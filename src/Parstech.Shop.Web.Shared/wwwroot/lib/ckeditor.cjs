"use strict";var Ds=Object.defineProperty;var Vs=(e,s,t)=>s in e?Ds(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var h=(e,s,t)=>Vs(e,typeof s!="symbol"?s+"":s,t);var jn=typeof global=="object"&&global&&global.Object===Object&&global,qs=typeof self=="object"&&self&&self.Object===Object&&self,J=jn||qs||Function("return this")(),j=J.Symbol,Jn=Object.prototype,js=Jn.hasOwnProperty,Js=Jn.toString,Tt=j?j.toStringTag:void 0;function zs(e){var s=js.call(e,Tt),t=e[Tt];try{e[Tt]=void 0;var n=!0}catch{}var r=Js.call(e);return n&&(s?e[Tt]=t:delete e[Tt]),r}var Us=Object.prototype,Ws=Us.toString;function Gs(e){return Ws.call(e)}var Ks="[object Null]",Hs="[object Undefined]",Ke=j?j.toStringTag:void 0;function bt(e){return e==null?e===void 0?Hs:Ks:Ke&&Ke in Object(e)?zs(e):Gs(e)}function et(e){return e!=null&&typeof e=="object"}var Ys="[object Symbol]";function Fe(e){return typeof e=="symbol"||et(e)&&bt(e)==Ys}function Xs(e,s){for(var t=-1,n=e==null?0:e.length,r=Array(n);++t<n;)r[t]=s(e[t],t,e);return r}var nt=Array.isArray,He=j?j.prototype:void 0,Ye=He?He.toString:void 0;function zn(e){if(typeof e=="string")return e;if(nt(e))return Xs(e,zn)+"";if(Fe(e))return Ye?Ye.call(e):"";var s=e+"";return s=="0"&&1/e==-1/0?"-0":s}function st(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var Zs="[object AsyncFunction]",Qs="[object Function]",tr="[object GeneratorFunction]",er="[object Proxy]";function Un(e){if(!st(e))return!1;var s=bt(e);return s==Qs||s==tr||s==Zs||s==er}var ae=J["__core-js_shared__"],Xe=function(){var e=/[^.]+$/.exec(ae&&ae.keys&&ae.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function nr(e){return!!Xe&&Xe in e}var sr=Function.prototype,rr=sr.toString;function ht(e){if(e!=null){try{return rr.call(e)}catch{}try{return e+""}catch{}}return""}var ir=/[\\^$.*+?()[\]{}|]/g,or=/^\[object .+?Constructor\]$/,ar=Function.prototype,lr=Object.prototype,cr=ar.toString,ur=lr.hasOwnProperty,hr=RegExp("^"+cr.call(ur).replace(ir,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fr(e){if(!st(e)||nr(e))return!1;var s=Un(e)?hr:or;return s.test(ht(e))}function dr(e,s){return e==null?void 0:e[s]}function ft(e,s){var t=dr(e,s);return fr(t)?t:void 0}var Ae=ft(J,"WeakMap"),Ze=Object.create,gr=function(){function e(){}return function(s){if(!st(s))return{};if(Ze)return Ze(s);e.prototype=s;var t=new e;return e.prototype=void 0,t}}();function pr(e,s){var t=-1,n=e.length;for(s||(s=Array(n));++t<n;)s[t]=e[t];return s}var Qe=function(){try{var e=ft(Object,"defineProperty");return e({},"",{}),e}catch{}}();function mr(e,s){for(var t=-1,n=e==null?0:e.length;++t<n&&s(e[t],t,e)!==!1;);return e}var _r=9007199254740991,yr=/^(?:0|[1-9]\d*)$/;function wr(e,s){var t=typeof e;return s=s??_r,!!s&&(t=="number"||t!="symbol"&&yr.test(e))&&e>-1&&e%1==0&&e<s}function Wn(e,s,t){s=="__proto__"&&Qe?Qe(e,s,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[s]=t}function Ie(e,s){return e===s||e!==e&&s!==s}var Pr=Object.prototype,vr=Pr.hasOwnProperty;function Gn(e,s,t){var n=e[s];(!(vr.call(e,s)&&Ie(n,t))||t===void 0&&!(s in e))&&Wn(e,s,t)}function ee(e,s,t,n){var r=!t;t||(t={});for(var i=-1,o=s.length;++i<o;){var a=s[i],l=void 0;l===void 0&&(l=e[a]),r?Wn(t,a,l):Gn(t,a,l)}return t}var br=9007199254740991;function Kn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=br}function Hn(e){return e!=null&&Kn(e.length)&&!Un(e)}var Ar=Object.prototype;function $e(e){var s=e&&e.constructor,t=typeof s=="function"&&s.prototype||Ar;return e===t}function Sr(e,s){for(var t=-1,n=Array(e);++t<e;)n[t]=s(t);return n}var Tr="[object Arguments]";function tn(e){return et(e)&&bt(e)==Tr}var Yn=Object.prototype,Er=Yn.hasOwnProperty,xr=Yn.propertyIsEnumerable,Or=tn(function(){return arguments}())?tn:function(e){return et(e)&&Er.call(e,"callee")&&!xr.call(e,"callee")};function Rr(){return!1}var Xn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,en=Xn&&typeof module=="object"&&module&&!module.nodeType&&module,Mr=en&&en.exports===Xn,nn=Mr?J.Buffer:void 0,kr=nn?nn.isBuffer:void 0,Yt=kr||Rr,Cr="[object Arguments]",Nr="[object Array]",Br="[object Boolean]",Fr="[object Date]",Ir="[object Error]",$r="[object Function]",Lr="[object Map]",Dr="[object Number]",Vr="[object Object]",qr="[object RegExp]",jr="[object Set]",Jr="[object String]",zr="[object WeakMap]",Ur="[object ArrayBuffer]",Wr="[object DataView]",Gr="[object Float32Array]",Kr="[object Float64Array]",Hr="[object Int8Array]",Yr="[object Int16Array]",Xr="[object Int32Array]",Zr="[object Uint8Array]",Qr="[object Uint8ClampedArray]",ti="[object Uint16Array]",ei="[object Uint32Array]",S={};S[Gr]=S[Kr]=S[Hr]=S[Yr]=S[Xr]=S[Zr]=S[Qr]=S[ti]=S[ei]=!0;S[Cr]=S[Nr]=S[Ur]=S[Br]=S[Wr]=S[Fr]=S[Ir]=S[$r]=S[Lr]=S[Dr]=S[Vr]=S[qr]=S[jr]=S[Jr]=S[zr]=!1;function ni(e){return et(e)&&Kn(e.length)&&!!S[bt(e)]}function Le(e){return function(s){return e(s)}}var Zn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Mt=Zn&&typeof module=="object"&&module&&!module.nodeType&&module,si=Mt&&Mt.exports===Zn,le=si&&jn.process,Pt=function(){try{var e=Mt&&Mt.require&&Mt.require("util").types;return e||le&&le.binding&&le.binding("util")}catch{}}(),sn=Pt&&Pt.isTypedArray,Qn=sn?Le(sn):ni,ri=Object.prototype,ii=ri.hasOwnProperty;function ts(e,s){var t=nt(e),n=!t&&Or(e),r=!t&&!n&&Yt(e),i=!t&&!n&&!r&&Qn(e),o=t||n||r||i,a=o?Sr(e.length,String):[],l=a.length;for(var c in e)(s||ii.call(e,c))&&!(o&&(c=="length"||r&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||wr(c,l)))&&a.push(c);return a}function es(e,s){return function(t){return e(s(t))}}var oi=es(Object.keys,Object),ai=Object.prototype,li=ai.hasOwnProperty;function ci(e){if(!$e(e))return oi(e);var s=[];for(var t in Object(e))li.call(e,t)&&t!="constructor"&&s.push(t);return s}function ns(e){return Hn(e)?ts(e):ci(e)}function ui(e){var s=[];if(e!=null)for(var t in Object(e))s.push(t);return s}var hi=Object.prototype,fi=hi.hasOwnProperty;function di(e){if(!st(e))return ui(e);var s=$e(e),t=[];for(var n in e)n=="constructor"&&(s||!fi.call(e,n))||t.push(n);return t}function gi(e){return Hn(e)?ts(e,!0):di(e)}var pi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mi=/^\w*$/;function _i(e,s){if(nt(e))return!1;var t=typeof e;return t=="number"||t=="symbol"||t=="boolean"||e==null||Fe(e)?!0:mi.test(e)||!pi.test(e)||s!=null&&e in Object(s)}var It=ft(Object,"create");function yi(){this.__data__=It?It(null):{},this.size=0}function wi(e){var s=this.has(e)&&delete this.__data__[e];return this.size-=s?1:0,s}var Pi="__lodash_hash_undefined__",vi=Object.prototype,bi=vi.hasOwnProperty;function Ai(e){var s=this.__data__;if(It){var t=s[e];return t===Pi?void 0:t}return bi.call(s,e)?s[e]:void 0}var Si=Object.prototype,Ti=Si.hasOwnProperty;function Ei(e){var s=this.__data__;return It?s[e]!==void 0:Ti.call(s,e)}var xi="__lodash_hash_undefined__";function Oi(e,s){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=It&&s===void 0?xi:s,this}function ct(e){var s=-1,t=e==null?0:e.length;for(this.clear();++s<t;){var n=e[s];this.set(n[0],n[1])}}ct.prototype.clear=yi;ct.prototype.delete=wi;ct.prototype.get=Ai;ct.prototype.has=Ei;ct.prototype.set=Oi;function Ri(){this.__data__=[],this.size=0}function ne(e,s){for(var t=e.length;t--;)if(Ie(e[t][0],s))return t;return-1}var Mi=Array.prototype,ki=Mi.splice;function Ci(e){var s=this.__data__,t=ne(s,e);if(t<0)return!1;var n=s.length-1;return t==n?s.pop():ki.call(s,t,1),--this.size,!0}function Ni(e){var s=this.__data__,t=ne(s,e);return t<0?void 0:s[t][1]}function Bi(e){return ne(this.__data__,e)>-1}function Fi(e,s){var t=this.__data__,n=ne(t,e);return n<0?(++this.size,t.push([e,s])):t[n][1]=s,this}function H(e){var s=-1,t=e==null?0:e.length;for(this.clear();++s<t;){var n=e[s];this.set(n[0],n[1])}}H.prototype.clear=Ri;H.prototype.delete=Ci;H.prototype.get=Ni;H.prototype.has=Bi;H.prototype.set=Fi;var $t=ft(J,"Map");function Ii(){this.size=0,this.__data__={hash:new ct,map:new($t||H),string:new ct}}function $i(e){var s=typeof e;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?e!=="__proto__":e===null}function se(e,s){var t=e.__data__;return $i(s)?t[typeof s=="string"?"string":"hash"]:t.map}function Li(e){var s=se(this,e).delete(e);return this.size-=s?1:0,s}function Di(e){return se(this,e).get(e)}function Vi(e){return se(this,e).has(e)}function qi(e,s){var t=se(this,e),n=t.size;return t.set(e,s),this.size+=t.size==n?0:1,this}function Y(e){var s=-1,t=e==null?0:e.length;for(this.clear();++s<t;){var n=e[s];this.set(n[0],n[1])}}Y.prototype.clear=Ii;Y.prototype.delete=Li;Y.prototype.get=Di;Y.prototype.has=Vi;Y.prototype.set=qi;var ji="Expected a function";function De(e,s){if(typeof e!="function"||s!=null&&typeof s!="function")throw new TypeError(ji);var t=function(){var n=arguments,r=s?s.apply(this,n):n[0],i=t.cache;if(i.has(r))return i.get(r);var o=e.apply(this,n);return t.cache=i.set(r,o)||i,o};return t.cache=new(De.Cache||Y),t}De.Cache=Y;var Ji=500;function zi(e){var s=De(e,function(n){return t.size===Ji&&t.clear(),n}),t=s.cache;return s}var Ui=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wi=/\\(\\)?/g,Gi=zi(function(e){var s=[];return e.charCodeAt(0)===46&&s.push(""),e.replace(Ui,function(t,n,r,i){s.push(r?i.replace(Wi,"$1"):n||t)}),s});function Ki(e){return e==null?"":zn(e)}function ss(e,s){return nt(e)?e:_i(e,s)?[e]:Gi(Ki(e))}function rs(e){if(typeof e=="string"||Fe(e))return e;var s=e+"";return s=="0"&&1/e==-1/0?"-0":s}function is(e,s){s=ss(s,e);for(var t=0,n=s.length;e!=null&&t<n;)e=e[rs(s[t++])];return t&&t==n?e:void 0}function Hi(e,s,t){var n=e==null?void 0:is(e,s);return n===void 0?t:n}function os(e,s){for(var t=-1,n=s.length,r=e.length;++t<n;)e[r+t]=s[t];return e}var as=es(Object.getPrototypeOf,Object);function Yi(e,s,t){var n=-1,r=e.length;s<0&&(s=-s>r?0:r+s),t=t>r?r:t,t<0&&(t+=r),r=s>t?0:t-s>>>0,s>>>=0;for(var i=Array(r);++n<r;)i[n]=e[n+s];return i}function Xi(){this.__data__=new H,this.size=0}function Zi(e){var s=this.__data__,t=s.delete(e);return this.size=s.size,t}function Qi(e){return this.__data__.get(e)}function to(e){return this.__data__.has(e)}var eo=200;function no(e,s){var t=this.__data__;if(t instanceof H){var n=t.__data__;if(!$t||n.length<eo-1)return n.push([e,s]),this.size=++t.size,this;t=this.__data__=new Y(n)}return t.set(e,s),this.size=t.size,this}function G(e){var s=this.__data__=new H(e);this.size=s.size}G.prototype.clear=Xi;G.prototype.delete=Zi;G.prototype.get=Qi;G.prototype.has=to;G.prototype.set=no;function so(e,s){return e&&ee(s,ns(s),e)}function ro(e,s){return e&&ee(s,gi(s),e)}var ls=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rn=ls&&typeof module=="object"&&module&&!module.nodeType&&module,io=rn&&rn.exports===ls,on=io?J.Buffer:void 0,an=on?on.allocUnsafe:void 0;function oo(e,s){var t=e.length,n=an?an(t):new e.constructor(t);return e.copy(n),n}function ao(e,s){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var o=e[t];s(o,t,e)&&(i[r++]=o)}return i}function cs(){return[]}var lo=Object.prototype,co=lo.propertyIsEnumerable,ln=Object.getOwnPropertySymbols,Ve=ln?function(e){return e==null?[]:(e=Object(e),ao(ln(e),function(s){return co.call(e,s)}))}:cs;function uo(e,s){return ee(e,Ve(e),s)}var ho=Object.getOwnPropertySymbols,fo=ho?function(e){for(var s=[];e;)os(s,Ve(e)),e=as(e);return s}:cs;function go(e,s){return ee(e,fo(e),s)}function po(e,s,t){var n=s(e);return nt(e)?n:os(n,t(e))}function Se(e){return po(e,ns,Ve)}var Te=ft(J,"DataView"),Ee=ft(J,"Promise"),xe=ft(J,"Set"),cn="[object Map]",mo="[object Object]",un="[object Promise]",hn="[object Set]",fn="[object WeakMap]",dn="[object DataView]",_o=ht(Te),yo=ht($t),wo=ht(Ee),Po=ht(xe),vo=ht(Ae),L=bt;(Te&&L(new Te(new ArrayBuffer(1)))!=dn||$t&&L(new $t)!=cn||Ee&&L(Ee.resolve())!=un||xe&&L(new xe)!=hn||Ae&&L(new Ae)!=fn)&&(L=function(e){var s=bt(e),t=s==mo?e.constructor:void 0,n=t?ht(t):"";if(n)switch(n){case _o:return dn;case yo:return cn;case wo:return un;case Po:return hn;case vo:return fn}return s});var bo=Object.prototype,Ao=bo.hasOwnProperty;function So(e){var s=e.length,t=new e.constructor(s);return s&&typeof e[0]=="string"&&Ao.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var Xt=J.Uint8Array;function To(e){var s=new e.constructor(e.byteLength);return new Xt(s).set(new Xt(e)),s}function Eo(e,s){var t=e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var xo=/\w*$/;function Oo(e){var s=new e.constructor(e.source,xo.exec(e));return s.lastIndex=e.lastIndex,s}var gn=j?j.prototype:void 0,pn=gn?gn.valueOf:void 0;function Ro(e){return pn?Object(pn.call(e)):{}}function Mo(e,s){var t=e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var ko="[object Boolean]",Co="[object Date]",No="[object Map]",Bo="[object Number]",Fo="[object RegExp]",Io="[object Set]",$o="[object String]",Lo="[object Symbol]",Do="[object ArrayBuffer]",Vo="[object DataView]",qo="[object Float32Array]",jo="[object Float64Array]",Jo="[object Int8Array]",zo="[object Int16Array]",Uo="[object Int32Array]",Wo="[object Uint8Array]",Go="[object Uint8ClampedArray]",Ko="[object Uint16Array]",Ho="[object Uint32Array]";function Yo(e,s,t){var n=e.constructor;switch(s){case Do:return To(e);case ko:case Co:return new n(+e);case Vo:return Eo(e);case qo:case jo:case Jo:case zo:case Uo:case Wo:case Go:case Ko:case Ho:return Mo(e);case No:return new n;case Bo:case $o:return new n(e);case Fo:return Oo(e);case Io:return new n;case Lo:return Ro(e)}}function Xo(e){return typeof e.constructor=="function"&&!$e(e)?gr(as(e)):{}}var Zo="[object Map]";function Qo(e){return et(e)&&L(e)==Zo}var mn=Pt&&Pt.isMap,ta=mn?Le(mn):Qo,ea="[object Set]";function na(e){return et(e)&&L(e)==ea}var _n=Pt&&Pt.isSet,sa=_n?Le(_n):na,ra=2,us="[object Arguments]",ia="[object Array]",oa="[object Boolean]",aa="[object Date]",la="[object Error]",hs="[object Function]",ca="[object GeneratorFunction]",ua="[object Map]",ha="[object Number]",fs="[object Object]",fa="[object RegExp]",da="[object Set]",ga="[object String]",pa="[object Symbol]",ma="[object WeakMap]",_a="[object ArrayBuffer]",ya="[object DataView]",wa="[object Float32Array]",Pa="[object Float64Array]",va="[object Int8Array]",ba="[object Int16Array]",Aa="[object Int32Array]",Sa="[object Uint8Array]",Ta="[object Uint8ClampedArray]",Ea="[object Uint16Array]",xa="[object Uint32Array]",b={};b[us]=b[ia]=b[_a]=b[ya]=b[oa]=b[aa]=b[wa]=b[Pa]=b[va]=b[ba]=b[Aa]=b[ua]=b[ha]=b[fs]=b[fa]=b[da]=b[ga]=b[pa]=b[Sa]=b[Ta]=b[Ea]=b[xa]=!0;b[la]=b[hs]=b[ma]=!1;function Ht(e,s,t,n,r,i){var o,a=s&ra;if(o!==void 0)return o;if(!st(e))return e;var l=nt(e);if(l)return o=So(e),pr(e,o);var c=L(e),u=c==hs||c==ca;if(Yt(e))return oo(e);if(c==fs||c==us||u&&!r)return o=u?{}:Xo(e),a?go(e,ro(o,e)):uo(e,so(o,e));if(!b[c])return r?e:{};o=Yo(e,c),i||(i=new G);var f=i.get(e);if(f)return f;i.set(e,o),sa(e)?e.forEach(function(y){o.add(Ht(y,s,t,y,e,i))}):ta(e)&&e.forEach(function(y,w){o.set(w,Ht(y,s,t,w,e,i))});var d=Se,m=l?void 0:d(e);return mr(m||e,function(y,w){m&&(w=y,y=e[w]),Gn(o,w,Ht(y,s,t,w,e,i))}),o}var Oa=4;function Ra(e){return Ht(e,Oa)}var Ma="__lodash_hash_undefined__";function ka(e){return this.__data__.set(e,Ma),this}function Ca(e){return this.__data__.has(e)}function Zt(e){var s=-1,t=e==null?0:e.length;for(this.__data__=new Y;++s<t;)this.add(e[s])}Zt.prototype.add=Zt.prototype.push=ka;Zt.prototype.has=Ca;function Na(e,s){for(var t=-1,n=e==null?0:e.length;++t<n;)if(s(e[t],t,e))return!0;return!1}function Ba(e,s){return e.has(s)}var Fa=1,Ia=2;function ds(e,s,t,n,r,i){var o=t&Fa,a=e.length,l=s.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(e),u=i.get(s);if(c&&u)return c==s&&u==e;var f=-1,d=!0,m=t&Ia?new Zt:void 0;for(i.set(e,s),i.set(s,e);++f<a;){var y=e[f],w=s[f];if(n)var k=o?n(w,y,f,s,e,i):n(y,w,f,e,s,i);if(k!==void 0){if(k)continue;d=!1;break}if(m){if(!Na(s,function(V,it){if(!Ba(m,it)&&(y===V||r(y,V,t,n,i)))return m.push(it)})){d=!1;break}}else if(!(y===w||r(y,w,t,n,i))){d=!1;break}}return i.delete(e),i.delete(s),d}function $a(e){var s=-1,t=Array(e.size);return e.forEach(function(n,r){t[++s]=[r,n]}),t}function La(e){var s=-1,t=Array(e.size);return e.forEach(function(n){t[++s]=n}),t}var Da=1,Va=2,qa="[object Boolean]",ja="[object Date]",Ja="[object Error]",za="[object Map]",Ua="[object Number]",Wa="[object RegExp]",Ga="[object Set]",Ka="[object String]",Ha="[object Symbol]",Ya="[object ArrayBuffer]",Xa="[object DataView]",yn=j?j.prototype:void 0,ce=yn?yn.valueOf:void 0;function Za(e,s,t,n,r,i,o){switch(t){case Xa:if(e.byteLength!=s.byteLength||e.byteOffset!=s.byteOffset)return!1;e=e.buffer,s=s.buffer;case Ya:return!(e.byteLength!=s.byteLength||!i(new Xt(e),new Xt(s)));case qa:case ja:case Ua:return Ie(+e,+s);case Ja:return e.name==s.name&&e.message==s.message;case Wa:case Ka:return e==s+"";case za:var a=$a;case Ga:var l=n&Da;if(a||(a=La),e.size!=s.size&&!l)return!1;var c=o.get(e);if(c)return c==s;n|=Va,o.set(e,s);var u=ds(a(e),a(s),n,r,i,o);return o.delete(e),u;case Ha:if(ce)return ce.call(e)==ce.call(s)}return!1}var Qa=1,tl=Object.prototype,el=tl.hasOwnProperty;function nl(e,s,t,n,r,i){var o=t&Qa,a=Se(e),l=a.length,c=Se(s),u=c.length;if(l!=u&&!o)return!1;for(var f=l;f--;){var d=a[f];if(!(o?d in s:el.call(s,d)))return!1}var m=i.get(e),y=i.get(s);if(m&&y)return m==s&&y==e;var w=!0;i.set(e,s),i.set(s,e);for(var k=o;++f<l;){d=a[f];var V=e[d],it=s[d];if(n)var Ge=o?n(it,V,d,s,e,i):n(V,it,d,e,s,i);if(!(Ge===void 0?V===it||r(V,it,t,n,i):Ge)){w=!1;break}k||(k=d=="constructor")}if(w&&!k){var Ut=e.constructor,Wt=s.constructor;Ut!=Wt&&"constructor"in e&&"constructor"in s&&!(typeof Ut=="function"&&Ut instanceof Ut&&typeof Wt=="function"&&Wt instanceof Wt)&&(w=!1)}return i.delete(e),i.delete(s),w}var sl=1,wn="[object Arguments]",Pn="[object Array]",Gt="[object Object]",rl=Object.prototype,vn=rl.hasOwnProperty;function il(e,s,t,n,r,i){var o=nt(e),a=nt(s),l=o?Pn:L(e),c=a?Pn:L(s);l=l==wn?Gt:l,c=c==wn?Gt:c;var u=l==Gt,f=c==Gt,d=l==c;if(d&&Yt(e)){if(!Yt(s))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new G),o||Qn(e)?ds(e,s,t,n,r,i):Za(e,s,l,t,n,r,i);if(!(t&sl)){var m=u&&vn.call(e,"__wrapped__"),y=f&&vn.call(s,"__wrapped__");if(m||y){var w=m?e.value():e,k=y?s.value():s;return i||(i=new G),r(w,k,t,n,i)}}return d?(i||(i=new G),nl(e,s,t,n,r,i)):!1}function gs(e,s,t,n,r){return e===s?!0:e==null||s==null||!et(e)&&!et(s)?e!==e&&s!==s:il(e,s,t,n,gs,r)}function ol(e){var s=e==null?0:e.length;return s?e[s-1]:void 0}function al(e,s){return s.length<2?e:is(e,Yi(s,0,-1))}function bn(e,s){return gs(e,s)}function ll(e,s){return s=ss(s,e),e=al(e,s),e==null||delete e[rs(ol(s))]}function cl(e,s){return e==null?!0:ll(e,s)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 *//**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let Oe;try{Oe={window,document}}catch{/* istanbul ignore next -- @preserve */Oe={window:{},document:{}}}var Lt=Oe;/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function An(){return function e(){e.called=!0}}class vt{constructor(s,t){h(this,"source");h(this,"name");h(this,"path");h(this,"stop");h(this,"off");h(this,"return");this.source=s,this.name=t,this.path=[],this.stop=An(),this.off=An()}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const C=new Array(256).fill("").map((e,s)=>("0"+s.toString(16)).slice(-2));function re(){const[e,s,t,n]=crypto.getRandomValues(new Uint32Array(4));return"e"+C[e>>0&255]+C[e>>8&255]+C[e>>16&255]+C[e>>24&255]+C[s>>0&255]+C[s>>8&255]+C[s>>16&255]+C[s>>24&255]+C[t>>0&255]+C[t>>8&255]+C[t>>16&255]+C[t>>24&255]+C[n>>0&255]+C[n>>8&255]+C[n>>16&255]+C[n>>24&255]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Re={get(e="normal"){return typeof e!="number"?this[e]||this.normal:e},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};function ul(e,s){const t=Re.get(s.priority);let n=0,r=e.length;for(;n<r;){const i=n+r>>1;Re.get(e[i].priority)<t?r=i:n=i+1}e.splice(n,0,s)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const hl="https://ckeditor.com/docs/ckeditor5/latest/support/error-codes.html";class g extends Error{constructor(t,n,r){super(fl(t,r));h(this,"context");h(this,"data");this.name="CKEditorError",this.context=n,this.data=r}is(t){return t==="CKEditorError"}static rethrowUnexpectedError(t,n){if(t.is&&t.is("CKEditorError"))throw t;const r=new g(t.message,n);throw r.stack=t.stack,r}}function Me(e,s){console.warn(...dl(e,s))}function ps(e){return`
Read more: ${hl}#error-${e}`}function fl(e,s){const t=new WeakSet,r=s?` ${JSON.stringify(s,(o,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return`[object ${a.constructor.name}]`;t.add(a)}return a})}`:"",i=ps(e);return e+r+i}function dl(e,s){const t=ps(e);return s?[e,s,t]:[e,t]}const gl="44.3.0";/* istanbul ignore next -- @preserve */if(globalThis.CKEDITOR_VERSION)throw new g("ckeditor-duplicated-modules",null);globalThis.CKEDITOR_VERSION=gl;const _t=Symbol("listeningTo"),ke=Symbol("emitterId"),z=Symbol("delegations"),ms=O(Object);function O(e){if(!e)return ms;class s extends e{on(n,r,i){this.listenTo(this,n,r,i)}once(n,r,i){let o=!1;const a=(l,...c)=>{o||(o=!0,l.off(),r.call(this,l,...c))};this.listenTo(this,n,a,i)}off(n,r){this.stopListening(this,n,r)}listenTo(n,r,i,o={}){let a,l;this[_t]||(this[_t]={});const c=this[_t];ue(n)||_s(n);const u=ue(n);(a=c[u])||(a=c[u]={emitter:n,callbacks:{}}),(l=a.callbacks[r])||(l=a.callbacks[r]=[]),l.push(i),wl(this,n,r,i,o)}stopListening(n,r,i){const o=this[_t];let a=n&&ue(n);const l=o&&a?o[a]:void 0,c=l&&r?l.callbacks[r]:void 0;if(!(!o||n&&!l||r&&!c))if(i)he(this,n,r,i),c.indexOf(i)!==-1&&(c.length===1?delete l.callbacks[r]:he(this,n,r,i));else if(c){for(;i=c.pop();)he(this,n,r,i);delete l.callbacks[r]}else if(l){for(r in l.callbacks)this.stopListening(n,r);delete o[a]}else{for(a in o)this.stopListening(o[a].emitter);delete this[_t]}}fire(n,...r){try{const i=n instanceof vt?n:new vt(this,n),o=i.name;let a=yl(this,o);if(i.path.push(this),a){a=a.slice();for(let c=0;c<a.length;c++){const u=a[c].callback;if(u.call(this,i,...r),i.off.called&&(delete i.off.called,this._removeEventListener(o,u)),i.stop.called)break}}const l=this[z];if(l){const c=l.get(o),u=l.get("*");c&&Sn(c,i,r),u&&Sn(u,i,r)}return i.return}catch(i){/* istanbul ignore next -- @preserve */g.rethrowUnexpectedError(i,this)}}delegate(...n){return{to:(r,i)=>{this[z]||(this[z]=new Map),n.forEach(o=>{const a=this[z].get(o);a?a.set(r,i):this[z].set(o,new Map([[r,i]]))})}}}stopDelegating(n,r){if(this[z])if(!n)this[z].clear();else if(!r)this[z].delete(n);else{const i=this[z].get(n);i&&i.delete(r)}}_addEventListener(n,r,i){_l(this,n);const o=Ce(this,n),a=Re.get(i.priority),l={callback:r,priority:a};for(const c of o)ul(c,l)}_removeEventListener(n,r){const i=Ce(this,n);for(const o of i)for(let a=0;a<o.length;a++)o[a].callback==r&&(o.splice(a,1),a--)}}return s}["on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(e=>{O[e]=ms.prototype[e]});function pl(e,s){const t=e[_t];return t&&t[s]?t[s].emitter:null}function _s(e,s){e[ke]||(e[ke]=s||re())}function ue(e){return e[ke]}function ys(e){return e._events||Object.defineProperty(e,"_events",{value:{}}),e._events}function ml(){return{callbacks:[],childEvents:[]}}function _l(e,s){const t=ys(e);if(t[s])return;let n=s,r=null;const i=[];for(;n!==""&&!t[n];)t[n]=ml(),i.push(t[n]),r&&t[n].childEvents.push(r),r=n,n=n.substr(0,n.lastIndexOf(":"));if(n!==""){for(const o of i)o.callbacks=t[n].callbacks.slice();t[n].childEvents.push(r)}}function Ce(e,s){const t=ys(e)[s];if(!t)return[];let n=[t.callbacks];for(let r=0;r<t.childEvents.length;r++){const i=Ce(e,t.childEvents[r]);n=n.concat(i)}return n}function yl(e,s){if(!e._events)return null;let t=s;do{const n=e._events[t];if(n&&n.callbacks&&n.callbacks.length)return n.callbacks;const r=t.lastIndexOf(":");t=r>-1?t.substring(0,r):""}while(t);return null}function Sn(e,s,t){for(let[n,r]of e){r?typeof r=="function"&&(r=r(s.name)):r=s.name;const i=new vt(s.source,r);i.path=[...s.path],n.fire(i,...t)}}function wl(e,s,t,n,r){s._addEventListener?s._addEventListener(t,n,r):e._addEventListener.call(s,t,n,r)}function he(e,s,t,n){s._removeEventListener?s._removeEventListener(t,n):e._removeEventListener.call(s,t,n)}const kt=Symbol("observableProperties"),Dt=Symbol("boundObservables"),Ct=Symbol("boundProperties"),ot=Symbol("decoratedMethods"),Tn=Symbol("decoratedOriginal"),ws=qe(O());function qe(e){var t,n,r,i,o;if(!e)return ws;class s extends(o=e,i=kt,r=ot,n=Ct,t=Dt,o){constructor(){super(...arguments);h(this,i);h(this,r);h(this,n);h(this,t)}set(c,u){if(st(c)){Object.keys(c).forEach(d=>{this.set(d,c[d])},this);return}fe(this);const f=this[kt];if(c in this&&!f.has(c))throw new g("observable-set-cannot-override",this);Object.defineProperty(this,c,{enumerable:!0,configurable:!0,get(){return f.get(c)},set(d){const m=f.get(c);let y=this.fire(`set:${c}`,c,d,m);y===void 0&&(y=d),(m!==y||!f.has(c))&&(f.set(c,y),this.fire(`change:${c}`,c,y,m))}}),this[c]=u}bind(...c){if(!c.length||!En(c))throw new g("observable-bind-wrong-properties",this);if(new Set(c).size!==c.length)throw new g("observable-bind-duplicate-properties",this);fe(this);const u=this[Ct];c.forEach(d=>{if(u.has(d))throw new g("observable-bind-rebind",this)});const f=new Map;return c.forEach(d=>{const m={property:d,to:[]};u.set(d,m),f.set(d,m)}),{to:Pl,toMany:vl,_observable:this,_bindProperties:c,_to:[],_bindings:f}}unbind(...c){if(!this[kt])return;const u=this[Ct],f=this[Dt];if(c.length){if(!En(c))throw new g("observable-unbind-wrong-properties",this);c.forEach(d=>{const m=u.get(d);m&&(m.to.forEach(([y,w])=>{const k=f.get(y),V=k[w];V.delete(m),V.size||delete k[w],Object.keys(k).length||(f.delete(y),this.stopListening(y,"change"))}),u.delete(d))})}else f.forEach((d,m)=>{this.stopListening(m,"change")}),f.clear(),u.clear()}decorate(c){fe(this);const u=this[c];if(!u)throw new g("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:c});this.on(c,(f,d)=>{f.return=u.apply(this,d)}),this[c]=function(...f){return this.fire(c,f)},this[c][Tn]=u,this[ot]||(this[ot]=[]),this[ot].push(c)}stopListening(c,u,f){if(!c&&this[ot]){for(const d of this[ot])this[d]=this[d][Tn];delete this[ot]}super.stopListening(c,u,f)}}return s}["set","bind","unbind","decorate","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(e=>{qe[e]=ws.prototype[e]});function fe(e){e[kt]||(Object.defineProperty(e,kt,{value:new Map}),Object.defineProperty(e,Dt,{value:new Map}),Object.defineProperty(e,Ct,{value:new Map}))}function Pl(...e){const s=Al(...e),t=Array.from(this._bindings.keys()),n=t.length;if(!s.callback&&s.to.length>1)throw new g("observable-bind-to-no-callback",this);if(n>1&&s.callback)throw new g("observable-bind-to-extra-callback",this);s.to.forEach(r=>{if(r.properties.length&&r.properties.length!==n)throw new g("observable-bind-to-properties-length",this);r.properties.length||(r.properties=this._bindProperties)}),this._to=s.to,s.callback&&(this._bindings.get(t[0]).callback=s.callback),El(this._observable,this._to),Tl(this),this._bindProperties.forEach(r=>{Ps(this._observable,r)})}function vl(e,s,t){if(this._bindings.size>1)throw new g("observable-bind-to-many-not-one-binding",this);this.to(...bl(e,s),t)}function bl(e,s){const t=e.map(n=>[n,s]);return Array.prototype.concat.apply([],t)}function En(e){return e.every(s=>typeof s=="string")}function Al(...e){if(!e.length)throw new g("observable-bind-to-parse-error",null);const s={to:[]};let t;return typeof e[e.length-1]=="function"&&(s.callback=e.pop()),e.forEach(n=>{if(typeof n=="string")t.properties.push(n);else if(typeof n=="object")t={observable:n,properties:[]},s.to.push(t);else throw new g("observable-bind-to-parse-error",null)}),s}function Sl(e,s,t,n){const r=e[Dt],i=r.get(t),o=i||{};o[n]||(o[n]=new Set),o[n].add(s),i||r.set(t,o)}function Tl(e){let s;e._bindings.forEach((t,n)=>{e._to.forEach(r=>{s=r.properties[t.callback?0:e._bindProperties.indexOf(n)],t.to.push([r.observable,s]),Sl(e._observable,t,r.observable,s)})})}function Ps(e,s){const n=e[Ct].get(s);let r;n.callback?r=n.callback.apply(e,n.to.map(i=>i[0][i[1]])):(r=n.to[0],r=r[0][r[1]]),Object.prototype.hasOwnProperty.call(e,s)?e[s]=r:e.set(s,r)}function El(e,s){s.forEach(t=>{const n=e[Dt];let r;n.get(t.observable)||e.listenTo(t.observable,"change",(i,o)=>{r=n.get(t.observable)[o],r&&r.forEach(a=>{Ps(e,a.property)})})})}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function xn(e){let s=0;for(const t of e)s++;return s}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function B(e,s){const t=Math.min(e.length,s.length);for(let n=0;n<t;n++)if(e[n]!=s[n])return n;return e.length==s.length?"same":e.length<s.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function X(e){return!!(e&&e[Symbol.iterator])}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function On(e){if(e){if(e.defaultView)return e instanceof e.defaultView.Document;if(e.ownerDocument&&e.ownerDocument.defaultView)return e instanceof e.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Rn(e){const s=Object.prototype.toString.apply(e);return s=="[object Window]"||s=="[object global]"}const vs=bs(O());function bs(e){if(!e)return vs;class s extends e{listenTo(n,r,i,o={}){if(On(n)||Rn(n)){const a={capture:!!o.useCapture,passive:!!o.usePassive},l=this._getProxyEmitter(n,a)||new xl(n,a);this.listenTo(l,r,i,o)}else super.listenTo(n,r,i,o)}stopListening(n,r,i){if(On(n)||Rn(n)){const o=this._getAllProxyEmitters(n);for(const a of o)this.stopListening(a,r,i)}else super.stopListening(n,r,i)}_getProxyEmitter(n,r){return pl(this,As(n,r))}_getAllProxyEmitters(n){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(r=>this._getProxyEmitter(n,r)).filter(r=>!!r)}}return s}["_getProxyEmitter","_getAllProxyEmitters","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(e=>{bs[e]=vs.prototype[e]});class xl extends O(){constructor(t,n){super();h(this,"_domNode");h(this,"_options");h(this,"_domListeners");_s(this,As(t,n)),this._domNode=t,this._options=n}attach(t){if(this._domListeners&&this._domListeners[t])return;const n=this._createDomListener(t);this._domNode.addEventListener(t,n,this._options),this._domListeners||(this._domListeners={}),this._domListeners[t]=n}detach(t){let n;this._domListeners[t]&&(!(n=this._events[t])||!n.callbacks.length)&&this._domListeners[t].removeListener()}_addEventListener(t,n,r){this.attach(t),O().prototype._addEventListener.call(this,t,n,r)}_removeEventListener(t,n){O().prototype._removeEventListener.call(this,t,n),this.detach(t)}_createDomListener(t){const n=r=>{this.fire(t,r)};return n.removeListener=()=>{this._domNode.removeEventListener(t,n,this._options),delete this._domListeners[t]},n}}function Ol(e){return e["data-ck-expando"]||(e["data-ck-expando"]=re())}function As(e,s){let t=Ol(e);for(const n of Object.keys(s).sort())s[n]&&(t+="-"+n);return t}const Nt=Rl();function Rl(){const e={pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,space:32,esc:27,tab:9,ctrl:1114112,shift:2228224,alt:4456448,cmd:8912896};for(let s=65;s<=90;s++){const t=String.fromCharCode(s);e[t.toLowerCase()]=s}for(let s=48;s<=57;s++)e[s-48]=s;for(let s=112;s<=123;s++)e["f"+(s-111)]=s;return Object.assign(e,{"'":222,",":108,"-":109,".":110,"/":111,";":186,"=":187,"[":219,"\\":220,"]":221,"`":223}),e}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Qt(e){return Array.isArray(e)?e:[e]}/* istanbul ignore else -- @preserve */Lt.window.CKEDITOR_TRANSLATIONS||(Lt.window.CKEDITOR_TRANSLATIONS={});class Ml extends O(){constructor(t={},n={}){super();h(this,"_items");h(this,"_itemMap");h(this,"_idProperty");h(this,"_bindToCollection");h(this,"_bindToExternalToInternalMap");h(this,"_bindToInternalToExternalMap");h(this,"_skippedIndexesFromExternal");const r=X(t);if(r||(n=t),this._items=[],this._itemMap=new Map,this._idProperty=n.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],r)for(const i of t)this._items.push(i),this._itemMap.set(this._getItemIdBeforeAdding(i),i)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(t,n){return this.addMany([t],n)}addMany(t,n){if(n===void 0)n=this._items.length;else if(n>this._items.length||n<0)throw new g("collection-add-item-invalid-index",this);let r=0;for(const i of t){const o=this._getItemIdBeforeAdding(i),a=n+r;this._items.splice(a,0,i),this._itemMap.set(o,i),this.fire("add",i,a),r++}return this.fire("change",{added:t,removed:[],index:n}),this}get(t){let n;if(typeof t=="string")n=this._itemMap.get(t);else if(typeof t=="number")n=this._items[t];else throw new g("collection-get-invalid-arg",this);return n||null}has(t){if(typeof t=="string")return this._itemMap.has(t);{const n=this._idProperty,r=t[n];return r&&this._itemMap.has(r)}}getIndex(t){let n;return typeof t=="string"?n=this._itemMap.get(t):n=t,n?this._items.indexOf(n):-1}remove(t){const[n,r]=this._remove(t);return this.fire("change",{added:[],removed:[n],index:r}),n}map(t,n){return this._items.map(t,n)}forEach(t,n){this._items.forEach(t,n)}find(t,n){return this._items.find(t,n)}filter(t,n){return this._items.filter(t,n)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const t=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:t,index:0})}bindTo(t){if(this._bindToCollection)throw new g("collection-bind-to-rebind",this);return this._bindToCollection=t,{as:n=>{this._setUpBindToBinding(r=>new n(r))},using:n=>{typeof n=="function"?this._setUpBindToBinding(n):this._setUpBindToBinding(r=>r[n])}}}_setUpBindToBinding(t){const n=this._bindToCollection,r=(i,o,a)=>{const l=n._bindToCollection==this,c=n._bindToInternalToExternalMap.get(o);if(l&&c)this._bindToExternalToInternalMap.set(o,c),this._bindToInternalToExternalMap.set(c,o);else{const u=t(o);if(!u){this._skippedIndexesFromExternal.push(a);return}let f=a;for(const d of this._skippedIndexesFromExternal)a>d&&f--;for(const d of n._skippedIndexesFromExternal)f>=d&&f++;this._bindToExternalToInternalMap.set(o,u),this._bindToInternalToExternalMap.set(u,o),this.add(u,f);for(let d=0;d<n._skippedIndexesFromExternal.length;d++)f<=n._skippedIndexesFromExternal[d]&&n._skippedIndexesFromExternal[d]++}};for(const i of n)r(null,i,n.getIndex(i));this.listenTo(n,"add",r),this.listenTo(n,"remove",(i,o,a)=>{const l=this._bindToExternalToInternalMap.get(o);l&&this.remove(l),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((c,u)=>(a<u&&c.push(u-1),a>u&&c.push(u),c),[])})}_getItemIdBeforeAdding(t){const n=this._idProperty;let r;if(n in t){if(r=t[n],typeof r!="string")throw new g("collection-add-invalid-id",this);if(this.get(r))throw new g("collection-add-item-already-exists",this)}else t[n]=r=re();return r}_remove(t){let n,r,i,o=!1;const a=this._idProperty;if(typeof t=="string"?(r=t,i=this._itemMap.get(r),o=!i,i&&(n=this._items.indexOf(i))):typeof t=="number"?(n=t,i=this._items[n],o=!i,i&&(r=i[a])):(i=t,r=i[a],n=this._items.indexOf(i),o=n==-1||!this._itemMap.get(r)),o)throw new g("collection-remove-404",this);this._items.splice(n,1),this._itemMap.delete(r);const l=this._bindToInternalToExternalMap.get(i);return this._bindToInternalToExternalMap.delete(i),this._bindToExternalToInternalMap.delete(l),this.fire("remove",i,n),[i,n]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function kl(e){const s=new Map;for(const t in e)s.set(t,e[t]);return s}function Vt(e){return X(e)?new Map(e):kl(e)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Mn(e,s,t){const n=e.length,r=s.length;for(let i=n-1;i>=t;i--)e[i+r]=e[i];for(let i=0;i<r;i++)e[t+i]=s[i]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 *//**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let dt=class{is(){throw new Error("is() method is abstract")}},gt=class extends O(dt){constructor(t){super();h(this,"document");h(this,"parent");this.document=t,this.parent=null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))==-1)throw new g("view-node-not-found-in-parent",this);return t}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.root.is("rootElement")}getPath(){const t=[];let n=this;for(;n.parent;)t.unshift(n.index),n=n.parent;return t}getAncestors(t={}){const n=[];let r=t.includeSelf?this:this.parent;for(;r;)n[t.parentFirst?"push":"unshift"](r),r=r.parent;return n}getCommonAncestor(t,n={}){const r=this.getAncestors(n),i=t.getAncestors(n);let o=0;for(;r[o]==i[o]&&r[o];)o++;return o===0?null:r[o-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const n=this.getPath(),r=t.getPath(),i=B(n,r);switch(i){case"prefix":return!0;case"extension":return!1;default:return n[i]<r[i]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}_remove(){this.parent._removeChildren(this.index)}_fireChange(t,n,r){this.fire(`change:${t}`,n,r),this.parent&&this.parent._fireChange(t,n,r)}toJSON(){const t=Ra(this);return delete t.parent,t}};gt.prototype.is=function(e){return e==="node"||e==="view:node"};let lt=class Ne extends gt{constructor(t,n){super(t);h(this,"_textData");this._textData=n}get data(){return this._textData}get _data(){return this.data}set _data(t){this._fireChange("text",this),this._textData=t}isSimilar(t){return t instanceof Ne?this===t||this.data===t.data:!1}_clone(){return new Ne(this.document,this.data)}};lt.prototype.is=function(e){return e==="$text"||e==="view:$text"||e==="text"||e==="view:text"||e==="node"||e==="view:node"};let W=class extends dt{constructor(t,n,r){super();h(this,"textNode");h(this,"data");h(this,"offsetInText");if(this.textNode=t,n<0||n>t.data.length)throw new g("view-textproxy-wrong-offsetintext",this);if(r<0||n+r>t.data.length)throw new g("view-textproxy-wrong-length",this);this.data=t.data.substring(n,n+r),this.offsetInText=n}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(t={}){const n=[];let r=t.includeSelf?this.textNode:this.parent;for(;r!==null;)n[t.parentFirst?"push":"unshift"](r),r=r.parent;return n}};W.prototype.is=function(e){return e==="$textProxy"||e==="view:$textProxy"||e==="textProxy"||e==="view:textProxy"};function Cl(e){const s=[];return"attributes"in e&&e.attributes&&de(s,e.attributes),"classes"in e&&e.classes&&de(s,e.classes,"class"),"styles"in e&&e.styles&&de(s,e.styles,"style"),{name:e.name||!1,attributes:s}}function de(e,s,t){if(typeof s=="string"){e.push(t?[t,s]:[s]);return}for(const n of s)Array.isArray(n)?e.push(n):e.push(t?[t,n]:[n])}class Nl{constructor(...s){h(this,"_patterns",[]);this.add(...s)}add(...s){for(let t of s)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...s){for(const t of s)for(const n of this._patterns){const r=this._isElementMatching(t,n);if(r)return{element:t,pattern:n,match:r}}return null}matchAll(...s){const t=[];for(const n of s)for(const r of this._patterns){const i=this._isElementMatching(n,r);i&&t.push({element:n,pattern:r,match:i})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const s=this._patterns[0],t=s.name;return typeof s!="function"&&t&&!(t instanceof RegExp)?t:null}_isElementMatching(s,t){if(typeof t=="function"){const i=t(s);return!i||typeof i!="object"?i:Cl(i)}const n={};if(t.name&&(n.name=Bl(t.name,s.name),!n.name))return null;const r=[];return t.attributes&&!Fl(t.attributes,s,r)||t.classes&&!Il(t.classes,s,r)||t.styles&&!$l(t.styles,s,r)?null:(r.length&&(n.attributes=r),n)}}function te(e,s){return e===!0||e===s||e instanceof RegExp&&!!String(s).match(e)}function Bl(e,s){return e instanceof RegExp?!!s.match(e):e===s}function je(e,s){if(Array.isArray(e))return e.map(n=>typeof n!="object"||n instanceof RegExp?s?[s,n,!0]:[n,!0]:((n.key===void 0||n.value===void 0)&&Me("matcher-pattern-missing-key-or-value",n),s?[s,n.key,n.value]:[n.key,n.value]));if(typeof e!="object"||e instanceof RegExp)return[s?[s,e,!0]:[e,!0]];const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(s?[s,n,e[n]]:[n,e[n]]);return t}function Fl(e,s,t){let n;return typeof e=="object"&&!(e instanceof RegExp)&&!Array.isArray(e)?(e.style!==void 0&&Me("matcher-pattern-deprecated-attributes-style-key",e),e.class!==void 0&&Me("matcher-pattern-deprecated-attributes-class-key",e)):n=["class","style"],s._collectAttributesMatch(je(e),t,n)}function Il(e,s,t){return s._collectAttributesMatch(je(e,"class"),t)}function $l(e,s,t){return s._collectAttributesMatch(je(e,"style"),t)}class ge{constructor(s){h(this,"_styles");h(this,"_cachedStyleNames",null);h(this,"_cachedExpandedStyleNames",null);h(this,"_styleProcessor");this._styles={},this._styleProcessor=s}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(s){this.clear();const t=Ll(s);for(const[n,r]of t)this._styleProcessor.toNormalizedForm(n,r,this._styles);return this}has(s){if(this.isEmpty)return!1;const n=this._styleProcessor.getReducedForm(s,this._styles).find(([r])=>r===s);return Array.isArray(n)}set(s,t){if(this._cachedStyleNames=null,this._cachedExpandedStyleNames=null,st(s))for(const[n,r]of Object.entries(s))this._styleProcessor.toNormalizedForm(n,r,this._styles);else this._styleProcessor.toNormalizedForm(s,t,this._styles)}remove(s){for(const t of Qt(s)){this._cachedStyleNames=null,this._cachedExpandedStyleNames=null;const n=Dl(t);cl(this._styles,n),delete this._styles[t],this._cleanEmptyObjectsOnPath(n)}}getNormalized(s){return this._styleProcessor.getNormalized(s,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map(s=>s.join(":")).sort().join(";")+";"}getAsString(s){if(this.isEmpty)return;if(this._styles[s]&&!st(this._styles[s]))return this._styles[s];const n=this._styleProcessor.getReducedForm(s,this._styles).find(([r])=>r===s);if(Array.isArray(n))return n[1]}getStyleNames(s=!1){return this.isEmpty?[]:s?(this._cachedExpandedStyleNames=this._cachedExpandedStyleNames||this._styleProcessor.getStyleNames(this._styles),this._cachedExpandedStyleNames):(this._cachedStyleNames=this._cachedStyleNames||this.getStylesEntries().map(([t])=>t),this._cachedStyleNames)}keys(){return this.getStyleNames()}clear(){this._styles={},this._cachedStyleNames=null,this._cachedExpandedStyleNames=null}isSimilar(s){if(this.size!==s.size)return!1;for(const t of this.getStyleNames())if(!s.has(t)||s.getAsString(t)!==this.getAsString(t))return!1;return!0}getStylesEntries(){const s=[],t=Object.keys(this._styles);for(const n of t)s.push(...this._styleProcessor.getReducedForm(n,this._styles));return s}_clone(){const s=new this.constructor(this._styleProcessor);return s.set(this.getNormalized()),s}_getTokensMatch(s,t){const n=[];for(const r of this.getStyleNames(!0))if(te(s,r)){if(t===!0){n.push(r);continue}const i=this.getAsString(r);te(t,i)&&n.push(r)}return n.length?n:void 0}_getConsumables(s){const t=[];if(s){t.push(s);for(const n of this._styleProcessor.getRelatedStyles(s))t.push(n)}else for(const n of this.getStyleNames()){for(const r of this._styleProcessor.getRelatedStyles(n))t.push(r);t.push(n)}return t}_canMergeFrom(s){for(const t of s.getStyleNames())if(this.has(t)&&this.getAsString(t)!==s.getAsString(t))return!1;return!0}_mergeFrom(s){for(const t of s.getStyleNames())this.has(t)||this.set(t,s.getAsString(t))}_isMatching(s){for(const t of s.getStyleNames())if(!this.has(t)||this.getAsString(t)!==s.getAsString(t))return!1;return!0}_cleanEmptyObjectsOnPath(s){const t=s.split(".");if(!(t.length>1))return;const r=t.splice(0,t.length-1).join("."),i=Hi(this._styles,r);if(!i)return;!Object.keys(i).length&&this.remove(r)}}function Ll(e){let s=null,t=0,n=0,r=null;const i=new Map;if(e==="")return i;e.charAt(e.length-1)!=";"&&(e=e+";");for(let o=0;o<e.length;o++){const a=e.charAt(o);if(s===null)switch(a){case":":r||(r=e.substr(t,o-t),n=o+1);break;case'"':case"'":s=a;break;case";":{const l=e.substr(n,o-n);r&&i.set(r.trim(),l.trim()),r=null,t=o+1;break}}else a===s&&(s=null)}return i}function Dl(e){return e.replace("-",".")}class pe{constructor(){h(this,"_set",new Set)}get isEmpty(){return this._set.size==0}get size(){return this._set.size}has(s){return this._set.has(s)}keys(){return Array.from(this._set.keys())}setTo(s){this.clear();for(const t of s.split(/\s+/))t&&this._set.add(t);return this}set(s){for(const t of Qt(s))t&&this._set.add(t)}remove(s){for(const t of Qt(s))this._set.delete(t)}clear(){this._set.clear()}toString(){return Array.from(this._set).join(" ")}isSimilar(s){if(this.size!==s.size)return!1;for(const t of this.keys())if(!s.has(t))return!1;return!0}_clone(){const s=new this.constructor;return s._set=new Set(this._set),s}_getTokensMatch(s){const t=[];if(s===!0){for(const n of this._set.keys())t.push(n);return t}if(typeof s=="string"){for(const n of s.split(/\s+/))if(this._set.has(n))t.push(n);else return;return t}for(const n of this._set.keys())n.match(s)&&t.push(n);return t.length?t:void 0}_getConsumables(s){return s?[s]:this.keys()}_canMergeFrom(){return!0}_mergeFrom(s){for(const t of s._set.keys())this._set.has(t)||this._set.add(t)}_isMatching(s){for(const t of s._set.keys())if(!this._set.has(t))return!1;return!0}}let At=class Ss extends gt{constructor(t,n,r,i){super(t);h(this,"name");h(this,"_unsafeAttributesToRender",[]);h(this,"_attrs");h(this,"_children");h(this,"_customProperties",new Map);this.name=n,this._attrs=this._parseAttributes(r),this._children=[],i&&this._insertChild(0,i)}get _classes(){return this._attrs.get("class")}get _styles(){return this._attrs.get("style")}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes&&(yield"class"),this._styles&&(yield"style");for(const t of this._attrs.keys())t!="class"&&t!="style"&&(yield t)}*getAttributes(){for(const[t,n]of this._attrs.entries())yield[t,String(n)]}getAttribute(t){return this._attrs.has(t)?String(this._attrs.get(t)):void 0}hasAttribute(t,n){return this._attrs.has(t)?n!==void 0?pt(this.name,t)||Et(this.name,t)?this._attrs.get(t).has(n):this._attrs.get(t)===n:!0:!1}isSimilar(t){if(!(t instanceof Ss))return!1;if(this===t)return!0;if(this.name!=t.name||this._attrs.size!==t._attrs.size)return!1;for(const[n,r]of this._attrs){const i=t._attrs.get(n);if(i===void 0)return!1;if(typeof r=="string"||typeof i=="string"){if(i!==r)return!1}else if(!r.isSimilar(i))return!1}return!0}hasClass(...t){for(const n of t)if(!this._classes||!this._classes.has(n))return!1;return!0}getClassNames(){const t=this._classes?this._classes.keys():[],n=t[Symbol.iterator]();return Object.assign(t,{next:n.next.bind(n)})}getStyle(t){return this._styles&&this._styles.getAsString(t)}getNormalizedStyle(t){return this._styles&&this._styles.getNormalized(t)}getStyleNames(t){return this._styles?this._styles.getStyleNames(t):[]}hasStyle(...t){for(const n of t)if(!this._styles||!this._styles.has(n))return!1;return!0}findAncestor(...t){const n=new Nl(...t);let r=this.parent;for(;r&&!r.is("documentFragment");){if(n.match(r))return r;r=r.parent}return null}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const t=this._classes?this._classes.keys().sort().join(","):"",n=this._styles&&String(this._styles),r=Array.from(this._attrs).filter(([i])=>i!="style"&&i!="class").map(i=>`${i[0]}="${i[1]}"`).sort().join(" ");return this.name+(t==""?"":` class="${t}"`)+(n?` style="${n}"`:"")+(r==""?"":` ${r}`)}shouldRenderUnsafeAttribute(t){return this._unsafeAttributesToRender.includes(t)}_clone(t=!1){const n=[];if(t)for(const i of this.getChildren())n.push(i._clone(t));const r=new this.constructor(this.document,this.name,this._attrs,n);return r._customProperties=new Map(this._customProperties),r.getFillerOffset=this.getFillerOffset,r._unsafeAttributesToRender=this._unsafeAttributesToRender,r}_appendChild(t){return this._insertChild(this.childCount,t)}_insertChild(t,n){this._fireChange("children",this,{index:t});let r=0;const i=Vl(this.document,n);for(const o of i)o.parent!==null&&o._remove(),o.parent=this,o.document=this.document,this._children.splice(t,0,o),t++,r++;return r}_removeChildren(t,n=1){this._fireChange("children",this,{index:t});for(let r=t;r<t+n;r++)this._children[r].parent=null;return this._children.splice(t,n)}_setAttribute(t,n,r=!0){if(this._fireChange("attributes",this),pt(this.name,t)||Et(this.name,t)){let i=this._attrs.get(t);i||(i=pt(this.name,t)?new ge(this.document.stylesProcessor):new pe,this._attrs.set(t,i)),r?i.setTo(String(n)):pt(this.name,t)?Array.isArray(n)?i.set(n[0],n[1]):i.set(n):i.set(typeof n=="string"?n.split(/\s+/):n)}else this._attrs.set(t,String(n))}_removeAttribute(t,n){if(this._fireChange("attributes",this),n!==void 0&&(pt(this.name,t)||Et(this.name,t))){const r=this._attrs.get(t);return r?(Et(this.name,t)&&typeof n=="string"&&(n=n.split(/\s+/)),r.remove(n),r.isEmpty?this._attrs.delete(t):!1):!1}return this._attrs.delete(t)}_addClass(t){this._setAttribute("class",t,!1)}_removeClass(t){this._removeAttribute("class",t)}_setStyle(t,n){typeof t!="string"?this._setAttribute("style",t,!1):this._setAttribute("style",[t,n],!1)}_removeStyle(t){this._removeAttribute("style",t)}_collectAttributesMatch(t,n,r){for(const[i,o,a]of t){let l=!1,c=!1;for(const[u,f]of this._attrs)if(!(r&&r.includes(u)||!te(i,u)))if(l=!0,typeof f=="string"){if(te(o,f))n.push([u]),c=!0;else if(!(i instanceof RegExp))return!1}else{const d=f._getTokensMatch(o,a||!0);if(d){c=!0;for(const m of d)n.push([u,m])}else if(!(i instanceof RegExp))return!1}if(!l||!c)return!1}return!0}_getConsumables(t,n){const r=[];if(t){const i=this._attrs.get(t);if(i!==void 0)if(typeof i=="string")r.push([t]);else for(const o of i._getConsumables(n))r.push([t,o])}else for(const[i,o]of this._attrs)if(typeof o=="string")r.push([i]);else for(const a of o._getConsumables())r.push([i,a]);return{name:!t,attributes:r}}_canMergeAttributesFrom(t){if(this.name!=t.name)return!1;for(const[n,r]of t._attrs){const i=this._attrs.get(n);if(i!==void 0){if(typeof i=="string"||typeof r=="string"){if(i!==r)return!1}else if(!i._canMergeFrom(r))return!1}}return!0}_mergeAttributesFrom(t){this._fireChange("attributes",this);for(const[n,r]of t._attrs){const i=this._attrs.get(n);i===void 0||typeof i=="string"||typeof r=="string"?this._setAttribute(n,r):i._mergeFrom(r)}}_canSubtractAttributesOf(t){if(this.name!=t.name)return!1;for(const[n,r]of t._attrs){const i=this._attrs.get(n);if(i===void 0)return!1;if(typeof i=="string"||typeof r=="string"){if(i!==r)return!1}else if(!i._isMatching(r))return!1}return!0}_subtractAttributesOf(t){this._fireChange("attributes",this);for(const[n,r]of t._attrs){const i=this._attrs.get(n);typeof i=="string"||typeof r=="string"?this._attrs.delete(n):(i.remove(r.keys()),i.isEmpty&&this._attrs.delete(n))}}_setCustomProperty(t,n){this._customProperties.set(t,n)}_removeCustomProperty(t){return this._customProperties.delete(t)}_parseAttributes(t){const n=Vt(t);for(const[r,i]of n)if(i===null)n.delete(r);else if(pt(this.name,r)){const o=i instanceof ge?i._clone():new ge(this.document.stylesProcessor).setTo(String(i));n.set(r,o)}else if(Et(this.name,r)){const o=i instanceof pe?i._clone():new pe().setTo(String(i));n.set(r,o)}else typeof i!="string"&&n.set(r,String(i));return n}};At.prototype.is=function(e,s){return s?s===this.name&&(e==="element"||e==="view:element"):e==="element"||e==="view:element"||e==="node"||e==="view:node"};function Vl(e,s){if(typeof s=="string")return[new lt(e,s)];X(s)||(s=[s]);const t=[];for(const n of s)typeof n=="string"?t.push(new lt(e,n)):n instanceof W?t.push(new lt(e,n.data)):t.push(n);return t}function Et(e,s){return s=="class"||e=="a"&&s=="rel"}function pt(e,s){return s=="style"}class Ts extends At{constructor(s,t,n,r){super(s,t,n,r),this.getFillerOffset=ql}}Ts.prototype.is=function(e,s){return s?s===this.name&&(e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};function ql(){const e=[...this.getChildren()],s=e[this.childCount-1];if(s&&s.is("element","br"))return this.childCount;for(const t of e)if(!t.is("uiElement"))return null;return this.childCount}class Je extends qe(Ts){constructor(s,t,n,r){super(s,t,n,r),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(s),this.bind("isFocused").to(s,"isFocused",i=>i&&s.selection.editableElement==this),this.listenTo(s.selection,"change",()=>{this.isFocused=s.isFocused&&s.selection.editableElement==this})}destroy(){this.stopListening()}}Je.prototype.is=function(e,s){return s?s===this.name&&(e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};const kn=Symbol("rootName");class jl extends Je{constructor(s,t){super(s,t),this.rootName="main"}get rootName(){return this.getCustomProperty(kn)}set rootName(s){this._setCustomProperty(kn,s)}set _name(s){this.name=s}}jl.prototype.is=function(e,s){return s?s===this.name&&(e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};let yt=class{constructor(s={}){h(this,"direction");h(this,"boundaries");h(this,"singleCharacters");h(this,"shallow");h(this,"ignoreElementEnd");h(this,"_position");h(this,"_boundaryStartParent");h(this,"_boundaryEndParent");if(!s.boundaries&&!s.startPosition)throw new g("view-tree-walker-no-start-position",null);if(s.direction&&s.direction!="forward"&&s.direction!="backward")throw new g("view-tree-walker-unknown-direction",s.startPosition,{direction:s.direction});this.boundaries=s.boundaries||null,s.startPosition?this._position=v._createAt(s.startPosition):this._position=v._createAt(s.boundaries[s.direction=="backward"?"end":"start"]),this.direction=s.direction||"forward",this.singleCharacters=!!s.singleCharacters,this.shallow=!!s.shallow,this.ignoreElementEnd=!!s.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(s){let t,n;do n=this.position,t=this.next();while(!t.done&&s(t.value));t.done||(this._position=n)}jumpTo(s){this._boundaryStartParent&&s.isBefore(this.boundaries.start)?s=this.boundaries.start:this._boundaryEndParent&&s.isAfter(this.boundaries.end)&&(s=this.boundaries.end),this._position=s.clone()}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let s=this.position.clone();const t=this.position,n=s.parent;if(n.parent===null&&s.offset===n.childCount)return{done:!0,value:void 0};if(n===this._boundaryEndParent&&s.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let r;if(n&&n.is("view:$text")){if(s.isAtEnd)return this._position=v._createAfter(n),this._next();r=n.data[s.offset]}else r=n.getChild(s.offset);if(typeof r=="string"){let i;this.singleCharacters?i=1:i=(n===this._boundaryEndParent?this.boundaries.end.offset:n.data.length)-s.offset;const o=new W(n,s.offset,i);return s.offset+=i,this._position=s,this._formatReturnValue("text",o,t,s,i)}if(r&&r.is("view:element")){if(!this.shallow)s=new v(r,0);else{if(this.boundaries&&this.boundaries.end.isBefore(s))return{done:!0,value:void 0};s.offset++}return this._position=s,this._formatReturnValue("elementStart",r,t,s,1)}if(r&&r.is("view:$text")){if(this.singleCharacters)return s=new v(r,0),this._position=s,this._next();let i=r.data.length,o;return r==this._boundaryEndParent?(i=this.boundaries.end.offset,o=new W(r,0,i),s=v._createAfter(o)):(o=new W(r,0,r.data.length),s.offset++),this._position=s,this._formatReturnValue("text",o,t,s,i)}return s=v._createAfter(n),this._position=s,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",n,t,s)}_previous(){let s=this.position.clone();const t=this.position,n=s.parent;if(n.parent===null&&s.offset===0)return{done:!0,value:void 0};if(n==this._boundaryStartParent&&s.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let r;if(n.is("view:$text")){if(s.isAtStart)return this._position=v._createBefore(n),this._previous();r=n.data[s.offset-1]}else r=n.getChild(s.offset-1);if(typeof r=="string"){let i;if(this.singleCharacters)i=1;else{const a=n===this._boundaryStartParent?this.boundaries.start.offset:0;i=s.offset-a}s.offset-=i;const o=new W(n,s.offset,i);return this._position=s,this._formatReturnValue("text",o,t,s,i)}if(r&&r.is("view:element"))return this.shallow?(s.offset--,this._position=s,this._formatReturnValue("elementStart",r,t,s,1)):(s=new v(r,r.childCount),this._position=s,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",r,t,s));if(r&&r.is("view:$text")){if(this.singleCharacters)return s=new v(r,r.data.length),this._position=s,this._previous();let i=r.data.length,o;if(r==this._boundaryStartParent){const a=this.boundaries.start.offset;o=new W(r,a,r.data.length-a),i=o.data.length,s=v._createBefore(o)}else o=new W(r,0,r.data.length),s.offset--;return this._position=s,this._formatReturnValue("text",o,t,s,i)}return s=v._createBefore(n),this._position=s,this._formatReturnValue("elementStart",n,t,s,1)}_formatReturnValue(s,t,n,r,i){return t.is("view:$textProxy")&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(r=v._createAfter(t.textNode),this._position=r):n=v._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(r=v._createBefore(t.textNode),this._position=r):n=v._createBefore(t.textNode))),{done:!1,value:{type:s,item:t,previousPosition:n,nextPosition:r,length:i}}}},v=class U extends dt{constructor(t,n){super();h(this,"parent");h(this,"offset");this.parent=t,this.offset=n}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const t=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===t}get root(){return this.parent.root}get editableElement(){let t=this.parent;for(;!(t instanceof Je);)if(t.parent)t=t.parent;else return null;return t}getShiftedBy(t){const n=U._createAt(this),r=n.offset+t;return n.offset=r<0?0:r,n}getLastMatchingPosition(t,n={}){n.startPosition=this;const r=new yt(n);return r.skip(t),r.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(t){const n=this.getAncestors(),r=t.getAncestors();let i=0;for(;n[i]==r[i]&&n[i];)i++;return i===0?null:n[i-1]}isEqual(t){return this.parent==t.parent&&this.offset==t.offset}isBefore(t){return this.compareWith(t)=="before"}isAfter(t){return this.compareWith(t)=="after"}compareWith(t){if(this.root!==t.root)return"different";if(this.isEqual(t))return"same";const n=this.parent.is("node")?this.parent.getPath():[],r=t.parent.is("node")?t.parent.getPath():[];n.push(this.offset),r.push(t.offset);const i=B(n,r);switch(i){case"prefix":return"before";case"extension":return"after";default:return n[i]<r[i]?"before":"after"}}getWalker(t={}){return t.startPosition=this,new yt(t)}clone(){return new U(this.parent,this.offset)}static _createAt(t,n){if(t instanceof U)return new this(t.parent,t.offset);{const r=t;if(n=="end")n=r.is("$text")?r.data.length:r.childCount;else{if(n=="before")return this._createBefore(r);if(n=="after")return this._createAfter(r);if(n!==0&&!n)throw new g("view-createpositionat-offset-required",r)}return new U(r,n)}}static _createAfter(t){if(t.is("$textProxy"))return new U(t.textNode,t.offsetInText+t.data.length);if(!t.parent)throw new g("view-position-after-root",t,{root:t});return new U(t.parent,t.index+1)}static _createBefore(t){if(t.is("$textProxy"))return new U(t.textNode,t.offsetInText);if(!t.parent)throw new g("view-position-before-root",t,{root:t});return new U(t.parent,t.index)}};v.prototype.is=function(e){return e==="position"||e==="view:position"};let q=class Z extends dt{constructor(t,n=null){super();h(this,"start");h(this,"end");this.start=t.clone(),this.end=n?n.clone():t.clone()}*[Symbol.iterator](){yield*new yt({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let t=this.start.getLastMatchingPosition(Kt,{direction:"backward"}),n=this.end.getLastMatchingPosition(Kt);return t.parent.is("$text")&&t.isAtStart&&(t=v._createBefore(t.parent)),n.parent.is("$text")&&n.isAtEnd&&(n=v._createAfter(n.parent)),new Z(t,n)}getTrimmed(){let t=this.start.getLastMatchingPosition(Kt);if(t.isAfter(this.end)||t.isEqual(this.end))return new Z(t,t);let n=this.end.getLastMatchingPosition(Kt,{direction:"backward"});const r=t.nodeAfter,i=n.nodeBefore;return r&&r.is("$text")&&(t=new v(r,0)),i&&i.is("$text")&&(n=new v(i,i.data.length)),new Z(t,n)}isEqual(t){return this==t||this.start.isEqual(t.start)&&this.end.isEqual(t.end)}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,n=!1){t.isCollapsed&&(n=!1);const r=this.containsPosition(t.start)||n&&this.start.isEqual(t.start),i=this.containsPosition(t.end)||n&&this.end.isEqual(t.end);return r&&i}getDifference(t){const n=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&n.push(new Z(this.start,t.start)),this.containsPosition(t.end)&&n.push(new Z(t.end,this.end))):n.push(this.clone()),n}getIntersection(t){if(this.isIntersecting(t)){let n=this.start,r=this.end;return this.containsPosition(t.start)&&(n=t.start),this.containsPosition(t.end)&&(r=t.end),new Z(n,r)}return null}getWalker(t={}){return t.boundaries=this,new yt(t)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let t=this.start.nodeAfter,n=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(t=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(n=this.end.parent.previousSibling),t&&t.is("element")&&t===n?t:null}clone(){return new Z(this.start,this.end)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const n=new yt(t);for(const r of n)yield r.item}*getPositions(t={}){t.boundaries=this;const n=new yt(t);yield n.position;for(const r of n)yield r.nextPosition}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}static _createFromParentsAndOffsets(t,n,r,i){return new this(new v(t,n),new v(r,i))}static _createFromPositionAndShift(t,n){const r=t,i=t.getShiftedBy(n);return n>0?new this(r,i):new this(i,r)}static _createIn(t){return this._createFromParentsAndOffsets(t,0,t,t.childCount)}static _createOn(t){const n=t.is("$textProxy")?t.offsetSize:1;return this._createFromPositionAndShift(v._createBefore(t),n)}};q.prototype.is=function(e){return e==="range"||e==="view:range"};function Kt(e){return!!(e.item.is("attributeElement")||e.item.is("uiElement"))}let Es=class xs extends O(dt){constructor(...t){super();h(this,"_ranges");h(this,"_lastRangeBackward");h(this,"_isFake");h(this,"_fakeSelectionLabel");this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",t.length&&this.setTo(...t)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.end:t.start).clone()}get focus(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.start:t.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const t of this._ranges)yield t.clone()}getFirstRange(){let t=null;for(const n of this._ranges)(!t||n.start.isBefore(t.start))&&(t=n);return t?t.clone():null}getLastRange(){let t=null;for(const n of this._ranges)(!t||n.end.isAfter(t.end))&&(t=n);return t?t.clone():null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}isEqual(t){if(this.isFake!=t.isFake||this.isFake&&this.fakeSelectionLabel!=t.fakeSelectionLabel||this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const n of this._ranges){let r=!1;for(const i of t._ranges)if(n.isEqual(i)){r=!0;break}if(!r)return!1}return!0}isSimilar(t){if(this.isBackward!=t.isBackward)return!1;const n=xn(this.getRanges()),r=xn(t.getRanges());if(n!=r)return!1;if(n==0)return!0;for(let i of this.getRanges()){i=i.getTrimmed();let o=!1;for(let a of t.getRanges())if(a=a.getTrimmed(),i.start.isEqual(a.start)&&i.end.isEqual(a.end)){o=!0;break}if(!o)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(...t){let[n,r,i]=t;if(typeof r=="object"&&(i=r,r=void 0),n===null)this._setRanges([]),this._setFakeOptions(i);else if(n instanceof xs||n instanceof Os)this._setRanges(n.getRanges(),n.isBackward),this._setFakeOptions({fake:n.isFake,label:n.fakeSelectionLabel});else if(n instanceof q)this._setRanges([n],i&&i.backward),this._setFakeOptions(i);else if(n instanceof v)this._setRanges([new q(n)]),this._setFakeOptions(i);else if(n instanceof gt){const o=!!i&&!!i.backward;let a;if(r===void 0)throw new g("view-selection-setto-required-second-parameter",this);r=="in"?a=q._createIn(n):r=="on"?a=q._createOn(n):a=new q(v._createAt(n,r)),this._setRanges([a],o),this._setFakeOptions(i)}else if(X(n))this._setRanges(n,i&&i.backward),this._setFakeOptions(i);else throw new g("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(t,n){if(this.anchor===null)throw new g("view-selection-setfocus-no-ranges",this);const r=v._createAt(t,n);if(r.compareWith(this.focus)=="same")return;const i=this.anchor;this._ranges.pop(),r.compareWith(i)=="before"?this._addRange(new q(r,i),!0):this._addRange(new q(i,r)),this.fire("change")}_setRanges(t,n=!1){t=Array.from(t),this._ranges=[];for(const r of t)this._addRange(r);this._lastRangeBackward=!!n}_setFakeOptions(t={}){this._isFake=!!t.fake,this._fakeSelectionLabel=t.fake&&t.label||""}_addRange(t,n=!1){if(!(t instanceof q))throw new g("view-selection-add-range-not-range",this);this._pushRange(t),this._lastRangeBackward=!!n}_pushRange(t){for(const n of this._ranges)if(t.isIntersecting(n))throw new g("view-selection-range-intersects",this,{addedRange:t,intersectingRange:n});this._ranges.push(new q(t.start,t.end))}};Es.prototype.is=function(e){return e==="selection"||e==="view:selection"};let Os=class extends O(dt){constructor(...t){super();h(this,"_selection");this._selection=new Es,this._selection.delegate("change").to(this),t.length&&this._selection.setTo(...t)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(t){return this._selection.isEqual(t)}isSimilar(t){return this._selection.isSimilar(t)}_setTo(...t){this._selection.setTo(...t)}_setFocus(t,n){this._selection.setFocus(t,n)}};Os.prototype.is=function(e){return e==="selection"||e=="documentSelection"||e=="view:selection"||e=="view:documentSelection"};class Jl extends vt{constructor(t,n,r){super(t,n);h(this,"startRange");h(this,"_eventPhase");h(this,"_currentTarget");this.startRange=r,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}const me=Symbol("bubbling contexts");function Cn(e){class s extends e{fire(n,...r){try{const i=n instanceof vt?n:new vt(this,n),o=_e(this);if(!o.size)return;if(xt(i,"capturing",this),mt(o,"$capture",i,...r))return i.return;const a=i.startRange||this.selection.getFirstRange(),l=a?a.getContainedElement():null,c=l?!!Rs(o,l):!1;let u=l||zl(a);if(xt(i,"atTarget",u),!c){if(mt(o,"$text",i,...r))return i.return;xt(i,"bubbling",u)}for(;u;){if(u.is("rootElement")){if(mt(o,"$root",i,...r))return i.return}else if(u.is("element")&&mt(o,u.name,i,...r))return i.return;if(mt(o,u,i,...r))return i.return;u=u.parent,xt(i,"bubbling",u)}return xt(i,"bubbling",this),mt(o,"$document",i,...r),i.return}catch(i){/* istanbul ignore next -- @preserve */g.rethrowUnexpectedError(i,this)}}_addEventListener(n,r,i){const o=Qt(i.context||"$document"),a=_e(this);for(const l of o){let c=a.get(l);c||(c=new(O()),a.set(l,c)),this.listenTo(c,n,r,i)}}_removeEventListener(n,r){const i=_e(this);for(const o of i.values())this.stopListening(o,n,r)}}return s}{const e=Cn(Object);["fire","_addEventListener","_removeEventListener"].forEach(s=>{Cn[s]=e.prototype[s]})}function xt(e,s,t){e instanceof Jl&&(e._eventPhase=s,e._currentTarget=t)}function mt(e,s,t,...n){const r=typeof s=="string"?e.get(s):Rs(e,s);return r?(r.fire(t,...n),t.stop.called):!1}function Rs(e,s){for(const[t,n]of e)if(typeof t=="function"&&t(s))return n;return null}function _e(e){return e[me]||(e[me]=new Map),e[me]}function zl(e){if(!e)return null;const s=e.start.parent,t=e.end.parent,n=s.getPath(),r=t.getPath();return n.length>r.length?s:t}const Nn=10;class Ms extends At{constructor(t,n,r,i){super(t,n,r,i);h(this,"_priority",Nn);h(this,"_id",null);h(this,"_clonesGroup",null);this.getFillerOffset=Ul}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new g("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(t){return this.id!==null||t.id!==null?this.id===t.id:super.isSimilar(t)&&this.priority==t.priority}_clone(t=!1){const n=super._clone(t);return n._priority=this._priority,n._id=this._id,n}_canMergeAttributesFrom(t){return this.id!==null||t.id!==null||this.priority!==t.priority?!1:super._canMergeAttributesFrom(t)}_canSubtractAttributesOf(t){return this.id!==null||t.id!==null||this.priority!==t.priority?!1:super._canSubtractAttributesOf(t)}}h(Ms,"DEFAULT_PRIORITY",Nn);Ms.prototype.is=function(e,s){return s?s===this.name&&(e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"):e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};function Ul(){if(ye(this))return null;let e=this.parent;for(;e&&e.is("attributeElement");){if(ye(e)>1)return null;e=e.parent}return!e||ye(e)>1?null:this.childCount}function ye(e){return Array.from(e.getChildren()).filter(s=>!s.is("uiElement")).length}class Wl extends At{constructor(s,t,n,r){super(s,t,n,r),this.getFillerOffset=Gl}_insertChild(s,t){if(t&&(t instanceof gt||Array.from(t).length>0))throw new g("view-emptyelement-cannot-add",[this,t]);return 0}}Wl.prototype.is=function(e,s){return s?s===this.name&&(e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"):e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};function Gl(){return null}class Kl extends At{constructor(s,t,n,r){super(s,t,n,r),this.getFillerOffset=Hl}_insertChild(s,t){if(t&&(t instanceof gt||Array.from(t).length>0))throw new g("view-uielement-cannot-add",[this,t]);return 0}render(s,t){return this.toDomElement(s)}toDomElement(s){const t=s.createElement(this.name);for(const n of this.getAttributeKeys())t.setAttribute(n,this.getAttribute(n));return t}}Kl.prototype.is=function(e,s){return s?s===this.name&&(e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"):e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"};function Hl(){return null}class Yl extends At{constructor(s,t,n,r){super(s,t,n,r),this.getFillerOffset=Xl}_insertChild(s,t){if(t&&(t instanceof gt||Array.from(t).length>0))throw new g("view-rawelement-cannot-add",[this,t]);return 0}render(s,t){}}Yl.prototype.is=function(e,s){return s?s===this.name&&(e==="rawElement"||e==="view:rawElement"||e==="element"||e==="view:element"):e==="rawElement"||e==="view:rawElement"||e===this.name||e==="view:"+this.name||e==="element"||e==="view:element"||e==="node"||e==="view:node"};function Xl(){return null}let Zl=class extends O(dt){constructor(t,n){super();h(this,"document");h(this,"_children",[]);h(this,"_customProperties",new Map);this.document=t,n&&this._insertChild(0,n)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(t){return this._insertChild(this.childCount,t)}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(t,n){this._fireChange("children",this,{index:t});let r=0;const i=Ql(this.document,n);for(const o of i)o.parent!==null&&o._remove(),o.parent=this,this._children.splice(t,0,o),t++,r++;return r}_removeChildren(t,n=1){this._fireChange("children",this,{index:t});for(let r=t;r<t+n;r++)this._children[r].parent=null;return this._children.splice(t,n)}_fireChange(t,n,r){this.fire(`change:${t}`,n,r)}_setCustomProperty(t,n){this._customProperties.set(t,n)}_removeCustomProperty(t){return this._customProperties.delete(t)}};Zl.prototype.is=function(e){return e==="documentFragment"||e==="view:documentFragment"};function Ql(e,s){return typeof s=="string"?[new lt(e,s)]:(X(s)||(s=[s]),Array.from(s).map(t=>typeof t=="string"?new lt(e,t):t instanceof W?new lt(e,t.data):t))}const tc=e=>e.createTextNode(""),ec=e=>{const s=e.createElement("span");return s.dataset.ckeFiller="true",s.innerText="",s},nc=e=>{const s=e.createElement("br");return s.dataset.ckeFiller="true",s};nc(Lt.document);tc(Lt.document);ec(Lt.document);/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class rt{is(){throw new Error("is() method is abstract")}}class ut extends rt{constructor(t,n,r){super();h(this,"textNode");h(this,"data");h(this,"offsetInText");if(this.textNode=t,n<0||n>t.offsetSize)throw new g("model-textproxy-wrong-offsetintext",this);if(r<0||n+r>t.offsetSize)throw new g("model-textproxy-wrong-length",this);this.data=t.data.substring(n,n+r),this.offsetInText=n}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const t=this.textNode.getPath();return t.length>0&&(t[t.length-1]+=this.offsetInText),t}getAncestors(t={}){const n=[];let r=t.includeSelf?this:this.parent;for(;r;)n[t.parentFirst?"push":"unshift"](r),r=r.parent;return n}hasAttribute(t){return this.textNode.hasAttribute(t)}getAttribute(t){return this.textNode.getAttribute(t)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}ut.prototype.is=function(e){return e==="$textProxy"||e==="model:$textProxy"||e==="textProxy"||e==="model:textProxy"};class Rt{constructor(s){h(this,"direction");h(this,"boundaries");h(this,"singleCharacters");h(this,"shallow");h(this,"ignoreElementEnd");h(this,"_position");h(this,"_boundaryStartParent");h(this,"_boundaryEndParent");h(this,"_visitedParent");if(!s||!s.boundaries&&!s.startPosition)throw new g("model-tree-walker-no-start-position",null);const t=s.direction||"forward";if(t!="forward"&&t!="backward")throw new g("model-tree-walker-unknown-direction",s,{direction:t});this.direction=t,this.boundaries=s.boundaries||null,s.startPosition?this._position=s.startPosition.clone():this._position=_._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!s.singleCharacters,this.shallow=!!s.shallow,this.ignoreElementEnd=!!s.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(s){let t,n,r,i;do r=this.position,i=this._visitedParent,{done:t,value:n}=this.next();while(!t&&s(n));t||(this._position=r,this._visitedParent=i)}jumpTo(s){this._boundaryStartParent&&s.isBefore(this.boundaries.start)?s=this.boundaries.start:this._boundaryEndParent&&s.isAfter(this.boundaries.end)&&(s=this.boundaries.end),this._position=s.clone(),this._visitedParent=s.parent}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const s=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===n.maxOffset)return{done:!0,value:void 0};if(n===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const r=Bt(t,n),i=r||ks(t,n,r);if(i&&i.is("model:element")){if(!this.shallow)t.path.push(0),this._visitedParent=i;else{if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}return this._position=t,at("elementStart",i,s,t,1)}if(i&&i.is("model:$text")){let o;if(this.singleCharacters)o=1;else{let c=i.endOffset;this._boundaryEndParent==n&&this.boundaries.end.offset<c&&(c=this.boundaries.end.offset),o=c-t.offset}const a=t.offset-i.startOffset,l=new ut(i,a,o);return t.offset+=o,this._position=t,at("text",l,s,t,o)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=n.parent,this.ignoreElementEnd?this._next():at("elementEnd",n,s,t)}_previous(){const s=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===0)return{done:!0,value:void 0};if(n==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const r=t.parent,i=Bt(t,r),o=i||Cs(t,r,i);if(o&&o.is("model:element"))return t.offset--,this.shallow?(this._position=t,at("elementStart",o,s,t,1)):(t.path.push(o.maxOffset),this._position=t,this._visitedParent=o,this.ignoreElementEnd?this._previous():at("elementEnd",o,s,t));if(o&&o.is("model:$text")){let a;if(this.singleCharacters)a=1;else{let u=o.startOffset;this._boundaryStartParent==n&&this.boundaries.start.offset>u&&(u=this.boundaries.start.offset),a=t.offset-u}const l=t.offset-o.startOffset,c=new ut(o,l-a,a);return t.offset-=a,this._position=t,at("text",c,s,t,a)}return t.path.pop(),this._position=t,this._visitedParent=n.parent,at("elementStart",n,s,t,1)}}function at(e,s,t,n,r){return{done:!1,value:{type:e,item:s,previousPosition:t,nextPosition:n,length:r}}}class _ extends rt{constructor(t,n,r="toNone"){super();h(this,"root");h(this,"path");h(this,"stickiness");if(!t.is("element")&&!t.is("documentFragment"))throw new g("model-position-root-invalid",t);if(!Array.isArray(n)||n.length===0)throw new g("model-position-path-incorrect-format",t,{path:n});t.is("rootElement")?n=n.slice():(n=[...t.getPath(),...n],t=t.root),this.root=t,this.path=n,this.stickiness=r}get offset(){return this.path[this.path.length-1]}set offset(t){this.path[this.path.length-1]=t}get parent(){let t=this.root;for(let n=0;n<this.path.length-1;n++)if(t=t.getChildAtOffset(this.path[n]),!t)throw new g("model-position-path-incorrect",this,{position:this});if(t.is("$text"))throw new g("model-position-path-incorrect",this,{position:this});return t}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return Bt(this,this.parent)}get nodeAfter(){const t=this.parent;return ks(this,t,Bt(this,t))}get nodeBefore(){const t=this.parent;return Cs(this,t,Bt(this,t))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}isValid(){if(this.offset<0)return!1;let t=this.root;for(let n=0;n<this.path.length-1;n++)if(t=t.getChildAtOffset(this.path[n]),!t)return!1;return this.offset<=t.maxOffset}compareWith(t){if(this.root!=t.root)return"different";const n=B(this.path,t.path);switch(n){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[n]<t.path[n]?"before":"after"}}getLastMatchingPosition(t,n={}){n.startPosition=this;const r=new Rt(n);return r.skip(t),r.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const t=this.parent;return t.is("documentFragment")?[t]:t.getAncestors({includeSelf:!0})}findAncestor(t){const n=this.parent;return n.is("element")?n.findAncestor(t,{includeSelf:!0}):null}getCommonPath(t){if(this.root!=t.root)return[];const n=B(this.path,t.path),r=typeof n=="string"?Math.min(this.path.length,t.path.length):n;return this.path.slice(0,r)}getCommonAncestor(t){const n=this.getAncestors(),r=t.getAncestors();let i=0;for(;n[i]==r[i]&&n[i];)i++;return i===0?null:n[i-1]}getShiftedBy(t){const n=this.clone(),r=n.offset+t;return n.offset=r<0?0:r,n}isAfter(t){return this.compareWith(t)=="after"}isBefore(t){return this.compareWith(t)=="before"}isEqual(t){return this.compareWith(t)=="same"}isTouching(t){if(this.root!==t.root)return!1;const n=Math.min(this.path.length,t.path.length);for(let r=0;r<n;r++){const i=this.path[r]-t.path[r];if(i<-1||i>1)return!1;if(i===1)return Bn(t,this,r);if(i===-1)return Bn(this,t,r)}return this.path.length===t.path.length?!0:this.path.length>t.path.length?Be(this.path,n):Be(t.path,n)}hasSameParentAs(t){if(this.root!==t.root)return!1;const n=this.getParentPath(),r=t.getParentPath();return B(n,r)=="same"}getTransformedByOperation(t){let n;switch(t.type){case"insert":n=this._getTransformedByInsertOperation(t);break;case"move":case"remove":case"reinsert":n=this._getTransformedByMoveOperation(t);break;case"split":n=this._getTransformedBySplitOperation(t);break;case"merge":n=this._getTransformedByMergeOperation(t);break;default:n=_._createAt(this);break}return n}_getTransformedByInsertOperation(t){return this._getTransformedByInsertion(t.position,t.howMany)}_getTransformedByMoveOperation(t){return this._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany)}_getTransformedBySplitOperation(t){const n=t.movedRange;return n.containsPosition(this)||n.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(t.splitPosition,t.moveTargetPosition):t.graveyardPosition?this._getTransformedByMove(t.graveyardPosition,t.insertionPosition,1):this._getTransformedByInsertion(t.insertionPosition,1)}_getTransformedByMergeOperation(t){const n=t.movedRange,r=n.containsPosition(this)||n.start.isEqual(this);let i;return r?(i=this._getCombined(t.sourcePosition,t.targetPosition),t.sourcePosition.isBefore(t.targetPosition)&&(i=i._getTransformedByDeletion(t.deletionPosition,1))):this.isEqual(t.deletionPosition)?i=_._createAt(t.deletionPosition):i=this._getTransformedByMove(t.deletionPosition,t.graveyardPosition,1),i}_getTransformedByDeletion(t,n){const r=_._createAt(this);if(this.root!=t.root)return r;if(B(t.getParentPath(),this.getParentPath())=="same"){if(t.offset<this.offset){if(t.offset+n>this.offset)return null;r.offset-=n}}else if(B(t.getParentPath(),this.getParentPath())=="prefix"){const i=t.path.length-1;if(t.offset<=this.path[i]){if(t.offset+n>this.path[i])return null;r.path[i]-=n}}return r}_getTransformedByInsertion(t,n){const r=_._createAt(this);if(this.root!=t.root)return r;if(B(t.getParentPath(),this.getParentPath())=="same")(t.offset<this.offset||t.offset==this.offset&&this.stickiness!="toPrevious")&&(r.offset+=n);else if(B(t.getParentPath(),this.getParentPath())=="prefix"){const i=t.path.length-1;t.offset<=this.path[i]&&(r.path[i]+=n)}return r}_getTransformedByMove(t,n,r){if(n=n._getTransformedByDeletion(t,r),t.isEqual(n))return _._createAt(this);const i=this._getTransformedByDeletion(t,r);return i===null||t.isEqual(this)&&this.stickiness=="toNext"||t.getShiftedBy(r).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(t,n):i._getTransformedByInsertion(n,r)}_getCombined(t,n){const r=t.path.length-1,i=_._createAt(n);return i.stickiness=this.stickiness,i.offset=i.offset+this.path[r]-t.offset,i.path=[...i.path,...this.path.slice(r+1)],i}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(t,n,r="toNone"){if(t.is("model:position"))return new _(t.root,t.path,t.stickiness);{const i=t;if(n=="end")n=i.maxOffset;else{if(n=="before")return this._createBefore(i,r);if(n=="after")return this._createAfter(i,r);if(n!==0&&!n)throw new g("model-createpositionat-offset-required",[this,t])}if(!i.is("element")&&!i.is("documentFragment"))throw new g("model-position-parent-incorrect",[this,t]);const o=i.getPath();return o.push(n),new this(i.root,o,r)}}static _createAfter(t,n){if(!t.parent)throw new g("model-position-after-root",[this,t],{root:t});return this._createAt(t.parent,t.endOffset,n)}static _createBefore(t,n){if(!t.parent)throw new g("model-position-before-root",t,{root:t});return this._createAt(t.parent,t.startOffset,n)}static fromJSON(t,n){if(t.root==="$graveyard"){const r=new _(n.graveyard,t.path);return r.stickiness=t.stickiness,r}if(!n.getRoot(t.root))throw new g("model-position-fromjson-no-root",n,{rootName:t.root});return new _(n.getRoot(t.root),t.path,t.stickiness)}}_.prototype.is=function(e){return e==="position"||e==="model:position"};function Bt(e,s){const t=s.getChildAtOffset(e.offset);return t&&t.is("$text")&&t.startOffset<e.offset?t:null}function ks(e,s,t){return t!==null?null:s.getChildAtOffset(e.offset)}function Cs(e,s,t){return t!==null?null:s.getChild(s.offsetToIndex(e.offset)-1)}function Bn(e,s,t){return!(t+1===e.path.length||!Be(s.path,t+1)||!sc(e,t+1))}function Be(e,s){for(;s<e.length;){if(e[s]!==0)return!1;s++}return!0}function sc(e,s){let t=e.parent,n=e.path.length-1,r=0;for(;n>=s;){if(e.path[n]+r!==t.maxOffset)return!1;r=1,n--,t=t.parent}return!0}class p extends rt{constructor(t,n){super();h(this,"start");h(this,"end");this.start=_._createAt(t),this.end=n?_._createAt(n):_._createAt(t),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new Rt({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const t=this.start.getParentPath(),n=this.end.getParentPath();return B(t,n)=="same"}get root(){return this.start.root}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,n=!1){t.isCollapsed&&(n=!1);const r=this.containsPosition(t.start)||n&&this.start.isEqual(t.start),i=this.containsPosition(t.end)||n&&this.end.isEqual(t.end);return r&&i}containsItem(t){const n=_._createBefore(t);return this.containsPosition(n)||this.start.isEqual(n)}isEqual(t){return this.start.isEqual(t.start)&&this.end.isEqual(t.end)}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}getDifference(t){const n=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&n.push(new p(this.start,t.start)),this.containsPosition(t.end)&&n.push(new p(t.end,this.end))):n.push(new p(this.start,this.end)),n}getIntersection(t){if(this.isIntersecting(t)){let n=this.start,r=this.end;return this.containsPosition(t.start)&&(n=t.start),this.containsPosition(t.end)&&(r=t.end),new p(n,r)}return null}getJoined(t,n=!1){let r=this.isIntersecting(t);if(r||(this.start.isBefore(t.start)?r=n?this.end.isTouching(t.start):this.end.isEqual(t.start):r=n?t.end.isTouching(this.start):t.end.isEqual(this.start)),!r)return null;let i=this.start,o=this.end;return t.start.isBefore(i)&&(i=t.start),t.end.isAfter(o)&&(o=t.end),new p(i,o)}getMinimalFlatRanges(){const t=[],n=this.start.getCommonPath(this.end).length,r=_._createAt(this.start);let i=r.parent;for(;r.path.length>n+1;){const o=i.maxOffset-r.offset;o!==0&&t.push(new p(r,r.getShiftedBy(o))),r.path=r.path.slice(0,-1),r.offset++,i=i.parent}for(;r.path.length<=this.end.path.length;){const o=this.end.path[r.path.length-1],a=o-r.offset;a!==0&&t.push(new p(r,r.getShiftedBy(a))),r.offset=o,r.path.push(0)}return t}getWalker(t={}){return t.boundaries=this,new Rt(t)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const n=new Rt(t);for(const r of n)yield r.item}*getPositions(t={}){t.boundaries=this;const n=new Rt(t);yield n.position;for(const r of n)yield r.nextPosition}getTransformedByOperation(t){switch(t.type){case"insert":return this._getTransformedByInsertOperation(t);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(t);case"split":return[this._getTransformedBySplitOperation(t)];case"merge":return[this._getTransformedByMergeOperation(t)]}return[new p(this.start,this.end)]}getTransformedByOperations(t){const n=[new p(this.start,this.end)];for(const r of t)for(let i=0;i<n.length;i++){const o=n[i].getTransformedByOperation(r);n.splice(i,1,...o),i+=o.length-1}for(let r=0;r<n.length;r++){const i=n[r];for(let o=r+1;o<n.length;o++){const a=n[o];(i.containsRange(a)||a.containsRange(i)||i.isEqual(a))&&n.splice(o,1)}}return n}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const t=this.start.nodeAfter,n=this.end.nodeBefore;return t&&t.is("element")&&t===n?t:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(t,n=!1){return this._getTransformedByInsertion(t.position,t.howMany,n)}_getTransformedByMoveOperation(t,n=!1){const r=t.sourcePosition,i=t.howMany,o=t.targetPosition;return this._getTransformedByMove(r,o,i,n)}_getTransformedBySplitOperation(t){const n=this.start._getTransformedBySplitOperation(t);let r=this.end._getTransformedBySplitOperation(t);return this.end.isEqual(t.insertionPosition)&&(r=this.end.getShiftedBy(1)),n.root!=r.root&&(r=this.end.getShiftedBy(-1)),new p(n,r)}_getTransformedByMergeOperation(t){if(this.start.isEqual(t.targetPosition)&&this.end.isEqual(t.deletionPosition))return new p(this.start);let n=this.start._getTransformedByMergeOperation(t),r=this.end._getTransformedByMergeOperation(t);return n.root!=r.root&&(r=this.end.getShiftedBy(-1)),n.isAfter(r)?(t.sourcePosition.isBefore(t.targetPosition)?(n=_._createAt(r),n.offset=0):(t.deletionPosition.isEqual(n)||(r=t.deletionPosition),n=t.targetPosition),new p(n,r)):new p(n,r)}_getTransformedByInsertion(t,n,r=!1){if(r&&this.containsPosition(t))return[new p(this.start,t),new p(t.getShiftedBy(n),this.end._getTransformedByInsertion(t,n))];{const i=new p(this.start,this.end);return i.start=i.start._getTransformedByInsertion(t,n),i.end=i.end._getTransformedByInsertion(t,n),[i]}}_getTransformedByMove(t,n,r,i=!1){if(this.isCollapsed){const d=this.start._getTransformedByMove(t,n,r);return[new p(d)]}const o=p._createFromPositionAndShift(t,r),a=n._getTransformedByDeletion(t,r);if(this.containsPosition(n)&&!i&&(o.containsPosition(this.start)||o.containsPosition(this.end))){const d=this.start._getTransformedByMove(t,n,r),m=this.end._getTransformedByMove(t,n,r);return[new p(d,m)]}let l;const c=this.getDifference(o);let u=null;const f=this.getIntersection(o);if(c.length==1?u=new p(c[0].start._getTransformedByDeletion(t,r),c[0].end._getTransformedByDeletion(t,r)):c.length==2&&(u=new p(this.start,this.end._getTransformedByDeletion(t,r))),u?l=u._getTransformedByInsertion(a,r,f!==null||i):l=[],f){const d=new p(f.start._getCombined(o.start,a),f.end._getCombined(o.start,a));l.length==2?l.splice(1,0,d):l.push(d)}return l}_getTransformedByDeletion(t,n){let r=this.start._getTransformedByDeletion(t,n),i=this.end._getTransformedByDeletion(t,n);return r==null&&i==null?null:(r==null&&(r=t),i==null&&(i=t),new p(r,i))}static _createFromPositionAndShift(t,n){const r=t,i=t.getShiftedBy(n);return n>0?new this(r,i):new this(i,r)}static _createIn(t){return new this(_._createAt(t,0),_._createAt(t,t.maxOffset))}static _createOn(t){return this._createFromPositionAndShift(_._createBefore(t),t.offsetSize)}static _createFromRanges(t){if(t.length===0)throw new g("range-create-from-ranges-empty-array",null);if(t.length==1)return t[0].clone();const n=t[0];t.sort((o,a)=>o.start.isAfter(a.start)?1:-1);const r=t.indexOf(n),i=new this(n.start,n.end);for(let o=r-1;o>=0&&t[o].end.isEqual(i.start);o--)i.start=_._createAt(t[o].start);for(let o=r+1;o<t.length&&t[o].start.isEqual(i.end);o++)i.end=_._createAt(t[o].end);return i}static fromJSON(t,n){return new this(_.fromJSON(t.start,n),_.fromJSON(t.end,n))}}p.prototype.is=function(e){return e==="range"||e==="model:range"};let St=class extends rt{constructor(t){super();h(this,"parent",null);h(this,"_attrs");h(this,"_index",null);h(this,"_startOffset",null);this._attrs=Vt(t)}get document(){return null}get index(){return this._index}get startOffset(){return this._startOffset}get offsetSize(){return 1}get endOffset(){return this.startOffset===null?null:this.startOffset+this.offsetSize}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.parent===null?!1:this.root.isAttached()}getPath(){const t=[];let n=this;for(;n.parent;)t.unshift(n.startOffset),n=n.parent;return t}getAncestors(t={}){const n=[];let r=t.includeSelf?this:this.parent;for(;r;)n[t.parentFirst?"push":"unshift"](r),r=r.parent;return n}getCommonAncestor(t,n={}){const r=this.getAncestors(n),i=t.getAncestors(n);let o=0;for(;r[o]==i[o]&&r[o];)o++;return o===0?null:r[o-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const n=this.getPath(),r=t.getPath(),i=B(n,r);switch(i){case"prefix":return!0;case"extension":return!1;default:return n[i]<r[i]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}hasAttribute(t){return this._attrs.has(t)}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const t={};return this._attrs.size&&(t.attributes=Array.from(this._attrs).reduce((n,r)=>(n[r[0]]=r[1],n),{})),t}_clone(t){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(t,n){this._attrs.set(t,n)}_setAttributesTo(t){this._attrs=Vt(t)}_removeAttribute(t){return this._attrs.delete(t)}_clearAttributes(){this._attrs.clear()}};St.prototype.is=function(e){return e==="node"||e==="model:node"};class ie extends O(rt){constructor(...t){super();h(this,"_lastRangeBackward",!1);h(this,"_attrs",new Map);h(this,"_ranges",[]);t.length&&this.setTo(...t)}get anchor(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.end:t.start}return null}get focus(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.start:t.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(t){if(this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const n of this._ranges){let r=!1;for(const i of t._ranges)if(n.isEqual(i)){r=!0;break}if(!r)return!1}return!0}*getRanges(){for(const t of this._ranges)yield new p(t.start,t.end)}getFirstRange(){let t=null;for(const n of this._ranges)(!t||n.start.isBefore(t.start))&&(t=n);return t?new p(t.start,t.end):null}getLastRange(){let t=null;for(const n of this._ranges)(!t||n.end.isAfter(t.end))&&(t=n);return t?new p(t.start,t.end):null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}setTo(...t){let[n,r,i]=t;if(typeof r=="object"&&(i=r,r=void 0),n===null)this._setRanges([]);else if(n instanceof ie)this._setRanges(n.getRanges(),n.isBackward);else if(n&&typeof n.getRanges=="function")this._setRanges(n.getRanges(),n.isBackward);else if(n instanceof p)this._setRanges([n],!!i&&!!i.backward);else if(n instanceof _)this._setRanges([new p(n)]);else if(n instanceof St){const o=!!i&&!!i.backward;let a;if(r=="in")a=p._createIn(n);else if(r=="on")a=p._createOn(n);else if(r!==void 0)a=new p(_._createAt(n,r));else throw new g("model-selection-setto-required-second-parameter",[this,n]);this._setRanges([a],o)}else if(X(n))this._setRanges(n,i&&!!i.backward);else throw new g("model-selection-setto-not-selectable",[this,n])}_setRanges(t,n=!1){const r=Array.from(t),i=r.some(o=>{if(!(o instanceof p))throw new g("model-selection-set-ranges-not-range",[this,t]);return this._ranges.every(a=>!a.isEqual(o))});r.length===this._ranges.length&&!i||(this._replaceAllRanges(r),this._lastRangeBackward=!!n,this.fire("change:range",{directChange:!0}))}setFocus(t,n){if(this.anchor===null)throw new g("model-selection-setfocus-no-ranges",[this,t]);const r=_._createAt(t,n);if(r.compareWith(this.focus)=="same")return;const i=this.anchor;this._ranges.length&&this._popRange(),r.compareWith(i)=="before"?(this._pushRange(new p(r,i)),this._lastRangeBackward=!0):(this._pushRange(new p(i,r)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(t){return this._attrs.has(t)}removeAttribute(t){this.hasAttribute(t)&&(this._attrs.delete(t),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}setAttribute(t,n){this.getAttribute(t)!==n&&(this._attrs.set(t,n),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const t=new WeakSet;for(const n of this.getRanges()){const r=Fn(n.start,t);ic(r,n)&&(yield r);const i=n.getWalker();for(const a of i){const l=a.item;a.type=="elementEnd"&&rc(l,t,n)?yield l:a.type=="elementStart"&&l.is("model:element")&&l.root.document.model.schema.isBlock(l)&&i.jumpTo(_._createAt(l,"end"))}const o=Fn(n.end,t);oc(o,n)&&(yield o)}}containsEntireContent(t=this.anchor.root){const n=_._createAt(t,0),r=_._createAt(t,"end");return n.isTouching(this.getFirstPosition())&&r.isTouching(this.getLastPosition())}_pushRange(t){this._checkRange(t),this._ranges.push(new p(t.start,t.end))}_checkRange(t){for(let n=0;n<this._ranges.length;n++)if(t.isIntersecting(this._ranges[n]))throw new g("model-selection-range-intersects",[this,t],{addedRange:t,intersectingRange:this._ranges[n]})}_replaceAllRanges(t){this._removeAllRanges();for(const n of t)this._pushRange(n)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}ie.prototype.is=function(e){return e==="selection"||e==="model:selection"};function Ns(e,s){return s.has(e)?!1:(s.add(e),e.root.document.model.schema.isBlock(e)&&!!e.parent)}function rc(e,s,t){return Ns(e,s)&&ze(e,t)}function Fn(e,s){const n=e.parent.root.document.model.schema,r=e.parent.getAncestors({parentFirst:!0,includeSelf:!0});let i=!1;const o=r.find(a=>i?!1:(i=n.isLimit(a),!i&&Ns(a,s)));return r.forEach(a=>s.add(a)),o}function ze(e,s){const t=ac(e);return t?!s.containsRange(p._createOn(t),!0):!0}function ic(e,s){return e?s.isCollapsed||e.isEmpty?!0:s.start.isTouching(_._createAt(e,e.maxOffset))?!1:ze(e,s):!1}function oc(e,s){return e?s.isCollapsed||e.isEmpty?!0:s.end.isTouching(_._createAt(e,0))?!1:ze(e,s):!1}function ac(e){const s=e.root.document.model.schema;let t=e.parent;for(;t;){if(s.isBlock(t))return t;t=t.parent}}class oe extends O(p){constructor(s,t){super(s,t),lc.call(this)}detach(){this.stopListening()}toRange(){return new p(this.start,this.end)}static fromRange(s){return new oe(s.start,s.end)}}oe.prototype.is=function(e){return e==="liveRange"||e==="model:liveRange"||e=="range"||e==="model:range"};function lc(){this.listenTo(this.root.document.model,"applyOperation",(e,s)=>{const t=s[0];t.isDocumentOperation&&cc.call(this,t)},{priority:"low"})}function cc(e){const s=this.getTransformedByOperation(e),t=p._createFromRanges(s),n=!t.isEqual(this),r=uc(this,e);let i=null;if(n){t.root.rootName=="$graveyard"&&(e.type=="remove"?i=e.sourcePosition:i=e.deletionPosition);const o=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",o,{deletionPosition:i})}else r&&this.fire("change:content",this.toRange(),{deletionPosition:i})}function uc(e,s){switch(s.type){case"insert":return e.containsPosition(s.position);case"move":case"remove":case"reinsert":case"merge":return e.containsPosition(s.sourcePosition)||e.start.isEqual(s.sourcePosition)||e.containsPosition(s.targetPosition);case"split":return e.containsPosition(s.splitPosition)||e.containsPosition(s.insertionPosition)}return!1}class E extends St{constructor(t,n){super(n);h(this,"_data");this._data=t||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const t=super.toJSON();return t.data=this.data,t}_clone(){return new E(this.data,this.getAttributes())}static fromJSON(t){return new E(t.data,t.attributes)}}E.prototype.is=function(e){return e==="$text"||e==="model:$text"||e==="text"||e==="model:text"||e==="node"||e==="model:node"};const qt="selection:";class hc extends O(rt){constructor(t){super();h(this,"_selection");this._selection=new fc(t),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(t){return this._selection.containsEntireContent(t)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(t){return this._selection.getAttribute(t)}hasAttribute(t){return this._selection.hasAttribute(t)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(t){this._selection.observeMarkers(t)}_setFocus(t,n){this._selection.setFocus(t,n)}_setTo(...t){this._selection.setTo(...t)}_setAttribute(t,n){this._selection.setAttribute(t,n)}_removeAttribute(t){this._selection.removeAttribute(t)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(t){this._selection.restoreGravity(t)}static _getStoreAttributeKey(t){return qt+t}static _isStoreAttributeKey(t){return t.startsWith(qt)}}hc.prototype.is=function(e){return e==="selection"||e=="model:selection"||e=="documentSelection"||e=="model:documentSelection"};class fc extends ie{constructor(t){super();h(this,"markers",new Ml({idProperty:"name"}));h(this,"_model");h(this,"_document");h(this,"_attributePriority",new Map);h(this,"_selectionRestorePosition",null);h(this,"_hasChangedRange",!1);h(this,"_overriddenGravityRegister",new Set);h(this,"_observedMarkers",new Set);this._model=t.model,this._document=t,this.listenTo(this._model,"applyOperation",(n,r)=>{const i=r[0];!i.isDocumentOperation||i.type=="marker"||i.type=="rename"||i.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{this._validateSelectionRanges(this.getRanges())}),this.listenTo(this._model.markers,"update",(n,r,i,o)=>{this._updateMarker(r,o)}),this.listenTo(this._document,"change",(n,r)=>{dc(this._model,r)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let t=0;t<this._ranges.length;t++)this._ranges[t].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...t){super.setTo(...t),this._updateAttributes(!0),this.updateMarkers()}setFocus(t,n){super.setFocus(t,n),this._updateAttributes(!0),this.updateMarkers()}setAttribute(t,n){if(this._setAttribute(t,n)){const r=[t];this.fire("change:attribute",{attributeKeys:r,directChange:!0})}}removeAttribute(t){if(this._removeAttribute(t)){const n=[t];this.fire("change:attribute",{attributeKeys:n,directChange:!0})}}overrideGravity(){const t=re();return this._overriddenGravityRegister.add(t),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),t}restoreGravity(t){if(!this._overriddenGravityRegister.has(t))throw new g("document-selection-gravity-wrong-restore",this,{uid:t});this._overriddenGravityRegister.delete(t),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(t){this._observedMarkers.add(t),this.updateMarkers()}_replaceAllRanges(t){this._validateSelectionRanges(t),super._replaceAllRanges(t)}_popRange(){this._ranges.pop().detach()}_pushRange(t){const n=this._prepareRange(t);n&&this._ranges.push(n)}_validateSelectionRanges(t){for(const n of t)if(!this._document._validateSelectionRange(n))throw new g("document-selection-wrong-position",this,{range:n})}_prepareRange(t){if(this._checkRange(t),t.root==this._document.graveyard)return;const n=oe.fromRange(t);return n.on("change:range",(r,i,o)=>{if(this._hasChangedRange=!0,n.root==this._document.graveyard){this._selectionRestorePosition=o.deletionPosition;const a=this._ranges.indexOf(n);this._ranges.splice(a,1),n.detach()}}),n}updateMarkers(){if(!this._observedMarkers.size)return;const t=[];let n=!1;for(const i of this._model.markers){const o=i.name.split(":",1)[0];if(!this._observedMarkers.has(o))continue;const a=i.getRange();for(const l of this.getRanges())a.containsRange(l,!l.isCollapsed)&&t.push(i)}const r=Array.from(this.markers);for(const i of t)this.markers.has(i)||(this.markers.add(i),n=!0);for(const i of Array.from(this.markers))t.includes(i)||(this.markers.remove(i),n=!0);n&&this.fire("change:marker",{oldMarkers:r,directChange:!1})}_updateMarker(t,n){const r=t.name.split(":",1)[0];if(!this._observedMarkers.has(r))return;let i=!1;const o=Array.from(this.markers),a=this.markers.has(t);if(!n)a&&(this.markers.remove(t),i=!0);else{let l=!1;for(const c of this.getRanges())if(n.containsRange(c,!c.isCollapsed)){l=!0;break}l&&!a?(this.markers.add(t),i=!0):!l&&a&&(this.markers.remove(t),i=!0)}i&&this.fire("change:marker",{oldMarkers:o,directChange:!1})}_updateAttributes(t){const n=Vt(this._getSurroundingAttributes()),r=Vt(this.getAttributes());if(t)this._attributePriority=new Map,this._attrs=new Map;else for(const[o,a]of this._attributePriority)a=="low"&&(this._attrs.delete(o),this._attributePriority.delete(o));this._setAttributesTo(n);const i=[];for(const[o,a]of this.getAttributes())(!r.has(o)||r.get(o)!==a)&&i.push(o);for(const[o]of r)this.hasAttribute(o)||i.push(o);i.length>0&&this.fire("change:attribute",{attributeKeys:i,directChange:!1})}_setAttribute(t,n,r=!0){const i=r?"normal":"low";return i=="low"&&this._attributePriority.get(t)=="normal"||super.getAttribute(t)===n?!1:(this._attrs.set(t,n),this._attributePriority.set(t,i),!0)}_removeAttribute(t,n=!0){const r=n?"normal":"low";return r=="low"&&this._attributePriority.get(t)=="normal"||(this._attributePriority.set(t,r),!super.hasAttribute(t))?!1:(this._attrs.delete(t),!0)}_setAttributesTo(t){const n=new Set;for(const[r,i]of this.getAttributes())t.get(r)!==i&&this._removeAttribute(r,!1);for(const[r,i]of t)this._setAttribute(r,i,!1)&&n.add(r);return n}*getStoredAttributes(){const t=this.getFirstPosition().parent;if(this.isCollapsed&&t.isEmpty)for(const n of t.getAttributeKeys())n.startsWith(qt)&&(yield[n.substr(qt.length),t.getAttribute(n)])}_getSurroundingAttributes(){const t=this.getFirstPosition(),n=this._model.schema;if(t.root.rootName=="$graveyard")return null;let r=null;if(this.isCollapsed){const i=t.textNode?t.textNode:t.nodeBefore,o=t.textNode?t.textNode:t.nodeAfter;if(this.isGravityOverridden||(r=Ot(i,n)),r||(r=Ot(o,n)),!this.isGravityOverridden&&!r){let a=i;for(;a&&!r;)a=a.previousSibling,r=Ot(a,n)}if(!r){let a=o;for(;a&&!r;)a=a.nextSibling,r=Ot(a,n)}r||(r=this.getStoredAttributes())}else{const i=this.getFirstRange();for(const o of i){if(o.item.is("element")&&n.isObject(o.item)){r=Ot(o.item,n);break}if(o.type=="text"){r=o.item.getAttributes();break}}}return r}_fixGraveyardSelection(t){const n=this._model.schema.getNearestSelectionRange(t);n&&this._pushRange(n)}}function Ot(e,s){if(!e)return null;if(e instanceof ut||e instanceof E)return e.getAttributes();if(!s.isInline(e))return null;if(!s.isObject(e))return[];const t=[];for(const[n,r]of e.getAttributes())s.checkAttribute("$text",n)&&s.getAttributeProperties(n).copyFromObject!==!1&&t.push([n,r]);return t}function dc(e,s){const t=e.document.differ;for(const n of t.getChanges()){if(n.type!="insert")continue;const r=n.position.parent;n.length===r.maxOffset&&e.enqueueChange(s,o=>{const a=Array.from(r.getAttributeKeys()).filter(l=>l.startsWith(qt));for(const l of a)o.removeAttribute(l,r)})}}class Ft{constructor(s){h(this,"_nodes",[]);h(this,"_offsetToNode",[]);s&&this._insertNodes(0,s)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._offsetToNode.length}getNode(s){return this._nodes[s]||null}getNodeAtOffset(s){return this._offsetToNode[s]||null}getNodeIndex(s){return s.index}getNodeStartOffset(s){return s.startOffset}indexToOffset(s){if(s==this._nodes.length)return this.maxOffset;const t=this._nodes[s];if(!t)throw new g("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(s){if(s==this._offsetToNode.length)return this._nodes.length;const t=this._offsetToNode[s];if(!t)throw new g("model-nodelist-offset-out-of-bounds",this,{offset:s,nodeList:this});return this.getNodeIndex(t)}_insertNodes(s,t){const n=[];for(const i of t){if(!(i instanceof St))throw new g("model-nodelist-insertnodes-not-node",this);n.push(i)}let r=this.indexToOffset(s);Mn(this._nodes,n,s),Mn(this._offsetToNode,gc(n),r);for(let i=s;i<this._nodes.length;i++)this._nodes[i]._index=i,this._nodes[i]._startOffset=r,r+=this._nodes[i].offsetSize}_removeNodes(s,t=1){if(t==0)return[];let n=this.indexToOffset(s);const r=this._nodes.splice(s,t),i=r[r.length-1],o=i.startOffset+i.offsetSize-n;this._offsetToNode.splice(n,o);for(const a of r)a._index=null,a._startOffset=null;for(let a=s;a<this._nodes.length;a++)this._nodes[a]._index=a,this._nodes[a]._startOffset=n,n+=this._nodes[a].offsetSize;return r}_removeNodesArray(s){if(s.length==0)return;for(const n of s)n._index=null,n._startOffset=null;this._nodes=this._nodes.filter(n=>n.index!==null),this._offsetToNode=this._offsetToNode.filter(n=>n.index!==null);let t=0;for(let n=0;n<this._nodes.length;n++)this._nodes[n]._index=n,this._nodes[n]._startOffset=t,t+=this._nodes[n].offsetSize}toJSON(){return this._nodes.map(s=>s.toJSON())}}function gc(e){const s=[];let t=0;for(const n of e)for(let r=0;r<n.offsetSize;r++)s[t++]=n;return s}class K extends St{constructor(t,n,r){super(n);h(this,"name");h(this,"_children",new Ft);this.name=t,r&&this._insertChild(0,r)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}getChild(t){return this._children.getNode(t)}getChildAtOffset(t){return this._children.getNodeAtOffset(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}offsetToIndex(t){return this._children.offsetToIndex(t)}getNodeByPath(t){let n=this;for(const r of t)n=n.getChildAtOffset(r);return n}findAncestor(t,n={}){let r=n.includeSelf?this:this.parent;for(;r;){if(r.name===t)return r;r=r.parent}return null}toJSON(){const t=super.toJSON();if(t.name=this.name,this._children.length>0){t.children=[];for(const n of this._children)t.children.push(n.toJSON())}return t}_clone(t=!1){const n=t?mc(this._children):void 0;return new K(this.name,this.getAttributes(),n)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,n){const r=pc(n);for(const i of r)i.parent!==null&&i._remove(),i.parent=this;this._children._insertNodes(t,r)}_removeChildren(t,n=1){const r=this._children._removeNodes(t,n);for(const i of r)i.parent=null;return r}_removeChildrenArray(t){this._children._removeNodesArray(t);for(const n of t)n.parent=null}static fromJSON(t){let n;if(t.children){n=[];for(const r of t.children)r.name?n.push(K.fromJSON(r)):n.push(E.fromJSON(r))}return new K(t.name,t.attributes,n)}}K.prototype.is=function(e,s){return s?s===this.name&&(e==="element"||e==="model:element"):e==="element"||e==="model:element"||e==="node"||e==="model:node"};function pc(e){if(typeof e=="string")return[new E(e)];X(e)||(e=[e]);const s=[];for(const t of e)typeof t=="string"?s.push(new E(t)):t instanceof ut?s.push(new E(t.data,t.getAttributes())):s.push(t);return s}function mc(e){const s=[];for(const t of e)s.push(t._clone(!0));return s}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ${constructor(s){h(this,"baseVersion");h(this,"isDocumentOperation");h(this,"batch");this.baseVersion=s,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const s=Object.assign({},this);return s.__className=this.constructor.className,delete s.batch,delete s.isDocumentOperation,s}static get className(){return"Operation"}static fromJSON(s,t){return new this(s.baseVersion)}}function Ue(e,s){const t=Bs(s),n=t.reduce((o,a)=>o+a.offsetSize,0),r=e.parent;zt(e);const i=e.index;return r._insertChild(i,t),Jt(r,i+t.length),Jt(r,i),new p(e,e.getShiftedBy(n))}function _c(e){if(!e.isFlat)throw new g("operation-utils-remove-range-not-flat",this);const s=e.start.parent;zt(e.start),zt(e.end);const t=s._removeChildren(e.start.index,e.end.index-e.start.index);return Jt(s,e.start.index),t}function jt(e,s){if(!e.isFlat)throw new g("operation-utils-move-range-not-flat",this);const t=_c(e);return s=s._getTransformedByDeletion(e.start,e.end.offset-e.start.offset),Ue(s,t)}function yc(e,s,t){zt(e.start),zt(e.end);for(const n of e.getItems({shallow:!0})){const r=n.is("$textProxy")?n.textNode:n;t!==null?r._setAttribute(s,t):r._removeAttribute(s),Jt(r.parent,r.index)}Jt(e.end.parent,e.end.index)}function Bs(e){const s=[];function t(n){if(typeof n=="string")s.push(new E(n));else if(n instanceof ut)s.push(new E(n.data,n.getAttributes()));else if(n instanceof St)s.push(n);else if(X(n))for(const r of n)t(r)}t(e);for(let n=1;n<s.length;n++){const r=s[n],i=s[n-1];r instanceof E&&i instanceof E&&Fs(r,i)&&(s.splice(n-1,2,new E(i.data+r.data,i.getAttributes())),n--)}return s}function Jt(e,s){const t=e.getChild(s-1),n=e.getChild(s);if(t&&n&&t.is("$text")&&n.is("$text")&&Fs(t,n)){const r=new E(t.data+n.data,t.getAttributes());e._removeChildren(s-1,2),e._insertChild(s-1,r)}}function zt(e){const s=e.textNode,t=e.parent;if(s){const n=e.offset-s.startOffset,r=s.index;t._removeChildren(r,1);const i=new E(s.data.substr(0,n),s.getAttributes()),o=new E(s.data.substr(n),s.getAttributes());t._insertChild(r,[i,o])}}function Fs(e,s){const t=e.getAttributes(),n=s.getAttributes();for(const r of t){if(r[1]!==s.getAttribute(r[0]))return!1;n.next()}return n.next().done}class A extends ${constructor(t,n,r,i){super(i);h(this,"sourcePosition");h(this,"howMany");h(this,"targetPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toNext",this.howMany=n,this.targetPosition=r.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}get affectedSelectable(){return[p._createFromPositionAndShift(this.sourcePosition,this.howMany),p._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new A(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const t=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new A(this.getMovedRangeStart(),this.howMany,t,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,n=this.targetPosition.parent,r=this.sourcePosition.offset,i=this.targetPosition.offset;if(r+this.howMany>t.maxOffset)throw new g("move-operation-nodes-do-not-exist",this);if(t===n&&r<i&&i<r+this.howMany)throw new g("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&B(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const o=this.sourcePosition.path.length-1;if(this.targetPosition.path[o]>=r&&this.targetPosition.path[o]<r+this.howMany)throw new g("move-operation-node-into-itself",this)}}_execute(){jt(p._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t.targetPosition=this.targetPosition.toJSON(),t}static get className(){return"MoveOperation"}static fromJSON(t,n){const r=_.fromJSON(t.sourcePosition,n),i=_.fromJSON(t.targetPosition,n);return new this(r,t.howMany,i,t.baseVersion)}}class M extends ${constructor(t,n,r){super(r);h(this,"position");h(this,"nodes");h(this,"shouldReceiveAttributes");this.position=t.clone(),this.position.stickiness="toNone",this.nodes=new Ft(Bs(n)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const t=new Ft([...this.nodes].map(r=>r._clone(!0))),n=new M(this.position,t,this.baseVersion);return n.shouldReceiveAttributes=this.shouldReceiveAttributes,n}getReversed(){const t=this.position.root.document.graveyard,n=new _(t,[0]);return new A(this.position,this.nodes.maxOffset,n,this.baseVersion+1)}_validate(){const t=this.position.parent;if(!t||t.maxOffset<this.position.offset)throw new g("insert-operation-position-invalid",this)}_execute(){const t=this.nodes;this.nodes=new Ft([...t].map(n=>n._clone(!0))),Ue(this.position,t)}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t.nodes=this.nodes.toJSON(),t}static get className(){return"InsertOperation"}static fromJSON(t,n){const r=[];for(const o of t.nodes)o.name?r.push(K.fromJSON(o)):r.push(E.fromJSON(o));const i=new M(_.fromJSON(t.position,n),r,t.baseVersion);return i.shouldReceiveAttributes=t.shouldReceiveAttributes,i}}class T extends ${constructor(t,n,r,i,o){super(o);h(this,"splitPosition");h(this,"howMany");h(this,"insertionPosition");h(this,"graveyardPosition");this.splitPosition=t.clone(),this.splitPosition.stickiness="toNext",this.howMany=n,this.insertionPosition=r,this.graveyardPosition=i?i.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const t=this.insertionPosition.path.slice();return t.push(0),new _(this.insertionPosition.root,t)}get movedRange(){const t=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new p(this.splitPosition,t)}get affectedSelectable(){const t=[p._createFromPositionAndShift(this.splitPosition,0),p._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&t.push(p._createFromPositionAndShift(this.graveyardPosition,0)),t}clone(){return new T(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.splitPosition.root.document.graveyard,n=new _(t,[0]);return new N(this.moveTargetPosition,this.howMany,this.splitPosition,n,this.baseVersion+1)}_validate(){const t=this.splitPosition.parent,n=this.splitPosition.offset;if(!t||t.maxOffset<n)throw new g("split-operation-position-invalid",this);if(t.parent){if(this.howMany!=t.maxOffset-this.splitPosition.offset)throw new g("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new g("split-operation-graveyard-position-invalid",this)}else throw new g("split-operation-split-in-root",this)}_execute(){const t=this.splitPosition.parent;if(this.graveyardPosition)jt(p._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const r=t._clone();Ue(this.insertionPosition,r)}const n=new p(_._createAt(t,this.splitPosition.offset),_._createAt(t,t.maxOffset));jt(n,this.moveTargetPosition)}toJSON(){const t=super.toJSON();return t.splitPosition=this.splitPosition.toJSON(),t.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(t.graveyardPosition=this.graveyardPosition.toJSON()),t}static get className(){return"SplitOperation"}static getInsertionPosition(t){const n=t.path.slice(0,-1);return n[n.length-1]++,new _(t.root,n,"toPrevious")}static fromJSON(t,n){const r=_.fromJSON(t.splitPosition,n),i=_.fromJSON(t.insertionPosition,n),o=t.graveyardPosition?_.fromJSON(t.graveyardPosition,n):null;return new this(r,t.howMany,i,o,t.baseVersion)}}class N extends ${constructor(t,n,r,i,o){super(o);h(this,"sourcePosition");h(this,"howMany");h(this,"targetPosition");h(this,"graveyardPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=n,this.targetPosition=r.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=i.clone()}get type(){return"merge"}get deletionPosition(){return new _(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const t=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new p(this.sourcePosition,t)}get affectedSelectable(){const t=this.sourcePosition.parent;return[p._createOn(t),p._createFromPositionAndShift(this.targetPosition,0),p._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new N(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.targetPosition._getTransformedByMergeOperation(this),n=this.sourcePosition.path.slice(0,-1),r=new _(this.sourcePosition.root,n)._getTransformedByMergeOperation(this);return new T(t,this.howMany,r,this.graveyardPosition,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,n=this.targetPosition.parent;if(t.parent)if(n.parent){if(this.howMany!=t.maxOffset)throw new g("merge-operation-how-many-invalid",this)}else throw new g("merge-operation-target-position-invalid",this);else throw new g("merge-operation-source-position-invalid",this)}_execute(){const t=this.sourcePosition.parent,n=p._createIn(t);jt(n,this.targetPosition),jt(p._createOn(t),this.graveyardPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=t.sourcePosition.toJSON(),t.targetPosition=t.targetPosition.toJSON(),t.graveyardPosition=t.graveyardPosition.toJSON(),t}static get className(){return"MergeOperation"}static fromJSON(t,n){const r=_.fromJSON(t.sourcePosition,n),i=_.fromJSON(t.targetPosition,n),o=_.fromJSON(t.graveyardPosition,n);return new this(r,t.howMany,i,o,t.baseVersion)}}class I extends ${constructor(t,n,r,i,o,a){super(a);h(this,"name");h(this,"oldRange");h(this,"newRange");h(this,"affectsData");h(this,"_markers");this.name=t,this.oldRange=n?n.clone():null,this.newRange=r?r.clone():null,this.affectsData=o,this._markers=i}get type(){return"marker"}get affectedSelectable(){const t=[];return this.oldRange&&t.push(this.oldRange.clone()),this.newRange&&(this.oldRange?t.push(...this.newRange.getDifference(this.oldRange)):t.push(this.newRange.clone())),t}clone(){return new I(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new I(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const t=super.toJSON();return this.oldRange&&(t.oldRange=this.oldRange.toJSON()),this.newRange&&(t.newRange=this.newRange.toJSON()),delete t._markers,t}static get className(){return"MarkerOperation"}static fromJSON(t,n){return new I(t.name,t.oldRange?p.fromJSON(t.oldRange,n):null,t.newRange?p.fromJSON(t.newRange,n):null,n.model.markers,t.affectsData,t.baseVersion)}}class x extends ${constructor(t,n,r,i,o){super(o);h(this,"range");h(this,"key");h(this,"oldValue");h(this,"newValue");this.range=t.clone(),this.key=n,this.oldValue=r===void 0?null:r,this.newValue=i===void 0?null:i}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new x(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new x(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const t=super.toJSON();return t.range=this.range.toJSON(),t}_validate(){if(!this.range.isFlat)throw new g("attribute-operation-range-not-flat",this);for(const t of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!bn(t.getAttribute(this.key),this.oldValue))throw new g("attribute-operation-wrong-old-value",this,{item:t,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&t.hasAttribute(this.key))throw new g("attribute-operation-attribute-exists",this,{node:t,key:this.key})}}_execute(){bn(this.oldValue,this.newValue)||yc(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(t,n){return new x(p.fromJSON(t.range,n),t.key,t.oldValue,t.newValue,t.baseVersion)}}class R extends ${get type(){return"noop"}get affectedSelectable(){return null}clone(){return new R(this.baseVersion)}getReversed(){return new R(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}class F extends ${constructor(t,n,r,i){super(i);h(this,"position");h(this,"oldName");h(this,"newName");this.position=t,this.position.stickiness="toNext",this.oldName=n,this.newName=r}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new F(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new F(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const t=this.position.nodeAfter;if(t instanceof K){if(t.name!==this.oldName)throw new g("rename-operation-wrong-name",this)}else throw new g("rename-operation-wrong-position",this)}_execute(){const t=this.position.nodeAfter;t.name=this.newName}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t}static get className(){return"RenameOperation"}static fromJSON(t,n){return new F(_.fromJSON(t.position,n),t.oldName,t.newName,t.baseVersion)}}class Q extends ${constructor(t,n,r,i,o){super(o);h(this,"root");h(this,"key");h(this,"oldValue");h(this,"newValue");this.root=t,this.key=n,this.oldValue=r===void 0?null:r,this.newValue=i===void 0?null:i}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new Q(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new Q(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new g("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new g("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new g("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const t=super.toJSON();return t.root=this.root.toJSON(),t}static get className(){return"RootAttributeOperation"}static fromJSON(t,n){if(!n.getRoot(t.root))throw new g("rootattribute-operation-fromjson-no-root",this,{rootName:t.root});return new Q(n.getRoot(t.root),t.key,t.oldValue,t.newValue,t.baseVersion)}}class tt extends ${constructor(t,n,r,i,o){super(o);h(this,"rootName");h(this,"elementName");h(this,"isAdd");h(this,"_document");if(this.rootName=t,this.elementName=n,this.isAdd=r,this._document=i,!this._document.getRoot(this.rootName)){const a=this._document.createRoot(this.elementName,this.rootName);a._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new tt(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new tt(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const t=super.toJSON();return delete t._document,t}static get className(){return"RootOperation"}static fromJSON(t,n){return new tt(t.rootName,t.elementName,t.isAdd,n,t.baseVersion)}}const D={};D[x.className]=x;D[M.className]=M;D[I.className]=I;D[A.className]=A;D[R.className]=R;D[$.className]=$;D[F.className]=F;D[Q.className]=Q;D[tt.className]=tt;D[T.className]=T;D[N.className]=N;const In=new Map;function P(e,s,t){let n=In.get(e);n||(n=new Map,In.set(e,n)),n.set(s,t)}P(x,x,(e,s,t)=>{if(e.key===s.key&&e.range.start.hasSameParentAs(s.range.start)){const n=e.range.getDifference(s.range).map(i=>new x(i,e.key,e.oldValue,e.newValue,0)),r=e.range.getIntersection(s.range);return r&&t.aIsStrong&&n.push(new x(r,s.key,s.newValue,e.newValue,0)),n.length==0?[new R(0)]:n}else return[e]});P(x,M,(e,s)=>{if(e.range.start.hasSameParentAs(s.position)&&e.range.containsPosition(s.position)){const n=e.range._getTransformedByInsertion(s.position,s.howMany,!s.shouldReceiveAttributes).map(r=>new x(r,e.key,e.oldValue,e.newValue,e.baseVersion));if(s.shouldReceiveAttributes){const r=Is(s,e.key,e.oldValue);r&&n.unshift(r)}return n}return e.range=e.range._getTransformedByInsertion(s.position,s.howMany,!1)[0],[e]});function Is(e,s,t){const r=e.nodes.getNode(0).getAttribute(s);if(r==t)return null;const i=new p(e.position,e.position.getShiftedBy(e.howMany));return new x(i,s,r,t,0)}P(x,N,(e,s)=>{const t=[];e.range.start.hasSameParentAs(s.deletionPosition)&&(e.range.containsPosition(s.deletionPosition)||e.range.start.isEqual(s.deletionPosition))&&t.push(p._createFromPositionAndShift(s.graveyardPosition,1));const n=e.range._getTransformedByMergeOperation(s);return n.isCollapsed||t.push(n),t.map(r=>new x(r,e.key,e.oldValue,e.newValue,e.baseVersion))});P(x,A,(e,s)=>wc(e.range,s).map(n=>new x(n,e.key,e.oldValue,e.newValue,e.baseVersion)));function wc(e,s){const t=p._createFromPositionAndShift(s.sourcePosition,s.howMany);let n=null,r=[];t.containsRange(e,!0)?n=e:e.start.hasSameParentAs(t.start)?(r=e.getDifference(t),n=e.getIntersection(t)):r=[e];const i=[];for(let o of r){o=o._getTransformedByDeletion(s.sourcePosition,s.howMany);const a=s.getMovedRangeStart(),l=o.start.hasSameParentAs(a),c=o._getTransformedByInsertion(a,s.howMany,l);i.push(...c)}return n&&i.push(n._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany,!1)[0]),i}P(x,T,(e,s)=>{if(e.range.end.isEqual(s.insertionPosition))return s.graveyardPosition||e.range.end.offset++,[e];if(e.range.start.hasSameParentAs(s.splitPosition)&&e.range.containsPosition(s.splitPosition)){const t=e.clone();return t.range=new p(s.moveTargetPosition.clone(),e.range.end._getCombined(s.splitPosition,s.moveTargetPosition)),e.range.end=s.splitPosition.clone(),e.range.end.stickiness="toPrevious",[e,t]}return e.range=e.range._getTransformedBySplitOperation(s),[e]});P(M,x,(e,s)=>{const t=[e];if(e.shouldReceiveAttributes&&e.position.hasSameParentAs(s.range.start)&&s.range.containsPosition(e.position)){const n=Is(e,s.key,s.newValue);n&&t.push(n)}return t});P(M,M,(e,s,t)=>e.position.isEqual(s.position)&&t.aIsStrong?[e]:(e.position=e.position._getTransformedByInsertOperation(s),[e]));P(M,A,(e,s)=>(e.position=e.position._getTransformedByMoveOperation(s),[e]));P(M,T,(e,s)=>(e.position=e.position._getTransformedBySplitOperation(s),[e]));P(M,N,(e,s)=>(e.position=e.position._getTransformedByMergeOperation(s),[e]));P(I,M,(e,s)=>(e.oldRange&&(e.oldRange=e.oldRange._getTransformedByInsertOperation(s)[0]),e.newRange&&(e.newRange=e.newRange._getTransformedByInsertOperation(s)[0]),[e]));P(I,I,(e,s,t)=>{if(e.name==s.name)if(t.aIsStrong)e.oldRange=s.newRange?s.newRange.clone():null;else return[new R(0)];return[e]});P(I,N,(e,s)=>(e.oldRange&&(e.oldRange=e.oldRange._getTransformedByMergeOperation(s)),e.newRange&&(e.newRange=e.newRange._getTransformedByMergeOperation(s)),[e]));P(I,A,(e,s)=>{const t=[e];if(e.oldRange&&(e.oldRange=p._createFromRanges(e.oldRange._getTransformedByMoveOperation(s))),e.newRange){const n=e.newRange._getTransformedByMoveOperation(s);e.newRange=n[0];for(let r=1;r<n.length;r++){const i=e.clone();i.oldRange=null,i.newRange=n[r],i.baseVersion=-1,t.push(i)}}return t});P(I,T,(e,s,t)=>{if(e.oldRange&&(e.oldRange=e.oldRange._getTransformedBySplitOperation(s)),e.newRange){if(t.abRelation){const n=e.newRange._getTransformedBySplitOperation(s);return e.newRange.start.isEqual(s.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?e.newRange.start=_._createAt(s.insertionPosition):e.newRange.start.isEqual(s.splitPosition)&&!t.abRelation.wasInLeftElement?e.newRange.start=_._createAt(s.moveTargetPosition):e.newRange.start=n.start,e.newRange.end.isEqual(s.splitPosition)&&t.abRelation.wasInRightElement?e.newRange.end=_._createAt(s.moveTargetPosition):e.newRange.end.isEqual(s.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?e.newRange.end=_._createAt(s.insertionPosition):e.newRange.end=n.end,[e]}e.newRange=e.newRange._getTransformedBySplitOperation(s)}return[e]});P(N,M,(e,s)=>(e.sourcePosition.hasSameParentAs(s.position)&&(e.howMany+=s.howMany),e.sourcePosition=e.sourcePosition._getTransformedByInsertOperation(s),e.targetPosition=e.targetPosition._getTransformedByInsertOperation(s),[e]));P(N,N,(e,s,t)=>{if(e.sourcePosition.isEqual(s.sourcePosition)&&e.targetPosition.isEqual(s.targetPosition))if(t.bWasUndone){const n=s.graveyardPosition.path.slice();return n.push(0),e.sourcePosition=new _(s.graveyardPosition.root,n),e.howMany=0,[e]}else return[new R(0)];if(e.sourcePosition.isEqual(s.sourcePosition)&&!e.targetPosition.isEqual(s.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const n=e.targetPosition.root.rootName=="$graveyard",r=s.targetPosition.root.rootName=="$graveyard";if(r&&!n||!(n&&!r)&&t.aIsStrong){const l=s.targetPosition._getTransformedByMergeOperation(s),c=e.targetPosition._getTransformedByMergeOperation(s);return[new A(l,e.howMany,c,0)]}else return[new R(0)]}return e.sourcePosition.hasSameParentAs(s.targetPosition)&&(e.howMany+=s.howMany),e.sourcePosition=e.sourcePosition._getTransformedByMergeOperation(s),e.targetPosition=e.targetPosition._getTransformedByMergeOperation(s),(!e.graveyardPosition.isEqual(s.graveyardPosition)||!t.aIsStrong)&&(e.graveyardPosition=e.graveyardPosition._getTransformedByMergeOperation(s)),[e]});P(N,A,(e,s,t)=>{const n=p._createFromPositionAndShift(s.sourcePosition,s.howMany);return s.type=="remove"&&!t.bWasUndone&&e.deletionPosition.hasSameParentAs(s.sourcePosition)&&n.containsPosition(e.sourcePosition)?[new R(0)]:(s.sourcePosition.getShiftedBy(s.howMany).isEqual(e.sourcePosition)?e.sourcePosition.stickiness="toNone":s.targetPosition.isEqual(e.sourcePosition)&&t.abRelation=="mergeSourceAffected"?e.sourcePosition.stickiness="toNext":s.sourcePosition.isEqual(e.targetPosition)?(e.targetPosition.stickiness="toNone",e.howMany-=s.howMany):s.targetPosition.isEqual(e.targetPosition)&&t.abRelation=="mergeTargetWasBefore"?(e.targetPosition.stickiness="toPrevious",e.howMany+=s.howMany):(e.sourcePosition.hasSameParentAs(s.targetPosition)&&(e.howMany+=s.howMany),e.sourcePosition.hasSameParentAs(s.sourcePosition)&&(e.howMany-=s.howMany)),e.sourcePosition=e.sourcePosition._getTransformedByMoveOperation(s),e.targetPosition=e.targetPosition._getTransformedByMoveOperation(s),e.sourcePosition.stickiness="toPrevious",e.targetPosition.stickiness="toNext",e.graveyardPosition.isEqual(s.targetPosition)||(e.graveyardPosition=e.graveyardPosition._getTransformedByMoveOperation(s)),[e])});P(N,T,(e,s,t)=>{if(s.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedByDeletion(s.graveyardPosition,1),e.deletionPosition.isEqual(s.graveyardPosition)&&(e.howMany=s.howMany)),e.targetPosition.isEqual(s.splitPosition)&&(s.graveyardPosition&&e.deletionPosition.isEqual(s.graveyardPosition)||t.abRelation=="mergeTargetNotMoved"))return e.sourcePosition=e.sourcePosition._getTransformedBySplitOperation(s),[e];if(e.sourcePosition.isEqual(s.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return e.howMany=0,e.targetPosition=e.targetPosition._getTransformedBySplitOperation(s),[e];if(t.abRelation=="mergeSameElement"||e.sourcePosition.offset>0)return e.sourcePosition=s.moveTargetPosition.clone(),e.targetPosition=e.targetPosition._getTransformedBySplitOperation(s),[e]}return e.sourcePosition.hasSameParentAs(s.splitPosition)&&(e.howMany=s.splitPosition.offset),e.sourcePosition=e.sourcePosition._getTransformedBySplitOperation(s),e.targetPosition=e.targetPosition._getTransformedBySplitOperation(s),[e]});P(A,M,(e,s)=>{const n=p._createFromPositionAndShift(e.sourcePosition,e.howMany)._getTransformedByInsertOperation(s,!1)[0];return e.sourcePosition=n.start,e.howMany=n.end.offset-n.start.offset,e.targetPosition.isEqual(s.position)||(e.targetPosition=e.targetPosition._getTransformedByInsertOperation(s)),[e]});P(A,A,(e,s,t)=>{const n=p._createFromPositionAndShift(e.sourcePosition,e.howMany),r=p._createFromPositionAndShift(s.sourcePosition,s.howMany);let i=t.aIsStrong,o=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?o=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(o=!1);let a;if(e.targetPosition.isEqual(s.targetPosition)&&o?a=e.targetPosition._getTransformedByDeletion(s.sourcePosition,s.howMany):a=e.targetPosition._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany),$n(e,s)&&$n(s,e))return[s.getReversed()];if(n.containsPosition(s.targetPosition)&&n.containsRange(r,!0))return n.start=n.start._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany),n.end=n.end._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany),wt([n],a);if(r.containsPosition(e.targetPosition)&&r.containsRange(n,!0))return n.start=n.start._getCombined(s.sourcePosition,s.getMovedRangeStart()),n.end=n.end._getCombined(s.sourcePosition,s.getMovedRangeStart()),wt([n],a);const u=B(e.sourcePosition.getParentPath(),s.sourcePosition.getParentPath());if(u=="prefix"||u=="extension")return n.start=n.start._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany),n.end=n.end._getTransformedByMove(s.sourcePosition,s.targetPosition,s.howMany),wt([n],a);e.type=="remove"&&s.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?i=!0:e.type!="remove"&&s.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(i=!1);const f=[],d=n.getDifference(r);for(const y of d){y.start=y.start._getTransformedByDeletion(s.sourcePosition,s.howMany),y.end=y.end._getTransformedByDeletion(s.sourcePosition,s.howMany);const w=B(y.start.getParentPath(),s.getMovedRangeStart().getParentPath())=="same",k=y._getTransformedByInsertion(s.getMovedRangeStart(),s.howMany,w);f.push(...k)}const m=n.getIntersection(r);return m!==null&&i&&(m.start=m.start._getCombined(s.sourcePosition,s.getMovedRangeStart()),m.end=m.end._getCombined(s.sourcePosition,s.getMovedRangeStart()),f.length===0?f.push(m):f.length==1?r.start.isBefore(n.start)||r.start.isEqual(n.start)?f.unshift(m):f.push(m):f.splice(1,0,m)),f.length===0?[new R(e.baseVersion)]:wt(f,a)});P(A,T,(e,s,t)=>{let n=e.targetPosition.clone();(!e.targetPosition.isEqual(s.insertionPosition)||!s.graveyardPosition||t.abRelation=="moveTargetAfter")&&(n=e.targetPosition._getTransformedBySplitOperation(s));const r=p._createFromPositionAndShift(e.sourcePosition,e.howMany);if(r.end.isEqual(s.insertionPosition))return s.graveyardPosition||e.howMany++,e.targetPosition=n,[e];if(r.start.hasSameParentAs(s.splitPosition)&&r.containsPosition(s.splitPosition)){let a=new p(s.splitPosition,r.end);a=a._getTransformedBySplitOperation(s);const l=[new p(r.start,s.splitPosition),a];return wt(l,n)}e.targetPosition.isEqual(s.splitPosition)&&t.abRelation=="insertAtSource"&&(n=s.moveTargetPosition),e.targetPosition.isEqual(s.insertionPosition)&&t.abRelation=="insertBetween"&&(n=e.targetPosition);const o=[r._getTransformedBySplitOperation(s)];if(s.graveyardPosition){const a=r.start.isEqual(s.graveyardPosition)||r.containsPosition(s.graveyardPosition);e.howMany>1&&a&&!t.aWasUndone&&o.push(p._createFromPositionAndShift(s.insertionPosition,1))}return wt(o,n)});P(A,N,(e,s,t)=>{const n=p._createFromPositionAndShift(e.sourcePosition,e.howMany);if(s.deletionPosition.hasSameParentAs(e.sourcePosition)&&n.containsPosition(s.sourcePosition)){if(e.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const o=[];let a=s.graveyardPosition.clone(),l=s.targetPosition._getTransformedByMergeOperation(s);const c=e.targetPosition.getTransformedByOperation(s);e.howMany>1&&(o.push(new A(e.sourcePosition,e.howMany-1,c,0)),a=a._getTransformedByMove(e.sourcePosition,c,e.howMany-1),l=l._getTransformedByMove(e.sourcePosition,c,e.howMany-1));const u=s.deletionPosition._getCombined(e.sourcePosition,c),f=new A(a,1,u,0),d=f.getMovedRangeStart().path.slice();d.push(0);const m=new _(f.targetPosition.root,d);l=l._getTransformedByMove(a,u,1);const y=new A(l,s.howMany,m,0);return o.push(f),o.push(y),o}}else if(e.howMany==1)return t.bWasUndone?(e.sourcePosition=s.graveyardPosition.clone(),e.targetPosition=e.targetPosition._getTransformedByMergeOperation(s),[e]):[new R(0)]}const i=p._createFromPositionAndShift(e.sourcePosition,e.howMany)._getTransformedByMergeOperation(s);return e.sourcePosition=i.start,e.howMany=i.end.offset-i.start.offset,e.targetPosition=e.targetPosition._getTransformedByMergeOperation(s),[e]});P(F,M,(e,s)=>(e.position=e.position._getTransformedByInsertOperation(s),[e]));P(F,N,(e,s)=>e.position.isEqual(s.deletionPosition)?(e.position=s.graveyardPosition.clone(),e.position.stickiness="toNext",[e]):(e.position=e.position._getTransformedByMergeOperation(s),[e]));P(F,A,(e,s)=>(e.position=e.position._getTransformedByMoveOperation(s),[e]));P(F,F,(e,s,t)=>{if(e.position.isEqual(s.position))if(t.aIsStrong)e.oldName=s.newName;else return[new R(0)];return[e]});P(F,T,(e,s)=>{const t=e.position.path,n=s.splitPosition.getParentPath();if(B(t,n)=="same"&&!s.graveyardPosition){const r=new F(e.position.getShiftedBy(1),e.oldName,e.newName,0);return[e,r]}return e.position=e.position._getTransformedBySplitOperation(s),[e]});P(Q,Q,(e,s,t)=>{if(e.root===s.root&&e.key===s.key){if(!t.aIsStrong||e.newValue===s.newValue)return[new R(0)];e.oldValue=s.newValue}return[e]});P(tt,tt,(e,s)=>e.rootName===s.rootName&&e.isAdd===s.isAdd?[new R(0)]:[e]);P(T,M,(e,s)=>(e.splitPosition.hasSameParentAs(s.position)&&e.splitPosition.offset<s.position.offset&&(e.howMany+=s.howMany),e.splitPosition=e.splitPosition._getTransformedByInsertOperation(s),e.insertionPosition=e.insertionPosition._getTransformedByInsertOperation(s),[e]));P(T,N,(e,s,t)=>{if(!e.graveyardPosition&&!t.bWasUndone&&e.splitPosition.hasSameParentAs(s.sourcePosition)){const n=s.graveyardPosition.path.slice();n.push(0);const r=new _(s.graveyardPosition.root,n),i=T.getInsertionPosition(new _(s.graveyardPosition.root,n)),o=new T(r,0,i,null,0);return e.splitPosition=e.splitPosition._getTransformedByMergeOperation(s),e.insertionPosition=T.getInsertionPosition(e.splitPosition),e.graveyardPosition=o.insertionPosition.clone(),e.graveyardPosition.stickiness="toNext",[o,e]}return e.splitPosition.hasSameParentAs(s.deletionPosition)&&!e.splitPosition.isAfter(s.deletionPosition)&&e.howMany--,e.splitPosition.hasSameParentAs(s.targetPosition)&&(e.howMany+=s.howMany),e.splitPosition=e.splitPosition._getTransformedByMergeOperation(s),e.insertionPosition=T.getInsertionPosition(e.splitPosition),e.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedByMergeOperation(s)),[e]});P(T,A,(e,s,t)=>{const n=p._createFromPositionAndShift(s.sourcePosition,s.howMany);if(e.graveyardPosition){const i=n.start.isEqual(e.graveyardPosition)||n.containsPosition(e.graveyardPosition);if(!t.bWasUndone&&i){const o=e.splitPosition._getTransformedByMoveOperation(s),a=e.graveyardPosition._getTransformedByMoveOperation(s),l=a.path.slice();l.push(0);const c=new _(a.root,l);return[new A(o,e.howMany,c,0)]}e.graveyardPosition=e.graveyardPosition._getTransformedByMoveOperation(s)}const r=e.splitPosition.isEqual(s.targetPosition);if(r&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return e.howMany+=s.howMany,e.splitPosition=e.splitPosition._getTransformedByDeletion(s.sourcePosition,s.howMany),e.insertionPosition=T.getInsertionPosition(e.splitPosition),[e];if(r&&t.abRelation&&t.abRelation.howMany){const{howMany:i,offset:o}=t.abRelation;return e.howMany+=i,e.splitPosition=e.splitPosition.getShiftedBy(o),[e]}if(e.splitPosition.hasSameParentAs(s.sourcePosition)&&n.containsPosition(e.splitPosition)){const i=s.howMany-(e.splitPosition.offset-s.sourcePosition.offset);return e.howMany-=i,e.splitPosition.hasSameParentAs(s.targetPosition)&&e.splitPosition.offset<s.targetPosition.offset&&(e.howMany+=s.howMany),e.splitPosition=s.sourcePosition.clone(),e.insertionPosition=T.getInsertionPosition(e.splitPosition),[e]}return s.sourcePosition.isEqual(s.targetPosition)||(e.splitPosition.hasSameParentAs(s.sourcePosition)&&e.splitPosition.offset<=s.sourcePosition.offset&&(e.howMany-=s.howMany),e.splitPosition.hasSameParentAs(s.targetPosition)&&e.splitPosition.offset<s.targetPosition.offset&&(e.howMany+=s.howMany)),e.splitPosition.stickiness="toNone",e.splitPosition=e.splitPosition._getTransformedByMoveOperation(s),e.splitPosition.stickiness="toNext",e.graveyardPosition?e.insertionPosition=e.insertionPosition._getTransformedByMoveOperation(s):e.insertionPosition=T.getInsertionPosition(e.splitPosition),[e]});P(T,T,(e,s,t)=>{if(e.splitPosition.isEqual(s.splitPosition)){if(!e.graveyardPosition&&!s.graveyardPosition)return[new R(0)];if(e.graveyardPosition&&s.graveyardPosition&&e.graveyardPosition.isEqual(s.graveyardPosition))return[new R(0)];if(t.abRelation=="splitBefore")return e.howMany=0,e.graveyardPosition=e.graveyardPosition._getTransformedBySplitOperation(s),[e]}if(e.graveyardPosition&&s.graveyardPosition&&e.graveyardPosition.isEqual(s.graveyardPosition)){const n=e.splitPosition.root.rootName=="$graveyard",r=s.splitPosition.root.rootName=="$graveyard";if(r&&!n||!(n&&!r)&&t.aIsStrong){const l=[];return s.howMany&&l.push(new A(s.moveTargetPosition,s.howMany,s.splitPosition,0)),e.howMany&&l.push(new A(e.splitPosition,e.howMany,e.moveTargetPosition,0)),l}else return[new R(0)]}if(e.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedBySplitOperation(s)),e.splitPosition.isEqual(s.insertionPosition)&&t.abRelation=="splitBefore")return e.howMany++,[e];if(s.splitPosition.isEqual(e.insertionPosition)&&t.baRelation=="splitBefore"){const n=s.insertionPosition.path.slice();n.push(0);const r=new _(s.insertionPosition.root,n),i=new A(e.insertionPosition,1,r,0);return[e,i]}return e.splitPosition.hasSameParentAs(s.splitPosition)&&e.splitPosition.offset<s.splitPosition.offset&&(e.howMany-=s.howMany),e.splitPosition=e.splitPosition._getTransformedBySplitOperation(s),e.insertionPosition=T.getInsertionPosition(e.splitPosition),[e]});function $n(e,s){return e.targetPosition._getTransformedByDeletion(s.sourcePosition,s.howMany)===null}function wt(e,s){const t=[];for(let n=0;n<e.length;n++){const r=e[n],i=new A(r.start,r.end.offset-r.start.offset,s,0);t.push(i);for(let o=n+1;o<e.length;o++)e[o]=e[o]._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany)[0];s=s._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany)}return t}class Pc extends O(_){constructor(s,t,n="toNone"){if(super(s,t,n),!this.root.is("rootElement"))throw new g("model-liveposition-root-not-rootelement",s);vc.call(this)}detach(){this.stopListening()}toPosition(){return new _(this.root,this.path.slice(),this.stickiness)}static fromPosition(s,t){return new this(s.root,s.path.slice(),t||s.stickiness)}}Pc.prototype.is=function(e){return e==="livePosition"||e==="model:livePosition"||e=="position"||e==="model:position"};function vc(){this.listenTo(this.root.document.model,"applyOperation",(e,s)=>{const t=s[0];t.isDocumentOperation&&bc.call(this,t)},{priority:"low"})}function bc(e){const s=this.getTransformedByOperation(e);if(!this.isEqual(s)){const t=this.toPosition();this.path=s.path,this.root=s.root,this.fire("change",t)}}class Ac extends K{constructor(t,n,r="main"){super(n);h(this,"rootName");h(this,"_document");h(this,"_isAttached",!0);h(this,"_isLoaded",!0);this._document=t,this.rootName=r}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}Ac.prototype.is=function(e,s){return s?s===this.name&&(e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"):e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"||e==="node"||e==="model:node"};class Sc extends O(rt){constructor(t,n,r,i){super();h(this,"name");h(this,"_managedUsingOperations");h(this,"_affectsData");h(this,"_liveRange");this.name=t,this._liveRange=this._attachLiveRange(n),this._managedUsingOperations=r,this._affectsData=i}get managedUsingOperations(){if(!this._liveRange)throw new g("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new g("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new g("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new g("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new g("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(t){return this._liveRange&&this._detachLiveRange(),t.delegate("change:range").to(this),t.delegate("change:content").to(this),this._liveRange=t,t}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}Sc.prototype.is=function(e){return e==="marker"||e==="model:marker"};class We extends rt{constructor(t){super();h(this,"markers",new Map);h(this,"_children",new Ft);t&&this._insertChild(0,t)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(t){return this._children.getNode(t)}getChildAtOffset(t){return this._children.getNodeAtOffset(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}getPath(){return[]}getNodeByPath(t){let n=this;for(const r of t)n=n.getChildAtOffset(r);return n}offsetToIndex(t){return this._children.offsetToIndex(t)}toJSON(){const t=[];for(const n of this._children)t.push(n.toJSON());return t}static fromJSON(t){const n=[];for(const r of t)r.name?n.push(K.fromJSON(r)):n.push(E.fromJSON(r));return new We(n)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,n){const r=Tc(n);for(const i of r)i.parent!==null&&i._remove(),i.parent=this;this._children._insertNodes(t,r)}_removeChildren(t,n=1){const r=this._children._removeNodes(t,n);for(const i of r)i.parent=null;return r}_removeChildrenArray(t){this._children._removeNodesArray(t);for(const n of t)n.parent=null}}We.prototype.is=function(e){return e==="documentFragment"||e==="model:documentFragment"};function Tc(e){return typeof e=="string"?[new E(e)]:(X(e)||(e=[e]),Array.from(e).map(s=>typeof s=="string"?new E(s):s instanceof ut?new E(s.data,s.getAttributes()):s))}var we,Ln;function $s(){return Ln||(Ln=1,we={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),we}$s();var Pe,Dn;function Ls(){if(Dn)return Pe;Dn=1;const e=$s(),s={};for(const r of Object.keys(e))s[e[r]]=r;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Pe=t;for(const r of Object.keys(t)){if(!("channels"in t[r]))throw new Error("missing channels property: "+r);if(!("labels"in t[r]))throw new Error("missing channel labels property: "+r);if(t[r].labels.length!==t[r].channels)throw new Error("channel and label counts mismatch: "+r);const{channels:i,labels:o}=t[r];delete t[r].channels,delete t[r].labels,Object.defineProperty(t[r],"channels",{value:i}),Object.defineProperty(t[r],"labels",{value:o})}t.rgb.hsl=function(r){const i=r[0]/255,o=r[1]/255,a=r[2]/255,l=Math.min(i,o,a),c=Math.max(i,o,a),u=c-l;let f,d;c===l?f=0:i===c?f=(o-a)/u:o===c?f=2+(a-i)/u:a===c&&(f=4+(i-o)/u),f=Math.min(f*60,360),f<0&&(f+=360);const m=(l+c)/2;return c===l?d=0:m<=.5?d=u/(c+l):d=u/(2-c-l),[f,d*100,m*100]},t.rgb.hsv=function(r){let i,o,a,l,c;const u=r[0]/255,f=r[1]/255,d=r[2]/255,m=Math.max(u,f,d),y=m-Math.min(u,f,d),w=function(k){return(m-k)/6/y+1/2};return y===0?(l=0,c=0):(c=y/m,i=w(u),o=w(f),a=w(d),u===m?l=a-o:f===m?l=1/3+i-a:d===m&&(l=2/3+o-i),l<0?l+=1:l>1&&(l-=1)),[l*360,c*100,m*100]},t.rgb.hwb=function(r){const i=r[0],o=r[1];let a=r[2];const l=t.rgb.hsl(r)[0],c=1/255*Math.min(i,Math.min(o,a));return a=1-1/255*Math.max(i,Math.max(o,a)),[l,c*100,a*100]},t.rgb.cmyk=function(r){const i=r[0]/255,o=r[1]/255,a=r[2]/255,l=Math.min(1-i,1-o,1-a),c=(1-i-l)/(1-l)||0,u=(1-o-l)/(1-l)||0,f=(1-a-l)/(1-l)||0;return[c*100,u*100,f*100,l*100]};function n(r,i){return(r[0]-i[0])**2+(r[1]-i[1])**2+(r[2]-i[2])**2}return t.rgb.keyword=function(r){const i=s[r];if(i)return i;let o=1/0,a;for(const l of Object.keys(e)){const c=e[l],u=n(r,c);u<o&&(o=u,a=l)}return a},t.keyword.rgb=function(r){return e[r]},t.rgb.xyz=function(r){let i=r[0]/255,o=r[1]/255,a=r[2]/255;i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,a=a>.04045?((a+.055)/1.055)**2.4:a/12.92;const l=i*.4124+o*.3576+a*.1805,c=i*.2126+o*.7152+a*.0722,u=i*.0193+o*.1192+a*.9505;return[l*100,c*100,u*100]},t.rgb.lab=function(r){const i=t.rgb.xyz(r);let o=i[0],a=i[1],l=i[2];o/=95.047,a/=100,l/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,a=a>.008856?a**(1/3):7.787*a+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;const c=116*a-16,u=500*(o-a),f=200*(a-l);return[c,u,f]},t.hsl.rgb=function(r){const i=r[0]/360,o=r[1]/100,a=r[2]/100;let l,c,u;if(o===0)return u=a*255,[u,u,u];a<.5?l=a*(1+o):l=a+o-a*o;const f=2*a-l,d=[0,0,0];for(let m=0;m<3;m++)c=i+1/3*-(m-1),c<0&&c++,c>1&&c--,6*c<1?u=f+(l-f)*6*c:2*c<1?u=l:3*c<2?u=f+(l-f)*(2/3-c)*6:u=f,d[m]=u*255;return d},t.hsl.hsv=function(r){const i=r[0];let o=r[1]/100,a=r[2]/100,l=o;const c=Math.max(a,.01);a*=2,o*=a<=1?a:2-a,l*=c<=1?c:2-c;const u=(a+o)/2,f=a===0?2*l/(c+l):2*o/(a+o);return[i,f*100,u*100]},t.hsv.rgb=function(r){const i=r[0]/60,o=r[1]/100;let a=r[2]/100;const l=Math.floor(i)%6,c=i-Math.floor(i),u=255*a*(1-o),f=255*a*(1-o*c),d=255*a*(1-o*(1-c));switch(a*=255,l){case 0:return[a,d,u];case 1:return[f,a,u];case 2:return[u,a,d];case 3:return[u,f,a];case 4:return[d,u,a];case 5:return[a,u,f]}},t.hsv.hsl=function(r){const i=r[0],o=r[1]/100,a=r[2]/100,l=Math.max(a,.01);let c,u;u=(2-o)*a;const f=(2-o)*l;return c=o*l,c/=f<=1?f:2-f,c=c||0,u/=2,[i,c*100,u*100]},t.hwb.rgb=function(r){const i=r[0]/360;let o=r[1]/100,a=r[2]/100;const l=o+a;let c;l>1&&(o/=l,a/=l);const u=Math.floor(6*i),f=1-a;c=6*i-u,(u&1)!==0&&(c=1-c);const d=o+c*(f-o);let m,y,w;switch(u){default:case 6:case 0:m=f,y=d,w=o;break;case 1:m=d,y=f,w=o;break;case 2:m=o,y=f,w=d;break;case 3:m=o,y=d,w=f;break;case 4:m=d,y=o,w=f;break;case 5:m=f,y=o,w=d;break}return[m*255,y*255,w*255]},t.cmyk.rgb=function(r){const i=r[0]/100,o=r[1]/100,a=r[2]/100,l=r[3]/100,c=1-Math.min(1,i*(1-l)+l),u=1-Math.min(1,o*(1-l)+l),f=1-Math.min(1,a*(1-l)+l);return[c*255,u*255,f*255]},t.xyz.rgb=function(r){const i=r[0]/100,o=r[1]/100,a=r[2]/100;let l,c,u;return l=i*3.2406+o*-1.5372+a*-.4986,c=i*-.9689+o*1.8758+a*.0415,u=i*.0557+o*-.204+a*1.057,l=l>.0031308?1.055*l**(1/2.4)-.055:l*12.92,c=c>.0031308?1.055*c**(1/2.4)-.055:c*12.92,u=u>.0031308?1.055*u**(1/2.4)-.055:u*12.92,l=Math.min(Math.max(0,l),1),c=Math.min(Math.max(0,c),1),u=Math.min(Math.max(0,u),1),[l*255,c*255,u*255]},t.xyz.lab=function(r){let i=r[0],o=r[1],a=r[2];i/=95.047,o/=100,a/=108.883,i=i>.008856?i**(1/3):7.787*i+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;const l=116*o-16,c=500*(i-o),u=200*(o-a);return[l,c,u]},t.lab.xyz=function(r){const i=r[0],o=r[1],a=r[2];let l,c,u;c=(i+16)/116,l=o/500+c,u=c-a/200;const f=c**3,d=l**3,m=u**3;return c=f>.008856?f:(c-16/116)/7.787,l=d>.008856?d:(l-16/116)/7.787,u=m>.008856?m:(u-16/116)/7.787,l*=95.047,c*=100,u*=108.883,[l,c,u]},t.lab.lch=function(r){const i=r[0],o=r[1],a=r[2];let l;l=Math.atan2(a,o)*360/2/Math.PI,l<0&&(l+=360);const u=Math.sqrt(o*o+a*a);return[i,u,l]},t.lch.lab=function(r){const i=r[0],o=r[1],l=r[2]/360*2*Math.PI,c=o*Math.cos(l),u=o*Math.sin(l);return[i,c,u]},t.rgb.ansi16=function(r,i=null){const[o,a,l]=r;let c=i===null?t.rgb.hsv(r)[2]:i;if(c=Math.round(c/50),c===0)return 30;let u=30+(Math.round(l/255)<<2|Math.round(a/255)<<1|Math.round(o/255));return c===2&&(u+=60),u},t.hsv.ansi16=function(r){return t.rgb.ansi16(t.hsv.rgb(r),r[2])},t.rgb.ansi256=function(r){const i=r[0],o=r[1],a=r[2];return i===o&&o===a?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(o/255*5)+Math.round(a/255*5)},t.ansi16.rgb=function(r){let i=r%10;if(i===0||i===7)return r>50&&(i+=3.5),i=i/10.5*255,[i,i,i];const o=(~~(r>50)+1)*.5,a=(i&1)*o*255,l=(i>>1&1)*o*255,c=(i>>2&1)*o*255;return[a,l,c]},t.ansi256.rgb=function(r){if(r>=232){const c=(r-232)*10+8;return[c,c,c]}r-=16;let i;const o=Math.floor(r/36)/5*255,a=Math.floor((i=r%36)/6)/5*255,l=i%6/5*255;return[o,a,l]},t.rgb.hex=function(r){const o=(((Math.round(r[0])&255)<<16)+((Math.round(r[1])&255)<<8)+(Math.round(r[2])&255)).toString(16).toUpperCase();return"000000".substring(o.length)+o},t.hex.rgb=function(r){const i=r.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];let o=i[0];i[0].length===3&&(o=o.split("").map(f=>f+f).join(""));const a=parseInt(o,16),l=a>>16&255,c=a>>8&255,u=a&255;return[l,c,u]},t.rgb.hcg=function(r){const i=r[0]/255,o=r[1]/255,a=r[2]/255,l=Math.max(Math.max(i,o),a),c=Math.min(Math.min(i,o),a),u=l-c;let f,d;return u<1?f=c/(1-u):f=0,u<=0?d=0:l===i?d=(o-a)/u%6:l===o?d=2+(a-i)/u:d=4+(i-o)/u,d/=6,d%=1,[d*360,u*100,f*100]},t.hsl.hcg=function(r){const i=r[1]/100,o=r[2]/100,a=o<.5?2*i*o:2*i*(1-o);let l=0;return a<1&&(l=(o-.5*a)/(1-a)),[r[0],a*100,l*100]},t.hsv.hcg=function(r){const i=r[1]/100,o=r[2]/100,a=i*o;let l=0;return a<1&&(l=(o-a)/(1-a)),[r[0],a*100,l*100]},t.hcg.rgb=function(r){const i=r[0]/360,o=r[1]/100,a=r[2]/100;if(o===0)return[a*255,a*255,a*255];const l=[0,0,0],c=i%1*6,u=c%1,f=1-u;let d=0;switch(Math.floor(c)){case 0:l[0]=1,l[1]=u,l[2]=0;break;case 1:l[0]=f,l[1]=1,l[2]=0;break;case 2:l[0]=0,l[1]=1,l[2]=u;break;case 3:l[0]=0,l[1]=f,l[2]=1;break;case 4:l[0]=u,l[1]=0,l[2]=1;break;default:l[0]=1,l[1]=0,l[2]=f}return d=(1-o)*a,[(o*l[0]+d)*255,(o*l[1]+d)*255,(o*l[2]+d)*255]},t.hcg.hsv=function(r){const i=r[1]/100,o=r[2]/100,a=i+o*(1-i);let l=0;return a>0&&(l=i/a),[r[0],l*100,a*100]},t.hcg.hsl=function(r){const i=r[1]/100,a=r[2]/100*(1-i)+.5*i;let l=0;return a>0&&a<.5?l=i/(2*a):a>=.5&&a<1&&(l=i/(2*(1-a))),[r[0],l*100,a*100]},t.hcg.hwb=function(r){const i=r[1]/100,o=r[2]/100,a=i+o*(1-i);return[r[0],(a-i)*100,(1-a)*100]},t.hwb.hcg=function(r){const i=r[1]/100,a=1-r[2]/100,l=a-i;let c=0;return l<1&&(c=(a-l)/(1-l)),[r[0],l*100,c*100]},t.apple.rgb=function(r){return[r[0]/65535*255,r[1]/65535*255,r[2]/65535*255]},t.rgb.apple=function(r){return[r[0]/255*65535,r[1]/255*65535,r[2]/255*65535]},t.gray.rgb=function(r){return[r[0]/100*255,r[0]/100*255,r[0]/100*255]},t.gray.hsl=function(r){return[0,0,r[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(r){return[0,100,r[0]]},t.gray.cmyk=function(r){return[0,0,0,r[0]]},t.gray.lab=function(r){return[r[0],0,0]},t.gray.hex=function(r){const i=Math.round(r[0]/100*255)&255,a=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(a.length)+a},t.rgb.gray=function(r){return[(r[0]+r[1]+r[2])/3/255*100]},Pe}var ve,Vn;function Ec(){if(Vn)return ve;Vn=1;const e=Ls();function s(){const i={},o=Object.keys(e);for(let a=o.length,l=0;l<a;l++)i[o[l]]={distance:-1,parent:null};return i}function t(i){const o=s(),a=[i];for(o[i].distance=0;a.length;){const l=a.pop(),c=Object.keys(e[l]);for(let u=c.length,f=0;f<u;f++){const d=c[f],m=o[d];m.distance===-1&&(m.distance=o[l].distance+1,m.parent=l,a.unshift(d))}}return o}function n(i,o){return function(a){return o(i(a))}}function r(i,o){const a=[o[i].parent,i];let l=e[o[i].parent][i],c=o[i].parent;for(;o[c].parent;)a.unshift(o[c].parent),l=n(e[o[c].parent][c],l),c=o[c].parent;return l.conversion=a,l}return ve=function(i){const o=t(i),a={},l=Object.keys(o);for(let c=l.length,u=0;u<c;u++){const f=l[u];o[f].parent!==null&&(a[f]=r(f,o))}return a},ve}var be,qn;function xc(){if(qn)return be;qn=1;const e=Ls(),s=Ec(),t={},n=Object.keys(e);function r(o){const a=function(...l){const c=l[0];return c==null?c:(c.length>1&&(l=c),o(l))};return"conversion"in o&&(a.conversion=o.conversion),a}function i(o){const a=function(...l){const c=l[0];if(c==null)return c;c.length>1&&(l=c);const u=o(l);if(typeof u=="object")for(let f=u.length,d=0;d<f;d++)u[d]=Math.round(u[d]);return u};return"conversion"in o&&(a.conversion=o.conversion),a}return n.forEach(o=>{t[o]={},Object.defineProperty(t[o],"channels",{value:e[o].channels}),Object.defineProperty(t[o],"labels",{value:e[o].labels});const a=s(o);Object.keys(a).forEach(c=>{const u=a[c];t[o][c]=i(u),t[o][c].raw=r(u)})}),be=t,be}xc();/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */var Oc='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';new DOMParser().parseFromString(Oc,"image/svg+xml").firstChild;/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Rc=[{listStyle:"disc",typeAttribute:"disc",listType:"bulleted"},{listStyle:"circle",typeAttribute:"circle",listType:"bulleted"},{listStyle:"square",typeAttribute:"square",listType:"bulleted"},{listStyle:"decimal",typeAttribute:"1",listType:"numbered"},{listStyle:"decimal-leading-zero",typeAttribute:null,listType:"numbered"},{listStyle:"lower-roman",typeAttribute:"i",listType:"numbered"},{listStyle:"upper-roman",typeAttribute:"I",listType:"numbered"},{listStyle:"lower-alpha",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-alpha",typeAttribute:"A",listType:"numbered"},{listStyle:"lower-latin",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-latin",typeAttribute:"A",listType:"numbered"}];for(const{listStyle:e,typeAttribute:s,listType:t}of Rc);/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Nt.arrowup,Nt.arrowdown,Nt.esc;Nt.enter,Nt.tab;window.CKEDITOR.editorConfig=function(e){e.contentsLangDirection="rtl",e.language="fa",e.filebrowserImageUploadUrl="/file-upload",e.toolbar="MyToolbar",e.toolbar_MyToolbar=[{name:"document",items:["Source","-","Save","NewPage","DocProps","Preview","Print","-","Templates"]},{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","SpellChecker","Scayt"]},{name:"forms",items:["Form","Checkbox","Radio","TextField","Textarea","Select","Button","ImageButton","HiddenField"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"colors",items:["TextColor","BGColor"]},"/",{name:"insert",items:["Image","Flash","Table","HorizontalRule","Smiley","SpecialChar","PageBreak","Iframe"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl"]},{name:"styles",items:["Styles","Format","Font","FontSize"]}]};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2tlZGl0b3IuY2pzIiwic291cmNlcyI6WyIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZnJlZUdsb2JhbC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19yb290LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX1N5bWJvbC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRSYXdUYWcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fb2JqZWN0VG9TdHJpbmcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUdldFRhZy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzT2JqZWN0TGlrZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzU3ltYm9sLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2FycmF5TWFwLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNBcnJheS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlVG9TdHJpbmcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9pc09iamVjdC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzRnVuY3Rpb24uanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fY29yZUpzRGF0YS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19pc01hc2tlZC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL190b1NvdXJjZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlSXNOYXRpdmUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZ2V0VmFsdWUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZ2V0TmF0aXZlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX1dlYWtNYXAuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUNyZWF0ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19jb3B5QXJyYXkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZGVmaW5lUHJvcGVydHkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYXJyYXlFYWNoLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2lzSW5kZXguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUFzc2lnblZhbHVlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvZXEuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYXNzaWduVmFsdWUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fY29weU9iamVjdC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzTGVuZ3RoLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNBcnJheUxpa2UuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9faXNQcm90b3R5cGUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZVRpbWVzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VJc0FyZ3VtZW50cy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzQXJndW1lbnRzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvc3R1YkZhbHNlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNCdWZmZXIuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUlzVHlwZWRBcnJheS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlVW5hcnkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fbm9kZVV0aWwuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9pc1R5cGVkQXJyYXkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYXJyYXlMaWtlS2V5cy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19vdmVyQXJnLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX25hdGl2ZUtleXMuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUtleXMuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9rZXlzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX25hdGl2ZUtleXNJbi5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlS2V5c0luLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMva2V5c0luLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2lzS2V5LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX25hdGl2ZUNyZWF0ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19oYXNoQ2xlYXIuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9faGFzaERlbGV0ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19oYXNoR2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2hhc2hIYXMuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9faGFzaFNldC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19IYXNoLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2xpc3RDYWNoZUNsZWFyLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Fzc29jSW5kZXhPZi5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19saXN0Q2FjaGVEZWxldGUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fbGlzdENhY2hlR2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2xpc3RDYWNoZUhhcy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19saXN0Q2FjaGVTZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fTGlzdENhY2hlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX01hcC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19tYXBDYWNoZUNsZWFyLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2lzS2V5YWJsZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRNYXBEYXRhLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX21hcENhY2hlRGVsZXRlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX21hcENhY2hlR2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX21hcENhY2hlSGFzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX21hcENhY2hlU2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX01hcENhY2hlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvbWVtb2l6ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19tZW1vaXplQ2FwcGVkLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX3N0cmluZ1RvUGF0aC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL3RvU3RyaW5nLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Nhc3RQYXRoLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX3RvS2V5LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VHZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9nZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYXJyYXlQdXNoLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldFByb3RvdHlwZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlU2xpY2UuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fc3RhY2tDbGVhci5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19zdGFja0RlbGV0ZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19zdGFja0dldC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19zdGFja0hhcy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19zdGFja1NldC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19TdGFjay5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlQXNzaWduLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VBc3NpZ25Jbi5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19jbG9uZUJ1ZmZlci5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19hcnJheUZpbHRlci5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL3N0dWJBcnJheS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19nZXRTeW1ib2xzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2NvcHlTeW1ib2xzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldFN5bWJvbHNJbi5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19jb3B5U3ltYm9sc0luLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Jhc2VHZXRBbGxLZXlzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2dldEFsbEtleXMuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fRGF0YVZpZXcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fUHJvbWlzZS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19TZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fZ2V0VGFnLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2luaXRDbG9uZUFycmF5LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX1VpbnQ4QXJyYXkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fY2xvbmVBcnJheUJ1ZmZlci5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19jbG9uZURhdGFWaWV3LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Nsb25lUmVnRXhwLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Nsb25lU3ltYm9sLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2Nsb25lVHlwZWRBcnJheS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19pbml0Q2xvbmVCeVRhZy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19pbml0Q2xvbmVPYmplY3QuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUlzTWFwLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNNYXAuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUlzU2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvaXNTZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUNsb25lLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvY2xvbmUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fc2V0Q2FjaGVBZGQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fc2V0Q2FjaGVIYXMuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fU2V0Q2FjaGUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYXJyYXlTb21lLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2NhY2hlSGFzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2VxdWFsQXJyYXlzLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX21hcFRvQXJyYXkuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fc2V0VG9BcnJheS5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19lcXVhbEJ5VGFnLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX2VxdWFsT2JqZWN0cy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL19iYXNlSXNFcXVhbERlZXAuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZUlzRXF1YWwuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9sYXN0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvX3BhcmVudC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9sb2Rhc2gtZXNANC4xNy4yMS9ub2RlX21vZHVsZXMvbG9kYXNoLWVzL2lzRXF1YWwuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vbG9kYXNoLWVzQDQuMTcuMjEvbm9kZV9tb2R1bGVzL2xvZGFzaC1lcy9fYmFzZVVuc2V0LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2xvZGFzaC1lc0A0LjE3LjIxL25vZGVfbW9kdWxlcy9sb2Rhc2gtZXMvdW5zZXQuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGNrZWRpdG9yK2NrZWRpdG9yNS11dGlsc0A0NC4zLjAvbm9kZV9tb2R1bGVzL0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvZGlzdC9pbmRleC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AY2tlZGl0b3IrY2tlZGl0b3I1LWVuZ2luZUA0NC4zLjAvbm9kZV9tb2R1bGVzL0Bja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2Rpc3QvaW5kZXguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vY29sb3ItbmFtZUAxLjEuNC9ub2RlX21vZHVsZXMvY29sb3ItbmFtZS9pbmRleC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9jb2xvci1jb252ZXJ0QDIuMC4xL25vZGVfbW9kdWxlcy9jb2xvci1jb252ZXJ0L2NvbnZlcnNpb25zLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2NvbG9yLWNvbnZlcnRAMi4wLjEvbm9kZV9tb2R1bGVzL2NvbG9yLWNvbnZlcnQvcm91dGUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vY29sb3ItY29udmVydEAyLjAuMS9ub2RlX21vZHVsZXMvY29sb3ItY29udmVydC9pbmRleC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AY2tlZGl0b3IrY2tlZGl0b3I1LXdpZGdldEA0NC4zLjAvbm9kZV9tb2R1bGVzL0Bja2VkaXRvci9ja2VkaXRvcjUtd2lkZ2V0L2Rpc3QvaW5kZXguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGNrZWRpdG9yK2NrZWRpdG9yNS1saXN0QDQ0LjMuMC9ub2RlX21vZHVsZXMvQGNrZWRpdG9yL2NrZWRpdG9yNS1saXN0L2Rpc3QvaW5kZXguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGNrZWRpdG9yK2NrZWRpdG9yNS1tZW50aW9uQDQ0LjMuMC9ub2RlX21vZHVsZXMvQGNrZWRpdG9yL2NrZWRpdG9yNS1tZW50aW9uL2Rpc3QvaW5kZXguanMiLCIuLi8uLi9zb3VyY2UvY2tlZGl0b3IvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi9cbnZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDtcblxuZXhwb3J0IGRlZmF1bHQgZnJlZUdsb2JhbDtcbiIsImltcG9ydCBmcmVlR2xvYmFsIGZyb20gJy4vX2ZyZWVHbG9iYWwuanMnO1xuXG4vKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqL1xudmFyIGZyZWVTZWxmID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7XG5cbi8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqL1xudmFyIHJvb3QgPSBmcmVlR2xvYmFsIHx8IGZyZWVTZWxmIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvb3Q7XG4iLCJpbXBvcnQgcm9vdCBmcm9tICcuL19yb290LmpzJztcblxuLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovXG52YXIgU3ltYm9sID0gcm9vdC5TeW1ib2w7XG5cbmV4cG9ydCBkZWZhdWx0IFN5bWJvbDtcbiIsImltcG9ydCBTeW1ib2wgZnJvbSAnLi9fU3ltYm9sLmpzJztcblxuLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqXG4gKiBVc2VkIHRvIHJlc29sdmUgdGhlXG4gKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZylcbiAqIG9mIHZhbHVlcy5cbiAqL1xudmFyIG5hdGl2ZU9iamVjdFRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7XG5cbi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqL1xudmFyIHN5bVRvU3RyaW5nVGFnID0gU3ltYm9sID8gU3ltYm9sLnRvU3RyaW5nVGFnIDogdW5kZWZpbmVkO1xuXG4vKipcbiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUdldFRhZ2Agd2hpY2ggaWdub3JlcyBgU3ltYm9sLnRvU3RyaW5nVGFnYCB2YWx1ZXMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LlxuICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgcmF3IGB0b1N0cmluZ1RhZ2AuXG4gKi9cbmZ1bmN0aW9uIGdldFJhd1RhZyh2YWx1ZSkge1xuICB2YXIgaXNPd24gPSBoYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyksXG4gICAgICB0YWcgPSB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ107XG5cbiAgdHJ5IHtcbiAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ10gPSB1bmRlZmluZWQ7XG4gICAgdmFyIHVubWFza2VkID0gdHJ1ZTtcbiAgfSBjYXRjaCAoZSkge31cblxuICB2YXIgcmVzdWx0ID0gbmF0aXZlT2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSk7XG4gIGlmICh1bm1hc2tlZCkge1xuICAgIGlmIChpc093bikge1xuICAgICAgdmFsdWVbc3ltVG9TdHJpbmdUYWddID0gdGFnO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgdmFsdWVbc3ltVG9TdHJpbmdUYWddO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBnZXRSYXdUYWc7XG4iLCIvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovXG52YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGVcbiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKVxuICogb2YgdmFsdWVzLlxuICovXG52YXIgbmF0aXZlT2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZztcblxuLyoqXG4gKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nIHVzaW5nIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuXG4gKi9cbmZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKHZhbHVlKSB7XG4gIHJldHVybiBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgb2JqZWN0VG9TdHJpbmc7XG4iLCJpbXBvcnQgU3ltYm9sIGZyb20gJy4vX1N5bWJvbC5qcyc7XG5pbXBvcnQgZ2V0UmF3VGFnIGZyb20gJy4vX2dldFJhd1RhZy5qcyc7XG5pbXBvcnQgb2JqZWN0VG9TdHJpbmcgZnJvbSAnLi9fb2JqZWN0VG9TdHJpbmcuanMnO1xuXG4vKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovXG52YXIgbnVsbFRhZyA9ICdbb2JqZWN0IE51bGxdJyxcbiAgICB1bmRlZmluZWRUYWcgPSAnW29iamVjdCBVbmRlZmluZWRdJztcblxuLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovXG52YXIgc3ltVG9TdHJpbmdUYWcgPSBTeW1ib2wgPyBTeW1ib2wudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldFRhZ2Agd2l0aG91dCBmYWxsYmFja3MgZm9yIGJ1Z2d5IGVudmlyb25tZW50cy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLlxuICovXG5mdW5jdGlvbiBiYXNlR2V0VGFnKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnO1xuICB9XG4gIHJldHVybiAoc3ltVG9TdHJpbmdUYWcgJiYgc3ltVG9TdHJpbmdUYWcgaW4gT2JqZWN0KHZhbHVlKSlcbiAgICA/IGdldFJhd1RhZyh2YWx1ZSlcbiAgICA6IG9iamVjdFRvU3RyaW5nKHZhbHVlKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUdldFRhZztcbiIsIi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgXG4gKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mIFwib2JqZWN0XCIuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc09iamVjdExpa2Uoe30pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdExpa2UoXy5ub29wKTtcbiAqIC8vID0+IGZhbHNlXG4gKlxuICogXy5pc09iamVjdExpa2UobnVsbCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnO1xufVxuXG5leHBvcnQgZGVmYXVsdCBpc09iamVjdExpa2U7XG4iLCJpbXBvcnQgYmFzZUdldFRhZyBmcm9tICcuL19iYXNlR2V0VGFnLmpzJztcbmltcG9ydCBpc09iamVjdExpa2UgZnJvbSAnLi9pc09iamVjdExpa2UuanMnO1xuXG4vKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovXG52YXIgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXSc7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTeW1ib2xgIHByaW1pdGl2ZSBvciBvYmplY3QuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzeW1ib2wsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNTeW1ib2woJ2FiYycpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNTeW1ib2wodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnc3ltYm9sJyB8fFxuICAgIChpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IHN5bWJvbFRhZyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGlzU3ltYm9sO1xuIiwiLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ubWFwYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWVcbiAqIHNob3J0aGFuZHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBtYXBwZWQgYXJyYXkuXG4gKi9cbmZ1bmN0aW9uIGFycmF5TWFwKGFycmF5LCBpdGVyYXRlZSkge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoLFxuICAgICAgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcblxuICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXJyYXlNYXA7XG4iLCIvKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAwLjEuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXksIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc0FycmF5KFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc0FycmF5KGRvY3VtZW50LmJvZHkuY2hpbGRyZW4pO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmlzQXJyYXkoJ2FiYycpO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmlzQXJyYXkoXy5ub29wKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbnZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheTtcblxuZXhwb3J0IGRlZmF1bHQgaXNBcnJheTtcbiIsImltcG9ydCBTeW1ib2wgZnJvbSAnLi9fU3ltYm9sLmpzJztcbmltcG9ydCBhcnJheU1hcCBmcm9tICcuL19hcnJheU1hcC5qcyc7XG5pbXBvcnQgaXNBcnJheSBmcm9tICcuL2lzQXJyYXkuanMnO1xuaW1wb3J0IGlzU3ltYm9sIGZyb20gJy4vaXNTeW1ib2wuanMnO1xuXG4vKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB2YXJpb3VzIGBOdW1iZXJgIGNvbnN0YW50cy4gKi9cbnZhciBJTkZJTklUWSA9IDEgLyAwO1xuXG4vKiogVXNlZCB0byBjb252ZXJ0IHN5bWJvbHMgdG8gcHJpbWl0aXZlcyBhbmQgc3RyaW5ncy4gKi9cbnZhciBzeW1ib2xQcm90byA9IFN5bWJvbCA/IFN5bWJvbC5wcm90b3R5cGUgOiB1bmRlZmluZWQsXG4gICAgc3ltYm9sVG9TdHJpbmcgPSBzeW1ib2xQcm90byA/IHN5bWJvbFByb3RvLnRvU3RyaW5nIDogdW5kZWZpbmVkO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRvU3RyaW5nYCB3aGljaCBkb2Vzbid0IGNvbnZlcnQgbnVsbGlzaFxuICogdmFsdWVzIHRvIGVtcHR5IHN0cmluZ3MuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzdHJpbmcuXG4gKi9cbmZ1bmN0aW9uIGJhc2VUb1N0cmluZyh2YWx1ZSkge1xuICAvLyBFeGl0IGVhcmx5IGZvciBzdHJpbmdzIHRvIGF2b2lkIGEgcGVyZm9ybWFuY2UgaGl0IGluIHNvbWUgZW52aXJvbm1lbnRzLlxuICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmIChpc0FycmF5KHZhbHVlKSkge1xuICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbnZlcnQgdmFsdWVzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgcmV0dXJuIGFycmF5TWFwKHZhbHVlLCBiYXNlVG9TdHJpbmcpICsgJyc7XG4gIH1cbiAgaWYgKGlzU3ltYm9sKHZhbHVlKSkge1xuICAgIHJldHVybiBzeW1ib2xUb1N0cmluZyA/IHN5bWJvbFRvU3RyaW5nLmNhbGwodmFsdWUpIDogJyc7XG4gIH1cbiAgdmFyIHJlc3VsdCA9ICh2YWx1ZSArICcnKTtcbiAgcmV0dXJuIChyZXN1bHQgPT0gJzAnICYmICgxIC8gdmFsdWUpID09IC1JTkZJTklUWSkgPyAnLTAnIDogcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlVG9TdHJpbmc7XG4iLCIvKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHRoZVxuICogW2xhbmd1YWdlIHR5cGVdKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1lY21hc2NyaXB0LWxhbmd1YWdlLXR5cGVzKVxuICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKVxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgMC4xLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIG9iamVjdCwgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLmlzT2JqZWN0KHt9KTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzT2JqZWN0KFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdChfLm5vb3ApO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3QobnVsbCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkge1xuICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNPYmplY3Q7XG4iLCJpbXBvcnQgYmFzZUdldFRhZyBmcm9tICcuL19iYXNlR2V0VGFnLmpzJztcbmltcG9ydCBpc09iamVjdCBmcm9tICcuL2lzT2JqZWN0LmpzJztcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGFzeW5jVGFnID0gJ1tvYmplY3QgQXN5bmNGdW5jdGlvbl0nLFxuICAgIGZ1bmNUYWcgPSAnW29iamVjdCBGdW5jdGlvbl0nLFxuICAgIGdlblRhZyA9ICdbb2JqZWN0IEdlbmVyYXRvckZ1bmN0aW9uXScsXG4gICAgcHJveHlUYWcgPSAnW29iamVjdCBQcm94eV0nO1xuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRnVuY3Rpb25gIG9iamVjdC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGZ1bmN0aW9uLCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8uaXNGdW5jdGlvbihfKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzRnVuY3Rpb24oL2FiYy8pO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZSkge1xuICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICAvLyBUaGUgdXNlIG9mIGBPYmplY3QjdG9TdHJpbmdgIGF2b2lkcyBpc3N1ZXMgd2l0aCB0aGUgYHR5cGVvZmAgb3BlcmF0b3JcbiAgLy8gaW4gU2FmYXJpIDkgd2hpY2ggcmV0dXJucyAnb2JqZWN0JyBmb3IgdHlwZWQgYXJyYXlzIGFuZCBvdGhlciBjb25zdHJ1Y3RvcnMuXG4gIHZhciB0YWcgPSBiYXNlR2V0VGFnKHZhbHVlKTtcbiAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWcgfHwgdGFnID09IGFzeW5jVGFnIHx8IHRhZyA9PSBwcm94eVRhZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNGdW5jdGlvbjtcbiIsImltcG9ydCByb290IGZyb20gJy4vX3Jvb3QuanMnO1xuXG4vKiogVXNlZCB0byBkZXRlY3Qgb3ZlcnJlYWNoaW5nIGNvcmUtanMgc2hpbXMuICovXG52YXIgY29yZUpzRGF0YSA9IHJvb3RbJ19fY29yZS1qc19zaGFyZWRfXyddO1xuXG5leHBvcnQgZGVmYXVsdCBjb3JlSnNEYXRhO1xuIiwiaW1wb3J0IGNvcmVKc0RhdGEgZnJvbSAnLi9fY29yZUpzRGF0YS5qcyc7XG5cbi8qKiBVc2VkIHRvIGRldGVjdCBtZXRob2RzIG1hc3F1ZXJhZGluZyBhcyBuYXRpdmUuICovXG52YXIgbWFza1NyY0tleSA9IChmdW5jdGlvbigpIHtcbiAgdmFyIHVpZCA9IC9bXi5dKyQvLmV4ZWMoY29yZUpzRGF0YSAmJiBjb3JlSnNEYXRhLmtleXMgJiYgY29yZUpzRGF0YS5rZXlzLklFX1BST1RPIHx8ICcnKTtcbiAgcmV0dXJuIHVpZCA/ICgnU3ltYm9sKHNyYylfMS4nICsgdWlkKSA6ICcnO1xufSgpKTtcblxuLyoqXG4gKiBDaGVja3MgaWYgYGZ1bmNgIGhhcyBpdHMgc291cmNlIG1hc2tlZC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGZ1bmNgIGlzIG1hc2tlZCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBpc01hc2tlZChmdW5jKSB7XG4gIHJldHVybiAhIW1hc2tTcmNLZXkgJiYgKG1hc2tTcmNLZXkgaW4gZnVuYyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGlzTWFza2VkO1xuIiwiLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqL1xudmFyIGZ1bmNUb1N0cmluZyA9IGZ1bmNQcm90by50b1N0cmluZztcblxuLyoqXG4gKiBDb252ZXJ0cyBgZnVuY2AgdG8gaXRzIHNvdXJjZSBjb2RlLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjb252ZXJ0LlxuICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc291cmNlIGNvZGUuXG4gKi9cbmZ1bmN0aW9uIHRvU291cmNlKGZ1bmMpIHtcbiAgaWYgKGZ1bmMgIT0gbnVsbCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZnVuY1RvU3RyaW5nLmNhbGwoZnVuYyk7XG4gICAgfSBjYXRjaCAoZSkge31cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIChmdW5jICsgJycpO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG4gIH1cbiAgcmV0dXJuICcnO1xufVxuXG5leHBvcnQgZGVmYXVsdCB0b1NvdXJjZTtcbiIsImltcG9ydCBpc0Z1bmN0aW9uIGZyb20gJy4vaXNGdW5jdGlvbi5qcyc7XG5pbXBvcnQgaXNNYXNrZWQgZnJvbSAnLi9faXNNYXNrZWQuanMnO1xuaW1wb3J0IGlzT2JqZWN0IGZyb20gJy4vaXNPYmplY3QuanMnO1xuaW1wb3J0IHRvU291cmNlIGZyb20gJy4vX3RvU291cmNlLmpzJztcblxuLyoqXG4gKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgXG4gKiBbc3ludGF4IGNoYXJhY3RlcnNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXBhdHRlcm5zKS5cbiAqL1xudmFyIHJlUmVnRXhwQ2hhciA9IC9bXFxcXF4kLiorPygpW1xcXXt9fF0vZztcblxuLyoqIFVzZWQgdG8gZGV0ZWN0IGhvc3QgY29uc3RydWN0b3JzIChTYWZhcmkpLiAqL1xudmFyIHJlSXNIb3N0Q3RvciA9IC9eXFxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXFxdJC87XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBmdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGUsXG4gICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKiogVXNlZCB0byByZXNvbHZlIHRoZSBkZWNvbXBpbGVkIHNvdXJjZSBvZiBmdW5jdGlvbnMuICovXG52YXIgZnVuY1RvU3RyaW5nID0gZnVuY1Byb3RvLnRvU3RyaW5nO1xuXG4vKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi9cbnZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5O1xuXG4vKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlLiAqL1xudmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICtcbiAgZnVuY1RvU3RyaW5nLmNhbGwoaGFzT3duUHJvcGVydHkpLnJlcGxhY2UocmVSZWdFeHBDaGFyLCAnXFxcXCQmJylcbiAgLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFxcXFwoKXwgZm9yIC4rPyg/PVxcXFxcXF0pL2csICckMS4qPycpICsgJyQnXG4pO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTmF0aXZlYCB3aXRob3V0IGJhZCBzaGltIGNoZWNrcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbixcbiAqICBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkge1xuICBpZiAoIWlzT2JqZWN0KHZhbHVlKSB8fCBpc01hc2tlZCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIHBhdHRlcm4gPSBpc0Z1bmN0aW9uKHZhbHVlKSA/IHJlSXNOYXRpdmUgOiByZUlzSG9zdEN0b3I7XG4gIHJldHVybiBwYXR0ZXJuLnRlc3QodG9Tb3VyY2UodmFsdWUpKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUlzTmF0aXZlO1xuIiwiLyoqXG4gKiBHZXRzIHRoZSB2YWx1ZSBhdCBga2V5YCBvZiBgb2JqZWN0YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBwcm9wZXJ0eSB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gZ2V0VmFsdWUob2JqZWN0LCBrZXkpIHtcbiAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdldFZhbHVlO1xuIiwiaW1wb3J0IGJhc2VJc05hdGl2ZSBmcm9tICcuL19iYXNlSXNOYXRpdmUuanMnO1xuaW1wb3J0IGdldFZhbHVlIGZyb20gJy4vX2dldFZhbHVlLmpzJztcblxuLyoqXG4gKiBHZXRzIHRoZSBuYXRpdmUgZnVuY3Rpb24gYXQgYGtleWAgb2YgYG9iamVjdGAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kIHRvIGdldC5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBmdW5jdGlvbiBpZiBpdCdzIG5hdGl2ZSwgZWxzZSBgdW5kZWZpbmVkYC5cbiAqL1xuZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7XG4gIHZhciB2YWx1ZSA9IGdldFZhbHVlKG9iamVjdCwga2V5KTtcbiAgcmV0dXJuIGJhc2VJc05hdGl2ZSh2YWx1ZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZ2V0TmF0aXZlO1xuIiwiaW1wb3J0IGdldE5hdGl2ZSBmcm9tICcuL19nZXROYXRpdmUuanMnO1xuaW1wb3J0IHJvb3QgZnJvbSAnLi9fcm9vdC5qcyc7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHRoYXQgYXJlIHZlcmlmaWVkIHRvIGJlIG5hdGl2ZS4gKi9cbnZhciBXZWFrTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdXZWFrTWFwJyk7XG5cbmV4cG9ydCBkZWZhdWx0IFdlYWtNYXA7XG4iLCJpbXBvcnQgaXNPYmplY3QgZnJvbSAnLi9pc09iamVjdC5qcyc7XG5cbi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdENyZWF0ZSA9IE9iamVjdC5jcmVhdGU7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uY3JlYXRlYCB3aXRob3V0IHN1cHBvcnQgZm9yIGFzc2lnbmluZ1xuICogcHJvcGVydGllcyB0byB0aGUgY3JlYXRlZCBvYmplY3QuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBwcm90byBUaGUgb2JqZWN0IHRvIGluaGVyaXQgZnJvbS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG5ldyBvYmplY3QuXG4gKi9cbnZhciBiYXNlQ3JlYXRlID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBvYmplY3QoKSB7fVxuICByZXR1cm4gZnVuY3Rpb24ocHJvdG8pIHtcbiAgICBpZiAoIWlzT2JqZWN0KHByb3RvKSkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICBpZiAob2JqZWN0Q3JlYXRlKSB7XG4gICAgICByZXR1cm4gb2JqZWN0Q3JlYXRlKHByb3RvKTtcbiAgICB9XG4gICAgb2JqZWN0LnByb3RvdHlwZSA9IHByb3RvO1xuICAgIHZhciByZXN1bHQgPSBuZXcgb2JqZWN0O1xuICAgIG9iamVjdC5wcm90b3R5cGUgPSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn0oKSk7XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VDcmVhdGU7XG4iLCIvKipcbiAqIENvcGllcyB0aGUgdmFsdWVzIG9mIGBzb3VyY2VgIHRvIGBhcnJheWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgZnJvbS5cbiAqIEBwYXJhbSB7QXJyYXl9IFthcnJheT1bXV0gVGhlIGFycmF5IHRvIGNvcHkgdmFsdWVzIHRvLlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuXG4gKi9cbmZ1bmN0aW9uIGNvcHlBcnJheShzb3VyY2UsIGFycmF5KSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgbGVuZ3RoID0gc291cmNlLmxlbmd0aDtcblxuICBhcnJheSB8fCAoYXJyYXkgPSBBcnJheShsZW5ndGgpKTtcbiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdO1xuICB9XG4gIHJldHVybiBhcnJheTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29weUFycmF5O1xuIiwiaW1wb3J0IGdldE5hdGl2ZSBmcm9tICcuL19nZXROYXRpdmUuanMnO1xuXG52YXIgZGVmaW5lUHJvcGVydHkgPSAoZnVuY3Rpb24oKSB7XG4gIHRyeSB7XG4gICAgdmFyIGZ1bmMgPSBnZXROYXRpdmUoT2JqZWN0LCAnZGVmaW5lUHJvcGVydHknKTtcbiAgICBmdW5jKHt9LCAnJywge30pO1xuICAgIHJldHVybiBmdW5jO1xuICB9IGNhdGNoIChlKSB7fVxufSgpKTtcblxuZXhwb3J0IGRlZmF1bHQgZGVmaW5lUHJvcGVydHk7XG4iLCIvKipcbiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5mb3JFYWNoYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3JcbiAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAqL1xuZnVuY3Rpb24gYXJyYXlFYWNoKGFycmF5LCBpdGVyYXRlZSkge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuXG4gIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgaWYgKGl0ZXJhdGVlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSA9PT0gZmFsc2UpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYXJyYXk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFycmF5RWFjaDtcbiIsIi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqL1xudmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxO1xuXG4vKiogVXNlZCB0byBkZXRlY3QgdW5zaWduZWQgaW50ZWdlciB2YWx1ZXMuICovXG52YXIgcmVJc1VpbnQgPSAvXig/OjB8WzEtOV1cXGQqKSQvO1xuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcGFyYW0ge251bWJlcn0gW2xlbmd0aD1NQVhfU0FGRV9JTlRFR0VSXSBUaGUgdXBwZXIgYm91bmRzIG9mIGEgdmFsaWQgaW5kZXguXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGluZGV4LCBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGlzSW5kZXgodmFsdWUsIGxlbmd0aCkge1xuICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTtcbiAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyBNQVhfU0FGRV9JTlRFR0VSIDogbGVuZ3RoO1xuXG4gIHJldHVybiAhIWxlbmd0aCAmJlxuICAgICh0eXBlID09ICdudW1iZXInIHx8XG4gICAgICAodHlwZSAhPSAnc3ltYm9sJyAmJiByZUlzVWludC50ZXN0KHZhbHVlKSkpICYmXG4gICAgICAgICh2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDwgbGVuZ3RoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNJbmRleDtcbiIsImltcG9ydCBkZWZpbmVQcm9wZXJ0eSBmcm9tICcuL19kZWZpbmVQcm9wZXJ0eS5qcyc7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGFzc2lnblZhbHVlYCBhbmQgYGFzc2lnbk1lcmdlVmFsdWVgIHdpdGhvdXRcbiAqIHZhbHVlIGNoZWNrcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIG1vZGlmeS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gYXNzaWduLlxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYXNzaWduLlxuICovXG5mdW5jdGlvbiBiYXNlQXNzaWduVmFsdWUob2JqZWN0LCBrZXksIHZhbHVlKSB7XG4gIGlmIChrZXkgPT0gJ19fcHJvdG9fXycgJiYgZGVmaW5lUHJvcGVydHkpIHtcbiAgICBkZWZpbmVQcm9wZXJ0eShvYmplY3QsIGtleSwge1xuICAgICAgJ2NvbmZpZ3VyYWJsZSc6IHRydWUsXG4gICAgICAnZW51bWVyYWJsZSc6IHRydWUsXG4gICAgICAndmFsdWUnOiB2YWx1ZSxcbiAgICAgICd3cml0YWJsZSc6IHRydWVcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBvYmplY3Rba2V5XSA9IHZhbHVlO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VBc3NpZ25WYWx1ZTtcbiIsIi8qKlxuICogUGVyZm9ybXMgYVxuICogW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybylcbiAqIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZSBlcXVpdmFsZW50LlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4wLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLlxuICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIHZhciBvYmplY3QgPSB7ICdhJzogMSB9O1xuICogdmFyIG90aGVyID0geyAnYSc6IDEgfTtcbiAqXG4gKiBfLmVxKG9iamVjdCwgb2JqZWN0KTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmVxKG9iamVjdCwgb3RoZXIpO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmVxKCdhJywgJ2EnKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmVxKCdhJywgT2JqZWN0KCdhJykpO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmVxKE5hTiwgTmFOKTtcbiAqIC8vID0+IHRydWVcbiAqL1xuZnVuY3Rpb24gZXEodmFsdWUsIG90aGVyKSB7XG4gIHJldHVybiB2YWx1ZSA9PT0gb3RoZXIgfHwgKHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXIpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBlcTtcbiIsImltcG9ydCBiYXNlQXNzaWduVmFsdWUgZnJvbSAnLi9fYmFzZUFzc2lnblZhbHVlLmpzJztcbmltcG9ydCBlcSBmcm9tICcuL2VxLmpzJztcblxuLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqXG4gKiBBc3NpZ25zIGB2YWx1ZWAgdG8gYGtleWAgb2YgYG9iamVjdGAgaWYgdGhlIGV4aXN0aW5nIHZhbHVlIGlzIG5vdCBlcXVpdmFsZW50XG4gKiB1c2luZyBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKVxuICogZm9yIGVxdWFsaXR5IGNvbXBhcmlzb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gbW9kaWZ5LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBhc3NpZ24uXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24uXG4gKi9cbmZ1bmN0aW9uIGFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSkge1xuICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XTtcbiAgaWYgKCEoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYgZXEob2JqVmFsdWUsIHZhbHVlKSkgfHxcbiAgICAgICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICEoa2V5IGluIG9iamVjdCkpKSB7XG4gICAgYmFzZUFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgYXNzaWduVmFsdWU7XG4iLCJpbXBvcnQgYXNzaWduVmFsdWUgZnJvbSAnLi9fYXNzaWduVmFsdWUuanMnO1xuaW1wb3J0IGJhc2VBc3NpZ25WYWx1ZSBmcm9tICcuL19iYXNlQXNzaWduVmFsdWUuanMnO1xuXG4vKipcbiAqIENvcGllcyBwcm9wZXJ0aWVzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBwcm9wZXJ0aWVzIGZyb20uXG4gKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMgdG8gY29weS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0PXt9XSBUaGUgb2JqZWN0IHRvIGNvcHkgcHJvcGVydGllcyB0by5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvcGllZCB2YWx1ZXMuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICovXG5mdW5jdGlvbiBjb3B5T2JqZWN0KHNvdXJjZSwgcHJvcHMsIG9iamVjdCwgY3VzdG9taXplcikge1xuICB2YXIgaXNOZXcgPSAhb2JqZWN0O1xuICBvYmplY3QgfHwgKG9iamVjdCA9IHt9KTtcblxuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IHByb3BzLmxlbmd0aDtcblxuICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgIHZhciBrZXkgPSBwcm9wc1tpbmRleF07XG5cbiAgICB2YXIgbmV3VmFsdWUgPSBjdXN0b21pemVyXG4gICAgICA/IGN1c3RvbWl6ZXIob2JqZWN0W2tleV0sIHNvdXJjZVtrZXldLCBrZXksIG9iamVjdCwgc291cmNlKVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgbmV3VmFsdWUgPSBzb3VyY2Vba2V5XTtcbiAgICB9XG4gICAgaWYgKGlzTmV3KSB7XG4gICAgICBiYXNlQXNzaWduVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzaWduVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9iamVjdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29weU9iamVjdDtcbiIsIi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqL1xudmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxO1xuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBsZW5ndGguXG4gKlxuICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb25cbiAqIFtgVG9MZW5ndGhgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy10b2xlbmd0aCkuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBsZW5ndGgsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc0xlbmd0aCgzKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpO1xuICogLy8gPT4gZmFsc2VcbiAqXG4gKiBfLmlzTGVuZ3RoKEluZmluaXR5KTtcbiAqIC8vID0+IGZhbHNlXG4gKlxuICogXy5pc0xlbmd0aCgnMycpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJlxuICAgIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPD0gTUFYX1NBRkVfSU5URUdFUjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNMZW5ndGg7XG4iLCJpbXBvcnQgaXNGdW5jdGlvbiBmcm9tICcuL2lzRnVuY3Rpb24uanMnO1xuaW1wb3J0IGlzTGVuZ3RoIGZyb20gJy4vaXNMZW5ndGguanMnO1xuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3NcbiAqIG5vdCBhIGZ1bmN0aW9uIGFuZCBoYXMgYSBgdmFsdWUubGVuZ3RoYCB0aGF0J3MgYW4gaW50ZWdlciBncmVhdGVyIHRoYW4gb3JcbiAqIGVxdWFsIHRvIGAwYCBhbmQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmAuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiBpc0xlbmd0aCh2YWx1ZS5sZW5ndGgpICYmICFpc0Z1bmN0aW9uKHZhbHVlKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNBcnJheUxpa2U7XG4iLCIvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovXG52YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxpa2VseSBhIHByb3RvdHlwZSBvYmplY3QuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm90b3R5cGUsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gaXNQcm90b3R5cGUodmFsdWUpIHtcbiAgdmFyIEN0b3IgPSB2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvcixcbiAgICAgIHByb3RvID0gKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUpIHx8IG9iamVjdFByb3RvO1xuXG4gIHJldHVybiB2YWx1ZSA9PT0gcHJvdG87XG59XG5cbmV4cG9ydCBkZWZhdWx0IGlzUHJvdG90eXBlO1xuIiwiLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50aW1lc2Agd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzXG4gKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHJlc3VsdHMuXG4gKi9cbmZ1bmN0aW9uIGJhc2VUaW1lcyhuLCBpdGVyYXRlZSkge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIHJlc3VsdCA9IEFycmF5KG4pO1xuXG4gIHdoaWxlICgrK2luZGV4IDwgbikge1xuICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShpbmRleCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZVRpbWVzO1xuIiwiaW1wb3J0IGJhc2VHZXRUYWcgZnJvbSAnLi9fYmFzZUdldFRhZy5qcyc7XG5pbXBvcnQgaXNPYmplY3RMaWtlIGZyb20gJy4vaXNPYmplY3RMaWtlLmpzJztcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJztcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc0FyZ3VtZW50c2AuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LFxuICovXG5mdW5jdGlvbiBiYXNlSXNBcmd1bWVudHModmFsdWUpIHtcbiAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gYXJnc1RhZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUlzQXJndW1lbnRzO1xuIiwiaW1wb3J0IGJhc2VJc0FyZ3VtZW50cyBmcm9tICcuL19iYXNlSXNBcmd1bWVudHMuanMnO1xuaW1wb3J0IGlzT2JqZWN0TGlrZSBmcm9tICcuL2lzT2JqZWN0TGlrZS5qcyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqL1xudmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqL1xudmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8ucHJvcGVydHlJc0VudW1lcmFibGU7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBgYXJndW1lbnRzYCBvYmplY3QsXG4gKiAgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLmlzQXJndW1lbnRzKGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNBcmd1bWVudHMoWzEsIDIsIDNdKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbnZhciBpc0FyZ3VtZW50cyA9IGJhc2VJc0FyZ3VtZW50cyhmdW5jdGlvbigpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA/IGJhc2VJc0FyZ3VtZW50cyA6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJlxuICAgICFwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHZhbHVlLCAnY2FsbGVlJyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBpc0FyZ3VtZW50cztcbiIsIi8qKlxuICogVGhpcyBtZXRob2QgcmV0dXJucyBgZmFsc2VgLlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4xMy4wXG4gKiBAY2F0ZWdvcnkgVXRpbFxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy50aW1lcygyLCBfLnN0dWJGYWxzZSk7XG4gKiAvLyA9PiBbZmFsc2UsIGZhbHNlXVxuICovXG5mdW5jdGlvbiBzdHViRmFsc2UoKSB7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc3R1YkZhbHNlO1xuIiwiaW1wb3J0IHJvb3QgZnJvbSAnLi9fcm9vdC5qcyc7XG5pbXBvcnQgc3R1YkZhbHNlIGZyb20gJy4vc3R1YkZhbHNlLmpzJztcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBleHBvcnRzYC4gKi9cbnZhciBmcmVlRXhwb3J0cyA9IHR5cGVvZiBleHBvcnRzID09ICdvYmplY3QnICYmIGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0cztcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBtb2R1bGVgLiAqL1xudmFyIGZyZWVNb2R1bGUgPSBmcmVlRXhwb3J0cyAmJiB0eXBlb2YgbW9kdWxlID09ICdvYmplY3QnICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTtcblxuLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi9cbnZhciBtb2R1bGVFeHBvcnRzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLmV4cG9ydHMgPT09IGZyZWVFeHBvcnRzO1xuXG4vKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi9cbnZhciBCdWZmZXIgPSBtb2R1bGVFeHBvcnRzID8gcm9vdC5CdWZmZXIgOiB1bmRlZmluZWQ7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi9cbnZhciBuYXRpdmVJc0J1ZmZlciA9IEJ1ZmZlciA/IEJ1ZmZlci5pc0J1ZmZlciA6IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlci5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDQuMy4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlciwgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLmlzQnVmZmVyKG5ldyBCdWZmZXIoMikpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNCdWZmZXIobmV3IFVpbnQ4QXJyYXkoMikpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xudmFyIGlzQnVmZmVyID0gbmF0aXZlSXNCdWZmZXIgfHwgc3R1YkZhbHNlO1xuXG5leHBvcnQgZGVmYXVsdCBpc0J1ZmZlcjtcbiIsImltcG9ydCBiYXNlR2V0VGFnIGZyb20gJy4vX2Jhc2VHZXRUYWcuanMnO1xuaW1wb3J0IGlzTGVuZ3RoIGZyb20gJy4vaXNMZW5ndGguanMnO1xuaW1wb3J0IGlzT2JqZWN0TGlrZSBmcm9tICcuL2lzT2JqZWN0TGlrZS5qcyc7XG5cbi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi9cbnZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsXG4gICAgYXJyYXlUYWcgPSAnW29iamVjdCBBcnJheV0nLFxuICAgIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsXG4gICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsXG4gICAgZnVuY1RhZyA9ICdbb2JqZWN0IEZ1bmN0aW9uXScsXG4gICAgbWFwVGFnID0gJ1tvYmplY3QgTWFwXScsXG4gICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsXG4gICAgb2JqZWN0VGFnID0gJ1tvYmplY3QgT2JqZWN0XScsXG4gICAgcmVnZXhwVGFnID0gJ1tvYmplY3QgUmVnRXhwXScsXG4gICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsXG4gICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXScsXG4gICAgd2Vha01hcFRhZyA9ICdbb2JqZWN0IFdlYWtNYXBdJztcblxudmFyIGFycmF5QnVmZmVyVGFnID0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJyxcbiAgICBkYXRhVmlld1RhZyA9ICdbb2JqZWN0IERhdGFWaWV3XScsXG4gICAgZmxvYXQzMlRhZyA9ICdbb2JqZWN0IEZsb2F0MzJBcnJheV0nLFxuICAgIGZsb2F0NjRUYWcgPSAnW29iamVjdCBGbG9hdDY0QXJyYXldJyxcbiAgICBpbnQ4VGFnID0gJ1tvYmplY3QgSW50OEFycmF5XScsXG4gICAgaW50MTZUYWcgPSAnW29iamVjdCBJbnQxNkFycmF5XScsXG4gICAgaW50MzJUYWcgPSAnW29iamVjdCBJbnQzMkFycmF5XScsXG4gICAgdWludDhUYWcgPSAnW29iamVjdCBVaW50OEFycmF5XScsXG4gICAgdWludDhDbGFtcGVkVGFnID0gJ1tvYmplY3QgVWludDhDbGFtcGVkQXJyYXldJyxcbiAgICB1aW50MTZUYWcgPSAnW29iamVjdCBVaW50MTZBcnJheV0nLFxuICAgIHVpbnQzMlRhZyA9ICdbb2JqZWN0IFVpbnQzMkFycmF5XSc7XG5cbi8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi9cbnZhciB0eXBlZEFycmF5VGFncyA9IHt9O1xudHlwZWRBcnJheVRhZ3NbZmxvYXQzMlRhZ10gPSB0eXBlZEFycmF5VGFnc1tmbG9hdDY0VGFnXSA9XG50eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9XG50eXBlZEFycmF5VGFnc1tpbnQzMlRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50OFRhZ10gPVxudHlwZWRBcnJheVRhZ3NbdWludDhDbGFtcGVkVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQxNlRhZ10gPVxudHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7XG50eXBlZEFycmF5VGFnc1thcmdzVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2FycmF5VGFnXSA9XG50eXBlZEFycmF5VGFnc1thcnJheUJ1ZmZlclRhZ10gPSB0eXBlZEFycmF5VGFnc1tib29sVGFnXSA9XG50eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9XG50eXBlZEFycmF5VGFnc1tlcnJvclRhZ10gPSB0eXBlZEFycmF5VGFnc1tmdW5jVGFnXSA9XG50eXBlZEFycmF5VGFnc1ttYXBUYWddID0gdHlwZWRBcnJheVRhZ3NbbnVtYmVyVGFnXSA9XG50eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9XG50eXBlZEFycmF5VGFnc1tzZXRUYWddID0gdHlwZWRBcnJheVRhZ3Nbc3RyaW5nVGFnXSA9XG50eXBlZEFycmF5VGFnc1t3ZWFrTWFwVGFnXSA9IGZhbHNlO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzVHlwZWRBcnJheWAgd2l0aG91dCBOb2RlLmpzIG9wdGltaXphdGlvbnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB0eXBlZCBhcnJheSwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBiYXNlSXNUeXBlZEFycmF5KHZhbHVlKSB7XG4gIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmXG4gICAgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW2Jhc2VHZXRUYWcodmFsdWUpXTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUlzVHlwZWRBcnJheTtcbiIsIi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udW5hcnlgIHdpdGhvdXQgc3VwcG9ydCBmb3Igc3RvcmluZyBtZXRhZGF0YS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2FwIGFyZ3VtZW50cyBmb3IuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjYXBwZWQgZnVuY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIGJhc2VVbmFyeShmdW5jKSB7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiBmdW5jKHZhbHVlKTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZVVuYXJ5O1xuIiwiaW1wb3J0IGZyZWVHbG9iYWwgZnJvbSAnLi9fZnJlZUdsb2JhbC5qcyc7XG5cbi8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZXhwb3J0c2AuICovXG52YXIgZnJlZUV4cG9ydHMgPSB0eXBlb2YgZXhwb3J0cyA9PSAnb2JqZWN0JyAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7XG5cbi8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgbW9kdWxlYC4gKi9cbnZhciBmcmVlTW9kdWxlID0gZnJlZUV4cG9ydHMgJiYgdHlwZW9mIG1vZHVsZSA9PSAnb2JqZWN0JyAmJiBtb2R1bGUgJiYgIW1vZHVsZS5ub2RlVHlwZSAmJiBtb2R1bGU7XG5cbi8qKiBEZXRlY3QgdGhlIHBvcHVsYXIgQ29tbW9uSlMgZXh0ZW5zaW9uIGBtb2R1bGUuZXhwb3J0c2AuICovXG52YXIgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0cztcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBwcm9jZXNzYCBmcm9tIE5vZGUuanMuICovXG52YXIgZnJlZVByb2Nlc3MgPSBtb2R1bGVFeHBvcnRzICYmIGZyZWVHbG9iYWwucHJvY2VzcztcblxuLyoqIFVzZWQgdG8gYWNjZXNzIGZhc3RlciBOb2RlLmpzIGhlbHBlcnMuICovXG52YXIgbm9kZVV0aWwgPSAoZnVuY3Rpb24oKSB7XG4gIHRyeSB7XG4gICAgLy8gVXNlIGB1dGlsLnR5cGVzYCBmb3IgTm9kZS5qcyAxMCsuXG4gICAgdmFyIHR5cGVzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLnJlcXVpcmUgJiYgZnJlZU1vZHVsZS5yZXF1aXJlKCd1dGlsJykudHlwZXM7XG5cbiAgICBpZiAodHlwZXMpIHtcbiAgICAgIHJldHVybiB0eXBlcztcbiAgICB9XG5cbiAgICAvLyBMZWdhY3kgYHByb2Nlc3MuYmluZGluZygndXRpbCcpYCBmb3IgTm9kZS5qcyA8IDEwLlxuICAgIHJldHVybiBmcmVlUHJvY2VzcyAmJiBmcmVlUHJvY2Vzcy5iaW5kaW5nICYmIGZyZWVQcm9jZXNzLmJpbmRpbmcoJ3V0aWwnKTtcbiAgfSBjYXRjaCAoZSkge31cbn0oKSk7XG5cbmV4cG9ydCBkZWZhdWx0IG5vZGVVdGlsO1xuIiwiaW1wb3J0IGJhc2VJc1R5cGVkQXJyYXkgZnJvbSAnLi9fYmFzZUlzVHlwZWRBcnJheS5qcyc7XG5pbXBvcnQgYmFzZVVuYXJ5IGZyb20gJy4vX2Jhc2VVbmFyeS5qcyc7XG5pbXBvcnQgbm9kZVV0aWwgZnJvbSAnLi9fbm9kZVV0aWwuanMnO1xuXG4vKiBOb2RlLmpzIGhlbHBlciByZWZlcmVuY2VzLiAqL1xudmFyIG5vZGVJc1R5cGVkQXJyYXkgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc1R5cGVkQXJyYXk7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIHR5cGVkIGFycmF5LlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgMy4wLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdHlwZWQgYXJyYXksIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc1R5cGVkQXJyYXkobmV3IFVpbnQ4QXJyYXkpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNUeXBlZEFycmF5KFtdKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbnZhciBpc1R5cGVkQXJyYXkgPSBub2RlSXNUeXBlZEFycmF5ID8gYmFzZVVuYXJ5KG5vZGVJc1R5cGVkQXJyYXkpIDogYmFzZUlzVHlwZWRBcnJheTtcblxuZXhwb3J0IGRlZmF1bHQgaXNUeXBlZEFycmF5O1xuIiwiaW1wb3J0IGJhc2VUaW1lcyBmcm9tICcuL19iYXNlVGltZXMuanMnO1xuaW1wb3J0IGlzQXJndW1lbnRzIGZyb20gJy4vaXNBcmd1bWVudHMuanMnO1xuaW1wb3J0IGlzQXJyYXkgZnJvbSAnLi9pc0FycmF5LmpzJztcbmltcG9ydCBpc0J1ZmZlciBmcm9tICcuL2lzQnVmZmVyLmpzJztcbmltcG9ydCBpc0luZGV4IGZyb20gJy4vX2lzSW5kZXguanMnO1xuaW1wb3J0IGlzVHlwZWRBcnJheSBmcm9tICcuL2lzVHlwZWRBcnJheS5qcyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqL1xudmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiB0aGUgYXJyYXktbGlrZSBgdmFsdWVgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuXG4gKi9cbmZ1bmN0aW9uIGFycmF5TGlrZUtleXModmFsdWUsIGluaGVyaXRlZCkge1xuICB2YXIgaXNBcnIgPSBpc0FycmF5KHZhbHVlKSxcbiAgICAgIGlzQXJnID0gIWlzQXJyICYmIGlzQXJndW1lbnRzKHZhbHVlKSxcbiAgICAgIGlzQnVmZiA9ICFpc0FyciAmJiAhaXNBcmcgJiYgaXNCdWZmZXIodmFsdWUpLFxuICAgICAgaXNUeXBlID0gIWlzQXJyICYmICFpc0FyZyAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheSh2YWx1ZSksXG4gICAgICBza2lwSW5kZXhlcyA9IGlzQXJyIHx8IGlzQXJnIHx8IGlzQnVmZiB8fCBpc1R5cGUsXG4gICAgICByZXN1bHQgPSBza2lwSW5kZXhlcyA/IGJhc2VUaW1lcyh2YWx1ZS5sZW5ndGgsIFN0cmluZykgOiBbXSxcbiAgICAgIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7XG5cbiAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7XG4gICAgaWYgKChpbmhlcml0ZWQgfHwgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwga2V5KSkgJiZcbiAgICAgICAgIShza2lwSW5kZXhlcyAmJiAoXG4gICAgICAgICAgIC8vIFNhZmFyaSA5IGhhcyBlbnVtZXJhYmxlIGBhcmd1bWVudHMubGVuZ3RoYCBpbiBzdHJpY3QgbW9kZS5cbiAgICAgICAgICAga2V5ID09ICdsZW5ndGgnIHx8XG4gICAgICAgICAgIC8vIE5vZGUuanMgMC4xMCBoYXMgZW51bWVyYWJsZSBub24taW5kZXggcHJvcGVydGllcyBvbiBidWZmZXJzLlxuICAgICAgICAgICAoaXNCdWZmICYmIChrZXkgPT0gJ29mZnNldCcgfHwga2V5ID09ICdwYXJlbnQnKSkgfHxcbiAgICAgICAgICAgLy8gUGhhbnRvbUpTIDIgaGFzIGVudW1lcmFibGUgbm9uLWluZGV4IHByb3BlcnRpZXMgb24gdHlwZWQgYXJyYXlzLlxuICAgICAgICAgICAoaXNUeXBlICYmIChrZXkgPT0gJ2J1ZmZlcicgfHwga2V5ID09ICdieXRlTGVuZ3RoJyB8fCBrZXkgPT0gJ2J5dGVPZmZzZXQnKSkgfHxcbiAgICAgICAgICAgLy8gU2tpcCBpbmRleCBwcm9wZXJ0aWVzLlxuICAgICAgICAgICBpc0luZGV4KGtleSwgbGVuZ3RoKVxuICAgICAgICApKSkge1xuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXJyYXlMaWtlS2V5cztcbiIsIi8qKlxuICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSB0cmFuc2Zvcm0gVGhlIGFyZ3VtZW50IHRyYW5zZm9ybS5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBvdmVyQXJnKGZ1bmMsIHRyYW5zZm9ybSkge1xuICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7XG4gICAgcmV0dXJuIGZ1bmModHJhbnNmb3JtKGFyZykpO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBvdmVyQXJnO1xuIiwiaW1wb3J0IG92ZXJBcmcgZnJvbSAnLi9fb3ZlckFyZy5qcyc7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi9cbnZhciBuYXRpdmVLZXlzID0gb3ZlckFyZyhPYmplY3Qua2V5cywgT2JqZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgbmF0aXZlS2V5cztcbiIsImltcG9ydCBpc1Byb3RvdHlwZSBmcm9tICcuL19pc1Byb3RvdHlwZS5qcyc7XG5pbXBvcnQgbmF0aXZlS2V5cyBmcm9tICcuL19uYXRpdmVLZXlzLmpzJztcblxuLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5rZXlzYCB3aGljaCBkb2Vzbid0IHRyZWF0IHNwYXJzZSBhcnJheXMgYXMgZGVuc2UuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuXG4gKi9cbmZ1bmN0aW9uIGJhc2VLZXlzKG9iamVjdCkge1xuICBpZiAoIWlzUHJvdG90eXBlKG9iamVjdCkpIHtcbiAgICByZXR1cm4gbmF0aXZlS2V5cyhvYmplY3QpO1xuICB9XG4gIHZhciByZXN1bHQgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIE9iamVjdChvYmplY3QpKSB7XG4gICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpICYmIGtleSAhPSAnY29uc3RydWN0b3InKSB7XG4gICAgICByZXN1bHQucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlS2V5cztcbiIsImltcG9ydCBhcnJheUxpa2VLZXlzIGZyb20gJy4vX2FycmF5TGlrZUtleXMuanMnO1xuaW1wb3J0IGJhc2VLZXlzIGZyb20gJy4vX2Jhc2VLZXlzLmpzJztcbmltcG9ydCBpc0FycmF5TGlrZSBmcm9tICcuL2lzQXJyYXlMaWtlLmpzJztcblxuLyoqXG4gKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC5cbiAqXG4gKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4gU2VlIHRoZVxuICogW0VTIHNwZWNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKVxuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAc3RhdGljXG4gKiBAc2luY2UgMC4xLjBcbiAqIEBtZW1iZXJPZiBfXG4gKiBAY2F0ZWdvcnkgT2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLlxuICogQGV4YW1wbGVcbiAqXG4gKiBmdW5jdGlvbiBGb28oKSB7XG4gKiAgIHRoaXMuYSA9IDE7XG4gKiAgIHRoaXMuYiA9IDI7XG4gKiB9XG4gKlxuICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAqXG4gKiBfLmtleXMobmV3IEZvbyk7XG4gKiAvLyA9PiBbJ2EnLCAnYiddIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpXG4gKlxuICogXy5rZXlzKCdoaScpO1xuICogLy8gPT4gWycwJywgJzEnXVxuICovXG5mdW5jdGlvbiBrZXlzKG9iamVjdCkge1xuICByZXR1cm4gaXNBcnJheUxpa2Uob2JqZWN0KSA/IGFycmF5TGlrZUtleXMob2JqZWN0KSA6IGJhc2VLZXlzKG9iamVjdCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGtleXM7XG4iLCIvKipcbiAqIFRoaXMgZnVuY3Rpb24gaXMgbGlrZVxuICogW2BPYmplY3Qua2V5c2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKVxuICogZXhjZXB0IHRoYXQgaXQgaW5jbHVkZXMgaW5oZXJpdGVkIGVudW1lcmFibGUgcHJvcGVydGllcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy5cbiAqL1xuZnVuY3Rpb24gbmF0aXZlS2V5c0luKG9iamVjdCkge1xuICB2YXIgcmVzdWx0ID0gW107XG4gIGlmIChvYmplY3QgIT0gbnVsbCkge1xuICAgIGZvciAodmFyIGtleSBpbiBPYmplY3Qob2JqZWN0KSkge1xuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgbmF0aXZlS2V5c0luO1xuIiwiaW1wb3J0IGlzT2JqZWN0IGZyb20gJy4vaXNPYmplY3QuanMnO1xuaW1wb3J0IGlzUHJvdG90eXBlIGZyb20gJy4vX2lzUHJvdG90eXBlLmpzJztcbmltcG9ydCBuYXRpdmVLZXlzSW4gZnJvbSAnLi9fbmF0aXZlS2V5c0luLmpzJztcblxuLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5rZXlzSW5gIHdoaWNoIGRvZXNuJ3QgdHJlYXQgc3BhcnNlIGFycmF5cyBhcyBkZW5zZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy5cbiAqL1xuZnVuY3Rpb24gYmFzZUtleXNJbihvYmplY3QpIHtcbiAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7XG4gICAgcmV0dXJuIG5hdGl2ZUtleXNJbihvYmplY3QpO1xuICB9XG4gIHZhciBpc1Byb3RvID0gaXNQcm90b3R5cGUob2JqZWN0KSxcbiAgICAgIHJlc3VsdCA9IFtdO1xuXG4gIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICBpZiAoIShrZXkgPT0gJ2NvbnN0cnVjdG9yJyAmJiAoaXNQcm90byB8fCAhaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpKSkge1xuICAgICAgcmVzdWx0LnB1c2goa2V5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUtleXNJbjtcbiIsImltcG9ydCBhcnJheUxpa2VLZXlzIGZyb20gJy4vX2FycmF5TGlrZUtleXMuanMnO1xuaW1wb3J0IGJhc2VLZXlzSW4gZnJvbSAnLi9fYmFzZUtleXNJbi5qcyc7XG5pbXBvcnQgaXNBcnJheUxpa2UgZnJvbSAnLi9pc0FycmF5TGlrZS5qcyc7XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC5cbiAqXG4gKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDMuMC4wXG4gKiBAY2F0ZWdvcnkgT2JqZWN0XG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLlxuICogQGV4YW1wbGVcbiAqXG4gKiBmdW5jdGlvbiBGb28oKSB7XG4gKiAgIHRoaXMuYSA9IDE7XG4gKiAgIHRoaXMuYiA9IDI7XG4gKiB9XG4gKlxuICogRm9vLnByb3RvdHlwZS5jID0gMztcbiAqXG4gKiBfLmtleXNJbihuZXcgRm9vKTtcbiAqIC8vID0+IFsnYScsICdiJywgJ2MnXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKVxuICovXG5mdW5jdGlvbiBrZXlzSW4ob2JqZWN0KSB7XG4gIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QsIHRydWUpIDogYmFzZUtleXNJbihvYmplY3QpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBrZXlzSW47XG4iLCJpbXBvcnQgaXNBcnJheSBmcm9tICcuL2lzQXJyYXkuanMnO1xuaW1wb3J0IGlzU3ltYm9sIGZyb20gJy4vaXNTeW1ib2wuanMnO1xuXG4vKiogVXNlZCB0byBtYXRjaCBwcm9wZXJ0eSBuYW1lcyB3aXRoaW4gcHJvcGVydHkgcGF0aHMuICovXG52YXIgcmVJc0RlZXBQcm9wID0gL1xcLnxcXFsoPzpbXltcXF1dKnwoW1wiJ10pKD86KD8hXFwxKVteXFxcXF18XFxcXC4pKj9cXDEpXFxdLyxcbiAgICByZUlzUGxhaW5Qcm9wID0gL15cXHcqJC87XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBwcm9wZXJ0eSBuYW1lIGFuZCBub3QgYSBwcm9wZXJ0eSBwYXRoLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3BlcnR5IG5hbWUsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkge1xuICBpZiAoaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gIGlmICh0eXBlID09ICdudW1iZXInIHx8IHR5cGUgPT0gJ3N5bWJvbCcgfHwgdHlwZSA9PSAnYm9vbGVhbicgfHxcbiAgICAgIHZhbHVlID09IG51bGwgfHwgaXNTeW1ib2wodmFsdWUpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIHJlSXNQbGFpblByb3AudGVzdCh2YWx1ZSkgfHwgIXJlSXNEZWVwUHJvcC50ZXN0KHZhbHVlKSB8fFxuICAgIChvYmplY3QgIT0gbnVsbCAmJiB2YWx1ZSBpbiBPYmplY3Qob2JqZWN0KSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGlzS2V5O1xuIiwiaW1wb3J0IGdldE5hdGl2ZSBmcm9tICcuL19nZXROYXRpdmUuanMnO1xuXG4vKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyB0aGF0IGFyZSB2ZXJpZmllZCB0byBiZSBuYXRpdmUuICovXG52YXIgbmF0aXZlQ3JlYXRlID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2NyZWF0ZScpO1xuXG5leHBvcnQgZGVmYXVsdCBuYXRpdmVDcmVhdGU7XG4iLCJpbXBvcnQgbmF0aXZlQ3JlYXRlIGZyb20gJy4vX25hdGl2ZUNyZWF0ZS5qcyc7XG5cbi8qKlxuICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgaGFzaC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgY2xlYXJcbiAqIEBtZW1iZXJPZiBIYXNoXG4gKi9cbmZ1bmN0aW9uIGhhc2hDbGVhcigpIHtcbiAgdGhpcy5fX2RhdGFfXyA9IG5hdGl2ZUNyZWF0ZSA/IG5hdGl2ZUNyZWF0ZShudWxsKSA6IHt9O1xuICB0aGlzLnNpemUgPSAwO1xufVxuXG5leHBvcnQgZGVmYXVsdCBoYXNoQ2xlYXI7XG4iLCIvKipcbiAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBoYXNoLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBkZWxldGVcbiAqIEBtZW1iZXJPZiBIYXNoXG4gKiBAcGFyYW0ge09iamVjdH0gaGFzaCBUaGUgaGFzaCB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gaGFzaERlbGV0ZShrZXkpIHtcbiAgdmFyIHJlc3VsdCA9IHRoaXMuaGFzKGtleSkgJiYgZGVsZXRlIHRoaXMuX19kYXRhX19ba2V5XTtcbiAgdGhpcy5zaXplIC09IHJlc3VsdCA/IDEgOiAwO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBoYXNoRGVsZXRlO1xuIiwiaW1wb3J0IG5hdGl2ZUNyZWF0ZSBmcm9tICcuL19uYXRpdmVDcmVhdGUuanMnO1xuXG4vKiogVXNlZCB0byBzdGFuZC1pbiBmb3IgYHVuZGVmaW5lZGAgaGFzaCB2YWx1ZXMuICovXG52YXIgSEFTSF9VTkRFRklORUQgPSAnX19sb2Rhc2hfaGFzaF91bmRlZmluZWRfXyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqL1xudmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbi8qKlxuICogR2V0cyB0aGUgaGFzaCB2YWx1ZSBmb3IgYGtleWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGdldFxuICogQG1lbWJlck9mIEhhc2hcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LlxuICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLlxuICovXG5mdW5jdGlvbiBoYXNoR2V0KGtleSkge1xuICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187XG4gIGlmIChuYXRpdmVDcmVhdGUpIHtcbiAgICB2YXIgcmVzdWx0ID0gZGF0YVtrZXldO1xuICAgIHJldHVybiByZXN1bHQgPT09IEhBU0hfVU5ERUZJTkVEID8gdW5kZWZpbmVkIDogcmVzdWx0O1xuICB9XG4gIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSkgPyBkYXRhW2tleV0gOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGhhc2hHZXQ7XG4iLCJpbXBvcnQgbmF0aXZlQ3JlYXRlIGZyb20gJy4vX25hdGl2ZUNyZWF0ZS5qcyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqL1xudmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBoYXNcbiAqIEBtZW1iZXJPZiBIYXNoXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gaGFzaEhhcyhrZXkpIHtcbiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fO1xuICByZXR1cm4gbmF0aXZlQ3JlYXRlID8gKGRhdGFba2V5XSAhPT0gdW5kZWZpbmVkKSA6IGhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaGFzaEhhcztcbiIsImltcG9ydCBuYXRpdmVDcmVhdGUgZnJvbSAnLi9fbmF0aXZlQ3JlYXRlLmpzJztcblxuLyoqIFVzZWQgdG8gc3RhbmQtaW4gZm9yIGB1bmRlZmluZWRgIGhhc2ggdmFsdWVzLiAqL1xudmFyIEhBU0hfVU5ERUZJTkVEID0gJ19fbG9kYXNoX2hhc2hfdW5kZWZpbmVkX18nO1xuXG4vKipcbiAqIFNldHMgdGhlIGhhc2ggYGtleWAgdG8gYHZhbHVlYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgc2V0XG4gKiBAbWVtYmVyT2YgSGFzaFxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBoYXNoIGluc3RhbmNlLlxuICovXG5mdW5jdGlvbiBoYXNoU2V0KGtleSwgdmFsdWUpIHtcbiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fO1xuICB0aGlzLnNpemUgKz0gdGhpcy5oYXMoa2V5KSA/IDAgOiAxO1xuICBkYXRhW2tleV0gPSAobmF0aXZlQ3JlYXRlICYmIHZhbHVlID09PSB1bmRlZmluZWQpID8gSEFTSF9VTkRFRklORUQgOiB2YWx1ZTtcbiAgcmV0dXJuIHRoaXM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGhhc2hTZXQ7XG4iLCJpbXBvcnQgaGFzaENsZWFyIGZyb20gJy4vX2hhc2hDbGVhci5qcyc7XG5pbXBvcnQgaGFzaERlbGV0ZSBmcm9tICcuL19oYXNoRGVsZXRlLmpzJztcbmltcG9ydCBoYXNoR2V0IGZyb20gJy4vX2hhc2hHZXQuanMnO1xuaW1wb3J0IGhhc2hIYXMgZnJvbSAnLi9faGFzaEhhcy5qcyc7XG5pbXBvcnQgaGFzaFNldCBmcm9tICcuL19oYXNoU2V0LmpzJztcblxuLyoqXG4gKiBDcmVhdGVzIGEgaGFzaCBvYmplY3QuXG4gKlxuICogQHByaXZhdGVcbiAqIEBjb25zdHJ1Y3RvclxuICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuXG4gKi9cbmZ1bmN0aW9uIEhhc2goZW50cmllcykge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDtcblxuICB0aGlzLmNsZWFyKCk7XG4gIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07XG4gICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTtcbiAgfVxufVxuXG4vLyBBZGQgbWV0aG9kcyB0byBgSGFzaGAuXG5IYXNoLnByb3RvdHlwZS5jbGVhciA9IGhhc2hDbGVhcjtcbkhhc2gucHJvdG90eXBlWydkZWxldGUnXSA9IGhhc2hEZWxldGU7XG5IYXNoLnByb3RvdHlwZS5nZXQgPSBoYXNoR2V0O1xuSGFzaC5wcm90b3R5cGUuaGFzID0gaGFzaEhhcztcbkhhc2gucHJvdG90eXBlLnNldCA9IGhhc2hTZXQ7XG5cbmV4cG9ydCBkZWZhdWx0IEhhc2g7XG4iLCIvKipcbiAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGxpc3QgY2FjaGUuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGNsZWFyXG4gKiBAbWVtYmVyT2YgTGlzdENhY2hlXG4gKi9cbmZ1bmN0aW9uIGxpc3RDYWNoZUNsZWFyKCkge1xuICB0aGlzLl9fZGF0YV9fID0gW107XG4gIHRoaXMuc2l6ZSA9IDA7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGxpc3RDYWNoZUNsZWFyO1xuIiwiaW1wb3J0IGVxIGZyb20gJy4vZXEuanMnO1xuXG4vKipcbiAqIEdldHMgdGhlIGluZGV4IGF0IHdoaWNoIHRoZSBga2V5YCBpcyBmb3VuZCBpbiBgYXJyYXlgIG9mIGtleS12YWx1ZSBwYWlycy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGluc3BlY3QuXG4gKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHRvIHNlYXJjaCBmb3IuXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLlxuICovXG5mdW5jdGlvbiBhc3NvY0luZGV4T2YoYXJyYXksIGtleSkge1xuICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICBpZiAoZXEoYXJyYXlbbGVuZ3RoXVswXSwga2V5KSkge1xuICAgICAgcmV0dXJuIGxlbmd0aDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIC0xO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3NvY0luZGV4T2Y7XG4iLCJpbXBvcnQgYXNzb2NJbmRleE9mIGZyb20gJy4vX2Fzc29jSW5kZXhPZi5qcyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBhcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlO1xuXG4vKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi9cbnZhciBzcGxpY2UgPSBhcnJheVByb3RvLnNwbGljZTtcblxuLyoqXG4gKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgbGlzdCBjYWNoZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgZGVsZXRlXG4gKiBAbWVtYmVyT2YgTGlzdENhY2hlXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gbGlzdENhY2hlRGVsZXRlKGtleSkge1xuICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sXG4gICAgICBpbmRleCA9IGFzc29jSW5kZXhPZihkYXRhLCBrZXkpO1xuXG4gIGlmIChpbmRleCA8IDApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGxhc3RJbmRleCA9IGRhdGEubGVuZ3RoIC0gMTtcbiAgaWYgKGluZGV4ID09IGxhc3RJbmRleCkge1xuICAgIGRhdGEucG9wKCk7XG4gIH0gZWxzZSB7XG4gICAgc3BsaWNlLmNhbGwoZGF0YSwgaW5kZXgsIDEpO1xuICB9XG4gIC0tdGhpcy5zaXplO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgbGlzdENhY2hlRGVsZXRlO1xuIiwiaW1wb3J0IGFzc29jSW5kZXhPZiBmcm9tICcuL19hc3NvY0luZGV4T2YuanMnO1xuXG4vKipcbiAqIEdldHMgdGhlIGxpc3QgY2FjaGUgdmFsdWUgZm9yIGBrZXlgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBnZXRcbiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LlxuICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLlxuICovXG5mdW5jdGlvbiBsaXN0Q2FjaGVHZXQoa2V5KSB7XG4gIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXyxcbiAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7XG5cbiAgcmV0dXJuIGluZGV4IDwgMCA/IHVuZGVmaW5lZCA6IGRhdGFbaW5kZXhdWzFdO1xufVxuXG5leHBvcnQgZGVmYXVsdCBsaXN0Q2FjaGVHZXQ7XG4iLCJpbXBvcnQgYXNzb2NJbmRleE9mIGZyb20gJy4vX2Fzc29jSW5kZXhPZi5qcyc7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgbGlzdCBjYWNoZSB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBoYXNcbiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBsaXN0Q2FjaGVIYXMoa2V5KSB7XG4gIHJldHVybiBhc3NvY0luZGV4T2YodGhpcy5fX2RhdGFfXywga2V5KSA+IC0xO1xufVxuXG5leHBvcnQgZGVmYXVsdCBsaXN0Q2FjaGVIYXM7XG4iLCJpbXBvcnQgYXNzb2NJbmRleE9mIGZyb20gJy4vX2Fzc29jSW5kZXhPZi5qcyc7XG5cbi8qKlxuICogU2V0cyB0aGUgbGlzdCBjYWNoZSBga2V5YCB0byBgdmFsdWVgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBzZXRcbiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LlxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbGlzdCBjYWNoZSBpbnN0YW5jZS5cbiAqL1xuZnVuY3Rpb24gbGlzdENhY2hlU2V0KGtleSwgdmFsdWUpIHtcbiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLFxuICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTtcblxuICBpZiAoaW5kZXggPCAwKSB7XG4gICAgKyt0aGlzLnNpemU7XG4gICAgZGF0YS5wdXNoKFtrZXksIHZhbHVlXSk7XG4gIH0gZWxzZSB7XG4gICAgZGF0YVtpbmRleF1bMV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cblxuZXhwb3J0IGRlZmF1bHQgbGlzdENhY2hlU2V0O1xuIiwiaW1wb3J0IGxpc3RDYWNoZUNsZWFyIGZyb20gJy4vX2xpc3RDYWNoZUNsZWFyLmpzJztcbmltcG9ydCBsaXN0Q2FjaGVEZWxldGUgZnJvbSAnLi9fbGlzdENhY2hlRGVsZXRlLmpzJztcbmltcG9ydCBsaXN0Q2FjaGVHZXQgZnJvbSAnLi9fbGlzdENhY2hlR2V0LmpzJztcbmltcG9ydCBsaXN0Q2FjaGVIYXMgZnJvbSAnLi9fbGlzdENhY2hlSGFzLmpzJztcbmltcG9ydCBsaXN0Q2FjaGVTZXQgZnJvbSAnLi9fbGlzdENhY2hlU2V0LmpzJztcblxuLyoqXG4gKiBDcmVhdGVzIGFuIGxpc3QgY2FjaGUgb2JqZWN0LlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLlxuICovXG5mdW5jdGlvbiBMaXN0Q2FjaGUoZW50cmllcykge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDtcblxuICB0aGlzLmNsZWFyKCk7XG4gIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07XG4gICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTtcbiAgfVxufVxuXG4vLyBBZGQgbWV0aG9kcyB0byBgTGlzdENhY2hlYC5cbkxpc3RDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBsaXN0Q2FjaGVDbGVhcjtcbkxpc3RDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbGlzdENhY2hlRGVsZXRlO1xuTGlzdENhY2hlLnByb3RvdHlwZS5nZXQgPSBsaXN0Q2FjaGVHZXQ7XG5MaXN0Q2FjaGUucHJvdG90eXBlLmhhcyA9IGxpc3RDYWNoZUhhcztcbkxpc3RDYWNoZS5wcm90b3R5cGUuc2V0ID0gbGlzdENhY2hlU2V0O1xuXG5leHBvcnQgZGVmYXVsdCBMaXN0Q2FjaGU7XG4iLCJpbXBvcnQgZ2V0TmF0aXZlIGZyb20gJy4vX2dldE5hdGl2ZS5qcyc7XG5pbXBvcnQgcm9vdCBmcm9tICcuL19yb290LmpzJztcblxuLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqL1xudmFyIE1hcCA9IGdldE5hdGl2ZShyb290LCAnTWFwJyk7XG5cbmV4cG9ydCBkZWZhdWx0IE1hcDtcbiIsImltcG9ydCBIYXNoIGZyb20gJy4vX0hhc2guanMnO1xuaW1wb3J0IExpc3RDYWNoZSBmcm9tICcuL19MaXN0Q2FjaGUuanMnO1xuaW1wb3J0IE1hcCBmcm9tICcuL19NYXAuanMnO1xuXG4vKipcbiAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIG1hcC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgY2xlYXJcbiAqIEBtZW1iZXJPZiBNYXBDYWNoZVxuICovXG5mdW5jdGlvbiBtYXBDYWNoZUNsZWFyKCkge1xuICB0aGlzLnNpemUgPSAwO1xuICB0aGlzLl9fZGF0YV9fID0ge1xuICAgICdoYXNoJzogbmV3IEhhc2gsXG4gICAgJ21hcCc6IG5ldyAoTWFwIHx8IExpc3RDYWNoZSksXG4gICAgJ3N0cmluZyc6IG5ldyBIYXNoXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IG1hcENhY2hlQ2xlYXI7XG4iLCIvKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHN1aXRhYmxlIGZvciB1c2UgYXMgdW5pcXVlIG9iamVjdCBrZXkuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gaXNLZXlhYmxlKHZhbHVlKSB7XG4gIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlO1xuICByZXR1cm4gKHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnbnVtYmVyJyB8fCB0eXBlID09ICdzeW1ib2wnIHx8IHR5cGUgPT0gJ2Jvb2xlYW4nKVxuICAgID8gKHZhbHVlICE9PSAnX19wcm90b19fJylcbiAgICA6ICh2YWx1ZSA9PT0gbnVsbCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGlzS2V5YWJsZTtcbiIsImltcG9ydCBpc0tleWFibGUgZnJvbSAnLi9faXNLZXlhYmxlLmpzJztcblxuLyoqXG4gKiBHZXRzIHRoZSBkYXRhIGZvciBgbWFwYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIHF1ZXJ5LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUgcmVmZXJlbmNlIGtleS5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBtYXAgZGF0YS5cbiAqL1xuZnVuY3Rpb24gZ2V0TWFwRGF0YShtYXAsIGtleSkge1xuICB2YXIgZGF0YSA9IG1hcC5fX2RhdGFfXztcbiAgcmV0dXJuIGlzS2V5YWJsZShrZXkpXG4gICAgPyBkYXRhW3R5cGVvZiBrZXkgPT0gJ3N0cmluZycgPyAnc3RyaW5nJyA6ICdoYXNoJ11cbiAgICA6IGRhdGEubWFwO1xufVxuXG5leHBvcnQgZGVmYXVsdCBnZXRNYXBEYXRhO1xuIiwiaW1wb3J0IGdldE1hcERhdGEgZnJvbSAnLi9fZ2V0TWFwRGF0YS5qcyc7XG5cbi8qKlxuICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIG1hcC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgZGVsZXRlXG4gKiBAbWVtYmVyT2YgTWFwQ2FjaGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBtYXBDYWNoZURlbGV0ZShrZXkpIHtcbiAgdmFyIHJlc3VsdCA9IGdldE1hcERhdGEodGhpcywga2V5KVsnZGVsZXRlJ10oa2V5KTtcbiAgdGhpcy5zaXplIC09IHJlc3VsdCA/IDEgOiAwO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBtYXBDYWNoZURlbGV0ZTtcbiIsImltcG9ydCBnZXRNYXBEYXRhIGZyb20gJy4vX2dldE1hcERhdGEuanMnO1xuXG4vKipcbiAqIEdldHMgdGhlIG1hcCB2YWx1ZSBmb3IgYGtleWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGdldFxuICogQG1lbWJlck9mIE1hcENhY2hlXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gbWFwQ2FjaGVHZXQoa2V5KSB7XG4gIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuZ2V0KGtleSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IG1hcENhY2hlR2V0O1xuIiwiaW1wb3J0IGdldE1hcERhdGEgZnJvbSAnLi9fZ2V0TWFwRGF0YS5qcyc7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgbWFwIHZhbHVlIGZvciBga2V5YCBleGlzdHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGhhc1xuICogQG1lbWJlck9mIE1hcENhY2hlXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gbWFwQ2FjaGVIYXMoa2V5KSB7XG4gIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuaGFzKGtleSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IG1hcENhY2hlSGFzO1xuIiwiaW1wb3J0IGdldE1hcERhdGEgZnJvbSAnLi9fZ2V0TWFwRGF0YS5qcyc7XG5cbi8qKlxuICogU2V0cyB0aGUgbWFwIGBrZXlgIHRvIGB2YWx1ZWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIHNldFxuICogQG1lbWJlck9mIE1hcENhY2hlXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC5cbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG1hcCBjYWNoZSBpbnN0YW5jZS5cbiAqL1xuZnVuY3Rpb24gbWFwQ2FjaGVTZXQoa2V5LCB2YWx1ZSkge1xuICB2YXIgZGF0YSA9IGdldE1hcERhdGEodGhpcywga2V5KSxcbiAgICAgIHNpemUgPSBkYXRhLnNpemU7XG5cbiAgZGF0YS5zZXQoa2V5LCB2YWx1ZSk7XG4gIHRoaXMuc2l6ZSArPSBkYXRhLnNpemUgPT0gc2l6ZSA/IDAgOiAxO1xuICByZXR1cm4gdGhpcztcbn1cblxuZXhwb3J0IGRlZmF1bHQgbWFwQ2FjaGVTZXQ7XG4iLCJpbXBvcnQgbWFwQ2FjaGVDbGVhciBmcm9tICcuL19tYXBDYWNoZUNsZWFyLmpzJztcbmltcG9ydCBtYXBDYWNoZURlbGV0ZSBmcm9tICcuL19tYXBDYWNoZURlbGV0ZS5qcyc7XG5pbXBvcnQgbWFwQ2FjaGVHZXQgZnJvbSAnLi9fbWFwQ2FjaGVHZXQuanMnO1xuaW1wb3J0IG1hcENhY2hlSGFzIGZyb20gJy4vX21hcENhY2hlSGFzLmpzJztcbmltcG9ydCBtYXBDYWNoZVNldCBmcm9tICcuL19tYXBDYWNoZVNldC5qcyc7XG5cbi8qKlxuICogQ3JlYXRlcyBhIG1hcCBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLlxuICovXG5mdW5jdGlvbiBNYXBDYWNoZShlbnRyaWVzKSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoO1xuXG4gIHRoaXMuY2xlYXIoKTtcbiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTtcbiAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pO1xuICB9XG59XG5cbi8vIEFkZCBtZXRob2RzIHRvIGBNYXBDYWNoZWAuXG5NYXBDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBtYXBDYWNoZUNsZWFyO1xuTWFwQ2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IG1hcENhY2hlRGVsZXRlO1xuTWFwQ2FjaGUucHJvdG90eXBlLmdldCA9IG1hcENhY2hlR2V0O1xuTWFwQ2FjaGUucHJvdG90eXBlLmhhcyA9IG1hcENhY2hlSGFzO1xuTWFwQ2FjaGUucHJvdG90eXBlLnNldCA9IG1hcENhY2hlU2V0O1xuXG5leHBvcnQgZGVmYXVsdCBNYXBDYWNoZTtcbiIsImltcG9ydCBNYXBDYWNoZSBmcm9tICcuL19NYXBDYWNoZS5qcyc7XG5cbi8qKiBFcnJvciBtZXNzYWdlIGNvbnN0YW50cy4gKi9cbnZhciBGVU5DX0VSUk9SX1RFWFQgPSAnRXhwZWN0ZWQgYSBmdW5jdGlvbic7XG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWVtb2l6ZXMgdGhlIHJlc3VsdCBvZiBgZnVuY2AuIElmIGByZXNvbHZlcmAgaXNcbiAqIHByb3ZpZGVkLCBpdCBkZXRlcm1pbmVzIHRoZSBjYWNoZSBrZXkgZm9yIHN0b3JpbmcgdGhlIHJlc3VsdCBiYXNlZCBvbiB0aGVcbiAqIGFyZ3VtZW50cyBwcm92aWRlZCB0byB0aGUgbWVtb2l6ZWQgZnVuY3Rpb24uIEJ5IGRlZmF1bHQsIHRoZSBmaXJzdCBhcmd1bWVudFxuICogcHJvdmlkZWQgdG8gdGhlIG1lbW9pemVkIGZ1bmN0aW9uIGlzIHVzZWQgYXMgdGhlIG1hcCBjYWNoZSBrZXkuIFRoZSBgZnVuY2BcbiAqIGlzIGludm9rZWQgd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlIG1lbW9pemVkIGZ1bmN0aW9uLlxuICpcbiAqICoqTm90ZToqKiBUaGUgY2FjaGUgaXMgZXhwb3NlZCBhcyB0aGUgYGNhY2hlYCBwcm9wZXJ0eSBvbiB0aGUgbWVtb2l6ZWRcbiAqIGZ1bmN0aW9uLiBJdHMgY3JlYXRpb24gbWF5IGJlIGN1c3RvbWl6ZWQgYnkgcmVwbGFjaW5nIHRoZSBgXy5tZW1vaXplLkNhY2hlYFxuICogY29uc3RydWN0b3Igd2l0aCBvbmUgd2hvc2UgaW5zdGFuY2VzIGltcGxlbWVudCB0aGVcbiAqIFtgTWFwYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcHJvcGVydGllcy1vZi10aGUtbWFwLXByb3RvdHlwZS1vYmplY3QpXG4gKiBtZXRob2QgaW50ZXJmYWNlIG9mIGBjbGVhcmAsIGBkZWxldGVgLCBgZ2V0YCwgYGhhc2AsIGFuZCBgc2V0YC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgRnVuY3Rpb25cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGhhdmUgaXRzIG91dHB1dCBtZW1vaXplZC5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtyZXNvbHZlcl0gVGhlIGZ1bmN0aW9uIHRvIHJlc29sdmUgdGhlIGNhY2hlIGtleS5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLlxuICogQGV4YW1wbGVcbiAqXG4gKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEsICdiJzogMiB9O1xuICogdmFyIG90aGVyID0geyAnYyc6IDMsICdkJzogNCB9O1xuICpcbiAqIHZhciB2YWx1ZXMgPSBfLm1lbW9pemUoXy52YWx1ZXMpO1xuICogdmFsdWVzKG9iamVjdCk7XG4gKiAvLyA9PiBbMSwgMl1cbiAqXG4gKiB2YWx1ZXMob3RoZXIpO1xuICogLy8gPT4gWzMsIDRdXG4gKlxuICogb2JqZWN0LmEgPSAyO1xuICogdmFsdWVzKG9iamVjdCk7XG4gKiAvLyA9PiBbMSwgMl1cbiAqXG4gKiAvLyBNb2RpZnkgdGhlIHJlc3VsdCBjYWNoZS5cbiAqIHZhbHVlcy5jYWNoZS5zZXQob2JqZWN0LCBbJ2EnLCAnYiddKTtcbiAqIHZhbHVlcyhvYmplY3QpO1xuICogLy8gPT4gWydhJywgJ2InXVxuICpcbiAqIC8vIFJlcGxhY2UgYF8ubWVtb2l6ZS5DYWNoZWAuXG4gKiBfLm1lbW9pemUuQ2FjaGUgPSBXZWFrTWFwO1xuICovXG5mdW5jdGlvbiBtZW1vaXplKGZ1bmMsIHJlc29sdmVyKSB7XG4gIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nIHx8IChyZXNvbHZlciAhPSBudWxsICYmIHR5cGVvZiByZXNvbHZlciAhPSAnZnVuY3Rpb24nKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUKTtcbiAgfVxuICB2YXIgbWVtb2l6ZWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cyxcbiAgICAgICAga2V5ID0gcmVzb2x2ZXIgPyByZXNvbHZlci5hcHBseSh0aGlzLCBhcmdzKSA6IGFyZ3NbMF0sXG4gICAgICAgIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGU7XG5cbiAgICBpZiAoY2FjaGUuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQoa2V5KTtcbiAgICB9XG4gICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgbWVtb2l6ZWQuY2FjaGUgPSBjYWNoZS5zZXQoa2V5LCByZXN1bHQpIHx8IGNhY2hlO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIG1lbW9pemVkLmNhY2hlID0gbmV3IChtZW1vaXplLkNhY2hlIHx8IE1hcENhY2hlKTtcbiAgcmV0dXJuIG1lbW9pemVkO1xufVxuXG4vLyBFeHBvc2UgYE1hcENhY2hlYC5cbm1lbW9pemUuQ2FjaGUgPSBNYXBDYWNoZTtcblxuZXhwb3J0IGRlZmF1bHQgbWVtb2l6ZTtcbiIsImltcG9ydCBtZW1vaXplIGZyb20gJy4vbWVtb2l6ZS5qcyc7XG5cbi8qKiBVc2VkIGFzIHRoZSBtYXhpbXVtIG1lbW9pemUgY2FjaGUgc2l6ZS4gKi9cbnZhciBNQVhfTUVNT0laRV9TSVpFID0gNTAwO1xuXG4vKipcbiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5tZW1vaXplYCB3aGljaCBjbGVhcnMgdGhlIG1lbW9pemVkIGZ1bmN0aW9uJ3NcbiAqIGNhY2hlIHdoZW4gaXQgZXhjZWVkcyBgTUFYX01FTU9JWkVfU0laRWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGhhdmUgaXRzIG91dHB1dCBtZW1vaXplZC5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IG1lbW9pemVkIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBtZW1vaXplQ2FwcGVkKGZ1bmMpIHtcbiAgdmFyIHJlc3VsdCA9IG1lbW9pemUoZnVuYywgZnVuY3Rpb24oa2V5KSB7XG4gICAgaWYgKGNhY2hlLnNpemUgPT09IE1BWF9NRU1PSVpFX1NJWkUpIHtcbiAgICAgIGNhY2hlLmNsZWFyKCk7XG4gICAgfVxuICAgIHJldHVybiBrZXk7XG4gIH0pO1xuXG4gIHZhciBjYWNoZSA9IHJlc3VsdC5jYWNoZTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgbWVtb2l6ZUNhcHBlZDtcbiIsImltcG9ydCBtZW1vaXplQ2FwcGVkIGZyb20gJy4vX21lbW9pemVDYXBwZWQuanMnO1xuXG4vKiogVXNlZCB0byBtYXRjaCBwcm9wZXJ0eSBuYW1lcyB3aXRoaW4gcHJvcGVydHkgcGF0aHMuICovXG52YXIgcmVQcm9wTmFtZSA9IC9bXi5bXFxdXSt8XFxbKD86KC0/XFxkKyg/OlxcLlxcZCspPyl8KFtcIiddKSgoPzooPyFcXDIpW15cXFxcXXxcXFxcLikqPylcXDIpXFxdfCg/PSg/OlxcLnxcXFtcXF0pKD86XFwufFxcW1xcXXwkKSkvZztcblxuLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovXG52YXIgcmVFc2NhcGVDaGFyID0gL1xcXFwoXFxcXCk/L2c7XG5cbi8qKlxuICogQ29udmVydHMgYHN0cmluZ2AgdG8gYSBwcm9wZXJ0eSBwYXRoIGFycmF5LlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcHJvcGVydHkgcGF0aCBhcnJheS5cbiAqL1xudmFyIHN0cmluZ1RvUGF0aCA9IG1lbW9pemVDYXBwZWQoZnVuY3Rpb24oc3RyaW5nKSB7XG4gIHZhciByZXN1bHQgPSBbXTtcbiAgaWYgKHN0cmluZy5jaGFyQ29kZUF0KDApID09PSA0NiAvKiAuICovKSB7XG4gICAgcmVzdWx0LnB1c2goJycpO1xuICB9XG4gIHN0cmluZy5yZXBsYWNlKHJlUHJvcE5hbWUsIGZ1bmN0aW9uKG1hdGNoLCBudW1iZXIsIHF1b3RlLCBzdWJTdHJpbmcpIHtcbiAgICByZXN1bHQucHVzaChxdW90ZSA/IHN1YlN0cmluZy5yZXBsYWNlKHJlRXNjYXBlQ2hhciwgJyQxJykgOiAobnVtYmVyIHx8IG1hdGNoKSk7XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHN0cmluZ1RvUGF0aDtcbiIsImltcG9ydCBiYXNlVG9TdHJpbmcgZnJvbSAnLi9fYmFzZVRvU3RyaW5nLmpzJztcblxuLyoqXG4gKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nLiBBbiBlbXB0eSBzdHJpbmcgaXMgcmV0dXJuZWQgZm9yIGBudWxsYFxuICogYW5kIGB1bmRlZmluZWRgIHZhbHVlcy4gVGhlIHNpZ24gb2YgYC0wYCBpcyBwcmVzZXJ2ZWQuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLnRvU3RyaW5nKG51bGwpO1xuICogLy8gPT4gJydcbiAqXG4gKiBfLnRvU3RyaW5nKC0wKTtcbiAqIC8vID0+ICctMCdcbiAqXG4gKiBfLnRvU3RyaW5nKFsxLCAyLCAzXSk7XG4gKiAvLyA9PiAnMSwyLDMnXG4gKi9cbmZ1bmN0aW9uIHRvU3RyaW5nKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSA9PSBudWxsID8gJycgOiBiYXNlVG9TdHJpbmcodmFsdWUpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB0b1N0cmluZztcbiIsImltcG9ydCBpc0FycmF5IGZyb20gJy4vaXNBcnJheS5qcyc7XG5pbXBvcnQgaXNLZXkgZnJvbSAnLi9faXNLZXkuanMnO1xuaW1wb3J0IHN0cmluZ1RvUGF0aCBmcm9tICcuL19zdHJpbmdUb1BhdGguanMnO1xuaW1wb3J0IHRvU3RyaW5nIGZyb20gJy4vdG9TdHJpbmcuanMnO1xuXG4vKipcbiAqIENhc3RzIGB2YWx1ZWAgdG8gYSBwYXRoIGFycmF5IGlmIGl0J3Mgbm90IG9uZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNhc3QgcHJvcGVydHkgcGF0aCBhcnJheS5cbiAqL1xuZnVuY3Rpb24gY2FzdFBhdGgodmFsdWUsIG9iamVjdCkge1xuICBpZiAoaXNBcnJheSh2YWx1ZSkpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIGlzS2V5KHZhbHVlLCBvYmplY3QpID8gW3ZhbHVlXSA6IHN0cmluZ1RvUGF0aCh0b1N0cmluZyh2YWx1ZSkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjYXN0UGF0aDtcbiIsImltcG9ydCBpc1N5bWJvbCBmcm9tICcuL2lzU3ltYm9sLmpzJztcblxuLyoqIFVzZWQgYXMgcmVmZXJlbmNlcyBmb3IgdmFyaW91cyBgTnVtYmVyYCBjb25zdGFudHMuICovXG52YXIgSU5GSU5JVFkgPSAxIC8gMDtcblxuLyoqXG4gKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nIGtleSBpZiBpdCdzIG5vdCBhIHN0cmluZyBvciBzeW1ib2wuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGluc3BlY3QuXG4gKiBAcmV0dXJucyB7c3RyaW5nfHN5bWJvbH0gUmV0dXJucyB0aGUga2V5LlxuICovXG5mdW5jdGlvbiB0b0tleSh2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8IGlzU3ltYm9sKHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICB2YXIgcmVzdWx0ID0gKHZhbHVlICsgJycpO1xuICByZXR1cm4gKHJlc3VsdCA9PSAnMCcgJiYgKDEgLyB2YWx1ZSkgPT0gLUlORklOSVRZKSA/ICctMCcgOiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHRvS2V5O1xuIiwiaW1wb3J0IGNhc3RQYXRoIGZyb20gJy4vX2Nhc3RQYXRoLmpzJztcbmltcG9ydCB0b0tleSBmcm9tICcuL190b0tleS5qcyc7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZ2V0YCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZmF1bHQgdmFsdWVzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LlxuICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHJlc29sdmVkIHZhbHVlLlxuICovXG5mdW5jdGlvbiBiYXNlR2V0KG9iamVjdCwgcGF0aCkge1xuICBwYXRoID0gY2FzdFBhdGgocGF0aCwgb2JqZWN0KTtcblxuICB2YXIgaW5kZXggPSAwLFxuICAgICAgbGVuZ3RoID0gcGF0aC5sZW5ndGg7XG5cbiAgd2hpbGUgKG9iamVjdCAhPSBudWxsICYmIGluZGV4IDwgbGVuZ3RoKSB7XG4gICAgb2JqZWN0ID0gb2JqZWN0W3RvS2V5KHBhdGhbaW5kZXgrK10pXTtcbiAgfVxuICByZXR1cm4gKGluZGV4ICYmIGluZGV4ID09IGxlbmd0aCkgPyBvYmplY3QgOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VHZXQ7XG4iLCJpbXBvcnQgYmFzZUdldCBmcm9tICcuL19iYXNlR2V0LmpzJztcblxuLyoqXG4gKiBHZXRzIHRoZSB2YWx1ZSBhdCBgcGF0aGAgb2YgYG9iamVjdGAuIElmIHRoZSByZXNvbHZlZCB2YWx1ZSBpc1xuICogYHVuZGVmaW5lZGAsIHRoZSBgZGVmYXVsdFZhbHVlYCBpcyByZXR1cm5lZCBpbiBpdHMgcGxhY2UuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAzLjcuMFxuICogQGNhdGVnb3J5IE9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICogQHBhcmFtIHtBcnJheXxzdHJpbmd9IHBhdGggVGhlIHBhdGggb2YgdGhlIHByb3BlcnR5IHRvIGdldC5cbiAqIEBwYXJhbSB7Kn0gW2RlZmF1bHRWYWx1ZV0gVGhlIHZhbHVlIHJldHVybmVkIGZvciBgdW5kZWZpbmVkYCByZXNvbHZlZCB2YWx1ZXMuXG4gKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuXG4gKiBAZXhhbXBsZVxuICpcbiAqIHZhciBvYmplY3QgPSB7ICdhJzogW3sgJ2InOiB7ICdjJzogMyB9IH1dIH07XG4gKlxuICogXy5nZXQob2JqZWN0LCAnYVswXS5iLmMnKTtcbiAqIC8vID0+IDNcbiAqXG4gKiBfLmdldChvYmplY3QsIFsnYScsICcwJywgJ2InLCAnYyddKTtcbiAqIC8vID0+IDNcbiAqXG4gKiBfLmdldChvYmplY3QsICdhLmIuYycsICdkZWZhdWx0Jyk7XG4gKiAvLyA9PiAnZGVmYXVsdCdcbiAqL1xuZnVuY3Rpb24gZ2V0KG9iamVjdCwgcGF0aCwgZGVmYXVsdFZhbHVlKSB7XG4gIHZhciByZXN1bHQgPSBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IGJhc2VHZXQob2JqZWN0LCBwYXRoKTtcbiAgcmV0dXJuIHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdFZhbHVlIDogcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBnZXQ7XG4iLCIvKipcbiAqIEFwcGVuZHMgdGhlIGVsZW1lbnRzIG9mIGB2YWx1ZXNgIHRvIGBhcnJheWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byBhcHBlbmQuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC5cbiAqL1xuZnVuY3Rpb24gYXJyYXlQdXNoKGFycmF5LCB2YWx1ZXMpIHtcbiAgdmFyIGluZGV4ID0gLTEsXG4gICAgICBsZW5ndGggPSB2YWx1ZXMubGVuZ3RoLFxuICAgICAgb2Zmc2V0ID0gYXJyYXkubGVuZ3RoO1xuXG4gIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XG4gICAgYXJyYXlbb2Zmc2V0ICsgaW5kZXhdID0gdmFsdWVzW2luZGV4XTtcbiAgfVxuICByZXR1cm4gYXJyYXk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFycmF5UHVzaDtcbiIsImltcG9ydCBvdmVyQXJnIGZyb20gJy4vX292ZXJBcmcuanMnO1xuXG4vKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi9cbnZhciBnZXRQcm90b3R5cGUgPSBvdmVyQXJnKE9iamVjdC5nZXRQcm90b3R5cGVPZiwgT2JqZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgZ2V0UHJvdG90eXBlO1xuIiwiLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5zbGljZWAgd2l0aG91dCBhbiBpdGVyYXRlZSBjYWxsIGd1YXJkLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gc2xpY2UuXG4gKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgc2xpY2Ugb2YgYGFycmF5YC5cbiAqL1xuZnVuY3Rpb24gYmFzZVNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xuXG4gIGlmIChzdGFydCA8IDApIHtcbiAgICBzdGFydCA9IC1zdGFydCA+IGxlbmd0aCA/IDAgOiAobGVuZ3RoICsgc3RhcnQpO1xuICB9XG4gIGVuZCA9IGVuZCA+IGxlbmd0aCA/IGxlbmd0aCA6IGVuZDtcbiAgaWYgKGVuZCA8IDApIHtcbiAgICBlbmQgKz0gbGVuZ3RoO1xuICB9XG4gIGxlbmd0aCA9IHN0YXJ0ID4gZW5kID8gMCA6ICgoZW5kIC0gc3RhcnQpID4+PiAwKTtcbiAgc3RhcnQgPj4+PSAwO1xuXG4gIHZhciByZXN1bHQgPSBBcnJheShsZW5ndGgpO1xuICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgIHJlc3VsdFtpbmRleF0gPSBhcnJheVtpbmRleCArIHN0YXJ0XTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlU2xpY2U7XG4iLCJpbXBvcnQgTGlzdENhY2hlIGZyb20gJy4vX0xpc3RDYWNoZS5qcyc7XG5cbi8qKlxuICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgc3RhY2suXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGNsZWFyXG4gKiBAbWVtYmVyT2YgU3RhY2tcbiAqL1xuZnVuY3Rpb24gc3RhY2tDbGVhcigpIHtcbiAgdGhpcy5fX2RhdGFfXyA9IG5ldyBMaXN0Q2FjaGU7XG4gIHRoaXMuc2l6ZSA9IDA7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YWNrQ2xlYXI7XG4iLCIvKipcbiAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBzdGFjay5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgZGVsZXRlXG4gKiBAbWVtYmVyT2YgU3RhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBzdGFja0RlbGV0ZShrZXkpIHtcbiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLFxuICAgICAgcmVzdWx0ID0gZGF0YVsnZGVsZXRlJ10oa2V5KTtcblxuICB0aGlzLnNpemUgPSBkYXRhLnNpemU7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YWNrRGVsZXRlO1xuIiwiLyoqXG4gKiBHZXRzIHRoZSBzdGFjayB2YWx1ZSBmb3IgYGtleWAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBuYW1lIGdldFxuICogQG1lbWJlck9mIFN0YWNrXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gc3RhY2tHZXQoa2V5KSB7XG4gIHJldHVybiB0aGlzLl9fZGF0YV9fLmdldChrZXkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzdGFja0dldDtcbiIsIi8qKlxuICogQ2hlY2tzIGlmIGEgc3RhY2sgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgaGFzXG4gKiBAbWVtYmVyT2YgU3RhY2tcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBzdGFja0hhcyhrZXkpIHtcbiAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKGtleSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YWNrSGFzO1xuIiwiaW1wb3J0IExpc3RDYWNoZSBmcm9tICcuL19MaXN0Q2FjaGUuanMnO1xuaW1wb3J0IE1hcCBmcm9tICcuL19NYXAuanMnO1xuaW1wb3J0IE1hcENhY2hlIGZyb20gJy4vX01hcENhY2hlLmpzJztcblxuLyoqIFVzZWQgYXMgdGhlIHNpemUgdG8gZW5hYmxlIGxhcmdlIGFycmF5IG9wdGltaXphdGlvbnMuICovXG52YXIgTEFSR0VfQVJSQVlfU0laRSA9IDIwMDtcblxuLyoqXG4gKiBTZXRzIHRoZSBzdGFjayBga2V5YCB0byBgdmFsdWVgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAbmFtZSBzZXRcbiAqIEBtZW1iZXJPZiBTdGFja1xuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBzdGFjayBjYWNoZSBpbnN0YW5jZS5cbiAqL1xuZnVuY3Rpb24gc3RhY2tTZXQoa2V5LCB2YWx1ZSkge1xuICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187XG4gIGlmIChkYXRhIGluc3RhbmNlb2YgTGlzdENhY2hlKSB7XG4gICAgdmFyIHBhaXJzID0gZGF0YS5fX2RhdGFfXztcbiAgICBpZiAoIU1hcCB8fCAocGFpcnMubGVuZ3RoIDwgTEFSR0VfQVJSQVlfU0laRSAtIDEpKSB7XG4gICAgICBwYWlycy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgICB0aGlzLnNpemUgPSArK2RhdGEuc2l6ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBkYXRhID0gdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZShwYWlycyk7XG4gIH1cbiAgZGF0YS5zZXQoa2V5LCB2YWx1ZSk7XG4gIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTtcbiAgcmV0dXJuIHRoaXM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YWNrU2V0O1xuIiwiaW1wb3J0IExpc3RDYWNoZSBmcm9tICcuL19MaXN0Q2FjaGUuanMnO1xuaW1wb3J0IHN0YWNrQ2xlYXIgZnJvbSAnLi9fc3RhY2tDbGVhci5qcyc7XG5pbXBvcnQgc3RhY2tEZWxldGUgZnJvbSAnLi9fc3RhY2tEZWxldGUuanMnO1xuaW1wb3J0IHN0YWNrR2V0IGZyb20gJy4vX3N0YWNrR2V0LmpzJztcbmltcG9ydCBzdGFja0hhcyBmcm9tICcuL19zdGFja0hhcy5qcyc7XG5pbXBvcnQgc3RhY2tTZXQgZnJvbSAnLi9fc3RhY2tTZXQuanMnO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBzdGFjayBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLlxuICovXG5mdW5jdGlvbiBTdGFjayhlbnRyaWVzKSB7XG4gIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXyA9IG5ldyBMaXN0Q2FjaGUoZW50cmllcyk7XG4gIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTtcbn1cblxuLy8gQWRkIG1ldGhvZHMgdG8gYFN0YWNrYC5cblN0YWNrLnByb3RvdHlwZS5jbGVhciA9IHN0YWNrQ2xlYXI7XG5TdGFjay5wcm90b3R5cGVbJ2RlbGV0ZSddID0gc3RhY2tEZWxldGU7XG5TdGFjay5wcm90b3R5cGUuZ2V0ID0gc3RhY2tHZXQ7XG5TdGFjay5wcm90b3R5cGUuaGFzID0gc3RhY2tIYXM7XG5TdGFjay5wcm90b3R5cGUuc2V0ID0gc3RhY2tTZXQ7XG5cbmV4cG9ydCBkZWZhdWx0IFN0YWNrO1xuIiwiaW1wb3J0IGNvcHlPYmplY3QgZnJvbSAnLi9fY29weU9iamVjdC5qcyc7XG5pbXBvcnQga2V5cyBmcm9tICcuL2tleXMuanMnO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmFzc2lnbmAgd2l0aG91dCBzdXBwb3J0IGZvciBtdWx0aXBsZSBzb3VyY2VzXG4gKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAqL1xuZnVuY3Rpb24gYmFzZUFzc2lnbihvYmplY3QsIHNvdXJjZSkge1xuICByZXR1cm4gb2JqZWN0ICYmIGNvcHlPYmplY3Qoc291cmNlLCBrZXlzKHNvdXJjZSksIG9iamVjdCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VBc3NpZ247XG4iLCJpbXBvcnQgY29weU9iamVjdCBmcm9tICcuL19jb3B5T2JqZWN0LmpzJztcbmltcG9ydCBrZXlzSW4gZnJvbSAnLi9rZXlzSW4uanMnO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmFzc2lnbkluYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXNcbiAqIG9yIGBjdXN0b21pemVyYCBmdW5jdGlvbnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIGRlc3RpbmF0aW9uIG9iamVjdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIHNvdXJjZSBvYmplY3QuXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICovXG5mdW5jdGlvbiBiYXNlQXNzaWduSW4ob2JqZWN0LCBzb3VyY2UpIHtcbiAgcmV0dXJuIG9iamVjdCAmJiBjb3B5T2JqZWN0KHNvdXJjZSwga2V5c0luKHNvdXJjZSksIG9iamVjdCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VBc3NpZ25JbjtcbiIsImltcG9ydCByb290IGZyb20gJy4vX3Jvb3QuanMnO1xuXG4vKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGV4cG9ydHNgLiAqL1xudmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzO1xuXG4vKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYG1vZHVsZWAuICovXG52YXIgZnJlZU1vZHVsZSA9IGZyZWVFeHBvcnRzICYmIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlO1xuXG4vKiogRGV0ZWN0IHRoZSBwb3B1bGFyIENvbW1vbkpTIGV4dGVuc2lvbiBgbW9kdWxlLmV4cG9ydHNgLiAqL1xudmFyIG1vZHVsZUV4cG9ydHMgPSBmcmVlTW9kdWxlICYmIGZyZWVNb2R1bGUuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHM7XG5cbi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqL1xudmFyIEJ1ZmZlciA9IG1vZHVsZUV4cG9ydHMgPyByb290LkJ1ZmZlciA6IHVuZGVmaW5lZCxcbiAgICBhbGxvY1Vuc2FmZSA9IEJ1ZmZlciA/IEJ1ZmZlci5hbGxvY1Vuc2FmZSA6IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBDcmVhdGVzIGEgY2xvbmUgb2YgIGBidWZmZXJgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0J1ZmZlcn0gYnVmZmVyIFRoZSBidWZmZXIgdG8gY2xvbmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLlxuICogQHJldHVybnMge0J1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGJ1ZmZlci5cbiAqL1xuZnVuY3Rpb24gY2xvbmVCdWZmZXIoYnVmZmVyLCBpc0RlZXApIHtcbiAgaWYgKGlzRGVlcCkge1xuICAgIHJldHVybiBidWZmZXIuc2xpY2UoKTtcbiAgfVxuICB2YXIgbGVuZ3RoID0gYnVmZmVyLmxlbmd0aCxcbiAgICAgIHJlc3VsdCA9IGFsbG9jVW5zYWZlID8gYWxsb2NVbnNhZmUobGVuZ3RoKSA6IG5ldyBidWZmZXIuY29uc3RydWN0b3IobGVuZ3RoKTtcblxuICBidWZmZXIuY29weShyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbG9uZUJ1ZmZlcjtcbiIsIi8qKlxuICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLmZpbHRlcmAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yXG4gKiBpdGVyYXRlZSBzaG9ydGhhbmRzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGZpbHRlcmVkIGFycmF5LlxuICovXG5mdW5jdGlvbiBhcnJheUZpbHRlcihhcnJheSwgcHJlZGljYXRlKSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsXG4gICAgICByZXNJbmRleCA9IDAsXG4gICAgICByZXN1bHQgPSBbXTtcblxuICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkge1xuICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTtcbiAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgYXJyYXkpKSB7XG4gICAgICByZXN1bHRbcmVzSW5kZXgrK10gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXJyYXlGaWx0ZXI7XG4iLCIvKipcbiAqIFRoaXMgbWV0aG9kIHJldHVybnMgYSBuZXcgZW1wdHkgYXJyYXkuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjEzLjBcbiAqIEBjYXRlZ29yeSBVdGlsXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIG5ldyBlbXB0eSBhcnJheS5cbiAqIEBleGFtcGxlXG4gKlxuICogdmFyIGFycmF5cyA9IF8udGltZXMoMiwgXy5zdHViQXJyYXkpO1xuICpcbiAqIGNvbnNvbGUubG9nKGFycmF5cyk7XG4gKiAvLyA9PiBbW10sIFtdXVxuICpcbiAqIGNvbnNvbGUubG9nKGFycmF5c1swXSA9PT0gYXJyYXlzWzFdKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbmZ1bmN0aW9uIHN0dWJBcnJheSgpIHtcbiAgcmV0dXJuIFtdO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzdHViQXJyYXk7XG4iLCJpbXBvcnQgYXJyYXlGaWx0ZXIgZnJvbSAnLi9fYXJyYXlGaWx0ZXIuanMnO1xuaW1wb3J0IHN0dWJBcnJheSBmcm9tICcuL3N0dWJBcnJheS5qcyc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqL1xudmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8ucHJvcGVydHlJc0VudW1lcmFibGU7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi9cbnZhciBuYXRpdmVHZXRTeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scztcblxuLyoqXG4gKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBzeW1ib2xzIG9mIGBvYmplY3RgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHN5bWJvbHMuXG4gKi9cbnZhciBnZXRTeW1ib2xzID0gIW5hdGl2ZUdldFN5bWJvbHMgPyBzdHViQXJyYXkgOiBmdW5jdGlvbihvYmplY3QpIHtcbiAgaWYgKG9iamVjdCA9PSBudWxsKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIG9iamVjdCA9IE9iamVjdChvYmplY3QpO1xuICByZXR1cm4gYXJyYXlGaWx0ZXIobmF0aXZlR2V0U3ltYm9scyhvYmplY3QpLCBmdW5jdGlvbihzeW1ib2wpIHtcbiAgICByZXR1cm4gcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChvYmplY3QsIHN5bWJvbCk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZ2V0U3ltYm9scztcbiIsImltcG9ydCBjb3B5T2JqZWN0IGZyb20gJy4vX2NvcHlPYmplY3QuanMnO1xuaW1wb3J0IGdldFN5bWJvbHMgZnJvbSAnLi9fZ2V0U3ltYm9scy5qcyc7XG5cbi8qKlxuICogQ29waWVzIG93biBzeW1ib2xzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uXG4gKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHN5bWJvbHMgdG8uXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLlxuICovXG5mdW5jdGlvbiBjb3B5U3ltYm9scyhzb3VyY2UsIG9iamVjdCkge1xuICByZXR1cm4gY29weU9iamVjdChzb3VyY2UsIGdldFN5bWJvbHMoc291cmNlKSwgb2JqZWN0KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY29weVN5bWJvbHM7XG4iLCJpbXBvcnQgYXJyYXlQdXNoIGZyb20gJy4vX2FycmF5UHVzaC5qcyc7XG5pbXBvcnQgZ2V0UHJvdG90eXBlIGZyb20gJy4vX2dldFByb3RvdHlwZS5qcyc7XG5pbXBvcnQgZ2V0U3ltYm9scyBmcm9tICcuL19nZXRTeW1ib2xzLmpzJztcbmltcG9ydCBzdHViQXJyYXkgZnJvbSAnLi9zdHViQXJyYXkuanMnO1xuXG4vKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyBmb3IgdGhvc2Ugd2l0aCB0aGUgc2FtZSBuYW1lIGFzIG90aGVyIGBsb2Rhc2hgIG1ldGhvZHMuICovXG52YXIgbmF0aXZlR2V0U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGFuZCBpbmhlcml0ZWQgZW51bWVyYWJsZSBzeW1ib2xzIG9mIGBvYmplY3RgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHN5bWJvbHMuXG4gKi9cbnZhciBnZXRTeW1ib2xzSW4gPSAhbmF0aXZlR2V0U3ltYm9scyA/IHN0dWJBcnJheSA6IGZ1bmN0aW9uKG9iamVjdCkge1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHdoaWxlIChvYmplY3QpIHtcbiAgICBhcnJheVB1c2gocmVzdWx0LCBnZXRTeW1ib2xzKG9iamVjdCkpO1xuICAgIG9iamVjdCA9IGdldFByb3RvdHlwZShvYmplY3QpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnZXRTeW1ib2xzSW47XG4iLCJpbXBvcnQgY29weU9iamVjdCBmcm9tICcuL19jb3B5T2JqZWN0LmpzJztcbmltcG9ydCBnZXRTeW1ib2xzSW4gZnJvbSAnLi9fZ2V0U3ltYm9sc0luLmpzJztcblxuLyoqXG4gKiBDb3BpZXMgb3duIGFuZCBpbmhlcml0ZWQgc3ltYm9scyBvZiBgc291cmNlYCB0byBgb2JqZWN0YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgb2JqZWN0IHRvIGNvcHkgc3ltYm9scyBmcm9tLlxuICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgb2JqZWN0YC5cbiAqL1xuZnVuY3Rpb24gY29weVN5bWJvbHNJbihzb3VyY2UsIG9iamVjdCkge1xuICByZXR1cm4gY29weU9iamVjdChzb3VyY2UsIGdldFN5bWJvbHNJbihzb3VyY2UpLCBvYmplY3QpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjb3B5U3ltYm9sc0luO1xuIiwiaW1wb3J0IGFycmF5UHVzaCBmcm9tICcuL19hcnJheVB1c2guanMnO1xuaW1wb3J0IGlzQXJyYXkgZnJvbSAnLi9pc0FycmF5LmpzJztcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0QWxsS2V5c2AgYW5kIGBnZXRBbGxLZXlzSW5gIHdoaWNoIHVzZXNcbiAqIGBrZXlzRnVuY2AgYW5kIGBzeW1ib2xzRnVuY2AgdG8gZ2V0IHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIGFuZFxuICogc3ltYm9scyBvZiBgb2JqZWN0YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IHN5bWJvbHNGdW5jIFRoZSBmdW5jdGlvbiB0byBnZXQgdGhlIHN5bWJvbHMgb2YgYG9iamVjdGAuXG4gKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzLlxuICovXG5mdW5jdGlvbiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXNGdW5jLCBzeW1ib2xzRnVuYykge1xuICB2YXIgcmVzdWx0ID0ga2V5c0Z1bmMob2JqZWN0KTtcbiAgcmV0dXJuIGlzQXJyYXkob2JqZWN0KSA/IHJlc3VsdCA6IGFycmF5UHVzaChyZXN1bHQsIHN5bWJvbHNGdW5jKG9iamVjdCkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlR2V0QWxsS2V5cztcbiIsImltcG9ydCBiYXNlR2V0QWxsS2V5cyBmcm9tICcuL19iYXNlR2V0QWxsS2V5cy5qcyc7XG5pbXBvcnQgZ2V0U3ltYm9scyBmcm9tICcuL19nZXRTeW1ib2xzLmpzJztcbmltcG9ydCBrZXlzIGZyb20gJy4va2V5cy5qcyc7XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scyBvZiBgb2JqZWN0YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scy5cbiAqL1xuZnVuY3Rpb24gZ2V0QWxsS2V5cyhvYmplY3QpIHtcbiAgcmV0dXJuIGJhc2VHZXRBbGxLZXlzKG9iamVjdCwga2V5cywgZ2V0U3ltYm9scyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdldEFsbEtleXM7XG4iLCJpbXBvcnQgZ2V0TmF0aXZlIGZyb20gJy4vX2dldE5hdGl2ZS5qcyc7XG5pbXBvcnQgcm9vdCBmcm9tICcuL19yb290LmpzJztcblxuLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqL1xudmFyIERhdGFWaWV3ID0gZ2V0TmF0aXZlKHJvb3QsICdEYXRhVmlldycpO1xuXG5leHBvcnQgZGVmYXVsdCBEYXRhVmlldztcbiIsImltcG9ydCBnZXROYXRpdmUgZnJvbSAnLi9fZ2V0TmF0aXZlLmpzJztcbmltcG9ydCByb290IGZyb20gJy4vX3Jvb3QuanMnO1xuXG4vKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyB0aGF0IGFyZSB2ZXJpZmllZCB0byBiZSBuYXRpdmUuICovXG52YXIgUHJvbWlzZSA9IGdldE5hdGl2ZShyb290LCAnUHJvbWlzZScpO1xuXG5leHBvcnQgZGVmYXVsdCBQcm9taXNlO1xuIiwiaW1wb3J0IGdldE5hdGl2ZSBmcm9tICcuL19nZXROYXRpdmUuanMnO1xuaW1wb3J0IHJvb3QgZnJvbSAnLi9fcm9vdC5qcyc7XG5cbi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHRoYXQgYXJlIHZlcmlmaWVkIHRvIGJlIG5hdGl2ZS4gKi9cbnZhciBTZXQgPSBnZXROYXRpdmUocm9vdCwgJ1NldCcpO1xuXG5leHBvcnQgZGVmYXVsdCBTZXQ7XG4iLCJpbXBvcnQgRGF0YVZpZXcgZnJvbSAnLi9fRGF0YVZpZXcuanMnO1xuaW1wb3J0IE1hcCBmcm9tICcuL19NYXAuanMnO1xuaW1wb3J0IFByb21pc2UgZnJvbSAnLi9fUHJvbWlzZS5qcyc7XG5pbXBvcnQgU2V0IGZyb20gJy4vX1NldC5qcyc7XG5pbXBvcnQgV2Vha01hcCBmcm9tICcuL19XZWFrTWFwLmpzJztcbmltcG9ydCBiYXNlR2V0VGFnIGZyb20gJy4vX2Jhc2VHZXRUYWcuanMnO1xuaW1wb3J0IHRvU291cmNlIGZyb20gJy4vX3RvU291cmNlLmpzJztcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIG1hcFRhZyA9ICdbb2JqZWN0IE1hcF0nLFxuICAgIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nLFxuICAgIHByb21pc2VUYWcgPSAnW29iamVjdCBQcm9taXNlXScsXG4gICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsXG4gICAgd2Vha01hcFRhZyA9ICdbb2JqZWN0IFdlYWtNYXBdJztcblxudmFyIGRhdGFWaWV3VGFnID0gJ1tvYmplY3QgRGF0YVZpZXddJztcblxuLyoqIFVzZWQgdG8gZGV0ZWN0IG1hcHMsIHNldHMsIGFuZCB3ZWFrbWFwcy4gKi9cbnZhciBkYXRhVmlld0N0b3JTdHJpbmcgPSB0b1NvdXJjZShEYXRhVmlldyksXG4gICAgbWFwQ3RvclN0cmluZyA9IHRvU291cmNlKE1hcCksXG4gICAgcHJvbWlzZUN0b3JTdHJpbmcgPSB0b1NvdXJjZShQcm9taXNlKSxcbiAgICBzZXRDdG9yU3RyaW5nID0gdG9Tb3VyY2UoU2V0KSxcbiAgICB3ZWFrTWFwQ3RvclN0cmluZyA9IHRvU291cmNlKFdlYWtNYXApO1xuXG4vKipcbiAqIEdldHMgdGhlIGB0b1N0cmluZ1RhZ2Agb2YgYHZhbHVlYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLlxuICovXG52YXIgZ2V0VGFnID0gYmFzZUdldFRhZztcblxuLy8gRmFsbGJhY2sgZm9yIGRhdGEgdmlld3MsIG1hcHMsIHNldHMsIGFuZCB3ZWFrIG1hcHMgaW4gSUUgMTEgYW5kIHByb21pc2VzIGluIE5vZGUuanMgPCA2LlxuaWYgKChEYXRhVmlldyAmJiBnZXRUYWcobmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcigxKSkpICE9IGRhdGFWaWV3VGFnKSB8fFxuICAgIChNYXAgJiYgZ2V0VGFnKG5ldyBNYXApICE9IG1hcFRhZykgfHxcbiAgICAoUHJvbWlzZSAmJiBnZXRUYWcoUHJvbWlzZS5yZXNvbHZlKCkpICE9IHByb21pc2VUYWcpIHx8XG4gICAgKFNldCAmJiBnZXRUYWcobmV3IFNldCkgIT0gc2V0VGFnKSB8fFxuICAgIChXZWFrTWFwICYmIGdldFRhZyhuZXcgV2Vha01hcCkgIT0gd2Vha01hcFRhZykpIHtcbiAgZ2V0VGFnID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICB2YXIgcmVzdWx0ID0gYmFzZUdldFRhZyh2YWx1ZSksXG4gICAgICAgIEN0b3IgPSByZXN1bHQgPT0gb2JqZWN0VGFnID8gdmFsdWUuY29uc3RydWN0b3IgOiB1bmRlZmluZWQsXG4gICAgICAgIGN0b3JTdHJpbmcgPSBDdG9yID8gdG9Tb3VyY2UoQ3RvcikgOiAnJztcblxuICAgIGlmIChjdG9yU3RyaW5nKSB7XG4gICAgICBzd2l0Y2ggKGN0b3JTdHJpbmcpIHtcbiAgICAgICAgY2FzZSBkYXRhVmlld0N0b3JTdHJpbmc6IHJldHVybiBkYXRhVmlld1RhZztcbiAgICAgICAgY2FzZSBtYXBDdG9yU3RyaW5nOiByZXR1cm4gbWFwVGFnO1xuICAgICAgICBjYXNlIHByb21pc2VDdG9yU3RyaW5nOiByZXR1cm4gcHJvbWlzZVRhZztcbiAgICAgICAgY2FzZSBzZXRDdG9yU3RyaW5nOiByZXR1cm4gc2V0VGFnO1xuICAgICAgICBjYXNlIHdlYWtNYXBDdG9yU3RyaW5nOiByZXR1cm4gd2Vha01hcFRhZztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZ2V0VGFnO1xuIiwiLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqL1xudmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovXG52YXIgaGFzT3duUHJvcGVydHkgPSBvYmplY3RQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuLyoqXG4gKiBJbml0aWFsaXplcyBhbiBhcnJheSBjbG9uZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNsb25lLlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS5cbiAqL1xuZnVuY3Rpb24gaW5pdENsb25lQXJyYXkoYXJyYXkpIHtcbiAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCxcbiAgICAgIHJlc3VsdCA9IG5ldyBhcnJheS5jb25zdHJ1Y3RvcihsZW5ndGgpO1xuXG4gIC8vIEFkZCBwcm9wZXJ0aWVzIGFzc2lnbmVkIGJ5IGBSZWdFeHAjZXhlY2AuXG4gIGlmIChsZW5ndGggJiYgdHlwZW9mIGFycmF5WzBdID09ICdzdHJpbmcnICYmIGhhc093blByb3BlcnR5LmNhbGwoYXJyYXksICdpbmRleCcpKSB7XG4gICAgcmVzdWx0LmluZGV4ID0gYXJyYXkuaW5kZXg7XG4gICAgcmVzdWx0LmlucHV0ID0gYXJyYXkuaW5wdXQ7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaW5pdENsb25lQXJyYXk7XG4iLCJpbXBvcnQgcm9vdCBmcm9tICcuL19yb290LmpzJztcblxuLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovXG52YXIgVWludDhBcnJheSA9IHJvb3QuVWludDhBcnJheTtcblxuZXhwb3J0IGRlZmF1bHQgVWludDhBcnJheTtcbiIsImltcG9ydCBVaW50OEFycmF5IGZyb20gJy4vX1VpbnQ4QXJyYXkuanMnO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgYXJyYXlCdWZmZXJgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnJheUJ1ZmZlciBUaGUgYXJyYXkgYnVmZmVyIHRvIGNsb25lLlxuICogQHJldHVybnMge0FycmF5QnVmZmVyfSBSZXR1cm5zIHRoZSBjbG9uZWQgYXJyYXkgYnVmZmVyLlxuICovXG5mdW5jdGlvbiBjbG9uZUFycmF5QnVmZmVyKGFycmF5QnVmZmVyKSB7XG4gIHZhciByZXN1bHQgPSBuZXcgYXJyYXlCdWZmZXIuY29uc3RydWN0b3IoYXJyYXlCdWZmZXIuYnl0ZUxlbmd0aCk7XG4gIG5ldyBVaW50OEFycmF5KHJlc3VsdCkuc2V0KG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsb25lQXJyYXlCdWZmZXI7XG4iLCJpbXBvcnQgY2xvbmVBcnJheUJ1ZmZlciBmcm9tICcuL19jbG9uZUFycmF5QnVmZmVyLmpzJztcblxuLyoqXG4gKiBDcmVhdGVzIGEgY2xvbmUgb2YgYGRhdGFWaWV3YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IGRhdGFWaWV3IFRoZSBkYXRhIHZpZXcgdG8gY2xvbmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIGRhdGEgdmlldy5cbiAqL1xuZnVuY3Rpb24gY2xvbmVEYXRhVmlldyhkYXRhVmlldywgaXNEZWVwKSB7XG4gIHZhciBidWZmZXIgPSBpc0RlZXAgPyBjbG9uZUFycmF5QnVmZmVyKGRhdGFWaWV3LmJ1ZmZlcikgOiBkYXRhVmlldy5idWZmZXI7XG4gIHJldHVybiBuZXcgZGF0YVZpZXcuY29uc3RydWN0b3IoYnVmZmVyLCBkYXRhVmlldy5ieXRlT2Zmc2V0LCBkYXRhVmlldy5ieXRlTGVuZ3RoKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xvbmVEYXRhVmlldztcbiIsIi8qKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIGZsYWdzIGZyb20gdGhlaXIgY29lcmNlZCBzdHJpbmcgdmFsdWVzLiAqL1xudmFyIHJlRmxhZ3MgPSAvXFx3KiQvO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgcmVnZXhwYC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IHJlZ2V4cCBUaGUgcmVnZXhwIHRvIGNsb25lLlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIHJlZ2V4cC5cbiAqL1xuZnVuY3Rpb24gY2xvbmVSZWdFeHAocmVnZXhwKSB7XG4gIHZhciByZXN1bHQgPSBuZXcgcmVnZXhwLmNvbnN0cnVjdG9yKHJlZ2V4cC5zb3VyY2UsIHJlRmxhZ3MuZXhlYyhyZWdleHApKTtcbiAgcmVzdWx0Lmxhc3RJbmRleCA9IHJlZ2V4cC5sYXN0SW5kZXg7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsb25lUmVnRXhwO1xuIiwiaW1wb3J0IFN5bWJvbCBmcm9tICcuL19TeW1ib2wuanMnO1xuXG4vKiogVXNlZCB0byBjb252ZXJ0IHN5bWJvbHMgdG8gcHJpbWl0aXZlcyBhbmQgc3RyaW5ncy4gKi9cbnZhciBzeW1ib2xQcm90byA9IFN5bWJvbCA/IFN5bWJvbC5wcm90b3R5cGUgOiB1bmRlZmluZWQsXG4gICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGBzeW1ib2xgIG9iamVjdC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IHN5bWJvbCBUaGUgc3ltYm9sIG9iamVjdCB0byBjbG9uZS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCBzeW1ib2wgb2JqZWN0LlxuICovXG5mdW5jdGlvbiBjbG9uZVN5bWJvbChzeW1ib2wpIHtcbiAgcmV0dXJuIHN5bWJvbFZhbHVlT2YgPyBPYmplY3Qoc3ltYm9sVmFsdWVPZi5jYWxsKHN5bWJvbCkpIDoge307XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsb25lU3ltYm9sO1xuIiwiaW1wb3J0IGNsb25lQXJyYXlCdWZmZXIgZnJvbSAnLi9fY2xvbmVBcnJheUJ1ZmZlci5qcyc7XG5cbi8qKlxuICogQ3JlYXRlcyBhIGNsb25lIG9mIGB0eXBlZEFycmF5YC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IHR5cGVkQXJyYXkgVGhlIHR5cGVkIGFycmF5IHRvIGNsb25lLlxuICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCB0eXBlZCBhcnJheS5cbiAqL1xuZnVuY3Rpb24gY2xvbmVUeXBlZEFycmF5KHR5cGVkQXJyYXksIGlzRGVlcCkge1xuICB2YXIgYnVmZmVyID0gaXNEZWVwID8gY2xvbmVBcnJheUJ1ZmZlcih0eXBlZEFycmF5LmJ1ZmZlcikgOiB0eXBlZEFycmF5LmJ1ZmZlcjtcbiAgcmV0dXJuIG5ldyB0eXBlZEFycmF5LmNvbnN0cnVjdG9yKGJ1ZmZlciwgdHlwZWRBcnJheS5ieXRlT2Zmc2V0LCB0eXBlZEFycmF5Lmxlbmd0aCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsb25lVHlwZWRBcnJheTtcbiIsImltcG9ydCBjbG9uZUFycmF5QnVmZmVyIGZyb20gJy4vX2Nsb25lQXJyYXlCdWZmZXIuanMnO1xuaW1wb3J0IGNsb25lRGF0YVZpZXcgZnJvbSAnLi9fY2xvbmVEYXRhVmlldy5qcyc7XG5pbXBvcnQgY2xvbmVSZWdFeHAgZnJvbSAnLi9fY2xvbmVSZWdFeHAuanMnO1xuaW1wb3J0IGNsb25lU3ltYm9sIGZyb20gJy4vX2Nsb25lU3ltYm9sLmpzJztcbmltcG9ydCBjbG9uZVR5cGVkQXJyYXkgZnJvbSAnLi9fY2xvbmVUeXBlZEFycmF5LmpzJztcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsXG4gICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJyxcbiAgICBudW1iZXJUYWcgPSAnW29iamVjdCBOdW1iZXJdJyxcbiAgICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJyxcbiAgICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJyxcbiAgICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJyxcbiAgICBzeW1ib2xUYWcgPSAnW29iamVjdCBTeW1ib2xdJztcblxudmFyIGFycmF5QnVmZmVyVGFnID0gJ1tvYmplY3QgQXJyYXlCdWZmZXJdJyxcbiAgICBkYXRhVmlld1RhZyA9ICdbb2JqZWN0IERhdGFWaWV3XScsXG4gICAgZmxvYXQzMlRhZyA9ICdbb2JqZWN0IEZsb2F0MzJBcnJheV0nLFxuICAgIGZsb2F0NjRUYWcgPSAnW29iamVjdCBGbG9hdDY0QXJyYXldJyxcbiAgICBpbnQ4VGFnID0gJ1tvYmplY3QgSW50OEFycmF5XScsXG4gICAgaW50MTZUYWcgPSAnW29iamVjdCBJbnQxNkFycmF5XScsXG4gICAgaW50MzJUYWcgPSAnW29iamVjdCBJbnQzMkFycmF5XScsXG4gICAgdWludDhUYWcgPSAnW29iamVjdCBVaW50OEFycmF5XScsXG4gICAgdWludDhDbGFtcGVkVGFnID0gJ1tvYmplY3QgVWludDhDbGFtcGVkQXJyYXldJyxcbiAgICB1aW50MTZUYWcgPSAnW29iamVjdCBVaW50MTZBcnJheV0nLFxuICAgIHVpbnQzMlRhZyA9ICdbb2JqZWN0IFVpbnQzMkFycmF5XSc7XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lIGJhc2VkIG9uIGl0cyBgdG9TdHJpbmdUYWdgLlxuICpcbiAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIG9ubHkgc3VwcG9ydHMgY2xvbmluZyB2YWx1ZXMgd2l0aCB0YWdzIG9mXG4gKiBgQm9vbGVhbmAsIGBEYXRlYCwgYEVycm9yYCwgYE1hcGAsIGBOdW1iZXJgLCBgUmVnRXhwYCwgYFNldGAsIG9yIGBTdHJpbmdgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2xvbmUuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFnIFRoZSBgdG9TdHJpbmdUYWdgIG9mIHRoZSBvYmplY3QgdG8gY2xvbmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuXG4gKi9cbmZ1bmN0aW9uIGluaXRDbG9uZUJ5VGFnKG9iamVjdCwgdGFnLCBpc0RlZXApIHtcbiAgdmFyIEN0b3IgPSBvYmplY3QuY29uc3RydWN0b3I7XG4gIHN3aXRjaCAodGFnKSB7XG4gICAgY2FzZSBhcnJheUJ1ZmZlclRhZzpcbiAgICAgIHJldHVybiBjbG9uZUFycmF5QnVmZmVyKG9iamVjdCk7XG5cbiAgICBjYXNlIGJvb2xUYWc6XG4gICAgY2FzZSBkYXRlVGFnOlxuICAgICAgcmV0dXJuIG5ldyBDdG9yKCtvYmplY3QpO1xuXG4gICAgY2FzZSBkYXRhVmlld1RhZzpcbiAgICAgIHJldHVybiBjbG9uZURhdGFWaWV3KG9iamVjdCwgaXNEZWVwKTtcblxuICAgIGNhc2UgZmxvYXQzMlRhZzogY2FzZSBmbG9hdDY0VGFnOlxuICAgIGNhc2UgaW50OFRhZzogY2FzZSBpbnQxNlRhZzogY2FzZSBpbnQzMlRhZzpcbiAgICBjYXNlIHVpbnQ4VGFnOiBjYXNlIHVpbnQ4Q2xhbXBlZFRhZzogY2FzZSB1aW50MTZUYWc6IGNhc2UgdWludDMyVGFnOlxuICAgICAgcmV0dXJuIGNsb25lVHlwZWRBcnJheShvYmplY3QsIGlzRGVlcCk7XG5cbiAgICBjYXNlIG1hcFRhZzpcbiAgICAgIHJldHVybiBuZXcgQ3RvcjtcblxuICAgIGNhc2UgbnVtYmVyVGFnOlxuICAgIGNhc2Ugc3RyaW5nVGFnOlxuICAgICAgcmV0dXJuIG5ldyBDdG9yKG9iamVjdCk7XG5cbiAgICBjYXNlIHJlZ2V4cFRhZzpcbiAgICAgIHJldHVybiBjbG9uZVJlZ0V4cChvYmplY3QpO1xuXG4gICAgY2FzZSBzZXRUYWc6XG4gICAgICByZXR1cm4gbmV3IEN0b3I7XG5cbiAgICBjYXNlIHN5bWJvbFRhZzpcbiAgICAgIHJldHVybiBjbG9uZVN5bWJvbChvYmplY3QpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGluaXRDbG9uZUJ5VGFnO1xuIiwiaW1wb3J0IGJhc2VDcmVhdGUgZnJvbSAnLi9fYmFzZUNyZWF0ZS5qcyc7XG5pbXBvcnQgZ2V0UHJvdG90eXBlIGZyb20gJy4vX2dldFByb3RvdHlwZS5qcyc7XG5pbXBvcnQgaXNQcm90b3R5cGUgZnJvbSAnLi9faXNQcm90b3R5cGUuanMnO1xuXG4vKipcbiAqIEluaXRpYWxpemVzIGFuIG9iamVjdCBjbG9uZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNsb25lLlxuICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuXG4gKi9cbmZ1bmN0aW9uIGluaXRDbG9uZU9iamVjdChvYmplY3QpIHtcbiAgcmV0dXJuICh0eXBlb2Ygb2JqZWN0LmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgIWlzUHJvdG90eXBlKG9iamVjdCkpXG4gICAgPyBiYXNlQ3JlYXRlKGdldFByb3RvdHlwZShvYmplY3QpKVxuICAgIDoge307XG59XG5cbmV4cG9ydCBkZWZhdWx0IGluaXRDbG9uZU9iamVjdDtcbiIsImltcG9ydCBnZXRUYWcgZnJvbSAnLi9fZ2V0VGFnLmpzJztcbmltcG9ydCBpc09iamVjdExpa2UgZnJvbSAnLi9pc09iamVjdExpa2UuanMnO1xuXG4vKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovXG52YXIgbWFwVGFnID0gJ1tvYmplY3QgTWFwXSc7XG5cbi8qKlxuICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNNYXBgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbWFwLCBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGJhc2VJc01hcCh2YWx1ZSkge1xuICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBnZXRUYWcodmFsdWUpID09IG1hcFRhZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgYmFzZUlzTWFwO1xuIiwiaW1wb3J0IGJhc2VJc01hcCBmcm9tICcuL19iYXNlSXNNYXAuanMnO1xuaW1wb3J0IGJhc2VVbmFyeSBmcm9tICcuL19iYXNlVW5hcnkuanMnO1xuaW1wb3J0IG5vZGVVdGlsIGZyb20gJy4vX25vZGVVdGlsLmpzJztcblxuLyogTm9kZS5qcyBoZWxwZXIgcmVmZXJlbmNlcy4gKi9cbnZhciBub2RlSXNNYXAgPSBub2RlVXRpbCAmJiBub2RlVXRpbC5pc01hcDtcblxuLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYE1hcGAgb2JqZWN0LlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4zLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbWFwLCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8uaXNNYXAobmV3IE1hcCk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc01hcChuZXcgV2Vha01hcCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG52YXIgaXNNYXAgPSBub2RlSXNNYXAgPyBiYXNlVW5hcnkobm9kZUlzTWFwKSA6IGJhc2VJc01hcDtcblxuZXhwb3J0IGRlZmF1bHQgaXNNYXA7XG4iLCJpbXBvcnQgZ2V0VGFnIGZyb20gJy4vX2dldFRhZy5qcyc7XG5pbXBvcnQgaXNPYmplY3RMaWtlIGZyb20gJy4vaXNPYmplY3RMaWtlLmpzJztcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIHNldFRhZyA9ICdbb2JqZWN0IFNldF0nO1xuXG4vKipcbiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzU2V0YCB3aXRob3V0IE5vZGUuanMgb3B0aW1pemF0aW9ucy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBiYXNlSXNTZXQodmFsdWUpIHtcbiAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgZ2V0VGFnKHZhbHVlKSA9PSBzZXRUYWc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VJc1NldDtcbiIsImltcG9ydCBiYXNlSXNTZXQgZnJvbSAnLi9fYmFzZUlzU2V0LmpzJztcbmltcG9ydCBiYXNlVW5hcnkgZnJvbSAnLi9fYmFzZVVuYXJ5LmpzJztcbmltcG9ydCBub2RlVXRpbCBmcm9tICcuL19ub2RlVXRpbC5qcyc7XG5cbi8qIE5vZGUuanMgaGVscGVyIHJlZmVyZW5jZXMuICovXG52YXIgbm9kZUlzU2V0ID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNTZXQ7XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTZXRgIG9iamVjdC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDQuMy4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHNldCwgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiBfLmlzU2V0KG5ldyBTZXQpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNTZXQobmV3IFdlYWtTZXQpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xudmFyIGlzU2V0ID0gbm9kZUlzU2V0ID8gYmFzZVVuYXJ5KG5vZGVJc1NldCkgOiBiYXNlSXNTZXQ7XG5cbmV4cG9ydCBkZWZhdWx0IGlzU2V0O1xuIiwiaW1wb3J0IFN0YWNrIGZyb20gJy4vX1N0YWNrLmpzJztcbmltcG9ydCBhcnJheUVhY2ggZnJvbSAnLi9fYXJyYXlFYWNoLmpzJztcbmltcG9ydCBhc3NpZ25WYWx1ZSBmcm9tICcuL19hc3NpZ25WYWx1ZS5qcyc7XG5pbXBvcnQgYmFzZUFzc2lnbiBmcm9tICcuL19iYXNlQXNzaWduLmpzJztcbmltcG9ydCBiYXNlQXNzaWduSW4gZnJvbSAnLi9fYmFzZUFzc2lnbkluLmpzJztcbmltcG9ydCBjbG9uZUJ1ZmZlciBmcm9tICcuL19jbG9uZUJ1ZmZlci5qcyc7XG5pbXBvcnQgY29weUFycmF5IGZyb20gJy4vX2NvcHlBcnJheS5qcyc7XG5pbXBvcnQgY29weVN5bWJvbHMgZnJvbSAnLi9fY29weVN5bWJvbHMuanMnO1xuaW1wb3J0IGNvcHlTeW1ib2xzSW4gZnJvbSAnLi9fY29weVN5bWJvbHNJbi5qcyc7XG5pbXBvcnQgZ2V0QWxsS2V5cyBmcm9tICcuL19nZXRBbGxLZXlzLmpzJztcbmltcG9ydCBnZXRBbGxLZXlzSW4gZnJvbSAnLi9fZ2V0QWxsS2V5c0luLmpzJztcbmltcG9ydCBnZXRUYWcgZnJvbSAnLi9fZ2V0VGFnLmpzJztcbmltcG9ydCBpbml0Q2xvbmVBcnJheSBmcm9tICcuL19pbml0Q2xvbmVBcnJheS5qcyc7XG5pbXBvcnQgaW5pdENsb25lQnlUYWcgZnJvbSAnLi9faW5pdENsb25lQnlUYWcuanMnO1xuaW1wb3J0IGluaXRDbG9uZU9iamVjdCBmcm9tICcuL19pbml0Q2xvbmVPYmplY3QuanMnO1xuaW1wb3J0IGlzQXJyYXkgZnJvbSAnLi9pc0FycmF5LmpzJztcbmltcG9ydCBpc0J1ZmZlciBmcm9tICcuL2lzQnVmZmVyLmpzJztcbmltcG9ydCBpc01hcCBmcm9tICcuL2lzTWFwLmpzJztcbmltcG9ydCBpc09iamVjdCBmcm9tICcuL2lzT2JqZWN0LmpzJztcbmltcG9ydCBpc1NldCBmcm9tICcuL2lzU2V0LmpzJztcbmltcG9ydCBrZXlzIGZyb20gJy4va2V5cy5qcyc7XG5pbXBvcnQga2V5c0luIGZyb20gJy4va2V5c0luLmpzJztcblxuLyoqIFVzZWQgdG8gY29tcG9zZSBiaXRtYXNrcyBmb3IgY2xvbmluZy4gKi9cbnZhciBDTE9ORV9ERUVQX0ZMQUcgPSAxLFxuICAgIENMT05FX0ZMQVRfRkxBRyA9IDIsXG4gICAgQ0xPTkVfU1lNQk9MU19GTEFHID0gNDtcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJyxcbiAgICBhcnJheVRhZyA9ICdbb2JqZWN0IEFycmF5XScsXG4gICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJyxcbiAgICBkYXRlVGFnID0gJ1tvYmplY3QgRGF0ZV0nLFxuICAgIGVycm9yVGFnID0gJ1tvYmplY3QgRXJyb3JdJyxcbiAgICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJyxcbiAgICBnZW5UYWcgPSAnW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0nLFxuICAgIG1hcFRhZyA9ICdbb2JqZWN0IE1hcF0nLFxuICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLFxuICAgIG9iamVjdFRhZyA9ICdbb2JqZWN0IE9iamVjdF0nLFxuICAgIHJlZ2V4cFRhZyA9ICdbb2JqZWN0IFJlZ0V4cF0nLFxuICAgIHNldFRhZyA9ICdbb2JqZWN0IFNldF0nLFxuICAgIHN0cmluZ1RhZyA9ICdbb2JqZWN0IFN0cmluZ10nLFxuICAgIHN5bWJvbFRhZyA9ICdbb2JqZWN0IFN5bWJvbF0nLFxuICAgIHdlYWtNYXBUYWcgPSAnW29iamVjdCBXZWFrTWFwXSc7XG5cbnZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsXG4gICAgZGF0YVZpZXdUYWcgPSAnW29iamVjdCBEYXRhVmlld10nLFxuICAgIGZsb2F0MzJUYWcgPSAnW29iamVjdCBGbG9hdDMyQXJyYXldJyxcbiAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsXG4gICAgaW50OFRhZyA9ICdbb2JqZWN0IEludDhBcnJheV0nLFxuICAgIGludDE2VGFnID0gJ1tvYmplY3QgSW50MTZBcnJheV0nLFxuICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLFxuICAgIHVpbnQ4VGFnID0gJ1tvYmplY3QgVWludDhBcnJheV0nLFxuICAgIHVpbnQ4Q2xhbXBlZFRhZyA9ICdbb2JqZWN0IFVpbnQ4Q2xhbXBlZEFycmF5XScsXG4gICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJyxcbiAgICB1aW50MzJUYWcgPSAnW29iamVjdCBVaW50MzJBcnJheV0nO1xuXG4vKiogVXNlZCB0byBpZGVudGlmeSBgdG9TdHJpbmdUYWdgIHZhbHVlcyBzdXBwb3J0ZWQgYnkgYF8uY2xvbmVgLiAqL1xudmFyIGNsb25lYWJsZVRhZ3MgPSB7fTtcbmNsb25lYWJsZVRhZ3NbYXJnc1RhZ10gPSBjbG9uZWFibGVUYWdzW2FycmF5VGFnXSA9XG5jbG9uZWFibGVUYWdzW2FycmF5QnVmZmVyVGFnXSA9IGNsb25lYWJsZVRhZ3NbZGF0YVZpZXdUYWddID1cbmNsb25lYWJsZVRhZ3NbYm9vbFRhZ10gPSBjbG9uZWFibGVUYWdzW2RhdGVUYWddID1cbmNsb25lYWJsZVRhZ3NbZmxvYXQzMlRhZ10gPSBjbG9uZWFibGVUYWdzW2Zsb2F0NjRUYWddID1cbmNsb25lYWJsZVRhZ3NbaW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW2ludDE2VGFnXSA9XG5jbG9uZWFibGVUYWdzW2ludDMyVGFnXSA9IGNsb25lYWJsZVRhZ3NbbWFwVGFnXSA9XG5jbG9uZWFibGVUYWdzW251bWJlclRhZ10gPSBjbG9uZWFibGVUYWdzW29iamVjdFRhZ10gPVxuY2xvbmVhYmxlVGFnc1tyZWdleHBUYWddID0gY2xvbmVhYmxlVGFnc1tzZXRUYWddID1cbmNsb25lYWJsZVRhZ3Nbc3RyaW5nVGFnXSA9IGNsb25lYWJsZVRhZ3Nbc3ltYm9sVGFnXSA9XG5jbG9uZWFibGVUYWdzW3VpbnQ4VGFnXSA9IGNsb25lYWJsZVRhZ3NbdWludDhDbGFtcGVkVGFnXSA9XG5jbG9uZWFibGVUYWdzW3VpbnQxNlRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQzMlRhZ10gPSB0cnVlO1xuY2xvbmVhYmxlVGFnc1tlcnJvclRhZ10gPSBjbG9uZWFibGVUYWdzW2Z1bmNUYWddID1cbmNsb25lYWJsZVRhZ3Nbd2Vha01hcFRhZ10gPSBmYWxzZTtcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5jbG9uZWAgYW5kIGBfLmNsb25lRGVlcGAgd2hpY2ggdHJhY2tzXG4gKiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuXG4gKiAgMSAtIERlZXAgY2xvbmVcbiAqICAyIC0gRmxhdHRlbiBpbmhlcml0ZWQgcHJvcGVydGllc1xuICogIDQgLSBDbG9uZSBzeW1ib2xzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nLlxuICogQHBhcmFtIHtzdHJpbmd9IFtrZXldIFRoZSBrZXkgb2YgYHZhbHVlYC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgcGFyZW50IG9iamVjdCBvZiBgdmFsdWVgLlxuICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGFuZCB0aGVpciBjbG9uZSBjb3VudGVycGFydHMuXG4gKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLlxuICovXG5mdW5jdGlvbiBiYXNlQ2xvbmUodmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGtleSwgb2JqZWN0LCBzdGFjaykge1xuICB2YXIgcmVzdWx0LFxuICAgICAgaXNEZWVwID0gYml0bWFzayAmIENMT05FX0RFRVBfRkxBRyxcbiAgICAgIGlzRmxhdCA9IGJpdG1hc2sgJiBDTE9ORV9GTEFUX0ZMQUcsXG4gICAgICBpc0Z1bGwgPSBiaXRtYXNrICYgQ0xPTkVfU1lNQk9MU19GTEFHO1xuXG4gIGlmIChjdXN0b21pemVyKSB7XG4gICAgcmVzdWx0ID0gb2JqZWN0ID8gY3VzdG9taXplcih2YWx1ZSwga2V5LCBvYmplY3QsIHN0YWNrKSA6IGN1c3RvbWl6ZXIodmFsdWUpO1xuICB9XG4gIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgdmFyIGlzQXJyID0gaXNBcnJheSh2YWx1ZSk7XG4gIGlmIChpc0Fycikge1xuICAgIHJlc3VsdCA9IGluaXRDbG9uZUFycmF5KHZhbHVlKTtcbiAgICBpZiAoIWlzRGVlcCkge1xuICAgICAgcmV0dXJuIGNvcHlBcnJheSh2YWx1ZSwgcmVzdWx0KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFyIHRhZyA9IGdldFRhZyh2YWx1ZSksXG4gICAgICAgIGlzRnVuYyA9IHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWc7XG5cbiAgICBpZiAoaXNCdWZmZXIodmFsdWUpKSB7XG4gICAgICByZXR1cm4gY2xvbmVCdWZmZXIodmFsdWUsIGlzRGVlcCk7XG4gICAgfVxuICAgIGlmICh0YWcgPT0gb2JqZWN0VGFnIHx8IHRhZyA9PSBhcmdzVGFnIHx8IChpc0Z1bmMgJiYgIW9iamVjdCkpIHtcbiAgICAgIHJlc3VsdCA9IChpc0ZsYXQgfHwgaXNGdW5jKSA/IHt9IDogaW5pdENsb25lT2JqZWN0KHZhbHVlKTtcbiAgICAgIGlmICghaXNEZWVwKSB7XG4gICAgICAgIHJldHVybiBpc0ZsYXRcbiAgICAgICAgICA/IGNvcHlTeW1ib2xzSW4odmFsdWUsIGJhc2VBc3NpZ25JbihyZXN1bHQsIHZhbHVlKSlcbiAgICAgICAgICA6IGNvcHlTeW1ib2xzKHZhbHVlLCBiYXNlQXNzaWduKHJlc3VsdCwgdmFsdWUpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFjbG9uZWFibGVUYWdzW3RhZ10pIHtcbiAgICAgICAgcmV0dXJuIG9iamVjdCA/IHZhbHVlIDoge307XG4gICAgICB9XG4gICAgICByZXN1bHQgPSBpbml0Q2xvbmVCeVRhZyh2YWx1ZSwgdGFnLCBpc0RlZXApO1xuICAgIH1cbiAgfVxuICAvLyBDaGVjayBmb3IgY2lyY3VsYXIgcmVmZXJlbmNlcyBhbmQgcmV0dXJuIGl0cyBjb3JyZXNwb25kaW5nIGNsb25lLlxuICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spO1xuICB2YXIgc3RhY2tlZCA9IHN0YWNrLmdldCh2YWx1ZSk7XG4gIGlmIChzdGFja2VkKSB7XG4gICAgcmV0dXJuIHN0YWNrZWQ7XG4gIH1cbiAgc3RhY2suc2V0KHZhbHVlLCByZXN1bHQpO1xuXG4gIGlmIChpc1NldCh2YWx1ZSkpIHtcbiAgICB2YWx1ZS5mb3JFYWNoKGZ1bmN0aW9uKHN1YlZhbHVlKSB7XG4gICAgICByZXN1bHQuYWRkKGJhc2VDbG9uZShzdWJWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3ViVmFsdWUsIHZhbHVlLCBzdGFjaykpO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKGlzTWFwKHZhbHVlKSkge1xuICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24oc3ViVmFsdWUsIGtleSkge1xuICAgICAgcmVzdWx0LnNldChrZXksIGJhc2VDbG9uZShzdWJWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCB2YWx1ZSwgc3RhY2spKTtcbiAgICB9KTtcbiAgfVxuXG4gIHZhciBrZXlzRnVuYyA9IGlzRnVsbFxuICAgID8gKGlzRmxhdCA/IGdldEFsbEtleXNJbiA6IGdldEFsbEtleXMpXG4gICAgOiAoaXNGbGF0ID8ga2V5c0luIDoga2V5cyk7XG5cbiAgdmFyIHByb3BzID0gaXNBcnIgPyB1bmRlZmluZWQgOiBrZXlzRnVuYyh2YWx1ZSk7XG4gIGFycmF5RWFjaChwcm9wcyB8fCB2YWx1ZSwgZnVuY3Rpb24oc3ViVmFsdWUsIGtleSkge1xuICAgIGlmIChwcm9wcykge1xuICAgICAga2V5ID0gc3ViVmFsdWU7XG4gICAgICBzdWJWYWx1ZSA9IHZhbHVlW2tleV07XG4gICAgfVxuICAgIC8vIFJlY3Vyc2l2ZWx5IHBvcHVsYXRlIGNsb25lIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgYXNzaWduVmFsdWUocmVzdWx0LCBrZXksIGJhc2VDbG9uZShzdWJWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwga2V5LCB2YWx1ZSwgc3RhY2spKTtcbiAgfSk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VDbG9uZTtcbiIsImltcG9ydCBiYXNlQ2xvbmUgZnJvbSAnLi9fYmFzZUNsb25lLmpzJztcblxuLyoqIFVzZWQgdG8gY29tcG9zZSBiaXRtYXNrcyBmb3IgY2xvbmluZy4gKi9cbnZhciBDTE9ORV9TWU1CT0xTX0ZMQUcgPSA0O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBzaGFsbG93IGNsb25lIG9mIGB2YWx1ZWAuXG4gKlxuICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24gdGhlXG4gKiBbc3RydWN0dXJlZCBjbG9uZSBhbGdvcml0aG1dKGh0dHBzOi8vbWRuLmlvL1N0cnVjdHVyZWRfY2xvbmVfYWxnb3JpdGhtKVxuICogYW5kIHN1cHBvcnRzIGNsb25pbmcgYXJyYXlzLCBhcnJheSBidWZmZXJzLCBib29sZWFucywgZGF0ZSBvYmplY3RzLCBtYXBzLFxuICogbnVtYmVycywgYE9iamVjdGAgb2JqZWN0cywgcmVnZXhlcywgc2V0cywgc3RyaW5ncywgc3ltYm9scywgYW5kIHR5cGVkXG4gKiBhcnJheXMuIFRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0aWVzIG9mIGBhcmd1bWVudHNgIG9iamVjdHMgYXJlIGNsb25lZFxuICogYXMgcGxhaW4gb2JqZWN0cy4gQW4gZW1wdHkgb2JqZWN0IGlzIHJldHVybmVkIGZvciB1bmNsb25lYWJsZSB2YWx1ZXMgc3VjaFxuICogYXMgZXJyb3Igb2JqZWN0cywgZnVuY3Rpb25zLCBET00gbm9kZXMsIGFuZCBXZWFrTWFwcy5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuXG4gKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgY2xvbmVkIHZhbHVlLlxuICogQHNlZSBfLmNsb25lRGVlcFxuICogQGV4YW1wbGVcbiAqXG4gKiB2YXIgb2JqZWN0cyA9IFt7ICdhJzogMSB9LCB7ICdiJzogMiB9XTtcbiAqXG4gKiB2YXIgc2hhbGxvdyA9IF8uY2xvbmUob2JqZWN0cyk7XG4gKiBjb25zb2xlLmxvZyhzaGFsbG93WzBdID09PSBvYmplY3RzWzBdKTtcbiAqIC8vID0+IHRydWVcbiAqL1xuZnVuY3Rpb24gY2xvbmUodmFsdWUpIHtcbiAgcmV0dXJuIGJhc2VDbG9uZSh2YWx1ZSwgQ0xPTkVfU1lNQk9MU19GTEFHKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xvbmU7XG4iLCIvKiogVXNlZCB0byBzdGFuZC1pbiBmb3IgYHVuZGVmaW5lZGAgaGFzaCB2YWx1ZXMuICovXG52YXIgSEFTSF9VTkRFRklORUQgPSAnX19sb2Rhc2hfaGFzaF91bmRlZmluZWRfXyc7XG5cbi8qKlxuICogQWRkcyBgdmFsdWVgIHRvIHRoZSBhcnJheSBjYWNoZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgYWRkXG4gKiBAbWVtYmVyT2YgU2V0Q2FjaGVcbiAqIEBhbGlhcyBwdXNoXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjYWNoZS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNhY2hlIGluc3RhbmNlLlxuICovXG5mdW5jdGlvbiBzZXRDYWNoZUFkZCh2YWx1ZSkge1xuICB0aGlzLl9fZGF0YV9fLnNldCh2YWx1ZSwgSEFTSF9VTkRFRklORUQpO1xuICByZXR1cm4gdGhpcztcbn1cblxuZXhwb3J0IGRlZmF1bHQgc2V0Q2FjaGVBZGQ7XG4iLCIvKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGluIHRoZSBhcnJheSBjYWNoZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQG5hbWUgaGFzXG4gKiBAbWVtYmVyT2YgU2V0Q2FjaGVcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNlYXJjaCBmb3IuXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIHNldENhY2hlSGFzKHZhbHVlKSB7XG4gIHJldHVybiB0aGlzLl9fZGF0YV9fLmhhcyh2YWx1ZSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHNldENhY2hlSGFzO1xuIiwiaW1wb3J0IE1hcENhY2hlIGZyb20gJy4vX01hcENhY2hlLmpzJztcbmltcG9ydCBzZXRDYWNoZUFkZCBmcm9tICcuL19zZXRDYWNoZUFkZC5qcyc7XG5pbXBvcnQgc2V0Q2FjaGVIYXMgZnJvbSAnLi9fc2V0Q2FjaGVIYXMuanMnO1xuXG4vKipcbiAqXG4gKiBDcmVhdGVzIGFuIGFycmF5IGNhY2hlIG9iamVjdCB0byBzdG9yZSB1bmlxdWUgdmFsdWVzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7QXJyYXl9IFt2YWx1ZXNdIFRoZSB2YWx1ZXMgdG8gY2FjaGUuXG4gKi9cbmZ1bmN0aW9uIFNldENhY2hlKHZhbHVlcykge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIGxlbmd0aCA9IHZhbHVlcyA9PSBudWxsID8gMCA6IHZhbHVlcy5sZW5ndGg7XG5cbiAgdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZTtcbiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICB0aGlzLmFkZCh2YWx1ZXNbaW5kZXhdKTtcbiAgfVxufVxuXG4vLyBBZGQgbWV0aG9kcyB0byBgU2V0Q2FjaGVgLlxuU2V0Q2FjaGUucHJvdG90eXBlLmFkZCA9IFNldENhY2hlLnByb3RvdHlwZS5wdXNoID0gc2V0Q2FjaGVBZGQ7XG5TZXRDYWNoZS5wcm90b3R5cGUuaGFzID0gc2V0Q2FjaGVIYXM7XG5cbmV4cG9ydCBkZWZhdWx0IFNldENhY2hlO1xuIiwiLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc29tZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlXG4gKiBzaG9ydGhhbmRzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkaWNhdGUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjayxcbiAqICBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7XG5cbiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHtcbiAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXJyYXlTb21lO1xuIiwiLyoqXG4gKiBDaGVja3MgaWYgYSBgY2FjaGVgIHZhbHVlIGZvciBga2V5YCBleGlzdHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBjYWNoZSBUaGUgY2FjaGUgdG8gcXVlcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gY2FjaGVIYXMoY2FjaGUsIGtleSkge1xuICByZXR1cm4gY2FjaGUuaGFzKGtleSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNhY2hlSGFzO1xuIiwiaW1wb3J0IFNldENhY2hlIGZyb20gJy4vX1NldENhY2hlLmpzJztcbmltcG9ydCBhcnJheVNvbWUgZnJvbSAnLi9fYXJyYXlTb21lLmpzJztcbmltcG9ydCBjYWNoZUhhcyBmcm9tICcuL19jYWNoZUhhcy5qcyc7XG5cbi8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIHZhbHVlIGNvbXBhcmlzb25zLiAqL1xudmFyIENPTVBBUkVfUEFSVElBTF9GTEFHID0gMSxcbiAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjtcblxuLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGFycmF5cyB3aXRoIHN1cHBvcnQgZm9yXG4gKiBwYXJ0aWFsIGRlZXAgY29tcGFyaXNvbnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBjb21wYXJlLlxuICogQHBhcmFtIHtBcnJheX0gb3RoZXIgVGhlIG90aGVyIGFycmF5IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGN1c3RvbWl6ZXIgVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBhcnJheWAgYW5kIGBvdGhlcmAgb2JqZWN0cy5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXJyYXlzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuXG4gKi9cbmZ1bmN0aW9uIGVxdWFsQXJyYXlzKGFycmF5LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykge1xuICB2YXIgaXNQYXJ0aWFsID0gYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHLFxuICAgICAgYXJyTGVuZ3RoID0gYXJyYXkubGVuZ3RoLFxuICAgICAgb3RoTGVuZ3RoID0gb3RoZXIubGVuZ3RoO1xuXG4gIGlmIChhcnJMZW5ndGggIT0gb3RoTGVuZ3RoICYmICEoaXNQYXJ0aWFsICYmIG90aExlbmd0aCA+IGFyckxlbmd0aCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gQ2hlY2sgdGhhdCBjeWNsaWMgdmFsdWVzIGFyZSBlcXVhbC5cbiAgdmFyIGFyclN0YWNrZWQgPSBzdGFjay5nZXQoYXJyYXkpO1xuICB2YXIgb3RoU3RhY2tlZCA9IHN0YWNrLmdldChvdGhlcik7XG4gIGlmIChhcnJTdGFja2VkICYmIG90aFN0YWNrZWQpIHtcbiAgICByZXR1cm4gYXJyU3RhY2tlZCA9PSBvdGhlciAmJiBvdGhTdGFja2VkID09IGFycmF5O1xuICB9XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgcmVzdWx0ID0gdHJ1ZSxcbiAgICAgIHNlZW4gPSAoYml0bWFzayAmIENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcpID8gbmV3IFNldENhY2hlIDogdW5kZWZpbmVkO1xuXG4gIHN0YWNrLnNldChhcnJheSwgb3RoZXIpO1xuICBzdGFjay5zZXQob3RoZXIsIGFycmF5KTtcblxuICAvLyBJZ25vcmUgbm9uLWluZGV4IHByb3BlcnRpZXMuXG4gIHdoaWxlICgrK2luZGV4IDwgYXJyTGVuZ3RoKSB7XG4gICAgdmFyIGFyclZhbHVlID0gYXJyYXlbaW5kZXhdLFxuICAgICAgICBvdGhWYWx1ZSA9IG90aGVyW2luZGV4XTtcblxuICAgIGlmIChjdXN0b21pemVyKSB7XG4gICAgICB2YXIgY29tcGFyZWQgPSBpc1BhcnRpYWxcbiAgICAgICAgPyBjdXN0b21pemVyKG90aFZhbHVlLCBhcnJWYWx1ZSwgaW5kZXgsIG90aGVyLCBhcnJheSwgc3RhY2spXG4gICAgICAgIDogY3VzdG9taXplcihhcnJWYWx1ZSwgb3RoVmFsdWUsIGluZGV4LCBhcnJheSwgb3RoZXIsIHN0YWNrKTtcbiAgICB9XG4gICAgaWYgKGNvbXBhcmVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChjb21wYXJlZCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgaWYgKHNlZW4pIHtcbiAgICAgIGlmICghYXJyYXlTb21lKG90aGVyLCBmdW5jdGlvbihvdGhWYWx1ZSwgb3RoSW5kZXgpIHtcbiAgICAgICAgICAgIGlmICghY2FjaGVIYXMoc2Vlbiwgb3RoSW5kZXgpICYmXG4gICAgICAgICAgICAgICAgKGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fCBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaykpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzZWVuLnB1c2gob3RoSW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKSB7XG4gICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCEoXG4gICAgICAgICAgYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8XG4gICAgICAgICAgICBlcXVhbEZ1bmMoYXJyVmFsdWUsIG90aFZhbHVlLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaylcbiAgICAgICAgKSkge1xuICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgc3RhY2tbJ2RlbGV0ZSddKGFycmF5KTtcbiAgc3RhY2tbJ2RlbGV0ZSddKG90aGVyKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZXF1YWxBcnJheXM7XG4iLCIvKipcbiAqIENvbnZlcnRzIGBtYXBgIHRvIGl0cyBrZXktdmFsdWUgcGFpcnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBjb252ZXJ0LlxuICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBrZXktdmFsdWUgcGFpcnMuXG4gKi9cbmZ1bmN0aW9uIG1hcFRvQXJyYXkobWFwKSB7XG4gIHZhciBpbmRleCA9IC0xLFxuICAgICAgcmVzdWx0ID0gQXJyYXkobWFwLnNpemUpO1xuXG4gIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICByZXN1bHRbKytpbmRleF0gPSBba2V5LCB2YWx1ZV07XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZGVmYXVsdCBtYXBUb0FycmF5O1xuIiwiLyoqXG4gKiBDb252ZXJ0cyBgc2V0YCB0byBhbiBhcnJheSBvZiBpdHMgdmFsdWVzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gc2V0IFRoZSBzZXQgdG8gY29udmVydC5cbiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgdmFsdWVzLlxuICovXG5mdW5jdGlvbiBzZXRUb0FycmF5KHNldCkge1xuICB2YXIgaW5kZXggPSAtMSxcbiAgICAgIHJlc3VsdCA9IEFycmF5KHNldC5zaXplKTtcblxuICBzZXQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJlc3VsdFsrK2luZGV4XSA9IHZhbHVlO1xuICB9KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc2V0VG9BcnJheTtcbiIsImltcG9ydCBTeW1ib2wgZnJvbSAnLi9fU3ltYm9sLmpzJztcbmltcG9ydCBVaW50OEFycmF5IGZyb20gJy4vX1VpbnQ4QXJyYXkuanMnO1xuaW1wb3J0IGVxIGZyb20gJy4vZXEuanMnO1xuaW1wb3J0IGVxdWFsQXJyYXlzIGZyb20gJy4vX2VxdWFsQXJyYXlzLmpzJztcbmltcG9ydCBtYXBUb0FycmF5IGZyb20gJy4vX21hcFRvQXJyYXkuanMnO1xuaW1wb3J0IHNldFRvQXJyYXkgZnJvbSAnLi9fc2V0VG9BcnJheS5qcyc7XG5cbi8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIHZhbHVlIGNvbXBhcmlzb25zLiAqL1xudmFyIENPTVBBUkVfUEFSVElBTF9GTEFHID0gMSxcbiAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjtcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGJvb2xUYWcgPSAnW29iamVjdCBCb29sZWFuXScsXG4gICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJyxcbiAgICBlcnJvclRhZyA9ICdbb2JqZWN0IEVycm9yXScsXG4gICAgbWFwVGFnID0gJ1tvYmplY3QgTWFwXScsXG4gICAgbnVtYmVyVGFnID0gJ1tvYmplY3QgTnVtYmVyXScsXG4gICAgcmVnZXhwVGFnID0gJ1tvYmplY3QgUmVnRXhwXScsXG4gICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsXG4gICAgc3RyaW5nVGFnID0gJ1tvYmplY3QgU3RyaW5nXScsXG4gICAgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXSc7XG5cbnZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsXG4gICAgZGF0YVZpZXdUYWcgPSAnW29iamVjdCBEYXRhVmlld10nO1xuXG4vKiogVXNlZCB0byBjb252ZXJ0IHN5bWJvbHMgdG8gcHJpbWl0aXZlcyBhbmQgc3RyaW5ncy4gKi9cbnZhciBzeW1ib2xQcm90byA9IFN5bWJvbCA/IFN5bWJvbC5wcm90b3R5cGUgOiB1bmRlZmluZWQsXG4gICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGNvbXBhcmluZyBvYmplY3RzIG9mXG4gKiB0aGUgc2FtZSBgdG9TdHJpbmdUYWdgLlxuICpcbiAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIG9ubHkgc3VwcG9ydHMgY29tcGFyaW5nIHZhbHVlcyB3aXRoIHRhZ3Mgb2ZcbiAqIGBCb29sZWFuYCwgYERhdGVgLCBgRXJyb3JgLCBgTnVtYmVyYCwgYFJlZ0V4cGAsIG9yIGBTdHJpbmdgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFnIFRoZSBgdG9TdHJpbmdUYWdgIG9mIHRoZSBvYmplY3RzIHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGN1c3RvbWl6ZXIgVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCB0YWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHtcbiAgc3dpdGNoICh0YWcpIHtcbiAgICBjYXNlIGRhdGFWaWV3VGFnOlxuICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fFxuICAgICAgICAgIChvYmplY3QuYnl0ZU9mZnNldCAhPSBvdGhlci5ieXRlT2Zmc2V0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBvYmplY3QgPSBvYmplY3QuYnVmZmVyO1xuICAgICAgb3RoZXIgPSBvdGhlci5idWZmZXI7XG5cbiAgICBjYXNlIGFycmF5QnVmZmVyVGFnOlxuICAgICAgaWYgKChvYmplY3QuYnl0ZUxlbmd0aCAhPSBvdGhlci5ieXRlTGVuZ3RoKSB8fFxuICAgICAgICAgICFlcXVhbEZ1bmMobmV3IFVpbnQ4QXJyYXkob2JqZWN0KSwgbmV3IFVpbnQ4QXJyYXkob3RoZXIpKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcblxuICAgIGNhc2UgYm9vbFRhZzpcbiAgICBjYXNlIGRhdGVUYWc6XG4gICAgY2FzZSBudW1iZXJUYWc6XG4gICAgICAvLyBDb2VyY2UgYm9vbGVhbnMgdG8gYDFgIG9yIGAwYCBhbmQgZGF0ZXMgdG8gbWlsbGlzZWNvbmRzLlxuICAgICAgLy8gSW52YWxpZCBkYXRlcyBhcmUgY29lcmNlZCB0byBgTmFOYC5cbiAgICAgIHJldHVybiBlcSgrb2JqZWN0LCArb3RoZXIpO1xuXG4gICAgY2FzZSBlcnJvclRhZzpcbiAgICAgIHJldHVybiBvYmplY3QubmFtZSA9PSBvdGhlci5uYW1lICYmIG9iamVjdC5tZXNzYWdlID09IG90aGVyLm1lc3NhZ2U7XG5cbiAgICBjYXNlIHJlZ2V4cFRhZzpcbiAgICBjYXNlIHN0cmluZ1RhZzpcbiAgICAgIC8vIENvZXJjZSByZWdleGVzIHRvIHN0cmluZ3MgYW5kIHRyZWF0IHN0cmluZ3MsIHByaW1pdGl2ZXMgYW5kIG9iamVjdHMsXG4gICAgICAvLyBhcyBlcXVhbC4gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1yZWdleHAucHJvdG90eXBlLnRvc3RyaW5nXG4gICAgICAvLyBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAgcmV0dXJuIG9iamVjdCA9PSAob3RoZXIgKyAnJyk7XG5cbiAgICBjYXNlIG1hcFRhZzpcbiAgICAgIHZhciBjb252ZXJ0ID0gbWFwVG9BcnJheTtcblxuICAgIGNhc2Ugc2V0VGFnOlxuICAgICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRztcbiAgICAgIGNvbnZlcnQgfHwgKGNvbnZlcnQgPSBzZXRUb0FycmF5KTtcblxuICAgICAgaWYgKG9iamVjdC5zaXplICE9IG90aGVyLnNpemUgJiYgIWlzUGFydGlhbCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBBc3N1bWUgY3ljbGljIHZhbHVlcyBhcmUgZXF1YWwuXG4gICAgICB2YXIgc3RhY2tlZCA9IHN0YWNrLmdldChvYmplY3QpO1xuICAgICAgaWYgKHN0YWNrZWQpIHtcbiAgICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7XG4gICAgICB9XG4gICAgICBiaXRtYXNrIHw9IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUc7XG5cbiAgICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgb2JqZWN0cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgICAgc3RhY2suc2V0KG9iamVjdCwgb3RoZXIpO1xuICAgICAgdmFyIHJlc3VsdCA9IGVxdWFsQXJyYXlzKGNvbnZlcnQob2JqZWN0KSwgY29udmVydChvdGhlciksIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spO1xuICAgICAgc3RhY2tbJ2RlbGV0ZSddKG9iamVjdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgY2FzZSBzeW1ib2xUYWc6XG4gICAgICBpZiAoc3ltYm9sVmFsdWVPZikge1xuICAgICAgICByZXR1cm4gc3ltYm9sVmFsdWVPZi5jYWxsKG9iamVjdCkgPT0gc3ltYm9sVmFsdWVPZi5jYWxsKG90aGVyKTtcbiAgICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGVxdWFsQnlUYWc7XG4iLCJpbXBvcnQgZ2V0QWxsS2V5cyBmcm9tICcuL19nZXRBbGxLZXlzLmpzJztcblxuLyoqIFVzZWQgdG8gY29tcG9zZSBiaXRtYXNrcyBmb3IgdmFsdWUgY29tcGFyaXNvbnMuICovXG52YXIgQ09NUEFSRV9QQVJUSUFMX0ZMQUcgPSAxO1xuXG4vKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovXG52YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi9cbnZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5O1xuXG4vKipcbiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUlzRXF1YWxEZWVwYCBmb3Igb2JqZWN0cyB3aXRoIHN1cHBvcnQgZm9yXG4gKiBwYXJ0aWFsIGRlZXAgY29tcGFyaXNvbnMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlLlxuICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBiaXRtYXNrIFRoZSBiaXRtYXNrIGZsYWdzLiBTZWUgYGJhc2VJc0VxdWFsYCBmb3IgbW9yZSBkZXRhaWxzLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLlxuICogQHBhcmFtIHtPYmplY3R9IHN0YWNrIFRyYWNrcyB0cmF2ZXJzZWQgYG9iamVjdGAgYW5kIGBvdGhlcmAgb2JqZWN0cy5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaykge1xuICB2YXIgaXNQYXJ0aWFsID0gYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHLFxuICAgICAgb2JqUHJvcHMgPSBnZXRBbGxLZXlzKG9iamVjdCksXG4gICAgICBvYmpMZW5ndGggPSBvYmpQcm9wcy5sZW5ndGgsXG4gICAgICBvdGhQcm9wcyA9IGdldEFsbEtleXMob3RoZXIpLFxuICAgICAgb3RoTGVuZ3RoID0gb3RoUHJvcHMubGVuZ3RoO1xuXG4gIGlmIChvYmpMZW5ndGggIT0gb3RoTGVuZ3RoICYmICFpc1BhcnRpYWwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGluZGV4ID0gb2JqTGVuZ3RoO1xuICB3aGlsZSAoaW5kZXgtLSkge1xuICAgIHZhciBrZXkgPSBvYmpQcm9wc1tpbmRleF07XG4gICAgaWYgKCEoaXNQYXJ0aWFsID8ga2V5IGluIG90aGVyIDogaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwga2V5KSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgLy8gQ2hlY2sgdGhhdCBjeWNsaWMgdmFsdWVzIGFyZSBlcXVhbC5cbiAgdmFyIG9ialN0YWNrZWQgPSBzdGFjay5nZXQob2JqZWN0KTtcbiAgdmFyIG90aFN0YWNrZWQgPSBzdGFjay5nZXQob3RoZXIpO1xuICBpZiAob2JqU3RhY2tlZCAmJiBvdGhTdGFja2VkKSB7XG4gICAgcmV0dXJuIG9ialN0YWNrZWQgPT0gb3RoZXIgJiYgb3RoU3RhY2tlZCA9PSBvYmplY3Q7XG4gIH1cbiAgdmFyIHJlc3VsdCA9IHRydWU7XG4gIHN0YWNrLnNldChvYmplY3QsIG90aGVyKTtcbiAgc3RhY2suc2V0KG90aGVyLCBvYmplY3QpO1xuXG4gIHZhciBza2lwQ3RvciA9IGlzUGFydGlhbDtcbiAgd2hpbGUgKCsraW5kZXggPCBvYmpMZW5ndGgpIHtcbiAgICBrZXkgPSBvYmpQcm9wc1tpbmRleF07XG4gICAgdmFyIG9ialZhbHVlID0gb2JqZWN0W2tleV0sXG4gICAgICAgIG90aFZhbHVlID0gb3RoZXJba2V5XTtcblxuICAgIGlmIChjdXN0b21pemVyKSB7XG4gICAgICB2YXIgY29tcGFyZWQgPSBpc1BhcnRpYWxcbiAgICAgICAgPyBjdXN0b21pemVyKG90aFZhbHVlLCBvYmpWYWx1ZSwga2V5LCBvdGhlciwgb2JqZWN0LCBzdGFjaylcbiAgICAgICAgOiBjdXN0b21pemVyKG9ialZhbHVlLCBvdGhWYWx1ZSwga2V5LCBvYmplY3QsIG90aGVyLCBzdGFjayk7XG4gICAgfVxuICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgb2JqZWN0cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgIGlmICghKGNvbXBhcmVkID09PSB1bmRlZmluZWRcbiAgICAgICAgICA/IChvYmpWYWx1ZSA9PT0gb3RoVmFsdWUgfHwgZXF1YWxGdW5jKG9ialZhbHVlLCBvdGhWYWx1ZSwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spKVxuICAgICAgICAgIDogY29tcGFyZWRcbiAgICAgICAgKSkge1xuICAgICAgcmVzdWx0ID0gZmFsc2U7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgc2tpcEN0b3IgfHwgKHNraXBDdG9yID0ga2V5ID09ICdjb25zdHJ1Y3RvcicpO1xuICB9XG4gIGlmIChyZXN1bHQgJiYgIXNraXBDdG9yKSB7XG4gICAgdmFyIG9iakN0b3IgPSBvYmplY3QuY29uc3RydWN0b3IsXG4gICAgICAgIG90aEN0b3IgPSBvdGhlci5jb25zdHJ1Y3RvcjtcblxuICAgIC8vIE5vbiBgT2JqZWN0YCBvYmplY3QgaW5zdGFuY2VzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWFsLlxuICAgIGlmIChvYmpDdG9yICE9IG90aEN0b3IgJiZcbiAgICAgICAgKCdjb25zdHJ1Y3RvcicgaW4gb2JqZWN0ICYmICdjb25zdHJ1Y3RvcicgaW4gb3RoZXIpICYmXG4gICAgICAgICEodHlwZW9mIG9iakN0b3IgPT0gJ2Z1bmN0aW9uJyAmJiBvYmpDdG9yIGluc3RhbmNlb2Ygb2JqQ3RvciAmJlxuICAgICAgICAgIHR5cGVvZiBvdGhDdG9yID09ICdmdW5jdGlvbicgJiYgb3RoQ3RvciBpbnN0YW5jZW9mIG90aEN0b3IpKSB7XG4gICAgICByZXN1bHQgPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgc3RhY2tbJ2RlbGV0ZSddKG9iamVjdCk7XG4gIHN0YWNrWydkZWxldGUnXShvdGhlcik7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGVxdWFsT2JqZWN0cztcbiIsImltcG9ydCBTdGFjayBmcm9tICcuL19TdGFjay5qcyc7XG5pbXBvcnQgZXF1YWxBcnJheXMgZnJvbSAnLi9fZXF1YWxBcnJheXMuanMnO1xuaW1wb3J0IGVxdWFsQnlUYWcgZnJvbSAnLi9fZXF1YWxCeVRhZy5qcyc7XG5pbXBvcnQgZXF1YWxPYmplY3RzIGZyb20gJy4vX2VxdWFsT2JqZWN0cy5qcyc7XG5pbXBvcnQgZ2V0VGFnIGZyb20gJy4vX2dldFRhZy5qcyc7XG5pbXBvcnQgaXNBcnJheSBmcm9tICcuL2lzQXJyYXkuanMnO1xuaW1wb3J0IGlzQnVmZmVyIGZyb20gJy4vaXNCdWZmZXIuanMnO1xuaW1wb3J0IGlzVHlwZWRBcnJheSBmcm9tICcuL2lzVHlwZWRBcnJheS5qcyc7XG5cbi8qKiBVc2VkIHRvIGNvbXBvc2UgYml0bWFza3MgZm9yIHZhbHVlIGNvbXBhcmlzb25zLiAqL1xudmFyIENPTVBBUkVfUEFSVElBTF9GTEFHID0gMTtcblxuLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqL1xudmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJyxcbiAgICBhcnJheVRhZyA9ICdbb2JqZWN0IEFycmF5XScsXG4gICAgb2JqZWN0VGFnID0gJ1tvYmplY3QgT2JqZWN0XSc7XG5cbi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi9cbnZhciBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7XG5cbi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqL1xudmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7XG5cbi8qKlxuICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlSXNFcXVhbGAgZm9yIGFycmF5cyBhbmQgb2JqZWN0cyB3aGljaCBwZXJmb3Jtc1xuICogZGVlcCBjb21wYXJpc29ucyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhclxuICogcmVmZXJlbmNlcyB0byBiZSBjb21wYXJlZC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0ge09iamVjdH0gb3RoZXIgVGhlIG90aGVyIG9iamVjdCB0byBjb21wYXJlLlxuICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBlcXVhbEZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRldGVybWluZSBlcXVpdmFsZW50cyBvZiB2YWx1ZXMuXG4gKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gYmFzZUlzRXF1YWxEZWVwKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHtcbiAgdmFyIG9iaklzQXJyID0gaXNBcnJheShvYmplY3QpLFxuICAgICAgb3RoSXNBcnIgPSBpc0FycmF5KG90aGVyKSxcbiAgICAgIG9ialRhZyA9IG9iaklzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob2JqZWN0KSxcbiAgICAgIG90aFRhZyA9IG90aElzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob3RoZXIpO1xuXG4gIG9ialRhZyA9IG9ialRhZyA9PSBhcmdzVGFnID8gb2JqZWN0VGFnIDogb2JqVGFnO1xuICBvdGhUYWcgPSBvdGhUYWcgPT0gYXJnc1RhZyA/IG9iamVjdFRhZyA6IG90aFRhZztcblxuICB2YXIgb2JqSXNPYmogPSBvYmpUYWcgPT0gb2JqZWN0VGFnLFxuICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLFxuICAgICAgaXNTYW1lVGFnID0gb2JqVGFnID09IG90aFRhZztcblxuICBpZiAoaXNTYW1lVGFnICYmIGlzQnVmZmVyKG9iamVjdCkpIHtcbiAgICBpZiAoIWlzQnVmZmVyKG90aGVyKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBvYmpJc0FyciA9IHRydWU7XG4gICAgb2JqSXNPYmogPSBmYWxzZTtcbiAgfVxuICBpZiAoaXNTYW1lVGFnICYmICFvYmpJc09iaikge1xuICAgIHN0YWNrIHx8IChzdGFjayA9IG5ldyBTdGFjayk7XG4gICAgcmV0dXJuIChvYmpJc0FyciB8fCBpc1R5cGVkQXJyYXkob2JqZWN0KSlcbiAgICAgID8gZXF1YWxBcnJheXMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjaylcbiAgICAgIDogZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCBvYmpUYWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spO1xuICB9XG4gIGlmICghKGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRykpIHtcbiAgICB2YXIgb2JqSXNXcmFwcGVkID0gb2JqSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsICdfX3dyYXBwZWRfXycpLFxuICAgICAgICBvdGhJc1dyYXBwZWQgPSBvdGhJc09iaiAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG90aGVyLCAnX193cmFwcGVkX18nKTtcblxuICAgIGlmIChvYmpJc1dyYXBwZWQgfHwgb3RoSXNXcmFwcGVkKSB7XG4gICAgICB2YXIgb2JqVW53cmFwcGVkID0gb2JqSXNXcmFwcGVkID8gb2JqZWN0LnZhbHVlKCkgOiBvYmplY3QsXG4gICAgICAgICAgb3RoVW53cmFwcGVkID0gb3RoSXNXcmFwcGVkID8gb3RoZXIudmFsdWUoKSA6IG90aGVyO1xuXG4gICAgICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spO1xuICAgICAgcmV0dXJuIGVxdWFsRnVuYyhvYmpVbndyYXBwZWQsIG90aFVud3JhcHBlZCwgYml0bWFzaywgY3VzdG9taXplciwgc3RhY2spO1xuICAgIH1cbiAgfVxuICBpZiAoIWlzU2FtZVRhZykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spO1xuICByZXR1cm4gZXF1YWxPYmplY3RzKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spO1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlSXNFcXVhbERlZXA7XG4iLCJpbXBvcnQgYmFzZUlzRXF1YWxEZWVwIGZyb20gJy4vX2Jhc2VJc0VxdWFsRGVlcC5qcyc7XG5pbXBvcnQgaXNPYmplY3RMaWtlIGZyb20gJy4vaXNPYmplY3RMaWtlLmpzJztcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc0VxdWFsYCB3aGljaCBzdXBwb3J0cyBwYXJ0aWFsIGNvbXBhcmlzb25zXG4gKiBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLlxuICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy5cbiAqICAxIC0gVW5vcmRlcmVkIGNvbXBhcmlzb25cbiAqICAyIC0gUGFydGlhbCBjb21wYXJpc29uXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjb21wYXJpc29ucy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgYHZhbHVlYCBhbmQgYG90aGVyYCBvYmplY3RzLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC5cbiAqL1xuZnVuY3Rpb24gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBzdGFjaykge1xuICBpZiAodmFsdWUgPT09IG90aGVyKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzT2JqZWN0TGlrZShvdGhlcikpKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXI7XG4gIH1cbiAgcmV0dXJuIGJhc2VJc0VxdWFsRGVlcCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGJhc2VJc0VxdWFsLCBzdGFjayk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGJhc2VJc0VxdWFsO1xuIiwiLyoqXG4gKiBHZXRzIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgQXJyYXlcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBxdWVyeS5cbiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGFycmF5YC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5sYXN0KFsxLCAyLCAzXSk7XG4gKiAvLyA9PiAzXG4gKi9cbmZ1bmN0aW9uIGxhc3QoYXJyYXkpIHtcbiAgdmFyIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoO1xuICByZXR1cm4gbGVuZ3RoID8gYXJyYXlbbGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGxhc3Q7XG4iLCJpbXBvcnQgYmFzZUdldCBmcm9tICcuL19iYXNlR2V0LmpzJztcbmltcG9ydCBiYXNlU2xpY2UgZnJvbSAnLi9fYmFzZVNsaWNlLmpzJztcblxuLyoqXG4gKiBHZXRzIHRoZSBwYXJlbnQgdmFsdWUgYXQgYHBhdGhgIG9mIGBvYmplY3RgLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuXG4gKiBAcGFyYW0ge0FycmF5fSBwYXRoIFRoZSBwYXRoIHRvIGdldCB0aGUgcGFyZW50IHZhbHVlIG9mLlxuICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHBhcmVudCB2YWx1ZS5cbiAqL1xuZnVuY3Rpb24gcGFyZW50KG9iamVjdCwgcGF0aCkge1xuICByZXR1cm4gcGF0aC5sZW5ndGggPCAyID8gb2JqZWN0IDogYmFzZUdldChvYmplY3QsIGJhc2VTbGljZShwYXRoLCAwLCAtMSkpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBwYXJlbnQ7XG4iLCJpbXBvcnQgYmFzZUlzRXF1YWwgZnJvbSAnLi9fYmFzZUlzRXF1YWwuanMnO1xuXG4vKipcbiAqIFBlcmZvcm1zIGEgZGVlcCBjb21wYXJpc29uIGJldHdlZW4gdHdvIHZhbHVlcyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmVcbiAqIGVxdWl2YWxlbnQuXG4gKlxuICogKipOb3RlOioqIFRoaXMgbWV0aG9kIHN1cHBvcnRzIGNvbXBhcmluZyBhcnJheXMsIGFycmF5IGJ1ZmZlcnMsIGJvb2xlYW5zLFxuICogZGF0ZSBvYmplY3RzLCBlcnJvciBvYmplY3RzLCBtYXBzLCBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLFxuICogc2V0cywgc3RyaW5ncywgc3ltYm9scywgYW5kIHR5cGVkIGFycmF5cy4gYE9iamVjdGAgb2JqZWN0cyBhcmUgY29tcGFyZWRcbiAqIGJ5IHRoZWlyIG93biwgbm90IGluaGVyaXRlZCwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzLiBGdW5jdGlvbnMgYW5kIERPTVxuICogbm9kZXMgYXJlIGNvbXBhcmVkIGJ5IHN0cmljdCBlcXVhbGl0eSwgaS5lLiBgPT09YC5cbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHZhbHVlcyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLlxuICogQGV4YW1wbGVcbiAqXG4gKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTtcbiAqIHZhciBvdGhlciA9IHsgJ2EnOiAxIH07XG4gKlxuICogXy5pc0VxdWFsKG9iamVjdCwgb3RoZXIpO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIG9iamVjdCA9PT0gb3RoZXI7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc0VxdWFsKHZhbHVlLCBvdGhlcikge1xuICByZXR1cm4gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgaXNFcXVhbDtcbiIsImltcG9ydCBjYXN0UGF0aCBmcm9tICcuL19jYXN0UGF0aC5qcyc7XG5pbXBvcnQgbGFzdCBmcm9tICcuL2xhc3QuanMnO1xuaW1wb3J0IHBhcmVudCBmcm9tICcuL19wYXJlbnQuanMnO1xuaW1wb3J0IHRvS2V5IGZyb20gJy4vX3RvS2V5LmpzJztcblxuLyoqXG4gKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bnNldGAuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcHJvcGVydHkgcGF0aCB0byB1bnNldC5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgcHJvcGVydHkgaXMgZGVsZXRlZCwgZWxzZSBgZmFsc2VgLlxuICovXG5mdW5jdGlvbiBiYXNlVW5zZXQob2JqZWN0LCBwYXRoKSB7XG4gIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpO1xuICBvYmplY3QgPSBwYXJlbnQob2JqZWN0LCBwYXRoKTtcbiAgcmV0dXJuIG9iamVjdCA9PSBudWxsIHx8IGRlbGV0ZSBvYmplY3RbdG9LZXkobGFzdChwYXRoKSldO1xufVxuXG5leHBvcnQgZGVmYXVsdCBiYXNlVW5zZXQ7XG4iLCJpbXBvcnQgYmFzZVVuc2V0IGZyb20gJy4vX2Jhc2VVbnNldC5qcyc7XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgcHJvcGVydHkgYXQgYHBhdGhgIG9mIGBvYmplY3RgLlxuICpcbiAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBtdXRhdGVzIGBvYmplY3RgLlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4wLjBcbiAqIEBjYXRlZ29yeSBPYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuXG4gKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gdW5zZXQuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHByb3BlcnR5IGlzIGRlbGV0ZWQsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiA3IH0gfV0gfTtcbiAqIF8udW5zZXQob2JqZWN0LCAnYVswXS5iLmMnKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBjb25zb2xlLmxvZyhvYmplY3QpO1xuICogLy8gPT4geyAnYSc6IFt7ICdiJzoge30gfV0gfTtcbiAqXG4gKiBfLnVuc2V0KG9iamVjdCwgWydhJywgJzAnLCAnYicsICdjJ10pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIGNvbnNvbGUubG9nKG9iamVjdCk7XG4gKiAvLyA9PiB7ICdhJzogW3sgJ2InOiB7fSB9XSB9O1xuICovXG5mdW5jdGlvbiB1bnNldChvYmplY3QsIHBhdGgpIHtcbiAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gdHJ1ZSA6IGJhc2VVbnNldChvYmplY3QsIHBhdGgpO1xufVxuXG5leHBvcnQgZGVmYXVsdCB1bnNldDtcbiIsIi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqL1xuaW1wb3J0IHsgaXNPYmplY3QsIGlzU3RyaW5nLCBpc1BsYWluT2JqZWN0LCBjbG9uZURlZXBXaXRoLCBpc0VsZW1lbnQgYXMgaXNFbGVtZW50JDEsIGlzRnVuY3Rpb24sIG1lcmdlIH0gZnJvbSAnbG9kYXNoLWVzJztcblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qIGdsb2JhbHMgd2luZG93LCBkb2N1bWVudCAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZG9tL2dsb2JhbFxuICovIC8vIFRoaXMgaW50ZXJmYWNlIGV4aXN0cyB0byBtYWtlIG91ciBBUEkgcGFnZXMgbW9yZSByZWFkYWJsZS5cbi8qKlxuICogQSBoZWxwZXIgKG1vZHVsZSkgZ2l2aW5nIGFuIGFjY2VzcyB0byB0aGUgZ2xvYmFsIERPTSBvYmplY3RzIHN1Y2ggYXMgYHdpbmRvd2AgYW5kIGBkb2N1bWVudGAuXG4gKi8gLyoqXG4gKiBBIGhlbHBlciAobW9kdWxlKSBnaXZpbmcgYW4gYWNjZXNzIHRvIHRoZSBnbG9iYWwgRE9NIG9iamVjdHMgc3VjaCBhcyBgd2luZG93YCBhbmRcbiAqIGBkb2N1bWVudGAuIEFjY2Vzc2luZyB0aGVzZSBvYmplY3RzIHVzaW5nIHRoaXMgaGVscGVyIGFsbG93cyBlYXN5IGFuZCBidWxsZXRwcm9vZlxuICogdGVzdGluZywgaS5lLiBzdHViYmluZyBuYXRpdmUgcHJvcGVydGllczpcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgZ2xvYmFsIH0gZnJvbSAnY2tlZGl0b3I1L3V0aWxzJztcbiAqXG4gKiAvLyBUaGlzIHN0dWIgd2lsbCB3b3JrIGZvciBhbnkgY29kZSB1c2luZyBnbG9iYWwgbW9kdWxlLlxuICogdGVzdFV0aWxzLnNpbm9uLnN0dWIoIGdsb2JhbCwgJ3dpbmRvdycsIHtcbiAqIFx0aW5uZXJXaWR0aDogMTAwMDBcbiAqIH0gKTtcbiAqXG4gKiBjb25zb2xlLmxvZyggZ2xvYmFsLndpbmRvdy5pbm5lcldpZHRoICk7XG4gKiBgYGBcbiAqLyBsZXQgZ2xvYmFsVmFyOyAvLyBuYW1lZCBnbG9iYWxWYXIgaW5zdGVhZCBvZiBnbG9iYWw6IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEyOTcxXG4vLyBJbiBzb21lIGVudmlyb25tZW50cyB3aW5kb3cgYW5kIGRvY3VtZW50IEFQSSBtaWdodCBub3QgYmUgYXZhaWxhYmxlLlxudHJ5IHtcbiAgICBnbG9iYWxWYXIgPSB7XG4gICAgICAgIHdpbmRvdyxcbiAgICAgICAgZG9jdW1lbnRcbiAgICB9O1xufSBjYXRjaCAoZSkge1xuICAgIC8vIEl0J3Mgbm90IHBvc3NpYmxlIHRvIG1vY2sgYSB3aW5kb3cgb2JqZWN0IHRvIHNpbXVsYXRlIGxhY2sgb2YgYSB3aW5kb3cgb2JqZWN0IHdpdGhvdXQgd3JpdGluZyBleHRyZW1lbHkgY29udm9sdXRlZCBjb2RlLlxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyAvLyBMZXQncyBjYXN0IGl0IHRvIG5vdCBjaGFuZ2UgbW9kdWxlJ3MgQVBJLlxuICAgIC8vIFdlIG9ubHkgaGFuZGxlIHRoaXMgc28gbG9hZGluZyBlZGl0b3IgaW4gZW52aXJvbm1lbnRzIHdpdGhvdXQgd2luZG93IGFuZCBkb2N1bWVudCBkb2Vzbid0IGZhaWwuXG4gICAgLy8gRm9yIGJldHRlciBEWCB3ZSBzaG91bGRuJ3QgaW50cm9kdWNlIG1peGVkIHR5cGVzIGFuZCByZXF1aXJlIGRldmVsb3BlcnMgdG8gY2hlY2sgdGhlIHR5cGUgbWFudWFsbHkuXG4gICAgLy8gVGhpcyBtb2R1bGUgc2hvdWxkIG5vdCBiZSB1c2VkIG9uIHB1cnBvc2UgaW4gYW55IGVudmlyb25tZW50IG91dHNpZGUgYnJvd3Nlci5cbiAgICBnbG9iYWxWYXIgPSB7XG4gICAgICAgIHdpbmRvdzoge30sXG4gICAgICAgIGRvY3VtZW50OiB7fVxuICAgIH07XG59XG52YXIgZ2xvYmFsID0gZ2xvYmFsVmFyO1xuXG4vKipcbiAqIFNhZmVseSByZXR1cm5zIGB1c2VyQWdlbnRgIGZyb20gYnJvd3NlcidzIG5hdmlnYXRvciBBUEkgaW4gYSBsb3dlciBjYXNlLlxuICogSWYgbmF2aWdhdG9yIEFQSSBpcyBub3QgYXZhaWxhYmxlIGl0IHdpbGwgcmV0dXJuIGFuIGVtcHR5IHN0cmluZy5cbiAqLyBmdW5jdGlvbiBnZXRVc2VyQWdlbnQoKSB7XG4gICAgLy8gSW4gc29tZSBlbnZpcm9ubWVudHMgbmF2aWdhdG9yIEFQSSBtaWdodCBub3QgYmUgYXZhaWxhYmxlLlxuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxufVxuY29uc3QgdXNlckFnZW50ID0gLyogI19fUFVSRV9fICovIGdldFVzZXJBZ2VudCgpO1xuLyoqXG4gKiBBIG5hbWVzcGFjZSBjb250YWluaW5nIGVudmlyb25tZW50IGFuZCBicm93c2VyIGluZm9ybWF0aW9uLlxuICovIGNvbnN0IGVudiA9IHtcbiAgICBpc01hYzogLyogI19fUFVSRV9fICovIGlzTWFjKHVzZXJBZ2VudCksXG4gICAgaXNXaW5kb3dzOiAvKiAjX19QVVJFX18gKi8gaXNXaW5kb3dzKHVzZXJBZ2VudCksXG4gICAgaXNHZWNrbzogLyogI19fUFVSRV9fICovIGlzR2Vja28odXNlckFnZW50KSxcbiAgICBpc1NhZmFyaTogLyogI19fUFVSRV9fICovIGlzU2FmYXJpKHVzZXJBZ2VudCksXG4gICAgaXNpT1M6IC8qICNfX1BVUkVfXyAqLyBpc2lPUyh1c2VyQWdlbnQpLFxuICAgIGlzQW5kcm9pZDogLyogI19fUFVSRV9fICovIGlzQW5kcm9pZCh1c2VyQWdlbnQpLFxuICAgIGlzQmxpbms6IC8qICNfX1BVUkVfXyAqLyBpc0JsaW5rKHVzZXJBZ2VudCksXG4gICAgZ2V0IGlzTWVkaWFGb3JjZWRDb2xvcnMgKCkge1xuICAgICAgICByZXR1cm4gaXNNZWRpYUZvcmNlZENvbG9ycygpO1xuICAgIH0sXG4gICAgZ2V0IGlzTW90aW9uUmVkdWNlZCAoKSB7XG4gICAgICAgIHJldHVybiBpc01vdGlvblJlZHVjZWQoKTtcbiAgICB9LFxuICAgIGZlYXR1cmVzOiB7XG4gICAgICAgIGlzUmVnRXhwVW5pY29kZVByb3BlcnR5U3VwcG9ydGVkOiAvKiAjX19QVVJFX18gKi8gaXNSZWdFeHBVbmljb2RlUHJvcGVydHlTdXBwb3J0ZWQoKVxuICAgIH1cbn07XG4vKipcbiAqIENoZWNrcyBpZiBVc2VyIEFnZW50IHJlcHJlc2VudGVkIGJ5IHRoZSBzdHJpbmcgaXMgcnVubmluZyBvbiBNYWNpbnRvc2guXG4gKlxuICogQHBhcmFtIHVzZXJBZ2VudCAqKkxvd2VyY2FzZSoqIGBuYXZpZ2F0b3IudXNlckFnZW50YCBzdHJpbmcuXG4gKiBAcmV0dXJucyBXaGV0aGVyIFVzZXIgQWdlbnQgaXMgcnVubmluZyBvbiBNYWNpbnRvc2ggb3Igbm90LlxuICovIGZ1bmN0aW9uIGlzTWFjKHVzZXJBZ2VudCkge1xuICAgIHJldHVybiB1c2VyQWdlbnQuaW5kZXhPZignbWFjaW50b3NoJykgPiAtMTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIFVzZXIgQWdlbnQgcmVwcmVzZW50ZWQgYnkgdGhlIHN0cmluZyBpcyBydW5uaW5nIG9uIFdpbmRvd3MuXG4gKlxuICogQHBhcmFtIHVzZXJBZ2VudCAqKkxvd2VyY2FzZSoqIGBuYXZpZ2F0b3IudXNlckFnZW50YCBzdHJpbmcuXG4gKiBAcmV0dXJucyBXaGV0aGVyIFVzZXIgQWdlbnQgaXMgcnVubmluZyBvbiBXaW5kb3dzIG9yIG5vdC5cbiAqLyBmdW5jdGlvbiBpc1dpbmRvd3ModXNlckFnZW50KSB7XG4gICAgcmV0dXJuIHVzZXJBZ2VudC5pbmRleE9mKCd3aW5kb3dzJykgPiAtMTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIFVzZXIgQWdlbnQgcmVwcmVzZW50ZWQgYnkgdGhlIHN0cmluZyBpcyBGaXJlZm94IChHZWNrbykuXG4gKlxuICogQHBhcmFtIHVzZXJBZ2VudCAqKkxvd2VyY2FzZSoqIGBuYXZpZ2F0b3IudXNlckFnZW50YCBzdHJpbmcuXG4gKiBAcmV0dXJucyBXaGV0aGVyIFVzZXIgQWdlbnQgaXMgRmlyZWZveCBvciBub3QuXG4gKi8gZnVuY3Rpb24gaXNHZWNrbyh1c2VyQWdlbnQpIHtcbiAgICByZXR1cm4gISF1c2VyQWdlbnQubWF0Y2goL2dlY2tvXFwvXFxkKy8pO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgVXNlciBBZ2VudCByZXByZXNlbnRlZCBieSB0aGUgc3RyaW5nIGlzIFNhZmFyaS5cbiAqXG4gKiBAcGFyYW0gdXNlckFnZW50ICoqTG93ZXJjYXNlKiogYG5hdmlnYXRvci51c2VyQWdlbnRgIHN0cmluZy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgVXNlciBBZ2VudCBpcyBTYWZhcmkgb3Igbm90LlxuICovIGZ1bmN0aW9uIGlzU2FmYXJpKHVzZXJBZ2VudCkge1xuICAgIHJldHVybiB1c2VyQWdlbnQuaW5kZXhPZignIGFwcGxld2Via2l0LycpID4gLTEgJiYgdXNlckFnZW50LmluZGV4T2YoJ2Nocm9tZScpID09PSAtMTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIFVzZXIgQWdlbnQgcmVwcmVzZW50ZWQgYnkgdGhlIHN0cmluZyBpcyBydW5uaW5nIGluIGlPUy5cbiAqXG4gKiBAcGFyYW0gdXNlckFnZW50ICoqTG93ZXJjYXNlKiogYG5hdmlnYXRvci51c2VyQWdlbnRgIHN0cmluZy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgVXNlciBBZ2VudCBpcyBydW5uaW5nIGluIGlPUyBvciBub3QuXG4gKi8gZnVuY3Rpb24gaXNpT1ModXNlckFnZW50KSB7XG4gICAgLy8gXCJSZXF1ZXN0IG1vYmlsZSBzaXRlXCIgfHwgXCJSZXF1ZXN0IGRlc2t0b3Agc2l0ZVwiLlxuICAgIHJldHVybiAhIXVzZXJBZ2VudC5tYXRjaCgvaXBob25lfGlwYWQvaSkgfHwgaXNNYWModXNlckFnZW50KSAmJiBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgPiAwO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgVXNlciBBZ2VudCByZXByZXNlbnRlZCBieSB0aGUgc3RyaW5nIGlzIEFuZHJvaWQgbW9iaWxlIGRldmljZS5cbiAqXG4gKiBAcGFyYW0gdXNlckFnZW50ICoqTG93ZXJjYXNlKiogYG5hdmlnYXRvci51c2VyQWdlbnRgIHN0cmluZy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgVXNlciBBZ2VudCBpcyBTYWZhcmkgb3Igbm90LlxuICovIGZ1bmN0aW9uIGlzQW5kcm9pZCh1c2VyQWdlbnQpIHtcbiAgICByZXR1cm4gdXNlckFnZW50LmluZGV4T2YoJ2FuZHJvaWQnKSA+IC0xO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgVXNlciBBZ2VudCByZXByZXNlbnRlZCBieSB0aGUgc3RyaW5nIGlzIEJsaW5rIGVuZ2luZS5cbiAqXG4gKiBAcGFyYW0gdXNlckFnZW50ICoqTG93ZXJjYXNlKiogYG5hdmlnYXRvci51c2VyQWdlbnRgIHN0cmluZy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgVXNlciBBZ2VudCBpcyBCbGluayBlbmdpbmUgb3Igbm90LlxuICovIGZ1bmN0aW9uIGlzQmxpbmsodXNlckFnZW50KSB7XG4gICAgLy8gVGhlIEVkZ2UgYnJvd3NlciBiZWZvcmUgc3dpdGNoaW5nIHRvIHRoZSBCbGluayBlbmdpbmUgdXNlZCB0byByZXBvcnQgaXRzZWxmIGFzIENocm9tZSAoYW5kIFwiRWRnZS9cIilcbiAgICAvLyBidXQgYWZ0ZXIgc3dpdGNoaW5nIHRvIHRoZSBCbGluayBpdCByZXBsYWNlZCBcIkVkZ2UvXCIgd2l0aCBcIkVkZy9cIi5cbiAgICByZXR1cm4gdXNlckFnZW50LmluZGV4T2YoJ2Nocm9tZS8nKSA+IC0xICYmIHVzZXJBZ2VudC5pbmRleE9mKCdlZGdlLycpIDwgMDtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBjdXJyZW50IGVudmlyb25tZW50IHN1cHBvcnRzIEVTMjAxOCBVbmljb2RlIHByb3BlcnRpZXMgbGlrZSBgXFxwe1B9YCBvciBgXFxwe0x9YC5cbiAqIE1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdW5pY29kZSBwcm9wZXJ0aWVzIG1pZ2h0IGJlIGZvdW5kXG4gKiBbaW4gVW5pY29kZSBTdGFuZGFyZCBBbm5leCAjNDRdKGh0dHBzOi8vd3d3LnVuaWNvZGUub3JnL3JlcG9ydHMvdHI0NC8jR0NfVmFsdWVzX1RhYmxlKS5cbiAqLyBmdW5jdGlvbiBpc1JlZ0V4cFVuaWNvZGVQcm9wZXJ0eVN1cHBvcnRlZCgpIHtcbiAgICBsZXQgaXNTdXBwb3J0ZWQgPSBmYWxzZTtcbiAgICAvLyBGZWF0dXJlIGRldGVjdGlvbiBmb3IgVW5pY29kZSBwcm9wZXJ0aWVzLiBBZGRlZCBpbiBFUzIwMTguIEN1cnJlbnRseSBGaXJlZm94IGRvZXMgbm90IHN1cHBvcnQgaXQuXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtbWVudGlvbi9pc3N1ZXMvNDQjaXNzdWVjb21tZW50LTQ4NzAwMjE3NC5cbiAgICB0cnkge1xuICAgICAgICAvLyBVc2FnZSBvZiByZWd1bGFyIGV4cHJlc3Npb24gbGl0ZXJhbCBjYXVzZSBlcnJvciBkdXJpbmcgYnVpbGQgKGNrZWRpdG9yL2NrZWRpdG9yNS1kZXYjNTM0KS5cbiAgICAgICAgaXNTdXBwb3J0ZWQgPSAnxIcnLnNlYXJjaChuZXcgUmVnRXhwKCdbXFxcXHB7TH1dJywgJ3UnKSkgPT09IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBGaXJlZm94IHRocm93cyBhIFN5bnRheEVycm9yIHdoZW4gdGhlIGdyb3VwIGlzIHVuc3VwcG9ydGVkLlxuICAgIH1cbiAgICByZXR1cm4gaXNTdXBwb3J0ZWQ7XG59XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgdXNlciBhZ2VudCBoYXMgZW5hYmxlZCBhIGZvcmNlZCBjb2xvcnMgbW9kZSAoZS5nLiBXaW5kb3dzIEhpZ2ggQ29udHJhc3QgbW9kZSkuXG4gKlxuICogUmV0dXJucyBgZmFsc2VgIGluIGVudmlyb25tZW50cyB3aGVyZSBgd2luZG93YCBnbG9iYWwgb2JqZWN0IGlzIG5vdCBhdmFpbGFibGUuXG4gKi8gZnVuY3Rpb24gaXNNZWRpYUZvcmNlZENvbG9ycygpIHtcbiAgICByZXR1cm4gZ2xvYmFsLndpbmRvdy5tYXRjaE1lZGlhID8gZ2xvYmFsLndpbmRvdy5tYXRjaE1lZGlhKCcoZm9yY2VkLWNvbG9yczogYWN0aXZlKScpLm1hdGNoZXMgOiBmYWxzZTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGVuYWJsZWQgXCJwcmVmZXJzIHJlZHVjZWQgbW90aW9uXCIgc2V0dGluZyBpbiBicm93c2VyLlxuICpcbiAqIFJldHVybnMgYGZhbHNlYCBpbiBlbnZpcm9ubWVudHMgd2hlcmUgYHdpbmRvd2AgZ2xvYmFsIG9iamVjdCBpcyBub3QgYXZhaWxhYmxlLlxuICovIGZ1bmN0aW9uIGlzTW90aW9uUmVkdWNlZCgpIHtcbiAgICByZXR1cm4gZ2xvYmFsLndpbmRvdy5tYXRjaE1lZGlhID8gZ2xvYmFsLndpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1yZWR1Y2VkLW1vdGlvbiknKS5tYXRjaGVzIDogZmFsc2U7XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZmFzdGRpZmZcbiAqLyAvKipcbiAqIEZpbmRzIHBvc2l0aW9ucyBvZiB0aGUgZmlyc3QgYW5kIGxhc3QgY2hhbmdlIGluIHRoZSBnaXZlbiBzdHJpbmcvYXJyYXkgYW5kIGdlbmVyYXRlcyBhIHNldCBvZiBjaGFuZ2VzOlxuICpcbiAqIGBgYHRzXG4gKiBmYXN0RGlmZiggJzEyYScsICcxMnh5emEnICk7XG4gKiAvLyBbIHsgaW5kZXg6IDIsIHR5cGU6ICdpbnNlcnQnLCB2YWx1ZXM6IFsgJ3gnLCAneScsICd6JyBdIH0gXVxuICpcbiAqIGZhc3REaWZmKCAnMTJhJywgJzEyYWEnICk7XG4gKiAvLyBbIHsgaW5kZXg6IDMsIHR5cGU6ICdpbnNlcnQnLCB2YWx1ZXM6IFsgJ2EnIF0gfSBdXG4gKlxuICogZmFzdERpZmYoICcxMnh5emEnLCAnMTJhJyApO1xuICogLy8gWyB7IGluZGV4OiAyLCB0eXBlOiAnZGVsZXRlJywgaG93TWFueTogMyB9IF1cbiAqXG4gKiBmYXN0RGlmZiggWyAnMScsICcyJywgJ2EnLCAnYScgXSwgWyAnMScsICcyJywgJ2EnIF0gKTtcbiAqIC8vIFsgeyBpbmRleDogMywgdHlwZTogJ2RlbGV0ZScsIGhvd01hbnk6IDEgfSBdXG4gKlxuICogZmFzdERpZmYoIFsgJzEnLCAnMicsICdhJywgJ2InLCAnYycsICczJyBdLCBbICcyJywgJ2EnLCAnYicgXSApO1xuICogLy8gWyB7IGluZGV4OiAwLCB0eXBlOiAnaW5zZXJ0JywgdmFsdWVzOiBbICcyJywgJ2EnLCAnYicgXSB9LCB7IGluZGV4OiAzLCB0eXBlOiAnZGVsZXRlJywgaG93TWFueTogNiB9IF1cbiAqIGBgYFxuICpcbiAqIFBhc3NlZCBhcnJheXMgY2FuIGNvbnRhaW4gYW55IHR5cGUgb2YgZGF0YSwgaG93ZXZlciB0byBjb21wYXJlIHRoZW0gY29ycmVjdGx5IGN1c3RvbSBjb21wYXJhdG9yIGZ1bmN0aW9uXG4gKiBzaG91bGQgYmUgcGFzc2VkIGFzIGEgdGhpcmQgcGFyYW1ldGVyOlxuICpcbiAqIGBgYHRzXG4gKiBmYXN0RGlmZiggWyB7IHZhbHVlOiAxIH0sIHsgdmFsdWU6IDIgfSBdLCBbIHsgdmFsdWU6IDEgfSwgeyB2YWx1ZTogMyB9IF0sICggYSwgYiApID0+IHtcbiAqIFx0cmV0dXJuIGEudmFsdWUgPT09IGIudmFsdWU7XG4gKiB9ICk7XG4gKiAvLyBbIHsgaW5kZXg6IDEsIHR5cGU6ICdpbnNlcnQnLCB2YWx1ZXM6IFsgeyB2YWx1ZTogMyB9IF0gfSwgeyBpbmRleDogMiwgdHlwZTogJ2RlbGV0ZScsIGhvd01hbnk6IDEgfSBdXG4gKiBgYGBcbiAqXG4gKiBUaGUgcmVzdWx0ZWQgc2V0IG9mIGNoYW5nZXMgY2FuIGJlIGFwcGxpZWQgdG8gdGhlIGlucHV0IGluIG9yZGVyIHRvIHRyYW5zZm9ybSBpdCBpbnRvIHRoZSBvdXRwdXQsIGZvciBleGFtcGxlOlxuICpcbiAqIGBgYHRzXG4gKiBsZXQgaW5wdXQgPSAnMTJhYmMzJztcbiAqIGNvbnN0IG91dHB1dCA9ICcyYWInO1xuICogY29uc3QgY2hhbmdlcyA9IGZhc3REaWZmKCBpbnB1dCwgb3V0cHV0ICk7XG4gKlxuICogY2hhbmdlcy5mb3JFYWNoKCBjaGFuZ2UgPT4ge1xuICogXHRpZiAoIGNoYW5nZS50eXBlID09ICdpbnNlcnQnICkge1xuICogXHRcdGlucHV0ID0gaW5wdXQuc3Vic3RyaW5nKCAwLCBjaGFuZ2UuaW5kZXggKSArIGNoYW5nZS52YWx1ZXMuam9pbiggJycgKSArIGlucHV0LnN1YnN0cmluZyggY2hhbmdlLmluZGV4ICk7XG4gKiBcdH0gZWxzZSBpZiAoIGNoYW5nZS50eXBlID09ICdkZWxldGUnICkge1xuICogXHRcdGlucHV0ID0gaW5wdXQuc3Vic3RyaW5nKCAwLCBjaGFuZ2UuaW5kZXggKSArIGlucHV0LnN1YnN0cmluZyggY2hhbmdlLmluZGV4ICsgY2hhbmdlLmhvd01hbnkgKTtcbiAqIFx0fVxuICogfSApO1xuICpcbiAqIC8vIGlucHV0IGVxdWFscyBvdXRwdXQgbm93XG4gKiBgYGBcbiAqXG4gKiBvciBpbiBjYXNlIG9mIGFycmF5czpcbiAqXG4gKiBgYGB0c1xuICogbGV0IGlucHV0ID0gWyAnMScsICcyJywgJ2EnLCAnYicsICdjJywgJzMnIF07XG4gKiBjb25zdCBvdXRwdXQgPSBbICcyJywgJ2EnLCAnYicgXTtcbiAqIGNvbnN0IGNoYW5nZXMgPSBmYXN0RGlmZiggaW5wdXQsIG91dHB1dCApO1xuICpcbiAqIGNoYW5nZXMuZm9yRWFjaCggY2hhbmdlID0+IHtcbiAqIFx0aWYgKCBjaGFuZ2UudHlwZSA9PSAnaW5zZXJ0JyApIHtcbiAqIFx0XHRpbnB1dCA9IGlucHV0LnNsaWNlKCAwLCBjaGFuZ2UuaW5kZXggKS5jb25jYXQoIGNoYW5nZS52YWx1ZXMsIGlucHV0LnNsaWNlKCBjaGFuZ2UuaW5kZXggKSApO1xuICogXHR9IGVsc2UgaWYgKCBjaGFuZ2UudHlwZSA9PSAnZGVsZXRlJyApIHtcbiAqIFx0XHRpbnB1dCA9IGlucHV0LnNsaWNlKCAwLCBjaGFuZ2UuaW5kZXggKS5jb25jYXQoIGlucHV0LnNsaWNlKCBjaGFuZ2UuaW5kZXggKyBjaGFuZ2UuaG93TWFueSApICk7XG4gKiBcdH1cbiAqIH0gKTtcbiAqXG4gKiAvLyBpbnB1dCBlcXVhbHMgb3V0cHV0IG5vd1xuICogYGBgXG4gKlxuICogQnkgcGFzc2luZyBgdHJ1ZWAgYXMgdGhlIGZvdXJ0aCBwYXJhbWV0ZXIgKGBhdG9taWNDaGFuZ2VzYCkgdGhlIG91dHB1dCBvZiB0aGlzIGZ1bmN0aW9uIHdpbGwgYmVjb21lIGNvbXBhdGlibGUgd2l0aFxuICogdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvZGlmZn5kaWZmIGBkaWZmKClgfSBmdW5jdGlvbjpcbiAqXG4gKiBgYGB0c1xuICogZmFzdERpZmYoICcxMmEnLCAnMTJ4eXphJywgdW5kZWZpbmVkLCB0cnVlICk7XG4gKiAvLyBbICdlcXVhbCcsICdlcXVhbCcsICdpbnNlcnQnLCAnaW5zZXJ0JywgJ2luc2VydCcsICdlcXVhbCcgXVxuICogYGBgXG4gKlxuICogVGhlIGRlZmF1bHQgb3V0cHV0IGZvcm1hdCBvZiB0aGlzIGZ1bmN0aW9uIGlzIGNvbXBhdGlibGUgd2l0aCB0aGUgb3V0cHV0IGZvcm1hdCBvZlxuICoge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmdG9jaGFuZ2VzfmRpZmZUb0NoYW5nZXMgYGRpZmZUb0NoYW5nZXMoKWB9LiBUaGUgYGRpZmZUb0NoYW5nZXMoKWAgaW5wdXQgZm9ybWF0IGlzLCBpbiB0dXJuLFxuICogY29tcGF0aWJsZSB3aXRoIHRoZSBvdXRwdXQgb2Yge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmfmRpZmYgYGRpZmYoKWB9OlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBhID0gJzEyMzQnO1xuICogY29uc3QgYiA9ICcxMnh5ejM0JztcbiAqXG4gKiAvLyBCb3RoIGNhbGxzIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdHMgKGdyb3VwZWQgY2hhbmdlcyBmb3JtYXQpLlxuICogZmFzdERpZmYoIGEsIGIgKTtcbiAqIGRpZmZUb0NoYW5nZXMoIGRpZmYoIGEsIGIgKSApO1xuICpcbiAqIC8vIEFnYWluLCBib3RoIGNhbGxzIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdHMgKGF0b21pYyBjaGFuZ2VzIGZvcm1hdCkuXG4gKiBmYXN0RGlmZiggYSwgYiwgdW5kZWZpbmVkLCB0cnVlICk7XG4gKiBkaWZmKCBhLCBiICk7XG4gKiBgYGBcbiAqXG4gKiBAdHlwZVBhcmFtIFQgVGhlIHR5cGUgb2YgYXJyYXkgZWxlbWVudHMuXG4gKiBAdHlwZVBhcmFtIEF0b21pY0NoYW5nZXMgVGhlIHR5cGUgb2YgYGF0b21pY0NoYW5nZXNgIHBhcmFtZXRlciAoc2VsZWN0cyB0aGUgcmVzdWx0IHR5cGUpLlxuICogQHBhcmFtIGEgSW5wdXQgYXJyYXkgb3Igc3RyaW5nLlxuICogQHBhcmFtIGIgSW5wdXQgYXJyYXkgb3Igc3RyaW5nLlxuICogQHBhcmFtIGNtcCBPcHRpb25hbCBmdW5jdGlvbiB1c2VkIHRvIGNvbXBhcmUgYXJyYXkgdmFsdWVzLCBieSBkZWZhdWx0IGA9PT1gIChzdHJpY3QgZXF1YWwgb3BlcmF0b3IpIGlzIHVzZWQuXG4gKiBAcGFyYW0gYXRvbWljQ2hhbmdlcyBXaGV0aGVyIGFuIGFycmF5IG9mIGBpbnNldHxkZWxldGV8ZXF1YWxgIG9wZXJhdGlvbnMgc2hvdWxkXG4gKiBiZSByZXR1cm5lZCBpbnN0ZWFkIG9mIGNoYW5nZXMgc2V0LiBUaGlzIG1ha2VzIHRoaXMgZnVuY3Rpb24gY29tcGF0aWJsZSB3aXRoIHtAbGluayBtb2R1bGU6dXRpbHMvZGlmZn5kaWZmIGBkaWZmKClgfS5cbiAqIERlZmF1bHRzIHRvIGBmYWxzZWAuXG4gKiBAcmV0dXJucyBBcnJheSBvZiBjaGFuZ2VzLiBUaGUgZWxlbWVudHMgYXJlIGVpdGhlciB7QGxpbmsgbW9kdWxlOnV0aWxzL2RpZmZ+RGlmZlJlc3VsdH0gb3Ige0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmdG9jaGFuZ2VzfkNoYW5nZX0sXG4gKiBkZXBlbmRpbmcgb24gYGF0b21pY0NoYW5nZXNgIHBhcmFtZXRlci5cbiAqLyBmdW5jdGlvbiBmYXN0RGlmZihhLCBiLCBjbXAsIGF0b21pY0NoYW5nZXMpIHtcbiAgICAvLyBTZXQgdGhlIGNvbXBhcmF0b3IgZnVuY3Rpb24uXG4gICAgY21wID0gY21wIHx8IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfTtcbiAgICAvLyBDb252ZXJ0IHRoZSBzdHJpbmcgKG9yIGFueSBhcnJheS1saWtlIG9iamVjdCAtIGVnLiBOb2RlTGlzdCkgdG8gYW4gYXJyYXkgYnkgdXNpbmcgdGhlIHNsaWNlKCkgbWV0aG9kIGJlY2F1c2UsXG4gICAgLy8gdW5saWtlIEFycmF5LmZyb20oKSwgaXQgcmV0dXJucyBhcnJheSBvZiBVVEYtMTYgY29kZSB1bml0cyBpbnN0ZWFkIG9mIHRoZSBjb2RlIHBvaW50cyBvZiBhIHN0cmluZy5cbiAgICAvLyBPbmUgY29kZSBwb2ludCBtaWdodCBiZSBhIHN1cnJvZ2F0ZSBwYWlyIG9mIHR3byBjb2RlIHVuaXRzLiBBbGwgdGV4dCBvZmZzZXRzIGFyZSBleHBlY3RlZCB0byBiZSBpbiBjb2RlIHVuaXRzLlxuICAgIC8vIFNlZSBja2VkaXRvci9ja2VkaXRvcjUjMzE0Ny5cbiAgICAvL1xuICAgIC8vIFdlIG5lZWQgdG8gbWFrZSBzdXJlIGhlcmUgdGhhdCBmYXN0RGlmZigpIHdvcmtzIGlkZW50aWNhbCB0byBkaWZmKCkuXG4gICAgY29uc3QgYXJyYXlBID0gQXJyYXkuaXNBcnJheShhKSA/IGEgOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhKTtcbiAgICBjb25zdCBhcnJheUIgPSBBcnJheS5pc0FycmF5KGIpID8gYiA6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGIpO1xuICAgIC8vIEZpbmQgZmlyc3QgYW5kIGxhc3QgY2hhbmdlLlxuICAgIGNvbnN0IGNoYW5nZUluZGV4ZXMgPSBmaW5kQ2hhbmdlQm91bmRhcnlJbmRleGVzKGFycmF5QSwgYXJyYXlCLCBjbXApO1xuICAgIC8vIFRyYW5zZm9ybSBpbnRvIGNoYW5nZXMgYXJyYXkuXG4gICAgY29uc3QgcmVzdWx0ID0gYXRvbWljQ2hhbmdlcyA/IGNoYW5nZUluZGV4ZXNUb0F0b21pY0NoYW5nZXMoY2hhbmdlSW5kZXhlcywgYXJyYXlCLmxlbmd0aCkgOiBjaGFuZ2VJbmRleGVzVG9DaGFuZ2VzKGFycmF5QiwgY2hhbmdlSW5kZXhlcyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbi8qKlxuICogRmluZHMgcG9zaXRpb24gb2YgdGhlIGZpcnN0IGFuZCBsYXN0IGNoYW5nZSBpbiB0aGUgZ2l2ZW4gYXJyYXlzLiBGb3IgZXhhbXBsZTpcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgaW5kZXhlcyA9IGZpbmRDaGFuZ2VCb3VuZGFyeUluZGV4ZXMoIFsgJzEnLCAnMicsICczJywgJzQnIF0sIFsgJzEnLCAnMycsICc0JywgJzInLCAnNCcgXSApO1xuICogY29uc29sZS5sb2coIGluZGV4ZXMgKTsgLy8geyBmaXJzdEluZGV4OiAxLCBsYXN0SW5kZXhPbGQ6IDMsIGxhc3RJbmRleE5ldzogNCB9XG4gKiBgYGBcbiAqXG4gKiBUaGUgYWJvdmUgaW5kZXhlcyBtZWFucyB0aGF0IGluIHRoZSBmaXJzdCBhcnJheSB0aGUgbW9kaWZpZWQgcGFydCBpcyBgMVsyM100YCBhbmQgaW4gdGhlIHNlY29uZCBhcnJheSBpdCBpcyBgMVszNDJdNGAuXG4gKiBCYXNlZCBvbiBzdWNoIGluZGV4ZXMsIGFycmF5IHdpdGggYGluc2VydGAvYGRlbGV0ZWAgb3BlcmF0aW9ucyB3aGljaCBhbGxvd3MgdHJhbnNmb3JtaW5nIGZpcnN0IHZhbHVlIGludG8gdGhlIHNlY29uZCBvbmVcbiAqIGNhbiBiZSBnZW5lcmF0ZWQuXG4gKi8gZnVuY3Rpb24gZmluZENoYW5nZUJvdW5kYXJ5SW5kZXhlcyhhcnIxLCBhcnIyLCBjbXApIHtcbiAgICAvLyBGaW5kIHRoZSBmaXJzdCBkaWZmZXJlbmNlIGJldHdlZW4gcGFzc2VkIHZhbHVlcy5cbiAgICBjb25zdCBmaXJzdEluZGV4ID0gZmluZEZpcnN0RGlmZmVyZW5jZUluZGV4KGFycjEsIGFycjIsIGNtcCk7XG4gICAgLy8gSWYgYXJyYXlzIGFyZSBlcXVhbCByZXR1cm4gLTEgaW5kZXhlcyBvYmplY3QuXG4gICAgaWYgKGZpcnN0SW5kZXggPT09IC0xKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaXJzdEluZGV4OiAtMSxcbiAgICAgICAgICAgIGxhc3RJbmRleE9sZDogLTEsXG4gICAgICAgICAgICBsYXN0SW5kZXhOZXc6IC0xXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8vIFJlbW92ZSB0aGUgY29tbW9uIHBhcnQgb2YgZWFjaCB2YWx1ZSBhbmQgcmV2ZXJzZSB0aGVtIHRvIG1ha2UgaXQgc2ltcGxlciB0byBmaW5kIHRoZSBsYXN0IGRpZmZlcmVuY2UgYmV0d2VlbiB0aGVtLlxuICAgIGNvbnN0IG9sZEFycmF5UmV2ZXJzZWQgPSBjdXRBbmRSZXZlcnNlKGFycjEsIGZpcnN0SW5kZXgpO1xuICAgIGNvbnN0IG5ld0FycmF5UmV2ZXJzZWQgPSBjdXRBbmRSZXZlcnNlKGFycjIsIGZpcnN0SW5kZXgpO1xuICAgIC8vIEZpbmQgdGhlIGZpcnN0IGRpZmZlcmVuY2UgYmV0d2VlbiByZXZlcnNlZCB2YWx1ZXMuXG4gICAgLy8gSXQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgXCJob3cgbWFueSBlbGVtZW50cyBmcm9tIHRoZSBlbmQgdGhlIGxhc3QgZGlmZmVyZW5jZSBvY2N1cnJlZFwiLlxuICAgIC8vXG4gICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgLy9cbiAgICAvLyBcdFx0XHRcdGluaXRpYWxcdC0+XHRhZnRlciBjdXRcdC0+IHJldmVyc2VkOlxuICAgIC8vIG9sZFZhbHVlOlx0JzMyMWJhJ1x0LT5cdCcyMWJhJ1x0XHQtPiAnYWIxMidcbiAgICAvLyBuZXdWYWx1ZTpcdCczMXhiYSdcdC0+XHQnMXhiYSdcdFx0LT4gJ2FieDEnXG4gICAgLy8gbGFzdEluZGV4Olx0XHRcdFx0XHRcdFx0LT4gMlxuICAgIC8vXG4gICAgLy8gU28gdGhlIGxhc3QgY2hhbmdlIG9jY3VycmVkIHR3byBjaGFyYWN0ZXJzIGZyb20gdGhlIGVuZCBvZiB0aGUgYXJyYXlzLlxuICAgIGNvbnN0IGxhc3RJbmRleCA9IGZpbmRGaXJzdERpZmZlcmVuY2VJbmRleChvbGRBcnJheVJldmVyc2VkLCBuZXdBcnJheVJldmVyc2VkLCBjbXApO1xuICAgIC8vIFVzZSBgbGFzdEluZGV4YCB0byBjYWxjdWxhdGUgcHJvcGVyIG9mZnNldCwgc3RhcnRpbmcgZnJvbSB0aGUgYmVnaW5uaW5nIChgbGFzdEluZGV4YCBraW5kIG9mIHN0YXJ0cyBmcm9tIHRoZSBlbmQpLlxuICAgIGNvbnN0IGxhc3RJbmRleE9sZCA9IGFycjEubGVuZ3RoIC0gbGFzdEluZGV4O1xuICAgIGNvbnN0IGxhc3RJbmRleE5ldyA9IGFycjIubGVuZ3RoIC0gbGFzdEluZGV4O1xuICAgIHJldHVybiB7XG4gICAgICAgIGZpcnN0SW5kZXgsXG4gICAgICAgIGxhc3RJbmRleE9sZCxcbiAgICAgICAgbGFzdEluZGV4TmV3XG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyBhIGZpcnN0IGluZGV4IG9uIHdoaWNoIGdpdmVuIGFycmF5cyBkaWZmZXIuIElmIGJvdGggYXJyYXlzIGFyZSB0aGUgc2FtZSwgLTEgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gZmluZEZpcnN0RGlmZmVyZW5jZUluZGV4KGFycjEsIGFycjIsIGNtcCkge1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBNYXRoLm1heChhcnIxLmxlbmd0aCwgYXJyMi5sZW5ndGgpOyBpKyspe1xuICAgICAgICBpZiAoYXJyMVtpXSA9PT0gdW5kZWZpbmVkIHx8IGFycjJbaV0gPT09IHVuZGVmaW5lZCB8fCAhY21wKGFycjFbaV0sIGFycjJbaV0pKSB7XG4gICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gLTE7IC8vIFJldHVybiAtMSBpZiBhcnJheXMgYXJlIGVxdWFsLlxufVxuLyoqXG4gKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgZ2l2ZW4gYXJyYXkgd2l0aCBgaG93TWFueWAgZWxlbWVudHMgcmVtb3ZlZCBzdGFydGluZyBmcm9tIHRoZSBiZWdpbm5pbmcgYW5kIGluIHJldmVyc2VkIG9yZGVyLlxuICpcbiAqIEBwYXJhbSBhcnIgQXJyYXkgdG8gYmUgcHJvY2Vzc2VkLlxuICogQHBhcmFtIGhvd01hbnkgSG93IG1hbnkgZWxlbWVudHMgZnJvbSBhcnJheSBiZWdpbm5pbmcgdG8gcmVtb3ZlLlxuICogQHJldHVybnMgU2hvcnRlbmVkIGFuZCByZXZlcnNlZCBhcnJheS5cbiAqLyBmdW5jdGlvbiBjdXRBbmRSZXZlcnNlKGFyciwgaG93TWFueSkge1xuICAgIHJldHVybiBhcnIuc2xpY2UoaG93TWFueSkucmV2ZXJzZSgpO1xufVxuLyoqXG4gKiBHZW5lcmF0ZXMgY2hhbmdlcyBhcnJheSBiYXNlZCBvbiBjaGFuZ2UgaW5kZXhlcyBmcm9tIGBmaW5kQ2hhbmdlQm91bmRhcnlJbmRleGVzYCBmdW5jdGlvbi4gVGhpcyBmdW5jdGlvbiB3aWxsXG4gKiBnZW5lcmF0ZSBhcnJheSB3aXRoIDAgKG5vIGNoYW5nZXMpLCAxIChkZWxldGlvbiBvciBpbnNlcnRpb24pIG9yIDIgcmVjb3JkcyAoaW5zZXJ0aW9uIGFuZCBkZWxldGlvbikuXG4gKlxuICogQHBhcmFtIG5ld0FycmF5IE5ldyBhcnJheSBmb3Igd2hpY2ggY2hhbmdlIGluZGV4ZXMgd2VyZSBjYWxjdWxhdGVkLlxuICogQHBhcmFtIGNoYW5nZUluZGV4ZXMgQ2hhbmdlIGluZGV4ZXMgb2JqZWN0IGZyb20gYGZpbmRDaGFuZ2VCb3VuZGFyeUluZGV4ZXNgIGZ1bmN0aW9uLlxuICogQHJldHVybnMgQXJyYXkgb2YgY2hhbmdlcyBjb21wYXRpYmxlIHdpdGgge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmdG9jaGFuZ2VzfmRpZmZUb0NoYW5nZXN9IGZvcm1hdC5cbiAqLyBmdW5jdGlvbiBjaGFuZ2VJbmRleGVzVG9DaGFuZ2VzKG5ld0FycmF5LCBjaGFuZ2VJbmRleGVzKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgY29uc3QgeyBmaXJzdEluZGV4LCBsYXN0SW5kZXhPbGQsIGxhc3RJbmRleE5ldyB9ID0gY2hhbmdlSW5kZXhlcztcbiAgICAvLyBPcmRlciBvcGVyYXRpb25zIGFzICdpbnNlcnQnLCAnZGVsZXRlJyBhcnJheSB0byBrZWVwIGNvbXBhdGliaWxpdHkgd2l0aCB7QGxpbmsgbW9kdWxlOnV0aWxzL2RpZmZ0b2NoYW5nZXN+ZGlmZlRvQ2hhbmdlc31cbiAgICAvLyBpbiBtb3N0IGNhc2VzLiBIb3dldmVyLCAnZGlmZlRvQ2hhbmdlcycgZG9lcyBub3Qgc3RpY2sgdG8gYW55IG9yZGVyIHNvIGluIHNvbWUgY2FzZXNcbiAgICAvLyAoZm9yIGV4YW1wbGUgcmVwbGFjaW5nICcxMjM0NScgd2l0aCAnYWJjZCcpIGl0IHdpbGwgZ2VuZXJhdGUgJ2RlbGV0ZScsICdpbnNlcnQnIG9yZGVyLlxuICAgIGlmIChsYXN0SW5kZXhOZXcgLSBmaXJzdEluZGV4ID4gMCkge1xuICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICBpbmRleDogZmlyc3RJbmRleCxcbiAgICAgICAgICAgIHR5cGU6ICdpbnNlcnQnLFxuICAgICAgICAgICAgdmFsdWVzOiBuZXdBcnJheS5zbGljZShmaXJzdEluZGV4LCBsYXN0SW5kZXhOZXcpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAobGFzdEluZGV4T2xkIC0gZmlyc3RJbmRleCA+IDApIHtcbiAgICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICAgICAgaW5kZXg6IGZpcnN0SW5kZXggKyAobGFzdEluZGV4TmV3IC0gZmlyc3RJbmRleCksXG4gICAgICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgICAgIGhvd01hbnk6IGxhc3RJbmRleE9sZCAtIGZpcnN0SW5kZXhcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4vKipcbiAqIEdlbmVyYXRlcyBhcnJheSB3aXRoIHNldCBgZXF1YWx8aW5zZXJ0fGRlbGV0ZWAgb3BlcmF0aW9ucyBiYXNlZCBvbiBjaGFuZ2UgaW5kZXhlcyBmcm9tIGBmaW5kQ2hhbmdlQm91bmRhcnlJbmRleGVzYCBmdW5jdGlvbi5cbiAqXG4gKiBAcGFyYW0gY2hhbmdlSW5kZXhlcyBDaGFuZ2UgaW5kZXhlcyBvYmplY3QgZnJvbSBgZmluZENoYW5nZUJvdW5kYXJ5SW5kZXhlc2AgZnVuY3Rpb24uXG4gKiBAcGFyYW0gbmV3TGVuZ3RoIExlbmd0aCBvZiB0aGUgbmV3IGFycmF5IG9uIHdoaWNoIGBmaW5kQ2hhbmdlQm91bmRhcnlJbmRleGVzYCBjYWxjdWxhdGVkIGNoYW5nZSBpbmRleGVzLlxuICogQHJldHVybnMgQXJyYXkgb2YgY2hhbmdlcyBjb21wYXRpYmxlIHdpdGgge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmfmRpZmZ9IGZvcm1hdC5cbiAqLyBmdW5jdGlvbiBjaGFuZ2VJbmRleGVzVG9BdG9taWNDaGFuZ2VzKGNoYW5nZUluZGV4ZXMsIG5ld0xlbmd0aCkge1xuICAgIGNvbnN0IHsgZmlyc3RJbmRleCwgbGFzdEluZGV4T2xkLCBsYXN0SW5kZXhOZXcgfSA9IGNoYW5nZUluZGV4ZXM7XG4gICAgLy8gTm8gY2hhbmdlcy5cbiAgICBpZiAoZmlyc3RJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5KG5ld0xlbmd0aCkuZmlsbCgnZXF1YWwnKTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgIGlmIChmaXJzdEluZGV4ID4gMCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KEFycmF5KGZpcnN0SW5kZXgpLmZpbGwoJ2VxdWFsJykpO1xuICAgIH1cbiAgICBpZiAobGFzdEluZGV4TmV3IC0gZmlyc3RJbmRleCA+IDApIHtcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdChBcnJheShsYXN0SW5kZXhOZXcgLSBmaXJzdEluZGV4KS5maWxsKCdpbnNlcnQnKSk7XG4gICAgfVxuICAgIGlmIChsYXN0SW5kZXhPbGQgLSBmaXJzdEluZGV4ID4gMCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KEFycmF5KGxhc3RJbmRleE9sZCAtIGZpcnN0SW5kZXgpLmZpbGwoJ2RlbGV0ZScpKTtcbiAgICB9XG4gICAgaWYgKGxhc3RJbmRleE5ldyA8IG5ld0xlbmd0aCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KEFycmF5KG5ld0xlbmd0aCAtIGxhc3RJbmRleE5ldykuZmlsbCgnZXF1YWwnKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIFRoZSBmb2xsb3dpbmcgY29kZSBpcyBiYXNlZCBvbiB0aGUgXCJPKE5QKSBTZXF1ZW5jZSBDb21wYXJpc29uIEFsZ29yaXRobVwiXG4vLyBieSBTdW4gV3UsIFVkaSBNYW5iZXIsIEdlbmUgTXllcnMsIFdlYmIgTWlsbGVyLlxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdHdvIGFycmF5cyBvciBzdHJpbmdzIHByb2R1Y2luZyBhbiBhcnJheSBjb250YWluaW5nIGEgbGlzdCBvZiBjaGFuZ2VzXG4gKiBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIGlucHV0IGludG8gb3V0cHV0LlxuICpcbiAqIGBgYHRzXG4gKiBkaWZmKCAnYWJhJywgJ2FjY2EnICk7IC8vIFsgJ2VxdWFsJywgJ2luc2VydCcsICdpbnNlcnQnLCAnZGVsZXRlJywgJ2VxdWFsJyBdXG4gKiBgYGBcbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGJhc2VkIG9uIHRoZSBcIk8oTlApIFNlcXVlbmNlIENvbXBhcmlzb24gQWxnb3JpdGhtXCIgYnkgU3VuIFd1LCBVZGkgTWFuYmVyLCBHZW5lIE15ZXJzLCBXZWJiIE1pbGxlci5cbiAqIFVuZm9ydHVuYXRlbHksIHdoaWxlIGl0IGdpdmVzIHRoZSBtb3N0IHByZWNpc2UgcmVzdWx0cywgaXRzIHRvIGNvbXBsZXggZm9yIGxvbmdlciBzdHJpbmdzL2Fycm93IChhYm92ZSAyMDAgaXRlbXMpLlxuICogVGhlcmVmb3JlLCBgZGlmZigpYCBhdXRvbWF0aWNhbGx5IHN3aXRjaGVzIHRvIHtAbGluayBtb2R1bGU6dXRpbHMvZmFzdGRpZmZ+ZmFzdERpZmYgYGZhc3REaWZmKClgfSB3aGVuIGRldGVjdGluZ1xuICogc3VjaCBhIHNjZW5hcmlvLiBUaGUgcmV0dXJuIGZvcm1hdHMgb2YgYm90aCBmdW5jdGlvbnMgYXJlIGlkZW50aWNhbC5cbiAqXG4gKiBAcGFyYW0gYSBJbnB1dCBhcnJheSBvciBzdHJpbmcuXG4gKiBAcGFyYW0gYiBPdXRwdXQgYXJyYXkgb3Igc3RyaW5nLlxuICogQHBhcmFtIGNtcCBPcHRpb25hbCBmdW5jdGlvbiB1c2VkIHRvIGNvbXBhcmUgYXJyYXkgdmFsdWVzLCBieSBkZWZhdWx0ID09PSBpcyB1c2VkLlxuICogQHJldHVybnMgQXJyYXkgb2YgY2hhbmdlcy5cbiAqLyBmdW5jdGlvbiBkaWZmKGEsIGIsIGNtcCkge1xuICAgIC8vIFNldCB0aGUgY29tcGFyYXRvciBmdW5jdGlvbi5cbiAgICBjbXAgPSBjbXAgfHwgZnVuY3Rpb24oYSwgYikge1xuICAgICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICB9O1xuICAgIGNvbnN0IGFMZW5ndGggPSBhLmxlbmd0aDtcbiAgICBjb25zdCBiTGVuZ3RoID0gYi5sZW5ndGg7XG4gICAgLy8gUGVyZm9ybSBgZmFzdERpZmZgIGZvciBsb25nZXIgc3RyaW5ncy9hcnJheXMgKHNlZSAjMjY5KS5cbiAgICBpZiAoYUxlbmd0aCA+IDIwMCB8fCBiTGVuZ3RoID4gMjAwIHx8IGFMZW5ndGggKyBiTGVuZ3RoID4gMzAwKSB7XG4gICAgICAgIHJldHVybiBkaWZmLmZhc3REaWZmKGEsIGIsIGNtcCwgdHJ1ZSk7XG4gICAgfVxuICAgIC8vIFRlbXBvcmFyeSBhY3Rpb24gdHlwZSBzdGF0aWNzLlxuICAgIGxldCBfaW5zZXJ0LCBfZGVsZXRlO1xuICAgIC8vIFN3YXBwZWQgdGhlIGFycmF5cyB0byB1c2UgdGhlIHNob3J0ZXIgb25lIGFzIHRoZSBmaXJzdCBvbmUuXG4gICAgaWYgKGJMZW5ndGggPCBhTGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHRtcCA9IGE7XG4gICAgICAgIGEgPSBiO1xuICAgICAgICBiID0gdG1wO1xuICAgICAgICAvLyBXZSBzd2FwIHRoZSBhY3Rpb24gdHlwZXMgYXMgd2VsbC5cbiAgICAgICAgX2luc2VydCA9ICdkZWxldGUnO1xuICAgICAgICBfZGVsZXRlID0gJ2luc2VydCc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgX2luc2VydCA9ICdpbnNlcnQnO1xuICAgICAgICBfZGVsZXRlID0gJ2RlbGV0ZSc7XG4gICAgfVxuICAgIGNvbnN0IG0gPSBhLmxlbmd0aDtcbiAgICBjb25zdCBuID0gYi5sZW5ndGg7XG4gICAgY29uc3QgZGVsdGEgPSBuIC0gbTtcbiAgICAvLyBFZGl0IHNjcmlwdHMsIGZvciBlYWNoIGRpYWdvbmFsLlxuICAgIGNvbnN0IGVzID0ge307XG4gICAgLy8gRnVydGhlc3QgcG9pbnRzLCB0aGUgZnVydGhlc3QgeSB3ZSBjYW4gZ2V0IG9uIGVhY2ggZGlhZ29uYWwuXG4gICAgY29uc3QgZnAgPSB7fTtcbiAgICBmdW5jdGlvbiBzbmFrZShrKSB7XG4gICAgICAgIC8vIFdlIHVzZSAtMSBhcyBhbiBhbHRlcm5hdGl2ZSBiZWxvdyB0byBoYW5kbGUgaW5pdGlhbCB2YWx1ZXMgKCBpbnN0ZWFkIG9mIGZpbGxpbmcgdGhlIGZwIHdpdGggLTEgZmlyc3QgKS5cbiAgICAgICAgLy8gRnVydGhlc3QgcG9pbnRzICh5KSBvbiB0aGUgZGlhZ29uYWwgYmVsb3cgay5cbiAgICAgICAgY29uc3QgeTEgPSAoZnBbayAtIDFdICE9PSB1bmRlZmluZWQgPyBmcFtrIC0gMV0gOiAtMSkgKyAxO1xuICAgICAgICAvLyBGdXJ0aGVzdCBwb2ludHMgKHkpIG9uIHRoZSBkaWFnb25hbCBhYm92ZSBrLlxuICAgICAgICBjb25zdCB5MiA9IGZwW2sgKyAxXSAhPT0gdW5kZWZpbmVkID8gZnBbayArIDFdIDogLTE7XG4gICAgICAgIC8vIFRoZSB3YXkgd2Ugc2hvdWxkIGdvIHRvIGdldCBmdXJ0aGVyLlxuICAgICAgICBjb25zdCBkaXIgPSB5MSA+IHkyID8gLTEgOiAxO1xuICAgICAgICAvLyBDbG9uZSBwcmV2aW91cyBjaGFuZ2VzIGFycmF5IChpZiBhbnkpLlxuICAgICAgICBpZiAoZXNbayArIGRpcl0pIHtcbiAgICAgICAgICAgIGVzW2tdID0gZXNbayArIGRpcl0uc2xpY2UoMCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIGNoYW5nZXMgYXJyYXkuXG4gICAgICAgIGlmICghZXNba10pIHtcbiAgICAgICAgICAgIGVzW2tdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgLy8gUHVzaCB0aGUgYWN0aW9uLlxuICAgICAgICBlc1trXS5wdXNoKHkxID4geTIgPyBfaW5zZXJ0IDogX2RlbGV0ZSk7XG4gICAgICAgIC8vIFNldCB0aGUgYmVnaW5uaW5nIGNvb3JkaW5hdGVzLlxuICAgICAgICBsZXQgeSA9IE1hdGgubWF4KHkxLCB5Mik7XG4gICAgICAgIGxldCB4ID0geSAtIGs7XG4gICAgICAgIC8vIFRyYXZlcnNlIHRoZSBkaWFnb25hbCBhcyBsb25nIGFzIHRoZSB2YWx1ZXMgbWF0Y2guXG4gICAgICAgIHdoaWxlKHggPCBtICYmIHkgPCBuICYmIGNtcChhW3hdLCBiW3ldKSl7XG4gICAgICAgICAgICB4Kys7XG4gICAgICAgICAgICB5Kys7XG4gICAgICAgICAgICAvLyBQdXNoIG5vIGNoYW5nZSBhY3Rpb24uXG4gICAgICAgICAgICBlc1trXS5wdXNoKCdlcXVhbCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB5O1xuICAgIH1cbiAgICBsZXQgcCA9IDA7XG4gICAgbGV0IGs7XG4gICAgLy8gVHJhdmVyc2UgdGhlIGdyYXBoIHVudGlsIHdlIHJlYWNoIHRoZSBlbmQgb2YgdGhlIGxvbmdlciBzdHJpbmcuXG4gICAgZG8ge1xuICAgICAgICAvLyBVcGRhdGVzIGZ1cnRoZXN0IHBvaW50cyBhbmQgZWRpdCBzY3JpcHRzIGZvciBkaWFnb25hbHMgYmVsb3cgZGVsdGEuXG4gICAgICAgIGZvcihrID0gLXA7IGsgPCBkZWx0YTsgaysrKXtcbiAgICAgICAgICAgIGZwW2tdID0gc25ha2Uoayk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlcyBmdXJ0aGVzdCBwb2ludHMgYW5kIGVkaXQgc2NyaXB0cyBmb3IgZGlhZ29uYWxzIGFib3ZlIGRlbHRhLlxuICAgICAgICBmb3IoayA9IGRlbHRhICsgcDsgayA+IGRlbHRhOyBrLS0pe1xuICAgICAgICAgICAgZnBba10gPSBzbmFrZShrKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBVcGRhdGVzIGZ1cnRoZXN0IHBvaW50IGFuZCBlZGl0IHNjcmlwdCBmb3IgdGhlIGRlbHRhIGRpYWdvbmFsLlxuICAgICAgICAvLyBub3RlIHRoYXQgdGhlIGRlbHRhIGRpYWdvbmFsIGlzIHRoZSBvbmUgd2hpY2ggZ29lcyB0aHJvdWdoIHRoZSBzaW5rIChtLCBuKS5cbiAgICAgICAgZnBbZGVsdGFdID0gc25ha2UoZGVsdGEpO1xuICAgICAgICBwKys7XG4gICAgfXdoaWxlIChmcFtkZWx0YV0gIT09IG4pXG4gICAgLy8gUmV0dXJuIHRoZSBmaW5hbCBsaXN0IG9mIGVkaXQgY2hhbmdlcy5cbiAgICAvLyBXZSByZW1vdmUgdGhlIGZpcnN0IGl0ZW0gdGhhdCByZXByZXNlbnRzIHRoZSBhY3Rpb24gZm9yIHRoZSBpbmplY3RlZCBudWxscy5cbiAgICByZXR1cm4gZXNbZGVsdGFdLnNsaWNlKDEpO1xufVxuLy8gU3RvcmUgdGhlIEFQSSBpbiBzdGF0aWMgcHJvcGVydHkgdG8gZWFzaWx5IG92ZXJ3cml0ZSBpdCBpbiB0ZXN0cy5cbi8vIFRvbyBiYWQgZGVwZW5kZW5jeSBpbmplY3Rpb24gZG9lcyBub3Qgd29yayBpbiBXZWJwYWNrICsgRVMgNiAoY29uc3QpICsgQmFiZWwuXG5kaWZmLmZhc3REaWZmID0gZmFzdERpZmY7XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZGlmZnRvY2hhbmdlc1xuICovIC8qKlxuICogQ3JlYXRlcyBhIHNldCBvZiBjaGFuZ2VzIHdoaWNoIG5lZWQgdG8gYmUgYXBwbGllZCB0byB0aGUgaW5wdXQgaW4gb3JkZXIgdG8gdHJhbnNmb3JtXG4gKiBpdCBpbnRvIHRoZSBvdXRwdXQuIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgd2l0aCBzdHJpbmdzIG9yIGFycmF5cy5cbiAqXG4gKiBgYGB0c1xuICogY29uc3QgaW5wdXQgPSBBcnJheS5mcm9tKCAnYWJjJyApO1xuICogY29uc3Qgb3V0cHV0ID0gQXJyYXkuZnJvbSggJ3hhYnknICk7XG4gKiBjb25zdCBjaGFuZ2VzID0gZGlmZlRvQ2hhbmdlcyggZGlmZiggaW5wdXQsIG91dHB1dCApLCBvdXRwdXQgKTtcbiAqXG4gKiBjaGFuZ2VzLmZvckVhY2goIGNoYW5nZSA9PiB7XG4gKiBcdGlmICggY2hhbmdlLnR5cGUgPT0gJ2luc2VydCcgKSB7XG4gKiBcdFx0aW5wdXQuc3BsaWNlKCBjaGFuZ2UuaW5kZXgsIDAsIC4uLmNoYW5nZS52YWx1ZXMgKTtcbiAqIFx0fSBlbHNlIGlmICggY2hhbmdlLnR5cGUgPT0gJ2RlbGV0ZScgKSB7XG4gKiBcdFx0aW5wdXQuc3BsaWNlKCBjaGFuZ2UuaW5kZXgsIGNoYW5nZS5ob3dNYW55ICk7XG4gKiBcdH1cbiAqIH0gKTtcbiAqXG4gKiBpbnB1dC5qb2luKCAnJyApID09IG91dHB1dC5qb2luKCAnJyApOyAvLyAtPiB0cnVlXG4gKiBgYGBcbiAqXG4gKiBAdHlwZVBhcmFtIFQgVGhlIHR5cGUgb2Ygb3V0cHV0IGFycmF5IGVsZW1lbnQuXG4gKiBAcGFyYW0gZGlmZiBSZXN1bHQgb2Yge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmfmRpZmZ9LlxuICogQHBhcmFtIG91dHB1dCBUaGUgc3RyaW5nIG9yIGFycmF5IHdoaWNoIHdhcyBwYXNzZWQgYXMgZGlmZidzIG91dHB1dC5cbiAqIEByZXR1cm5zIFNldCBvZiBjaGFuZ2VzIChpbnNlcnQgb3IgZGVsZXRlKSB3aGljaCBuZWVkIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGlucHV0XG4gKiBpbiBvcmRlciB0byB0cmFuc2Zvcm0gaXQgaW50byB0aGUgb3V0cHV0LlxuICovIGZ1bmN0aW9uIGRpZmZUb0NoYW5nZXMoZGlmZiwgb3V0cHV0KSB7XG4gICAgY29uc3QgY2hhbmdlcyA9IFtdO1xuICAgIGxldCBpbmRleCA9IDA7XG4gICAgbGV0IGxhc3RPcGVyYXRpb24gPSBudWxsO1xuICAgIGRpZmYuZm9yRWFjaCgoY2hhbmdlKT0+e1xuICAgICAgICBpZiAoY2hhbmdlID09ICdlcXVhbCcpIHtcbiAgICAgICAgICAgIHB1c2hMYXN0KCk7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICB9IGVsc2UgaWYgKGNoYW5nZSA9PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgaWYgKGxhc3RPcGVyYXRpb24gJiYgbGFzdE9wZXJhdGlvbi50eXBlID09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgbGFzdE9wZXJhdGlvbi52YWx1ZXMucHVzaChvdXRwdXRbaW5kZXhdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHVzaExhc3QoKTtcbiAgICAgICAgICAgICAgICBsYXN0T3BlcmF0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW5zZXJ0JyxcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2luZGV4XVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgIH0gZWxzZSAvKiBpZiAoIGNoYW5nZSA9PSAnZGVsZXRlJyApICovIHtcbiAgICAgICAgICAgIGlmIChsYXN0T3BlcmF0aW9uICYmIGxhc3RPcGVyYXRpb24udHlwZSA9PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgIGxhc3RPcGVyYXRpb24uaG93TWFueSsrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwdXNoTGFzdCgpO1xuICAgICAgICAgICAgICAgIGxhc3RPcGVyYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkZWxldGUnLFxuICAgICAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgaG93TWFueTogMVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBwdXNoTGFzdCgpO1xuICAgIHJldHVybiBjaGFuZ2VzO1xuICAgIGZ1bmN0aW9uIHB1c2hMYXN0KCkge1xuICAgICAgICBpZiAobGFzdE9wZXJhdGlvbikge1xuICAgICAgICAgICAgY2hhbmdlcy5wdXNoKGxhc3RPcGVyYXRpb24pO1xuICAgICAgICAgICAgbGFzdE9wZXJhdGlvbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvbWl4XG4gKi8gLyoqXG4gKiBDb3BpZXMgZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGFuZCBzeW1ib2xzIGZyb20gdGhlIG9iamVjdHMgZ2l2ZW4gYXMgMm5kKyBwYXJhbWV0ZXJzIHRvIHRoZVxuICogcHJvdG90eXBlIG9mIGZpcnN0IG9iamVjdCAoYSBjb25zdHJ1Y3RvcikuXG4gKlxuICogYGBgXG4gKiBjbGFzcyBFZGl0b3Ige1xuICogXHQuLi5cbiAqIH1cbiAqXG4gKiBjb25zdCBTb21lTWl4aW4gPSB7XG4gKiBcdGEoKSB7XG4gKiBcdFx0cmV0dXJuICdhJztcbiAqIFx0fVxuICogfTtcbiAqXG4gKiBtaXgoIEVkaXRvciwgU29tZU1peGluLCAuLi4gKTtcbiAqXG4gKiBuZXcgRWRpdG9yKCkuYSgpOyAvLyAtPiAnYSdcbiAqIGBgYFxuICpcbiAqIE5vdGU6IFByb3BlcnRpZXMgd2hpY2ggYWxyZWFkeSBleGlzdCBpbiB0aGUgYmFzZSBjbGFzcyB3aWxsIG5vdCBiZSBvdmVycmlkZW4uXG4gKlxuICogQGRlcHJlY2F0ZWQgVXNlIG1peGluIHBhdHRlcm4sIHNlZTogaHR0cHM6Ly93d3cudHlwZXNjcmlwdGxhbmcub3JnL2RvY3MvaGFuZGJvb2svbWl4aW5zLmh0bWwuXG4gKiBAcGFyYW0gYmFzZUNsYXNzIENsYXNzIHdoaWNoIHByb3RvdHlwZSB3aWxsIGJlIGV4dGVuZGVkLlxuICogQHBhcmFtIG1peGlucyBPYmplY3RzIGZyb20gd2hpY2ggdG8gZ2V0IHByb3BlcnRpZXMuXG4gKi8gZnVuY3Rpb24gbWl4KGJhc2VDbGFzcywgLi4ubWl4aW5zKSB7XG4gICAgbWl4aW5zLmZvckVhY2goKG1peGluKT0+e1xuICAgICAgICBjb25zdCBwcm9wZXJ0eU5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobWl4aW4pO1xuICAgICAgICBjb25zdCBwcm9wZXJ0eVN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG1peGluKTtcbiAgICAgICAgcHJvcGVydHlOYW1lcy5jb25jYXQocHJvcGVydHlTeW1ib2xzKS5mb3JFYWNoKChrZXkpPT57XG4gICAgICAgICAgICBpZiAoa2V5IGluIGJhc2VDbGFzcy5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG1peGluID09ICdmdW5jdGlvbicgJiYgKGtleSA9PSAnbGVuZ3RoJyB8fCBrZXkgPT0gJ25hbWUnIHx8IGtleSA9PSAncHJvdG90eXBlJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzb3VyY2VEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtaXhpbiwga2V5KTtcbiAgICAgICAgICAgIHNvdXJjZURlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJhc2VDbGFzcy5wcm90b3R5cGUsIGtleSwgc291cmNlRGVzY3JpcHRvcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL3NweVxuICovIC8qKlxuICogQ3JlYXRlcyBhIHNweSBmdW5jdGlvbiAoYWxhIFNpbm9uLmpzKSB0aGF0IGNhbiBiZSB1c2VkIHRvIGluc3BlY3QgY2FsbCB0byBpdC5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIGFyZSB0aGUgcHJlc2VudCBmZWF0dXJlczpcbiAqXG4gKiAqIHNweS5jYWxsZWQ6IHByb3BlcnR5IHNldCB0byBgdHJ1ZWAgaWYgdGhlIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlLlxuICpcbiAqIEByZXR1cm5zIFRoZSBzcHkgZnVuY3Rpb24uXG4gKi8gZnVuY3Rpb24gc3B5KCkge1xuICAgIHJldHVybiBmdW5jdGlvbiBzcHkoKSB7XG4gICAgICAgIHNweS5jYWxsZWQgPSB0cnVlO1xuICAgIH07XG59XG5cbi8qKlxuICogVGhlIGV2ZW50IG9iamVjdCBwYXNzZWQgdG8gZXZlbnQgY2FsbGJhY2tzLiBJdCBpcyB1c2VkIHRvIHByb3ZpZGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGV2ZW50IGFzIHdlbGwgYXMgYSB0b29sIHRvXG4gKiBtYW5pcHVsYXRlIGl0LlxuICovIGNsYXNzIEV2ZW50SW5mbyB7XG4gICAgLyoqXG5cdCAqIFRoZSBvYmplY3QgdGhhdCBmaXJlZCB0aGUgZXZlbnQuXG5cdCAqLyBzb3VyY2U7XG4gICAgLyoqXG5cdCAqIFRoZSBldmVudCBuYW1lLlxuXHQgKi8gbmFtZTtcbiAgICAvKipcblx0ICogUGF0aCB0aGlzIGV2ZW50IGhhcyBmb2xsb3dlZC4gU2VlIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXIjZGVsZWdhdGV9LlxuXHQgKi8gcGF0aDtcbiAgICAvKipcblx0ICogU3RvcHMgdGhlIGV2ZW50IGVtaXR0ZXIgdG8gY2FsbCBmdXJ0aGVyIGNhbGxiYWNrcyBmb3IgdGhpcyBldmVudCBpbnRlcmFjdGlvbi5cblx0ICovIHN0b3A7XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgdGhlIGN1cnJlbnQgY2FsbGJhY2sgZnJvbSBmdXR1cmUgaW50ZXJhY3Rpb25zIG9mIHRoaXMgZXZlbnQuXG5cdCAqLyBvZmY7XG4gICAgLyoqXG5cdCAqIFRoZSB2YWx1ZSB3aGljaCB3aWxsIGJlIHJldHVybmVkIGJ5IHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXIjZmlyZX0uXG5cdCAqXG5cdCAqIEl0J3MgYHVuZGVmaW5lZGAgYnkgZGVmYXVsdCBhbmQgY2FuIGJlIGNoYW5nZWQgYnkgYW4gZXZlbnQgbGlzdGVuZXI6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGRhdGFDb250cm9sbGVyLmZpcmUoICdnZXRTZWxlY3RlZENvbnRlbnQnLCAoIGV2dCApID0+IHtcblx0ICogXHQvLyBUaGlzIGxpc3RlbmVyIHdpbGwgbWFrZSBgZGF0YUNvbnRyb2xsZXIuZmlyZSggJ2dldFNlbGVjdGVkQ29udGVudCcgKWBcblx0ICogXHQvLyBhbHdheXMgcmV0dXJuIGFuIGVtcHR5IERvY3VtZW50RnJhZ21lbnQuXG5cdCAqIFx0ZXZ0LnJldHVybiA9IG5ldyBEb2N1bWVudEZyYWdtZW50KCk7XG5cdCAqXG5cdCAqIFx0Ly8gTWFrZSBzdXJlIG5vIG90aGVyIGxpc3RlbmVycyBhcmUgZXhlY3V0ZWQuXG5cdCAqIFx0ZXZ0LnN0b3AoKTtcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICovIHJldHVybjtcbiAgICAvKipcblx0ICogQHBhcmFtIHNvdXJjZSBUaGUgZW1pdHRlci5cblx0ICogQHBhcmFtIG5hbWUgVGhlIGV2ZW50IG5hbWUuXG5cdCAqLyBjb25zdHJ1Y3Rvcihzb3VyY2UsIG5hbWUpe1xuICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5wYXRoID0gW107XG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgbWV0aG9kcyBhcmUgZGVmaW5lZCBpbiB0aGUgY29uc3RydWN0b3IgYmVjYXVzZSB0aGV5IG11c3QgYmUgcmUtY3JlYXRlZCBwZXIgaW5zdGFuY2UuXG4gICAgICAgIHRoaXMuc3RvcCA9IHNweSgpO1xuICAgICAgICB0aGlzLm9mZiA9IHNweSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy91aWRcbiAqLyAvKipcbiAqIEEgaGFzaCB0YWJsZSBvZiBoZXggbnVtYmVycyB0byBhdm9pZCB1c2luZyB0b1N0cmluZygpIGluIHVpZCgpIHdoaWNoIGlzIGNvc3RseS5cbiAqIFsgJzAwJywgJzAxJywgJzAyJywgLi4uLCAnZmUnLCAnZmYnIF1cbiAqLyBjb25zdCBIRVhfTlVNQkVSUyA9IG5ldyBBcnJheSgyNTYpLmZpbGwoJycpLm1hcCgoXywgaW5kZXgpPT4oJzAnICsgaW5kZXgudG9TdHJpbmcoMTYpKS5zbGljZSgtMikpO1xuLyoqXG4gKiBSZXR1cm5zIGEgdW5pcXVlIGlkLiBUaGUgaWQgc3RhcnRzIHdpdGggYW4gXCJlXCIgY2hhcmFjdGVyIGFuZCBhIHJhbmRvbWx5IGdlbmVyYXRlZCBzdHJpbmcgb2ZcbiAqIDMyIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzLlxuICpcbiAqICoqTm90ZSoqOiBUaGUgY2hhcmFjdGVycyB0aGUgdW5pcXVlIGlkIGlzIGJ1aWx0IGZyb20gY29ycmVzcG9uZCB0byB0aGUgaGV4IG51bWJlciBub3RhdGlvblxuICogKGZyb20gXCIwXCIgdG8gXCI5XCIsIGZyb20gXCJhXCIgdG8gXCJmXCIpLiBJbiBvdGhlciB3b3JkcywgZWFjaCBpZCBjb3JyZXNwb25kcyB0byBhbiBcImVcIiBmb2xsb3dlZFxuICogYnkgMTYgOC1iaXQgbnVtYmVycyBuZXh0IHRvIGVhY2ggb3RoZXIuXG4gKlxuICogQHJldHVybnMgQW4gdW5pcXVlIGlkIHN0cmluZy5cbiAqLyBmdW5jdGlvbiB1aWQoKSB7XG4gICAgLy8gTGV0J3MgY3JlYXRlIHNvbWUgcG9zaXRpdmUgcmFuZG9tIDMyYml0IGludGVnZXJzIGZpcnN0LlxuICAgIGNvbnN0IFtyMSwgcjIsIHIzLCByNF0gPSBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50MzJBcnJheSg0KSk7XG4gICAgLy8gTWFrZSBzdXJlIHRoYXQgaWQgZG9lcyBub3Qgc3RhcnQgd2l0aCBudW1iZXIuXG4gICAgcmV0dXJuICdlJyArIEhFWF9OVU1CRVJTW3IxID4+IDAgJiAweEZGXSArIEhFWF9OVU1CRVJTW3IxID4+IDggJiAweEZGXSArIEhFWF9OVU1CRVJTW3IxID4+IDE2ICYgMHhGRl0gKyBIRVhfTlVNQkVSU1tyMSA+PiAyNCAmIDB4RkZdICsgSEVYX05VTUJFUlNbcjIgPj4gMCAmIDB4RkZdICsgSEVYX05VTUJFUlNbcjIgPj4gOCAmIDB4RkZdICsgSEVYX05VTUJFUlNbcjIgPj4gMTYgJiAweEZGXSArIEhFWF9OVU1CRVJTW3IyID4+IDI0ICYgMHhGRl0gKyBIRVhfTlVNQkVSU1tyMyA+PiAwICYgMHhGRl0gKyBIRVhfTlVNQkVSU1tyMyA+PiA4ICYgMHhGRl0gKyBIRVhfTlVNQkVSU1tyMyA+PiAxNiAmIDB4RkZdICsgSEVYX05VTUJFUlNbcjMgPj4gMjQgJiAweEZGXSArIEhFWF9OVU1CRVJTW3I0ID4+IDAgJiAweEZGXSArIEhFWF9OVU1CRVJTW3I0ID4+IDggJiAweEZGXSArIEhFWF9OVU1CRVJTW3I0ID4+IDE2ICYgMHhGRl0gKyBIRVhfTlVNQkVSU1tyNCA+PiAyNCAmIDB4RkZdO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL3ByaW9yaXRpZXNcbiAqLyAvKipcbiAqIFN0cmluZyByZXByZXNlbnRpbmcgYSBwcmlvcml0eSB2YWx1ZS5cbiAqLyAvKipcbiAqIFByb3ZpZGVzIGdyb3VwIG9mIGNvbnN0YW50cyB0byB1c2UgaW5zdGVhZCBvZiBoYXJkY29kaW5nIG51bWVyaWMgcHJpb3JpdHkgdmFsdWVzLlxuICovIGNvbnN0IHByaW9yaXRpZXMgPSB7XG4gICAgZ2V0IChwcmlvcml0eSA9ICdub3JtYWwnKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcHJpb3JpdHkgIT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW3ByaW9yaXR5XSB8fCB0aGlzLm5vcm1hbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwcmlvcml0eTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGlnaGVzdDogMTAwMDAwLFxuICAgIGhpZ2g6IDEwMDAsXG4gICAgbm9ybWFsOiAwLFxuICAgIGxvdzogLTFlMyxcbiAgICBsb3dlc3Q6IC0xZTVcbn07XG5cbi8qKlxuICogSW5zZXJ0cyBhbnkgb2JqZWN0IHdpdGggcHJpb3JpdHkgYXQgY29ycmVjdCBpbmRleCBieSBwcmlvcml0eSBzbyByZWdpc3RlcmVkIG9iamVjdHMgYXJlIGFsd2F5cyBzb3J0ZWQgZnJvbSBoaWdoZXN0IHRvIGxvd2VzdCBwcmlvcml0eS5cbiAqXG4gKiBAcGFyYW0gb2JqZWN0cyBBcnJheSBvZiBvYmplY3RzIHdpdGggcHJpb3JpdHkgdG8gaW5zZXJ0IG9iamVjdCB0by5cbiAqIEBwYXJhbSBvYmplY3RUb0luc2VydCBPYmplY3Qgd2l0aCBgcHJpb3JpdHlgIHByb3BlcnR5LlxuICovIGZ1bmN0aW9uIGluc2VydFRvUHJpb3JpdHlBcnJheShvYmplY3RzLCBvYmplY3RUb0luc2VydCkge1xuICAgIGNvbnN0IHByaW9yaXR5ID0gcHJpb3JpdGllcy5nZXQob2JqZWN0VG9JbnNlcnQucHJpb3JpdHkpO1xuICAgIC8vIEJpbmFyeSBzZWFyY2ggZm9yIGJldHRlciBwZXJmb3JtYW5jZSBpbiBsYXJnZSB0YWJsZXMuXG4gICAgbGV0IGxlZnQgPSAwO1xuICAgIGxldCByaWdodCA9IG9iamVjdHMubGVuZ3RoO1xuICAgIHdoaWxlKGxlZnQgPCByaWdodCl7XG4gICAgICAgIGNvbnN0IG1pZCA9IGxlZnQgKyByaWdodCA+PiAxOyAvLyBVc2UgYml0d2lzZSBvcGVyYXRvciBmb3IgZmFzdGVyIGZsb29yIGRpdmlzaW9uIGJ5IDIuXG4gICAgICAgIGNvbnN0IG1pZFByaW9yaXR5ID0gcHJpb3JpdGllcy5nZXQob2JqZWN0c1ttaWRdLnByaW9yaXR5KTtcbiAgICAgICAgaWYgKG1pZFByaW9yaXR5IDwgcHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHJpZ2h0ID0gbWlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGVmdCA9IG1pZCArIDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb2JqZWN0cy5zcGxpY2UobGVmdCwgMCwgb2JqZWN0VG9JbnNlcnQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2NrZWRpdG9yZXJyb3JcbiAqLyAvKiBnbG9iYWxzIGNvbnNvbGUgKi8gLyoqXG4gKiBVUkwgdG8gdGhlIGRvY3VtZW50YXRpb24gd2l0aCBlcnJvciBjb2Rlcy5cbiAqLyBjb25zdCBET0NVTUVOVEFUSU9OX1VSTCA9ICdodHRwczovL2NrZWRpdG9yLmNvbS9kb2NzL2NrZWRpdG9yNS9sYXRlc3Qvc3VwcG9ydC9lcnJvci1jb2Rlcy5odG1sJztcbi8qKlxuICogVGhlIENLRWRpdG9yIGVycm9yIGNsYXNzLlxuICpcbiAqIFlvdSBzaG91bGQgdGhyb3cgYENLRWRpdG9yRXJyb3JgIHdoZW46XG4gKlxuICogKiBBbiB1bmV4cGVjdGVkIHNpdHVhdGlvbiBvY2N1cnJlZCBhbmQgdGhlIGVkaXRvciAobW9zdCBwcm9iYWJseSkgd2lsbCBub3Qgd29yayBwcm9wZXJseS4gU3VjaCBleGNlcHRpb24gd2lsbCBiZSBoYW5kbGVkXG4gKiBieSB0aGUge0BsaW5rIG1vZHVsZTp3YXRjaGRvZy93YXRjaGRvZ35XYXRjaGRvZyB3YXRjaGRvZ30gKGlmIGl0IGlzIGludGVncmF0ZWQpLFxuICogKiBJZiB0aGUgZWRpdG9yIGlzIGluY29ycmVjdGx5IGludGVncmF0ZWQgb3IgdGhlIGVkaXRvciBBUEkgaXMgdXNlZCBpbiB0aGUgd3Jvbmcgd2F5LiBUaGlzIHdheSB5b3Ugd2lsbCBnaXZlXG4gKiBmZWVkYmFjayB0byB0aGUgZGV2ZWxvcGVyIGFzIHNvb24gYXMgcG9zc2libGUuIEtlZXAgaW4gbWluZCB0aGF0IGZvciBjb21tb24gaW50ZWdyYXRpb24gaXNzdWVzIHdoaWNoIHNob3VsZCBub3RcbiAqIHN0b3AgZWRpdG9yIGluaXRpYWxpemF0aW9uIChsaWtlIG1pc3NpbmcgdXBsb2FkIGFkYXB0ZXIsIHdyb25nIG5hbWUgb2YgYSB0b29sYmFyIGNvbXBvbmVudCkgd2UgdXNlXG4gKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+bG9nV2FybmluZyBgbG9nV2FybmluZygpYH0gYW5kXG4gKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+bG9nRXJyb3IgYGxvZ0Vycm9yKClgfVxuICogdG8gaW1wcm92ZSBkZXZlbG9wZXJzIGV4cGVyaWVuY2UgYW5kIGxldCB0aGVtIHNlZSB0aGUgYSB3b3JraW5nIGVkaXRvciBhcyBzb29uIGFzIHBvc3NpYmxlLlxuICpcbiAqIGBgYHRzXG4gKiAvKipcbiAqICAqIEVycm9yIHRocm93biB3aGVuIGEgcGx1Z2luIGNhbm5vdCBiZSBsb2FkZWQgZHVlIHRvIEphdmFTY3JpcHQgZXJyb3JzLCBsYWNrIG9mIHBsdWdpbnMgd2l0aCBhIGdpdmVuIG5hbWUsIGV0Yy5cbiAqICAqXG4gKiAgKiBAZXJyb3IgcGx1Z2luLWxvYWRcbiAqICAqIEBwYXJhbSBwbHVnaW5OYW1lIFRoZSBuYW1lIG9mIHRoZSBwbHVnaW4gdGhhdCBjb3VsZCBub3QgYmUgbG9hZGVkLlxuICogICogQHBhcmFtIG1vZHVsZU5hbWUgVGhlIG5hbWUgb2YgdGhlIG1vZHVsZSB3aGljaCB0cmllZCB0byBsb2FkIHRoaXMgcGx1Z2luLlxuICogICpcXC9cbiAqIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCAncGx1Z2luLWxvYWQnLCB7XG4gKiBcdHBsdWdpbk5hbWU6ICdmb28nLFxuICogXHRtb2R1bGVOYW1lOiAnYmFyJ1xuICogfSApO1xuICogYGBgXG4gKi8gY2xhc3MgQ0tFZGl0b3JFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICAvKipcblx0ICogQSBjb250ZXh0IG9mIHRoZSBlcnJvciBieSB3aGljaCB0aGUgV2F0Y2hkb2cgaXMgYWJsZSB0byBkZXRlcm1pbmUgd2hpY2ggZWRpdG9yIGNyYXNoZWQuXG5cdCAqLyBjb250ZXh0O1xuICAgIC8qKlxuXHQgKiBUaGUgYWRkaXRpb25hbCBlcnJvciBkYXRhIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IuIFVuZGVmaW5lZCBpZiBub25lIHdhcyBwYXNzZWQuXG5cdCAqLyBkYXRhO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBDS0VkaXRvckVycm9yIGNsYXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gZXJyb3JOYW1lIFRoZSBlcnJvciBpZCBpbiBhbiBgZXJyb3ItbmFtZWAgZm9ybWF0LiBBIGxpbmsgdG8gdGhpcyBlcnJvciBkb2N1bWVudGF0aW9uIHBhZ2Ugd2lsbCBiZSBhZGRlZFxuXHQgKiB0byB0aGUgdGhyb3duIGVycm9yJ3MgYG1lc3NhZ2VgLlxuXHQgKiBAcGFyYW0gY29udGV4dCBBIGNvbnRleHQgb2YgdGhlIGVycm9yIGJ5IHdoaWNoIHRoZSB7QGxpbmsgbW9kdWxlOndhdGNoZG9nL3dhdGNoZG9nfldhdGNoZG9nIHdhdGNoZG9nfVxuXHQgKiBpcyBhYmxlIHRvIGRldGVybWluZSB3aGljaCBlZGl0b3IgY3Jhc2hlZC4gSXQgc2hvdWxkIGJlIGFuIGVkaXRvciBpbnN0YW5jZSBvciBhIHByb3BlcnR5IGNvbm5lY3RlZCB0byBpdC4gSXQgY2FuIGJlIGFsc29cblx0ICogYSBgbnVsbGAgdmFsdWUgaWYgdGhlIGVkaXRvciBzaG91bGQgbm90IGJlIHJlc3RhcnRlZCBpbiBjYXNlIG9mIHRoZSBlcnJvciAoZS5nLiBkdXJpbmcgdGhlIGVkaXRvciBpbml0aWFsaXphdGlvbikuXG5cdCAqIFRoZSBlcnJvciBjb250ZXh0IHNob3VsZCBiZSBjaGVja2VkIHVzaW5nIHRoZSBgYXJlQ29ubmVjdGVkVGhyb3VnaFByb3BlcnRpZXMoIGVkaXRvciwgY29udGV4dCApYCB1dGlsaXR5XG5cdCAqIHRvIGNoZWNrIGlmIHRoZSBvYmplY3Qgd29ya3MgYXMgdGhlIGNvbnRleHQuXG5cdCAqIEBwYXJhbSBkYXRhIEFkZGl0aW9uYWwgZGF0YSBkZXNjcmliaW5nIHRoZSBlcnJvci4gQSBzdHJpbmdpZmllZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0XG5cdCAqIHdpbGwgYmUgYXBwZW5kZWQgdG8gdGhlIGVycm9yIG1lc3NhZ2UsIHNvIHRoZSBkYXRhIGFyZSBxdWlja2x5IHZpc2libGUgaW4gdGhlIGNvbnNvbGUuIFRoZSBvcmlnaW5hbFxuXHQgKiBkYXRhIG9iamVjdCB3aWxsIGFsc28gYmUgbGF0ZXIgYXZhaWxhYmxlIHVuZGVyIHRoZSB7QGxpbmsgI2RhdGF9IHByb3BlcnR5LlxuXHQgKi8gY29uc3RydWN0b3IoZXJyb3JOYW1lLCBjb250ZXh0LCBkYXRhKXtcbiAgICAgICAgc3VwZXIoZ2V0RXJyb3JNZXNzYWdlKGVycm9yTmFtZSwgZGF0YSkpO1xuICAgICAgICB0aGlzLm5hbWUgPSAnQ0tFZGl0b3JFcnJvcic7XG4gICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGVycm9yIGlzIG9mIHRoZSBgQ0tFZGl0b3JFcnJvcmAgdHlwZS5cblx0ICovIGlzKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUgPT09ICdDS0VkaXRvckVycm9yJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgdXRpbGl0eSB0aGF0IGVuc3VyZXMgdGhhdCB0aGUgdGhyb3duIGVycm9yIGlzIGEge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3J9IG9uZS5cblx0ICogSXQgaXMgdXNlZnVsIHdoZW4gY29tYmluZWQgd2l0aCB0aGUge0BsaW5rIG1vZHVsZTp3YXRjaGRvZy93YXRjaGRvZ35XYXRjaGRvZ30gZmVhdHVyZSwgd2hpY2ggY2FuIHJlc3RhcnQgdGhlIGVkaXRvciBpbiBjYXNlXG5cdCAqIG9mIGEge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3J9IGVycm9yLlxuXHQgKlxuXHQgKiBAcGFyYW0gZXJyIFRoZSBlcnJvciB0byByZXRocm93LlxuXHQgKiBAcGFyYW0gY29udGV4dCBBbiBvYmplY3QgY29ubmVjdGVkIHRocm91Z2ggcHJvcGVydGllcyB3aXRoIHRoZSBlZGl0b3IgaW5zdGFuY2UuIFRoaXMgY29udGV4dCB3aWxsIGJlIHVzZWRcblx0ICogYnkgdGhlIHdhdGNoZG9nIHRvIHZlcmlmeSB3aGljaCBlZGl0b3Igc2hvdWxkIGJlIHJlc3RhcnRlZC5cblx0ICovIHN0YXRpYyByZXRocm93VW5leHBlY3RlZEVycm9yKGVyciwgY29udGV4dCkge1xuICAgICAgICBpZiAoZXJyLmlzICYmIGVyci5pcygnQ0tFZGl0b3JFcnJvcicpKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG5cdFx0ICogQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCBpbnNpZGUgdGhlIENLRWRpdG9yIDUgY29kZWJhc2UuIFRoaXMgZXJyb3Igd2lsbCBsb29rIGxpa2UgdGhlIG9yaWdpbmFsIG9uZVxuXHRcdCAqIHRvIG1ha2UgdGhlIGRlYnVnZ2luZyBlYXNpZXIuXG5cdFx0ICpcblx0XHQgKiBUaGlzIGVycm9yIGlzIG9ubHkgdXNlZnVsIHdoZW4gdGhlIGVkaXRvciBpcyBpbml0aWFsaXplZCB1c2luZyB0aGUge0BsaW5rIG1vZHVsZTp3YXRjaGRvZy93YXRjaGRvZ35XYXRjaGRvZ30gZmVhdHVyZS5cblx0XHQgKiBJbiBjYXNlIG9mIHN1Y2ggZXJyb3IgKG9yIGFueSB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvcn0gZXJyb3IpIHRoZSB3YXRjaGRvZyBzaG91bGQgcmVzdGFydCB0aGUgZWRpdG9yLlxuXHRcdCAqXG5cdFx0ICogQGVycm9yIHVuZXhwZWN0ZWQtZXJyb3Jcblx0XHQgKi8gY29uc3QgZXJyb3IgPSBuZXcgQ0tFZGl0b3JFcnJvcihlcnIubWVzc2FnZSwgY29udGV4dCk7XG4gICAgICAgIC8vIFJlc3RvcmUgdGhlIG9yaWdpbmFsIHN0YWNrIHRyYWNlIHRvIG1ha2UgdGhlIGVycm9yIGxvb2sgbGlrZSB0aGUgb3JpZ2luYWwgb25lLlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvNTU5NSBmb3IgbW9yZSBkZXRhaWxzLlxuICAgICAgICBlcnJvci5zdGFjayA9IGVyci5zdGFjaztcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxufVxuLyoqXG4gKiBMb2dzIGEgd2FybmluZyB0byB0aGUgY29uc29sZSB3aXRoIGEgcHJvcGVybHkgZm9ybWF0dGVkIG1lc3NhZ2UgYW5kIGFkZHMgYSBsaW5rIHRvIHRoZSBkb2N1bWVudGF0aW9uLlxuICogVXNlIHdoZW5ldmVyIHlvdSB3YW50IHRvIGxvZyBhIHdhcm5pbmcgdG8gdGhlIGNvbnNvbGUuXG4gKlxuICogYGBgdHNcbiAqIC8qKlxuICogICogVGhlcmUgd2FzIGEgcHJvYmxlbSBwcm9jZXNzaW5nIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSB0b29sYmFyLiBUaGUgaXRlbSB3aXRoIHRoZSBnaXZlblxuICogICogbmFtZSBkb2VzIG5vdCBleGlzdCwgc28gaXQgd2FzIG9taXR0ZWQgd2hlbiByZW5kZXJpbmcgdGhlIHRvb2xiYXIuXG4gKiAgKlxuICogICogQGVycm9yIHRvb2xiYXJ2aWV3LWl0ZW0tdW5hdmFpbGFibGVcbiAqICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQuXG4gKiAgKlxcL1xuICogbG9nV2FybmluZyggJ3Rvb2xiYXJ2aWV3LWl0ZW0tdW5hdmFpbGFibGUnLCB7IG5hbWUgfSApO1xuICogYGBgXG4gKlxuICogU2VlIGFsc28ge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3J9IGZvciBhbiBleHBsYW5hdGlvbiB3aGVuIHRvIHRocm93IGFuIGVycm9yIGFuZCB3aGVuIHRvIGxvZ1xuICogYSB3YXJuaW5nIG9yIGFuIGVycm9yIHRvIHRoZSBjb25zb2xlLlxuICpcbiAqIEBwYXJhbSBlcnJvck5hbWUgVGhlIGVycm9yIG5hbWUgdG8gYmUgbG9nZ2VkLlxuICogQHBhcmFtIGRhdGEgQWRkaXRpb25hbCBkYXRhIHRvIGJlIGxvZ2dlZC5cbiAqLyBmdW5jdGlvbiBsb2dXYXJuaW5nKGVycm9yTmFtZSwgZGF0YSkge1xuICAgIGNvbnNvbGUud2FybiguLi5mb3JtYXRDb25zb2xlQXJndW1lbnRzKGVycm9yTmFtZSwgZGF0YSkpO1xufVxuLyoqXG4gKiBMb2dzIGFuIGVycm9yIHRvIHRoZSBjb25zb2xlIHdpdGggYSBwcm9wZXJseSBmb3JtYXR0ZWQgbWVzc2FnZSBhbmQgYWRkcyBhIGxpbmsgdG8gdGhlIGRvY3VtZW50YXRpb24uXG4gKiBVc2Ugd2hlbmV2ZXIgeW91IHdhbnQgdG8gbG9nIGFuIGVycm9yIHRvIHRoZSBjb25zb2xlLlxuICpcbiAqIGBgYHRzXG4gKiAvKipcbiAqICAqIFRoZXJlIHdhcyBhIHByb2JsZW0gcHJvY2Vzc2luZyB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgdG9vbGJhci4gVGhlIGl0ZW0gd2l0aCB0aGUgZ2l2ZW5cbiAqICAqIG5hbWUgZG9lcyBub3QgZXhpc3QsIHNvIGl0IHdhcyBvbWl0dGVkIHdoZW4gcmVuZGVyaW5nIHRoZSB0b29sYmFyLlxuICogICpcbiAqICAqIEBlcnJvciB0b29sYmFydmlldy1pdGVtLXVuYXZhaWxhYmxlXG4gKiAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgY29tcG9uZW50LlxuICogICpcXC9cbiAqICBsb2dFcnJvciggJ3Rvb2xiYXJ2aWV3LWl0ZW0tdW5hdmFpbGFibGUnLCB7IG5hbWUgfSApO1xuICogYGBgXG4gKlxuICogKipOb3RlKio6IEluIG1vc3QgY2FzZXMgbG9nZ2luZyBhIHdhcm5pbmcgdXNpbmcge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfmxvZ1dhcm5pbmd9IGlzIGVub3VnaC5cbiAqXG4gKiBTZWUgYWxzbyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvcn0gZm9yIGFuIGV4cGxhbmF0aW9uIHdoZW4gdG8gdXNlIGVhY2ggbWV0aG9kLlxuICpcbiAqIEBwYXJhbSBlcnJvck5hbWUgVGhlIGVycm9yIG5hbWUgdG8gYmUgbG9nZ2VkLlxuICogQHBhcmFtIGRhdGEgQWRkaXRpb25hbCBkYXRhIHRvIGJlIGxvZ2dlZC5cbiAqLyBmdW5jdGlvbiBsb2dFcnJvcihlcnJvck5hbWUsIGRhdGEpIHtcbiAgICBjb25zb2xlLmVycm9yKC4uLmZvcm1hdENvbnNvbGVBcmd1bWVudHMoZXJyb3JOYW1lLCBkYXRhKSk7XG59XG4vKipcbiAqIFJldHVybnMgZm9ybWF0dGVkIGxpbmsgdG8gZG9jdW1lbnRhdGlvbiBtZXNzYWdlLlxuICovIGZ1bmN0aW9uIGdldExpbmtUb0RvY3VtZW50YXRpb25NZXNzYWdlKGVycm9yTmFtZSkge1xuICAgIHJldHVybiBgXFxuUmVhZCBtb3JlOiAke0RPQ1VNRU5UQVRJT05fVVJMfSNlcnJvci0ke2Vycm9yTmFtZX1gO1xufVxuLyoqXG4gKiBSZXR1cm5zIGZvcm1hdHRlZCBlcnJvciBtZXNzYWdlLlxuICovIGZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShlcnJvck5hbWUsIGRhdGEpIHtcbiAgICBjb25zdCBwcm9jZXNzZWRPYmplY3RzID0gbmV3IFdlYWtTZXQoKTtcbiAgICBjb25zdCBjaXJjdWxhclJlZmVyZW5jZXNSZXBsYWNlciA9IChrZXksIHZhbHVlKT0+e1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHByb2Nlc3NlZE9iamVjdHMuaGFzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBgW29iamVjdCAke3ZhbHVlLmNvbnN0cnVjdG9yLm5hbWV9XWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcm9jZXNzZWRPYmplY3RzLmFkZCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH07XG4gICAgY29uc3Qgc3RyaW5naWZpZWREYXRhID0gZGF0YSA/IGAgJHtKU09OLnN0cmluZ2lmeShkYXRhLCBjaXJjdWxhclJlZmVyZW5jZXNSZXBsYWNlcil9YCA6ICcnO1xuICAgIGNvbnN0IGRvY3VtZW50YXRpb25MaW5rID0gZ2V0TGlua1RvRG9jdW1lbnRhdGlvbk1lc3NhZ2UoZXJyb3JOYW1lKTtcbiAgICByZXR1cm4gZXJyb3JOYW1lICsgc3RyaW5naWZpZWREYXRhICsgZG9jdW1lbnRhdGlvbkxpbms7XG59XG4vKipcbiAqIFJldHVybnMgZm9ybWF0dGVkIGNvbnNvbGUgZXJyb3IgYXJndW1lbnRzLlxuICovIGZ1bmN0aW9uIGZvcm1hdENvbnNvbGVBcmd1bWVudHMoZXJyb3JOYW1lLCBkYXRhKSB7XG4gICAgY29uc3QgZG9jdW1lbnRhdGlvbk1lc3NhZ2UgPSBnZXRMaW5rVG9Eb2N1bWVudGF0aW9uTWVzc2FnZShlcnJvck5hbWUpO1xuICAgIHJldHVybiBkYXRhID8gW1xuICAgICAgICBlcnJvck5hbWUsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGRvY3VtZW50YXRpb25NZXNzYWdlXG4gICAgXSA6IFtcbiAgICAgICAgZXJyb3JOYW1lLFxuICAgICAgICBkb2N1bWVudGF0aW9uTWVzc2FnZVxuICAgIF07XG59XG5cbmNvbnN0IHZlcnNpb24gPSAnNDQuMy4wJztcbi8vIFRoZSBzZWNvbmQgYXJndW1lbnQgaXMgbm90IGEgbW9udGguIEl0IGlzIGBtb250aEluZGV4YCBhbmQgc3RhcnRzIGZyb20gYDBgLlxuY29uc3QgcmVsZWFzZURhdGUgPSBuZXcgRGF0ZSgyMDI1LCAyLCA1KTtcbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyBpZiAoZ2xvYmFsVGhpcy5DS0VESVRPUl9WRVJTSU9OKSB7XG4gICAgLyoqXG5cdCAqIFRoaXMgZXJyb3IgaXMgdGhyb3duIHdoZW4sIGR1ZSB0byBhIG1pc3Rha2UgaW4gdGhlIHdheSBDS0VkaXRvciZuYnNwOzUgd2FzIGluc3RhbGxlZCxcblx0ICogaW1wb3J0ZWQsIG9yIGluaXRpYWxpemVkLCBzb21lIG9mIGl0cyBtb2R1bGVzIHdlcmUgZXZhbHVhdGVkIGFuZCBleGVjdXRlZCB0d2ljZS5cblx0ICogRHVwbGljYXRlIG1vZHVsZXMgaW5ldml0YWJseSBsZWFkIHRvIHJ1bnRpbWUgZXJyb3JzIGFuZCBpbmNyZWFzZWQgYnVuZGxlIHNpemUuXG5cdCAqXG5cdCAqICMgQ2hlY2sgZGVwZW5kZW5jeSB2ZXJzaW9uc1xuXHQgKlxuXHQgKiBGaXJzdCwgbWFrZSBzdXJlIHRoYXQgeW91IHVzZSB0aGUgbGF0ZXN0IHZlcnNpb24gb2YgYWxsIENLRWRpdG9yJm5ic3A7NSBkZXBlbmRlbmNpZXMuXG5cdCAqIERlcGVuZGluZyBvbiB0aGUgaW5zdGFsbGF0aW9uIG1ldGhvZCwgeW91IHNob3VsZCBjaGVjayB0aGUgdmVyc2lvbnMgb2YgdGhlIGBja2VkaXRvcjVgLFxuXHQgKiBgY2tlZGl0b3I1LXByZW1pdW0tZmVhdHVyZXNgLCBvciBgQGNrZWRpdG9yL2NrZWRpdG9yNS08TkFNRT5gIHBhY2thZ2VzLiBJZiB5b3UgY2Fubm90IHVwZGF0ZVxuXHQgKiB0byB0aGUgbGF0ZXN0IHZlcnNpb24sIGVuc3VyZSB0aGF0IGFsbCB0aGUgQ0tFZGl0b3ImbmJzcDs1IHBhY2thZ2VzIGFyZVxuXHQgKiBpbiB0aGUgc2FtZSB2ZXJzaW9uLlxuXHQgKlxuXHQgKiBJZiB5b3UgdXNlIHRoaXJkLXBhcnR5IHBsdWdpbnMsIG1ha2Ugc3VyZSB0byB1cGRhdGUgdGhlbSwgdG9vLiBJZiB0aGV5IGFyZSBpbmNvbXBhdGlibGVcblx0ICogd2l0aCB0aGUgdmVyc2lvbiBvZiBDS0VkaXRvciZuYnNwOzUgeW91IHVzZSwgeW91IG1heSBuZWVkIHRvIGRvd25ncmFkZSB0aGUgQ0tFZGl0b3ImbmJzcDs1IHBhY2thZ2VzXG5cdCAqICh3aGljaCB3ZSBkbyBub3QgcmVjb21tZW5kKS4gQXNrIHRoZSBwbHVnaW4ncyBhdXRob3IgdG8gdXBncmFkZSB0aGUgZGVwZW5kZW5jaWVzLFxuXHQgKiBvciBmb3JrIHRoZWlyIHByb2plY3QgYW5kIHVwZGF0ZSBpdCB5b3Vyc2VsZi5cblx0ICpcblx0ICogIyBDaGVjayBpbXBvcnRzXG5cdCAqXG5cdCAqIFRoZSBuZXh0IHN0ZXAgaXMgdG8gbG9vayBhdCBob3cgeW91IGltcG9ydCBDS0VkaXRvciZuYnNwOzUgaW50byB5b3VyIHByb2plY3QuXG5cdCAqXG5cdCAqICoqVGhlIHtAZ2xpbmsgdXBkYXRpbmcvbmltLW1pZ3JhdGlvbi9taWdyYXRpb24tdG8tbmV3LWluc3RhbGxhdGlvbi1tZXRob2RzIG5ldyBpbnN0YWxsYXRpb24gbWV0aG9kc31cblx0ICogYXJlIGRlc2lnbmVkIHRvIHByZXZlbnQgbW9kdWxlIGR1cGxpY2F0aW9uLCBzbyBpZiB5b3UgYXJlIG5vdCB1c2luZyB0aGVtIHlldCwgeW91IHNob3VsZCBjb25zaWRlclxuXHQgKiB1cGRhdGluZyB5b3VyIHByb2plY3QqKi4gSG93ZXZlciwgc2V2ZXJhbCBsZWdhY3kgaW5zdGFsbGF0aW9uIG1ldGhvZHMgYXJlIHN0aWxsIHN1cHBvcnRlZCBmb3IgYmFja3dhcmRcblx0ICogY29tcGF0aWJpbGl0eSwgYW5kIG1peGluZyB0aGVtIG1heSByZXN1bHQgaW4gbW9kdWxlIGR1cGxpY2F0aW9uLlxuXHQgKlxuXHQgKiBUaGVzZSBhcmUgdGhlIG1vc3QgY29tbW9uIGltcG9ydCBtZXRob2RzIG9mIHRoZSBDS0VkaXRvciZuYnNwOzUgcGFja2FnZXMuXG5cdCAqXG5cdCAqIC0gKipOZXcgaW5zdGFsbGF0aW9uIG1ldGhvZHMgKE5JTSkqKiAmbmRhc2g7IEltcG9ydHMgZnJvbSB0aGUgYGNrZWRpdG9yNWAgYW5kIGBja2VkaXRvcjUtcHJlbWl1bS1mZWF0dXJlc2AgcGFja2FnZXMuXG5cdCAqIC0gKipPcHRpbWl6ZWQgYnVpbGQqKiBmb3IgdGhlIG5ldyBpbnN0YWxsYXRpb24gbWV0aG9kcyAmbmRhc2g7IEltcG9ydHMgZnJvbSB0aGUgYEBja2VkaXRvci9ja2VkaXRvcjUtPE5BTUU+L2Rpc3QvaW5kZXguanNgLlxuXHQgKiAtICoqUHJlZGVmaW5lZCBidWlsZHMqKiAobGVnYWN5KSAmbmRhc2g7IEltcG9ydHMgZnJvbSB0aGUgYEBja2VkaXRvci9ja2VkaXRvcjUtYnVpbGQtPE5BTUU+YCBwYWNrYWdlcy5cblx0ICogLSAqKkRlZmF1bHQgaW1wb3J0cyoqIChsZWdhY3kpICZuZGFzaDsgSW1wb3J0cyBmcm9tIHRoZSBgQGNrZWRpdG9yL2NrZWRpdG9yNS08TkFNRT5gIHBhY2thZ2VzIChkZWZhdWx0IGV4cG9ydCkuXG5cdCAqIC0gKipgc3JjYCoqIChsZWdhY3kpICZuZGFzaDsgSW1wb3J0cyBmcm9tIHRoZSBgQGNrZWRpdG9yL2NrZWRpdG9yNS08TkFNRT4vc3JjLypgLlxuXHQgKiAtICoqRExMIGJ1aWxkcyoqIChsZWdhY3kpICZuZGFzaDsgSW1wb3J0cyBmcm9tIHRoZSBgY2tlZGl0b3I1L2J1aWxkLzxOQU1FPmAgYW5kIGBAY2tlZGl0b3IvY2tlZGl0b3I1LTxOQU1FPi9idWlsZC8qYC5cblx0ICpcblx0ICogVGhlIGJlc3Qgd2F5IHRvIGF2b2lkIGR1cGxpY2F0ZSBtb2R1bGVzIGlzIHRvIGF2b2lkIG1peGluZyB0aGVzZSBpbnN0YWxsYXRpb24gbWV0aG9kcy4gRm9yIGV4YW1wbGUsIGlmIHlvdSB1c2UgaW1wb3J0c1xuXHQgKiBzcGVjaWZpYyB0byB0aGUgb3B0aW1pemVkIGJ1aWxkLCB5b3Ugc2hvdWxkIHVzZSB0aGVtIGZvciBhbGwgQ0tFZGl0b3ImbmJzcDs1IHBhY2thZ2VzLiBJbiBhZGRpdGlvbiwgc2luY2Vcblx0ICogdGhlIFByZWRlZmluZWQgYW5kIERMTCBidWlsZHMgYWxyZWFkeSBpbmNsdWRlIHRoZSBjb3JlIG9mIHRoZSBlZGl0b3IsIHRoZXkgY2Fubm90IGJlIHVzZWQgd2l0aCBvdGhlciB0eXBlcyBvZiBpbXBvcnRzLlxuXHQgKlxuXHQgKiBIZXJlIGlzIGEgbWF0cml4IHNob3dpbmcgd2hpY2ggaW5zdGFsbGF0aW9uIG1ldGhvZHMgYXJlIGNvbXBhdGlibGUgd2l0aCBlYWNoIG90aGVyOlxuXHQgKlxuXHQgKiB8ICAgICAgICAgICAgICAgICAgfCBOSU0gfCBPcHRpbWl6ZWQgYnVpbGQgfCBQcmVkZWZpbmVkIGJ1aWxkcyB8IERlZmF1bHQgaW1wb3J0cyB8IGBzcmNgIHwgRExMIGJ1aWxkcyB8XG5cdCAqIHwtLS0tLS0tLS0tLS0tLS0tLS18LS0tLS18LS0tLS0tLS0tLS0tLS0tLS18LS0tLS0tLS0tLS0tLS0tLS0tLXwtLS0tLS0tLS0tLS0tLS0tLXwtLS0tLS0tfC0tLS0tLS0tLS0tLXxcblx0ICogfCBOSU0gICAgICAgICAgICAgIHwg4pyFICB8IOKchSAgICAgICAgICAgICAgfCDinYwgICAgICAgICAgICAgICAgfCDinYwgICAgICAgICAgICAgIHwg4p2MICAgIHwg4p2MICAgICAgICAgfFxuXHQgKiB8IE9wdGltaXplZCBidWlsZHMgfCDinIUgIHwg4pyFICAgICAgICAgICAgICB8IOKdjCAgICAgICAgICAgICAgICB8IOKdjCAgICAgICAgICAgICAgfCDinYwgICAgfCDinYwgICAgICAgICB8XG5cdCAqIHwgUHJlZGVmaW5lZCBidWlsZCB8IOKdjCAgfCDinYwgICAgICAgICAgICAgIHwg4pyFICAgICAgICAgICAgICAgIHwg4p2MICAgICAgICAgICAgICB8IOKdjCAgICB8IOKdjCAgICAgICAgIHxcblx0ICogfCBEZWZhdWx0IGltcG9ydHMgIHwg4p2MICB8IOKdjCAgICAgICAgICAgICAgfCDinYwgICAgICAgICAgICAgICAgfCDinIUgICAgICAgICAgICAgIHwg4pyFICAgIHwg4p2MICAgICAgICAgfFxuXHQgKiB8IGBzcmNgICAgICAgICAgICAgfCDinYwgIHwg4p2MICAgICAgICAgICAgICB8IOKdjCAgICAgICAgICAgICAgICB8IOKchSAgICAgICAgICAgICAgfCDinIUgICAgfCDinYwgICAgICAgICB8XG5cdCAqIHwgRExMIGJ1aWxkcyAgICAgICB8IOKdjCAgfCDinYwgICAgICAgICAgICAgIHwg4p2MICAgICAgICAgICAgICAgIHwg4p2MICAgICAgICAgICAgICB8IOKdjCAgICB8IOKchSAgICAgICAgIHxcblx0ICpcblx0ICogSWYgeW91IHVzZSBhbnkgdGhpcmQtcGFydHkgcGx1Z2lucywgbWFrZSBzdXJlIHRoZSB3YXkgeW91IGltcG9ydCB0aGVtIGlzIGNvbXBhdGlibGUgd2l0aFxuXHQgKiB0aGUgd2F5IHlvdSBpbXBvcnQgQ0tFZGl0b3ImbmJzcDs1LlxuXHQgKlxuXHQgKiA8ZGV0YWlscz5cblx0ICogPHN1bW1hcnk+TmV3IGluc3RhbGxhdGlvbiBtZXRob2RzIGFuZCBvcHRpbWl6ZWQgYnVpbGRzPC9zdW1tYXJ5PlxuXHQgKlxuXHQgKiBJZiB5b3UgdXNlIHRoZSB7QGdsaW5rIHVwZGF0aW5nL25pbS1taWdyYXRpb24vbWlncmF0aW9uLXRvLW5ldy1pbnN0YWxsYXRpb24tbWV0aG9kcyBuZXcgaW5zdGFsbGF0aW9uIG1ldGhvZHN9LFxuXHQgKiB5b3Ugc2hvdWxkIG9ubHkgaW1wb3J0IGNvZGUgZnJvbSB0aGUgYGNrZWRpdG9yNWAgYW5kIGBja2VkaXRvcjUtcHJlbWl1bS1mZWF0dXJlc2AgcGFja2FnZXMuXG5cdCAqIERvIG5vdCBpbXBvcnQgY29kZSBmcm9tIHRoZSBgQGNrZWRpdG9yL2NrZWRpdG9yNS08TkFNRT5gIHBhY2thZ2VzIHVubGVzcyB5b3UgZm9sbG93XG5cdCAqIHRoZSB7QGdsaW5rIGdldHRpbmctc3RhcnRlZC9zZXR1cC9vcHRpbWl6aW5nLWJ1aWxkLXNpemUgT3B0aW1pemluZyBidWlsZCBzaXplfSBndWlkZSBhbmQgdGhlIGltcG9ydHMgZnJvbVxuXHQgKiB0aGUgYEBja2VkaXRvci9ja2VkaXRvcjUtPE5BTUU+YCBwYWNrYWdlcyBlbmQgd2l0aCBgL2Rpc3QvaW5kZXguanNgLlxuXHQgKlxuXHQgKiBJZiB5b3UgdXNlIGEgQ0ROLCBlbnN1cmUgdGhhdCBzb21lIGZpbGVzIGFyZSBub3QgaW5jbHVkZWQgdHdpY2UgaW4geW91ciBwcm9qZWN0LlxuXHQgKlxuXHQgKiBFeGFtcGxlcyBvZiB2YWxpZCBhbmQgaW52YWxpZCBpbXBvcnQgcGF0aHM6XG5cdCAqXG5cdCAqIGBgYGpzXG5cdCAqIGltcG9ydCB7IENsYXNzaWNFZGl0b3IsIEhpZ2hsaWdodCB9IGZyb20gJ2NrZWRpdG9yNSc7IC8vIOKchVxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodC9kaXN0L2luZGV4LmpzJzsgLy8g4pyFXG5cdCAqIGltcG9ydCBIaWdobGlnaHQgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1oaWdobGlnaHQvc3JjL2hpZ2hsaWdodC5qcyc7IC8vIOKdjFxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodCc7IC8vIOKdjFxuXHQgKiBpbXBvcnQgJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0L2J1aWxkL2hpZ2hsaWdodC5qcyc7IC8vIOKdjFxuXHQgKiBgYGBcblx0ICogPC9kZXRhaWxzPlxuXHQgKlxuXHQgKiA8ZGV0YWlscz5cblx0ICogPHN1bW1hcnk+KExlZ2FjeSkgUHJlZGVmaW5lZCBidWlsZHM8L3N1bW1hcnk+XG5cdCAqXG5cdCAqIElmIHlvdSB1c2UgdGhlIHtAZ2xpbmsgZ2V0dGluZy1zdGFydGVkL2xlZ2FjeS9pbnN0YWxsYXRpb24tbWV0aG9kcy9wcmVkZWZpbmVkLWJ1aWxkcyBQcmVkZWZpbmVkIGJ1aWxkc30sXG5cdCAqIHlvdSBjYW5ub3QgaW1wb3J0IGFueSBhZGRpdGlvbmFsIHBsdWdpbnMuIFRoZXNlIGJ1aWxkcyBhbHJlYWR5IGluY2x1ZGUgdGhlIGVkaXRvcidzIGNvcmVcblx0ICogYW5kIHNlbGVjdGVkIHBsdWdpbnMgYW5kIGltcG9ydGluZyBhZGRpdGlvbmFsIG9uZXMgd2lsbCBjYXVzZSBzb21lIG1vZHVsZXMgdG8gYmUgYnVuZGxlZCBhbmQgbG9hZGVkIHR3aWNlLlxuXHQgKlxuXHQgKiBFeGFtcGxlcyBvZiB2YWxpZCBhbmQgaW52YWxpZCBpbXBvcnQgcGF0aHM6XG5cdCAqXG5cdCAqIGBgYGpzXG5cdCAqIGltcG9ydCBDbGFzc2ljRWRpdG9yIGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtYnVpbGQtY2xhc3NpYyc7IC8vIOKchVxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdja2VkaXRvcjUnOyAvLyDinYxcblx0ICogaW1wb3J0IHsgSGlnaGxpZ2h0IH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1oaWdobGlnaHQvZGlzdC9pbmRleC5qcyc7IC8vIOKdjFxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodCc7IC8vIOKdjFxuXHQgKiBpbXBvcnQgSGlnaGxpZ2h0IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0L3NyYy9oaWdobGlnaHQnOyAvLyDinYxcblx0ICogaW1wb3J0ICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodC9idWlsZC9oaWdobGlnaHQnOyAvLyDinYxcblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIHlvdSBhcmUgbWlzc2luZyBzb21lIGZlYXR1cmVzIGZyb20gdGhlXG5cdCAqIHtAZ2xpbmsgZ2V0dGluZy1zdGFydGVkL2xlZ2FjeS9pbnN0YWxsYXRpb24tbWV0aG9kcy9wcmVkZWZpbmVkLWJ1aWxkcyNwbHVnaW5zLWluY2x1ZGVkLWluLXRoZS1wcmVkZWZpbmVkLWJ1aWxkcyBsaXN0IG9mIHBsdWdpbnN9LFxuXHQgKiB5b3Ugc2hvdWxkIHN3aXRjaCB0byB0aGUge0BnbGluayB1cGRhdGluZy9uaW0tbWlncmF0aW9uL21pZ3JhdGlvbi10by1uZXctaW5zdGFsbGF0aW9uLW1ldGhvZHMgbmV3IGluc3RhbGxhdGlvbiBtZXRob2RzfVxuXHQgKiB3aGljaCBkbyBub3QgaGF2ZSB0aGlzIGxpbWl0YXRpb24uXG5cdCAqIElmIHlvdSBjYW5ub3QgbWlncmF0ZSB0byB0aGUgbmV3IGluc3RhbGxhdGlvbiBtZXRob2RzLCB0cnkgdGhlXG5cdCAqIHtAZ2xpbmsgZ2V0dGluZy1zdGFydGVkL2xlZ2FjeS9pbnN0YWxsYXRpb24tbWV0aG9kcy9wcmVkZWZpbmVkLWJ1aWxkcyNzdXBlcmJ1aWxkIHN1cGVyYnVpbGR9IGluc3RlYWQuXG5cdCAqIFRoaXMgYnVpbGQgY29udGFpbnMgYWxsIHRoZSBlZGl0b3IgZmVhdHVyZXMuXG5cdCAqIDwvZGV0YWlscz5cblx0ICpcblx0ICogPGRldGFpbHM+XG5cdCAqIDxzdW1tYXJ5PihMZWdhY3kpIERlZmF1bHQgaW1wb3J0cyBhbmQgYHNyY2AgaW1wb3J0czwvc3VtbWFyeT5cblx0ICpcblx0ICogSWYgeW91IHVzZSB0aGUge0BnbGluayBnZXR0aW5nLXN0YXJ0ZWQvbGVnYWN5L2luc3RhbGxhdGlvbi1tZXRob2RzL3F1aWNrLXN0YXJ0LW90aGVyIGxlZ2FjeSBjdXN0b21pemVkIGluc3RhbGxhdGlvbn1cblx0ICogbWV0aG9kLCB5b3Ugc2hvdWxkIG9ubHkgaW1wb3J0IGNvZGUgZnJvbSB0aGUgYEBja2VkaXRvci9ja2VkaXRvcjUtPE5BTUU+YCBwYWNrYWdlcy4gV2hpbGUgeW91IGNhbiBpbXBvcnQgY29kZSBmcm9tXG5cdCAqIHRoZSBgQGNrZWRpdG9yL2NrZWRpdG9yNS08TkFNRT4vc3JjLypgIGZpbGVzLCBpdCBpcyBub3QgcmVjb21tZW5kZWQgYXMgaXQgY2FuIG1ha2UgbWlncmF0aW9uIHRvIHRoZSBuZXcgaW5zdGFsbGF0aW9uXG5cdCAqIG1ldGhvZHMgbW9yZSBkaWZmaWN1bHQuXG5cdCAqXG5cdCAqIElmIHlvdSB1c2UgdGhpcyBpbnN0YWxsYXRpb24gbWV0aG9kLCB5b3Ugc2hvdWxkIG5vdCBpbXBvcnQgY29kZSBmcm9tIHRoZSBgY2tlZGl0b3I1YCwgYGNrZWRpdG9yNS1wcmVtaXVtLWZlYXR1cmVzYCxcblx0ICogb3IgYEBja2VkaXRvci9ja2VkaXRvcjUtYnVpbGQtPE5BTUU+YCBwYWNrYWdlcy5cblx0ICpcblx0ICogRXhhbXBsZXMgb2YgdmFsaWQgYW5kIGludmFsaWQgaW1wb3J0IHBhdGhzOlxuXHQgKlxuXHQgKiBgYGBqc1xuXHQgKiBpbXBvcnQgeyBDbGFzc2ljRWRpdG9yIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lZGl0b3ItY2xhc3NpYyc7IC8vIOKchVxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodCc7IC8vIOKchVxuXHQgKiBpbXBvcnQgSGlnaGxpZ2h0IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0L3NyYy9oaWdobGlnaHQuanMnOyAvLyDinIUgKG5vdCByZWNvbW1lbmRlZClcblx0ICogaW1wb3J0IHsgSGlnaGxpZ2h0IH0gZnJvbSAnY2tlZGl0b3I1JzsgLy8g4p2MXG5cdCAqIGltcG9ydCB7IEhpZ2hsaWdodCB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0L2Rpc3QvaW5kZXguanMnOyAvLyDinYxcblx0ICogaW1wb3J0ICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodC9idWlsZC9oaWdobGlnaHQnOyAvLyDinYxcblx0ICogYGBgXG5cdCAqIDwvZGV0YWlscz5cblx0ICpcblx0ICogPGRldGFpbHM+XG5cdCAqIDxzdW1tYXJ5PihMZWdhY3kpIERMTCBidWlsZHM8L3N1bW1hcnk+XG5cdCAqXG5cdCAqIElmIHlvdSBhcmUgdXNpbmcgdGhlIHtAZ2xpbmsgZ2V0dGluZy1zdGFydGVkL2xlZ2FjeS9hZHZhbmNlZC9hbHRlcm5hdGl2ZS1zZXR1cHMvZGxsLWJ1aWxkcyBsZWdhY3kgRExMIGJ1aWxkc30sXG5cdCAqIHlvdSBzaG91bGQgbm90IGltcG9ydCBhbnkgbm9uLURMTCBtb2R1bGVzLlxuXHQgKlxuXHQgKiBFeGFtcGxlcyBvZiB2YWxpZCBhbmQgaW52YWxpZCBpbXBvcnQgcGF0aHM6XG5cdCAqXG5cdCAqIGBgYGpzXG5cdCAqIGltcG9ydCAnY2tlZGl0b3I1L2J1aWxkL2NrZWRpdG9yNS1kbGwuanMnOy8vIOKchVxuXHQgKiBpbXBvcnQgJ0Bja2VkaXRvci9ja2VkaXRvcjUtZWRpdG9yLWNsYXNzaWMvYnVpbGQvZWRpdG9yLWNsYXNzaWMuanMnOy8vIOKchVxuXHQgKiBpbXBvcnQgJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0L2J1aWxkL2hpZ2hsaWdodC5qcyc7Ly8g4pyFXG5cdCAqIGltcG9ydCB7IEhpZ2hsaWdodCB9IGZyb20gJ2NrZWRpdG9yNSc7IC8vIOKdjFxuXHQgKiBpbXBvcnQgeyBIaWdobGlnaHQgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWhpZ2hsaWdodC9kaXN0L2luZGV4LmpzJzsgLy8g4p2MXG5cdCAqIGltcG9ydCB7IEhpZ2hsaWdodCB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtaGlnaGxpZ2h0JzsgLy8g4p2MXG5cdCAqIGltcG9ydCBIaWdobGlnaHQgZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1oaWdobGlnaHQvc3JjL2hpZ2hsaWdodC5qcyc7IC8vIOKdjFxuXHQgKiBgYGBcblx0ICogPC9kZXRhaWxzPlxuXHQgKlxuXHQgKiAjIFJlaW5zdGFsbCBgbm9kZV9tb2R1bGVzYFxuXHQgKlxuXHQgKiBVc3VhbGx5LCBucG0gYW5kIG90aGVyIHBhY2thZ2UgbWFuYWdlcnMgZGVkdXBsaWNhdGUgYWxsIHBhY2thZ2VzIC0gZm9yIGV4YW1wbGUsIGBja2VkaXRvcjVgIGlzIG9ubHkgaW5zdGFsbGVkIG9uY2Vcblx0ICogaW4gYG5vZGVfbW9kdWxlcy9gLiBIb3dldmVyLCBpdCBpcyBrbm93biB0byBmYWlsIHRvIGRvIHNvIG9jY2FzaW9uYWxseS5cblx0ICpcblx0ICogVG8gcnVsZSBvdXQgdGhpcyBwb3NzaWJpbGl0eSwgeW91IGNhbiB0cnkgdGhlIGZvbGxvd2luZzpcblx0ICpcblx0ICogMS4gUmVtb3ZlIHRoZSBgbm9kZV9tb2R1bGVzYCBkaXJlY3RvcnkuXG5cdCAqIDIuIFJlbW92ZSB0aGUgYHBhY2thZ2UtbG9jay5qc29uYCwgYHlhcm4ubG9ja2AsIG9yIGBwbnBtLWxvY2sueWFtbGAgZmlsZXMgKGRlcGVuZGluZyBvbiB0aGUgcGFja2FnZSBtYW5hZ2VyIHVzZWQpLlxuXHQgKiAzLiBSdW4gYG5wbSBpbnN0YWxsYCB0byByZWluc3RhbGwgYWxsIHBhY2thZ2VzLlxuXHQgKiA0LiBSdW4gYG5wbSBsc2AgdG8gY2hlY2sgaG93IG1hbnkgdGltZXMgcGFja2FnZXMgbGlrZSBgQGNrZWRpdG9yL2NrZWRpdG9yNS1jb3JlYCBhcmUgaW5zdGFsbGVkLlxuXHQgKiBJZiB0aGV5IGFyZSBpbnN0YWxsZWQgbW9yZSB0aGFuIG9uY2UsIHZlcmlmeSB3aGljaCBwYWNrYWdlIGNhdXNlcyB0aGF0LlxuXHQgKlxuXHQgKiBAZXJyb3IgY2tlZGl0b3ItZHVwbGljYXRlZC1tb2R1bGVzXG5cdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY2tlZGl0b3ItZHVwbGljYXRlZC1tb2R1bGVzJywgbnVsbCk7XG59IGVsc2Uge1xuICAgIGdsb2JhbFRoaXMuQ0tFRElUT1JfVkVSU0lPTiA9IHZlcnNpb247XG59XG5cbmNvbnN0IF9saXN0ZW5pbmdUbyA9IFN5bWJvbCgnbGlzdGVuaW5nVG8nKTtcbmNvbnN0IF9lbWl0dGVySWQgPSBTeW1ib2woJ2VtaXR0ZXJJZCcpO1xuY29uc3QgX2RlbGVnYXRpb25zID0gU3ltYm9sKCdkZWxlZ2F0aW9ucycpO1xuY29uc3QgZGVmYXVsdEVtaXR0ZXJDbGFzcyQxID0gLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbihPYmplY3QpO1xuZnVuY3Rpb24gRW1pdHRlck1peGluKGJhc2UpIHtcbiAgICBpZiAoIWJhc2UpIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRFbWl0dGVyQ2xhc3MkMTtcbiAgICB9XG4gICAgY2xhc3MgTWl4aW4gZXh0ZW5kcyBiYXNlIHtcbiAgICAgICAgb24oZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMsIGV2ZW50LCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgb25jZShldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGxldCB3YXNGaXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3Qgb25jZUNhbGxiYWNrID0gKGV2ZW50LCAuLi5hcmdzKT0+e1xuICAgICAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkIG9ubHkgb25jZSBldmVuIGlmIHRoZSBjYWxsYmFjayBpdHNlbGYgbGVhZHMgdG8gcmUtZmlyaW5nIHRoZSBldmVudFxuICAgICAgICAgICAgICAgIC8vICh3aGljaCB3b3VsZCBjYWxsIHRoZSBjYWxsYmFjayBhZ2FpbikuXG4gICAgICAgICAgICAgICAgaWYgKCF3YXNGaXJlZCkge1xuICAgICAgICAgICAgICAgICAgICB3YXNGaXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdvIG9mZigpIGF0IHRoZSBmaXJzdCBjYWxsLlxuICAgICAgICAgICAgICAgICAgICBldmVudC5vZmYoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gR28gd2l0aCB0aGUgb3JpZ2luYWwgY2FsbGJhY2suXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgZXZlbnQsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBNYWtlIGEgc2ltaWxhciBvbigpIGNhbGwsIHNpbXBseSByZXBsYWNpbmcgdGhlIGNhbGxiYWNrLlxuICAgICAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLCBldmVudCwgb25jZUNhbGxiYWNrLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBvZmYoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodGhpcywgZXZlbnQsIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICBsaXN0ZW5UbyhlbWl0dGVyLCBldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICAgICAgbGV0IGVtaXR0ZXJJbmZvLCBldmVudENhbGxiYWNrcztcbiAgICAgICAgICAgIC8vIF9saXN0ZW5pbmdUbyBjb250YWlucyBhIGxpc3Qgb2YgZW1pdHRlcnMgdGhhdCB0aGlzIG9iamVjdCBpcyBsaXN0ZW5pbmcgdG8uXG4gICAgICAgICAgICAvLyBUaGlzIGxpc3QgaGFzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIF9saXN0ZW5pbmdUbzoge1xuICAgICAgICAgICAgLy8gICAgIGVtaXR0ZXJJZDoge1xuICAgICAgICAgICAgLy8gICAgICAgICBlbWl0dGVyOiBlbWl0dGVyLFxuICAgICAgICAgICAgLy8gICAgICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGV2ZW50MTogWyBjYWxsYmFjazEsIGNhbGxiYWNrMiwgLi4uIF1cbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIC4uLi5cbiAgICAgICAgICAgIC8vICAgICAgICAgfVxuICAgICAgICAgICAgLy8gICAgIH0sXG4gICAgICAgICAgICAvLyAgICAgLi4uXG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICBpZiAoIXRoaXNbX2xpc3RlbmluZ1RvXSkge1xuICAgICAgICAgICAgICAgIHRoaXNbX2xpc3RlbmluZ1RvXSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZW1pdHRlcnMgPSB0aGlzW19saXN0ZW5pbmdUb107XG4gICAgICAgICAgICBpZiAoIV9nZXRFbWl0dGVySWQoZW1pdHRlcikpIHtcbiAgICAgICAgICAgICAgICBfc2V0RW1pdHRlcklkKGVtaXR0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZW1pdHRlcklkID0gX2dldEVtaXR0ZXJJZChlbWl0dGVyKTtcbiAgICAgICAgICAgIGlmICghKGVtaXR0ZXJJbmZvID0gZW1pdHRlcnNbZW1pdHRlcklkXSkpIHtcbiAgICAgICAgICAgICAgICBlbWl0dGVySW5mbyA9IGVtaXR0ZXJzW2VtaXR0ZXJJZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczoge31cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCEoZXZlbnRDYWxsYmFja3MgPSBlbWl0dGVySW5mby5jYWxsYmFja3NbZXZlbnRdKSkge1xuICAgICAgICAgICAgICAgIGV2ZW50Q2FsbGJhY2tzID0gZW1pdHRlckluZm8uY2FsbGJhY2tzW2V2ZW50XSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZlbnRDYWxsYmFja3MucHVzaChjYWxsYmFjayk7XG4gICAgICAgICAgICAvLyBGaW5hbGx5IHJlZ2lzdGVyIHRoZSBjYWxsYmFjayB0byB0aGUgZXZlbnQuXG4gICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKHRoaXMsIGVtaXR0ZXIsIGV2ZW50LCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgc3RvcExpc3RlbmluZyhlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNvbnN0IGVtaXR0ZXJzID0gdGhpc1tfbGlzdGVuaW5nVG9dO1xuICAgICAgICAgICAgbGV0IGVtaXR0ZXJJZCA9IGVtaXR0ZXIgJiYgX2dldEVtaXR0ZXJJZChlbWl0dGVyKTtcbiAgICAgICAgICAgIGNvbnN0IGVtaXR0ZXJJbmZvID0gZW1pdHRlcnMgJiYgZW1pdHRlcklkID8gZW1pdHRlcnNbZW1pdHRlcklkXSA6IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50Q2FsbGJhY2tzID0gZW1pdHRlckluZm8gJiYgZXZlbnQgPyBlbWl0dGVySW5mby5jYWxsYmFja3NbZXZlbnRdIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgLy8gU3RvcCBpZiBub3RoaW5nIGhhcyBiZWVuIGxpc3RlbmVkLlxuICAgICAgICAgICAgaWYgKCFlbWl0dGVycyB8fCBlbWl0dGVyICYmICFlbWl0dGVySW5mbyB8fCBldmVudCAmJiAhZXZlbnRDYWxsYmFja3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBbGwgcGFyYW1zIHByb3ZpZGVkLiBvZmYoKSB0aGF0IHNpbmdsZSBjYWxsYmFjay5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcywgZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAvLyBXZSBtdXN0IHJlbW92ZSBjYWxsYmFja3MgYXMgd2VsbCBpbiBvcmRlciB0byBwcmV2ZW50IG1lbW9yeSBsZWFrcy5cbiAgICAgICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9wdWxsLzg0ODBcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGV2ZW50Q2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Q2FsbGJhY2tzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGVtaXR0ZXJJbmZvLmNhbGxiYWNrc1tldmVudF07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKHRoaXMsIGVtaXR0ZXIsIGV2ZW50LCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50Q2FsbGJhY2tzKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUoY2FsbGJhY2sgPSBldmVudENhbGxiYWNrcy5wb3AoKSl7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcywgZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVsZXRlIGVtaXR0ZXJJbmZvLmNhbGxiYWNrc1tldmVudF07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVtaXR0ZXJJbmZvKSB7XG4gICAgICAgICAgICAgICAgZm9yKGV2ZW50IGluIGVtaXR0ZXJJbmZvLmNhbGxiYWNrcyl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcExpc3RlbmluZyhlbWl0dGVyLCBldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlbGV0ZSBlbWl0dGVyc1tlbWl0dGVySWRdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IoZW1pdHRlcklkIGluIGVtaXR0ZXJzKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKGVtaXR0ZXJzW2VtaXR0ZXJJZF0uZW1pdHRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzW19saXN0ZW5pbmdUb107XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmlyZShldmVudE9ySW5mbywgLi4uYXJncykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudEluZm8gPSBldmVudE9ySW5mbyBpbnN0YW5jZW9mIEV2ZW50SW5mbyA/IGV2ZW50T3JJbmZvIDogbmV3IEV2ZW50SW5mbyh0aGlzLCBldmVudE9ySW5mbyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBldmVudEluZm8ubmFtZTtcbiAgICAgICAgICAgICAgICBsZXQgY2FsbGJhY2tzID0gZ2V0Q2FsbGJhY2tzRm9yRXZlbnQodGhpcywgZXZlbnQpO1xuICAgICAgICAgICAgICAgIC8vIFJlY29yZCB0aGF0IHRoZSBldmVudCBwYXNzZWQgdGhpcyBlbWl0dGVyIG9uIGl0cyBwYXRoLlxuICAgICAgICAgICAgICAgIGV2ZW50SW5mby5wYXRoLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGV2ZW50IGxpc3RlbmVyIGNhbGxiYWNrcyBmaXJzdC5cbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvcHlpbmcgY2FsbGJhY2tzIGFycmF5IGlzIHRoZSBlYXNpZXN0IGFuZCBtb3N0IHNlY3VyZSB3YXkgb2YgcHJldmVudGluZyBpbmZpbml0ZSBsb29wcywgd2hlbiBldmVudCBjYWxsYmFja3NcbiAgICAgICAgICAgICAgICAgICAgLy8gYXJlIGFkZGVkIHdoaWxlIHByb2Nlc3Npbmcgb3RoZXIgY2FsbGJhY2tzLiBQcmV2aW91cyBzb2x1dGlvbiBpbnZvbHZlZCBhZGRpbmcgY291bnRlcnMgKHVuaXF1ZSBpZHMpIGJ1dFxuICAgICAgICAgICAgICAgICAgICAvLyBmYWlsZWQgaWYgY2FsbGJhY2tzIHdlcmUgYWRkZWQgdG8gdGhlIHF1ZXVlIGJlZm9yZSBjdXJyZW50bHkgcHJvY2Vzc2VkIGNhbGxiYWNrLlxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIHByb3ZlcyB0byBiZSB0b28gaW5lZmZpY2llbnQsIGFub3RoZXIgbWV0aG9kIGlzIHRvIGNoYW5nZSBgLm9uKClgIHNvIGNhbGxiYWNrcyBhcmUgc3RvcmVkIGlmIHNhbWVcbiAgICAgICAgICAgICAgICAgICAgLy8gZXZlbnQgaXMgY3VycmVudGx5IHByb2Nlc3NlZC4gVGhlbiwgYC5maXJlKClgIGF0IHRoZSBlbmQsIHdvdWxkIGhhdmUgdG8gYWRkIGFsbCBzdG9yZWQgZXZlbnRzLlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MgPSBjYWxsYmFja3Muc2xpY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmbiA9IGNhbGxiYWNrc1tpXS5jYWxsYmFjaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGZuLmNhbGwodGhpcywgZXZlbnRJbmZvLCAuLi5hcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY2FsbGJhY2sgZnJvbSBmdXR1cmUgcmVxdWVzdHMgaWYgb2ZmKCkgaGFzIGJlZW4gY2FsbGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50SW5mby5vZmYuY2FsbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjYWxsZWQgbWFyayBmb3IgdGhlIG5leHQgY2FsbHMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGV2ZW50SW5mby5vZmYuY2FsbGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGZuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCBleGVjdXRlIG5leHQgY2FsbGJhY2tzIGlmIHN0b3AoKSB3YXMgY2FsbGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50SW5mby5zdG9wLmNhbGxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIERlbGVnYXRlIGV2ZW50IHRvIG90aGVyIGVtaXR0ZXJzIGlmIG5lZWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBkZWxlZ2F0aW9ucyA9IHRoaXNbX2RlbGVnYXRpb25zXTtcbiAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25zID0gZGVsZWdhdGlvbnMuZ2V0KGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFzc0FsbERlc3RpbmF0aW9ucyA9IGRlbGVnYXRpb25zLmdldCgnKicpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGVzdGluYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJlRGVsZWdhdGVkRXZlbnRzKGRlc3RpbmF0aW9ucywgZXZlbnRJbmZvLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocGFzc0FsbERlc3RpbmF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlyZURlbGVnYXRlZEV2ZW50cyhwYXNzQWxsRGVzdGluYXRpb25zLCBldmVudEluZm8sIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBldmVudEluZm8ucmV0dXJuO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAtLSBAcHJlc2VydmUgKi8gQ0tFZGl0b3JFcnJvci5yZXRocm93VW5leHBlY3RlZEVycm9yKGVyciwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGVsZWdhdGUoLi4uZXZlbnRzKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRvOiAoZW1pdHRlciwgbmFtZU9yRnVuY3Rpb24pPT57XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpc1tfZGVsZWdhdGlvbnNdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW19kZWxlZ2F0aW9uc10gPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gT3JpZ2luYWxseSB0aGVyZSB3YXMgYSBmb3IuLm9mIGxvb3Agd2hpY2ggdW5mb3J0dW5hdGVseSBjYXVzZWQgYW4gZXJyb3IgaW4gQmFiZWwgdGhhdCBkaWRuJ3QgYWxsb3dcbiAgICAgICAgICAgICAgICAgICAgLy8gYnVpbGQgYW4gYXBwbGljYXRpb24uIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1yZWFjdC9pc3N1ZXMvNDAuXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50cy5mb3JFYWNoKChldmVudE5hbWUpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbnMgPSB0aGlzW19kZWxlZ2F0aW9uc10uZ2V0KGV2ZW50TmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRlc3RpbmF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbX2RlbGVnYXRpb25zXS5zZXQoZXZlbnROYW1lLCBuZXcgTWFwKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVPckZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9ucy5zZXQoZW1pdHRlciwgbmFtZU9yRnVuY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHN0b3BEZWxlZ2F0aW5nKGV2ZW50LCBlbWl0dGVyKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXNbX2RlbGVnYXRpb25zXSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZXZlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzW19kZWxlZ2F0aW9uc10uY2xlYXIoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWVtaXR0ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzW19kZWxlZ2F0aW9uc10uZGVsZXRlKGV2ZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25zID0gdGhpc1tfZGVsZWdhdGlvbnNdLmdldChldmVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGRlc3RpbmF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbnMuZGVsZXRlKGVtaXR0ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBfYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGNyZWF0ZUV2ZW50TmFtZXNwYWNlKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RzID0gZ2V0Q2FsbGJhY2tzTGlzdHNGb3JOYW1lc3BhY2UodGhpcywgZXZlbnQpO1xuICAgICAgICAgICAgY29uc3QgcHJpb3JpdHkgPSBwcmlvcml0aWVzLmdldChvcHRpb25zLnByaW9yaXR5KTtcbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrRGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgICAgICAgICBwcmlvcml0eVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgY2FsbGJhY2sgdG8gYWxsIGNhbGxiYWNrcyBsaXN0LlxuICAgICAgICAgICAgZm9yIChjb25zdCBjYWxsYmFja3Mgb2YgbGlzdHMpe1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgY2FsbGJhY2sgdG8gdGhlIGxpc3QgaW4gdGhlIHJpZ2h0IHByaW9yaXR5IHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgIGluc2VydFRvUHJpb3JpdHlBcnJheShjYWxsYmFja3MsIGNhbGxiYWNrRGVmaW5pdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjb25zdCBsaXN0cyA9IGdldENhbGxiYWNrc0xpc3RzRm9yTmFtZXNwYWNlKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2tzIG9mIGxpc3RzKXtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrc1tpXS5jYWxsYmFjayA9PSBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0IChmaXhpbmcgdGhlIG5leHQgaW5kZXgpLlxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gTWl4aW47XG59XG4vLyBCYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggYG1peGBcbltcbiAgICAnb24nLFxuICAgICdvbmNlJyxcbiAgICAnb2ZmJyxcbiAgICAnbGlzdGVuVG8nLFxuICAgICdzdG9wTGlzdGVuaW5nJyxcbiAgICAnZmlyZScsXG4gICAgJ2RlbGVnYXRlJyxcbiAgICAnc3RvcERlbGVnYXRpbmcnLFxuICAgICdfYWRkRXZlbnRMaXN0ZW5lcicsXG4gICAgJ19yZW1vdmVFdmVudExpc3RlbmVyJ1xuXS5mb3JFYWNoKChrZXkpPT57XG4gICAgRW1pdHRlck1peGluW2tleV0gPSBkZWZhdWx0RW1pdHRlckNsYXNzJDEucHJvdG90eXBlW2tleV07XG59KTtcbi8qKlxuICogQ2hlY2tzIGlmIGBsaXN0ZW5pbmdFbWl0dGVyYCBsaXN0ZW5zIHRvIGFuIGVtaXR0ZXIgd2l0aCBnaXZlbiBgbGlzdGVuZWRUb0VtaXR0ZXJJZGAgYW5kIGlmIHNvLCByZXR1cm5zIHRoYXQgZW1pdHRlci5cbiAqIElmIG5vdCwgcmV0dXJucyBgbnVsbGAuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGlzdGVuaW5nRW1pdHRlciBBbiBlbWl0dGVyIHRoYXQgbGlzdGVucy5cbiAqIEBwYXJhbSBsaXN0ZW5lZFRvRW1pdHRlcklkIFVuaXF1ZSBlbWl0dGVyIGlkIG9mIGVtaXR0ZXIgbGlzdGVuZWQgdG8uXG4gKi8gZnVuY3Rpb24gX2dldEVtaXR0ZXJMaXN0ZW5lZFRvKGxpc3RlbmluZ0VtaXR0ZXIsIGxpc3RlbmVkVG9FbWl0dGVySWQpIHtcbiAgICBjb25zdCBsaXN0ZW5pbmdUbyA9IGxpc3RlbmluZ0VtaXR0ZXJbX2xpc3RlbmluZ1RvXTtcbiAgICBpZiAobGlzdGVuaW5nVG8gJiYgbGlzdGVuaW5nVG9bbGlzdGVuZWRUb0VtaXR0ZXJJZF0pIHtcbiAgICAgICAgcmV0dXJuIGxpc3RlbmluZ1RvW2xpc3RlbmVkVG9FbWl0dGVySWRdLmVtaXR0ZXI7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBTZXRzIGVtaXR0ZXIncyB1bmlxdWUgaWQuXG4gKlxuICogKipOb3RlOioqIGBfZW1pdHRlcklkYCBjYW4gYmUgc2V0IG9ubHkgb25jZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBlbWl0dGVyIEFuIGVtaXR0ZXIgZm9yIHdoaWNoIGlkIHdpbGwgYmUgc2V0LlxuICogQHBhcmFtIGlkIFVuaXF1ZSBpZCB0byBzZXQuIElmIG5vdCBwYXNzZWQsIHJhbmRvbSB1bmlxdWUgaWQgd2lsbCBiZSBzZXQuXG4gKi8gZnVuY3Rpb24gX3NldEVtaXR0ZXJJZChlbWl0dGVyLCBpZCkge1xuICAgIGlmICghZW1pdHRlcltfZW1pdHRlcklkXSkge1xuICAgICAgICBlbWl0dGVyW19lbWl0dGVySWRdID0gaWQgfHwgdWlkKCk7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGVtaXR0ZXIncyB1bmlxdWUgaWQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gZW1pdHRlciBBbiBlbWl0dGVyIHdoaWNoIGlkIHdpbGwgYmUgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gX2dldEVtaXR0ZXJJZChlbWl0dGVyKSB7XG4gICAgcmV0dXJuIGVtaXR0ZXJbX2VtaXR0ZXJJZF07XG59XG4vKipcbiAqIEdldHMgdGhlIGludGVybmFsIGBfZXZlbnRzYCBwcm9wZXJ0eSBvZiB0aGUgZ2l2ZW4gb2JqZWN0LlxuICogYF9ldmVudHNgIHByb3BlcnR5IHN0b3JlIGFsbCBsaXN0cyB3aXRoIGNhbGxiYWNrcyBmb3IgcmVnaXN0ZXJlZCBldmVudCBuYW1lcy5cbiAqIElmIHRoZXJlIHdlcmUgbm8gZXZlbnRzIHJlZ2lzdGVyZWQgb24gdGhlIG9iamVjdCwgZW1wdHkgYF9ldmVudHNgIG9iamVjdCBpcyBjcmVhdGVkLlxuICovIGZ1bmN0aW9uIGdldEV2ZW50cyhzb3VyY2UpIHtcbiAgICBpZiAoIXNvdXJjZS5fZXZlbnRzKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzb3VyY2UsICdfZXZlbnRzJywge1xuICAgICAgICAgICAgdmFsdWU6IHt9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gc291cmNlLl9ldmVudHM7XG59XG4vKipcbiAqIENyZWF0ZXMgZXZlbnQgbm9kZSBmb3IgZ2VuZXJpYy1zcGVjaWZpYyBldmVudHMgcmVsYXRpb24gYXJjaGl0ZWN0dXJlLlxuICovIGZ1bmN0aW9uIG1ha2VFdmVudE5vZGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2FsbGJhY2tzOiBbXSxcbiAgICAgICAgY2hpbGRFdmVudHM6IFtdXG4gICAgfTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhbiBhcmNoaXRlY3R1cmUgZm9yIGdlbmVyaWMtc3BlY2lmaWMgZXZlbnRzIHJlbGF0aW9uLlxuICogSWYgbmVlZGVkLCBjcmVhdGVzIGFsbCBldmVudHMgZm9yIGdpdmVuIGV2ZW50TmFtZSwgaS5lLiBpZiB0aGUgZmlyc3QgcmVnaXN0ZXJlZCBldmVudFxuICogaXMgZm9vOmJhcjphYmMsIGl0IHdpbGwgY3JlYXRlIGZvbzpiYXI6YWJjLCBmb286YmFyIGFuZCBmb28gZXZlbnQgYW5kIHRpZSB0aGVtIHRvZ2V0aGVyLlxuICogSXQgYWxzbyBjb3BpZXMgY2FsbGJhY2tzIGZyb20gbW9yZSBnZW5lcmljIGV2ZW50cyB0byBtb3JlIHNwZWNpZmljIGV2ZW50cyB3aGVuXG4gKiBzcGVjaWZpYyBldmVudHMgYXJlIGNyZWF0ZWQuXG4gKi8gZnVuY3Rpb24gY3JlYXRlRXZlbnROYW1lc3BhY2Uoc291cmNlLCBldmVudE5hbWUpIHtcbiAgICBjb25zdCBldmVudHMgPSBnZXRFdmVudHMoc291cmNlKTtcbiAgICAvLyBGaXJzdCwgY2hlY2sgaWYgdGhlIGV2ZW50IHdlIHdhbnQgdG8gYWRkIHRvIHRoZSBzdHJ1Y3R1cmUgYWxyZWFkeSBleGlzdHMuXG4gICAgaWYgKGV2ZW50c1tldmVudE5hbWVdKSB7XG4gICAgICAgIC8vIElmIGl0IGV4aXN0cywgd2UgZG9uJ3QgaGF2ZSB0byBkbyBhbnl0aGluZy5cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBJbiBvdGhlciBjYXNlLCB3ZSBoYXZlIHRvIGNyZWF0ZSB0aGUgc3RydWN0dXJlIGZvciB0aGUgZXZlbnQuXG4gICAgLy8gTm90ZSwgdGhhdCB3ZSBtaWdodCBuZWVkIHRvIGNyZWF0ZSBpbnRlcm1lZGlhdGUgZXZlbnRzIHRvby5cbiAgICAvLyBJLmUuIGlmIGZvbzpiYXI6YWJjIGlzIGJlaW5nIHJlZ2lzdGVyZWQgYW5kIHdlIG9ubHkgaGF2ZSBmb28gaW4gdGhlIHN0cnVjdHVyZSxcbiAgICAvLyB3ZSBuZWVkIHRvIGFsc28gcmVnaXN0ZXIgZm9vOmJhci5cbiAgICAvLyBDdXJyZW50bHkgcHJvY2Vzc2VkIGV2ZW50IG5hbWUuXG4gICAgbGV0IG5hbWUgPSBldmVudE5hbWU7XG4gICAgLy8gTmFtZSBvZiB0aGUgZXZlbnQgdGhhdCBpcyBhIGNoaWxkIGV2ZW50IGZvciBjdXJyZW50bHkgcHJvY2Vzc2VkIGV2ZW50LlxuICAgIGxldCBjaGlsZEV2ZW50TmFtZSA9IG51bGw7XG4gICAgLy8gQXJyYXkgY29udGFpbmluZyBhbGwgbmV3bHkgY3JlYXRlZCBzcGVjaWZpYyBldmVudHMuXG4gICAgY29uc3QgbmV3RXZlbnROb2RlcyA9IFtdO1xuICAgIC8vIFdoaWxlIGxvb3AgY2FuJ3QgY2hlY2sgZm9yICc6JyBpbmRleCBiZWNhdXNlIHdlIGhhdmUgdG8gaGFuZGxlIGdlbmVyaWMgZXZlbnRzIHRvby5cbiAgICAvLyBJbiBlYWNoIGxvb3AsIHdlIHRydW5jYXRlIGV2ZW50IG5hbWUsIGdvaW5nIGZyb20gdGhlIG1vc3Qgc3BlY2lmaWMgbmFtZSB0byB0aGUgZ2VuZXJpYyBvbmUuXG4gICAgLy8gSS5lLiBmb286YmFyOmFiYyAtPiBmb286YmFyIC0+IGZvby5cbiAgICB3aGlsZShuYW1lICE9PSAnJyl7XG4gICAgICAgIGlmIChldmVudHNbbmFtZV0pIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoaXMgZXZlbnQgaXMgbm90IHlldCByZWdpc3RlcmVkLCBjcmVhdGUgYSBuZXcgb2JqZWN0IGZvciBpdC5cbiAgICAgICAgZXZlbnRzW25hbWVdID0gbWFrZUV2ZW50Tm9kZSgpO1xuICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGFycmF5IHdpdGggbmV3bHkgY3JlYXRlZCBldmVudHMuXG4gICAgICAgIG5ld0V2ZW50Tm9kZXMucHVzaChldmVudHNbbmFtZV0pO1xuICAgICAgICAvLyBBZGQgcHJldmlvdXNseSBwcm9jZXNzZWQgZXZlbnQgbmFtZSBhcyBhIGNoaWxkIG9mIHRoaXMgZXZlbnQuXG4gICAgICAgIGlmIChjaGlsZEV2ZW50TmFtZSkge1xuICAgICAgICAgICAgZXZlbnRzW25hbWVdLmNoaWxkRXZlbnRzLnB1c2goY2hpbGRFdmVudE5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNoaWxkRXZlbnROYW1lID0gbmFtZTtcbiAgICAgICAgLy8gSWYgYC5sYXN0SW5kZXhPZigpYCByZXR1cm5zIC0xLCBgLnN1YnN0cigpYCB3aWxsIHJldHVybiAnJyB3aGljaCB3aWxsIGJyZWFrIHRoZSBsb29wLlxuICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHIoMCwgbmFtZS5sYXN0SW5kZXhPZignOicpKTtcbiAgICB9XG4gICAgaWYgKG5hbWUgIT09ICcnKSB7XG4gICAgICAgIC8vIElmIG5hbWUgaXMgbm90IGVtcHR5LCB3ZSBmb3VuZCBhbiBhbHJlYWR5IHJlZ2lzdGVyZWQgZXZlbnQgdGhhdCB3YXMgYSBwYXJlbnQgb2YgdGhlXG4gICAgICAgIC8vIGV2ZW50IHdlIHdhbnRlZCB0byByZWdpc3Rlci5cbiAgICAgICAgLy8gQ29weSB0aGF0IGV2ZW50J3MgY2FsbGJhY2tzIHRvIG5ld2x5IHJlZ2lzdGVyZWQgZXZlbnRzLlxuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgbmV3RXZlbnROb2Rlcyl7XG4gICAgICAgICAgICBub2RlLmNhbGxiYWNrcyA9IGV2ZW50c1tuYW1lXS5jYWxsYmFja3Muc2xpY2UoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBZGQgbGFzdCBuZXdseSBjcmVhdGVkIGV2ZW50IHRvIHRoZSBhbHJlYWR5IHJlZ2lzdGVyZWQgZXZlbnQuXG4gICAgICAgIGV2ZW50c1tuYW1lXS5jaGlsZEV2ZW50cy5wdXNoKGNoaWxkRXZlbnROYW1lKTtcbiAgICB9XG59XG4vKipcbiAqIEdldHMgYW4gYXJyYXkgY29udGFpbmluZyBjYWxsYmFja3MgbGlzdCBmb3IgYSBnaXZlbiBldmVudCBhbmQgaXQncyBtb3JlIHNwZWNpZmljIGV2ZW50cy5cbiAqIEkuZS4gaWYgZ2l2ZW4gZXZlbnQgaXMgZm9vOmJhciBhbmQgdGhlcmUgaXMgYWxzbyBmb286YmFyOmFiYyBldmVudCByZWdpc3RlcmVkLCB0aGlzIHdpbGxcbiAqIHJldHVybiBjYWxsYmFjayBsaXN0IG9mIGZvbzpiYXIgYW5kIGZvbzpiYXI6YWJjIChidXQgbm90IGZvbykuXG4gKi8gZnVuY3Rpb24gZ2V0Q2FsbGJhY2tzTGlzdHNGb3JOYW1lc3BhY2Uoc291cmNlLCBldmVudE5hbWUpIHtcbiAgICBjb25zdCBldmVudE5vZGUgPSBnZXRFdmVudHMoc291cmNlKVtldmVudE5hbWVdO1xuICAgIGlmICghZXZlbnROb2RlKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgbGV0IGNhbGxiYWNrc0xpc3RzID0gW1xuICAgICAgICBldmVudE5vZGUuY2FsbGJhY2tzXG4gICAgXTtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgZXZlbnROb2RlLmNoaWxkRXZlbnRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY29uc3QgY2hpbGRDYWxsYmFja3NMaXN0cyA9IGdldENhbGxiYWNrc0xpc3RzRm9yTmFtZXNwYWNlKHNvdXJjZSwgZXZlbnROb2RlLmNoaWxkRXZlbnRzW2ldKTtcbiAgICAgICAgY2FsbGJhY2tzTGlzdHMgPSBjYWxsYmFja3NMaXN0cy5jb25jYXQoY2hpbGRDYWxsYmFja3NMaXN0cyk7XG4gICAgfVxuICAgIHJldHVybiBjYWxsYmFja3NMaXN0cztcbn1cbi8qKlxuICogR2V0IHRoZSBsaXN0IG9mIGNhbGxiYWNrcyBmb3IgYSBnaXZlbiBldmVudCwgYnV0IG9ubHkgaWYgdGhlcmUgYW55IGNhbGxiYWNrcyBoYXZlIGJlZW4gcmVnaXN0ZXJlZC5cbiAqIElmIHRoZXJlIGFyZSBubyBjYWxsYmFja3MgcmVnaXN0ZXJlZCBmb3IgZ2l2ZW4gZXZlbnQsIGl0IGNoZWNrcyBpZiB0aGlzIGlzIGEgc3BlY2lmaWMgZXZlbnQgYW5kIGxvb2tzXG4gKiBmb3IgY2FsbGJhY2tzIGZvciBpdCdzIG1vcmUgZ2VuZXJpYyB2ZXJzaW9uLlxuICovIGZ1bmN0aW9uIGdldENhbGxiYWNrc0ZvckV2ZW50KHNvdXJjZSwgZXZlbnROYW1lKSB7XG4gICAgaWYgKCFzb3VyY2UuX2V2ZW50cykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgbGV0IGN1cnJlbnRFdmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgZG8ge1xuICAgICAgICBjb25zdCBldmVudCA9IHNvdXJjZS5fZXZlbnRzW2N1cnJlbnRFdmVudE5hbWVdO1xuICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQuY2FsbGJhY2tzICYmIGV2ZW50LmNhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBldmVudC5jYWxsYmFja3M7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sb25JbmRleCA9IGN1cnJlbnRFdmVudE5hbWUubGFzdEluZGV4T2YoJzonKTtcbiAgICAgICAgY3VycmVudEV2ZW50TmFtZSA9IGNvbG9uSW5kZXggPiAtMSA/IGN1cnJlbnRFdmVudE5hbWUuc3Vic3RyaW5nKDAsIGNvbG9uSW5kZXgpIDogJyc7XG4gICAgfXdoaWxlIChjdXJyZW50RXZlbnROYW1lKVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBGaXJlcyBkZWxlZ2F0ZWQgZXZlbnRzIGZvciBnaXZlbiBtYXAgb2YgZGVzdGluYXRpb25zLlxuICpcbiAqIEBwYXJhbSBkZXN0aW5hdGlvbnMgQSBtYXAgY29udGFpbmluZyBgWyB7QGxpbmsgbW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyfSwgXCJldmVudCBuYW1lXCIgXWAgcGFpciBkZXN0aW5hdGlvbnMuXG4gKiBAcGFyYW0gZXZlbnRJbmZvIFRoZSBvcmlnaW5hbCBldmVudCBpbmZvIG9iamVjdC5cbiAqIEBwYXJhbSBmaXJlQXJncyBBcmd1bWVudHMgdGhlIG9yaWdpbmFsIGV2ZW50IHdhcyBmaXJlZCB3aXRoLlxuICovIGZ1bmN0aW9uIGZpcmVEZWxlZ2F0ZWRFdmVudHMoZGVzdGluYXRpb25zLCBldmVudEluZm8sIGZpcmVBcmdzKSB7XG4gICAgZm9yIChsZXQgW2VtaXR0ZXIsIG5hbWVdIG9mIGRlc3RpbmF0aW9ucyl7XG4gICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgbmFtZSA9IGV2ZW50SW5mby5uYW1lO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBuYW1lID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG5hbWUgPSBuYW1lKGV2ZW50SW5mby5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWxlZ2F0ZWRJbmZvID0gbmV3IEV2ZW50SW5mbyhldmVudEluZm8uc291cmNlLCBuYW1lKTtcbiAgICAgICAgZGVsZWdhdGVkSW5mby5wYXRoID0gW1xuICAgICAgICAgICAgLi4uZXZlbnRJbmZvLnBhdGhcbiAgICAgICAgXTtcbiAgICAgICAgZW1pdHRlci5maXJlKGRlbGVnYXRlZEluZm8sIC4uLmZpcmVBcmdzKTtcbiAgICB9XG59XG4vKipcbiAqIEhlbHBlciBmb3IgcmVnaXN0ZXJpbmcgZXZlbnQgY2FsbGJhY2sgb24gdGhlIGVtaXR0ZXIuXG4gKi8gZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihsaXN0ZW5lciwgZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gICAgaWYgKGVtaXR0ZXIuX2FkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgZW1pdHRlci5fYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEFsbG93IGxpc3RlbmluZyBvbiBvYmplY3RzIHRoYXQgZG8gbm90IGltcGxlbWVudCBFbWl0dGVyIGludGVyZmFjZS5cbiAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgaW4gc29tZSB0ZXN0cyB0aGF0IGFyZSB1c2luZyBtb2NrcyBpbnN0ZWFkIG9mIHRoZSByZWFsIG9iamVjdHMgd2l0aCBFbWl0dGVyTWl4aW4gbWl4ZWQuXG4gICAgICAgIGxpc3RlbmVyLl9hZGRFdmVudExpc3RlbmVyLmNhbGwoZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgICB9XG59XG4vKipcbiAqIEhlbHBlciBmb3IgcmVtb3ZpbmcgZXZlbnQgY2FsbGJhY2sgZnJvbSB0aGUgZW1pdHRlci5cbiAqLyBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKGxpc3RlbmVyLCBlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spIHtcbiAgICBpZiAoZW1pdHRlci5fcmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICBlbWl0dGVyLl9yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjayk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWxsb3cgbGlzdGVuaW5nIG9uIG9iamVjdHMgdGhhdCBkbyBub3QgaW1wbGVtZW50IEVtaXR0ZXIgaW50ZXJmYWNlLlxuICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBpbiBzb21lIHRlc3RzIHRoYXQgYXJlIHVzaW5nIG1vY2tzIGluc3RlYWQgb2YgdGhlIHJlYWwgb2JqZWN0cyB3aXRoIEVtaXR0ZXJNaXhpbiBtaXhlZC5cbiAgICAgICAgbGlzdGVuZXIuX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbChlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spO1xuICAgIH1cbn1cblxuY29uc3Qgb2JzZXJ2YWJsZVByb3BlcnRpZXNTeW1ib2wgPSBTeW1ib2woJ29ic2VydmFibGVQcm9wZXJ0aWVzJyk7XG5jb25zdCBib3VuZE9ic2VydmFibGVzU3ltYm9sID0gU3ltYm9sKCdib3VuZE9ic2VydmFibGVzJyk7XG5jb25zdCBib3VuZFByb3BlcnRpZXNTeW1ib2wgPSBTeW1ib2woJ2JvdW5kUHJvcGVydGllcycpO1xuY29uc3QgZGVjb3JhdGVkTWV0aG9kcyA9IFN5bWJvbCgnZGVjb3JhdGVkTWV0aG9kcycpO1xuY29uc3QgZGVjb3JhdGVkT3JpZ2luYWwgPSBTeW1ib2woJ2RlY29yYXRlZE9yaWdpbmFsJyk7XG5jb25zdCBkZWZhdWx0T2JzZXJ2YWJsZUNsYXNzID0gLyogI19fUFVSRV9fICovIE9ic2VydmFibGVNaXhpbigvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKCkpO1xuZnVuY3Rpb24gT2JzZXJ2YWJsZU1peGluKGJhc2UpIHtcbiAgICBpZiAoIWJhc2UpIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRPYnNlcnZhYmxlQ2xhc3M7XG4gICAgfVxuICAgIGNsYXNzIE1peGluIGV4dGVuZHMgYmFzZSB7XG4gICAgICAgIHNldChuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBhbiBPYmplY3QsIGl0ZXJhdGUgb3ZlciBpdHMgcHJvcGVydGllcy5cbiAgICAgICAgICAgIGlmIChpc09iamVjdChuYW1lKSkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKG5hbWUpLmZvckVhY2goKHByb3BlcnR5KT0+e1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldChwcm9wZXJ0eSwgbmFtZVtwcm9wZXJ0eV0pO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluaXRPYnNlcnZhYmxlKHRoaXMpO1xuICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXNbb2JzZXJ2YWJsZVByb3BlcnRpZXNTeW1ib2xdO1xuICAgICAgICAgICAgaWYgKG5hbWUgaW4gdGhpcyAmJiAhcHJvcGVydGllcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0ICogQ2Fubm90IG92ZXJyaWRlIGFuIGV4aXN0aW5nIHByb3BlcnR5LlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBUaGlzIGVycm9yIGlzIHRocm93biB3aGVuIHRyeWluZyB0byB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI3NldCBzZXR9IGEgcHJvcGVydHkgd2l0aFxuXHRcdFx0XHQgKiBhIG5hbWUgb2YgYW4gYWxyZWFkeSBleGlzdGluZyBwcm9wZXJ0eS4gRm9yIGV4YW1wbGU6XG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIGBgYHRzXG5cdFx0XHRcdCAqIGxldCBvYnNlcnZhYmxlID0gbmV3IE1vZGVsKCk7XG5cdFx0XHRcdCAqIG9ic2VydmFibGUucHJvcGVydHkgPSAxO1xuXHRcdFx0XHQgKiBvYnNlcnZhYmxlLnNldCggJ3Byb3BlcnR5JywgMiApO1x0XHRcdC8vIHRocm93c1xuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBvYnNlcnZhYmxlLnNldCggJ3Byb3BlcnR5JywgMSApO1xuXHRcdFx0XHQgKiBvYnNlcnZhYmxlLnNldCggJ3Byb3BlcnR5JywgMiApO1x0XHRcdC8vIG9rLCBiZWNhdXNlIHRoaXMgaXMgYW4gZXhpc3RpbmcgcHJvcGVydHkuXG5cdFx0XHRcdCAqIGBgYFxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3Igb2JzZXJ2YWJsZS1zZXQtY2Fubm90LW92ZXJyaWRlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1zZXQtY2Fubm90LW92ZXJyaWRlJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgbmFtZSwge1xuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGdldCAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0aWVzLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNldCAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBwcm9wZXJ0aWVzLmdldChuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmlyZSBgc2V0YCBldmVudCBiZWZvcmUgdGhlIG5ldyB2YWx1ZSB3aWxsIGJlIHNldCB0byBtYWtlIGl0IHBvc3NpYmxlXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvIG92ZXJyaWRlIG9ic2VydmFibGUgcHJvcGVydHkgd2l0aG91dCBhZmZlY3RpbmcgYGNoYW5nZWAgZXZlbnQuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL2lzc3Vlcy8xNzEuXG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHRoaXMuZmlyZShgc2V0OiR7bmFtZX1gLCBuYW1lLCB2YWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3VmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBBbGxvdyB1bmRlZmluZWQgYXMgYW4gaW5pdGlhbCB2YWx1ZSBsaWtlIEEuZGVmaW5lKCAneCcsIHVuZGVmaW5lZCApICgjMTMyKS5cbiAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogV2hlbiBwcm9wZXJ0aWVzIG1hcCBoYXMgbm8gc3VjaCBvd24gcHJvcGVydHksIHRoZW4gaXRzIHZhbHVlIGlzIHVuZGVmaW5lZC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFZhbHVlICE9PSBuZXdWYWx1ZSB8fCAhcHJvcGVydGllcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMuc2V0KG5hbWUsIG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZShgY2hhbmdlOiR7bmFtZX1gLCBuYW1lLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzW25hbWVdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgYmluZCguLi5iaW5kUHJvcGVydGllcykge1xuICAgICAgICAgICAgaWYgKCFiaW5kUHJvcGVydGllcy5sZW5ndGggfHwgIWlzU3RyaW5nQXJyYXkoYmluZFByb3BlcnRpZXMpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIEFsbCBwcm9wZXJ0aWVzIG11c3QgYmUgc3RyaW5ncy5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIG9ic2VydmFibGUtYmluZC13cm9uZy1wcm9wZXJ0aWVzXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1iaW5kLXdyb25nLXByb3BlcnRpZXMnLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuZXcgU2V0KGJpbmRQcm9wZXJ0aWVzKS5zaXplICE9PSBiaW5kUHJvcGVydGllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0ICogUHJvcGVydGllcyBtdXN0IGJlIHVuaXF1ZS5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIG9ic2VydmFibGUtYmluZC1kdXBsaWNhdGUtcHJvcGVydGllc1xuXHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGUtYmluZC1kdXBsaWNhdGUtcHJvcGVydGllcycsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaW5pdE9ic2VydmFibGUodGhpcyk7XG4gICAgICAgICAgICBjb25zdCBib3VuZFByb3BlcnRpZXMgPSB0aGlzW2JvdW5kUHJvcGVydGllc1N5bWJvbF07XG4gICAgICAgICAgICBiaW5kUHJvcGVydGllcy5mb3JFYWNoKChwcm9wZXJ0eU5hbWUpPT57XG4gICAgICAgICAgICAgICAgaWYgKGJvdW5kUHJvcGVydGllcy5oYXMocHJvcGVydHlOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0XHQgKiBDYW5ub3QgYmluZCB0aGUgc2FtZSBwcm9wZXJ0eSBtb3JlIHRoYW4gb25jZS5cblx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdCAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtcmViaW5kXG5cdFx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtcmViaW5kJywgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBiaW5kaW5ncyA9IG5ldyBNYXAoKTtcbiAgICAgICAgICAgIGJpbmRQcm9wZXJ0aWVzLmZvckVhY2goKGEpPT57XG4gICAgICAgICAgICAgICAgY29uc3QgYmluZGluZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IGEsXG4gICAgICAgICAgICAgICAgICAgIHRvOiBbXVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLnNldChhLCBiaW5kaW5nKTtcbiAgICAgICAgICAgICAgICBiaW5kaW5ncy5zZXQoYSwgYmluZGluZyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG86IGJpbmRUbyxcbiAgICAgICAgICAgICAgICB0b01hbnk6IGJpbmRUb01hbnksXG4gICAgICAgICAgICAgICAgX29ic2VydmFibGU6IHRoaXMsXG4gICAgICAgICAgICAgICAgX2JpbmRQcm9wZXJ0aWVzOiBiaW5kUHJvcGVydGllcyxcbiAgICAgICAgICAgICAgICBfdG86IFtdLFxuICAgICAgICAgICAgICAgIF9iaW5kaW5nczogYmluZGluZ3NcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgdW5iaW5kKC4uLnVuYmluZFByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8gZG8gaGVyZSBpZiBub3QgaW5pdGVkIHlldC5cbiAgICAgICAgICAgIGlmICghdGhpc1tvYnNlcnZhYmxlUHJvcGVydGllc1N5bWJvbF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBib3VuZFByb3BlcnRpZXMgPSB0aGlzW2JvdW5kUHJvcGVydGllc1N5bWJvbF07XG4gICAgICAgICAgICBjb25zdCBib3VuZE9ic2VydmFibGVzID0gdGhpc1tib3VuZE9ic2VydmFibGVzU3ltYm9sXTtcbiAgICAgICAgICAgIGlmICh1bmJpbmRQcm9wZXJ0aWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmICghaXNTdHJpbmdBcnJheSh1bmJpbmRQcm9wZXJ0aWVzKSkge1xuICAgICAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0XHQgKiBQcm9wZXJ0aWVzIG11c3QgYmUgc3RyaW5ncy5cblx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdCAqIEBlcnJvciBvYnNlcnZhYmxlLXVuYmluZC13cm9uZy1wcm9wZXJ0aWVzXG5cdFx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLXVuYmluZC13cm9uZy1wcm9wZXJ0aWVzJywgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVuYmluZFByb3BlcnRpZXMuZm9yRWFjaCgocHJvcGVydHlOYW1lKT0+e1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBiaW5kaW5nID0gYm91bmRQcm9wZXJ0aWVzLmdldChwcm9wZXJ0eU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIHRvIGRvIGlmIHRoZSBiaW5kaW5nIGlzIG5vdCBkZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIGlmICghYmluZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmcudG8uZm9yRWFjaCgoW3RvT2JzZXJ2YWJsZSwgdG9Qcm9wZXJ0eV0pPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b1Byb3BlcnRpZXMgPSBib3VuZE9ic2VydmFibGVzLmdldCh0b09ic2VydmFibGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9Qcm9wZXJ0eUJpbmRpbmdzID0gdG9Qcm9wZXJ0aWVzW3RvUHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9Qcm9wZXJ0eUJpbmRpbmdzLmRlbGV0ZShiaW5kaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9Qcm9wZXJ0eUJpbmRpbmdzLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdG9Qcm9wZXJ0aWVzW3RvUHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3Qua2V5cyh0b1Byb3BlcnRpZXMpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kT2JzZXJ2YWJsZXMuZGVsZXRlKHRvT2JzZXJ2YWJsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKHRvT2JzZXJ2YWJsZSwgJ2NoYW5nZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLmRlbGV0ZShwcm9wZXJ0eU5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBib3VuZE9ic2VydmFibGVzLmZvckVhY2goKGJpbmRpbmdzLCBib3VuZE9ic2VydmFibGUpPT57XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcExpc3RlbmluZyhib3VuZE9ic2VydmFibGUsICdjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBib3VuZE9ic2VydmFibGVzLmNsZWFyKCk7XG4gICAgICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLmNsZWFyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGVjb3JhdGUobWV0aG9kTmFtZSkge1xuICAgICAgICAgICAgaW5pdE9ic2VydmFibGUodGhpcyk7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IHRoaXNbbWV0aG9kTmFtZV07XG4gICAgICAgICAgICBpZiAoIW9yaWdpbmFsTWV0aG9kKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIENhbm5vdCBkZWNvcmF0ZSBhbiB1bmRlZmluZWQgbWV0aG9kLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3Igb2JzZXJ2YWJsZW1peGluLWNhbm5vdC1kZWNvcmF0ZS11bmRlZmluZWRcblx0XHRcdFx0ICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHdoaWNoIG1ldGhvZCBzaG91bGQgYmUgZGVjb3JhdGVkLlxuXHRcdFx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kTmFtZSBOYW1lIG9mIHRoZSBtZXRob2Qgd2hpY2ggZG9lcyBub3QgZXhpc3QuXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZW1peGluLWNhbm5vdC1kZWNvcmF0ZS11bmRlZmluZWQnLCB0aGlzLCB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdDogdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kTmFtZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vbihtZXRob2ROYW1lLCAoZXZ0LCBhcmdzKT0+e1xuICAgICAgICAgICAgICAgIGV2dC5yZXR1cm4gPSBvcmlnaW5hbE1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpc1ttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maXJlKG1ldGhvZE5hbWUsIGFyZ3MpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXNbbWV0aG9kTmFtZV1bZGVjb3JhdGVkT3JpZ2luYWxdID0gb3JpZ2luYWxNZXRob2Q7XG4gICAgICAgICAgICBpZiAoIXRoaXNbZGVjb3JhdGVkTWV0aG9kc10pIHtcbiAgICAgICAgICAgICAgICB0aGlzW2RlY29yYXRlZE1ldGhvZHNdID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzW2RlY29yYXRlZE1ldGhvZHNdLnB1c2gobWV0aG9kTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIEVtaXR0ZXJNaXhpbiBzdG9wTGlzdGVuaW5nIG1ldGhvZCB0byBiZSBhYmxlIHRvIGNsZWFuIChhbmQgcmVzdG9yZSkgZGVjb3JhdGVkIG1ldGhvZHMuXG4gICAgICAgIC8vIFRoaXMgaXMgbmVlZGVkIGluIGNhc2Ugb2Y6XG4gICAgICAgIC8vICAxLiBIYXZlIHguZm9vKCkgZGVjb3JhdGVkLlxuICAgICAgICAvLyAgMi4gQ2FsbCB4LnN0b3BMaXN0ZW5pbmcoKVxuICAgICAgICAvLyAgMy4gQ2FsbCB4LmZvbygpLiBQcm9ibGVtOiBub3RoaW5nIGhhcHBlbnMgKHRoZSBvcmlnaW5hbCBmb28oKSBtZXRob2QgaXMgbm90IGV4ZWN1dGVkKVxuICAgICAgICBzdG9wTGlzdGVuaW5nKGVtaXR0ZXIsIGV2ZW50LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgLy8gUmVtb3ZpbmcgYWxsIGxpc3RlbmVycyBzbyBsZXQncyBjbGVhbiB0aGUgZGVjb3JhdGVkIG1ldGhvZHMgdG8gdGhlIG9yaWdpbmFsIHN0YXRlLlxuICAgICAgICAgICAgaWYgKCFlbWl0dGVyICYmIHRoaXNbZGVjb3JhdGVkTWV0aG9kc10pIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1ldGhvZE5hbWUgb2YgdGhpc1tkZWNvcmF0ZWRNZXRob2RzXSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXNbbWV0aG9kTmFtZV0gPSB0aGlzW21ldGhvZE5hbWVdW2RlY29yYXRlZE9yaWdpbmFsXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXNbZGVjb3JhdGVkTWV0aG9kc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdXBlci5zdG9wTGlzdGVuaW5nKGVtaXR0ZXIsIGV2ZW50LCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgW29ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sXTtcbiAgICAgICAgW2RlY29yYXRlZE1ldGhvZHNdO1xuICAgICAgICBbYm91bmRQcm9wZXJ0aWVzU3ltYm9sXTtcbiAgICAgICAgW2JvdW5kT2JzZXJ2YWJsZXNTeW1ib2xdO1xuICAgIH1cbiAgICByZXR1cm4gTWl4aW47XG59XG4vLyBCYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggYG1peGBcbltcbiAgICAnc2V0JyxcbiAgICAnYmluZCcsXG4gICAgJ3VuYmluZCcsXG4gICAgJ2RlY29yYXRlJyxcbiAgICAnb24nLFxuICAgICdvbmNlJyxcbiAgICAnb2ZmJyxcbiAgICAnbGlzdGVuVG8nLFxuICAgICdzdG9wTGlzdGVuaW5nJyxcbiAgICAnZmlyZScsXG4gICAgJ2RlbGVnYXRlJyxcbiAgICAnc3RvcERlbGVnYXRpbmcnLFxuICAgICdfYWRkRXZlbnRMaXN0ZW5lcicsXG4gICAgJ19yZW1vdmVFdmVudExpc3RlbmVyJ1xuXS5mb3JFYWNoKChrZXkpPT57XG4gICAgT2JzZXJ2YWJsZU1peGluW2tleV0gPSBkZWZhdWx0T2JzZXJ2YWJsZUNsYXNzLnByb3RvdHlwZVtrZXldO1xufSk7XG4vLyBJbml0IHN5bWJvbCBwcm9wZXJ0aWVzIG5lZWRlZCBmb3IgdGhlIG9ic2VydmFibGUgbWVjaGFuaXNtIHRvIHdvcmsuXG5mdW5jdGlvbiBpbml0T2JzZXJ2YWJsZShvYnNlcnZhYmxlKSB7XG4gICAgLy8gRG8gbm90aGluZyBpZiBhbHJlYWR5IGluaXRlZC5cbiAgICBpZiAob2JzZXJ2YWJsZVtvYnNlcnZhYmxlUHJvcGVydGllc1N5bWJvbF0pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBUaGUgaW50ZXJuYWwgaGFzaCBjb250YWluaW5nIHRoZSBvYnNlcnZhYmxlJ3Mgc3RhdGUuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9ic2VydmFibGUsIG9ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sLCB7XG4gICAgICAgIHZhbHVlOiBuZXcgTWFwKClcbiAgICB9KTtcbiAgICAvLyBNYXAgY29udGFpbmluZyBiaW5kaW5ncyB0byBleHRlcm5hbCBvYnNlcnZhYmxlcy4gSXQgc2hhcmVzIHRoZSBiaW5kaW5nIG9iamVjdHNcbiAgICAvLyAoYHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IC4uLiB9YCkgd2l0aCB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI19ib3VuZFByb3BlcnRpZXN9IGFuZFxuICAgIC8vIGl0IGlzIHVzZWQgdG8gb2JzZXJ2ZSBleHRlcm5hbCBvYnNlcnZhYmxlcyB0byB1cGRhdGUgb3duIHByb3BlcnRpZXMgYWNjb3JkaW5nbHkuXG4gICAgLy8gU2VlIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUjYmluZH0uXG4gICAgLy9cbiAgICAvL1x0XHRBLmJpbmQoICdhJywgJ2InLCAnYycgKS50byggQiwgJ3gnLCAneScsICd4JyApO1xuICAgIC8vXHRcdGNvbnNvbGUubG9nKCBBLl9ib3VuZE9ic2VydmFibGVzICk7XG4gICAgLy9cbiAgICAvL1x0XHRcdE1hcCgge1xuICAgIC8vXHRcdFx0XHRCOiB7XG4gICAgLy9cdFx0XHRcdFx0eDogU2V0KCBbXG4gICAgLy9cdFx0XHRcdFx0XHR7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9LFxuICAgIC8vXHRcdFx0XHRcdFx0eyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfVxuICAgIC8vXHRcdFx0XHRcdF0gKSxcbiAgICAvL1x0XHRcdFx0XHR5OiBTZXQoIFtcbiAgICAvL1x0XHRcdFx0XHRcdHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFsgWyBCLCAneScgXSBdIH0sXG4gICAgLy9cdFx0XHRcdFx0XSApXG4gICAgLy9cdFx0XHRcdH1cbiAgICAvL1x0XHRcdH0gKVxuICAgIC8vXG4gICAgLy9cdFx0QS5iaW5kKCAnZCcgKS50byggQiwgJ3onICkudG8oIEMsICd3JyApLmFzKCBjYWxsYmFjayApO1xuICAgIC8vXHRcdGNvbnNvbGUubG9nKCBBLl9ib3VuZE9ic2VydmFibGVzICk7XG4gICAgLy9cbiAgICAvL1x0XHRcdE1hcCgge1xuICAgIC8vXHRcdFx0XHRCOiB7XG4gICAgLy9cdFx0XHRcdFx0eDogU2V0KCBbXG4gICAgLy9cdFx0XHRcdFx0XHR7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiBbIFsgQiwgJ3gnIF0gXSB9LFxuICAgIC8vXHRcdFx0XHRcdFx0eyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfVxuICAgIC8vXHRcdFx0XHRcdF0gKSxcbiAgICAvL1x0XHRcdFx0XHR5OiBTZXQoIFtcbiAgICAvL1x0XHRcdFx0XHRcdHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFsgWyBCLCAneScgXSBdIH0sXG4gICAgLy9cdFx0XHRcdFx0XSApLFxuICAgIC8vXHRcdFx0XHRcdHo6IFNldCggW1xuICAgIC8vXHRcdFx0XHRcdFx0eyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2QnLCB0bzogWyBbIEIsICd6JyBdLCBbIEMsICd3JyBdIF0sIGNhbGxiYWNrOiBjYWxsYmFjayB9XG4gICAgLy9cdFx0XHRcdFx0XSApXG4gICAgLy9cdFx0XHRcdH0sXG4gICAgLy9cdFx0XHRcdEM6IHtcbiAgICAvL1x0XHRcdFx0XHR3OiBTZXQoIFtcbiAgICAvL1x0XHRcdFx0XHRcdHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdkJywgdG86IFsgWyBCLCAneicgXSwgWyBDLCAndycgXSBdLCBjYWxsYmFjazogY2FsbGJhY2sgfVxuICAgIC8vXHRcdFx0XHRcdF0gKVxuICAgIC8vXHRcdFx0XHR9XG4gICAgLy9cdFx0XHR9IClcbiAgICAvL1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYnNlcnZhYmxlLCBib3VuZE9ic2VydmFibGVzU3ltYm9sLCB7XG4gICAgICAgIHZhbHVlOiBuZXcgTWFwKClcbiAgICB9KTtcbiAgICAvLyBPYmplY3QgdGhhdCBzdG9yZXMgd2hpY2ggcHJvcGVydGllcyBvZiB0aGlzIG9ic2VydmFibGUgYXJlIGJvdW5kIGFuZCBob3cuIEl0IHNoYXJlc1xuICAgIC8vIHRoZSBiaW5kaW5nIG9iamVjdHMgKGB7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiAuLi4gfWApIHdpdGhcbiAgICAvLyB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI19ib3VuZE9ic2VydmFibGVzfS4gVGhpcyBkYXRhIHN0cnVjdHVyZSBpc1xuICAgIC8vIGEgcmV2ZXJzZSBvZiB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI19ib3VuZE9ic2VydmFibGVzfSBhbmQgaXQgaXMgaGVscGZ1bCBmb3JcbiAgICAvLyB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGVtaXhpbn5PYnNlcnZhYmxlI3VuYmluZH0uXG4gICAgLy9cbiAgICAvLyBTZWUge0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSNiaW5kfS5cbiAgICAvL1xuICAgIC8vXHRcdEEuYmluZCggJ2EnLCAnYicsICdjJyApLnRvKCBCLCAneCcsICd5JywgJ3gnICk7XG4gICAgLy9cdFx0Y29uc29sZS5sb2coIEEuX2JvdW5kUHJvcGVydGllcyApO1xuICAgIC8vXG4gICAgLy9cdFx0XHRNYXAoIHtcbiAgICAvL1x0XHRcdFx0YTogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2EnLCB0bzogWyBbIEIsICd4JyBdIF0gfSxcbiAgICAvL1x0XHRcdFx0YjogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogWyBbIEIsICd5JyBdIF0gfSxcbiAgICAvL1x0XHRcdFx0YzogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfVxuICAgIC8vXHRcdFx0fSApXG4gICAgLy9cbiAgICAvL1x0XHRBLmJpbmQoICdkJyApLnRvKCBCLCAneicgKS50byggQywgJ3cnICkuYXMoIGNhbGxiYWNrICk7XG4gICAgLy9cdFx0Y29uc29sZS5sb2coIEEuX2JvdW5kUHJvcGVydGllcyApO1xuICAgIC8vXG4gICAgLy9cdFx0XHRNYXAoIHtcbiAgICAvL1x0XHRcdFx0YTogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2EnLCB0bzogWyBbIEIsICd4JyBdIF0gfSxcbiAgICAvL1x0XHRcdFx0YjogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogWyBbIEIsICd5JyBdIF0gfSxcbiAgICAvL1x0XHRcdFx0YzogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2MnLCB0bzogWyBbIEIsICd4JyBdIF0gfSxcbiAgICAvL1x0XHRcdFx0ZDogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2QnLCB0bzogWyBbIEIsICd6JyBdLCBbIEMsICd3JyBdIF0sIGNhbGxiYWNrOiBjYWxsYmFjayB9XG4gICAgLy9cdFx0XHR9IClcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JzZXJ2YWJsZSwgYm91bmRQcm9wZXJ0aWVzU3ltYm9sLCB7XG4gICAgICAgIHZhbHVlOiBuZXcgTWFwKClcbiAgICB9KTtcbn1cbi8qKlxuICogQSBjaGFpbmluZyBmb3Ige0BsaW5rIG1vZHVsZTp1dGlscy9vYnNlcnZhYmxlbWl4aW5+T2JzZXJ2YWJsZSNiaW5kfSBwcm92aWRpbmcgYC50bygpYCBpbnRlcmZhY2UuXG4gKlxuICogQHBhcmFtIGFyZ3MgQXJndW1lbnRzIG9mIHRoZSBgLnRvKCBhcmdzIClgIGJpbmRpbmcuXG4gKi8gZnVuY3Rpb24gYmluZFRvKC4uLmFyZ3MpIHtcbiAgICBjb25zdCBwYXJzZWRBcmdzID0gcGFyc2VCaW5kVG9BcmdzKC4uLmFyZ3MpO1xuICAgIGNvbnN0IGJpbmRpbmdzS2V5cyA9IEFycmF5LmZyb20odGhpcy5fYmluZGluZ3Mua2V5cygpKTtcbiAgICBjb25zdCBudW1iZXJPZkJpbmRpbmdzID0gYmluZGluZ3NLZXlzLmxlbmd0aDtcbiAgICAvLyBFbGltaW5hdGUgQS5iaW5kKCAneCcgKS50byggQiwgQyApXG4gICAgaWYgKCFwYXJzZWRBcmdzLmNhbGxiYWNrICYmIHBhcnNlZEFyZ3MudG8ubGVuZ3RoID4gMSkge1xuICAgICAgICAvKipcblx0XHQgKiBCaW5kaW5nIG11bHRpcGxlIG9ic2VydmFibGVzIG9ubHkgcG9zc2libGUgd2l0aCBjYWxsYmFjay5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtdG8tbm8tY2FsbGJhY2tcblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGUtYmluZC10by1uby1jYWxsYmFjaycsIHRoaXMpO1xuICAgIH1cbiAgICAvLyBFbGltaW5hdGUgQS5iaW5kKCAneCcsICd5JyApLnRvKCBCLCBjYWxsYmFjayApXG4gICAgaWYgKG51bWJlck9mQmluZGluZ3MgPiAxICYmIHBhcnNlZEFyZ3MuY2FsbGJhY2spIHtcbiAgICAgICAgLyoqXG5cdFx0ICogQ2Fubm90IGJpbmQgbXVsdGlwbGUgcHJvcGVydGllcyBhbmQgdXNlIGEgY2FsbGJhY2sgaW4gb25lIGJpbmRpbmcuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3Igb2JzZXJ2YWJsZS1iaW5kLXRvLWV4dHJhLWNhbGxiYWNrXG5cdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tZXh0cmEtY2FsbGJhY2snLCB0aGlzKTtcbiAgICB9XG4gICAgcGFyc2VkQXJncy50by5mb3JFYWNoKCh0byk9PntcbiAgICAgICAgLy8gRWxpbWluYXRlIEEuYmluZCggJ3gnLCAneScgKS50byggQiwgJ2EnIClcbiAgICAgICAgaWYgKHRvLnByb3BlcnRpZXMubGVuZ3RoICYmIHRvLnByb3BlcnRpZXMubGVuZ3RoICE9PSBudW1iZXJPZkJpbmRpbmdzKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBudW1iZXIgb2YgcHJvcGVydGllcyBtdXN0IG1hdGNoLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtdG8tcHJvcGVydGllcy1sZW5ndGhcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignb2JzZXJ2YWJsZS1iaW5kLXRvLXByb3BlcnRpZXMtbGVuZ3RoJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2hlbiBubyB0by5wcm9wZXJ0aWVzIHNwZWNpZmllZCwgb2JzZXJ2aW5nIHNvdXJjZSBwcm9wZXJ0aWVzIGluc3RlYWQgaS5lLlxuICAgICAgICAvLyBBLmJpbmQoICd4JywgJ3knICkudG8oIEIgKSAtPiBPYnNlcnZlIEIueCBhbmQgQi55XG4gICAgICAgIGlmICghdG8ucHJvcGVydGllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRvLnByb3BlcnRpZXMgPSB0aGlzLl9iaW5kUHJvcGVydGllcztcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX3RvID0gcGFyc2VkQXJncy50bztcbiAgICAvLyBGaWxsIHtAbGluayBCaW5kQ2hhaW4jX2JpbmRpbmdzfSB3aXRoIGNhbGxiYWNrLiBXaGVuIHRoZSBjYWxsYmFjayBpcyBzZXQgdGhlcmUncyBvbmx5IG9uZSBiaW5kaW5nLlxuICAgIGlmIChwYXJzZWRBcmdzLmNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2JpbmRpbmdzLmdldChiaW5kaW5nc0tleXNbMF0pLmNhbGxiYWNrID0gcGFyc2VkQXJncy5jYWxsYmFjaztcbiAgICB9XG4gICAgYXR0YWNoQmluZFRvTGlzdGVuZXJzKHRoaXMuX29ic2VydmFibGUsIHRoaXMuX3RvKTtcbiAgICAvLyBVcGRhdGUgb2JzZXJ2YWJsZS5fYm91bmRQcm9wZXJ0aWVzIGFuZCBvYnNlcnZhYmxlLl9ib3VuZE9ic2VydmFibGVzLlxuICAgIHVwZGF0ZUJpbmRUb0JvdW5kKHRoaXMpO1xuICAgIC8vIFNldCBpbml0aWFsIHZhbHVlcyBvZiBib3VuZCBwcm9wZXJ0aWVzLlxuICAgIHRoaXMuX2JpbmRQcm9wZXJ0aWVzLmZvckVhY2goKHByb3BlcnR5TmFtZSk9PntcbiAgICAgICAgdXBkYXRlQm91bmRPYnNlcnZhYmxlUHJvcGVydHkodGhpcy5fb2JzZXJ2YWJsZSwgcHJvcGVydHlOYW1lKTtcbiAgICB9KTtcbn1cbi8qKlxuICogQmluZHMgdG8gYW4gYXR0cmlidXRlIGluIGEgc2V0IG9mIGl0ZXJhYmxlIG9ic2VydmFibGVzLlxuICovIGZ1bmN0aW9uIGJpbmRUb01hbnkob2JzZXJ2YWJsZXMsIGF0dHJpYnV0ZSwgY2FsbGJhY2spIHtcbiAgICBpZiAodGhpcy5fYmluZGluZ3Muc2l6ZSA+IDEpIHtcbiAgICAgICAgLyoqXG5cdFx0ICogQmluZGluZyBvbmUgYXR0cmlidXRlIHRvIG1hbnkgb2JzZXJ2YWJsZXMgb25seSBwb3NzaWJsZSB3aXRoIG9uZSBhdHRyaWJ1dGUuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3Igb2JzZXJ2YWJsZS1iaW5kLXRvLW1hbnktbm90LW9uZS1iaW5kaW5nXG5cdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tbWFueS1ub3Qtb25lLWJpbmRpbmcnLCB0aGlzKTtcbiAgICB9XG4gICAgdGhpcy50bygvLyBCaW5kIHRvICNhdHRyaWJ1dGUgb2YgZWFjaCBvYnNlcnZhYmxlLi4uXG4gICAgLi4uZ2V0QmluZGluZ1RhcmdldHMob2JzZXJ2YWJsZXMsIGF0dHJpYnV0ZSksIC8vIC4uLnVzaW5nIGdpdmVuIGNhbGxiYWNrIHRvIHBhcnNlIGF0dHJpYnV0ZSB2YWx1ZXMuXG4gICAgY2FsbGJhY2spO1xufVxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IG9mIGJpbmRpbmcgY29tcG9uZW50cyBmb3JcbiAqIHtAbGluayBPYnNlcnZhYmxlI2JpbmR9IGZyb20gYSBzZXQgb2YgaXRlcmFibGUgb2JzZXJ2YWJsZXMuXG4gKi8gZnVuY3Rpb24gZ2V0QmluZGluZ1RhcmdldHMob2JzZXJ2YWJsZXMsIGF0dHJpYnV0ZSkge1xuICAgIGNvbnN0IG9ic2VydmFibGVBbmRBdHRyaWJ1dGVQYWlycyA9IG9ic2VydmFibGVzLm1hcCgob2JzZXJ2YWJsZSk9PltcbiAgICAgICAgICAgIG9ic2VydmFibGUsXG4gICAgICAgICAgICBhdHRyaWJ1dGVcbiAgICAgICAgXSk7XG4gICAgLy8gTWVyZ2UgcGFpcnMgdG8gb25lLWRpbWVuc2lvbiBhcnJheSBvZiBvYnNlcnZhYmxlcyBhbmQgYXR0cmlidXRlcy5cbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgb2JzZXJ2YWJsZUFuZEF0dHJpYnV0ZVBhaXJzKTtcbn1cbi8qKlxuICogQ2hlY2sgaWYgYWxsIGVudHJpZXMgb2YgdGhlIGFycmF5IGFyZSBvZiBgU3RyaW5nYCB0eXBlLlxuICovIGZ1bmN0aW9uIGlzU3RyaW5nQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIGFyci5ldmVyeSgoYSk9PnR5cGVvZiBhID09ICdzdHJpbmcnKTtcbn1cbi8qKlxuICogUGFyc2VzIGFuZCB2YWxpZGF0ZXMge0BsaW5rIE9ic2VydmFibGUjYmluZH1gLnRvKCBhcmdzIClgIGFyZ3VtZW50cyBhbmQgcmV0dXJuc1xuICogYW4gb2JqZWN0IHdpdGggYSBwYXJzZWQgc3RydWN0dXJlLiBGb3IgZXhhbXBsZVxuICpcbiAqIGBgYHRzXG4gKiBBLmJpbmQoICd4JyApLnRvKCBCLCAnYScsIEMsICdiJywgY2FsbCApO1xuICogYGBgXG4gKlxuICogYmVjb21lc1xuICpcbiAqIGBgYHRzXG4gKiB7XG4gKiBcdHRvOiBbXG4gKiBcdFx0eyBvYnNlcnZhYmxlOiBCLCBwcm9wZXJ0aWVzOiBbICdhJyBdIH0sXG4gKiBcdFx0eyBvYnNlcnZhYmxlOiBDLCBwcm9wZXJ0aWVzOiBbICdiJyBdIH0sXG4gKiBcdF0sXG4gKiBcdGNhbGxiYWNrOiBjYWxsXG4gKiB9XG4gKlxuICogQHBhcmFtIGFyZ3MgQXJndW1lbnRzIG9mIHtAbGluayBPYnNlcnZhYmxlI2JpbmR9YC50byggYXJncyApYC5cbiAqLyBmdW5jdGlvbiBwYXJzZUJpbmRUb0FyZ3MoLi4uYXJncykge1xuICAgIC8vIEVsaW1pbmF0ZSBBLmJpbmQoICd4JyApLnRvKClcbiAgICBpZiAoIWFyZ3MubGVuZ3RoKSB7XG4gICAgICAgIC8qKlxuXHRcdCAqIEludmFsaWQgYXJndW1lbnQgc3ludGF4IGluIGB0bygpYC5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBvYnNlcnZhYmxlLWJpbmQtdG8tcGFyc2UtZXJyb3Jcblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29ic2VydmFibGUtYmluZC10by1wYXJzZS1lcnJvcicsIG51bGwpO1xuICAgIH1cbiAgICBjb25zdCBwYXJzZWQgPSB7XG4gICAgICAgIHRvOiBbXVxuICAgIH07XG4gICAgbGV0IGxhc3RPYnNlcnZhYmxlO1xuICAgIGlmICh0eXBlb2YgYXJnc1thcmdzLmxlbmd0aCAtIDFdID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcGFyc2VkLmNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICB9XG4gICAgYXJncy5mb3JFYWNoKChhKT0+e1xuICAgICAgICBpZiAodHlwZW9mIGEgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGxhc3RPYnNlcnZhYmxlLnByb3BlcnRpZXMucHVzaChhKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgbGFzdE9ic2VydmFibGUgPSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2YWJsZTogYSxcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHBhcnNlZC50by5wdXNoKGxhc3RPYnNlcnZhYmxlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdvYnNlcnZhYmxlLWJpbmQtdG8tcGFyc2UtZXJyb3InLCBudWxsKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBwYXJzZWQ7XG59XG4vKipcbiAqIFN5bmNocm9uaXplcyB7QGxpbmsgbW9kdWxlOnV0aWxzL29ic2VydmFibGUjX2JvdW5kT2JzZXJ2YWJsZXN9IHdpdGgge0BsaW5rIEJpbmRpbmd9LlxuICpcbiAqIEBwYXJhbSBiaW5kaW5nIEEgYmluZGluZyB0byBzdG9yZSBpbiB7QGxpbmsgT2JzZXJ2YWJsZSNfYm91bmRPYnNlcnZhYmxlc30uXG4gKiBAcGFyYW0gdG9PYnNlcnZhYmxlIEEgb2JzZXJ2YWJsZSwgd2hpY2ggaXMgYSBuZXcgY29tcG9uZW50IG9mIGBiaW5kaW5nYC5cbiAqIEBwYXJhbSB0b1Byb3BlcnR5TmFtZSBBIG5hbWUgb2YgYHRvT2JzZXJ2YWJsZWAncyBwcm9wZXJ0eSwgYSBuZXcgY29tcG9uZW50IG9mIHRoZSBgYmluZGluZ2AuXG4gKi8gZnVuY3Rpb24gdXBkYXRlQm91bmRPYnNlcnZhYmxlcyhvYnNlcnZhYmxlLCBiaW5kaW5nLCB0b09ic2VydmFibGUsIHRvUHJvcGVydHlOYW1lKSB7XG4gICAgY29uc3QgYm91bmRPYnNlcnZhYmxlcyA9IG9ic2VydmFibGVbYm91bmRPYnNlcnZhYmxlc1N5bWJvbF07XG4gICAgY29uc3QgYmluZGluZ3NUb09ic2VydmFibGUgPSBib3VuZE9ic2VydmFibGVzLmdldCh0b09ic2VydmFibGUpO1xuICAgIGNvbnN0IGJpbmRpbmdzID0gYmluZGluZ3NUb09ic2VydmFibGUgfHwge307XG4gICAgaWYgKCFiaW5kaW5nc1t0b1Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgYmluZGluZ3NbdG9Qcm9wZXJ0eU5hbWVdID0gbmV3IFNldCgpO1xuICAgIH1cbiAgICAvLyBQYXNzIHRoZSBiaW5kaW5nIHRvIGEgY29ycmVzcG9uZGluZyBTZXQgaW4gYG9ic2VydmFibGUuX2JvdW5kT2JzZXJ2YWJsZXNgLlxuICAgIGJpbmRpbmdzW3RvUHJvcGVydHlOYW1lXS5hZGQoYmluZGluZyk7XG4gICAgaWYgKCFiaW5kaW5nc1RvT2JzZXJ2YWJsZSkge1xuICAgICAgICBib3VuZE9ic2VydmFibGVzLnNldCh0b09ic2VydmFibGUsIGJpbmRpbmdzKTtcbiAgICB9XG59XG4vKipcbiAqIFN5bmNocm9uaXplcyB7QGxpbmsgT2JzZXJ2YWJsZSNfYm91bmRQcm9wZXJ0aWVzfSBhbmQge0BsaW5rIE9ic2VydmFibGUjX2JvdW5kT2JzZXJ2YWJsZXN9XG4gKiB3aXRoIHtAbGluayBCaW5kQ2hhaW59LlxuICpcbiAqIEFzc3VtaW5nIHRoZSBmb2xsb3dpbmcgYmluZGluZyBiZWluZyBjcmVhdGVkXG4gKlxuICogYGBgdHNcbiAqIEEuYmluZCggJ2EnLCAnYicgKS50byggQiwgJ3gnLCAneScgKTtcbiAqIGBgYFxuICpcbiAqIHRoZSBmb2xsb3dpbmcgYmluZGluZ3Mgd2VyZSBpbml0aWFsaXplZCBieSB7QGxpbmsgT2JzZXJ2YWJsZSNiaW5kfSBpbiB7QGxpbmsgQmluZENoYWluI19iaW5kaW5nc306XG4gKlxuICogYGBgdHNcbiAqIHtcbiAqIFx0YTogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2EnLCB0bzogW10gfSxcbiAqIFx0YjogeyBvYnNlcnZhYmxlOiBBLCBwcm9wZXJ0eTogJ2InLCB0bzogW10gfSxcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEl0ZXJhdGUgb3ZlciBhbGwgYmluZGluZ3MgaW4gdGhpcyBjaGFpbiBhbmQgZmlsbCB0aGVpciBgdG9gIHByb3BlcnRpZXMgd2l0aFxuICogY29ycmVzcG9uZGluZyB0byggLi4uICkgYXJndW1lbnRzIChjb21wb25lbnRzIG9mIHRoZSBiaW5kaW5nKSwgc29cbiAqXG4gKiBgYGB0c1xuICoge1xuICogXHRhOiB7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYScsIHRvOiBbIEIsICd4JyBdIH0sXG4gKiBcdGI6IHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdiJywgdG86IFsgQiwgJ3knIF0gfSxcbiAqIH1cbiAqIGBgYFxuICpcbiAqIFRoZW4gdXBkYXRlIHRoZSBzdHJ1Y3R1cmUgb2Yge0BsaW5rIE9ic2VydmFibGUjX2JvdW5kT2JzZXJ2YWJsZXN9IHdpdGggdXBkYXRlZFxuICogYmluZGluZywgc28gaXQgYmVjb21lczpcbiAqXG4gKiBgYGB0c1xuICogTWFwKCB7XG4gKiBcdEI6IHtcbiAqIFx0XHR4OiBTZXQoIFtcbiAqIFx0XHRcdHsgb2JzZXJ2YWJsZTogQSwgcHJvcGVydHk6ICdhJywgdG86IFsgWyBCLCAneCcgXSBdIH1cbiAqIFx0XHRdICksXG4gKiBcdFx0eTogU2V0KCBbXG4gKiBcdFx0XHR7IG9ic2VydmFibGU6IEEsIHByb3BlcnR5OiAnYicsIHRvOiBbIFsgQiwgJ3knIF0gXSB9LFxuICogXHRcdF0gKVxuICogXHR9XG4gKiB9IClcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBjaGFpbiBUaGUgYmluZGluZyBpbml0aWFsaXplZCBieSB7QGxpbmsgT2JzZXJ2YWJsZSNiaW5kfS5cbiAqLyBmdW5jdGlvbiB1cGRhdGVCaW5kVG9Cb3VuZChjaGFpbikge1xuICAgIGxldCB0b1Byb3BlcnR5O1xuICAgIGNoYWluLl9iaW5kaW5ncy5mb3JFYWNoKChiaW5kaW5nLCBwcm9wZXJ0eU5hbWUpPT57XG4gICAgICAgIC8vIE5vdGU6IEZvciBhIGJpbmRpbmcgd2l0aG91dCBhIGNhbGxiYWNrLCB0aGlzIHdpbGwgcnVuIG9ubHkgb25jZVxuICAgICAgICAvLyBsaWtlIGluIEEuYmluZCggJ3gnLCAneScgKS50byggQiwgJ2EnLCAnYicgKVxuICAgICAgICAvLyBUT0RPOiBFUzYgZGVzdHJ1Y3R1cmluZy5cbiAgICAgICAgY2hhaW4uX3RvLmZvckVhY2goKHRvKT0+e1xuICAgICAgICAgICAgdG9Qcm9wZXJ0eSA9IHRvLnByb3BlcnRpZXNbYmluZGluZy5jYWxsYmFjayA/IDAgOiBjaGFpbi5fYmluZFByb3BlcnRpZXMuaW5kZXhPZihwcm9wZXJ0eU5hbWUpXTtcbiAgICAgICAgICAgIGJpbmRpbmcudG8ucHVzaChbXG4gICAgICAgICAgICAgICAgdG8ub2JzZXJ2YWJsZSxcbiAgICAgICAgICAgICAgICB0b1Byb3BlcnR5XG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHVwZGF0ZUJvdW5kT2JzZXJ2YWJsZXMoY2hhaW4uX29ic2VydmFibGUsIGJpbmRpbmcsIHRvLm9ic2VydmFibGUsIHRvUHJvcGVydHkpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbi8qKlxuICogVXBkYXRlcyBhbiBwcm9wZXJ0eSBvZiBhIHtAbGluayBPYnNlcnZhYmxlfSB3aXRoIGEgdmFsdWVcbiAqIGRldGVybWluZWQgYnkgYW4gZW50cnkgaW4ge0BsaW5rIE9ic2VydmFibGUjX2JvdW5kUHJvcGVydGllc30uXG4gKlxuICogQHBhcmFtIG9ic2VydmFibGUgQSBvYnNlcnZhYmxlIHdoaWNoIHByb3BlcnR5IGlzIHRvIGJlIHVwZGF0ZWQuXG4gKiBAcGFyYW0gcHJvcGVydHlOYW1lIEFuIHByb3BlcnR5IHRvIGJlIHVwZGF0ZWQuXG4gKi8gZnVuY3Rpb24gdXBkYXRlQm91bmRPYnNlcnZhYmxlUHJvcGVydHkob2JzZXJ2YWJsZSwgcHJvcGVydHlOYW1lKSB7XG4gICAgY29uc3QgYm91bmRQcm9wZXJ0aWVzID0gb2JzZXJ2YWJsZVtib3VuZFByb3BlcnRpZXNTeW1ib2xdO1xuICAgIGNvbnN0IGJpbmRpbmcgPSBib3VuZFByb3BlcnRpZXMuZ2V0KHByb3BlcnR5TmFtZSk7XG4gICAgbGV0IHByb3BlcnR5VmFsdWU7XG4gICAgLy8gV2hlbiBhIGJpbmRpbmcgd2l0aCBjYWxsYmFjayBpcyBjcmVhdGVkIGxpa2VcbiAgICAvL1xuICAgIC8vIFx0XHRBLmJpbmQoICdhJyApLnRvKCBCLCAnYicsIEMsICdjJywgY2FsbGJhY2sgKTtcbiAgICAvL1xuICAgIC8vIGNvbGxlY3QgQi5iIGFuZCBDLmMsIHRoZW4gcGFzcyB0aGVtIHRvIGNhbGxiYWNrIHRvIHNldCBBLmEuXG4gICAgaWYgKGJpbmRpbmcuY2FsbGJhY2spIHtcbiAgICAgICAgcHJvcGVydHlWYWx1ZSA9IGJpbmRpbmcuY2FsbGJhY2suYXBwbHkob2JzZXJ2YWJsZSwgYmluZGluZy50by5tYXAoKHRvKT0+dG9bMF1bdG9bMV1dKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcHJvcGVydHlWYWx1ZSA9IGJpbmRpbmcudG9bMF07XG4gICAgICAgIHByb3BlcnR5VmFsdWUgPSBwcm9wZXJ0eVZhbHVlWzBdW3Byb3BlcnR5VmFsdWVbMV1dO1xuICAgIH1cbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9ic2VydmFibGUsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgb2JzZXJ2YWJsZVtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydHlWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBvYnNlcnZhYmxlLnNldChwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUpO1xuICAgIH1cbn1cbi8qKlxuICogU3RhcnRzIGxpc3RlbmluZyB0byBjaGFuZ2VzIGluIHtAbGluayBCaW5kQ2hhaW4uX3RvfSBvYnNlcnZhYmxlcyB0byB1cGRhdGVcbiAqIHtAbGluayBCaW5kQ2hhaW4uX29ic2VydmFibGV9IHtAbGluayBCaW5kQ2hhaW4uX2JpbmRQcm9wZXJ0aWVzfS4gQWxzbyBzZXRzIHRoZVxuICogaW5pdGlhbCBzdGF0ZSBvZiB7QGxpbmsgQmluZENoYWluLl9vYnNlcnZhYmxlfS5cbiAqXG4gKiBAcGFyYW0gY2hhaW4gVGhlIGNoYWluIGluaXRpYWxpemVkIGJ5IHtAbGluayBPYnNlcnZhYmxlI2JpbmR9LlxuICovIGZ1bmN0aW9uIGF0dGFjaEJpbmRUb0xpc3RlbmVycyhvYnNlcnZhYmxlLCB0b0JpbmRpbmdzKSB7XG4gICAgdG9CaW5kaW5ncy5mb3JFYWNoKCh0byk9PntcbiAgICAgICAgY29uc3QgYm91bmRPYnNlcnZhYmxlcyA9IG9ic2VydmFibGVbYm91bmRPYnNlcnZhYmxlc1N5bWJvbF07XG4gICAgICAgIGxldCBiaW5kaW5ncztcbiAgICAgICAgLy8gSWYgdGhlcmUncyBhbHJlYWR5IGEgY2hhaW4gYmV0d2VlbiB0aGUgb2JzZXJ2YWJsZXMgKGBvYnNlcnZhYmxlYCBsaXN0ZW5zIHRvXG4gICAgICAgIC8vIGB0by5vYnNlcnZhYmxlYCksIHRoZXJlJ3Mgbm8gbmVlZCB0byBjcmVhdGUgYW5vdGhlciBgY2hhbmdlYCBldmVudCBsaXN0ZW5lci5cbiAgICAgICAgaWYgKCFib3VuZE9ic2VydmFibGVzLmdldCh0by5vYnNlcnZhYmxlKSkge1xuICAgICAgICAgICAgb2JzZXJ2YWJsZS5saXN0ZW5Ubyh0by5vYnNlcnZhYmxlLCAnY2hhbmdlJywgKGV2dCwgcHJvcGVydHlOYW1lKT0+e1xuICAgICAgICAgICAgICAgIGJpbmRpbmdzID0gYm91bmRPYnNlcnZhYmxlcy5nZXQodG8ub2JzZXJ2YWJsZSlbcHJvcGVydHlOYW1lXTtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiB0by5vYnNlcnZhYmxlIHdpbGwgZmlyZSBmb3IgYW55IHByb3BlcnR5IGNoYW5nZSwgcmVhY3RcbiAgICAgICAgICAgICAgICAvLyB0byBjaGFuZ2VzIG9mIHByb3BlcnRpZXMgd2hpY2ggYXJlIGJvdW5kIG9ubHkuXG4gICAgICAgICAgICAgICAgaWYgKGJpbmRpbmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdzLmZvckVhY2goKGJpbmRpbmcpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVCb3VuZE9ic2VydmFibGVQcm9wZXJ0eShvYnNlcnZhYmxlLCBiaW5kaW5nLnByb3BlcnR5KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9lbGVtZW50cmVwbGFjZXJcbiAqLyAvKipcbiAqIFV0aWxpdHkgY2xhc3MgYWxsb3dpbmcgdG8gaGlkZSBleGlzdGluZyBIVE1MIGVsZW1lbnRzIG9yIHJlcGxhY2UgdGhlbSB3aXRoIGdpdmVuIG9uZXMgaW4gYSB3YXkgdGhhdCBkb2Vzbid0IHJlbW92ZVxuICogdGhlIG9yaWdpbmFsIGVsZW1lbnRzIGZyb20gdGhlIERPTS5cbiAqLyBjbGFzcyBFbGVtZW50UmVwbGFjZXIge1xuICAgIC8qKlxuXHQgKiBUaGUgZWxlbWVudHMgcmVwbGFjZWQgYnkge0BsaW5rICNyZXBsYWNlfSBhbmQgdGhlaXIgcmVwbGFjZW1lbnRzLlxuXHQgKi8gX3JlcGxhY2VkRWxlbWVudHM7XG4gICAgY29uc3RydWN0b3IoKXtcbiAgICAgICAgdGhpcy5fcmVwbGFjZWRFbGVtZW50cyA9IFtdO1xuICAgIH1cbiAgICAvKipcblx0ICogSGlkZXMgdGhlIGBlbGVtZW50YCBhbmQsIGlmIHNwZWNpZmllZCwgaW5zZXJ0cyB0aGUgdGhlIGdpdmVuIGVsZW1lbnQgbmV4dCB0byBpdC5cblx0ICpcblx0ICogVGhlIGVmZmVjdCBvZiB0aGlzIG1ldGhvZCBjYW4gYmUgcmV2ZXJ0ZWQgYnkge0BsaW5rICNyZXN0b3JlfS5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gcmVwbGFjZS5cblx0ICogQHBhcmFtIG5ld0VsZW1lbnQgVGhlIHJlcGxhY2VtZW50IGVsZW1lbnQuIElmIG5vdCBwYXNzZWQsIHRoZW4gdGhlIGBlbGVtZW50YCB3aWxsIGp1c3QgYmUgaGlkZGVuLlxuXHQgKi8gcmVwbGFjZShlbGVtZW50LCBuZXdFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX3JlcGxhY2VkRWxlbWVudHMucHVzaCh7XG4gICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgbmV3RWxlbWVudFxuICAgICAgICB9KTtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBpZiAobmV3RWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdFbGVtZW50LCBlbGVtZW50Lm5leHRTaWJsaW5nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVzdG9yZXMgd2hhdCB7QGxpbmsgI3JlcGxhY2V9IGRpZC5cblx0ICovIHJlc3RvcmUoKSB7XG4gICAgICAgIHRoaXMuX3JlcGxhY2VkRWxlbWVudHMuZm9yRWFjaCgoeyBlbGVtZW50LCBuZXdFbGVtZW50IH0pPT57XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAgICAgICAgIGlmIChuZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3JlcGxhY2VkRWxlbWVudHMgPSBbXTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvYWJvcnRhYmxlZGVib3VuY2VcbiAqLyAvKipcbiAqIFJldHVybnMgYSBmdW5jdGlvbiB3cmFwcGVyIHRoYXQgd2lsbCBleGVjdXRlIHRoZSBwcm92aWRlZCBmdW5jdGlvbiBhbmQgYWJvcnQgYW55IHByZXZpb3VzIGNhbGwgdGhhdCBpcyBzdGlsbCBpbiBwcm9ncmVzcy5cbiAqXG4gKiBAcGFyYW0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkLiBJdCB3aWxsIGJlIHByb3ZpZGVkIHdpdGggYEFib3J0U2lnbmFsYCBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyLlxuICovIGZ1bmN0aW9uIGFib3J0YWJsZURlYm91bmNlKGZ1bmMpIHtcbiAgICBsZXQgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICBmdW5jdGlvbiBhYm9ydGFibGUoLi4uYXJncykge1xuICAgICAgICBjb250cm9sbGVyLmFib3J0KCk7XG4gICAgICAgIGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgIHJldHVybiBmdW5jKGNvbnRyb2xsZXIuc2lnbmFsLCAuLi5hcmdzKTtcbiAgICB9XG4gICAgYWJvcnRhYmxlLmFib3J0ID0gKCk9PmNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICByZXR1cm4gYWJvcnRhYmxlO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2NvdW50XG4gKi8gLyoqXG4gKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgaXRlbXMgcmV0dXJuIGJ5IHRoZSBpdGVyYXRvci5cbiAqXG4gKiBgYGB0c1xuICogY291bnQoIFsgMSwgMiwgMywgNCwgNSBdICk7IC8vIDU7XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gaXRlcmFibGUgQW55IGl0ZXJhYmxlLlxuICogQHJldHVybnMgTnVtYmVyIG9mIGl0ZW1zIHJldHVybmVkIGJ5IHRoYXQgaXRlcmFibGUuXG4gKi8gZnVuY3Rpb24gY291bnQoaXRlcmFibGUpIHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBmb3IgKGNvbnN0IF8gb2YgaXRlcmFibGUpe1xuICAgICAgICBjb3VudCsrO1xuICAgIH1cbiAgICByZXR1cm4gY291bnQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvY29tcGFyZWFycmF5c1xuICovIC8qKlxuICogQ29tcGFyZXMgaG93IGdpdmVuIGFycmF5cyByZWxhdGUgdG8gZWFjaCBvdGhlci4gT25lIGFycmF5IGNhbiBiZTogc2FtZSBhcyBhbm90aGVyIGFycmF5LCBwcmVmaXggb2YgYW5vdGhlciBhcnJheVxuICogb3IgY29tcGxldGVseSBkaWZmZXJlbnQuIElmIGFycmF5cyBhcmUgZGlmZmVyZW50LCBmaXJzdCBpbmRleCBhdCB3aGljaCB0aGV5IGRpZmZlciBpcyByZXR1cm5lZC4gT3RoZXJ3aXNlLFxuICogYSBmbGFnIHNwZWNpZnlpbmcgdGhlIHJlbGF0aW9uIGlzIHJldHVybmVkLiBGbGFncyBhcmUgbmVnYXRpdmUgbnVtYmVycywgc28gd2hlbmV2ZXIgYSBudW1iZXIgPj0gMCBpcyByZXR1cm5lZFxuICogaXQgbWVhbnMgdGhhdCBhcnJheXMgZGlmZmVyLlxuICpcbiAqIGBgYHRzXG4gKiBjb21wYXJlQXJyYXlzKCBbIDAsIDIgXSwgWyAwLCAyIF0gKTtcdFx0Ly8gJ3NhbWUnXG4gKiBjb21wYXJlQXJyYXlzKCBbIDAsIDIgXSwgWyAwLCAyLCAxIF0gKTtcdFx0Ly8gJ3ByZWZpeCdcbiAqIGNvbXBhcmVBcnJheXMoIFsgMCwgMiBdLCBbIDAgXSApO1x0XHRcdC8vICdleHRlbnNpb24nXG4gKiBjb21wYXJlQXJyYXlzKCBbIDAsIDIgXSwgWyAxLCAyIF0gKTtcdFx0Ly8gMFxuICogY29tcGFyZUFycmF5cyggWyAwLCAyIF0sIFsgMCwgMSBdICk7XHRcdC8vIDFcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBhIEFycmF5IHRoYXQgaXMgY29tcGFyZWQuXG4gKiBAcGFyYW0gYiBBcnJheSB0byBjb21wYXJlIHdpdGguXG4gKiBAcmV0dXJucyBIb3cgYXJyYXkgYGFgIGlzIHJlbGF0ZWQgdG8gYGJgLlxuICovIGZ1bmN0aW9uIGNvbXBhcmVBcnJheXMoYSwgYikge1xuICAgIGNvbnN0IG1pbkxlbiA9IE1hdGgubWluKGEubGVuZ3RoLCBiLmxlbmd0aCk7XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IG1pbkxlbjsgaSsrKXtcbiAgICAgICAgaWYgKGFbaV0gIT0gYltpXSkge1xuICAgICAgICAgICAgLy8gVGhlIGFycmF5cyBhcmUgZGlmZmVyZW50LlxuICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQm90aCBhcnJheXMgd2VyZSBzYW1lIGF0IGFsbCBwb2ludHMuXG4gICAgaWYgKGEubGVuZ3RoID09IGIubGVuZ3RoKSB7XG4gICAgICAgIC8vIElmIHRoZWlyIGxlbmd0aCBpcyBhbHNvIHNhbWUsIHRoZXkgYXJlIHRoZSBzYW1lLlxuICAgICAgICByZXR1cm4gJ3NhbWUnO1xuICAgIH0gZWxzZSBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkge1xuICAgICAgICAvLyBDb21wYXJlZCBhcnJheSBpcyBzaG9ydGVyIHNvIGl0IGlzIGEgcHJlZml4IG9mIHRoZSBvdGhlciBhcnJheS5cbiAgICAgICAgcmV0dXJuICdwcmVmaXgnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENvbXBhcmVkIGFycmF5IGlzIGxvbmdlciBzbyBpdCBpcyBhbiBleHRlbnNpb24gb2YgdGhlIG90aGVyIGFycmF5LlxuICAgICAgICByZXR1cm4gJ2V4dGVuc2lvbic7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2lzaXRlcmFibGVcbiAqLyAvKipcbiAqIENoZWNrcyBpZiB2YWx1ZSBpbXBsZW1lbnRzIGl0ZXJhdG9yIGludGVyZmFjZS5cbiAqXG4gKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMgVHJ1ZSBpZiB2YWx1ZSBpbXBsZW1lbnRzIGl0ZXJhdG9yIGludGVyZmFjZS5cbiAqLyBmdW5jdGlvbiBpc0l0ZXJhYmxlKHZhbHVlKSB7XG4gICAgcmV0dXJuICEhKHZhbHVlICYmIHZhbHVlW1N5bWJvbC5pdGVyYXRvcl0pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gSFRNTCBvciBTVkcgZWxlbWVudCB3aXRoIGF0dHJpYnV0ZXMgYW5kIGNoaWxkcmVuIGVsZW1lbnRzLlxuICpcbiAqIGBgYHRzXG4gKiBjcmVhdGVFbGVtZW50KCBkb2N1bWVudCwgJ3AnICk7IC8vIDxwPlxuICogY3JlYXRlRWxlbWVudCggZG9jdW1lbnQsICdtYXNrJywgeyB4bWxuczogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB9ICk7IC8vIDxtYXNrPlxuICogYGBgXG4gKlxuICogQHBhcmFtIGRvYyBEb2N1bWVudCB1c2VkIHRvIGNyZWF0ZSB0aGUgZWxlbWVudC5cbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGVsZW1lbnQuXG4gKiBAcGFyYW0gYXR0cmlidXRlcyBPYmplY3Qgd2hlcmUga2V5cyByZXByZXNlbnQgYXR0cmlidXRlIGtleXMgYW5kIHZhbHVlcyByZXByZXNlbnQgYXR0cmlidXRlIHZhbHVlcy5cbiAqIEBwYXJhbSBjaGlsZHJlbiBDaGlsZCBvciBhbnkgaXRlcmFibGUgb2YgY2hpbGRyZW4uIFN0cmluZ3Mgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHR1cm5lZCBpbnRvIFRleHQgbm9kZXMuXG4gKiBAcmV0dXJucyBIVE1MIG9yIFNWRyBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQoZG9jLCBuYW1lLCBhdHRyaWJ1dGVzID0ge30sIGNoaWxkcmVuID0gW10pIHtcbiAgICBjb25zdCBuYW1lc3BhY2UgPSBhdHRyaWJ1dGVzICYmIGF0dHJpYnV0ZXMueG1sbnM7XG4gICAgY29uc3QgZWxlbWVudCA9IG5hbWVzcGFjZSA/IGRvYy5jcmVhdGVFbGVtZW50TlMobmFtZXNwYWNlLCBuYW1lKSA6IGRvYy5jcmVhdGVFbGVtZW50KG5hbWUpO1xuICAgIGZvcihjb25zdCBrZXkgaW4gYXR0cmlidXRlcyl7XG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGtleSwgYXR0cmlidXRlc1trZXldKTtcbiAgICB9XG4gICAgaWYgKGlzU3RyaW5nKGNoaWxkcmVuKSB8fCAhaXNJdGVyYWJsZShjaGlsZHJlbikpIHtcbiAgICAgICAgY2hpbGRyZW4gPSBbXG4gICAgICAgICAgICBjaGlsZHJlblxuICAgICAgICBdO1xuICAgIH1cbiAgICBmb3IgKGxldCBjaGlsZCBvZiBjaGlsZHJlbil7XG4gICAgICAgIGlmIChpc1N0cmluZyhjaGlsZCkpIHtcbiAgICAgICAgICAgIGNoaWxkID0gZG9jLmNyZWF0ZVRleHROb2RlKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG59XG5cbi8qKlxuICogSGFuZGxlcyBhIGNvbmZpZ3VyYXRpb24gZGljdGlvbmFyeS5cbiAqXG4gKiBAdHlwZVBhcmFtIENmZyBBIHR5cGUgb2YgdGhlIGNvbmZpZ3VyYXRpb24gZGljdGlvbmFyeS5cbiAqLyBjbGFzcyBDb25maWcge1xuICAgIC8qKlxuXHQgKiBTdG9yZSBmb3IgdGhlIHdob2xlIGNvbmZpZ3VyYXRpb24uXG5cdCAqLyBfY29uZmlnO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgfkNvbmZpZ30gY2xhc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25maWd1cmF0aW9ucyBUaGUgaW5pdGlhbCBjb25maWd1cmF0aW9ucyB0byBiZSBzZXQuIFVzdWFsbHksIHByb3ZpZGVkIGJ5IHRoZSB1c2VyLlxuXHQgKiBAcGFyYW0gZGVmYXVsdENvbmZpZ3VyYXRpb25zIFRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb25zLiBVc3VhbGx5LCBwcm92aWRlZCBieSB0aGUgc3lzdGVtLlxuXHQgKi8gY29uc3RydWN0b3IoY29uZmlndXJhdGlvbnMsIGRlZmF1bHRDb25maWd1cmF0aW9ucyl7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIC8vIFNldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb24uXG4gICAgICAgIGlmIChkZWZhdWx0Q29uZmlndXJhdGlvbnMpIHtcbiAgICAgICAgICAgIC8vIENsb25lIHRoZSBjb25maWd1cmF0aW9uIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBwcm9wZXJ0aWVzIHdpbGwgbm90IGJlIHNoYXJlZFxuICAgICAgICAgICAgLy8gYmV0d2VlbiBlZGl0b3JzIGFuZCBtYWtlIHRoZSB3YXRjaGRvZyBmZWF0dXJlIHdvcmsgY29ycmVjdGx5LlxuICAgICAgICAgICAgdGhpcy5kZWZpbmUoY2xvbmVDb25maWcoZGVmYXVsdENvbmZpZ3VyYXRpb25zKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0IGluaXRpYWwgY29uZmlndXJhdGlvbi5cbiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRPYmplY3RUb1RhcmdldCh0aGlzLl9jb25maWcsIGNvbmZpZ3VyYXRpb25zKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXQobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc2V0VG9UYXJnZXQodGhpcy5fY29uZmlnLCBuYW1lLCB2YWx1ZSk7XG4gICAgfVxuICAgIGRlZmluZShuYW1lLCB2YWx1ZSkge1xuICAgICAgICBjb25zdCBpc0RlZmluZSA9IHRydWU7XG4gICAgICAgIHRoaXMuX3NldFRvVGFyZ2V0KHRoaXMuX2NvbmZpZywgbmFtZSwgdmFsdWUsIGlzRGVmaW5lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIHZhbHVlIGZvciBhIGNvbmZpZ3VyYXRpb24gZW50cnkuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbmZpZy5nZXQoICduYW1lJyApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogRGVlcCBjb25maWd1cmF0aW9ucyBjYW4gYmUgcmV0cmlldmVkIGJ5IHNlcGFyYXRpbmcgZWFjaCBwYXJ0IHdpdGggYSBkb3QuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbmZpZy5nZXQoICd0b29sYmFyLmNvbGxhcHNlZCcgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIFRoZSBjb25maWd1cmF0aW9uIG5hbWUuIENvbmZpZ3VyYXRpb24gbmFtZXMgYXJlIGNhc2Utc2Vuc2l0aXZlLlxuXHQgKiBAcmV0dXJucyBUaGUgY29uZmlndXJhdGlvbiB2YWx1ZSBvciBgdW5kZWZpbmVkYCBpZiB0aGUgY29uZmlndXJhdGlvbiBlbnRyeSB3YXMgbm90IGZvdW5kLlxuXHQgKi8gZ2V0KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEZyb21Tb3VyY2UodGhpcy5fY29uZmlnLCBuYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgYWxsIHRvcCBsZXZlbCBjb25maWd1cmF0aW9uIG5hbWVzLlxuXHQgKi8gKm5hbWVzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmtleXModGhpcy5fY29uZmlnKSl7XG4gICAgICAgICAgICB5aWVsZCBuYW1lO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTYXZlcyBwYXNzZWQgY29uZmlndXJhdGlvbiB0byB0aGUgc3BlY2lmaWVkIHRhcmdldCAobmVzdGVkIG9iamVjdCkuXG5cdCAqXG5cdCAqIEBwYXJhbSB0YXJnZXQgTmVzdGVkIGNvbmZpZyBvYmplY3QuXG5cdCAqIEBwYXJhbSBuYW1lIFRoZSBjb25maWd1cmF0aW9uIG5hbWUgb3IgYW4gb2JqZWN0IGZyb20gd2hpY2ggdGFrZSBwcm9wZXJ0aWVzIGFzXG5cdCAqIGNvbmZpZ3VyYXRpb24gZW50cmllcy4gQ29uZmlndXJhdGlvbiBuYW1lcyBhcmUgY2FzZS1zZW5zaXRpdmUuXG5cdCAqIEBwYXJhbSB2YWx1ZSBUaGUgY29uZmlndXJhdGlvbiB2YWx1ZS4gVXNlZCBpZiBhIG5hbWUgaXMgcGFzc2VkLlxuXHQgKiBAcGFyYW0gaXNEZWZpbmUgRGVmaW5lIGlmIHBhc3NlZCBjb25maWd1cmF0aW9uIHNob3VsZCBvdmVyd3JpdGUgZXhpc3Rpbmcgb25lLlxuXHQgKi8gX3NldFRvVGFyZ2V0KHRhcmdldCwgbmFtZSwgdmFsdWUsIGlzRGVmaW5lID0gZmFsc2UpIHtcbiAgICAgICAgLy8gSW4gY2FzZSBvZiBhbiBvYmplY3QsIGl0ZXJhdGUgdGhyb3VnaCBpdCBhbmQgY2FsbCBgX3NldFRvVGFyZ2V0YCBhZ2FpbiBmb3IgZWFjaCBwcm9wZXJ0eS5cbiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QobmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldE9iamVjdFRvVGFyZ2V0KHRhcmdldCwgbmFtZSwgaXNEZWZpbmUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBjb25maWd1cmF0aW9uIG5hbWUgc2hvdWxkIGJlIHNwbGl0IGludG8gcGFydHMgaWYgaXQgaGFzIGRvdHMuIEUuZy4gYHJlc2l6ZS53aWR0aGAgLT4gW2ByZXNpemVgLCBgd2lkdGhgXS5cbiAgICAgICAgY29uc3QgcGFydHMgPSBuYW1lLnNwbGl0KCcuJyk7XG4gICAgICAgIC8vIFRha2UgdGhlIG5hbWUgb2YgdGhlIGNvbmZpZ3VyYXRpb24gb3V0IG9mIHRoZSBwYXJ0cy4gRS5nLiBgcmVzaXplLndpZHRoYCAtPiBgd2lkdGhgLlxuICAgICAgICBuYW1lID0gcGFydHMucG9wKCk7XG4gICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBwYXJ0cyB0byBjaGVjayBpZiBjdXJyZW50bHkgc3RvcmVkIGNvbmZpZ3VyYXRpb24gaGFzIHByb3BlciBzdHJ1Y3R1cmUuXG4gICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cyl7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBvYmplY3QgZm9yIHNwZWNpZmllZCBwYXJ0IHRoZW4gY3JlYXRlIG9uZS5cbiAgICAgICAgICAgIGlmICghaXNQbGFpbk9iamVjdCh0YXJnZXRbcGFydF0pKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0W3BhcnRdID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5lc3RlZCBvYmplY3QgYmVjb21lcyBhIHRhcmdldC5cbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldFtwYXJ0XTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbiBjYXNlIG9mIHZhbHVlIGlzIGFuIG9iamVjdC5cbiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgICAvLyBXZSB0YWtlIGNhcmUgb2YgcHJvcGVyIGNvbmZpZyBzdHJ1Y3R1cmUuXG4gICAgICAgICAgICBpZiAoIWlzUGxhaW5PYmplY3QodGFyZ2V0W25hbWVdKSkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtuYW1lXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbbmFtZV07XG4gICAgICAgICAgICAvLyBBbmQgaXRlcmF0ZSB0aHJvdWdoIHRoaXMgb2JqZWN0IGNhbGxpbmcgYF9zZXRUb1RhcmdldGAgYWdhaW4gZm9yIGVhY2ggcHJvcGVydHkuXG4gICAgICAgICAgICB0aGlzLl9zZXRPYmplY3RUb1RhcmdldCh0YXJnZXQsIHZhbHVlLCBpc0RlZmluZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRG8gbm90aGluZyBpZiB3ZSBhcmUgZGVmaW5pbmcgY29uZmlndXJhdGlvbiBmb3Igbm9uIGVtcHR5IG5hbWUuXG4gICAgICAgIGlmIChpc0RlZmluZSAmJiB0eXBlb2YgdGFyZ2V0W25hbWVdICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0W25hbWVdID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXQgc3BlY2lmaWVkIGNvbmZpZ3VyYXRpb24gZnJvbSBzcGVjaWZpZWQgc291cmNlIChuZXN0ZWQgb2JqZWN0KS5cblx0ICpcblx0ICogQHBhcmFtIHNvdXJjZSBsZXZlbCBvZiBuZXN0ZWQgb2JqZWN0LlxuXHQgKiBAcGFyYW0gbmFtZSBUaGUgY29uZmlndXJhdGlvbiBuYW1lLiBDb25maWd1cmF0aW9uIG5hbWVzIGFyZSBjYXNlLXNlbnNpdGl2ZS5cblx0ICogQHJldHVybnMgVGhlIGNvbmZpZ3VyYXRpb24gdmFsdWUgb3IgYHVuZGVmaW5lZGAgaWYgdGhlIGNvbmZpZ3VyYXRpb24gZW50cnkgd2FzIG5vdCBmb3VuZC5cblx0ICovIF9nZXRGcm9tU291cmNlKHNvdXJjZSwgbmFtZSkge1xuICAgICAgICAvLyBUaGUgY29uZmlndXJhdGlvbiBuYW1lIHNob3VsZCBiZSBzcGxpdCBpbnRvIHBhcnRzIGlmIGl0IGhhcyBkb3RzLiBFLmcuIGByZXNpemUud2lkdGhgIC0+IFtgcmVzaXplYCwgYHdpZHRoYF0uXG4gICAgICAgIGNvbnN0IHBhcnRzID0gbmFtZS5zcGxpdCgnLicpO1xuICAgICAgICAvLyBUYWtlIHRoZSBuYW1lIG9mIHRoZSBjb25maWd1cmF0aW9uIG91dCBvZiB0aGUgcGFydHMuIEUuZy4gYHJlc2l6ZS53aWR0aGAgLT4gYHdpZHRoYC5cbiAgICAgICAgbmFtZSA9IHBhcnRzLnBvcCgpO1xuICAgICAgICAvLyBJdGVyYXRlIG92ZXIgcGFydHMgdG8gY2hlY2sgaWYgY3VycmVudGx5IHN0b3JlZCBjb25maWd1cmF0aW9uIGhhcyBwcm9wZXIgc3RydWN0dXJlLlxuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpe1xuICAgICAgICAgICAgaWYgKCFpc1BsYWluT2JqZWN0KHNvdXJjZVtwYXJ0XSkpIHtcbiAgICAgICAgICAgICAgICBzb3VyY2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTmVzdGVkIG9iamVjdCBiZWNvbWVzIGEgc291cmNlLlxuICAgICAgICAgICAgc291cmNlID0gc291cmNlW3BhcnRdO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsd2F5cyByZXR1cm5zIHVuZGVmaW5lZCBmb3Igbm9uIGV4aXN0aW5nIGNvbmZpZ3VyYXRpb24uXG4gICAgICAgIHJldHVybiBzb3VyY2UgPyBjbG9uZUNvbmZpZyhzb3VyY2VbbmFtZV0pIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmF0ZXMgdGhyb3VnaCBwYXNzZWQgb2JqZWN0IGFuZCBjYWxscyB7QGxpbmsgI19zZXRUb1RhcmdldH0gbWV0aG9kIHdpdGggb2JqZWN0IGtleSBhbmQgdmFsdWUgZm9yIGVhY2ggcHJvcGVydHkuXG5cdCAqXG5cdCAqIEBwYXJhbSB0YXJnZXQgTmVzdGVkIGNvbmZpZyBvYmplY3QuXG5cdCAqIEBwYXJhbSBjb25maWd1cmF0aW9uIENvbmZpZ3VyYXRpb24gZGF0YSBzZXRcblx0ICogQHBhcmFtIGlzRGVmaW5lIERlZmluZXMgaWYgcGFzc2VkIGNvbmZpZ3VyYXRpb24gaXMgZGVmYXVsdCBjb25maWd1cmF0aW9uIG9yIG5vdC5cblx0ICovIF9zZXRPYmplY3RUb1RhcmdldCh0YXJnZXQsIGNvbmZpZ3VyYXRpb24sIGlzRGVmaW5lKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGNvbmZpZ3VyYXRpb24pLmZvckVhY2goKGtleSk9PntcbiAgICAgICAgICAgIHRoaXMuX3NldFRvVGFyZ2V0KHRhcmdldCwga2V5LCBjb25maWd1cmF0aW9uW2tleV0sIGlzRGVmaW5lKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBDbG9uZXMgY29uZmlndXJhdGlvbiBvYmplY3Qgb3IgdmFsdWUuXG4gKi8gZnVuY3Rpb24gY2xvbmVDb25maWcoc291cmNlKSB7XG4gICAgcmV0dXJuIGNsb25lRGVlcFdpdGgoc291cmNlLCBsZWF2ZUl0ZW1SZWZlcmVuY2VzKTtcbn1cbi8qKlxuICogQSBjdXN0b21pemVkIGZ1bmN0aW9uIGZvciBjbG9uZURlZXBXaXRoLlxuICogSW4gY2FzZSBpZiBpdCdzIGEgRE9NIEVsZW1lbnQgaXQgd2lsbCBsZWF2ZSByZWZlcmVuY2VzIHRvIERPTSBFbGVtZW50cyBpbnN0ZWFkIG9mIGNsb25pbmcgdGhlbS5cbiAqIElmIGl0J3MgYSBmdW5jdGlvbiBpdCB3aWxsIGxlYXZlIHJlZmVyZW5jZSB0byBhY3R1YWxsIGZ1bmN0aW9uLlxuICovIGZ1bmN0aW9uIGxlYXZlSXRlbVJlZmVyZW5jZXModmFsdWUpIHtcbiAgICByZXR1cm4gaXNFbGVtZW50JDEodmFsdWUpIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/IHZhbHVlIDogdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS9pc25vZGVcbiAqLyAvKipcbiAqIENoZWNrcyBpZiB0aGUgb2JqZWN0IGlzIGEgbmF0aXZlIERPTSBOb2RlLlxuICovIGZ1bmN0aW9uIGlzTm9kZShvYmopIHtcbiAgICBpZiAob2JqKSB7XG4gICAgICAgIGlmIChvYmouZGVmYXVsdFZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBvYmouZGVmYXVsdFZpZXcuRG9jdW1lbnQ7XG4gICAgICAgIH0gZWxzZSBpZiAob2JqLm93bmVyRG9jdW1lbnQgJiYgb2JqLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBvYmoub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5Ob2RlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9kb20vaXN3aW5kb3dcbiAqLyAvKipcbiAqIENoZWNrcyBpZiB0aGUgb2JqZWN0IGlzIGEgbmF0aXZlIERPTSBXaW5kb3cuXG4gKi8gZnVuY3Rpb24gaXNXaW5kb3cob2JqKSB7XG4gICAgY29uc3Qgc3RyaW5naWZpZWRPYmplY3QgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KG9iaik7XG4gICAgLy8gUmV0dXJucyBgdHJ1ZWAgZm9yIHRoZSBgd2luZG93YCBvYmplY3QgaW4gYnJvd3NlciBlbnZpcm9ubWVudHMuXG4gICAgaWYgKHN0cmluZ2lmaWVkT2JqZWN0ID09ICdbb2JqZWN0IFdpbmRvd10nKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGB0cnVlYCBmb3IgdGhlIGB3aW5kb3dgIG9iamVjdCBpbiB0aGUgRWxlY3Ryb24gZW52aXJvbm1lbnQuXG4gICAgaWYgKHN0cmluZ2lmaWVkT2JqZWN0ID09ICdbb2JqZWN0IGdsb2JhbF0nKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmNvbnN0IGRlZmF1bHRFbWl0dGVyQ2xhc3MgPSAvKiAjX19QVVJFX18gKi8gRG9tRW1pdHRlck1peGluKC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSk7XG5mdW5jdGlvbiBEb21FbWl0dGVyTWl4aW4oYmFzZSkge1xuICAgIGlmICghYmFzZSkge1xuICAgICAgICByZXR1cm4gZGVmYXVsdEVtaXR0ZXJDbGFzcztcbiAgICB9XG4gICAgY2xhc3MgTWl4aW4gZXh0ZW5kcyBiYXNlIHtcbiAgICAgICAgbGlzdGVuVG8oZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGVtaXR0ZXIgaXMgYW4gaW5zdGFuY2Ugb2YgRE9NIE5vZGUuIElmIHNvLCB1c2UgY29ycmVzcG9uZGluZyBQcm94eUVtaXR0ZXIgKG9yIGNyZWF0ZSBvbmUgaWYgbm90IGV4aXN0aW5nKS5cbiAgICAgICAgICAgIGlmIChpc05vZGUoZW1pdHRlcikgfHwgaXNXaW5kb3coZW1pdHRlcikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm94eU9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNhcHR1cmU6ICEhb3B0aW9ucy51c2VDYXB0dXJlLFxuICAgICAgICAgICAgICAgICAgICBwYXNzaXZlOiAhIW9wdGlvbnMudXNlUGFzc2l2ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY29uc3QgcHJveHlFbWl0dGVyID0gdGhpcy5fZ2V0UHJveHlFbWl0dGVyKGVtaXR0ZXIsIHByb3h5T3B0aW9ucykgfHwgbmV3IFByb3h5RW1pdHRlcihlbWl0dGVyLCBwcm94eU9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8ocHJveHlFbWl0dGVyLCBldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHBhcmVudCBjbGFzcyBtZXRob2Qgd2l0aCBFbWl0dGVyIChvciBQcm94eUVtaXR0ZXIpIGluc3RhbmNlLlxuICAgICAgICAgICAgICAgIHN1cGVyLmxpc3RlblRvKGVtaXR0ZXIsIGV2ZW50LCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RvcExpc3RlbmluZyhlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBlbWl0dGVyIGlzIGFuIGluc3RhbmNlIG9mIERPTSBOb2RlLiBJZiBzbywgZm9yd2FyZCB0aGUgY2FsbCB0byB0aGUgY29ycmVzcG9uZGluZyBQcm94eUVtaXR0ZXJzLlxuICAgICAgICAgICAgaWYgKGlzTm9kZShlbWl0dGVyKSB8fCBpc1dpbmRvdyhlbWl0dGVyKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3h5RW1pdHRlcnMgPSB0aGlzLl9nZXRBbGxQcm94eUVtaXR0ZXJzKGVtaXR0ZXIpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJveHkgb2YgcHJveHlFbWl0dGVycyl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcExpc3RlbmluZyhwcm94eSwgZXZlbnQsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgcGFyZW50IGNsYXNzIG1ldGhvZCB3aXRoIEVtaXR0ZXIgKG9yIFByb3h5RW1pdHRlcikgaW5zdGFuY2UuXG4gICAgICAgICAgICAgICAgc3VwZXIuc3RvcExpc3RlbmluZyhlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qKlxuXHRcdCAqIFJldHJpZXZlcyBQcm94eUVtaXR0ZXIgaW5zdGFuY2UgZm9yIGdpdmVuIERPTSBOb2RlIHJlc2lkaW5nIGluIHRoaXMgSG9zdCBhbmQgZ2l2ZW4gb3B0aW9ucy5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBub2RlIERPTSBOb2RlIG9mIHRoZSBQcm94eUVtaXR0ZXIuXG5cdFx0ICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBvcHRpb25zLlxuXHRcdCAqIEBwYXJhbSBvcHRpb25zLnVzZUNhcHR1cmUgSW5kaWNhdGVzIHRoYXQgZXZlbnRzIG9mIHRoaXMgdHlwZSB3aWxsIGJlIGRpc3BhdGNoZWQgdG8gdGhlIHJlZ2lzdGVyZWRcblx0XHQgKiBsaXN0ZW5lciBiZWZvcmUgYmVpbmcgZGlzcGF0Y2hlZCB0byBhbnkgRXZlbnRUYXJnZXQgYmVuZWF0aCBpdCBpbiB0aGUgRE9NIHRyZWUuXG5cdFx0ICogQHBhcmFtIG9wdGlvbnMudXNlUGFzc2l2ZSBJbmRpY2F0ZXMgdGhhdCB0aGUgZnVuY3Rpb24gc3BlY2lmaWVkIGJ5IGxpc3RlbmVyIHdpbGwgbmV2ZXIgY2FsbCBwcmV2ZW50RGVmYXVsdCgpXG5cdFx0ICogYW5kIHByZXZlbnRzIGJsb2NraW5nIGJyb3dzZXIncyBtYWluIHRocmVhZCBieSB0aGlzIGV2ZW50IGhhbmRsZXIuXG5cdFx0ICogQHJldHVybnMgUHJveHlFbWl0dGVyIGluc3RhbmNlIGJvdW5kIHRvIHRoZSBET00gTm9kZS5cblx0XHQgKi8gX2dldFByb3h5RW1pdHRlcihub2RlLCBvcHRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gX2dldEVtaXR0ZXJMaXN0ZW5lZFRvKHRoaXMsIGdldFByb3h5RW1pdHRlcklkKG5vZGUsIG9wdGlvbnMpKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcblx0XHQgKiBSZXRyaWV2ZXMgYWxsIHRoZSBQcm94eUVtaXR0ZXIgaW5zdGFuY2VzIGZvciBnaXZlbiBET00gTm9kZSByZXNpZGluZyBpbiB0aGlzIEhvc3QuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gbm9kZSBET00gTm9kZSBvZiB0aGUgUHJveHlFbWl0dGVyLlxuXHRcdCAqLyBfZ2V0QWxsUHJveHlFbWl0dGVycyhub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY2FwdHVyZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHBhc3NpdmU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNhcHR1cmU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwYXNzaXZlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNhcHR1cmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBhc3NpdmU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNhcHR1cmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBhc3NpdmU6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLm1hcCgob3B0aW9ucyk9PnRoaXMuX2dldFByb3h5RW1pdHRlcihub2RlLCBvcHRpb25zKSkuZmlsdGVyKChwcm94eSk9PiEhcHJveHkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBNaXhpbjtcbn1cbi8vIEJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCBgbWl4YFxuW1xuICAgICdfZ2V0UHJveHlFbWl0dGVyJyxcbiAgICAnX2dldEFsbFByb3h5RW1pdHRlcnMnLFxuICAgICdvbicsXG4gICAgJ29uY2UnLFxuICAgICdvZmYnLFxuICAgICdsaXN0ZW5UbycsXG4gICAgJ3N0b3BMaXN0ZW5pbmcnLFxuICAgICdmaXJlJyxcbiAgICAnZGVsZWdhdGUnLFxuICAgICdzdG9wRGVsZWdhdGluZycsXG4gICAgJ19hZGRFdmVudExpc3RlbmVyJyxcbiAgICAnX3JlbW92ZUV2ZW50TGlzdGVuZXInXG5dLmZvckVhY2goKGtleSk9PntcbiAgICBEb21FbWl0dGVyTWl4aW5ba2V5XSA9IGRlZmF1bHRFbWl0dGVyQ2xhc3MucHJvdG90eXBlW2tleV07XG59KTtcbi8qKlxuICogQ3JlYXRlcyBhIFByb3h5RW1pdHRlciBpbnN0YW5jZS4gU3VjaCBhbiBpbnN0YW5jZSBpcyBhIGJyaWRnZSBiZXR3ZWVuIGEgRE9NIE5vZGUgZmlyaW5nIGV2ZW50c1xuICogYW5kIGFueSBIb3N0IGxpc3RlbmluZyB0byB0aGVtLiBJdCBpcyBiYWNrd2FyZHMgY29tcGF0aWJsZSB3aXRoIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXIjb259LlxuICogVGhlcmUgaXMgYSBzZXBhcmF0ZSBpbnN0YW5jZSBmb3IgZWFjaCBjb21iaW5hdGlvbiBvZiBtb2RlcyAodXNlQ2FwdHVyZSAmIHVzZVBhc3NpdmUpLiBUaGUgbW9kZSBpcyBjb25jYXRlbmF0ZWQgd2l0aFxuICogVUlEIHN0b3JlZCBpbiBIVE1MRWxlbWVudCB0byBnaXZlIGVhY2ggaW5zdGFuY2UgdW5pcXVlIGlkZW50aWZpZXIuXG4gKlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuVG8oIGNsaWNrLCAuLi4gKVxuICogICAgICAgICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICBzdG9wTGlzdGVuaW5nKCAuLi4gKSAgICAgICB8XG4gKiAgICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICBhZGRFdmVudExpc3RlbmVyKCBjbGljaywgLi4uIClcbiAqICAgICB8IEhvc3QgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgfCAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKCBjbGljaywgLi4uICkgICAgIHxcbiAqICAgICB8IF9saXN0ZW5pbmdUbzogeyAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS12LS0tLS0tLS0tLS0tLSsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICB8ICAgVUlEK21vZGU6IHsgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgfCBQcm94eUVtaXR0ZXIgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICB8ICAgICBlbWl0dGVyOiBQcm94eUVtaXR0ZXIsIHwgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsgICAgICAgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS0tLXYtLS0tLS0tLS0tK1xuICogICAgIHwgICAgIGNhbGxiYWNrczogeyAgICAgICAgICAgfCAgICAgICAgICAgICAgICB8IGV2ZW50czogeyAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICB8IE5vZGUgKEhUTUxFbGVtZW50KSAgICB8XG4gKiAgICAgfCAgICAgICBjbGljazogWyBjYWxsYmFja3MgXSB8ICAgICAgICAgICAgICAgIHwgICBjbGljazogWyBjYWxsYmFja3MgXSB8ICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICB8ICAgICB9ICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgfCB9LCAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgfCBkYXRhLWNrLWV4cGFuZG86IFVJRCAgfFxuICogICAgIHwgICB9ICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICB8IF9kb21Ob2RlOiBOb2RlLCAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gKiAgICAgfCB9ICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgIHwgX2RvbUxpc3RlbmVyczoge30sICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgfCArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKyB8ICAgICAgICAgICAgICAgIHwgX2VtaXR0ZXJJZDogVUlEK21vZGUgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgfCB8IERvbUVtaXR0ZXJNaXhpbiAgICAgICAgfCB8ICAgICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLV4tLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgfCArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKyB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgKy0tLS0tLS0tLS0tLS0tXi0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gKiAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgIGNsaWNrIChET00gRXZlbnQpXG4gKiAgICAgICAgICAgICAgICAgICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmUoIGNsaWNrLCBET00gRXZlbnQgKVxuICovIGNsYXNzIFByb3h5RW1pdHRlciBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSB7XG4gICAgX2RvbU5vZGU7XG4gICAgX29wdGlvbnM7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBub2RlIERPTSBOb2RlIHRoYXQgZmlyZXMgZXZlbnRzLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnVzZUNhcHR1cmUgSW5kaWNhdGVzIHRoYXQgZXZlbnRzIG9mIHRoaXMgdHlwZSB3aWxsIGJlIGRpc3BhdGNoZWQgdG8gdGhlIHJlZ2lzdGVyZWRcblx0ICogbGlzdGVuZXIgYmVmb3JlIGJlaW5nIGRpc3BhdGNoZWQgdG8gYW55IEV2ZW50VGFyZ2V0IGJlbmVhdGggaXQgaW4gdGhlIERPTSB0cmVlLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy51c2VQYXNzaXZlIEluZGljYXRlcyB0aGF0IHRoZSBmdW5jdGlvbiBzcGVjaWZpZWQgYnkgbGlzdGVuZXIgd2lsbCBuZXZlciBjYWxsIHByZXZlbnREZWZhdWx0KClcblx0ICogYW5kIHByZXZlbnRzIGJsb2NraW5nIGJyb3dzZXIncyBtYWluIHRocmVhZCBieSB0aGlzIGV2ZW50IGhhbmRsZXIuXG5cdCAqLyBjb25zdHJ1Y3Rvcihub2RlLCBvcHRpb25zKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgLy8gU2V0IGVtaXR0ZXIgSUQgdG8gbWF0Y2ggRE9NIE5vZGUgXCJleHBhbmRvXCIgcHJvcGVydHkuXG4gICAgICAgIF9zZXRFbWl0dGVySWQodGhpcywgZ2V0UHJveHlFbWl0dGVySWQobm9kZSwgb3B0aW9ucykpO1xuICAgICAgICAvLyBSZW1lbWJlciB0aGUgRE9NIE5vZGUgdGhpcyBQcm94eUVtaXR0ZXIgaXMgYm91bmQgdG8uXG4gICAgICAgIHRoaXMuX2RvbU5vZGUgPSBub2RlO1xuICAgICAgICAvLyBBbmQgZ2l2ZW4gb3B0aW9ucy5cbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb2xsZWN0aW9uIG9mIG5hdGl2ZSBET00gbGlzdGVuZXJzLlxuXHQgKi8gX2RvbUxpc3RlbmVycztcbiAgICAvKipcblx0ICogUmVnaXN0ZXJzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiBhbiBldmVudCBpcyBmaXJlZC5cblx0ICpcblx0ICogSXQgYXR0YWNoZXMgYSBuYXRpdmUgRE9NIGxpc3RlbmVyIHRvIHRoZSBET00gTm9kZS4gV2hlbiBmaXJlZCxcblx0ICogYSBjb3JyZXNwb25kaW5nIEVtaXR0ZXIgZXZlbnQgd2lsbCBhbHNvIGZpcmUgd2l0aCBET00gRXZlbnQgb2JqZWN0IGFzIGFuIGFyZ3VtZW50LlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVGhpcyBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCBieSB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTp1dGlscy9lbWl0dGVybWl4aW5+RW1pdHRlciNsaXN0ZW5UbyBgRW1pdHRlciNsaXN0ZW5UbygpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBldmVudCBUaGUgbmFtZSBvZiB0aGUgZXZlbnQuXG5cdCAqLyBhdHRhY2goZXZlbnQpIHtcbiAgICAgICAgLy8gSWYgdGhlIERPTSBMaXN0ZW5lciBmb3IgZ2l2ZW4gZXZlbnQgYWxyZWFkeSBleGlzdCBpdCBpcyBwb2ludGxlc3NcbiAgICAgICAgLy8gdG8gYXR0YWNoIGFub3RoZXIgb25lLlxuICAgICAgICBpZiAodGhpcy5fZG9tTGlzdGVuZXJzICYmIHRoaXMuX2RvbUxpc3RlbmVyc1tldmVudF0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkb21MaXN0ZW5lciA9IHRoaXMuX2NyZWF0ZURvbUxpc3RlbmVyKGV2ZW50KTtcbiAgICAgICAgLy8gQXR0YWNoIHRoZSBuYXRpdmUgRE9NIGxpc3RlbmVyIHRvIERPTSBOb2RlLlxuICAgICAgICB0aGlzLl9kb21Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGRvbUxpc3RlbmVyLCB0aGlzLl9vcHRpb25zKTtcbiAgICAgICAgaWYgKCF0aGlzLl9kb21MaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIHRoaXMuX2RvbUxpc3RlbmVycyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIC8vIFN0b3JlIHRoZSBuYXRpdmUgRE9NIGxpc3RlbmVyIGluIHRoaXMgUHJveHlFbWl0dGVyLiBJdCB3aWxsIGJlIGhlbHBmdWxcbiAgICAgICAgLy8gd2hlbiBzdG9wcGluZyBsaXN0ZW5pbmcgdG8gdGhlIGV2ZW50LlxuICAgICAgICB0aGlzLl9kb21MaXN0ZW5lcnNbZXZlbnRdID0gZG9tTGlzdGVuZXI7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTdG9wcyBleGVjdXRpbmcgdGhlIGNhbGxiYWNrIG9uIHRoZSBnaXZlbiBldmVudC5cblx0ICpcblx0ICogKipOb3RlKio6IFRoaXMgaXMgYXV0b21hdGljYWxseSBjYWxsZWQgYnkgdGhlXG5cdCAqIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXIjc3RvcExpc3RlbmluZyBgRW1pdHRlciNzdG9wTGlzdGVuaW5nKClgfS5cblx0ICpcblx0ICogQHBhcmFtIGV2ZW50IFRoZSBuYW1lIG9mIHRoZSBldmVudC5cblx0ICovIGRldGFjaChldmVudCkge1xuICAgICAgICBsZXQgZXZlbnRzO1xuICAgICAgICAvLyBSZW1vdmUgbmF0aXZlIERPTSBsaXN0ZW5lcnMgd2hpY2ggYXJlIG9ycGhhbnMuIElmIG5vIGNhbGxiYWNrc1xuICAgICAgICAvLyBhcmUgYXdhaXRpbmcgZ2l2ZW4gZXZlbnQsIGRldGFjaCBuYXRpdmUgRE9NIGxpc3RlbmVyIGZyb20gRE9NIE5vZGUuXG4gICAgICAgIC8vIFNlZToge0BsaW5rIGF0dGFjaH0uXG4gICAgICAgIGlmICh0aGlzLl9kb21MaXN0ZW5lcnNbZXZlbnRdICYmICghKGV2ZW50cyA9IHRoaXMuX2V2ZW50c1tldmVudF0pIHx8ICFldmVudHMuY2FsbGJhY2tzLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2RvbUxpc3RlbmVyc1tldmVudF0ucmVtb3ZlTGlzdGVuZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBjYWxsYmFjayB0byBlbWl0dGVyIGZvciBnaXZlbiBldmVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBldmVudCBUaGUgbmFtZSBvZiB0aGUgZXZlbnQuXG5cdCAqIEBwYXJhbSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uIGV2ZW50LlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMuXG5cdCAqLyBfYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5hdHRhY2goZXZlbnQpO1xuICAgICAgICBFbWl0dGVyTWl4aW4oKS5wcm90b3R5cGUuX2FkZEV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBjYWxsYmFjayBmcm9tIGVtaXR0ZXIgZm9yIGdpdmVuIGV2ZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGV2ZW50IFRoZSBuYW1lIG9mIHRoZSBldmVudC5cblx0ICogQHBhcmFtIGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBzdG9wIGJlaW5nIGNhbGxlZC5cblx0ICovIF9yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjaykge1xuICAgICAgICBFbWl0dGVyTWl4aW4oKS5wcm90b3R5cGUuX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudCwgY2FsbGJhY2spO1xuICAgICAgICB0aGlzLmRldGFjaChldmVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmF0aXZlIERPTSBsaXN0ZW5lciBjYWxsYmFjay4gV2hlbiB0aGUgbmF0aXZlIERPTSBldmVudFxuXHQgKiBpcyBmaXJlZCBpdCB3aWxsIGZpcmUgY29ycmVzcG9uZGluZyBldmVudCBvbiB0aGlzIFByb3h5RW1pdHRlci5cblx0ICogTm90ZTogQSBuYXRpdmUgRE9NIEV2ZW50IGlzIHBhc3NlZCBhcyBhbiBhcmd1bWVudC5cblx0ICpcblx0ICogQHBhcmFtIGV2ZW50IFRoZSBuYW1lIG9mIHRoZSBldmVudC5cblx0ICogQHJldHVybnMgVGhlIERPTSBsaXN0ZW5lciBjYWxsYmFjay5cblx0ICovIF9jcmVhdGVEb21MaXN0ZW5lcihldmVudCkge1xuICAgICAgICBjb25zdCBkb21MaXN0ZW5lciA9IChkb21FdnQpPT57XG4gICAgICAgICAgICB0aGlzLmZpcmUoZXZlbnQsIGRvbUV2dCk7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFN1cHBseSB0aGUgRE9NIGxpc3RlbmVyIGNhbGxiYWNrIHdpdGggYSBmdW5jdGlvbiB0aGF0IHdpbGwgaGVscFxuICAgICAgICAvLyBkZXRhY2ggaXQgZnJvbSB0aGUgRE9NIE5vZGUsIHdoZW4gaXQgaXMgbm8gbG9uZ2VyIG5lY2Vzc2FyeS5cbiAgICAgICAgLy8gU2VlOiB7QGxpbmsgZGV0YWNofS5cbiAgICAgICAgZG9tTGlzdGVuZXIucmVtb3ZlTGlzdGVuZXIgPSAoKT0+e1xuICAgICAgICAgICAgdGhpcy5fZG9tTm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBkb21MaXN0ZW5lciwgdGhpcy5fb3B0aW9ucyk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fZG9tTGlzdGVuZXJzW2V2ZW50XTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRvbUxpc3RlbmVyO1xuICAgIH1cbn1cbi8qKlxuICogR2V0cyBhbiB1bmlxdWUgRE9NIE5vZGUgaWRlbnRpZmllci4gVGhlIGlkZW50aWZpZXIgd2lsbCBiZSBzZXQgaWYgbm90IGRlZmluZWQuXG4gKlxuICogQHJldHVybnMgVUlEIGZvciBnaXZlbiBET00gTm9kZS5cbiAqLyBmdW5jdGlvbiBnZXROb2RlVUlEKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZVsnZGF0YS1jay1leHBhbmRvJ10gfHwgKG5vZGVbJ2RhdGEtY2stZXhwYW5kbyddID0gdWlkKCkpO1xufVxuLyoqXG4gKiBHZXRzIGlkIG9mIHRoZSBQcm94eUVtaXR0ZXIgZm9yIHRoZSBnaXZlbiBub2RlLlxuICovIGZ1bmN0aW9uIGdldFByb3h5RW1pdHRlcklkKG5vZGUsIG9wdGlvbnMpIHtcbiAgICBsZXQgaWQgPSBnZXROb2RlVUlEKG5vZGUpO1xuICAgIGZvciAoY29uc3Qgb3B0aW9uIG9mIE9iamVjdC5rZXlzKG9wdGlvbnMpLnNvcnQoKSl7XG4gICAgICAgIGlmIChvcHRpb25zW29wdGlvbl0pIHtcbiAgICAgICAgICAgIGlkICs9ICctJyArIG9wdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaWQ7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY2xvc2VzdCBzY3JvbGxhYmxlIGFuY2VzdG9yIG9mIGEgRE9NIGVsZW1lbnQuXG4gKlxuICogQHBhcmFtIGRvbUVsZW1lbnQgRE9NIGVsZW1lbnQuXG4gKiBAcmV0dXJucyBGaXJzdCBhbmNlc3RvciBvZiBgZG9tRWxlbWVudGAgdGhhdCBpcyBzY3JvbGxhYmxlIG9yIG51bGwgaWYgc3VjaCBhbmNlc3RvciBkb2Vzbid0IGV4aXN0LlxuICovIGZ1bmN0aW9uIGZpbmRDbG9zZXN0U2Nyb2xsYWJsZUFuY2VzdG9yKGRvbUVsZW1lbnQpIHtcbiAgICBsZXQgZWxlbWVudCA9IGRvbUVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHdoaWxlKGVsZW1lbnQudGFnTmFtZSAhPSAnQk9EWScpe1xuICAgICAgICBjb25zdCBvdmVyZmxvdyA9IGVsZW1lbnQuc3R5bGUub3ZlcmZsb3dZIHx8IGdsb2JhbC53aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5vdmVyZmxvd1k7XG4gICAgICAgIGlmIChvdmVyZmxvdyA9PT0gJ2F1dG8nIHx8IG92ZXJmbG93ID09PSAnc2Nyb2xsJykge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qIGdsb2JhbHMgTm9kZSAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZG9tL2dldGFuY2VzdG9yc1xuICovIC8qKlxuICogUmV0dXJucyBhbGwgYW5jZXN0b3JzIG9mIGdpdmVuIERPTSBub2RlLCBzdGFydGluZyBmcm9tIHRoZSB0b3AtbW9zdCAocm9vdCkuIEluY2x1ZGVzIHRoZSBnaXZlbiBub2RlIGl0c2VsZi4gSWYgdGhlXG4gKiBub2RlIGlzIGEgcGFydCBvZiBgRG9jdW1lbnRGcmFnbWVudGAgdGhhdCBgRG9jdW1lbnRGcmFnbWVudGAgd2lsbCBiZSByZXR1cm5lZC4gSW4gY29udHJhcnksIGlmIHRoZSBub2RlIGlzXG4gKiBhcHBlbmRlZCB0byBhIGBEb2N1bWVudGAsIHRoYXQgYERvY3VtZW50YCB3aWxsIG5vdCBiZSByZXR1cm5lZCAoYWxnb3JpdGhtcyBvcGVyYXRpbmcgb24gRE9NIHRyZWUgY2FyZSBmb3IgYERvY3VtZW50I2RvY3VtZW50RWxlbWVudGBcbiAqIGF0IG1vc3QsIHdoaWNoIHdpbGwgYmUgcmV0dXJuZWQpLlxuICpcbiAqIEBwYXJhbSBub2RlIERPTSBub2RlLlxuICogQHJldHVybnMgQXJyYXkgb2YgZ2l2ZW4gYG5vZGVgIHBhcmVudHMuXG4gKi8gZnVuY3Rpb24gZ2V0QW5jZXN0b3JzKG5vZGUpIHtcbiAgICBjb25zdCBub2RlcyA9IFtdO1xuICAgIGxldCBjdXJyZW50Tm9kZSA9IG5vZGU7XG4gICAgLy8gV2UgYXJlIGludGVyZXN0ZWQgaW4gYE5vZGVgcyBgRG9jdW1lbnRGcmFnbWVudGBzIG9ubHkuXG4gICAgd2hpbGUoY3VycmVudE5vZGUgJiYgY3VycmVudE5vZGUubm9kZVR5cGUgIT0gTm9kZS5ET0NVTUVOVF9OT0RFKXtcbiAgICAgICAgbm9kZXMudW5zaGlmdChjdXJyZW50Tm9kZSk7XG4gICAgICAgIGN1cnJlbnROb2RlID0gY3VycmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICB9XG4gICAgcmV0dXJuIG5vZGVzO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyogZ2xvYmFscyBIVE1MVGV4dEFyZWFFbGVtZW50ICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9kb20vZ2V0ZGF0YWZyb21lbGVtZW50XG4gKi8gLyoqXG4gKiBHZXRzIGRhdGEgZnJvbSBhIGdpdmVuIHNvdXJjZSBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBlbCBUaGUgZWxlbWVudCBmcm9tIHdoaWNoIHRoZSBkYXRhIHdpbGwgYmUgcmV0cmlldmVkLlxuICogQHJldHVybnMgVGhlIGRhdGEgc3RyaW5nLlxuICovIGZ1bmN0aW9uIGdldERhdGFGcm9tRWxlbWVudChlbCkge1xuICAgIGlmIChlbCBpbnN0YW5jZW9mIEhUTUxUZXh0QXJlYUVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsLnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gZWwuaW5uZXJIVE1MO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS9nZXRib3JkZXJ3aWR0aHNcbiAqLyAvKipcbiAqIFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgQ1NTIGJvcmRlciB3aWR0aHMgb2YgYSBzcGVjaWZpZWQgSFRNTCBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBlbGVtZW50IEFuIGVsZW1lbnQgd2hpY2ggaGFzIENTUyBib3JkZXJzLlxuICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYHRvcGAsIGBsZWZ0YCwgYHJpZ2h0YCBhbmQgYGJvdHRvbWAgcHJvcGVydGllc1xuICogd2l0aCBudW1lcmljYWwgdmFsdWVzIG9mIHRoZSBgYm9yZGVyLVt0b3AsbGVmdCxyaWdodCxib3R0b21dLXdpZHRoYCBDU1Mgc3R5bGVzLlxuICovIGZ1bmN0aW9uIGdldEJvcmRlcldpZHRocyhlbGVtZW50KSB7XG4gICAgLy8gQ2FsbCBnZXRDb21wdXRlZFN0eWxlIG9uIHRoZSB3aW5kb3cgdGhlIGVsZW1lbnQgZG9jdW1lbnQgYmVsb25ncyB0by5cbiAgICBjb25zdCBzdHlsZSA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDogcGFyc2VJbnQoc3R5bGUuYm9yZGVyVG9wV2lkdGgsIDEwKSxcbiAgICAgICAgcmlnaHQ6IHBhcnNlSW50KHN0eWxlLmJvcmRlclJpZ2h0V2lkdGgsIDEwKSxcbiAgICAgICAgYm90dG9tOiBwYXJzZUludChzdHlsZS5ib3JkZXJCb3R0b21XaWR0aCwgMTApLFxuICAgICAgICBsZWZ0OiBwYXJzZUludChzdHlsZS5ib3JkZXJMZWZ0V2lkdGgsIDEwKVxuICAgIH07XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZG9tL2dldHJhbmdlZnJvbW1vdXNlZXZlbnRcbiAqLyAvKipcbiAqIFJldHVybnMgYSBET00gcmFuZ2UgZnJvbSBhIGdpdmVuIHBvaW50IHNwZWNpZmllZCBieSBhIG1vdXNlIGV2ZW50LlxuICpcbiAqIEBwYXJhbSBkb21FdmVudCBUaGUgbW91c2UgZXZlbnQuXG4gKiBAcmV0dXJucyBUaGUgRE9NIHJhbmdlLlxuICovIGZ1bmN0aW9uIGdldFJhbmdlRnJvbU1vdXNlRXZlbnQoZG9tRXZlbnQpIHtcbiAgICBpZiAoIWRvbUV2ZW50LnRhcmdldCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZG9tRG9jID0gZG9tRXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQ7XG4gICAgY29uc3QgeCA9IGRvbUV2ZW50LmNsaWVudFg7XG4gICAgY29uc3QgeSA9IGRvbUV2ZW50LmNsaWVudFk7XG4gICAgbGV0IGRvbVJhbmdlID0gbnVsbDtcbiAgICAvLyBXZWJraXQgJiBCbGluay5cbiAgICBpZiAoZG9tRG9jLmNhcmV0UmFuZ2VGcm9tUG9pbnQgJiYgZG9tRG9jLmNhcmV0UmFuZ2VGcm9tUG9pbnQoeCwgeSkpIHtcbiAgICAgICAgZG9tUmFuZ2UgPSBkb21Eb2MuY2FyZXRSYW5nZUZyb21Qb2ludCh4LCB5KTtcbiAgICB9IGVsc2UgaWYgKGRvbUV2ZW50LnJhbmdlUGFyZW50KSB7XG4gICAgICAgIGRvbVJhbmdlID0gZG9tRG9jLmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIGRvbVJhbmdlLnNldFN0YXJ0KGRvbUV2ZW50LnJhbmdlUGFyZW50LCBkb21FdmVudC5yYW5nZU9mZnNldCk7XG4gICAgICAgIGRvbVJhbmdlLmNvbGxhcHNlKHRydWUpO1xuICAgIH1cbiAgICByZXR1cm4gZG9tUmFuZ2U7XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZG9tL2lzdGV4dFxuICovIC8qKlxuICogQ2hlY2tzIGlmIHRoZSBvYmplY3QgaXMgYSBuYXRpdmUgRE9NIFRleHQgbm9kZS5cbiAqLyBmdW5jdGlvbiBpc1RleHQob2JqKSB7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IFRleHRdJztcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9kb20vaXNyYW5nZVxuICovIC8qKlxuICogQ2hlY2tzIGlmIHRoZSBvYmplY3QgaXMgYSBuYXRpdmUgRE9NIFJhbmdlLlxuICovIGZ1bmN0aW9uIGlzUmFuZ2Uob2JqKSB7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkob2JqKSA9PSAnW29iamVjdCBSYW5nZV0nO1xufVxuXG4vKipcbiAqIEZvciBhIGdpdmVuIGVsZW1lbnQsIHJldHVybnMgdGhlIG5lYXJlc3QgYW5jZXN0b3IgZWxlbWVudCB3aGljaCBDU1MgcG9zaXRpb24gaXMgbm90IFwic3RhdGljXCIuXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgVGhlIG5hdGl2ZSBET00gZWxlbWVudCB0byBiZSBjaGVja2VkLlxuICovIGZ1bmN0aW9uIGdldFBvc2l0aW9uZWRBbmNlc3RvcihlbGVtZW50KSB7XG4gICAgaWYgKCFlbGVtZW50IHx8ICFlbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCA9PT0gZ2xvYmFsLmRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50Lm9mZnNldFBhcmVudDtcbn1cblxuY29uc3QgcmVjdFByb3BlcnRpZXMgPSBbXG4gICAgJ3RvcCcsXG4gICAgJ3JpZ2h0JyxcbiAgICAnYm90dG9tJyxcbiAgICAnbGVmdCcsXG4gICAgJ3dpZHRoJyxcbiAgICAnaGVpZ2h0J1xuXTtcbi8qKlxuICogQSBoZWxwZXIgY2xhc3MgcmVwcmVzZW50aW5nIGEgYENsaWVudFJlY3RgIG9iamVjdCwgZS5nLiB2YWx1ZSByZXR1cm5lZCBieVxuICogdGhlIG5hdGl2ZSBgb2JqZWN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpYCBtZXRob2QuIFByb3ZpZGVzIGEgc2V0IG9mIG1ldGhvZHNcbiAqIHRvIG1hbmlwdWxhdGUgdGhlIHJlY3QgYW5kIGNvbXBhcmUgaXQgYWdhaW5zdCBvdGhlciByZWN0IGluc3RhbmNlcy5cbiAqLyBjbGFzcyBSZWN0IHtcbiAgICAvKipcblx0ICogVGhlIFwidG9wXCIgdmFsdWUgb2YgdGhlIHJlY3QuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gdG9wO1xuICAgIC8qKlxuXHQgKiBUaGUgXCJyaWdodFwiIHZhbHVlIG9mIHRoZSByZWN0LlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIHJpZ2h0O1xuICAgIC8qKlxuXHQgKiBUaGUgXCJib3R0b21cIiB2YWx1ZSBvZiB0aGUgcmVjdC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBib3R0b207XG4gICAgLyoqXG5cdCAqIFRoZSBcImxlZnRcIiB2YWx1ZSBvZiB0aGUgcmVjdC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBsZWZ0O1xuICAgIC8qKlxuXHQgKiBUaGUgXCJ3aWR0aFwiIHZhbHVlIG9mIHRoZSByZWN0LlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIHdpZHRoO1xuICAgIC8qKlxuXHQgKiBUaGUgXCJoZWlnaHRcIiB2YWx1ZSBvZiB0aGUgcmVjdC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBoZWlnaHQ7XG4gICAgLyoqXG5cdCAqIFRoZSBvYmplY3QgdGhpcyByZWN0IGlzIGZvci5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBfc291cmNlO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHJlY3QuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIFJlY3Qgb2YgYW4gSFRNTEVsZW1lbnQuXG5cdCAqIGNvbnN0IHJlY3RBID0gbmV3IFJlY3QoIGRvY3VtZW50LmJvZHkgKTtcblx0ICpcblx0ICogLy8gUmVjdCBvZiBhIERPTSBSYW5nZS5cblx0ICogY29uc3QgcmVjdEIgPSBuZXcgUmVjdCggZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCggMCApICk7XG5cdCAqXG5cdCAqIC8vIFJlY3Qgb2YgYSB3aW5kb3cgKHdlYiBicm93c2VyIHZpZXdwb3J0KS5cblx0ICogY29uc3QgcmVjdEMgPSBuZXcgUmVjdCggd2luZG93ICk7XG5cdCAqXG5cdCAqIC8vIFJlY3Qgb3V0IG9mIGFuIG9iamVjdC5cblx0ICogY29uc3QgcmVjdEQgPSBuZXcgUmVjdCggeyB0b3A6IDAsIHJpZ2h0OiAxMCwgYm90dG9tOiAxMCwgbGVmdDogMCwgd2lkdGg6IDEwLCBoZWlnaHQ6IDEwIH0gKTtcblx0ICpcblx0ICogLy8gUmVjdCBvdXQgb2YgYW5vdGhlciBSZWN0IGluc3RhbmNlLlxuXHQgKiBjb25zdCByZWN0RSA9IG5ldyBSZWN0KCByZWN0RCApO1xuXHQgKlxuXHQgKiAvLyBSZWN0IG91dCBvZiBhIENsaWVudFJlY3QuXG5cdCAqIGNvbnN0IHJlY3RGID0gbmV3IFJlY3QoIGRvY3VtZW50LmJvZHkuZ2V0Q2xpZW50UmVjdHMoKS5pdGVtKCAwICkgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBCeSBkZWZhdWx0IGEgcmVjdCBvZiBhbiBIVE1MIGVsZW1lbnQgaW5jbHVkZXMgaXRzIENTUyBib3JkZXJzIGFuZCBzY3JvbGxiYXJzIChpZiBhbnkpXG5cdCAqIGFudCB0aGUgcmVjdCBvZiBhIGB3aW5kb3dgIGluY2x1ZGVzIHNjcm9sbGJhcnMgdG9vLiBVc2Uge0BsaW5rICNleGNsdWRlU2Nyb2xsYmFyc0FuZEJvcmRlcnN9XG5cdCAqIHRvIGdldCB0aGUgaW5uZXIgcGFydCBvZiB0aGUgcmVjdC5cblx0ICpcblx0ICogQHBhcmFtIHNvdXJjZSBBIHNvdXJjZSBvYmplY3QgdG8gY3JlYXRlIHRoZSByZWN0LlxuXHQgKi8gY29uc3RydWN0b3Ioc291cmNlKXtcbiAgICAgICAgY29uc3QgaXNTb3VyY2VSYW5nZSA9IGlzUmFuZ2Uoc291cmNlKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdfc291cmNlJywge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHNvdXJjZSBpcyBhIFJlY3QgaW5zdGFuY2UsIGNvcHkgaXQncyAjX3NvdXJjZS5cbiAgICAgICAgICAgIHZhbHVlOiBzb3VyY2UuX3NvdXJjZSB8fCBzb3VyY2UsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaXNEb21FbGVtZW50KHNvdXJjZSkgfHwgaXNTb3VyY2VSYW5nZSkge1xuICAgICAgICAgICAgLy8gVGhlIGBSZWN0YCBjbGFzcyBkZXBlbmRzIG9uIGBnZXRCb3VuZGluZ0NsaWVudFJlY3RgIGFuZCBgZ2V0Q2xpZW50UmVjdHNgIERPTSBtZXRob2RzLiBJZiB0aGUgc291cmNlXG4gICAgICAgICAgICAvLyBvZiBhIHJlY3QgaW4gYW4gSFRNTCBlbGVtZW50IG9yIGEgRE9NIHJhbmdlIGJ1dCBpdCBkb2VzIG5vdCBiZWxvbmcgdG8gYW55IHJlbmRlcmVkIERPTSB0cmVlLCB0aGVzZSBtZXRob2RzXG4gICAgICAgICAgICAvLyB3aWxsIGZhaWwgdG8gb2J0YWluIHRoZSBnZW9tZXRyeSBhbmQgdGhlIHJlY3QgaW5zdGFuY2UgbWFrZXMgbGl0dGxlIHNlbnNlIHRvIHRoZSBmZWF0dXJlcyB1c2luZyBpdC5cbiAgICAgICAgICAgIC8vIFRvIGdldCByaWQgb2YgdGhpcyB3YXJuaW5nIG1ha2Ugc3VyZSB0aGUgc291cmNlIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IgaXMgYSBkZXNjZW5kYW50IG9mIGB3aW5kb3cuZG9jdW1lbnQuYm9keWAuXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUcgLy8gY29uc3Qgc291cmNlTm9kZSA9IGlzU291cmNlUmFuZ2UgPyBzb3VyY2Uuc3RhcnRDb250YWluZXIgOiBzb3VyY2U7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUcgLy8gaWYgKCAhc291cmNlTm9kZS5vd25lckRvY3VtZW50IHx8ICFzb3VyY2VOb2RlLm93bmVyRG9jdW1lbnQuYm9keS5jb250YWlucyggc291cmNlTm9kZSApICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIFx0Y29uc29sZS53YXJuKFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIFx0XHQncmVjdC1zb3VyY2Utbm90LWluLWRvbTogVGhlIHNvdXJjZSBvZiB0aGlzIHJlY3QgZG9lcyBub3QgYmVsb25nIHRvIGFueSByZW5kZXJlZCBET00gdHJlZS4nLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIFx0XHR7IHNvdXJjZSB9ICk7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUcgLy8gfVxuICAgICAgICAgICAgaWYgKGlzU291cmNlUmFuZ2UpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5nZVJlY3RzID0gUmVjdC5nZXREb21SYW5nZVJlY3RzKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgY29weVJlY3RQcm9wZXJ0aWVzKHRoaXMsIFJlY3QuZ2V0Qm91bmRpbmdSZWN0KHJhbmdlUmVjdHMpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29weVJlY3RQcm9wZXJ0aWVzKHRoaXMsIHNvdXJjZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaXNXaW5kb3coc291cmNlKSkge1xuICAgICAgICAgICAgY29uc3QgeyBpbm5lcldpZHRoLCBpbm5lckhlaWdodCB9ID0gc291cmNlO1xuICAgICAgICAgICAgY29weVJlY3RQcm9wZXJ0aWVzKHRoaXMsIHtcbiAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IGlubmVyV2lkdGgsXG4gICAgICAgICAgICAgICAgYm90dG9tOiBpbm5lckhlaWdodCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBpbm5lcldpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaW5uZXJIZWlnaHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29weVJlY3RQcm9wZXJ0aWVzKHRoaXMsIHNvdXJjZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBjbG9uZSBvZiB0aGUgcmVjdC5cblx0ICpcblx0ICogQHJldHVybnMgQSBjbG9uZWQgcmVjdC5cblx0ICovIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJlY3QodGhpcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyB0aGUgcmVjdCBzbyB0aGF0IGl0cyB1cHBlcuKAk2xlZnQgY29ybmVyIGxhbmRzIGluIGRlc2lyZWQgYFsgeCwgeSBdYCBsb2NhdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHggRGVzaXJlZCBob3Jpem9udGFsIGxvY2F0aW9uLlxuXHQgKiBAcGFyYW0geSBEZXNpcmVkIHZlcnRpY2FsIGxvY2F0aW9uLlxuXHQgKiBAcmV0dXJucyBBIHJlY3Qgd2hpY2ggaGFzIGJlZW4gbW92ZWQuXG5cdCAqLyBtb3ZlVG8oeCwgeSkge1xuICAgICAgICB0aGlzLnRvcCA9IHk7XG4gICAgICAgIHRoaXMucmlnaHQgPSB4ICsgdGhpcy53aWR0aDtcbiAgICAgICAgdGhpcy5ib3R0b20gPSB5ICsgdGhpcy5oZWlnaHQ7XG4gICAgICAgIHRoaXMubGVmdCA9IHg7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcblx0ICogTW92ZXMgdGhlIHJlY3QgaW7igJNwbGFjZSBieSBhIGRlZGljYXRlZCBvZmZzZXQuXG5cdCAqXG5cdCAqIEBwYXJhbSB4IEEgaG9yaXpvbnRhbCBvZmZzZXQuXG5cdCAqIEBwYXJhbSB5IEEgdmVydGljYWwgb2Zmc2V0XG5cdCAqIEByZXR1cm5zIEEgcmVjdCB3aGljaCBoYXMgYmVlbiBtb3ZlZC5cblx0ICovIG1vdmVCeSh4LCB5KSB7XG4gICAgICAgIHRoaXMudG9wICs9IHk7XG4gICAgICAgIHRoaXMucmlnaHQgKz0geDtcbiAgICAgICAgdGhpcy5sZWZ0ICs9IHg7XG4gICAgICAgIHRoaXMuYm90dG9tICs9IHk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIG5ldyByZWN0IGEgYSByZXN1bHQgb2YgaW50ZXJzZWN0aW9uIHdpdGggYW5vdGhlciByZWN0LlxuXHQgKi8gZ2V0SW50ZXJzZWN0aW9uKGFub3RoZXJSZWN0KSB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSB7XG4gICAgICAgICAgICB0b3A6IE1hdGgubWF4KHRoaXMudG9wLCBhbm90aGVyUmVjdC50b3ApLFxuICAgICAgICAgICAgcmlnaHQ6IE1hdGgubWluKHRoaXMucmlnaHQsIGFub3RoZXJSZWN0LnJpZ2h0KSxcbiAgICAgICAgICAgIGJvdHRvbTogTWF0aC5taW4odGhpcy5ib3R0b20sIGFub3RoZXJSZWN0LmJvdHRvbSksXG4gICAgICAgICAgICBsZWZ0OiBNYXRoLm1heCh0aGlzLmxlZnQsIGFub3RoZXJSZWN0LmxlZnQpLFxuICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgfTtcbiAgICAgICAgcmVjdC53aWR0aCA9IHJlY3QucmlnaHQgLSByZWN0LmxlZnQ7XG4gICAgICAgIHJlY3QuaGVpZ2h0ID0gcmVjdC5ib3R0b20gLSByZWN0LnRvcDtcbiAgICAgICAgaWYgKHJlY3Qud2lkdGggPCAwIHx8IHJlY3QuaGVpZ2h0IDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBuZXdSZWN0ID0gbmV3IFJlY3QocmVjdCk7XG4gICAgICAgICAgICBuZXdSZWN0Ll9zb3VyY2UgPSB0aGlzLl9zb3VyY2U7XG4gICAgICAgICAgICByZXR1cm4gbmV3UmVjdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgYXJlYSBvZiBpbnRlcnNlY3Rpb24gd2l0aCBhbm90aGVyIHJlY3QuXG5cdCAqXG5cdCAqIEByZXR1cm5zIEFyZWEgb2YgaW50ZXJzZWN0aW9uLlxuXHQgKi8gZ2V0SW50ZXJzZWN0aW9uQXJlYShhbm90aGVyUmVjdCkge1xuICAgICAgICBjb25zdCByZWN0ID0gdGhpcy5nZXRJbnRlcnNlY3Rpb24oYW5vdGhlclJlY3QpO1xuICAgICAgICBpZiAocmVjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlY3QuZ2V0QXJlYSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGFyZWEgb2YgdGhlIHJlY3QuXG5cdCAqLyBnZXRBcmVhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIG5ldyByZWN0LCBhIHBhcnQgb2YgdGhlIG9yaWdpbmFsIHJlY3QsIHdoaWNoIGlzIGFjdHVhbGx5IHZpc2libGUgdG8gdGhlIHVzZXIgYW5kIGlzIHJlbGF0aXZlIHRvIHRoZSxgYm9keWAsXG5cdCAqIGUuZy4gYW4gb3JpZ2luYWwgcmVjdCBjcm9wcGVkIGJ5IHBhcmVudCBlbGVtZW50IHJlY3RzIHdoaWNoIGhhdmUgYG92ZXJmbG93YCBzZXQgaW4gQ1NTXG5cdCAqIG90aGVyIHRoYW4gYFwidmlzaWJsZVwiYC5cblx0ICpcblx0ICogSWYgdGhlcmUncyBubyBzdWNoIHZpc2libGUgcmVjdCwgd2hpY2ggaXMgd2hlbiB0aGUgcmVjdCBpcyBsaW1pdGVkIGJ5IG9uZSBvciBtYW55IG9mXG5cdCAqIHRoZSBhbmNlc3RvcnMsIGBudWxsYCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogKipOb3RlKio6IFRoaXMgbWV0aG9kIGRvZXMgbm90IGNvbnNpZGVyIHRoZSBib3VuZGFyaWVzIG9mIHRoZSB2aWV3cG9ydCAod2luZG93KS5cblx0ICogVG8gZ2V0IGEgcmVjdCBjcm9wcGVkIGJ5IGFsbCBhbmNlc3RvcnMgYW5kIHRoZSB2aWV3cG9ydCwgdXNlIGFuIGludGVyc2VjdGlvbiBzdWNoIGFzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCB2aXNpYmxlSW5WaWV3cG9ydFJlY3QgPSBuZXcgUmVjdCggd2luZG93ICkuZ2V0SW50ZXJzZWN0aW9uKCBuZXcgUmVjdCggc291cmNlICkuZ2V0VmlzaWJsZSgpICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcmV0dXJucyBBIHZpc2libGUgcmVjdCBpbnN0YW5jZSBvciBgbnVsbGAsIGlmIHRoZXJlJ3Mgbm9uZS5cblx0ICovIGdldFZpc2libGUoKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IHRoaXMuX3NvdXJjZTtcbiAgICAgICAgbGV0IHZpc2libGVSZWN0ID0gdGhpcy5jbG9uZSgpO1xuICAgICAgICAvLyBUaGVyZSdzIG5vIGFuY2VzdG9yIHRvIGNyb3AgPGJvZHk+IHdpdGggdGhlIG92ZXJmbG93LlxuICAgICAgICBpZiAoaXNCb2R5KHNvdXJjZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB2aXNpYmxlUmVjdDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY2hpbGQgPSBzb3VyY2U7XG4gICAgICAgIGxldCBwYXJlbnQgPSBzb3VyY2UucGFyZW50Tm9kZSB8fCBzb3VyY2UuY29tbW9uQW5jZXN0b3JDb250YWluZXI7XG4gICAgICAgIGxldCBhYnNvbHV0ZWx5UG9zaXRpb25lZENoaWxkRWxlbWVudDtcbiAgICAgICAgLy8gQ2hlY2sgdGhlIGFuY2VzdG9ycyBhbGwgdGhlIHdheSB1cCB0byB0aGUgPGJvZHk+LlxuICAgICAgICB3aGlsZShwYXJlbnQgJiYgIWlzQm9keShwYXJlbnQpKXtcbiAgICAgICAgICAgIGNvbnN0IGlzUGFyZW50T3ZlcmZsb3dWaXNpYmxlID0gZ2V0RWxlbWVudE92ZXJmbG93KHBhcmVudCkgPT09ICd2aXNpYmxlJztcbiAgICAgICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIGdldEVsZW1lbnRQb3NpdGlvbihjaGlsZCkgPT09ICdhYnNvbHV0ZScpIHtcbiAgICAgICAgICAgICAgICBhYnNvbHV0ZWx5UG9zaXRpb25lZENoaWxkRWxlbWVudCA9IGNoaWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGFyZW50RWxlbWVudFBvc2l0aW9uID0gZ2V0RWxlbWVudFBvc2l0aW9uKHBhcmVudCk7XG4gICAgICAgICAgICAvLyBUaGUgY2hpbGQgd2lsbCBiZSBjcm9wcGVkIG9ubHkgaWYgaXQgaGFzIGBwb3NpdGlvbjogYWJzb2x1dGVgIGFuZCB0aGUgcGFyZW50IGhhcyBgcG9zaXRpb246IHJlbGF0aXZlYCArIHNvbWUgb3ZlcmZsb3cuXG4gICAgICAgICAgICAvLyBPdGhlcndpc2UgdGhlcmUncyBubyBjaGFuY2Ugb2YgdmlzdWFsIGNsaXBwaW5nIGFuZCB0aGUgcGFyZW50IGNhbiBiZSBza2lwcGVkXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xNDEwNy5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBjb25kaXRpb246IGlzUGFyZW50T3ZlcmZsb3dWaXNpYmxlXG4gICAgICAgICAgICAvLyBcdFx0Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICAgICAgICAgIC8vXHRcdHwgI3BhcmVudFx0XHRcdFx0XHR8XG4gICAgICAgICAgICAvL1x0XHR8IChvdmVyZmxvdzogdmlzaWJsZSlcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fFx0XHRcdFx0Ky0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgICAgICAgIC8vXHRcdHxcdFx0XHRcdHwgY2hpbGRcdFx0XHRcdFx0XHR8XG4gICAgICAgICAgICAvL1x0XHR8XHRcdFx0XHQrLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tK1xuICAgICAgICAgICAgLy9cdFx0Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBjb25kaXRpb246IGFic29sdXRlbHlQb3NpdGlvbmVkQ2hpbGRFbGVtZW50ICYmIHBhcmVudEVsZW1lbnRQb3NpdGlvbiA9PT0gJ3JlbGF0aXZlJyAmJiBpc1BhcmVudE92ZXJmbG93VmlzaWJsZVxuICAgICAgICAgICAgLy8gXHRcdCstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvL1x0XHR8IHBhcmVudFx0XHRcdFx0XHR8XG4gICAgICAgICAgICAvL1x0XHR8IChwb3NpdGlvbjogcmVsYXRpdmU7KVx0XHR8XG4gICAgICAgICAgICAvL1x0XHR8IChvdmVyZmxvdzogdmlzaWJsZTspXHRcdHxcbiAgICAgICAgICAgIC8vXHRcdHxcdFx0XHRcdCstLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvL1x0XHR8XHRcdFx0XHR8IGNoaWxkICBcdFx0XHRcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fFx0XHRcdFx0fCAocG9zaXRpb246IGFic29sdXRlOylcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fFx0XHRcdFx0Ky0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgICAgICAgIC8vXHRcdCstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gY29uZGl0aW9uOiBhYnNvbHV0ZWx5UG9zaXRpb25lZENoaWxkRWxlbWVudCAmJiBwYXJlbnRFbGVtZW50UG9zaXRpb24gIT09ICdyZWxhdGl2ZSdcbiAgICAgICAgICAgIC8vIFx0XHQrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuICAgICAgICAgICAgLy9cdFx0fCBwYXJlbnRcdFx0XHRcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fCAocG9zaXRpb246IHN0YXRpYzspXHRcdHxcbiAgICAgICAgICAgIC8vXHRcdHxcdFx0XHRcdCstLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICAvL1x0XHR8XHRcdFx0XHR8IGNoaWxkICBcdFx0XHRcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fFx0XHRcdFx0fCAocG9zaXRpb246IGFic29sdXRlOylcdFx0fFxuICAgICAgICAgICAgLy9cdFx0fFx0XHRcdFx0Ky0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgICAgICAgIC8vXHRcdCstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gICAgICAgICAgICBpZiAoaXNQYXJlbnRPdmVyZmxvd1Zpc2libGUgfHwgYWJzb2x1dGVseVBvc2l0aW9uZWRDaGlsZEVsZW1lbnQgJiYgKHBhcmVudEVsZW1lbnRQb3NpdGlvbiA9PT0gJ3JlbGF0aXZlJyAmJiBpc1BhcmVudE92ZXJmbG93VmlzaWJsZSB8fCBwYXJlbnRFbGVtZW50UG9zaXRpb24gIT09ICdyZWxhdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRSZWN0ID0gbmV3IFJlY3QocGFyZW50KTtcbiAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvblJlY3QgPSB2aXNpYmxlUmVjdC5nZXRJbnRlcnNlY3Rpb24ocGFyZW50UmVjdCk7XG4gICAgICAgICAgICBpZiAoaW50ZXJzZWN0aW9uUmVjdCkge1xuICAgICAgICAgICAgICAgIGlmIChpbnRlcnNlY3Rpb25SZWN0LmdldEFyZWEoKSA8IHZpc2libGVSZWN0LmdldEFyZWEoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZWR1Y2UgdGhlIHZpc2libGUgcmVjdCB0byB0aGUgaW50ZXJzZWN0aW9uLlxuICAgICAgICAgICAgICAgICAgICB2aXNpYmxlUmVjdCA9IGludGVyc2VjdGlvblJlY3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG5vIGludGVyc2VjdGlvbiwgdGhlIHJlY3QgaXMgY29tcGxldGVseSBpbnZpc2libGUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjaGlsZCA9IHBhcmVudDtcbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2aXNpYmxlUmVjdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBhbGwgcHJvcGVydHkgdmFsdWVzICh7QGxpbmsgI3RvcH0sIHtAbGluayAjbGVmdH0sIHtAbGluayAjcmlnaHR9LFxuXHQgKiB7QGxpbmsgI2JvdHRvbX0sIHtAbGluayAjd2lkdGh9IGFuZCB7QGxpbmsgI2hlaWdodH0pIGFyZSB0aGUgZXF1YWwgaW4gYm90aCByZWN0XG5cdCAqIGluc3RhbmNlcy5cblx0ICpcblx0ICogQHBhcmFtIGFub3RoZXJSZWN0IEEgcmVjdCBpbnN0YW5jZSB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIGB0cnVlYCB3aGVuIFJlY3RzIGFyZSBlcXVhbC4gYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBpc0VxdWFsKGFub3RoZXJSZWN0KSB7XG4gICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiByZWN0UHJvcGVydGllcyl7XG4gICAgICAgICAgICBpZiAodGhpc1twcm9wXSAhPT0gYW5vdGhlclJlY3RbcHJvcF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBhIHJlY3QgZnVsbHkgY29udGFpbnMgYW5vdGhlciByZWN0IGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gYW5vdGhlclJlY3Rcblx0ICogQHJldHVybnMgYHRydWVgIGlmIGNvbnRhaW5zLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGNvbnRhaW5zKGFub3RoZXJSZWN0KSB7XG4gICAgICAgIGNvbnN0IGludGVyc2VjdFJlY3QgPSB0aGlzLmdldEludGVyc2VjdGlvbihhbm90aGVyUmVjdCk7XG4gICAgICAgIHJldHVybiAhIShpbnRlcnNlY3RSZWN0ICYmIGludGVyc2VjdFJlY3QuaXNFcXVhbChhbm90aGVyUmVjdCkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVjYWxjdWxhdGVzIHNjcmVlbiBjb29yZGluYXRlcyB0byBjb29yZGluYXRlcyByZWxhdGl2ZSB0byB0aGUgcG9zaXRpb25lZCBhbmNlc3RvciBvZmZzZXQuXG5cdCAqLyB0b0Fic29sdXRlUmVjdCgpIHtcbiAgICAgICAgY29uc3QgeyBzY3JvbGxYLCBzY3JvbGxZIH0gPSBnbG9iYWwud2luZG93O1xuICAgICAgICBjb25zdCBhYnNvbHV0ZVJlY3QgPSB0aGlzLmNsb25lKCkubW92ZUJ5KHNjcm9sbFgsIHNjcm9sbFkpO1xuICAgICAgICBpZiAoaXNEb21FbGVtZW50KGFic29sdXRlUmVjdC5fc291cmNlKSkge1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb25lZEFuY2VzdG9yID0gZ2V0UG9zaXRpb25lZEFuY2VzdG9yKGFic29sdXRlUmVjdC5fc291cmNlKTtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbmVkQW5jZXN0b3IpIHtcbiAgICAgICAgICAgICAgICBzaGlmdFJlY3RUb0NvbXBlbnNhdGVQb3NpdGlvbmVkQW5jZXN0b3IoYWJzb2x1dGVSZWN0LCBwb3NpdGlvbmVkQW5jZXN0b3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhYnNvbHV0ZVJlY3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGNsdWRlcyBzY3JvbGxiYXJzIGFuZCBDU1MgYm9yZGVycyBmcm9tIHRoZSByZWN0LlxuXHQgKlxuXHQgKiAqIEJvcmRlcnMgYXJlIHJlbW92ZWQgd2hlbiB7QGxpbmsgI19zb3VyY2V9IGlzIGFuIEhUTUwgZWxlbWVudC5cblx0ICogKiBTY3JvbGxiYXJzIGFyZSBleGNsdWRlZCBmcm9tIEhUTUwgZWxlbWVudHMgYW5kIHRoZSBgd2luZG93YC5cblx0ICpcblx0ICogQHJldHVybnMgQSByZWN0IHdoaWNoIGhhcyBiZWVuIHVwZGF0ZWQuXG5cdCAqLyBleGNsdWRlU2Nyb2xsYmFyc0FuZEJvcmRlcnMoKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IHRoaXMuX3NvdXJjZTtcbiAgICAgICAgbGV0IHNjcm9sbEJhcldpZHRoLCBzY3JvbGxCYXJIZWlnaHQsIGRpcmVjdGlvbjtcbiAgICAgICAgaWYgKGlzV2luZG93KHNvdXJjZSkpIHtcbiAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoID0gc291cmNlLmlubmVyV2lkdGggLSBzb3VyY2UuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xuICAgICAgICAgICAgc2Nyb2xsQmFySGVpZ2h0ID0gc291cmNlLmlubmVySGVpZ2h0IC0gc291cmNlLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSBzb3VyY2UuZ2V0Q29tcHV0ZWRTdHlsZShzb3VyY2UuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5kaXJlY3Rpb247XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBib3JkZXJXaWR0aHMgPSBnZXRCb3JkZXJXaWR0aHMoc291cmNlKTtcbiAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoID0gc291cmNlLm9mZnNldFdpZHRoIC0gc291cmNlLmNsaWVudFdpZHRoIC0gYm9yZGVyV2lkdGhzLmxlZnQgLSBib3JkZXJXaWR0aHMucmlnaHQ7XG4gICAgICAgICAgICBzY3JvbGxCYXJIZWlnaHQgPSBzb3VyY2Uub2Zmc2V0SGVpZ2h0IC0gc291cmNlLmNsaWVudEhlaWdodCAtIGJvcmRlcldpZHRocy50b3AgLSBib3JkZXJXaWR0aHMuYm90dG9tO1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gc291cmNlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShzb3VyY2UpLmRpcmVjdGlvbjtcbiAgICAgICAgICAgIHRoaXMubGVmdCArPSBib3JkZXJXaWR0aHMubGVmdDtcbiAgICAgICAgICAgIHRoaXMudG9wICs9IGJvcmRlcldpZHRocy50b3A7XG4gICAgICAgICAgICB0aGlzLnJpZ2h0IC09IGJvcmRlcldpZHRocy5yaWdodDtcbiAgICAgICAgICAgIHRoaXMuYm90dG9tIC09IGJvcmRlcldpZHRocy5ib3R0b207XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5yaWdodCAtIHRoaXMubGVmdDtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5ib3R0b20gLSB0aGlzLnRvcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndpZHRoIC09IHNjcm9sbEJhcldpZHRoO1xuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnbHRyJykge1xuICAgICAgICAgICAgdGhpcy5yaWdodCAtPSBzY3JvbGxCYXJXaWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGVmdCArPSBzY3JvbGxCYXJXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhlaWdodCAtPSBzY3JvbGxCYXJIZWlnaHQ7XG4gICAgICAgIHRoaXMuYm90dG9tIC09IHNjcm9sbEJhckhlaWdodDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGFycmF5IG9mIHJlY3RzIG9mIHRoZSBnaXZlbiBuYXRpdmUgRE9NIFJhbmdlLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2UgQSBuYXRpdmUgRE9NIHJhbmdlLlxuXHQgKiBAcmV0dXJucyBET00gUmFuZ2UgcmVjdHMuXG5cdCAqLyBzdGF0aWMgZ2V0RG9tUmFuZ2VSZWN0cyhyYW5nZSkge1xuICAgICAgICBjb25zdCByZWN0cyA9IFtdO1xuICAgICAgICAvLyBTYWZhcmkgZG9lcyBub3QgaXRlcmF0ZSBvdmVyIENsaWVudFJlY3RMaXN0IHVzaW5nIGZvci4uLm9mIGxvb3AuXG4gICAgICAgIGNvbnN0IGNsaWVudFJlY3RzID0gQXJyYXkuZnJvbShyYW5nZS5nZXRDbGllbnRSZWN0cygpKTtcbiAgICAgICAgaWYgKGNsaWVudFJlY3RzLmxlbmd0aCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCByZWN0IG9mIGNsaWVudFJlY3RzKXtcbiAgICAgICAgICAgICAgICByZWN0cy5wdXNoKG5ldyBSZWN0KHJlY3QpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBzdGFydENvbnRhaW5lciA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyO1xuICAgICAgICAgICAgaWYgKGlzVGV4dChzdGFydENvbnRhaW5lcikpIHtcbiAgICAgICAgICAgICAgICBzdGFydENvbnRhaW5lciA9IHN0YXJ0Q29udGFpbmVyLnBhcmVudE5vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZWN0ID0gbmV3IFJlY3Qoc3RhcnRDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpO1xuICAgICAgICAgICAgcmVjdC5yaWdodCA9IHJlY3QubGVmdDtcbiAgICAgICAgICAgIHJlY3Qud2lkdGggPSAwO1xuICAgICAgICAgICAgcmVjdHMucHVzaChyZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVjdHM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgYm91bmRpbmcgcmVjdGFuZ2xlIHRoYXQgY29udGFpbnMgYWxsIHRoZSBnaXZlbiBgcmVjdHNgLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmVjdHMgQSBsaXN0IG9mIHJlY3RhbmdsZXMgdGhhdCBzaG91bGQgYmUgY29udGFpbmVkIGluIHRoZSByZXN1bHQgcmVjdGFuZ2xlLlxuXHQgKiBAcmV0dXJucyBCb3VuZGluZyByZWN0YW5nbGUgb3IgYG51bGxgIGlmIG5vIGByZWN0c2Agd2VyZSBnaXZlbi5cblx0ICovIHN0YXRpYyBnZXRCb3VuZGluZ1JlY3QocmVjdHMpIHtcbiAgICAgICAgY29uc3QgYm91bmRpbmdSZWN0RGF0YSA9IHtcbiAgICAgICAgICAgIGxlZnQ6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxcbiAgICAgICAgICAgIHRvcDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLFxuICAgICAgICAgICAgcmlnaHQ6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSxcbiAgICAgICAgICAgIGJvdHRvbTogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLFxuICAgICAgICAgICAgd2lkdGg6IDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDBcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IHJlY3RhbmdsZUNvdW50ID0gMDtcbiAgICAgICAgZm9yIChjb25zdCByZWN0IG9mIHJlY3RzKXtcbiAgICAgICAgICAgIHJlY3RhbmdsZUNvdW50Kys7XG4gICAgICAgICAgICBib3VuZGluZ1JlY3REYXRhLmxlZnQgPSBNYXRoLm1pbihib3VuZGluZ1JlY3REYXRhLmxlZnQsIHJlY3QubGVmdCk7XG4gICAgICAgICAgICBib3VuZGluZ1JlY3REYXRhLnRvcCA9IE1hdGgubWluKGJvdW5kaW5nUmVjdERhdGEudG9wLCByZWN0LnRvcCk7XG4gICAgICAgICAgICBib3VuZGluZ1JlY3REYXRhLnJpZ2h0ID0gTWF0aC5tYXgoYm91bmRpbmdSZWN0RGF0YS5yaWdodCwgcmVjdC5yaWdodCk7XG4gICAgICAgICAgICBib3VuZGluZ1JlY3REYXRhLmJvdHRvbSA9IE1hdGgubWF4KGJvdW5kaW5nUmVjdERhdGEuYm90dG9tLCByZWN0LmJvdHRvbSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlY3RhbmdsZUNvdW50ID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGJvdW5kaW5nUmVjdERhdGEud2lkdGggPSBib3VuZGluZ1JlY3REYXRhLnJpZ2h0IC0gYm91bmRpbmdSZWN0RGF0YS5sZWZ0O1xuICAgICAgICBib3VuZGluZ1JlY3REYXRhLmhlaWdodCA9IGJvdW5kaW5nUmVjdERhdGEuYm90dG9tIC0gYm91bmRpbmdSZWN0RGF0YS50b3A7XG4gICAgICAgIHJldHVybiBuZXcgUmVjdChib3VuZGluZ1JlY3REYXRhKTtcbiAgICB9XG59XG4vKipcbiAqIEFjcXVpcmVzIGFsbCB0aGUgcmVjdCBwcm9wZXJ0aWVzIGZyb20gdGhlIHBhc3NlZCBzb3VyY2UuXG4gKi8gZnVuY3Rpb24gY29weVJlY3RQcm9wZXJ0aWVzKHJlY3QsIHNvdXJjZSkge1xuICAgIGZvciAoY29uc3QgcCBvZiByZWN0UHJvcGVydGllcyl7XG4gICAgICAgIHJlY3RbcF0gPSBzb3VyY2VbcF07XG4gICAgfVxufVxuLyoqXG4gKiBDaGVja3MgaWYgcHJvdmlkZWQgb2JqZWN0IGlzIGEgPGJvZHk+IEhUTUwgZWxlbWVudC5cbiAqLyBmdW5jdGlvbiBpc0JvZHkodmFsdWUpIHtcbiAgICBpZiAoIWlzRG9tRWxlbWVudCh2YWx1ZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlLm93bmVyRG9jdW1lbnQuYm9keTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHByb3ZpZGVkIG9iamVjdCBcImxvb2tzIGxpa2VcIiBhIERPTSBFbGVtZW50IGFuZCBoYXMgQVBJIHJlcXVpcmVkIGJ5IGBSZWN0YCBjbGFzcy5cbiAqLyBmdW5jdGlvbiBpc0RvbUVsZW1lbnQodmFsdWUpIHtcbiAgICAvLyBOb3RlOiBlYXJsaWVyIHdlIHVzZWQgYGlzRWxlbWVudCgpYCBmcm9tIGxvZGFzaCBsaWJyYXJ5LCBob3dldmVyIHRoYXQgZnVuY3Rpb24gaXMgbGVzcyBwZXJmb3JtYW50IGJlY2F1c2VcbiAgICAvLyBpdCBtYWtlcyBjb21wbGljYXRlZCBjaGVja3MgdG8gbWFrZSBzdXJlIHRoYXQgZ2l2ZW4gdmFsdWUgaXMgYSBET00gZWxlbWVudC5cbiAgICByZXR1cm4gdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZS5ub2RlVHlwZSA9PT0gMSAmJiB0eXBlb2YgdmFsdWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0ID09PSAnZnVuY3Rpb24nO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgYHBvc2l0aW9uYCBzdHlsZSBvZiBhbiBgSFRNTEVsZW1lbnRgLlxuICovIGZ1bmN0aW9uIGdldEVsZW1lbnRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLnBvc2l0aW9uIDogJ3N0YXRpYyc7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBgb3ZlcmZsb3dgIHN0eWxlIG9mIGFuIGBIVE1MRWxlbWVudGAgb3IgYSBgUmFuZ2VgLlxuICovIGZ1bmN0aW9uIGdldEVsZW1lbnRPdmVyZmxvdyhlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLm92ZXJmbG93IDogJ3Zpc2libGUnO1xufVxuLyoqXG4gKiBGb3IgYSBnaXZlbiBhYnNvbHV0ZSBSZWN0IGNvb3JkaW5hdGVzIG9iamVjdCBhbmQgYSBwb3NpdGlvbmVkIGVsZW1lbnQgYW5jZXN0b3IsIGl0IHVwZGF0ZXMgaXRzXG4gKiBjb29yZGluYXRlcyB0aGF0IG1ha2UgdXAgZm9yIHRoZSBwb3NpdGlvbiBhbmQgdGhlIHNjcm9sbCBvZiB0aGUgYW5jZXN0b3IuXG4gKlxuICogVGhpcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSB3aGlsZSBSZWN0cyAoYW5kIERPTVJlY3RzKSBhcmUgcmVsYXRpdmUgdG8gdGhlIGJyb3dzZXIncyB2aWV3cG9ydCwgdGhlaXIgY29vcmRpbmF0ZXNcbiAqIGFyZSB1c2VkIGluIHJlYWzigJNsaWZlIHRvIHBvc2l0aW9uIGVsZW1lbnRzIHdpdGggYHBvc2l0aW9uOiBhYnNvbHV0ZWAsIHdoaWNoIGFyZSBzY29wZWQgYnkgYW55IHBvc2l0aW9uZWRcbiAqIChhbmQgc2Nyb2xsYWJsZSkgYW5jZXN0b3JzLlxuICovIGZ1bmN0aW9uIHNoaWZ0UmVjdFRvQ29tcGVuc2F0ZVBvc2l0aW9uZWRBbmNlc3RvcihyZWN0LCBwb3NpdGlvbmVkRWxlbWVudEFuY2VzdG9yKSB7XG4gICAgY29uc3QgYW5jZXN0b3JQb3NpdGlvbiA9IG5ldyBSZWN0KHBvc2l0aW9uZWRFbGVtZW50QW5jZXN0b3IpO1xuICAgIGNvbnN0IGFuY2VzdG9yQm9yZGVyV2lkdGhzID0gZ2V0Qm9yZGVyV2lkdGhzKHBvc2l0aW9uZWRFbGVtZW50QW5jZXN0b3IpO1xuICAgIGxldCBtb3ZlWCA9IDA7XG4gICAgbGV0IG1vdmVZID0gMDtcbiAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS11aS1kZWZhdWx0L2lzc3Vlcy8xMjYpXG4gICAgLy8gSWYgdGhlcmUncyBzb21lIHBvc2l0aW9uZWQgYW5jZXN0b3Igb2YgdGhlIHBhbmVsLCB0aGVuIGl0cyBgUmVjdGAgbXVzdCBiZSB0YWtlbiBpbnRvXG4gICAgLy8gY29uc2lkZXJhdGlvbi4gYFJlY3RgIGlzIGFsd2F5cyByZWxhdGl2ZSB0byB0aGUgdmlld3BvcnQgd2hpbGUgYHBvc2l0aW9uOiBhYnNvbHV0ZWAgd29ya3NcbiAgICAvLyB3aXRoIHJlc3BlY3QgdG8gdGhhdCBwb3NpdGlvbmVkIGFuY2VzdG9yLlxuICAgIG1vdmVYIC09IGFuY2VzdG9yUG9zaXRpb24ubGVmdDtcbiAgICBtb3ZlWSAtPSBhbmNlc3RvclBvc2l0aW9uLnRvcDtcbiAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9pc3N1ZXMvMTM5KVxuICAgIC8vIElmIHRoZXJlJ3Mgc29tZSBwb3NpdGlvbmVkIGFuY2VzdG9yIG9mIHRoZSBwYW5lbCwgbm90IG9ubHkgaXRzIHBvc2l0aW9uIG11c3QgYmUgdGFrZW4gaW50b1xuICAgIC8vIGNvbnNpZGVyYXRpb24gKHNlZSBhYm92ZSkgYnV0IGFsc28gaXRzIGludGVybmFsIHNjcm9sbHMuIFNjcm9sbCBoYXZlIGFuIGltcGFjdCBoZXJlIGJlY2F1c2UgYFJlY3RgXG4gICAgLy8gaXMgcmVsYXRpdmUgdG8gdGhlIHZpZXdwb3J0IChpdCBkb2Vzbid0IGNhcmUgYWJvdXQgc2Nyb2xsaW5nKSwgd2hpbGUgYHBvc2l0aW9uOiBhYnNvbHV0ZWBcbiAgICAvLyBtdXN0IGNvbXBlbnNhdGUgdGhhdCBzY3JvbGxpbmcuXG4gICAgbW92ZVggKz0gcG9zaXRpb25lZEVsZW1lbnRBbmNlc3Rvci5zY3JvbGxMZWZ0O1xuICAgIG1vdmVZICs9IHBvc2l0aW9uZWRFbGVtZW50QW5jZXN0b3Iuc2Nyb2xsVG9wO1xuICAgIC8vIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL2lzc3Vlcy8xMzkpXG4gICAgLy8gSWYgdGhlcmUncyBzb21lIHBvc2l0aW9uZWQgYW5jZXN0b3Igb2YgdGhlIHBhbmVsLCB0aGVuIGl0cyBgUmVjdGAgaW5jbHVkZXMgaXRzIENTUyBgYm9yZGVyV2lkdGhgXG4gICAgLy8gd2hpbGUgYHBvc2l0aW9uOiBhYnNvbHV0ZWAgcG9zaXRpb25pbmcgZG9lcyBub3QgY29uc2lkZXIgaXQuXG4gICAgLy8gRS5nLiBgeyBwb3NpdGlvbjogYWJzb2x1dGUsIHRvcDogMCwgbGVmdDogMCB9YCBtZWFucyB1cHBlciBsZWZ0IGNvcm5lciBvZiB0aGUgZWxlbWVudCxcbiAgICAvLyBub3QgdXBwZXItbGVmdCBjb3JuZXIgb2YgaXRzIGJvcmRlci5cbiAgICBtb3ZlWCAtPSBhbmNlc3RvckJvcmRlcldpZHRocy5sZWZ0O1xuICAgIG1vdmVZIC09IGFuY2VzdG9yQm9yZGVyV2lkdGhzLnRvcDtcbiAgICByZWN0Lm1vdmVCeShtb3ZlWCwgbW92ZVkpO1xufVxuXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHdoaWNoIGluc3RhbmNlcyBhbGxvdyBwZXJmb3JtaW5nIGN1c3RvbSBhY3Rpb25zIHdoZW4gbmF0aXZlIERPTSBlbGVtZW50cyBhcmUgcmVzaXplZC5cbiAqXG4gKiBgYGB0c1xuICogY29uc3QgZWRpdGFibGVFbGVtZW50ID0gZWRpdG9yLmVkaXRpbmcudmlldy5nZXREb21Sb290KCk7XG4gKlxuICogY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoIGVkaXRhYmxlRWxlbWVudCwgZW50cnkgPT4ge1xuICogXHRjb25zb2xlLmxvZyggJ1RoZSBlZGl0YWJsZSBlbGVtZW50IGhhcyBiZWVuIHJlc2l6ZWQgaW4gRE9NLicgKTtcbiAqIFx0Y29uc29sZS5sb2coIGVudHJ5LnRhcmdldCApOyAvLyAtPiBlZGl0YWJsZUVsZW1lbnRcbiAqIFx0Y29uc29sZS5sb2coIGVudHJ5LmNvbnRlbnRSZWN0LndpZHRoICk7IC8vIC0+IGUuZy4gJzQyM3B4J1xuICogfSApO1xuICogYGBgXG4gKlxuICogSXQgdXNlcyB0aGUgW25hdGl2ZSBET00gcmVzaXplIG9ic2VydmVyXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvUmVzaXplT2JzZXJ2ZXIpXG4gKiB1bmRlciB0aGUgaG9vZC5cbiAqLyBjbGFzcyBSZXNpemVPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIFRoZSBlbGVtZW50IG9ic2VydmVkIGJ5IHRoaXMgb2JzZXJ2ZXIuXG5cdCAqLyBfZWxlbWVudDtcbiAgICAvKipcblx0ICogVGhlIGNhbGxiYWNrIGV4ZWN1dGVkIGVhY2ggdGltZSB7QGxpbmsgI19lbGVtZW50fSBpcyByZXNpemVkLlxuXHQgKi8gX2NhbGxiYWNrO1xuICAgIC8qKlxuXHQgKiBUaGUgc2luZ2xlIG5hdGl2ZSBvYnNlcnZlciBpbnN0YW5jZSBzaGFyZWQgYWNyb3NzIGFsbCB7QGxpbmsgbW9kdWxlOnV0aWxzL2RvbS9yZXNpemVvYnNlcnZlcn5SZXNpemVPYnNlcnZlcn0gaW5zdGFuY2VzLlxuXHQgKi8gc3RhdGljIF9vYnNlcnZlckluc3RhbmNlID0gbnVsbDtcbiAgICAvKipcblx0ICogQSBtYXBwaW5nIG9mIG5hdGl2ZSBET00gZWxlbWVudHMgYW5kIHRoZWlyIGNhbGxiYWNrcyBzaGFyZWQgYWNyb3NzIGFsbFxuXHQgKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2RvbS9yZXNpemVvYnNlcnZlcn5SZXNpemVPYnNlcnZlcn0gaW5zdGFuY2VzLlxuXHQgKi8gc3RhdGljIF9lbGVtZW50Q2FsbGJhY2tzID0gbnVsbDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgYFJlc2l6ZU9ic2VydmVyYCBjbGFzcy5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgQSBET00gZWxlbWVudCB0aGF0IGlzIHRvIGJlIG9ic2VydmVkIGZvciByZXNpemluZy4gTm90ZSB0aGF0XG5cdCAqIHRoZSBlbGVtZW50IG11c3QgYmUgdmlzaWJsZSAoaS5lLiBub3QgZGV0YWNoZWQgZnJvbSBET00pIGZvciB0aGUgb2JzZXJ2ZXIgdG8gd29yay5cblx0ICogQHBhcmFtIGNhbGxiYWNrIEEgZnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIG9ic2VydmVkIGVsZW1lbnQgd2FzIHJlc2l6ZWQuIEl0IHBhc3Nlc1xuXHQgKiB0aGUgW2BSZXNpemVPYnNlcnZlckVudHJ5YF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1Jlc2l6ZU9ic2VydmVyRW50cnkpXG5cdCAqIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSByZXNpemUgZXZlbnQuXG5cdCAqLyBjb25zdHJ1Y3RvcihlbGVtZW50LCBjYWxsYmFjayl7XG4gICAgICAgIC8vICoqTm90ZSoqOiBGb3IgdGhlIG1heGltdW0gcGVyZm9ybWFuY2UsIHRoaXMgY2xhc3MgZW5zdXJlcyBvbmx5IGEgc2luZ2xlIGluc3RhbmNlIG9mIHRoZSBuYXRpdmVcbiAgICAgICAgLy8gb2JzZXJ2ZXIgaXMgdXNlZCBubyBtYXR0ZXIgaG93IG1hbnkgaW5zdGFuY2VzIG9mIHRoaXMgY2xhc3Mgd2VyZSBjcmVhdGVkLlxuICAgICAgICBpZiAoIVJlc2l6ZU9ic2VydmVyLl9vYnNlcnZlckluc3RhbmNlKSB7XG4gICAgICAgICAgICBSZXNpemVPYnNlcnZlci5fY3JlYXRlT2JzZXJ2ZXIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy5fY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgUmVzaXplT2JzZXJ2ZXIuX2FkZEVsZW1lbnRDYWxsYmFjayhlbGVtZW50LCBjYWxsYmFjayk7XG4gICAgICAgIFJlc2l6ZU9ic2VydmVyLl9vYnNlcnZlckluc3RhbmNlLm9ic2VydmUoZWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgZWxlbWVudCBvYnNlcnZlZCBieSB0aGlzIG9ic2VydmVyLlxuXHQgKi8gZ2V0IGVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogRGVzdHJveXMgdGhlIG9ic2VydmVyIHdoaWNoIGRpc2FibGVzIHRoZSBgY2FsbGJhY2tgIHBhc3NlZCB0byB0aGUge0BsaW5rICNjb25zdHJ1Y3Rvcn0uXG5cdCAqLyBkZXN0cm95KCkge1xuICAgICAgICBSZXNpemVPYnNlcnZlci5fZGVsZXRlRWxlbWVudENhbGxiYWNrKHRoaXMuX2VsZW1lbnQsIHRoaXMuX2NhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIG5ldyByZXNpemUgY2FsbGJhY2sgZm9yIHRoZSBET00gZWxlbWVudC5cblx0ICovIHN0YXRpYyBfYWRkRWxlbWVudENhbGxiYWNrKGVsZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghUmVzaXplT2JzZXJ2ZXIuX2VsZW1lbnRDYWxsYmFja3MpIHtcbiAgICAgICAgICAgIFJlc2l6ZU9ic2VydmVyLl9lbGVtZW50Q2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjYWxsYmFja3MgPSBSZXNpemVPYnNlcnZlci5fZWxlbWVudENhbGxiYWNrcy5nZXQoZWxlbWVudCk7XG4gICAgICAgIGlmICghY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICBjYWxsYmFja3MgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICBSZXNpemVPYnNlcnZlci5fZWxlbWVudENhbGxiYWNrcy5zZXQoZWxlbWVudCwgY2FsbGJhY2tzKTtcbiAgICAgICAgfVxuICAgICAgICBjYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYSByZXNpemUgY2FsbGJhY2sgZnJvbSB0aGUgRE9NIGVsZW1lbnQuIElmIG5vIGNhbGxiYWNrcyBhcmUgbGVmdFxuXHQgKiBmb3IgdGhlIGVsZW1lbnQsIGl0IHJlbW92ZXMgdGhlIGVsZW1lbnQgZnJvbSB0aGUgbmF0aXZlIG9ic2VydmVyLlxuXHQgKi8gc3RhdGljIF9kZWxldGVFbGVtZW50Q2FsbGJhY2soZWxlbWVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gUmVzaXplT2JzZXJ2ZXIuX2dldEVsZW1lbnRDYWxsYmFja3MoZWxlbWVudCk7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZWxlbWVudCBjYWxsYmFjay4gQ2hlY2sgaWYgZXhpc3QgZmlyc3QgaW4gY2FzZSBzb21lb25lXG4gICAgICAgIC8vIGNhbGxlZCBkZXN0cm95KCkgdHdpY2UuXG4gICAgICAgIGlmIChjYWxsYmFja3MpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrcy5kZWxldGUoY2FsbGJhY2spO1xuICAgICAgICAgICAgLy8gSWYgbm8gY2FsbGJhY2tzIGxlZnQgZm9yIHRoZSBlbGVtZW50LCBhbHNvIHJlbW92ZSB0aGUgZWxlbWVudC5cbiAgICAgICAgICAgIGlmICghY2FsbGJhY2tzLnNpemUpIHtcbiAgICAgICAgICAgICAgICBSZXNpemVPYnNlcnZlci5fZWxlbWVudENhbGxiYWNrcy5kZWxldGUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgUmVzaXplT2JzZXJ2ZXIuX29ic2VydmVySW5zdGFuY2UudW5vYnNlcnZlKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChSZXNpemVPYnNlcnZlci5fZWxlbWVudENhbGxiYWNrcyAmJiAhUmVzaXplT2JzZXJ2ZXIuX2VsZW1lbnRDYWxsYmFja3Muc2l6ZSkge1xuICAgICAgICAgICAgUmVzaXplT2JzZXJ2ZXIuX29ic2VydmVySW5zdGFuY2UgPSBudWxsO1xuICAgICAgICAgICAgUmVzaXplT2JzZXJ2ZXIuX2VsZW1lbnRDYWxsYmFja3MgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFyZSByZWdpc3RlcmVkIHJlc2l6ZSBjYWxsYmFja3MgZm9yIHRoZSBET00gZWxlbWVudC5cblx0ICovIHN0YXRpYyBfZ2V0RWxlbWVudENhbGxiYWNrcyhlbGVtZW50KSB7XG4gICAgICAgIGlmICghUmVzaXplT2JzZXJ2ZXIuX2VsZW1lbnRDYWxsYmFja3MpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSZXNpemVPYnNlcnZlci5fZWxlbWVudENhbGxiYWNrcy5nZXQoZWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIHRoZSBzaW5nbGUgbmF0aXZlIG9ic2VydmVyIHNoYXJlZCBhY3Jvc3MgYWxsIGBSZXNpemVPYnNlcnZlcmAgaW5zdGFuY2VzLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVPYnNlcnZlcigpIHtcbiAgICAgICAgUmVzaXplT2JzZXJ2ZXIuX29ic2VydmVySW5zdGFuY2UgPSBuZXcgZ2xvYmFsLndpbmRvdy5SZXNpemVPYnNlcnZlcigoZW50cmllcyk9PntcbiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gUmVzaXplT2JzZXJ2ZXIuX2dldEVsZW1lbnRDYWxsYmFja3MoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgY2FsbGJhY2tzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVudHJ5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS9zZXRkYXRhaW5lbGVtZW50XG4gKi8gLyogZ2xvYmFscyBIVE1MVGV4dEFyZWFFbGVtZW50ICovIC8qKlxuICogU2V0cyBkYXRhIGluIGEgZ2l2ZW4gZWxlbWVudC5cbiAqXG4gKiBAcGFyYW0gZWwgVGhlIGVsZW1lbnQgaW4gd2hpY2ggdGhlIGRhdGEgd2lsbCBiZSBzZXQuXG4gKiBAcGFyYW0gZGF0YSBUaGUgZGF0YSBzdHJpbmcuXG4gKi8gZnVuY3Rpb24gc2V0RGF0YUluRWxlbWVudChlbCwgZGF0YSkge1xuICAgIGlmIChlbCBpbnN0YW5jZW9mIEhUTUxUZXh0QXJlYUVsZW1lbnQpIHtcbiAgICAgICAgZWwudmFsdWUgPSBkYXRhO1xuICAgIH1cbiAgICBlbC5pbm5lckhUTUwgPSBkYXRhO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS90b3VuaXRcbiAqLyAvKipcbiAqIFJldHVybnMgYSBoZWxwZXIgZnVuY3Rpb24sIHdoaWNoIGFkZHMgYSBkZXNpcmVkIHRyYWlsaW5nXG4gKiBgdW5pdGAgdG8gdGhlIHBhc3NlZCB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0gdW5pdCBBbiB1bml0IGxpa2UgXCJweFwiIG9yIFwiZW1cIi5cbiAqLyBmdW5jdGlvbiB0b1VuaXQodW5pdCkge1xuICAgIHJldHVybiAodmFsdWUpPT52YWx1ZSArIHVuaXQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZG9tL2luZGV4b2ZcbiAqLyAvKipcbiAqIFJldHVybnMgaW5kZXggb2YgdGhlIG5vZGUgaW4gdGhlIHBhcmVudCBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBub2RlIE5vZGUgd2hpY2ggaW5kZXggaXMgdGVzdGVkLlxuICogQHJldHVybnMgSW5kZXggb2YgdGhlIG5vZGUgaW4gdGhlIHBhcmVudCBlbGVtZW50LiBSZXR1cm5zIDAgaWYgbm9kZSBoYXMgbm8gcGFyZW50LlxuICovIGZ1bmN0aW9uIGluZGV4T2Yobm9kZSkge1xuICAgIGxldCBpbmRleCA9IDA7XG4gICAgd2hpbGUobm9kZS5wcmV2aW91c1NpYmxpbmcpe1xuICAgICAgICBub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIGluZGV4Kys7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9kb20vaW5zZXJ0YXRcbiAqLyAvKipcbiAqIEluc2VydHMgbm9kZSB0byB0aGUgcGFyZW50IGF0IGdpdmVuIGluZGV4LlxuICpcbiAqIEBwYXJhbSBwYXJlbnRFbGVtZW50IFBhcmVudCBlbGVtZW50LlxuICogQHBhcmFtIGluZGV4IEluc2VydGlvbnMgaW5kZXguXG4gKiBAcGFyYW0gbm9kZVRvSW5zZXJ0IE5vZGUgdG8gaW5zZXJ0LlxuICovIGZ1bmN0aW9uIGluc2VydEF0KHBhcmVudEVsZW1lbnQsIGluZGV4LCBub2RlVG9JbnNlcnQpIHtcbiAgICBwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2RlVG9JbnNlcnQsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKiBnbG9iYWxzIE5vZGUgKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS9pc2NvbW1lbnRcbiAqLyAvKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBvYmplY3QgaXMgYSBuYXRpdmUgRE9NIENvbW1lbnQgbm9kZS5cbiAqLyBmdW5jdGlvbiBpc0NvbW1lbnQob2JqKSB7XG4gICAgcmV0dXJuIG9iaiAmJiBvYmoubm9kZVR5cGUgPT09IE5vZGUuQ09NTUVOVF9OT0RFO1xufVxuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gYXR0cmlidXRlIG5hbWUgaXMgdmFsaWQgaW4gdGVybXMgb2YgSFRNTC5cbiAqXG4gKiBAcGFyYW0gbmFtZSBBdHRyaWJ1dGUgbmFtZS5cbiAqLyBmdW5jdGlvbiBpc1ZhbGlkQXR0cmlidXRlTmFtZShuYW1lKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZ2xvYmFsLmRvY3VtZW50LmNyZWF0ZUF0dHJpYnV0ZShuYW1lKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBlbGVtZW50IGlzIHZpc2libGUgdG8gdGhlIHVzZXIgaW4gRE9NOlxuICpcbiAqICogY29ubmVjdGVkIHRvIHRoZSByb290IG9mIHRoZSBkb2N1bWVudCxcbiAqICogaGFzIG5vIGBkaXNwbGF5OiBub25lYCxcbiAqICogaGFzIG5vIGFuY2VzdG9ycyB3aXRoIGBkaXNwbGF5OiBub25lYC5cbiAqXG4gKiAqKk5vdGUqKjogVGhpcyBoZWxwZXIgZG9lcyBub3QgY2hlY2sgd2hldGhlciB0aGUgZWxlbWVudCBpcyBoaWRkZW4gYnkgY3JvcHBpbmcsIG92ZXJmbG93LCBldGMuLlxuICogVG8gY2hlY2sgdGhhdCwgdXNlIHtAbGluayBtb2R1bGU6dXRpbHMvZG9tL3JlY3R+UmVjdH0gaW5zdGVhZC5cbiAqLyBmdW5jdGlvbiBpc1Zpc2libGUoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChpc1RleHQoZWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIGlzVmlzaWJsZShlbGVtZW50LnBhcmVudEVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5nZXRDbGllbnRSZWN0cykge1xuICAgICAgICByZXR1cm4gISFlbGVtZW50LmdldENsaWVudFJlY3RzKCkubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBjb25zdCB7XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gXHRkZWZhdWx0OiBSZWN0RHJhd2VyLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0ZGlhZ29uYWxTdHlsZXNCbGFjayxcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBcdGRpYWdvbmFsU3R5bGVzR3JlZW4sXG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gXHRkaWFnb25hbFN0eWxlc1JlZFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIH0gPSByZXF1aXJlKCAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy90ZXN0cy9fdXRpbHMvcmVjdGRyYXdlcicgKTtcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBjb25zdCBUQVJHRVRfUkVDVF9TVFlMRSA9IHtcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBcdG91dGxpbmVXaWR0aDogJzJweCcsIG91dGxpbmVTdHlsZTogJ2Rhc2hlZCcsIG91dGxpbmVDb2xvcjogJ2JsdWUnLCBvdXRsaW5lT2Zmc2V0OiAnMnB4J1xuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIH07XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gY29uc3QgVklTSUJMRV9UQVJHRVRfUkVDVF9TVFlMRSA9IHtcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvL1x0XHQuLi5kaWFnb25hbFN0eWxlc0JsYWNrLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRcdG9wYWNpdHk6ICcxJyxcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvL1x0XHRiYWNrZ3JvdW5kQ29sb3I6ICcjMDAwMDAwMzMnLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRcdG91dGxpbmVXaWR0aDogJzJweCdcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyB9O1xuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIGNvbnN0IFZJRVdQT1JUX1JFQ1RfU1RZTEUgPSB7XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gXHRvdXRsaW5lV2lkdGg6ICcycHgnLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0b3V0bGluZU9mZnNldDogJy0ycHgnLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0b3V0bGluZVN0eWxlOiAnc29saWQnLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0b3V0bGluZUNvbG9yOiAncmVkJ1xuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIH07XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gY29uc3QgVklTSUJMRV9MSU1JVEVSX1JFQ1RfU1RZTEUgPSB7XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gXHQuLi5kaWFnb25hbFN0eWxlc0dyZWVuLFxuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0b3V0bGluZVdpZHRoOiAnMnB4Jyxcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBcdG91dGxpbmVPZmZzZXQ6ICctMnB4J1xuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIH07XG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gY29uc3QgRUxFTUVOVF9SRUNUX1NUWUxFID0ge1xuLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0b3V0bGluZVdpZHRoOiAnMnB4Jywgb3V0bGluZUNvbG9yOiAnb3JhbmdlJywgb3V0bGluZU9mZnNldDogJy0ycHgnXG4vLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gfTtcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBjb25zdCBDSE9TRU5fUE9TSVRJT05fUkVDVF9TVFlMRSA9IHtcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyBcdG9wYWNpdHk6IC41LCBvdXRsaW5lQ29sb3I6ICdtYWdlbnRhJywgYmFja2dyb3VuZENvbG9yOiAnbWFnZW50YSdcbi8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyB9O1xuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBgcG9zaXRpb246IGFic29sdXRlYCBjb29yZGluYXRlcyBvZiBhIGdpdmVuIGVsZW1lbnQgc28gaXQgY2FuIGJlIHBvc2l0aW9uZWQgd2l0aCByZXNwZWN0IHRvIHRoZVxuICogdGFyZ2V0IGluIHRoZSB2aXN1YWxseSBtb3N0IGVmZmljaWVudCB3YXksIHRha2luZyB2YXJpb3VzIHJlc3RyaWN0aW9ucyBsaWtlIHZpZXdwb3J0IG9yIGxpbWl0ZXIgZ2VvbWV0cnlcbiAqIGludG8gY29uc2lkZXJhdGlvbi5cbiAqXG4gKiAqKk5vdGUqKjogSWYgdGhlcmUgYXJlIG5vIHBvc2l0aW9uIGNvb3JkaW5hdGVzIGZvdW5kIHRoYXQgbWVldCB0aGUgcmVxdWlyZW1lbnRzIChhcmd1bWVudHMgb2YgdGhpcyBoZWxwZXIpLFxuICogYG51bGxgIGlzIHJldHVybmVkLlxuICpcbiAqIGBgYHRzXG4gKiAvLyBUaGUgZWxlbWVudCB3aGljaCBpcyB0byBiZSBwb3NpdGlvbmVkLlxuICogY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvciggJyN0b29sYmFyJyApO1xuICpcbiAqIC8vIEEgdGFyZ2V0IHRvIHdoaWNoIHRoZSBlbGVtZW50IGlzIHBvc2l0aW9uZWQgcmVsYXRpdmVseS5cbiAqIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvciggJyNjb250YWluZXInICk7XG4gKlxuICogLy8gRmluZGluZyB0aGUgb3B0aW1hbCBjb29yZGluYXRlcyBmb3IgdGhlIHBvc2l0aW9uaW5nLlxuICogY29uc3QgeyBsZWZ0LCB0b3AsIG5hbWUgfSA9IGdldE9wdGltYWxQb3NpdGlvbigge1xuICogXHRlbGVtZW50OiBlbGVtZW50LFxuICogXHR0YXJnZXQ6IHRhcmdldCxcbiAqXG4gKiBcdC8vIFRoZSBhbGdvcml0aG0gd2lsbCBjaG9zZSBhbW9uZyB0aGVzZSBwb3NpdGlvbnMgdG8gbWVldCB0aGUgcmVxdWlyZW1lbnRzIHN1Y2hcbiAqIFx0Ly8gYXMgXCJsaW1pdGVyXCIgZWxlbWVudCBvciBcImZpdEluVmlld3BvcnRcIiwgc2V0IGJlbG93LiBUaGUgcG9zaXRpb25zIGFyZSBjb25zaWRlcmVkXG4gKiBcdC8vIGluIHRoZSBvcmRlciBvZiB0aGUgYXJyYXkuXG4gKiBcdHBvc2l0aW9uczogW1xuICogXHRcdC8vXG4gKiBcdCBcdC8vXHRbIFRhcmdldCBdXG4gKiBcdFx0Ly9cdCstLS0tLS0tLS0tLS0tLS0tLStcbiAqIFx0XHQvL1x0fCAgICAgRWxlbWVudCAgICAgfFxuICogXHRcdC8vXHQrLS0tLS0tLS0tLS0tLS0tLS0rXG4gKiBcdFx0Ly9cbiAqIFx0XHR0YXJnZXRSZWN0ID0+ICgge1xuICogXHRcdFx0dG9wOiB0YXJnZXRSZWN0LmJvdHRvbSxcbiAqIFx0XHRcdGxlZnQ6IHRhcmdldFJlY3QubGVmdCxcbiAqIFx0XHRcdG5hbWU6ICdteVNvdXRoRWFzdFBvc2l0aW9uJ1xuICogXHRcdH0gKSxcbiAqXG4gKiBcdFx0Ly9cbiAqIFx0XHQvL1x0Ky0tLS0tLS0tLS0tLS0tLS0tK1xuICogXHRcdC8vXHR8ICAgICBFbGVtZW50ICAgICB8XG4gKiBcdFx0Ly9cdCstLS0tLS0tLS0tLS0tLS0tLStcbiAqIFx0XHQvL1x0WyBUYXJnZXQgXVxuICogXHRcdC8vXG4gKiBcdFx0KCB0YXJnZXRSZWN0LCBlbGVtZW50UmVjdCApID0+ICgge1xuICogXHRcdFx0dG9wOiB0YXJnZXRSZWN0LnRvcCAtIGVsZW1lbnRSZWN0LmhlaWdodCxcbiAqIFx0XHRcdGxlZnQ6IHRhcmdldFJlY3QubGVmdCxcbiAqIFx0XHRcdG5hbWU6ICdteU5vcnRoRWFzdFBvc2l0aW9uJ1xuICogXHRcdH0gKVxuICogXHRdLFxuICpcbiAqIFx0Ly8gRmluZCBhIHBvc2l0aW9uIHN1Y2ggZ3VhcmFudGVlcyB0aGUgZWxlbWVudCByZW1haW5zIHdpdGhpbiB2aXNpYmxlIGJvdW5kYXJpZXMgb2YgPGJvZHk+LlxuICogXHRsaW1pdGVyOiBkb2N1bWVudC5ib2R5LFxuICpcbiAqIFx0Ly8gRmluZCBhIHBvc2l0aW9uIHN1Y2ggZ3VhcmFudGVlcyB0aGUgZWxlbWVudCByZW1haW5zIHdpdGhpbiB2aXNpYmxlIGJvdW5kYXJpZXMgb2YgdGhlIGJyb3dzZXIgdmlld3BvcnQuXG4gKiBcdGZpdEluVmlld3BvcnQ6IHRydWVcbiAqIH0gKTtcbiAqXG4gKiAvLyBUaGUgYmVzdCBwb3NpdGlvbiB3aGljaCBmaXRzIGludG8gZG9jdW1lbnQuYm9keSBhbmQgdGhlIHZpZXdwb3J0LiBNYXkgYmUgdXNlZnVsXG4gKiAvLyB0byBzZXQgcHJvcGVyIGNsYXNzIG9uIHRoZSBgZWxlbWVudGAuXG4gKiBjb25zb2xlLmxvZyggbmFtZSApOyAvLyAtPiBcIm15Tm9ydGhFYXN0UG9zaXRpb25cIlxuICpcbiAqIC8vIFVzaW5nIHRoZSBhYnNvbHV0ZSBjb29yZGluYXRlcyB3aGljaCBoYXMgYmVlbiBmb3VuZCB0byBwb3NpdGlvbiB0aGUgZWxlbWVudFxuICogLy8gYXMgaW4gdGhlIGRpYWdyYW0gZGVwaWN0aW5nIHRoZSBcIm15Tm9ydGhFYXN0UG9zaXRpb25cIiBwb3NpdGlvbi5cbiAqIGVsZW1lbnQuc3R5bGUudG9wID0gdG9wO1xuICogZWxlbWVudC5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBvcHRpb25zIFRoZSBpbnB1dCBkYXRhIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSBoZWxwZXIuXG4gKi8gZnVuY3Rpb24gZ2V0T3B0aW1hbFBvc2l0aW9uKHsgZWxlbWVudCwgdGFyZ2V0LCBwb3NpdGlvbnMsIGxpbWl0ZXIsIGZpdEluVmlld3BvcnQsIHZpZXdwb3J0T2Zmc2V0Q29uZmlnIH0pIHtcbiAgICAvLyBJZiB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+T3B0aW9ucyN0YXJnZXR9IGlzIGEgZnVuY3Rpb24sIHVzZSB3aGF0IGl0IHJldHVybnMuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9pc3N1ZXMvMTU3XG4gICAgaWYgKGlzRnVuY3Rpb24odGFyZ2V0KSkge1xuICAgICAgICB0YXJnZXQgPSB0YXJnZXQoKTtcbiAgICB9XG4gICAgLy8gSWYgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvZG9tL3Bvc2l0aW9ufk9wdGlvbnMjbGltaXRlcn0gaXMgYSBmdW5jdGlvbiwgdXNlIHdoYXQgaXQgcmV0dXJucy5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXVpL2lzc3Vlcy8yNjBcbiAgICBpZiAoaXNGdW5jdGlvbihsaW1pdGVyKSkge1xuICAgICAgICBsaW1pdGVyID0gbGltaXRlcigpO1xuICAgIH1cbiAgICBjb25zdCBwb3NpdGlvbmVkRWxlbWVudEFuY2VzdG9yID0gZ2V0UG9zaXRpb25lZEFuY2VzdG9yKGVsZW1lbnQpO1xuICAgIGNvbnN0IGNvbnN0cmFpbmVkVmlld3BvcnRSZWN0ID0gZ2V0Q29uc3RyYWluZWRWaWV3cG9ydFJlY3Qodmlld3BvcnRPZmZzZXRDb25maWcpO1xuICAgIGNvbnN0IGVsZW1lbnRSZWN0ID0gbmV3IFJlY3QoZWxlbWVudCk7XG4gICAgY29uc3QgdmlzaWJsZVRhcmdldFJlY3QgPSBnZXRWaXNpYmxlVmlld3BvcnRJbnRlcnNlY3Rpb25SZWN0KHRhcmdldCwgY29uc3RyYWluZWRWaWV3cG9ydFJlY3QpO1xuICAgIGxldCBiZXN0UG9zaXRpb247XG4gICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIGNvbnN0IHRhcmdldFJlY3QgPSBuZXcgUmVjdCggdGFyZ2V0ICk7XG4gICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFJlY3REcmF3ZXIuY2xlYXIoKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gUmVjdERyYXdlci5kcmF3KCB0YXJnZXRSZWN0LCBUQVJHRVRfUkVDVF9TVFlMRSwgJ1RhcmdldCcgKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gaWYgKCBjb25zdHJhaW5lZFZpZXdwb3J0UmVjdCApIHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy9cdFx0UmVjdERyYXdlci5kcmF3KCBjb25zdHJhaW5lZFZpZXdwb3J0UmVjdCwgVklFV1BPUlRfUkVDVF9TVFlMRSwgJ1ZpZXdwb3J0JyApO1xuICAgIC8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvLyB9XG4gICAgLy8gSWYgdGhlIHRhcmdldCBnb3QgY3JvcHBlZCBieSBhbmNlc3RvcnMgb3Igd2VudCBvZmYgdGhlIHNjcmVlbiwgcG9zaXRpb25pbmcgZG9lcyBub3QgbWFrZSBhbnkgc2Vuc2UuXG4gICAgaWYgKCF2aXNpYmxlVGFyZ2V0UmVjdCB8fCAhY29uc3RyYWluZWRWaWV3cG9ydFJlY3QuZ2V0SW50ZXJzZWN0aW9uKHZpc2libGVUYXJnZXRSZWN0KSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRSZWN0RHJhd2VyLmRyYXcoIHZpc2libGVUYXJnZXRSZWN0LCBWSVNJQkxFX1RBUkdFVF9SRUNUX1NUWUxFLCAnVmlzVGd0JyApO1xuICAgIGNvbnN0IHBvc2l0aW9uT3B0aW9ucyA9IHtcbiAgICAgICAgdGFyZ2V0UmVjdDogdmlzaWJsZVRhcmdldFJlY3QsXG4gICAgICAgIGVsZW1lbnRSZWN0LFxuICAgICAgICBwb3NpdGlvbmVkRWxlbWVudEFuY2VzdG9yLFxuICAgICAgICB2aWV3cG9ydFJlY3Q6IGNvbnN0cmFpbmVkVmlld3BvcnRSZWN0XG4gICAgfTtcbiAgICAvLyBJZiB0aGVyZSBhcmUgbm8gbGltaXRzLCBqdXN0IGdyYWIgdGhlIHZlcnkgZmlyc3QgcG9zaXRpb24gYW5kIGJlIGRvbmUgd2l0aCB0aGF0IGRyYW1hLlxuICAgIGlmICghbGltaXRlciAmJiAhZml0SW5WaWV3cG9ydCkge1xuICAgICAgICBiZXN0UG9zaXRpb24gPSBuZXcgUG9zaXRpb25PYmplY3QocG9zaXRpb25zWzBdLCBwb3NpdGlvbk9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChsaW1pdGVyKSB7XG4gICAgICAgICAgICBjb25zdCB2aXNpYmxlTGltaXRlclJlY3QgPSBnZXRWaXNpYmxlVmlld3BvcnRJbnRlcnNlY3Rpb25SZWN0KGxpbWl0ZXIsIGNvbnN0cmFpbmVkVmlld3BvcnRSZWN0KTtcbiAgICAgICAgICAgIGlmICh2aXNpYmxlTGltaXRlclJlY3QpIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbk9wdGlvbnMubGltaXRlclJlY3QgPSB2aXNpYmxlTGltaXRlclJlY3Q7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gUmVjdERyYXdlci5kcmF3KCB2aXNpYmxlTGltaXRlclJlY3QsIFZJU0lCTEVfTElNSVRFUl9SRUNUX1NUWUxFLCAnVmlzTGltJyApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZXJlJ3Mgbm8gYmVzdCBwb3NpdGlvbiBmb3VuZCwgaS5lLiB3aGVuIGFsbCBpbnRlcnNlY3Rpb25zIGhhdmUgbm8gYXJlYSBiZWNhdXNlXG4gICAgICAgIC8vIHJlY3RzIGhhdmUgbm8gd2lkdGggb3IgaGVpZ2h0LCB0aGVuIGp1c3QgcmV0dXJuIGBudWxsYFxuICAgICAgICBiZXN0UG9zaXRpb24gPSBnZXRCZXN0UG9zaXRpb24ocG9zaXRpb25zLCBwb3NpdGlvbk9wdGlvbnMpO1xuICAgIH1cbiAgICByZXR1cm4gYmVzdFBvc2l0aW9uO1xufVxuLyoqXG4gKiBSZXR1cm5zIGludGVyc2VjdGlvbiBvZiB2aXNpYmxlIHNvdXJjZSBgUmVjdGAgd2l0aCBWaWV3cG9ydCBgUmVjdGAuIEluIGNhc2Ugd2hlbiBzb3VyY2UgYFJlY3RgIGlzIG5vdCB2aXNpYmxlXG4gKiBvciB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24gYmV0d2VlbiBzb3VyY2UgYFJlY3RgIGFuZCBWaWV3cG9ydCBgUmVjdGAsIGBudWxsYCB3aWxsIGJlIHJldHVybmVkLlxuICovIGZ1bmN0aW9uIGdldFZpc2libGVWaWV3cG9ydEludGVyc2VjdGlvblJlY3Qoc291cmNlLCB2aWV3cG9ydFJlY3QpIHtcbiAgICBjb25zdCB2aXNpYmxlU291cmNlUmVjdCA9IG5ldyBSZWN0KHNvdXJjZSkuZ2V0VmlzaWJsZSgpO1xuICAgIGlmICghdmlzaWJsZVNvdXJjZVJlY3QpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB2aXNpYmxlU291cmNlUmVjdC5nZXRJbnRlcnNlY3Rpb24odmlld3BvcnRSZWN0KTtcbn1cbi8qKlxuICogUmV0dXJucyBhIHZpZXdwb3J0IGBSZWN0YCBzaHJ1bmsgYnkgdGhlIHZpZXdwb3J0IG9mZnNldCBjb25maWcgZnJvbSBhbGwgc2lkZXMuXG4gKi8gZnVuY3Rpb24gZ2V0Q29uc3RyYWluZWRWaWV3cG9ydFJlY3Qodmlld3BvcnRPZmZzZXRDb25maWcpIHtcbiAgICB2aWV3cG9ydE9mZnNldENvbmZpZyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGJvdHRvbTogMCxcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgcmlnaHQ6IDBcbiAgICB9LCB2aWV3cG9ydE9mZnNldENvbmZpZyk7XG4gICAgY29uc3Qgdmlld3BvcnRSZWN0ID0gbmV3IFJlY3QoZ2xvYmFsLndpbmRvdyk7XG4gICAgdmlld3BvcnRSZWN0LnRvcCArPSB2aWV3cG9ydE9mZnNldENvbmZpZy50b3A7XG4gICAgdmlld3BvcnRSZWN0LmhlaWdodCAtPSB2aWV3cG9ydE9mZnNldENvbmZpZy50b3A7XG4gICAgdmlld3BvcnRSZWN0LmJvdHRvbSAtPSB2aWV3cG9ydE9mZnNldENvbmZpZy5ib3R0b207XG4gICAgdmlld3BvcnRSZWN0LmhlaWdodCAtPSB2aWV3cG9ydE9mZnNldENvbmZpZy5ib3R0b207XG4gICAgcmV0dXJuIHZpZXdwb3J0UmVjdDtcbn1cbi8qKlxuICogRm9yIGEgZ2l2ZW4gYXJyYXkgb2YgcG9zaXRpb25pbmcgZnVuY3Rpb25zLCByZXR1cm5zIHN1Y2ggdGhhdCBwcm92aWRlcyB0aGUgYmVzdFxuICogZml0IG9mIHRoZSBgZWxlbWVudFJlY3RgIGludG8gdGhlIGBsaW1pdGVyUmVjdGAgYW5kIGB2aWV3cG9ydFJlY3RgLlxuICovIGZ1bmN0aW9uIGdldEJlc3RQb3NpdGlvbihwb3NpdGlvbnMsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGVsZW1lbnRSZWN0IH0gPSBvcHRpb25zO1xuICAgIC8vIFRoaXMgaXMgd2hlbiBlbGVtZW50IGlzIGZ1bGx5IHZpc2libGUuXG4gICAgY29uc3QgZWxlbWVudFJlY3RBcmVhID0gZWxlbWVudFJlY3QuZ2V0QXJlYSgpO1xuICAgIGNvbnN0IHBvc2l0aW9uSW5zdGFuY2VzID0gcG9zaXRpb25zLm1hcCgocG9zaXRpb25pbmdGdW5jdGlvbik9Pm5ldyBQb3NpdGlvbk9iamVjdChwb3NpdGlvbmluZ0Z1bmN0aW9uLCBvcHRpb25zKSkvLyBTb21lIHBvc2l0aW9uaW5nIGZ1bmN0aW9ucyBtYXkgcmV0dXJuIGBudWxsYCBpZiB0aGV5IGRvbid0IHdhbnQgdG8gcGFydGljaXBhdGUuXG4gICAgLmZpbHRlcigocG9zaXRpb24pPT4hIXBvc2l0aW9uLm5hbWUpO1xuICAgIGxldCBtYXhGaXRGYWN0b3IgPSAwO1xuICAgIGxldCBiZXN0UG9zaXRpb24gPSBudWxsO1xuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgcG9zaXRpb25JbnN0YW5jZXMpe1xuICAgICAgICBjb25zdCB7IGxpbWl0ZXJJbnRlcnNlY3Rpb25BcmVhLCB2aWV3cG9ydEludGVyc2VjdGlvbkFyZWEgfSA9IHBvc2l0aW9uO1xuICAgICAgICAvLyBJZiBhIHN1Y2ggcG9zaXRpb24gaXMgZm91bmQgdGhhdCBlbGVtZW50IGlzIGZ1bGx5IGNvbnRhaW5lZCBieSB0aGUgbGltaXRlciB0aGVuLCBvYnZpb3VzbHksXG4gICAgICAgIC8vIHRoZXJlIHdpbGwgYmUgbm8gYmV0dGVyIG9uZSwgc28gZmluaXNoaW5nLlxuICAgICAgICBpZiAobGltaXRlckludGVyc2VjdGlvbkFyZWEgPT09IGVsZW1lbnRSZWN0QXJlYSkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRSZWN0RHJhd2VyLmRyYXcoIHBvc2l0aW9uLl9yZWN0LCBDSE9TRU5fUE9TSVRJT05fUkVDVF9TVFlMRSwgW1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRcdHBvc2l0aW9uLm5hbWUsXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy9cdFx0JzEwMCUgZml0JyxcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvL1x0XS5qb2luKCAnXFxuJyApICk7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgLy8gVG8gbWF4aW1pemUgYm90aCB2aWV3cG9ydCBhbmQgbGltaXRlciBpbnRlcnNlY3Rpb24gYXJlYXMgd2UgdXNlIGRpc3RhbmNlIG9uIF92aWV3cG9ydEludGVyc2VjdGlvbkFyZWFcbiAgICAgICAgLy8gYW5kIF9saW1pdGVySW50ZXJzZWN0aW9uQXJlYSBwbGFuZSAod2l0aG91dCBzcXJ0IGJlY2F1c2Ugd2UgYXJlIGxvb2tpbmcgZm9yIG1heCB2YWx1ZSkuXG4gICAgICAgIGNvbnN0IGZpdEZhY3RvciA9IHZpZXdwb3J0SW50ZXJzZWN0aW9uQXJlYSAqKiAyICsgbGltaXRlckludGVyc2VjdGlvbkFyZWEgKiogMjtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRSZWN0RHJhd2VyLmRyYXcoIHBvc2l0aW9uLl9yZWN0LCB7IG9wYWNpdHk6IC40IH0sIFtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRcdHBvc2l0aW9uLm5hbWUsXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19QT1NJVElPTiAvL1x0XHQnVmk9JyArICBNYXRoLnJvdW5kKCB2aWV3cG9ydEludGVyc2VjdGlvbkFyZWEgKSxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vXHRcdCdMaT0nICsgTWF0aC5yb3VuZCggbGltaXRlckludGVyc2VjdGlvbkFyZWEgKVxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy9cdF0uam9pbiggJ1xcbicgKSApO1xuICAgICAgICBpZiAoZml0RmFjdG9yID4gbWF4Rml0RmFjdG9yKSB7XG4gICAgICAgICAgICBtYXhGaXRGYWN0b3IgPSBmaXRGYWN0b3I7XG4gICAgICAgICAgICBiZXN0UG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBAaWYgQ0tfREVCVUdfUE9TSVRJT04gLy8gaWYgKCBiZXN0UG9zaXRpb24gKSB7XG4gICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIFx0UmVjdERyYXdlci5kcmF3KCBiZXN0UG9zaXRpb24uX3JlY3QsIENIT1NFTl9QT1NJVElPTl9SRUNUX1NUWUxFICk7XG4gICAgLy8gQGlmIENLX0RFQlVHX1BPU0lUSU9OIC8vIH1cbiAgICByZXR1cm4gYmVzdFBvc2l0aW9uO1xufVxuLyoqXG4gKiBBIHBvc2l0aW9uIGNsYXNzIHdoaWNoIGluc3RhbmNlcyBhcmUgY3JlYXRlZCBhbmQgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+Z2V0T3B0aW1hbFBvc2l0aW9ufSBoZWxwZXIuXG4gKlxuICoge0BsaW5rIG1vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+UG9zaXRpb24jdG9wfSBhbmQge0BsaW5rIG1vZHVsZTp1dGlscy9kb20vcG9zaXRpb25+UG9zaXRpb24jbGVmdH0gcHJvcGVydGllcyBvZiB0aGUgcG9zaXRpb24gaW5zdGFuY2VcbiAqIHRyYW5zbGF0ZSBkaXJlY3RseSB0byB0aGUgYHRvcGAgYW5kIGBsZWZ0YCBwcm9wZXJ0aWVzIGluIENTUyBcImBwb3NpdGlvbjogYWJzb2x1dGVgIGNvb3JkaW5hdGUgc3lzdGVtXCIuIElmIHNldCBvbiB0aGUgcG9zaXRpb25lZCBlbGVtZW50XG4gKiBpbiBET00sIHRoZXkgd2lsbCBtYWtlIGl0IGRpc3BsYXkgaXQgaW4gdGhlIHJpZ2h0IHBsYWNlIGluIHRoZSB2aWV3cG9ydC5cbiAqLyBjbGFzcyBQb3NpdGlvbk9iamVjdCB7XG4gICAgbmFtZTtcbiAgICBjb25maWc7XG4gICAgX3Bvc2l0aW9uaW5nRnVuY3Rpb25Db29yZGluYXRlcztcbiAgICBfb3B0aW9ucztcbiAgICBfY2FjaGVkUmVjdDtcbiAgICBfY2FjaGVkQWJzb2x1dGVSZWN0O1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2RvbS9wb3NpdGlvbn5Qb3NpdGlvbk9iamVjdH0gY2xhc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbmluZ0Z1bmN0aW9uIGZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0aGF0IGRlZmluZXMgdGhlIGV4cGVjdGVkXG5cdCAqIGNvb3JkaW5hdGVzIHRoZSBwb3NpdGlvbmVkIGVsZW1lbnQgc2hvdWxkIG1vdmUgdG8uXG5cdCAqIEBwYXJhbSBvcHRpb25zIG9wdGlvbnMgb2JqZWN0LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5lbGVtZW50UmVjdCBUaGUgcG9zaXRpb25lZCBlbGVtZW50IHJlY3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnRhcmdldFJlY3QgVGhlIHRhcmdldCBlbGVtZW50IHJlY3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnZpZXdwb3J0UmVjdCBUaGUgdmlld3BvcnQgcmVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMubGltaXRlclJlY3QgVGhlIGxpbWl0ZXIgcmVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMucG9zaXRpb25lZEVsZW1lbnRBbmNlc3RvciBOZWFyZXN0IGVsZW1lbnQgYW5jZXN0b3IgZWxlbWVudCB3aGljaCBDU1MgcG9zaXRpb24gaXMgbm90IFwic3RhdGljXCIuXG5cdCAqLyBjb25zdHJ1Y3Rvcihwb3NpdGlvbmluZ0Z1bmN0aW9uLCBvcHRpb25zKXtcbiAgICAgICAgY29uc3QgcG9zaXRpb25pbmdGdW5jdGlvbk91dHB1dCA9IHBvc2l0aW9uaW5nRnVuY3Rpb24ob3B0aW9ucy50YXJnZXRSZWN0LCBvcHRpb25zLmVsZW1lbnRSZWN0LCBvcHRpb25zLnZpZXdwb3J0UmVjdCwgb3B0aW9ucy5saW1pdGVyUmVjdCk7XG4gICAgICAgIC8vIE5hbWVsZXNzIHBvc2l0aW9uIGZvciBhIGZ1bmN0aW9uIHRoYXQgZGlkbid0IHBhcnRpY2lwYXRlLlxuICAgICAgICBpZiAoIXBvc2l0aW9uaW5nRnVuY3Rpb25PdXRwdXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGxlZnQsIHRvcCwgbmFtZSwgY29uZmlnIH0gPSBwb3NpdGlvbmluZ0Z1bmN0aW9uT3V0cHV0O1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgdGhpcy5fcG9zaXRpb25pbmdGdW5jdGlvbkNvb3JkaW5hdGVzID0ge1xuICAgICAgICAgICAgbGVmdCxcbiAgICAgICAgICAgIHRvcFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBsZWZ0IHZhbHVlIGluIHBpeGVscyBpbiB0aGUgQ1NTIGBwb3NpdGlvbjogYWJzb2x1dGVgIGNvb3JkaW5hdGUgc3lzdGVtLlxuXHQgKiBTZXQgaXQgb24gdGhlIHBvc2l0aW9uZWQgZWxlbWVudCBpbiBET00gdG8gbW92ZSBpdCB0byB0aGUgcG9zaXRpb24uXG5cdCAqLyBnZXQgbGVmdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Fic29sdXRlUmVjdC5sZWZ0O1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIHRvcCB2YWx1ZSBpbiBwaXhlbHMgaW4gdGhlIENTUyBgcG9zaXRpb246IGFic29sdXRlYCBjb29yZGluYXRlIHN5c3RlbS5cblx0ICogU2V0IGl0IG9uIHRoZSBwb3NpdGlvbmVkIGVsZW1lbnQgaW4gRE9NIHRvIG1vdmUgaXQgdG8gdGhlIHBvc2l0aW9uLlxuXHQgKi8gZ2V0IHRvcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Fic29sdXRlUmVjdC50b3A7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBbiBpbnRlcnNlY3Rpb24gYXJlYSBiZXR3ZWVuIHBvc2l0aW9uZWQgZWxlbWVudCBhbmQgbGltaXRlciB3aXRoaW4gdmlld3BvcnQgY29uc3RyYWludHMuXG5cdCAqLyBnZXQgbGltaXRlckludGVyc2VjdGlvbkFyZWEoKSB7XG4gICAgICAgIGNvbnN0IGxpbWl0ZXJSZWN0ID0gdGhpcy5fb3B0aW9ucy5saW1pdGVyUmVjdDtcbiAgICAgICAgaWYgKGxpbWl0ZXJSZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gbGltaXRlclJlY3QuZ2V0SW50ZXJzZWN0aW9uQXJlYSh0aGlzLl9yZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFuIGludGVyc2VjdGlvbiBhcmVhIGJldHdlZW4gcG9zaXRpb25lZCBlbGVtZW50IGFuZCB2aWV3cG9ydC5cblx0ICovIGdldCB2aWV3cG9ydEludGVyc2VjdGlvbkFyZWEoKSB7XG4gICAgICAgIGNvbnN0IHZpZXdwb3J0UmVjdCA9IHRoaXMuX29wdGlvbnMudmlld3BvcnRSZWN0O1xuICAgICAgICByZXR1cm4gdmlld3BvcnRSZWN0LmdldEludGVyc2VjdGlvbkFyZWEodGhpcy5fcmVjdCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBbiBhbHJlYWR5IHBvc2l0aW9uZWQgZWxlbWVudCByZWN0LiBBIGNsb25lIG9mIHRoZSBlbGVtZW50IHJlY3QgcGFzc2VkIHRvIHRoZSBjb25zdHJ1Y3RvclxuXHQgKiBidXQgcGxhY2VkIGluIHRoZSB2aWV3cG9ydCBhY2NvcmRpbmcgdG8gdGhlIHBvc2l0aW9uaW5nIGZ1bmN0aW9uLlxuXHQgKi8gZ2V0IF9yZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5fY2FjaGVkUmVjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZFJlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2FjaGVkUmVjdCA9IHRoaXMuX29wdGlvbnMuZWxlbWVudFJlY3QuY2xvbmUoKS5tb3ZlVG8odGhpcy5fcG9zaXRpb25pbmdGdW5jdGlvbkNvb3JkaW5hdGVzLmxlZnQsIHRoaXMuX3Bvc2l0aW9uaW5nRnVuY3Rpb25Db29yZGluYXRlcy50b3ApO1xuICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkUmVjdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFuIGFscmVhZHkgYWJzb2x1dGVseSBwb3NpdGlvbmVkIGVsZW1lbnQgcmVjdC4gU2VlICh7QGxpbmsgI19yZWN0fSkuXG5cdCAqLyBnZXQgX2Fic29sdXRlUmVjdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NhY2hlZEFic29sdXRlUmVjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZEFic29sdXRlUmVjdDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jYWNoZWRBYnNvbHV0ZVJlY3QgPSB0aGlzLl9yZWN0LnRvQWJzb2x1dGVSZWN0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRBYnNvbHV0ZVJlY3Q7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL2RvbS9yZW1vdmVcbiAqLyAvKipcbiAqIFJlbW92ZXMgZ2l2ZW4gbm9kZSBmcm9tIHBhcmVudC5cbiAqXG4gKiBAcGFyYW0gbm9kZSBOb2RlIHRvIHJlbW92ZS5cbiAqLyBmdW5jdGlvbiByZW1vdmUobm9kZSkge1xuICAgIGNvbnN0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICBpZiAocGFyZW50KSB7XG4gICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTtcbiAgICB9XG59XG5cbi8qKlxuICogTWFrZXMgYW55IHBhZ2UgYEhUTUxFbGVtZW50YCBvciBgUmFuZ2VgIChgdGFyZ2V0YCkgdmlzaWJsZSBpbnNpZGUgdGhlIGJyb3dzZXIgdmlld3BvcnQuXG4gKiBUaGlzIGhlbHBlciB3aWxsIHNjcm9sbCBhbGwgYHRhcmdldGAgYW5jZXN0b3JzIGFuZCB0aGUgd2ViIGJyb3dzZXIgdmlld3BvcnQgdG8gcmV2ZWFsIHRoZSB0YXJnZXQgdG9cbiAqIHRoZSB1c2VyLiBJZiB0aGUgYHRhcmdldGAgaXMgYWxyZWFkeSB2aXNpYmxlLCBub3RoaW5nIHdpbGwgaGFwcGVuLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiBvZiB0aGUgc2Nyb2xsaW5nIGJlaGF2aW9yLlxuICogQHBhcmFtIG9wdGlvbnMudGFyZ2V0IEEgdGFyZ2V0LCB3aGljaCBzdXBwb3NlZCB0byBiZWNvbWUgdmlzaWJsZSB0byB0aGUgdXNlci5cbiAqIEBwYXJhbSBvcHRpb25zLnZpZXdwb3J0T2Zmc2V0IEFuIG9mZnNldCBmcm9tIHRoZSBlZGdlIG9mIHRoZSB2aWV3cG9ydCAoaW4gcGl4ZWxzKVxuICogdGhlIGB0YXJnZXRgIHdpbGwgYmUgbW92ZWQgYnkgaWYgdGhlIHZpZXdwb3J0IGlzIHNjcm9sbGVkLiBJdCBlbmhhbmNlcyB0aGUgdXNlciBleHBlcmllbmNlXG4gKiBieSBrZWVwaW5nIHRoZSBgdGFyZ2V0YCBzb21lIGRpc3RhbmNlIGZyb20gdGhlIGVkZ2Ugb2YgdGhlIHZpZXdwb3J0IGFuZCB0aHVzIG1ha2luZyBpdCBlYXNpZXIgdG9cbiAqIHJlYWQgb3IgZWRpdCBieSB0aGUgdXNlci5cbiAqIEBwYXJhbSBvcHRpb25zLmFuY2VzdG9yT2Zmc2V0IEFuIG9mZnNldCBmcm9tIHRoZSBib3VuZGFyeSBvZiBzY3JvbGxhYmxlIGFuY2VzdG9ycyAoaWYgYW55KVxuICogdGhlIGB0YXJnZXRgIHdpbGwgYmUgbW92ZWQgYnkgaWYgdGhlIHZpZXdwb3J0IGlzIHNjcm9sbGVkLiBJdCBlbmhhbmNlcyB0aGUgdXNlciBleHBlcmllbmNlXG4gKiBieSBrZWVwaW5nIHRoZSBgdGFyZ2V0YCBzb21lIGRpc3RhbmNlIGZyb20gdGhlIGVkZ2Ugb2YgdGhlIGFuY2VzdG9ycyBhbmQgdGh1cyBtYWtpbmcgaXQgZWFzaWVyIHRvXG4gKiByZWFkIG9yIGVkaXQgYnkgdGhlIHVzZXIuXG4gKiBAcGFyYW0gb3B0aW9ucy5hbGlnblRvVG9wIFdoZW4gc2V0IGB0cnVlYCwgdGhlIGhlbHBlciB3aWxsIG1ha2Ugc3VyZSB0aGUgYHRhcmdldGAgaXMgc2Nyb2xsZWQgdXBcbiAqIHRvIHRoZSB0b3AgYm91bmRhcnkgb2YgdGhlIHZpZXdwb3J0IGFuZC9vciBzY3JvbGxhYmxlIGFuY2VzdG9ycyBpZiBzY3JvbGxlZCB1cC4gV2hlbiBub3Qgc2V0XG4gKiAoZGVmYXVsdCksIHRoZSBgdGFyZ2V0YCB3aWxsIGJlIHJldmVhbGVkIGJ5IHNjcm9sbGluZyBhcyBsaXR0bGUgYXMgcG9zc2libGUuIFRoaXMgb3B0aW9uIHdpbGxcbiAqIG5vdCBhZmZlY3QgYHRhcmdldHNgIHRoYXQgbXVzdCBiZSBzY3JvbGxlZCBkb3duIGJlY2F1c2UgdGhleSB3aWxsIGFwcGVhciBhdCB0aGUgdG9wIG9mIHRoZSBib3VuZGFyeVxuICogYW55d2F5LlxuICpcbiAqIGBgYFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxWaWV3cG9ydFRvU2hvd1RhcmdldCgpIHdpdGggICAgICAgICAgICBzY3JvbGxWaWV3cG9ydFRvU2hvd1RhcmdldCgpIHdpdGhcbiAqICAgICAgICAgIEluaXRpYWwgc3RhdGUgICAgICAgICAgICAgICAgICAgICAgICBhbGlnblRvVG9wIHVuc2V0IChkZWZhdWx0KSAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduVG9Ub3AgPSB0cnVlXG4gKlxuICog4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSQICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUrOKUgOKUkCAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSQXG4gKiDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUguKWsuKUgiAgICAgICDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUguKWsuKUgiAgICAgICAg4pSCICAgWyBUYXJnZXQgdG8gYmUgcmV2ZWFsZWQgXSAgICDilILilrLilIJcbiAqIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSCIOKUgiAgICAgICDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgiDilIIgICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSCIOKUglxuICog4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilILilojilIIgICAgICAg4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIIg4pSCICAgICAgICDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgiDilIJcbiAqIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSC4paI4pSCICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSCIOKUgiAgICAgICAg4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIIg4pSCXG4gKiDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgiDilIIgICAgICAg4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilILilojilIIgICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSCIOKUglxuICog4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIIg4pSCICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSC4paI4pSCICAgICAgICDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUguKWiOKUglxuICog4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIIg4pSCICAgICAgIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSCIOKUgiAgICAgICAg4pSCICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilILilojilIJcbiAqIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSC4pa84pSCICAgICAgIOKUgiAgIFsgVGFyZ2V0IHRvIGJlIHJldmVhbGVkIF0gICAg4pSC4pa84pSCICAgICAgICDilIIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUguKWvOKUglxuICog4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS04pSA4pSYICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUtOKUgOKUmCAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS04pSA4pSYXG4gKlxuICpcbiAqICAgICBbIFRhcmdldCB0byBiZSByZXZlYWxlZCBdXG4gKmBgYFxuICpcbiAqIEBwYXJhbSBvcHRpb25zLmZvcmNlU2Nyb2xsIFdoZW4gc2V0IGB0cnVlYCwgdGhlIGB0YXJnZXRgIHdpbGwgYmUgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB2aWV3cG9ydFxuICogYW5kIHNjcm9sbGFibGUgYW5jZXN0b3JzIHdoZXRoZXIgaXQgaXMgYWxyZWFkeSB2aXNpYmxlIG9yIG5vdC4gVGhpcyBvcHRpb24gd2lsbCBvbmx5IHdvcmsgd2hlbiBgYWxpZ25Ub1RvcGBcbiAqIGlzIGB0cnVlYFxuICovIGZ1bmN0aW9uIHNjcm9sbFZpZXdwb3J0VG9TaG93VGFyZ2V0KHsgdGFyZ2V0LCB2aWV3cG9ydE9mZnNldCA9IDAsIGFuY2VzdG9yT2Zmc2V0ID0gMCwgYWxpZ25Ub1RvcCwgZm9yY2VTY3JvbGwgfSkge1xuICAgIGNvbnN0IHRhcmdldFdpbmRvdyA9IGdldFdpbmRvdyh0YXJnZXQpO1xuICAgIGxldCBjdXJyZW50V2luZG93ID0gdGFyZ2V0V2luZG93O1xuICAgIGxldCBjdXJyZW50RnJhbWUgPSBudWxsO1xuICAgIHZpZXdwb3J0T2Zmc2V0ID0gbm9ybWFsaXplVmlld3BvcnRPZmZzZXQodmlld3BvcnRPZmZzZXQpO1xuICAgIC8vIEl0ZXJhdGUgb3ZlciBhbGwgd2luZG93cywgc3RhcnRpbmcgZnJvbSB0YXJnZXQncyBwYXJlbnQgd2luZG93IHVwIHRvIHdpbmRvdyN0b3AuXG4gICAgd2hpbGUoY3VycmVudFdpbmRvdyl7XG4gICAgICAgIGxldCBmaXJzdEFuY2VzdG9yVG9TY3JvbGw7XG4gICAgICAgIC8vIExldCdzIHNjcm9sbCB0YXJnZXQncyBhbmNlc3RvcnMgZmlyc3QgdG8gcmV2ZWFsIGl0LiBUaGVuLCBvbmNlIHRoZSBhbmNlc3RvciBzY3JvbGxzXG4gICAgICAgIC8vIHNldHRsZWQgZG93biwgdGhlIGFsZ29yaXRobSBjYW4gZXZlbnR1YWxseSBzY3JvbGwgdGhlIHZpZXdwb3J0IG9mIHRoZSBjdXJyZW50IHdpbmRvdy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTm90ZTogSWYgdGhlIGN1cnJlbnQgd2luZG93IGlzIHRhcmdldCdzICoqb3JpZ2luYWwqKiB3aW5kb3cgKGUuZy4gdGhlIGZpcnN0IG9uZSksXG4gICAgICAgIC8vIHN0YXJ0IHNjcm9sbGluZyB0aGUgY2xvc2VzdCBwYXJlbnQgb2YgdGhlIHRhcmdldC4gSWYgbm90LCBzY3JvbGwgdGhlIGNsb3Nlc3QgcGFyZW50XG4gICAgICAgIC8vIG9mIGFuIGlmcmFtZSB0aGF0IHJlc2lkZXMgaW4gdGhlIGN1cnJlbnQgd2luZG93LlxuICAgICAgICBpZiAoY3VycmVudFdpbmRvdyA9PSB0YXJnZXRXaW5kb3cpIHtcbiAgICAgICAgICAgIGZpcnN0QW5jZXN0b3JUb1Njcm9sbCA9IGdldFBhcmVudEVsZW1lbnQodGFyZ2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpcnN0QW5jZXN0b3JUb1Njcm9sbCA9IGdldFBhcmVudEVsZW1lbnQoY3VycmVudEZyYW1lKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTY3JvbGwgdGhlIHRhcmdldCdzIGFuY2VzdG9ycyBmaXJzdC4gT25jZSBkb25lLCBzY3JvbGxpbmcgdGhlIHZpZXdwb3J0IGlzIGVhc3kuXG4gICAgICAgIHNjcm9sbEFuY2VzdG9yc1RvU2hvd1JlY3Qoe1xuICAgICAgICAgICAgcGFyZW50OiBmaXJzdEFuY2VzdG9yVG9TY3JvbGwsXG4gICAgICAgICAgICBnZXRSZWN0OiAoKT0+e1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IElmIHRoZSB0YXJnZXQgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBjdXJyZW50IHdpbmRvdyAqKmRpcmVjdGx5KiosXG4gICAgICAgICAgICAgICAgLy8gaS5lLiBpdCByZXNpZGVzIGluIGFuIGlmcmFtZSBiZWxvbmdpbmcgdG8gdGhlIHdpbmRvdywgb2J0YWluIHRoZSB0YXJnZXQncyByZWN0XG4gICAgICAgICAgICAgICAgLy8gaW4gdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSBjdXJyZW50IHdpbmRvdy4gQnkgZGVmYXVsdCwgYSBSZWN0IHJldHVybnMgZ2VvbWV0cnlcbiAgICAgICAgICAgICAgICAvLyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCB3aW5kb3cncyB2aWV3cG9ydC4gVG8gbWFrZSBpdCB3b3JrIGluIGEgcGFyZW50IHdpbmRvdyxcbiAgICAgICAgICAgICAgICAvLyBpdCBtdXN0IGJlIHNoaWZ0ZWQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldFJlY3RSZWxhdGl2ZVRvV2luZG93KHRhcmdldCwgY3VycmVudFdpbmRvdyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYWxpZ25Ub1RvcCxcbiAgICAgICAgICAgIGFuY2VzdG9yT2Zmc2V0LFxuICAgICAgICAgICAgZm9yY2VTY3JvbGxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIE9idGFpbiB0aGUgcmVjdCBvZiB0aGUgdGFyZ2V0IGFmdGVyIGl0IGhhcyBiZWVuIHNjcm9sbGVkIHdpdGhpbiBpdHMgYW5jZXN0b3JzLlxuICAgICAgICAvLyBJdCdzIHRpbWUgdG8gc2Nyb2xsIHRoZSB2aWV3cG9ydC5cbiAgICAgICAgbGV0IHRhcmdldFJlY3QgPSBnZXRSZWN0UmVsYXRpdmVUb1dpbmRvdyh0YXJnZXQsIGN1cnJlbnRXaW5kb3cpO1xuICAgICAgICAvLyBEZXRlY3Qgc2l0dWF0aW9uIHdoZXJlIHRoZSB0YXJnZXQgaXMgaGlnaGVyIHRoYW4gdGhlIGZpcnN0IHNjcm9sbGFibGUgYW5jZXN0b3IuXG4gICAgICAgIC8vIEluIHN1Y2ggY2FzZSBzY3JvbGxpbmcgdGhlIHZpZXdwb3J0IHRvIHJldmVhbCB0aGUgdGFyZ2V0IG1pZ2h0IGJlIG1hbGZ1bmN0aW9uaW5nIGJlY2F1c2VcbiAgICAgICAgLy8gdGhlIHRhcmdldCBgLnRvcGAgcG9zaXRpb24gaXMgbG93ZXIgdGhhbiB0aGUgYW5jZXN0b3IncyBgLnRvcGAgcG9zaXRpb24uIElmIGl0J3MgbGFyZ2UgZW5vdWdoIGl0IGNhbiBiZSBuZWdhdGl2ZS5cbiAgICAgICAgLy8gSXQgY2F1c2VzIHRoZSBgc2Nyb2xsV2luZG93VG9TaG93UmVjdGAgdG8gc2Nyb2xsIHRoZSB2aWV3cG9ydCB0byB0aGUgbmVnYXRpdmUgdG9wIHBvc2l0aW9uIHdoaWNoIGlzIG5vdCBwb3NzaWJsZVxuICAgICAgICAvLyBhbmQgbGVhZHMgdG8gdGhlIHZpZXdwb3J0IGJlaW5nIHNjcm9sbGVkIHRvIHRoZSBhYnNvbHV0ZSB0b3Agb2YgdGhlIGRvY3VtZW50LiBUbyBwcmV2ZW50IHRoaXMsIHRoZSB0YXJnZXQncyByZWN0XG4gICAgICAgIC8vIG11c3QgYmUgc2hpZnRlZCB0byB0aGUgYW5jZXN0b3IncyB0b3AgcG9zaXRpb24uIEl0IHNob3VsZCBub3QgYWZmZWN0IHRoZSB0YXJnZXQncyB2aXNpYmlsaXR5IGJlY2F1c2UgdGhlIGFuY2VzdG9yXG4gICAgICAgIC8vIGlzIGFscmVhZHkgc2Nyb2xsZWQgdG8gcmV2ZWFsIHRoZSB0YXJnZXQuXG4gICAgICAgIC8vIFNlZSBtb3JlOiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xNzA3OVxuICAgICAgICBjb25zdCBhbmNlc3RvcldpbmRvd1JlbGF0aXZlUmVjdCA9IGdldFJlY3RSZWxhdGl2ZVRvV2luZG93KGZpcnN0QW5jZXN0b3JUb1Njcm9sbCwgY3VycmVudFdpbmRvdyk7XG4gICAgICAgIGlmICh0YXJnZXRSZWN0LmhlaWdodCA+IGFuY2VzdG9yV2luZG93UmVsYXRpdmVSZWN0LmhlaWdodCkge1xuICAgICAgICAgICAgY29uc3QgYW5jZXN0b3JUYXJnZXRJbnRlcnNlY3Rpb24gPSB0YXJnZXRSZWN0LmdldEludGVyc2VjdGlvbihhbmNlc3RvcldpbmRvd1JlbGF0aXZlUmVjdCk7XG4gICAgICAgICAgICBpZiAoYW5jZXN0b3JUYXJnZXRJbnRlcnNlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRSZWN0ID0gYW5jZXN0b3JUYXJnZXRJbnRlcnNlY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2Nyb2xsV2luZG93VG9TaG93UmVjdCh7XG4gICAgICAgICAgICB3aW5kb3c6IGN1cnJlbnRXaW5kb3csXG4gICAgICAgICAgICByZWN0OiB0YXJnZXRSZWN0LFxuICAgICAgICAgICAgdmlld3BvcnRPZmZzZXQsXG4gICAgICAgICAgICBhbGlnblRvVG9wLFxuICAgICAgICAgICAgZm9yY2VTY3JvbGxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChjdXJyZW50V2luZG93LnBhcmVudCAhPSBjdXJyZW50V2luZG93KSB7XG4gICAgICAgICAgICAvLyBLZWVwIHRoZSByZWZlcmVuY2UgdG8gdGhlIDxpZnJhbWU+IGVsZW1lbnQgdGhlIFwicHJldmlvdXMgY3VycmVudCB3aW5kb3dcIiB3YXNcbiAgICAgICAgICAgIC8vIHJlbmRlcmVkIHdpdGhpbi4gSXQgd2lsbCBiZSB1c2VmdWwgdG8gcmXigJNjYWxjdWxhdGUgdGhlIHJlY3Qgb2YgdGhlIHRhcmdldFxuICAgICAgICAgICAgLy8gaW4gdGhlIHBhcmVudCB3aW5kb3cncyByZWxhdGl2ZSBnZW9tZXRyeS4gVGhlIHRhcmdldCdzIHJlY3QgbXVzdCBiZSBzaGlmdGVkXG4gICAgICAgICAgICAvLyBieSBpdCdzIGlmcmFtZSdzIHBvc2l0aW9uLlxuICAgICAgICAgICAgY3VycmVudEZyYW1lID0gY3VycmVudFdpbmRvdy5mcmFtZUVsZW1lbnQ7XG4gICAgICAgICAgICBjdXJyZW50V2luZG93ID0gY3VycmVudFdpbmRvdy5wYXJlbnQ7XG4gICAgICAgICAgICAvLyBJZiB0aGUgY3VycmVudCB3aW5kb3cgaGFzIHNvbWUgcGFyZW50IGJ1dCBmcmFtZUVsZW1lbnQgaXMgaW5hY2Nlc3NpYmxlLCB0aGVuIHRoZXkgaGF2ZVxuICAgICAgICAgICAgLy8gZGlmZmVyZW50IGRvbWFpbnMvcG9ydHMgYW5kLCBkdWUgdG8gc2VjdXJpdHkgcmVhc29ucywgYWNjZXNzaW5nIGFuZCBzY3JvbGxpbmdcbiAgICAgICAgICAgIC8vIHRoZSBwYXJlbnQgd2luZG93IHdvbid0IGJlIHBvc3NpYmxlLlxuICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzkzMC5cbiAgICAgICAgICAgIGlmICghY3VycmVudEZyYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudFdpbmRvdyA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIE1ha2VzIGFueSBwYWdlIGBIVE1MRWxlbWVudGAgb3IgYFJhbmdlYCAodGFyZ2V0KSB2aXNpYmxlIHdpdGhpbiBpdHMgc2Nyb2xsYWJsZSBhbmNlc3RvcnMsXG4gKiBlLmcuIGlmIHRoZXkgaGF2ZSBgb3ZlcmZsb3c6IHNjcm9sbGAgQ1NTIHN0eWxlLlxuICpcbiAqIEBwYXJhbSB0YXJnZXQgQSB0YXJnZXQsIHdoaWNoIHN1cHBvc2VkIHRvIGJlY29tZSB2aXNpYmxlIHRvIHRoZSB1c2VyLlxuICogQHBhcmFtIGFuY2VzdG9yT2Zmc2V0IEFuIG9mZnNldCBiZXR3ZWVuIHRoZSB0YXJnZXQgYW5kIHRoZSBib3VuZGFyeSBvZiBzY3JvbGxhYmxlIGFuY2VzdG9yc1xuICogdG8gYmUgbWFpbnRhaW5lZCB3aGlsZSBzY3JvbGxpbmcuXG4gKiBAcGFyYW0gbGltaXRlckVsZW1lbnQgVGhlIG91dGVybW9zdCBhbmNlc3RvciB0aGF0IHNob3VsZCBiZSBzY3JvbGxlZC4gSWYgc3BlY2lmaWVkLCBpdCBjYW4gcHJldmVudFxuICogc2Nyb2xsaW5nIHRoZSB3aG9sZSBwYWdlLlxuICovIGZ1bmN0aW9uIHNjcm9sbEFuY2VzdG9yc1RvU2hvd1RhcmdldCh0YXJnZXQsIGFuY2VzdG9yT2Zmc2V0LCBsaW1pdGVyRWxlbWVudCkge1xuICAgIGNvbnN0IHRhcmdldFBhcmVudCA9IGdldFBhcmVudEVsZW1lbnQodGFyZ2V0KTtcbiAgICBzY3JvbGxBbmNlc3RvcnNUb1Nob3dSZWN0KHtcbiAgICAgICAgcGFyZW50OiB0YXJnZXRQYXJlbnQsXG4gICAgICAgIGdldFJlY3Q6ICgpPT5uZXcgUmVjdCh0YXJnZXQpLFxuICAgICAgICBhbmNlc3Rvck9mZnNldCxcbiAgICAgICAgbGltaXRlckVsZW1lbnRcbiAgICB9KTtcbn1cbi8qKlxuICogTWFrZXMgYSBnaXZlbiByZWN0IHZpc2libGUgd2l0aGluIGl0cyBwYXJlbnQgd2luZG93LlxuICpcbiAqIE5vdGU6IEF2b2lkIHRoZSBzaXR1YXRpb24gd2hlcmUgdGhlIGNhcmV0IGlzIHN0aWxsIGluIHRoZSB2aWV3cG9ydCwgYnV0IHRvdGFsbHlcbiAqIGF0IHRoZSBlZGdlIG9mIGl0LiBJbiBzdWNoIHNpdHVhdGlvbiwgaWYgaXQgbW92ZWQgYmV5b25kIHRoZSB2aWV3cG9ydCBpbiB0aGUgbmV4dFxuICogYWN0aW9uIGUuZy4gYWZ0ZXIgcGFzdGUsIHRoZSBzY3JvbGxpbmcgd291bGQgbW92ZSBpdCB0byB0aGUgdmlld3BvcnRPZmZzZXQgbGV2ZWxcbiAqIGFuZCBpdCBhbGwgd291bGQgbG9vayBsaWtlIHRoZSBjYXJldCB2aXN1YWxseSBtb3ZlZCB1cC9kb3duOlxuICpcbiAqIDEuXG4gKiBgYGBcbiAqIHwgZm9vW11cbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8LS0tIE4gcHggb2Ygc3BhY2UgYmVsb3cgdGhlIGNhcmV0XG4gKiArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLi4uXG4gKiBgYGBcbiAqXG4gKiAyLiAqcGFzdGUqXG4gKiAzLlxuICogYGBgXG4gKiB8XG4gKiB8XG4gKiArLWZvby0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLi4uXG4gKiAgIGJhcltdICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC0tLSBjYXJldCBiZWxvdyB2aWV3cG9ydCwgc2Nyb2xsaW5nLi4uXG4gKiBgYGBcbiAqXG4gKiA0LiAqc2Nyb2xsaW5nKlxuICogNS5cbiAqIGBgYFxuICogfFxuICogfCBmb29cbiAqIHwgYmFyW10gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8LS0tIGNhcmV0IHByZWNpc2VseSBhdCB0aGUgZWRnZVxuICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS4uLlxuICogYGBgXG4gKlxuICogVG8gcHJldmVudCB0aGlzLCB0aGlzIG1ldGhvZCBjaGVja3MgdGhlIHJlY3RzIG1vdmVkIGJ5IHRoZSB2aWV3cG9ydE9mZnNldCB0byBjb3ZlclxuICogdGhlIHVwcGVyL2xvd2VyIGVkZ2Ugb2YgdGhlIHZpZXdwb3J0LiBJdCBtYWtlcyBzdXJlIGlmIHRoZSBhY3Rpb24gcmVwZWF0cywgdGhlcmUnc1xuICogbm8gdHdpdGNoaW5nIOKAkyBpdCdzIGEgcHVyZWx5IHZpc3VhbCBpbXByb3ZlbWVudDpcbiAqXG4gKiA1LiAoYWZ0ZXIgZml4KVxuICogYGBgXG4gKiB8XG4gKiB8IGZvb1xuICogfCBiYXJbXVxuICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwtLS0gTiBweCBvZiBzcGFjZSBiZWxvdyB0aGUgY2FyZXRcbiAqICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0uLi5cbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiBvZiB0aGUgc2Nyb2xsaW5nIGJlaGF2aW9yLlxuICogQHBhcmFtIG9wdGlvbnMud2luZG93IEEgd2luZG93IHdoaWNoIGlzIHNjcm9sbGVkIHRvIHJldmVhbCB0aGUgcmVjdC5cbiAqIEBwYXJhbSBvcHRpb25zLnJlY3QgQSByZWN0IHdoaWNoIGlzIHRvIGJlIHJldmVhbGVkLlxuICogQHBhcmFtIG9wdGlvbnMudmlld3BvcnRPZmZzZXQgQW4gb2Zmc2V0IGZyb20gdGhlIGVkZ2Ugb2YgdGhlIHZpZXdwb3J0IChpbiBwaXhlbHMpIHRoZSBgcmVjdGAgd2lsbCBiZVxuICogbW92ZWQgYnkgaWYgdGhlIHZpZXdwb3J0IGlzIHNjcm9sbGVkLlxuICogQHBhcmFtIG9wdGlvbnMuYWxpZ25Ub1RvcCBXaGVuIHNldCBgdHJ1ZWAsIHRoZSBoZWxwZXIgd2lsbCBtYWtlIHN1cmUgdGhlIGByZWN0YCBpcyBzY3JvbGxlZCB1cFxuICogdG8gdGhlIHRvcCBib3VuZGFyeSBvZiB0aGUgdmlld3BvcnQgaWYgc2Nyb2xsZWQgdXAuIFdoZW4gbm90IHNldCAoZGVmYXVsdCksIHRoZSBgcmVjdGAgd2lsbCBiZVxuICogcmV2ZWFsZWQgYnkgc2Nyb2xsaW5nIGFzIGxpdHRsZSBhcyBwb3NzaWJsZS4gVGhpcyBvcHRpb24gd2lsbCBub3QgYWZmZWN0IHJlY3RzIHRoYXQgbXVzdCBiZSBzY3JvbGxlZFxuICogZG93biBiZWNhdXNlIHRoZXkgd2lsbCBhcHBlYXIgYXQgdGhlIHRvcCBvZiB0aGUgYm91bmRhcnkgYW55d2F5LlxuICogQHBhcmFtIG9wdGlvbnMuZm9yY2VTY3JvbGwgV2hlbiBzZXQgYHRydWVgLCB0aGUgYHJlY3RgIHdpbGwgYmUgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB2aWV3cG9ydFxuICogd2hldGhlciBpdCBpcyBhbHJlYWR5IHZpc2libGUgb3Igbm90LiBUaGlzIG9wdGlvbiB3aWxsIG9ubHkgd29yayB3aGVuIGBhbGlnblRvVG9wYCBpcyBgdHJ1ZWBcbiAqLyBmdW5jdGlvbiBzY3JvbGxXaW5kb3dUb1Nob3dSZWN0KHsgd2luZG93LCByZWN0LCBhbGlnblRvVG9wLCBmb3JjZVNjcm9sbCwgdmlld3BvcnRPZmZzZXQgfSkge1xuICAgIGNvbnN0IHRhcmdldFNoaWZ0ZWREb3duUmVjdCA9IHJlY3QuY2xvbmUoKS5tb3ZlQnkoMCwgdmlld3BvcnRPZmZzZXQuYm90dG9tKTtcbiAgICBjb25zdCB0YXJnZXRTaGlmdGVkVXBSZWN0ID0gcmVjdC5jbG9uZSgpLm1vdmVCeSgwLCAtdmlld3BvcnRPZmZzZXQudG9wKTtcbiAgICBjb25zdCB2aWV3cG9ydFJlY3QgPSBuZXcgUmVjdCh3aW5kb3cpLmV4Y2x1ZGVTY3JvbGxiYXJzQW5kQm9yZGVycygpO1xuICAgIGNvbnN0IHJlY3RzID0gW1xuICAgICAgICB0YXJnZXRTaGlmdGVkVXBSZWN0LFxuICAgICAgICB0YXJnZXRTaGlmdGVkRG93blJlY3RcbiAgICBdO1xuICAgIGNvbnN0IGZvcmNlU2Nyb2xsVG9Ub3AgPSBhbGlnblRvVG9wICYmIGZvcmNlU2Nyb2xsO1xuICAgIGNvbnN0IGFsbFJlY3RzRml0SW5WaWV3cG9ydCA9IHJlY3RzLmV2ZXJ5KChyZWN0KT0+dmlld3BvcnRSZWN0LmNvbnRhaW5zKHJlY3QpKTtcbiAgICBsZXQgeyBzY3JvbGxYLCBzY3JvbGxZIH0gPSB3aW5kb3c7XG4gICAgY29uc3QgaW5pdGlhbFNjcm9sbFggPSBzY3JvbGxYO1xuICAgIGNvbnN0IGluaXRpYWxTY3JvbGxZID0gc2Nyb2xsWTtcbiAgICBpZiAoZm9yY2VTY3JvbGxUb1RvcCkge1xuICAgICAgICBzY3JvbGxZIC09IHZpZXdwb3J0UmVjdC50b3AgLSByZWN0LnRvcCArIHZpZXdwb3J0T2Zmc2V0LnRvcDtcbiAgICB9IGVsc2UgaWYgKCFhbGxSZWN0c0ZpdEluVmlld3BvcnQpIHtcbiAgICAgICAgaWYgKGlzQWJvdmUodGFyZ2V0U2hpZnRlZFVwUmVjdCwgdmlld3BvcnRSZWN0KSkge1xuICAgICAgICAgICAgc2Nyb2xsWSAtPSB2aWV3cG9ydFJlY3QudG9wIC0gcmVjdC50b3AgKyB2aWV3cG9ydE9mZnNldC50b3A7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNCZWxvdyh0YXJnZXRTaGlmdGVkRG93blJlY3QsIHZpZXdwb3J0UmVjdCkpIHtcbiAgICAgICAgICAgIGlmIChhbGlnblRvVG9wKSB7XG4gICAgICAgICAgICAgICAgc2Nyb2xsWSArPSByZWN0LnRvcCAtIHZpZXdwb3J0UmVjdC50b3AgLSB2aWV3cG9ydE9mZnNldC50b3A7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNjcm9sbFkgKz0gcmVjdC5ib3R0b20gLSB2aWV3cG9ydFJlY3QuYm90dG9tICsgdmlld3BvcnRPZmZzZXQuYm90dG9tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghYWxsUmVjdHNGaXRJblZpZXdwb3J0KSB7XG4gICAgICAgIC8vIFRPRE86IFdlYiBicm93c2VycyBzY3JvbGwgbmF0aXZlbHkgdG8gcGxhY2UgdGhlIHRhcmdldCBpbiB0aGUgbWlkZGxlXG4gICAgICAgIC8vIG9mIHRoZSB2aWV3cG9ydC4gSXQncyBub3QgYSB2ZXJ5IHBvcHVsYXIgY2FzZSwgdGhvdWdoLlxuICAgICAgICBpZiAoaXNMZWZ0T2YocmVjdCwgdmlld3BvcnRSZWN0KSkge1xuICAgICAgICAgICAgc2Nyb2xsWCAtPSB2aWV3cG9ydFJlY3QubGVmdCAtIHJlY3QubGVmdCArIHZpZXdwb3J0T2Zmc2V0LmxlZnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNSaWdodE9mKHJlY3QsIHZpZXdwb3J0UmVjdCkpIHtcbiAgICAgICAgICAgIHNjcm9sbFggKz0gcmVjdC5yaWdodCAtIHZpZXdwb3J0UmVjdC5yaWdodCArIHZpZXdwb3J0T2Zmc2V0LnJpZ2h0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChzY3JvbGxYICE9IGluaXRpYWxTY3JvbGxYIHx8IHNjcm9sbFkgIT09IGluaXRpYWxTY3JvbGxZKSB7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbyhzY3JvbGxYLCBzY3JvbGxZKTtcbiAgICB9XG59XG4vKipcbiAqIFJlY3Vyc2l2ZWx5IHNjcm9sbHMgZWxlbWVudCBhbmNlc3RvcnMgdG8gdmlzdWFsbHkgcmV2ZWFsIGEgcmVjdC5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHNjcm9sbGluZyBiZWhhdmlvci5cbiAqIEBwYXJhbSBvcHRpb25zLnBhcmVudCBUaGUgZmlyc3QgcGFyZW50IGFuY2VzdG9yIHRvIHN0YXJ0IHNjcm9sbGluZy5cbiAqIEBwYXJhbSBvcHRpb25zLmdldFJlY3QgQSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIHRoZSBSZWN0LCB3aGljaCBpcyB0byBiZSByZXZlYWxlZC5cbiAqIEBwYXJhbSBvcHRpb25zLmFuY2VzdG9yT2Zmc2V0IEFuIG9mZnNldCBmcm9tIHRoZSBib3VuZGFyeSBvZiBzY3JvbGxhYmxlIGFuY2VzdG9ycyAoaWYgYW55KVxuICogdGhlIGBSZWN0YCBpbnN0YW5jZSB3aWxsIGJlIG1vdmVkIGJ5IGlmIHRoZSB2aWV3cG9ydCBpcyBzY3JvbGxlZC5cbiAqIEBwYXJhbSBvcHRpb25zLmFsaWduVG9Ub3AgV2hlbiBzZXQgYHRydWVgLCB0aGUgaGVscGVyIHdpbGwgbWFrZSBzdXJlIHRoZSBgUmVjdGAgaW5zdGFuY2UgaXMgc2Nyb2xsZWQgdXBcbiAqIHRvIHRoZSB0b3AgYm91bmRhcnkgb2YgdGhlIHNjcm9sbGFibGUgYW5jZXN0b3JzIGlmIHNjcm9sbGVkIHVwLiBXaGVuIG5vdCBzZXQgKGRlZmF1bHQpLCB0aGUgYHJlY3RgXG4gKiB3aWxsIGJlIHJldmVhbGVkIGJ5IHNjcm9sbGluZyBhcyBsaXR0bGUgYXMgcG9zc2libGUuIFRoaXMgb3B0aW9uIHdpbGwgbm90IGFmZmVjdCByZWN0cyB0aGF0IG11c3QgYmVcbiAqIHNjcm9sbGVkIGRvd24gYmVjYXVzZSB0aGV5IHdpbGwgYXBwZWFyIGF0IHRoZSB0b3Agb2YgdGhlIGJvdW5kYXJ5XG4gKiBhbnl3YXkuXG4gKiBAcGFyYW0gb3B0aW9ucy5mb3JjZVNjcm9sbCBXaGVuIHNldCBgdHJ1ZWAsIHRoZSBgcmVjdGAgd2lsbCBiZSBhbGlnbmVkIHRvIHRoZSB0b3Agb2Ygc2Nyb2xsYWJsZSBhbmNlc3RvcnNcbiAqIHdoZXRoZXIgaXQgaXMgYWxyZWFkeSB2aXNpYmxlIG9yIG5vdC4gVGhpcyBvcHRpb24gd2lsbCBvbmx5IHdvcmsgd2hlbiBgYWxpZ25Ub1RvcGAgaXMgYHRydWVgXG4gKiBAcGFyYW0gb3B0aW9ucy5saW1pdGVyRWxlbWVudCBUaGUgb3V0ZXJtb3N0IGFuY2VzdG9yIHRoYXQgc2hvdWxkIGJlIHNjcm9sbGVkLiBEZWZhdWx0cyB0byB0aGUgYDxib2R5PmAgZWxlbWVudC5cbiAqLyBmdW5jdGlvbiBzY3JvbGxBbmNlc3RvcnNUb1Nob3dSZWN0KHsgcGFyZW50LCBnZXRSZWN0LCBhbGlnblRvVG9wLCBmb3JjZVNjcm9sbCwgYW5jZXN0b3JPZmZzZXQgPSAwLCBsaW1pdGVyRWxlbWVudCB9KSB7XG4gICAgY29uc3QgcGFyZW50V2luZG93ID0gZ2V0V2luZG93KHBhcmVudCk7XG4gICAgY29uc3QgZm9yY2VTY3JvbGxUb1RvcCA9IGFsaWduVG9Ub3AgJiYgZm9yY2VTY3JvbGw7XG4gICAgbGV0IHBhcmVudFJlY3QsIHRhcmdldFJlY3QsIHRhcmdldEZpdHNJblRhcmdldDtcbiAgICBjb25zdCBsaW1pdGVyID0gbGltaXRlckVsZW1lbnQgfHwgcGFyZW50V2luZG93LmRvY3VtZW50LmJvZHk7XG4gICAgd2hpbGUocGFyZW50ICE9IGxpbWl0ZXIpe1xuICAgICAgICB0YXJnZXRSZWN0ID0gZ2V0UmVjdCgpO1xuICAgICAgICBwYXJlbnRSZWN0ID0gbmV3IFJlY3QocGFyZW50KS5leGNsdWRlU2Nyb2xsYmFyc0FuZEJvcmRlcnMoKTtcbiAgICAgICAgdGFyZ2V0Rml0c0luVGFyZ2V0ID0gcGFyZW50UmVjdC5jb250YWlucyh0YXJnZXRSZWN0KTtcbiAgICAgICAgaWYgKGZvcmNlU2Nyb2xsVG9Ub3ApIHtcbiAgICAgICAgICAgIHBhcmVudC5zY3JvbGxUb3AgLT0gcGFyZW50UmVjdC50b3AgLSB0YXJnZXRSZWN0LnRvcCArIGFuY2VzdG9yT2Zmc2V0O1xuICAgICAgICB9IGVsc2UgaWYgKCF0YXJnZXRGaXRzSW5UYXJnZXQpIHtcbiAgICAgICAgICAgIGlmIChpc0Fib3ZlKHRhcmdldFJlY3QsIHBhcmVudFJlY3QpKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50LnNjcm9sbFRvcCAtPSBwYXJlbnRSZWN0LnRvcCAtIHRhcmdldFJlY3QudG9wICsgYW5jZXN0b3JPZmZzZXQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzQmVsb3codGFyZ2V0UmVjdCwgcGFyZW50UmVjdCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYWxpZ25Ub1RvcCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wICs9IHRhcmdldFJlY3QudG9wIC0gcGFyZW50UmVjdC50b3AgLSBhbmNlc3Rvck9mZnNldDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wICs9IHRhcmdldFJlY3QuYm90dG9tIC0gcGFyZW50UmVjdC5ib3R0b20gKyBhbmNlc3Rvck9mZnNldDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0YXJnZXRGaXRzSW5UYXJnZXQpIHtcbiAgICAgICAgICAgIGlmIChpc0xlZnRPZih0YXJnZXRSZWN0LCBwYXJlbnRSZWN0KSkge1xuICAgICAgICAgICAgICAgIHBhcmVudC5zY3JvbGxMZWZ0IC09IHBhcmVudFJlY3QubGVmdCAtIHRhcmdldFJlY3QubGVmdCArIGFuY2VzdG9yT2Zmc2V0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc1JpZ2h0T2YodGFyZ2V0UmVjdCwgcGFyZW50UmVjdCkpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsTGVmdCArPSB0YXJnZXRSZWN0LnJpZ2h0IC0gcGFyZW50UmVjdC5yaWdodCArIGFuY2VzdG9yT2Zmc2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuICAgIH1cbn1cbi8qKlxuICogRGV0ZXJtaW5lcyBpZiBhIGdpdmVuIGBSZWN0YCBleHRlbmRzIGJleW9uZCB0aGUgYm90dG9tIGVkZ2Ugb2YgdGhlIHNlY29uZCBgUmVjdGAuXG4gKi8gZnVuY3Rpb24gaXNCZWxvdyhmaXJzdFJlY3QsIHNlY29uZFJlY3QpIHtcbiAgICByZXR1cm4gZmlyc3RSZWN0LmJvdHRvbSA+IHNlY29uZFJlY3QuYm90dG9tO1xufVxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIGEgZ2l2ZW4gYFJlY3RgIGV4dGVuZHMgYmV5b25kIHRoZSB0b3AgZWRnZSBvZiB0aGUgc2Vjb25kIGBSZWN0YC5cbiAqLyBmdW5jdGlvbiBpc0Fib3ZlKGZpcnN0UmVjdCwgc2Vjb25kUmVjdCkge1xuICAgIHJldHVybiBmaXJzdFJlY3QudG9wIDwgc2Vjb25kUmVjdC50b3A7XG59XG4vKipcbiAqIERldGVybWluZXMgaWYgYSBnaXZlbiBgUmVjdGAgZXh0ZW5kcyBiZXlvbmQgdGhlIGxlZnQgZWRnZSBvZiB0aGUgc2Vjb25kIGBSZWN0YC5cbiAqLyBmdW5jdGlvbiBpc0xlZnRPZihmaXJzdFJlY3QsIHNlY29uZFJlY3QpIHtcbiAgICByZXR1cm4gZmlyc3RSZWN0LmxlZnQgPCBzZWNvbmRSZWN0LmxlZnQ7XG59XG4vKipcbiAqIERldGVybWluZXMgaWYgYSBnaXZlbiBgUmVjdGAgZXh0ZW5kcyBiZXlvbmQgdGhlIHJpZ2h0IGVkZ2Ugb2YgdGhlIHNlY29uZCBgUmVjdGAuXG4gKi8gZnVuY3Rpb24gaXNSaWdodE9mKGZpcnN0UmVjdCwgc2Vjb25kUmVjdCkge1xuICAgIHJldHVybiBmaXJzdFJlY3QucmlnaHQgPiBzZWNvbmRSZWN0LnJpZ2h0O1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBjbG9zZXN0IHdpbmRvdyBvZiBhbiBlbGVtZW50IG9yIHJhbmdlLlxuICovIGZ1bmN0aW9uIGdldFdpbmRvdyhlbGVtZW50T3JSYW5nZSkge1xuICAgIGlmIChpc1JhbmdlKGVsZW1lbnRPclJhbmdlKSkge1xuICAgICAgICByZXR1cm4gZWxlbWVudE9yUmFuZ2Uuc3RhcnRDb250YWluZXIub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZWxlbWVudE9yUmFuZ2Uub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldztcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGNsb3Nlc3QgcGFyZW50IG9mIGFuIGVsZW1lbnQgb3IgRE9NIHJhbmdlLlxuICovIGZ1bmN0aW9uIGdldFBhcmVudEVsZW1lbnQoZWxlbWVudE9yUmFuZ2UpIHtcbiAgICBpZiAoaXNSYW5nZShlbGVtZW50T3JSYW5nZSkpIHtcbiAgICAgICAgbGV0IHBhcmVudCA9IGVsZW1lbnRPclJhbmdlLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyO1xuICAgICAgICAvLyBJZiBhIFJhbmdlIGlzIGF0dGFjaGVkIHRvIHRoZSBUZXh0LCB1c2UgdGhlIGNsb3Nlc3QgZWxlbWVudCBhbmNlc3Rvci5cbiAgICAgICAgaWYgKGlzVGV4dChwYXJlbnQpKSB7XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50T3JSYW5nZS5wYXJlbnROb2RlO1xuICAgIH1cbn1cbi8qKlxuICogUmV0dXJucyB0aGUgcmVjdCBvZiBhbiBlbGVtZW50IG9yIHJhbmdlIHJlc2lkaW5nIGluIGFuIGlmcmFtZS5cbiAqIFRoZSByZXN1bHQgcmVjdCBpcyByZWxhdGl2ZSB0byB0aGUgZ2VvbWV0cnkgb2YgdGhlIHBhc3NlZCB3aW5kb3cgaW5zdGFuY2UuXG4gKlxuICogQHBhcmFtIHRhcmdldCBFbGVtZW50IG9yIHJhbmdlIHdoaWNoIHJlY3Qgc2hvdWxkIGJlIHJldHVybmVkLlxuICogQHBhcmFtIHJlbGF0aXZlV2luZG93IEEgd2luZG93IHRoZSByZWN0IHNob3VsZCBiZSByZWxhdGl2ZSB0by5cbiAqLyBmdW5jdGlvbiBnZXRSZWN0UmVsYXRpdmVUb1dpbmRvdyh0YXJnZXQsIHJlbGF0aXZlV2luZG93KSB7XG4gICAgY29uc3QgdGFyZ2V0V2luZG93ID0gZ2V0V2luZG93KHRhcmdldCk7XG4gICAgY29uc3QgcmVjdCA9IG5ldyBSZWN0KHRhcmdldCk7XG4gICAgaWYgKHRhcmdldFdpbmRvdyA9PT0gcmVsYXRpdmVXaW5kb3cpIHtcbiAgICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGN1cnJlbnRXaW5kb3cgPSB0YXJnZXRXaW5kb3c7XG4gICAgICAgIHdoaWxlKGN1cnJlbnRXaW5kb3cgIT0gcmVsYXRpdmVXaW5kb3cpe1xuICAgICAgICAgICAgY29uc3QgZnJhbWUgPSBjdXJyZW50V2luZG93LmZyYW1lRWxlbWVudDtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lUmVjdCA9IG5ldyBSZWN0KGZyYW1lKS5leGNsdWRlU2Nyb2xsYmFyc0FuZEJvcmRlcnMoKTtcbiAgICAgICAgICAgIHJlY3QubW92ZUJ5KGZyYW1lUmVjdC5sZWZ0LCBmcmFtZVJlY3QudG9wKTtcbiAgICAgICAgICAgIGN1cnJlbnRXaW5kb3cgPSBjdXJyZW50V2luZG93LnBhcmVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVjdDtcbn1cbi8qKlxuICogQSBoZWxwZXIgdGhhdCBleHBsb2RlcyB0aGUgYHZpZXdwb3J0T2Zmc2V0YCBjb25maWd1cmF0aW9uIGlmIGRlZmluZWQgYXMgYSBwbGFpbiBudW1iZXIgaW50byBhbiBvYmplY3RcbiAqIHdpdGggYHRvcGAsIGBib3R0b21gLCBgbGVmdGAsIGFuZCBgcmlnaHRgIHByb3BlcnRpZXMuXG4gKlxuICogSWYgYW4gb2JqZWN0IHZhbHVlIGlzIHBhc3NlZCwgdGhpcyBoZWxwZXIgd2lsbCBwYXNzIGl0IHRocm91Z2guXG4gKlxuICogQHBhcmFtIHZpZXdwb3J0T2Zmc2V0IFZpZXdwb3J0IG9mZnNldCB0byBiZSBub3JtYWxpemVkLlxuICovIGZ1bmN0aW9uIG5vcm1hbGl6ZVZpZXdwb3J0T2Zmc2V0KHZpZXdwb3J0T2Zmc2V0KSB7XG4gICAgaWYgKHR5cGVvZiB2aWV3cG9ydE9mZnNldCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogdmlld3BvcnRPZmZzZXQsXG4gICAgICAgICAgICBib3R0b206IHZpZXdwb3J0T2Zmc2V0LFxuICAgICAgICAgICAgbGVmdDogdmlld3BvcnRPZmZzZXQsXG4gICAgICAgICAgICByaWdodDogdmlld3BvcnRPZmZzZXRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHZpZXdwb3J0T2Zmc2V0O1xufVxuXG5jb25zdCBtb2RpZmllcnNUb0dseXBoc01hYyA9IHtcbiAgICBjdHJsOiAn4oyDJyxcbiAgICBjbWQ6ICfijJgnLFxuICAgIGFsdDogJ+KMpScsXG4gICAgc2hpZnQ6ICfih6cnXG59O1xuY29uc3QgbW9kaWZpZXJzVG9HbHlwaHNOb25NYWMgPSB7XG4gICAgY3RybDogJ0N0cmwrJyxcbiAgICBhbHQ6ICdBbHQrJyxcbiAgICBzaGlmdDogJ1NoaWZ0Kydcbn07XG5jb25zdCBrZXlDb2Rlc1RvR2x5cGhzID0ge1xuICAgIDM3OiAn4oaQJyxcbiAgICAzODogJ+KGkScsXG4gICAgMzk6ICfihpInLFxuICAgIDQwOiAn4oaTJyxcbiAgICA5OiAn4oelJyxcbiAgICAzMzogJ1BhZ2UgVXAnLFxuICAgIDM0OiAnUGFnZSBEb3duJ1xufTtcbi8qKlxuICogQW4gb2JqZWN0IHdpdGggYGtleU5hbWUgPT4ga2V5Q29kZWAgcGFpcnMgZm9yIGEgc2V0IG9mIGtub3duIGtleXMuXG4gKlxuICogQ29udGFpbnM6XG4gKlxuICogKiBgYS16YCxcbiAqICogYDAtOWAsXG4gKiAqIGBmMS1mMTJgLFxuICogKiBgYCBgIGBgLCBgLWAsIGA9YCwgYFtgLCBgXWAsIGA7YCwgYCdgLCBgLGAsIGAuYCwgYC9gLCBgXFxgLFxuICogKiBgYXJyb3cobGVmdHx1cHxyaWdodHxib3R0b20pYCxcbiAqICogYGJhY2tzcGFjZWAsIGBkZWxldGVgLCBgZW5kYCwgYGVudGVyYCwgYGVzY2AsIGBob21lYCwgYHRhYmAsXG4gKiAqIGBjdHJsYCwgYGNtZGAsIGBzaGlmdGAsIGBhbHRgLlxuICovIGNvbnN0IGtleUNvZGVzID0gLyogI19fUFVSRV9fICovIGdlbmVyYXRlS25vd25LZXlDb2RlcygpO1xuY29uc3Qga2V5Q29kZU5hbWVzID0gLyogI19fUFVSRV9fICovIE9iamVjdC5mcm9tRW50cmllcygvKiAjX19QVVJFX18gKi8gT2JqZWN0LmVudHJpZXMoa2V5Q29kZXMpLm1hcCgoW25hbWUsIGNvZGVdKT0+e1xuICAgIGxldCBwcmV0dHlLZXlOYW1lO1xuICAgIGlmIChjb2RlIGluIGtleUNvZGVzVG9HbHlwaHMpIHtcbiAgICAgICAgcHJldHR5S2V5TmFtZSA9IGtleUNvZGVzVG9HbHlwaHNbY29kZV07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcHJldHR5S2V5TmFtZSA9IG5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBjb2RlLFxuICAgICAgICBwcmV0dHlLZXlOYW1lXG4gICAgXTtcbn0pKTtcbi8qKlxuICogQ29udmVydHMgYSBrZXkgbmFtZSBvciB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfktleXN0cm9rZUluZm8ga2V5c3Ryb2tlIGluZm99IGludG8gYSBrZXkgY29kZS5cbiAqXG4gKiBOb3RlOiBLZXkgbmFtZXMgYXJlIG1hdGNoZWQgd2l0aCB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkI2tleUNvZGVzfSBpbiBhIGNhc2UtaW5zZW5zaXRpdmUgd2F5LlxuICpcbiAqIEBwYXJhbSBrZXkgQSBrZXkgbmFtZSAoc2VlIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmQja2V5Q29kZXN9KSBvciBhIGtleXN0cm9rZSBkYXRhIG9iamVjdC5cbiAqIEByZXR1cm5zIEtleSBvciBrZXlzdHJva2UgY29kZS5cbiAqLyBmdW5jdGlvbiBnZXRDb2RlKGtleSkge1xuICAgIGxldCBrZXlDb2RlO1xuICAgIGlmICh0eXBlb2Yga2V5ID09ICdzdHJpbmcnKSB7XG4gICAgICAgIGtleUNvZGUgPSBrZXlDb2Rlc1trZXkudG9Mb3dlckNhc2UoKV07XG4gICAgICAgIGlmICgha2V5Q29kZSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBVbmtub3duIGtleSBuYW1lLiBPbmx5IGtleSBuYW1lcyBpbmNsdWRlZCBpbiB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9rZXlib2FyZCNrZXlDb2Rlc30gY2FuIGJlIHVzZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGtleWJvYXJkLXVua25vd24ta2V5XG5cdFx0XHQgKiBAcGFyYW0ge1N0cmluZ30ga2V5XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2tleWJvYXJkLXVua25vd24ta2V5JywgbnVsbCwge1xuICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBrZXlDb2RlID0ga2V5LmtleUNvZGUgKyAoa2V5LmFsdEtleSA/IGtleUNvZGVzLmFsdCA6IDApICsgKGtleS5jdHJsS2V5ID8ga2V5Q29kZXMuY3RybCA6IDApICsgKGtleS5zaGlmdEtleSA/IGtleUNvZGVzLnNoaWZ0IDogMCkgKyAoa2V5Lm1ldGFLZXkgPyBrZXlDb2Rlcy5jbWQgOiAwKTtcbiAgICB9XG4gICAgcmV0dXJuIGtleUNvZGU7XG59XG4vKipcbiAqIFBhcnNlcyB0aGUga2V5c3Ryb2tlIGFuZCByZXR1cm5zIGEga2V5c3Ryb2tlIGNvZGUgdGhhdCB3aWxsIG1hdGNoIHRoZSBjb2RlIHJldHVybmVkIGJ5XG4gKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfmdldENvZGV9IGZvciB0aGUgY29ycmVzcG9uZGluZyB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfktleXN0cm9rZUluZm8ga2V5c3Ryb2tlIGluZm99LlxuICpcbiAqIFRoZSBrZXlzdHJva2UgY2FuIGJlIHBhc3NlZCBpbiB0d28gZm9ybWF0czpcbiAqXG4gKiAqIGFzIGEgc2luZ2xlIHN0cmluZyDigJMgZS5nLiBgY3RybCArIEFgLFxuICogKiBhcyBhbiBhcnJheSBvZiB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfmtleUNvZGVzIGtub3duIGtleSBuYW1lc30gYW5kIGtleSBjb2RlcyDigJMgZS5nLjpcbiAqICAgKiBgWyAnY3RybCcsIDMyIF1gIChjdHJsICsgc3BhY2UpLFxuICogICAqIGBbICdjdHJsJywgJ2EnIF1gIChjdHJsICsgQSkuXG4gKlxuICogTm90ZTogS2V5IG5hbWVzIGFyZSBtYXRjaGVkIHdpdGgge0BsaW5rIG1vZHVsZTp1dGlscy9rZXlib2FyZCNrZXlDb2Rlc30gaW4gYSBjYXNlLWluc2Vuc2l0aXZlIHdheS5cbiAqXG4gKiBOb3RlOiBPbmx5IGtleXN0cm9rZXMgd2l0aCBhIHNpbmdsZSBub24tbW9kaWZpZXIga2V5IGFyZSBzdXBwb3J0ZWQgKGUuZy4gYGN0cmwrQWAgaXMgT0ssIGJ1dCBgY3RybCtBK0JgIGlzIG5vdCkuXG4gKlxuICogTm90ZTogT24gbWFjT1MsIGtleXN0cm9rZSBoYW5kbGluZyBpcyB0cmFuc2xhdGluZyB0aGUgYEN0cmxgIGtleSB0byB0aGUgYENtZGAga2V5IGFuZCBoYW5kbGluZyBvbmx5IHRoYXQga2V5c3Ryb2tlLlxuICogRm9yIGV4YW1wbGUsIGEgcmVnaXN0ZXJlZCBrZXlzdHJva2UgYEN0cmwrQWAgd2lsbCBiZSB0cmFuc2xhdGVkIHRvIGBDbWQrQWAgb24gbWFjT1MuIFRvIGRpc2FibGUgdGhlIHRyYW5zbGF0aW9uIG9mIHNvbWUga2V5c3Ryb2tlLFxuICogdXNlIHRoZSBmb3JjZWQgbW9kaWZpZXI6IGBDdHJsIStBYCAobm90ZSB0aGUgZXhjbGFtYXRpb24gbWFyaykuXG4gKlxuICogQHBhcmFtIGtleXN0cm9rZSBUaGUga2V5c3Ryb2tlIGRlZmluaXRpb24uXG4gKiBAcmV0dXJucyBLZXlzdHJva2UgY29kZS5cbiAqLyBmdW5jdGlvbiBwYXJzZUtleXN0cm9rZShrZXlzdHJva2UpIHtcbiAgICBpZiAodHlwZW9mIGtleXN0cm9rZSA9PSAnc3RyaW5nJykge1xuICAgICAgICBrZXlzdHJva2UgPSBzcGxpdEtleXN0cm9rZVRleHQoa2V5c3Ryb2tlKTtcbiAgICB9XG4gICAgcmV0dXJuIGtleXN0cm9rZS5tYXAoKGtleSk9PnR5cGVvZiBrZXkgPT0gJ3N0cmluZycgPyBnZXRFbnZLZXlDb2RlKGtleSkgOiBrZXkpLnJlZHVjZSgoa2V5LCBzdW0pPT5zdW0gKyBrZXksIDApO1xufVxuLyoqXG4gKiBUcmFuc2xhdGVzIGFueSBrZXlzdHJva2Ugc3RyaW5nIHRleHQgbGlrZSBgXCJDdHJsK0FcImAgdG8gYW5cbiAqIGVudmlyb25tZW504oCTc3BlY2lmaWMga2V5c3Ryb2tlLCBpLmUuIGBcIuKMmEFcImAgb24gbWFjT1MuXG4gKlxuICogQHBhcmFtIGtleXN0cm9rZSBUaGUga2V5c3Ryb2tlIHRleHQuXG4gKiBAcGFyYW0gW2ZvcmNlZEVudl0gVGhlIGVudmlyb25tZW50IHRvIGZvcmNlIHRoZSBrZXkgdHJhbnNsYXRpb24gdG8uIElmIG5vdCBwcm92aWRlZCwgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgaXMgdXNlZC5cbiAqIEByZXR1cm5zIFRoZSBrZXlzdHJva2UgdGV4dCBzcGVjaWZpYyBmb3IgdGhlIGVudmlyb25tZW50LlxuICovIGZ1bmN0aW9uIGdldEVudktleXN0cm9rZVRleHQoa2V5c3Ryb2tlLCBmb3JjZWRFbnYpIHtcbiAgICBsZXQga2V5c3Ryb2tlQ29kZSA9IHBhcnNlS2V5c3Ryb2tlKGtleXN0cm9rZSk7XG4gICAgY29uc3QgaXNNYWMgPSBmb3JjZWRFbnYgPyBmb3JjZWRFbnYgPT09ICdNYWMnIDogZW52LmlzTWFjIHx8IGVudi5pc2lPUztcbiAgICBjb25zdCBtb2RpZmllcnNUb0dseXBocyA9IE9iamVjdC5lbnRyaWVzKGlzTWFjID8gbW9kaWZpZXJzVG9HbHlwaHNNYWMgOiBtb2RpZmllcnNUb0dseXBoc05vbk1hYyk7XG4gICAgY29uc3QgbW9kaWZpZXJzID0gbW9kaWZpZXJzVG9HbHlwaHMucmVkdWNlKChtb2RpZmllcnMsIFtuYW1lLCBnbHlwaF0pPT57XG4gICAgICAgIC8vIE1vZGlmaWVyIGtleXMgYXJlIHN0b3JlZCBhcyBhIGJpdCBtYXNrIHNvIGV4dHJhY3QgdGhvc2UgZnJvbSB0aGUga2V5c3Ryb2tlIGNvZGUuXG4gICAgICAgIGlmICgoa2V5c3Ryb2tlQ29kZSAmIGtleUNvZGVzW25hbWVdKSAhPSAwKSB7XG4gICAgICAgICAgICBrZXlzdHJva2VDb2RlICY9IH5rZXlDb2Rlc1tuYW1lXTtcbiAgICAgICAgICAgIG1vZGlmaWVycyArPSBnbHlwaDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbW9kaWZpZXJzO1xuICAgIH0sICcnKTtcbiAgICByZXR1cm4gbW9kaWZpZXJzICsgKGtleXN0cm9rZUNvZGUgPyBrZXlDb2RlTmFtZXNba2V5c3Ryb2tlQ29kZV0gOiAnJyk7XG59XG4vKipcbiAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBwcm92aWRlZCBrZXkgY29kZSByZXByZXNlbnRzIG9uZSBvZiB0aGUgYXJyb3cga2V5cy5cbiAqXG4gKiBAcGFyYW0ga2V5Q29kZSBBIGtleSBjb2RlIGFzIGluIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmR+S2V5c3Ryb2tlSW5mbyNrZXlDb2RlfS5cbiAqLyBmdW5jdGlvbiBpc0Fycm93S2V5Q29kZShrZXlDb2RlKSB7XG4gICAgcmV0dXJuIGtleUNvZGUgPT0ga2V5Q29kZXMuYXJyb3dyaWdodCB8fCBrZXlDb2RlID09IGtleUNvZGVzLmFycm93bGVmdCB8fCBrZXlDb2RlID09IGtleUNvZGVzLmFycm93dXAgfHwga2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd2Rvd247XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGRpcmVjdGlvbiBpbiB3aGljaCB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb24gc2VsZWN0aW9ufVxuICogd2lsbCBtb3ZlIHdoZW4gdGhlIHByb3ZpZGVkIGFycm93IGtleSBjb2RlIGlzIHByZXNzZWQgY29uc2lkZXJpbmcgdGhlIGxhbmd1YWdlIGRpcmVjdGlvbiBvZiB0aGUgZWRpdG9yIGNvbnRlbnQuXG4gKlxuICogRm9yIGluc3RhbmNlLCBpbiByaWdodOKAk3Rv4oCTbGVmdCAoUlRMKSBjb250ZW50IGxhbmd1YWdlcywgcHJlc3NpbmcgdGhlIGxlZnQgYXJyb3cgbWVhbnMgbW92aW5nIHRoZSBzZWxlY3Rpb24gcmlnaHQgKGZvcndhcmQpXG4gKiBpbiB0aGUgbW9kZWwgc3RydWN0dXJlLiBTaW1pbGFybHksIHByZXNzaW5nIHRoZSByaWdodCBhcnJvdyBtb3ZlcyB0aGUgc2VsZWN0aW9uIGxlZnQgKGJhY2t3YXJkKS5cbiAqXG4gKiBAcGFyYW0ga2V5Q29kZSBBIGtleSBjb2RlIGFzIGluIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmR+S2V5c3Ryb2tlSW5mbyNrZXlDb2RlfS5cbiAqIEBwYXJhbSBjb250ZW50TGFuZ3VhZ2VEaXJlY3Rpb24gVGhlIGNvbnRlbnQgbGFuZ3VhZ2UgZGlyZWN0aW9uLCBjb3JyZXNwb25kaW5nIHRvXG4gKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2xvY2FsZX5Mb2NhbGUjY29udGVudExhbmd1YWdlRGlyZWN0aW9ufS5cbiAqIEByZXR1cm5zIExvY2FsaXplZCBhcnJvdyBkaXJlY3Rpb24gb3IgYHVuZGVmaW5lZGAgZm9yIG5vbi1hcnJvdyBrZXkgY29kZXMuXG4gKi8gZnVuY3Rpb24gZ2V0TG9jYWxpemVkQXJyb3dLZXlDb2RlRGlyZWN0aW9uKGtleUNvZGUsIGNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbikge1xuICAgIGNvbnN0IGlzTHRyQ29udGVudCA9IGNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbiA9PT0gJ2x0cic7XG4gICAgc3dpdGNoKGtleUNvZGUpe1xuICAgICAgICBjYXNlIGtleUNvZGVzLmFycm93bGVmdDpcbiAgICAgICAgICAgIHJldHVybiBpc0x0ckNvbnRlbnQgPyAnbGVmdCcgOiAncmlnaHQnO1xuICAgICAgICBjYXNlIGtleUNvZGVzLmFycm93cmlnaHQ6XG4gICAgICAgICAgICByZXR1cm4gaXNMdHJDb250ZW50ID8gJ3JpZ2h0JyA6ICdsZWZ0JztcbiAgICAgICAgY2FzZSBrZXlDb2Rlcy5hcnJvd3VwOlxuICAgICAgICAgICAgcmV0dXJuICd1cCc7XG4gICAgICAgIGNhc2Uga2V5Q29kZXMuYXJyb3dkb3duOlxuICAgICAgICAgICAgcmV0dXJuICdkb3duJztcbiAgICB9XG59XG4vKipcbiAqIENvbnZlcnRzIGEga2V5IG5hbWUgdG8gdGhlIGtleSBjb2RlIHdpdGggbWFwcGluZyBiYXNlZCBvbiB0aGUgZW52LlxuICpcbiAqIFNlZToge0BsaW5rIG1vZHVsZTp1dGlscy9rZXlib2FyZH5nZXRDb2RlfS5cbiAqXG4gKiBAcGFyYW0ga2V5IFRoZSBrZXkgbmFtZSAoc2VlIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmQja2V5Q29kZXN9KS5cbiAqIEByZXR1cm5zIEtleSBjb2RlLlxuICovIGZ1bmN0aW9uIGdldEVudktleUNvZGUoa2V5KSB7XG4gICAgLy8gRG9uJ3QgcmVtYXAgbW9kaWZpZXIga2V5IGZvciBmb3JjZWQgbW9kaWZpZXJzLlxuICAgIGlmIChrZXkuZW5kc1dpdGgoJyEnKSkge1xuICAgICAgICByZXR1cm4gZ2V0Q29kZShrZXkuc2xpY2UoMCwgLTEpKTtcbiAgICB9XG4gICAgY29uc3QgY29kZSA9IGdldENvZGUoa2V5KTtcbiAgICByZXR1cm4gKGVudi5pc01hYyB8fCBlbnYuaXNpT1MpICYmIGNvZGUgPT0ga2V5Q29kZXMuY3RybCA/IGtleUNvZGVzLmNtZCA6IGNvZGU7XG59XG4vKipcbiAqIERldGVybWluZXMgaWYgdGhlIHByb3ZpZGVkIGtleSBjb2RlIG1vdmVzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiBzZWxlY3Rpb259XG4gKiBmb3J3YXJkIG9yIGJhY2t3YXJkIGNvbnNpZGVyaW5nIHRoZSBsYW5ndWFnZSBkaXJlY3Rpb24gb2YgdGhlIGVkaXRvciBjb250ZW50LlxuICpcbiAqIEZvciBpbnN0YW5jZSwgaW4gcmlnaHTigJN0b+KAk2xlZnQgKFJUTCkgbGFuZ3VhZ2VzLCBwcmVzc2luZyB0aGUgbGVmdCBhcnJvdyBtZWFucyBtb3ZpbmcgZm9yd2FyZFxuICogaW4gdGhlIG1vZGVsIHN0cnVjdHVyZS4gU2ltaWxhcmx5LCBwcmVzc2luZyB0aGUgcmlnaHQgYXJyb3cgbW92ZXMgdGhlIHNlbGVjdGlvbiBiYWNrd2FyZC5cbiAqXG4gKiBAcGFyYW0ga2V5Q29kZSBBIGtleSBjb2RlIGFzIGluIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmR+S2V5c3Ryb2tlSW5mbyNrZXlDb2RlfS5cbiAqIEBwYXJhbSBjb250ZW50TGFuZ3VhZ2VEaXJlY3Rpb24gVGhlIGNvbnRlbnQgbGFuZ3VhZ2UgZGlyZWN0aW9uLCBjb3JyZXNwb25kaW5nIHRvXG4gKiB7QGxpbmsgbW9kdWxlOnV0aWxzL2xvY2FsZX5Mb2NhbGUjY29udGVudExhbmd1YWdlRGlyZWN0aW9ufS5cbiAqLyBmdW5jdGlvbiBpc0ZvcndhcmRBcnJvd0tleUNvZGUoa2V5Q29kZSwgY29udGVudExhbmd1YWdlRGlyZWN0aW9uKSB7XG4gICAgY29uc3QgbG9jYWxpemVkS2V5Q29kZURpcmVjdGlvbiA9IGdldExvY2FsaXplZEFycm93S2V5Q29kZURpcmVjdGlvbihrZXlDb2RlLCBjb250ZW50TGFuZ3VhZ2VEaXJlY3Rpb24pO1xuICAgIHJldHVybiBsb2NhbGl6ZWRLZXlDb2RlRGlyZWN0aW9uID09PSAnZG93bicgfHwgbG9jYWxpemVkS2V5Q29kZURpcmVjdGlvbiA9PT0gJ3JpZ2h0Jztcbn1cbmZ1bmN0aW9uIGdlbmVyYXRlS25vd25LZXlDb2RlcygpIHtcbiAgICBjb25zdCBrZXlDb2RlcyA9IHtcbiAgICAgICAgcGFnZXVwOiAzMyxcbiAgICAgICAgcGFnZWRvd246IDM0LFxuICAgICAgICBlbmQ6IDM1LFxuICAgICAgICBob21lOiAzNixcbiAgICAgICAgYXJyb3dsZWZ0OiAzNyxcbiAgICAgICAgYXJyb3d1cDogMzgsXG4gICAgICAgIGFycm93cmlnaHQ6IDM5LFxuICAgICAgICBhcnJvd2Rvd246IDQwLFxuICAgICAgICBiYWNrc3BhY2U6IDgsXG4gICAgICAgIGRlbGV0ZTogNDYsXG4gICAgICAgIGVudGVyOiAxMyxcbiAgICAgICAgc3BhY2U6IDMyLFxuICAgICAgICBlc2M6IDI3LFxuICAgICAgICB0YWI6IDksXG4gICAgICAgIC8vIFRoZSBpZGVhIGFib3V0IHRoZXNlIG51bWJlcnMgaXMgdGhhdCB0aGV5IGRvIG5vdCBjb2xsaWRlIHdpdGggYW55IHJlYWwga2V5IGNvZGVzLCBzbyB3ZSBjYW4gdXNlIHRoZW1cbiAgICAgICAgLy8gbGlrZSBiaXQgbWFza3MuXG4gICAgICAgIGN0cmw6IDB4MTEwMDAwLFxuICAgICAgICBzaGlmdDogMHgyMjAwMDAsXG4gICAgICAgIGFsdDogMHg0NDAwMDAsXG4gICAgICAgIGNtZDogMHg4ODAwMDBcbiAgICB9O1xuICAgIC8vIGEtelxuICAgIGZvcihsZXQgY29kZSA9IDY1OyBjb2RlIDw9IDkwOyBjb2RlKyspe1xuICAgICAgICBjb25zdCBsZXR0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpO1xuICAgICAgICBrZXlDb2Rlc1tsZXR0ZXIudG9Mb3dlckNhc2UoKV0gPSBjb2RlO1xuICAgIH1cbiAgICAvLyAwLTlcbiAgICBmb3IobGV0IGNvZGUgPSA0ODsgY29kZSA8PSA1NzsgY29kZSsrKXtcbiAgICAgICAga2V5Q29kZXNbY29kZSAtIDQ4XSA9IGNvZGU7XG4gICAgfVxuICAgIC8vIEYxLUYxMlxuICAgIGZvcihsZXQgY29kZSA9IDExMjsgY29kZSA8PSAxMjM7IGNvZGUrKyl7XG4gICAgICAgIGtleUNvZGVzWydmJyArIChjb2RlIC0gMTExKV0gPSBjb2RlO1xuICAgIH1cbiAgICAvLyBvdGhlciBjaGFyYWN0ZXJzXG4gICAgT2JqZWN0LmFzc2lnbihrZXlDb2Rlcywge1xuICAgICAgICAnXFwnJzogMjIyLFxuICAgICAgICAnLCc6IDEwOCxcbiAgICAgICAgJy0nOiAxMDksXG4gICAgICAgICcuJzogMTEwLFxuICAgICAgICAnLyc6IDExMSxcbiAgICAgICAgJzsnOiAxODYsXG4gICAgICAgICc9JzogMTg3LFxuICAgICAgICAnWyc6IDIxOSxcbiAgICAgICAgJ1xcXFwnOiAyMjAsXG4gICAgICAgICddJzogMjIxLFxuICAgICAgICAnYCc6IDIyM1xuICAgIH0pO1xuICAgIHJldHVybiBrZXlDb2Rlcztcbn1cbmZ1bmN0aW9uIHNwbGl0S2V5c3Ryb2tlVGV4dChrZXlzdHJva2UpIHtcbiAgICByZXR1cm4ga2V5c3Ryb2tlLnNwbGl0KCcrJykubWFwKChrZXkpPT5rZXkudHJpbSgpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9sYW5ndWFnZVxuICovIC8qKlxuICogU3RyaW5nIHJlcHJlc2VudGluZyBhIGxhbmd1YWdlIGRpcmVjdGlvbi5cbiAqLyBjb25zdCBSVExfTEFOR1VBR0VfQ09ERVMgPSBbXG4gICAgJ2FyJyxcbiAgICAnYXJhJyxcbiAgICAnZHYnLFxuICAgICdkaXYnLFxuICAgICdmYScsXG4gICAgJ3BlcicsXG4gICAgJ2ZhcycsXG4gICAgJ2hlJyxcbiAgICAnaGViJyxcbiAgICAna3UnLFxuICAgICdrdXInLFxuICAgICd1ZycsXG4gICAgJ3VpZycgLy8gVWlnaHVyLCBVeWdodXJcbl07XG4vKipcbiAqIEhlbHBzIGRldGVybWluZSB3aGV0aGVyIGEgbGFuZ3VhZ2UgdGV4dCBkaXJlY3Rpb24gaXMgTFRSIG9yIFJUTC5cbiAqXG4gKiBAcGFyYW0gbGFuZ3VhZ2VDb2RlIFRoZSBJU08gNjM5LTEgb3IgSVNPIDYzOS0yIGxhbmd1YWdlIGNvZGUuXG4gKi8gZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24obGFuZ3VhZ2VDb2RlKSB7XG4gICAgcmV0dXJuIFJUTF9MQU5HVUFHRV9DT0RFUy5pbmNsdWRlcyhsYW5ndWFnZUNvZGUpID8gJ3J0bCcgOiAnbHRyJztcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy90b2FycmF5XG4gKi8gLyoqXG4gKiBUcmFuc2Zvcm1zIGFueSB2YWx1ZSB0byBhbiBhcnJheS4gSWYgdGhlIHByb3ZpZGVkIHZhbHVlIGlzIGFscmVhZHkgYW4gYXJyYXksIGl0IGlzIHJldHVybmVkIHVuY2hhbmdlZC5cbiAqXG4gKiBAbGFiZWwgTVVUQUJMRVxuICogQHBhcmFtIGRhdGEgVGhlIHZhbHVlIHRvIHRyYW5zZm9ybSB0byBhbiBhcnJheS5cbiAqIEByZXR1cm5zIEFuIGFycmF5IGNyZWF0ZWQgZnJvbSBkYXRhLlxuICovIGZ1bmN0aW9uIHRvQXJyYXkoZGF0YSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YSA6IFtcbiAgICAgICAgZGF0YVxuICAgIF07XG59XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlIC0tIEBwcmVzZXJ2ZSAqLyBpZiAoIWdsb2JhbC53aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TKSB7XG4gICAgZ2xvYmFsLndpbmRvdy5DS0VESVRPUl9UUkFOU0xBVElPTlMgPSB7fTtcbn1cbi8qKlxuICogQWRkcyB0cmFuc2xhdGlvbnMgdG8gZXhpc3Rpbmcgb25lcyBvciBvdmVycmlkZXMgdGhlIGV4aXN0aW5nIHRyYW5zbGF0aW9ucy4gVGhlc2UgdHJhbnNsYXRpb25zIHdpbGwgbGF0ZXJcbiAqIGJlIGF2YWlsYWJsZSBmb3IgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvbG9jYWxlfkxvY2FsZSN0IGB0KClgfSBmdW5jdGlvbi5cbiAqXG4gKiBUaGUgYHRyYW5zbGF0aW9uc2AgaXMgYW4gb2JqZWN0IHdoaWNoIGNvbnNpc3RzIG9mIGBtZXNzYWdlSWQ6IHRyYW5zbGF0aW9uYCBwYWlycy4gTm90ZSB0aGF0IHRoZSBtZXNzYWdlIElEIGNhbiBiZVxuICogZWl0aGVyIGNvbnN0cnVjdGVkIGZyb20gdGhlIG1lc3NhZ2Ugc3RyaW5nIG9yIGZyb20gdGhlIG1lc3NhZ2UgSUQgaWYgaXQgd2FzIHBhc3NlZFxuICogKHRoaXMgaGFwcGVucyByYXJlbHkgYW5kIG1vc3RseSBmb3Igc2hvcnQgbWVzc2FnZXMgb3IgbWVzc2FnZXMgd2l0aCBwbGFjZWhvbGRlcnMpLlxuICogU2luY2UgdGhlIGVkaXRvciBkaXNwbGF5cyBvbmx5IHRoZSBtZXNzYWdlIHN0cmluZywgdGhlIG1lc3NhZ2UgSUQgY2FuIGJlIGZvdW5kIGVpdGhlciBpbiB0aGUgc291cmNlIGNvZGUgb3IgaW4gdGhlXG4gKiBidWlsdCB0cmFuc2xhdGlvbnMgZm9yIGFub3RoZXIgbGFuZ3VhZ2UuXG4gKlxuICogYGBgdHNcbiAqIGFkZCggJ3BsJywge1xuICogXHQnQ2FuY2VsJzogJ0FudWx1aicsXG4gKiBcdCdJTUFHRSc6ICdvYnJheicsIC8vIE5vdGUgdGhhdCB0aGUgYElNQUdFYCBjb21lcyBmcm9tIHRoZSBtZXNzYWdlIElELCB3aGlsZSB0aGUgc3RyaW5nIGNhbiBiZSBgaW1hZ2VgLlxuICogfSApO1xuICogYGBgXG4gKlxuICogSWYgdGhlIG1lc3NhZ2UgaXMgc3VwcG9zZWQgdG8gc3VwcG9ydCB2YXJpb3VzIHBsdXJhbCBmb3JtcywgbWFrZSBzdXJlIHRvIHByb3ZpZGUgYW4gYXJyYXkgd2l0aCB0aGUgc2luZ3VsYXIgZm9ybSBhbmQgYWxsIHBsdXJhbCBmb3JtczpcbiAqXG4gKiBgYGB0c1xuICogYWRkKCAncGwnLCB7XG4gKiBcdCdBZGQgc3BhY2UnOiBbICdEb2RhaiBzcGFjasSZJywgJ0RvZGFqICUwIHNwYWNqZScsICdEb2RhaiAlMCBzcGFjamknIF1cbiAqIH0gKTtcbiAqIGBgYFxuICpcbiAqIFlvdSBzaG91bGQgYWxzbyBzcGVjaWZ5IHRoZSB0aGlyZCBhcmd1bWVudCAodGhlIGBnZXRQbHVyYWxGb3JtKClgIGZ1bmN0aW9uKSB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZXRlcm1pbmUgdGhlIHBsdXJhbCBmb3JtIGlmIG5vXG4gKiBsYW5ndWFnZSBmaWxlIHdhcyBsb2FkZWQgZm9yIHRoYXQgbGFuZ3VhZ2UuIEFsbCBsYW5ndWFnZSBmaWxlcyBjb21pbmcgZnJvbSBDS0VkaXRvciA1IHNvdXJjZXMgd2lsbCBoYXZlIHRoaXMgb3B0aW9uIHNldCwgc29cbiAqIHRoZXNlIHBsdXJhbCBmb3JtIHJ1bGVzIHdpbGwgYmUgcmV1c2VkIGJ5IG90aGVyIHRyYW5zbGF0aW9ucyBhZGRlZCB0byB0aGUgcmVnaXN0ZXJlZCBsYW5ndWFnZXMuIFRoZSBgZ2V0UGx1cmFsRm9ybSgpYCBmdW5jdGlvblxuICogY2FuIHJldHVybiBlaXRoZXIgYSBCb29sZWFuIG9yIGEgbnVtYmVyLlxuICpcbiAqIGBgYHRzXG4gKiBhZGQoICdlbicsIHtcbiAqIFx0Ly8gLi4uIFRyYW5zbGF0aW9ucy5cbiAqIH0sIG4gPT4gbiAhPT0gMSApO1xuICogYWRkKCAncGwnLCB7XG4gKiBcdC8vIC4uLiBUcmFuc2xhdGlvbnMuXG4gKiB9LCBuID0+IG4gPT0gMSA/IDAgOiBuICUgMTAgPj0gMiAmJiBuICUgMTAgPD0gNCAmJiAoIG4gJSAxMDAgPCAxMCB8fCBuICUgMTAwID49IDIwICkgPyAxIDogMiApO1xuICogYGBgXG4gKlxuICogQWxsIHRyYW5zbGF0aW9ucyBleHRlbmQgdGhlIGdsb2JhbCBgd2luZG93LkNLRURJVE9SX1RSQU5TTEFUSU9OU2Agb2JqZWN0LiBBbiBleGFtcGxlIG9mIHRoaXMgb2JqZWN0IGNhbiBiZSBmb3VuZCBiZWxvdzpcbiAqXG4gKiBgYGB0c1xuICoge1xuICogXHRwbDoge1xuICogXHRcdGRpY3Rpb25hcnk6IHtcbiAqIFx0XHRcdCdDYW5jZWwnOiAnQW51bHVqJyxcbiAqIFx0XHRcdCdBZGQgc3BhY2UnOiBbICdEb2RhaiBzcGFjasSZJywgJ0RvZGFqICUwIHNwYWNqZScsICdEb2RhaiAlMCBzcGFjamknIF1cbiAqIFx0XHR9LFxuICogXHRcdC8vIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBwbHVyYWwgZm9ybSBpbmRleC5cbiAqIFx0XHRnZXRQbHVyYWxGb3JtOiBuID0+IG4gPT0gMSA/IDAgOiBuICUgMTAgPj0gMiAmJiBuICUgMTAgPD0gNCAmJiAoIG4gJSAxMDAgPCAxMCB8fCBuICUgMTAwID49IDIwICkgPyAxIDogMiApO1xuICogXHR9XG4gKiBcdC8vIE90aGVyIGxhbmd1YWdlcy5cbiAqIFx0fVxuICogYGBgXG4gKlxuICogSWYgeW91IGNhbm5vdCBpbXBvcnQgdGhpcyBmdW5jdGlvbiBmcm9tIHRoaXMgbW9kdWxlIChlLmcuIGJlY2F1c2UgeW91IHVzZSBhIENLRWRpdG9yIDUgYnVpbGQpLCB5b3UgY2FuXG4gKiBzdGlsbCBhZGQgdHJhbnNsYXRpb25zIGJ5IGV4dGVuZGluZyB0aGUgZ2xvYmFsIGB3aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TYCBvYmplY3QgYnkgdXNpbmcgYSBmdW5jdGlvbiBsaWtlXG4gKiB0aGUgb25lIGJlbG93OlxuICpcbiAqIGBgYHRzXG4gKiBmdW5jdGlvbiBhZGRUcmFuc2xhdGlvbnMoIGxhbmd1YWdlLCB0cmFuc2xhdGlvbnMsIGdldFBsdXJhbEZvcm0gKSB7XG4gKiBcdGlmICggIWdsb2JhbC53aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TICkge1xuICogXHRcdGdsb2JhbC53aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TID0ge307XG4gKiBcdH1cblxuICogXHRpZiAoICFnbG9iYWwud2luZG93LkNLRURJVE9SX1RSQU5TTEFUSU9OU1sgbGFuZ3VhZ2UgXSApIHtcbiAqIFx0XHRnbG9iYWwud2luZG93LkNLRURJVE9SX1RSQU5TTEFUSU9OU1sgbGFuZ3VhZ2UgXSA9IHt9O1xuICogXHR9XG4gKlxuICogXHRjb25zdCBsYW5ndWFnZVRyYW5zbGF0aW9ucyA9IGdsb2JhbC53aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TWyBsYW5ndWFnZSBdO1xuICpcbiAqIFx0bGFuZ3VhZ2VUcmFuc2xhdGlvbnMuZGljdGlvbmFyeSA9IGxhbmd1YWdlVHJhbnNsYXRpb25zLmRpY3Rpb25hcnkgfHwge307XG4gKiBcdGxhbmd1YWdlVHJhbnNsYXRpb25zLmdldFBsdXJhbEZvcm0gPSBnZXRQbHVyYWxGb3JtIHx8IGxhbmd1YWdlVHJhbnNsYXRpb25zLmdldFBsdXJhbEZvcm07XG4gKlxuICogXHQvLyBFeHRlbmQgdGhlIGRpY3Rpb25hcnkgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZS5cbiAqIFx0T2JqZWN0LmFzc2lnbiggbGFuZ3VhZ2VUcmFuc2xhdGlvbnMuZGljdGlvbmFyeSwgdHJhbnNsYXRpb25zICk7XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbGFuZ3VhZ2UgVGFyZ2V0IGxhbmd1YWdlLlxuICogQHBhcmFtIHRyYW5zbGF0aW9ucyBBbiBvYmplY3Qgd2l0aCB0cmFuc2xhdGlvbnMgd2hpY2ggd2lsbCBiZSBhZGRlZCB0byB0aGUgZGljdGlvbmFyeS5cbiAqIEZvciBlYWNoIG1lc3NhZ2UgSUQgdGhlIHZhbHVlIHNob3VsZCBiZSBlaXRoZXIgYSB0cmFuc2xhdGlvbiBvciBhbiBhcnJheSBvZiB0cmFuc2xhdGlvbnMgaWYgdGhlIG1lc3NhZ2VcbiAqIHNob3VsZCBzdXBwb3J0IHBsdXJhbCBmb3Jtcy5cbiAqIEBwYXJhbSBnZXRQbHVyYWxGb3JtIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBwbHVyYWwgZm9ybSBpbmRleCAoYSBudW1iZXIpLlxuICovIGZ1bmN0aW9uIGFkZChsYW5ndWFnZSwgdHJhbnNsYXRpb25zLCBnZXRQbHVyYWxGb3JtKSB7XG4gICAgaWYgKCFnbG9iYWwud2luZG93LkNLRURJVE9SX1RSQU5TTEFUSU9OU1tsYW5ndWFnZV0pIHtcbiAgICAgICAgZ2xvYmFsLndpbmRvdy5DS0VESVRPUl9UUkFOU0xBVElPTlNbbGFuZ3VhZ2VdID0ge307XG4gICAgfVxuICAgIGNvbnN0IGxhbmd1YWdlVHJhbnNsYXRpb25zID0gZ2xvYmFsLndpbmRvdy5DS0VESVRPUl9UUkFOU0xBVElPTlNbbGFuZ3VhZ2VdO1xuICAgIGxhbmd1YWdlVHJhbnNsYXRpb25zLmRpY3Rpb25hcnkgPSBsYW5ndWFnZVRyYW5zbGF0aW9ucy5kaWN0aW9uYXJ5IHx8IHt9O1xuICAgIGxhbmd1YWdlVHJhbnNsYXRpb25zLmdldFBsdXJhbEZvcm0gPSBnZXRQbHVyYWxGb3JtIHx8IGxhbmd1YWdlVHJhbnNsYXRpb25zLmdldFBsdXJhbEZvcm07XG4gICAgT2JqZWN0LmFzc2lnbihsYW5ndWFnZVRyYW5zbGF0aW9ucy5kaWN0aW9uYXJ5LCB0cmFuc2xhdGlvbnMpO1xufVxuLyoqXG4gKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgaW50ZXJuYWwsIHVzZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2xvY2FsZX5Mb2NhbGUjdCB0aGUgYHQoKWAgZnVuY3Rpb259IGluc3RlYWQgdG8gdHJhbnNsYXRlXG4gKiB0aGUgZWRpdG9yIFVJIHBhcnRzLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gaXMgcmVzcG9uc2libGUgZm9yIHRyYW5zbGF0aW5nIG1lc3NhZ2VzIHRvIHRoZSBzcGVjaWZpZWQgbGFuZ3VhZ2UuIEl0IHVzZXMgdHJhbnNsYXRpb25zIGFkZGVkIHBlcnZpb3VzbHlcbiAqIGJ5IHtAbGluayBtb2R1bGU6dXRpbHMvdHJhbnNsYXRpb24tc2VydmljZX5hZGR9IChhIHRyYW5zbGF0aW9ucyBkaWN0aW9uYXJ5IGFuZCB0aGUgYGdldFBsdXJhbEZvcm0oKWAgZnVuY3Rpb25cbiAqIHRvIHByb3ZpZGUgYWNjdXJhdGUgdHJhbnNsYXRpb25zIG9mIHBsdXJhbCBmb3JtcykuXG4gKlxuICogV2hlbiBubyB0cmFuc2xhdGlvbiBpcyBkZWZpbmVkIGluIHRoZSBkaWN0aW9uYXJ5IG9yIHRoZSBkaWN0aW9uYXJ5IGRvZXMgbm90IGV4aXN0LCB0aGlzIGZ1bmN0aW9uIHJldHVybnNcbiAqIHRoZSBvcmlnaW5hbCBtZXNzYWdlIHN0cmluZyBvciB0aGUgbWVzc2FnZSBwbHVyYWwgZGVwZW5kaW5nIG9uIHRoZSBudW1iZXIgb2YgZWxlbWVudHMuXG4gKlxuICogYGBgdHNcbiAqIHRyYW5zbGF0ZSggJ3BsJywgeyBzdHJpbmc6ICdDYW5jZWwnIH0gKTsgLy8gJ0NhbmNlbCdcbiAqIGBgYFxuICpcbiAqIFRoZSB0aGlyZCBvcHRpb25hbCBhcmd1bWVudCBpcyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzLCBiYXNlZCBvbiB3aGljaCB0aGUgc2luZ2xlIGZvcm0gb3Igb25lIG9mIHRoZSBwbHVyYWwgZm9ybXNcbiAqIHNob3VsZCBiZSBwaWNrZWQgd2hlbiB0aGUgbWVzc2FnZSBpcyBzdXBwb3NlZCB0byBzdXBwb3J0IHZhcmlvdXMgcGx1cmFsIGZvcm1zLlxuICpcbiAqIGBgYHRzXG4gKiB0cmFuc2xhdGUoICdlbicsIHsgc3RyaW5nOiAnQWRkIGEgc3BhY2UnLCBwbHVyYWw6ICdBZGQgJTAgc3BhY2VzJyB9LCAxICk7IC8vICdBZGQgYSBzcGFjZSdcbiAqIHRyYW5zbGF0ZSggJ2VuJywgeyBzdHJpbmc6ICdBZGQgYSBzcGFjZScsIHBsdXJhbDogJ0FkZCAlMCBzcGFjZXMnIH0sIDMgKTsgLy8gJ0FkZCAlMCBzcGFjZXMnXG4gKiBgYGBcbiAqXG4gKiBUaGUgbWVzc2FnZSBzaG91bGQgcHJvdmlkZSBhbiBJRCB1c2luZyB0aGUgYGlkYCBwcm9wZXJ0eSB3aGVuIHRoZSBtZXNzYWdlIHN0cmluZ3MgYXJlIG5vdCB1bmlxdWUgYW5kIHRoZWlyXG4gKiB0cmFuc2xhdGlvbnMgc2hvdWxkIGJlIGRpZmZlcmVudC5cbiAqXG4gKiBgYGB0c1xuICogdHJhbnNsYXRlKCAnZW4nLCB7IHN0cmluZzogJ2ltYWdlJywgaWQ6ICdBRERfSU1BR0UnIH0gKTtcbiAqIHRyYW5zbGF0ZSggJ2VuJywgeyBzdHJpbmc6ICdpbWFnZScsIGlkOiAnQU5fSU1BR0UnIH0gKTtcbiAqIGBgYFxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxhbmd1YWdlIFRhcmdldCBsYW5ndWFnZS5cbiAqIEBwYXJhbSBtZXNzYWdlIEEgbWVzc2FnZSB0aGF0IHdpbGwgYmUgdHJhbnNsYXRlZC5cbiAqIEBwYXJhbSBxdWFudGl0eSBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGZvciB3aGljaCBhIHBsdXJhbCBmb3JtIHNob3VsZCBiZSBwaWNrZWQgZnJvbSB0aGUgdGFyZ2V0IGxhbmd1YWdlIGRpY3Rpb25hcnkuXG4gKiBAcGFyYW0gdHJhbnNsYXRpb25zIFRyYW5zbGF0aW9ucyBwYXNzZWQgaW4gZWRpdG9yIGNvbmZpZywgaWYgbm90IHByb3ZpZGVkIHVzZSB0aGUgZ2xvYmFsIGB3aW5kb3cuQ0tFRElUT1JfVFJBTlNMQVRJT05TYC5cbiAqIEByZXR1cm5zIFRyYW5zbGF0ZWQgc2VudGVuY2UuXG4gKi8gZnVuY3Rpb24gX3RyYW5zbGF0ZShsYW5ndWFnZSwgbWVzc2FnZSwgcXVhbnRpdHkgPSAxLCB0cmFuc2xhdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIHF1YW50aXR5ICE9PSAnbnVtYmVyJykge1xuICAgICAgICAvKipcblx0XHQgKiBBbiBpbmNvcnJlY3QgdmFsdWUgd2FzIHBhc3NlZCB0byB0aGUgdHJhbnNsYXRpb24gZnVuY3Rpb24uIFRoaXMgd2FzIHByb2JhYmx5IGNhdXNlZFxuXHRcdCAqIGJ5IGFuIGluY29ycmVjdCBtZXNzYWdlIGludGVycG9sYXRpb24gb2YgYSBwbHVyYWwgZm9ybS4gTm90ZSB0aGF0IGZvciBtZXNzYWdlcyBzdXBwb3J0aW5nIHBsdXJhbCBmb3Jtc1xuXHRcdCAqIHRoZSBzZWNvbmQgYXJndW1lbnQgb2YgdGhlIGB0KClgIGZ1bmN0aW9uIHNob3VsZCBhbHdheXMgYmUgYSBudW1iZXIgb3IgYW4gYXJyYXkgd2l0aCBhIG51bWJlciBhcyB0aGUgZmlyc3QgZWxlbWVudC5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciB0cmFuc2xhdGlvbi1zZXJ2aWNlLXF1YW50aXR5LW5vdC1hLW51bWJlclxuXHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndHJhbnNsYXRpb24tc2VydmljZS1xdWFudGl0eS1ub3QtYS1udW1iZXInLCBudWxsLCB7XG4gICAgICAgICAgICBxdWFudGl0eVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgbm9ybWFsaXplZFRyYW5zbGF0aW9ucyA9IHRyYW5zbGF0aW9ucyB8fCBnbG9iYWwud2luZG93LkNLRURJVE9SX1RSQU5TTEFUSU9OUztcbiAgICBjb25zdCBudW1iZXJPZkxhbmd1YWdlcyA9IGdldE51bWJlck9mTGFuZ3VhZ2VzKG5vcm1hbGl6ZWRUcmFuc2xhdGlvbnMpO1xuICAgIGlmIChudW1iZXJPZkxhbmd1YWdlcyA9PT0gMSkge1xuICAgICAgICAvLyBPdmVycmlkZSB0aGUgbGFuZ3VhZ2UgdG8gdGhlIG9ubHkgc3VwcG9ydGVkIG9uZS5cbiAgICAgICAgLy8gVGhpcyBjYW4ndCBiZSBkb25lIGluIHRoZSBgTG9jYWxlYCBjbGFzcywgYmVjYXVzZSB0aGUgdHJhbnNsYXRpb25zIGNvbWVzIGFmdGVyIHRoZSBgTG9jYWxlYCBjbGFzcyBpbml0aWFsaXphdGlvbi5cbiAgICAgICAgbGFuZ3VhZ2UgPSBPYmplY3Qua2V5cyhub3JtYWxpemVkVHJhbnNsYXRpb25zKVswXTtcbiAgICB9XG4gICAgY29uc3QgbWVzc2FnZUlkID0gbWVzc2FnZS5pZCB8fCBtZXNzYWdlLnN0cmluZztcbiAgICBpZiAobnVtYmVyT2ZMYW5ndWFnZXMgPT09IDAgfHwgIWhhc1RyYW5zbGF0aW9uKGxhbmd1YWdlLCBtZXNzYWdlSWQsIG5vcm1hbGl6ZWRUcmFuc2xhdGlvbnMpKSB7XG4gICAgICAgIGlmIChxdWFudGl0eSAhPT0gMSkge1xuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBkZWZhdWx0IHBsdXJhbCBmb3JtIHRoYXQgd2FzIHBhc3NlZCBpbiB0aGUgYG1lc3NhZ2UucGx1cmFsYCBwYXJhbWV0ZXIuXG4gICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5wbHVyYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2Uuc3RyaW5nO1xuICAgIH1cbiAgICBjb25zdCBkaWN0aW9uYXJ5ID0gbm9ybWFsaXplZFRyYW5zbGF0aW9uc1tsYW5ndWFnZV0uZGljdGlvbmFyeTtcbiAgICBjb25zdCBnZXRQbHVyYWxGb3JtID0gbm9ybWFsaXplZFRyYW5zbGF0aW9uc1tsYW5ndWFnZV0uZ2V0UGx1cmFsRm9ybSB8fCAoKG4pPT5uID09PSAxID8gMCA6IDEpO1xuICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gZGljdGlvbmFyeVttZXNzYWdlSWRdO1xuICAgIGlmICh0eXBlb2YgdHJhbnNsYXRpb24gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiB0cmFuc2xhdGlvbjtcbiAgICB9XG4gICAgY29uc3QgcGx1cmFsRm9ybUluZGV4ID0gTnVtYmVyKGdldFBsdXJhbEZvcm0ocXVhbnRpdHkpKTtcbiAgICAvLyBOb3RlOiBUaGUgYHRyYW5zbGF0ZWAgZnVuY3Rpb24gaXMgbm90IHJlc3BvbnNpYmxlIGZvciByZXBsYWNpbmcgYCUwLCAlMSwgLi4uYCB3aXRoIHZhbHVlcy5cbiAgICByZXR1cm4gdHJhbnNsYXRpb25bcGx1cmFsRm9ybUluZGV4XTtcbn1cbi8qKlxuICogSWYgYXJyYXkgdGhlbiBtZXJnZSBvYmplY3RzIHdoaWNoIGFyZSBpbnNpZGUgb3RoZXJ3aXNlIHJldHVybiBnaXZlbiBvYmplY3QuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gdHJhbnNsYXRpb25zIFRyYW5zbGF0aW9ucyBwYXNzZWQgaW4gZWRpdG9yIGNvbmZpZy5cbiAqLyBmdW5jdGlvbiBfdW5pZnlUcmFuc2xhdGlvbnModHJhbnNsYXRpb25zKSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodHJhbnNsYXRpb25zKSA/IHRyYW5zbGF0aW9ucy5yZWR1Y2UoKGFjYywgdHJhbnNsYXRpb24pPT5tZXJnZShhY2MsIHRyYW5zbGF0aW9uKSkgOiB0cmFuc2xhdGlvbnM7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBkaWN0aW9uYXJ5IGV4aXN0cyBhbmQgdHJhbnNsYXRpb24gaW4gdGhhdCBkaWN0aW9uYXJ5IGV4aXN0cy5cbiAqLyBmdW5jdGlvbiBoYXNUcmFuc2xhdGlvbihsYW5ndWFnZSwgbWVzc2FnZUlkLCB0cmFuc2xhdGlvbnMpIHtcbiAgICByZXR1cm4gISF0cmFuc2xhdGlvbnNbbGFuZ3VhZ2VdICYmICEhdHJhbnNsYXRpb25zW2xhbmd1YWdlXS5kaWN0aW9uYXJ5W21lc3NhZ2VJZF07XG59XG5mdW5jdGlvbiBnZXROdW1iZXJPZkxhbmd1YWdlcyh0cmFuc2xhdGlvbnMpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModHJhbnNsYXRpb25zKS5sZW5ndGg7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgbG9jYWxpemF0aW9uIHNlcnZpY2VzLlxuICovIGNsYXNzIExvY2FsZSB7XG4gICAgLyoqXG5cdCAqIFRoZSBlZGl0b3IgVUkgbGFuZ3VhZ2UgY29kZSBpbiB0aGUgW0lTTyA2MzktMV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSVNPXzYzOS0xKSBmb3JtYXQuXG5cdCAqXG5cdCAqIElmIHRoZSB7QGxpbmsgI2NvbnRlbnRMYW5ndWFnZSBjb250ZW50IGxhbmd1YWdlfSB3YXMgbm90IHNwZWNpZmllZCBpbiB0aGUgYExvY2FsZWAgY29uc3RydWN0b3IsXG5cdCAqIGl0IGFsc28gZGVmaW5lcyB0aGUgbGFuZ3VhZ2Ugb2YgdGhlIGNvbnRlbnQuXG5cdCAqLyB1aUxhbmd1YWdlO1xuICAgIC8qKlxuXHQgKiBUZXh0IGRpcmVjdGlvbiBvZiB0aGUge0BsaW5rICN1aUxhbmd1YWdlIGVkaXRvciBVSSBsYW5ndWFnZX0uIEVpdGhlciBgJ2x0cidgIG9yIGAncnRsJ2AuXG5cdCAqLyB1aUxhbmd1YWdlRGlyZWN0aW9uO1xuICAgIC8qKlxuXHQgKiBUaGUgZWRpdG9yIGNvbnRlbnQgbGFuZ3VhZ2UgY29kZSBpbiB0aGUgW0lTTyA2MzktMV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSVNPXzYzOS0xKSBmb3JtYXQuXG5cdCAqXG5cdCAqIFVzdWFsbHkgdGhlIHNhbWUgYXMgdGhlIHtAbGluayAjdWlMYW5ndWFnZSBlZGl0b3IgbGFuZ3VhZ2V9LCBpdCBjYW4gYmUgY3VzdG9taXplZCBieSBwYXNzaW5nIGFuIG9wdGlvbmFsXG5cdCAqIGFyZ3VtZW50IHRvIHRoZSBgTG9jYWxlYCBjb25zdHJ1Y3Rvci5cblx0ICovIGNvbnRlbnRMYW5ndWFnZTtcbiAgICAvKipcblx0ICogVGV4dCBkaXJlY3Rpb24gb2YgdGhlIHtAbGluayAjY29udGVudExhbmd1YWdlIGVkaXRvciBjb250ZW50IGxhbmd1YWdlfS5cblx0ICpcblx0ICogSWYgdGhlIGNvbnRlbnQgbGFuZ3VhZ2Ugd2FzIHBhc3NlZCBkaXJlY3RseSB0byB0aGUgYExvY2FsZWAgY29uc3RydWN0b3IsIHRoaXMgcHJvcGVydHkgcmVwcmVzZW50cyB0aGVcblx0ICogZGlyZWN0aW9uIG9mIHRoYXQgbGFuZ3VhZ2UuXG5cdCAqXG5cdCAqIElmIHRoZSB7QGxpbmsgI2NvbnRlbnRMYW5ndWFnZSBlZGl0b3IgY29udGVudCBsYW5ndWFnZX0gd2FzIGRlcml2ZWQgZnJvbSB0aGUge0BsaW5rICN1aUxhbmd1YWdlIGVkaXRvciBsYW5ndWFnZX0sXG5cdCAqIHRoZSBjb250ZW50IGxhbmd1YWdlIGRpcmVjdGlvbiBpcyB0aGUgc2FtZSBhcyB0aGUge0BsaW5rICN1aUxhbmd1YWdlRGlyZWN0aW9uIFVJIGxhbmd1YWdlIGRpcmVjdGlvbn0uXG5cdCAqXG5cdCAqIFRoZSB2YWx1ZSBpcyBlaXRoZXIgYCdsdHInYCBvciBgJ3J0bCdgLlxuXHQgKi8gY29udGVudExhbmd1YWdlRGlyZWN0aW9uO1xuICAgIC8qKlxuXHQgKiBUcmFuc2xhdGVzIHRoZSBnaXZlbiBtZXNzYWdlIHRvIHRoZSB7QGxpbmsgI3VpTGFuZ3VhZ2V9LiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBpblxuXHQgKiB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3IjdCBgRWRpdG9yYH0gYW5kIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3I3QgYFZpZXdgfS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QncyBjb250ZXh0IGlzIHN0YXRpY2FsbHkgYm91bmQgdG8gdGhlIGBMb2NhbGVgIGluc3RhbmNlIGFuZCAqKnNob3VsZCBhbHdheXMgYmUgY2FsbGVkIGFzIGEgZnVuY3Rpb24qKjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdCA9IGxvY2FsZS50O1xuXHQgKiB0KCAnTGFiZWwnICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGUgbWVzc2FnZSBjYW4gYmUgZWl0aGVyIGEgc3RyaW5nIG9yIGFuIG9iamVjdCBpbXBsZW1lbnRpbmcgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvdHJhbnNsYXRpb24tc2VydmljZX5NZXNzYWdlfSBpbnRlcmZhY2UuXG5cdCAqXG5cdCAqIFRoZSBtZXNzYWdlIG1heSBjb250YWluIHBsYWNlaG9sZGVycyAoYCU8aW5kZXg+YCkgZm9yIHZhbHVlKHMpIHRoYXQgYXJlIHBhc3NlZCBhcyBhIGB2YWx1ZXNgIHBhcmFtZXRlci5cblx0ICogRm9yIGFuIGFycmF5IG9mIHZhbHVlcywgdGhlIGAlPGluZGV4PmAgd2lsbCBiZSBjaGFuZ2VkIHRvIGFuIGVsZW1lbnQgb2YgdGhhdCBhcnJheSBhdCB0aGUgZ2l2ZW4gaW5kZXguXG5cdCAqIEZvciBhIHNpbmdsZSB2YWx1ZSBwYXNzZWQgYXMgdGhlIHNlY29uZCBhcmd1bWVudCwgb25seSB0aGUgYCUwYCBwbGFjZWhvbGRlcnMgd2lsbCBiZSBjaGFuZ2VkIHRvIHRoZSBwcm92aWRlZCB2YWx1ZS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogdCggJ0NyZWF0ZWQgZmlsZSBcIiUwXCIgaW4gJTFtcy4nLCBbIGZpbGVOYW1lLCB0aW1lVGFrZW4gXSApO1xuXHQgKiB0KCAnQ3JlYXRlZCBmaWxlIFwiJTBcIiwgZmlsZU5hbWUgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFRoZSBtZXNzYWdlIHN1cHBvcnRzIHBsdXJhbCBmb3Jtcy4gVG8gc3BlY2lmeSB0aGUgcGx1cmFsIGZvcm0sIHVzZSB0aGUgYHBsdXJhbGAgcHJvcGVydHkuIFNpbmd1bGFyIG9yIHBsdXJhbCBmb3JtXG5cdCAqIHdpbGwgYmUgY2hvc2VuIGRlcGVuZGluZyBvbiB0aGUgZmlyc3QgdmFsdWUgZnJvbSB0aGUgcGFzc2VkIGB2YWx1ZXNgLiBUaGUgdmFsdWUgb2YgdGhlIGBwbHVyYWxgIHByb3BlcnR5IGlzIHVzZWRcblx0ICogYXMgYSBkZWZhdWx0IHBsdXJhbCB0cmFuc2xhdGlvbiB3aGVuIHRoZSB0cmFuc2xhdGlvbiBmb3IgdGhlIHRhcmdldCBsYW5ndWFnZSBpcyBtaXNzaW5nLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB0KCB7IHN0cmluZzogJ0FkZCBhIHNwYWNlJywgcGx1cmFsOiAnQWRkICUwIHNwYWNlcycgfSwgMSApOyAvLyAnQWRkIGEgc3BhY2UnIGZvciB0aGUgRW5nbGlzaCBsYW5ndWFnZS5cblx0ICogdCggeyBzdHJpbmc6ICdBZGQgYSBzcGFjZScsIHBsdXJhbDogJ0FkZCAlMCBzcGFjZXMnIH0sIDUgKTsgLy8gJ0FkZCA1IHNwYWNlcycgZm9yIHRoZSBFbmdsaXNoIGxhbmd1YWdlLlxuXHQgKiB0KCB7IHN0cmluZzogJyUxIGEgc3BhY2UnLCBwbHVyYWw6ICclMSAlMCBzcGFjZXMnIH0sIFsgMiwgJ0FkZCcgXSApOyAvLyAnQWRkIDIgc3BhY2VzJyBmb3IgdGhlIEVuZ2xpc2ggbGFuZ3VhZ2UuXG5cdCAqXG5cdCAqIHQoIHsgc3RyaW5nOiAnQWRkIGEgc3BhY2UnLCBwbHVyYWw6ICdBZGQgJTAgc3BhY2VzJyB9LCAxICk7IC8vICdEb2RhaiBzcGFjasSZJyBmb3IgdGhlIFBvbGlzaCBsYW5ndWFnZS5cblx0ICogdCggeyBzdHJpbmc6ICdBZGQgYSBzcGFjZScsIHBsdXJhbDogJ0FkZCAlMCBzcGFjZXMnIH0sIDUgKTsgLy8gJ0RvZGFqIDUgc3BhY2ppJyBmb3IgdGhlIFBvbGlzaCBsYW5ndWFnZS5cblx0ICogdCggeyBzdHJpbmc6ICclMSBhIHNwYWNlJywgcGx1cmFsOiAnJTEgJTAgc3BhY2VzJyB9LCBbIDIsICdBZGQnIF0gKTsgLy8gJ0RvZGFqIDIgc3BhY2plJyBmb3IgdGhlIFBvbGlzaCBsYW5ndWFnZS5cblx0ICogYGBgXG5cdCAqXG5cdCAqICAqIFRoZSBtZXNzYWdlIHNob3VsZCBwcm92aWRlIGFuIElEIHVzaW5nIHRoZSBgaWRgIHByb3BlcnR5IHdoZW4gdGhlIG1lc3NhZ2Ugc3RyaW5ncyBhcmUgbm90IHVuaXF1ZSBhbmQgdGhlaXJcblx0ICogdHJhbnNsYXRpb25zIHNob3VsZCBiZSBkaWZmZXJlbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHRyYW5zbGF0ZSggJ2VuJywgeyBzdHJpbmc6ICdpbWFnZScsIGlkOiAnQUREX0lNQUdFJyB9ICk7XG5cdCAqIHRyYW5zbGF0ZSggJ2VuJywgeyBzdHJpbmc6ICdpbWFnZScsIGlkOiAnQU5fSU1BR0UnIH0gKTtcblx0ICogYGBgXG5cdCAqLyB0O1xuICAgIC8qKlxuXHQgKiBPYmplY3QgdGhhdCBjb250YWlucyB0cmFuc2xhdGlvbnMuXG5cdCAqLyB0cmFuc2xhdGlvbnM7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIGxvY2FsZSBjbGFzcy4gTGVhcm4gbW9yZSBhYm91dFxuXHQgKiB7QGdsaW5rIGdldHRpbmctc3RhcnRlZC9zZXR1cC91aS1sYW5ndWFnZSBjb25maWd1cmluZyB0aGUgbGFuZ3VhZ2Ugb2YgdGhlIGVkaXRvcn0uXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIExvY2FsZSBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy51aUxhbmd1YWdlIFRoZSBlZGl0b3IgVUkgbGFuZ3VhZ2UgY29kZSBpbiB0aGVcblx0ICogW0lTTyA2MzktMV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSVNPXzYzOS0xKSBmb3JtYXQuIFNlZSB7QGxpbmsgI3VpTGFuZ3VhZ2V9LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5jb250ZW50TGFuZ3VhZ2UgVGhlIGVkaXRvciBjb250ZW50IGxhbmd1YWdlIGNvZGUgaW4gdGhlXG5cdCAqIFtJU08gNjM5LTFdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT182MzktMSkgZm9ybWF0LiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgc2FtZSBhcyBgb3B0aW9ucy5sYW5ndWFnZWAuXG5cdCAqIFNlZSB7QGxpbmsgI2NvbnRlbnRMYW5ndWFnZX0uXG5cdCAqIEBwYXJhbSB0cmFuc2xhdGlvbnMgVHJhbnNsYXRpb25zIHBhc3NlZCBhcyBhIGVkaXRvciBjb25maWcgcGFyYW1ldGVyLlxuXHQgKi8gY29uc3RydWN0b3IoeyB1aUxhbmd1YWdlID0gJ2VuJywgY29udGVudExhbmd1YWdlLCB0cmFuc2xhdGlvbnMgfSA9IHt9KXtcbiAgICAgICAgdGhpcy51aUxhbmd1YWdlID0gdWlMYW5ndWFnZTtcbiAgICAgICAgdGhpcy5jb250ZW50TGFuZ3VhZ2UgPSBjb250ZW50TGFuZ3VhZ2UgfHwgdGhpcy51aUxhbmd1YWdlO1xuICAgICAgICB0aGlzLnVpTGFuZ3VhZ2VEaXJlY3Rpb24gPSBnZXRMYW5ndWFnZURpcmVjdGlvbih0aGlzLnVpTGFuZ3VhZ2UpO1xuICAgICAgICB0aGlzLmNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbiA9IGdldExhbmd1YWdlRGlyZWN0aW9uKHRoaXMuY29udGVudExhbmd1YWdlKTtcbiAgICAgICAgdGhpcy50cmFuc2xhdGlvbnMgPSBfdW5pZnlUcmFuc2xhdGlvbnModHJhbnNsYXRpb25zKTtcbiAgICAgICAgdGhpcy50ID0gKG1lc3NhZ2UsIHZhbHVlcyk9PnRoaXMuX3QobWVzc2FnZSwgdmFsdWVzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBlZGl0b3IgVUkgbGFuZ3VhZ2UgY29kZSBpbiB0aGUgW0lTTyA2MzktMV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSVNPXzYzOS0xKSBmb3JtYXQuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIHByb3BlcnR5IHdhcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIHtAbGluayAjdWlMYW5ndWFnZX0gYW5kIHtAbGluayAjY29udGVudExhbmd1YWdlfVxuXHQgKiBwcm9wZXJ0aWVzIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBkZXByZWNhdGVkXG5cdCAqLyBnZXQgbGFuZ3VhZ2UoKSB7XG4gICAgICAgIC8qKlxuXHRcdCAqIFRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2xvY2FsZX5Mb2NhbGUjbGFuZ3VhZ2UgYExvY2FsZSNsYW5ndWFnZWB9IHByb3BlcnR5IHdhcyBkZXByZWNhdGVkIGFuZCB3aWxsXG5cdFx0ICogYmUgcmVtb3ZlZCBpbiB0aGUgbmVhciBmdXR1cmUuIFBsZWFzZSB1c2UgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvbG9jYWxlfkxvY2FsZSN1aUxhbmd1YWdlIGBMb2NhbGUjdWlMYW5ndWFnZWB9IGFuZFxuXHRcdCAqIHtAbGluayBtb2R1bGU6dXRpbHMvbG9jYWxlfkxvY2FsZSNjb250ZW50TGFuZ3VhZ2UgYExvY2FsZSNjb250ZW50TGFuZ3VhZ2VgfSBwcm9wZXJ0aWVzIGluc3RlYWQuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3IgbG9jYWxlLWRlcHJlY2F0ZWQtbGFuZ3VhZ2UtcHJvcGVydHlcblx0XHQgKi8gY29uc29sZS53YXJuKCdsb2NhbGUtZGVwcmVjYXRlZC1sYW5ndWFnZS1wcm9wZXJ0eTogJyArICdUaGUgTG9jYWxlI2xhbmd1YWdlIHByb3BlcnR5IGhhcyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmVhciBmdXR1cmUuICcgKyAnUGxlYXNlIHVzZSAjdWlMYW5ndWFnZSBhbmQgI2NvbnRlbnRMYW5ndWFnZSBwcm9wZXJ0aWVzIGluc3RlYWQuJyk7XG4gICAgICAgIHJldHVybiB0aGlzLnVpTGFuZ3VhZ2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBbiB1bmJvdW5kIHZlcnNpb24gb2YgdGhlIHtAbGluayAjdH0gbWV0aG9kLlxuXHQgKi8gX3QobWVzc2FnZSwgdmFsdWVzID0gW10pIHtcbiAgICAgICAgdmFsdWVzID0gdG9BcnJheSh2YWx1ZXMpO1xuICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgIHN0cmluZzogbWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBoYXNQbHVyYWxGb3JtID0gISFtZXNzYWdlLnBsdXJhbDtcbiAgICAgICAgY29uc3QgcXVhbnRpdHkgPSBoYXNQbHVyYWxGb3JtID8gdmFsdWVzWzBdIDogMTtcbiAgICAgICAgY29uc3QgdHJhbnNsYXRlZFN0cmluZyA9IF90cmFuc2xhdGUodGhpcy51aUxhbmd1YWdlLCBtZXNzYWdlLCBxdWFudGl0eSwgdGhpcy50cmFuc2xhdGlvbnMpO1xuICAgICAgICByZXR1cm4gaW50ZXJwb2xhdGVTdHJpbmcodHJhbnNsYXRlZFN0cmluZywgdmFsdWVzKTtcbiAgICB9XG59XG4vKipcbiAqIEZpbGxzIHRoZSBgJTAsICUxLCAuLi5gIHN0cmluZyBwbGFjZWhvbGRlcnMgd2l0aCB2YWx1ZXMuXG4gKi8gZnVuY3Rpb24gaW50ZXJwb2xhdGVTdHJpbmcoc3RyaW5nLCB2YWx1ZXMpIHtcbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoLyUoXFxkKykvZywgKG1hdGNoLCBpbmRleCk9PntcbiAgICAgICAgcmV0dXJuIGluZGV4IDwgdmFsdWVzLmxlbmd0aCA/IHZhbHVlc1tpbmRleF0gOiBtYXRjaDtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBDb2xsZWN0aW9ucyBhcmUgb3JkZXJlZCBzZXRzIG9mIG9iamVjdHMuIEl0ZW1zIGluIHRoZSBjb2xsZWN0aW9uIGNhbiBiZSByZXRyaWV2ZWQgYnkgdGhlaXIgaW5kZXhlc1xuICogaW4gdGhlIGNvbGxlY3Rpb24gKGxpa2UgaW4gYW4gYXJyYXkpIG9yIGJ5IHRoZWlyIGlkcy5cbiAqXG4gKiBJZiBhbiBvYmplY3Qgd2l0aG91dCBhbiBgaWRgIHByb3BlcnR5IGlzIGJlaW5nIGFkZGVkIHRvIHRoZSBjb2xsZWN0aW9uLCB0aGUgYGlkYCBwcm9wZXJ0eSB3aWxsIGJlIGdlbmVyYXRlZFxuICogYXV0b21hdGljYWxseS4gTm90ZSB0aGF0IHRoZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBpZCBpcyB1bmlxdWUgb25seSB3aXRoaW4gdGhpcyBzaW5nbGUgY29sbGVjdGlvbiBpbnN0YW5jZS5cbiAqXG4gKiBCeSBkZWZhdWx0IGFuIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24gaXMgaWRlbnRpZmllZCBieSBpdHMgYGlkYCBwcm9wZXJ0eS4gVGhlIG5hbWUgb2YgdGhlIGlkZW50aWZpZXIgY2FuIGJlXG4gKiBjb25maWd1cmVkIHRocm91Z2ggdGhlIGNvbnN0cnVjdG9yIG9mIHRoZSBjb2xsZWN0aW9uLlxuICpcbiAqIEB0eXBlUGFyYW0gVCBUaGUgdHlwZSBvZiB0aGUgY29sbGVjdGlvbiBlbGVtZW50LlxuICovIGNsYXNzIENvbGxlY3Rpb24gZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKCkge1xuICAgIC8qKlxuXHQgKiBUaGUgaW50ZXJuYWwgbGlzdCBvZiBpdGVtcyBpbiB0aGUgY29sbGVjdGlvbi5cblx0ICovIF9pdGVtcztcbiAgICAvKipcblx0ICogVGhlIGludGVybmFsIG1hcCBvZiBpdGVtcyBpbiB0aGUgY29sbGVjdGlvbi5cblx0ICovIF9pdGVtTWFwO1xuICAgIC8qKlxuXHQgKiBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2hpY2ggaXMgY29uc2lkZXJlZCB0byBpZGVudGlmeSBhbiBpdGVtLlxuXHQgKi8gX2lkUHJvcGVydHk7XG4gICAgLyoqXG5cdCAqIEEgY29sbGVjdGlvbiBpbnN0YW5jZSB0aGlzIGNvbGxlY3Rpb24gaXMgYm91bmQgdG8gYXMgYSByZXN1bHRcblx0ICogb2YgY2FsbGluZyB7QGxpbmsgI2JpbmRUb30gbWV0aG9kLlxuXHQgKi8gX2JpbmRUb0NvbGxlY3Rpb247XG4gICAgLyoqXG5cdCAqIEEgaGVscGVyIG1hcHBpbmcgZXh0ZXJuYWwgaXRlbXMgb2YgYSBib3VuZCBjb2xsZWN0aW9uICh7QGxpbmsgI2JpbmRUb30pXG5cdCAqIGFuZCBhY3R1YWwgaXRlbXMgb2YgdGhpcyBjb2xsZWN0aW9uLiBJdCBwcm92aWRlcyBpbmZvcm1hdGlvblxuXHQgKiBuZWNlc3NhcnkgdG8gcHJvcGVybHkgcmVtb3ZlIGl0ZW1zIGJvdW5kIHRvIGFub3RoZXIgY29sbGVjdGlvbi5cblx0ICpcblx0ICogU2VlIHtAbGluayAjX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcH0uXG5cdCAqLyBfYmluZFRvRXh0ZXJuYWxUb0ludGVybmFsTWFwO1xuICAgIC8qKlxuXHQgKiBBIGhlbHBlciBtYXBwaW5nIGl0ZW1zIG9mIHRoaXMgY29sbGVjdGlvbiB0byBleHRlcm5hbCBpdGVtcyBvZiBhIGJvdW5kIGNvbGxlY3Rpb25cblx0ICogKHtAbGluayAjYmluZFRvfSkuIEl0IHByb3ZpZGVzIGluZm9ybWF0aW9uIG5lY2Vzc2FyeSB0byBtYW5hZ2UgdGhlIGJpbmRpbmdzLCBlLmcuXG5cdCAqIHRvIGF2b2lkIGxvb3BzIGluIHR3b+KAk3dheSBiaW5kaW5ncy5cblx0ICpcblx0ICogU2VlIHtAbGluayAjX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcH0uXG5cdCAqLyBfYmluZFRvSW50ZXJuYWxUb0V4dGVybmFsTWFwO1xuICAgIC8qKlxuXHQgKiBTdG9yZXMgaW5kZXhlcyBvZiBza2lwcGVkIGl0ZW1zIGZyb20gYm91bmQgZXh0ZXJuYWwgY29sbGVjdGlvbi5cblx0ICovIF9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbDtcbiAgICBjb25zdHJ1Y3Rvcihpbml0aWFsSXRlbXNPck9wdGlvbnMgPSB7fSwgb3B0aW9ucyA9IHt9KXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgY29uc3QgaGFzSW5pdGlhbEl0ZW1zID0gaXNJdGVyYWJsZShpbml0aWFsSXRlbXNPck9wdGlvbnMpO1xuICAgICAgICBpZiAoIWhhc0luaXRpYWxJdGVtcykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IGluaXRpYWxJdGVtc09yT3B0aW9ucztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pdGVtcyA9IFtdO1xuICAgICAgICB0aGlzLl9pdGVtTWFwID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLl9pZFByb3BlcnR5ID0gb3B0aW9ucy5pZFByb3BlcnR5IHx8ICdpZCc7XG4gICAgICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcCA9IG5ldyBXZWFrTWFwKCk7XG4gICAgICAgIHRoaXMuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcCA9IG5ldyBXZWFrTWFwKCk7XG4gICAgICAgIHRoaXMuX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsID0gW107XG4gICAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCBjb250ZW50IG9mIHRoZSBjb2xsZWN0aW9uIChpZiBwcm92aWRlZCBpbiB0aGUgY29uc3RydWN0b3IpLlxuICAgICAgICBpZiAoaGFzSW5pdGlhbEl0ZW1zKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaW5pdGlhbEl0ZW1zT3JPcHRpb25zKXtcbiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1NYXAuc2V0KHRoaXMuX2dldEl0ZW1JZEJlZm9yZUFkZGluZyhpdGVtKSwgaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBudW1iZXIgb2YgaXRlbXMgYXZhaWxhYmxlIGluIHRoZSBjb2xsZWN0aW9uLlxuXHQgKi8gZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGZpcnN0IGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbiBvciBudWxsIHdoZW4gY29sbGVjdGlvbiBpcyBlbXB0eS5cblx0ICovIGdldCBmaXJzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zWzBdIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBsYXN0IGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbiBvciBudWxsIHdoZW4gY29sbGVjdGlvbiBpcyBlbXB0eS5cblx0ICovIGdldCBsYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXNbdGhpcy5sZW5ndGggLSAxXSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBhbiBpdGVtIGludG8gdGhlIGNvbGxlY3Rpb24uXG5cdCAqXG5cdCAqIElmIHRoZSBpdGVtIGRvZXMgbm90IGhhdmUgYW4gaWQsIHRoZW4gaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhbmQgc2V0IG9uIHRoZSBpdGVtLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbVxuXHQgKiBAcGFyYW0gaW5kZXggVGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLiBUaGUgaXRlbVxuXHQgKiBpcyBwdXNoZWQgdG8gdGhlIGNvbGxlY3Rpb24gd2hlbiBgaW5kZXhgIG5vdCBzcGVjaWZpZWQuXG5cdCAqIEBmaXJlcyBhZGRcblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKi8gYWRkKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZE1hbnkoW1xuICAgICAgICAgICAgaXRlbVxuICAgICAgICBdLCBpbmRleCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBZGRzIG11bHRpcGxlIGl0ZW1zIGludG8gdGhlIGNvbGxlY3Rpb24uXG5cdCAqXG5cdCAqIEFueSBpdGVtIG5vdCBjb250YWluaW5nIGFuIGlkIHdpbGwgZ2V0IGFuIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIG9uZS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW1zXG5cdCAqIEBwYXJhbSBpbmRleCBUaGUgcG9zaXRpb24gb2YgdGhlIGluc2VydGlvbi4gSXRlbXMgd2lsbCBiZSBhcHBlbmRlZCBpZiBubyBgaW5kZXhgIGlzIHNwZWNpZmllZC5cblx0ICogQGZpcmVzIGFkZFxuXHQgKiBAZmlyZXMgY2hhbmdlXG5cdCAqLyBhZGRNYW55KGl0ZW1zLCBpbmRleCkge1xuICAgICAgICBpZiAoaW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9pdGVtcy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPiB0aGlzLl9pdGVtcy5sZW5ndGggfHwgaW5kZXggPCAwKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBgaW5kZXhgIHBhc3NlZCB0byB7QGxpbmsgbW9kdWxlOnV0aWxzL2NvbGxlY3Rpb25+Q29sbGVjdGlvbiNhZGRNYW55IGBDb2xsZWN0aW9uI2FkZE1hbnkoKWB9XG5cdFx0XHQgKiBpcyBpbnZhbGlkLiBJdCBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgdGhlIGNvbGxlY3Rpb24ncyBsZW5ndGguXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGNvbGxlY3Rpb24tYWRkLWl0ZW0taW52YWxpZC1pbmRleFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWFkZC1pdGVtLWludmFsaWQtaW5kZXgnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IHRoaXMuX2dldEl0ZW1JZEJlZm9yZUFkZGluZyhpdGVtKTtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJdGVtSW5kZXggPSBpbmRleCArIG9mZnNldDtcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShjdXJyZW50SXRlbUluZGV4LCAwLCBpdGVtKTtcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1NYXAuc2V0KGl0ZW1JZCwgaXRlbSk7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2FkZCcsIGl0ZW0sIGN1cnJlbnRJdGVtSW5kZXgpO1xuICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB7XG4gICAgICAgICAgICBhZGRlZDogaXRlbXMsXG4gICAgICAgICAgICByZW1vdmVkOiBbXSxcbiAgICAgICAgICAgIGluZGV4XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgYW4gaXRlbSBieSBpdHMgSUQgb3IgaW5kZXguXG5cdCAqXG5cdCAqIEBwYXJhbSBpZE9ySW5kZXggVGhlIGl0ZW0gSUQgb3IgaW5kZXggaW4gdGhlIGNvbGxlY3Rpb24uXG5cdCAqIEByZXR1cm5zIFRoZSByZXF1ZXN0ZWQgaXRlbSBvciBgbnVsbGAgaWYgc3VjaCBpdGVtIGRvZXMgbm90IGV4aXN0LlxuXHQgKi8gZ2V0KGlkT3JJbmRleCkge1xuICAgICAgICBsZXQgaXRlbTtcbiAgICAgICAgaWYgKHR5cGVvZiBpZE9ySW5kZXggPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtTWFwLmdldChpZE9ySW5kZXgpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpZE9ySW5kZXggPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtc1tpZE9ySW5kZXhdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBBbiBpbmRleCBvciBJRCBtdXN0IGJlIGdpdmVuLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBjb2xsZWN0aW9uLWdldC1pbnZhbGlkLWFyZ1xuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWdldC1pbnZhbGlkLWFyZycsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIGNvbGxlY3Rpb24gY29udGFpbnMgYW4gaXRlbS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW1PcklkIFRoZSBpdGVtIG9yIGl0cyBJRCBpbiB0aGUgY29sbGVjdGlvbi5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIHRoZSBjb2xsZWN0aW9uIGNvbnRhaW5zIHRoZSBpdGVtLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGhhcyhpdGVtT3JJZCkge1xuICAgICAgICBpZiAodHlwZW9mIGl0ZW1PcklkID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXRlbU1hcC5oYXMoaXRlbU9ySWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaWRQcm9wZXJ0eSA9IHRoaXMuX2lkUHJvcGVydHk7XG4gICAgICAgICAgICBjb25zdCBpZCA9IGl0ZW1PcklkW2lkUHJvcGVydHldO1xuICAgICAgICAgICAgcmV0dXJuIGlkICYmIHRoaXMuX2l0ZW1NYXAuaGFzKGlkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBhbiBpbmRleCBvZiBhbiBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLlxuXHQgKiBXaGVuIGFuIGl0ZW0gaXMgbm90IGRlZmluZWQgaW4gdGhlIGNvbGxlY3Rpb24sIHRoZSBpbmRleCB3aWxsIGVxdWFsIC0xLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbU9ySWQgVGhlIGl0ZW0gb3IgaXRzIElEIGluIHRoZSBjb2xsZWN0aW9uLlxuXHQgKiBAcmV0dXJucyBUaGUgaW5kZXggb2YgYSBnaXZlbiBpdGVtLlxuXHQgKi8gZ2V0SW5kZXgoaXRlbU9ySWQpIHtcbiAgICAgICAgbGV0IGl0ZW07XG4gICAgICAgIGlmICh0eXBlb2YgaXRlbU9ySWQgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtTWFwLmdldChpdGVtT3JJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtID0gaXRlbU9ySWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGl0ZW0gPyB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pIDogLTE7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFuIGl0ZW0gZnJvbSB0aGUgY29sbGVjdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHN1YmplY3QgVGhlIGl0ZW0gdG8gcmVtb3ZlLCBpdHMgSUQgb3IgaW5kZXggaW4gdGhlIGNvbGxlY3Rpb24uXG5cdCAqIEByZXR1cm5zIFRoZSByZW1vdmVkIGl0ZW0uXG5cdCAqIEBmaXJlcyByZW1vdmVcblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKi8gcmVtb3ZlKHN1YmplY3QpIHtcbiAgICAgICAgY29uc3QgW2l0ZW0sIGluZGV4XSA9IHRoaXMuX3JlbW92ZShzdWJqZWN0KTtcbiAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB7XG4gICAgICAgICAgICBhZGRlZDogW10sXG4gICAgICAgICAgICByZW1vdmVkOiBbXG4gICAgICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGluZGV4XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBmb3IgZWFjaCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uIGFuZCBjb21wb3NlcyBhbiBhcnJheSBvciB2YWx1ZXMgcmV0dXJuZWQgYnkgdGhpcyBjYWxsYmFjay5cblx0ICpcblx0ICogQHR5cGVQYXJhbSBVIFRoZSByZXN1bHQgdHlwZSBvZiB0aGUgY2FsbGJhY2suXG5cdCAqIEBwYXJhbSBjYWxsYmFja1xuXHQgKiBAcGFyYW0gY3R4IENvbnRleHQgaW4gd2hpY2ggdGhlIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxsZWQuXG5cdCAqIEByZXR1cm5zIFRoZSByZXN1bHQgb2YgbWFwcGluZy5cblx0ICovIG1hcChjYWxsYmFjaywgY3R4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5tYXAoY2FsbGJhY2ssIGN0eCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQZXJmb3JtcyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmb3IgZWFjaCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gY3R4IENvbnRleHQgaW4gd2hpY2ggdGhlIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxsZWQuXG5cdCAqLyBmb3JFYWNoKGNhbGxiYWNrLCBjdHgpIHtcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChjYWxsYmFjaywgY3R4KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEZpbmRzIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBjb2xsZWN0aW9uIGZvciB3aGljaCB0aGUgYGNhbGxiYWNrYCByZXR1cm5zIGEgdHJ1ZSB2YWx1ZS5cblx0ICpcblx0ICogQHBhcmFtIGNhbGxiYWNrXG5cdCAqIEBwYXJhbSBjdHggQ29udGV4dCBpbiB3aGljaCB0aGUgYGNhbGxiYWNrYCB3aWxsIGJlIGNhbGxlZC5cblx0ICogQHJldHVybnMgVGhlIGl0ZW0gZm9yIHdoaWNoIGBjYWxsYmFja2AgcmV0dXJuZWQgYSB0cnVlIHZhbHVlLlxuXHQgKi8gZmluZChjYWxsYmFjaywgY3R4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5maW5kKGNhbGxiYWNrLCBjdHgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSB3aXRoIGl0ZW1zIGZvciB3aGljaCB0aGUgYGNhbGxiYWNrYCByZXR1cm5lZCBhIHRydWUgdmFsdWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBjYWxsYmFja1xuXHQgKiBAcGFyYW0gY3R4IENvbnRleHQgaW4gd2hpY2ggdGhlIGBjYWxsYmFja2Agd2lsbCBiZSBjYWxsZWQuXG5cdCAqIEByZXR1cm5zIFRoZSBhcnJheSB3aXRoIG1hdGNoaW5nIGl0ZW1zLlxuXHQgKi8gZmlsdGVyKGNhbGxiYWNrLCBjdHgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zLmZpbHRlcihjYWxsYmFjaywgY3R4KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYWxsIGl0ZW1zIGZyb20gdGhlIGNvbGxlY3Rpb24gYW5kIGRlc3Ryb3lzIHRoZSBiaW5kaW5nIGNyZWF0ZWQgdXNpbmdcblx0ICoge0BsaW5rICNiaW5kVG99LlxuXHQgKlxuXHQgKiBAZmlyZXMgcmVtb3ZlXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICovIGNsZWFyKCkge1xuICAgICAgICBpZiAodGhpcy5fYmluZFRvQ29sbGVjdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKHRoaXMuX2JpbmRUb0NvbGxlY3Rpb24pO1xuICAgICAgICAgICAgdGhpcy5fYmluZFRvQ29sbGVjdGlvbiA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVtb3ZlZEl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLl9pdGVtcyk7XG4gICAgICAgIHdoaWxlKHRoaXMubGVuZ3RoKXtcbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZSgwKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZScsIHtcbiAgICAgICAgICAgIGFkZGVkOiBbXSxcbiAgICAgICAgICAgIHJlbW92ZWQ6IHJlbW92ZWRJdGVtcyxcbiAgICAgICAgICAgIGluZGV4OiAwXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgYW5kIHN5bmNocm9uaXplcyB0aGUgY29sbGVjdGlvbiB3aXRoIGFub3RoZXIgb25lLlxuXHQgKlxuXHQgKiBUaGUgYmluZGluZyBjYW4gYmUgYSBzaW1wbGUgZmFjdG9yeTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY2xhc3MgRmFjdG9yeUNsYXNzIHtcblx0ICogXHRwdWJsaWMgbGFiZWw6IHN0cmluZztcblx0ICpcblx0ICogXHRjb25zdHJ1Y3RvciggZGF0YTogeyBsYWJlbDogc3RyaW5nIH0gKSB7XG5cdCAqIFx0XHR0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDtcblx0ICogXHR9XG5cdCAqIH1cblx0ICpcblx0ICogY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb248eyBsYWJlbDogc3RyaW5nIH0+KCB7IGlkUHJvcGVydHk6ICdsYWJlbCcgfSApO1xuXHQgKiBjb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbjxGYWN0b3J5Q2xhc3M+KCk7XG5cdCAqXG5cdCAqIHRhcmdldC5iaW5kVG8oIHNvdXJjZSApLmFzKCBGYWN0b3J5Q2xhc3MgKTtcblx0ICpcblx0ICogc291cmNlLmFkZCggeyBsYWJlbDogJ2ZvbycgfSApO1xuXHQgKiBzb3VyY2UuYWRkKCB7IGxhYmVsOiAnYmFyJyB9ICk7XG5cdCAqXG5cdCAqIGNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDJcblx0ICogY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDEgKS5sYWJlbCApOyAvLyAnYmFyJ1xuXHQgKlxuXHQgKiBzb3VyY2UucmVtb3ZlKCAwICk7XG5cdCAqIGNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDFcblx0ICogY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDAgKS5sYWJlbCApOyAvLyAnYmFyJ1xuXHQgKiBgYGBcblx0ICpcblx0ICogb3IgdGhlIGZhY3RvcnkgZHJpdmVuIGJ5IGEgY3VzdG9tIGNhbGxiYWNrOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjbGFzcyBGb29DbGFzcyB7XG5cdCAqIFx0cHVibGljIGxhYmVsOiBzdHJpbmc7XG5cdCAqXG5cdCAqIFx0Y29uc3RydWN0b3IoIGRhdGE6IHsgbGFiZWw6IHN0cmluZyB9ICkge1xuXHQgKiBcdFx0dGhpcy5sYWJlbCA9IGRhdGEubGFiZWw7XG5cdCAqIFx0fVxuXHQgKiB9XG5cdCAqXG5cdCAqIGNsYXNzIEJhckNsYXNzIHtcblx0ICogXHRwdWJsaWMgbGFiZWw6IHN0cmluZztcblx0ICpcblx0ICogXHRjb25zdHJ1Y3RvciggZGF0YTogeyBsYWJlbDogc3RyaW5nIH0gKSB7XG5cdCAqIFx0XHR0aGlzLmxhYmVsID0gZGF0YS5sYWJlbDtcblx0ICogXHR9XG5cdCAqIH1cblx0ICpcblx0ICogY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb248eyBsYWJlbDogc3RyaW5nIH0+KCB7IGlkUHJvcGVydHk6ICdsYWJlbCcgfSApO1xuXHQgKiBjb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbjxGb29DbGFzcyB8IEJhckNsYXNzPigpO1xuXHQgKlxuXHQgKiB0YXJnZXQuYmluZFRvKCBzb3VyY2UgKS51c2luZyggKCBpdGVtICkgPT4ge1xuXHQgKiBcdGlmICggaXRlbS5sYWJlbCA9PSAnZm9vJyApIHtcblx0ICogXHRcdHJldHVybiBuZXcgRm9vQ2xhc3MoIGl0ZW0gKTtcblx0ICogXHR9IGVsc2Uge1xuXHQgKiBcdFx0cmV0dXJuIG5ldyBCYXJDbGFzcyggaXRlbSApO1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiBzb3VyY2UuYWRkKCB7IGxhYmVsOiAnZm9vJyB9ICk7XG5cdCAqIHNvdXJjZS5hZGQoIHsgbGFiZWw6ICdiYXInIH0gKTtcblx0ICpcblx0ICogY29uc29sZS5sb2coIHRhcmdldC5sZW5ndGggKTsgLy8gMlxuXHQgKiBjb25zb2xlLmxvZyggdGFyZ2V0LmdldCggMCApIGluc3RhbmNlb2YgRm9vQ2xhc3MgKTsgLy8gdHJ1ZVxuXHQgKiBjb25zb2xlLmxvZyggdGFyZ2V0LmdldCggMSApIGluc3RhbmNlb2YgQmFyQ2xhc3MgKTsgLy8gdHJ1ZVxuXHQgKiBgYGBcblx0ICpcblx0ICogb3IgdGhlIGZhY3Rvcnkgb3V0IG9mIHByb3BlcnR5IG5hbWU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IHNvdXJjZSA9IG5ldyBDb2xsZWN0aW9uPHsgbmVzdGVkOiB7IHZhbHVlOiBzdHJpbmcgfSB9PigpO1xuXHQgKiBjb25zdCB0YXJnZXQgPSBuZXcgQ29sbGVjdGlvbjx7IHZhbHVlOiBzdHJpbmcgfT4oKTtcblx0ICpcblx0ICogdGFyZ2V0LmJpbmRUbyggc291cmNlICkudXNpbmcoICduZXN0ZWQnICk7XG5cdCAqXG5cdCAqIHNvdXJjZS5hZGQoIHsgbmVzdGVkOiB7IHZhbHVlOiAnZm9vJyB9IH0gKTtcblx0ICogc291cmNlLmFkZCggeyBuZXN0ZWQ6IHsgdmFsdWU6ICdiYXInIH0gfSApO1xuXHQgKlxuXHQgKiBjb25zb2xlLmxvZyggdGFyZ2V0Lmxlbmd0aCApOyAvLyAyXG5cdCAqIGNvbnNvbGUubG9nKCB0YXJnZXQuZ2V0KCAwICkudmFsdWUgKTsgLy8gJ2Zvbydcblx0ICogY29uc29sZS5sb2coIHRhcmdldC5nZXQoIDEgKS52YWx1ZSApOyAvLyAnYmFyJ1xuXHQgKiBgYGBcblx0ICpcblx0ICogSXQncyBwb3NzaWJsZSB0byBza2lwIHNwZWNpZmllZCBpdGVtcyBieSByZXR1cm5pbmcgbnVsbCB2YWx1ZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3Qgc291cmNlID0gbmV3IENvbGxlY3Rpb248eyBoaWRkZW46IGJvb2xlYW4gfT4oKTtcblx0ICogY29uc3QgdGFyZ2V0ID0gbmV3IENvbGxlY3Rpb248eyBoaWRkZW46IGJvb2xlYW4gfT4oKTtcblx0ICpcblx0ICogdGFyZ2V0LmJpbmRUbyggc291cmNlICkudXNpbmcoIGl0ZW0gPT4ge1xuXHQgKiBcdGlmICggaXRlbS5oaWRkZW4gKSB7XG5cdCAqIFx0XHRyZXR1cm4gbnVsbDtcblx0ICogXHR9XG5cdCAqXG5cdCAqIFx0cmV0dXJuIGl0ZW07XG5cdCAqIH0gKTtcblx0ICpcblx0ICogc291cmNlLmFkZCggeyBoaWRkZW46IHRydWUgfSApO1xuXHQgKiBzb3VyY2UuYWRkKCB7IGhpZGRlbjogZmFsc2UgfSApO1xuXHQgKlxuXHQgKiBjb25zb2xlLmxvZyggc291cmNlLmxlbmd0aCApOyAvLyAyXG5cdCAqIGNvbnNvbGUubG9nKCB0YXJnZXQubGVuZ3RoICk7IC8vIDFcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiB7QGxpbmsgI2NsZWFyfSBjYW4gYmUgdXNlZCB0byBicmVhayB0aGUgYmluZGluZy5cblx0ICpcblx0ICogQHR5cGVQYXJhbSBTIFRoZSB0eXBlIG9mIGBleHRlcm5hbENvbGxlY3Rpb25gIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBleHRlcm5hbENvbGxlY3Rpb24gQSBjb2xsZWN0aW9uIHRvIGJlIGJvdW5kLlxuXHQgKiBAcmV0dXJucyBUaGUgYmluZGluZyBjaGFpbiBvYmplY3QuXG5cdCAqLyBiaW5kVG8oZXh0ZXJuYWxDb2xsZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLl9iaW5kVG9Db2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBjb2xsZWN0aW9uIGNhbm5vdCBiZSBib3VuZCBtb3JlIHRoYW4gb25jZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgY29sbGVjdGlvbi1iaW5kLXRvLXJlYmluZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWJpbmQtdG8tcmViaW5kJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYmluZFRvQ29sbGVjdGlvbiA9IGV4dGVybmFsQ29sbGVjdGlvbjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFzOiAoQ2xhc3MpPT57XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0VXBCaW5kVG9CaW5kaW5nKChpdGVtKT0+bmV3IENsYXNzKGl0ZW0pKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1c2luZzogKGNhbGxiYWNrT3JQcm9wZXJ0eSk9PntcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrT3JQcm9wZXJ0eSA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFVwQmluZFRvQmluZGluZyhjYWxsYmFja09yUHJvcGVydHkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFVwQmluZFRvQmluZGluZygoaXRlbSk9Pml0ZW1bY2FsbGJhY2tPclByb3BlcnR5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcblx0ICogRmluYWxpemVzIGFuZCBhY3RpdmF0ZXMgYSBiaW5kaW5nIGluaXRpYXRlZCBieSB7QGxpbmsgI2JpbmRUb30uXG5cdCAqXG5cdCAqIEBwYXJhbSBmYWN0b3J5IEEgZnVuY3Rpb24gd2hpY2ggcHJvZHVjZXMgY29sbGVjdGlvbiBpdGVtcy5cblx0ICovIF9zZXRVcEJpbmRUb0JpbmRpbmcoZmFjdG9yeSkge1xuICAgICAgICBjb25zdCBleHRlcm5hbENvbGxlY3Rpb24gPSB0aGlzLl9iaW5kVG9Db2xsZWN0aW9uO1xuICAgICAgICAvLyBBZGRzIHRoZSBpdGVtIHRvIHRoZSBjb2xsZWN0aW9uIG9uY2UgYSBjaGFuZ2UgaGFzIGJlZW4gZG9uZSB0byB0aGUgZXh0ZXJuYWwgY29sbGVjdGlvbi5cbiAgICAgICAgY29uc3QgYWRkSXRlbSA9IChldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpPT57XG4gICAgICAgICAgICBjb25zdCBpc0V4dGVybmFsQm91bmRUb1RoaXMgPSBleHRlcm5hbENvbGxlY3Rpb24uX2JpbmRUb0NvbGxlY3Rpb24gPT0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IGV4dGVybmFsSXRlbUJvdW5kID0gZXh0ZXJuYWxDb2xsZWN0aW9uLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuZ2V0KGV4dGVybmFsSXRlbSk7XG4gICAgICAgICAgICAvLyBJZiBhbiBleHRlcm5hbCBjb2xsZWN0aW9uIGlzIGJvdW5kIHRvIHRoaXMgY29sbGVjdGlvbiwgd2hpY2ggbWFrZXMgaXQgYSAy4oCTd2F5IGJpbmRpbmcsXG4gICAgICAgICAgICAvLyBhbmQgdGhlIHBhcnRpY3VsYXIgZXh0ZXJuYWwgY29sbGVjdGlvbiBpdGVtIGlzIGFscmVhZHkgYm91bmQsIGRvbid0IGFkZCBpdCBoZXJlLlxuICAgICAgICAgICAgLy8gVGhlIGV4dGVybmFsIGl0ZW0gaGFzIGJlZW4gY3JlYXRlZCAqKm91dCBvZiB0aGlzIGNvbGxlY3Rpb24ncyBpdGVtKiogYW5kIChyZSlhZGRpbmcgaXQgd2lsbFxuICAgICAgICAgICAgLy8gY2F1c2UgYSBsb29wLlxuICAgICAgICAgICAgaWYgKGlzRXh0ZXJuYWxCb3VuZFRvVGhpcyAmJiBleHRlcm5hbEl0ZW1Cb3VuZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5zZXQoZXh0ZXJuYWxJdGVtLCBleHRlcm5hbEl0ZW1Cb3VuZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmluZFRvSW50ZXJuYWxUb0V4dGVybmFsTWFwLnNldChleHRlcm5hbEl0ZW1Cb3VuZCwgZXh0ZXJuYWxJdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGZhY3RvcnkoZXh0ZXJuYWxJdGVtKTtcbiAgICAgICAgICAgICAgICAvLyBXaGVuIHRoZXJlIGlzIG5vIGl0ZW0gd2UgbmVlZCB0byByZW1lbWJlciBza2lwcGVkIGluZGV4IGZpcnN0IGFuZCB0aGVuIHdlIGNhbiBza2lwIHRoaXMgaXRlbS5cbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWwucHVzaChpbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gTGV0cyB0cnkgdG8gcHV0IGl0ZW0gYXQgdGhlIHNhbWUgaW5kZXggYXMgaW5kZXggaW4gZXh0ZXJuYWwgY29sbGVjdGlvblxuICAgICAgICAgICAgICAgIC8vIGJ1dCB3aGVuIHRoZXJlIGFyZSBhIHNraXBwZWQgaXRlbXMgaW4gb25lIG9yIGJvdGggY29sbGVjdGlvbnMgd2UgbmVlZCB0byByZWNhbGN1bGF0ZSB0aGlzIGluZGV4LlxuICAgICAgICAgICAgICAgIGxldCBmaW5hbEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgLy8gV2hlbiB3ZSB0cnkgdG8gaW5zZXJ0IGl0ZW0gYWZ0ZXIgc29tZSBza2lwcGVkIGl0ZW1zIGZyb20gZXh0ZXJuYWwgY29sbGVjdGlvbiB3ZSBuZWVkXG4gICAgICAgICAgICAgICAgLy8gdG8gaW5jbHVkZSB0aGlzIHNraXBwZWQgaXRlbXMgYW5kIGRlY3JlYXNlIGluZGV4LlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gRm9yIHRoZSBmb2xsb3dpbmcgZXhhbXBsZTpcbiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbCAtPiBbICdBJywgJ0IgLSBza2lwcGVkIGZvciBpbnRlcm5hbCcsICdDIC0gc2tpcHBlZCBmb3IgaW50ZXJuYWwnIF1cbiAgICAgICAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbIEEgXVxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gQW5vdGhlciBpdGVtIGlzIGJlZW4gYWRkZWQgYXQgdGhlIGVuZCBvZiBleHRlcm5hbCBjb2xsZWN0aW9uOlxuICAgICAgICAgICAgICAgIC8vIGV4dGVybmFsLmFkZCggJ0QnIClcbiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbCAtPiBbICdBJywgJ0IgLSBza2lwcGVkIGZvciBpbnRlcm5hbCcsICdDIC0gc2tpcHBlZCBmb3IgaW50ZXJuYWwnLCAnRCcgXVxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gV2UgY2FuJ3QganVzdCBhZGQgJ0QnIHRvIGludGVybmFsIGF0IHRoZSBzYW1lIGluZGV4IGFzIGluZGV4IGluIGV4dGVybmFsIGJlY2F1c2VcbiAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgcHJvZHVjZSBlbXB0eSBpbmRleGVzIHdoYXQgaXMgaW52YWxpZDpcbiAgICAgICAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbICdBJywgZW1wdHksIGVtcHR5LCAnRCcgXVxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gU28gd2UgbmVlZCB0byBpbmNsdWRlIHNraXBwZWQgaXRlbXMgYW5kIGRlY3JlYXNlIGluZGV4XG4gICAgICAgICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsICdEJyBdXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBza2lwcGVkIG9mIHRoaXMuX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gc2tpcHBlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gdGFrZSBpbnRvIGNvbnNpZGVyYXRpb24gdGhhdCBleHRlcm5hbCBjb2xsZWN0aW9uIGNvdWxkIHNraXAgc29tZSBpdGVtcyBmcm9tXG4gICAgICAgICAgICAgICAgLy8gaW50ZXJuYWwgY29sbGVjdGlvbi5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIEZvciB0aGUgZm9sbG93aW5nIGV4YW1wbGU6XG4gICAgICAgICAgICAgICAgLy8gaW50ZXJuYWwgLT4gWyAnQScsICdCIC0gc2tpcHBlZCBmb3IgZXh0ZXJuYWwnLCAnQyAtIHNraXBwZWQgZm9yIGV4dGVybmFsJyBdXG4gICAgICAgICAgICAgICAgLy8gZXh0ZXJuYWwgLT4gWyBBIF1cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIEFub3RoZXIgaXRlbSBpcyBiZWVuIGFkZGVkIGF0IHRoZSBlbmQgb2YgZXh0ZXJuYWwgY29sbGVjdGlvbjpcbiAgICAgICAgICAgICAgICAvLyBleHRlcm5hbC5hZGQoICdEJyApXG4gICAgICAgICAgICAgICAgLy8gZXh0ZXJuYWwgLT4gWyAnQScsICdEJyBdXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGluY2x1ZGUgc2tpcHBlZCBpdGVtcyBhbmQgcGxhY2UgbmV3IGl0ZW0gYWZ0ZXIgdGhlbTpcbiAgICAgICAgICAgICAgICAvLyBpbnRlcm5hbCAtPiBbICdBJywgJ0IgLSBza2lwcGVkIGZvciBleHRlcm5hbCcsICdDIC0gc2tpcHBlZCBmb3IgZXh0ZXJuYWwnLCAnRCcgXVxuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc2tpcHBlZCBvZiBleHRlcm5hbENvbGxlY3Rpb24uX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsSW5kZXggPj0gc2tpcHBlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5zZXQoZXh0ZXJuYWxJdGVtLCBpdGVtKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9iaW5kVG9JbnRlcm5hbFRvRXh0ZXJuYWxNYXAuc2V0KGl0ZW0sIGV4dGVybmFsSXRlbSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGQoaXRlbSwgZmluYWxJbmRleCk7XG4gICAgICAgICAgICAgICAgLy8gQWZ0ZXIgYWRkaW5nIG5ldyBlbGVtZW50IHRvIGludGVybmFsIGNvbGxlY3Rpb24gd2UgbmVlZCB1cGRhdGUgaW5kZXhlc1xuICAgICAgICAgICAgICAgIC8vIG9mIHNraXBwZWQgaXRlbXMgaW4gZXh0ZXJuYWwgY29sbGVjdGlvbi5cbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZXh0ZXJuYWxDb2xsZWN0aW9uLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaW5hbEluZGV4IDw9IGV4dGVybmFsQ29sbGVjdGlvbi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWxbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVybmFsQ29sbGVjdGlvbi5fc2tpcHBlZEluZGV4ZXNGcm9tRXh0ZXJuYWxbaV0rKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gTG9hZCB0aGUgaW5pdGlhbCBjb250ZW50IG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgICAgICBmb3IgKGNvbnN0IGV4dGVybmFsSXRlbSBvZiBleHRlcm5hbENvbGxlY3Rpb24pe1xuICAgICAgICAgICAgYWRkSXRlbShudWxsLCBleHRlcm5hbEl0ZW0sIGV4dGVybmFsQ29sbGVjdGlvbi5nZXRJbmRleChleHRlcm5hbEl0ZW0pKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTeW5jaHJvbml6ZSB0aGUgd2l0aCBjb2xsZWN0aW9uIGFzIG5ldyBpdGVtcyBhcmUgYWRkZWQuXG4gICAgICAgIHRoaXMubGlzdGVuVG8oZXh0ZXJuYWxDb2xsZWN0aW9uLCAnYWRkJywgYWRkSXRlbSk7XG4gICAgICAgIC8vIFN5bmNocm9uaXplIHRoZSB3aXRoIGNvbGxlY3Rpb24gYXMgbmV3IGl0ZW1zIGFyZSByZW1vdmVkLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGV4dGVybmFsQ29sbGVjdGlvbiwgJ3JlbW92ZScsIChldnQsIGV4dGVybmFsSXRlbSwgaW5kZXgpPT57XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5fYmluZFRvRXh0ZXJuYWxUb0ludGVybmFsTWFwLmdldChleHRlcm5hbEl0ZW0pO1xuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFmdGVyIHJlbW92aW5nIGVsZW1lbnQgZnJvbSBleHRlcm5hbCBjb2xsZWN0aW9uIHdlIG5lZWQgdXBkYXRlL3JlbW92ZSBpbmRleGVzXG4gICAgICAgICAgICAvLyBvZiBza2lwcGVkIGl0ZW1zIGluIGludGVybmFsIGNvbGxlY3Rpb24uXG4gICAgICAgICAgICB0aGlzLl9za2lwcGVkSW5kZXhlc0Zyb21FeHRlcm5hbCA9IHRoaXMuX3NraXBwZWRJbmRleGVzRnJvbUV4dGVybmFsLnJlZHVjZSgocmVzdWx0LCBza2lwcGVkKT0+e1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHNraXBwZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2tpcHBlZCAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiBza2lwcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNraXBwZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfSwgW10pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gdW5pcXVlIGlkIHByb3BlcnR5IGZvciBhIGdpdmVuIGBpdGVtYC5cblx0ICpcblx0ICogVGhlIG1ldGhvZCB3aWxsIGdlbmVyYXRlIG5ldyBpZCBhbmQgYXNzaWduIGl0IHRvIHRoZSBgaXRlbWAgaWYgaXQgZG9lc24ndCBoYXZlIGFueS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSB0byBiZSBhZGRlZC5cblx0ICovIF9nZXRJdGVtSWRCZWZvcmVBZGRpbmcoaXRlbSkge1xuICAgICAgICBjb25zdCBpZFByb3BlcnR5ID0gdGhpcy5faWRQcm9wZXJ0eTtcbiAgICAgICAgbGV0IGl0ZW1JZDtcbiAgICAgICAgaWYgKGlkUHJvcGVydHkgaW4gaXRlbSkge1xuICAgICAgICAgICAgaXRlbUlkID0gaXRlbVtpZFByb3BlcnR5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbUlkICE9ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFRoaXMgaXRlbSdzIElEIHNob3VsZCBiZSBhIHN0cmluZy5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIGNvbGxlY3Rpb24tYWRkLWludmFsaWQtaWRcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLWFkZC1pbnZhbGlkLWlkJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5nZXQoaXRlbUlkKSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUaGlzIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gdGhlIGNvbGxlY3Rpb24uXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIEBlcnJvciBjb2xsZWN0aW9uLWFkZC1pdGVtLWFscmVhZHktZXhpc3RzXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29sbGVjdGlvbi1hZGQtaXRlbS1hbHJlYWR5LWV4aXN0cycsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbVtpZFByb3BlcnR5XSA9IGl0ZW1JZCA9IHVpZCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtSWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb3JlIHtAbGluayAjcmVtb3ZlfSBtZXRob2QgaW1wbGVtZW50YXRpb24gc2hhcmVkIGluIG90aGVyIGZ1bmN0aW9ucy5cblx0ICpcblx0ICogSW4gY29udHJhc3QgdGhpcyBtZXRob2QgKipkb2VzIG5vdCoqIGZpcmUgdGhlIHtAbGluayAjZXZlbnQ6Y2hhbmdlfSBldmVudC5cblx0ICpcblx0ICogQHBhcmFtIHN1YmplY3QgVGhlIGl0ZW0gdG8gcmVtb3ZlLCBpdHMgaWQgb3IgaW5kZXggaW4gdGhlIGNvbGxlY3Rpb24uXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgcmVtb3ZlZCBpdGVtIGFuZCBpdHMgaW5kZXguXG5cdCAqIEBmaXJlcyByZW1vdmVcblx0ICovIF9yZW1vdmUoc3ViamVjdCkge1xuICAgICAgICBsZXQgaW5kZXgsIGlkLCBpdGVtO1xuICAgICAgICBsZXQgaXRlbURvZXNOb3RFeGlzdCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBpZFByb3BlcnR5ID0gdGhpcy5faWRQcm9wZXJ0eTtcbiAgICAgICAgaWYgKHR5cGVvZiBzdWJqZWN0ID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBpZCA9IHN1YmplY3Q7XG4gICAgICAgICAgICBpdGVtID0gdGhpcy5faXRlbU1hcC5nZXQoaWQpO1xuICAgICAgICAgICAgaXRlbURvZXNOb3RFeGlzdCA9ICFpdGVtO1xuICAgICAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IHRoaXMuX2l0ZW1zLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHN1YmplY3QgPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGluZGV4ID0gc3ViamVjdDtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07XG4gICAgICAgICAgICBpdGVtRG9lc05vdEV4aXN0ID0gIWl0ZW07XG4gICAgICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGlkID0gaXRlbVtpZFByb3BlcnR5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW0gPSBzdWJqZWN0O1xuICAgICAgICAgICAgaWQgPSBpdGVtW2lkUHJvcGVydHldO1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pO1xuICAgICAgICAgICAgaXRlbURvZXNOb3RFeGlzdCA9IGluZGV4ID09IC0xIHx8ICF0aGlzLl9pdGVtTWFwLmdldChpZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl0ZW1Eb2VzTm90RXhpc3QpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogSXRlbSBub3QgZm91bmQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGNvbGxlY3Rpb24tcmVtb3ZlLTQwNFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb2xsZWN0aW9uLXJlbW92ZS00MDQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLl9pdGVtTWFwLmRlbGV0ZShpZCk7XG4gICAgICAgIGNvbnN0IGV4dGVybmFsSXRlbSA9IHRoaXMuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcC5nZXQoaXRlbSk7XG4gICAgICAgIHRoaXMuX2JpbmRUb0ludGVybmFsVG9FeHRlcm5hbE1hcC5kZWxldGUoaXRlbSk7XG4gICAgICAgIHRoaXMuX2JpbmRUb0V4dGVybmFsVG9JbnRlcm5hbE1hcC5kZWxldGUoZXh0ZXJuYWxJdGVtKTtcbiAgICAgICAgdGhpcy5maXJlKCdyZW1vdmUnLCBpdGVtLCBpbmRleCk7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBpdGVtLFxuICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEl0ZXJhYmxlIGludGVyZmFjZS5cblx0ICovIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9maXJzdFxuICovIC8qKlxuICogUmV0dXJucyBmaXJzdCBpdGVtIG9mIHRoZSBnaXZlbiBgaXRlcmF0b3JgLlxuICovIGZ1bmN0aW9uIGZpcnN0KGl0ZXJhdG9yKSB7XG4gICAgY29uc3QgaXRlcmF0b3JJdGVtID0gaXRlcmF0b3IubmV4dCgpO1xuICAgIGlmIChpdGVyYXRvckl0ZW0uZG9uZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZXJhdG9ySXRlbS52YWx1ZTtcbn1cblxuLyoqXG4gKiBBbGxvd3Mgb2JzZXJ2aW5nIGEgZ3JvdXAgb2YgRE9NIGBFbGVtZW50YHMgb3Ige0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXcgdmlldyBpbnN0YW5jZXN9IHdoZXRoZXIgYXQgbGVhc3Qgb25lIG9mIHRoZW0gKG9yIHRoZWlyIGNoaWxkKVxuICogaXMgZm9jdXNlZC5cbiAqXG4gKiBVc2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3J9IGluIG9yZGVyIHRvIHRyYWNrIHdoZXRoZXIgdGhlIGZvY3VzIGlzIHN0aWxsIHdpdGhpbiB0aGUgYXBwbGljYXRpb24sXG4gKiBvciB3ZXJlIHVzZWQgb3V0c2lkZSBvZiBpdHMgVUkuXG4gKlxuICogKipOb3RlKiogYGZvY3VzYCBhbmQgYGJsdXJgIGxpc3RlbmVycyB1c2UgZXZlbnQgY2FwdHVyaW5nLCBzbyBpdCBpcyBvbmx5IG5lZWRlZCB0byByZWdpc3RlciB3cmFwcGVyIGBFbGVtZW50YFxuICogd2hpY2ggY29udGFpbiBvdGhlciBgZm9jdXNhYmxlYCBlbGVtZW50cy4gQnV0IG5vdGUgdGhhdCB0aGlzIHdyYXBwZXIgZWxlbWVudCBoYXMgdG8gYmUgZm9jdXNhYmxlIHRvb1xuICogKGhhdmUgZS5nLiBgdGFiaW5kZXg9XCItMVwiYCkuXG4gKlxuICogQ2hlY2sgb3V0IHRoZSB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvdWkvZm9jdXMtdHJhY2tpbmcgXCJEZWVwIGRpdmUgaW50byBmb2N1cyB0cmFja2luZ1wifSBndWlkZSB0byBsZWFybiBtb3JlLlxuICovIGNsYXNzIEZvY3VzVHJhY2tlciBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBEb21FbWl0dGVyTWl4aW4oLyogI19fUFVSRV9fICovIE9ic2VydmFibGVNaXhpbigpKSB7XG4gICAgLyoqXG5cdCAqIExpc3Qgb2YgcmVnaXN0ZXJlZCBET00gZWxlbWVudHMuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2VsZW1lbnRzID0gbmV3IFNldCgpO1xuICAgIC8qKlxuXHQgKiBMaXN0IG9mIHZpZXdzIHdpdGggZXh0ZXJuYWwgZm9jdXMgdHJhY2tlcnMgdGhhdCBjb250cmlidXRlIHRvIHRoZSBzdGF0ZSBvZiB0aGlzIGZvY3VzIHRyYWNrZXIuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2V4dGVybmFsVmlld3MgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIEFzeW5jaHJvbm91cyBibHVyIGV2ZW50IHRpbWVvdXQuXG5cdCAqLyBfYmx1clRpbWVvdXQgPSBudWxsO1xuICAgIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gcHVibGljIF9sYWJlbD86IHN0cmluZztcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnNldCgnaXNGb2N1c2VkJywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgnZm9jdXNlZEVsZW1lbnQnLCBudWxsKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIEZvY3VzVHJhY2tlci5faW5zdGFuY2VzLnB1c2goIHRoaXMgKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIExpc3Qgb2YgcmVnaXN0ZXJlZCBET00gZWxlbWVudHMuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGUgbGlzdCBkb2VzIGRvIG5vdCBpbmNsdWRlIGVsZW1lbnRzIGZyb20ge0BsaW5rICNleHRlcm5hbFZpZXdzfS5cblx0ICovIGdldCBlbGVtZW50cygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5fZWxlbWVudHMudmFsdWVzKCkpO1xuICAgIH1cbiAgICAvKipcblx0ICogTGlzdCBvZiBleHRlcm5hbCBmb2N1c2FibGUgdmlld3MgdGhhdCBjb250cmlidXRlIHRvIHRoZSBzdGF0ZSBvZiB0aGlzIGZvY3VzIHRyYWNrZXIuIFNlZSB7QGxpbmsgI2FkZH0gdG8gbGVhcm4gbW9yZS5cblx0ICovIGdldCBleHRlcm5hbFZpZXdzKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9leHRlcm5hbFZpZXdzLnZhbHVlcygpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyB0cmFja2luZyBhIHNwZWNpZmllZCBET00gZWxlbWVudCBvciBhIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fSBpbnN0YW5jZS5cblx0ICpcblx0ICogKiBJZiBhIERPTSBlbGVtZW50IGlzIHBhc3NlZCwgdGhlIGZvY3VzIHRyYWNrZXIgbGlzdGVucyB0byB0aGUgYGZvY3VzYCBhbmQgYGJsdXJgIGV2ZW50cyBvbiB0aGlzIGVsZW1lbnQuXG5cdCAqIFRyYWNrZWQgZWxlbWVudHMgYXJlIGxpc3RlZCBpbiB7QGxpbmsgI2VsZW1lbnRzfS5cblx0ICogKiBJZiBhIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fSBpbnN0YW5jZSBpcyBwYXNzZWQgdGhhdCBoYXMgYSBgRm9jdXNUcmFja2VyYCBpbnN0YW5jZSAoe0BsaW5rIH5WaWV3V2l0aEZvY3VzVHJhY2tlcn0pLFxuXHQgKiB0aGUgZXh0ZXJuYWwgZm9jdXMgdHJhY2tlcidzIHN0YXRlICh7QGxpbmsgI2lzRm9jdXNlZH0sIHtAbGluayAjZm9jdXNlZEVsZW1lbnR9KSBzdGFydHMgY29udHJpYnV0aW5nIHRvIHRoZSBjdXJyZW50IHRyYWNrZXIgaW5zdGFuY2UuXG5cdCAqIFRoaXMgYWxsb3dzIGZvciBpbmNyZWFzaW5nIHRoZSBcInJlYWNoXCIgb2YgYSBmb2N1cyB0cmFja2VyIGluc3RhbmNlLCBieSBjb25uZWN0aW5nIHR3byBvciBtb3JlIGZvY3VzIHRyYWNrZXJzIHRvZ2V0aGVyIHdoZW4gRE9NXG5cdCAqIGVsZW1lbnRzIHRoZXkgdHJhY2sgYXJlIGxvY2F0ZWQgaW4gZGlmZmVyZW50IHN1YnRyZWVzIGluIERPTS4gRXh0ZXJuYWwgZm9jdXMgdHJhY2tlcnMgYXJlIGxpc3RlZCBpbiB7QGxpbmsgI2V4dGVybmFsVmlld3N9LlxuXHQgKiAqIElmIGEge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXd9IGluc3RhbmNlIGlzIHBhc3NlZCB0aGF0IGhhcyBubyBgRm9jdXNUcmFja2VyYCAoKipub3QqKiBhIHtAbGluayB+Vmlld1dpdGhGb2N1c1RyYWNrZXJ9KSxcblx0ICogaXRzIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3I2VsZW1lbnR9IGlzIHVzZWQgdG8gdHJhY2sgZm9jdXMgbGlrZSBhbnkgb3RoZXIgRE9NIGVsZW1lbnQuXG5cdCAqLyBhZGQoZWxlbWVudE9yVmlldykge1xuICAgICAgICBpZiAoaXNFbGVtZW50KGVsZW1lbnRPclZpZXcpKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRFbGVtZW50KGVsZW1lbnRPclZpZXcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGlzVmlld1dpdGhGb2N1c1RyYWNrZXIoZWxlbWVudE9yVmlldykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRWaWV3KGVsZW1lbnRPclZpZXcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnRPclZpZXcuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0XHQgKiBUaGUge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXd9IGFkZGVkIHRvIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2ZvY3VzdHJhY2tlcn5Gb2N1c1RyYWNrZXJ9IGRvZXMgbm90IGhhdmUgYW5cblx0XHRcdFx0XHQgKiB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyNlbGVtZW50fS4gTWFrZSBzdXJlIHRoZSB2aWV3IGlzIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3I3JlbmRlcn0gYmVmb3JlIGFkZGluZ1xuXHRcdFx0XHRcdCAqIGl0IHRvIHRoZSBmb2N1cyB0cmFja2VyLlxuXHRcdFx0XHRcdCAqXG5cdFx0XHRcdFx0ICogQGVycm9yIGZvY3VzdHJhY2tlci1hZGQtdmlldy1taXNzaW5nLWVsZW1lbnRcblx0XHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2ZvY3VzdHJhY2tlci1hZGQtdmlldy1taXNzaW5nLWVsZW1lbnQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1c1RyYWNrZXI6IHRoaXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3OiBlbGVtZW50T3JWaWV3XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9hZGRFbGVtZW50KGVsZW1lbnRPclZpZXcuZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0b3BzIHRyYWNraW5nIGZvY3VzIGluIHRoZSBzcGVjaWZpZWQgRE9NIGVsZW1lbnQgb3IgYSB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyB2aWV3IGluc3RhbmNlfS4gU2VlIHtAbGluayAjYWRkfSB0byBsZWFybiBtb3JlLlxuXHQgKi8gcmVtb3ZlKGVsZW1lbnRPclZpZXcpIHtcbiAgICAgICAgaWYgKGlzRWxlbWVudChlbGVtZW50T3JWaWV3KSkge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRWxlbWVudChlbGVtZW50T3JWaWV3KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChpc1ZpZXdXaXRoRm9jdXNUcmFja2VyKGVsZW1lbnRPclZpZXcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlVmlldyhlbGVtZW50T3JWaWV3KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQXNzdW1pbmcgdGhhdCBpZiB0aGUgdmlldyB3YXMgc3VjY2Vzc2Z1bGx5IGFkZGVkLCBpdCBtdXN0IGhhdmUgY29tZSB3aXRoIGFuIGV4aXN0aW5nICNlbGVtZW50LlxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUVsZW1lbnQoZWxlbWVudE9yVmlldy5lbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBhIERPTSBlbGVtZW50IHRvIHRoZSBmb2N1cyB0cmFja2VyIGFuZCBzdGFydHMgbGlzdGVuaW5nIHRvIHRoZSBgZm9jdXNgIGFuZCBgYmx1cmAgZXZlbnRzIG9uIGl0LlxuXHQgKi8gX2FkZEVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5fZWxlbWVudHMuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoaXMgZWxlbWVudCBpcyBhbHJlYWR5IHRyYWNrZWQgYnkge0BsaW5rIG1vZHVsZTp1dGlscy9mb2N1c3RyYWNrZXJ+Rm9jdXNUcmFja2VyfS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgZm9jdXN0cmFja2VyLWFkZC1lbGVtZW50LWFscmVhZHktZXhpc3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZm9jdXN0cmFja2VyLWFkZC1lbGVtZW50LWFscmVhZHktZXhpc3QnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpc3RlblRvKGVsZW1lbnQsICdmb2N1cycsICgpPT57XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIGNvbnNvbGUubG9nKCBgXCIkeyBnZXROYW1lKCB0aGlzICkgfVwiOiBGb2N1cyB3aXRoIHVzZUNhcHR1cmUgb24gRE9NIGVsZW1lbnRgICk7XG4gICAgICAgICAgICBjb25zdCBleHRlcm5hbEZvY3VzZWRWaWV3SW5TdWJ0cmVlID0gdGhpcy5leHRlcm5hbFZpZXdzLmZpbmQoKHZpZXcpPT5pc0V4dGVybmFsVmlld1N1YnRyZWVGb2N1c2VkKGVsZW1lbnQsIHZpZXcpKTtcbiAgICAgICAgICAgIGlmIChleHRlcm5hbEZvY3VzZWRWaWV3SW5TdWJ0cmVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXMoZXh0ZXJuYWxGb2N1c2VkVmlld0luU3VidHJlZS5lbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZm9jdXMoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWxlbWVudCwgJ2JsdXInLCAoKT0+e1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBjb25zb2xlLmxvZyggYFwiJHsgZ2V0TmFtZSggdGhpcyApIH1cIjogQmx1ciB3aXRoIHVzZUNhcHR1cmUgb24gRE9NIGVsZW1lbnRgICk7XG4gICAgICAgICAgICB0aGlzLl9ibHVyKCk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmFkZChlbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYSBET00gZWxlbWVudCBmcm9tIHRoZSBmb2N1cyB0cmFja2VyLlxuXHQgKi8gX3JlbW92ZUVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5fZWxlbWVudHMuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoZWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50cy5kZWxldGUoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnQgPT09IHRoaXMuZm9jdXNlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2JsdXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBhbiBleHRlcm5hbCB7QGxpbmsgbW9kdWxlOnVpL3ZpZXd+VmlldyB2aWV3IGluc3RhbmNlfSB0byB0aGlzIGZvY3VzIHRyYWNrZXIgYW5kIG1ha2VzIGl0IGNvbnRyaWJ1dGUgdG8gdGhpcyBmb2N1cyB0cmFja2VyJ3Ncblx0ICogc3RhdGUgZWl0aGVyIGJ5IGl0cyBgVmlldyNlbGVtZW50YCBvciBieSBpdHMgYFZpZXcjZm9jdXNUcmFja2VyYCBpbnN0YW5jZS5cblx0ICovIF9hZGRWaWV3KHZpZXcpIHtcbiAgICAgICAgaWYgKHZpZXcuZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fYWRkRWxlbWVudCh2aWV3LmVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGlzdGVuVG8odmlldy5mb2N1c1RyYWNrZXIsICdjaGFuZ2U6Zm9jdXNlZEVsZW1lbnQnLCAoKT0+e1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRgXCIkeyBnZXROYW1lKCB0aGlzICkgfVwiOiBSZWxhdGVkIFwiJHsgZ2V0TmFtZSggdmlldy5mb2N1c1RyYWNrZXIgKSB9XCIjZm9jdXNlZEVsZW1lbnQgPSBgLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdHZpZXcuZm9jdXNUcmFja2VyLmZvY3VzZWRFbGVtZW50XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vICk7XG4gICAgICAgICAgICBpZiAodmlldy5mb2N1c1RyYWNrZXIuZm9jdXNlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodmlldy5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZvY3VzKHZpZXcuZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibHVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9leHRlcm5hbFZpZXdzLmFkZCh2aWV3KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYW4gZXh0ZXJuYWwge0BsaW5rIG1vZHVsZTp1aS92aWV3flZpZXcgdmlldyBpbnN0YW5jZX0gZnJvbSB0aGlzIGZvY3VzIHRyYWNrZXIuXG5cdCAqLyBfcmVtb3ZlVmlldyh2aWV3KSB7XG4gICAgICAgIGlmICh2aWV3LmVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZUVsZW1lbnQodmlldy5lbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcodmlldy5mb2N1c1RyYWNrZXIpO1xuICAgICAgICB0aGlzLl9leHRlcm5hbFZpZXdzLmRlbGV0ZSh2aWV3KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc3Ryb3lzIHRoZSBmb2N1cyB0cmFja2VyIGJ5OlxuXHQgKiAtIERpc2FibGluZyBhbGwgZXZlbnQgbGlzdGVuZXJzIGF0dGFjaGVkIHRvIHRyYWNrZWQgZWxlbWVudHMgb3IgZXh0ZXJuYWwgdmlld3MuXG5cdCAqIC0gUmVtb3ZpbmcgYWxsIHRyYWNrZWQgZWxlbWVudHMgYW5kIHZpZXdzIHRoYXQgd2VyZSBwcmV2aW91c2x5IGFkZGVkLlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX2V4dGVybmFsVmlld3MuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mb2N1c2VkRWxlbWVudCA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTdG9yZXMgY3VycmVudGx5IGZvY3VzZWQgZWxlbWVudCBhcyB7QGxpbmsgI2ZvY3VzZWRFbGVtZW50fSBhbmQgc2V0cyB7QGxpbmsgI2lzRm9jdXNlZH0gYHRydWVgLlxuXHQgKi8gX2ZvY3VzKGVsZW1lbnQpIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBjb25zb2xlLmxvZyggYFwiJHsgZ2V0TmFtZSggdGhpcyApIH1cIjogX2ZvY3VzKCkgb24gZWxlbWVudGAsIGVsZW1lbnQgKTtcbiAgICAgICAgdGhpcy5fY2xlYXJCbHVyVGltZW91dCgpO1xuICAgICAgICB0aGlzLmZvY3VzZWRFbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2xlYXJzIGN1cnJlbnRseSB7QGxpbmsgI2ZvY3VzZWRFbGVtZW50fSBhbmQgc2V0cyB7QGxpbmsgI2lzRm9jdXNlZH0gYGZhbHNlYC5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgdXNlcyBgc2V0VGltZW91dCgpYCB0byBjaGFuZ2Ugb3JkZXIgb2YgYGJsdXJgIGFuZCBgZm9jdXNgIGV2ZW50cyBjYWxscywgZW5zdXJpbmcgdGhhdCBtb3ZpbmcgZm9jdXMgYmV0d2VlblxuXHQgKiB0d28gZWxlbWVudHMgd2l0aGluIGEgc2luZ2xlIGZvY3VzIHRyYWNrZXIncyBzY29wZSwgd2lsbCBub3QgY2F1c2UgYFsgYmx1ckEsIGZvY3VzQiBdYCBzZXF1ZW5jZSBidXQganVzdCBgWyBmb2N1c0IgXWAuXG5cdCAqIFRoZSBmb3JtZXIgd291bGQgY2F1c2UgYSBtb21lbnRhcnkgY2hhbmdlIG9mIGAjaXNGb2N1c2VkYCB0byBgZmFsc2VgIHdoaWNoIGlzIG5vdCBkZXNpcmVkIGJlY2F1c2UgYW55IGxvZ2ljIGxpc3RlbmluZyB0b1xuXHQgKiBhIGZvY3VzIHRyYWNrZXIgc3RhdGUgd291bGQgZXhwZXJpZW5jZSBVSSBmbGFzaGVzIGFuZCBnbGl0Y2hlcyBhcyB0aGUgdXNlciBmb2N1cyB0cmF2ZWxzIGFjcm9zcyB0aGUgVUkuXG5cdCAqLyBfYmx1cigpIHtcbiAgICAgICAgY29uc3QgaXNBbnlFbGVtZW50Rm9jdXNlZCA9IHRoaXMuZWxlbWVudHMuZmluZCgoZWxlbWVudCk9PmVsZW1lbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpO1xuICAgICAgICAvLyBBdm9pZCBibHVycyBvcmlnaW5hdGluZyBmcm9tIGV4dGVybmFsIEZUcyB3aGVuIHRoZSBmb2N1cyBzdGlsbCByZW1haW5zIGluIG9uZSBvZiB0aGUgI2VsZW1lbnRzLlxuICAgICAgICBpZiAoaXNBbnlFbGVtZW50Rm9jdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzQW55RXh0ZXJuYWxWaWV3Rm9jdXNlZCA9IHRoaXMuZXh0ZXJuYWxWaWV3cy5maW5kKCh2aWV3KT0+e1xuICAgICAgICAgICAgLy8gRG8gbm90IGNvbnNpZGVyIGV4dGVybmFsIHZpZXdzJ3MgZm9jdXMgdHJhY2tlcnMgYXMgZm9jdXNlZCBpZiB0aGVyZSdzIGEgYmx1ciB0aW1lb3V0IHBlbmRpbmcuXG4gICAgICAgICAgICByZXR1cm4gdmlldy5mb2N1c1RyYWNrZXIuaXNGb2N1c2VkICYmICF2aWV3LmZvY3VzVHJhY2tlci5fYmx1clRpbWVvdXQ7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBdm9pZCB1bm5lY2Vzc2FyeSBET00gYmx1cnMgY29taW5nIGZyb20gI2VsZW1lbnRzIHdoZW4gdGhlIGZvY3VzIHN0aWxsIHJlbWFpbnMgaW4gb25lIG9mICNleHRlcm5hbFZpZXdzLlxuICAgICAgICBpZiAoaXNBbnlFeHRlcm5hbFZpZXdGb2N1c2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2xlYXJCbHVyVGltZW91dCgpO1xuICAgICAgICB0aGlzLl9ibHVyVGltZW91dCA9IHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gY29uc29sZS5sb2coIGBcIiR7IGdldE5hbWUoIHRoaXMgKSB9XCI6IEJsdXIuYCApO1xuICAgICAgICAgICAgdGhpcy5mb2N1c2VkRWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmlzRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9LCAwKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsZWFycyB0aGUgYXN5bmNocm9ub3VzIGJsdXIgZXZlbnQgdGltZW91dCBvbiBkZW1hbmQuIFNlZSB7QGxpbmsgI19ibHVyfSB0byBsZWFybiBtb3JlLlxuXHQgKi8gX2NsZWFyQmx1clRpbWVvdXQoKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9ibHVyVGltZW91dCk7XG4gICAgICAgIHRoaXMuX2JsdXJUaW1lb3V0ID0gbnVsbDtcbiAgICB9XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIGEgdmlldyBpcyBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgflZpZXdXaXRoRm9jdXNUcmFja2VyfS5cbiAqLyBmdW5jdGlvbiBpc1ZpZXdXaXRoRm9jdXNUcmFja2VyKHZpZXcpIHtcbiAgICByZXR1cm4gJ2ZvY3VzVHJhY2tlcicgaW4gdmlldyAmJiB2aWV3LmZvY3VzVHJhY2tlciBpbnN0YW5jZW9mIEZvY3VzVHJhY2tlcjtcbn1cbmZ1bmN0aW9uIGlzRWxlbWVudCh2YWx1ZSkge1xuICAgIHJldHVybiBpc0VsZW1lbnQkMSh2YWx1ZSk7XG59XG5mdW5jdGlvbiBpc0V4dGVybmFsVmlld1N1YnRyZWVGb2N1c2VkKHN1YlRyZWVSb290LCB2aWV3KSB7XG4gICAgaWYgKGlzRm9jdXNlZFZpZXcoc3ViVHJlZVJvb3QsIHZpZXcpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gISF2aWV3LmZvY3VzVHJhY2tlci5leHRlcm5hbFZpZXdzLmZpbmQoKHZpZXcpPT5pc0ZvY3VzZWRWaWV3KHN1YlRyZWVSb290LCB2aWV3KSk7XG59XG5mdW5jdGlvbiBpc0ZvY3VzZWRWaWV3KHN1YlRyZWVSb290LCB2aWV3KSB7XG4gICAgLy8gTm90ZTogWW91IGNhbm5vdCBkZXBlbmQgb24gZXh0ZXJuYWxWaWV3LmZvY3VzVHJhY2tlci5mb2N1c2VkRWxlbWVudCBiZWNhdXNlIGJsdXJzIGFyZSBhc3luY2hyb25vdXMgYW5kIHRoZSB2YWx1ZSBtYXlcbiAgICAvLyBiZSBvdXRkYXRlZCB3aGVuIG1vdmluZyBmb2N1cyBiZXR3ZWVuIHR3byBlbGVtZW50cy4gVXNpbmcgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbnN0ZWFkLlxuICAgIHJldHVybiAhIXZpZXcuZWxlbWVudCAmJiB2aWV3LmVsZW1lbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgJiYgc3ViVHJlZVJvb3QuY29udGFpbnModmlldy5lbGVtZW50KTtcbn0gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBkZWNsYXJlIGdsb2JhbCB7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGludGVyZmFjZSBXaW5kb3cge1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdGxvZ0ZvY3VzVHJhY2tlcnM6IEZ1bmN0aW9uO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHR9XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyB9XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvL1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gZnVuY3Rpb24gZ2V0TmFtZSggZm9jdXNUcmFja2VyOiBGb2N1c1RyYWNrZXIgKTogc3RyaW5nIHtcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0cmV0dXJuIGZvY3VzVHJhY2tlci5fbGFiZWwgfHwgJ1Vua25vd24nO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gfVxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy9cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIGZ1bmN0aW9uIGxvZ1N0YXRlKFxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRmb2N1c1RyYWNrZXI6IEZvY3VzVHJhY2tlcixcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0a2V5c1RvTG9nOiBBcnJheTxzdHJpbmc+ID0gWyAnaXNGb2N1c2VkJywgJ2ZvY3VzZWRFbGVtZW50JyBdXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyApOiBzdHJpbmcge1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRrZXlzVG9Mb2cuZm9yRWFjaCgga2V5ID0+IHsgY29uc29sZS5sb2coIGAkeyBrZXkgfT1gLCBmb2N1c1RyYWNrZXJbIGtleSBdICkgfSApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRjb25zb2xlLmxvZyggJ2VsZW1lbnRzJywgZm9jdXNUcmFja2VyLmVsZW1lbnRzICk7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGNvbnNvbGUubG9nKCAnZXh0ZXJuYWxWaWV3cycsIGZvY3VzVHJhY2tlci5leHRlcm5hbFZpZXdzICk7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyB9XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvL1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gd2luZG93LmxvZ0ZvY3VzVHJhY2tlcnMgPSAoXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGZpbHRlciA9ICgpID0+IHRydWUsXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGtleXNUb0xvZzogQXJyYXk8c3RyaW5nPlxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gKTogdm9pZCA9PiB7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGNvbnNvbGUuZ3JvdXAoICdGb2N1c1RyYWNrZXJzJyApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy9cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0Zm9yICggY29uc3QgZm9jdXNUcmFja2VyIG9mIEZvY3VzVHJhY2tlci5faW5zdGFuY2VzICkge1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdGlmICggZmlsdGVyKCBmb2N1c1RyYWNrZXIgKSApIHtcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0XHRcdGNvbnNvbGUuZ3JvdXAoIGBcIiR7IGdldE5hbWUoIGZvY3VzVHJhY2tlciApIH1cImAgKTtcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0XHRcdGxvZ1N0YXRlKCBmb2N1c1RyYWNrZXIsIGtleXNUb0xvZyApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdFx0Y29uc29sZS5ncm91cEVuZCgpO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdH1cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0fVxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy9cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gfTtcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyB3aW5kb3cubG9nRm9jdXNUcmFja2VyVHJlZSA9IChcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0cm9vdEZvY3VzVHJhY2tlcjogRm9jdXNUcmFja2VyLFxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRmaWx0ZXIgPSAoKSA9PiB0cnVlLFxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRrZXlzVG9Mb2c6IEFycmF5PHN0cmluZz5cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vICk6IHZvaWQgPT4ge1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRjb25zb2xlLmdyb3VwKCAnRm9jdXNUcmFja2VycyB0cmVlJyApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy9cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0bG9nQnJhbmNoKCByb290Rm9jdXNUcmFja2VyLCBmaWx0ZXIgKTtcbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdGZ1bmN0aW9uIGxvZ0JyYW5jaCggZm9jdXNUcmFja2VyLCBmaWx0ZXIgKSB7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdFx0Y29uc29sZS5ncm91cCggYFwiJHsgZ2V0TmFtZSggZm9jdXNUcmFja2VyICkgfVwiYCApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdGxvZ1N0YXRlKCBmb2N1c1RyYWNrZXIsIGtleXNUb0xvZyApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy9cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vIFx0XHRmb3IgKCBjb25zdCBleHRlcm5hbFZpZXcgb2YgZm9jdXNUcmFja2VyLmV4dGVybmFsVmlld3MgKSB7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdFx0XHRpZiAoIGZpbHRlciggZXh0ZXJuYWxWaWV3LmZvY3VzVHJhY2tlciApICkge1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdFx0XHRsb2dCcmFuY2goIGV4dGVybmFsVmlldy5mb2N1c1RyYWNrZXIsIGZpbHRlciApO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdFx0fVxuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRcdH1cbiAvLyBAaWYgQ0tfREVCVUdfRk9DVVNUUkFDS0VSIC8vXG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyBcdFx0Y29uc29sZS5ncm91cEVuZCgpO1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHR9XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvL1xuIC8vIEBpZiBDS19ERUJVR19GT0NVU1RSQUNLRVIgLy8gXHRjb25zb2xlLmdyb3VwRW5kKCk7XG4gLy8gQGlmIENLX0RFQlVHX0ZPQ1VTVFJBQ0tFUiAvLyB9O1xuXG4vKipcbiAqIEtleXN0cm9rZSBoYW5kbGVyIGFsbG93cyByZWdpc3RlcmluZyBjYWxsYmFja3MgZm9yIGdpdmVuIGtleXN0cm9rZXMuXG4gKlxuICogVGhlIG1vc3QgZnJlcXVlbnQgdXNlIG9mIHRoaXMgY2xhc3MgaXMgdGhyb3VnaCB0aGUge0BsaW5rIG1vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yI2tleXN0cm9rZXMgYGVkaXRvci5rZXlzdHJva2VzYH1cbiAqIHByb3BlcnR5LiBJdCBhbGxvd3MgbGlzdGVuaW5nIHRvIGtleXN0cm9rZXMgZXhlY3V0ZWQgaW4gdGhlIGVkaXRpbmcgdmlldzpcbiAqXG4gKiBgYGB0c1xuICogZWRpdG9yLmtleXN0cm9rZXMuc2V0KCAnQ3RybCtBJywgKCBrZXlFdnREYXRhLCBjYW5jZWwgKSA9PiB7XG4gKiBcdGNvbnNvbGUubG9nKCAnQ3RybCtBIGhhcyBiZWVuIHByZXNzZWQnICk7XG4gKiBcdGNhbmNlbCgpO1xuICogfSApO1xuICogYGBgXG4gKlxuICogSG93ZXZlciwgdGhpcyB1dGlsaXR5IGNsYXNzIGNhbiBiZSB1c2VkIGluIHZhcmlvdXMgcGFydCBvZiB0aGUgVUkuIEZvciBpbnN0YW5jZSwgYSBjZXJ0YWluIHtAbGluayBtb2R1bGU6dWkvdmlld35WaWV3fVxuICogY2FuIHVzZSBpdCBsaWtlIHRoaXM6XG4gKlxuICogYGBgdHNcbiAqIGNsYXNzIE15VmlldyBleHRlbmRzIFZpZXcge1xuICogXHRjb25zdHJ1Y3RvcigpIHtcbiAqIFx0XHR0aGlzLmtleXN0cm9rZXMgPSBuZXcgS2V5c3Ryb2tlSGFuZGxlcigpO1xuICpcbiAqIFx0XHR0aGlzLmtleXN0cm9rZXMuc2V0KCAndGFiJywgaGFuZGxlVGFiS2V5ICk7XG4gKiBcdH1cbiAqXG4gKiBcdHJlbmRlcigpIHtcbiAqIFx0XHRzdXBlci5yZW5kZXIoKTtcbiAqXG4gKiBcdFx0dGhpcy5rZXlzdHJva2VzLmxpc3RlblRvKCB0aGlzLmVsZW1lbnQgKTtcbiAqIFx0fVxuICogfVxuICogYGBgXG4gKlxuICogVGhhdCBrZXlzdHJva2UgaGFuZGxlciB3aWxsIGxpc3RlbiB0byBga2V5ZG93bmAgZXZlbnRzIGZpcmVkIGluIHRoaXMgdmlldydzIG1haW4gZWxlbWVudC5cbiAqXG4gKi8gY2xhc3MgS2V5c3Ryb2tlSGFuZGxlciB7XG4gICAgLyoqXG5cdCAqIExpc3RlbmVyIHVzZWQgdG8gbGlzdGVuIHRvIGV2ZW50cyBmb3IgZWFzaWVyIGtleXN0cm9rZSBoYW5kbGVyIGRlc3RydWN0aW9uLlxuXHQgKi8gX2xpc3RlbmVyO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBrZXlzdHJva2UgaGFuZGxlci5cblx0ICovIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHRoaXMuX2xpc3RlbmVyID0gbmV3IChEb21FbWl0dGVyTWl4aW4oKSkoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyBsaXN0ZW5pbmcgZm9yIGBrZXlkb3duYCBldmVudHMgZnJvbSBhIGdpdmVuIGVtaXR0ZXIuXG5cdCAqLyBsaXN0ZW5UbyhlbWl0dGVyKSB7XG4gICAgICAgIC8vIFRoZSAjX2xpc3RlbmVyIHdvcmtzIGhlcmUgYXMgYSBraW5kIG9mIGRpc3BhdGNoZXIuIEl0IGdyb3VwcyB0aGUgZXZlbnRzIGNvbWluZyBmcm9tIHRoZSBzYW1lXG4gICAgICAgIC8vIGtleXN0cm9rZSBzbyB0aGUgbGlzdGVuZXJzIGNhbiBiZSBhdHRhY2hlZCB0byB0aGVtIHdpdGggZGlmZmVyZW50IHByaW9yaXRpZXMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEUuZy4gYWxsIHRoZSBrZXlzdHJva2VzIHdpdGggdGhlIGBrZXlDb2RlYCBvZiA0MiBjb21pbmcgZnJvbSB0aGUgYGVtaXR0ZXJgIGFyZSBwcm9wYWdhdGVkXG4gICAgICAgIC8vIGFzIGEgYF9rZXlkb3duOjQyYCBldmVudCBieSB0aGUgYF9saXN0ZW5lcmAuIElmIHRoZXJlJ3MgYSBjYWxsYmFjayBjcmVhdGVkIGJ5IHRoZSBgc2V0YFxuICAgICAgICAvLyBtZXRob2QgZm9yIHRoaXMgNDIga2V5c3Ryb2tlLCBpdCBsaXN0ZW5zIHRvIHRoZSBgX2xpc3RlbmVyI19rZXlkb3duOjQyYCBldmVudCBvbmx5IGFuZCBpbnRlcmFjdHNcbiAgICAgICAgLy8gb25seSB3aXRoIG90aGVyIGxpc3RlbmVycyBvZiB0aGlzIHBhcnRpY3VsYXIgZXZlbnQsIHRodXMgbWFraW5nIGl0IHBvc3NpYmxlIHRvIHByaW9yaXRpemVcbiAgICAgICAgLy8gdGhlIGxpc3RlbmVycyBhbmQgc2FmZWx5IGNhbmNlbCBleGVjdXRpb24sIHdoZW4gbmVlZGVkLiBJbnN0ZWFkIG9mIGR1cGxpY2F0aW5nIHRoZSBFbWl0dGVyIGxvZ2ljLFxuICAgICAgICAvLyB0aGUgS2V5c3Ryb2tlSGFuZGxlciByZeKAk3VzZXMgaXQgdG8gZG8gaXRzIGpvYi5cbiAgICAgICAgdGhpcy5fbGlzdGVuZXIubGlzdGVuVG8oZW1pdHRlciwgJ2tleWRvd24nLCAoZXZ0LCBrZXlFdnREYXRhKT0+e1xuICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXIuZmlyZSgnX2tleWRvd246JyArIGdldENvZGUoa2V5RXZ0RGF0YSksIGtleUV2dERhdGEpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIGhhbmRsZXIgZm9yIHRoZSBzcGVjaWZpZWQga2V5c3Ryb2tlLlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5c3Ryb2tlIEtleXN0cm9rZSBkZWZpbmVkIGluIGEgZm9ybWF0IGFjY2VwdGVkIGJ5XG5cdCAqIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfnBhcnNlS2V5c3Ryb2tlfSBmdW5jdGlvbi5cblx0ICogQHBhcmFtIGNhbGxiYWNrIEEgZnVuY3Rpb24gY2FsbGVkIHdpdGggdGhlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIva2V5b2JzZXJ2ZXJ+S2V5RXZlbnREYXRhIGtleSBldmVudCBkYXRhfSBvYmplY3QgYW5kXG5cdCAqIGEgaGVscGVyIGZ1bmN0aW9uIHRvIGNhbGwgYm90aCBgcHJldmVudERlZmF1bHQoKWAgYW5kIGBzdG9wUHJvcGFnYXRpb24oKWAgb24gdGhlIHVuZGVybHlpbmcgZXZlbnQuXG5cdCAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgb3B0aW9ucy5cblx0ICovIHNldChrZXlzdHJva2UsIGNhbGxiYWNrLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3Qga2V5Q29kZSA9IHBhcnNlS2V5c3Ryb2tlKGtleXN0cm9rZSk7XG4gICAgICAgIGNvbnN0IHByaW9yaXR5ID0gb3B0aW9ucy5wcmlvcml0eTtcbiAgICAgICAgLy8gRXhlY3V0ZSB0aGUgcGFzc2VkIGNhbGxiYWNrIG9uIEtleXN0cm9rZUhhbmRsZXIjX2tleWRvd24uXG4gICAgICAgIC8vIFRPRE86IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvaXNzdWVzLzE0NFxuICAgICAgICB0aGlzLl9saXN0ZW5lci5saXN0ZW5Ubyh0aGlzLl9saXN0ZW5lciwgJ19rZXlkb3duOicgKyBrZXlDb2RlLCAoZXZ0LCBrZXlFdnREYXRhKT0+e1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZmlsdGVyICYmICFvcHRpb25zLmZpbHRlcihrZXlFdnREYXRhKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrKGtleUV2dERhdGEsICgpPT57XG4gICAgICAgICAgICAgICAgLy8gU3RvcCB0aGUgZXZlbnQgaW4gdGhlIERPTTogbm8gbGlzdGVuZXIgaW4gdGhlIHdlYiBwYWdlXG4gICAgICAgICAgICAgICAgLy8gd2lsbCBiZSB0cmlnZ2VyZWQgYnkgdGhpcyBldmVudC5cbiAgICAgICAgICAgICAgICBrZXlFdnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAga2V5RXZ0RGF0YS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAvLyBTdG9wIHRoZSBldmVudCBpbiB0aGUgS2V5c3Ryb2tlSGFuZGxlcjogbm8gbW9yZSBjYWxsYmFja3NcbiAgICAgICAgICAgICAgICAvLyB3aWxsIGJlIGV4ZWN1dGVkIGZvciB0aGlzIGtleXN0cm9rZS5cbiAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBNYXJrIHRoaXMga2V5c3Ryb2tlIGFzIGhhbmRsZWQgYnkgdGhlIGNhbGxiYWNrLiBTZWU6ICNwcmVzcy5cbiAgICAgICAgICAgIGV2dC5yZXR1cm4gPSB0cnVlO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRyaWdnZXJzIGEga2V5c3Ryb2tlIGhhbmRsZXIgZm9yIGEgc3BlY2lmaWVkIGtleSBjb21iaW5hdGlvbiwgaWYgc3VjaCBhIGtleXN0cm9rZSB3YXMge0BsaW5rICNzZXQgZGVmaW5lZH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBrZXlFdnREYXRhIEtleSBldmVudCBkYXRhLlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBrZXlzdHJva2Ugd2FzIGhhbmRsZWQuXG5cdCAqLyBwcmVzcyhrZXlFdnREYXRhKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuX2xpc3RlbmVyLmZpcmUoJ19rZXlkb3duOicgKyBnZXRDb2RlKGtleUV2dERhdGEpLCBrZXlFdnREYXRhKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0b3BzIGxpc3RlbmluZyB0byBga2V5ZG93bmAgZXZlbnRzIGZyb20gdGhlIGdpdmVuIGVtaXR0ZXIuXG5cdCAqLyBzdG9wTGlzdGVuaW5nKGVtaXR0ZXIpIHtcbiAgICAgICAgdGhpcy5fbGlzdGVuZXIuc3RvcExpc3RlbmluZyhlbWl0dGVyKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc3Ryb3lzIHRoZSBrZXlzdHJva2UgaGFuZGxlci5cblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9vYmplY3R0b21hcFxuICovIC8qKlxuICogVHJhbnNmb3JtcyBvYmplY3QgdG8gbWFwLlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBtYXAgPSBvYmplY3RUb01hcCggeyAnZm9vJzogMSwgJ2Jhcic6IDIgfSApO1xuICogbWFwLmdldCggJ2ZvbycgKTsgLy8gMVxuICogYGBgXG4gKlxuICogKipOb3RlKio6IEZvciBtaXhlZCBkYXRhIChgT2JqZWN0YCBvciBgSXRlcmFibGVgKSB0aGVyZSdzIGEgZGVkaWNhdGVkIHtAbGluayBtb2R1bGU6dXRpbHMvdG9tYXB+dG9NYXB9IGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSBvYmogT2JqZWN0IHRvIHRyYW5zZm9ybS5cbiAqIEByZXR1cm5zIE1hcCBjcmVhdGVkIGZyb20gb2JqZWN0LlxuICovIGZ1bmN0aW9uIG9iamVjdFRvTWFwKG9iaikge1xuICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcbiAgICBmb3IoY29uc3Qga2V5IGluIG9iail7XG4gICAgICAgIG1hcC5zZXQoa2V5LCBvYmpba2V5XSk7XG4gICAgfVxuICAgIHJldHVybiBtYXA7XG59XG5cbi8qKlxuICogVHJhbnNmb3JtcyBvYmplY3Qgb3IgaXRlcmFibGUgdG8gbWFwLiBJdGVyYWJsZSBuZWVkcyB0byBiZSBpbiB0aGUgZm9ybWF0IGFjY2VwdGFibGUgYnkgdGhlIGBNYXBgIGNvbnN0cnVjdG9yLlxuICpcbiAqIGBgYHRzXG4gKiBtYXAgPSB0b01hcCggeyAnZm9vJzogMSwgJ2Jhcic6IDIgfSApO1xuICogbWFwID0gdG9NYXAoIFsgWyAnZm9vJywgMSBdLCBbICdiYXInLCAyIF0gXSApO1xuICogbWFwID0gdG9NYXAoIGFub3RoZXJNYXAgKTtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBkYXRhIE9iamVjdCBvciBpdGVyYWJsZSB0byB0cmFuc2Zvcm0uXG4gKiBAcmV0dXJucyBNYXAgY3JlYXRlZCBmcm9tIGRhdGEuXG4gKi8gZnVuY3Rpb24gdG9NYXAoZGF0YSkge1xuICAgIGlmIChpc0l0ZXJhYmxlKGRhdGEpKSB7XG4gICAgICAgIHJldHVybiBuZXcgTWFwKGRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvYmplY3RUb01hcChkYXRhKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvd2FpdFxuICovIC8qKlxuICogUmV0dXJucyBhIHByb21pc2UgdGhhdCBpcyByZXNvbHZlZCBhZnRlciB0aGUgc3BlY2lmaWVkIHRpbWUuXG4gKlxuICogQHBhcmFtIHRpbWVvdXQgVGhlIHRpbWUgaW4gbWlsbGlzZWNvbmRzIHRvIHdhaXQuXG4gKiBAcGFyYW0gb3B0aW9ucy5zaWduYWwgQSBzaWduYWwgdG8gYWJvcnQgdGhlIHdhaXRpbmcuXG4gKi8gZnVuY3Rpb24gd2FpdCh0aW1lb3V0LCBvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk9PntcbiAgICAgICAgY29uc3Qgc2lnbmFsID0gb3B0aW9ucy5zaWduYWwgfHwgbmV3IEFib3J0Q29udHJvbGxlcigpLnNpZ25hbDtcbiAgICAgICAgc2lnbmFsLnRocm93SWZBYm9ydGVkKCk7XG4gICAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCh0aW1lb3V0SGFuZGxlciwgdGltZW91dCk7XG4gICAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGFib3J0SGFuZGxlciwge1xuICAgICAgICAgICAgb25jZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgZnVuY3Rpb24gdGltZW91dEhhbmRsZXIoKSB7XG4gICAgICAgICAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBhYm9ydEhhbmRsZXIpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGFib3J0SGFuZGxlcigpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICAgICAgICByZWplY3Qoc2lnbmFsLnJlYXNvbik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLyoqXG4gKiBUcmllcyBjYWxsaW5nIHRoZSBnaXZlbiBjYWxsYmFjayB1bnRpbCBpdCBzdWNlc3NmdWxseSByZXNvbHZlcy5cbiAqXG4gKiBJZiB0aGUgY2FsbGJhY2sgZmFpbHMgYG1heFJldHJpZXNgIHRpbWVzLCB0aGUgcmV0dXJuZWQgcHJvbWlzZSBpcyByZWplY3RlZCB3aXRoIHRoZSBsYXN0IGVycm9yLlxuICpcbiAqIEB0eXBlUGFyYW0gVFJlc3VsdCBUaGUgcmVzdWx0IG9mIGEgc3VjY2Vzc2Z1bCBjYWxsYmFjayBpbnZvY2F0aW9uLlxuICogQHBhcmFtIGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBjYWxsIHVudGlsIGl0IHN1Y2NlZWRzLlxuICogQHBhcmFtIG9wdGlvbnMubWF4UmV0cmllcyBNYXhpbXVtIG51bWJlciBvZiByZXRyaWVzLlxuICogQHBhcmFtIG9wdGlvbnMucmV0cnlEZWxheSBUaGUgdGltZSBpbiBtaWxsaXNlY29uZHMgYmV0d2VlbiBhdHRlbXB0cy4gQnkgZGVmYXVsdCBpdCBpbXBsZW1lbnRzIGV4cG9uZW50aWFsIGJhY2stb2ZmIHBvbGljeS5cbiAqIEBwYXJhbSBvcHRpb25zLnNpZ25hbCBUaGUgc2lnbmFsIHRvIGFib3J0IGZ1cnRoZXIgcmV0cmllcy4gVGhlIGNhbGxiYWNrIGl0c2VsZiBpcyBub3QgYWJvcnRlZCBhdXRvbWF0aWNhbGx5LlxuICovIGFzeW5jIGZ1bmN0aW9uIHJldHJ5KGNhbGxiYWNrLCBvcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB7IG1heEF0dGVtcHRzID0gNCwgcmV0cnlEZWxheSA9IGV4cG9uZW50aWFsRGVsYXkoKSwgc2lnbmFsID0gbmV3IEFib3J0Q29udHJvbGxlcigpLnNpZ25hbCB9ID0gb3B0aW9ucztcbiAgICBzaWduYWwudGhyb3dJZkFib3J0ZWQoKTtcbiAgICBmb3IobGV0IGF0dGVtcHQgPSAwOzsgYXR0ZW1wdCsrKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBjYWxsYmFjaygpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzTGFzdCA9IGF0dGVtcHQgKyAxID49IG1heEF0dGVtcHRzO1xuICAgICAgICAgICAgaWYgKGlzTGFzdCkge1xuICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB3YWl0KHJldHJ5RGVsYXkoYXR0ZW1wdCksIHtcbiAgICAgICAgICAgIHNpZ25hbFxuICAgICAgICB9KTtcbiAgICB9XG59XG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGNhbGN1bGF0ZXMgZXhwb25lbnRpYWwgYmFjay1vZmYgZGVsYXkuIFBhc3MgaXQgYXMgYG9wdGlvbnMucmV0cnlEZWxheWAgdG8ge0BsaW5rIH5yZXRyeX0uXG4gKlxuICogQHBhcmFtIG9wdGlvbnMuZGVsYXkgQmFzZSBkZWxheSBiZXR3ZWVuIGludm9jYXRpb25zLiBEZWZhdWx0cyB0byAxcy5cbiAqIEBwYXJhbSBvcHRpb25zLmZhY3RvciBIb3cgbXVjaCB0byBpbmNyZWFzZSB0aGUgZGVsYXkuIERlZmF1bHRzIHRvIDJ4LlxuICogQHBhcmFtIG9wdGlvbnMubWF4RGVsYXkgTWF4aW11bSB0aW1lb3V0LiBFdmVuIGlmIGhpZ2hlciB0aW1lb3V0IGlzIGNhbGN1bGF0ZWQsIGl0IGNhbm5vdCBnZXQgaGlnaGVyIHRoYW4gdGhpcyB2YWx1ZS4gRGVmYXVsdCB0byAxMHMuXG4gKiBAcmV0dXJucyBUaGUgZnVuY3Rpb24gY2FsY3VsYXRpbmcgdGhlIGRlbGF5LlxuICovIGZ1bmN0aW9uIGV4cG9uZW50aWFsRGVsYXkob3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgeyBkZWxheSA9IDEwMDAsIGZhY3RvciA9IDIsIG1heERlbGF5ID0gMTAwMDAgfSA9IG9wdGlvbnM7XG4gICAgcmV0dXJuIChhdHRlbXB0KT0+TWF0aC5taW4oZmFjdG9yICoqIGF0dGVtcHQgKiBkZWxheSwgbWF4RGVsYXkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL3NwbGljZWFycmF5XG4gKi8gLyoqXG4gKiBTcGxpY2VzIG9uZSBhcnJheSBpbnRvIGFub3RoZXIuIFRvIGJlIHVzZWQgaW5zdGVhZCBvZiBgQXJyYXkucHJvdG90eXBlLnNwbGljZWAgZm9yIGJldHRlclxuICogcGVyZm9ybWFuY2UgYW5kIGJlY2F1c2UgdGhlIGxhdHRlciBtYXkgdGhyb3cgXCJNYXhpbXVtIGNhbGwgc3RhY2sgc2l6ZSBleGNlZWRlZFwiIGVycm9yIHdoZW5cbiAqIHBhc3NpbmcgaHVnZSBudW1iZXIgb2YgaXRlbXMgdG8gaW5zZXJ0LlxuICpcbiAqIGBgYHRzXG4gKiBzcGxpY2VBcnJheSggWyAxLCAyIF0sIFsgMywgNCBdLCAwICk7XHQvLyBbIDMsIDQsIDEsIDIgXVxuICogc3BsaWNlQXJyYXkoIFsgMSwgMiBdLCBbIDMsIDQgXSwgMSApO1x0Ly8gWyAxLCAzLCA0LCAyIF1cbiAqIHNwbGljZUFycmF5KCBbIDEsIDIgXSwgWyAzLCA0IF0sIDIgKTtcdC8vIFsgMSwgMiwgMywgNCBdXG4gKiBzcGxpY2VBcnJheSggWyAxLCAyIF0sIFtdLCAgICAgICAwICk7XHQvLyBbIDEsIDIgXVxuICogYGBgXG4gKlxuICogQHBhcmFtIHRhcmdldCBBcnJheSB0byBiZSBzcGxpY2VkLlxuICogQHBhcmFtIHNvdXJjZSBBcnJheSBvZiBlbGVtZW50cyB0byBiZSBpbnNlcnRlZCB0byB0YXJnZXQuXG4gKiBAcGFyYW0gc3RhcnQgSW5kZXggYXQgd2hpY2ggbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkL3JlbW92ZWQuXG4gKiBAcGFyYW0gY291bnQgTnVtYmVyIG9mIGl0ZW1zLlxuICpcbiAqIEByZXR1cm5zIE5ldyBzcGxpY2VkIGFycmF5LlxuICovIGZ1bmN0aW9uIHNwbGljZUFycmF5KHRhcmdldEFycmF5LCBpbnNlcnRBcnJheSwgaW5kZXgpIHtcbiAgICBjb25zdCBvcmlnaW5hbExlbmd0aCA9IHRhcmdldEFycmF5Lmxlbmd0aDtcbiAgICBjb25zdCBpbnNlcnRMZW5ndGggPSBpbnNlcnRBcnJheS5sZW5ndGg7XG4gICAgLy8gU2hpZnQgZWxlbWVudHMgaW4gdGhlIHRhcmdldCBhcnJheSB0byBtYWtlIHNwYWNlIGZvciBpbnNlcnRBcnJheVxuICAgIGZvcihsZXQgaSA9IG9yaWdpbmFsTGVuZ3RoIC0gMTsgaSA+PSBpbmRleDsgaS0tKXtcbiAgICAgICAgdGFyZ2V0QXJyYXlbaSArIGluc2VydExlbmd0aF0gPSB0YXJnZXRBcnJheVtpXTtcbiAgICB9XG4gICAgLy8gQ29weSBlbGVtZW50cyBmcm9tIGluc2VydEFycmF5IGludG8gdGhlIHRhcmdldCBhcnJheVxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBpbnNlcnRMZW5ndGg7IGkrKyl7XG4gICAgICAgIHRhcmdldEFycmF5W2luZGV4ICsgaV0gPSBpbnNlcnRBcnJheVtpXTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgdXRpbHMvZGVsYXlcbiAqLyAvKiBnbG9iYWxzIHNldFRpbWVvdXQsIGNsZWFyVGltZW91dCAqLyAvKipcbiAqIFJldHVybnMgYSBmdW5jdGlvbiB3cmFwcGVyIHRoYXQgd2lsbCB0cmlnZ2VyIGEgZnVuY3Rpb24gYWZ0ZXIgYSBzcGVjaWZpZWQgd2FpdCB0aW1lLlxuICogVGhlIHRpbWVvdXQgY2FuIGJlIGNhbmNlbGVkIGJ5IGNhbGxpbmcgdGhlIGNhbmNlbCBmdW5jdGlvbiBvbiB0aGUgcmV0dXJuZWQgd3JhcHBlZCBmdW5jdGlvbi5cbiAqXG4gKiBAcGFyYW0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gd3JhcC5cbiAqIEBwYXJhbSB3YWl0IFRoZSB0aW1lb3V0IGluIG1zLlxuICovIGZ1bmN0aW9uIGRlbGF5KGZ1bmMsIHdhaXQpIHtcbiAgICBsZXQgdGltZXI7XG4gICAgZnVuY3Rpb24gZGVsYXllZCguLi5hcmdzKSB7XG4gICAgICAgIGRlbGF5ZWQuY2FuY2VsKCk7XG4gICAgICAgIHRpbWVyID0gc2V0VGltZW91dCgoKT0+ZnVuYyguLi5hcmdzKSwgd2FpdCk7XG4gICAgfVxuICAgIGRlbGF5ZWQuY2FuY2VsID0gKCk9PntcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICB9O1xuICAgIHJldHVybiBkZWxheWVkO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIHV0aWxzL3BhcnNlYmFzZTY0ZW5jb2RlZG9iamVjdFxuICovIC8qKlxuICogUGFyc2VzIGEgYmFzZTY0LWVuY29kZWQgb2JqZWN0IGFuZCByZXR1cm5zIHRoZSBkZWNvZGVkIG9iamVjdCwgb3IgbnVsbCBpZiB0aGUgZGVjb2Rpbmcgd2FzIHVuc3VjY2Vzc2Z1bC5cbiAqLyBmdW5jdGlvbiBwYXJzZUJhc2U2NEVuY29kZWRPYmplY3QoZW5jb2RlZCkge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghZW5jb2RlZC5zdGFydHNXaXRoKCdleScpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNvZGVkID0gYXRvYihlbmNvZGVkLnJlcGxhY2UoLy0vZywgJysnKS5yZXBsYWNlKC9fL2csICcvJykpO1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkZWNvZGVkKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9jcmMzMlxuICovIC8qKlxuICogR2VuZXJhdGVzIGEgQ1JDIGxvb2t1cCB0YWJsZS5cbiAqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhbmQgcmV0dXJucyBhIDI1Ni1lbGVtZW50IGFycmF5IG9mIHByZS1jb21wdXRlZCBDUkMgdmFsdWVzIGZvciBxdWljayBDUkMgY2FsY3VsYXRpb24uXG4gKiBJdCB1c2VzIHRoZSBwb2x5bm9taWFsIDB4RURCODgzMjAgdG8gY29tcHV0ZSBlYWNoIHZhbHVlIGluIHRoZSBsb29wLCBvcHRpbWl6aW5nIGZ1dHVyZSBDUkMgY2FsY3VsYXRpb25zLlxuICovIGZ1bmN0aW9uIG1ha2VDcmNUYWJsZSgpIHtcbiAgICBjb25zdCBjcmNUYWJsZSA9IFtdO1xuICAgIGZvcihsZXQgbiA9IDA7IG4gPCAyNTY7IG4rKyl7XG4gICAgICAgIGxldCBjID0gbjtcbiAgICAgICAgZm9yKGxldCBrID0gMDsgayA8IDg7IGsrKyl7XG4gICAgICAgICAgICBpZiAoYyAmIDEpIHtcbiAgICAgICAgICAgICAgICBjID0gMHhFREI4ODMyMCBeIGMgPj4+IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGMgPSBjID4+PiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNyY1RhYmxlW25dID0gYztcbiAgICB9XG4gICAgcmV0dXJuIGNyY1RhYmxlO1xufVxuLyoqXG4gKiBDYWxjdWxhdGVzIENSQy0zMiBjaGVja3N1bSBmb3IgYSBnaXZlbiBpbnB1dERhdGEgdG8gdmVyaWZ5IHRoZSBpbnRlZ3JpdHkgb2YgZGF0YS5cbiAqXG4gKiBAcGFyYW0gaW5wdXREYXRhIEFjY2VwdHMgYSBzaW5nbGUgdmFsdWUgKHN0cmluZywgbnVtYmVyLCBib29sZWFuKSwgYW4gYXJyYXkgb2Ygc3RyaW5ncywgb3IgYW4gYXJyYXkgb2YgYWxsIG9mIHRoZSBhYm92ZSB0eXBlcy5cbiAqIE5vbi1zdHJpbmcgdmFsdWVzIGFyZSBjb252ZXJ0ZWQgdG8gc3RyaW5ncyBiZWZvcmUgY2FsY3VsYXRpbmcgdGhlIGNoZWNrc3VtLlxuICogVGhlIGNoZWNrc3VtIGNhbGN1bGF0aW9uIGlzIGJhc2VkIG9uIHRoZSBjb25jYXRlbmF0ZWQgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBpbnB1dCB2YWx1ZXM6XG4gKiAqIGBjcmMzMignZm9vJylgIGlzIGVxdWl2YWxlbnQgdG8gYGNyYzMyKFsnZm9vJ10pYFxuICogKiBgY3JjMzIoMTIzKWAgaXMgZXF1aXZhbGVudCB0byBgY3JjMzIoWycxMjMnXSlgXG4gKiAqIGBjcmMzMih0cnVlKWAgaXMgZXF1aXZhbGVudCB0byBgY3JjMzIoWyd0cnVlJ10pYFxuICogKiBgY3JjMzIoWydmb28nLCAxMjMsIHRydWVdKWAgcHJvZHVjZXMgdGhlIHNhbWUgcmVzdWx0IGFzIGBjcmMzMignZm9vMTIzdHJ1ZScpYFxuICogKiBOZXN0ZWQgYXJyYXlzIG9mIHN0cmluZ3MgYXJlIGZsYXR0ZW5lZCwgc28gYGNyYzMyKFtbJ2ZvbycsICdiYXInXSwgJ2JheiddKWAgaXMgZXF1aXZhbGVudCB0byBgY3JjMzIoWydmb29iYXInLCAnYmF6J10pYFxuICpcbiAqIEByZXR1cm5zIFRoZSBDUkMtMzIgY2hlY2tzdW0sIHJldHVybmVkIGFzIGEgaGV4YWRlY2ltYWwgc3RyaW5nLlxuICovIGZ1bmN0aW9uIGNyYzMyKGlucHV0RGF0YSkge1xuICAgIGNvbnN0IGRhdGFBcnJheSA9IEFycmF5LmlzQXJyYXkoaW5wdXREYXRhKSA/IGlucHV0RGF0YSA6IFtcbiAgICAgICAgaW5wdXREYXRhXG4gICAgXTtcbiAgICBjb25zdCBjcmNUYWJsZSA9IG1ha2VDcmNUYWJsZSgpO1xuICAgIGxldCBjcmMgPSAwIF4gLTE7XG4gICAgLy8gQ29udmVydCBkYXRhIHRvIGEgc2luZ2xlIHN0cmluZy5cbiAgICBjb25zdCBkYXRhU3RyaW5nID0gZGF0YUFycmF5Lm1hcCgoaXRlbSk9PntcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmpvaW4oJycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTdHJpbmcoaXRlbSk7XG4gICAgfSkuam9pbignJyk7XG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBDUkMgZm9yIHRoZSByZXN1bHRpbmcgc3RyaW5nLlxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBkYXRhU3RyaW5nLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY29uc3QgYnl0ZSA9IGRhdGFTdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICAgICAgY3JjID0gY3JjID4+PiA4IF4gY3JjVGFibGVbKGNyYyBeIGJ5dGUpICYgMHhGRl07XG4gICAgfVxuICAgIGNyYyA9IChjcmMgXiAtMSkgPj4+IDA7IC8vIEZvcmNlIHVuc2lnbmVkIGludGVnZXIuXG4gICAgcmV0dXJuIGNyYy50b1N0cmluZygxNikucGFkU3RhcnQoOCwgJzAnKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSB1dGlscy9jb2xsZWN0c3R5bGVzaGVldHNcbiAqLyAvKipcbiAqIEEgaGVscGVyIGZ1bmN0aW9uIGZvciBnZXR0aW5nIGNvbmNhdGVuYXRlZCBDU1MgcnVsZXMgZnJvbSBleHRlcm5hbCBzdHlsZXNoZWV0cy5cbiAqXG4gKiBAcGFyYW0gc3R5bGVzaGVldHMgQW4gYXJyYXkgb2Ygc3R5bGVzaGVldCBwYXRocyBkZWxpdmVyZWQgYnkgdGhlIHVzZXIgdGhyb3VnaCB0aGUgcGx1Z2luIGNvbmZpZ3VyYXRpb24uXG4gKi8gYXN5bmMgZnVuY3Rpb24gY29sbGVjdFN0eWxlc2hlZXRzKHN0eWxlc2hlZXRzKSB7XG4gICAgaWYgKCFzdHlsZXNoZWV0cykge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChzdHlsZXNoZWV0cy5tYXAoYXN5bmMgKHN0eWxlc2hlZXQpPT57XG4gICAgICAgIGlmIChzdHlsZXNoZWV0ID09PSAnRURJVE9SX1NUWUxFUycpIHtcbiAgICAgICAgICAgIHJldHVybiBnZXRFZGl0b3JTdHlsZXMoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdpbmRvdy5mZXRjaChzdHlsZXNoZWV0KTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTtcbiAgICB9KSk7XG4gICAgcmV0dXJuIHJlc3VsdHMuam9pbignICcpLnRyaW0oKTtcbn1cbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIGdldHRpbmcgdGhlIGJhc2ljIGVkaXRvciBjb250ZW50IHN0eWxlcyBmb3IgdGhlIGAuY2stY29udGVudGAgY2xhc3NcbiAqIGFuZCBhbGwgQ1NTIHZhcmlhYmxlcyBkZWZpbmVkIGluIHRoZSBkb2N1bWVudC5cbiAqLyBmdW5jdGlvbiBnZXRFZGl0b3JTdHlsZXMoKSB7XG4gICAgY29uc3QgZWRpdG9yU3R5bGVzID0gW107XG4gICAgY29uc3QgZWRpdG9yQ1NTVmFyaWFibGVzID0gW107XG4gICAgZm9yIChjb25zdCBzdHlsZVNoZWV0IG9mIEFycmF5LmZyb20oZG9jdW1lbnQuc3R5bGVTaGVldHMpKXtcbiAgICAgICAgY29uc3Qgb3duZXJOb2RlID0gc3R5bGVTaGVldC5vd25lck5vZGU7XG4gICAgICAgIGlmIChvd25lck5vZGUuaGFzQXR0cmlidXRlKCdkYXRhLWNrZScpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgQXJyYXkuZnJvbShzdHlsZVNoZWV0LmNzc1J1bGVzKSl7XG4gICAgICAgICAgICAgICAgaWYgKHJ1bGUuY3NzVGV4dC5pbmRleE9mKCcuY2stY29udGVudCcpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdHlsZXMucHVzaChydWxlLmNzc1RleHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocnVsZS5jc3NUZXh0LmluZGV4T2YoJzpyb290JykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvckNTU1ZhcmlhYmxlcy5wdXNoKHJ1bGUuY3NzVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghZWRpdG9yU3R5bGVzLmxlbmd0aCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBlZGl0b3Igc3R5bGVzaGVldCBjb3VsZCBub3QgYmUgZm91bmQgaW4gdGhlIGRvY3VtZW50LiAnICsgJ0NoZWNrIHlvdXIgd2VicGFjayBjb25maWcgLSBzdHlsZS1sb2FkZXIgc2hvdWxkIHVzZSBkYXRhLWNrZT10cnVlIGF0dHJpYnV0ZSBmb3IgdGhlIGVkaXRvciBzdHlsZXNoZWV0LicpO1xuICAgIH1cbiAgICAvLyBXZSB3YW50IHRvIHRyaW0gdGhlIHJldHVybmVkIHZhbHVlIGluIGNhc2Ugb2YgYFsgXCJcIiwgXCJcIiwgLi4uIF1gLlxuICAgIHJldHVybiBbXG4gICAgICAgIC4uLmVkaXRvckNTU1ZhcmlhYmxlcyxcbiAgICAgICAgLi4uZWRpdG9yU3R5bGVzXG4gICAgXS5qb2luKCcgJykudHJpbSgpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBTZXQgb2YgdXRpbHMgdG8gaGFuZGxlIHVuaWNvZGUgY2hhcmFjdGVycy5cbiAqXG4gKiBAbW9kdWxlIHV0aWxzL3VuaWNvZGVcbiAqLyAvKipcbiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIGBjaGFyYWN0ZXJgIGlzIGEgY29tYmluaW5nIG1hcmsuXG4gKlxuICogQHBhcmFtIGNoYXJhY3RlciBDaGFyYWN0ZXIgdG8gY2hlY2suXG4gKi8gZnVuY3Rpb24gaXNDb21iaW5pbmdNYXJrKGNoYXJhY3Rlcikge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1taXNsZWFkaW5nLWNoYXJhY3Rlci1jbGFzc1xuICAgIHJldHVybiAhIWNoYXJhY3RlciAmJiBjaGFyYWN0ZXIubGVuZ3RoID09IDEgJiYgL1tcXHUwMzAwLVxcdTAzNmZcXHUxYWIwLVxcdTFhZmZcXHUxZGMwLVxcdTFkZmZcXHUyMGQwLVxcdTIwZmZcXHVmZTIwLVxcdWZlMmZdLy50ZXN0KGNoYXJhY3Rlcik7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIGBjaGFyYWN0ZXJgIGlzIGEgaGlnaCBoYWxmIG9mIHN1cnJvZ2F0ZSBwYWlyLlxuICpcbiAqIFVzaW5nIFVURi0xNiB0ZXJtaW5vbG9neSwgYSBzdXJyb2dhdGUgcGFpciBkZW5vdGVzIFVURi0xNiBjaGFyYWN0ZXIgdXNpbmcgdHdvIFVURi04IGNoYXJhY3RlcnMuIFRoZSBzdXJyb2dhdGUgcGFpclxuICogY29uc2lzdCBvZiBoaWdoIHN1cnJvZ2F0ZSBwYWlyIGNoYXJhY3RlciBmb2xsb3dlZCBieSBsb3cgc3Vycm9nYXRlIHBhaXIgY2hhcmFjdGVyLlxuICpcbiAqIEBwYXJhbSBjaGFyYWN0ZXIgQ2hhcmFjdGVyIHRvIGNoZWNrLlxuICovIGZ1bmN0aW9uIGlzSGlnaFN1cnJvZ2F0ZUhhbGYoY2hhcmFjdGVyKSB7XG4gICAgcmV0dXJuICEhY2hhcmFjdGVyICYmIGNoYXJhY3Rlci5sZW5ndGggPT0gMSAmJiAvW1xcdWQ4MDAtXFx1ZGJmZl0vLnRlc3QoY2hhcmFjdGVyKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gYGNoYXJhY3RlcmAgaXMgYSBsb3cgaGFsZiBvZiBzdXJyb2dhdGUgcGFpci5cbiAqXG4gKiBVc2luZyBVVEYtMTYgdGVybWlub2xvZ3ksIGEgc3Vycm9nYXRlIHBhaXIgZGVub3RlcyBVVEYtMTYgY2hhcmFjdGVyIHVzaW5nIHR3byBVVEYtOCBjaGFyYWN0ZXJzLiBUaGUgc3Vycm9nYXRlIHBhaXJcbiAqIGNvbnNpc3Qgb2YgaGlnaCBzdXJyb2dhdGUgcGFpciBjaGFyYWN0ZXIgZm9sbG93ZWQgYnkgbG93IHN1cnJvZ2F0ZSBwYWlyIGNoYXJhY3Rlci5cbiAqXG4gKiBAcGFyYW0gY2hhcmFjdGVyIENoYXJhY3RlciB0byBjaGVjay5cbiAqLyBmdW5jdGlvbiBpc0xvd1N1cnJvZ2F0ZUhhbGYoY2hhcmFjdGVyKSB7XG4gICAgcmV0dXJuICEhY2hhcmFjdGVyICYmIGNoYXJhY3Rlci5sZW5ndGggPT0gMSAmJiAvW1xcdWRjMDAtXFx1ZGZmZl0vLnRlc3QoY2hhcmFjdGVyKTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gb2Zmc2V0IGluIGEgc3RyaW5nIGlzIGluc2lkZSBhIHN1cnJvZ2F0ZSBwYWlyIChiZXR3ZWVuIHR3byBzdXJyb2dhdGUgaGFsdmVzKS5cbiAqXG4gKiBAcGFyYW0gc3RyaW5nIFN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IHRvIGNoZWNrLlxuICovIGZ1bmN0aW9uIGlzSW5zaWRlU3Vycm9nYXRlUGFpcihzdHJpbmcsIG9mZnNldCkge1xuICAgIHJldHVybiBpc0hpZ2hTdXJyb2dhdGVIYWxmKHN0cmluZy5jaGFyQXQob2Zmc2V0IC0gMSkpICYmIGlzTG93U3Vycm9nYXRlSGFsZihzdHJpbmcuY2hhckF0KG9mZnNldCkpO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBnaXZlbiBvZmZzZXQgaW4gYSBzdHJpbmcgaXMgYmV0d2VlbiBiYXNlIGNoYXJhY3RlciBhbmQgY29tYmluaW5nIG1hcmsgb3IgYmV0d2VlbiB0d28gY29tYmluaW5nIG1hcmtzLlxuICpcbiAqIEBwYXJhbSBzdHJpbmcgU3RyaW5nIHRvIGNoZWNrLlxuICogQHBhcmFtIG9mZnNldCBPZmZzZXQgdG8gY2hlY2suXG4gKi8gZnVuY3Rpb24gaXNJbnNpZGVDb21iaW5lZFN5bWJvbChzdHJpbmcsIG9mZnNldCkge1xuICAgIHJldHVybiBpc0NvbWJpbmluZ01hcmsoc3RyaW5nLmNoYXJBdChvZmZzZXQpKTtcbn1cbmNvbnN0IEVNT0pJX1BBVFRFUk4gPSAvKiAjX19QVVJFX18gKi8gYnVpbGRFbW9qaVJlZ2V4cCgpO1xuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBnaXZlbiBvZmZzZXQgaW4gYSBzdHJpbmcgaXMgaW5zaWRlIG11bHRpLWNoYXJhY3RlciBlbW9qaSBzZXF1ZW5jZS5cbiAqXG4gKiBAcGFyYW0gc3RyaW5nIFN0cmluZyB0byBjaGVjay5cbiAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IHRvIGNoZWNrLlxuICovIGZ1bmN0aW9uIGlzSW5zaWRlRW1vamlTZXF1ZW5jZShzdHJpbmcsIG9mZnNldCkge1xuICAgIGNvbnN0IG1hdGNoZXMgPSBTdHJpbmcoc3RyaW5nKS5tYXRjaEFsbChFTU9KSV9QQVRURVJOKTtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShtYXRjaGVzKS5zb21lKChtYXRjaCk9Pm1hdGNoLmluZGV4IDwgb2Zmc2V0ICYmIG9mZnNldCA8IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoKTtcbn1cbmZ1bmN0aW9uIGJ1aWxkRW1vamlSZWdleHAoKSB7XG4gICAgY29uc3QgcGFydHMgPSBbXG4gICAgICAgIC8vIEVtb2ppIFRhZyBTZXF1ZW5jZSAoRVRTKVxuICAgICAgICAvXFxwe0Vtb2ppfVtcXHV7RTAwMjB9LVxcdXtFMDA3RX1dK1xcdXtFMDA3Rn0vdSxcbiAgICAgICAgLy8gRW1vamkgS2V5Y2FwIFNlcXVlbmNlXG4gICAgICAgIC9cXHB7RW1vaml9XFx1e0ZFMEZ9P1xcdXsyMEUzfS91LFxuICAgICAgICAvLyBFbW9qaSBQcmVzZW50YXRpb24gU2VxdWVuY2VcbiAgICAgICAgL1xccHtFbW9qaX1cXHV7RkUwRn0vdSxcbiAgICAgICAgLy8gU2luZ2xlLUNoYXJhY3RlciBFbW9qaSAvIEVtb2ppIE1vZGlmaWVyIFNlcXVlbmNlXG4gICAgICAgIC8oPz1cXHB7R2VuZXJhbF9DYXRlZ29yeT1PdGhlcl9TeW1ib2x9KVxccHtFbW9qaX1cXHB7RW1vamlfTW9kaWZpZXJ9Ki91XG4gICAgXTtcbiAgICBjb25zdCBmbGFnU2VxdWVuY2UgPSAvXFxwe1JlZ2lvbmFsX0luZGljYXRvcn17Mn0vdS5zb3VyY2U7XG4gICAgY29uc3QgZW1vamkgPSAnKD86JyArIHBhcnRzLm1hcCgocGFydCk9PnBhcnQuc291cmNlKS5qb2luKCd8JykgKyAnKSc7XG4gICAgY29uc3Qgc2VxdWVuY2UgPSBgJHtmbGFnU2VxdWVuY2V9fCR7ZW1vaml9KD86XFx1ezIwMER9JHtlbW9qaX0pKmA7XG4gICAgcmV0dXJuIG5ldyBSZWdFeHAoc2VxdWVuY2UsICd1ZycpO1xufVxuXG5leHBvcnQgeyBDS0VkaXRvckVycm9yLCBDb2xsZWN0aW9uLCBDb25maWcsIERvbUVtaXR0ZXJNaXhpbiwgRWxlbWVudFJlcGxhY2VyLCBFbWl0dGVyTWl4aW4sIEV2ZW50SW5mbywgRm9jdXNUcmFja2VyLCBLZXlzdHJva2VIYW5kbGVyLCBMb2NhbGUsIE9ic2VydmFibGVNaXhpbiwgUmVjdCwgUmVzaXplT2JzZXJ2ZXIsIGFib3J0YWJsZURlYm91bmNlLCBhZGQsIGNvbGxlY3RTdHlsZXNoZWV0cywgY29tcGFyZUFycmF5cywgY291bnQsIGNyYzMyLCBjcmVhdGVFbGVtZW50LCBkZWxheSwgZGlmZiwgZGlmZlRvQ2hhbmdlcywgZW52LCBleHBvbmVudGlhbERlbGF5LCBmYXN0RGlmZiwgZmluZENsb3Nlc3RTY3JvbGxhYmxlQW5jZXN0b3IsIGZpcnN0LCBnZXRBbmNlc3RvcnMsIGdldEJvcmRlcldpZHRocywgZ2V0Q29kZSwgZ2V0RGF0YUZyb21FbGVtZW50LCBnZXRFbnZLZXlzdHJva2VUZXh0LCBnZXRMYW5ndWFnZURpcmVjdGlvbiwgZ2V0TG9jYWxpemVkQXJyb3dLZXlDb2RlRGlyZWN0aW9uLCBnZXRPcHRpbWFsUG9zaXRpb24sIGdldFJhbmdlRnJvbU1vdXNlRXZlbnQsIGdsb2JhbCwgaW5kZXhPZiwgaW5zZXJ0QXQsIGluc2VydFRvUHJpb3JpdHlBcnJheSwgaXNBcnJvd0tleUNvZGUsIGlzQ29tYmluaW5nTWFyaywgaXNDb21tZW50LCBpc0ZvcndhcmRBcnJvd0tleUNvZGUsIGlzSGlnaFN1cnJvZ2F0ZUhhbGYsIGlzSW5zaWRlQ29tYmluZWRTeW1ib2wsIGlzSW5zaWRlRW1vamlTZXF1ZW5jZSwgaXNJbnNpZGVTdXJyb2dhdGVQYWlyLCBpc0l0ZXJhYmxlLCBpc0xvd1N1cnJvZ2F0ZUhhbGYsIGlzTm9kZSwgaXNSYW5nZSwgaXNUZXh0LCBpc1ZhbGlkQXR0cmlidXRlTmFtZSwgaXNWaWV3V2l0aEZvY3VzVHJhY2tlciwgaXNWaXNpYmxlLCBrZXlDb2RlcywgbG9nRXJyb3IsIGxvZ1dhcm5pbmcsIG1peCwgcGFyc2VCYXNlNjRFbmNvZGVkT2JqZWN0LCBwYXJzZUtleXN0cm9rZSwgcHJpb3JpdGllcywgcmVsZWFzZURhdGUsIHJlbW92ZSwgcmV0cnksIHNjcm9sbEFuY2VzdG9yc1RvU2hvd1RhcmdldCwgc2Nyb2xsVmlld3BvcnRUb1Nob3dUYXJnZXQsIHNldERhdGFJbkVsZW1lbnQsIHNwbGljZUFycmF5LCB0b0FycmF5LCB0b01hcCwgdG9Vbml0LCB1aWQsIHZlcnNpb24sIHdhaXQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcFxuIiwiLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovXG5pbXBvcnQgeyBsb2dXYXJuaW5nLCBFbWl0dGVyTWl4aW4sIENLRWRpdG9yRXJyb3IsIGNvbXBhcmVBcnJheXMsIHRvQXJyYXksIHRvTWFwLCBpc0l0ZXJhYmxlLCBPYnNlcnZhYmxlTWl4aW4sIGNvdW50LCBFdmVudEluZm8sIENvbGxlY3Rpb24sIGtleUNvZGVzLCBpc1RleHQsIGVudiwgcmVtb3ZlIGFzIHJlbW92ZSQxLCBpbnNlcnRBdCwgZGlmZiwgZmFzdERpZmYsIGlzTm9kZSwgaXNDb21tZW50LCBpbmRleE9mLCBnbG9iYWwsIGlzVmFsaWRBdHRyaWJ1dGVOYW1lLCBmaXJzdCwgZ2V0QW5jZXN0b3JzLCBEb21FbWl0dGVyTWl4aW4sIGdldENvZGUsIGlzQXJyb3dLZXlDb2RlLCBzY3JvbGxWaWV3cG9ydFRvU2hvd1RhcmdldCwgdWlkLCBzcGxpY2VBcnJheSwgcHJpb3JpdGllcywgaXNJbnNpZGVTdXJyb2dhdGVQYWlyLCBpc0luc2lkZUNvbWJpbmVkU3ltYm9sLCBpc0luc2lkZUVtb2ppU2VxdWVuY2UgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgY2xvbmUsIGlzT2JqZWN0LCB1bnNldCwgZ2V0LCBtZXJnZSwgc2V0LCBpc1BsYWluT2JqZWN0LCBleHRlbmQsIGRlYm91bmNlLCBpc0VxdWFsV2l0aCwgY2xvbmVEZWVwLCBpc0VxdWFsIH0gZnJvbSAnbG9kYXNoLWVzJztcblxuLy8gRWFjaCBkb2N1bWVudCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgaXRzIHBsYWNlaG9sZGVyIGVsZW1lbnRzIGFuZCBjaGVjayBmdW5jdGlvbnMuXG5jb25zdCBkb2N1bWVudFBsYWNlaG9sZGVycyA9IG5ldyBXZWFrTWFwKCk7XG5sZXQgaGFzRGlzcGxheWVkUGxhY2Vob2xkZXJEZXByZWNhdGlvbldhcm5pbmcgPSBmYWxzZTtcbi8qKlxuICogQSBoZWxwZXIgdGhhdCBlbmFibGVzIGEgcGxhY2Vob2xkZXIgb24gdGhlIHByb3ZpZGVkIHZpZXcgZWxlbWVudCAoYWxzbyB1cGRhdGVzIGl0cyB2aXNpYmlsaXR5KS5cbiAqIFRoZSBwbGFjZWhvbGRlciBpcyBhIENTUyBwc2V1ZG/igJNlbGVtZW50ICh3aXRoIGEgdGV4dCBjb250ZW50KSBhdHRhY2hlZCB0byB0aGUgZWxlbWVudC5cbiAqXG4gKiBUbyBjaGFuZ2UgdGhlIHBsYWNlaG9sZGVyIHRleHQsIGNoYW5nZSB2YWx1ZSBvZiB0aGUgYHBsYWNlaG9sZGVyYCBwcm9wZXJ0eSBpbiB0aGUgcHJvdmlkZWQgYGVsZW1lbnRgLlxuICpcbiAqIFRvIGRpc2FibGUgdGhlIHBsYWNlaG9sZGVyLCB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wbGFjZWhvbGRlcn5kaXNhYmxlUGxhY2Vob2xkZXIgYGRpc2FibGVQbGFjZWhvbGRlcigpYH0gaGVscGVyLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBvZiB0aGUgcGxhY2Vob2xkZXIuXG4gKiBAcGFyYW0gb3B0aW9ucy52aWV3IEVkaXRpbmcgdmlldyBpbnN0YW5jZS5cbiAqIEBwYXJhbSBvcHRpb25zLmVsZW1lbnQgRWxlbWVudCB0aGF0IHdpbGwgZ2FpbiBhIHBsYWNlaG9sZGVyLiBTZWUgYG9wdGlvbnMuaXNEaXJlY3RIb3N0YCB0byBsZWFybiBtb3JlLlxuICogQHBhcmFtIG9wdGlvbnMuaXNEaXJlY3RIb3N0IElmIHNldCBgZmFsc2VgLCB0aGUgcGxhY2Vob2xkZXIgd2lsbCBub3QgYmUgZW5hYmxlZCBkaXJlY3RseVxuICogaW4gdGhlIHBhc3NlZCBgZWxlbWVudGAgYnV0IGluIG9uZSBvZiBpdHMgY2hpbGRyZW4gKHNlbGVjdGVkIGF1dG9tYXRpY2FsbHksIGkuZS4gYSBmaXJzdCBlbXB0eSBjaGlsZCBlbGVtZW50KS5cbiAqIFVzZWZ1bCB3aGVuIGF0dGFjaGluZyBwbGFjZWhvbGRlcnMgdG8gZWxlbWVudHMgdGhhdCBjYW4gaG9zdCBvdGhlciBlbGVtZW50cyAobm90IGp1c3QgdGV4dCksIGZvciBpbnN0YW5jZSxcbiAqIGVkaXRhYmxlIHJvb3QgZWxlbWVudHMuXG4gKiBAcGFyYW0gb3B0aW9ucy50ZXh0IFBsYWNlaG9sZGVyIHRleHQuIEl0J3MgKipkZXByZWNhdGVkKiogYW5kIHdpbGwgYmUgcmVtb3ZlZCBzb29uLiBVc2VcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcGxhY2Vob2xkZXJ+UGxhY2Vob2xkZXJhYmxlRWxlbWVudCNwbGFjZWhvbGRlciBgb3B0aW9ucy5lbGVtZW50LnBsYWNlaG9sZGVyYH0gaW5zdGVhZC5cbiAqIEBwYXJhbSBvcHRpb25zLmtlZXBPbkZvY3VzIElmIHNldCBgdHJ1ZWAsIHRoZSBwbGFjZWhvbGRlciBzdGF5IHZpc2libGUgd2hlbiB0aGUgaG9zdCBlbGVtZW50IGlzIGZvY3VzZWQuXG4gKi8gZnVuY3Rpb24gZW5hYmxlUGxhY2Vob2xkZXIoeyB2aWV3LCBlbGVtZW50LCB0ZXh0LCBpc0RpcmVjdEhvc3QgPSB0cnVlLCBrZWVwT25Gb2N1cyA9IGZhbHNlIH0pIHtcbiAgICBjb25zdCBkb2MgPSB2aWV3LmRvY3VtZW50O1xuICAgIC8vIFVzZSBhIHNpbmdsZSBwb3N0IGZpeGVyIHBlcuKAlGRvY3VtZW50IHRvIHVwZGF0ZSBhbGwgcGxhY2Vob2xkZXJzLlxuICAgIGlmICghZG9jdW1lbnRQbGFjZWhvbGRlcnMuaGFzKGRvYykpIHtcbiAgICAgICAgZG9jdW1lbnRQbGFjZWhvbGRlcnMuc2V0KGRvYywgbmV3IE1hcCgpKTtcbiAgICAgICAgLy8gSWYgYSBwb3N0LWZpeGVyIGNhbGxiYWNrIG1ha2VzIGEgY2hhbmdlLCBpdCBzaG91bGQgcmV0dXJuIGB0cnVlYCBzbyBvdGhlciBwb3N04oCTZml4ZXJzXG4gICAgICAgIC8vIGNhbiByZeKAk2V2YWx1YXRlIHRoZSBkb2N1bWVudCBhZ2Fpbi5cbiAgICAgICAgZG9jLnJlZ2lzdGVyUG9zdEZpeGVyKCh3cml0ZXIpPT51cGRhdGVEb2N1bWVudFBsYWNlaG9sZGVycyhkb2N1bWVudFBsYWNlaG9sZGVycy5nZXQoZG9jKSwgd3JpdGVyKSk7XG4gICAgICAgIC8vIFVwZGF0ZSBwbGFjZWhvbGRlcnMgb24gaXNDb21wb3Npbmcgc3RhdGUgY2hhbmdlIHNpbmNlIHJlbmRlcmluZyBpcyBkaXNhYmxlZCB3aGlsZSBpbiBjb21wb3NpdGlvbiBtb2RlLlxuICAgICAgICBkb2Mub24oJ2NoYW5nZTppc0NvbXBvc2luZycsICgpPT57XG4gICAgICAgICAgICB2aWV3LmNoYW5nZSgod3JpdGVyKT0+dXBkYXRlRG9jdW1lbnRQbGFjZWhvbGRlcnMoZG9jdW1lbnRQbGFjZWhvbGRlcnMuZ2V0KGRvYyksIHdyaXRlcikpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5pcygnZWRpdGFibGVFbGVtZW50JykpIHtcbiAgICAgICAgZWxlbWVudC5vbignY2hhbmdlOnBsYWNlaG9sZGVyJywgKGV2dEluZm8sIGV2dCwgdGV4dCk9PnNldFBsYWNlaG9sZGVyKHRleHQpKTtcbiAgICB9XG4gICAgaWYgKGVsZW1lbnQucGxhY2Vob2xkZXIpIHtcbiAgICAgICAgc2V0UGxhY2Vob2xkZXIoZWxlbWVudC5wbGFjZWhvbGRlcik7XG4gICAgfSBlbHNlIGlmICh0ZXh0KSB7XG4gICAgICAgIHNldFBsYWNlaG9sZGVyKHRleHQpO1xuICAgIH1cbiAgICBpZiAodGV4dCkge1xuICAgICAgICBzaG93UGxhY2Vob2xkZXJUZXh0RGVwcmVjYXRpb25XYXJuaW5nKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNldFBsYWNlaG9sZGVyKHRleHQpIHtcbiAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIGlzRGlyZWN0SG9zdCxcbiAgICAgICAgICAgIGtlZXBPbkZvY3VzLFxuICAgICAgICAgICAgaG9zdEVsZW1lbnQ6IGlzRGlyZWN0SG9zdCA/IGVsZW1lbnQgOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIC8vIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBlbGVtZW50IHBsYWNlaG9sZGVyIHVuZGVyIGl0cyBkb2N1bWVudC5cbiAgICAgICAgZG9jdW1lbnRQbGFjZWhvbGRlcnMuZ2V0KGRvYykuc2V0KGVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgcGxhY2Vob2xkZXJzIHJpZ2h0IGF3YXkuXG4gICAgICAgIHZpZXcuY2hhbmdlKCh3cml0ZXIpPT51cGRhdGVEb2N1bWVudFBsYWNlaG9sZGVycyhbXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBjb25maWdcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICBdLCB3cml0ZXIpKTtcbiAgICB9XG59XG4vKipcbiAqIERpc2FibGVzIHRoZSBwbGFjZWhvbGRlciBmdW5jdGlvbmFsaXR5IGZyb20gYSBnaXZlbiBlbGVtZW50LlxuICpcbiAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3BsYWNlaG9sZGVyfmVuYWJsZVBsYWNlaG9sZGVyIGBlbmFibGVQbGFjZWhvbGRlcigpYH0gdG8gbGVhcm4gbW9yZS5cbiAqLyBmdW5jdGlvbiBkaXNhYmxlUGxhY2Vob2xkZXIodmlldywgZWxlbWVudCkge1xuICAgIGNvbnN0IGRvYyA9IGVsZW1lbnQuZG9jdW1lbnQ7XG4gICAgaWYgKCFkb2N1bWVudFBsYWNlaG9sZGVycy5oYXMoZG9jKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZpZXcuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgIGNvbnN0IHBsYWNlaG9sZGVycyA9IGRvY3VtZW50UGxhY2Vob2xkZXJzLmdldChkb2MpO1xuICAgICAgICBjb25zdCBjb25maWcgPSBwbGFjZWhvbGRlcnMuZ2V0KGVsZW1lbnQpO1xuICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCdkYXRhLXBsYWNlaG9sZGVyJywgY29uZmlnLmhvc3RFbGVtZW50KTtcbiAgICAgICAgaGlkZVBsYWNlaG9sZGVyKHdyaXRlciwgY29uZmlnLmhvc3RFbGVtZW50KTtcbiAgICAgICAgcGxhY2Vob2xkZXJzLmRlbGV0ZShlbGVtZW50KTtcbiAgICB9KTtcbn1cbi8qKlxuICogU2hvd3MgYSBwbGFjZWhvbGRlciBpbiB0aGUgcHJvdmlkZWQgZWxlbWVudCBieSBjaGFuZ2luZyByZWxhdGVkIGF0dHJpYnV0ZXMgYW5kIENTUyBjbGFzc2VzLlxuICpcbiAqICoqTm90ZSoqOiBUaGlzIGhlbHBlciB3aWxsIG5vdCB1cGRhdGUgdGhlIHBsYWNlaG9sZGVyIHZpc2liaWxpdHkgbm9yIG1hbmFnZSB0aGVcbiAqIGl0IGluIGFueSB3YXkgaW4gdGhlIGZ1dHVyZS4gV2hhdCBpdCBkb2VzIGlzIGEgb25l4oCTdGltZSBzdGF0ZSBjaGFuZ2Ugb2YgYW4gZWxlbWVudC4gVXNlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3BsYWNlaG9sZGVyfmVuYWJsZVBsYWNlaG9sZGVyIGBlbmFibGVQbGFjZWhvbGRlcigpYH0gYW5kXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3BsYWNlaG9sZGVyfmRpc2FibGVQbGFjZWhvbGRlciBgZGlzYWJsZVBsYWNlaG9sZGVyKClgfSBmb3IgZnVsbFxuICogcGxhY2Vob2xkZXIgZnVuY3Rpb25hbGl0eS5cbiAqXG4gKiAqKk5vdGUqKjogVGhpcyBoZWxwZXIgd2lsbCBibGluZGx5IHNob3cgdGhlIHBsYWNlaG9sZGVyIGRpcmVjdGx5IGluIHRoZSByb290IGVkaXRhYmxlIGVsZW1lbnQgaWZcbiAqIG9uZSBpcyBwYXNzZWQsIHdoaWNoIGNvdWxkIHJlc3VsdCBpbiBhIHZpc3VhbCBjbGFzaCBpZiB0aGUgZWRpdGFibGUgZWxlbWVudCBoYXMgc29tZSBjaGlsZHJlblxuICogKGZvciBpbnN0YW5jZSwgYW4gZW1wdHkgcGFyYWdyYXBoKS4gVXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcGxhY2Vob2xkZXJ+ZW5hYmxlUGxhY2Vob2xkZXIgYGVuYWJsZVBsYWNlaG9sZGVyKClgfVxuICogaW4gdGhhdCBjYXNlIG9yIG1ha2Ugc3VyZSB0aGUgY29ycmVjdCBlbGVtZW50IGlzIHBhc3NlZCB0byB0aGUgaGVscGVyLlxuICpcbiAqIEByZXR1cm5zIGB0cnVlYCwgaWYgYW55IGNoYW5nZXMgd2VyZSBtYWRlIHRvIHRoZSBgZWxlbWVudGAuXG4gKi8gZnVuY3Rpb24gc2hvd1BsYWNlaG9sZGVyKHdyaXRlciwgZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudC5oYXNDbGFzcygnY2stcGxhY2Vob2xkZXInKSkge1xuICAgICAgICB3cml0ZXIuYWRkQ2xhc3MoJ2NrLXBsYWNlaG9sZGVyJywgZWxlbWVudCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIEhpZGVzIGEgcGxhY2Vob2xkZXIgaW4gdGhlIGVsZW1lbnQgYnkgY2hhbmdpbmcgcmVsYXRlZCBhdHRyaWJ1dGVzIGFuZCBDU1MgY2xhc3Nlcy5cbiAqXG4gKiAqKk5vdGUqKjogVGhpcyBoZWxwZXIgd2lsbCBub3QgdXBkYXRlIHRoZSBwbGFjZWhvbGRlciB2aXNpYmlsaXR5IG5vciBtYW5hZ2UgdGhlXG4gKiBpdCBpbiBhbnkgd2F5IGluIHRoZSBmdXR1cmUuIFdoYXQgaXQgZG9lcyBpcyBhIG9uZeKAk3RpbWUgc3RhdGUgY2hhbmdlIG9mIGFuIGVsZW1lbnQuIFVzZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wbGFjZWhvbGRlcn5lbmFibGVQbGFjZWhvbGRlciBgZW5hYmxlUGxhY2Vob2xkZXIoKWB9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wbGFjZWhvbGRlcn5kaXNhYmxlUGxhY2Vob2xkZXIgYGRpc2FibGVQbGFjZWhvbGRlcigpYH0gZm9yIGZ1bGxcbiAqIHBsYWNlaG9sZGVyIGZ1bmN0aW9uYWxpdHkuXG4gKlxuICogQHJldHVybnMgYHRydWVgLCBpZiBhbnkgY2hhbmdlcyB3ZXJlIG1hZGUgdG8gdGhlIGBlbGVtZW50YC5cbiAqLyBmdW5jdGlvbiBoaWRlUGxhY2Vob2xkZXIod3JpdGVyLCBlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQuaGFzQ2xhc3MoJ2NrLXBsYWNlaG9sZGVyJykpIHtcbiAgICAgICAgd3JpdGVyLnJlbW92ZUNsYXNzKCdjay1wbGFjZWhvbGRlcicsIGVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgYSBwbGFjZWhvbGRlciBzaG91bGQgYmUgZGlzcGxheWVkIGluIHRoZSBlbGVtZW50LlxuICpcbiAqICoqTm90ZSoqOiBUaGlzIGhlbHBlciB3aWxsIGJsaW5kbHkgY2hlY2sgdGhlIHBvc3NpYmlsaXR5IG9mIHNob3dpbmcgYSBwbGFjZWhvbGRlciBkaXJlY3RseSBpbiB0aGVcbiAqIHJvb3QgZWRpdGFibGUgZWxlbWVudCBpZiBvbmUgaXMgcGFzc2VkLCB3aGljaCBtYXkgbm90IGJlIHRoZSBleHBlY3RlZCByZXN1bHQuIElmIGFuIGVsZW1lbnQgY2FuXG4gKiBob3N0IG90aGVyIGVsZW1lbnRzIChub3QganVzdCB0ZXh0KSwgbW9zdCBsaWtlbHkgb25lIG9mIGl0cyBjaGlsZHJlbiBzaG91bGQgYmUgY2hlY2tlZCBpbnN0ZWFkXG4gKiBiZWNhdXNlIGl0IHdpbGwgYmUgdGhlIGZpbmFsIGhvc3QgZm9yIHRoZSBwbGFjZWhvbGRlci4gVXNlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3BsYWNlaG9sZGVyfmVuYWJsZVBsYWNlaG9sZGVyIGBlbmFibGVQbGFjZWhvbGRlcigpYH0gaW4gdGhhdCBjYXNlIG9yIG1ha2VcbiAqIHN1cmUgdGhlIGNvcnJlY3QgZWxlbWVudCBpcyBwYXNzZWQgdG8gdGhlIGhlbHBlci5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRoYXQgaG9sZHMgdGhlIHBsYWNlaG9sZGVyLlxuICogQHBhcmFtIGtlZXBPbkZvY3VzIEZvY3VzaW5nIHRoZSBlbGVtZW50IHdpbGwga2VlcCB0aGUgcGxhY2Vob2xkZXIgdmlzaWJsZS5cbiAqLyBmdW5jdGlvbiBuZWVkc1BsYWNlaG9sZGVyKGVsZW1lbnQsIGtlZXBPbkZvY3VzKSB7XG4gICAgaWYgKCFlbGVtZW50LmlzQXR0YWNoZWQoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChoYXNDb250ZW50KGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZG9jID0gZWxlbWVudC5kb2N1bWVudDtcbiAgICBjb25zdCB2aWV3U2VsZWN0aW9uID0gZG9jLnNlbGVjdGlvbjtcbiAgICBjb25zdCBzZWxlY3Rpb25BbmNob3IgPSB2aWV3U2VsZWN0aW9uLmFuY2hvcjtcbiAgICBpZiAoZG9jLmlzQ29tcG9zaW5nICYmIHNlbGVjdGlvbkFuY2hvciAmJiBzZWxlY3Rpb25BbmNob3IucGFyZW50ID09PSBlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gU2tpcCB0aGUgZm9jdXMgY2hlY2sgYW5kIG1ha2UgdGhlIHBsYWNlaG9sZGVyIHZpc2libGUgYWxyZWFkeSByZWdhcmRsZXNzIG9mIGRvY3VtZW50IGZvY3VzIHN0YXRlLlxuICAgIGlmIChrZWVwT25Gb2N1cykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLy8gSWYgdGhlIGRvY3VtZW50IGlzIGJsdXJyZWQuXG4gICAgaWYgKCFkb2MuaXNGb2N1c2VkKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBJZiBkb2N1bWVudCBpcyBmb2N1c2VkIGFuZCB0aGUgZWxlbWVudCBpcyBlbXB0eSBidXQgdGhlIHNlbGVjdGlvbiBpcyBub3QgYW5jaG9yZWQgaW5zaWRlIGl0LlxuICAgIHJldHVybiAhIXNlbGVjdGlvbkFuY2hvciAmJiBzZWxlY3Rpb25BbmNob3IucGFyZW50ICE9PSBlbGVtZW50O1xufVxuLyoqXG4gKiBBbnl0aGluZyBidXQgdWlFbGVtZW50KHMpIGNvdW50cyBhcyBjb250ZW50LlxuICovIGZ1bmN0aW9uIGhhc0NvbnRlbnQoZWxlbWVudCkge1xuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZWxlbWVudC5nZXRDaGlsZHJlbigpKXtcbiAgICAgICAgaWYgKCFjaGlsZC5pcygndWlFbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbi8qKlxuICogVXBkYXRlcyBhbGwgcGxhY2Vob2xkZXJzIGFzc29jaWF0ZWQgd2l0aCBhIGRvY3VtZW50IGluIGEgcG9zdOKAk2ZpeGVyIGNhbGxiYWNrLlxuICpcbiAqIEByZXR1cm5zIFRydWUgaWYgYW55IGNoYW5nZXMgd2VyZSBtYWRlIHRvIHRoZSB2aWV3IGRvY3VtZW50LlxuICovIGZ1bmN0aW9uIHVwZGF0ZURvY3VtZW50UGxhY2Vob2xkZXJzKHBsYWNlaG9sZGVycywgd3JpdGVyKSB7XG4gICAgY29uc3QgZGlyZWN0SG9zdEVsZW1lbnRzID0gW107XG4gICAgbGV0IHdhc1ZpZXdNb2RpZmllZCA9IGZhbHNlO1xuICAgIC8vIEZpcnN0IHNldCBwbGFjZWhvbGRlcnMgb24gdGhlIGRpcmVjdCBob3N0cy5cbiAgICBmb3IgKGNvbnN0IFtlbGVtZW50LCBjb25maWddIG9mIHBsYWNlaG9sZGVycyl7XG4gICAgICAgIGlmIChjb25maWcuaXNEaXJlY3RIb3N0KSB7XG4gICAgICAgICAgICBkaXJlY3RIb3N0RWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVQbGFjZWhvbGRlcih3cml0ZXIsIGVsZW1lbnQsIGNvbmZpZykpIHtcbiAgICAgICAgICAgICAgICB3YXNWaWV3TW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFRoZW4gc2V0IHBsYWNlaG9sZGVycyBvbiB0aGUgaW5kaXJlY3QgaG9zdHMgYnV0IG9ubHkgb24gdGhvc2UgdGhhdCBkb2VzIG5vdCBhbHJlYWR5IGhhdmUgYW4gZGlyZWN0IGhvc3QgcGxhY2Vob2xkZXIuXG4gICAgZm9yIChjb25zdCBbZWxlbWVudCwgY29uZmlnXSBvZiBwbGFjZWhvbGRlcnMpe1xuICAgICAgICBpZiAoY29uZmlnLmlzRGlyZWN0SG9zdCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG9zdEVsZW1lbnQgPSBnZXRDaGlsZFBsYWNlaG9sZGVySG9zdFN1YnN0aXR1dGUoZWxlbWVudCk7XG4gICAgICAgIC8vIFdoZW4gbm90IGEgZGlyZWN0IGhvc3QsIGl0IGNvdWxkIGhhcHBlbiB0aGF0IHRoZXJlIGlzIG5vIGNoaWxkIGVsZW1lbnRcbiAgICAgICAgLy8gY2FwYWJsZSBvZiBkaXNwbGF5aW5nIGEgcGxhY2Vob2xkZXIuXG4gICAgICAgIGlmICghaG9zdEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvbid0IG92ZXJyaWRlIHBsYWNlaG9sZGVyIGlmIHRoZSBob3N0IGVsZW1lbnQgYWxyZWFkeSBoYXMgc29tZSBkaXJlY3QgcGxhY2Vob2xkZXIuXG4gICAgICAgIGlmIChkaXJlY3RIb3N0RWxlbWVudHMuaW5jbHVkZXMoaG9zdEVsZW1lbnQpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBVcGRhdGUgdGhlIGhvc3QgZWxlbWVudCAodXNlZCBmb3Igc2V0dGluZyBhbmQgcmVtb3ZpbmcgdGhlIHBsYWNlaG9sZGVyKS5cbiAgICAgICAgY29uZmlnLmhvc3RFbGVtZW50ID0gaG9zdEVsZW1lbnQ7XG4gICAgICAgIGlmICh1cGRhdGVQbGFjZWhvbGRlcih3cml0ZXIsIGVsZW1lbnQsIGNvbmZpZykpIHtcbiAgICAgICAgICAgIHdhc1ZpZXdNb2RpZmllZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHdhc1ZpZXdNb2RpZmllZDtcbn1cbi8qKlxuICogVXBkYXRlcyBhIHNpbmdsZSBwbGFjZWhvbGRlciBpbiBhIHBvc3TigJNmaXhlciBjYWxsYmFjay5cbiAqXG4gKiBAcmV0dXJucyBUcnVlIGlmIGFueSBjaGFuZ2VzIHdlcmUgbWFkZSB0byB0aGUgdmlldyBkb2N1bWVudC5cbiAqLyBmdW5jdGlvbiB1cGRhdGVQbGFjZWhvbGRlcih3cml0ZXIsIGVsZW1lbnQsIGNvbmZpZykge1xuICAgIGNvbnN0IHsgdGV4dCwgaXNEaXJlY3RIb3N0LCBob3N0RWxlbWVudCB9ID0gY29uZmlnO1xuICAgIGxldCB3YXNWaWV3TW9kaWZpZWQgPSBmYWxzZTtcbiAgICAvLyBUaGlzIG1heSBiZSBuZWNlc3Nhcnkgd2hlbiB1cGRhdGluZyB0aGUgcGxhY2Vob2xkZXIgdGV4dCB0byBzb21ldGhpbmcgZWxzZS5cbiAgICBpZiAoaG9zdEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXBsYWNlaG9sZGVyJykgIT09IHRleHQpIHtcbiAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnZGF0YS1wbGFjZWhvbGRlcicsIHRleHQsIGhvc3RFbGVtZW50KTtcbiAgICAgICAgd2FzVmlld01vZGlmaWVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gSWYgdGhlIGhvc3QgZWxlbWVudCBpcyBub3QgYSBkaXJlY3QgaG9zdCB0aGVuIHBsYWNlaG9sZGVyIGlzIG5lZWRlZCBvbmx5IHdoZW4gdGhlcmUgaXMgb25seSBvbmUgZWxlbWVudC5cbiAgICBjb25zdCBpc09ubHlDaGlsZCA9IGlzRGlyZWN0SG9zdCB8fCBlbGVtZW50LmNoaWxkQ291bnQgPT0gMTtcbiAgICBpZiAoaXNPbmx5Q2hpbGQgJiYgbmVlZHNQbGFjZWhvbGRlcihob3N0RWxlbWVudCwgY29uZmlnLmtlZXBPbkZvY3VzKSkge1xuICAgICAgICBpZiAoc2hvd1BsYWNlaG9sZGVyKHdyaXRlciwgaG9zdEVsZW1lbnQpKSB7XG4gICAgICAgICAgICB3YXNWaWV3TW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChoaWRlUGxhY2Vob2xkZXIod3JpdGVyLCBob3N0RWxlbWVudCkpIHtcbiAgICAgICAgd2FzVmlld01vZGlmaWVkID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHdhc1ZpZXdNb2RpZmllZDtcbn1cbi8qKlxuICogR2V0cyBhIGNoaWxkIGVsZW1lbnQgY2FwYWJsZSBvZiBkaXNwbGF5aW5nIGEgcGxhY2Vob2xkZXIgaWYgYSBwYXJlbnQgZWxlbWVudCBjYW4gaG9zdCBtb3JlXG4gKiB0aGFuIGp1c3QgdGV4dCAoZm9yIGluc3RhbmNlLCB3aGVuIGl0IGlzIGEgcm9vdCBlZGl0YWJsZSBlbGVtZW50KS4gVGhlIGNoaWxkIGVsZW1lbnRcbiAqIGNhbiB0aGVuIGJlIHVzZWQgaW4gb3RoZXIgcGxhY2Vob2xkZXIgaGVscGVycyBhcyBhIHN1YnN0aXR1dGUgb2YgaXRzIHBhcmVudC5cbiAqLyBmdW5jdGlvbiBnZXRDaGlsZFBsYWNlaG9sZGVySG9zdFN1YnN0aXR1dGUocGFyZW50KSB7XG4gICAgaWYgKHBhcmVudC5jaGlsZENvdW50KSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Q2hpbGQgPSBwYXJlbnQuZ2V0Q2hpbGQoMCk7XG4gICAgICAgIGlmIChmaXJzdENoaWxkLmlzKCdlbGVtZW50JykgJiYgIWZpcnN0Q2hpbGQuaXMoJ3VpRWxlbWVudCcpICYmICFmaXJzdENoaWxkLmlzKCdhdHRyaWJ1dGVFbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBmaXJzdENoaWxkO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBEaXNwbGF5cyBhIGRlcHJlY2F0aW9uIHdhcm5pbmcgbWVzc2FnZSBpbiB0aGUgY29uc29sZSwgYnV0IG9ubHkgb25jZSBwZXIgcGFnZSBsb2FkLlxuICovIGZ1bmN0aW9uIHNob3dQbGFjZWhvbGRlclRleHREZXByZWNhdGlvbldhcm5pbmcoKSB7XG4gICAgaWYgKCFoYXNEaXNwbGF5ZWRQbGFjZWhvbGRlckRlcHJlY2F0aW9uV2FybmluZykge1xuICAgICAgICAvKipcblx0XHQgKiBUaGUgXCJ0ZXh0XCIgb3B0aW9uIGluIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3BsYWNlaG9sZGVyfmVuYWJsZVBsYWNlaG9sZGVyIGBlbmFibGVQbGFjZWhvbGRlcigpYH1cblx0XHQgKiBmdW5jdGlvbiBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgc29vbi5cblx0XHQgKlxuXHRcdCAqIFNlZSB0aGUge0BnbGluayB1cGRhdGluZy9ndWlkZXMvdXBkYXRlLXRvLTM5I3ZpZXctZWxlbWVudC1wbGFjZWhvbGRlciBNaWdyYXRpb24gdG8gdjM5fSBndWlkZSBmb3Jcblx0XHQgKiBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0byBhcHBseSB0aGlzIGNoYW5nZS5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBlbmFibGVwbGFjZWhvbGRlci1kZXByZWNhdGVkLXRleHQtb3B0aW9uXG5cdFx0ICovIGxvZ1dhcm5pbmcoJ2VuYWJsZXBsYWNlaG9sZGVyLWRlcHJlY2F0ZWQtdGV4dC1vcHRpb24nKTtcbiAgICB9XG4gICAgaGFzRGlzcGxheWVkUGxhY2Vob2xkZXJEZXByZWNhdGlvbldhcm5pbmcgPSB0cnVlO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIGVuZ2luZS92aWV3L3R5cGVjaGVja2FibGVcbiAqLyBsZXQgVHlwZUNoZWNrYWJsZSQxID0gY2xhc3MgVHlwZUNoZWNrYWJsZSB7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgLS0gQHByZXNlcnZlICovIGlzKCkge1xuICAgICAgICAvLyBUaGVyZSBhcmUgYSBsb3Qgb2Ygb3ZlcmxvYWRzIGFib3ZlLlxuICAgICAgICAvLyBPdmVycmlkaW5nIG1ldGhvZCBpbiBkZXJpdmVkIGNsYXNzZXMgcmVtb3ZlIHRoZW0gYW5kIG9ubHkgYGlzKCB0eXBlOiBzdHJpbmcgKTogYm9vbGVhbmAgaXMgdmlzaWJsZSB3aGljaCB3ZSBkb24ndCB3YW50LlxuICAgICAgICAvLyBPbmUgb3B0aW9uIHdvdWxkIGJlIHRvIGNvcHkgdGhlbSBhbGwgdG8gYWxsIGNsYXNzZXMsIGJ1dCB0aGF0J3MgdWdseS5cbiAgICAgICAgLy8gSXQncyBiZXN0IHdoZW4gVHlwZVNjcmlwdCBjb21waWxlciBkb2Vzbid0IHNlZSB0aG9zZSBvdmVybG9hZHMsIGV4Y2VwdCB0aGUgb25lIGluIHRoZSB0b3AgYmFzZSBjbGFzcy5cbiAgICAgICAgLy8gVG8gb3ZlcmxvYWQgYSBtZXRob2QsIGJ1dCBub3QgbGV0IHRoZSBjb21waWxlciBzZWUgaXQsIGRvIGFmdGVyIGNsYXNzIGRlZmluaXRpb246XG4gICAgICAgIC8vIGBNeUNsYXNzLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKCB0eXBlOiBzdHJpbmcgKSB7Li4ufWBcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpcygpIG1ldGhvZCBpcyBhYnN0cmFjdCcpO1xuICAgIH1cbn07XG5cbi8qKlxuICogQWJzdHJhY3QgdmlldyBub2RlIGNsYXNzLlxuICpcbiAqIFRoaXMgaXMgYW4gYWJzdHJhY3QgY2xhc3MuIEl0cyBjb25zdHJ1Y3RvciBzaG91bGQgbm90IGJlIHVzZWQgZGlyZWN0bHkuXG4gKiBVc2UgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdXBjYXN0d3JpdGVyflVwY2FzdFdyaXRlcn1cbiAqIHRvIGNyZWF0ZSBuZXcgaW5zdGFuY2VzIG9mIHZpZXcgbm9kZXMuXG4gKi8gbGV0IE5vZGUkMiA9IGNsYXNzIE5vZGUgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKFR5cGVDaGVja2FibGUkMSkge1xuICAgIC8qKlxuXHQgKiBUaGUgZG9jdW1lbnQgaW5zdGFuY2UgdG8gd2hpY2ggdGhpcyBub2RlIGJlbG9uZ3MuXG5cdCAqLyBkb2N1bWVudDtcbiAgICAvKipcblx0ICogUGFyZW50IGVsZW1lbnQuIE51bGwgYnkgZGVmYXVsdC4gU2V0IGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19pbnNlcnRDaGlsZH0uXG5cdCAqLyBwYXJlbnQ7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB0cmVlIHZpZXcgbm9kZS5cblx0ICpcblx0ICogQHBhcmFtIGRvY3VtZW50IFRoZSBkb2N1bWVudCBpbnN0YW5jZSB0byB3aGljaCB0aGlzIG5vZGUgYmVsb25ncy5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50KXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5kb2N1bWVudCA9IGRvY3VtZW50O1xuICAgICAgICB0aGlzLnBhcmVudCA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbmRleCBvZiB0aGUgbm9kZSBpbiB0aGUgcGFyZW50IGVsZW1lbnQgb3IgbnVsbCBpZiB0aGUgbm9kZSBoYXMgbm8gcGFyZW50LlxuXHQgKlxuXHQgKiBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSB0aHJvd3MgYW4gZXJyb3IgaWYgdGhpcyBub2RlJ3MgcGFyZW50IGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdC5cblx0ICogVGhpcyBtZWFucyB0aGF0IHZpZXcgdHJlZSBnb3QgYnJva2VuLlxuXHQgKi8gZ2V0IGluZGV4KCkge1xuICAgICAgICBsZXQgcG9zO1xuICAgICAgICBpZiAoIXRoaXMucGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBObyBwYXJlbnQgb3IgY2hpbGQgZG9lc24ndCBleGlzdCBpbiBwYXJlbnQncyBjaGlsZHJlbi5cbiAgICAgICAgaWYgKChwb3MgPSB0aGlzLnBhcmVudC5nZXRDaGlsZEluZGV4KHRoaXMpKSA9PSAtMSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgbm9kZSdzIHBhcmVudCBkb2VzIG5vdCBjb250YWluIHRoaXMgbm9kZS4gSXQgbWVhbnMgdGhhdCB0aGUgZG9jdW1lbnQgdHJlZSBpcyBjb3JydXB0ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctbm9kZS1ub3QtZm91bmQtaW4tcGFyZW50XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctbm9kZS1ub3QtZm91bmQtaW4tcGFyZW50JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIE5vZGUncyBuZXh0IHNpYmxpbmcsIG9yIGBudWxsYCBpZiBpdCBpcyB0aGUgbGFzdCBjaGlsZC5cblx0ICovIGdldCBuZXh0U2libGluZygpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmluZGV4O1xuICAgICAgICByZXR1cm4gaW5kZXggIT09IG51bGwgJiYgdGhpcy5wYXJlbnQuZ2V0Q2hpbGQoaW5kZXggKyAxKSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogTm9kZSdzIHByZXZpb3VzIHNpYmxpbmcsIG9yIGBudWxsYCBpZiBpdCBpcyB0aGUgZmlyc3QgY2hpbGQuXG5cdCAqLyBnZXQgcHJldmlvdXNTaWJsaW5nKCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgICAgIHJldHVybiBpbmRleCAhPT0gbnVsbCAmJiB0aGlzLnBhcmVudC5nZXRDaGlsZChpbmRleCAtIDEpIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUb3AtbW9zdCBhbmNlc3RvciBvZiB0aGUgbm9kZS4gSWYgdGhlIG5vZGUgaGFzIG5vIHBhcmVudCBpdCBpcyB0aGUgcm9vdCBpdHNlbGYuXG5cdCAqLyBnZXQgcm9vdCgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzLCBjb25zaXN0ZW50LXRoaXNcbiAgICAgICAgbGV0IHJvb3QgPSB0aGlzO1xuICAgICAgICB3aGlsZShyb290LnBhcmVudCl7XG4gICAgICAgICAgICByb290ID0gcm9vdC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgdGhlIG5vZGUgaXMgaW4gYSB0cmVlIHJvb3RlZCBpbiB0aGUgZG9jdW1lbnQgKGlzIGEgZGVzY2VuZGFudCBvZiBvbmUgb2YgaXRzIHJvb3RzKS5cblx0ICovIGlzQXR0YWNoZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QuaXMoJ3Jvb3RFbGVtZW50Jyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGEgcGF0aCB0byB0aGUgbm9kZS4gVGhlIHBhdGggaXMgYW4gYXJyYXkgY29udGFpbmluZyBpbmRpY2VzIG9mIGNvbnNlY3V0aXZlIGFuY2VzdG9ycyBvZiB0aGlzIG5vZGUsXG5cdCAqIGJlZ2lubmluZyBmcm9tIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI3Jvb3Qgcm9vdH0sIGRvd24gdG8gdGhpcyBub2RlJ3MgaW5kZXguXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IGFiYyA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVRleHQoICdhYmMnICk7XG5cdCAqIGNvbnN0IGZvbyA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVRleHQoICdmb28nICk7XG5cdCAqIGNvbnN0IGgxID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ2gxJywgbnVsbCwgZG93bmNhc3RXcml0ZXIuY3JlYXRlVGV4dCggJ2hlYWRlcicgKSApO1xuXHQgKiBjb25zdCBwID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ3AnLCBudWxsLCBbIGFiYywgZm9vIF0gKTtcblx0ICogY29uc3QgZGl2ID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ2RpdicsIG51bGwsIFsgaDEsIHAgXSApO1xuXHQgKiBmb28uZ2V0UGF0aCgpOyAvLyBSZXR1cm5zIFsgMSwgMyBdLiBgZm9vYCBpcyBpbiBgcGAgd2hpY2ggaXMgaW4gYGRpdmAuIGBwYCBzdGFydHMgYXQgb2Zmc2V0IDEsIHdoaWxlIGBmb29gIGF0IDMuXG5cdCAqIGgxLmdldFBhdGgoKTsgLy8gUmV0dXJucyBbIDAgXS5cblx0ICogZGl2LmdldFBhdGgoKTsgLy8gUmV0dXJucyBbXS5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEByZXR1cm5zIFRoZSBwYXRoLlxuXHQgKi8gZ2V0UGF0aCgpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IFtdO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXRoaXMtYWxpYXMsIGNvbnNpc3RlbnQtdGhpc1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXM7XG4gICAgICAgIHdoaWxlKG5vZGUucGFyZW50KXtcbiAgICAgICAgICAgIHBhdGgudW5zaGlmdChub2RlLmluZGV4KTtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGF0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW5jZXN0b3JzIGFycmF5IG9mIHRoaXMgbm9kZS5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBvYmplY3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmluY2x1ZGVTZWxmIFdoZW4gc2V0IHRvIGB0cnVlYCB0aGlzIG5vZGUgd2lsbCBiZSBhbHNvIGluY2x1ZGVkIGluIHBhcmVudCdzIGFycmF5LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5wYXJlbnRGaXJzdCBXaGVuIHNldCB0byBgdHJ1ZWAsIGFycmF5IHdpbGwgYmUgc29ydGVkIGZyb20gbm9kZSdzIHBhcmVudCB0byByb290IGVsZW1lbnQsXG5cdCAqIG90aGVyd2lzZSByb290IGVsZW1lbnQgd2lsbCBiZSB0aGUgZmlyc3QgaXRlbSBpbiB0aGUgYXJyYXkuXG5cdCAqIEByZXR1cm5zIEFycmF5IHdpdGggYW5jZXN0b3JzLlxuXHQgKi8gZ2V0QW5jZXN0b3JzKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBhbmNlc3RvcnMgPSBbXTtcbiAgICAgICAgbGV0IHBhcmVudCA9IG9wdGlvbnMuaW5jbHVkZVNlbGYgPyB0aGlzIDogdGhpcy5wYXJlbnQ7XG4gICAgICAgIHdoaWxlKHBhcmVudCl7XG4gICAgICAgICAgICBhbmNlc3RvcnNbb3B0aW9ucy5wYXJlbnRGaXJzdCA/ICdwdXNoJyA6ICd1bnNoaWZ0J10ocGFyZW50KTtcbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFuY2VzdG9ycztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9XG5cdCAqIHdoaWNoIGlzIGEgY29tbW9uIGFuY2VzdG9yIG9mIGJvdGggbm9kZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIFRoZSBzZWNvbmQgbm9kZS5cblx0ICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBvYmplY3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmluY2x1ZGVTZWxmIFdoZW4gc2V0IHRvIGB0cnVlYCBib3RoIG5vZGVzIHdpbGwgYmUgY29uc2lkZXJlZCBcImFuY2VzdG9yc1wiIHRvby5cblx0ICogV2hpY2ggbWVhbnMgdGhhdCBpZiBlLmcuIG5vZGUgQSBpcyBpbnNpZGUgQiwgdGhlbiB0aGVpciBjb21tb24gYW5jZXN0b3Igd2lsbCBiZSBCLlxuXHQgKi8gZ2V0Q29tbW9uQW5jZXN0b3Iobm9kZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9yc0EgPSB0aGlzLmdldEFuY2VzdG9ycyhvcHRpb25zKTtcbiAgICAgICAgY29uc3QgYW5jZXN0b3JzQiA9IG5vZGUuZ2V0QW5jZXN0b3JzKG9wdGlvbnMpO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHdoaWxlKGFuY2VzdG9yc0FbaV0gPT0gYW5jZXN0b3JzQltpXSAmJiBhbmNlc3RvcnNBW2ldKXtcbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaSA9PT0gMCA/IG51bGwgOiBhbmNlc3RvcnNBW2kgLSAxXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgd2hldGhlciB0aGlzIG5vZGUgaXMgYmVmb3JlIGdpdmVuIG5vZGUuIGBmYWxzZWAgaXMgcmV0dXJuZWQgaWYgbm9kZXMgYXJlIGluIGRpZmZlcmVudCB0cmVlcyAoZm9yIGV4YW1wbGUsXG5cdCAqIGluIGRpZmZlcmVudCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH1zKS5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgTm9kZSB0byBjb21wYXJlIHdpdGguXG5cdCAqLyBpc0JlZm9yZShub2RlKSB7XG4gICAgICAgIC8vIEdpdmVuIG5vZGUgaXMgbm90IGJlZm9yZSB0aGlzIG5vZGUgaWYgdGhleSBhcmUgc2FtZS5cbiAgICAgICAgaWYgKHRoaXMgPT0gbm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJldHVybiBgZmFsc2VgIGlmIGl0IGlzIGltcG9zc2libGUgdG8gY29tcGFyZSBub2Rlcy5cbiAgICAgICAgaWYgKHRoaXMucm9vdCAhPT0gbm9kZS5yb290KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGhpc1BhdGggPSB0aGlzLmdldFBhdGgoKTtcbiAgICAgICAgY29uc3Qgbm9kZVBhdGggPSBub2RlLmdldFBhdGgoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyZUFycmF5cyh0aGlzUGF0aCwgbm9kZVBhdGgpO1xuICAgICAgICBzd2l0Y2gocmVzdWx0KXtcbiAgICAgICAgICAgIGNhc2UgJ3ByZWZpeCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICBjYXNlICdleHRlbnNpb24nOlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNQYXRoW3Jlc3VsdF0gPCBub2RlUGF0aFtyZXN1bHRdO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBub2RlIGlzIGFmdGVyIGdpdmVuIG5vZGUuIGBmYWxzZWAgaXMgcmV0dXJuZWQgaWYgbm9kZXMgYXJlIGluIGRpZmZlcmVudCB0cmVlcyAoZm9yIGV4YW1wbGUsXG5cdCAqIGluIGRpZmZlcmVudCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH1zKS5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgTm9kZSB0byBjb21wYXJlIHdpdGguXG5cdCAqLyBpc0FmdGVyKG5vZGUpIHtcbiAgICAgICAgLy8gR2l2ZW4gbm9kZSBpcyBub3QgYmVmb3JlIHRoaXMgbm9kZSBpZiB0aGV5IGFyZSBzYW1lLlxuICAgICAgICBpZiAodGhpcyA9PSBub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIGBmYWxzZWAgaWYgaXQgaXMgaW1wb3NzaWJsZSB0byBjb21wYXJlIG5vZGVzLlxuICAgICAgICBpZiAodGhpcy5yb290ICE9PSBub2RlLnJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbiBvdGhlciBjYXNlcywganVzdCBjaGVjayBpZiB0aGUgYG5vZGVgIGlzIGJlZm9yZSwgYW5kIHJldHVybiB0aGUgb3Bwb3NpdGUuXG4gICAgICAgIHJldHVybiAhdGhpcy5pc0JlZm9yZShub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgbm9kZSBmcm9tIHBhcmVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfcmVtb3ZlKCkge1xuICAgICAgICB0aGlzLnBhcmVudC5fcmVtb3ZlQ2hpbGRyZW4odGhpcy5pbmRleCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHR5cGUgVHlwZSBvZiB0aGUgY2hhbmdlLlxuXHQgKiBAcGFyYW0gbm9kZSBDaGFuZ2VkIG5vZGUuXG5cdCAqIEBwYXJhbSBkYXRhIEFkZGl0aW9uYWwgZGF0YS5cblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKi8gX2ZpcmVDaGFuZ2UodHlwZSwgbm9kZSwgZGF0YSkge1xuICAgICAgICB0aGlzLmZpcmUoYGNoYW5nZToke3R5cGV9YCwgbm9kZSwgZGF0YSk7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQuX2ZpcmVDaGFuZ2UodHlwZSwgbm9kZSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEN1c3RvbSB0b0pTT04gbWV0aG9kIHRvIHNvbHZlIGNoaWxkLXBhcmVudCBjaXJjdWxhciBkZXBlbmRlbmNpZXMuXG5cdCAqXG5cdCAqIEByZXR1cm5zIENsb25lIG9mIHRoaXMgb2JqZWN0IHdpdGggdGhlIHBhcmVudCBwcm9wZXJ0eSByZW1vdmVkLlxuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICBjb25zdCBqc29uID0gY2xvbmUodGhpcyk7XG4gICAgICAgIC8vIER1ZSB0byBjaXJjdWxhciByZWZlcmVuY2VzIHdlIG5lZWQgdG8gcmVtb3ZlIHBhcmVudCByZWZlcmVuY2UuXG4gICAgICAgIGRlbGV0ZSBqc29uLnBhcmVudDtcbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgfVxufTtcbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cbk5vZGUkMi5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAndmlldzpub2RlJztcbn07XG5cbi8qKlxuICogVHJlZSB2aWV3IHRleHQgbm9kZS5cbiAqXG4gKiBUaGUgY29uc3RydWN0b3Igb2YgdGhpcyBjbGFzcyBzaG91bGQgbm90IGJlIHVzZWQgZGlyZWN0bHkuIFRvIGNyZWF0ZSBhIG5ldyB0ZXh0IG5vZGUgaW5zdGFuY2VcbiAqIHVzZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVUZXh0IGBEb3duY2FzdFdyaXRlciNjcmVhdGVUZXh0KClgfVxuICogbWV0aG9kIHdoZW4gd29ya2luZyBvbiBkYXRhIGRvd25jYXN0ZWQgZnJvbSB0aGUgbW9kZWwgb3IgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXIjY3JlYXRlVGV4dCBgVXBjYXN0V3JpdGVyI2NyZWF0ZVRleHQoKWB9XG4gKiBtZXRob2Qgd2hlbiB3b3JraW5nIG9uIG5vbi1zZW1hbnRpYyB2aWV3cy5cbiAqLyBsZXQgVGV4dCQxID0gY2xhc3MgVGV4dCBleHRlbmRzIE5vZGUkMiB7XG4gICAgLyoqXG5cdCAqIFRoZSB0ZXh0IGNvbnRlbnQuXG5cdCAqXG5cdCAqIFNldHRpbmcgdGhlIGRhdGEgZmlyZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2V2ZW50OmNoYW5nZTp0ZXh0IGNoYW5nZSBldmVudH0uXG5cdCAqLyBfdGV4dERhdGE7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB0cmVlIHZpZXcgdGV4dCBub2RlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVUZXh0XG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIGRvY3VtZW50IGluc3RhbmNlIHRvIHdoaWNoIHRoaXMgdGV4dCBub2RlIGJlbG9uZ3MuXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSB0ZXh0J3MgZGF0YS5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBkYXRhKXtcbiAgICAgICAgc3VwZXIoZG9jdW1lbnQpO1xuICAgICAgICB0aGlzLl90ZXh0RGF0YSA9IGRhdGE7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgdGV4dCBjb250ZW50LlxuXHQgKi8gZ2V0IGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90ZXh0RGF0YTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBgX2RhdGFgIHByb3BlcnR5IGlzIGNvbnRyb2xsZWQgYnkgYSBnZXR0ZXIgYW5kIGEgc2V0dGVyLlxuXHQgKlxuXHQgKiBUaGUgZ2V0dGVyIGlzIHJlcXVpcmVkIHdoZW4gdXNpbmcgdGhlIGFkZGl0aW9uIGFzc2lnbm1lbnQgb3BlcmF0b3Igb24gcHJvdGVjdGVkIHByb3BlcnR5OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBmb28gPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApO1xuXHQgKiBjb25zdCBiYXIgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnYmFyJyApO1xuXHQgKlxuXHQgKiBmb28uX2RhdGEgKz0gYmFyLmRhdGE7ICAgLy8gZXhlY3V0ZXM6IGBmb28uX2RhdGEgPSBmb28uX2RhdGEgKyBiYXIuZGF0YWBcblx0ICogY29uc29sZS5sb2coIGZvby5kYXRhICk7IC8vIHByaW50czogJ2Zvb2Jhcidcblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIHRoZSBwcm90ZWN0ZWQgZ2V0dGVyIGRpZG4ndCBleGlzdCwgYGZvby5fZGF0YWAgd2lsbCByZXR1cm4gYHVuZGVmaW5lZGAgYW5kIHJlc3VsdCBvZiB0aGUgbWVyZ2Ugd2lsbCBiZSBpbnZhbGlkLlxuXHQgKlxuXHQgKiBUaGUgc2V0dGVyIHNldHMgZGF0YSBhbmQgZmlyZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2V2ZW50OmNoYW5nZTp0ZXh0IGNoYW5nZSBldmVudH0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gZ2V0IF9kYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhO1xuICAgIH1cbiAgICBzZXQgX2RhdGEoZGF0YSkge1xuICAgICAgICB0aGlzLl9maXJlQ2hhbmdlKCd0ZXh0JywgdGhpcyk7XG4gICAgICAgIHRoaXMuX3RleHREYXRhID0gZGF0YTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0aGlzIHRleHQgbm9kZSBpcyBzaW1pbGFyIHRvIG90aGVyIHRleHQgbm9kZS5cblx0ICogQm90aCBub2RlcyBzaG91bGQgaGF2ZSB0aGUgc2FtZSBkYXRhIHRvIGJlIGNvbnNpZGVyZWQgYXMgc2ltaWxhci5cblx0ICpcblx0ICogQHBhcmFtIG90aGVyTm9kZSBOb2RlIHRvIGNoZWNrIGlmIGl0IGlzIHNhbWUgYXMgdGhpcyBub2RlLlxuXHQgKi8gaXNTaW1pbGFyKG90aGVyTm9kZSkge1xuICAgICAgICBpZiAoIShvdGhlck5vZGUgaW5zdGFuY2VvZiBUZXh0KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzID09PSBvdGhlck5vZGUgfHwgdGhpcy5kYXRhID09PSBvdGhlck5vZGUuZGF0YTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyB0aGlzIG5vZGUuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmV0dXJucyBUZXh0IG5vZGUgdGhhdCBpcyBhIGNsb25lIG9mIHRoaXMgbm9kZS5cblx0ICovIF9jbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KHRoaXMuZG9jdW1lbnQsIHRoaXMuZGF0YSk7XG4gICAgfVxufTtcbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cblRleHQkMS5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09ICckdGV4dCcgfHwgdHlwZSA9PT0gJ3ZpZXc6JHRleHQnIHx8IC8vIFRoaXMgYXJlIGxlZ2FjeSB2YWx1ZXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICB0eXBlID09PSAndGV4dCcgfHwgdHlwZSA9PT0gJ3ZpZXc6dGV4dCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgdHlwZSA9PT0gJ25vZGUnIHx8IHR5cGUgPT09ICd2aWV3Om5vZGUnO1xufTtcblxuLyoqXG4gKiBUZXh0UHJveHkgaXMgYSB3cmFwcGVyIGZvciBzdWJzdHJpbmcgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHR9LiBJbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGlzIGNyZWF0ZWQgYnlcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfSB3aGVuIG9ubHkgYSBwYXJ0IG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0fSBuZWVkcyB0byBiZSByZXR1cm5lZC5cbiAqXG4gKiBgVGV4dFByb3h5YCBoYXMgYW4gQVBJIHNpbWlsYXIgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgVGV4dH0gYW5kIGFsbG93cyB0byBkbyBtb3N0IG9mIHRoZSBjb21tb24gdGFza3MgcGVyZm9ybWVkXG4gKiBvbiB2aWV3IG5vZGVzLlxuICpcbiAqICoqTm90ZToqKiBTb21lIGBUZXh0UHJveHlgIGluc3RhbmNlcyBtYXkgcmVwcmVzZW50IHdob2xlIHRleHQgbm9kZSwgbm90IGp1c3QgYSBwYXJ0IG9mIGl0LlxuICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dHByb3h5flRleHRQcm94eSNpc1BhcnRpYWx9LlxuICpcbiAqICoqTm90ZToqKiBgVGV4dFByb3h5YCBpcyBhIHJlYWRvbmx5IGludGVyZmFjZS5cbiAqXG4gKiAqKk5vdGU6KiogYFRleHRQcm94eWAgaW5zdGFuY2VzIGFyZSBjcmVhdGVkIG9uIHRoZSBmbHkgYmFzaW5nIG9uIHRoZSBjdXJyZW50IHN0YXRlIG9mIHBhcmVudCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dH0uXG4gKiBCZWNhdXNlIG9mIHRoaXMgaXQgaXMgaGlnaGx5IHVucmVjb21tZW5kZWQgdG8gc3RvcmUgcmVmZXJlbmNlcyB0byBgVGV4dFByb3h5IGluc3RhbmNlcyBiZWNhdXNlIHRoZXkgbWlnaHQgZ2V0XG4gKiBpbnZhbGlkYXRlZCBkdWUgdG8gb3BlcmF0aW9ucyBvbiBEb2N1bWVudC4gQWxzbyBUZXh0UHJveHkgaXMgbm90IGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGV9IHNvIGl0IGNhbiBub3QgYmVcbiAqIGluc2VydGVkIGFzIGEgY2hpbGQgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9LlxuICpcbiAqIGBUZXh0UHJveHlgIGluc3RhbmNlcyBhcmUgY3JlYXRlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlciB2aWV3IHRyZWUgd2Fsa2VyfS4gWW91IHNob3VsZCBub3QgbmVlZCB0byBjcmVhdGVcbiAqIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgYnkgeW91ciBvd24uXG4gKi8gbGV0IFRleHRQcm94eSQxID0gY2xhc3MgVGV4dFByb3h5IGV4dGVuZHMgVHlwZUNoZWNrYWJsZSQxIHtcbiAgICAvKipcblx0ICogUmVmZXJlbmNlIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dH0gZWxlbWVudCB3aGljaCBUZXh0UHJveHkgaXMgYSBzdWJzdHJpbmcuXG5cdCAqLyB0ZXh0Tm9kZTtcbiAgICAvKipcblx0ICogVGV4dCBkYXRhIHJlcHJlc2VudGVkIGJ5IHRoaXMgdGV4dCBwcm94eS5cblx0ICovIGRhdGE7XG4gICAgLyoqXG5cdCAqIE9mZnNldCBpbiB0aGUgYHRleHROb2RlYCB3aGVyZSB0aGlzIGBUZXh0UHJveHlgIGluc3RhbmNlIHN0YXJ0cy5cblx0ICovIG9mZnNldEluVGV4dDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHRleHQgcHJveHkuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gdGV4dE5vZGUgVGV4dCBub2RlIHdoaWNoIHBhcnQgaXMgcmVwcmVzZW50ZWQgYnkgdGhpcyB0ZXh0IHByb3h5LlxuXHQgKiBAcGFyYW0gb2Zmc2V0SW5UZXh0IE9mZnNldCBpbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHRwcm94eX5UZXh0UHJveHkjdGV4dE5vZGUgdGV4dCBub2RlfVxuXHQgKiBmcm9tIHdoaWNoIHRoZSB0ZXh0IHByb3h5IHN0YXJ0cy5cblx0ICogQHBhcmFtIGxlbmd0aCBUZXh0IHByb3h5IGxlbmd0aCwgdGhhdCBpcyBob3cgbWFueSB0ZXh0IG5vZGUncyBjaGFyYWN0ZXJzLCBzdGFydGluZyBmcm9tIGBvZmZzZXRJblRleHRgIGl0IHJlcHJlc2VudHMuXG5cdCAqIEBjb25zdHJ1Y3RvclxuXHQgKi8gY29uc3RydWN0b3IodGV4dE5vZGUsIG9mZnNldEluVGV4dCwgbGVuZ3RoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy50ZXh0Tm9kZSA9IHRleHROb2RlO1xuICAgICAgICBpZiAob2Zmc2V0SW5UZXh0IDwgMCB8fCBvZmZzZXRJblRleHQgPiB0ZXh0Tm9kZS5kYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHaXZlbiBvZmZzZXRJblRleHQgdmFsdWUgaXMgaW5jb3JyZWN0LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXRleHRwcm94eS13cm9uZy1vZmZzZXRpbnRleHRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy10ZXh0cHJveHktd3Jvbmctb2Zmc2V0aW50ZXh0JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlbmd0aCA8IDAgfHwgb2Zmc2V0SW5UZXh0ICsgbGVuZ3RoID4gdGV4dE5vZGUuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogR2l2ZW4gbGVuZ3RoIHZhbHVlIGlzIGluY29ycmVjdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy10ZXh0cHJveHktd3JvbmctbGVuZ3RoXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctdGV4dHByb3h5LXdyb25nLWxlbmd0aCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGF0YSA9IHRleHROb2RlLmRhdGEuc3Vic3RyaW5nKG9mZnNldEluVGV4dCwgb2Zmc2V0SW5UZXh0ICsgbGVuZ3RoKTtcbiAgICAgICAgdGhpcy5vZmZzZXRJblRleHQgPSBvZmZzZXRJblRleHQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPZmZzZXQgc2l6ZSBvZiB0aGlzIG5vZGUuXG5cdCAqLyBnZXQgb2Zmc2V0U2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBgVGV4dFByb3h5YCBpbnN0YW5jZSBjb3ZlcnMgb25seSBwYXJ0IG9mIHRoZSBvcmlnaW5hbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGV9XG5cdCAqIChgdHJ1ZWApIG9yIHRoZSB3aG9sZSB0ZXh0IG5vZGUgKGBmYWxzZWApLlxuXHQgKlxuXHQgKiBUaGlzIGlzIGBmYWxzZWAgd2hlbiB0ZXh0IHByb3h5IHN0YXJ0cyBhdCB0aGUgdmVyeSBiZWdpbm5pbmcgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0cHJveHl+VGV4dFByb3h5I3RleHROb2RlIHRleHROb2RlfVxuXHQgKiAoe0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0cHJveHl+VGV4dFByb3h5I29mZnNldEluVGV4dCBvZmZzZXRJblRleHR9IGVxdWFscyBgMGApIGFuZCB0ZXh0IHByb3h5IHNpemVzIGlzIGVxdWFsIHRvXG5cdCAqIHRleHQgbm9kZSBzaXplLlxuXHQgKi8gZ2V0IGlzUGFydGlhbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5sZW5ndGggIT09IHRoaXMudGV4dE5vZGUuZGF0YS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQYXJlbnQgb2YgdGhpcyB0ZXh0IHByb3h5LCB3aGljaCBpcyBzYW1lIGFzIHBhcmVudCBvZiB0ZXh0IG5vZGUgcmVwcmVzZW50ZWQgYnkgdGhpcyB0ZXh0IHByb3h5LlxuXHQgKi8gZ2V0IHBhcmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dE5vZGUucGFyZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogUm9vdCBvZiB0aGlzIHRleHQgcHJveHksIHdoaWNoIGlzIHNhbWUgYXMgcm9vdCBvZiB0ZXh0IG5vZGUgcmVwcmVzZW50ZWQgYnkgdGhpcyB0ZXh0IHByb3h5LlxuXHQgKi8gZ2V0IHJvb3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHROb2RlLnJvb3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50IFZpZXcgZG9jdW1lbnR9IHRoYXQgb3ducyB0aGlzIHRleHQgcHJveHksIG9yIGBudWxsYCBpZiB0aGUgdGV4dCBwcm94eSBpcyBpbnNpZGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgZG9jdW1lbnQgZnJhZ21lbnR9LlxuXHQgKi8gZ2V0IGRvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0Tm9kZS5kb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW5jZXN0b3JzIGFycmF5IG9mIHRoaXMgdGV4dCBwcm94eS5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBvYmplY3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmluY2x1ZGVTZWxmIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGV4dE5vZGUgd2lsbCBiZSBhbHNvIGluY2x1ZGVkIGluIHBhcmVudCdzIGFycmF5LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5wYXJlbnRGaXJzdCBXaGVuIHNldCB0byBgdHJ1ZWAsIGFycmF5IHdpbGwgYmUgc29ydGVkIGZyb20gdGV4dCBwcm94eSBwYXJlbnQgdG9cblx0ICogcm9vdCBlbGVtZW50LCBvdGhlcndpc2Ugcm9vdCBlbGVtZW50IHdpbGwgYmUgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIGFycmF5LlxuXHQgKiBAcmV0dXJucyBBcnJheSB3aXRoIGFuY2VzdG9ycy5cblx0ICovIGdldEFuY2VzdG9ycyhvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgYW5jZXN0b3JzID0gW107XG4gICAgICAgIGxldCBwYXJlbnQgPSBvcHRpb25zLmluY2x1ZGVTZWxmID8gdGhpcy50ZXh0Tm9kZSA6IHRoaXMucGFyZW50O1xuICAgICAgICB3aGlsZShwYXJlbnQgIT09IG51bGwpe1xuICAgICAgICAgICAgYW5jZXN0b3JzW29wdGlvbnMucGFyZW50Rmlyc3QgPyAncHVzaCcgOiAndW5zaGlmdCddKHBhcmVudCk7XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhbmNlc3RvcnM7XG4gICAgfVxufTtcbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cblRleHRQcm94eSQxLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJyR0ZXh0UHJveHknIHx8IHR5cGUgPT09ICd2aWV3OiR0ZXh0UHJveHknIHx8IC8vIFRoaXMgYXJlIGxlZ2FjeSB2YWx1ZXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICB0eXBlID09PSAndGV4dFByb3h5JyB8fCB0eXBlID09PSAndmlldzp0ZXh0UHJveHknO1xufTtcblxuLyoqXG4gKiBDbGFzcyB1c2VkIGZvciBoYW5kbGluZyBjb25zdW1wdGlvbiBvZiB2aWV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnRzfSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IHRleHQgbm9kZXN9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudHN9LlxuICogRWxlbWVudCdzIG5hbWUgYW5kIGl0cyBwYXJ0cyAoYXR0cmlidXRlcywgY2xhc3NlcyBhbmQgc3R5bGVzKSBjYW4gYmUgY29uc3VtZWQgc2VwYXJhdGVseS4gQ29uc3VtaW5nIGFuIGVsZW1lbnQncyBuYW1lXG4gKiBkb2VzIG5vdCBjb25zdW1lIGl0cyBhdHRyaWJ1dGVzLCBjbGFzc2VzIGFuZCBzdHlsZXMuXG4gKiBUbyBhZGQgaXRlbXMgZm9yIGNvbnN1bXB0aW9uIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI2FkZCBhZGQgbWV0aG9kfS5cbiAqIFRvIHRlc3QgaXRlbXMgdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGUjdGVzdCB0ZXN0IG1ldGhvZH0uXG4gKiBUbyBjb25zdW1lIGl0ZW1zIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI2NvbnN1bWUgY29uc3VtZSBtZXRob2R9LlxuICogVG8gcmV2ZXJ0IGFscmVhZHkgY29uc3VtZWQgaXRlbXMgdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGUjcmV2ZXJ0IHJldmVydCBtZXRob2R9LlxuICpcbiAqIGBgYHRzXG4gKiB2aWV3Q29uc3VtYWJsZS5hZGQoIGVsZW1lbnQsIHsgbmFtZTogdHJ1ZSB9ICk7IC8vIEFkZHMgZWxlbWVudCdzIG5hbWUgYXMgcmVhZHkgdG8gYmUgY29uc3VtZWQuXG4gKiB2aWV3Q29uc3VtYWJsZS5hZGQoIHRleHROb2RlICk7IC8vIEFkZHMgdGV4dCBub2RlIGZvciBjb25zdW1wdGlvbi5cbiAqIHZpZXdDb25zdW1hYmxlLmFkZCggZG9jRnJhZ21lbnQgKTsgLy8gQWRkcyBkb2N1bWVudCBmcmFnbWVudCBmb3IgY29uc3VtcHRpb24uXG4gKiB2aWV3Q29uc3VtYWJsZS50ZXN0KCBlbGVtZW50LCB7IG5hbWU6IHRydWUgfSAgKTsgLy8gVGVzdHMgaWYgZWxlbWVudCdzIG5hbWUgY2FuIGJlIGNvbnN1bWVkLlxuICogdmlld0NvbnN1bWFibGUudGVzdCggdGV4dE5vZGUgKTsgLy8gVGVzdHMgaWYgdGV4dCBub2RlIGNhbiBiZSBjb25zdW1lZC5cbiAqIHZpZXdDb25zdW1hYmxlLnRlc3QoIGRvY0ZyYWdtZW50ICk7IC8vIFRlc3RzIGlmIGRvY3VtZW50IGZyYWdtZW50IGNhbiBiZSBjb25zdW1lZC5cbiAqIHZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIGVsZW1lbnQsIHsgbmFtZTogdHJ1ZSB9ICApOyAvLyBDb25zdW1lIGVsZW1lbnQncyBuYW1lLlxuICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggdGV4dE5vZGUgKTsgLy8gQ29uc3VtZSB0ZXh0IG5vZGUuXG4gKiB2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBkb2NGcmFnbWVudCApOyAvLyBDb25zdW1lIGRvY3VtZW50IGZyYWdtZW50LlxuICogdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBlbGVtZW50LCB7IG5hbWU6IHRydWUgfSAgKTsgLy8gUmV2ZXJ0IGFscmVhZHkgY29uc3VtZWQgZWxlbWVudCdzIG5hbWUuXG4gKiB2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHRleHROb2RlICk7IC8vIFJldmVydCBhbHJlYWR5IGNvbnN1bWVkIHRleHQgbm9kZS5cbiAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggZG9jRnJhZ21lbnQgKTsgLy8gUmV2ZXJ0IGFscmVhZHkgY29uc3VtZWQgZG9jdW1lbnQgZnJhZ21lbnQuXG4gKiBgYGBcbiAqLyBjbGFzcyBWaWV3Q29uc3VtYWJsZSB7XG4gICAgLyoqXG5cdCAqIE1hcCBvZiBjb25zdW1hYmxlIGVsZW1lbnRzLiBJZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSBpcyB1c2VkIGFzIGEga2V5LFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdFbGVtZW50Q29uc3VtYWJsZXMgVmlld0VsZW1lbnRDb25zdW1hYmxlc30gaW5zdGFuY2UgaXMgc3RvcmVkIGFzIHZhbHVlLlxuXHQgKiBGb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2Rlc30gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50c30gYm9vbGVhbiB2YWx1ZSBpcyBzdG9yZWQgYXMgdmFsdWUuXG5cdCAqLyBfY29uc3VtYWJsZXMgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIEFkZHMgdmlldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2RlfSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH0gYXMgcmVhZHkgdG8gYmUgY29uc3VtZWQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBuYW1lOiB0cnVlIH0gKTsgLy8gQWRkcyBlbGVtZW50J3MgbmFtZSB0byBjb25zdW1lLlxuXHQgKiB2aWV3Q29uc3VtYWJsZS5hZGQoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnIH0gKTsgLy8gQWRkcyBlbGVtZW50J3MgYXR0cmlidXRlLlxuXHQgKiB2aWV3Q29uc3VtYWJsZS5hZGQoIHAsIHsgY2xhc3NlczogJ2Zvb2JhcicgfSApOyAvLyBBZGRzIGVsZW1lbnQncyBjbGFzcy5cblx0ICogdmlld0NvbnN1bWFibGUuYWRkKCBwLCB7IHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIEFkZHMgZWxlbWVudCdzIHN0eWxlXG5cdCAqIHZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScsIHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIEFkZHMgYXR0cmlidXRlIGFuZCBzdHlsZS5cblx0ICogdmlld0NvbnN1bWFibGUuYWRkKCBwLCB7IGNsYXNzZXM6IFsgJ2JheicsICdiYXInIF0gfSApOyAvLyBNdWx0aXBsZSBjb25zdW1hYmxlcyBjYW4gYmUgcHJvdmlkZWQuXG5cdCAqIHZpZXdDb25zdW1hYmxlLmFkZCggdGV4dE5vZGUgKTsgLy8gQWRkcyB0ZXh0IG5vZGUgdG8gY29uc3VtZS5cblx0ICogdmlld0NvbnN1bWFibGUuYWRkKCBkb2NGcmFnbWVudCApOyAvLyBBZGRzIGRvY3VtZW50IGZyYWdtZW50IHRvIGNvbnN1bWUuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXdjb25zdW1hYmxlLWludmFsaWQtYXR0cmlidXRlYCB3aGVuIGBjbGFzc2Agb3IgYHN0eWxlYFxuXHQgKiBhdHRyaWJ1dGUgaXMgcHJvdmlkZWQgLSBpdCBzaG91bGQgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGJ5IHByb3ZpZGluZyBhY3R1YWwgc3R5bGUvY2xhc3MuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHZpZXdDb25zdW1hYmxlLmFkZCggcCwgeyBhdHRyaWJ1dGVzOiAnc3R5bGUnIH0gKTsgLy8gVGhpcyBjYWxsIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLlxuXHQgKiB2aWV3Q29uc3VtYWJsZS5hZGQoIHAsIHsgc3R5bGVzOiAnY29sb3InIH0gKTsgLy8gVGhpcyBpcyBwcm9wZXJseSBoYW5kbGVkIHN0eWxlLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGNvbnN1bWFibGVzIFVzZWQgb25seSBpZiBmaXJzdCBwYXJhbWV0ZXIgaXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSBpbnN0YW5jZS5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLm5hbWUgSWYgc2V0IHRvIHRydWUgZWxlbWVudCdzIG5hbWUgd2lsbCBiZSBpbmNsdWRlZC5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMuY2xhc3NlcyBDbGFzcyBuYW1lIG9yIGFycmF5IG9mIGNsYXNzIG5hbWVzLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMuXG5cdCAqLyBhZGQoZWxlbWVudCwgY29uc3VtYWJsZXMpIHtcbiAgICAgICAgbGV0IGVsZW1lbnRDb25zdW1hYmxlcztcbiAgICAgICAgLy8gRm9yIHRleHQgbm9kZXMgYW5kIGRvY3VtZW50IGZyYWdtZW50cyBqdXN0IG1hcmsgdGhlbSBhcyBjb25zdW1hYmxlLlxuICAgICAgICBpZiAoZWxlbWVudC5pcygnJHRleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgIHRoaXMuX2NvbnN1bWFibGVzLnNldChlbGVtZW50LCB0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBGb3IgZWxlbWVudHMgY3JlYXRlIG5ldyBWaWV3RWxlbWVudENvbnN1bWFibGVzIG9yIHVwZGF0ZSBhbHJlYWR5IGV4aXN0aW5nIG9uZS5cbiAgICAgICAgaWYgKCF0aGlzLl9jb25zdW1hYmxlcy5oYXMoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGVsZW1lbnRDb25zdW1hYmxlcyA9IG5ldyBWaWV3RWxlbWVudENvbnN1bWFibGVzKGVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5fY29uc3VtYWJsZXMuc2V0KGVsZW1lbnQsIGVsZW1lbnRDb25zdW1hYmxlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50Q29uc3VtYWJsZXMgPSB0aGlzLl9jb25zdW1hYmxlcy5nZXQoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudENvbnN1bWFibGVzLmFkZChjb25zdW1hYmxlcyA/IG5vcm1hbGl6ZUNvbnN1bWFibGVzKGNvbnN1bWFibGVzKSA6IGVsZW1lbnQuX2dldENvbnN1bWFibGVzKCkpO1xuICAgIH1cbiAgICAvKipcblx0ICogVGVzdHMgaWYge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dCBub2RlfSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH0gY2FuIGJlIGNvbnN1bWVkLlxuXHQgKiBJdCByZXR1cm5zIGB0cnVlYCB3aGVuIGFsbCBpdGVtcyBpbmNsdWRlZCBpbiBtZXRob2QncyBjYWxsIGNhbiBiZSBjb25zdW1lZC4gUmV0dXJucyBgZmFsc2VgIHdoZW5cblx0ICogZmlyc3QgYWxyZWFkeSBjb25zdW1lZCBpdGVtIGlzIGZvdW5kIGFuZCBgbnVsbGAgd2hlbiBmaXJzdCBub24tY29uc3VtYWJsZSBpdGVtIGlzIGZvdW5kLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB2aWV3Q29uc3VtYWJsZS50ZXN0KCBwLCB7IG5hbWU6IHRydWUgfSApOyAvLyBUZXN0cyBlbGVtZW50J3MgbmFtZS5cblx0ICogdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScgfSApOyAvLyBUZXN0cyBhdHRyaWJ1dGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnRlc3QoIHAsIHsgY2xhc3NlczogJ2Zvb2JhcicgfSApOyAvLyBUZXN0cyBjbGFzcy5cblx0ICogdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBUZXN0cyBzdHlsZS5cblx0ICogdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScsIHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIFRlc3RzIGF0dHJpYnV0ZSBhbmQgc3R5bGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnRlc3QoIHAsIHsgY2xhc3NlczogWyAnYmF6JywgJ2JhcicgXSB9ICk7IC8vIE11bHRpcGxlIGNvbnN1bWFibGVzIGNhbiBiZSB0ZXN0ZWQuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnRlc3QoIHRleHROb2RlICk7IC8vIFRlc3RzIHRleHQgbm9kZS5cblx0ICogdmlld0NvbnN1bWFibGUudGVzdCggZG9jRnJhZ21lbnQgKTsgLy8gVGVzdHMgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUZXN0aW5nIGNsYXNzZXMgYW5kIHN0eWxlcyBhcyBhdHRyaWJ1dGUgd2lsbCB0ZXN0IGlmIGFsbCBhZGRlZCBjbGFzc2VzL3N0eWxlcyBjYW4gYmUgY29uc3VtZWQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHZpZXdDb25zdW1hYmxlLnRlc3QoIHAsIHsgYXR0cmlidXRlczogJ2NsYXNzJyB9ICk7IC8vIFRlc3RzIGlmIGFsbCBhZGRlZCBjbGFzc2VzIGNhbiBiZSBjb25zdW1lZC5cblx0ICogdmlld0NvbnN1bWFibGUudGVzdCggcCwgeyBhdHRyaWJ1dGVzOiAnc3R5bGUnIH0gKTsgLy8gVGVzdHMgaWYgYWxsIGFkZGVkIHN0eWxlcyBjYW4gYmUgY29uc3VtZWQuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMgVXNlZCBvbmx5IGlmIGZpcnN0IHBhcmFtZXRlciBpcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IGluc3RhbmNlLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMubmFtZSBJZiBzZXQgdG8gdHJ1ZSBlbGVtZW50J3MgbmFtZSB3aWxsIGJlIGluY2x1ZGVkLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMuYXR0cmlidXRlcyBBdHRyaWJ1dGUgbmFtZSBvciBhcnJheSBvZiBhdHRyaWJ1dGUgbmFtZXMuXG5cdCAqIEBwYXJhbSBjb25zdW1hYmxlcy5jbGFzc2VzIENsYXNzIG5hbWUgb3IgYXJyYXkgb2YgY2xhc3MgbmFtZXMuXG5cdCAqIEBwYXJhbSBjb25zdW1hYmxlcy5zdHlsZXMgU3R5bGUgbmFtZSBvciBhcnJheSBvZiBzdHlsZSBuYW1lcy5cblx0ICogQHJldHVybnMgUmV0dXJucyBgdHJ1ZWAgd2hlbiBhbGwgaXRlbXMgaW5jbHVkZWQgaW4gbWV0aG9kJ3MgY2FsbCBjYW4gYmUgY29uc3VtZWQuIFJldHVybnMgYGZhbHNlYFxuXHQgKiB3aGVuIGZpcnN0IGFscmVhZHkgY29uc3VtZWQgaXRlbSBpcyBmb3VuZCBhbmQgYG51bGxgIHdoZW4gZmlyc3Qgbm9uLWNvbnN1bWFibGUgaXRlbSBpcyBmb3VuZC5cblx0ICovIHRlc3QoZWxlbWVudCwgY29uc3VtYWJsZXMpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudENvbnN1bWFibGVzID0gdGhpcy5fY29uc3VtYWJsZXMuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudENvbnN1bWFibGVzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZvciB0ZXh0IG5vZGVzIGFuZCBkb2N1bWVudCBmcmFnbWVudHMgcmV0dXJuIHN0b3JlZCBib29sZWFuIHZhbHVlLlxuICAgICAgICBpZiAoZWxlbWVudC5pcygnJHRleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50Q29uc3VtYWJsZXM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRm9yIGVsZW1lbnRzIHRlc3QgY29uc3VtYWJsZXMgb2JqZWN0LlxuICAgICAgICByZXR1cm4gZWxlbWVudENvbnN1bWFibGVzLnRlc3Qobm9ybWFsaXplQ29uc3VtYWJsZXMoY29uc3VtYWJsZXMpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnN1bWVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0sIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IHRleHQgbm9kZX0gb3Jcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgZG9jdW1lbnQgZnJhZ21lbnR9LlxuXHQgKiBJdCByZXR1cm5zIGB0cnVlYCB3aGVuIGFsbCBpdGVtcyBpbmNsdWRlZCBpbiBtZXRob2QncyBjYWxsIGNhbiBiZSBjb25zdW1lZCwgb3RoZXJ3aXNlIHJldHVybnMgYGZhbHNlYC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBuYW1lOiB0cnVlIH0gKTsgLy8gQ29uc3VtZXMgZWxlbWVudCdzIG5hbWUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnIH0gKTsgLy8gQ29uc3VtZXMgZWxlbWVudCdzIGF0dHJpYnV0ZS5cblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBjbGFzc2VzOiAnZm9vYmFyJyB9ICk7IC8vIENvbnN1bWVzIGVsZW1lbnQncyBjbGFzcy5cblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBDb25zdW1lcyBlbGVtZW50J3Mgc3R5bGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHAsIHsgYXR0cmlidXRlczogJ25hbWUnLCBzdHlsZXM6ICdjb2xvcicgfSApOyAvLyBDb25zdW1lcyBhdHRyaWJ1dGUgYW5kIHN0eWxlLlxuXHQgKiB2aWV3Q29uc3VtYWJsZS5jb25zdW1lKCBwLCB7IGNsYXNzZXM6IFsgJ2JheicsICdiYXInIF0gfSApOyAvLyBNdWx0aXBsZSBjb25zdW1hYmxlcyBjYW4gYmUgY29uc3VtZWQuXG5cdCAqIHZpZXdDb25zdW1hYmxlLmNvbnN1bWUoIHRleHROb2RlICk7IC8vIENvbnN1bWVzIHRleHQgbm9kZS5cblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggZG9jRnJhZ21lbnQgKTsgLy8gQ29uc3VtZXMgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDb25zdW1pbmcgY2xhc3NlcyBhbmQgc3R5bGVzIGFzIGF0dHJpYnV0ZSB3aWxsIHRlc3QgaWYgYWxsIGFkZGVkIGNsYXNzZXMvc3R5bGVzIGNhbiBiZSBjb25zdW1lZC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBhdHRyaWJ1dGVzOiAnY2xhc3MnIH0gKTsgLy8gQ29uc3VtZSBvbmx5IGlmIGFsbCBhZGRlZCBjbGFzc2VzIGNhbiBiZSBjb25zdW1lZC5cblx0ICogdmlld0NvbnN1bWFibGUuY29uc3VtZSggcCwgeyBhdHRyaWJ1dGVzOiAnc3R5bGUnIH0gKTsgLy8gQ29uc3VtZSBvbmx5IGlmIGFsbCBhZGRlZCBzdHlsZXMgY2FuIGJlIGNvbnN1bWVkLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGNvbnN1bWFibGVzIFVzZWQgb25seSBpZiBmaXJzdCBwYXJhbWV0ZXIgaXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fSBpbnN0YW5jZS5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLm5hbWUgSWYgc2V0IHRvIHRydWUgZWxlbWVudCdzIG5hbWUgd2lsbCBiZSBpbmNsdWRlZC5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMgQXR0cmlidXRlIG5hbWUgb3IgYXJyYXkgb2YgYXR0cmlidXRlIG5hbWVzLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMuY2xhc3NlcyBDbGFzcyBuYW1lIG9yIGFycmF5IG9mIGNsYXNzIG5hbWVzLlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMuc3R5bGVzIFN0eWxlIG5hbWUgb3IgYXJyYXkgb2Ygc3R5bGUgbmFtZXMuXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIHdoZW4gYWxsIGl0ZW1zIGluY2x1ZGVkIGluIG1ldGhvZCdzIGNhbGwgY2FuIGJlIGNvbnN1bWVkLFxuXHQgKiBvdGhlcndpc2UgcmV0dXJucyBgZmFsc2VgLlxuXHQgKi8gY29uc3VtZShlbGVtZW50LCBjb25zdW1hYmxlcykge1xuICAgICAgICBpZiAoZWxlbWVudC5pcygnJHRleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy50ZXN0KGVsZW1lbnQsIGNvbnN1bWFibGVzKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZvciB0ZXh0IG5vZGVzIGFuZCBkb2N1bWVudCBmcmFnbWVudHMgc2V0IHZhbHVlIHRvIGZhbHNlLlxuICAgICAgICAgICAgdGhpcy5fY29uc3VtYWJsZXMuc2V0KGVsZW1lbnQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZvciBlbGVtZW50cyAtIGNvbnN1bWUgY29uc3VtYWJsZXMgb2JqZWN0LlxuICAgICAgICBjb25zdCBlbGVtZW50Q29uc3VtYWJsZXMgPSB0aGlzLl9jb25zdW1hYmxlcy5nZXQoZWxlbWVudCk7XG4gICAgICAgIGlmIChlbGVtZW50Q29uc3VtYWJsZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbGVtZW50Q29uc3VtYWJsZXMuY29uc3VtZShub3JtYWxpemVDb25zdW1hYmxlcyhjb25zdW1hYmxlcykpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV2ZXJ0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9LCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGV9IG9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fSBzbyB0aGV5IGNhbiBiZSBjb25zdW1lZCBvbmNlIGFnYWluLlxuXHQgKiBNZXRob2QgZG9lcyBub3QgcmV2ZXJ0IGl0ZW1zIHRoYXQgd2VyZSBuZXZlciBwcmV2aW91c2x5IGFkZGVkIGZvciBjb25zdW1wdGlvbiwgZXZlbiBpZiB0aGV5IGFyZSBpbmNsdWRlZCBpblxuXHQgKiBtZXRob2QncyBjYWxsLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHAsIHsgbmFtZTogdHJ1ZSB9ICk7IC8vIFJldmVydHMgZWxlbWVudCdzIG5hbWUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScgfSApOyAvLyBSZXZlcnRzIGVsZW1lbnQncyBhdHRyaWJ1dGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBjbGFzc2VzOiAnZm9vYmFyJyB9ICk7IC8vIFJldmVydHMgZWxlbWVudCdzIGNsYXNzLlxuXHQgKiB2aWV3Q29uc3VtYWJsZS5yZXZlcnQoIHAsIHsgc3R5bGVzOiAnY29sb3InIH0gKTsgLy8gUmV2ZXJ0cyBlbGVtZW50J3Mgc3R5bGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBhdHRyaWJ1dGVzOiAnbmFtZScsIHN0eWxlczogJ2NvbG9yJyB9ICk7IC8vIFJldmVydHMgYXR0cmlidXRlIGFuZCBzdHlsZS5cblx0ICogdmlld0NvbnN1bWFibGUucmV2ZXJ0KCBwLCB7IGNsYXNzZXM6IFsgJ2JheicsICdiYXInIF0gfSApOyAvLyBNdWx0aXBsZSBuYW1lcyBjYW4gYmUgcmV2ZXJ0ZWQuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggdGV4dE5vZGUgKTsgLy8gUmV2ZXJ0cyB0ZXh0IG5vZGUuXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggZG9jRnJhZ21lbnQgKTsgLy8gUmV2ZXJ0cyBkb2N1bWVudCBmcmFnbWVudC5cblx0ICogYGBgXG5cdCAqXG5cdCAqIFJldmVydGluZyBjbGFzc2VzIGFuZCBzdHlsZXMgYXMgYXR0cmlidXRlIHdpbGwgcmV2ZXJ0IGFsbCBjbGFzc2VzL3N0eWxlcyB0aGF0IHdlcmUgcHJldmlvdXNseSBhZGRlZCBmb3Jcblx0ICogY29uc3VtcHRpb24uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBhdHRyaWJ1dGVzOiAnY2xhc3MnIH0gKTsgLy8gUmV2ZXJ0cyBhbGwgY2xhc3NlcyBhZGRlZCBmb3IgY29uc3VtcHRpb24uXG5cdCAqIHZpZXdDb25zdW1hYmxlLnJldmVydCggcCwgeyBhdHRyaWJ1dGVzOiAnc3R5bGUnIH0gKTsgLy8gUmV2ZXJ0cyBhbGwgc3R5bGVzIGFkZGVkIGZvciBjb25zdW1wdGlvbi5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25zdW1hYmxlcyBVc2VkIG9ubHkgaWYgZmlyc3QgcGFyYW1ldGVyIGlzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0gaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBjb25zdW1hYmxlcy5uYW1lIElmIHNldCB0byB0cnVlIGVsZW1lbnQncyBuYW1lIHdpbGwgYmUgaW5jbHVkZWQuXG5cdCAqIEBwYXJhbSBjb25zdW1hYmxlcy5hdHRyaWJ1dGVzIEF0dHJpYnV0ZSBuYW1lIG9yIGFycmF5IG9mIGF0dHJpYnV0ZSBuYW1lcy5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLmNsYXNzZXMgQ2xhc3MgbmFtZSBvciBhcnJheSBvZiBjbGFzcyBuYW1lcy5cblx0ICogQHBhcmFtIGNvbnN1bWFibGVzLnN0eWxlcyBTdHlsZSBuYW1lIG9yIGFycmF5IG9mIHN0eWxlIG5hbWVzLlxuXHQgKi8gcmV2ZXJ0KGVsZW1lbnQsIGNvbnN1bWFibGVzKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRDb25zdW1hYmxlcyA9IHRoaXMuX2NvbnN1bWFibGVzLmdldChlbGVtZW50KTtcbiAgICAgICAgaWYgKGVsZW1lbnRDb25zdW1hYmxlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnJHRleHQnKSB8fCBlbGVtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgICAgICAvLyBGb3IgdGV4dCBub2RlcyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIC0gc2V0IGNvbnN1bWFibGUgdG8gdHJ1ZS5cbiAgICAgICAgICAgICAgICB0aGlzLl9jb25zdW1hYmxlcy5zZXQoZWxlbWVudCwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZvciBlbGVtZW50cyAtIHJldmVydCBpdGVtcyBmcm9tIGNvbnN1bWFibGVzIG9iamVjdC5cbiAgICAgICAgICAgICAgICBlbGVtZW50Q29uc3VtYWJsZXMucmV2ZXJ0KG5vcm1hbGl6ZUNvbnN1bWFibGVzKGNvbnN1bWFibGVzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5WaWV3Q29uc3VtYWJsZSBWaWV3Q29uc3VtYWJsZX0gaW5zdGFuY2UgZnJvbVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSBub2RlfSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH0uXG5cdCAqIEluc3RhbmNlIHdpbGwgY29udGFpbiBhbGwgZWxlbWVudHMsIGNoaWxkIG5vZGVzLCBhdHRyaWJ1dGVzLCBzdHlsZXMgYW5kIGNsYXNzZXMgYWRkZWQgZm9yIGNvbnN1bXB0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gZnJvbSBWaWV3IG5vZGUgb3IgZG9jdW1lbnQgZnJhZ21lbnQgZnJvbSB3aGljaCBgVmlld0NvbnN1bWFibGVgIHdpbGwgYmUgY3JlYXRlZC5cblx0ICogQHBhcmFtIGluc3RhbmNlIElmIHByb3ZpZGVkLCBnaXZlbiBgVmlld0NvbnN1bWFibGVgIGluc3RhbmNlIHdpbGwgYmUgdXNlZFxuXHQgKiB0byBhZGQgYWxsIGNvbnN1bWFibGVzLiBJdCB3aWxsIGJlIHJldHVybmVkIGluc3RlYWQgb2YgYSBuZXcgaW5zdGFuY2UuXG5cdCAqLyBzdGF0aWMgY3JlYXRlRnJvbShmcm9tLCBpbnN0YW5jZSkge1xuICAgICAgICBpZiAoIWluc3RhbmNlKSB7XG4gICAgICAgICAgICBpbnN0YW5jZSA9IG5ldyBWaWV3Q29uc3VtYWJsZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmcm9tLmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICBpbnN0YW5jZS5hZGQoZnJvbSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbS5pcygnZWxlbWVudCcpIHx8IGZyb20uaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSkge1xuICAgICAgICAgICAgaW5zdGFuY2UuYWRkKGZyb20pO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBmcm9tLmdldENoaWxkcmVuKCkpe1xuICAgICAgICAgICAgICAgIFZpZXdDb25zdW1hYmxlLmNyZWF0ZUZyb20oY2hpbGQsIGluc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgfVxufVxuLyoqXG4gKiBUaGlzIGlzIGEgcHJpdmF0ZSBoZWxwZXItY2xhc3MgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+Vmlld0NvbnN1bWFibGV9LlxuICogSXQgcmVwcmVzZW50cyBhbmQgbWFuaXB1bGF0ZXMgY29uc3VtYWJsZSBwYXJ0cyBvZiBhIHNpbmdsZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0uXG4gKi8gY2xhc3MgVmlld0VsZW1lbnRDb25zdW1hYmxlcyB7XG4gICAgZWxlbWVudDtcbiAgICAvKipcblx0ICogRmxhZyBpbmRpY2F0aW5nIGlmIG5hbWUgb2YgdGhlIGVsZW1lbnQgY2FuIGJlIGNvbnN1bWVkLlxuXHQgKi8gX2NhbkNvbnN1bWVOYW1lID0gbnVsbDtcbiAgICAvKipcblx0ICogQSBtYXAgb2YgZWxlbWVudCdzIGNvbnN1bWFibGVzLlxuXHQgKiAqIEZvciBwbGFpbiBhdHRyaWJ1dGVzIHRoZSB2YWx1ZSBpcyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBhdHRyaWJ1dGUgaXMgYXZhaWxhYmxlIHRvIGNvbnN1bWUuXG5cdCAqICogRm9yIHRva2VuIGJhc2VkIGF0dHJpYnV0ZXMgKGxpa2UgY2xhc3MgbGlzdCBhbmQgc3R5bGUpIHRoZSB2YWx1ZSBpcyBhIG1hcCBvZiB0b2tlbnMgdG8gYm9vbGVhbnNcblx0ICogaW5kaWNhdGluZyB3aGV0aGVyIHRoZSB0b2tlbiBpcyBhdmFpbGFibGUgdG8gY29uc3VtZSBvbiB0aGUgZ2l2ZW4gYXR0cmlidXRlLlxuXHQgKi8gX2F0dHJpYnV0ZXMgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgVmlld0VsZW1lbnRDb25zdW1hYmxlcyBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIGZyb20gVmlldyBlbGVtZW50IGZyb20gd2hpY2ggYFZpZXdFbGVtZW50Q29uc3VtYWJsZXNgIGlzIGJlaW5nIGNyZWF0ZWQuXG5cdCAqLyBjb25zdHJ1Y3Rvcihmcm9tKXtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZnJvbTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgY29uc3VtYWJsZSBwYXJ0cyBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgdmlldyBlbGVtZW50fS5cblx0ICogRWxlbWVudCdzIG5hbWUgaXRzZWxmIGNhbiBiZSBtYXJrZWQgdG8gYmUgY29uc3VtZWQgKHdoZW4gZWxlbWVudCdzIG5hbWUgaXMgY29uc3VtZWQgaXRzIGF0dHJpYnV0ZXMsIGNsYXNzZXMgYW5kXG5cdCAqIHN0eWxlcyBzdGlsbCBjb3VsZCBiZSBjb25zdW1lZCk6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN1bWFibGVzLmFkZCggeyBuYW1lOiB0cnVlIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEF0dHJpYnV0ZXMgY2xhc3NlcyBhbmQgc3R5bGVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdW1hYmxlcy5hZGQoIHsgYXR0cmlidXRlczogWyBbICd0aXRsZScgXSwgWyAnY2xhc3MnLCAnZm9vJyBdLCBbICdzdHlsZScsICdjb2xvciddIF0gfSApO1xuXHQgKiBjb25zdW1hYmxlcy5hZGQoIHsgYXR0cmlidXRlczogWyBbICd0aXRsZScgXSwgWyAnbmFtZScgXSwgWyAnY2xhc3MnLCAnZm9vJyBdLCBbICdjbGFzcycsICdiYXInIF0gXSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBhY2NlcHRzIG9ubHkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fk5vcm1hbGl6ZWRDb25zdW1hYmxlc30uXG5cdCAqIFlvdSBjYW4gdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdmlld2NvbnN1bWFibGV+bm9ybWFsaXplQ29uc3VtYWJsZXN9IGhlbHBlciB0byBjb252ZXJ0IGZyb21cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5Db25zdW1hYmxlc30gdG8gYE5vcm1hbGl6ZWRDb25zdW1hYmxlc2AuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgdmlld2NvbnN1bWFibGUtaW52YWxpZC1hdHRyaWJ1dGVgIHdoZW4gYGNsYXNzYCBvciBgc3R5bGVgXG5cdCAqIGF0dHJpYnV0ZSBpcyBwcm92aWRlZCAtIGl0IHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHkgYnkgcHJvdmlkaW5nIGBzdHlsZWAgYW5kIGBjbGFzc2AgaW4gY29uc3VtYWJsZXMgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMgT2JqZWN0IGRlc2NyaWJpbmcgd2hpY2ggcGFydHMgb2YgdGhlIGVsZW1lbnQgY2FuIGJlIGNvbnN1bWVkLlxuXHQgKi8gYWRkKGNvbnN1bWFibGVzKSB7XG4gICAgICAgIGlmIChjb25zdW1hYmxlcy5uYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9jYW5Db25zdW1lTmFtZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgdG9rZW5dIG9mIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZVRva2VucyA9IHRoaXMuX2F0dHJpYnV0ZXMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgICAgIGlmICghYXR0cmlidXRlVG9rZW5zIHx8IHR5cGVvZiBhdHRyaWJ1dGVUb2tlbnMgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVRva2VucyA9IG5ldyBNYXAoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlcy5zZXQobmFtZSwgYXR0cmlidXRlVG9rZW5zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlVG9rZW5zLnNldCh0b2tlbiwgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUgPT0gJ3N0eWxlJyB8fCBuYW1lID09ICdjbGFzcycpIHtcbiAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0ICogQ2xhc3MgYW5kIHN0eWxlIGF0dHJpYnV0ZXMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSBpblxuXHRcdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI2FkZCBgVmlld0NvbnN1bWFibGUjYWRkKClgfS5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogV2hhdCB5b3UgaGF2ZSBkb25lIGlzIHRyeWluZyB0byB1c2U6XG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIGBgYHRzXG5cdFx0XHRcdCAqIGNvbnN1bWFibGVzLmFkZCggeyBhdHRyaWJ1dGVzOiBbICdjbGFzcycsICdzdHlsZScgXSB9ICk7XG5cdFx0XHRcdCAqIGBgYFxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBXaGlsZSBlYWNoIGNsYXNzIGFuZCBzdHlsZSBzaG91bGQgYmUgcmVnaXN0ZXJlZCBzZXBhcmF0ZWx5OlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBgYGB0c1xuXHRcdFx0XHQgKiBjb25zdW1hYmxlcy5hZGQoIHsgY2xhc3NlczogJ3NvbWUtY2xhc3MnLCBzdHlsZXM6ICdmb250LXdlaWdodCcgfSApO1xuXHRcdFx0XHQgKiBgYGBcblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIHZpZXdjb25zdW1hYmxlLWludmFsaWQtYXR0cmlidXRlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlld2NvbnN1bWFibGUtaW52YWxpZC1hdHRyaWJ1dGUnLCB0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlcy5zZXQobmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFRlc3RzIGlmIHBhcnRzIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IGNhbiBiZSBjb25zdW1lZC5cblx0ICpcblx0ICogRWxlbWVudCdzIG5hbWUgY2FuIGJlIHRlc3RlZDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3VtYWJsZXMudGVzdCggeyBuYW1lOiB0cnVlIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEF0dHJpYnV0ZXMgY2xhc3NlcyBhbmQgc3R5bGVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdW1hYmxlcy50ZXN0KCB7IGF0dHJpYnV0ZXM6IFsgWyAndGl0bGUnIF0sIFsgJ2NsYXNzJywgJ2ZvbycgXSwgWyAnc3R5bGUnLCAnY29sb3InIF0gXSB9ICk7XG5cdCAqIGNvbnN1bWFibGVzLnRlc3QoIHsgYXR0cmlidXRlczogWyBbICd0aXRsZScgXSwgWyAnbmFtZScgXSwgWyAnY2xhc3MnLCAnZm9vJyBdLCBbICdjbGFzcycsICdiYXInIF0gXSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMgT2JqZWN0IGRlc2NyaWJpbmcgd2hpY2ggcGFydHMgb2YgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIHRlc3RlZC5cblx0ICogQHJldHVybnMgYHRydWVgIHdoZW4gYWxsIHRlc3RlZCBpdGVtcyBjYW4gYmUgY29uc3VtZWQsIGBudWxsYCB3aGVuIGV2ZW4gb25lIG9mIHRoZSBpdGVtc1xuXHQgKiB3YXMgbmV2ZXIgbWFya2VkIGZvciBjb25zdW1wdGlvbiBhbmQgYGZhbHNlYCB3aGVuIGV2ZW4gb25lIG9mIHRoZSBpdGVtcyB3YXMgYWxyZWFkeSBjb25zdW1lZC5cblx0ICovIHRlc3QoY29uc3VtYWJsZXMpIHtcbiAgICAgICAgLy8gQ2hlY2sgaWYgbmFtZSBjYW4gYmUgY29uc3VtZWQuXG4gICAgICAgIGlmIChjb25zdW1hYmxlcy5uYW1lICYmICF0aGlzLl9jYW5Db25zdW1lTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbkNvbnN1bWVOYW1lO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW25hbWUsIHRva2VuXSBvZiBjb25zdW1hYmxlcy5hdHRyaWJ1dGVzKXtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fYXR0cmlidXRlcy5nZXQobmFtZSk7XG4gICAgICAgICAgICAvLyBSZXR1cm4gbnVsbCBpZiBhdHRyaWJ1dGUgaXMgbm90IGZvdW5kLlxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFscmVhZHkgY29uc3VtZWQuXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2ltcGxlIGF0dHJpYnV0ZSBpcyBub3QgY29uc3VtZWQgc28gY29udGludWUgdG8gbmV4dCBhdHRyaWJ1dGUuXG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAvLyBUb2tlbml6ZWQgYXR0cmlidXRlIGJ1dCB0b2tlbiBpcyBub3Qgc3BlY2lmaWVkIHNvIGNoZWNrIGlmIGFsbCB0b2tlbnMgYXJlIG5vdCBjb25zdW1lZC5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuVmFsdWUgb2YgdmFsdWUudmFsdWVzKCkpe1xuICAgICAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IGNvbnN1bWVkIHRva2VuLlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRva2VuVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW5WYWx1ZSA9IHZhbHVlLmdldCh0b2tlbik7XG4gICAgICAgICAgICAgICAgLy8gUmV0dXJuIG51bGwgaWYgdG9rZW4gaXMgbm90IGZvdW5kLlxuICAgICAgICAgICAgICAgIGlmICh0b2tlblZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgY29uc3VtZWQuXG4gICAgICAgICAgICAgICAgaWYgKCF0b2tlblZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIHRydWUgb25seSBpZiBhbGwgY2FuIGJlIGNvbnN1bWVkLlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRlc3RzIGlmIHBhcnRzIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IGNhbiBiZSBjb25zdW1lZCBhbmQgY29uc3VtZXMgdGhlbSBpZiBhdmFpbGFibGUuXG5cdCAqIEl0IHJldHVybnMgYHRydWVgIHdoZW4gYWxsIGl0ZW1zIGluY2x1ZGVkIGluIG1ldGhvZCdzIGNhbGwgY2FuIGJlIGNvbnN1bWVkLCBvdGhlcndpc2UgcmV0dXJucyBgZmFsc2VgLlxuXHQgKlxuXHQgKiBFbGVtZW50J3MgbmFtZSBjYW4gYmUgY29uc3VtZWQ6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN1bWFibGVzLmNvbnN1bWUoIHsgbmFtZTogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBBdHRyaWJ1dGVzIGNsYXNzZXMgYW5kIHN0eWxlczpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3VtYWJsZXMuY29uc3VtZSggeyBhdHRyaWJ1dGVzOiBbIFsgJ3RpdGxlJyBdLCBbICdjbGFzcycsICdmb28nIF0sIFsgJ3N0eWxlJywgJ2NvbG9yJyBdIF0gfSApO1xuXHQgKiBjb25zdW1hYmxlcy5jb25zdW1lKCB7IGF0dHJpYnV0ZXM6IFsgWyAndGl0bGUnIF0sIFsgJ25hbWUnIF0sIFsgJ2NsYXNzJywgJ2ZvbycgXSwgWyAnY2xhc3MnLCAnYmFyJyBdIF0gfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGNvbnN1bWFibGVzIE9iamVjdCBkZXNjcmliaW5nIHdoaWNoIHBhcnRzIG9mIHRoZSBlbGVtZW50IHNob3VsZCBiZSBjb25zdW1lZC5cblx0ICogQHJldHVybnMgYHRydWVgIHdoZW4gYWxsIHRlc3RlZCBpdGVtcyBjYW4gYmUgY29uc3VtZWQgYW5kIGBmYWxzZWAgd2hlbiBldmVuIG9uZSBvZiB0aGUgaXRlbXMgY291bGQgbm90IGJlIGNvbnN1bWVkLlxuXHQgKi8gY29uc3VtZShjb25zdW1hYmxlcykge1xuICAgICAgICBpZiAoIXRoaXMudGVzdChjb25zdW1hYmxlcykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uc3VtYWJsZXMubmFtZSkge1xuICAgICAgICAgICAgdGhpcy5fY2FuQ29uc3VtZU5hbWUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCB0b2tlbl0gb2YgY29uc3VtYWJsZXMuYXR0cmlidXRlcyl7XG4gICAgICAgICAgICAvLyBgdmFsdWVgIG11c3QgYmUgc2V0LCBiZWNhdXNlIGB0aGlzLnRlc3QoKWAgcmV0dXJuZWQgYHRydWVgLlxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9hdHRyaWJ1dGVzLmdldChuYW1lKTtcbiAgICAgICAgICAgIC8vIFBsYWluIChub3QgdG9rZW5pemVkKSBub3QtY29uc3VtZWQgYXR0cmlidXRlLlxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgRWxlbWVudCBBUEkgdG8gY29sbGVjdCByZWxhdGVkIGF0dHJpYnV0ZXMuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBbdG9Db25zdW1lXSBvZiB0aGlzLmVsZW1lbnQuX2dldENvbnN1bWFibGVzKG5hbWUsIHRva2VuKS5hdHRyaWJ1dGVzKXtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlcy5zZXQodG9Db25zdW1lLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAvLyBUb2tlbml6ZWQgYXR0cmlidXRlIGJ1dCB0b2tlbiBpcyBub3Qgc3BlY2lmaWVkIHNvIGNvbnN1bWUgYWxsIHRva2Vucy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHZhbHVlLmtleXMoKSl7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLnNldCh0b2tlbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlIEVsZW1lbnQgQVBJIHRvIGNvbGxlY3QgcmVsYXRlZCBhdHRyaWJ1dGUgdG9rZW5zLlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgWywgdG9Db25zdW1lXSBvZiB0aGlzLmVsZW1lbnQuX2dldENvbnN1bWFibGVzKG5hbWUsIHRva2VuKS5hdHRyaWJ1dGVzKXtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2V0KHRvQ29uc3VtZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldmVydCBhbHJlYWR5IGNvbnN1bWVkIHBhcnRzIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgRWxlbWVudH0sIHNvIHRoZXkgY2FuIGJlIGNvbnN1bWVkIG9uY2UgYWdhaW4uXG5cdCAqIEVsZW1lbnQncyBuYW1lIGNhbiBiZSByZXZlcnRlZDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3VtYWJsZXMucmV2ZXJ0KCB7IG5hbWU6IHRydWUgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQXR0cmlidXRlcyBjbGFzc2VzIGFuZCBzdHlsZXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN1bWFibGVzLnJldmVydCggeyBhdHRyaWJ1dGVzOiBbIFsgJ3RpdGxlJyBdLCBbICdjbGFzcycsICdmb28nIF0sIFsgJ3N0eWxlJywgJ2NvbG9yJyBdIF0gfSApO1xuXHQgKiBjb25zdW1hYmxlcy5yZXZlcnQoIHsgYXR0cmlidXRlczogWyBbICd0aXRsZScgXSwgWyAnbmFtZScgXSwgWyAnY2xhc3MnLCAnZm9vJyBdLCBbICdjbGFzcycsICdiYXInIF0gXSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZXMgT2JqZWN0IGRlc2NyaWJpbmcgd2hpY2ggcGFydHMgb2YgdGhlIGVsZW1lbnQgc2hvdWxkIGJlIHJldmVydGVkLlxuXHQgKi8gcmV2ZXJ0KGNvbnN1bWFibGVzKSB7XG4gICAgICAgIGlmIChjb25zdW1hYmxlcy5uYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9jYW5Db25zdW1lTmFtZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgdG9rZW5dIG9mIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9hdHRyaWJ1dGVzLmdldChuYW1lKTtcbiAgICAgICAgICAgIC8vIFBsYWluIGNvbnN1bWVkIGF0dHJpYnV0ZS5cbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdHRyaWJ1dGVzLnNldChuYW1lLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFVua25vd24gYXR0cmlidXRlIG9yIG5vdCBjb25zdW1lZC5cbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgICAgICAgICAgLy8gVG9rZW5pemVkIGF0dHJpYnV0ZSBidXQgdG9rZW4gaXMgbm90IHNwZWNpZmllZCBzbyByZXZlcnQgYWxsIHRva2Vucy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHZhbHVlLmtleXMoKSl7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLnNldCh0b2tlbiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2tlblZhbHVlID0gdmFsdWUuZ2V0KHRva2VuKTtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW5WYWx1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuc2V0KHRva2VuLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBOb3RlIHRoYXQgcmV2ZXJ0IG9mIGNvbnN1bWVkIHJlbGF0ZWQgc3R5bGVzIGlzIG5vdCBoYW5kbGVkLlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBOb3JtYWxpemVzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5Db25zdW1hYmxlc30gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNofVxuICogdG8gYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+Tm9ybWFsaXplZENvbnN1bWFibGVzfS5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVDb25zdW1hYmxlcyhjb25zdW1hYmxlcykge1xuICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgICBpZiAoJ2F0dHJpYnV0ZXMnIGluIGNvbnN1bWFibGVzICYmIGNvbnN1bWFibGVzLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgbm9ybWFsaXplQ29uc3VtYWJsZVBhcnQoYXR0cmlidXRlcywgY29uc3VtYWJsZXMuYXR0cmlidXRlcyk7XG4gICAgfVxuICAgIGlmICgnY2xhc3NlcycgaW4gY29uc3VtYWJsZXMgJiYgY29uc3VtYWJsZXMuY2xhc3Nlcykge1xuICAgICAgICBub3JtYWxpemVDb25zdW1hYmxlUGFydChhdHRyaWJ1dGVzLCBjb25zdW1hYmxlcy5jbGFzc2VzLCAnY2xhc3MnKTtcbiAgICB9XG4gICAgaWYgKCdzdHlsZXMnIGluIGNvbnN1bWFibGVzICYmIGNvbnN1bWFibGVzLnN0eWxlcykge1xuICAgICAgICBub3JtYWxpemVDb25zdW1hYmxlUGFydChhdHRyaWJ1dGVzLCBjb25zdW1hYmxlcy5zdHlsZXMsICdzdHlsZScpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBjb25zdW1hYmxlcy5uYW1lIHx8IGZhbHNlLFxuICAgICAgICBhdHRyaWJ1dGVzXG4gICAgfTtcbn1cbi8qKlxuICogTm9ybWFsaXplcyBhIGxpc3Qgb2YgY29uc3VtYWJsZSBhdHRyaWJ1dGVzIHRvIGEgY29tbW9uIHR1cGxlIGZvcm1hdC5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVDb25zdW1hYmxlUGFydChhdHRyaWJ1dGVzLCBpdGVtcywgcHJlZml4KSB7XG4gICAgaWYgKHR5cGVvZiBpdGVtcyA9PSAnc3RyaW5nJykge1xuICAgICAgICBhdHRyaWJ1dGVzLnB1c2gocHJlZml4ID8gW1xuICAgICAgICAgICAgcHJlZml4LFxuICAgICAgICAgICAgaXRlbXNcbiAgICAgICAgXSA6IFtcbiAgICAgICAgICAgIGl0ZW1zXG4gICAgICAgIF0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcyl7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0pKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goaXRlbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2gocHJlZml4ID8gW1xuICAgICAgICAgICAgICAgIHByZWZpeCxcbiAgICAgICAgICAgICAgICBpdGVtXG4gICAgICAgICAgICBdIDogW1xuICAgICAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFZpZXcgbWF0Y2hlciBjbGFzcy5cbiAqIEluc3RhbmNlIG9mIHRoaXMgY2xhc3MgY2FuIGJlIHVzZWQgdG8gZmluZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50c30gdGhhdCBtYXRjaCBnaXZlbiBwYXR0ZXJuLlxuICovIGNsYXNzIE1hdGNoZXIge1xuICAgIF9wYXR0ZXJucyA9IFtdO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBpbnN0YW5jZSBvZiBNYXRjaGVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gcGF0dGVybiBNYXRjaCBwYXR0ZXJucy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyI2FkZCBhZGQgbWV0aG9kfSBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cblx0ICovIGNvbnN0cnVjdG9yKC4uLnBhdHRlcm4pe1xuICAgICAgICB0aGlzLmFkZCguLi5wYXR0ZXJuKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgcGF0dGVybiBvciBwYXR0ZXJucyB0byBtYXRjaGVyIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBTdHJpbmcuXG5cdCAqIG1hdGNoZXIuYWRkKCAnZGl2JyApO1xuXHQgKlxuXHQgKiAvLyBSZWd1bGFyIGV4cHJlc3Npb24uXG5cdCAqIG1hdGNoZXIuYWRkKCAvXlxcdy8gKTtcblx0ICpcblx0ICogLy8gU2luZ2xlIGNsYXNzLlxuXHQgKiBtYXRjaGVyLmFkZCgge1xuXHQgKiBcdGNsYXNzZXM6ICdmb29iYXInXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlclBhdHRlcm59IGZvciBtb3JlIGV4YW1wbGVzLlxuXHQgKlxuXHQgKiBNdWx0aXBsZSBwYXR0ZXJucyBjYW4gYmUgYWRkZWQgaW4gb25lIGNhbGw6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIG1hdGNoZXIuYWRkKCAnZGl2JywgeyBjbGFzc2VzOiAnZm9vYmFyJyB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gcGF0dGVybiBPYmplY3QgZGVzY3JpYmluZyBwYXR0ZXJuIGRldGFpbHMuIElmIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb25cblx0ICogaXMgcHJvdmlkZWQgaXQgd2lsbCBiZSB1c2VkIHRvIG1hdGNoIGVsZW1lbnQncyBuYW1lLiBQYXR0ZXJuIGNhbiBiZSBhbHNvIHByb3ZpZGVkIGluIGEgZm9ybVxuXHQgKiBvZiBhIGZ1bmN0aW9uIC0gdGhlbiB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdpdGggZWFjaCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSBhcyBhIHBhcmFtZXRlci5cblx0ICogRnVuY3Rpb24ncyByZXR1cm4gdmFsdWUgd2lsbCBiZSBzdG9yZWQgdW5kZXIgYG1hdGNoYCBrZXkgb2YgdGhlIG9iamVjdCByZXR1cm5lZCBmcm9tXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyI21hdGNoIG1hdGNofSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlciNtYXRjaEFsbCBtYXRjaEFsbH0gbWV0aG9kcy5cblx0ICovIGFkZCguLi5wYXR0ZXJuKSB7XG4gICAgICAgIGZvciAobGV0IGl0ZW0gb2YgcGF0dGVybil7XG4gICAgICAgICAgICAvLyBTdHJpbmcgb3IgUmVnRXhwIHBhdHRlcm4gaXMgdXNlZCBhcyBlbGVtZW50J3MgbmFtZS5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PSAnc3RyaW5nJyB8fCBpdGVtIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9wYXR0ZXJucy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYXRjaGVzIGVsZW1lbnRzIGZvciBjdXJyZW50bHkgc3RvcmVkIHBhdHRlcm5zLiBSZXR1cm5zIG1hdGNoIGluZm9ybWF0aW9uIGFib3V0IGZpcnN0IGZvdW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9LCBvdGhlcndpc2UgcmV0dXJucyBgbnVsbGAuXG5cdCAqXG5cdCAqIEV4YW1wbGUgb2YgcmV0dXJuZWQgb2JqZWN0OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB7XG5cdCAqIFx0ZWxlbWVudDogPGluc3RhbmNlIG9mIGZvdW5kIGVsZW1lbnQ+LFxuXHQgKiBcdHBhdHRlcm46IDxwYXR0ZXJuIHVzZWQgdG8gbWF0Y2ggZm91bmQgZWxlbWVudD4sXG5cdCAqIFx0bWF0Y2g6IHtcblx0ICogXHRcdG5hbWU6IHRydWUsXG5cdCAqIFx0XHRhdHRyaWJ1dGVzOiBbXG5cdCAqIFx0XHRcdFsgJ3RpdGxlJyBdLFxuXHQgKiBcdFx0XHRbICdocmVmJyBdLFxuXHQgKiBcdFx0XHRbICdjbGFzcycsICdmb28nIF0sXG5cdCAqIFx0XHRcdFsgJ3N0eWxlJywgJ2NvbG9yJyBdLFxuXHQgKiBcdFx0XHRbICdzdHlsZScsICdwb3NpdGlvbicgXVxuXHQgKiBcdFx0XVxuXHQgKiBcdH1cblx0ICogfVxuXHQgKiBgYGBcblx0ICpcblx0ICogWW91IGNvdWxkIHVzZSB0aGUgYG1hdGNoYCBmaWVsZCBmcm9tIHRoZSBhYm92ZSByZXR1cm5lZCBvYmplY3QgYXMgYW4gaW5wdXQgZm9yIHRoZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI3Rlc3QgYFZpZXdDb25zdW1hYmxlI3Rlc3QoKWB9IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlI2NvbnN1bWUgYFZpZXdDb25zdW1hYmxlI2NvbnN1bWUoKWB9IG1ldGhvZHMuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlciNhZGRcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyI21hdGNoQWxsXG5cdCAqIEBwYXJhbSBlbGVtZW50IFZpZXcgZWxlbWVudCB0byBtYXRjaCBhZ2FpbnN0IHN0b3JlZCBwYXR0ZXJucy5cblx0ICogQHJldHVybnMgVGhlIG1hdGNoIGluZm9ybWF0aW9uIGFib3V0IGZvdW5kIGVsZW1lbnQgb3IgYG51bGxgLlxuXHQgKi8gbWF0Y2goLi4uZWxlbWVudCkge1xuICAgICAgICBmb3IgKGNvbnN0IHNpbmdsZUVsZW1lbnQgb2YgZWxlbWVudCl7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgdGhpcy5fcGF0dGVybnMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gdGhpcy5faXNFbGVtZW50TWF0Y2hpbmcoc2luZ2xlRWxlbWVudCwgcGF0dGVybik7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiBzaW5nbGVFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogTWF0Y2hlcyBlbGVtZW50cyBmb3IgY3VycmVudGx5IHN0b3JlZCBwYXR0ZXJucy4gUmV0dXJucyBhcnJheSBvZiBtYXRjaCBpbmZvcm1hdGlvbiB3aXRoIGFsbCBmb3VuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50c30uIElmIG5vIGVsZW1lbnQgaXMgZm91bmQgLSByZXR1cm5zIGBudWxsYC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyI2FkZFxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXIjbWF0Y2hcblx0ICogQHBhcmFtIGVsZW1lbnQgVmlldyBlbGVtZW50IHRvIG1hdGNoIGFnYWluc3Qgc3RvcmVkIHBhdHRlcm5zLlxuXHQgKiBAcmV0dXJucyBBcnJheSB3aXRoIG1hdGNoIGluZm9ybWF0aW9uIGFib3V0IGZvdW5kIGVsZW1lbnRzIG9yIGBudWxsYC4gRm9yIG1vcmUgaW5mb3JtYXRpb25cblx0ICogc2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyI21hdGNoIG1hdGNoIG1ldGhvZH0gZGVzY3JpcHRpb24uXG5cdCAqLyBtYXRjaEFsbCguLi5lbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBzaW5nbGVFbGVtZW50IG9mIGVsZW1lbnQpe1xuICAgICAgICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRoaXMuX3BhdHRlcm5zKXtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IHRoaXMuX2lzRWxlbWVudE1hdGNoaW5nKHNpbmdsZUVsZW1lbnQsIHBhdHRlcm4pO1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogc2luZ2xlRWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm4sXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdHMubGVuZ3RoID4gMCA/IHJlc3VsdHMgOiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgZWxlbWVudCB0byBtYXRjaCBpZiB0aGVyZSBpcyBleGFjdGx5IG9uZSBwYXR0ZXJuIGFkZGVkIHRvIHRoZSBtYXRjaGVyIGluc3RhbmNlXG5cdCAqIGFuZCBpdCBtYXRjaGVzIGVsZW1lbnQgbmFtZSBkZWZpbmVkIGJ5IGBzdHJpbmdgIChub3QgYFJlZ0V4cGApLiBPdGhlcndpc2UsIHJldHVybnMgYG51bGxgLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBFbGVtZW50IG5hbWUgdHJ5aW5nIHRvIG1hdGNoLlxuXHQgKi8gZ2V0RWxlbWVudE5hbWUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9wYXR0ZXJucy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdHRlcm4gPSB0aGlzLl9wYXR0ZXJuc1swXTtcbiAgICAgICAgY29uc3QgbmFtZSA9IHBhdHRlcm4ubmFtZTtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBwYXR0ZXJuICE9ICdmdW5jdGlvbicgJiYgbmFtZSAmJiAhKG5hbWUgaW5zdGFuY2VvZiBSZWdFeHApID8gbmFtZSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIG1hdGNoIGluZm9ybWF0aW9uIGlmIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IGlzIG1hdGNoaW5nIHByb3ZpZGVkIHBhdHRlcm4uXG5cdCAqIElmIGVsZW1lbnQgY2Fubm90IGJlIG1hdGNoZWQgdG8gcHJvdmlkZWQgcGF0dGVybiAtIHJldHVybnMgYG51bGxgLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBSZXR1cm5zIG9iamVjdCB3aXRoIG1hdGNoIGluZm9ybWF0aW9uIG9yIG51bGwgaWYgZWxlbWVudCBpcyBub3QgbWF0Y2hpbmcuXG5cdCAqLyBfaXNFbGVtZW50TWF0Y2hpbmcoZWxlbWVudCwgcGF0dGVybikge1xuICAgICAgICAvLyBJZiBwYXR0ZXJuIGlzIHByb3ZpZGVkIGFzIGZ1bmN0aW9uIC0gcmV0dXJuIHJlc3VsdCBvZiB0aGF0IGZ1bmN0aW9uO1xuICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBwYXR0ZXJuKGVsZW1lbnQpO1xuICAgICAgICAgICAgLy8gSW4gc29tZSBwbGFjZXMgd2UgdXNlIE1hdGNoZXIgd2l0aCBjYWxsYmFjayBwYXR0ZXJuIHRoYXQgcmV0dXJucyBib29sZWFuLlxuICAgICAgICAgICAgaWYgKCFtYXRjaCB8fCB0eXBlb2YgbWF0Y2ggIT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplQ29uc3VtYWJsZXMobWF0Y2gpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hdGNoID0ge307XG4gICAgICAgIC8vIENoZWNrIGVsZW1lbnQncyBuYW1lLlxuICAgICAgICBpZiAocGF0dGVybi5uYW1lKSB7XG4gICAgICAgICAgICBtYXRjaC5uYW1lID0gbWF0Y2hOYW1lKHBhdHRlcm4ubmFtZSwgZWxlbWVudC5uYW1lKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gubmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXNNYXRjaCA9IFtdO1xuICAgICAgICAvLyBDaGVjayBlbGVtZW50J3MgYXR0cmlidXRlcy5cbiAgICAgICAgaWYgKHBhdHRlcm4uYXR0cmlidXRlcyAmJiAhbWF0Y2hBdHRyaWJ1dGVzKHBhdHRlcm4uYXR0cmlidXRlcywgZWxlbWVudCwgYXR0cmlidXRlc01hdGNoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgZWxlbWVudCdzIGNsYXNzZXMuXG4gICAgICAgIGlmIChwYXR0ZXJuLmNsYXNzZXMgJiYgIW1hdGNoQ2xhc3NlcyhwYXR0ZXJuLmNsYXNzZXMsIGVsZW1lbnQsIGF0dHJpYnV0ZXNNYXRjaCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGVsZW1lbnQncyBzdHlsZXMuXG4gICAgICAgIGlmIChwYXR0ZXJuLnN0eWxlcyAmJiAhbWF0Y2hTdHlsZXMocGF0dGVybi5zdHlsZXMsIGVsZW1lbnQsIGF0dHJpYnV0ZXNNYXRjaCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vdGUgdGhlIGBhdHRyaWJ1dGVzTWF0Y2hgIGFycmF5IGlzIHBvcHVsYXRlZCBieSB0aGUgYWJvdmUgY2FsbHMuXG4gICAgICAgIGlmIChhdHRyaWJ1dGVzTWF0Y2gubGVuZ3RoKSB7XG4gICAgICAgICAgICBtYXRjaC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlc01hdGNoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXRjaDtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gYGl0ZW1gIG1hdGNoZXMgdGhlIHBhdHRlcm4uXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gcGF0dGVybiBBIHBhdHRlcm4gcmVwcmVzZW50aW5nIGEga2V5L3ZhbHVlIHdlIHdhbnQgdG8gbWF0Y2guXG4gKiBAcGFyYW0gaXRlbSBBbiBhY3R1YWwgaXRlbSBrZXkvdmFsdWUgKGUuZy4gYCdzcmMnYCwgYCdiYWNrZ3JvdW5kLWNvbG9yJ2AsIGAnY2std2lkZ2V0J2ApIHdlJ3JlIHRlc3RpbmcgYWdhaW5zdCBwYXR0ZXJuLlxuICovIGZ1bmN0aW9uIGlzUGF0dGVybk1hdGNoZWQocGF0dGVybiwgaXRlbSkge1xuICAgIHJldHVybiBwYXR0ZXJuID09PSB0cnVlIHx8IHBhdHRlcm4gPT09IGl0ZW0gfHwgcGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCAmJiAhIVN0cmluZyhpdGVtKS5tYXRjaChwYXR0ZXJuKTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIG5hbWUgY2FuIGJlIG1hdGNoZWQgYnkgcHJvdmlkZWQgcGF0dGVybi5cbiAqXG4gKiBAcmV0dXJucyBSZXR1cm5zIGB0cnVlYCBpZiBuYW1lIGNhbiBiZSBtYXRjaGVkLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBtYXRjaE5hbWUocGF0dGVybiwgbmFtZSkge1xuICAgIC8vIElmIHBhdHRlcm4gaXMgcHJvdmlkZWQgYXMgUmVnRXhwIC0gdGVzdCBhZ2FpbnN0IHRoaXMgcmVnZXhwLlxuICAgIGlmIChwYXR0ZXJuIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgICAgIHJldHVybiAhIW5hbWUubWF0Y2gocGF0dGVybik7XG4gICAgfVxuICAgIHJldHVybiBwYXR0ZXJuID09PSBuYW1lO1xufVxuLyoqXG4gKiBCcmluZyBhbGwgdGhlIHBvc3NpYmxlIHBhdHRlcm4gZm9ybXMgdG8gYW4gYXJyYXkgb2YgdHVwbGVzIHdoZXJlIGZpcnN0IGl0ZW0gaXMgYSBrZXksIHNlY29uZCBpcyBhIHZhbHVlLFxuICogYW5kIHRoaXJkIG9wdGlvbmFsIGlzIGEgdG9rZW4gdmFsdWUuXG4gKlxuICogRXhhbXBsZXM6XG4gKlxuICogQm9vbGVhbiBwYXR0ZXJuIHZhbHVlOlxuICpcbiAqIGBgYHRzXG4gKiB0cnVlXG4gKiBgYGBcbiAqXG4gKiB0b1xuICpcbiAqIGBgYHRzXG4gKiBbIFsgdHJ1ZSwgdHJ1ZSBdIF1cbiAqIGBgYFxuICpcbiAqIFRleHR1YWwgcGF0dGVybiB2YWx1ZTpcbiAqXG4gKiBgYGB0c1xuICogJ2F0dHJpYnV0ZS1uYW1lLW9yLWNsYXNzLW9yLXN0eWxlJ1xuICogYGBgXG4gKlxuICogdG9cbiAqXG4gKiBgYGB0c1xuICogWyBbICdhdHRyaWJ1dGUtbmFtZS1vci1jbGFzcy1vci1zdHlsZScsIHRydWUgXSBdXG4gKiBgYGBcbiAqXG4gKiBSZWd1bGFyIGV4cHJlc3Npb246XG4gKlxuICogYGBgdHNcbiAqIC9eZGF0YS0uKiQvXG4gKiBgYGBcbiAqXG4gKiB0b1xuICpcbiAqIGBgYHRzXG4gKiBbIFsgL15kYXRhLS4qJC8sIHRydWUgXSBdXG4gKiBgYGBcbiAqXG4gKiBPYmplY3RzIChwbGFpbiBvciB3aXRoIGBrZXlgIGFuZCBgdmFsdWVgIHNwZWNpZmllZCBleHBsaWNpdGx5KTpcbiAqXG4gKiBgYGB0c1xuICoge1xuICogXHRzcmM6IC9eaHR0cHM6LiokL1xuICogfVxuICogYGBgXG4gKlxuICogb3JcbiAqXG4gKiBgYGB0c1xuICogWyB7XG4gKiBcdGtleTogJ3NyYycsXG4gKiBcdHZhbHVlOiAvXmh0dHBzOi4qJC9cbiAqIH0gXVxuICogYGBgXG4gKlxuICogdG86XG4gKlxuICogYGBgdHNcbiAqIFsgWyAnc3JjJywgL15odHRwczouKiQvIF0gXVxuICogYGBgXG4gKlxuICogQHJldHVybnMgUmV0dXJucyBhbiBhcnJheSBvZiBvYmplY3RzIG9yIG51bGwgaWYgcHJvdmlkZWQgcGF0dGVybnMgd2VyZSBub3QgaW4gYW4gZXhwZWN0ZWQgZm9ybS5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVQYXR0ZXJucyhwYXR0ZXJucywgcHJlZml4KSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkocGF0dGVybnMpKSB7XG4gICAgICAgIHJldHVybiBwYXR0ZXJucy5tYXAoKHBhdHRlcm4pPT57XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gIT09ICdvYmplY3QnIHx8IHBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ID8gW1xuICAgICAgICAgICAgICAgICAgICBwcmVmaXgsXG4gICAgICAgICAgICAgICAgICAgIHBhdHRlcm4sXG4gICAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICBdIDogW1xuICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuLFxuICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXR0ZXJuLmtleSA9PT0gdW5kZWZpbmVkIHx8IHBhdHRlcm4udmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIERvY3VtZW50ZWQgYXQgdGhlIGVuZCBvZiBtYXRjaGVyLmpzLlxuICAgICAgICAgICAgICAgIGxvZ1dhcm5pbmcoJ21hdGNoZXItcGF0dGVybi1taXNzaW5nLWtleS1vci12YWx1ZScsIHBhdHRlcm4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCA/IFtcbiAgICAgICAgICAgICAgICBwcmVmaXgsXG4gICAgICAgICAgICAgICAgcGF0dGVybi5rZXksXG4gICAgICAgICAgICAgICAgcGF0dGVybi52YWx1ZVxuICAgICAgICAgICAgXSA6IFtcbiAgICAgICAgICAgICAgICBwYXR0ZXJuLmtleSxcbiAgICAgICAgICAgICAgICBwYXR0ZXJuLnZhbHVlXG4gICAgICAgICAgICBdO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwYXR0ZXJucyAhPT0gJ29iamVjdCcgfHwgcGF0dGVybnMgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHByZWZpeCA/IFtcbiAgICAgICAgICAgICAgICBwcmVmaXgsXG4gICAgICAgICAgICAgICAgcGF0dGVybnMsXG4gICAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgXSA6IFtcbiAgICAgICAgICAgICAgICBwYXR0ZXJucyxcbiAgICAgICAgICAgICAgICB0cnVlXG4gICAgICAgICAgICBdXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIEJlbG93IHdlIGRvIHdoYXQgT2JqZWN0LmVudHJpZXMoKSBkb2VzLCBidXQgZmFzdGVyXG4gICAgY29uc3Qgbm9ybWFsaXplZFBhdHRlcm5zID0gW107XG4gICAgZm9yKGNvbnN0IGtleSBpbiBwYXR0ZXJucyl7XG4gICAgICAgIC8vIFJlcGxhY2Ugd2l0aCBPYmplY3QuaGFzT3duKCkgd2hlbiB3ZSB1cGdyYWRlIHRvIGVzMjAyMi5cbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChwYXR0ZXJucywga2V5KSkge1xuICAgICAgICAgICAgbm9ybWFsaXplZFBhdHRlcm5zLnB1c2gocHJlZml4ID8gW1xuICAgICAgICAgICAgICAgIHByZWZpeCxcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgcGF0dGVybnNba2V5XVxuICAgICAgICAgICAgXSA6IFtcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgcGF0dGVybnNba2V5XVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5vcm1hbGl6ZWRQYXR0ZXJucztcbn1cbi8qKlxuICogQ2hlY2tzIGlmIGF0dHJpYnV0ZXMgb2YgcHJvdmlkZWQgZWxlbWVudCBjYW4gYmUgbWF0Y2hlZCBhZ2FpbnN0IHByb3ZpZGVkIHBhdHRlcm5zLlxuICpcbiAqIEBwYXJhbSBwYXR0ZXJucyBPYmplY3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCBhdHRyaWJ1dGVzIHRvIG1hdGNoLiBFYWNoIGtleSBvZiB0aGUgb2JqZWN0IHdpbGwgYmVcbiAqIHVzZWQgYXMgYXR0cmlidXRlIG5hbWUuIFZhbHVlIG9mIGVhY2gga2V5IGNhbiBiZSBhIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggYWdhaW5zdCBhdHRyaWJ1dGUgdmFsdWUuXG4gKiBAcGFyYW0gIGVsZW1lbnQgRWxlbWVudCB3aGljaCBhdHRyaWJ1dGVzIHdpbGwgYmUgdGVzdGVkLlxuICogQHBhcmFtIG1hdGNoIEFuIGFycmF5IHRvIHBvcHVsYXRlIHdpdGggbWF0Y2hpbmcgdHVwbGVzLlxuICogQHJldHVybnMgUmV0dXJucyBhcnJheSB3aXRoIG1hdGNoZWQgYXR0cmlidXRlIG5hbWVzIG9yIGBudWxsYCBpZiBubyBhdHRyaWJ1dGVzIHdlcmUgbWF0Y2hlZC5cbiAqLyBmdW5jdGlvbiBtYXRjaEF0dHJpYnV0ZXMocGF0dGVybnMsIGVsZW1lbnQsIG1hdGNoKSB7XG4gICAgbGV0IGV4Y2x1ZGVBdHRyaWJ1dGVzO1xuICAgIC8vIGBzdHlsZWAgYW5kIGBjbGFzc2AgYXR0cmlidXRlIGtleXMgYXJlIGRlcHJlY2F0ZWQuIE9ubHkgYWxsb3cgdGhlbSBpbiBvYmplY3QgcGF0dGVyblxuICAgIC8vIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LlxuICAgIGlmICh0eXBlb2YgcGF0dGVybnMgPT09ICdvYmplY3QnICYmICEocGF0dGVybnMgaW5zdGFuY2VvZiBSZWdFeHApICYmICFBcnJheS5pc0FycmF5KHBhdHRlcm5zKSkge1xuICAgICAgICBpZiAocGF0dGVybnMuc3R5bGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gRG9jdW1lbnRlZCBhdCB0aGUgZW5kIG9mIG1hdGNoZXIuanMuXG4gICAgICAgICAgICBsb2dXYXJuaW5nKCdtYXRjaGVyLXBhdHRlcm4tZGVwcmVjYXRlZC1hdHRyaWJ1dGVzLXN0eWxlLWtleScsIHBhdHRlcm5zKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0dGVybnMuY2xhc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gRG9jdW1lbnRlZCBhdCB0aGUgZW5kIG9mIG1hdGNoZXIuanMuXG4gICAgICAgICAgICBsb2dXYXJuaW5nKCdtYXRjaGVyLXBhdHRlcm4tZGVwcmVjYXRlZC1hdHRyaWJ1dGVzLWNsYXNzLWtleScsIHBhdHRlcm5zKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGV4Y2x1ZGVBdHRyaWJ1dGVzID0gW1xuICAgICAgICAgICAgJ2NsYXNzJyxcbiAgICAgICAgICAgICdzdHlsZSdcbiAgICAgICAgXTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQuX2NvbGxlY3RBdHRyaWJ1dGVzTWF0Y2gobm9ybWFsaXplUGF0dGVybnMocGF0dGVybnMpLCBtYXRjaCwgZXhjbHVkZUF0dHJpYnV0ZXMpO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgY2xhc3NlcyBvZiBwcm92aWRlZCBlbGVtZW50IGNhbiBiZSBtYXRjaGVkIGFnYWluc3QgcHJvdmlkZWQgcGF0dGVybnMuXG4gKlxuICogQHBhcmFtIHBhdHRlcm5zIEFycmF5IG9mIHN0cmluZ3Mgb3IgcmVndWxhciBleHByZXNzaW9ucyB0byBtYXRjaCBhZ2FpbnN0IGVsZW1lbnQncyBjbGFzc2VzLlxuICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBjbGFzc2VzIHdpbGwgYmUgdGVzdGVkLlxuICogQHBhcmFtIG1hdGNoIEFuIGFycmF5IHRvIHBvcHVsYXRlIHdpdGggbWF0Y2hpbmcgdHVwbGVzLlxuICogQHJldHVybnMgUmV0dXJucyBhcnJheSB3aXRoIG1hdGNoZWQgY2xhc3MgbmFtZXMgb3IgYG51bGxgIGlmIG5vIGNsYXNzZXMgd2VyZSBtYXRjaGVkLlxuICovIGZ1bmN0aW9uIG1hdGNoQ2xhc3NlcyhwYXR0ZXJucywgZWxlbWVudCwgbWF0Y2gpIHtcbiAgICByZXR1cm4gZWxlbWVudC5fY29sbGVjdEF0dHJpYnV0ZXNNYXRjaChub3JtYWxpemVQYXR0ZXJucyhwYXR0ZXJucywgJ2NsYXNzJyksIG1hdGNoKTtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHN0eWxlcyBvZiBwcm92aWRlZCBlbGVtZW50IGNhbiBiZSBtYXRjaGVkIGFnYWluc3QgcHJvdmlkZWQgcGF0dGVybnMuXG4gKlxuICogQHBhcmFtIHBhdHRlcm5zIE9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHN0eWxlcyB0byBtYXRjaC4gRWFjaCBrZXkgb2YgdGhlIG9iamVjdCB3aWxsIGJlXG4gKiB1c2VkIGFzIHN0eWxlIG5hbWUuIFZhbHVlIG9mIGVhY2gga2V5IGNhbiBiZSBhIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb24gdG8gbWF0Y2ggYWdhaW5zdCBzdHlsZSB2YWx1ZS5cbiAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgd2hpY2ggc3R5bGVzIHdpbGwgYmUgdGVzdGVkLlxuICogQHBhcmFtIG1hdGNoIEFuIGFycmF5IHRvIHBvcHVsYXRlIHdpdGggbWF0Y2hpbmcgdHVwbGVzLlxuICogQHJldHVybnMgUmV0dXJucyBhcnJheSB3aXRoIG1hdGNoZWQgc3R5bGUgbmFtZXMgb3IgYG51bGxgIGlmIG5vIHN0eWxlcyB3ZXJlIG1hdGNoZWQuXG4gKi8gZnVuY3Rpb24gbWF0Y2hTdHlsZXMocGF0dGVybnMsIGVsZW1lbnQsIG1hdGNoKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQuX2NvbGxlY3RBdHRyaWJ1dGVzTWF0Y2gobm9ybWFsaXplUGF0dGVybnMocGF0dGVybnMsICdzdHlsZScpLCBtYXRjaCk7XG59XG4gLyoqXG4gKiBUaGUga2V5LXZhbHVlIG1hdGNoZXIgcGF0dGVybiBpcyBtaXNzaW5nIGtleSBvciB2YWx1ZS4gQm90aCBtdXN0IGJlIHByZXNlbnQuXG4gKiBSZWZlciB0aGUgZG9jdW1lbnRhdGlvbjoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXJQYXR0ZXJufS5cbiAqXG4gKiBAcGFyYW0gcGF0dGVybiBQYXR0ZXJuIHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLlxuICogQGVycm9yIG1hdGNoZXItcGF0dGVybi1taXNzaW5nLWtleS1vci12YWx1ZVxuICovICAvKipcbiAqIFRoZSBrZXktdmFsdWUgbWF0Y2hlciBwYXR0ZXJuIGZvciBgYXR0cmlidXRlc2Agb3B0aW9uIGlzIHVzaW5nIGRlcHJlY2F0ZWQgYHN0eWxlYCBrZXkuXG4gKlxuICogVXNlIGBzdHlsZXNgIG1hdGNoZXIgcGF0dGVybiBvcHRpb24gaW5zdGVhZDpcbiAqXG4gKiBgYGB0c1xuICogLy8gSW5zdGVhZCBvZjpcbiAqIGNvbnN0IHBhdHRlcm4gPSB7XG4gKiBcdGF0dHJpYnV0ZXM6IHtcbiAqIFx0XHRrZXkxOiAndmFsdWUxJyxcbiAqIFx0XHRrZXkyOiAndmFsdWUyJyxcbiAqIFx0XHRzdHlsZTogL15ib3JkZXIuKiQvXG4gKiBcdH1cbiAqIH1cbiAqXG4gKiAvLyBVc2U6XG4gKiBjb25zdCBwYXR0ZXJuID0ge1xuICogXHRhdHRyaWJ1dGVzOiB7XG4gKiBcdFx0a2V5MTogJ3ZhbHVlMScsXG4gKiBcdFx0a2V5MjogJ3ZhbHVlMidcbiAqIFx0fSxcbiAqIFx0c3R5bGVzOiAvXmJvcmRlci4qJC9cbiAqIH1cbiAqIGBgYFxuICpcbiAqIFJlZmVyIHRvIHRoZSB7QGdsaW5rIHVwZGF0aW5nL2d1aWRlcy91cGRhdGUtdG8tMjkjI3VwZGF0ZS10by1ja2VkaXRvci01LXYyOTEwIE1pZ3JhdGlvbiB0byB2MjkuMS4wfSBndWlkZVxuICogYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyUGF0dGVybn0gZG9jdW1lbnRhdGlvbi5cbiAqXG4gKiBAcGFyYW0gcGF0dGVybiBQYXR0ZXJuIHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLlxuICogQGVycm9yIG1hdGNoZXItcGF0dGVybi1kZXByZWNhdGVkLWF0dHJpYnV0ZXMtc3R5bGUta2V5XG4gKi8gIC8qKlxuICogVGhlIGtleS12YWx1ZSBtYXRjaGVyIHBhdHRlcm4gZm9yIGBhdHRyaWJ1dGVzYCBvcHRpb24gaXMgdXNpbmcgZGVwcmVjYXRlZCBgY2xhc3NgIGtleS5cbiAqXG4gKiBVc2UgYGNsYXNzZXNgIG1hdGNoZXIgcGF0dGVybiBvcHRpb24gaW5zdGVhZDpcbiAqXG4gKiBgYGB0c1xuICogLy8gSW5zdGVhZCBvZjpcbiAqIGNvbnN0IHBhdHRlcm4gPSB7XG4gKiBcdGF0dHJpYnV0ZXM6IHtcbiAqIFx0XHRrZXkxOiAndmFsdWUxJyxcbiAqIFx0XHRrZXkyOiAndmFsdWUyJyxcbiAqIFx0XHRjbGFzczogJ2Zvb2JhcidcbiAqIFx0fVxuICogfVxuICpcbiAqIC8vIFVzZTpcbiAqIGNvbnN0IHBhdHRlcm4gPSB7XG4gKiBcdGF0dHJpYnV0ZXM6IHtcbiAqIFx0XHRrZXkxOiAndmFsdWUxJyxcbiAqIFx0XHRrZXkyOiAndmFsdWUyJ1xuICogXHR9LFxuICogXHRjbGFzc2VzOiAnZm9vYmFyJ1xuICogfVxuICogYGBgXG4gKlxuICogUmVmZXIgdG8gdGhlIHtAZ2xpbmsgdXBkYXRpbmcvZ3VpZGVzL3VwZGF0ZS10by0yOSMjdXBkYXRlLXRvLWNrZWRpdG9yLTUtdjI5MTAgTWlncmF0aW9uIHRvIHYyOS4xLjB9IGd1aWRlXG4gKiBhbmQgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyUGF0dGVybn0gZG9jdW1lbnRhdGlvbi5cbiAqXG4gKiBAcGFyYW0gcGF0dGVybiBQYXR0ZXJuIHdpdGggbWlzc2luZyBwcm9wZXJ0aWVzLlxuICogQGVycm9yIG1hdGNoZXItcGF0dGVybi1kZXByZWNhdGVkLWF0dHJpYnV0ZXMtY2xhc3Mta2V5XG4gKi9cblxuLyoqXG4gKiBTdHlsZXMgbWFwLiBBbGxvd3MgaGFuZGxpbmcgKGFkZGluZywgcmVtb3ZpbmcsIHJldHJpZXZpbmcpIGEgc2V0IG9mIHN0eWxlIHJ1bGVzICh1c3VhbGx5LCBvZiBhbiBlbGVtZW50KS5cbiAqLyBjbGFzcyBTdHlsZXNNYXAge1xuICAgIC8qKlxuXHQgKiBLZWVwcyBhbiBpbnRlcm5hbCByZXByZXNlbnRhdGlvbiBvZiBzdHlsZXMgbWFwLiBOb3JtYWxpemVkIHN0eWxlcyBhcmUga2VwdCBhcyBvYmplY3QgdHJlZSB0byBhbGxvdyB1bmlmaWVkIG1vZGlmaWNhdGlvbiBhbmRcblx0ICogdmFsdWUgYWNjZXNzIG1vZGVsIHVzaW5nIGxvZGFzaCdzIGdldCwgc2V0LCB1bnNldCwgZXRjIG1ldGhvZHMuXG5cdCAqXG5cdCAqIFdoZW4gbm8gc3R5bGUgcHJvY2Vzc29yIHJ1bGVzIGFyZSBkZWZpbmVkIGl0IGFjdHMgYXMgc2ltcGxlIGtleS12YWx1ZSBzdG9yYWdlLlxuXHQgKi8gX3N0eWxlcztcbiAgICAvKipcblx0ICogQ2FjaGVkIGxpc3Qgb2Ygc3R5bGUgbmFtZXMgZm9yIGZhc3RlciBhY2Nlc3MuXG5cdCAqLyBfY2FjaGVkU3R5bGVOYW1lcyA9IG51bGw7XG4gICAgLyoqXG5cdCAqIENhY2hlZCBsaXN0IG9mIGV4cGFuZGVkIHN0eWxlIG5hbWVzIGZvciBmYXN0ZXIgYWNjZXNzLlxuXHQgKi8gX2NhY2hlZEV4cGFuZGVkU3R5bGVOYW1lcyA9IG51bGw7XG4gICAgLyoqXG5cdCAqIEFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlc21hcH5TdHlsZXNQcm9jZXNzb3J9LlxuXHQgKi8gX3N0eWxlUHJvY2Vzc29yO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIFN0eWxlcyBpbnN0YW5jZS5cblx0ICovIGNvbnN0cnVjdG9yKHN0eWxlUHJvY2Vzc29yKXtcbiAgICAgICAgdGhpcy5fc3R5bGVzID0ge307XG4gICAgICAgIHRoaXMuX3N0eWxlUHJvY2Vzc29yID0gc3R5bGVQcm9jZXNzb3I7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgc3R5bGUgbWFwIGhhcyBubyBzdHlsZXMgc2V0LlxuXHQgKi8gZ2V0IGlzRW1wdHkoKSB7XG4gICAgICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyh0aGlzLl9zdHlsZXMpO1xuICAgICAgICByZXR1cm4gIWVudHJpZXMubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcblx0ICogTnVtYmVyIG9mIHN0eWxlcyBkZWZpbmVkLlxuXHQgKi8gZ2V0IHNpemUoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRW1wdHkpIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlTmFtZXMoKS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXQgc3R5bGVzIG1hcCB0byBhIG5ldyB2YWx1ZS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVzLnNldFRvKCAnYm9yZGVyOjFweCBzb2xpZCBibHVlO21hcmdpbi10b3A6MXB4OycgKTtcblx0ICogYGBgXG5cdCAqLyBzZXRUbyhpbmxpbmVTdHlsZSkge1xuICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIGNvbnN0IHBhcnNlZFN0eWxlcyA9IHBhcnNlSW5saW5lU3R5bGVzKGlubGluZVN0eWxlKTtcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgcGFyc2VkU3R5bGVzKXtcbiAgICAgICAgICAgIHRoaXMuX3N0eWxlUHJvY2Vzc29yLnRvTm9ybWFsaXplZEZvcm0oa2V5LCB2YWx1ZSwgdGhpcy5fc3R5bGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBhIGdpdmVuIHN0eWxlIGlzIHNldC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVzLnNldFRvKCAnbWFyZ2luLWxlZnQ6MXB4OycgKTtcblx0ICpcblx0ICogc3R5bGVzLmhhcyggJ21hcmdpbi1sZWZ0JyApOyAgICAvLyAtPiB0cnVlXG5cdCAqIHN0eWxlcy5oYXMoICdwYWRkaW5nJyApOyAgICAgICAgLy8gLT4gZmFsc2Vcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIGNoZWNrIHN1cHBvcnRzIG5vcm1hbGl6ZWQgc3R5bGUgbmFtZXMuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEVuYWJsZSAnbWFyZ2luJyBzaG9ydGhhbmQgcHJvY2Vzc2luZzpcblx0ICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkTWFyZ2luUnVsZXMgKTtcblx0ICpcblx0ICogc3R5bGVzLnNldFRvKCAnbWFyZ2luOjJweDsnICk7XG5cdCAqXG5cdCAqIHN0eWxlcy5oYXMoICdtYXJnaW4nICk7ICAgICAgICAgLy8gLT4gdHJ1ZVxuXHQgKiBzdHlsZXMuaGFzKCAnbWFyZ2luLXRvcCcgKTsgICAgIC8vIC0+IHRydWVcblx0ICogc3R5bGVzLmhhcyggJ21hcmdpbi1sZWZ0JyApOyAgICAvLyAtPiB0cnVlXG5cdCAqXG5cdCAqIHN0eWxlcy5yZW1vdmUoICdtYXJnaW4tdG9wJyApO1xuXHQgKlxuXHQgKiBzdHlsZXMuaGFzKCAnbWFyZ2luJyApOyAgICAgICAgIC8vIC0+IGZhbHNlXG5cdCAqIHN0eWxlcy5oYXMoICdtYXJnaW4tdG9wJyApOyAgICAgLy8gLT4gZmFsc2Vcblx0ICogc3R5bGVzLmhhcyggJ21hcmdpbi1sZWZ0JyApOyAgICAvLyAtPiB0cnVlXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gbmFtZSBTdHlsZSBuYW1lLlxuXHQgKi8gaGFzKG5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0eWxlcyA9IHRoaXMuX3N0eWxlUHJvY2Vzc29yLmdldFJlZHVjZWRGb3JtKG5hbWUsIHRoaXMuX3N0eWxlcyk7XG4gICAgICAgIGNvbnN0IHByb3BlcnR5RGVzY3JpcHRvciA9IHN0eWxlcy5maW5kKChbcHJvcGVydHldKT0+cHJvcGVydHkgPT09IG5hbWUpO1xuICAgICAgICAvLyBPbmx5IHJldHVybiBhIHZhbHVlIGlmIGl0IGlzIHNldDtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocHJvcGVydHlEZXNjcmlwdG9yKTtcbiAgICB9XG4gICAgc2V0KG5hbWVPck9iamVjdCwgdmFsdWVPck9iamVjdCkge1xuICAgICAgICB0aGlzLl9jYWNoZWRTdHlsZU5hbWVzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY2FjaGVkRXhwYW5kZWRTdHlsZU5hbWVzID0gbnVsbDtcbiAgICAgICAgaWYgKGlzT2JqZWN0KG5hbWVPck9iamVjdCkpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG5hbWVPck9iamVjdCkpe1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0eWxlUHJvY2Vzc29yLnRvTm9ybWFsaXplZEZvcm0oa2V5LCB2YWx1ZSwgdGhpcy5fc3R5bGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3N0eWxlUHJvY2Vzc29yLnRvTm9ybWFsaXplZEZvcm0obmFtZU9yT2JqZWN0LCB2YWx1ZU9yT2JqZWN0LCB0aGlzLl9zdHlsZXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGdpdmVuIHN0eWxlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzdHlsZXMuc2V0VG8oICdiYWNrZ3JvdW5kOiNmMDA7bWFyZ2luLXJpZ2h0OjJweDsnICk7XG5cdCAqXG5cdCAqIHN0eWxlcy5yZW1vdmUoICdiYWNrZ3JvdW5kJyApO1xuXHQgKlxuXHQgKiBzdHlsZXMudG9TdHJpbmcoKTsgICAvLyAtPiAnbWFyZ2luLXJpZ2h0OjJweDsnXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKipOb3RlKio6KiBUaGlzIG1ldGhvZCB1c2VzIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjYWRkU3R5bGVQcm9jZXNzb3JSdWxlc1xuXHQgKiBlbmFibGVkIHN0eWxlIHByb2Nlc3NvciBydWxlc30gdG8gbm9ybWFsaXplIHBhc3NlZCB2YWx1ZXMuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEVuYWJsZSAnbWFyZ2luJyBzaG9ydGhhbmQgcHJvY2Vzc2luZzpcblx0ICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkTWFyZ2luUnVsZXMgKTtcblx0ICpcblx0ICogc3R5bGVzLnNldFRvKCAnbWFyZ2luOjFweCcgKTtcblx0ICpcblx0ICogc3R5bGVzLnJlbW92ZSggJ21hcmdpbi10b3AnICk7XG5cdCAqIHN0eWxlcy5yZW1vdmUoICdtYXJnaW4tcmlnaHQnICk7XG5cdCAqXG5cdCAqIHN0eWxlcy50b1N0cmluZygpOyAvLyAtPiAnbWFyZ2luLWJvdHRvbToxcHg7bWFyZ2luLWxlZnQ6MXB4Oydcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lcyBTdHlsZSBuYW1lIG9yIGFuIGFycmF5IG9mIG5hbWVzLlxuXHQgKi8gcmVtb3ZlKG5hbWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiB0b0FycmF5KG5hbWVzKSl7XG4gICAgICAgICAgICB0aGlzLl9jYWNoZWRTdHlsZU5hbWVzID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2NhY2hlZEV4cGFuZGVkU3R5bGVOYW1lcyA9IG51bGw7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gdG9QYXRoKG5hbWUpO1xuICAgICAgICAgICAgdW5zZXQodGhpcy5fc3R5bGVzLCBwYXRoKTtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zdHlsZXNbbmFtZV07XG4gICAgICAgICAgICB0aGlzLl9jbGVhbkVtcHR5T2JqZWN0c09uUGF0aChwYXRoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIG5vcm1hbGl6ZWQgc3R5bGUgb2JqZWN0IG9yIGEgc2luZ2xlIHZhbHVlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBFbmFibGUgJ21hcmdpbicgc2hvcnRoYW5kIHByb2Nlc3Npbmc6XG5cdCAqIGVkaXRvci5kYXRhLmFkZFN0eWxlUHJvY2Vzc29yUnVsZXMoIGFkZE1hcmdpblJ1bGVzICk7XG5cdCAqXG5cdCAqIGNvbnN0IHN0eWxlcyA9IG5ldyBTdHlsZXMoKTtcblx0ICogc3R5bGVzLnNldFRvKCAnbWFyZ2luOjFweCAycHggM2VtOycgKTtcblx0ICpcblx0ICogc3R5bGVzLmdldE5vcm1hbGl6ZWQoICdtYXJnaW4nICk7XG5cdCAqIC8vIHdpbGwgbG9nOlxuXHQgKiAvLyB7XG5cdCAqIC8vICAgICB0b3A6ICcxcHgnLFxuXHQgKiAvLyAgICAgcmlnaHQ6ICcycHgnLFxuXHQgKiAvLyAgICAgYm90dG9tOiAnM2VtJyxcblx0ICogLy8gICAgIGxlZnQ6ICcycHgnICAgICAvLyBub3JtYWxpemVkIHZhbHVlIGZyb20gbWFyZ2luIHNob3J0aGFuZFxuXHQgKiAvLyB9XG5cdCAqXG5cdCAqIHN0eWxlcy5nZXROb3JtYWxpemVkKCAnbWFyZ2luLWxlZnQnICk7IC8vIC0+ICcycHgnXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVGhpcyBtZXRob2Qgd2lsbCBvbmx5IHJldHVybiBub3JtYWxpemVkIHN0eWxlcyBpZiBhIHN0eWxlIHByb2Nlc3NvciB3YXMgZGVmaW5lZC5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgU3R5bGUgbmFtZS5cblx0ICovIGdldE5vcm1hbGl6ZWQobmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVQcm9jZXNzb3IuZ2V0Tm9ybWFsaXplZChuYW1lLCB0aGlzLl9zdHlsZXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIG5vcm1hbGl6ZWQgc3R5bGUgc3RyaW5nLiBTdHlsZXMgYXJlIHNvcnRlZCBieSBuYW1lLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzdHlsZXMuc2V0KCAnbWFyZ2luJyAsICcxcHgnICk7XG5cdCAqIHN0eWxlcy5zZXQoICdiYWNrZ3JvdW5kJywgJyNmMDAnICk7XG5cdCAqXG5cdCAqIHN0eWxlcy50b1N0cmluZygpOyAvLyAtPiAnYmFja2dyb3VuZDojZjAwO21hcmdpbjoxcHg7J1xuXHQgKiBgYGBcblx0ICpcblx0ICogKipOb3RlKio6IFRoaXMgbWV0aG9kIHN1cHBvcnRzIG5vcm1hbGl6ZWQgc3R5bGVzIGlmIGRlZmluZWQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEVuYWJsZSAnbWFyZ2luJyBzaG9ydGhhbmQgcHJvY2Vzc2luZzpcblx0ICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkTWFyZ2luUnVsZXMgKTtcblx0ICpcblx0ICogc3R5bGVzLnNldCggJ21hcmdpbicgLCAnMXB4JyApO1xuXHQgKiBzdHlsZXMuc2V0KCAnYmFja2dyb3VuZCcsICcjZjAwJyApO1xuXHQgKiBzdHlsZXMucmVtb3ZlKCAnbWFyZ2luLXRvcCcgKTtcblx0ICogc3R5bGVzLnJlbW92ZSggJ21hcmdpbi1yaWdodCcgKTtcblx0ICpcblx0ICogc3R5bGVzLnRvU3RyaW5nKCk7IC8vIC0+ICdiYWNrZ3JvdW5kOiNmMDA7bWFyZ2luLWJvdHRvbToxcHg7bWFyZ2luLWxlZnQ6MXB4Oydcblx0ICogYGBgXG5cdCAqLyB0b1N0cmluZygpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlc0VudHJpZXMoKS5tYXAoKGFycik9PmFyci5qb2luKCc6JykpLnNvcnQoKS5qb2luKCc7JykgKyAnOyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHByb3BlcnR5IGFzIGEgdmFsdWUgc3RyaW5nIG9yIHVuZGVmaW5lZCBpZiBwcm9wZXJ0eSBpcyBub3Qgc2V0LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBFbmFibGUgJ21hcmdpbicgc2hvcnRoYW5kIHByb2Nlc3Npbmc6XG5cdCAqIGVkaXRvci5kYXRhLmFkZFN0eWxlUHJvY2Vzc29yUnVsZXMoIGFkZE1hcmdpblJ1bGVzICk7XG5cdCAqXG5cdCAqIGNvbnN0IHN0eWxlcyA9IG5ldyBTdHlsZXMoKTtcblx0ICogc3R5bGVzLnNldFRvKCAnbWFyZ2luOjFweDsnICk7XG5cdCAqIHN0eWxlcy5zZXQoICdtYXJnaW4tYm90dG9tJywgJzNlbScgKTtcblx0ICpcblx0ICogc3R5bGVzLmdldEFzU3RyaW5nKCAnbWFyZ2luJyApOyAvLyAtPiAnbWFyZ2luOiAxcHggMXB4IDNlbTsnXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlLCBob3dldmVyLCB0aGF0IGFsbCBzdWItdmFsdWVzIG11c3QgYmUgc2V0IGZvciB0aGUgbG9uZ2hhbmQgcHJvcGVydHkgbmFtZSB0byByZXR1cm4gYSB2YWx1ZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3Qgc3R5bGVzID0gbmV3IFN0eWxlcygpO1xuXHQgKiBzdHlsZXMuc2V0VG8oICdtYXJnaW46MXB4OycgKTtcblx0ICogc3R5bGVzLnJlbW92ZSggJ21hcmdpbi1ib3R0b20nICk7XG5cdCAqXG5cdCAqIHN0eWxlcy5nZXRBc1N0cmluZyggJ21hcmdpbicgKTsgLy8gLT4gdW5kZWZpbmVkXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbiB0aGUgYWJvdmUgc2NlbmFyaW8sIGl0IGlzIG5vdCBwb3NzaWJsZSB0byByZXR1cm4gYSBgbWFyZ2luYCB2YWx1ZSwgc28gYHVuZGVmaW5lZGAgaXMgcmV0dXJuZWQuXG5cdCAqIEluc3RlYWQsIHlvdSBzaG91bGQgdXNlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBzdHlsZXMgPSBuZXcgU3R5bGVzKCk7XG5cdCAqIHN0eWxlcy5zZXRUbyggJ21hcmdpbjoxcHg7JyApO1xuXHQgKiBzdHlsZXMucmVtb3ZlKCAnbWFyZ2luLWJvdHRvbScgKTtcblx0ICpcblx0ICogZm9yICggY29uc3Qgc3R5bGVOYW1lIG9mIHN0eWxlcy5nZXRTdHlsZU5hbWVzKCkgKSB7XG5cdCAqIFx0Y29uc29sZS5sb2coIHN0eWxlTmFtZSwgc3R5bGVzLmdldEFzU3RyaW5nKCBzdHlsZU5hbWUgKSApO1xuXHQgKiB9XG5cdCAqIC8vICdtYXJnaW4tdG9wJywgJzFweCdcblx0ICogLy8gJ21hcmdpbi1yaWdodCcsICcxcHgnXG5cdCAqIC8vICdtYXJnaW4tbGVmdCcsICcxcHgnXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbiBnZW5lcmFsLCBpdCBpcyByZWNvbW1lbmQgdG8gaXRlcmF0ZSBvdmVyIHN0eWxlIG5hbWVzIGxpa2UgaW4gdGhlIGV4YW1wbGUgYWJvdmUuIFRoaXMgd2F5LCB5b3Ugd2lsbCBhbHdheXMgZ2V0IGFsbFxuXHQgKiB0aGUgY3VycmVudGx5IHNldCBzdHlsZSB2YWx1ZXMuIFNvLCBpZiBhbGwgdGhlIDQgbWFyZ2luIHZhbHVlcyB3b3VsZCBiZSBzZXRcblx0ICogdGhlIGZvci1vZiBsb29wIGFib3ZlIHdvdWxkIHlpZWxkIG9ubHkgYCdtYXJnaW4nYCwgYCcxcHgnYDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3Qgc3R5bGVzID0gbmV3IFN0eWxlcygpO1xuXHQgKiBzdHlsZXMuc2V0VG8oICdtYXJnaW46MXB4OycgKTtcblx0ICpcblx0ICogZm9yICggY29uc3Qgc3R5bGVOYW1lIG9mIHN0eWxlcy5nZXRTdHlsZU5hbWVzKCkgKSB7XG5cdCAqIFx0Y29uc29sZS5sb2coIHN0eWxlTmFtZSwgc3R5bGVzLmdldEFzU3RyaW5nKCBzdHlsZU5hbWUgKSApO1xuXHQgKiB9XG5cdCAqIC8vICdtYXJnaW4nLCAnMXB4J1xuXHQgKiBgYGBcblx0ICpcblx0ICogKipOb3RlKio6IFRvIGdldCBhIG5vcm1hbGl6ZWQgdmVyc2lvbiBvZiBhIGxvbmdoYW5kIHByb3BlcnR5IHVzZSB0aGUge0BsaW5rICNnZXROb3JtYWxpemVkIGAjZ2V0Tm9ybWFsaXplZCgpYH0gbWV0aG9kLlxuXHQgKi8gZ2V0QXNTdHJpbmcocHJvcGVydHlOYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRW1wdHkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fc3R5bGVzW3Byb3BlcnR5TmFtZV0gJiYgIWlzT2JqZWN0KHRoaXMuX3N0eWxlc1twcm9wZXJ0eU5hbWVdKSkge1xuICAgICAgICAgICAgLy8gVHJ5IHJldHVybiBzdHlsZXMgc2V0IGRpcmVjdGx5IC0gdmFsdWVzIHRoYXQgYXJlIG5vdCBwYXJzZWQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVzW3Byb3BlcnR5TmFtZV07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3R5bGVzID0gdGhpcy5fc3R5bGVQcm9jZXNzb3IuZ2V0UmVkdWNlZEZvcm0ocHJvcGVydHlOYW1lLCB0aGlzLl9zdHlsZXMpO1xuICAgICAgICBjb25zdCBwcm9wZXJ0eURlc2NyaXB0b3IgPSBzdHlsZXMuZmluZCgoW3Byb3BlcnR5XSk9PnByb3BlcnR5ID09PSBwcm9wZXJ0eU5hbWUpO1xuICAgICAgICAvLyBPbmx5IHJldHVybiBhIHZhbHVlIGlmIGl0IGlzIHNldDtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcGVydHlEZXNjcmlwdG9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5RGVzY3JpcHRvclsxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbGwgc3R5bGUgcHJvcGVydGllcyBuYW1lcyBhcyB0aGV5IHdvdWxkIGFwcGVhciB3aGVuIHVzaW5nIHtAbGluayAjdG9TdHJpbmcgYCN0b1N0cmluZygpYH0uXG5cdCAqXG5cdCAqIFdoZW4gYGV4cGFuZGAgaXMgc2V0IHRvIHRydWUgYW5kIHRoZXJlJ3MgYSBzaG9ydGhhbmQgc3R5bGUgcHJvcGVydHkgc2V0LCBpdCB3aWxsIGFsc28gcmV0dXJuIGFsbCBlcXVpdmFsZW50IHN0eWxlczpcblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVzTWFwLnNldFRvKCAnbWFyZ2luOiAxZW0nIClcblx0ICogYGBgXG5cdCAqXG5cdCAqIHdpbGwgYmUgZXhwYW5kZWQgdG86XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIFsgJ21hcmdpbicsICdtYXJnaW4tdG9wJywgJ21hcmdpbi1yaWdodCcsICdtYXJnaW4tYm90dG9tJywgJ21hcmdpbi1sZWZ0JyBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gZXhwYW5kIEV4cGFuZCBzaG9ydGhhbmQgc3R5bGUgcHJvcGVydGllcyBhbmQgYWxsIHJldHVybiBlcXVpdmFsZW50IHN0eWxlIHJlcHJlc2VudGF0aW9ucy5cblx0ICovIGdldFN0eWxlTmFtZXMoZXhwYW5kID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChleHBhbmQpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhY2hlZEV4cGFuZGVkU3R5bGVOYW1lcyA9IHRoaXMuX2NhY2hlZEV4cGFuZGVkU3R5bGVOYW1lcyB8fCB0aGlzLl9zdHlsZVByb2Nlc3Nvci5nZXRTdHlsZU5hbWVzKHRoaXMuX3N0eWxlcyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkRXhwYW5kZWRTdHlsZU5hbWVzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NhY2hlZFN0eWxlTmFtZXMgPSB0aGlzLl9jYWNoZWRTdHlsZU5hbWVzIHx8IHRoaXMuZ2V0U3R5bGVzRW50cmllcygpLm1hcCgoW2tleV0pPT5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkU3R5bGVOYW1lcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFsaWFzIGZvciB7QGxpbmsgI2dldFN0eWxlTmFtZXN9LlxuXHQgKi8ga2V5cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGVOYW1lcygpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhbGwgc3R5bGVzLlxuXHQgKi8gY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuX3N0eWxlcyA9IHt9O1xuICAgICAgICB0aGlzLl9jYWNoZWRTdHlsZU5hbWVzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY2FjaGVkRXhwYW5kZWRTdHlsZU5hbWVzID0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYHRydWVgIGlmIGJvdGggYXR0cmlidXRlcyBoYXZlIHRoZSBzYW1lIHN0eWxlcy5cblx0ICovIGlzU2ltaWxhcihvdGhlcikge1xuICAgICAgICBpZiAodGhpcy5zaXplICE9PSBvdGhlci5zaXplKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBvZiB0aGlzLmdldFN0eWxlTmFtZXMoKSl7XG4gICAgICAgICAgICBpZiAoIW90aGVyLmhhcyhwcm9wZXJ0eSkgfHwgb3RoZXIuZ2V0QXNTdHJpbmcocHJvcGVydHkpICE9PSB0aGlzLmdldEFzU3RyaW5nKHByb3BlcnR5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgbm9ybWFsaXplZCBzdHlsZXMgZW50cmllcyBmb3IgZnVydGhlciBwcm9jZXNzaW5nLlxuXHQgKi8gZ2V0U3R5bGVzRW50cmllcygpIHtcbiAgICAgICAgY29uc3QgcGFyc2VkID0gW107XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLl9zdHlsZXMpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKXtcbiAgICAgICAgICAgIHBhcnNlZC5wdXNoKC4uLnRoaXMuX3N0eWxlUHJvY2Vzc29yLmdldFJlZHVjZWRGb3JtKGtleSwgdGhpcy5fc3R5bGVzKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcnNlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyB0aGUgYXR0cmlidXRlIHZhbHVlLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9jbG9uZSgpIHtcbiAgICAgICAgY29uc3QgY2xvbmUgPSBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLl9zdHlsZVByb2Nlc3Nvcik7XG4gICAgICAgIGNsb25lLnNldCh0aGlzLmdldE5vcm1hbGl6ZWQoKSk7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyIE1hdGNoZXJ9IHRvIGNvbGxlY3QgbWF0Y2hpbmcgc3R5bGVzLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHRva2VuUGF0dGVybiBUaGUgbWF0Y2hlZCBzdHlsZSBuYW1lIHBhdHRlcm4uXG5cdCAqIEBwYXJhbSB2YWx1ZVBhdHRlcm4gVGhlIG1hdGNoZWQgc3R5bGUgdmFsdWUgcGF0dGVybi5cblx0ICogQHJldHVybnMgQW4gYXJyYXkgb2YgbWF0Y2hpbmcgdG9rZW5zIChzdHlsZSBuYW1lcykuXG5cdCAqLyBfZ2V0VG9rZW5zTWF0Y2godG9rZW5QYXR0ZXJuLCB2YWx1ZVBhdHRlcm4pIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBzdHlsZU5hbWUgb2YgdGhpcy5nZXRTdHlsZU5hbWVzKHRydWUpKXtcbiAgICAgICAgICAgIGlmIChpc1BhdHRlcm5NYXRjaGVkKHRva2VuUGF0dGVybiwgc3R5bGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZVBhdHRlcm4gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2gucHVzaChzdHlsZU5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRm9yIG5vdywgdGhlIHJlZHVjZXJzIGFyZSBub3QgcmV0dXJuaW5nIHRoZSBmdWxsIHRyZWUgb2YgcHJvcGVydGllcy5cbiAgICAgICAgICAgICAgICAvLyBDYXN0aW5nIHRvIHN0cmluZyBwcmVzZXJ2ZXMgdGhlIG9sZCBiZWhhdmlvciB1bnRpbCB0aGUgcm9vdCBjYXVzZSBpcyBmaXhlZC5cbiAgICAgICAgICAgICAgICAvLyBNb3JlIGNhbiBiZSBmb3VuZCBpbiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMDM5OS5cbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0QXNTdHJpbmcoc3R5bGVOYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNQYXR0ZXJuTWF0Y2hlZCh2YWx1ZVBhdHRlcm4sIHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBtYXRjaC5wdXNoKHN0eWxlTmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXRjaC5sZW5ndGggPyBtYXRjaCA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBsaXN0IG9mIGNvbnN1bWFibGVzIGZvciB0aGUgYXR0cmlidXRlLiBUaGlzIGluY2x1ZGVzIHJlbGF0ZWQgc3R5bGVzLlxuXHQgKlxuXHQgKiBDb3VsZCBiZSBmaWx0ZXJlZCBieSB0aGUgZ2l2ZW4gc3R5bGUgbmFtZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfZ2V0Q29uc3VtYWJsZXMobmFtZSkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5hbWUpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByZWxhdGVkTmFtZSBvZiB0aGlzLl9zdHlsZVByb2Nlc3Nvci5nZXRSZWxhdGVkU3R5bGVzKG5hbWUpKXtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyZWxhdGVkTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdGhpcy5nZXRTdHlsZU5hbWVzKCkpe1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcmVsYXRlZE5hbWUgb2YgdGhpcy5fc3R5bGVQcm9jZXNzb3IuZ2V0UmVsYXRlZFN0eWxlcyhuYW1lKSl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJlbGF0ZWROYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX2Nhbk1lcmdlQXR0cmlidXRlc0Zyb219IHRvIHZlcmlmeSBpZiB0aGUgZ2l2ZW4gYXR0cmlidXRlIGNhbiBiZSBtZXJnZWQgd2l0aG91dFxuXHQgKiBjb25mbGljdHMgaW50byB0aGUgYXR0cmlidXRlLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyBpbmRpcmVjdGx5IHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9IHdoaWxlIGRvd24tY2FzdGluZ1xuXHQgKiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0gdG8gbWVyZ2UgaXQgd2l0aCBvdGhlciBBdHRyaWJ1dGVFbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9jYW5NZXJnZUZyb20ob3RoZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2Ygb3RoZXIuZ2V0U3R5bGVOYW1lcygpKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmhhcyhrZXkpICYmIHRoaXMuZ2V0QXNTdHJpbmcoa2V5KSAhPT0gb3RoZXIuZ2V0QXNTdHJpbmcoa2V5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX21lcmdlQXR0cmlidXRlc0Zyb219IHRvIG1lcmdlIGEgZ2l2ZW4gYXR0cmlidXRlIGludG8gdGhlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgaW5kaXJlY3RseSB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB3aGlsZSBkb3duLWNhc3Rpbmdcblx0ICogYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IHRvIG1lcmdlIGl0IHdpdGggb3RoZXIgQXR0cmlidXRlRWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfbWVyZ2VGcm9tKG90aGVyKSB7XG4gICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiBvdGhlci5nZXRTdHlsZU5hbWVzKCkpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmhhcyhwcm9wKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0KHByb3AsIG90aGVyLmdldEFzU3RyaW5nKHByb3ApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfY2FuU3VidHJhY3RBdHRyaWJ1dGVzT2Z9IHRvIHZlcmlmeSBpZiB0aGUgZ2l2ZW4gYXR0cmlidXRlIGNhbiBiZSBmdWxseVxuXHQgKiBzdWJ0cmFjdGVkIGZyb20gdGhlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgaW5kaXJlY3RseSB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB3aGlsZSBkb3duLWNhc3Rpbmdcblx0ICogYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IHRvIHVud3JhcCB0aGUgQXR0cmlidXRlRWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfaXNNYXRjaGluZyhvdGhlcikge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBvdGhlci5nZXRTdHlsZU5hbWVzKCkpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLmhhcyhrZXkpIHx8IHRoaXMuZ2V0QXNTdHJpbmcoa2V5KSAhPT0gb3RoZXIuZ2V0QXNTdHJpbmcoa2V5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgZW1wdHkgb2JqZWN0cyB1cG9uIHJlbW92aW5nIGFuIGVudHJ5IGZyb20gaW50ZXJuYWwgb2JqZWN0LlxuXHQgKi8gX2NsZWFuRW1wdHlPYmplY3RzT25QYXRoKHBhdGgpIHtcbiAgICAgICAgY29uc3QgcGF0aFBhcnRzID0gcGF0aC5zcGxpdCgnLicpO1xuICAgICAgICBjb25zdCBpc0NoaWxkUGF0aCA9IHBhdGhQYXJ0cy5sZW5ndGggPiAxO1xuICAgICAgICBpZiAoIWlzQ2hpbGRQYXRoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhQYXJ0cy5zcGxpY2UoMCwgcGF0aFBhcnRzLmxlbmd0aCAtIDEpLmpvaW4oJy4nKTtcbiAgICAgICAgY29uc3QgcGFyZW50T2JqZWN0ID0gZ2V0KHRoaXMuX3N0eWxlcywgcGFyZW50UGF0aCk7XG4gICAgICAgIGlmICghcGFyZW50T2JqZWN0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNQYXJlbnRFbXB0eSA9ICFPYmplY3Qua2V5cyhwYXJlbnRPYmplY3QpLmxlbmd0aDtcbiAgICAgICAgaWYgKGlzUGFyZW50RW1wdHkpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKHBhcmVudFBhdGgpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBTdHlsZSBwcm9jZXNzb3IgaXMgcmVzcG9uc2libGUgZm9yIHdyaXRpbmcgYW5kIHJlYWRpbmcgYSBub3JtYWxpemVkIHN0eWxlcyBvYmplY3QuXG4gKi8gY2xhc3MgU3R5bGVzUHJvY2Vzc29yIHtcbiAgICBfbm9ybWFsaXplcnM7XG4gICAgX2V4dHJhY3RvcnM7XG4gICAgX3JlZHVjZXJzO1xuICAgIF9jb25zdW1hYmxlcztcbiAgICAvKipcblx0ICogQ3JlYXRlcyBTdHlsZXNQcm9jZXNzb3IgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gY29uc3RydWN0b3IoKXtcbiAgICAgICAgdGhpcy5fbm9ybWFsaXplcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuX2V4dHJhY3RvcnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuX3JlZHVjZXJzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLl9jb25zdW1hYmxlcyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBhcnNlIHN0eWxlIHN0cmluZyB2YWx1ZSB0byBhIG5vcm1hbGl6ZWQgb2JqZWN0IGFuZCBhcHBlbmRzIGl0IHRvIHN0eWxlcyBvYmplY3QuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IHN0eWxlcyA9IHt9O1xuXHQgKlxuXHQgKiBzdHlsZXNQcm9jZXNzb3IudG9Ob3JtYWxpemVkRm9ybSggJ21hcmdpbicsICcxcHgnLCBzdHlsZXMgKTtcblx0ICpcblx0ICogLy8gc3R5bGVzIHdpbGwgY29uc2lzdDogeyBtYXJnaW46IHsgdG9wOiAnMXB4JywgcmlnaHQ6ICcxcHgnLCBib3R0b206ICcxcHgnLCBsZWZ0OiAnMXB4OyB9IH1cblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUbyBkZWZpbmUgbm9ybWFsaXplciBjYWxsYmFja3MgdXNlIHtAbGluayAjc2V0Tm9ybWFsaXplcn0uXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5hbWUgb2Ygc3R5bGUgcHJvcGVydHkuXG5cdCAqIEBwYXJhbSBwcm9wZXJ0eVZhbHVlIFZhbHVlIG9mIHN0eWxlIHByb3BlcnR5LlxuXHQgKiBAcGFyYW0gc3R5bGVzIE9iamVjdCBob2xkaW5nIG5vcm1hbGl6ZWQgc3R5bGVzLlxuXHQgKi8gdG9Ob3JtYWxpemVkRm9ybShuYW1lLCBwcm9wZXJ0eVZhbHVlLCBzdHlsZXMpIHtcbiAgICAgICAgaWYgKGlzT2JqZWN0KHByb3BlcnR5VmFsdWUpKSB7XG4gICAgICAgICAgICBhcHBlbmRTdHlsZVZhbHVlKHN0eWxlcywgdG9QYXRoKG5hbWUpLCBwcm9wZXJ0eVZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fbm9ybWFsaXplcnMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVyID0gdGhpcy5fbm9ybWFsaXplcnMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgY29uc3QgeyBwYXRoLCB2YWx1ZSB9ID0gbm9ybWFsaXplcihwcm9wZXJ0eVZhbHVlKTtcbiAgICAgICAgICAgIGFwcGVuZFN0eWxlVmFsdWUoc3R5bGVzLCBwYXRoLCB2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcHBlbmRTdHlsZVZhbHVlKHN0eWxlcywgbmFtZSwgcHJvcGVydHlWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBub3JtYWxpemVkIHZlcnNpb24gb2YgYSBzdHlsZSBwcm9wZXJ0eS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3Qgc3R5bGVzID0ge1xuXHQgKiBcdG1hcmdpbjogeyB0b3A6ICcxcHgnLCByaWdodDogJzFweCcsIGJvdHRvbTogJzFweCcsIGxlZnQ6ICcxcHg7IH0sXG5cdCAqIFx0YmFja2dyb3VuZDogeyBjb2xvcjogJyNmMDAnIH1cblx0ICogfTtcblx0ICpcblx0ICogc3R5bGVzUHJvY2Vzc29yLmdldE5vcm1hbGl6ZWQoICdiYWNrZ3JvdW5kJyApO1xuXHQgKiAvLyB3aWxsIHJldHVybjogeyBjb2xvcjogJyNmMDAnIH1cblx0ICpcblx0ICogc3R5bGVzUHJvY2Vzc29yLmdldE5vcm1hbGl6ZWQoICdtYXJnaW4tdG9wJyApO1xuXHQgKiAvLyB3aWxsIHJldHVybjogJzFweCdcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBJbiBzb21lIGNhc2VzIGV4dHJhY3Rpbmcgc2luZ2xlIHZhbHVlIHJlcXVpcmVzIGRlZmluaW5nIGFuIGV4dHJhY3RvciBjYWxsYmFjayB7QGxpbmsgI3NldEV4dHJhY3Rvcn0uXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5hbWUgb2Ygc3R5bGUgcHJvcGVydHkuXG5cdCAqIEBwYXJhbSBzdHlsZXMgT2JqZWN0IGhvbGRpbmcgbm9ybWFsaXplZCBzdHlsZXMuXG5cdCAqLyBnZXROb3JtYWxpemVkKG5hbWUsIHN0eWxlcykge1xuICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBtZXJnZSh7fSwgc3R5bGVzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBNaWdodCBiZSBlbXB0eSBzdHJpbmcuXG4gICAgICAgIGlmIChzdHlsZXNbbmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0eWxlc1tuYW1lXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fZXh0cmFjdG9ycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4dHJhY3RvciA9IHRoaXMuX2V4dHJhY3RvcnMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBleHRyYWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldChzdHlsZXMsIGV4dHJhY3Rvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGV4dHJhY3RvcihuYW1lLCBzdHlsZXMpO1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnZXQoc3R5bGVzLCB0b1BhdGgobmFtZSkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHJlZHVjZWQgZm9ybSBvZiBzdHlsZSBwcm9wZXJ0eSBmb3JtIG5vcm1hbGl6ZWQgb2JqZWN0LlxuXHQgKlxuXHQgKiBGb3IgZGVmYXVsdCBtYXJnaW4gcmVkdWNlciwgdGhlIGJlbG93IGNvZGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHN0eWxlc1Byb2Nlc3Nvci5nZXRSZWR1Y2VkRm9ybSggJ21hcmdpbicsIHtcblx0ICogXHRtYXJnaW46IHsgdG9wOiAnMXB4JywgcmlnaHQ6ICcxcHgnLCBib3R0b206ICcycHgnLCBsZWZ0OiAnMXB4OyB9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIHdpbGwgcmV0dXJuOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBbXG5cdCAqIFx0WyAnbWFyZ2luJywgJzFweCAxcHggMnB4JyBdXG5cdCAqIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIGJlY2F1c2UgaXQgbWlnaHQgYmUgcmVwcmVzZW50ZWQgYXMgYSBzaG9ydGhhbmQgJ21hcmdpbicgdmFsdWUuIEhvd2V2ZXIgaWYgb25lIG9mIG1hcmdpbiBsb25nIGhhbmQgdmFsdWVzIGlzIG1pc3NpbmcgaXQgc2hvdWxkIHJldHVybjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogW1xuXHQgKiBcdFsgJ21hcmdpbi10b3AnLCAnMXB4JyBdLFxuXHQgKiBcdFsgJ21hcmdpbi1yaWdodCcsICcxcHgnIF0sXG5cdCAqIFx0WyAnbWFyZ2luLWJvdHRvbScsICcycHgnIF1cblx0ICogXHQvLyB0aGUgJ2xlZnQnIHZhbHVlIGlzIG1pc3NpbmcgLSBjYW5ub3QgdXNlICdtYXJnaW4nIHNob3J0aGFuZC5cblx0ICogXVxuXHQgKiBgYGBcblx0ICpcblx0ICogKipOb3RlKio6IFRvIGRlZmluZSByZWR1Y2VyIGNhbGxiYWNrcyB1c2Uge0BsaW5rICNzZXRSZWR1Y2VyfS5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgTmFtZSBvZiBzdHlsZSBwcm9wZXJ0eS5cblx0ICovIGdldFJlZHVjZWRGb3JtKG5hbWUsIHN0eWxlcykge1xuICAgICAgICBjb25zdCBub3JtYWxpemVkVmFsdWUgPSB0aGlzLmdldE5vcm1hbGl6ZWQobmFtZSwgc3R5bGVzKTtcbiAgICAgICAgLy8gTWlnaHQgYmUgZW1wdHkgc3RyaW5nLlxuICAgICAgICBpZiAobm9ybWFsaXplZFZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fcmVkdWNlcnMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCByZWR1Y2VyID0gdGhpcy5fcmVkdWNlcnMuZ2V0KG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIHJlZHVjZXIobm9ybWFsaXplZFZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgbm9ybWFsaXplZFZhbHVlXG4gICAgICAgICAgICBdXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm4gYWxsIHN0eWxlIHByb3BlcnRpZXMuIEFsc28gZXhwYW5kIHNob3J0aGFuZCBwcm9wZXJ0aWVzIChlLmcuIGBtYXJnaW5gLCBgYmFja2dyb3VuZGApIGlmIHJlc3BlY3RpdmUgZXh0cmFjdG9yIGlzIGF2YWlsYWJsZS5cblx0ICpcblx0ICogQHBhcmFtIHN0eWxlcyBPYmplY3QgaG9sZGluZyBub3JtYWxpemVkIHN0eWxlcy5cblx0ICovIGdldFN0eWxlTmFtZXMoc3R5bGVzKSB7XG4gICAgICAgIGNvbnN0IHN0eWxlTmFtZXNLZXlzU2V0ID0gbmV3IFNldCgpO1xuICAgICAgICAvLyBGaW5kIGFsbCBleHRyYWN0YWJsZSBzdHlsZXMgdGhhdCBoYXZlIGEgdmFsdWUuXG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiB0aGlzLl9jb25zdW1hYmxlcy5rZXlzKCkpe1xuICAgICAgICAgICAgY29uc3Qgc3R5bGUgPSB0aGlzLmdldE5vcm1hbGl6ZWQobmFtZSwgc3R5bGVzKTtcbiAgICAgICAgICAgIGlmIChzdHlsZSAmJiAodHlwZW9mIHN0eWxlICE9ICdvYmplY3QnIHx8IE9iamVjdC5rZXlzKHN0eWxlKS5sZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgc3R5bGVOYW1lc0tleXNTZXQuYWRkKG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEZvciBzaW1wbGUgc3R5bGVzIChmb3IgZXhhbXBsZSBgY29sb3JgKSB3ZSBkb24ndCBoYXZlIGEgbWFwIG9mIHRob3NlIHN0eWxlc1xuICAgICAgICAvLyBidXQgdGhleSBhcmUgMSB0byAxIHdpdGggbm9ybWFsaXplZCBvYmplY3Qga2V5cy5cbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5rZXlzKHN0eWxlcykpe1xuICAgICAgICAgICAgc3R5bGVOYW1lc0tleXNTZXQuYWRkKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHN0eWxlTmFtZXNLZXlzU2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgcmVsYXRlZCBzdHlsZSBuYW1lcy5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVzUHJvY2Vzc29yLmdldFJlbGF0ZWRTdHlsZXMoICdtYXJnaW4nICk7XG5cdCAqIC8vIHdpbGwgcmV0dXJuOiBbICdtYXJnaW4tdG9wJywgJ21hcmdpbi1yaWdodCcsICdtYXJnaW4tYm90dG9tJywgJ21hcmdpbi1sZWZ0JyBdO1xuXHQgKlxuXHQgKiBzdHlsZXNQcm9jZXNzb3IuZ2V0UmVsYXRlZFN0eWxlcyggJ21hcmdpbi10b3AnICk7XG5cdCAqIC8vIHdpbGwgcmV0dXJuOiBbICdtYXJnaW4nIF07XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVG8gZGVmaW5lIG5ldyBzdHlsZSByZWxhdGlvbnMgbG9hZCBhbiBleGlzdGluZyBzdHlsZSBwcm9jZXNzb3Igb3IgdXNlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc3R5bGVzbWFwflN0eWxlc1Byb2Nlc3NvciNzZXRTdHlsZVJlbGF0aW9uIGBTdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbigpYH0uXG5cdCAqLyBnZXRSZWxhdGVkU3R5bGVzKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnN1bWFibGVzLmdldChuYW1lKSB8fCBbXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgYSBub3JtYWxpemVyIG1ldGhvZCBmb3IgYSBzdHlsZSBwcm9wZXJ0eS5cblx0ICpcblx0ICogQSBub3JtYWxpemVyIHJldHVybnMgZGVzY3JpYmluZyBob3cgdGhlIHZhbHVlIHNob3VsZCBiZSBub3JtYWxpemVkLlxuXHQgKlxuXHQgKiBGb3IgaW5zdGFuY2UgJ21hcmdpbicgc3R5bGUgaXMgYSBzaG9ydGhhbmQgZm9yIGZvdXIgbWFyZ2luIHZhbHVlczpcblx0ICpcblx0ICogLSAnbWFyZ2luLXRvcCdcblx0ICogLSAnbWFyZ2luLXJpZ2h0J1xuXHQgKiAtICdtYXJnaW4tYm90dG9tJ1xuXHQgKiAtICdtYXJnaW4tbGVmdCdcblx0ICpcblx0ICogYW5kIGNhbiBiZSB3cml0dGVuIGluIHZhcmlvdXMgd2F5cyBpZiBzb21lIHZhbHVlcyBhcmUgZXF1YWwgdG8gb3RoZXJzLiBGb3IgaW5zdGFuY2UgYCdtYXJnaW46IDFweCAyZW07J2AgaXMgYSBzaG9ydGhhbmQgZm9yXG5cdCAqIGAnbWFyZ2luLXRvcDogMXB4O21hcmdpbi1yaWdodDogMmVtO21hcmdpbi1ib3R0b206IDFweDttYXJnaW4tbGVmdDogMmVtJ2AuXG5cdCAqXG5cdCAqIEEgbm9ybWFsaXplciBzaG91bGQgcGFyc2UgdmFyaW91cyBtYXJnaW4gbm90YXRpb25zIGFzIGEgc2luZ2xlIG9iamVjdDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3Qgc3R5bGVzID0ge1xuXHQgKiBcdG1hcmdpbjoge1xuXHQgKiBcdFx0dG9wOiAnMXB4Jyxcblx0ICogXHRcdHJpZ2h0OiAnMmVtJyxcblx0ICogXHRcdGJvdHRvbTogJzFweCcsXG5cdCAqIFx0XHRsZWZ0OiAnMmVtJ1xuXHQgKiBcdH1cblx0ICogfTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFRodXMgYSBub3JtYWxpemVyIGZvciAnbWFyZ2luJyBzdHlsZSBzaG91bGQgcmV0dXJuIGFuIG9iamVjdCBkZWZpbmluZyBzdHlsZSBwYXRoIGFuZCB2YWx1ZSB0byBzdG9yZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgcmV0dXJuVmFsdWUgPSB7XG5cdCAqIFx0cGF0aDogJ21hcmdpbicsXG5cdCAqIFx0dmFsdWU6IHtcblx0ICogXHRcdHRvcDogJzFweCcsXG5cdCAqIFx0XHRyaWdodDogJzJlbScsXG5cdCAqIFx0XHRib3R0b206ICcxcHgnLFxuXHQgKiBcdFx0bGVmdDogJzJlbSdcblx0ICogXHR9XG5cdCAqIH07XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBBZGRpdGlvbmFsbHkgdG8gZnVsbHkgc3VwcG9ydCBhbGwgbWFyZ2luIG5vdGF0aW9ucyB0aGVyZSBzaG91bGQgYmUgYWxzbyBkZWZpbmVkIDQgbm9ybWFsaXplcnMgZm9yIGxvbmdoYW5kIG1hcmdpbiBub3RhdGlvbnMuIEJlbG93XG5cdCAqIGlzIGFuIGV4YW1wbGUgZm9yICdtYXJnaW4tdG9wJyBzdHlsZSBwcm9wZXJ0eSBub3JtYWxpemVyOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplciggJ21hcmdpbi10b3AnLCB2YWx1ZVN0cmluZyA9PiB7XG5cdCAqIFx0cmV0dXJuIHtcblx0ICogXHRcdHBhdGg6ICdtYXJnaW4udG9wJyxcblx0ICogXHRcdHZhbHVlOiB2YWx1ZVN0cmluZ1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICovIHNldE5vcm1hbGl6ZXIobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fbm9ybWFsaXplcnMuc2V0KG5hbWUsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgYSBleHRyYWN0b3IgY2FsbGJhY2sgZm9yIGEgc3R5bGUgcHJvcGVydHkuXG5cdCAqXG5cdCAqIE1vc3Qgbm9ybWFsaXplZCBzdHlsZSB2YWx1ZXMgYXJlIHN0b3JlZCBhcyBvbmUgbGV2ZWwgb2JqZWN0cy4gSXQgaXMgYXNzdW1lZCB0aGF0IGAnbWFyZ2luLXRvcCdgIHN0eWxlIHdpbGwgYmUgc3RvcmVkIGFzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBzdHlsZXMgPSB7XG5cdCAqIFx0bWFyZ2luOiB7XG5cdCAqIFx0XHR0b3A6ICd2YWx1ZSdcblx0ICogXHR9XG5cdCAqIH1cblx0ICogYGBgXG5cdCAqXG5cdCAqIEhvd2V2ZXIsIHNvbWUgc3R5bGVzIGNhbiBoYXZlIGNvbmZsaWN0aW5nIG5vdGF0aW9ucyBhbmQgdGh1cyBpdCBtaWdodCBiZSBoYXJkZXIgdG8gZXh0cmFjdCBhIHN0eWxlIHZhbHVlIGZyb20gc2hvcnRoYW5kLiBGb3IgaW5zdGFuY2Vcblx0ICogdGhlICdib3JkZXItdG9wLXN0eWxlJyBjYW4gYmUgZGVmaW5lZCB1c2luZyBgJ2JvcmRlci10b3A6c29saWQnYCwgYCdib3JkZXItc3R5bGU6c29saWQgbm9uZSBub25lIG5vbmUnYCBvciBieSBgJ2JvcmRlcjpzb2xpZCdgXG5cdCAqIHNob3J0aGFuZHMuIFRoZSBkZWZhdWx0IGJvcmRlciBzdHlsZXMgcHJvY2Vzc29ycyBzdG9yZXMgc3R5bGVzIGFzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBzdHlsZXMgPSB7XG5cdCAqIFx0Ym9yZGVyOiB7XG5cdCAqIFx0XHRzdHlsZToge1xuXHQgKiBcdFx0XHR0b3A6ICdzb2xpZCdcblx0ICogXHRcdH1cblx0ICogXHR9XG5cdCAqIH1cblx0ICogYGBgXG5cdCAqXG5cdCAqIGFzIGl0IGlzIGJldHRlciB0byBtb2RpZnkgYm9yZGVyIHN0eWxlIGluZGVwZW5kZW50bHkgZnJvbSBvdGhlciB2YWx1ZXMuIE9uIHRoZSBvdGhlciBwYXJ0IHRoZSBvdXRwdXQgb2YgdGhlIGJvcmRlciBtaWdodCBiZVxuXHQgKiBkZXNpcmVkIGFzIGBib3JkZXItdG9wYCwgYGJvcmRlci1sZWZ0YCwgZXRjIG5vdGF0aW9uLlxuXHQgKlxuXHQgKiBJbiB0aGUgYWJvdmUgZXhhbXBsZSBhbiBleHRyYWN0b3Igc2hvdWxkIHJldHVybiBhIHNpZGUgYm9yZGVyIHZhbHVlIHRoYXQgY29tYmluZXMgc3R5bGUsIGNvbG9yIGFuZCB3aWR0aDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVQcm9jZXNzb3Iuc2V0RXh0cmFjdG9yKCAnYm9yZGVyLXRvcCcsIHN0eWxlcyA9PiB7XG5cdCAqIFx0cmV0dXJuIHtcblx0ICogXHRcdGNvbG9yOiBzdHlsZXMuYm9yZGVyLmNvbG9yLnRvcCxcblx0ICogXHRcdHN0eWxlOiBzdHlsZXMuYm9yZGVyLnN0eWxlLnRvcCxcblx0ICogXHRcdHdpZHRoOiBzdHlsZXMuYm9yZGVyLndpZHRoLnRvcFxuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGNhbGxiYWNrT3JQYXRoIENhbGxiYWNrIHRoYXQgcmV0dXJuIGEgcmVxdWVzdGVkIHZhbHVlIG9yIHBhdGggc3RyaW5nIGZvciBzaW5nbGUgdmFsdWVzLlxuXHQgKi8gc2V0RXh0cmFjdG9yKG5hbWUsIGNhbGxiYWNrT3JQYXRoKSB7XG4gICAgICAgIHRoaXMuX2V4dHJhY3RvcnMuc2V0KG5hbWUsIGNhbGxiYWNrT3JQYXRoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgYSByZWR1Y2VyIGNhbGxiYWNrIGZvciBhIHN0eWxlIHByb3BlcnR5LlxuXHQgKlxuXHQgKiBSZWR1Y2VyIHJldHVybnMgYSBtaW5pbWFsIG5vdGF0aW9uIGZvciBnaXZlbiBzdHlsZSBuYW1lLiBGb3IgbG9uZ2hhbmQgcHJvcGVydGllcyBpdCBpcyBub3QgcmVxdWlyZWQgdG8gd3JpdGUgYSByZWR1Y2VyIGFzXG5cdCAqIGJ5IGRlZmF1bHQgdGhlIGRpcmVjdCB2YWx1ZSBmcm9tIHN0eWxlIHBhdGggaXMgdGFrZW4uXG5cdCAqXG5cdCAqIEZvciBzaG9ydGhhbmQgc3R5bGVzIGEgcmVkdWNlciBzaG91bGQgcmV0dXJuIG1pbmltYWwgc3R5bGUgbm90YXRpb24gZWl0aGVyIGJ5IHJldHVybmluZyBzaW5nbGUgbmFtZS12YWx1ZSB0dXBsZSBvciBtdWx0aXBsZSB0dXBsZXNcblx0ICogaWYgYSBzaG9ydGhhbmQgY2Fubm90IGJlIHVzZWQuIEZvciBpbnN0YW5jZSBmb3IgYSBtYXJnaW4gc2hvcnRoYW5kIGEgcmVkdWNlciBtaWdodCByZXR1cm46XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IG1hcmdpblNob3J0SGFuZFR1cGxlID0gW1xuXHQgKiBcdFsgJ21hcmdpbicsICcxcHggMXB4IDJweCcgXVxuXHQgKiBdO1xuXHQgKiBgYGBcblx0ICpcblx0ICogb3IgYSBsb25naGFuZCB0dXBsZXMgZm9yIGRlZmluZWQgdmFsdWVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBDb25zaWRlcmluZyBtYXJnaW4uYm90dG9tIGFuZCBtYXJnaW4ubGVmdCBhcmUgdW5kZWZpbmVkLlxuXHQgKiBjb25zdCBtYXJnaW5Mb25naGFuZHNUdXBsZXMgPSBbXG5cdCAqIFx0WyAnbWFyZ2luLXRvcCcsICcxcHgnIF0sXG5cdCAqIFx0WyAnbWFyZ2luLXJpZ2h0JywgJzFweCcgXVxuXHQgKiBdO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQSByZWR1Y2VyIG9idGFpbnMgYSBub3JtYWxpemVkIHN0eWxlIHZhbHVlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBTaW1wbGlmaWVkIHJlZHVjZXIgdGhhdCBhbHdheXMgb3V0cHV0cyA0IHZhbHVlcyB3aGljaCBhcmUgYWx3YXlzIHByZXNlbnQ6XG5cdCAqIHN0eWxlc1Byb2Nlc3Nvci5zZXRSZWR1Y2VyKCAnbWFyZ2luJywgbWFyZ2luID0+IHtcblx0ICogXHRyZXR1cm4gW1xuXHQgKiBcdFx0WyAnbWFyZ2luJywgYCR7IG1hcmdpbi50b3AgfSAkeyBtYXJnaW4ucmlnaHQgfSAkeyBtYXJnaW4uYm90dG9tIH0gJHsgbWFyZ2luLmxlZnQgfWAgXVxuXHQgKiBcdF1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICovIHNldFJlZHVjZXIobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcmVkdWNlcnMuc2V0KG5hbWUsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlZmluZXMgYSBzdHlsZSBzaG9ydGhhbmQgcmVsYXRpb24gdG8gb3RoZXIgc3R5bGUgbm90YXRpb25zLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbiggJ21hcmdpbicsIFtcblx0ICogXHQnbWFyZ2luLXRvcCcsXG5cdCAqIFx0J21hcmdpbi1yaWdodCcsXG5cdCAqIFx0J21hcmdpbi1ib3R0b20nLFxuXHQgKiBcdCdtYXJnaW4tbGVmdCdcblx0ICogXSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogVGhpcyBlbmFibGVzIGV4cGFuZGluZyBvZiBzdHlsZSBuYW1lcyBmb3Igc2hvcnRoYW5kcy4gRm9yIGluc3RhbmNlLCBpZiBkZWZpbmVkLFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3ZpZXdjb25zdW1hYmxlflZpZXdDb25zdW1hYmxlIHZpZXcgY29uc3VtYWJsZX0gaXRlbXMgYXJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZFxuXHQgKiBmb3IgbG9uZy1oYW5kIG1hcmdpbiBzdHlsZSBub3RhdGlvbiBhbG9uZ3NpZGUgdGhlIGAnbWFyZ2luJ2AgaXRlbS5cblx0ICpcblx0ICogVGhpcyBtZWFucyB0aGF0IHdoZW4gYW4gZWxlbWVudCBiZWluZyBjb252ZXJ0ZWQgaGFzIGEgc3R5bGUgYG1hcmdpbmAsIGEgY29udmVydGVyIGZvciBgbWFyZ2luLWxlZnRgIHdpbGwgd29yayBqdXN0XG5cdCAqIGZpbmUgc2luY2UgdGhlIHZpZXcgY29uc3VtYWJsZSB3aWxsIGNvbnRhaW4gYSBjb25zdW1hYmxlIGBtYXJnaW4tbGVmdGAgaXRlbSAodGhhbmtzIHRvIHRoZSByZWxhdGlvbikgYW5kXG5cdCAqIGBlbGVtZW50LmdldFN0eWxlKCAnbWFyZ2luLWxlZnQnIClgIHdpbGwgd29yayBhcyB3ZWxsIGFzc3VtaW5nIHRoYXQgdGhlIHN0eWxlIHByb2Nlc3NvciB3YXMgY29ycmVjdGx5IGNvbmZpZ3VyZWQuXG5cdCAqIEhvd2V2ZXIsIG9uY2UgYG1hcmdpbi1sZWZ0YCBpcyBjb25zdW1lZCwgYG1hcmdpbmAgd2lsbCBub3QgYmUgY29uc3VtYWJsZSBhbnltb3JlLlxuXHQgKi8gc2V0U3R5bGVSZWxhdGlvbihzaG9ydGhhbmROYW1lLCBzdHlsZU5hbWVzKSB7XG4gICAgICAgIHRoaXMuX21hcFN0eWxlTmFtZXMoc2hvcnRoYW5kTmFtZSwgc3R5bGVOYW1lcyk7XG4gICAgICAgIGZvciAoY29uc3QgYWxzb05hbWUgb2Ygc3R5bGVOYW1lcyl7XG4gICAgICAgICAgICB0aGlzLl9tYXBTdHlsZU5hbWVzKGFsc29OYW1lLCBbXG4gICAgICAgICAgICAgICAgc2hvcnRoYW5kTmFtZVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldCB0d28td2F5IGJpbmRpbmcgb2Ygc3R5bGUgbmFtZXMuXG5cdCAqLyBfbWFwU3R5bGVOYW1lcyhuYW1lLCBzdHlsZU5hbWVzKSB7XG4gICAgICAgIGlmICghdGhpcy5fY29uc3VtYWJsZXMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLl9jb25zdW1hYmxlcy5zZXQobmFtZSwgW10pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvbnN1bWFibGVzLmdldChuYW1lKS5wdXNoKC4uLnN0eWxlTmFtZXMpO1xuICAgIH1cbn1cbi8qKlxuICogUGFyc2VzIGlubGluZSBzdHlsZXMgYW5kIHB1dHMgcHJvcGVydHkgLSB2YWx1ZSBwYWlycyBpbnRvIHN0eWxlcyBtYXAuXG4gKlxuICogQHBhcmFtIHN0eWxlc1N0cmluZyBTdHlsZXMgdG8gcGFyc2UuXG4gKiBAcmV0dXJucyBNYXAgb2YgcGFyc2VkIHByb3BlcnRpZXMgYW5kIHZhbHVlcy5cbiAqLyBmdW5jdGlvbiBwYXJzZUlubGluZVN0eWxlcyhzdHlsZXNTdHJpbmcpIHtcbiAgICAvLyBgbnVsbGAgaWYgbm8gcXVvdGUgd2FzIGZvdW5kIGluIGlucHV0IHN0cmluZyBvciBsYXN0IGZvdW5kIHF1b3RlIHdhcyBhIGNsb3NpbmcgcXVvdGUuIFNlZSBiZWxvdy5cbiAgICBsZXQgcXVvdGVUeXBlID0gbnVsbDtcbiAgICBsZXQgcHJvcGVydHlOYW1lU3RhcnQgPSAwO1xuICAgIGxldCBwcm9wZXJ0eVZhbHVlU3RhcnQgPSAwO1xuICAgIGxldCBwcm9wZXJ0eU5hbWUgPSBudWxsO1xuICAgIGNvbnN0IHN0eWxlc01hcCA9IG5ldyBNYXAoKTtcbiAgICAvLyBEbyBub3Qgc2V0IGFueXRoaW5nIGlmIGlucHV0IHN0cmluZyBpcyBlbXB0eS5cbiAgICBpZiAoc3R5bGVzU3RyaW5nID09PSAnJykge1xuICAgICAgICByZXR1cm4gc3R5bGVzTWFwO1xuICAgIH1cbiAgICAvLyBGaXggaW5saW5lIHN0eWxlcyB0aGF0IGRvIG5vdCBlbmQgd2l0aCBgO2Agc28gdGhleSBhcmUgY29tcGF0aWJsZSB3aXRoIGFsZ29yaXRobSBiZWxvdy5cbiAgICBpZiAoc3R5bGVzU3RyaW5nLmNoYXJBdChzdHlsZXNTdHJpbmcubGVuZ3RoIC0gMSkgIT0gJzsnKSB7XG4gICAgICAgIHN0eWxlc1N0cmluZyA9IHN0eWxlc1N0cmluZyArICc7JztcbiAgICB9XG4gICAgLy8gU2VlayB0aGUgd2hvbGUgc3RyaW5nIGZvciBcInNwZWNpYWwgY2hhcmFjdGVyc1wiLlxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzdHlsZXNTdHJpbmcubGVuZ3RoOyBpKyspe1xuICAgICAgICBjb25zdCBjaGFyID0gc3R5bGVzU3RyaW5nLmNoYXJBdChpKTtcbiAgICAgICAgaWYgKHF1b3RlVHlwZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gTm8gcXVvdGUgZm91bmQgeWV0IG9yIGxhc3QgZm91bmQgcXVvdGUgd2FzIGEgY2xvc2luZyBxdW90ZS5cbiAgICAgICAgICAgIHN3aXRjaChjaGFyKXtcbiAgICAgICAgICAgICAgICBjYXNlICc6JzpcbiAgICAgICAgICAgICAgICAgICAgLy8gTW9zdCBvZiB0aW1lIGNvbG9uIG1lYW5zIHRoYXQgcHJvcGVydHkgbmFtZSBqdXN0IGVuZGVkLlxuICAgICAgICAgICAgICAgICAgICAvLyBTb21ldGltZXMgaG93ZXZlciBgOmAgaXMgZm91bmQgaW5zaWRlIHByb3BlcnR5IHZhbHVlIChmb3IgZXhhbXBsZSBpbiBiYWNrZ3JvdW5kIGltYWdlIHVybCkuXG4gICAgICAgICAgICAgICAgICAgIGlmICghcHJvcGVydHlOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUcmVhdCB0aGlzIGFzIGVuZCBvZiBwcm9wZXJ0eSBvbmx5IGlmIHByb3BlcnR5IG5hbWUgaXMgbm90IGFscmVhZHkgc2F2ZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIHByb3BlcnR5IG5hbWUuXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWUgPSBzdHlsZXNTdHJpbmcuc3Vic3RyKHByb3BlcnR5TmFtZVN0YXJ0LCBpIC0gcHJvcGVydHlOYW1lU3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSB0aGlzIHBvaW50IGFzIHRoZSBzdGFydCBvZiBwcm9wZXJ0eSB2YWx1ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VmFsdWVTdGFydCA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAgICAgICAgICBjYXNlICdcXCcnOlxuICAgICAgICAgICAgICAgICAgICAvLyBPcGVuaW5nIHF1b3RlIGZvdW5kICh0aGlzIGlzIGFuIG9wZW5pbmcgcXVvdGUsIGJlY2F1c2UgYHF1b3RlVHlwZWAgaXMgYG51bGxgKS5cbiAgICAgICAgICAgICAgICAgICAgcXVvdGVUeXBlID0gY2hhcjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnOyc6XG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByb3BlcnR5IHZhbHVlIGp1c3QgZW5kZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVc2UgcHJldmlvdXNseSBzdG9yZWQgcHJvcGVydHkgdmFsdWUgc3RhcnQgdG8gb2J0YWluIHByb3BlcnR5IHZhbHVlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlWYWx1ZSA9IHN0eWxlc1N0cmluZy5zdWJzdHIocHJvcGVydHlWYWx1ZVN0YXJ0LCBpIC0gcHJvcGVydHlWYWx1ZVN0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIHBhcnNlZCBwYXJ0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlc01hcC5zZXQocHJvcGVydHlOYW1lLnRyaW0oKSwgcHJvcGVydHlWYWx1ZS50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhpcyBwb2ludCBhcyBwcm9wZXJ0eSBuYW1lIHN0YXJ0LiBQcm9wZXJ0eSBuYW1lIHN0YXJ0cyBpbW1lZGlhdGVseSBhZnRlciBwcmV2aW91cyBwcm9wZXJ0eSB2YWx1ZSBlbmRzLlxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlOYW1lU3RhcnQgPSBpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY2hhciA9PT0gcXVvdGVUeXBlKSB7XG4gICAgICAgICAgICAvLyBJZiBhIHF1b3RlIGNoYXIgaXMgZm91bmQgYW5kIGl0IGlzIGEgY2xvc2luZyBxdW90ZSwgbWFyayB0aGlzIGZhY3QgYnkgYG51bGxgLWluZyBgcXVvdGVUeXBlYC5cbiAgICAgICAgICAgIHF1b3RlVHlwZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlc01hcDtcbn1cbi8qKlxuICogUmV0dXJuIGxvZGFzaCBjb21wYXRpYmxlIHBhdGggZnJvbSBzdHlsZSBuYW1lLlxuICovIGZ1bmN0aW9uIHRvUGF0aChuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWUucmVwbGFjZSgnLScsICcuJyk7XG59XG4vKipcbiAqIEFwcGVuZHMgc3R5bGUgZGVmaW5pdGlvbiB0byB0aGUgc3R5bGVzIG9iamVjdC5cbiAqLyBmdW5jdGlvbiBhcHBlbmRTdHlsZVZhbHVlKHN0eWxlc09iamVjdCwgbmFtZU9yUGF0aCwgdmFsdWVPck9iamVjdCkge1xuICAgIGxldCB2YWx1ZVRvU2V0ID0gdmFsdWVPck9iamVjdDtcbiAgICBpZiAoaXNPYmplY3QodmFsdWVPck9iamVjdCkpIHtcbiAgICAgICAgdmFsdWVUb1NldCA9IG1lcmdlKHt9LCBnZXQoc3R5bGVzT2JqZWN0LCBuYW1lT3JQYXRoKSwgdmFsdWVPck9iamVjdCk7XG4gICAgfVxuICAgIHNldChzdHlsZXNPYmplY3QsIG5hbWVPclBhdGgsIHZhbHVlVG9TZXQpO1xufVxuXG4vKipcbiAqIFRva2VuIGxpc3QuIEFsbG93cyBoYW5kbGluZyAoYWRkaW5nLCByZW1vdmluZywgcmV0cmlldmluZykgYSBzZXQgb2YgdG9rZW5zIChmb3IgZXhhbXBsZSBjbGFzcyBuYW1lcykuXG4gKi8gY2xhc3MgVG9rZW5MaXN0IHtcbiAgICAvKipcblx0ICogVGhlIHNldCBvZiB0b2tlbnMuXG5cdCAqLyBfc2V0ID0gbmV3IFNldCgpO1xuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgdG9rZW4gbGlzdCBoYXMgbm8gdG9rZW5zIHNldC5cblx0ICovIGdldCBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0LnNpemUgPT0gMDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE51bWJlciBvZiB0b2tlbnMuXG5cdCAqLyBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldC5zaXplO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIGEgZ2l2ZW4gdG9rZW4gaXMgc2V0LlxuXHQgKi8gaGFzKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldC5oYXMobmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFsbCB0b2tlbnMuXG5cdCAqLyBrZXlzKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLl9zZXQua2V5cygpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlc2V0cyB0aGUgdmFsdWUgdG8gdGhlIGdpdmVuIG9uZS5cblx0ICovIHNldFRvKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiB2YWx1ZS5zcGxpdCgvXFxzKy8pKXtcbiAgICAgICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldC5hZGQodG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyBhIGdpdmVuIHRva2VuIHdpdGhvdXQgYWZmZWN0aW5nIG90aGVyIHRva2Vucy5cblx0ICovIHNldCh0b2tlbnMpIHtcbiAgICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiB0b0FycmF5KHRva2Vucykpe1xuICAgICAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0LmFkZCh0b2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgZ2l2ZW4gdG9rZW4uXG5cdCAqLyByZW1vdmUodG9rZW5zKSB7XG4gICAgICAgIGZvciAoY29uc3QgdG9rZW4gb2YgdG9BcnJheSh0b2tlbnMpKXtcbiAgICAgICAgICAgIHRoaXMuX3NldC5kZWxldGUodG9rZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFsbCB0b2tlbnMuXG5cdCAqLyBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5fc2V0LmNsZWFyKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgbm9ybWFsaXplZCB0b2tlbnMgc3RyaW5nLlxuXHQgKi8gdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuX3NldCkuam9pbignICcpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBgdHJ1ZWAgaWYgYm90aCBhdHRyaWJ1dGVzIGhhdmUgdGhlIHNhbWUgdG9rZW5zLlxuXHQgKi8gaXNTaW1pbGFyKG90aGVyKSB7XG4gICAgICAgIGlmICh0aGlzLnNpemUgIT09IG90aGVyLnNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHRoaXMua2V5cygpKXtcbiAgICAgICAgICAgIGlmICghb3RoZXIuaGFzKHRva2VuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyB0aGUgYXR0cmlidXRlIHZhbHVlLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9jbG9uZSgpIHtcbiAgICAgICAgY29uc3QgY2xvbmUgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpO1xuICAgICAgICBjbG9uZS5fc2V0ID0gbmV3IFNldCh0aGlzLl9zZXQpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlciBNYXRjaGVyfSB0byBjb2xsZWN0IG1hdGNoaW5nIGF0dHJpYnV0ZSB0b2tlbnMuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gdG9rZW5QYXR0ZXJuIFRoZSBtYXRjaGVkIHRva2VuIG5hbWUgcGF0dGVybi5cblx0ICogQHJldHVybnMgQW4gYXJyYXkgb2YgbWF0Y2hpbmcgdG9rZW5zLlxuXHQgKi8gX2dldFRva2Vuc01hdGNoKHRva2VuUGF0dGVybikge1xuICAgICAgICBjb25zdCBtYXRjaCA9IFtdO1xuICAgICAgICBpZiAodG9rZW5QYXR0ZXJuID09PSB0cnVlKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHRoaXMuX3NldC5rZXlzKCkpe1xuICAgICAgICAgICAgICAgIG1hdGNoLnB1c2godG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgdG9rZW5QYXR0ZXJuID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHRva2VuUGF0dGVybi5zcGxpdCgvXFxzKy8pKXtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2V0Lmhhcyh0b2tlbikpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2gucHVzaCh0b2tlbik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0b2tlbiBvZiB0aGlzLl9zZXQua2V5cygpKXtcbiAgICAgICAgICAgIGlmICh0b2tlbi5tYXRjaCh0b2tlblBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2gucHVzaCh0b2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1hdGNoLmxlbmd0aCA/IG1hdGNoIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGxpc3Qgb2YgY29uc3VtYWJsZXMgZm9yIHRoZSBhdHRyaWJ1dGUuXG5cdCAqXG5cdCAqIENvdWxkIGJlIGZpbHRlcmVkIGJ5IHRoZSBnaXZlbiB0b2tlbiBuYW1lLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9nZXRDb25zdW1hYmxlcyhuYW1lKSB7XG4gICAgICAgIHJldHVybiBuYW1lID8gW1xuICAgICAgICAgICAgbmFtZVxuICAgICAgICBdIDogdGhpcy5rZXlzKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19jYW5NZXJnZUF0dHJpYnV0ZXNGcm9tfSB0byB2ZXJpZnkgaWYgdGhlIGdpdmVuIGF0dHJpYnV0ZVxuXHQgKiBjYW4gYmUgbWVyZ2VkIHdpdGhvdXQgY29uZmxpY3RzIGludG8gdGhlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgaW5kaXJlY3RseSB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB3aGlsZSBkb3duY2FzdGluZ1xuXHQgKiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0gdG8gbWVyZ2UgaXQgd2l0aCBvdGhlciBgQXR0cmlidXRlRWxlbWVudGAuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2Nhbk1lcmdlRnJvbSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19tZXJnZUF0dHJpYnV0ZXNGcm9tfSB0byBtZXJnZSBhIGdpdmVuIGF0dHJpYnV0ZSBpbnRvIHRoZSBhdHRyaWJ1dGUuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIGluZGlyZWN0bHkgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0gd2hpbGUgZG93bi1jYXN0aW5nXG5cdCAqIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSB0byBtZXJnZSBpdCB3aXRoIG90aGVyIEF0dHJpYnV0ZUVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX21lcmdlRnJvbShvdGhlcikge1xuICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIG90aGVyLl9zZXQua2V5cygpKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5fc2V0Lmhhcyh0b2tlbikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXQuYWRkKHRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfY2FuU3VidHJhY3RBdHRyaWJ1dGVzT2Z9IHRvIHZlcmlmeSBpZiB0aGUgZ2l2ZW4gYXR0cmlidXRlXG5cdCAqIGNhbiBiZSBmdWxseSBzdWJ0cmFjdGVkIGZyb20gdGhlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgaW5kaXJlY3RseSB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB3aGlsZSBkb3duLWNhc3Rpbmdcblx0ICogYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IHRvIHVud3JhcCB0aGUgQXR0cmlidXRlRWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfaXNNYXRjaGluZyhvdGhlcikge1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygb3RoZXIuX3NldC5rZXlzKCkpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9zZXQuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zdCB7IGNvbnZlcnRNYXBUb1RhZ3MgfSA9IHJlcXVpcmUoICcuLi9kZXYtdXRpbHMvdXRpbHMnICk7XG4vKipcbiAqIFZpZXcgZWxlbWVudC5cbiAqXG4gKiBUaGUgZWRpdGluZyBlbmdpbmUgZG9lcyBub3QgZGVmaW5lIGEgZml4ZWQgc2VtYW50aWNzIG9mIGl0cyBlbGVtZW50cyAoaXQgaXMgXCJEVEQtZnJlZVwiKS5cbiAqIFRoaXMgaXMgd2h5IHRoZSB0eXBlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0gbmVlZCB0b1xuICogYmUgZGVmaW5lZCBieSB0aGUgZmVhdHVyZSBkZXZlbG9wZXIuIFdoZW4gY3JlYXRpbmcgYW4gZWxlbWVudCB5b3Ugc2hvdWxkIHVzZSBvbmUgb2YgdGhlIGZvbGxvd2luZyBtZXRob2RzOlxuICpcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVDb250YWluZXJFbGVtZW50IGBkb3duY2FzdFdyaXRlciNjcmVhdGVDb250YWluZXJFbGVtZW50KClgfVxuICogaW4gb3JkZXIgdG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9LFxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQgYGRvd25jYXN0V3JpdGVyI2NyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoKWB9XG4gKiBpbiBvcmRlciB0byBjcmVhdGUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0sXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlRW1wdHlFbGVtZW50IGBkb3duY2FzdFdyaXRlciNjcmVhdGVFbXB0eUVsZW1lbnQoKWB9XG4gKiBpbiBvcmRlciB0byBjcmVhdGUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnR9LlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZVVJRWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlVUlFbGVtZW50KClgfVxuICogaW4gb3JkZXIgdG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fS5cbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVFZGl0YWJsZUVsZW1lbnQgYGRvd25jYXN0V3JpdGVyI2NyZWF0ZUVkaXRhYmxlRWxlbWVudCgpYH1cbiAqIGluIG9yZGVyIHRvIGNyZWF0ZSBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudH0uXG4gKlxuICogTm90ZSB0aGF0IGZvciB2aWV3IGVsZW1lbnRzIHdoaWNoIGFyZSBub3QgY3JlYXRlZCBmcm9tIHRoZSBtb2RlbCwgbGlrZSBlbGVtZW50cyBmcm9tIG11dGF0aW9ucywgcGFzdGUgb3JcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjc2V0IGRhdGEuc2V0fSBpdCBpcyBub3QgcG9zc2libGUgdG8gZGVmaW5lIHRoZSB0eXBlIG9mIHRoZSBlbGVtZW50LlxuICogSW4gc3VjaCBjYXNlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91cGNhc3R3cml0ZXJ+VXBjYXN0V3JpdGVyI2NyZWF0ZUVsZW1lbnQgYFVwY2FzdFdyaXRlciNjcmVhdGVFbGVtZW50KClgfSBtZXRob2RcbiAqIHNob3VsZCBiZSB1c2VkIHRvIGNyZWF0ZSBnZW5lcmljIHZpZXcgZWxlbWVudHMuXG4gKi8gbGV0IEVsZW1lbnQkMSA9IGNsYXNzIEVsZW1lbnQgZXh0ZW5kcyBOb2RlJDIge1xuICAgIC8qKlxuXHQgKiBOYW1lIG9mIHRoZSBlbGVtZW50LlxuXHQgKi8gbmFtZTtcbiAgICAvKipcblx0ICogQSBsaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0aGF0IHNob3VsZCBiZSByZW5kZXJlZCBpbiB0aGUgZWRpdGluZyBwaXBlbGluZSBldmVuIHRob3VnaCBmaWx0ZXJpbmcgbWVjaGFuaXNtc1xuXHQgKiBpbXBsZW1lbnRlZCBpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyfSAoZm9yIGluc3RhbmNlLFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjc2hvdWxkUmVuZGVyQXR0cmlidXRlfSkgd291bGQgZmlsdGVyIHRoZW0gb3V0LlxuXHQgKlxuXHQgKiBUaGVzZSBhdHRyaWJ1dGVzIGNhbiBiZSBzcGVjaWZpZWQgYXMgYW4gb3B0aW9uIHdoZW4gdGhlIGVsZW1lbnQgaXMgY3JlYXRlZCBieVxuXHQgKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0uIFRvIGNoZWNrIHdoZXRoZXIgYW4gdW5zYWZlIGFuIGF0dHJpYnV0ZSBzaG91bGRcblx0ICogYmUgcGVybWl0dGVkLCB1c2UgdGhlIHtAbGluayAjc2hvdWxkUmVuZGVyVW5zYWZlQXR0cmlidXRlfSBtZXRob2QuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3Vuc2FmZUF0dHJpYnV0ZXNUb1JlbmRlciA9IFtdO1xuICAgIC8qKlxuXHQgKiBNYXAgb2YgYXR0cmlidXRlcywgd2hlcmUgYXR0cmlidXRlcyBuYW1lcyBhcmUga2V5cyBhbmQgYXR0cmlidXRlcyB2YWx1ZXMgYXJlIHZhbHVlcy5cblx0ICovIF9hdHRycztcbiAgICAvKipcblx0ICogQXJyYXkgb2YgY2hpbGQgbm9kZXMuXG5cdCAqLyBfY2hpbGRyZW47XG4gICAgLyoqXG5cdCAqIE1hcCBvZiBjdXN0b20gcHJvcGVydGllcy5cblx0ICogQ3VzdG9tIHByb3BlcnRpZXMgY2FuIGJlIGFkZGVkIHRvIGVsZW1lbnQgaW5zdGFuY2UsIHdpbGwgYmUgY2xvbmVkIGJ1dCBub3QgcmVuZGVyZWQgaW50byBET00uXG5cdCAqLyBfY3VzdG9tUHJvcGVydGllcyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogU2V0IG9mIGNsYXNzZXMgYXNzb2NpYXRlZCB3aXRoIGVsZW1lbnQgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGlzIGlzIGp1c3QgYW4gYWxpYXMgZm9yIGB0aGlzLl9hdHRycy5nZXQoICdjbGFzcycgKTtgXG5cdCAqLyBnZXQgX2NsYXNzZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdHRycy5nZXQoJ2NsYXNzJyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOb3JtYWxpemVkIHN0eWxlcy5cblx0ICpcblx0ICogTm90ZSB0aGF0IHRoaXMgaXMganVzdCBhbiBhbGlhcyBmb3IgYHRoaXMuX2F0dHJzLmdldCggJ3N0eWxlJyApO2Bcblx0ICovIGdldCBfc3R5bGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMuZ2V0KCdzdHlsZScpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHZpZXcgZWxlbWVudC5cblx0ICpcblx0ICogQXR0cmlidXRlcyBjYW4gYmUgcGFzc2VkIGluIHZhcmlvdXMgZm9ybWF0czpcblx0ICpcblx0ICogYGBgdHNcblx0ICogbmV3IEVsZW1lbnQoIHZpZXdEb2N1bWVudCwgJ2RpdicsIHsgY2xhc3M6ICdlZGl0b3InLCBjb250ZW50RWRpdGFibGU6ICd0cnVlJyB9ICk7IC8vIG9iamVjdFxuXHQgKiBuZXcgRWxlbWVudCggdmlld0RvY3VtZW50LCAnZGl2JywgWyBbICdjbGFzcycsICdlZGl0b3InIF0sIFsgJ2NvbnRlbnRFZGl0YWJsZScsICd0cnVlJyBdIF0gKTsgLy8gbWFwLWxpa2UgaXRlcmF0b3Jcblx0ICogbmV3IEVsZW1lbnQoIHZpZXdEb2N1bWVudCwgJ2RpdicsIG1hcE9mQXR0cmlidXRlcyApOyAvLyBtYXBcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIGRvY3VtZW50IGluc3RhbmNlIHRvIHdoaWNoIHRoaXMgZWxlbWVudCBiZWxvbmdzLlxuXHQgKiBAcGFyYW0gbmFtZSBOb2RlIG5hbWUuXG5cdCAqIEBwYXJhbSBhdHRycyBDb2xsZWN0aW9uIG9mIGF0dHJpYnV0ZXMuXG5cdCAqIEBwYXJhbSBjaGlsZHJlbiBBIGxpc3Qgb2Ygbm9kZXMgdG8gYmUgaW5zZXJ0ZWQgaW50byBjcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCwgbmFtZSwgYXR0cnMsIGNoaWxkcmVuKXtcbiAgICAgICAgc3VwZXIoZG9jdW1lbnQpO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLl9hdHRycyA9IHRoaXMuX3BhcnNlQXR0cmlidXRlcyhhdHRycyk7XG4gICAgICAgIHRoaXMuX2NoaWxkcmVuID0gW107XG4gICAgICAgIGlmIChjaGlsZHJlbikge1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0Q2hpbGQoMCwgY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOdW1iZXIgb2YgZWxlbWVudCdzIGNoaWxkcmVuLlxuXHQgKi8gZ2V0IGNoaWxkQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJcyBgdHJ1ZWAgaWYgdGhlcmUgYXJlIG5vIG5vZGVzIGluc2lkZSB0aGlzIGVsZW1lbnQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gZ2V0IGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5sZW5ndGggPT09IDA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGNoaWxkIGF0IHRoZSBnaXZlbiBpbmRleC5cblx0ICpcblx0ICogQHBhcmFtIGluZGV4IEluZGV4IG9mIGNoaWxkLlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlLlxuXHQgKi8gZ2V0Q2hpbGQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuW2luZGV4XTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgaW5kZXggb2YgdGhlIGdpdmVuIGNoaWxkIG5vZGUuIFJldHVybnMgYC0xYCBpZiBjaGlsZCBub2RlIGlzIG5vdCBmb3VuZC5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgQ2hpbGQgbm9kZS5cblx0ICogQHJldHVybnMgSW5kZXggb2YgdGhlIGNoaWxkIG5vZGUuXG5cdCAqLyBnZXRDaGlsZEluZGV4KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmluZGV4T2Yobm9kZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGNoaWxkIG5vZGVzIGl0ZXJhdG9yLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlcyBpdGVyYXRvci5cblx0ICovIGdldENoaWxkcmVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpdGVyYXRvciB0aGF0IGNvbnRhaW5zIHRoZSBrZXlzIGZvciBhdHRyaWJ1dGVzLiBPcmRlciBvZiBpbnNlcnRpbmcgYXR0cmlidXRlcyBpcyBub3QgcHJlc2VydmVkLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBLZXlzIGZvciBhdHRyaWJ1dGVzLlxuXHQgKi8gKmdldEF0dHJpYnV0ZUtleXMoKSB7XG4gICAgICAgIC8vIFRoaXMgaXMgeWllbGRlZCBpbiB0aGlzIHNwZWNpZmljIG9yZGVyIHRvIG1haW50YWluIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb2YgZGF0YS5cbiAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSBjb3VsZCBzaW1wbHkganVzdCBoYXZlIHRoZSBgZm9yYCBsb29wIG9ubHkgaW5zaWRlIHRoaXMgbWV0aG9kLlxuICAgICAgICBpZiAodGhpcy5fY2xhc3Nlcykge1xuICAgICAgICAgICAgeWllbGQgJ2NsYXNzJztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fc3R5bGVzKSB7XG4gICAgICAgICAgICB5aWVsZCAnc3R5bGUnO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIHRoaXMuX2F0dHJzLmtleXMoKSl7XG4gICAgICAgICAgICBpZiAoa2V5ICE9ICdjbGFzcycgJiYga2V5ICE9ICdzdHlsZScpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBrZXk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgZWxlbWVudCdzIGF0dHJpYnV0ZXMuXG5cdCAqXG5cdCAqIEF0dHJpYnV0ZXMgYXJlIHJldHVybmVkIGFzIGFycmF5cyBjb250YWluaW5nIHR3byBpdGVtcy4gRmlyc3Qgb25lIGlzIGF0dHJpYnV0ZSBrZXkgYW5kIHNlY29uZCBpcyBhdHRyaWJ1dGUgdmFsdWUuXG5cdCAqIFRoaXMgZm9ybWF0IGlzIGFjY2VwdGVkIGJ5IG5hdGl2ZSBgTWFwYCBvYmplY3QgYW5kIGFsc28gY2FuIGJlIHBhc3NlZCBpbiBgTm9kZWAgY29uc3RydWN0b3IuXG5cdCAqLyAqZ2V0QXR0cmlidXRlcygpIHtcbiAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIHRoaXMuX2F0dHJzLmVudHJpZXMoKSl7XG4gICAgICAgICAgICB5aWVsZCBbXG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBTdHJpbmcodmFsdWUpXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGF0dHJpYnV0ZSBieSBrZXkuIElmIGF0dHJpYnV0ZSBpcyBub3QgcHJlc2VudCAtIHJldHVybnMgdW5kZWZpbmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBrZXkuXG5cdCAqIEByZXR1cm5zIEF0dHJpYnV0ZSB2YWx1ZS5cblx0ICovIGdldEF0dHJpYnV0ZShrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJzLmhhcyhrZXkpID8gU3RyaW5nKHRoaXMuX2F0dHJzLmdldChrZXkpKSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciBhbiBhdHRyaWJ1dGUgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBleGlzdHMgaW4gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBrZXkgQXR0cmlidXRlIGtleS5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIGF0dHJpYnV0ZSB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IGV4aXN0cyBpbiB0aGUgZWxlbWVudCwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBoYXNBdHRyaWJ1dGUoa2V5LCB0b2tlbikge1xuICAgICAgICBpZiAoIXRoaXMuX2F0dHJzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRva2VuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICh1c2VzU3R5bGVzTWFwKHRoaXMubmFtZSwga2V5KSB8fCB1c2VzVG9rZW5MaXN0KHRoaXMubmFtZSwga2V5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdHRycy5nZXQoa2V5KS5oYXModG9rZW4pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMuZ2V0KGtleSkgPT09IHRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoaXMgZWxlbWVudCBpcyBzaW1pbGFyIHRvIG90aGVyIGVsZW1lbnQuXG5cdCAqIEJvdGggZWxlbWVudHMgc2hvdWxkIGhhdmUgdGhlIHNhbWUgbmFtZSBhbmQgYXR0cmlidXRlcyB0byBiZSBjb25zaWRlcmVkIGFzIHNpbWlsYXIuIFR3byBzaW1pbGFyIGVsZW1lbnRzXG5cdCAqIGNhbiBjb250YWluIGRpZmZlcmVudCBzZXQgb2YgY2hpbGRyZW4gbm9kZXMuXG5cdCAqLyBpc1NpbWlsYXIob3RoZXJFbGVtZW50KSB7XG4gICAgICAgIGlmICghKG90aGVyRWxlbWVudCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgZXhhY3RseSB0aGUgc2FtZSBFbGVtZW50IGlzIHByb3ZpZGVkIC0gcmV0dXJuIHRydWUgaW1tZWRpYXRlbHkuXG4gICAgICAgIGlmICh0aGlzID09PSBvdGhlckVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGVsZW1lbnQgbmFtZS5cbiAgICAgICAgaWYgKHRoaXMubmFtZSAhPSBvdGhlckVsZW1lbnQubmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIG51bWJlciBvZiBhdHRyaWJ1dGVzLCBjbGFzc2VzIGFuZCBzdHlsZXMuXG4gICAgICAgIGlmICh0aGlzLl9hdHRycy5zaXplICE9PSBvdGhlckVsZW1lbnQuX2F0dHJzLnNpemUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiBhdHRyaWJ1dGVzIGFyZSB0aGUgc2FtZS5cbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5fYXR0cnMpe1xuICAgICAgICAgICAgY29uc3Qgb3RoZXJWYWx1ZSA9IG90aGVyRWxlbWVudC5fYXR0cnMuZ2V0KGtleSk7XG4gICAgICAgICAgICBpZiAob3RoZXJWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0eXBlb2Ygb3RoZXJWYWx1ZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGlmIChvdGhlclZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghdmFsdWUuaXNTaW1pbGFyKG90aGVyVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0cnVlIGlmIGNsYXNzIGlzIHByZXNlbnQuXG5cdCAqIElmIG1vcmUgdGhlbiBvbmUgY2xhc3MgaXMgcHJvdmlkZWQgLSByZXR1cm5zIHRydWUgb25seSB3aGVuIGFsbCBjbGFzc2VzIGFyZSBwcmVzZW50LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlbGVtZW50Lmhhc0NsYXNzKCAnZm9vJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2ZvbycgY2xhc3MgaXMgcHJlc2VudC5cblx0ICogZWxlbWVudC5oYXNDbGFzcyggJ2ZvbycsICdiYXInICk7IC8vIFJldHVybnMgdHJ1ZSBpZiAnZm9vJyBhbmQgJ2JhcicgY2xhc3NlcyBhcmUgYm90aCBwcmVzZW50LlxuXHQgKiBgYGBcblx0ICovIGhhc0NsYXNzKC4uLmNsYXNzTmFtZSkge1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgY2xhc3NOYW1lKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2xhc3NlcyB8fCAhdGhpcy5fY2xhc3Nlcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGl0ZXJhdG9yIHRoYXQgY29udGFpbnMgYWxsIGNsYXNzIG5hbWVzLlxuXHQgKi8gZ2V0Q2xhc3NOYW1lcygpIHtcbiAgICAgICAgY29uc3QgYXJyYXkgPSB0aGlzLl9jbGFzc2VzID8gdGhpcy5fY2xhc3Nlcy5rZXlzKCkgOiBbXTtcbiAgICAgICAgLy8gVGhpcyBpcyBvdmVyY29tcGxpY2F0ZWQgYmVjYXVzZSB3ZSBuZWVkIHRvIGJlIGJhY2t3YXJkIGNvbXBhdGlibGUgZm9yIHVzZSBjYXNlcyB3aGVuIGl0ZXJhdG9yIGlzIGV4cGVjdGVkLlxuICAgICAgICBjb25zdCBpdGVyYXRvciA9IGFycmF5W1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYXJyYXksIHtcbiAgICAgICAgICAgIG5leHQ6IGl0ZXJhdG9yLm5leHQuYmluZChpdGVyYXRvcilcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHN0eWxlIHZhbHVlIGZvciB0aGUgZ2l2ZW4gcHJvcGVydHkgbmFtZS5cblx0ICogSWYgdGhlIHN0eWxlIGRvZXMgbm90IGV4aXN0IGB1bmRlZmluZWRgIGlzIHJldHVybmVkLlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVGhpcyBtZXRob2QgY2FuIHdvcmsgd2l0aCBub3JtYWxpemVkIHN0eWxlIG5hbWVzIGlmXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyBhIHBhcnRpY3VsYXIgc3R5bGUgcHJvY2Vzc29yIHJ1bGUgaXMgZW5hYmxlZH0uXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlc21hcH5TdHlsZXNNYXAjZ2V0QXNTdHJpbmcgYFN0eWxlc01hcCNnZXRBc1N0cmluZygpYH0gZm9yIGRldGFpbHMuXG5cdCAqXG5cdCAqIEZvciBhbiBlbGVtZW50IHdpdGggc3R5bGUgc2V0IHRvIGAnbWFyZ2luOjFweCdgOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBFbmFibGUgJ21hcmdpbicgc2hvcnRoYW5kIHByb2Nlc3Npbmc6XG5cdCAqIGVkaXRvci5kYXRhLmFkZFN0eWxlUHJvY2Vzc29yUnVsZXMoIGFkZE1hcmdpblJ1bGVzICk7XG5cdCAqXG5cdCAqIGNvbnN0IGVsZW1lbnQgPSB2aWV3LmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHRjb25zdCBlbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoKTtcblx0ICogXHR3cml0ZXIuc2V0U3R5bGUoICdtYXJnaW4nLCAnMXB4JyApO1xuXHQgKiBcdHdyaXRlci5zZXRTdHlsZSggJ21hcmdpbi1ib3R0b20nLCAnM2VtJyApO1xuXHQgKlxuXHQgKiBcdHJldHVybiBlbGVtZW50O1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVsZW1lbnQuZ2V0U3R5bGUoICdtYXJnaW4nICk7IC8vIC0+ICdtYXJnaW46IDFweCAxcHggM2VtOydcblx0ICogYGBgXG5cdCAqLyBnZXRTdHlsZShwcm9wZXJ0eSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVzICYmIHRoaXMuX3N0eWxlcy5nZXRBc1N0cmluZyhwcm9wZXJ0eSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgbm9ybWFsaXplZCBzdHlsZSBvYmplY3Qgb3Igc2luZ2xlIHN0eWxlIHZhbHVlLlxuXHQgKlxuXHQgKiBGb3IgYW4gZWxlbWVudCB3aXRoIHN0eWxlIHNldCB0bzogbWFyZ2luOjFweCAycHggM2VtO1xuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlbGVtZW50LmdldE5vcm1hbGl6ZWRTdHlsZSggJ21hcmdpbicgKSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogd2lsbCByZXR1cm46XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHtcblx0ICogXHR0b3A6ICcxcHgnLFxuXHQgKiBcdHJpZ2h0OiAnMnB4Jyxcblx0ICogXHRib3R0b206ICczZW0nLFxuXHQgKiBcdGxlZnQ6ICcycHgnICAgIC8vIGEgbm9ybWFsaXplZCB2YWx1ZSBmcm9tIG1hcmdpbiBzaG9ydGhhbmRcblx0ICogfVxuXHQgKiBgYGBcblx0ICpcblx0ICogYW5kIHJlYWRpbmcgZm9yIHNpbmdsZSBzdHlsZSB2YWx1ZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogc3R5bGVzLmdldE5vcm1hbGl6ZWRTdHlsZSggJ21hcmdpbi1sZWZ0JyApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogV2lsbCByZXR1cm4gYSBgMnB4YCBzdHJpbmcuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIG1ldGhvZCB3aWxsIHJldHVybiBub3JtYWxpemVkIHZhbHVlcyBvbmx5IGlmXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyBhIHBhcnRpY3VsYXIgc3R5bGUgcHJvY2Vzc29yIHJ1bGUgaXMgZW5hYmxlZH0uXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlc21hcH5TdHlsZXNNYXAjZ2V0Tm9ybWFsaXplZCBgU3R5bGVzTWFwI2dldE5vcm1hbGl6ZWQoKWB9IGZvciBkZXRhaWxzLlxuXHQgKlxuXHQgKiBAcGFyYW0gcHJvcGVydHkgTmFtZSBvZiBDU1MgcHJvcGVydHlcblx0ICovIGdldE5vcm1hbGl6ZWRTdHlsZShwcm9wZXJ0eSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVzICYmIHRoaXMuX3N0eWxlcy5nZXROb3JtYWxpemVkKHByb3BlcnR5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gYXJyYXkgdGhhdCBjb250YWlucyBhbGwgc3R5bGUgbmFtZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBleHBhbmQgRXhwYW5kIHNob3J0aGFuZCBzdHlsZSBwcm9wZXJ0aWVzIGFuZCByZXR1cm4gYWxsIGVxdWl2YWxlbnQgc3R5bGUgcmVwcmVzZW50YXRpb25zLlxuXHQgKi8gZ2V0U3R5bGVOYW1lcyhleHBhbmQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0eWxlcyA/IHRoaXMuX3N0eWxlcy5nZXRTdHlsZU5hbWVzKGV4cGFuZCkgOiBbXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdHJ1ZSBpZiBzdHlsZSBrZXlzIGFyZSBwcmVzZW50LlxuXHQgKiBJZiBtb3JlIHRoZW4gb25lIHN0eWxlIHByb3BlcnR5IGlzIHByb3ZpZGVkIC0gcmV0dXJucyB0cnVlIG9ubHkgd2hlbiBhbGwgcHJvcGVydGllcyBhcmUgcHJlc2VudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogZWxlbWVudC5oYXNTdHlsZSggJ2NvbG9yJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2JvcmRlci10b3AnIHN0eWxlIGlzIHByZXNlbnQuXG5cdCAqIGVsZW1lbnQuaGFzU3R5bGUoICdjb2xvcicsICdib3JkZXItdG9wJyApOyAvLyBSZXR1cm5zIHRydWUgaWYgJ2NvbG9yJyBhbmQgJ2JvcmRlci10b3AnIHN0eWxlcyBhcmUgYm90aCBwcmVzZW50LlxuXHQgKiBgYGBcblx0ICovIGhhc1N0eWxlKC4uLnByb3BlcnR5KSB7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBwcm9wZXJ0eSl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX3N0eWxlcyB8fCAhdGhpcy5fc3R5bGVzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW5jZXN0b3IgZWxlbWVudCB0aGF0IG1hdGNoIHNwZWNpZmllZCBwYXR0ZXJuLlxuXHQgKiBQcm92aWRlZCBwYXR0ZXJucyBzaG91bGQgYmUgY29tcGF0aWJsZSB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyIE1hdGNoZXJ9IGFzIGl0IGlzIHVzZWQgaW50ZXJuYWxseS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyXG5cdCAqIEBwYXJhbSBwYXR0ZXJucyBQYXR0ZXJucyB1c2VkIHRvIG1hdGNoIGNvcnJlY3QgYW5jZXN0b3IuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlcn0uXG5cdCAqIEByZXR1cm5zIEZvdW5kIGVsZW1lbnQgb3IgYG51bGxgIGlmIG5vIG1hdGNoaW5nIGFuY2VzdG9yIHdhcyBmb3VuZC5cblx0ICovIGZpbmRBbmNlc3RvciguLi5wYXR0ZXJucykge1xuICAgICAgICBjb25zdCBtYXRjaGVyID0gbmV3IE1hdGNoZXIoLi4ucGF0dGVybnMpO1xuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgIHdoaWxlKHBhcmVudCAmJiAhcGFyZW50LmlzKCdkb2N1bWVudEZyYWdtZW50Jykpe1xuICAgICAgICAgICAgaWYgKG1hdGNoZXIubWF0Y2gocGFyZW50KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgY3VzdG9tIHByb3BlcnR5IHZhbHVlIGZvciB0aGUgZ2l2ZW4ga2V5LlxuXHQgKi8gZ2V0Q3VzdG9tUHJvcGVydHkoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzLmdldChrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpdGVyYXRvciB3aGljaCBpdGVyYXRlcyBvdmVyIHRoaXMgZWxlbWVudCdzIGN1c3RvbSBwcm9wZXJ0aWVzLlxuXHQgKiBJdGVyYXRvciBwcm92aWRlcyBgWyBrZXksIHZhbHVlIF1gIHBhaXJzIGZvciBlYWNoIHN0b3JlZCBwcm9wZXJ0eS5cblx0ICovICpnZXRDdXN0b21Qcm9wZXJ0aWVzKCkge1xuICAgICAgICB5aWVsZCogdGhpcy5fY3VzdG9tUHJvcGVydGllcy5lbnRyaWVzKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGlkZW50aXR5IHN0cmluZyBiYXNlZCBvbiBlbGVtZW50J3MgbmFtZSwgc3R5bGVzLCBjbGFzc2VzIGFuZCBvdGhlciBhdHRyaWJ1dGVzLlxuXHQgKiBUd28gZWxlbWVudHMgdGhhdCB7QGxpbmsgI2lzU2ltaWxhciBhcmUgc2ltaWxhcn0gd2lsbCBoYXZlIHNhbWUgaWRlbnRpdHkgc3RyaW5nLlxuXHQgKiBJdCBoYXMgdGhlIGZvbGxvd2luZyBmb3JtYXQ6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqICduYW1lIGNsYXNzPVwiY2xhc3MxLGNsYXNzMlwiIHN0eWxlPVwic3R5bGUxOnZhbHVlMTtzdHlsZTI6dmFsdWUyXCIgYXR0cjE9XCJ2YWwxXCIgYXR0cjI9XCJ2YWwyXCInXG5cdCAqIGBgYFxuIFx0ICpcblx0ICogRm9yIGV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IGVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ2ZvbycsIHtcblx0ICogXHRiYW5hbmE6ICcxMCcsXG5cdCAqIFx0YXBwbGU6ICcyMCcsXG5cdCAqIFx0c3R5bGU6ICdjb2xvcjogcmVkOyBib3JkZXItY29sb3I6IHdoaXRlOycsXG5cdCAqIFx0Y2xhc3M6ICdiYXonXG5cdCAqIH0gKTtcblx0ICpcblx0ICogLy8gcmV0dXJucyAnZm9vIGNsYXNzPVwiYmF6XCIgc3R5bGU9XCJib3JkZXItY29sb3I6d2hpdGU7Y29sb3I6cmVkXCIgYXBwbGU9XCIyMFwiIGJhbmFuYT1cIjEwXCInXG5cdCAqIGVsZW1lbnQuZ2V0SWRlbnRpdHkoKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBDbGFzc2VzLCBzdHlsZXMgYW5kIG90aGVyIGF0dHJpYnV0ZXMgYXJlIHNvcnRlZCBhbHBoYWJldGljYWxseS5cblx0ICovIGdldElkZW50aXR5KCkge1xuICAgICAgICBjb25zdCBjbGFzc2VzID0gdGhpcy5fY2xhc3NlcyA/IHRoaXMuX2NsYXNzZXMua2V5cygpLnNvcnQoKS5qb2luKCcsJykgOiAnJztcbiAgICAgICAgY29uc3Qgc3R5bGVzID0gdGhpcy5fc3R5bGVzICYmIFN0cmluZyh0aGlzLl9zdHlsZXMpO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gQXJyYXkuZnJvbSh0aGlzLl9hdHRycykuZmlsdGVyKChba2V5XSk9PmtleSAhPSAnc3R5bGUnICYmIGtleSAhPSAnY2xhc3MnKS5tYXAoKGkpPT5gJHtpWzBdfT1cIiR7aVsxXX1cImApLnNvcnQoKS5qb2luKCcgJyk7XG4gICAgICAgIHJldHVybiB0aGlzLm5hbWUgKyAoY2xhc3NlcyA9PSAnJyA/ICcnIDogYCBjbGFzcz1cIiR7Y2xhc3Nlc31cImApICsgKCFzdHlsZXMgPyAnJyA6IGAgc3R5bGU9XCIke3N0eWxlc31cImApICsgKGF0dHJpYnV0ZXMgPT0gJycgPyAnJyA6IGAgJHthdHRyaWJ1dGVzfWApO1xuICAgIH1cbiAgICAvKipcblx0ICogRGVjaWRlcyB3aGV0aGVyIGFuIHVuc2FmZSBhdHRyaWJ1dGUgaXMgd2hpdGVsaXN0ZWQgYW5kIHNob3VsZCBiZSByZW5kZXJlZCBpbiB0aGUgZWRpdGluZyBwaXBlbGluZSBldmVuIHRob3VnaCBmaWx0ZXJpbmcgbWVjaGFuaXNtc1xuXHQgKiBsaWtlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNzaG91bGRSZW5kZXJBdHRyaWJ1dGV9IHNheSBpdCBzaG91bGQgbm90LlxuXHQgKlxuXHQgKiBVbnNhZmUgYXR0cmlidXRlIG5hbWVzIGNhbiBiZSBzcGVjaWZpZWQgd2hlbiBjcmVhdGluZyBhbiBlbGVtZW50IHZpYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfS5cblx0ICpcblx0ICogQHBhcmFtIGF0dHJpYnV0ZU5hbWUgVGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBiZSBjaGVja2VkLlxuXHQgKi8gc2hvdWxkUmVuZGVyVW5zYWZlQXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Vuc2FmZUF0dHJpYnV0ZXNUb1JlbmRlci5pbmNsdWRlcyhhdHRyaWJ1dGVOYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyBwcm92aWRlZCBlbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGRlZXAgSWYgc2V0IHRvIGB0cnVlYCBjbG9uZXMgZWxlbWVudCBhbmQgYWxsIGl0cyBjaGlsZHJlbiByZWN1cnNpdmVseS4gV2hlbiBzZXQgdG8gYGZhbHNlYCxcblx0ICogZWxlbWVudCB3aWxsIGJlIGNsb25lZCB3aXRob3V0IGFueSBjaGlsZHJlbi5cblx0ICogQHJldHVybnMgQ2xvbmUgb2YgdGhpcyBlbGVtZW50LlxuXHQgKi8gX2Nsb25lKGRlZXAgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCBjaGlsZHJlbkNsb25lID0gW107XG4gICAgICAgIGlmIChkZWVwKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgY2hpbGRyZW5DbG9uZS5wdXNoKGNoaWxkLl9jbG9uZShkZWVwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ29udGFpbmVyRWxlbWVudCBhbmQgQXR0cmlidXRlRWxlbWVudCBzaG91bGQgYmUgYWxzbyBjbG9uZWQgcHJvcGVybHkuXG4gICAgICAgIGNvbnN0IGNsb25lZCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuZG9jdW1lbnQsIHRoaXMubmFtZSwgdGhpcy5fYXR0cnMsIGNoaWxkcmVuQ2xvbmUpO1xuICAgICAgICAvLyBDbG9uZSBjdXN0b20gcHJvcGVydGllcy5cbiAgICAgICAgY2xvbmVkLl9jdXN0b21Qcm9wZXJ0aWVzID0gbmV3IE1hcCh0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzKTtcbiAgICAgICAgLy8gQ2xvbmUgZmlsbGVyIG9mZnNldCBtZXRob2QuXG4gICAgICAgIC8vIFdlIGNhbid0IGRlZmluZSB0aGlzIG1ldGhvZCBpbiBhIHByb3RvdHlwZSBiZWNhdXNlIGl0J3MgYmVoYXZpb3Igd2hpY2hcbiAgICAgICAgLy8gaXMgY2hhbmdlZCBieSBlLmcuIHRvV2lkZ2V0KCkgZnVuY3Rpb24gZnJvbSBja2VkaXRvcjUtd2lkZ2V0LiBQZXJoYXBzIHRoaXMgc2hvdWxkIGJlIG9uZSBvZiBjdXN0b20gcHJvcHMuXG4gICAgICAgIGNsb25lZC5nZXRGaWxsZXJPZmZzZXQgPSB0aGlzLmdldEZpbGxlck9mZnNldDtcbiAgICAgICAgLy8gQ2xvbmUgdW5zYWZlIGF0dHJpYnV0ZXMgbGlzdC5cbiAgICAgICAgY2xvbmVkLl91bnNhZmVBdHRyaWJ1dGVzVG9SZW5kZXIgPSB0aGlzLl91bnNhZmVBdHRyaWJ1dGVzVG9SZW5kZXI7XG4gICAgICAgIHJldHVybiBjbG9uZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfaW5zZXJ0Q2hpbGQgSW5zZXJ0fSBhIGNoaWxkIG5vZGUgb3IgYSBsaXN0IG9mIGNoaWxkIG5vZGVzIGF0IHRoZSBlbmQgb2YgdGhpcyBub2RlXG5cdCAqIGFuZCBzZXRzIHRoZSBwYXJlbnQgb2YgdGhlc2Ugbm9kZXMgdG8gdGhpcyBlbGVtZW50LlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNpbnNlcnRcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBpdGVtcyBJdGVtcyB0byBiZSBpbnNlcnRlZC5cblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKiBAcmV0dXJucyBOdW1iZXIgb2YgYXBwZW5kZWQgbm9kZXMuXG5cdCAqLyBfYXBwZW5kQ2hpbGQoaXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc2VydENoaWxkKHRoaXMuY2hpbGRDb3VudCwgaXRlbXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyBhIGNoaWxkIG5vZGUgb3IgYSBsaXN0IG9mIGNoaWxkIG5vZGVzIG9uIHRoZSBnaXZlbiBpbmRleCBhbmQgc2V0cyB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvXG5cdCAqIHRoaXMgZWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2luc2VydFxuXHQgKiBAcGFyYW0gaW5kZXggUG9zaXRpb24gd2hlcmUgbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICogQHJldHVybnMgTnVtYmVyIG9mIGluc2VydGVkIG5vZGVzLlxuXHQgKi8gX2luc2VydENoaWxkKGluZGV4LCBpdGVtcykge1xuICAgICAgICB0aGlzLl9maXJlQ2hhbmdlKCdjaGlsZHJlbicsIHRoaXMsIHtcbiAgICAgICAgICAgIGluZGV4XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICBjb25zdCBub2RlcyA9IG5vcm1hbGl6ZSQzKHRoaXMuZG9jdW1lbnQsIGl0ZW1zKTtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKXtcbiAgICAgICAgICAgIC8vIElmIG5vZGUgdGhhdCBpcyBiZWluZyBhZGRlZCB0byB0aGlzIGVsZW1lbnQgaXMgYWxyZWFkeSBpbnNpZGUgYW5vdGhlciBlbGVtZW50LCBmaXJzdCByZW1vdmUgaXQgZnJvbSB0aGUgb2xkIHBhcmVudC5cbiAgICAgICAgICAgIGlmIChub2RlLnBhcmVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG5vZGUuX3JlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZS5wYXJlbnQgPSB0aGlzO1xuICAgICAgICAgICAgbm9kZS5kb2N1bWVudCA9IHRoaXMuZG9jdW1lbnQ7XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIG5vZGUpO1xuICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBudW1iZXIgb2YgY2hpbGQgbm9kZXMgc3RhcnRpbmcgYXQgdGhlIGdpdmVuIGluZGV4IGFuZCBzZXQgdGhlIHBhcmVudCBvZiB0aGVzZSBub2RlcyB0byBgbnVsbGAuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3JlbW92ZVxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGluZGV4IE51bWJlciBvZiB0aGUgZmlyc3Qgbm9kZSB0byByZW1vdmUuXG5cdCAqIEBwYXJhbSBob3dNYW55IE51bWJlciBvZiBub2RlcyB0byByZW1vdmUuXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICogQHJldHVybnMgVGhlIGFycmF5IG9mIHJlbW92ZWQgbm9kZXMuXG5cdCAqLyBfcmVtb3ZlQ2hpbGRyZW4oaW5kZXgsIGhvd01hbnkgPSAxKSB7XG4gICAgICAgIHRoaXMuX2ZpcmVDaGFuZ2UoJ2NoaWxkcmVuJywgdGhpcywge1xuICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgfSk7XG4gICAgICAgIGZvcihsZXQgaSA9IGluZGV4OyBpIDwgaW5kZXggKyBob3dNYW55OyBpKyspe1xuICAgICAgICAgICAgdGhpcy5fY2hpbGRyZW5baV0ucGFyZW50ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGluZGV4LCBob3dNYW55KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgb3Igb3ZlcndyaXRlIGF0dHJpYnV0ZSB3aXRoIGEgc3BlY2lmaWVkIGtleSBhbmQgdmFsdWUuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3NldEF0dHJpYnV0ZVxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGtleSBBdHRyaWJ1dGUga2V5LlxuXHQgKiBAcGFyYW0gdmFsdWUgQXR0cmlidXRlIHZhbHVlLlxuXHQgKiBAcGFyYW0gb3ZlcndyaXRlIFdoZXRoZXIgdG9rZW5pemVkIGF0dHJpYnV0ZSBzaG91bGQgb3ZlcnJpZGUgdGhlIGF0dHJpYnV0ZSB2YWx1ZSBvciBqdXN0IGFkZCBhIHRva2VuLlxuXHQgKiBAZmlyZXMgY2hhbmdlXG5cdCAqLyBfc2V0QXR0cmlidXRlKGtleSwgdmFsdWUsIG92ZXJ3cml0ZSA9IHRydWUpIHtcbiAgICAgICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpO1xuICAgICAgICBpZiAodXNlc1N0eWxlc01hcCh0aGlzLm5hbWUsIGtleSkgfHwgdXNlc1Rva2VuTGlzdCh0aGlzLm5hbWUsIGtleSkpIHtcbiAgICAgICAgICAgIGxldCBjdXJyZW50VmFsdWUgPSB0aGlzLl9hdHRycy5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICghY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gdXNlc1N0eWxlc01hcCh0aGlzLm5hbWUsIGtleSkgPyBuZXcgU3R5bGVzTWFwKHRoaXMuZG9jdW1lbnQuc3R5bGVzUHJvY2Vzc29yKSA6IG5ldyBUb2tlbkxpc3QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdHRycy5zZXQoa2V5LCBjdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG92ZXJ3cml0ZSkge1xuICAgICAgICAgICAgICAgIC8vIElmIHJlc2V0IGlzIHNldCB0aGVuIHZhbHVlIGhhdmUgdG8gYmUgYSBzdHJpbmcgdG8gdG9rZW5pemUuXG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNldFRvKFN0cmluZyh2YWx1ZSkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VzU3R5bGVzTWFwKHRoaXMubmFtZSwga2V5KSkge1xuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUuc2V0KHZhbHVlWzBdLCB2YWx1ZVsxXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnNldCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUuc2V0KHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyA/IHZhbHVlLnNwbGl0KC9cXHMrLykgOiB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9hdHRycy5zZXQoa2V5LCBTdHJpbmcodmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhdHRyaWJ1dGUgZnJvbSB0aGUgZWxlbWVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjcmVtb3ZlQXR0cmlidXRlXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBrZXkuXG5cdCAqIEBwYXJhbSB0b2tlbnMgQXR0cmlidXRlIHZhbHVlIHRva2VucyB0byByZW1vdmUuIFRoZSB3aG9sZSBhdHRyaWJ1dGUgaXMgcmVtb3ZlZCBpZiBub3Qgc3BlY2lmaWVkLlxuXHQgKiBAcmV0dXJucyBSZXR1cm5zIHRydWUgaWYgYW4gYXR0cmlidXRlIGV4aXN0ZWQgYW5kIGhhcyBiZWVuIHJlbW92ZWQuXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICovIF9yZW1vdmVBdHRyaWJ1dGUoa2V5LCB0b2tlbnMpIHtcbiAgICAgICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpO1xuICAgICAgICBpZiAodG9rZW5zICE9PSB1bmRlZmluZWQgJiYgKHVzZXNTdHlsZXNNYXAodGhpcy5uYW1lLCBrZXkpIHx8IHVzZXNUb2tlbkxpc3QodGhpcy5uYW1lLCBrZXkpKSkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFZhbHVlID0gdGhpcy5fYXR0cnMuZ2V0KGtleSk7XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh1c2VzVG9rZW5MaXN0KHRoaXMubmFtZSwga2V5KSAmJiB0eXBlb2YgdG9rZW5zID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zLnNwbGl0KC9cXHMrLyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50VmFsdWUucmVtb3ZlKHRva2Vucyk7XG4gICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlLmlzRW1wdHkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJzLmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBzcGVjaWZpZWQgY2xhc3MuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVsZW1lbnQuX2FkZENsYXNzKCAnZm9vJyApOyAvLyBBZGRzICdmb28nIGNsYXNzLlxuXHQgKiBlbGVtZW50Ll9hZGRDbGFzcyggWyAnZm9vJywgJ2JhcicgXSApOyAvLyBBZGRzICdmb28nIGFuZCAnYmFyJyBjbGFzc2VzLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYWRkQ2xhc3Ncblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICovIF9hZGRDbGFzcyhjbGFzc05hbWUpIHtcbiAgICAgICAgdGhpcy5fc2V0QXR0cmlidXRlKCdjbGFzcycsIGNsYXNzTmFtZSwgZmFsc2UpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBzcGVjaWZpZWQgY2xhc3MuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVsZW1lbnQuX3JlbW92ZUNsYXNzKCAnZm9vJyApOyAgLy8gUmVtb3ZlcyAnZm9vJyBjbGFzcy5cblx0ICogZWxlbWVudC5fcmVtb3ZlQ2xhc3MoIFsgJ2ZvbycsICdiYXInIF0gKTsgLy8gUmVtb3ZlcyBib3RoICdmb28nIGFuZCAnYmFyJyBjbGFzc2VzLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjcmVtb3ZlQ2xhc3Ncblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICovIF9yZW1vdmVDbGFzcyhjbGFzc05hbWUpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlQXR0cmlidXRlKCdjbGFzcycsIGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIF9zZXRTdHlsZShwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBwcm9wZXJ0eSAhPSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5fc2V0QXR0cmlidXRlKCdzdHlsZScsIHByb3BlcnR5LCBmYWxzZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgW1xuICAgICAgICAgICAgICAgIHByb3BlcnR5LFxuICAgICAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICBdLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgc3BlY2lmaWVkIHN0eWxlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlbGVtZW50Ll9yZW1vdmVTdHlsZSggJ2NvbG9yJyApOyAgLy8gUmVtb3ZlcyAnY29sb3InIHN0eWxlLlxuXHQgKiBlbGVtZW50Ll9yZW1vdmVTdHlsZSggWyAnY29sb3InLCAnYm9yZGVyLXRvcCcgXSApOyAvLyBSZW1vdmVzIGJvdGggJ2NvbG9yJyBhbmQgJ2JvcmRlci10b3AnIHN0eWxlcy5cblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIG1ldGhvZCBjYW4gd29yayB3aXRoIG5vcm1hbGl6ZWQgc3R5bGUgbmFtZXMgaWZcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNhZGRTdHlsZVByb2Nlc3NvclJ1bGVzIGEgcGFydGljdWxhciBzdHlsZSBwcm9jZXNzb3IgcnVsZSBpcyBlbmFibGVkfS5cblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc3R5bGVzbWFwflN0eWxlc01hcCNyZW1vdmUgYFN0eWxlc01hcCNyZW1vdmUoKWB9IGZvciBkZXRhaWxzLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNyZW1vdmVTdHlsZVxuXHQgKiBAaW50ZXJuYWxcblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKi8gX3JlbW92ZVN0eWxlKHByb3BlcnR5KSB7XG4gICAgICAgIHRoaXMuX3JlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnLCBwcm9wZXJ0eSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlciBNYXRjaGVyfSB0byBjb2xsZWN0IG1hdGNoaW5nIGF0dHJpYnV0ZSB0dXBsZXNcblx0ICogKGF0dHJpYnV0ZSBuYW1lIGFuZCBvcHRpb25hbCB0b2tlbikuXG5cdCAqXG5cdCAqIE5vcm1hbGl6ZWQgcGF0dGVybnMgY2FuIGJlIHVzZWQgaW4gZm9sbG93aW5nIHdheXM6XG5cdCAqIC0gdG8gbWF0Y2ggYW55IGF0dHJpYnV0ZSBuYW1lIHdpdGggYW55IG9yIG5vIHZhbHVlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBwYXR0ZXJuczogW1xuXHQgKiBcdFsgdHJ1ZSwgdHJ1ZSBdXG5cdCAqIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIC0gdG8gbWF0Y2ggYSBzcGVjaWZpYyBhdHRyaWJ1dGUgd2l0aCBhbnkgdmFsdWU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHBhdHRlcm5zOiBbXG5cdCAqIFx0WyAncmVxdWlyZWQnLCB0cnVlIF1cblx0ICogXVxuXHQgKiBgYGBcblx0ICpcblx0ICogLSB0byBtYXRjaCBhbiBhdHRyaWJ1dGUgbmFtZSB3aXRoIGEgUmVnRXhwIHdpdGggYW55IHZhbHVlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBwYXR0ZXJuczogW1xuXHQgKiBcdFsgL2hbMS02XS8sIHRydWUgXVxuXHQgKiBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBcdC0gdG8gbWF0Y2ggYSBzcGVjaWZpYyBhdHRyaWJ1dGUgd2l0aCB0aGUgZXhhY3QgdmFsdWU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHBhdHRlcm5zOiBbXG5cdCAqIFx0WyAncmVsJywgJ25vZm9sbG93JyBdXG5cdCAqIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIFx0LSB0byBtYXRjaCBhIHNwZWNpZmljIGF0dHJpYnV0ZSB3aXRoIGEgdmFsdWUgbWF0Y2hpbmcgYSBSZWdFeHA6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHBhdHRlcm5zOiBbXG5cdCAqIFx0WyAnc3JjJywgL15odHRwcy8gXVxuXHQgKiBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBcdC0gdG8gbWF0Y2ggYW4gYXR0cmlidXRlIG5hbWUgd2l0aCBhIFJlZ0V4cCBhbmQgdGhlIGV4YWN0IHZhbHVlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBwYXR0ZXJuczogW1xuXHQgKiBcdFsgL15kYXRhLXByb3BlcnR5LS8sICdmb29iYXInIF0sXG5cdCAqIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIFx0LSB0byBtYXRjaCBhbiBhdHRyaWJ1dGUgbmFtZSB3aXRoIGEgUmVnRXhwIGFuZCBtYXRjaCBhIHZhbHVlIHdpdGggYW5vdGhlciBSZWdFeHA6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHBhdHRlcm5zOiBbXG5cdCAqIFx0WyAvXmRhdGEtcHJvcGVydHktLywgL15mb28vIF1cblx0ICogXVxuXHQgKiBgYGBcblx0ICpcblx0ICogXHQtIHRvIG1hdGNoIGEgc3BlY2lmaWMgc3R5bGUgcHJvcGVydHkgd2l0aCB0aGUgdmFsdWUgbWF0Y2hpbmcgYSBSZWdFeHA6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHBhdHRlcm5zOiBbXG5cdCAqIFx0WyAnc3R5bGUnLCAnZm9udC1zaXplJywgL3B4JC8gXVxuXHQgKiBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBcdC0gdG8gbWF0Y2ggYSBzcGVjaWZpYyBjbGFzcyAoY2xhc3MgYXR0cmlidXRlIGlzIHRva2VuaXplZCBzbyBpdCBtYXRjaGVzIHRva2VucyBpbmRpdmlkdWFsbHkpOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBwYXR0ZXJuczogW1xuXHQgKiBcdFsgJ2NsYXNzJywgJ2ZvbycgXVxuXHQgKiBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHBhdHRlcm5zIEFuIGFycmF5IG9mIG5vcm1hbGl6ZWQgcGF0dGVybnMgKHR1cGxlcyBvZiAyIG9yIDMgaXRlbXMgZGVwZW5kaW5nIG9uIGlmIHRva2VuaXplZCBhdHRyaWJ1dGUgdmFsdWUgbWF0Y2ggaXMgbmVlZGVkKS5cblx0ICogQHBhcmFtIG1hdGNoIEFuIGFycmF5IHRvIHBvcHVsYXRlIHdpdGggbWF0Y2hpbmcgdHVwbGVzLlxuXHQgKiBAcGFyYW0gZXhjbHVkZSBBcnJheSBvZiBhdHRyaWJ1dGUgbmFtZXMgdG8gZXhjbHVkZSBmcm9tIG1hdGNoLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgZWxlbWVudCBtYXRjaGVzIGFsbCBwYXR0ZXJucy4gVGhlIG1hdGNoaW5nIHR1cGxlcyBhcmUgcHVzaGVkIHRvIHRoZSBgbWF0Y2hgIGFycmF5LlxuXHQgKi8gX2NvbGxlY3RBdHRyaWJ1dGVzTWF0Y2gocGF0dGVybnMsIG1hdGNoLCBleGNsdWRlKSB7XG4gICAgICAgIGZvciAoY29uc3QgW2tleVBhdHRlcm4sIHRva2VuUGF0dGVybiwgdmFsdWVQYXR0ZXJuXSBvZiBwYXR0ZXJucyl7XG4gICAgICAgICAgICBsZXQgaGFzS2V5ID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgaGFzVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX2F0dHJzKXtcbiAgICAgICAgICAgICAgICBpZiAoZXhjbHVkZSAmJiBleGNsdWRlLmluY2x1ZGVzKGtleSkgfHwgIWlzUGF0dGVybk1hdGNoZWQoa2V5UGF0dGVybiwga2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaGFzS2V5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1BhdHRlcm5NYXRjaGVkKHRva2VuUGF0dGVybiwgdmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaC5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzVmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCEoa2V5UGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuTWF0Y2ggPSB2YWx1ZS5fZ2V0VG9rZW5zTWF0Y2godG9rZW5QYXR0ZXJuLCB2YWx1ZVBhdHRlcm4gfHwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbk1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNWYWx1ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRva2VuTWF0Y2hJdGVtIG9mIHRva2VuTWF0Y2gpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuTWF0Y2hJdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIShrZXlQYXR0ZXJuIGluc3RhbmNlb2YgUmVnRXhwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFoYXNLZXkgfHwgIWhhc1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi92aWV3Y29uc3VtYWJsZX5WaWV3Q29uc3VtYWJsZX0gdG8gY29sbGVjdCB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fk5vcm1hbGl6ZWRDb25zdW1hYmxlc30gZm9yIHRoZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBXaGVuIGBrZXlgIGFuZCBgdG9rZW5gIHBhcmFtZXRlcnMgYXJlIHByb3ZpZGVkIHRoZSBvdXRwdXQgaXMgZmlsdGVyZWQgZm9yIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlIGFuZCBpdCdzIHRva2VucyBhbmQgcmVsYXRlZCB0b2tlbnMuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBuYW1lLlxuXHQgKiBAcGFyYW0gdG9rZW4gUmVmZXJlbmNlIHRva2VuIHRvIGNvbGxlY3QgYWxsIHJlbGF0ZWQgdG9rZW5zLlxuXHQgKi8gX2dldENvbnN1bWFibGVzKGtleSwgdG9rZW4pIHtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IFtdO1xuICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX2F0dHJzLmdldChrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaChbXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wIG9mIHZhbHVlLl9nZXRDb25zdW1hYmxlcyh0b2tlbikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcFxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0aGlzLl9hdHRycyl7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5XG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcCBvZiB2YWx1ZS5fZ2V0Q29uc3VtYWJsZXMoKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogIWtleSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFZlcmlmeSBpZiB0aGUgZ2l2ZW4gZWxlbWVudCBjYW4gYmUgbWVyZ2VkIHdpdGhvdXQgY29uZmxpY3RzIGludG8gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGlzIG1ldGhvZCBpcyBleHRlbmRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IGltcGxlbWVudGF0aW9uLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSB3aGlsZSBkb3duLWNhc3Rpbmdcblx0ICogYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IHRvIG1lcmdlIGl0IHdpdGggb3RoZXIgQXR0cmlidXRlRWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIGlmIGVsZW1lbnRzIGNhbiBiZSBtZXJnZWQuXG5cdCAqLyBfY2FuTWVyZ2VBdHRyaWJ1dGVzRnJvbShvdGhlckVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMubmFtZSAhPSBvdGhlckVsZW1lbnQubmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgb3RoZXJWYWx1ZV0gb2Ygb3RoZXJFbGVtZW50Ll9hdHRycyl7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX2F0dHJzLmdldChrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgdHlwZW9mIG90aGVyVmFsdWUgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG90aGVyVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXZhbHVlLl9jYW5NZXJnZUZyb20ob3RoZXJWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNZXJnZXMgYXR0cmlidXRlcyBvZiBhIGdpdmVuIGVsZW1lbnQgaW50byB0aGUgZWxlbWVudC5cblx0ICogVGhpcyBpbmNsdWRlcyBhbHNvIHRva2VuaXplZCBhdHRyaWJ1dGVzIGxpa2Ugc3R5bGUgYW5kIGNsYXNzLlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgeW91IHNob3VsZCBtYWtlIHN1cmUgdGhlcmUgYXJlIG5vIGNvbmZsaWN0cyBiZWZvcmUgbWVyZ2luZyAoc2VlIHtAbGluayAjX2Nhbk1lcmdlQXR0cmlidXRlc0Zyb219KS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0gd2hpbGUgZG93bi1jYXN0aW5nXG5cdCAqIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSB0byBtZXJnZSBpdCB3aXRoIG90aGVyIEF0dHJpYnV0ZUVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX21lcmdlQXR0cmlidXRlc0Zyb20ob3RoZXJFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2ZpcmVDaGFuZ2UoJ2F0dHJpYnV0ZXMnLCB0aGlzKTtcbiAgICAgICAgLy8gTW92ZSBhbGwgYXR0cmlidXRlcy9jbGFzc2VzL3N0eWxlcyBmcm9tIHdyYXBwZXIgdG8gd3JhcHBlZCBBdHRyaWJ1dGVFbGVtZW50LlxuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIG90aGVyVmFsdWVdIG9mIG90aGVyRWxlbWVudC5fYXR0cnMpe1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9hdHRycy5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCB0eXBlb2Ygb3RoZXJWYWx1ZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldEF0dHJpYnV0ZShrZXksIG90aGVyVmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZS5fbWVyZ2VGcm9tKG90aGVyVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBWZXJpZnkgaWYgdGhlIGdpdmVuIGVsZW1lbnQgYXR0cmlidXRlcyBjYW4gYmUgZnVsbHkgc3VidHJhY3RlZCBmcm9tIHRoZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgaXMgZXh0ZW5kZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSBpbXBsZW1lbnRhdGlvbi5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0gd2hpbGUgZG93bi1jYXN0aW5nXG5cdCAqIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSB0byB1bndyYXAgdGhlIEF0dHJpYnV0ZUVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmV0dXJucyBSZXR1cm5zIGB0cnVlYCBpZiBlbGVtZW50cyBhdHRyaWJ1dGVzIGNhbiBiZSBmdWxseSBzdWJ0cmFjdGVkLlxuXHQgKi8gX2NhblN1YnRyYWN0QXR0cmlidXRlc09mKG90aGVyRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5uYW1lICE9IG90aGVyRWxlbWVudC5uYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBba2V5LCBvdGhlclZhbHVlXSBvZiBvdGhlckVsZW1lbnQuX2F0dHJzKXtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fYXR0cnMuZ2V0KGtleSk7XG4gICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgdHlwZW9mIG90aGVyVmFsdWUgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09IG90aGVyVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXZhbHVlLl9pc01hdGNoaW5nKG90aGVyVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyAoc3VidHJhY3RzKSBjb3JyZXNwb25kaW5nIGF0dHJpYnV0ZXMgb2YgdGhlIGdpdmVuIGVsZW1lbnQgZnJvbSB0aGUgZWxlbWVudC5cblx0ICogVGhpcyBpbmNsdWRlcyBhbHNvIHRva2VuaXplZCBhdHRyaWJ1dGVzIGxpa2Ugc3R5bGUgYW5kIGNsYXNzLlxuXHQgKiBBbGwgYXR0cmlidXRlcywgY2xhc3NlcyBhbmQgc3R5bGVzIGZyb20gZ2l2ZW4gZWxlbWVudCBzaG91bGQgYmUgcHJlc2VudCBpbnNpZGUgdGhlIGVsZW1lbnQgYmVpbmcgdW53cmFwcGVkLlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgeW91IHNob3VsZCBtYWtlIHN1cmUgYWxsIGF0dHJpYnV0ZXMgY291bGQgYmUgc3VidHJhY3RlZCBiZWZvcmUgc3VidHJhY3RpbmcgdGhlbSAoc2VlIHtAbGluayAjX2NhblN1YnRyYWN0QXR0cmlidXRlc09mfSkuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9IHdoaWxlIGRvd24tY2FzdGluZ1xuXHQgKiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0gdG8gdW53cmFwIHRoZSBBdHRyaWJ1dGVFbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9zdWJ0cmFjdEF0dHJpYnV0ZXNPZihvdGhlckVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fZmlyZUNoYW5nZSgnYXR0cmlidXRlcycsIHRoaXMpO1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIG90aGVyVmFsdWVdIG9mIG90aGVyRWxlbWVudC5fYXR0cnMpe1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9hdHRycy5nZXQoa2V5KTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycgfHwgdHlwZW9mIG90aGVyVmFsdWUgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdHRycy5kZWxldGUoa2V5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUucmVtb3ZlKG90aGVyVmFsdWUua2V5cygpKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRycy5kZWxldGUoa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldHMgYSBjdXN0b20gcHJvcGVydHkuIFVubGlrZSBhdHRyaWJ1dGVzLCBjdXN0b20gcHJvcGVydGllcyBhcmUgbm90IHJlbmRlcmVkIHRvIHRoZSBET00sXG5cdCAqIHNvIHRoZXkgY2FuIGJlIHVzZWQgdG8gYWRkIHNwZWNpYWwgZGF0YSB0byBlbGVtZW50cy5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjc2V0Q3VzdG9tUHJvcGVydHlcblx0ICogQGludGVybmFsXG5cdCAqLyBfc2V0Q3VzdG9tUHJvcGVydHkoa2V5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzLnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgdGhlIGN1c3RvbSBwcm9wZXJ0eSBzdG9yZWQgdW5kZXIgdGhlIGdpdmVuIGtleS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjcmVtb3ZlQ3VzdG9tUHJvcGVydHlcblx0ICogQGludGVybmFsXG5cdCAqIEByZXR1cm5zIFJldHVybnMgdHJ1ZSBpZiBwcm9wZXJ0eSB3YXMgcmVtb3ZlZC5cblx0ICovIF9yZW1vdmVDdXN0b21Qcm9wZXJ0eShrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1c3RvbVByb3BlcnRpZXMuZGVsZXRlKGtleSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQYXJzZXMgYXR0cmlidXRlcyBwcm92aWRlZCB0byB0aGUgZWxlbWVudCBjb25zdHJ1Y3RvciBiZWZvcmUgdGhleSBhcmUgYXBwbGllZCB0byBhbiBlbGVtZW50LiBJZiBhdHRyaWJ1dGVzIGFyZSBwYXNzZWRcblx0ICogYXMgYW4gb2JqZWN0IChpbnN0ZWFkIG9mIGBJdGVyYWJsZWApLCB0aGUgb2JqZWN0IGlzIHRyYW5zZm9ybWVkIHRvIHRoZSBtYXAuIEF0dHJpYnV0ZXMgd2l0aCBgbnVsbGAgdmFsdWUgYXJlIHJlbW92ZWQuXG5cdCAqIEF0dHJpYnV0ZXMgd2l0aCBub24tYFN0cmluZ2AgdmFsdWUgYXJlIGNvbnZlcnRlZCB0byBgU3RyaW5nYC5cblx0ICpcblx0ICogQHBhcmFtIGF0dHJzIEF0dHJpYnV0ZXMgdG8gcGFyc2UuXG5cdCAqIEByZXR1cm5zIFBhcnNlZCBhdHRyaWJ1dGVzLlxuXHQgKi8gX3BhcnNlQXR0cmlidXRlcyhhdHRycykge1xuICAgICAgICBjb25zdCBhdHRyc01hcCA9IHRvTWFwKGF0dHJzKTtcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYXR0cnNNYXApe1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYXR0cnNNYXAuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXNTdHlsZXNNYXAodGhpcy5uYW1lLCBrZXkpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBlaXRoZXIgYW4gZWxlbWVudCBjbG9uZSBzbyB3ZSBuZWVkIHRvIGNsb25lIHN0eWxlcyBtYXAsIG9yIGEgbmV3IGluc3RhbmNlIHdoaWNoIHJlcXVpcmVzIHZhbHVlIHRvIGJlIHBhcnNlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlIGluc3RhbmNlb2YgU3R5bGVzTWFwID8gdmFsdWUuX2Nsb25lKCkgOiBuZXcgU3R5bGVzTWFwKHRoaXMuZG9jdW1lbnQuc3R5bGVzUHJvY2Vzc29yKS5zZXRUbyhTdHJpbmcodmFsdWUpKTtcbiAgICAgICAgICAgICAgICBhdHRyc01hcC5zZXQoa2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXNUb2tlbkxpc3QodGhpcy5uYW1lLCBrZXkpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBlaXRoZXIgYW4gZWxlbWVudCBjbG9uZSBzbyB3ZSBuZWVkIHRvIGNsb25lIHRva2VuIGxpc3QsIG9yIGEgbmV3IGluc3RhbmNlIHdoaWNoIHJlcXVpcmVzIHZhbHVlIHRvIGJlIHBhcnNlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHZhbHVlIGluc3RhbmNlb2YgVG9rZW5MaXN0ID8gdmFsdWUuX2Nsb25lKCkgOiBuZXcgVG9rZW5MaXN0KCkuc2V0VG8oU3RyaW5nKHZhbHVlKSk7XG4gICAgICAgICAgICAgICAgYXR0cnNNYXAuc2V0KGtleSwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBhdHRyc01hcC5zZXQoa2V5LCBTdHJpbmcodmFsdWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXR0cnNNYXA7XG4gICAgfVxufTtcbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cbkVsZW1lbnQkMS5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlLCBuYW1lKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHJldHVybiB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAndmlldzpub2RlJztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbmFtZSA9PT0gdGhpcy5uYW1lICYmICh0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcpO1xuICAgIH1cbn07XG4vKipcbiAqIENvbnZlcnRzIHN0cmluZ3MgdG8gVGV4dCBhbmQgbm9uLWl0ZXJhYmxlcyB0byBhcnJheXMuXG4gKi8gZnVuY3Rpb24gbm9ybWFsaXplJDMoZG9jdW1lbnQsIG5vZGVzKSB7XG4gICAgLy8gU2VwYXJhdGUgY29uZGl0aW9uIGJlY2F1c2Ugc3RyaW5nIGlzIGl0ZXJhYmxlLlxuICAgIGlmICh0eXBlb2Ygbm9kZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBUZXh0JDEoZG9jdW1lbnQsIG5vZGVzKVxuICAgICAgICBdO1xuICAgIH1cbiAgICBpZiAoIWlzSXRlcmFibGUobm9kZXMpKSB7XG4gICAgICAgIG5vZGVzID0gW1xuICAgICAgICAgICAgbm9kZXNcbiAgICAgICAgXTtcbiAgICB9XG4gICAgY29uc3Qgbm9ybWFsaXplZE5vZGVzID0gW107XG4gICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKXtcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBub3JtYWxpemVkTm9kZXMucHVzaChuZXcgVGV4dCQxKGRvY3VtZW50LCBub2RlKSk7XG4gICAgICAgIH0gZWxzZSBpZiAobm9kZSBpbnN0YW5jZW9mIFRleHRQcm94eSQxKSB7XG4gICAgICAgICAgICBub3JtYWxpemVkTm9kZXMucHVzaChuZXcgVGV4dCQxKGRvY3VtZW50LCBub2RlLmRhdGEpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZWROb2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVkTm9kZXM7XG59XG4vKipcbiAqIFJldHVybnMgYHRydWVgIGlmIGFuIGF0dHJpYnV0ZSBvbiBhIGdpdmVuIGVsZW1lbnQgc2hvdWxkIGJlIGhhbmRsZWQgYXMgYSBUb2tlbkxpc3QuXG4gKi8gZnVuY3Rpb24gdXNlc1Rva2VuTGlzdChlbGVtZW50TmFtZSwga2V5KSB7XG4gICAgcmV0dXJuIGtleSA9PSAnY2xhc3MnIHx8IGVsZW1lbnROYW1lID09ICdhJyAmJiBrZXkgPT0gJ3JlbCc7XG59XG4vKipcbiAqIFJldHVybnMgYHRydWVgIGlmIGFuIGF0dHJpYnV0ZSBvbiBhIGdpdmVuIGVsZW1lbnQgc2hvdWxkIGJlIGhhbmRsZWQgYXMgYSBTdHlsZXNNYXAuXG4gKi8gZnVuY3Rpb24gdXNlc1N0eWxlc01hcChlbGVtZW50TmFtZSwga2V5KSB7XG4gICAgcmV0dXJuIGtleSA9PSAnc3R5bGUnO1xufVxuXG4vKipcbiAqIENvbnRhaW5lcnMgYXJlIGVsZW1lbnRzIHdoaWNoIGRlZmluZSBkb2N1bWVudCBzdHJ1Y3R1cmUuIFRoZXkgZGVmaW5lIGJvdW5kYXJpZXMgZm9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGVzfS4gVGhleSBhcmUgbW9zdGx5IHVzZWQgZm9yIGJsb2NrIGVsZW1lbnRzIGxpa2UgYDxwPmAgb3IgYDxkaXY+YC5cbiAqXG4gKiBFZGl0aW5nIGVuZ2luZSBkb2VzIG5vdCBkZWZpbmUgYSBmaXhlZCBIVE1MIERURC4gVGhpcyBpcyB3aHkgYSBmZWF0dXJlIGRldmVsb3BlciBuZWVkcyB0byBjaG9vc2UgYmV0d2VlbiB2YXJpb3VzXG4gKiB0eXBlcyAoY29udGFpbmVyIGVsZW1lbnQsIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50fSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZW1wdHllbGVtZW50fkVtcHR5RWxlbWVudCBlbXB0eSBlbGVtZW50fSwgZXRjKSB3aGVuIGRldmVsb3BpbmcgYSBmZWF0dXJlLlxuICpcbiAqIFRoZSBjb250YWluZXIgZWxlbWVudCBzaG91bGQgYmUgeW91ciBkZWZhdWx0IGNob2ljZSB3aGVuIHdyaXRpbmcgYSBjb252ZXJ0ZXIsIHVubGVzczpcbiAqXG4gKiAqIHRoaXMgZWxlbWVudCByZXByZXNlbnRzIGEgbW9kZWwgdGV4dCBhdHRyaWJ1dGUgKHRoZW4gdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSksXG4gKiAqIHRoaXMgaXMgYW4gZW1wdHkgZWxlbWVudCBsaWtlIGA8aW1nPmAgKHRoZW4gdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZW1wdHllbGVtZW50fkVtcHR5RWxlbWVudH0pLFxuICogKiB0aGlzIGlzIGEgcm9vdCBlbGVtZW50LFxuICogKiB0aGlzIGlzIGEgbmVzdGVkIGVkaXRhYmxlIGVsZW1lbnQgKHRoZW4gdXNlICB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnR9KS5cbiAqXG4gKiBUbyBjcmVhdGUgYSBuZXcgY29udGFpbmVyIGVsZW1lbnQgaW5zdGFuY2UgdXNlIHRoZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVDb250YWluZXJFbGVtZW50IGBEb3duY2FzdFdyaXRlciNjcmVhdGVDb250YWluZXJFbGVtZW50KClgfVxuICogbWV0aG9kLlxuICovIGNsYXNzIENvbnRhaW5lckVsZW1lbnQgZXh0ZW5kcyBFbGVtZW50JDEge1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgY29udGFpbmVyIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZUNvbnRhaW5lckVsZW1lbnRcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50XG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIGRvY3VtZW50IGluc3RhbmNlIHRvIHdoaWNoIHRoaXMgZWxlbWVudCBiZWxvbmdzLlxuXHQgKiBAcGFyYW0gbmFtZSBOb2RlIG5hbWUuXG5cdCAqIEBwYXJhbSBhdHRycyBDb2xsZWN0aW9uIG9mIGF0dHJpYnV0ZXMuXG5cdCAqIEBwYXJhbSBjaGlsZHJlbiBBIGxpc3Qgb2Ygbm9kZXMgdG8gYmUgaW5zZXJ0ZWQgaW50byBjcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCwgbmFtZSwgYXR0cnMsIGNoaWxkcmVuKXtcbiAgICAgICAgc3VwZXIoZG9jdW1lbnQsIG5hbWUsIGF0dHJzLCBjaGlsZHJlbik7XG4gICAgICAgIHRoaXMuZ2V0RmlsbGVyT2Zmc2V0ID0gZ2V0RmlsbGVyT2Zmc2V0JDQ7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuQ29udGFpbmVyRWxlbWVudC5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlLCBuYW1lKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHJldHVybiB0eXBlID09PSAnY29udGFpbmVyRWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6Y29udGFpbmVyRWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdlbGVtZW50JyB8fCB0eXBlID09PSAndmlldzplbGVtZW50JyB8fCB0eXBlID09PSAnbm9kZScgfHwgdHlwZSA9PT0gJ3ZpZXc6bm9kZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5hbWUgPT09IHRoaXMubmFtZSAmJiAodHlwZSA9PT0gJ2NvbnRhaW5lckVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmNvbnRhaW5lckVsZW1lbnQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgICAgICB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcpO1xuICAgIH1cbn07XG4vKipcbiAqIFJldHVybnMgYmxvY2sge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXIgZmlsbGVyfSBvZmZzZXQgb3IgYG51bGxgIGlmIGJsb2NrIGZpbGxlciBpcyBub3QgbmVlZGVkLlxuICpcbiAqIEByZXR1cm5zIEJsb2NrIGZpbGxlciBvZmZzZXQgb3IgYG51bGxgIGlmIGJsb2NrIGZpbGxlciBpcyBub3QgbmVlZGVkLlxuICovIGZ1bmN0aW9uIGdldEZpbGxlck9mZnNldCQ0KCkge1xuICAgIGNvbnN0IGNoaWxkcmVuID0gW1xuICAgICAgICAuLi50aGlzLmdldENoaWxkcmVuKClcbiAgICBdO1xuICAgIGNvbnN0IGxhc3RDaGlsZCA9IGNoaWxkcmVuW3RoaXMuY2hpbGRDb3VudCAtIDFdO1xuICAgIC8vIEJsb2NrIGZpbGxlciBpcyByZXF1aXJlZCBhZnRlciBhIGA8YnI+YCBpZiBpdCdzIHRoZSBsYXN0IGVsZW1lbnQgaW4gaXRzIGNvbnRhaW5lci4gU2VlICMxNDIyLlxuICAgIGlmIChsYXN0Q2hpbGQgJiYgbGFzdENoaWxkLmlzKCdlbGVtZW50JywgJ2JyJykpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRDb3VudDtcbiAgICB9XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbil7XG4gICAgICAgIC8vIElmIHRoZXJlJ3MgYW55IG5vbi1VSSBlbGVtZW50IOKAkyBkb24ndCByZW5kZXIgdGhlIGJvZ3VzLlxuICAgICAgICBpZiAoIWNoaWxkLmlzKCd1aUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gSWYgdGhlcmUgYXJlIG9ubHkgVUkgZWxlbWVudHMg4oCTIHJlbmRlciB0aGUgYm9ndXMgYXQgdGhlIGVuZCBvZiB0aGUgZWxlbWVudC5cbiAgICByZXR1cm4gdGhpcy5jaGlsZENvdW50O1xufVxuXG4vKipcbiAqIEVkaXRhYmxlIGVsZW1lbnQgd2hpY2ggY2FuIGJlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yb290ZWRpdGFibGVlbGVtZW50flJvb3RFZGl0YWJsZUVsZW1lbnQgcm9vdH1cbiAqIG9yIG5lc3RlZCBlZGl0YWJsZSBhcmVhIGluIHRoZSBlZGl0b3IuXG4gKlxuICogRWRpdGFibGUgaXMgYXV0b21hdGljYWxseSByZWFkLW9ubHkgd2hlbiBpdHMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBEb2N1bWVudH0gaXMgcmVhZC1vbmx5LlxuICpcbiAqIFRoZSBjb25zdHJ1Y3RvciBvZiB0aGlzIGNsYXNzIHNob3VsZG4ndCBiZSB1c2VkIGRpcmVjdGx5LiBUbyBjcmVhdGUgbmV3IGBFZGl0YWJsZUVsZW1lbnRgIHVzZSB0aGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlRWRpdGFibGVFbGVtZW50IGBkb3duY2FzdFdyaXRlciNjcmVhdGVFZGl0YWJsZUVsZW1lbnQoKWB9IG1ldGhvZC5cbiAqLyBjbGFzcyBFZGl0YWJsZUVsZW1lbnQgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gT2JzZXJ2YWJsZU1peGluKENvbnRhaW5lckVsZW1lbnQpIHtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBlZGl0YWJsZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVFZGl0YWJsZUVsZW1lbnRcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgaW5zdGFuY2UgdG8gd2hpY2ggdGhpcyBlbGVtZW50IGJlbG9uZ3MuXG5cdCAqIEBwYXJhbSBuYW1lIE5vZGUgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIENvbGxlY3Rpb24gb2YgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbil7XG4gICAgICAgIHN1cGVyKGRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbik7XG4gICAgICAgIHRoaXMuc2V0KCdpc1JlYWRPbmx5JywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgnaXNGb2N1c2VkJywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgncGxhY2Vob2xkZXInLCB1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLmJpbmQoJ2lzUmVhZE9ubHknKS50byhkb2N1bWVudCk7XG4gICAgICAgIHRoaXMuYmluZCgnaXNGb2N1c2VkJykudG8oZG9jdW1lbnQsICdpc0ZvY3VzZWQnLCAoaXNGb2N1c2VkKT0+aXNGb2N1c2VkICYmIGRvY3VtZW50LnNlbGVjdGlvbi5lZGl0YWJsZUVsZW1lbnQgPT0gdGhpcyk7XG4gICAgICAgIC8vIFVwZGF0ZSBmb2N1cyBzdGF0ZSBiYXNlZCBvbiBzZWxlY3Rpb24gY2hhbmdlcy5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhkb2N1bWVudC5zZWxlY3Rpb24sICdjaGFuZ2UnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBkb2N1bWVudC5pc0ZvY3VzZWQgJiYgZG9jdW1lbnQuc2VsZWN0aW9uLmVkaXRhYmxlRWxlbWVudCA9PSB0aGlzO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuRWRpdGFibGVFbGVtZW50LnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUgPT09ICdlZGl0YWJsZUVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVkaXRhYmxlRWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdjb250YWluZXJFbGVtZW50JyB8fCB0eXBlID09PSAndmlldzpjb250YWluZXJFbGVtZW50JyB8fCB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcgfHwgdHlwZSA9PT0gJ25vZGUnIHx8IHR5cGUgPT09ICd2aWV3Om5vZGUnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICdlZGl0YWJsZUVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVkaXRhYmxlRWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdjb250YWluZXJFbGVtZW50JyB8fCB0eXBlID09PSAndmlldzpjb250YWluZXJFbGVtZW50JyB8fCB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcpO1xuICAgIH1cbn07XG5cbmNvbnN0IHJvb3ROYW1lU3ltYm9sID0gU3ltYm9sKCdyb290TmFtZScpO1xuLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgYSBzaW5nbGUgcm9vdCBpbiB0aGUgZGF0YSB2aWV3LiBBIHJvb3QgY2FuIGJlIGVpdGhlciB7QGxpbmsgflJvb3RFZGl0YWJsZUVsZW1lbnQjaXNSZWFkT25seSBlZGl0YWJsZSBvciByZWFkLW9ubHl9LFxuICogYnV0IGluIGJvdGggY2FzZXMgaXQgaXMgY2FsbGVkIFwiYW4gZWRpdGFibGVcIi4gUm9vdHMgY2FuIGNvbnRhaW4gb3RoZXIge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lZGl0YWJsZWVsZW1lbnR+RWRpdGFibGVFbGVtZW50XG4gKiBlZGl0YWJsZSBlbGVtZW50c30gbWFraW5nIHRoZW0gXCJuZXN0ZWQgZWRpdGFibGVzXCIuXG4gKi8gY2xhc3MgUm9vdEVkaXRhYmxlRWxlbWVudCBleHRlbmRzIEVkaXRhYmxlRWxlbWVudCB7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgcm9vdCBlZGl0YWJsZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIGRvY3VtZW50IGluc3RhbmNlIHRvIHdoaWNoIHRoaXMgZWxlbWVudCBiZWxvbmdzLlxuXHQgKiBAcGFyYW0gbmFtZSBOb2RlIG5hbWUuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCwgbmFtZSl7XG4gICAgICAgIHN1cGVyKGRvY3VtZW50LCBuYW1lKTtcbiAgICAgICAgdGhpcy5yb290TmFtZSA9ICdtYWluJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIE5hbWUgb2YgdGhpcyByb290IGluc2lkZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50fSB0aGF0IGlzIGFuIG93bmVyIG9mIHRoaXMgcm9vdC4gSWYgbm9cblx0ICogb3RoZXIgbmFtZSBpcyBzZXQsIGBtYWluYCBuYW1lIGlzIHVzZWQuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gZ2V0IHJvb3ROYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDdXN0b21Qcm9wZXJ0eShyb290TmFtZVN5bWJvbCk7XG4gICAgfVxuICAgIHNldCByb290TmFtZShyb290TmFtZSkge1xuICAgICAgICB0aGlzLl9zZXRDdXN0b21Qcm9wZXJ0eShyb290TmFtZVN5bWJvbCwgcm9vdE5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogT3ZlcnJpZGVzIG9sZCBlbGVtZW50IG5hbWUgYW5kIHNldHMgbmV3IG9uZS5cblx0ICogVGhpcyBpcyBuZWVkZWQgYmVjYXVzZSB2aWV3IHJvb3RzIGFyZSBjcmVhdGVkIGJlZm9yZSB0aGV5IGFyZSBhdHRhY2hlZCB0byB0aGUgRE9NLlxuXHQgKiBUaGUgbmFtZSBvZiB0aGUgcm9vdCBlbGVtZW50IGlzIHRlbXBvcmFyeSBhdCB0aGlzIHN0YWdlLiBJdCBoYXMgdG8gYmUgY2hhbmdlZCB3aGVuIHRoZVxuXHQgKiB2aWV3IHJvb3QgZWxlbWVudCBpcyBhdHRhY2hlZCB0byB0aGUgRE9NIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gbmFtZSBUaGUgbmV3IG5hbWUgb2YgZWxlbWVudC5cblx0ICovIHNldCBfbmFtZShuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuUm9vdEVkaXRhYmxlRWxlbWVudC5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlLCBuYW1lKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHJldHVybiB0eXBlID09PSAncm9vdEVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OnJvb3RFbGVtZW50JyB8fCAvLyBGcm9tIHN1cGVyLmlzKCkuIFRoaXMgaXMgaGlnaGx5IHV0aWxpc2VkIG1ldGhvZCBhbmQgY2Fubm90IGNhbGwgc3VwZXIuIFNlZSBja2VkaXRvci9ja2VkaXRvcjUjNjUyOS5cbiAgICAgICAgdHlwZSA9PT0gJ2VkaXRhYmxlRWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWRpdGFibGVFbGVtZW50JyB8fCB0eXBlID09PSAnY29udGFpbmVyRWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6Y29udGFpbmVyRWxlbWVudCcgfHwgdHlwZSA9PT0gJ2VsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVsZW1lbnQnIHx8IHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAndmlldzpub2RlJztcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbmFtZSA9PT0gdGhpcy5uYW1lICYmICh0eXBlID09PSAncm9vdEVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OnJvb3RFbGVtZW50JyB8fCAvLyBGcm9tIHN1cGVyLmlzKCkuIFRoaXMgaXMgaGlnaGx5IHV0aWxpc2VkIG1ldGhvZCBhbmQgY2Fubm90IGNhbGwgc3VwZXIuIFNlZSBja2VkaXRvci9ja2VkaXRvcjUjNjUyOS5cbiAgICAgICAgdHlwZSA9PT0gJ2VkaXRhYmxlRWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWRpdGFibGVFbGVtZW50JyB8fCB0eXBlID09PSAnY29udGFpbmVyRWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6Y29udGFpbmVyRWxlbWVudCcgfHwgdHlwZSA9PT0gJ2VsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVsZW1lbnQnKTtcbiAgICB9XG59O1xuXG4vKipcbiAqIFBvc2l0aW9uIGl0ZXJhdG9yIGNsYXNzLiBJdCBhbGxvd3MgdG8gaXRlcmF0ZSBmb3J3YXJkIGFuZCBiYWNrd2FyZCBvdmVyIHRoZSBkb2N1bWVudC5cbiAqLyBsZXQgVHJlZVdhbGtlciQxID0gY2xhc3MgVHJlZVdhbGtlciB7XG4gICAgLyoqXG5cdCAqIFdhbGtpbmcgZGlyZWN0aW9uLiBEZWZhdWx0cyBgJ2ZvcndhcmQnYC5cblx0ICovIGRpcmVjdGlvbjtcbiAgICAvKipcblx0ICogSXRlcmF0b3IgYm91bmRhcmllcy5cblx0ICpcblx0ICogV2hlbiB0aGUgaXRlcmF0b3IgaXMgd2Fsa2luZyBgJ2ZvcndhcmQnYCBvbiB0aGUgZW5kIG9mIGJvdW5kYXJ5IG9yIGlzIHdhbGtpbmcgYCdiYWNrd2FyZCdgXG5cdCAqIG9uIHRoZSBzdGFydCBvZiBib3VuZGFyeSwgdGhlbiBgeyBkb25lOiB0cnVlIH1gIGlzIHJldHVybmVkLlxuXHQgKlxuXHQgKiBJZiBib3VuZGFyaWVzIGFyZSBub3QgZGVmaW5lZCB0aGV5IGFyZSBzZXQgYmVmb3JlIGZpcnN0IGFuZCBhZnRlciBsYXN0IGNoaWxkIG9mIHRoZSByb290IG5vZGUuXG5cdCAqLyBib3VuZGFyaWVzO1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBhbGwgY2hhcmFjdGVycyBmcm9tIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0fSBzaG91bGQgYmUgcmV0dXJuZWQgYXMgb25lXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0fSBvciBvbmUgYnkgb25lIGFzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dHByb3h5flRleHRQcm94eX0uXG5cdCAqLyBzaW5nbGVDaGFyYWN0ZXJzO1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBpdGVyYXRvciBzaG91bGQgZW50ZXIgZWxlbWVudHMgb3Igbm90LiBJZiB0aGUgaXRlcmF0b3IgaXMgc2hhbGxvdyBjaGlsZCBub2RlcyBvZiBhbnlcblx0ICogaXRlcmF0ZWQgbm9kZSB3aWxsIG5vdCBiZSByZXR1cm5lZCBhbG9uZyB3aXRoIGBlbGVtZW50RW5kYCB0YWcuXG5cdCAqLyBzaGFsbG93O1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBpdGVyYXRvciBzaG91bGQgaWdub3JlIGBlbGVtZW50RW5kYCB0YWdzLiBJZiBzZXQgdG8gYHRydWVgLCB3YWxrZXIgd2lsbCBub3Rcblx0ICogcmV0dXJuIGEgcGFyZW50IG5vZGUgb2YgdGhlIHN0YXJ0IHBvc2l0aW9uLiBFYWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSB3aWxsIGJlIHJldHVybmVkIG9uY2UuXG5cdCAqIFdoZW4gc2V0IHRvIGBmYWxzZWAgZWFjaCBlbGVtZW50IG1pZ2h0IGJlIHJldHVybmVkIHR3aWNlOiBmb3IgYCdlbGVtZW50U3RhcnQnYCBhbmQgYCdlbGVtZW50RW5kJ2AuXG5cdCAqLyBpZ25vcmVFbGVtZW50RW5kO1xuICAgIC8qKlxuXHQgKiBJdGVyYXRvciBwb3NpdGlvbi4gSWYgc3RhcnQgcG9zaXRpb24gaXMgbm90IGRlZmluZWQgdGhlbiBwb3NpdGlvbiBkZXBlbmRzIG9uIHtAbGluayAjZGlyZWN0aW9ufS4gSWYgZGlyZWN0aW9uIGlzXG5cdCAqIGAnZm9yd2FyZCdgIHBvc2l0aW9uIHN0YXJ0cyBmb3JtIHRoZSBiZWdpbm5pbmcsIHdoZW4gZGlyZWN0aW9uIGlzIGAnYmFja3dhcmQnYCBwb3NpdGlvbiBzdGFydHMgZnJvbSB0aGUgZW5kLlxuXHQgKi8gX3Bvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBTdGFydCBib3VuZGFyeSBwYXJlbnQuXG5cdCAqLyBfYm91bmRhcnlTdGFydFBhcmVudDtcbiAgICAvKipcblx0ICogRW5kIGJvdW5kYXJ5IHBhcmVudC5cblx0ICovIF9ib3VuZGFyeUVuZFBhcmVudDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIGl0ZXJhdG9yLiBBbGwgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwsIGJ1dCB5b3UgaGF2ZSB0byBzcGVjaWZ5IGVpdGhlciBgYm91bmRhcmllc2Agb3IgYHN0YXJ0UG9zaXRpb25gLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBjb25maWd1cmF0aW9uLlxuXHQgKi8gY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KXtcbiAgICAgICAgaWYgKCFvcHRpb25zLmJvdW5kYXJpZXMgJiYgIW9wdGlvbnMuc3RhcnRQb3NpdGlvbikge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBOZWl0aGVyIGJvdW5kYXJpZXMgbm9yIHN0YXJ0aW5nIHBvc2l0aW9uIGhhdmUgYmVlbiBkZWZpbmVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXRyZWUtd2Fsa2VyLW5vLXN0YXJ0LXBvc2l0aW9uXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctdHJlZS13YWxrZXItbm8tc3RhcnQtcG9zaXRpb24nLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5kaXJlY3Rpb24gJiYgb3B0aW9ucy5kaXJlY3Rpb24gIT0gJ2ZvcndhcmQnICYmIG9wdGlvbnMuZGlyZWN0aW9uICE9ICdiYWNrd2FyZCcpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogT25seSBgYmFja3dhcmRgIGFuZCBgZm9yd2FyZGAgZGlyZWN0aW9uIGFsbG93ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctdHJlZS13YWxrZXItdW5rbm93bi1kaXJlY3Rpb25cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy10cmVlLXdhbGtlci11bmtub3duLWRpcmVjdGlvbicsIG9wdGlvbnMuc3RhcnRQb3NpdGlvbiwge1xuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogb3B0aW9ucy5kaXJlY3Rpb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm91bmRhcmllcyA9IG9wdGlvbnMuYm91bmRhcmllcyB8fCBudWxsO1xuICAgICAgICBpZiAob3B0aW9ucy5zdGFydFBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUF0KG9wdGlvbnMuc3RhcnRQb3NpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUF0KG9wdGlvbnMuYm91bmRhcmllc1tvcHRpb25zLmRpcmVjdGlvbiA9PSAnYmFja3dhcmQnID8gJ2VuZCcgOiAnc3RhcnQnXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBvcHRpb25zLmRpcmVjdGlvbiB8fCAnZm9yd2FyZCc7XG4gICAgICAgIHRoaXMuc2luZ2xlQ2hhcmFjdGVycyA9ICEhb3B0aW9ucy5zaW5nbGVDaGFyYWN0ZXJzO1xuICAgICAgICB0aGlzLnNoYWxsb3cgPSAhIW9wdGlvbnMuc2hhbGxvdztcbiAgICAgICAgdGhpcy5pZ25vcmVFbGVtZW50RW5kID0gISFvcHRpb25zLmlnbm9yZUVsZW1lbnRFbmQ7XG4gICAgICAgIHRoaXMuX2JvdW5kYXJ5U3RhcnRQYXJlbnQgPSB0aGlzLmJvdW5kYXJpZXMgPyB0aGlzLmJvdW5kYXJpZXMuc3RhcnQucGFyZW50IDogbnVsbDtcbiAgICAgICAgdGhpcy5fYm91bmRhcnlFbmRQYXJlbnQgPSB0aGlzLmJvdW5kYXJpZXMgPyB0aGlzLmJvdW5kYXJpZXMuZW5kLnBhcmVudCA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqLyBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYXRvciBwb3NpdGlvbi4gSWYgc3RhcnQgcG9zaXRpb24gaXMgbm90IGRlZmluZWQgdGhlbiBwb3NpdGlvbiBkZXBlbmRzIG9uIHtAbGluayAjZGlyZWN0aW9ufS4gSWYgZGlyZWN0aW9uIGlzXG5cdCAqIGAnZm9yd2FyZCdgIHBvc2l0aW9uIHN0YXJ0cyBmb3JtIHRoZSBiZWdpbm5pbmcsIHdoZW4gZGlyZWN0aW9uIGlzIGAnYmFja3dhcmQnYCBwb3NpdGlvbiBzdGFydHMgZnJvbSB0aGUgZW5kLlxuXHQgKi8gZ2V0IHBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyB7QGxpbmsgI3Bvc2l0aW9ufSBpbiB0aGUge0BsaW5rICNkaXJlY3Rpb259IHNraXBwaW5nIHZhbHVlcyBhcyBsb25nIGFzIHRoZSBjYWxsYmFjayBmdW5jdGlvbiByZXR1cm5zIGB0cnVlYC5cblx0ICpcblx0ICogRm9yIGV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdhbGtlci5za2lwKCB2YWx1ZSA9PiB2YWx1ZS50eXBlID09ICd0ZXh0JyApOyAvLyA8cD57fWZvbzwvcD4gLT4gPHA+Zm9vW108L3A+XG5cdCAqIHdhbGtlci5za2lwKCB2YWx1ZSA9PiB0cnVlICk7IC8vIE1vdmUgdGhlIHBvc2l0aW9uIHRvIHRoZSBlbmQ6IDxwPnt9Zm9vPC9wPiAtPiA8cD5mb288L3A+W11cblx0ICogd2Fsa2VyLnNraXAoIHZhbHVlID0+IGZhbHNlICk7IC8vIERvIG5vdCBtb3ZlIHRoZSBwb3NpdGlvbi5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBza2lwIENhbGxiYWNrIGZ1bmN0aW9uLiBHZXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWV9IGFuZCBzaG91bGRcblx0ICogcmV0dXJuIGB0cnVlYCBpZiB0aGUgdmFsdWUgc2hvdWxkIGJlIHNraXBwZWQgb3IgYGZhbHNlYCBpZiBub3QuXG5cdCAqLyBza2lwKHNraXApIHtcbiAgICAgICAgbGV0IG5leHRSZXN1bHQ7XG4gICAgICAgIGxldCBwcmV2UG9zaXRpb247XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHByZXZQb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgICAgICAgICBuZXh0UmVzdWx0ID0gdGhpcy5uZXh0KCk7XG4gICAgICAgIH13aGlsZSAoIW5leHRSZXN1bHQuZG9uZSAmJiBza2lwKG5leHRSZXN1bHQudmFsdWUpKVxuICAgICAgICBpZiAoIW5leHRSZXN1bHQuZG9uZSkge1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwcmV2UG9zaXRpb247XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIHRyZWUgd2Fsa2VyIHtAbGluayAjcG9zaXRpb259IHRvIHByb3ZpZGVkIGBwb3NpdGlvbmAuIFRyZWUgd2Fsa2VyIHdpbGxcblx0ICogY29udGludWUgdHJhdmVyc2luZyBmcm9tIHRoYXQgcG9zaXRpb24uXG5cdCAqXG5cdCAqIE5vdGU6IGluIGNvbnRyYXJ5IHRvIHtAbGluayB+VHJlZVdhbGtlciNza2lwfSwgdGhpcyBtZXRob2QgZG9lcyBub3QgaXRlcmF0ZSBvdmVyIHRoZSBub2RlcyBhbG9uZyB0aGUgd2F5LlxuXHQgKiBJdCBzaW1wbHkgc2V0cyB0aGUgY3VycmVudCB0cmVlIHdhbGtlciBwb3NpdGlvbiB0byBhIG5ldyBvbmUuXG5cdCAqIEZyb20gdGhlIHBlcmZvcm1hbmNlIHN0YW5kcG9pbnQsIGl0IGlzIGJldHRlciB0byB1c2Uge0BsaW5rIH5UcmVlV2Fsa2VyI2p1bXBUb30gcmF0aGVyIHRoYW4ge0BsaW5rIH5UcmVlV2Fsa2VyI3NraXB9LlxuXHQgKlxuXHQgKiBJZiB0aGUgcHJvdmlkZWQgcG9zaXRpb24gaXMgYmVmb3JlIHRoZSBzdGFydCBib3VuZGFyeSwgdGhlIHBvc2l0aW9uIHdpbGwgYmVcblx0ICogc2V0IHRvIHRoZSBzdGFydCBib3VuZGFyeS4gSWYgdGhlIHByb3ZpZGVkIHBvc2l0aW9uIGlzIGFmdGVyIHRoZSBlbmQgYm91bmRhcnksXG5cdCAqIHRoZSBwb3NpdGlvbiB3aWxsIGJlIHNldCB0byB0aGUgZW5kIGJvdW5kYXJ5LlxuXHQgKiBUaGlzIGlzIGRvbmUgdG8gcHJldmVudCB0aGUgdHJlZXdhbGtlciBmcm9tIHRyYXZlcnNpbmcgb3V0c2lkZSB0aGUgYm91bmRhcmllcy5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHRvIGp1bXAgdG8uXG5cdCAqLyBqdW1wVG8ocG9zaXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuX2JvdW5kYXJ5U3RhcnRQYXJlbnQgJiYgcG9zaXRpb24uaXNCZWZvcmUodGhpcy5ib3VuZGFyaWVzLnN0YXJ0KSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmJvdW5kYXJpZXMuc3RhcnQ7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm91bmRhcnlFbmRQYXJlbnQgJiYgcG9zaXRpb24uaXNBZnRlcih0aGlzLmJvdW5kYXJpZXMuZW5kKSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmJvdW5kYXJpZXMuZW5kO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb24uY2xvbmUoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIG5leHQgdHJlZSB3YWxrZXIncyB2YWx1ZS5cblx0ICpcblx0ICogQHJldHVybnMgT2JqZWN0IGltcGxlbWVudGluZyBpdGVyYXRvciBpbnRlcmZhY2UsIHJldHVybmluZ1xuXHQgKiBpbmZvcm1hdGlvbiBhYm91dCB0YWtlbiBzdGVwLlxuXHQgKi8gbmV4dCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09ICdmb3J3YXJkJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25leHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91cygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYWtlcyBhIHN0ZXAgZm9yd2FyZCBpbiB2aWV3LiBNb3ZlcyB0aGUge0BsaW5rICNwb3NpdGlvbn0gdG8gdGhlIG5leHQgcG9zaXRpb24gYW5kIHJldHVybnMgdGhlIGVuY291bnRlcmVkIHZhbHVlLlxuXHQgKi8gX25leHQoKSB7XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IHRoaXMucG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgLy8gV2UgYXJlIGF0IHRoZSBlbmQgb2YgdGhlIHJvb3QuXG4gICAgICAgIGlmIChwYXJlbnQucGFyZW50ID09PSBudWxsICYmIHBvc2l0aW9uLm9mZnNldCA9PT0gcGFyZW50LmNoaWxkQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIHJlYWNoZWQgdGhlIHdhbGtlciBib3VuZGFyeS5cbiAgICAgICAgaWYgKHBhcmVudCA9PT0gdGhpcy5fYm91bmRhcnlFbmRQYXJlbnQgJiYgcG9zaXRpb24ub2Zmc2V0ID09IHRoaXMuYm91bmRhcmllcy5lbmQub2Zmc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBHZXQgbm9kZSBqdXN0IGFmdGVyIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgICAgIGxldCBub2RlO1xuICAgICAgICAvLyBUZXh0IGlzIGEgc3BlY2lmaWMgcGFyZW50IGJlY2F1c2UgaXQgY29udGFpbnMgc3RyaW5nIGluc3RlYWQgb2YgY2hpbGQgbm9kZXMuXG4gICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LmlzKCd2aWV3OiR0ZXh0JykpIHtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5pc0F0RW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gUHJldmVudCByZXR1cm5pbmcgXCJlbGVtZW50RW5kXCIgZm9yIFRleHQgbm9kZS4gU2tpcCB0aGF0IHZhbHVlIGFuZCByZXR1cm4gdGhlIG5leHQgd2Fsa2VyIHN0ZXAuXG4gICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBQb3NpdGlvbiQxLl9jcmVhdGVBZnRlcihwYXJlbnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlID0gcGFyZW50LmRhdGFbcG9zaXRpb24ub2Zmc2V0XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUgPSBwYXJlbnQuZ2V0Q2hpbGQocG9zaXRpb24ub2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG5vZGUgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGxldCB0ZXh0TGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHRoaXMuc2luZ2xlQ2hhcmFjdGVycykge1xuICAgICAgICAgICAgICAgIHRleHRMZW5ndGggPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0ZXh0IHN0aWNrIG91dCBvZiB3YWxrZXIgcmFuZ2UuXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kT2Zmc2V0ID0gcGFyZW50ID09PSB0aGlzLl9ib3VuZGFyeUVuZFBhcmVudCA/IHRoaXMuYm91bmRhcmllcy5lbmQub2Zmc2V0IDogcGFyZW50LmRhdGEubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHRleHRMZW5ndGggPSBlbmRPZmZzZXQgLSBwb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0ZXh0UHJveHkgPSBuZXcgVGV4dFByb3h5JDEocGFyZW50LCBwb3NpdGlvbi5vZmZzZXQsIHRleHRMZW5ndGgpO1xuICAgICAgICAgICAgcG9zaXRpb24ub2Zmc2V0ICs9IHRleHRMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdFJldHVyblZhbHVlKCd0ZXh0JywgdGV4dFByb3h5LCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbiwgdGV4dExlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5pcygndmlldzplbGVtZW50JykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zaGFsbG93KSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMShub2RlLCAwKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgYXJlIHBhc3QgdGhlIHdhbGtlciBib3VuZGFyaWVzLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJvdW5kYXJpZXMgJiYgdGhpcy5ib3VuZGFyaWVzLmVuZC5pc0JlZm9yZShwb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBvc2l0aW9uLm9mZnNldCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudFN0YXJ0Jywgbm9kZSwgcHJldmlvdXNQb3NpdGlvbiwgcG9zaXRpb24sIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuaXMoJ3ZpZXc6JHRleHQnKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2luZ2xlQ2hhcmFjdGVycykge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gbmV3IFBvc2l0aW9uJDEobm9kZSwgMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGNoYXJhY3RlcnNDb3VudCA9IG5vZGUuZGF0YS5sZW5ndGg7XG4gICAgICAgICAgICBsZXQgaXRlbTtcbiAgICAgICAgICAgIC8vIElmIHRleHQgc3RpY2sgb3V0IG9mIHdhbGtlciByYW5nZSwgd2UgbmVlZCB0byBjdXQgaXQgYW5kIHdyYXAgaW4gVGV4dFByb3h5LlxuICAgICAgICAgICAgaWYgKG5vZGUgPT0gdGhpcy5fYm91bmRhcnlFbmRQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzQ291bnQgPSB0aGlzLmJvdW5kYXJpZXMuZW5kLm9mZnNldDtcbiAgICAgICAgICAgICAgICBpdGVtID0gbmV3IFRleHRQcm94eSQxKG5vZGUsIDAsIGNoYXJhY3RlcnNDb3VudCk7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbiQxLl9jcmVhdGVBZnRlcihpdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IG5ldyBUZXh0UHJveHkkMShub2RlLCAwLCBub2RlLmRhdGEubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAvLyBJZiBub3QganVzdCBrZWVwIG1vdmluZyBmb3J3YXJkLlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uLm9mZnNldCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgndGV4dCcsIGl0ZW0sIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uLCBjaGFyYWN0ZXJzQ291bnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGBub2RlYCBpcyBub3Qgc2V0LCB3ZSByZWFjaGVkIHRoZSBlbmQgb2YgY3VycmVudCBgcGFyZW50YC5cbiAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbiQxLl9jcmVhdGVBZnRlcihwYXJlbnQpO1xuICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICBpZiAodGhpcy5pZ25vcmVFbGVtZW50RW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudEVuZCcsIHBhcmVudCwgcHJldmlvdXNQb3NpdGlvbiwgcG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogTWFrZXMgYSBzdGVwIGJhY2t3YXJkIGluIHZpZXcuIE1vdmVzIHRoZSB7QGxpbmsgI3Bvc2l0aW9ufSB0byB0aGUgcHJldmlvdXMgcG9zaXRpb24gYW5kIHJldHVybnMgdGhlIGVuY291bnRlcmVkIHZhbHVlLlxuXHQgKi8gX3ByZXZpb3VzKCkge1xuICAgICAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzUG9zaXRpb24gPSB0aGlzLnBvc2l0aW9uO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIC8vIFdlIGFyZSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSByb290LlxuICAgICAgICBpZiAocGFyZW50LnBhcmVudCA9PT0gbnVsbCAmJiBwb3NpdGlvbi5vZmZzZXQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIHJlYWNoZWQgdGhlIHdhbGtlciBib3VuZGFyeS5cbiAgICAgICAgaWYgKHBhcmVudCA9PSB0aGlzLl9ib3VuZGFyeVN0YXJ0UGFyZW50ICYmIHBvc2l0aW9uLm9mZnNldCA9PSB0aGlzLmJvdW5kYXJpZXMuc3RhcnQub2Zmc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBHZXQgbm9kZSBqdXN0IGJlZm9yZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgICAgICBsZXQgbm9kZTtcbiAgICAgICAgLy8gVGV4dCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dH0gZWxlbWVudCBpcyBhIHNwZWNpZmljIHBhcmVudCBiZWNhdXNlIGNvbnRhaW5zIHN0cmluZyBpbnN0ZWFkIG9mIGNoaWxkIG5vZGVzLlxuICAgICAgICBpZiAocGFyZW50LmlzKCd2aWV3OiR0ZXh0JykpIHtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5pc0F0U3RhcnQpIHtcbiAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHJldHVybmluZyBcImVsZW1lbnRTdGFydFwiIGZvciBUZXh0IG5vZGUuIFNraXAgdGhhdCB2YWx1ZSBhbmQgcmV0dXJuIHRoZSBuZXh0IHdhbGtlciBzdGVwLlxuICAgICAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gUG9zaXRpb24kMS5fY3JlYXRlQmVmb3JlKHBhcmVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlID0gcGFyZW50LmRhdGFbcG9zaXRpb24ub2Zmc2V0IC0gMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub2RlID0gcGFyZW50LmdldENoaWxkKHBvc2l0aW9uLm9mZnNldCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbGV0IHRleHRMZW5ndGg7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc2luZ2xlQ2hhcmFjdGVycykge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRleHQgc3RpY2sgb3V0IG9mIHdhbGtlciByYW5nZS5cbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydE9mZnNldCA9IHBhcmVudCA9PT0gdGhpcy5fYm91bmRhcnlTdGFydFBhcmVudCA/IHRoaXMuYm91bmRhcmllcy5zdGFydC5vZmZzZXQgOiAwO1xuICAgICAgICAgICAgICAgIHRleHRMZW5ndGggPSBwb3NpdGlvbi5vZmZzZXQgLSBzdGFydE9mZnNldDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGV4dExlbmd0aCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQgLT0gdGV4dExlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IHRleHRQcm94eSA9IG5ldyBUZXh0UHJveHkkMShwYXJlbnQsIHBvc2l0aW9uLm9mZnNldCwgdGV4dExlbmd0aCk7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1hdFJldHVyblZhbHVlKCd0ZXh0JywgdGV4dFByb3h5LCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbiwgdGV4dExlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5pcygndmlldzplbGVtZW50JykpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNoYWxsb3cpIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQtLTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudFN0YXJ0Jywgbm9kZSwgcHJldmlvdXNQb3NpdGlvbiwgcG9zaXRpb24sIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMShub2RlLCBub2RlLmNoaWxkQ291bnQpO1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIGlmICh0aGlzLmlnbm9yZUVsZW1lbnRFbmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudEVuZCcsIG5vZGUsIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmlzKCd2aWV3OiR0ZXh0JykpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNpbmdsZUNoYXJhY3RlcnMpIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IG5ldyBQb3NpdGlvbiQxKG5vZGUsIG5vZGUuZGF0YS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgY2hhcmFjdGVyc0NvdW50ID0gbm9kZS5kYXRhLmxlbmd0aDtcbiAgICAgICAgICAgIGxldCBpdGVtO1xuICAgICAgICAgICAgLy8gSWYgdGV4dCBzdGljayBvdXQgb2Ygd2Fsa2VyIHJhbmdlLCB3ZSBuZWVkIHRvIGN1dCBpdCBhbmQgd3JhcCBpbiBUZXh0UHJveHkuXG4gICAgICAgICAgICBpZiAobm9kZSA9PSB0aGlzLl9ib3VuZGFyeVN0YXJ0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5ib3VuZGFyaWVzLnN0YXJ0Lm9mZnNldDtcbiAgICAgICAgICAgICAgICBpdGVtID0gbmV3IFRleHRQcm94eSQxKG5vZGUsIG9mZnNldCwgbm9kZS5kYXRhLmxlbmd0aCAtIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyc0NvdW50ID0gaXRlbS5kYXRhLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZShpdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IG5ldyBUZXh0UHJveHkkMShub2RlLCAwLCBub2RlLmRhdGEubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAvLyBJZiBub3QganVzdCBrZWVwIG1vdmluZyBiYWNrd2FyZC5cbiAgICAgICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQtLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZm9ybWF0UmV0dXJuVmFsdWUoJ3RleHQnLCBpdGVtLCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbiwgY2hhcmFjdGVyc0NvdW50KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBgbm9kZWAgaXMgbm90IHNldCwgd2UgcmVhY2hlZCB0aGUgYmVnaW5uaW5nIG9mIGN1cnJlbnQgYHBhcmVudGAuXG4gICAgICAgIHBvc2l0aW9uID0gUG9zaXRpb24kMS5fY3JlYXRlQmVmb3JlKHBhcmVudCk7XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudFN0YXJ0JywgcGFyZW50LCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbiwgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb3JtYXQgcmV0dXJuZWQgZGF0YSBhbmQgYWRqdXN0IGBwcmV2aW91c1Bvc2l0aW9uYCBhbmQgYG5leHRQb3NpdGlvbmAgaWYgcmVhY2ggdGhlIGJvdW5kIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dH0uXG5cdCAqXG5cdCAqIEBwYXJhbSB0eXBlIFR5cGUgb2Ygc3RlcC5cblx0ICogQHBhcmFtIGl0ZW0gSXRlbSBiZXR3ZWVuIG9sZCBhbmQgbmV3IHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gcHJldmlvdXNQb3NpdGlvbiBQcmV2aW91cyBwb3NpdGlvbiBvZiBpdGVyYXRvci5cblx0ICogQHBhcmFtIG5leHRQb3NpdGlvbiBOZXh0IHBvc2l0aW9uIG9mIGl0ZXJhdG9yLlxuXHQgKiBAcGFyYW0gbGVuZ3RoIExlbmd0aCBvZiB0aGUgaXRlbS5cblx0ICovIF9mb3JtYXRSZXR1cm5WYWx1ZSh0eXBlLCBpdGVtLCBwcmV2aW91c1Bvc2l0aW9uLCBuZXh0UG9zaXRpb24sIGxlbmd0aCkge1xuICAgICAgICAvLyBUZXh0IGlzIGEgc3BlY2lmaWMgcGFyZW50LCBiZWNhdXNlIGNvbnRhaW5zIHN0cmluZyBpbnN0ZWFkIG9mIGNoaWxkcmVuLlxuICAgICAgICAvLyBXYWxrZXIgZG9lc24ndCBlbnRlciB0byB0aGUgVGV4dCBleGNlcHQgc2l0dWF0aW9ucyB3aGVuIHdhbGtlciBpcyBpdGVyYXRpbmcgb3ZlciBldmVyeSBzaW5nbGUgY2hhcmFjdGVyLFxuICAgICAgICAvLyBvciB0aGUgYm91bmQgc3RhcnRzL2VuZHMgaW5zaWRlIHRoZSBUZXh0LiBTbyB3aGVuIHRoZSBwb3NpdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nIG9yIGF0IHRoZSBlbmQgb2YgdGhlIFRleHRcbiAgICAgICAgLy8gd2UgbW92ZSBpdCBqdXN0IGJlZm9yZSBvciBqdXN0IGFmdGVyIFRleHQuXG4gICAgICAgIGlmIChpdGVtLmlzKCd2aWV3OiR0ZXh0UHJveHknKSkge1xuICAgICAgICAgICAgLy8gUG9zaXRpb24gaXMgYXQgdGhlIGVuZCBvZiBUZXh0LlxuICAgICAgICAgICAgaWYgKGl0ZW0ub2Zmc2V0SW5UZXh0ICsgaXRlbS5kYXRhLmxlbmd0aCA9PSBpdGVtLnRleHROb2RlLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09ICdmb3J3YXJkJyAmJiAhKHRoaXMuYm91bmRhcmllcyAmJiB0aGlzLmJvdW5kYXJpZXMuZW5kLmlzRXF1YWwodGhpcy5wb3NpdGlvbikpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRQb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUFmdGVyKGl0ZW0udGV4dE5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHdlIGNoYW5nZSBuZXh0UG9zaXRpb24gb2YgcmV0dXJuZWQgdmFsdWUgd2UgbmVlZCBhbHNvIHVwZGF0ZSB3YWxrZXIgY3VycmVudCBwb3NpdGlvbi5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBuZXh0UG9zaXRpb247XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNQb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUFmdGVyKGl0ZW0udGV4dE5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFBvc2l0aW9uIGlzIGF0IHRoZSBiZWdpbmluZyBvdCB0aGUgdGV4dC5cbiAgICAgICAgICAgIGlmIChpdGVtLm9mZnNldEluVGV4dCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAnYmFja3dhcmQnICYmICEodGhpcy5ib3VuZGFyaWVzICYmIHRoaXMuYm91bmRhcmllcy5zdGFydC5pc0VxdWFsKHRoaXMucG9zaXRpb24pKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gPSBQb3NpdGlvbiQxLl9jcmVhdGVCZWZvcmUoaXRlbS50ZXh0Tm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gd2UgY2hhbmdlIG5leHRQb3NpdGlvbiBvZiByZXR1cm5lZCB2YWx1ZSB3ZSBuZWVkIGFsc28gdXBkYXRlIHdhbGtlciBjdXJyZW50IHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IG5leHRQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c1Bvc2l0aW9uID0gUG9zaXRpb24kMS5fY3JlYXRlQmVmb3JlKGl0ZW0udGV4dE5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZG9uZTogZmFsc2UsXG4gICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICBwcmV2aW91c1Bvc2l0aW9uLFxuICAgICAgICAgICAgICAgIG5leHRQb3NpdGlvbixcbiAgICAgICAgICAgICAgICBsZW5ndGhcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG59O1xuXG4vKipcbiAqIFBvc2l0aW9uIGluIHRoZSB2aWV3IHRyZWUuIFBvc2l0aW9uIGlzIHJlcHJlc2VudGVkIGJ5IGl0cyBwYXJlbnQgbm9kZSBhbmQgYW4gb2Zmc2V0IGluIHRoaXMgcGFyZW50LlxuICpcbiAqIEluIG9yZGVyIHRvIGNyZWF0ZSBhIG5ldyBwb3NpdGlvbiBpbnN0YW5jZSB1c2UgdGhlIGBjcmVhdGVQb3NpdGlvbiooKWAgZmFjdG9yeSBtZXRob2RzIGF2YWlsYWJsZSBpbjpcbiAqXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fVxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfVxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXJ9XG4gKi8gbGV0IFBvc2l0aW9uJDEgPSBjbGFzcyBQb3NpdGlvbiBleHRlbmRzIFR5cGVDaGVja2FibGUkMSB7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIHBhcmVudC5cblx0ICovIHBhcmVudDtcbiAgICAvKipcblx0ICogUG9zaXRpb24gb2Zmc2V0LlxuXHQgKi8gb2Zmc2V0O1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcG9zaXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBwYXJlbnQgUG9zaXRpb24gcGFyZW50LlxuXHQgKiBAcGFyYW0gb2Zmc2V0IFBvc2l0aW9uIG9mZnNldC5cblx0ICovIGNvbnN0cnVjdG9yKHBhcmVudCwgb2Zmc2V0KXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gb2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogTm9kZSBkaXJlY3RseSBhZnRlciB0aGUgcG9zaXRpb24uIEVxdWFscyBgbnVsbGAgd2hlbiB0aGVyZSBpcyBubyBub2RlIGFmdGVyIHBvc2l0aW9uIG9yIHBvc2l0aW9uIGlzIGxvY2F0ZWRcblx0ICogaW5zaWRlIHRleHQgbm9kZS5cblx0ICovIGdldCBub2RlQWZ0ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldENoaWxkKHRoaXMub2Zmc2V0KSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogTm9kZSBkaXJlY3RseSBiZWZvcmUgdGhlIHBvc2l0aW9uLiBFcXVhbHMgYG51bGxgIHdoZW4gdGhlcmUgaXMgbm8gbm9kZSBiZWZvcmUgcG9zaXRpb24gb3IgcG9zaXRpb24gaXMgbG9jYXRlZFxuXHQgKiBpbnNpZGUgdGV4dCBub2RlLlxuXHQgKi8gZ2V0IG5vZGVCZWZvcmUoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldENoaWxkKHRoaXMub2Zmc2V0IC0gMSkgfHwgbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIElzIGB0cnVlYCBpZiBwb3NpdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGl0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudCBwYXJlbnR9LCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGdldCBpc0F0U3RhcnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9mZnNldCA9PT0gMDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIElzIGB0cnVlYCBpZiBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIGl0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudCBwYXJlbnR9LCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGdldCBpc0F0RW5kKCkge1xuICAgICAgICBjb25zdCBlbmRPZmZzZXQgPSB0aGlzLnBhcmVudC5pcygnJHRleHQnKSA/IHRoaXMucGFyZW50LmRhdGEubGVuZ3RoIDogdGhpcy5wYXJlbnQuY2hpbGRDb3VudDtcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ID09PSBlbmRPZmZzZXQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQb3NpdGlvbidzIHJvb3QsIHRoYXQgaXMgdGhlIHJvb3Qgb2YgdGhlIHBvc2l0aW9uJ3MgcGFyZW50IGVsZW1lbnQuXG5cdCAqLyBnZXQgcm9vdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LnJvb3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnQgRWRpdGFibGVFbGVtZW50fSBpbnN0YW5jZSB0aGF0IGNvbnRhaW5zIHRoaXMgcG9zaXRpb24sIG9yIGBudWxsYCBpZlxuXHQgKiBwb3NpdGlvbiBpcyBub3QgaW5zaWRlIGFuIGVkaXRhYmxlIGVsZW1lbnQuXG5cdCAqLyBnZXQgZWRpdGFibGVFbGVtZW50KCkge1xuICAgICAgICBsZXQgZWRpdGFibGUgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgd2hpbGUoIShlZGl0YWJsZSBpbnN0YW5jZW9mIEVkaXRhYmxlRWxlbWVudCkpe1xuICAgICAgICAgICAgaWYgKGVkaXRhYmxlLnBhcmVudCkge1xuICAgICAgICAgICAgICAgIGVkaXRhYmxlID0gZWRpdGFibGUucGFyZW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWRpdGFibGU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgbmV3IGluc3RhbmNlIG9mIFBvc2l0aW9uIHdpdGggb2Zmc2V0IGluY3JlbWVudGVkIGJ5IGBzaGlmdGAgdmFsdWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBzaGlmdCBIb3cgcG9zaXRpb24gb2Zmc2V0IHNob3VsZCBnZXQgY2hhbmdlZC4gQWNjZXB0cyBuZWdhdGl2ZSB2YWx1ZXMuXG5cdCAqIEByZXR1cm5zIFNoaWZ0ZWQgcG9zaXRpb24uXG5cdCAqLyBnZXRTaGlmdGVkQnkoc2hpZnQpIHtcbiAgICAgICAgY29uc3Qgc2hpZnRlZCA9IFBvc2l0aW9uLl9jcmVhdGVBdCh0aGlzKTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hpZnRlZC5vZmZzZXQgKyBzaGlmdDtcbiAgICAgICAgc2hpZnRlZC5vZmZzZXQgPSBvZmZzZXQgPCAwID8gMCA6IG9mZnNldDtcbiAgICAgICAgcmV0dXJuIHNoaWZ0ZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBmYXJ0aGVzdCBwb3NpdGlvbiB3aGljaCBtYXRjaGVzIHRoZSBjYWxsYmFjayB1c2luZ1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlciBUcmVlV2Fsa2VyfS5cblx0ICpcblx0ICogRm9yIGV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCB2YWx1ZSA9PiB2YWx1ZS50eXBlID09ICd0ZXh0JyApOyAvLyA8cD57fWZvbzwvcD4gLT4gPHA+Zm9vW108L3A+XG5cdCAqIGdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCB2YWx1ZSA9PiB2YWx1ZS50eXBlID09ICd0ZXh0JywgeyBkaXJlY3Rpb246ICdiYWNrd2FyZCcgfSApOyAvLyA8cD5mb29bXTwvcD4gLT4gPHA+e31mb288L3A+XG5cdCAqIGdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCB2YWx1ZSA9PiBmYWxzZSApOyAvLyBEbyBub3QgbW92ZSB0aGUgcG9zaXRpb24uXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gc2tpcCBDYWxsYmFjayBmdW5jdGlvbi4gR2V0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlclZhbHVlfSBhbmQgc2hvdWxkXG5cdCAqIHJldHVybiBgdHJ1ZWAgaWYgdGhlIHZhbHVlIHNob3VsZCBiZSBza2lwcGVkIG9yIGBmYWxzZWAgaWYgbm90LlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBjb25maWd1cmF0aW9uIG9wdGlvbnMuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlcn0uXG5cdCAqIEByZXR1cm5zIFRoZSBwb3NpdGlvbiBhZnRlciB0aGUgbGFzdCBpdGVtIHdoaWNoIG1hdGNoZXMgdGhlIGBza2lwYCBjYWxsYmFjayB0ZXN0LlxuXHQgKi8gZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oc2tpcCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIG9wdGlvbnMuc3RhcnRQb3NpdGlvbiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHRyZWVXYWxrZXIgPSBuZXcgVHJlZVdhbGtlciQxKG9wdGlvbnMpO1xuICAgICAgICB0cmVlV2Fsa2VyLnNraXAoc2tpcCk7XG4gICAgICAgIHJldHVybiB0cmVlV2Fsa2VyLnBvc2l0aW9uO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbmNlc3RvcnMgYXJyYXkgb2YgdGhpcyBwb3NpdGlvbiwgdGhhdCBpcyB0aGlzIHBvc2l0aW9uJ3MgcGFyZW50IGFuZCBpdCdzIGFuY2VzdG9ycy5cblx0ICpcblx0ICogQHJldHVybnMgQXJyYXkgd2l0aCBhbmNlc3RvcnMuXG5cdCAqLyBnZXRBbmNlc3RvcnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50XG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldEFuY2VzdG9ycyh7XG4gICAgICAgICAgICAgICAgaW5jbHVkZVNlbGY6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGV9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fVxuXHQgKiB3aGljaCBpcyBhIGNvbW1vbiBhbmNlc3RvciBvZiBib3RoIHBvc2l0aW9ucy5cblx0ICovIGdldENvbW1vbkFuY2VzdG9yKHBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9yc0EgPSB0aGlzLmdldEFuY2VzdG9ycygpO1xuICAgICAgICBjb25zdCBhbmNlc3RvcnNCID0gcG9zaXRpb24uZ2V0QW5jZXN0b3JzKCk7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgd2hpbGUoYW5jZXN0b3JzQVtpXSA9PSBhbmNlc3RvcnNCW2ldICYmIGFuY2VzdG9yc0FbaV0pe1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpID09PSAwID8gbnVsbCA6IGFuY2VzdG9yc0FbaSAtIDFdO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBwb3NpdGlvbiBlcXVhbHMgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclBvc2l0aW9uIFBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgVHJ1ZSBpZiBwb3NpdGlvbnMgYXJlIHNhbWUuXG5cdCAqLyBpc0VxdWFsKG90aGVyUG9zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50ID09IG90aGVyUG9zaXRpb24ucGFyZW50ICYmIHRoaXMub2Zmc2V0ID09IG90aGVyUG9zaXRpb24ub2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBwb3NpdGlvbiBpcyBsb2NhdGVkIGJlZm9yZSBnaXZlbiBwb3NpdGlvbi4gV2hlbiBtZXRob2QgcmV0dXJucyBgZmFsc2VgIGl0IGRvZXMgbm90IG1lYW4gdGhhdFxuXHQgKiB0aGlzIHBvc2l0aW9uIGlzIGFmdGVyIGdpdmUgb25lLiBUd28gcG9zaXRpb25zIG1heSBiZSBsb2NhdGVkIGluc2lkZSBzZXBhcmF0ZSByb290cyBhbmQgaW4gdGhhdCBzaXR1YXRpb24gdGhpc1xuXHQgKiBtZXRob2Qgd2lsbCBzdGlsbCByZXR1cm4gYGZhbHNlYC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlclxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNjb21wYXJlV2l0aFxuXHQgKiBAcGFyYW0gb3RoZXJQb3NpdGlvbiBQb3NpdGlvbiB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcG9zaXRpb24gaXMgYmVmb3JlIGdpdmVuIHBvc2l0aW9uLlxuXHQgKi8gaXNCZWZvcmUob3RoZXJQb3NpdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlV2l0aChvdGhlclBvc2l0aW9uKSA9PSAnYmVmb3JlJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoaXMgcG9zaXRpb24gaXMgbG9jYXRlZCBhZnRlciBnaXZlbiBwb3NpdGlvbi4gV2hlbiBtZXRob2QgcmV0dXJucyBgZmFsc2VgIGl0IGRvZXMgbm90IG1lYW4gdGhhdFxuXHQgKiB0aGlzIHBvc2l0aW9uIGlzIGJlZm9yZSBnaXZlIG9uZS4gVHdvIHBvc2l0aW9ucyBtYXkgYmUgbG9jYXRlZCBpbnNpZGUgc2VwYXJhdGUgcm9vdHMgYW5kIGluIHRoYXQgc2l0dWF0aW9uIHRoaXNcblx0ICogbWV0aG9kIHdpbGwgc3RpbGwgcmV0dXJuIGBmYWxzZWAuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI2lzQmVmb3JlXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI2NvbXBhcmVXaXRoXG5cdCAqIEBwYXJhbSBvdGhlclBvc2l0aW9uIFBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBwb3NpdGlvbiBpcyBhZnRlciBnaXZlbiBwb3NpdGlvbi5cblx0ICovIGlzQWZ0ZXIob3RoZXJQb3NpdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlV2l0aChvdGhlclBvc2l0aW9uKSA9PSAnYWZ0ZXInO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBwb3NpdGlvbiBpcyBiZWZvcmUsIGFmdGVyIG9yIGluIHNhbWUgcG9zaXRpb24gdGhhdCBvdGhlciBwb3NpdGlvbi4gVHdvIHBvc2l0aW9ucyBtYXkgYmUgYWxzb1xuXHQgKiBkaWZmZXJlbnQgd2hlbiB0aGV5IGFyZSBsb2NhdGVkIGluIHNlcGFyYXRlIHJvb3RzLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJQb3NpdGlvbiBQb3NpdGlvbiB0byBjb21wYXJlIHdpdGguXG5cdCAqLyBjb21wYXJlV2l0aChvdGhlclBvc2l0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLnJvb3QgIT09IG90aGVyUG9zaXRpb24ucm9vdCkge1xuICAgICAgICAgICAgcmV0dXJuICdkaWZmZXJlbnQnO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzRXF1YWwob3RoZXJQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybiAnc2FtZSc7XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2V0IHBhdGggZnJvbSByb290IHRvIHBvc2l0aW9uJ3MgcGFyZW50IGVsZW1lbnQuXG4gICAgICAgIGNvbnN0IHRoaXNQYXRoID0gdGhpcy5wYXJlbnQuaXMoJ25vZGUnKSA/IHRoaXMucGFyZW50LmdldFBhdGgoKSA6IFtdO1xuICAgICAgICBjb25zdCBvdGhlclBhdGggPSBvdGhlclBvc2l0aW9uLnBhcmVudC5pcygnbm9kZScpID8gb3RoZXJQb3NpdGlvbi5wYXJlbnQuZ2V0UGF0aCgpIDogW107XG4gICAgICAgIC8vIEFkZCB0aGUgcG9zaXRpb25zJyBvZmZzZXRzIHRvIHRoZSBwYXJlbnRzIG9mZnNldHMuXG4gICAgICAgIHRoaXNQYXRoLnB1c2godGhpcy5vZmZzZXQpO1xuICAgICAgICBvdGhlclBhdGgucHVzaChvdGhlclBvc2l0aW9uLm9mZnNldCk7XG4gICAgICAgIC8vIENvbXBhcmUgYm90aCBwYXRoIGFycmF5cyB0byBmaW5kIGNvbW1vbiBhbmNlc3Rvci5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyZUFycmF5cyh0aGlzUGF0aCwgb3RoZXJQYXRoKTtcbiAgICAgICAgc3dpdGNoKHJlc3VsdCl7XG4gICAgICAgICAgICBjYXNlICdwcmVmaXgnOlxuICAgICAgICAgICAgICAgIHJldHVybiAnYmVmb3JlJztcbiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdhZnRlcic7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIENhc3QgdG8gbnVtYmVyIHRvIGF2b2lkIGhhdmluZyAnc2FtZScgYXMgYSB0eXBlIG9mIGByZXN1bHRgLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzUGF0aFtyZXN1bHRdIDwgb3RoZXJQYXRoW3Jlc3VsdF0gPyAnYmVmb3JlJyA6ICdhZnRlcic7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlciBUcmVlV2Fsa2VyfSBpbnN0YW5jZSB3aXRoIHRoaXMgcG9zaXRpb25zIGFzIGEgc3RhcnQgcG9zaXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9iamVjdCB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfVxuXHQgKi8gZ2V0V2Fsa2VyKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBvcHRpb25zLnN0YXJ0UG9zaXRpb24gPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFRyZWVXYWxrZXIkMShvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyB0aGlzIHBvc2l0aW9uLlxuXHQgKi8gY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24odGhpcy5wYXJlbnQsIHRoaXMub2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgcG9zaXRpb24gYXQgdGhlIGdpdmVuIGxvY2F0aW9uLiBUaGUgbG9jYXRpb24gY2FuIGJlIHNwZWNpZmllZCBhczpcblx0ICpcblx0ICogKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb259LFxuXHQgKiAqIHBhcmVudCBlbGVtZW50IGFuZCBvZmZzZXQgKG9mZnNldCBkZWZhdWx0cyB0byBgMGApLFxuXHQgKiAqIHBhcmVudCBlbGVtZW50IGFuZCBgJ2VuZCdgIChzZXRzIHBvc2l0aW9uIGF0IHRoZSBlbmQgb2YgdGhhdCBlbGVtZW50KSxcblx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19IGFuZCBgJ2JlZm9yZSdgIG9yIGAnYWZ0ZXInYCAoc2V0cyBwb3NpdGlvbiBiZWZvcmUgb3IgYWZ0ZXIgZ2l2ZW4gdmlldyBpdGVtKS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgYSBzaG9ydGN1dCB0byBvdGhlciBjb25zdHJ1Y3RvcnMgc3VjaCBhczpcblx0ICpcblx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uLl9jcmVhdGVCZWZvcmV9LFxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24uX2NyZWF0ZUFmdGVyfS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9yIG9uZSBvZiB0aGUgZmxhZ3MuIFVzZWQgb25seSB3aGVuIGZpcnN0IHBhcmFtZXRlciBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIHZpZXcgaXRlbX0uXG5cdCAqLyBzdGF0aWMgX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpIHtcbiAgICAgICAgaWYgKGl0ZW1PclBvc2l0aW9uIGluc3RhbmNlb2YgUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgdGhpcyhpdGVtT3JQb3NpdGlvbi5wYXJlbnQsIGl0ZW1PclBvc2l0aW9uLm9mZnNldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBub2RlID0gaXRlbU9yUG9zaXRpb247XG4gICAgICAgICAgICBpZiAob2Zmc2V0ID09ICdlbmQnKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gbm9kZS5pcygnJHRleHQnKSA/IG5vZGUuZGF0YS5sZW5ndGggOiBub2RlLmNoaWxkQ291bnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9mZnNldCA9PSAnYmVmb3JlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVCZWZvcmUobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9mZnNldCA9PSAnYWZ0ZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUFmdGVyKG5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvZmZzZXQgIT09IDAgJiYgIW9mZnNldCkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVQb3NpdGlvbkF0IGBWaWV3I2NyZWF0ZVBvc2l0aW9uQXQoKWB9XG5cdFx0XHRcdCAqIHJlcXVpcmVzIHRoZSBvZmZzZXQgdG8gYmUgc3BlY2lmaWVkIHdoZW4gdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBhIHZpZXcgaXRlbS5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIHZpZXctY3JlYXRlcG9zaXRpb25hdC1vZmZzZXQtcmVxdWlyZWRcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LWNyZWF0ZXBvc2l0aW9uYXQtb2Zmc2V0LXJlcXVpcmVkJywgbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKG5vZGUsIG9mZnNldCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgcG9zaXRpb24gYWZ0ZXIgZ2l2ZW4gdmlldyBpdGVtLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGl0ZW0gVmlldyBpdGVtIGFmdGVyIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgbG9jYXRlZC5cblx0ICovIHN0YXRpYyBfY3JlYXRlQWZ0ZXIoaXRlbSkge1xuICAgICAgICAvLyBUZXh0UHJveHkgaXMgbm90IGEgaW5zdGFuY2Ugb2YgTm9kZSBzbyB3ZSBuZWVkIGRvIGhhbmRsZSBpdCBpbiBzcGVjaWZpYyB3YXkuXG4gICAgICAgIGlmIChpdGVtLmlzKCckdGV4dFByb3h5JykpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24oaXRlbS50ZXh0Tm9kZSwgaXRlbS5vZmZzZXRJblRleHQgKyBpdGVtLmRhdGEubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWl0ZW0ucGFyZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFlvdSBjYW4gbm90IG1ha2UgYSBwb3NpdGlvbiBhZnRlciBhIHJvb3QuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctcG9zaXRpb24tYWZ0ZXItcm9vdFxuXHRcdFx0ICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlfSByb290XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctcG9zaXRpb24tYWZ0ZXItcm9vdCcsIGl0ZW0sIHtcbiAgICAgICAgICAgICAgICByb290OiBpdGVtXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGl0ZW0ucGFyZW50LCBpdGVtLmluZGV4ICsgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHBvc2l0aW9uIGJlZm9yZSBnaXZlbiB2aWV3IGl0ZW0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaXRlbSBWaWV3IGl0ZW0gYmVmb3JlIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgbG9jYXRlZC5cblx0ICovIHN0YXRpYyBfY3JlYXRlQmVmb3JlKGl0ZW0pIHtcbiAgICAgICAgLy8gVGV4dFByb3h5IGlzIG5vdCBhIGluc3RhbmNlIG9mIE5vZGUgc28gd2UgbmVlZCBkbyBoYW5kbGUgaXQgaW4gc3BlY2lmaWMgd2F5LlxuICAgICAgICBpZiAoaXRlbS5pcygnJHRleHRQcm94eScpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGl0ZW0udGV4dE5vZGUsIGl0ZW0ub2Zmc2V0SW5UZXh0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWl0ZW0ucGFyZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFlvdSBjYW5ub3QgbWFrZSBhIHBvc2l0aW9uIGJlZm9yZSBhIHJvb3QuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctcG9zaXRpb24tYmVmb3JlLXJvb3Rcblx0XHRcdCAqIEBwYXJhbSB7bW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZX0gcm9vdFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXBvc2l0aW9uLWJlZm9yZS1yb290JywgaXRlbSwge1xuICAgICAgICAgICAgICAgIHJvb3Q6IGl0ZW1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24oaXRlbS5wYXJlbnQsIGl0ZW0uaW5kZXgpO1xuICAgIH1cbn07XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5Qb3NpdGlvbiQxLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ3Bvc2l0aW9uJyB8fCB0eXBlID09PSAndmlldzpwb3NpdGlvbic7XG59O1xuXG4vKipcbiAqIFJhbmdlIGluIHRoZSB2aWV3IHRyZWUuIEEgcmFuZ2UgaXMgcmVwcmVzZW50ZWQgYnkgaXRzIHN0YXJ0IGFuZCBlbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbnN9LlxuICpcbiAqIEluIG9yZGVyIHRvIGNyZWF0ZSBhIG5ldyBwb3NpdGlvbiBpbnN0YW5jZSB1c2UgdGhlIGBjcmVhdGVQb3NpdGlvbiooKWAgZmFjdG9yeSBtZXRob2RzIGF2YWlsYWJsZSBpbjpcbiAqXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fVxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfVxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXJ9XG4gKi8gbGV0IFJhbmdlJDEgPSBjbGFzcyBSYW5nZSBleHRlbmRzIFR5cGVDaGVja2FibGUkMSB7XG4gICAgLyoqXG5cdCAqIFN0YXJ0IHBvc2l0aW9uLlxuXHQgKi8gc3RhcnQ7XG4gICAgLyoqXG5cdCAqIEVuZCBwb3NpdGlvbi5cblx0ICovIGVuZDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHNwYW5uaW5nIGZyb20gYHN0YXJ0YCBwb3NpdGlvbiB0byBgZW5kYCBwb3NpdGlvbi5cblx0ICpcblx0ICogKipOb3RlOioqIENvbnN0cnVjdG9yIGNyZWF0ZXMgaXQncyBvd24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0gaW5zdGFuY2VzIGJhc2luZyBvbiBwYXNzZWQgdmFsdWVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gc3RhcnQgU3RhcnQgcG9zaXRpb24uXG5cdCAqIEBwYXJhbSBlbmQgRW5kIHBvc2l0aW9uLiBJZiBub3Qgc2V0LCByYW5nZSB3aWxsIGJlIGNvbGxhcHNlZCBhdCB0aGUgYHN0YXJ0YCBwb3NpdGlvbi5cblx0ICovIGNvbnN0cnVjdG9yKHN0YXJ0LCBlbmQgPSBudWxsKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0LmNsb25lKCk7XG4gICAgICAgIHRoaXMuZW5kID0gZW5kID8gZW5kLmNsb25lKCkgOiBzdGFydC5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmFibGUgaW50ZXJmYWNlLlxuXHQgKlxuXHQgKiBJdGVyYXRlcyBvdmVyIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW1zfSB0aGF0IGFyZSBpbiB0aGlzIHJhbmdlIGFuZCByZXR1cm5zXG5cdCAqIHRoZW0gdG9nZXRoZXIgd2l0aCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGxpa2UgbGVuZ3RoIG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb25zfSxcblx0ICogZ3JvdXBlZCBhcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlclZhbHVlfS5cblx0ICpcblx0ICogVGhpcyBpdGVyYXRvciB1c2VzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyIFRyZWVXYWxrZXJ9IHdpdGggYGJvdW5kYXJpZXNgIHNldCB0byB0aGlzIHJhbmdlIGFuZFxuXHQgKiBgaWdub3JlRWxlbWVudEVuZGAgb3B0aW9uXG5cdCAqIHNldCB0byBgdHJ1ZWAuXG5cdCAqLyAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHlpZWxkKiBuZXcgVHJlZVdhbGtlciQxKHtcbiAgICAgICAgICAgIGJvdW5kYXJpZXM6IHRoaXMsXG4gICAgICAgICAgICBpZ25vcmVFbGVtZW50RW5kOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB3aGV0aGVyIHRoZSByYW5nZSBpcyBjb2xsYXBzZWQsIHRoYXQgaXMgaXQgc3RhcnQgYW5kIGVuZCBwb3NpdGlvbnMgYXJlIGVxdWFsLlxuXHQgKi8gZ2V0IGlzQ29sbGFwc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5pc0VxdWFsKHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgd2hldGhlciB0aGlzIHJhbmdlIGlzIGZsYXQsIHRoYXQgaXMgaWYge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gcG9zaXRpb24gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0gcG9zaXRpb24gYXJlIGluIHRoZSBzYW1lIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jcGFyZW50IHBhcmVudH0uXG5cdCAqLyBnZXQgaXNGbGF0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5wYXJlbnQgPT09IHRoaXMuZW5kLnBhcmVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJhbmdlIHJvb3QgZWxlbWVudC5cblx0ICovIGdldCByb290KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5yb290O1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1heGltYWwgcmFuZ2UgdGhhdCBoYXMgdGhlIHNhbWUgY29udGVudCBhcyB0aGlzIHJhbmdlIGJ1dCBpcyBleHBhbmRlZCBpbiBib3RoIHdheXMgKGF0IHRoZSBiZWdpbm5pbmdcblx0ICogYW5kIGF0IHRoZSBlbmQpLlxuXHQgKlxuXHQgKiBGb3IgZXhhbXBsZTpcblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD5Gb288L3A+PHA+PGI+e0Jhcn08L2I+PC9wPiAtPiA8cD5Gb288L3A+WzxwPjxiPkJhcjwvYj5dPC9wPlxuXHQgKiA8cD48Yj5mb288L2I+e2Jhcn08c3Bhbj48L3NwYW4+PC9wPiAtPiA8cD48Yj5mb29bPC9iPmJhcjxzcGFuPjwvc3Bhbj5dPC9wPlxuXHQgKiBgYGBcblx0ICpcblx0ICogTm90ZSB0aGF0IGluIHRoZSBzYW1wbGUgYWJvdmU6XG5cdCAqXG5cdCAqIC0gYDxwPmAgaGF2ZSB0eXBlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50fSxcblx0ICogLSBgPGI+YCBoYXZlIHR5cGUgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9LFxuXHQgKiAtIGA8c3Bhbj5gIGhhdmUgdHlwZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBFbmxhcmdlZCByYW5nZS5cblx0ICovIGdldEVubGFyZ2VkKCkge1xuICAgICAgICBsZXQgc3RhcnQgPSB0aGlzLnN0YXJ0LmdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKGVubGFyZ2VUcmltU2tpcCwge1xuICAgICAgICAgICAgZGlyZWN0aW9uOiAnYmFja3dhcmQnXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgZW5kID0gdGhpcy5lbmQuZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oZW5sYXJnZVRyaW1Ta2lwKTtcbiAgICAgICAgLy8gRml4IHBvc2l0aW9ucywgaW4gY2FzZSBpZiB0aGV5IGFyZSBpbiBUZXh0IG5vZGUuXG4gICAgICAgIGlmIChzdGFydC5wYXJlbnQuaXMoJyR0ZXh0JykgJiYgc3RhcnQuaXNBdFN0YXJ0KSB7XG4gICAgICAgICAgICBzdGFydCA9IFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZShzdGFydC5wYXJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbmQucGFyZW50LmlzKCckdGV4dCcpICYmIGVuZC5pc0F0RW5kKSB7XG4gICAgICAgICAgICBlbmQgPSBQb3NpdGlvbiQxLl9jcmVhdGVBZnRlcihlbmQucGFyZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1pbmltdW0gcmFuZ2UgdGhhdCBoYXMgdGhlIHNhbWUgY29udGVudCBhcyB0aGlzIHJhbmdlIGJ1dCBpcyB0cmltbWVkIGluIGJvdGggd2F5cyAoYXQgdGhlIGJlZ2lubmluZ1xuXHQgKiBhbmQgYXQgdGhlIGVuZCkuXG5cdCAqXG5cdCAqIEZvciBleGFtcGxlOlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxwPkZvbzwvcD5bPHA+PGI+QmFyPC9iPl08L3A+IC0+IDxwPkZvbzwvcD48cD48Yj57QmFyfTwvYj48L3A+XG5cdCAqIDxwPjxiPmZvb1s8L2I+YmFyPHNwYW4+PC9zcGFuPl08L3A+IC0+IDxwPjxiPmZvbzwvYj57YmFyfTxzcGFuPjwvc3Bhbj48L3A+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgaW4gdGhlIHNhbXBsZSBhYm92ZTpcblx0ICpcblx0ICogLSBgPHA+YCBoYXZlIHR5cGUgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9LFxuXHQgKiAtIGA8Yj5gIGhhdmUgdHlwZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0sXG5cdCAqIC0gYDxzcGFuPmAgaGF2ZSB0eXBlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudH0uXG5cdCAqXG5cdCAqIEByZXR1cm5zIFNocnVuayByYW5nZS5cblx0ICovIGdldFRyaW1tZWQoKSB7XG4gICAgICAgIGxldCBzdGFydCA9IHRoaXMuc3RhcnQuZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oZW5sYXJnZVRyaW1Ta2lwKTtcbiAgICAgICAgaWYgKHN0YXJ0LmlzQWZ0ZXIodGhpcy5lbmQpIHx8IHN0YXJ0LmlzRXF1YWwodGhpcy5lbmQpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVuZCA9IHRoaXMuZW5kLmdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKGVubGFyZ2VUcmltU2tpcCwge1xuICAgICAgICAgICAgZGlyZWN0aW9uOiAnYmFja3dhcmQnXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBub2RlQWZ0ZXJTdGFydCA9IHN0YXJ0Lm5vZGVBZnRlcjtcbiAgICAgICAgY29uc3Qgbm9kZUJlZm9yZUVuZCA9IGVuZC5ub2RlQmVmb3JlO1xuICAgICAgICAvLyBCZWNhdXNlIFRyZWVXYWxrZXIgcHJlZmVycyBwb3NpdGlvbnMgbmV4dCB0byB0ZXh0IG5vZGUsIHdlIG5lZWQgdG8gbW92ZSB0aGVtIG1hbnVhbGx5IGludG8gdGhlc2UgdGV4dCBub2Rlcy5cbiAgICAgICAgaWYgKG5vZGVBZnRlclN0YXJ0ICYmIG5vZGVBZnRlclN0YXJ0LmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICBzdGFydCA9IG5ldyBQb3NpdGlvbiQxKG5vZGVBZnRlclN0YXJ0LCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZUJlZm9yZUVuZCAmJiBub2RlQmVmb3JlRW5kLmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICBlbmQgPSBuZXcgUG9zaXRpb24kMShub2RlQmVmb3JlRW5kLCBub2RlQmVmb3JlRW5kLmRhdGEubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogVHdvIHJhbmdlcyBhcmUgZXF1YWwgaWYgdGhlaXIgc3RhcnQgYW5kIGVuZCBwb3NpdGlvbnMgYXJlIGVxdWFsLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiByYW5nZXMgYXJlIGVxdWFsLCBgZmFsc2VgIG90aGVyd2lzZVxuXHQgKi8gaXNFcXVhbChvdGhlclJhbmdlKSB7XG4gICAgICAgIHJldHVybiB0aGlzID09IG90aGVyUmFuZ2UgfHwgdGhpcy5zdGFydC5pc0VxdWFsKG90aGVyUmFuZ2Uuc3RhcnQpICYmIHRoaXMuZW5kLmlzRXF1YWwob3RoZXJSYW5nZS5lbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhpcyByYW5nZSBjb250YWlucyBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufS5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbn0gaXMgY29udGFpbmVkIGluIHRoaXMgcmFuZ2UsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gY29udGFpbnNQb3NpdGlvbihwb3NpdGlvbikge1xuICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNBZnRlcih0aGlzLnN0YXJ0KSAmJiBwb3NpdGlvbi5pc0JlZm9yZSh0aGlzLmVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHJhbmdlIGNvbnRhaW5zIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2V9LlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjaGVjay5cblx0ICogQHBhcmFtIGxvb3NlIFdoZXRoZXIgdGhlIGNoZWNrIGlzIGxvb3NlIG9yIHN0cmljdC4gSWYgdGhlIGNoZWNrIGlzIHN0cmljdCAoYGZhbHNlYCksIGNvbXBhcmVkIHJhbmdlIGNhbm5vdFxuXHQgKiBzdGFydCBvciBlbmQgYXQgdGhlIHNhbWUgcG9zaXRpb24gYXMgdGhpcyByYW5nZSBib3VuZGFyaWVzLiBJZiB0aGUgY2hlY2sgaXMgbG9vc2UgKGB0cnVlYCksIGNvbXBhcmVkIHJhbmdlIGNhbiBzdGFydCwgZW5kIG9yXG5cdCAqIGV2ZW4gYmUgZXF1YWwgdG8gdGhpcyByYW5nZS4gTm90ZSB0aGF0IGNvbGxhcHNlZCByYW5nZXMgYXJlIGFsd2F5cyBjb21wYXJlZCBpbiBzdHJpY3QgbW9kZS5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2V9IGJvdW5kYXJpZXMgYXJlIGNvbnRhaW5lZCBieSB0aGlzIHJhbmdlLCBgZmFsc2VgXG5cdCAqIG90aGVyd2lzZS5cblx0ICovIGNvbnRhaW5zUmFuZ2Uob3RoZXJSYW5nZSwgbG9vc2UgPSBmYWxzZSkge1xuICAgICAgICBpZiAob3RoZXJSYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgbG9vc2UgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWluc1N0YXJ0ID0gdGhpcy5jb250YWluc1Bvc2l0aW9uKG90aGVyUmFuZ2Uuc3RhcnQpIHx8IGxvb3NlICYmIHRoaXMuc3RhcnQuaXNFcXVhbChvdGhlclJhbmdlLnN0YXJ0KTtcbiAgICAgICAgY29uc3QgY29udGFpbnNFbmQgPSB0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5lbmQpIHx8IGxvb3NlICYmIHRoaXMuZW5kLmlzRXF1YWwob3RoZXJSYW5nZS5lbmQpO1xuICAgICAgICByZXR1cm4gY29udGFpbnNTdGFydCAmJiBjb250YWluc0VuZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbXB1dGVzIHdoaWNoIHBhcnQocykgb2YgdGhpcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlIHJhbmdlfSBpcyBub3QgYSBwYXJ0IG9mIGdpdmVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2V9LlxuXHQgKiBSZXR1cm5lZCBhcnJheSBjb250YWlucyB6ZXJvLCBvbmUgb3IgdHdvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2VzfS5cblx0ICpcblx0ICogRXhhbXBsZXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGxldCBmb28gPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApO1xuXHQgKiBsZXQgaW1nID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ2ltZycgKTtcblx0ICogbGV0IGJhciA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVRleHQoICdiYXInICk7XG5cdCAqIGxldCBwID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ3AnLCBudWxsLCBbIGZvbywgaW1nLCBiYXIgXSApO1xuXHQgKlxuXHQgKiBsZXQgcmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIGZvbywgMiApLCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIGJhciwgMSApOyAvLyBcIm9cIiwgaW1nLCBcImJcIiBhcmUgaW4gcmFuZ2UuXG5cdCAqIGxldCBvdGhlclJhbmdlID0gdmlldy5jcmVhdGVSYW5nZSggLy8gXCJvb1wiLCBpbWcsIFwiYmFcIiBhcmUgaW4gcmFuZ2UuXG5cdCAqIFx0dmlldy5jcmVhdGVQb3NpdGlvbkF0KCBmb28sIDEgKSxcblx0ICogXHR2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIGJhciwgMiApXG5cdCAqICk7XG5cdCAqIGxldCB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldERpZmZlcmVuY2UoIG90aGVyUmFuZ2UgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG5vIHJhbmdlcyBiZWNhdXNlIGBvdGhlclJhbmdlYCBjb250YWlucyBgcmFuZ2VgXG5cdCAqXG5cdCAqIG90aGVyUmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIGZvbywgMSApLCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIHAsIDIgKTsgLy8gXCJvb1wiLCBpbWcgYXJlIGluIHJhbmdlLlxuXHQgKiB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldERpZmZlcmVuY2UoIG90aGVyUmFuZ2UgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG9uZSByYW5nZTogZnJvbSAoIHAsIDIgKSB0byAoIGJhciwgMSApXG5cdCAqXG5cdCAqIG90aGVyUmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIHAsIDEgKSwgdmlldy5jcmVhdGVQb3NpdGlvbkF0KCBwLCAyICkgKTsgLy8gaW1nIGlzIGluIHJhbmdlLlxuXHQgKiB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldERpZmZlcmVuY2UoIG90aGVyUmFuZ2UgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIHR3byByYW5nZXM6IGZyb20gKCBmb28sIDEgKSB0byAoIHAsIDEgKSBhbmQgZnJvbSAoIHAsIDIgKSB0byAoIGJhciwgMSApXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBkaWZmZXJlbnRpYXRlIGFnYWluc3QuXG5cdCAqIEByZXR1cm5zIFRoZSBkaWZmZXJlbmNlIGJldHdlZW4gcmFuZ2VzLlxuXHQgKi8gZ2V0RGlmZmVyZW5jZShvdGhlclJhbmdlKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgICAgICBpZiAodGhpcy5pc0ludGVyc2VjdGluZyhvdGhlclJhbmdlKSkge1xuICAgICAgICAgICAgLy8gUmFuZ2VzIGludGVyc2VjdC5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICAvLyBHaXZlbiByYW5nZSBzdGFydCBpcyBpbnNpZGUgdGhpcyByYW5nZS4gVGhpcyBtZWFucyB0aGF0IHdlIGhhdmUgdG9cbiAgICAgICAgICAgICAgICAvLyBhZGQgc2hydW5rZW4gcmFuZ2UgLSBmcm9tIHRoZSBzdGFydCB0byB0aGUgbWlkZGxlIG9mIHRoaXMgcmFuZ2UuXG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKHRoaXMuc3RhcnQsIG90aGVyUmFuZ2Uuc3RhcnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5lbmQpKSB7XG4gICAgICAgICAgICAgICAgLy8gR2l2ZW4gcmFuZ2UgZW5kIGlzIGluc2lkZSB0aGlzIHJhbmdlLiBUaGlzIG1lYW5zIHRoYXQgd2UgaGF2ZSB0b1xuICAgICAgICAgICAgICAgIC8vIGFkZCBzaHJ1bmtlbiByYW5nZSAtIGZyb20gdGhlIG1pZGRsZSBvZiB0aGlzIHJhbmdlIHRvIHRoZSBlbmQuXG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKG90aGVyUmFuZ2UuZW5kLCB0aGlzLmVuZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUmFuZ2VzIGRvIG5vdCBpbnRlcnNlY3QsIHJldHVybiB0aGUgb3JpZ2luYWwgcmFuZ2UuXG4gICAgICAgICAgICByYW5nZXMucHVzaCh0aGlzLmNsb25lKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGludGVyc2VjdGlvbiBvZiB0aGlzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UgcmFuZ2V9IGFuZCBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlIHJhbmdlfS5cblx0ICogSW50ZXJzZWN0aW9uIGlzIGEgY29tbW9uIHBhcnQgb2YgYm90aCBvZiB0aG9zZSByYW5nZXMuIElmIHJhbmdlcyBoYXMgbm8gY29tbW9uIHBhcnQsIHJldHVybnMgYG51bGxgLlxuXHQgKlxuXHQgKiBFeGFtcGxlczpcblx0ICpcblx0ICogYGBgdHNcblx0ICogbGV0IGZvbyA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVRleHQoICdmb28nICk7XG5cdCAqIGxldCBpbWcgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAnaW1nJyApO1xuXHQgKiBsZXQgYmFyID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlVGV4dCggJ2JhcicgKTtcblx0ICogbGV0IHAgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAncCcsIG51bGwsIFsgZm9vLCBpbWcsIGJhciBdICk7XG5cdCAqXG5cdCAqIGxldCByYW5nZSA9IHZpZXcuY3JlYXRlUmFuZ2UoIHZpZXcuY3JlYXRlUG9zaXRpb25BdCggZm9vLCAyICksIHZpZXcuY3JlYXRlUG9zaXRpb25BdCggYmFyLCAxICk7IC8vIFwib1wiLCBpbWcsIFwiYlwiIGFyZSBpbiByYW5nZS5cblx0ICogbGV0IG90aGVyUmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIGZvbywgMSApLCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoIHAsIDIgKTsgLy8gXCJvb1wiLCBpbWcgYXJlIGluIHJhbmdlLlxuXHQgKiBsZXQgdHJhbnNmb3JtZWQgPSByYW5nZS5nZXRJbnRlcnNlY3Rpb24oIG90aGVyUmFuZ2UgKTsgLy8gcmFuZ2UgZnJvbSAoIGZvbywgMSApIHRvICggcCwgMiApLlxuXHQgKlxuXHQgKiBvdGhlclJhbmdlID0gdmlldy5jcmVhdGVSYW5nZSggdmlldy5jcmVhdGVQb3NpdGlvbkF0KCBiYXIsIDEgKSwgdmlldy5jcmVhdGVQb3NpdGlvbkF0KCBiYXIsIDMgKTsgXCJhclwiIGlzIGluIHJhbmdlLlxuXHQgKiB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldEludGVyc2VjdGlvbiggb3RoZXJSYW5nZSApOyAvLyBudWxsIC0gbm8gY29tbW9uIHBhcnQuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjaGVjayBmb3IgaW50ZXJzZWN0aW9uLlxuXHQgKiBAcmV0dXJucyBBIGNvbW1vbiBwYXJ0IG9mIGdpdmVuIHJhbmdlcyBvciBgbnVsbGAgaWYgcmFuZ2VzIGhhdmUgbm8gY29tbW9uIHBhcnQuXG5cdCAqLyBnZXRJbnRlcnNlY3Rpb24ob3RoZXJSYW5nZSkge1xuICAgICAgICBpZiAodGhpcy5pc0ludGVyc2VjdGluZyhvdGhlclJhbmdlKSkge1xuICAgICAgICAgICAgLy8gUmFuZ2VzIGludGVyc2VjdCwgc28gYSBjb21tb24gcmFuZ2Ugd2lsbCBiZSByZXR1cm5lZC5cbiAgICAgICAgICAgIC8vIEF0IG1vc3QsIGl0IHdpbGwgYmUgc2FtZSBhcyB0aGlzIHJhbmdlLlxuICAgICAgICAgICAgbGV0IGNvbW1vblJhbmdlU3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgICAgICAgICAgbGV0IGNvbW1vblJhbmdlRW5kID0gdGhpcy5lbmQ7XG4gICAgICAgICAgICBpZiAodGhpcy5jb250YWluc1Bvc2l0aW9uKG90aGVyUmFuZ2Uuc3RhcnQpKSB7XG4gICAgICAgICAgICAgICAgLy8gR2l2ZW4gcmFuZ2Ugc3RhcnQgaXMgaW5zaWRlIHRoaXMgcmFuZ2UuIFRoaXMgbWVhbnMgdGhhTnQgd2UgaGF2ZSB0b1xuICAgICAgICAgICAgICAgIC8vIHNocmluayBjb21tb24gcmFuZ2UgdG8gdGhlIGdpdmVuIHJhbmdlIHN0YXJ0LlxuICAgICAgICAgICAgICAgIGNvbW1vblJhbmdlU3RhcnQgPSBvdGhlclJhbmdlLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbnNQb3NpdGlvbihvdGhlclJhbmdlLmVuZCkpIHtcbiAgICAgICAgICAgICAgICAvLyBHaXZlbiByYW5nZSBlbmQgaXMgaW5zaWRlIHRoaXMgcmFuZ2UuIFRoaXMgbWVhbnMgdGhhdCB3ZSBoYXZlIHRvXG4gICAgICAgICAgICAgICAgLy8gc2hyaW5rIGNvbW1vbiByYW5nZSB0byB0aGUgZ2l2ZW4gcmFuZ2UgZW5kLlxuICAgICAgICAgICAgICAgIGNvbW1vblJhbmdlRW5kID0gb3RoZXJSYW5nZS5lbmQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKGNvbW1vblJhbmdlU3RhcnQsIGNvbW1vblJhbmdlRW5kKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSYW5nZXMgZG8gbm90IGludGVyc2VjdCwgc28gdGhleSBkbyBub3QgaGF2ZSBjb21tb24gcGFydC5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90cmVld2Fsa2VyflRyZWVXYWxrZXIgVHJlZVdhbGtlcn0gaW5zdGFuY2Ugd2l0aCB0aGlzIHJhbmdlIGFzIGEgYm91bmRhcnkuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9iamVjdCB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfS5cblx0ICovIGdldFdhbGtlcihvcHRpb25zID0ge30pIHtcbiAgICAgICAgb3B0aW9ucy5ib3VuZGFyaWVzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBUcmVlV2Fsa2VyJDEob3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9ub2Rlfk5vZGV9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fVxuXHQgKiB3aGljaCBpcyBhIGNvbW1vbiBhbmNlc3RvciBvZiByYW5nZSdzIGJvdGggZW5kcyAoaW4gd2hpY2ggdGhlIGVudGlyZSByYW5nZSBpcyBjb250YWluZWQpLlxuXHQgKi8gZ2V0Q29tbW9uQW5jZXN0b3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0LmdldENvbW1vbkFuY2VzdG9yKHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgRWxlbWVudH0gY29udGFpbmVkIGJ5IHRoZSByYW5nZS5cblx0ICogVGhlIGVsZW1lbnQgd2lsbCBiZSByZXR1cm5lZCB3aGVuIGl0IGlzIHRoZSAqKm9ubHkqKiBub2RlIHdpdGhpbiB0aGUgcmFuZ2UgYW5kICoqZnVsbHnigJNjb250YWluZWQqKlxuXHQgKiBhdCB0aGUgc2FtZSB0aW1lLlxuXHQgKi8gZ2V0Q29udGFpbmVkRWxlbWVudCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBub2RlQWZ0ZXJTdGFydCA9IHRoaXMuc3RhcnQubm9kZUFmdGVyO1xuICAgICAgICBsZXQgbm9kZUJlZm9yZUVuZCA9IHRoaXMuZW5kLm5vZGVCZWZvcmU7XG4gICAgICAgIC8vIEhhbmRsZSB0aGUgc2l0dWF0aW9uIHdoZW4gdGhlIHJhbmdlIHBvc2l0aW9uIGlzIGF0IHRoZSBiZWdpbm5pbmcgLyBhdCB0aGUgZW5kIG9mIGEgdGV4dCBub2RlLlxuICAgICAgICAvLyBJbiBzdWNoIHNpdHVhdGlvbiBgLm5vZGVBZnRlcmAgYW5kIGAubm9kZUJlZm9yZWAgYXJlIGBudWxsYCBidXQgdGhlIHJhbmdlIHN0aWxsIG1pZ2h0IGJlIHNwYW5uaW5nXG4gICAgICAgIC8vIG92ZXIgb25lIGVsZW1lbnQuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxwPkZvb3s8c3BhbiBjbGFzcz1cIndpZGdldFwiPjwvc3Bhbj59YmFyPC9wPiB2cyA8cD5Gb29bPHNwYW4gY2xhc3M9XCJ3aWRnZXRcIj48L3NwYW4+XWJhcjwvcD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhlc2UgYXJlIGJhc2ljYWxseSB0aGUgc2FtZSByYW5nZSwgb25seSB0aGUgZGlmZmVyZW5jZSBpcyBpZiB0aGUgcmFuZ2UgcG9zaXRpb24gaXMgYXRcbiAgICAgICAgLy8gYXQgdGhlIGVuZC9hdCB0aGUgYmVnaW5uaW5nIG9mIGEgdGV4dCBub2RlIG9yIGp1c3QgYmVmb3JlL2p1c3QgYWZ0ZXIgdGhlIHRleHQgbm9kZS5cbiAgICAgICAgLy9cbiAgICAgICAgaWYgKHRoaXMuc3RhcnQucGFyZW50LmlzKCckdGV4dCcpICYmIHRoaXMuc3RhcnQuaXNBdEVuZCAmJiB0aGlzLnN0YXJ0LnBhcmVudC5uZXh0U2libGluZykge1xuICAgICAgICAgICAgbm9kZUFmdGVyU3RhcnQgPSB0aGlzLnN0YXJ0LnBhcmVudC5uZXh0U2libGluZztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5lbmQucGFyZW50LmlzKCckdGV4dCcpICYmIHRoaXMuZW5kLmlzQXRTdGFydCAmJiB0aGlzLmVuZC5wYXJlbnQucHJldmlvdXNTaWJsaW5nKSB7XG4gICAgICAgICAgICBub2RlQmVmb3JlRW5kID0gdGhpcy5lbmQucGFyZW50LnByZXZpb3VzU2libGluZztcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZUFmdGVyU3RhcnQgJiYgbm9kZUFmdGVyU3RhcnQuaXMoJ2VsZW1lbnQnKSAmJiBub2RlQWZ0ZXJTdGFydCA9PT0gbm9kZUJlZm9yZUVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGVBZnRlclN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2xvbmVzIHRoaXMgcmFuZ2UuXG5cdCAqLyBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIHRoYXQgaXRlcmF0ZXMgb3ZlciBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtc30gdGhhdCBhcmUgaW4gdGhpcyByYW5nZSBhbmQgcmV0dXJuc1xuXHQgKiB0aGVtLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCB1c2VzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfSB3aXRoIGBib3VuZGFyaWVzYCBzZXQgdG8gdGhpcyByYW5nZSBhbmQgYGlnbm9yZUVsZW1lbnRFbmRgIG9wdGlvblxuXHQgKiBzZXQgdG8gYHRydWVgLiBIb3dldmVyIGl0IHJldHVybnMgb25seSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSBpdGVtc30sXG5cdCAqIG5vdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlclZhbHVlfS5cblx0ICpcblx0ICogWW91IG1heSBzcGVjaWZ5IGFkZGl0aW9uYWwgb3B0aW9ucyBmb3IgdGhlIHRyZWUgd2Fsa2VyLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90cmVld2Fsa2VyflRyZWVXYWxrZXJ9IGZvclxuXHQgKiBhIGZ1bGwgbGlzdCBvZiBhdmFpbGFibGUgb3B0aW9ucy5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgT2JqZWN0IHdpdGggY29uZmlndXJhdGlvbiBvcHRpb25zLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90cmVld2Fsa2VyflRyZWVXYWxrZXJ9LlxuXHQgKi8gKmdldEl0ZW1zKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBvcHRpb25zLmJvdW5kYXJpZXMgPSB0aGlzO1xuICAgICAgICBvcHRpb25zLmlnbm9yZUVsZW1lbnRFbmQgPSB0cnVlO1xuICAgICAgICBjb25zdCB0cmVlV2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIkMShvcHRpb25zKTtcbiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0cmVlV2Fsa2VyKXtcbiAgICAgICAgICAgIHlpZWxkIHZhbHVlLml0ZW07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9uc30gdGhhdCBhcmUgYm91bmRhcmllcyBvclxuXHQgKiBjb250YWluZWQgaW4gdGhpcyByYW5nZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgdXNlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlcn0gd2l0aCBgYm91bmRhcmllc2Agc2V0IHRvIHRoaXMgcmFuZ2UuIEhvd2V2ZXIgaXQgcmV0dXJucyBvbmx5XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb25zfSwgbm90IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWV9LlxuXHQgKlxuXHQgKiBZb3UgbWF5IHNwZWNpZnkgYWRkaXRpb25hbCBvcHRpb25zIGZvciB0aGUgdHJlZSB3YWxrZXIuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlcn0gZm9yXG5cdCAqIGEgZnVsbCBsaXN0IG9mIGF2YWlsYWJsZSBvcHRpb25zLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBjb25maWd1cmF0aW9uIG9wdGlvbnMuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RyZWV3YWxrZXJ+VHJlZVdhbGtlcn0uXG5cdCAqLyAqZ2V0UG9zaXRpb25zKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBvcHRpb25zLmJvdW5kYXJpZXMgPSB0aGlzO1xuICAgICAgICBjb25zdCB0cmVlV2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIkMShvcHRpb25zKTtcbiAgICAgICAgeWllbGQgdHJlZVdhbGtlci5wb3NpdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0cmVlV2Fsa2VyKXtcbiAgICAgICAgICAgIHlpZWxkIHZhbHVlLm5leHRQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGFuZCByZXR1cm5zIHdoZXRoZXIgdGhpcyByYW5nZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHJhbmdlLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIFRydWUgaWYgcmFuZ2VzIGludGVyc2VjdC5cblx0ICovIGlzSW50ZXJzZWN0aW5nKG90aGVyUmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnQuaXNCZWZvcmUob3RoZXJSYW5nZS5lbmQpICYmIHRoaXMuZW5kLmlzQWZ0ZXIob3RoZXJSYW5nZS5zdGFydCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgZnJvbSB0aGUgZ2l2ZW4gcGFyZW50cyBhbmQgb2Zmc2V0cy5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBzdGFydEVsZW1lbnQgU3RhcnQgcG9zaXRpb24gcGFyZW50IGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBzdGFydE9mZnNldCBTdGFydCBwb3NpdGlvbiBvZmZzZXQuXG5cdCAqIEBwYXJhbSBlbmRFbGVtZW50IEVuZCBwb3NpdGlvbiBwYXJlbnQgZWxlbWVudC5cblx0ICogQHBhcmFtIGVuZE9mZnNldCBFbmQgcG9zaXRpb24gb2Zmc2V0LlxuXHQgKiBAcmV0dXJucyBDcmVhdGVkIHJhbmdlLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVGcm9tUGFyZW50c0FuZE9mZnNldHMoc3RhcnRFbGVtZW50LCBzdGFydE9mZnNldCwgZW5kRWxlbWVudCwgZW5kT2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcyhuZXcgUG9zaXRpb24kMShzdGFydEVsZW1lbnQsIHN0YXJ0T2Zmc2V0KSwgbmV3IFBvc2l0aW9uJDEoZW5kRWxlbWVudCwgZW5kT2Zmc2V0KSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHJhbmdlLCBzcHJlYWRpbmcgZnJvbSBzcGVjaWZpZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbn0gdG8gYSBwb3NpdGlvbiBtb3ZlZCBieVxuXHQgKiBnaXZlbiBgc2hpZnRgLiBJZiBgc2hpZnRgIGlzIGEgbmVnYXRpdmUgdmFsdWUsIHNoaWZ0ZWQgcG9zaXRpb24gaXMgdHJlYXRlZCBhcyB0aGUgYmVnaW5uaW5nIG9mIHRoZSByYW5nZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBCZWdpbm5pbmcgb2YgdGhlIHJhbmdlLlxuXHQgKiBAcGFyYW0gc2hpZnQgSG93IGxvbmcgdGhlIHJhbmdlIHNob3VsZCBiZS5cblx0ICovIHN0YXRpYyBfY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQocG9zaXRpb24sIHNoaWZ0KSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gcG9zaXRpb247XG4gICAgICAgIGNvbnN0IGVuZCA9IHBvc2l0aW9uLmdldFNoaWZ0ZWRCeShzaGlmdCk7XG4gICAgICAgIHJldHVybiBzaGlmdCA+IDAgPyBuZXcgdGhpcyhzdGFydCwgZW5kKSA6IG5ldyB0aGlzKGVuZCwgc3RhcnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIGluc2lkZSBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB3aGljaCBzdGFydHMgYmVmb3JlIHRoZSBmaXJzdCBjaGlsZCBvZlxuXHQgKiB0aGF0IGVsZW1lbnQgYW5kIGVuZHMgYWZ0ZXIgdGhlIGxhc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBpcyBhIHBhcmVudCBmb3IgdGhlIHJhbmdlLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVJbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVGcm9tUGFyZW50c0FuZE9mZnNldHMoZWxlbWVudCwgMCwgZWxlbWVudCwgZWxlbWVudC5jaGlsZENvdW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSB0aGF0IHN0YXJ0cyBiZWZvcmUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgZW5kcyBhZnRlciBpdC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBzdGF0aWMgX2NyZWF0ZU9uKGl0ZW0pIHtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IGl0ZW0uaXMoJyR0ZXh0UHJveHknKSA/IGl0ZW0ub2Zmc2V0U2l6ZSA6IDE7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChQb3NpdGlvbiQxLl9jcmVhdGVCZWZvcmUoaXRlbSksIHNpemUpO1xuICAgIH1cbn07XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5SYW5nZSQxLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ3JhbmdlJyB8fCB0eXBlID09PSAndmlldzpyYW5nZSc7XG59O1xuLyoqXG4gKiBGdW5jdGlvbiB1c2VkIGJ5IGdldEVubGFyZ2VkIGFuZCBnZXRUcmltbWVkIG1ldGhvZHMuXG4gKi8gZnVuY3Rpb24gZW5sYXJnZVRyaW1Ta2lwKHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlLml0ZW0uaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSB8fCB2YWx1ZS5pdGVtLmlzKCd1aUVsZW1lbnQnKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyBhbiBhcmJpcnRhcnkgc2VsZWN0aW9uIGluIHRoZSB2aWV3LlxuICogU2VlIGFsc28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbn0uXG4gKlxuICogTmV3IHNlbGVjdGlvbiBpbnN0YW5jZXMgY2FuIGJlIGNyZWF0ZWQgdmlhIHRoZSBjb25zdHJ1Y3RvciBvciBvbmUgdGhlc2UgbWV0aG9kczpcbiAqXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2NyZWF0ZVNlbGVjdGlvbiBgVmlldyNjcmVhdGVTZWxlY3Rpb24oKWB9LFxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXIjY3JlYXRlU2VsZWN0aW9uIGBVcGNhc3RXcml0ZXIjY3JlYXRlU2VsZWN0aW9uKClgfS5cbiAqXG4gKiBBIHNlbGVjdGlvbiBjYW4gY29uc2lzdCBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlIHJhbmdlc30gdGhhdCBjYW4gYmUgc2V0IGJ5IHVzaW5nXG4gKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9uI3NldFRvIGBTZWxlY3Rpb24jc2V0VG8oKWB9IG1ldGhvZC5cbiAqLyBsZXQgU2VsZWN0aW9uJDEgPSBjbGFzcyBTZWxlY3Rpb24gZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKFR5cGVDaGVja2FibGUkMSkge1xuICAgIC8qKlxuXHQgKiBTdG9yZXMgYWxsIHJhbmdlcyB0aGF0IGFyZSBzZWxlY3RlZC5cblx0ICovIF9yYW5nZXM7XG4gICAgLyoqXG5cdCAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBsYXN0IGFkZGVkIHJhbmdlIHdhcyBhZGRlZCBhcyBhIGJhY2t3YXJkIG9yIGZvcndhcmQgcmFuZ2UuXG5cdCAqLyBfbGFzdFJhbmdlQmFja3dhcmQ7XG4gICAgLyoqXG5cdCAqIFNwZWNpZmllcyB3aGV0aGVyIHNlbGVjdGlvbiBpbnN0YW5jZSBpcyBmYWtlLlxuXHQgKi8gX2lzRmFrZTtcbiAgICAvKipcblx0ICogRmFrZSBzZWxlY3Rpb24ncyBsYWJlbC5cblx0ICovIF9mYWtlU2VsZWN0aW9uTGFiZWw7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgbmV3IHNlbGVjdGlvbiBpbnN0YW5jZS5cblx0ICpcblx0ICogKipOb3RlKio6IFRoZSBzZWxlY3Rpb24gY29uc3RydWN0b3IgaXMgYXZhaWxhYmxlIGFzIGEgZmFjdG9yeSBtZXRob2Q6XG5cdCAqXG5cdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY3JlYXRlU2VsZWN0aW9uIGBWaWV3I2NyZWF0ZVNlbGVjdGlvbigpYH0sXG5cdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91cGNhc3R3cml0ZXJ+VXBjYXN0V3JpdGVyI2NyZWF0ZVNlbGVjdGlvbiBgVXBjYXN0V3JpdGVyI2NyZWF0ZVNlbGVjdGlvbigpYH0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIENyZWF0ZXMgZW1wdHkgc2VsZWN0aW9uIHdpdGhvdXQgcmFuZ2VzLlxuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCk7XG5cdCAqXG5cdCAqIC8vIENyZWF0ZXMgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiByYW5nZS5cblx0ICogY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2UgKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHJhbmdlc1xuXHQgKiBjb25zdCByYW5nZXMgPSBbIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcnQxLCBlbmQyICksIHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcjIsIGVuZDIgKSBdO1xuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZXMgKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBzZWxlY3Rpb24gZnJvbSB0aGUgb3RoZXIgc2VsZWN0aW9uLlxuXHQgKiBjb25zdCBvdGhlclNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oKTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggb3RoZXJTZWxlY3Rpb24gKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBzZWxlY3Rpb24gZnJvbSB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uLlxuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqIGNvbnN0IHBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIHBhdGggKTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcG9zaXRpb24gKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiBnaXZlbiBpdGVtIGFuZCBvZmZzZXQuXG5cdCAqIGNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAncGFyYWdyYXBoJyApO1xuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsIG9mZnNldCApO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlXG5cdCAqIC8vIGZpcnN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuXG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHBhcmFncmFwaCwgJ2luJyApO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIGEgcmFuZ2Ugb24gYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gaXRlbX0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgaXRlbSBhbmQgZW5kc1xuXHQgKiAvLyBqdXN0IGFmdGVyIHRoZSBpdGVtLlxuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBwYXJhZ3JhcGgsICdvbicgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIGBTZWxlY3Rpb25gJ3MgY29uc3RydWN0b3IgYWxsb3cgcGFzc2luZyBhZGRpdGlvbmFsIG9wdGlvbnMgKGBiYWNrd2FyZGAsIGBmYWtlYCBhbmQgYGxhYmVsYCkgYXMgdGhlIGxhc3QgYXJndW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIENyZWF0ZXMgYmFja3dhcmQgc2VsZWN0aW9uLlxuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBiYWNrd2FyZDogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBGYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uIG92ZXIgc2VsZWN0ZWQgZWxlbWVudHMgYW5kIGlzIGhpZGRlbiB0byB0aGUgdXNlci5cblx0ICogVGhpcyB3YXksIG5vIG5hdGl2ZSBzZWxlY3Rpb24gVUkgYXJ0aWZhY3RzIGFyZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYW5kIHNlbGVjdGlvbiBvdmVyIGVsZW1lbnRzIGNhbiBiZVxuXHQgKiByZXByZXNlbnRlZCBpbiBvdGhlciB3YXksIGZvciBleGFtcGxlIGJ5IGFwcGx5aW5nIHByb3BlciBDU1MgY2xhc3MuXG5cdCAqXG5cdCAqIEFkZGl0aW9uYWxseSBmYWtlJ3Mgc2VsZWN0aW9uIGxhYmVsIGNhbiBiZSBwcm92aWRlZC4gSXQgd2lsbCBiZSB1c2VkIHRvIGRlc2NyaWJlIGZha2Ugc2VsZWN0aW9uIGluIERPTVxuXHQgKiAoYW5kIGJlICBwcm9wZXJseSBoYW5kbGVkIGJ5IHNjcmVlbiByZWFkZXJzKS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gQ3JlYXRlcyBmYWtlIHNlbGVjdGlvbiB3aXRoIGxhYmVsLlxuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBjb25zdHJ1Y3RvciguLi5hcmdzKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fcmFuZ2VzID0gW107XG4gICAgICAgIHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2lzRmFrZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9mYWtlU2VsZWN0aW9uTGFiZWwgPSAnJztcbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldFRvKC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRydWUgaWYgc2VsZWN0aW9uIGluc3RhbmNlIGlzIG1hcmtlZCBhcyBgZmFrZWAuXG5cdCAqXG5cdCAqIEBzZWUgI3NldFRvXG5cdCAqLyBnZXQgaXNGYWtlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNGYWtlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBmYWtlIHNlbGVjdGlvbiBsYWJlbC5cblx0ICpcblx0ICogQHNlZSAjc2V0VG9cblx0ICovIGdldCBmYWtlU2VsZWN0aW9uTGFiZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mYWtlU2VsZWN0aW9uTGFiZWw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWxlY3Rpb24gYW5jaG9yLiBBbmNob3IgbWF5IGJlIGRlc2NyaWJlZCBhcyBhIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gc3RhcnRzLiBUb2dldGhlciB3aXRoXG5cdCAqIHtAbGluayAjZm9jdXMgZm9jdXN9IHRoZXkgZGVmaW5lIHRoZSBkaXJlY3Rpb24gb2Ygc2VsZWN0aW9uLCB3aGljaCBpcyBpbXBvcnRhbnRcblx0ICogd2hlbiBleHBhbmRpbmcvc2hyaW5raW5nIHNlbGVjdGlvbi4gQW5jaG9yIGlzIGFsd2F5cyB0aGUgc3RhcnQgb3IgZW5kIG9mIHRoZSBtb3N0IHJlY2VudCBhZGRlZCByYW5nZS5cblx0ICogSXQgbWF5IGJlIGEgYml0IHVuaW50dWl0aXZlIHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIHJhbmdlcyBpbiBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEBzZWUgI2ZvY3VzXG5cdCAqLyBnZXQgYW5jaG9yKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3Jhbmdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJhbmdlID0gdGhpcy5fcmFuZ2VzW3RoaXMuX3Jhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgY29uc3QgYW5jaG9yID0gdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPyByYW5nZS5lbmQgOiByYW5nZS5zdGFydDtcbiAgICAgICAgcmV0dXJuIGFuY2hvci5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2VsZWN0aW9uIGZvY3VzLiBGb2N1cyBpcyBhIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gZW5kcy5cblx0ICpcblx0ICogQHNlZSAjYW5jaG9yXG5cdCAqLyBnZXQgZm9jdXMoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcmFuZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLl9yYW5nZXNbdGhpcy5fcmFuZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBmb2N1cyA9IHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkID8gcmFuZ2Uuc3RhcnQgOiByYW5nZS5lbmQ7XG4gICAgICAgIHJldHVybiBmb2N1cy5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB3aGV0aGVyIHRoZSBzZWxlY3Rpb24gaXMgY29sbGFwc2VkLiBTZWxlY3Rpb24gaXMgY29sbGFwc2VkIHdoZW4gdGhlcmUgaXMgZXhhY3RseSBvbmUgcmFuZ2Ugd2hpY2ggaXNcblx0ICogY29sbGFwc2VkLlxuXHQgKi8gZ2V0IGlzQ29sbGFwc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yYW5nZUNvdW50ID09PSAxICYmIHRoaXMuX3Jhbmdlc1swXS5pc0NvbGxhcHNlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgbnVtYmVyIG9mIHJhbmdlcyBpbiBzZWxlY3Rpb24uXG5cdCAqLyBnZXQgcmFuZ2VDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jhbmdlcy5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUge0BsaW5rICNmb2N1c30gcHJlY2VkZXMge0BsaW5rICNhbmNob3J9LlxuXHQgKi8gZ2V0IGlzQmFja3dhcmQoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5pc0NvbGxhcHNlZCAmJiB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudCBFZGl0YWJsZUVsZW1lbnR9IGluc3RhbmNlIHRoYXQgY29udGFpbnMgdGhpcyBzZWxlY3Rpb24sIG9yIGBudWxsYFxuXHQgKiBpZiB0aGUgc2VsZWN0aW9uIGlzIG5vdCBpbnNpZGUgYW4gZWRpdGFibGUgZWxlbWVudC5cblx0ICovIGdldCBlZGl0YWJsZUVsZW1lbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLmFuY2hvcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9yLmVkaXRhYmxlRWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmFibGUgdGhhdCBjb250YWlucyBjb3BpZXMgb2YgYWxsIHJhbmdlcyBhZGRlZCB0byB0aGUgc2VsZWN0aW9uLlxuXHQgKi8gKmdldFJhbmdlcygpIHtcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLl9yYW5nZXMpe1xuICAgICAgICAgICAgeWllbGQgcmFuZ2UuY2xvbmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjb3B5IG9mIHRoZSBmaXJzdCByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLiBGaXJzdCByYW5nZSBpcyB0aGUgb25lIHdoaWNoXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNCZWZvcmUgaXMgYmVmb3JlfSBzdGFydFxuXHQgKiBwb3NpdGlvbiBvZiBhbGwgb3RoZXIgcmFuZ2VzIChub3QgdG8gY29uZnVzZSB3aXRoIHRoZSBmaXJzdCByYW5nZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uKS5cblx0ICogUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uXG5cdCAqLyBnZXRGaXJzdFJhbmdlKCkge1xuICAgICAgICBsZXQgZmlyc3QgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHRoaXMuX3Jhbmdlcyl7XG4gICAgICAgICAgICBpZiAoIWZpcnN0IHx8IHJhbmdlLnN0YXJ0LmlzQmVmb3JlKGZpcnN0LnN0YXJ0KSkge1xuICAgICAgICAgICAgICAgIGZpcnN0ID0gcmFuZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpcnN0ID8gZmlyc3QuY2xvbmUoKSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGxhc3QgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbi4gTGFzdCByYW5nZSBpcyB0aGUgb25lIHdoaWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH1cblx0ICogcG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNpc0FmdGVyIGlzIGFmdGVyfSBlbmQgcG9zaXRpb24gb2YgYWxsIG90aGVyIHJhbmdlcyAobm90IHRvIGNvbmZ1c2Vcblx0ICogd2l0aCB0aGUgbGFzdCByYW5nZSBhZGRlZCB0byB0aGUgc2VsZWN0aW9uKS4gUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uXG5cdCAqLyBnZXRMYXN0UmFuZ2UoKSB7XG4gICAgICAgIGxldCBsYXN0ID0gbnVsbDtcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLl9yYW5nZXMpe1xuICAgICAgICAgICAgaWYgKCFsYXN0IHx8IHJhbmdlLmVuZC5pc0FmdGVyKGxhc3QuZW5kKSkge1xuICAgICAgICAgICAgICAgIGxhc3QgPSByYW5nZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGFzdCA/IGxhc3QuY2xvbmUoKSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGZpcnN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uIEZpcnN0IHBvc2l0aW9uIGlzIHRoZSBwb3NpdGlvbiB0aGF0XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNCZWZvcmUgaXMgYmVmb3JlfSBhbnkgb3RoZXIgcG9zaXRpb24gaW4gdGhlIHNlbGVjdGlvbiByYW5nZXMuXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0Rmlyc3RQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3QgZmlyc3RSYW5nZSA9IHRoaXMuZ2V0Rmlyc3RSYW5nZSgpO1xuICAgICAgICByZXR1cm4gZmlyc3RSYW5nZSA/IGZpcnN0UmFuZ2Uuc3RhcnQuY2xvbmUoKSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGxhc3QgcG9zaXRpb24gaW4gdGhlIHNlbGVjdGlvbi4gTGFzdCBwb3NpdGlvbiBpcyB0aGUgcG9zaXRpb24gdGhhdFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI2lzQWZ0ZXIgaXMgYWZ0ZXJ9IGFueSBvdGhlciBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uIHJhbmdlcy5cblx0ICogUmV0dXJucyBgbnVsbGAgaWYgbm8gcmFuZ2VzIGFyZSBhZGRlZCB0byBzZWxlY3Rpb24uXG5cdCAqLyBnZXRMYXN0UG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGxhc3RSYW5nZSA9IHRoaXMuZ2V0TGFzdFJhbmdlKCk7XG4gICAgICAgIHJldHVybiBsYXN0UmFuZ2UgPyBsYXN0UmFuZ2UuZW5kLmNsb25lKCkgOiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIsIHRoaXMgc2VsZWN0aW9uIGlzIGVxdWFsIHRvIGdpdmVuIHNlbGVjdGlvbi4gU2VsZWN0aW9ucyBhcmUgZXF1YWwgaWYgdGhleSBoYXZlIHNhbWUgZGlyZWN0aW9ucyxcblx0ICogc2FtZSBudW1iZXIgb2YgcmFuZ2VzIGFuZCBhbGwgcmFuZ2VzIGZyb20gb25lIHNlbGVjdGlvbiBlcXVhbCB0byBhIHJhbmdlIGZyb20gb3RoZXIgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJTZWxlY3Rpb24gU2VsZWN0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIHNlbGVjdGlvbnMgYXJlIGVxdWFsLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGlzRXF1YWwob3RoZXJTZWxlY3Rpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuaXNGYWtlICE9IG90aGVyU2VsZWN0aW9uLmlzRmFrZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzRmFrZSAmJiB0aGlzLmZha2VTZWxlY3Rpb25MYWJlbCAhPSBvdGhlclNlbGVjdGlvbi5mYWtlU2VsZWN0aW9uTGFiZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yYW5nZUNvdW50ICE9IG90aGVyU2VsZWN0aW9uLnJhbmdlQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJhbmdlQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5hbmNob3IuaXNFcXVhbChvdGhlclNlbGVjdGlvbi5hbmNob3IpIHx8ICF0aGlzLmZvY3VzLmlzRXF1YWwob3RoZXJTZWxlY3Rpb24uZm9jdXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0aGlzUmFuZ2Ugb2YgdGhpcy5fcmFuZ2VzKXtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBvdGhlclJhbmdlIG9mIG90aGVyU2VsZWN0aW9uLl9yYW5nZXMpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzUmFuZ2UuaXNFcXVhbChvdGhlclJhbmdlKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHNlbGVjdGlvbiBpcyBzaW1pbGFyIHRvIGdpdmVuIHNlbGVjdGlvbi4gU2VsZWN0aW9ucyBhcmUgc2ltaWxhciBpZiB0aGV5IGhhdmUgc2FtZSBkaXJlY3Rpb25zLCBzYW1lXG5cdCAqIG51bWJlciBvZiByYW5nZXMsIGFuZCBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNnZXRUcmltbWVkIHRyaW1tZWR9IHJhbmdlcyBmcm9tIG9uZSBzZWxlY3Rpb24gYXJlXG5cdCAqIGVxdWFsIHRvIGFueSB0cmltbWVkIHJhbmdlIGZyb20gb3RoZXIgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJTZWxlY3Rpb24gU2VsZWN0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIHNlbGVjdGlvbnMgYXJlIHNpbWlsYXIsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gaXNTaW1pbGFyKG90aGVyU2VsZWN0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQmFja3dhcmQgIT0gb3RoZXJTZWxlY3Rpb24uaXNCYWNrd2FyZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG51bU9mUmFuZ2VzQSA9IGNvdW50KHRoaXMuZ2V0UmFuZ2VzKCkpO1xuICAgICAgICBjb25zdCBudW1PZlJhbmdlc0IgPSBjb3VudChvdGhlclNlbGVjdGlvbi5nZXRSYW5nZXMoKSk7XG4gICAgICAgIC8vIElmIHNlbGVjdGlvbnMgaGF2ZSBkaWZmZXJlbnQgbnVtYmVyIG9mIHJhbmdlcywgdGhleSBjYW5ub3QgYmUgc2ltaWxhci5cbiAgICAgICAgaWYgKG51bU9mUmFuZ2VzQSAhPSBudW1PZlJhbmdlc0IpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBib3RoIHNlbGVjdGlvbnMgaGF2ZSBubyByYW5nZXMsIHRoZXkgYXJlIHNpbWlsYXIuXG4gICAgICAgIGlmIChudW1PZlJhbmdlc0EgPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgaWYgZWFjaCByYW5nZSBpbiBvbmUgc2VsZWN0aW9uIGhhcyBhIHNpbWlsYXIgcmFuZ2UgaW4gb3RoZXIgc2VsZWN0aW9uLlxuICAgICAgICBmb3IgKGxldCByYW5nZUEgb2YgdGhpcy5nZXRSYW5nZXMoKSl7XG4gICAgICAgICAgICByYW5nZUEgPSByYW5nZUEuZ2V0VHJpbW1lZCgpO1xuICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGxldCByYW5nZUIgb2Ygb3RoZXJTZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAgICAgICAgIHJhbmdlQiA9IHJhbmdlQi5nZXRUcmltbWVkKCk7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmdlQS5zdGFydC5pc0VxdWFsKHJhbmdlQi5zdGFydCkgJiYgcmFuZ2VBLmVuZC5pc0VxdWFsKHJhbmdlQi5lbmQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRm9yIGByYW5nZUFgLCBuZWl0aGVyIHJhbmdlIGluIGBvdGhlclNlbGVjdGlvbmAgd2FzIHNpbWlsYXIuIFNvIHNlbGVjdGlvbnMgYXJlIG5vdCBzaW1pbGFyLlxuICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBUaGVyZSB3ZXJlIG5vIHJhbmdlcyB0aGF0IHdlcmVuJ3QgbWF0Y2hlZC4gU2VsZWN0aW9ucyBhcmUgc2ltaWxhci5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBzZWxlY3RlZCBlbGVtZW50LiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBFbGVtZW50fSBpcyBjb25zaWRlcmVkIGFzIHNlbGVjdGVkIGlmIHRoZXJlIGlzIG9ubHlcblx0ICogb25lIHJhbmdlIGluIHRoZSBzZWxlY3Rpb24sIGFuZCB0aGF0IHJhbmdlIGNvbnRhaW5zIGV4YWN0bHkgb25lIGVsZW1lbnQuXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHNlbGVjdGVkIGVsZW1lbnQuXG5cdCAqLyBnZXRTZWxlY3RlZEVsZW1lbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnJhbmdlQ291bnQgIT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpcnN0UmFuZ2UoKS5nZXRDb250YWluZWRFbGVtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHRoaXMgc2VsZWN0aW9uJ3MgcmFuZ2VzIGFuZCBkaXJlY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbiBiYXNlZCBvbiB0aGUgZ2l2ZW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0YWJsZSBzZWxlY3RhYmxlfS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gU2V0cyBzZWxlY3Rpb24gdG8gdGhlIGdpdmVuIHJhbmdlLlxuXHQgKiBjb25zdCByYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSggc3RhcnQsIGVuZCApO1xuXHQgKiBzZWxlY3Rpb24uc2V0VG8oIHJhbmdlICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgc2VsZWN0aW9uIHRvIGdpdmVuIHJhbmdlcy5cblx0ICogY29uc3QgcmFuZ2VzID0gWyB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0MSwgZW5kMiApLCB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXIyLCBlbmQyICkgXTtcblx0ICogc2VsZWN0aW9uLnNldFRvKCByYW5nZSApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiB0byB0aGUgb3RoZXIgc2VsZWN0aW9uLlxuXHQgKiBjb25zdCBvdGhlclNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oKTtcblx0ICogc2VsZWN0aW9uLnNldFRvKCBvdGhlclNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiB0byBjb250ZW50cyBvZiBEb2N1bWVudFNlbGVjdGlvbi5cblx0ICogc2VsZWN0aW9uLnNldFRvKCBlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIGNvbGxhcHNlZCBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHBvc2l0aW9uLlxuXHQgKiBjb25zdCBwb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCByb290LCBwYXRoICk7XG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcG9zaXRpb24gKTtcblx0ICpcblx0ICogLy8gU2V0cyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiBnaXZlbiBpdGVtIGFuZCBvZmZzZXQuXG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcGFyYWdyYXBoLCBvZmZzZXQgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3QgY2hpbGQgb2Zcblx0ICogdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2VsZWN0aW9uLnNldFRvKCBwYXJhZ3JhcGgsICdpbicgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSBvbiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSBpdGVtfSB3aGljaCBzdGFydHMgYmVmb3JlIHRoZSBpdGVtIGFuZCBlbmRzIGp1c3QgYWZ0ZXIgdGhlIGl0ZW0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcGFyYWdyYXBoLCAnb24nICk7XG5cdCAqXG5cdCAqIC8vIENsZWFycyBzZWxlY3Rpb24uIFJlbW92ZXMgYWxsIHJhbmdlcy5cblx0ICogc2VsZWN0aW9uLnNldFRvKCBudWxsICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBgU2VsZWN0aW9uI3NldFRvKClgIG1ldGhvZCBhbGxvdyBwYXNzaW5nIGFkZGl0aW9uYWwgb3B0aW9ucyAoYGJhY2t3YXJkYCwgYGZha2VgIGFuZCBgbGFiZWxgKSBhcyB0aGUgbGFzdCBhcmd1bWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gU2V0cyBzZWxlY3Rpb24gYXMgYmFja3dhcmQuXG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcmFuZ2UsIHsgYmFja3dhcmQ6IHRydWUgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogRmFrZSBzZWxlY3Rpb24gZG9lcyBub3QgcmVuZGVyIGFzIGJyb3dzZXIgbmF0aXZlIHNlbGVjdGlvbiBvdmVyIHNlbGVjdGVkIGVsZW1lbnRzIGFuZCBpcyBoaWRkZW4gdG8gdGhlIHVzZXIuXG5cdCAqIFRoaXMgd2F5LCBubyBuYXRpdmUgc2VsZWN0aW9uIFVJIGFydGlmYWN0cyBhcmUgZGlzcGxheWVkIHRvIHRoZSB1c2VyIGFuZCBzZWxlY3Rpb24gb3ZlciBlbGVtZW50cyBjYW4gYmVcblx0ICogcmVwcmVzZW50ZWQgaW4gb3RoZXIgd2F5LCBmb3IgZXhhbXBsZSBieSBhcHBseWluZyBwcm9wZXIgQ1NTIGNsYXNzLlxuXHQgKlxuXHQgKiBBZGRpdGlvbmFsbHkgZmFrZSdzIHNlbGVjdGlvbiBsYWJlbCBjYW4gYmUgcHJvdmlkZWQuIEl0IHdpbGwgYmUgdXNlZCB0byBkZXNjcmliZSBmYWtlIHNlbGVjdGlvbiBpbiBET01cblx0ICogKGFuZCBiZSAgcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIENyZWF0ZXMgZmFrZSBzZWxlY3Rpb24gd2l0aCBsYWJlbC5cblx0ICogc2VsZWN0aW9uLnNldFRvKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKi8gc2V0VG8oLi4uYXJncykge1xuICAgICAgICBsZXQgW3NlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQsIG9wdGlvbnNdID0gYXJncztcbiAgICAgICAgaWYgKHR5cGVvZiBwbGFjZU9yT2Zmc2V0ID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gcGxhY2VPck9mZnNldDtcbiAgICAgICAgICAgIHBsYWNlT3JPZmZzZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdGFibGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldFJhbmdlcyhbXSk7XG4gICAgICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgU2VsZWN0aW9uIHx8IHNlbGVjdGFibGUgaW5zdGFuY2VvZiBEb2N1bWVudFNlbGVjdGlvbiQxKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoc2VsZWN0YWJsZS5nZXRSYW5nZXMoKSwgc2VsZWN0YWJsZS5pc0JhY2t3YXJkKTtcbiAgICAgICAgICAgIHRoaXMuX3NldEZha2VPcHRpb25zKHtcbiAgICAgICAgICAgICAgICBmYWtlOiBzZWxlY3RhYmxlLmlzRmFrZSxcbiAgICAgICAgICAgICAgICBsYWJlbDogc2VsZWN0YWJsZS5mYWtlU2VsZWN0aW9uTGFiZWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGFibGUgaW5zdGFuY2VvZiBSYW5nZSQxKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW1xuICAgICAgICAgICAgICAgIHNlbGVjdGFibGVcbiAgICAgICAgICAgIF0sIG9wdGlvbnMgJiYgb3B0aW9ucy5iYWNrd2FyZCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUG9zaXRpb24kMSkge1xuICAgICAgICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtcbiAgICAgICAgICAgICAgICBuZXcgUmFuZ2UkMShzZWxlY3RhYmxlKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgTm9kZSQyKSB7XG4gICAgICAgICAgICBjb25zdCBiYWNrd2FyZCA9ICEhb3B0aW9ucyAmJiAhIW9wdGlvbnMuYmFja3dhcmQ7XG4gICAgICAgICAgICBsZXQgcmFuZ2U7XG4gICAgICAgICAgICBpZiAocGxhY2VPck9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIHNlbGVjdGlvbi5zZXRUbyByZXF1aXJlcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSBub2RlLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3Igdmlldy1zZWxlY3Rpb24tc2V0dG8tcmVxdWlyZWQtc2Vjb25kLXBhcmFtZXRlclxuXHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctc2VsZWN0aW9uLXNldHRvLXJlcXVpcmVkLXNlY29uZC1wYXJhbWV0ZXInLCB0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCA9PSAnaW4nKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBSYW5nZSQxLl9jcmVhdGVJbihzZWxlY3RhYmxlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCA9PSAnb24nKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBSYW5nZSQxLl9jcmVhdGVPbihzZWxlY3RhYmxlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBuZXcgUmFuZ2UkMShQb3NpdGlvbiQxLl9jcmVhdGVBdChzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW1xuICAgICAgICAgICAgICAgIHJhbmdlXG4gICAgICAgICAgICBdLCBiYWNrd2FyZCk7XG4gICAgICAgICAgICB0aGlzLl9zZXRGYWtlT3B0aW9ucyhvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIGlmIChpc0l0ZXJhYmxlKHNlbGVjdGFibGUpKSB7XG4gICAgICAgICAgICAvLyBXZSBhc3N1bWUgdGhhdCB0aGUgc2VsZWN0YWJsZSBpcyBhbiBpdGVyYWJsZSBvZiByYW5nZXMuXG4gICAgICAgICAgICAvLyBBcnJheS5mcm9tKCkgaXMgdXNlZCB0byBwcmV2ZW50IHNldHRpbmcgcmFuZ2VzIHRvIHRoZSBvbGQgaXRlcmFibGVcbiAgICAgICAgICAgIHRoaXMuX3NldFJhbmdlcyhzZWxlY3RhYmxlLCBvcHRpb25zICYmIG9wdGlvbnMuYmFja3dhcmQpO1xuICAgICAgICAgICAgdGhpcy5fc2V0RmFrZU9wdGlvbnMob3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBzZXQgc2VsZWN0aW9uIHRvIGdpdmVuIHBsYWNlLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXR0by1ub3Qtc2VsZWN0YWJsZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1zZXR0by1ub3Qtc2VsZWN0YWJsZScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyB7QGxpbmsgI2ZvY3VzfSB0byB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uLlxuXHQgKlxuXHQgKiBUaGUgbG9jYXRpb24gY2FuIGJlIHNwZWNpZmllZCBpbiB0aGUgc2FtZSBmb3JtIGFzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2NyZWF0ZVBvc2l0aW9uQXQgdmlldy5jcmVhdGVQb3NpdGlvbkF0KCl9XG5cdCAqIHBhcmFtZXRlcnMuXG5cdCAqXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfS5cblx0ICovIHNldEZvY3VzKGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuYW5jaG9yID09PSBudWxsKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBzZXQgc2VsZWN0aW9uIGZvY3VzIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXNlbGVjdGlvbi1zZXRmb2N1cy1uby1yYW5nZXNcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1zZWxlY3Rpb24tc2V0Zm9jdXMtbm8tcmFuZ2VzJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3Rm9jdXMgPSBQb3NpdGlvbiQxLl9jcmVhdGVBdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgaWYgKG5ld0ZvY3VzLmNvbXBhcmVXaXRoKHRoaXMuZm9jdXMpID09ICdzYW1lJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFuY2hvciA9IHRoaXMuYW5jaG9yO1xuICAgICAgICB0aGlzLl9yYW5nZXMucG9wKCk7XG4gICAgICAgIGlmIChuZXdGb2N1cy5jb21wYXJlV2l0aChhbmNob3IpID09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRSYW5nZShuZXcgUmFuZ2UkMShuZXdGb2N1cywgYW5jaG9yKSwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRSYW5nZShuZXcgUmFuZ2UkMShhbmNob3IsIG5ld0ZvY3VzKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlcGxhY2VzIGFsbCByYW5nZXMgdGhhdCB3ZXJlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24gd2l0aCBnaXZlbiBhcnJheSBvZiByYW5nZXMuIExhc3QgcmFuZ2Ugb2YgdGhlIGFycmF5XG5cdCAqIGlzIHRyZWF0ZWQgbGlrZSB0aGUgbGFzdCBhZGRlZCByYW5nZSBhbmQgaXMgdXNlZCB0byBzZXQge0BsaW5rICNhbmNob3IgYW5jaG9yfSBhbmQge0BsaW5rICNmb2N1cyBmb2N1c30uXG5cdCAqIEFjY2VwdHMgYSBmbGFnIGRlc2NyaWJpbmcgaW4gd2hpY2ggd2F5IHRoZSBzZWxlY3Rpb24gaXMgbWFkZS5cblx0ICpcblx0ICogQHBhcmFtIG5ld1JhbmdlcyBJdGVyYWJsZSBvYmplY3Qgb2YgcmFuZ2VzIHRvIHNldC5cblx0ICogQHBhcmFtIGlzTGFzdEJhY2t3YXJkIEZsYWcgZGVzY3JpYmluZyBpZiBsYXN0IGFkZGVkIHJhbmdlIHdhcyBzZWxlY3RlZCBmb3J3YXJkIC0gZnJvbSBzdGFydCB0byBlbmRcblx0ICogKGBmYWxzZWApIG9yIGJhY2t3YXJkIC0gZnJvbSBlbmQgdG8gc3RhcnQgKGB0cnVlYCkuIERlZmF1bHRzIHRvIGBmYWxzZWAuXG5cdCAqLyBfc2V0UmFuZ2VzKG5ld1JhbmdlcywgaXNMYXN0QmFja3dhcmQgPSBmYWxzZSkge1xuICAgICAgICAvLyBOZXcgcmFuZ2VzIHNob3VsZCBiZSBjb3BpZWQgdG8gcHJldmVudCByZW1vdmluZyB0aGVtIGJ5IHNldHRpbmcgdGhlbSB0byBgW11gIGZpcnN0LlxuICAgICAgICAvLyBPbmx5IGFwcGxpZXMgdG8gc2l0dWF0aW9ucyB3aGVuIHNlbGVjdGlvbiBpcyBzZXQgdG8gdGhlIHNhbWUgc2VsZWN0aW9uIG9yIHNhbWUgc2VsZWN0aW9uJ3MgcmFuZ2VzLlxuICAgICAgICBuZXdSYW5nZXMgPSBBcnJheS5mcm9tKG5ld1Jhbmdlcyk7XG4gICAgICAgIHRoaXMuX3JhbmdlcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIG5ld1Jhbmdlcyl7XG4gICAgICAgICAgICB0aGlzLl9hZGRSYW5nZShyYW5nZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPSAhIWlzTGFzdEJhY2t3YXJkO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB0aGlzIHNlbGVjdGlvbiBpbnN0YW5jZSB0byBiZSBtYXJrZWQgYXMgYGZha2VgLiBBIGZha2Ugc2VsZWN0aW9uIGRvZXMgbm90IHJlbmRlciBhcyBicm93c2VyIG5hdGl2ZSBzZWxlY3Rpb25cblx0ICogb3ZlciBzZWxlY3RlZCBlbGVtZW50cyBhbmQgaXMgaGlkZGVuIHRvIHRoZSB1c2VyLiBUaGlzIHdheSwgbm8gbmF0aXZlIHNlbGVjdGlvbiBVSSBhcnRpZmFjdHMgYXJlIGRpc3BsYXllZCB0b1xuXHQgKiB0aGUgdXNlciBhbmQgc2VsZWN0aW9uIG92ZXIgZWxlbWVudHMgY2FuIGJlIHJlcHJlc2VudGVkIGluIG90aGVyIHdheSwgZm9yIGV4YW1wbGUgYnkgYXBwbHlpbmcgcHJvcGVyIENTUyBjbGFzcy5cblx0ICpcblx0ICogQWRkaXRpb25hbGx5IGZha2UncyBzZWxlY3Rpb24gbGFiZWwgY2FuIGJlIHByb3ZpZGVkLiBJdCB3aWxsIGJlIHVzZWQgdG8gZGVzY3JpYmUgZmFrZSBzZWxlY3Rpb24gaW4gRE9NIChhbmQgYmVcblx0ICogcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuXG5cdCAqLyBfc2V0RmFrZU9wdGlvbnMob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuX2lzRmFrZSA9ICEhb3B0aW9ucy5mYWtlO1xuICAgICAgICB0aGlzLl9mYWtlU2VsZWN0aW9uTGFiZWwgPSBvcHRpb25zLmZha2UgPyBvcHRpb25zLmxhYmVsIHx8ICcnIDogJyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBZGRzIGEgcmFuZ2UgdG8gdGhlIHNlbGVjdGlvbi4gQWRkZWQgcmFuZ2UgaXMgY29waWVkLiBUaGlzIG1lYW5zIHRoYXQgcGFzc2VkIHJhbmdlIGlzIG5vdCBzYXZlZCBpbiB0aGVcblx0ICogc2VsZWN0aW9uIGluc3RhbmNlIGFuZCB5b3UgY2FuIHNhZmVseSBvcGVyYXRlIG9uIGl0LlxuXHQgKlxuXHQgKiBBY2NlcHRzIGEgZmxhZyBkZXNjcmliaW5nIGluIHdoaWNoIHdheSB0aGUgc2VsZWN0aW9uIGlzIG1hZGUgLSBwYXNzZWQgcmFuZ2UgbWlnaHQgYmUgc2VsZWN0ZWQgZnJvbVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fSB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9XG5cdCAqIG9yIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgZW5kfSB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fS5cblx0ICogVGhlIGZsYWcgaXMgdXNlZCB0byBzZXQge0BsaW5rICNhbmNob3IgYW5jaG9yfSBhbmQge0BsaW5rICNmb2N1cyBmb2N1c30gcHJvcGVydGllcy5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGB2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzYCBpZiBhZGRlZCByYW5nZSBpbnRlcnNlY3RzXG5cdCAqIHdpdGggcmFuZ2VzIGFscmVhZHkgc3RvcmVkIGluIFNlbGVjdGlvbiBpbnN0YW5jZS5cblx0ICovIF9hZGRSYW5nZShyYW5nZSwgaXNCYWNrd2FyZCA9IGZhbHNlKSB7XG4gICAgICAgIGlmICghKHJhbmdlIGluc3RhbmNlb2YgUmFuZ2UkMSkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogU2VsZWN0aW9uIHJhbmdlIHNldCB0byBhbiBvYmplY3QgdGhhdCBpcyBub3QgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZX0uXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctc2VsZWN0aW9uLWFkZC1yYW5nZS1ub3QtcmFuZ2Vcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1zZWxlY3Rpb24tYWRkLXJhbmdlLW5vdC1yYW5nZScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3B1c2hSYW5nZShyYW5nZSk7XG4gICAgICAgIHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkID0gISFpc0JhY2t3YXJkO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyByYW5nZSB0byBzZWxlY3Rpb24gLSBjcmVhdGVzIGNvcHkgb2YgZ2l2ZW4gcmFuZ2Ugc28gaXQgY2FuIGJlIHNhZmVseSB1c2VkIGFuZCBtb2RpZmllZC5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGB2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzYCBpZiBhZGRlZCByYW5nZSBpbnRlcnNlY3RzXG5cdCAqIHdpdGggcmFuZ2VzIGFscmVhZHkgc3RvcmVkIGluIHNlbGVjdGlvbiBpbnN0YW5jZS5cblx0ICovIF9wdXNoUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgZm9yIChjb25zdCBzdG9yZWRSYW5nZSBvZiB0aGlzLl9yYW5nZXMpe1xuICAgICAgICAgICAgaWYgKHJhbmdlLmlzSW50ZXJzZWN0aW5nKHN0b3JlZFJhbmdlKSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUcnlpbmcgdG8gYWRkIGEgcmFuZ2UgdGhhdCBpbnRlcnNlY3RzIHdpdGggYW5vdGhlciByYW5nZSBmcm9tIHNlbGVjdGlvbi5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIHZpZXctc2VsZWN0aW9uLXJhbmdlLWludGVyc2VjdHNcblx0XHRcdFx0ICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IGFkZGVkUmFuZ2UgUmFuZ2UgdGhhdCB3YXMgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbi5cblx0XHRcdFx0ICogQHBhcmFtIHttb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9IGludGVyc2VjdGluZ1JhbmdlIFJhbmdlIGZyb20gc2VsZWN0aW9uIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGBhZGRlZFJhbmdlYC5cblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzJywgdGhpcywge1xuICAgICAgICAgICAgICAgICAgICBhZGRlZFJhbmdlOiByYW5nZSxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0aW5nUmFuZ2U6IHN0b3JlZFJhbmdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmFuZ2VzLnB1c2gobmV3IFJhbmdlJDEocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCkpO1xuICAgIH1cbn07XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5TZWxlY3Rpb24kMS5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09ICdzZWxlY3Rpb24nIHx8IHR5cGUgPT09ICd2aWV3OnNlbGVjdGlvbic7XG59O1xuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIGluIHRoZSB2aWV3LlxuICpcbiAqIEl0cyBpbnN0YW5jZSBpcyBhdmFpbGFibGUgaW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNzZWxlY3Rpb24gYERvY3VtZW50I3NlbGVjdGlvbmB9LlxuICpcbiAqIEl0IGlzIHNpbWlsYXIgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9zZWxlY3Rpb25+U2VsZWN0aW9ufSBidXRcbiAqIGl0IGhhcyBhIHJlYWQtb25seSBBUEkgYW5kIGNhbiBiZSBtb2RpZmllZCBvbmx5IGJ5IHRoZSB3cml0ZXIgYXZhaWxhYmxlIGluXG4gKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY2hhbmdlIGBWaWV3I2NoYW5nZSgpYH0gYmxvY2tcbiAqIChzbyB2aWEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNzZXRTZWxlY3Rpb24gYERvd25jYXN0V3JpdGVyI3NldFNlbGVjdGlvbigpYH0pLlxuICovIGxldCBEb2N1bWVudFNlbGVjdGlvbiQxID0gY2xhc3MgRG9jdW1lbnRTZWxlY3Rpb24gZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKFR5cGVDaGVja2FibGUkMSkge1xuICAgIC8qKlxuXHQgKiBTZWxlY3Rpb24gaXMgdXNlZCBpbnRlcm5hbGx5IChgRG9jdW1lbnRTZWxlY3Rpb25gIGlzIGEgcHJveHkgdG8gdGhhdCBzZWxlY3Rpb24pLlxuXHQgKi8gX3NlbGVjdGlvbjtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uID0gbmV3IFNlbGVjdGlvbiQxKCk7XG4gICAgICAgIC8vIERlbGVnYXRlIGNoYW5nZSBldmVudCB0byBiZSBmaXJlZCBvbiBEb2N1bWVudFNlbGVjdGlvbiBpbnN0YW5jZS5cbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uLmRlbGVnYXRlKCdjaGFuZ2UnKS50byh0aGlzKTtcbiAgICAgICAgLy8gU2V0IHNlbGVjdGlvbiBkYXRhLlxuICAgICAgICBpZiAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGlvbi5zZXRUbyguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0cnVlIGlmIHNlbGVjdGlvbiBpbnN0YW5jZSBpcyBtYXJrZWQgYXMgYGZha2VgLlxuXHQgKlxuXHQgKiBAc2VlICNfc2V0VG9cblx0ICovIGdldCBpc0Zha2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uaXNGYWtlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBmYWtlIHNlbGVjdGlvbiBsYWJlbC5cblx0ICpcblx0ICogQHNlZSAjX3NldFRvXG5cdCAqLyBnZXQgZmFrZVNlbGVjdGlvbkxhYmVsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmZha2VTZWxlY3Rpb25MYWJlbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlbGVjdGlvbiBhbmNob3IuIEFuY2hvciBtYXkgYmUgZGVzY3JpYmVkIGFzIGEgcG9zaXRpb24gd2hlcmUgdGhlIHNlbGVjdGlvbiBzdGFydHMuIFRvZ2V0aGVyIHdpdGhcblx0ICoge0BsaW5rICNmb2N1cyBmb2N1c30gdGhleSBkZWZpbmUgdGhlIGRpcmVjdGlvbiBvZiBzZWxlY3Rpb24sIHdoaWNoIGlzIGltcG9ydGFudFxuXHQgKiB3aGVuIGV4cGFuZGluZy9zaHJpbmtpbmcgc2VsZWN0aW9uLiBBbmNob3IgaXMgYWx3YXlzIHRoZSBzdGFydCBvciBlbmQgb2YgdGhlIG1vc3QgcmVjZW50IGFkZGVkIHJhbmdlLlxuXHQgKiBJdCBtYXkgYmUgYSBiaXQgdW5pbnR1aXRpdmUgd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGUgcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICpcblx0ICogQHNlZSAjZm9jdXNcblx0ICovIGdldCBhbmNob3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uYW5jaG9yO1xuICAgIH1cbiAgICAvKipcblx0ICogU2VsZWN0aW9uIGZvY3VzLiBGb2N1cyBpcyBhIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gZW5kcy5cblx0ICpcblx0ICogQHNlZSAjYW5jaG9yXG5cdCAqLyBnZXQgZm9jdXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZm9jdXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQuIFNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgd2hlbiB0aGVyZSBpcyBleGFjdGx5IG9uZSByYW5nZSB3aGljaCBpc1xuXHQgKiBjb2xsYXBzZWQuXG5cdCAqLyBnZXQgaXNDb2xsYXBzZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uaXNDb2xsYXBzZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIG51bWJlciBvZiByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0IHJhbmdlQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24ucmFuZ2VDb3VudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSB7QGxpbmsgI2ZvY3VzfSBwcmVjZWRlcyB7QGxpbmsgI2FuY2hvcn0uXG5cdCAqLyBnZXQgaXNCYWNrd2FyZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5pc0JhY2t3YXJkO1xuICAgIH1cbiAgICAvKipcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lZGl0YWJsZWVsZW1lbnR+RWRpdGFibGVFbGVtZW50IEVkaXRhYmxlRWxlbWVudH0gaW5zdGFuY2UgdGhhdCBjb250YWlucyB0aGlzIHNlbGVjdGlvbiwgb3IgYG51bGxgXG5cdCAqIGlmIHRoZSBzZWxlY3Rpb24gaXMgbm90IGluc2lkZSBhbiBlZGl0YWJsZSBlbGVtZW50LlxuXHQgKi8gZ2V0IGVkaXRhYmxlRWxlbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5lZGl0YWJsZUVsZW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VkIGZvciB0aGUgY29tcGF0aWJpbGl0eSB3aXRoIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3NlbGVjdGlvbn5TZWxlY3Rpb24jaXNFcXVhbH0gbWV0aG9kLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIGdldCBfcmFuZ2VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLl9yYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhYmxlIHRoYXQgY29udGFpbnMgY29waWVzIG9mIGFsbCByYW5nZXMgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbi5cblx0ICovICpnZXRSYW5nZXMoKSB7XG4gICAgICAgIHlpZWxkKiB0aGlzLl9zZWxlY3Rpb24uZ2V0UmFuZ2VzKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGNvcHkgb2YgdGhlIGZpcnN0IHJhbmdlIGluIHRoZSBzZWxlY3Rpb24uIEZpcnN0IHJhbmdlIGlzIHRoZSBvbmUgd2hpY2hcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gcG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNpc0JlZm9yZSBpcyBiZWZvcmV9IHN0YXJ0XG5cdCAqIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlIHdpdGggdGhlIGZpcnN0IHJhbmdlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24pLlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiBubyByYW5nZXMgYXJlIGFkZGVkIHRvIHNlbGVjdGlvbi5cblx0ICovIGdldEZpcnN0UmFuZ2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjb3B5IG9mIHRoZSBsYXN0IHJhbmdlIGluIHRoZSBzZWxlY3Rpb24uIExhc3QgcmFuZ2UgaXMgdGhlIG9uZSB3aGljaCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9XG5cdCAqIHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gZW5kIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlXG5cdCAqIHdpdGggdGhlIGxhc3QgcmFuZ2UgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbikuIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0TGFzdFJhbmdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldExhc3RSYW5nZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjb3B5IG9mIHRoZSBmaXJzdCBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLiBGaXJzdCBwb3NpdGlvbiBpcyB0aGUgcG9zaXRpb24gdGhhdFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uI2lzQmVmb3JlIGlzIGJlZm9yZX0gYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24gcmFuZ2VzLlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiBubyByYW5nZXMgYXJlIGFkZGVkIHRvIHNlbGVjdGlvbi5cblx0ICovIGdldEZpcnN0UG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjb3B5IG9mIHRoZSBsYXN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uIExhc3QgcG9zaXRpb24gaXMgdGhlIHBvc2l0aW9uIHRoYXRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNpc0FmdGVyIGlzIGFmdGVyfSBhbnkgb3RoZXIgcG9zaXRpb24gaW4gdGhlIHNlbGVjdGlvbiByYW5nZXMuXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIG5vIHJhbmdlcyBhcmUgYWRkZWQgdG8gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0TGFzdFBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgc2VsZWN0ZWQgZWxlbWVudC4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgRWxlbWVudH0gaXMgY29uc2lkZXJlZCBhcyBzZWxlY3RlZCBpZiB0aGVyZSBpcyBvbmx5XG5cdCAqIG9uZSByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLCBhbmQgdGhhdCByYW5nZSBjb250YWlucyBleGFjdGx5IG9uZSBlbGVtZW50LlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzZWxlY3RlZCBlbGVtZW50LlxuXHQgKi8gZ2V0U2VsZWN0ZWRFbGVtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIsIHRoaXMgc2VsZWN0aW9uIGlzIGVxdWFsIHRvIGdpdmVuIHNlbGVjdGlvbi4gU2VsZWN0aW9ucyBhcmUgZXF1YWwgaWYgdGhleSBoYXZlIHNhbWUgZGlyZWN0aW9ucyxcblx0ICogc2FtZSBudW1iZXIgb2YgcmFuZ2VzIGFuZCBhbGwgcmFuZ2VzIGZyb20gb25lIHNlbGVjdGlvbiBlcXVhbCB0byBhIHJhbmdlIGZyb20gb3RoZXIgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJTZWxlY3Rpb24gU2VsZWN0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIHNlbGVjdGlvbnMgYXJlIGVxdWFsLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGlzRXF1YWwob3RoZXJTZWxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5pc0VxdWFsKG90aGVyU2VsZWN0aW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoaXMgc2VsZWN0aW9uIGlzIHNpbWlsYXIgdG8gZ2l2ZW4gc2VsZWN0aW9uLiBTZWxlY3Rpb25zIGFyZSBzaW1pbGFyIGlmIHRoZXkgaGF2ZSBzYW1lIGRpcmVjdGlvbnMsIHNhbWVcblx0ICogbnVtYmVyIG9mIHJhbmdlcywgYW5kIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2dldFRyaW1tZWQgdHJpbW1lZH0gcmFuZ2VzIGZyb20gb25lIHNlbGVjdGlvbiBhcmVcblx0ICogZXF1YWwgdG8gYW55IHRyaW1tZWQgcmFuZ2UgZnJvbSBvdGhlciBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclNlbGVjdGlvbiBTZWxlY3Rpb24gdG8gY29tcGFyZSB3aXRoLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgc2VsZWN0aW9ucyBhcmUgc2ltaWxhciwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBpc1NpbWlsYXIob3RoZXJTZWxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5pc1NpbWlsYXIob3RoZXJTZWxlY3Rpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB0aGlzIHNlbGVjdGlvbidzIHJhbmdlcyBhbmQgZGlyZWN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24gYmFzZWQgb24gdGhlIGdpdmVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGFibGUgc2VsZWN0YWJsZX0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIFNldHMgc2VsZWN0aW9uIHRvIHRoZSBnaXZlbiByYW5nZS5cblx0ICogY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTtcblx0ICogZG9jdW1lbnRTZWxlY3Rpb24uX3NldFRvKCByYW5nZSApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiB0byBnaXZlbiByYW5nZXMuXG5cdCAqIGNvbnN0IHJhbmdlcyA9IFsgd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFydDEsIGVuZDIgKSwgd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFydDIsIGVuZDIgKSBdO1xuXHQgKiBkb2N1bWVudFNlbGVjdGlvbi5fc2V0VG8oIHJhbmdlICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgc2VsZWN0aW9uIHRvIHRoZSBvdGhlciBzZWxlY3Rpb24uXG5cdCAqIGNvbnN0IG90aGVyU2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpO1xuXHQgKiBkb2N1bWVudFNlbGVjdGlvbi5fc2V0VG8oIG90aGVyU2VsZWN0aW9uICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgY29sbGFwc2VkIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqIGNvbnN0IHBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHJvb3QsIG9mZnNldCApO1xuXHQgKiBkb2N1bWVudFNlbGVjdGlvbi5fc2V0VG8oIHBvc2l0aW9uICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgY29sbGFwc2VkIHNlbGVjdGlvbiBhdCB0aGUgcG9zaXRpb24gb2YgZ2l2ZW4gaXRlbSBhbmQgb2Zmc2V0LlxuXHQgKiBkb2N1bWVudFNlbGVjdGlvbi5fc2V0VG8oIHBhcmFncmFwaCwgb2Zmc2V0ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGZpcnN0IGNoaWxkIG9mXG5cdCAqIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGRvY3VtZW50U2VsZWN0aW9uLl9zZXRUbyggcGFyYWdyYXBoLCAnaW4nICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2Ugb24gYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gaXRlbX0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgaXRlbSBhbmQgZW5kcyBqdXN0IGFmdGVyIHRoZSBpdGVtLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBkb2N1bWVudFNlbGVjdGlvbi5fc2V0VG8oIHBhcmFncmFwaCwgJ29uJyApO1xuXHQgKlxuXHQgKiAvLyBDbGVhcnMgc2VsZWN0aW9uLiBSZW1vdmVzIGFsbCByYW5nZXMuXG5cdCAqIGRvY3VtZW50U2VsZWN0aW9uLl9zZXRUbyggbnVsbCApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogYFNlbGVjdGlvbiNfc2V0VG8oKWAgbWV0aG9kIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBvcHRpb25zIChgYmFja3dhcmRgLCBgZmFrZWAgYW5kIGBsYWJlbGApIGFzIHRoZSBsYXN0IGFyZ3VtZW50LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiBhcyBiYWNrd2FyZC5cblx0ICogZG9jdW1lbnRTZWxlY3Rpb24uX3NldFRvKCByYW5nZSwgeyBiYWNrd2FyZDogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBGYWtlIHNlbGVjdGlvbiBkb2VzIG5vdCByZW5kZXIgYXMgYnJvd3NlciBuYXRpdmUgc2VsZWN0aW9uIG92ZXIgc2VsZWN0ZWQgZWxlbWVudHMgYW5kIGlzIGhpZGRlbiB0byB0aGUgdXNlci5cblx0ICogVGhpcyB3YXksIG5vIG5hdGl2ZSBzZWxlY3Rpb24gVUkgYXJ0aWZhY3RzIGFyZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIgYW5kIHNlbGVjdGlvbiBvdmVyIGVsZW1lbnRzIGNhbiBiZVxuXHQgKiByZXByZXNlbnRlZCBpbiBvdGhlciB3YXksIGZvciBleGFtcGxlIGJ5IGFwcGx5aW5nIHByb3BlciBDU1MgY2xhc3MuXG5cdCAqXG5cdCAqIEFkZGl0aW9uYWxseSBmYWtlJ3Mgc2VsZWN0aW9uIGxhYmVsIGNhbiBiZSBwcm92aWRlZC4gSXQgd2lsbCBiZSB1c2VkIHRvIGRlcyBjcmliZSBmYWtlIHNlbGVjdGlvbiBpbiBET01cblx0ICogKGFuZCBiZSAgcHJvcGVybHkgaGFuZGxlZCBieSBzY3JlZW4gcmVhZGVycykuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIENyZWF0ZXMgZmFrZSBzZWxlY3Rpb24gd2l0aCBsYWJlbC5cblx0ICogZG9jdW1lbnRTZWxlY3Rpb24uX3NldFRvKCByYW5nZSwgeyBmYWtlOiB0cnVlLCBsYWJlbDogJ2ZvbycgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICovIF9zZXRUbyguLi5hcmdzKSB7XG4gICAgICAgIHRoaXMuX3NlbGVjdGlvbi5zZXRUbyguLi5hcmdzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIHtAbGluayAjZm9jdXN9IHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24uXG5cdCAqXG5cdCAqIFRoZSBsb2NhdGlvbiBjYW4gYmUgc3BlY2lmaWVkIGluIHRoZSBzYW1lIGZvcm0gYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY3JlYXRlUG9zaXRpb25BdCB2aWV3LmNyZWF0ZVBvc2l0aW9uQXQoKX1cblx0ICogcGFyYW1ldGVycy5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyBjaGFuZ2Vcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfS5cblx0ICovIF9zZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgICAgIHRoaXMuX3NlbGVjdGlvbi5zZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICB9XG59O1xuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuRG9jdW1lbnRTZWxlY3Rpb24kMS5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09ICdzZWxlY3Rpb24nIHx8IHR5cGUgPT0gJ2RvY3VtZW50U2VsZWN0aW9uJyB8fCB0eXBlID09ICd2aWV3OnNlbGVjdGlvbicgfHwgdHlwZSA9PSAndmlldzpkb2N1bWVudFNlbGVjdGlvbic7XG59O1xuXG4vKipcbiAqIFRoZSBldmVudCBvYmplY3QgcGFzc2VkIHRvIGJ1YmJsaW5nIGV2ZW50IGNhbGxiYWNrcy4gSXQgaXMgdXNlZCB0byBwcm92aWRlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBldmVudCBhcyB3ZWxsIGFzIGEgdG9vbCB0b1xuICogbWFuaXB1bGF0ZSBpdC5cbiAqLyBjbGFzcyBCdWJibGluZ0V2ZW50SW5mbyBleHRlbmRzIEV2ZW50SW5mbyB7XG4gICAgLyoqXG5cdCAqIFRoZSB2aWV3IHJhbmdlIHRoYXQgdGhlIGJ1YmJsaW5nIHNob3VsZCBzdGFydCBmcm9tLlxuXHQgKi8gc3RhcnRSYW5nZTtcbiAgICAvKipcblx0ICogVGhlIGN1cnJlbnQgZXZlbnQgcGhhc2UuXG5cdCAqLyBfZXZlbnRQaGFzZTtcbiAgICAvKipcblx0ICogVGhlIGN1cnJlbnQgYnViYmxpbmcgdGFyZ2V0LlxuXHQgKi8gX2N1cnJlbnRUYXJnZXQ7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBzb3VyY2UgVGhlIGVtaXR0ZXIuXG5cdCAqIEBwYXJhbSBuYW1lIFRoZSBldmVudCBuYW1lLlxuXHQgKiBAcGFyYW0gc3RhcnRSYW5nZSBUaGUgdmlldyByYW5nZSB0aGF0IHRoZSBidWJibGluZyBzaG91bGQgc3RhcnQgZnJvbS5cblx0ICovIGNvbnN0cnVjdG9yKHNvdXJjZSwgbmFtZSwgc3RhcnRSYW5nZSl7XG4gICAgICAgIHN1cGVyKHNvdXJjZSwgbmFtZSk7XG4gICAgICAgIHRoaXMuc3RhcnRSYW5nZSA9IHN0YXJ0UmFuZ2U7XG4gICAgICAgIHRoaXMuX2V2ZW50UGhhc2UgPSAnbm9uZSc7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRUYXJnZXQgPSBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIGN1cnJlbnQgZXZlbnQgcGhhc2UuXG5cdCAqLyBnZXQgZXZlbnRQaGFzZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50UGhhc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgY3VycmVudCBidWJibGluZyB0YXJnZXQuXG5cdCAqLyBnZXQgY3VycmVudFRhcmdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUYXJnZXQ7XG4gICAgfVxufVxuXG5jb25zdCBjb250ZXh0c1N5bWJvbCA9IFN5bWJvbCgnYnViYmxpbmcgY29udGV4dHMnKTtcbi8qKlxuICogQnViYmxpbmcgZW1pdHRlciBtaXhpbiBmb3IgdGhlIHZpZXcgZG9jdW1lbnQgYXMgZGVzY3JpYmVkIGluIHRoZSB7QGxpbmsgfkJ1YmJsaW5nRW1pdHRlcn0gaW50ZXJmYWNlLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIGNsYXNzIHRoYXQgaW5oZXJpdHMgZnJvbSB0aGUgcHJvdmlkZWQgYGJhc2VgIGFuZCBpbXBsZW1lbnRzIGBFbWl0dGVyYCBpbnRlcmZhY2UuXG4gKiBUaGUgYmFzZSBjbGFzcyBtdXN0IGltcGxlbWVudCB7QGxpbmsgbW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyfSBpbnRlcmZhY2UuXG4gKlxuICogYGBgdHNcbiAqIGNsYXNzIEJhc2VDbGFzcyBleHRlbmRzIEVtaXR0ZXJNaXhpbigpIHtcbiAqIFx0Ly8gLi4uXG4gKiB9XG4gKlxuICogY2xhc3MgTXlDbGFzcyBleHRlbmRzIEJ1YmJsaW5nRW1pdHRlck1peGluKCBCYXNlQ2xhc3MgKSB7XG4gKiBcdC8vIFRoaXMgY2xhc3MgZGVyaXZlcyBmcm9tIGBCYXNlQ2xhc3NgIGFuZCBpbXBsZW1lbnRzIHRoZSBgQnViYmxpbmdFbWl0dGVyYCBpbnRlcmZhY2UuXG4gKiB9XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBCdWJibGluZ0VtaXR0ZXJNaXhpbihiYXNlKSB7XG4gICAgY2xhc3MgTWl4aW4gZXh0ZW5kcyBiYXNlIHtcbiAgICAgICAgZmlyZShldmVudE9ySW5mbywgLi4uZXZlbnRBcmdzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50SW5mbyA9IGV2ZW50T3JJbmZvIGluc3RhbmNlb2YgRXZlbnRJbmZvID8gZXZlbnRPckluZm8gOiBuZXcgRXZlbnRJbmZvKHRoaXMsIGV2ZW50T3JJbmZvKTtcbiAgICAgICAgICAgICAgICBjb25zdCBldmVudENvbnRleHRzID0gZ2V0QnViYmxpbmdDb250ZXh0cyh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50Q29udGV4dHMuc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwZGF0ZUV2ZW50SW5mbyhldmVudEluZm8sICdjYXB0dXJpbmcnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAvLyBUaGUgY2FwdHVyZSBwaGFzZSBvZiB0aGUgZXZlbnQuXG4gICAgICAgICAgICAgICAgaWYgKGZpcmVMaXN0ZW5lckZvcihldmVudENvbnRleHRzLCAnJGNhcHR1cmUnLCBldmVudEluZm8sIC4uLmV2ZW50QXJncykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50SW5mby5yZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UmFuZ2UgPSBldmVudEluZm8uc3RhcnRSYW5nZSB8fCB0aGlzLnNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gc3RhcnRSYW5nZSA/IHN0YXJ0UmFuZ2UuZ2V0Q29udGFpbmVkRWxlbWVudCgpIDogbnVsbDtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0N1c3RvbUNvbnRleHQgPSBzZWxlY3RlZEVsZW1lbnQgPyBCb29sZWFuKGdldEN1c3RvbUNvbnRleHQoZXZlbnRDb250ZXh0cywgc2VsZWN0ZWRFbGVtZW50KSkgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IHNlbGVjdGVkRWxlbWVudCB8fCBnZXREZWVwZXJSYW5nZVBhcmVudChzdGFydFJhbmdlKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVFdmVudEluZm8oZXZlbnRJbmZvLCAnYXRUYXJnZXQnLCBub2RlKTtcbiAgICAgICAgICAgICAgICAvLyBGb3IgdGhlIG5vdCB5ZXQgYnViYmxpbmcgZXZlbnQgdHJpZ2dlciBmb3IgJHRleHQgbm9kZSBpZiBzZWxlY3Rpb24gY2FuIGJlIHRoZXJlIGFuZCBpdCdzIG5vdCBhIGN1c3RvbSBjb250ZXh0IHNlbGVjdGVkLlxuICAgICAgICAgICAgICAgIGlmICghaXNDdXN0b21Db250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaXJlTGlzdGVuZXJGb3IoZXZlbnRDb250ZXh0cywgJyR0ZXh0JywgZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRJbmZvLnJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVFdmVudEluZm8oZXZlbnRJbmZvLCAnYnViYmxpbmcnLCBub2RlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2hpbGUobm9kZSl7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJvb3Qgbm9kZSBoYW5kbGluZy5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuaXMoJ3Jvb3RFbGVtZW50JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaXJlTGlzdGVuZXJGb3IoZXZlbnRDb250ZXh0cywgJyRyb290JywgZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50SW5mby5yZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5pcygnZWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlyZUxpc3RlbmVyRm9yKGV2ZW50Q29udGV4dHMsIG5vZGUubmFtZSwgZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50SW5mby5yZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgY3VzdG9tIGNvbnRleHRzIChpLmUuLCBhIHdpZGdldCkuXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaXJlTGlzdGVuZXJGb3IoZXZlbnRDb250ZXh0cywgbm9kZSwgZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRJbmZvLnJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUV2ZW50SW5mbyhldmVudEluZm8sICdidWJibGluZycsIG5vZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVFdmVudEluZm8oZXZlbnRJbmZvLCAnYnViYmxpbmcnLCB0aGlzKTtcbiAgICAgICAgICAgICAgICAvLyBEb2N1bWVudCBjb250ZXh0LlxuICAgICAgICAgICAgICAgIGZpcmVMaXN0ZW5lckZvcihldmVudENvbnRleHRzLCAnJGRvY3VtZW50JywgZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpO1xuICAgICAgICAgICAgICAgIHJldHVybiBldmVudEluZm8ucmV0dXJuO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAtLSBAcHJlc2VydmUgKi8gQ0tFZGl0b3JFcnJvci5yZXRocm93VW5leHBlY3RlZEVycm9yKGVyciwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgX2FkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZXh0cyA9IHRvQXJyYXkob3B0aW9ucy5jb250ZXh0IHx8ICckZG9jdW1lbnQnKTtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50Q29udGV4dHMgPSBnZXRCdWJibGluZ0NvbnRleHRzKHRoaXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBjb250ZXh0IG9mIGNvbnRleHRzKXtcbiAgICAgICAgICAgICAgICBsZXQgZW1pdHRlciA9IGV2ZW50Q29udGV4dHMuZ2V0KGNvbnRleHQpO1xuICAgICAgICAgICAgICAgIGlmICghZW1pdHRlcikge1xuICAgICAgICAgICAgICAgICAgICBlbWl0dGVyID0gbmV3IChFbWl0dGVyTWl4aW4oKSkoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRDb250ZXh0cy5zZXQoY29udGV4dCwgZW1pdHRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuVG8oZW1pdHRlciwgZXZlbnQsIGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50Q29udGV4dHMgPSBnZXRCdWJibGluZ0NvbnRleHRzKHRoaXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbWl0dGVyIG9mIGV2ZW50Q29udGV4dHMudmFsdWVzKCkpe1xuICAgICAgICAgICAgICAgIHRoaXMuc3RvcExpc3RlbmluZyhlbWl0dGVyLCBldmVudCwgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBNaXhpbjtcbn1cbi8vIEJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCBgbWl4YC5cbntcbiAgICBjb25zdCBtaXhpbiA9IEJ1YmJsaW5nRW1pdHRlck1peGluKE9iamVjdCk7XG4gICAgW1xuICAgICAgICAnZmlyZScsXG4gICAgICAgICdfYWRkRXZlbnRMaXN0ZW5lcicsXG4gICAgICAgICdfcmVtb3ZlRXZlbnRMaXN0ZW5lcidcbiAgICBdLmZvckVhY2goKGtleSk9PntcbiAgICAgICAgQnViYmxpbmdFbWl0dGVyTWl4aW5ba2V5XSA9IG1peGluLnByb3RvdHlwZVtrZXldO1xuICAgIH0pO1xufS8qKlxuICogVXBkYXRlIHRoZSBldmVudCBpbmZvIGJ1YmJsaW5nIGZpZWxkcy5cbiAqXG4gKiBAcGFyYW0gZXZlbnRJbmZvIFRoZSBldmVudCBpbmZvIG9iamVjdCB0byB1cGRhdGUuXG4gKiBAcGFyYW0gZXZlbnRQaGFzZSBUaGUgY3VycmVudCBldmVudCBwaGFzZS5cbiAqIEBwYXJhbSBjdXJyZW50VGFyZ2V0IFRoZSBjdXJyZW50IGJ1YmJsaW5nIHRhcmdldC5cbiAqLyBmdW5jdGlvbiB1cGRhdGVFdmVudEluZm8oZXZlbnRJbmZvLCBldmVudFBoYXNlLCBjdXJyZW50VGFyZ2V0KSB7XG4gICAgaWYgKGV2ZW50SW5mbyBpbnN0YW5jZW9mIEJ1YmJsaW5nRXZlbnRJbmZvKSB7XG4gICAgICAgIGV2ZW50SW5mby5fZXZlbnRQaGFzZSA9IGV2ZW50UGhhc2U7XG4gICAgICAgIGV2ZW50SW5mby5fY3VycmVudFRhcmdldCA9IGN1cnJlbnRUYXJnZXQ7XG4gICAgfVxufVxuLyoqXG4gKiBGaXJlcyB0aGUgbGlzdGVuZXIgZm9yIHRoZSBzcGVjaWZpZWQgY29udGV4dC4gUmV0dXJucyBgdHJ1ZWAgaWYgZXZlbnQgd2FzIHN0b3BwZWQuXG4gKlxuICogQHBhcmFtIGV2ZW50SW5mbyBUaGUgYEV2ZW50SW5mb2Agb2JqZWN0LlxuICogQHBhcmFtIGV2ZW50QXJncyBBZGRpdGlvbmFsIGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrcy5cbiAqIEByZXR1cm5zIFRydWUgaWYgZXZlbnQgc3RvcCB3YXMgY2FsbGVkLlxuICovIGZ1bmN0aW9uIGZpcmVMaXN0ZW5lckZvcihldmVudENvbnRleHRzLCBjb250ZXh0LCBldmVudEluZm8sIC4uLmV2ZW50QXJncykge1xuICAgIGNvbnN0IGVtaXR0ZXIgPSB0eXBlb2YgY29udGV4dCA9PSAnc3RyaW5nJyA/IGV2ZW50Q29udGV4dHMuZ2V0KGNvbnRleHQpIDogZ2V0Q3VzdG9tQ29udGV4dChldmVudENvbnRleHRzLCBjb250ZXh0KTtcbiAgICBpZiAoIWVtaXR0ZXIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbWl0dGVyLmZpcmUoZXZlbnRJbmZvLCAuLi5ldmVudEFyZ3MpO1xuICAgIHJldHVybiBldmVudEluZm8uc3RvcC5jYWxsZWQ7XG59XG4vKipcbiAqIFJldHVybnMgYW4gZW1pdHRlciBmb3IgYSBzcGVjaWZpZWQgdmlldyBub2RlLlxuICovIGZ1bmN0aW9uIGdldEN1c3RvbUNvbnRleHQoZXZlbnRDb250ZXh0cywgbm9kZSkge1xuICAgIGZvciAoY29uc3QgW2NvbnRleHQsIGVtaXR0ZXJdIG9mIGV2ZW50Q29udGV4dHMpe1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRleHQgPT0gJ2Z1bmN0aW9uJyAmJiBjb250ZXh0KG5vZGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gZW1pdHRlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyBidWJibGluZyBjb250ZXh0cyBtYXAgZm9yIHRoZSBzb3VyY2UgKGVtaXR0ZXIpLlxuICovIGZ1bmN0aW9uIGdldEJ1YmJsaW5nQ29udGV4dHMoc291cmNlKSB7XG4gICAgaWYgKCFzb3VyY2VbY29udGV4dHNTeW1ib2xdKSB7XG4gICAgICAgIHNvdXJjZVtjb250ZXh0c1N5bWJvbF0gPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIHJldHVybiBzb3VyY2VbY29udGV4dHNTeW1ib2xdO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBkZWVwZXIgcGFyZW50IGVsZW1lbnQgZm9yIHRoZSByYW5nZS5cbiAqLyBmdW5jdGlvbiBnZXREZWVwZXJSYW5nZVBhcmVudChyYW5nZSkge1xuICAgIGlmICghcmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHN0YXJ0UGFyZW50ID0gcmFuZ2Uuc3RhcnQucGFyZW50O1xuICAgIGNvbnN0IGVuZFBhcmVudCA9IHJhbmdlLmVuZC5wYXJlbnQ7XG4gICAgY29uc3Qgc3RhcnRQYXRoID0gc3RhcnRQYXJlbnQuZ2V0UGF0aCgpO1xuICAgIGNvbnN0IGVuZFBhdGggPSBlbmRQYXJlbnQuZ2V0UGF0aCgpO1xuICAgIHJldHVybiBzdGFydFBhdGgubGVuZ3RoID4gZW5kUGF0aC5sZW5ndGggPyBzdGFydFBhcmVudCA6IGVuZFBhcmVudDtcbn1cblxuLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zdCB7IGxvZ0RvY3VtZW50IH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLyoqXG4gKiBEb2N1bWVudCBjbGFzcyBjcmVhdGVzIGFuIGFic3RyYWN0IGxheWVyIG92ZXIgdGhlIGNvbnRlbnQgZWRpdGFibGUgYXJlYSwgY29udGFpbnMgYSB0cmVlIG9mIHZpZXcgZWxlbWVudHMgYW5kXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uIHZpZXcgc2VsZWN0aW9ufSBhc3NvY2lhdGVkIHdpdGggdGhpcyBkb2N1bWVudC5cbiAqLyBsZXQgRG9jdW1lbnQkMSA9IGNsYXNzIERvY3VtZW50IGV4dGVuZHMgLyogI19fUFVSRV9fICovIEJ1YmJsaW5nRW1pdHRlck1peGluKC8qICNfX1BVUkVfXyAqLyBPYnNlcnZhYmxlTWl4aW4oKSkge1xuICAgIC8qKlxuXHQgKiBTZWxlY3Rpb24gZG9uZSBvbiB0aGlzIGRvY3VtZW50LlxuXHQgKi8gc2VsZWN0aW9uO1xuICAgIC8qKlxuXHQgKiBSb290cyBvZiB0aGUgdmlldyB0cmVlLiBDb2xsZWN0aW9uIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnRzfS5cblx0ICpcblx0ICogVmlldyByb290cyBhcmUgY3JlYXRlZCBhcyBhIHJlc3VsdCBvZiBiaW5kaW5nIGJldHdlZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNyb290c30gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3Jvb3RzfSBhbmQgdGhpcyBpcyBoYW5kbGVkIGJ5XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZWRpdGluZ2NvbnRyb2xsZXJ+RWRpdGluZ0NvbnRyb2xsZXJ9LCBzbyB0byBjcmVhdGUgdmlldyByb290IHdlIG5lZWQgdG8gY3JlYXRlXG5cdCAqIG1vZGVsIHJvb3QgdXNpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjY3JlYXRlUm9vdH0uXG5cdCAqLyByb290cztcbiAgICAvKipcblx0ICogVGhlIHN0eWxlcyBwcm9jZXNzb3IgaW5zdGFuY2UgdXNlZCBieSB0aGlzIGRvY3VtZW50IHdoZW4gbm9ybWFsaXppbmcgc3R5bGVzLlxuXHQgKi8gc3R5bGVzUHJvY2Vzc29yO1xuICAgIC8qKlxuXHQgKiBQb3N0LWZpeGVyIGNhbGxiYWNrcyByZWdpc3RlcmVkIHRvIHRoZSB2aWV3IGRvY3VtZW50LlxuXHQgKi8gX3Bvc3RGaXhlcnMgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBEb2N1bWVudCBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIHN0eWxlc1Byb2Nlc3NvciBUaGUgc3R5bGVzIHByb2Nlc3NvciBpbnN0YW5jZS5cblx0ICovIGNvbnN0cnVjdG9yKHN0eWxlc1Byb2Nlc3Nvcil7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0gbmV3IERvY3VtZW50U2VsZWN0aW9uJDEoKTtcbiAgICAgICAgdGhpcy5yb290cyA9IG5ldyBDb2xsZWN0aW9uKHtcbiAgICAgICAgICAgIGlkUHJvcGVydHk6ICdyb290TmFtZSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3R5bGVzUHJvY2Vzc29yID0gc3R5bGVzUHJvY2Vzc29yO1xuICAgICAgICB0aGlzLnNldCgnaXNSZWFkT25seScsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5zZXQoJ2lzRm9jdXNlZCcsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5zZXQoJ2lzU2VsZWN0aW5nJywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgnaXNDb21wb3NpbmcnLCBmYWxzZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNyb290cyB2aWV3IHJvb3QgZWxlbWVudH0gd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuIElmIHRoZSBuYW1lIGlzIG5vdFxuXHQgKiBzcGVjaWZpYyBcIm1haW5cIiByb290IGlzIHJldHVybmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSByb290LlxuXHQgKiBAcmV0dXJucyBUaGUgdmlldyByb290IGVsZW1lbnQgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgb3IgbnVsbCB3aGVuIHRoZXJlIGlzIG5vIHJvb3Qgb2YgZ2l2ZW4gbmFtZS5cblx0ICovIGdldFJvb3QobmFtZSA9ICdtYWluJykge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290cy5nZXQobmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBbGxvd3MgcmVnaXN0ZXJpbmcgcG9zdC1maXhlciBjYWxsYmFja3MuIEEgcG9zdC1maXhlcnMgbWVjaGFuaXNtIGFsbG93cyB0byB1cGRhdGUgdGhlIHZpZXcgdHJlZSBqdXN0IGJlZm9yZSBpdCBpcyByZW5kZXJlZFxuXHQgKiB0byB0aGUgRE9NLlxuXHQgKlxuXHQgKiBQb3N0LWZpeGVycyBhcmUgZXhlY3V0ZWQgcmlnaHQgYWZ0ZXIgYWxsIGNoYW5nZXMgZnJvbSB0aGUgb3V0ZXJtb3N0IGNoYW5nZSBibG9jayB3ZXJlIGFwcGxpZWQgYnV0XG5cdCAqIGJlZm9yZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZXZlbnQ6cmVuZGVyIHJlbmRlciBldmVudH0gaXMgZmlyZWQuIElmIGEgcG9zdC1maXhlciBjYWxsYmFjayBtYWRlXG5cdCAqIGEgY2hhbmdlLCBpdCBzaG91bGQgcmV0dXJuIGB0cnVlYC4gV2hlbiB0aGlzIGhhcHBlbnMsIGFsbCBwb3N0LWZpeGVycyBhcmUgZmlyZWQgYWdhaW4gdG8gY2hlY2sgaWYgc29tZXRoaW5nIGVsc2Ugc2hvdWxkXG5cdCAqIG5vdCBiZSBmaXhlZCBpbiB0aGUgbmV3IGRvY3VtZW50IHRyZWUgc3RhdGUuXG5cdCAqXG5cdCAqIFZpZXcgcG9zdC1maXhlcnMgYXJlIHVzZWZ1bCB3aGVuIHlvdSB3YW50IHRvIGFwcGx5IHNvbWUgZml4ZXMgd2hlbmV2ZXIgdGhlIHZpZXcgc3RydWN0dXJlIGNoYW5nZXMuIEtlZXAgaW4gbWluZCB0aGF0XG5cdCAqIGNoYW5nZXMgZXhlY3V0ZWQgaW4gYSB2aWV3IHBvc3QtZml4ZXIgc2hvdWxkIG5vdCBicmVhayBtb2RlbC12aWV3IG1hcHBpbmcuXG5cdCAqXG5cdCAqIFRoZSB0eXBlcyBvZiBjaGFuZ2VzIHdoaWNoIHNob3VsZCBiZSBzYWZlOlxuXHQgKlxuXHQgKiAqIGFkZGluZyBvciByZW1vdmluZyBhdHRyaWJ1dGUgZnJvbSBlbGVtZW50cyxcblx0ICogKiBjaGFuZ2VzIGluc2lkZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgVUkgZWxlbWVudHN9LFxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZWRpdGluZ2NvbnRyb2xsZXJ+RWRpdGluZ0NvbnRyb2xsZXIjcmVjb252ZXJ0SXRlbSBtYXJraW5nIHNvbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnRzIHRvIGJlXG5cdCAqIHJlLWNvbnZlcnRlZH0uXG5cdCAqXG5cdCAqIFRyeSB0byBhdm9pZCBjaGFuZ2VzIHdoaWNoIHRvdWNoIHZpZXcgc3RydWN0dXJlOlxuXHQgKlxuXHQgKiAqIHlvdSBzaG91bGQgbm90IGFkZCBvciByZW1vdmUgbm9yIHdyYXAgb3IgdW53cmFwIGFueSB2aWV3IGVsZW1lbnRzLFxuXHQgKiAqIHlvdSBzaG91bGQgbm90IGNoYW5nZSB0aGUgZWRpdG9yIGRhdGEgbW9kZWwgaW4gYSB2aWV3IHBvc3QtZml4ZXIuXG5cdCAqXG5cdCAqIEFzIGEgcGFyYW1ldGVyLCBhIHBvc3QtZml4ZXIgY2FsbGJhY2sgcmVjZWl2ZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyIGRvd25jYXN0IHdyaXRlcn0uXG5cdCAqXG5cdCAqIFR5cGljYWxseSwgYSBwb3N0LWZpeGVyIHdpbGwgbG9vayBsaWtlIHRoaXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQucmVnaXN0ZXJQb3N0Rml4ZXIoIHdyaXRlciA9PiB7XG5cdCAqIFx0aWYgKCBjaGVja1NvbWVDb25kaXRpb24oKSApIHtcblx0ICogXHRcdHdyaXRlci5kb1NvbWV0aGluZygpO1xuXHQgKlxuXHQgKiBcdFx0Ly8gTGV0IG90aGVyIHBvc3QtZml4ZXJzIGtub3cgdGhhdCBzb21ldGhpbmcgY2hhbmdlZC5cblx0ICogXHRcdHJldHVybiB0cnVlO1xuXHQgKiBcdH1cblx0ICpcblx0ICogXHRyZXR1cm4gZmFsc2U7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBub3RoaW5nIGhhcHBlbnMgcmlnaHQgYWZ0ZXIgeW91IHJlZ2lzdGVyIGEgcG9zdC1maXhlciAoZS5nLiBleGVjdXRlIHN1Y2ggYSBjb2RlIGluIHRoZSBjb25zb2xlKS5cblx0ICogVGhhdCBpcyBiZWNhdXNlIGFkZGluZyBhIHBvc3QtZml4ZXIgZG9lcyBub3QgZXhlY3V0ZSBpdC5cblx0ICogVGhlIHBvc3QtZml4ZXIgd2lsbCBiZSBleGVjdXRlZCBhcyBzb29uIGFzIGFueSBjaGFuZ2UgaW4gdGhlIGRvY3VtZW50IG5lZWRzIHRvIGNhdXNlIGl0cyByZW5kZXJpbmcuXG5cdCAqIElmIHlvdSB3YW50IHRvIHJlLXJlbmRlciB0aGUgZWRpdG9yJ3MgdmlldyBhZnRlciByZWdpc3RlcmluZyB0aGUgcG9zdC1maXhlciB0aGVuIHlvdSBzaG91bGQgZG8gaXQgbWFudWFsbHkgYnkgY2FsbGluZ1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNmb3JjZVJlbmRlciBgdmlldy5mb3JjZVJlbmRlcigpYH0uXG5cdCAqXG5cdCAqIElmIHlvdSBuZWVkIHRvIHJlZ2lzdGVyIGEgY2FsbGJhY2sgd2hpY2ggaXMgZXhlY3V0ZWQgd2hlbiBET00gZWxlbWVudHMgYXJlIGFscmVhZHkgdXBkYXRlZCxcblx0ICogdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2V2ZW50OnJlbmRlciByZW5kZXIgZXZlbnR9LlxuXHQgKi8gcmVnaXN0ZXJQb3N0Rml4ZXIocG9zdEZpeGVyKSB7XG4gICAgICAgIHRoaXMuX3Bvc3RGaXhlcnMuYWRkKHBvc3RGaXhlcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXN0cm95cyB0aGlzIGluc3RhbmNlLiBNYWtlcyBzdXJlIHRoYXQgYWxsIG9ic2VydmVycyBhcmUgZGVzdHJveWVkIGFuZCBsaXN0ZW5lcnMgcmVtb3ZlZC5cblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMucm9vdHMuZm9yRWFjaCgocm9vdCk9PnJvb3QuZGVzdHJveSgpKTtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQZXJmb3JtcyBwb3N0LWZpeGVyIGxvb3BzLiBFeGVjdXRlcyBwb3N0LWZpeGVyIGNhbGxiYWNrcyBhcyBsb25nIGFzIG5vbmUgb2YgdGhlbSBoYXMgZG9uZSBhbnkgY2hhbmdlcyB0byB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2NhbGxQb3N0Rml4ZXJzKHdyaXRlcikge1xuICAgICAgICBsZXQgd2FzRml4ZWQgPSBmYWxzZTtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBjYWxsYmFjayBvZiB0aGlzLl9wb3N0Rml4ZXJzKXtcbiAgICAgICAgICAgICAgICB3YXNGaXhlZCA9IGNhbGxiYWNrKHdyaXRlcik7XG4gICAgICAgICAgICAgICAgaWYgKHdhc0ZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfXdoaWxlICh3YXNGaXhlZClcbiAgICB9XG59O1xuXG4vLyBEZWZhdWx0IGF0dHJpYnV0ZSBwcmlvcml0eS5cbmNvbnN0IERFRkFVTFRfUFJJT1JJVFkgPSAxMDtcbi8qKlxuICogQXR0cmlidXRlIGVsZW1lbnRzIGFyZSB1c2VkIHRvIHJlcHJlc2VudCBmb3JtYXR0aW5nIGVsZW1lbnRzIGluIHRoZSB2aWV3ICh0aGluayDigJMgYDxiPmAsIGA8c3BhbiBzdHlsZT1cImZvbnQtc2l6ZTogMmVtXCI+YCwgZXRjLikuXG4gKiBNb3N0IG9mdGVuIHRoZXkgYXJlIGNyZWF0ZWQgd2hlbiBkb3duY2FzdGluZyBtb2RlbCB0ZXh0IGF0dHJpYnV0ZXMuXG4gKlxuICogRWRpdGluZyBlbmdpbmUgZG9lcyBub3QgZGVmaW5lIGEgZml4ZWQgSFRNTCBEVEQuIFRoaXMgaXMgd2h5IGEgZmVhdHVyZSBkZXZlbG9wZXIgbmVlZHMgdG8gY2hvb3NlIGJldHdlZW4gdmFyaW91c1xuICogdHlwZXMgKGNvbnRhaW5lciBlbGVtZW50LCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudH0sXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnQgZW1wdHkgZWxlbWVudH0sIGV0Yykgd2hlbiBkZXZlbG9waW5nIGEgZmVhdHVyZS5cbiAqXG4gKiBUbyBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIGVsZW1lbnQgaW5zdGFuY2UgdXNlIHRoZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVBdHRyaWJ1dGVFbGVtZW50IGBEb3duY2FzdFdyaXRlciNjcmVhdGVBdHRyaWJ1dGVFbGVtZW50KClgfSBtZXRob2QuXG4gKi8gY2xhc3MgQXR0cmlidXRlRWxlbWVudCBleHRlbmRzIEVsZW1lbnQkMSB7XG4gICAgc3RhdGljIERFRkFVTFRfUFJJT1JJVFkgPSBERUZBVUxUX1BSSU9SSVRZO1xuICAgIC8qKlxuXHQgKiBFbGVtZW50IHByaW9yaXR5LiBEZWNpZGVzIGluIHdoYXQgb3JkZXIgZWxlbWVudHMgYXJlIHdyYXBwZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmVhZG9ubHlcblx0ICovIF9wcmlvcml0eSA9IERFRkFVTFRfUFJJT1JJVFk7XG4gICAgLyoqXG5cdCAqIEVsZW1lbnQgaWRlbnRpZmllci4gSWYgc2V0LCBpdCBpcyB1c2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I2lzU2ltaWxhcn0sXG5cdCAqIGFuZCB0aGVuIHR3byBlbGVtZW50cyBhcmUgY29uc2lkZXJlZCBzaW1pbGFyIGlmLCBhbmQgb25seSBpZiB0aGV5IGhhdmUgdGhlIHNhbWUgYF9pZGAuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmVhZG9ubHlcblx0ICovIF9pZCA9IG51bGw7XG4gICAgLyoqXG5cdCAqIEtlZXBzIGFsbCB0aGUgYXR0cmlidXRlIGVsZW1lbnRzIHRoYXQgaGF2ZSB0aGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCNpZCBpZHN9XG5cdCAqIGFuZCBzdGlsbCBleGlzdCBpbiB0aGUgdmlldyB0cmVlLlxuXHQgKlxuXHQgKiBUaGlzIHByb3BlcnR5IGlzIG1hbmFnZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0uXG5cdCAqLyBfY2xvbmVzR3JvdXAgPSBudWxsO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGF0dHJpYnV0ZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVBdHRyaWJ1dGVFbGVtZW50XG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudFxuXHQgKiBAcHJvdGVjdGVkXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgaW5zdGFuY2UgdG8gd2hpY2ggdGhpcyBlbGVtZW50IGJlbG9uZ3MuXG5cdCAqIEBwYXJhbSBuYW1lIE5vZGUgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIENvbGxlY3Rpb24gb2YgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBuYW1lLCBhdHRycywgY2hpbGRyZW4pe1xuICAgICAgICBzdXBlcihkb2N1bWVudCwgbmFtZSwgYXR0cnMsIGNoaWxkcmVuKTtcbiAgICAgICAgdGhpcy5nZXRGaWxsZXJPZmZzZXQgPSBnZXRGaWxsZXJPZmZzZXQkMztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEVsZW1lbnQgcHJpb3JpdHkuIERlY2lkZXMgaW4gd2hhdCBvcmRlciBlbGVtZW50cyBhcmUgd3JhcHBlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfS5cblx0ICovIGdldCBwcmlvcml0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByaW9yaXR5O1xuICAgIH1cbiAgICAvKipcblx0ICogRWxlbWVudCBpZGVudGlmaWVyLiBJZiBzZXQsIGl0IGlzIHVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjaXNTaW1pbGFyfSxcblx0ICogYW5kIHRoZW4gdHdvIGVsZW1lbnRzIGFyZSBjb25zaWRlcmVkIHNpbWlsYXIgaWYsIGFuZCBvbmx5IGlmIHRoZXkgaGF2ZSB0aGUgc2FtZSBgaWRgLlxuXHQgKi8gZ2V0IGlkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9IHRoYXQgaGFzIHRoZVxuXHQgKiBzYW1lIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50I2lkIGlkfSBhbmQgYXJlIGluIHRoZSB2aWV3IHRyZWUgKHdlcmUgbm90IHJlbW92ZWQpLlxuXHQgKlxuXHQgKiBOb3RlOiBJZiB0aGlzIGVsZW1lbnQgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB0cmVlLCByZXR1cm5lZCBzZXQgd2lsbCBub3QgaW5jbHVkZSBpdC5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIGF0dHJpYnV0ZS1lbGVtZW50LWdldC1lbGVtZW50cy13aXRoLXNhbWUtaWQtbm8taWR9XG5cdCAqIGlmIHRoaXMgZWxlbWVudCBoYXMgbm8gYGlkYC5cblx0ICpcblx0ICogQHJldHVybnMgU2V0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGUgZWxlbWVudHNcblx0ICogd2l0aCB0aGUgc2FtZSBgaWRgIHRoYXQgd2VyZSBhZGRlZCBhbmQgbm90IHJlbW92ZWQgZnJvbSB0aGUgdmlldyB0cmVlLlxuXHQgKi8gZ2V0RWxlbWVudHNXaXRoU2FtZUlkKCkge1xuICAgICAgICBpZiAodGhpcy5pZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3QgZ2V0IGVsZW1lbnRzIHdpdGggdGhlIHNhbWUgaWQgZm9yIGFuIGF0dHJpYnV0ZSBlbGVtZW50IHdpdGhvdXQgaWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGF0dHJpYnV0ZS1lbGVtZW50LWdldC1lbGVtZW50cy13aXRoLXNhbWUtaWQtbm8taWRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignYXR0cmlidXRlLWVsZW1lbnQtZ2V0LWVsZW1lbnRzLXdpdGgtc2FtZS1pZC1uby1pZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgU2V0KHRoaXMuX2Nsb25lc0dyb3VwKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0aGlzIGVsZW1lbnQgaXMgc2ltaWxhciB0byBvdGhlciBlbGVtZW50LlxuXHQgKlxuXHQgKiBJZiBub25lIG9mIGVsZW1lbnRzIGhhcyBzZXQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjaWR9LCB0aGVuIGJvdGggZWxlbWVudHNcblx0ICogc2hvdWxkIGhhdmUgdGhlIHNhbWUgbmFtZSwgYXR0cmlidXRlcyBhbmQgcHJpb3JpdHkgdG8gYmUgY29uc2lkZXJlZCBhcyBzaW1pbGFyLiBUd28gc2ltaWxhciBlbGVtZW50cyBjYW4gY29udGFpblxuXHQgKiBkaWZmZXJlbnQgc2V0IG9mIGNoaWxkcmVuIG5vZGVzLlxuXHQgKlxuXHQgKiBJZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBoYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjaWR9IHNldCwgdGhlbiBib3RoXG5cdCAqIGVsZW1lbnRzIGhhdmUgdG8gaGF2ZSB0aGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCNpZH0gdmFsdWUgdG8gYmVcblx0ICogY29uc2lkZXJlZCBzaW1pbGFyLlxuXHQgKlxuXHQgKiBTaW1pbGFyaXR5IGlzIGltcG9ydGFudCBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlcn0uIEZvciBleGFtcGxlOlxuXHQgKlxuXHQgKiAqIHR3byBmb2xsb3dpbmcgc2ltaWxhciBlbGVtZW50cyBjYW4gYmUgbWVyZ2VkIHRvZ2V0aGVyIGludG8gb25lLCBsb25nZXIgZWxlbWVudCxcblx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3Vud3JhcH0gY2hlY2tzIHNpbWlsYXJpdHkgb2YgcGFzc2VkIGVsZW1lbnQgYW5kIHByb2Nlc3NlZCBlbGVtZW50IHRvXG5cdCAqIGRlY2lkZSB3aGV0aGVyIHByb2Nlc3NlZCBlbGVtZW50IHNob3VsZCBiZSB1bndyYXBwZWQsXG5cdCAqICogZXRjLlxuXHQgKi8gaXNTaW1pbGFyKG90aGVyRWxlbWVudCkge1xuICAgICAgICAvLyBJZiBhbnkgZWxlbWVudCBoYXMgYW4gYGlkYCBzZXQsIGp1c3QgY29tcGFyZSB0aGUgaWRzLlxuICAgICAgICBpZiAodGhpcy5pZCAhPT0gbnVsbCB8fCBvdGhlckVsZW1lbnQuaWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlkID09PSBvdGhlckVsZW1lbnQuaWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLmlzU2ltaWxhcihvdGhlckVsZW1lbnQpICYmIHRoaXMucHJpb3JpdHkgPT0gb3RoZXJFbGVtZW50LnByaW9yaXR5O1xuICAgIH1cbiAgICAvKipcblx0ICogQ2xvbmVzIHByb3ZpZGVkIGVsZW1lbnQgd2l0aCBwcmlvcml0eS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBkZWVwIElmIHNldCB0byBgdHJ1ZWAgY2xvbmVzIGVsZW1lbnQgYW5kIGFsbCBpdHMgY2hpbGRyZW4gcmVjdXJzaXZlbHkuIFdoZW4gc2V0IHRvIGBmYWxzZWAsXG5cdCAqIGVsZW1lbnQgd2lsbCBiZSBjbG9uZWQgd2l0aG91dCBhbnkgY2hpbGRyZW4uXG5cdCAqIEByZXR1cm5zIENsb25lIG9mIHRoaXMgZWxlbWVudC5cblx0ICovIF9jbG9uZShkZWVwID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgY2xvbmVkID0gc3VwZXIuX2Nsb25lKGRlZXApO1xuICAgICAgICAvLyBDbG9uZSBwcmlvcml0eSB0b28uXG4gICAgICAgIGNsb25lZC5fcHJpb3JpdHkgPSB0aGlzLl9wcmlvcml0eTtcbiAgICAgICAgLy8gQW5kIGlkIHRvby5cbiAgICAgICAgY2xvbmVkLl9pZCA9IHRoaXMuX2lkO1xuICAgICAgICByZXR1cm4gY2xvbmVkO1xuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfbWVyZ2VBdHRyaWJ1dGVzRnJvbX0gdG8gdmVyaWZ5IGlmIHRoZSBnaXZlbiBlbGVtZW50IGNhbiBiZSBtZXJnZWQgd2l0aG91dFxuXHQgKiBjb25mbGljdHMgaW50byB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2Nhbk1lcmdlQXR0cmlidXRlc0Zyb20ob3RoZXJFbGVtZW50KSB7XG4gICAgICAgIC8vIENhbid0IG1lcmdlIGlmIGFueSBvZiBlbGVtZW50cyBoYXZlIGFuIGlkIG9yIGEgZGlmZmVyZW5jZSBvZiBwcmlvcml0eS5cbiAgICAgICAgaWYgKHRoaXMuaWQgIT09IG51bGwgfHwgb3RoZXJFbGVtZW50LmlkICE9PSBudWxsIHx8IHRoaXMucHJpb3JpdHkgIT09IG90aGVyRWxlbWVudC5wcmlvcml0eSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdXBlci5fY2FuTWVyZ2VBdHRyaWJ1dGVzRnJvbShvdGhlckVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfc3VidHJhY3RBdHRyaWJ1dGVzT2Z9IHRvIHZlcmlmeSBpZiB0aGUgZ2l2ZW4gZWxlbWVudCBhdHRyaWJ1dGVzXG5cdCAqIGNhbiBiZSBmdWxseSBzdWJ0cmFjdGVkIGZyb20gdGhpcyBlbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9jYW5TdWJ0cmFjdEF0dHJpYnV0ZXNPZihvdGhlckVsZW1lbnQpIHtcbiAgICAgICAgLy8gQ2FuJ3Qgc3VidHJhY3QgaWYgYW55IG9mIGVsZW1lbnRzIGhhdmUgYW4gaWQgb3IgYSBkaWZmZXJlbmNlIG9mIHByaW9yaXR5LlxuICAgICAgICBpZiAodGhpcy5pZCAhPT0gbnVsbCB8fCBvdGhlckVsZW1lbnQuaWQgIT09IG51bGwgfHwgdGhpcy5wcmlvcml0eSAhPT0gb3RoZXJFbGVtZW50LnByaW9yaXR5KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLl9jYW5TdWJ0cmFjdEF0dHJpYnV0ZXNPZihvdGhlckVsZW1lbnQpO1xuICAgIH1cbn1cbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cbkF0dHJpYnV0ZUVsZW1lbnQucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSwgbmFtZSkge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgICByZXR1cm4gdHlwZSA9PT0gJ2F0dHJpYnV0ZUVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmF0dHJpYnV0ZUVsZW1lbnQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgICAgICB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcgfHwgdHlwZSA9PT0gJ25vZGUnIHx8IHR5cGUgPT09ICd2aWV3Om5vZGUnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICdhdHRyaWJ1dGVFbGVtZW50JyB8fCB0eXBlID09PSAndmlldzphdHRyaWJ1dGVFbGVtZW50JyB8fCAvLyBGcm9tIHN1cGVyLmlzKCkuIFRoaXMgaXMgaGlnaGx5IHV0aWxpc2VkIG1ldGhvZCBhbmQgY2Fubm90IGNhbGwgc3VwZXIuIFNlZSBja2VkaXRvci9ja2VkaXRvcjUjNjUyOS5cbiAgICAgICAgdHlwZSA9PT0gJ2VsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVsZW1lbnQnKTtcbiAgICB9XG59O1xuLyoqXG4gKiBSZXR1cm5zIGJsb2NrIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfkZpbGxlciBmaWxsZXJ9IG9mZnNldCBvciBgbnVsbGAgaWYgYmxvY2sgZmlsbGVyIGlzIG5vdCBuZWVkZWQuXG4gKlxuICogQHJldHVybnMgQmxvY2sgZmlsbGVyIG9mZnNldCBvciBgbnVsbGAgaWYgYmxvY2sgZmlsbGVyIGlzIG5vdCBuZWVkZWQuXG4gKi8gZnVuY3Rpb24gZ2V0RmlsbGVyT2Zmc2V0JDMoKSB7XG4gICAgLy8gPGI+Zm9vPC9iPiBkb2VzIG5vdCBuZWVkIGZpbGxlci5cbiAgICBpZiAobm9uVWlDaGlsZHJlbkNvdW50KHRoaXMpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBsZXQgZWxlbWVudCA9IHRoaXMucGFyZW50O1xuICAgIC8vIDxwPjxiPjwvYj48L3A+IG5lZWRzIGZpbGxlciAtPiA8cD48Yj48YnI+PC9iPjwvcD5cbiAgICB3aGlsZShlbGVtZW50ICYmIGVsZW1lbnQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSl7XG4gICAgICAgIGlmIChub25VaUNoaWxkcmVuQ291bnQoZWxlbWVudCkgPiAxKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnQ7XG4gICAgfVxuICAgIGlmICghZWxlbWVudCB8fCBub25VaUNoaWxkcmVuQ291bnQoZWxlbWVudCkgPiAxKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBSZW5kZXIgYmxvY2sgZmlsbGVyIGF0IHRoZSBlbmQgb2YgZWxlbWVudCAoYWZ0ZXIgYWxsIHVpIGVsZW1lbnRzKS5cbiAgICByZXR1cm4gdGhpcy5jaGlsZENvdW50O1xufVxuLyoqXG4gKiBSZXR1cm5zIHRvdGFsIGNvdW50IG9mIGNoaWxkcmVuIHRoYXQgYXJlIG5vdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgVUlFbGVtZW50c30uXG4gKi8gZnVuY3Rpb24gbm9uVWlDaGlsZHJlbkNvdW50KGVsZW1lbnQpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShlbGVtZW50LmdldENoaWxkcmVuKCkpLmZpbHRlcigoZWxlbWVudCk9PiFlbGVtZW50LmlzKCd1aUVsZW1lbnQnKSkubGVuZ3RoO1xufVxuXG4vKipcbiAqIEVtcHR5IGVsZW1lbnQgY2xhc3MuIEl0IGlzIHVzZWQgdG8gcmVwcmVzZW50IGVsZW1lbnRzIHRoYXQgY2Fubm90IGNvbnRhaW4gYW55IGNoaWxkIG5vZGVzIChmb3IgZXhhbXBsZSBgPGltZz5gIGVsZW1lbnRzKS5cbiAqXG4gKiBUbyBjcmVhdGUgYSBuZXcgZW1wdHkgZWxlbWVudCB1c2UgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZUVtcHR5RWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlRW1wdHlFbGVtZW50KClgfSBtZXRob2QuXG4gKi8gY2xhc3MgRW1wdHlFbGVtZW50IGV4dGVuZHMgRWxlbWVudCQxIHtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBuZXcgaW5zdGFuY2Ugb2YgRW1wdHlFbGVtZW50LlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctZW1wdHllbGVtZW50LWNhbm5vdC1hZGRgIHdoZW4gdGhpcmQgcGFyYW1ldGVyIGlzIHBhc3NlZCxcblx0ICogdG8gaW5mb3JtIHRoYXQgdXNhZ2Ugb2YgRW1wdHlFbGVtZW50IGlzIGluY29ycmVjdCAoYWRkaW5nIGNoaWxkIG5vZGVzIHRvIEVtcHR5RWxlbWVudCBpcyBmb3JiaWRkZW4pLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVFbXB0eUVsZW1lbnRcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgaW5zdGFuY2UgdG8gd2hpY2ggdGhpcyBlbGVtZW50IGJlbG9uZ3MuXG5cdCAqIEBwYXJhbSBuYW1lIE5vZGUgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIENvbGxlY3Rpb24gb2YgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbil7XG4gICAgICAgIHN1cGVyKGRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbik7XG4gICAgICAgIHRoaXMuZ2V0RmlsbGVyT2Zmc2V0ID0gZ2V0RmlsbGVyT2Zmc2V0JDI7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPdmVycmlkZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX2luc2VydENoaWxkfSBtZXRob2QuXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgdmlldy1lbXB0eWVsZW1lbnQtY2Fubm90LWFkZGAgdG8gcHJldmVudFxuXHQgKiBhZGRpbmcgYW55IGNoaWxkIG5vZGVzIHRvIEVtcHR5RWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfaW5zZXJ0Q2hpbGQoaW5kZXgsIGl0ZW1zKSB7XG4gICAgICAgIGlmIChpdGVtcyAmJiAoaXRlbXMgaW5zdGFuY2VvZiBOb2RlJDIgfHwgQXJyYXkuZnJvbShpdGVtcykubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogQ2Fubm90IGFkZCBjaGlsZHJlbiB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnR9LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LWVtcHR5ZWxlbWVudC1jYW5ub3QtYWRkXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctZW1wdHllbGVtZW50LWNhbm5vdC1hZGQnLCBbXG4gICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICBpdGVtc1xuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuRW1wdHlFbGVtZW50LnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUgPT09ICdlbXB0eUVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVtcHR5RWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdlbGVtZW50JyB8fCB0eXBlID09PSAndmlldzplbGVtZW50JyB8fCB0eXBlID09PSAnbm9kZScgfHwgdHlwZSA9PT0gJ3ZpZXc6bm9kZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5hbWUgPT09IHRoaXMubmFtZSAmJiAodHlwZSA9PT0gJ2VtcHR5RWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZW1wdHlFbGVtZW50JyB8fCB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcpO1xuICAgIH1cbn07XG4vKipcbiAqIFJldHVybnMgYG51bGxgIGJlY2F1c2UgYmxvY2sgZmlsbGVyIGlzIG5vdCBuZWVkZWQgZm9yIEVtcHR5RWxlbWVudHMuXG4gKi8gZnVuY3Rpb24gZ2V0RmlsbGVyT2Zmc2V0JDIoKSB7XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogVUkgZWxlbWVudCBjbGFzcy4gSXQgc2hvdWxkIGJlIHVzZWQgdG8gcmVwcmVzZW50IGVkaXRpbmcgVUkgd2hpY2ggbmVlZHMgdG8gYmUgaW5qZWN0ZWQgaW50byB0aGUgZWRpdGluZyB2aWV3XG4gKiBJZiBwb3NzaWJsZSwgeW91IHNob3VsZCBrZWVwIHlvdXIgVUkgb3V0c2lkZSB0aGUgZWRpdGluZyB2aWV3LiBIb3dldmVyLCBpZiB0aGF0IGlzIG5vdCBwb3NzaWJsZSxcbiAqIFVJIGVsZW1lbnRzIGNhbiBiZSB1c2VkLlxuICpcbiAqIEhvdyBhIFVJIGVsZW1lbnQgaXMgcmVuZGVyZWQgaXMgaW4geW91ciBjb250cm9sICh5b3UgcGFzcyBhIGNhbGxiYWNrIHRvXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZVVJRWxlbWVudCBgZG93bmNhc3RXcml0ZXIjY3JlYXRlVUlFbGVtZW50KClgfSkuXG4gKiBUaGUgZWRpdG9yIHdpbGwgaWdub3JlIHlvdXIgVUkgZWxlbWVudCDigJMgdGhlIHNlbGVjdGlvbiBjYW5ub3QgYmUgcGxhY2VkIGluIGl0LCBpdCBpcyBza2lwcGVkIChpbnZpc2libGUpIHdoZW5cbiAqIHRoZSB1c2VyIG1vZGlmaWVzIHRoZSBzZWxlY3Rpb24gYnkgdXNpbmcgYXJyb3cga2V5cyBhbmQgdGhlIGVkaXRvciBkb2VzIG5vdCBsaXN0ZW4gdG8gYW55IG11dGF0aW9ucyB3aGljaFxuICogaGFwcGVuIGluc2lkZSB5b3VyIFVJIGVsZW1lbnRzLlxuICpcbiAqIFRoZSBsaW1pdGF0aW9uIGlzIHRoYXQgeW91IGNhbm5vdCBjb252ZXJ0IGEgbW9kZWwgZWxlbWVudCB0byBhIFVJIGVsZW1lbnQuIFVJIGVsZW1lbnRzIG5lZWQgdG8gYmVcbiAqIGNyZWF0ZWQgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyIG1hcmtlcnN9IG9yIGFzIGFkZGl0aW5hbCBlbGVtZW50c1xuICogaW5zaWRlIG5vcm1hbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBjb250YWluZXIgZWxlbWVudHN9LlxuICpcbiAqIFRvIGNyZWF0ZSBhIG5ldyBVSSBlbGVtZW50IHVzZSB0aGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlVUlFbGVtZW50IGBkb3duY2FzdFdyaXRlciNjcmVhdGVVSUVsZW1lbnQoKWB9IG1ldGhvZC5cbiAqLyBjbGFzcyBVSUVsZW1lbnQgZXh0ZW5kcyBFbGVtZW50JDEge1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBpbnN0YW5jZSBvZiBVSUVsZW1lbnQuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgdmlldy11aWVsZW1lbnQtY2Fubm90LWFkZGAgd2hlbiB0aGlyZCBwYXJhbWV0ZXIgaXMgcGFzc2VkLFxuXHQgKiB0byBpbmZvcm0gdGhhdCB1c2FnZSBvZiBVSUVsZW1lbnQgaXMgaW5jb3JyZWN0IChhZGRpbmcgY2hpbGQgbm9kZXMgdG8gVUlFbGVtZW50IGlzIGZvcmJpZGRlbikuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZVVJRWxlbWVudFxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGRvY3VtZW50IFRoZSBkb2N1bWVudCBpbnN0YW5jZSB0byB3aGljaCB0aGlzIGVsZW1lbnQgYmVsb25ncy5cblx0ICogQHBhcmFtIG5hbWUgTm9kZSBuYW1lLlxuXHQgKiBAcGFyYW0gYXR0cnMgQ29sbGVjdGlvbiBvZiBhdHRyaWJ1dGVzLlxuXHQgKiBAcGFyYW0gY2hpbGRyZW4gQSBsaXN0IG9mIG5vZGVzIHRvIGJlIGluc2VydGVkIGludG8gY3JlYXRlZCBlbGVtZW50LlxuXHQgKi8gY29uc3RydWN0b3IoZG9jdW1lbnQsIG5hbWUsIGF0dHJzLCBjaGlsZHJlbil7XG4gICAgICAgIHN1cGVyKGRvY3VtZW50LCBuYW1lLCBhdHRycywgY2hpbGRyZW4pO1xuICAgICAgICB0aGlzLmdldEZpbGxlck9mZnNldCA9IGdldEZpbGxlck9mZnNldCQxO1xuICAgIH1cbiAgICAvKipcblx0ICogT3ZlcnJpZGVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19pbnNlcnRDaGlsZH0gbWV0aG9kLlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctdWllbGVtZW50LWNhbm5vdC1hZGRgIHRvIHByZXZlbnQgYWRkaW5nIGFueSBjaGlsZCBub2Rlc1xuXHQgKiB0byBVSUVsZW1lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2luc2VydENoaWxkKGluZGV4LCBpdGVtcykge1xuICAgICAgICBpZiAoaXRlbXMgJiYgKGl0ZW1zIGluc3RhbmNlb2YgTm9kZSQyIHx8IEFycmF5LmZyb20oaXRlbXMpLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBhZGQgY2hpbGRyZW4gdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy11aWVsZW1lbnQtY2Fubm90LWFkZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXVpZWxlbWVudC1jYW5ub3QtYWRkJywgW1xuICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAgaXRlbXNcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVuZGVycyB0aGlzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudH0gdG8gRE9NLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYnlcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyfS5cblx0ICogRG8gbm90IHVzZSBpbmhlcml0YW5jZSB0byBjcmVhdGUgY3VzdG9tIHJlbmRlcmluZyBtZXRob2QsIHJlcGxhY2UgYHJlbmRlcigpYCBtZXRob2QgaW5zdGVhZDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgbXlVSUVsZW1lbnQgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVVSUVsZW1lbnQoICdzcGFuJyApO1xuXHQgKiBteVVJRWxlbWVudC5yZW5kZXIgPSBmdW5jdGlvbiggZG9tRG9jdW1lbnQsIGRvbUNvbnZlcnRlciApIHtcblx0ICogXHRjb25zdCBkb21FbGVtZW50ID0gdGhpcy50b0RvbUVsZW1lbnQoIGRvbURvY3VtZW50ICk7XG5cdCAqXG5cdCAqIFx0ZG9tQ29udmVydGVyLnNldENvbnRlbnRPZiggZG9tRWxlbWVudCwgJzxiPnRoaXMgaXMgdWkgZWxlbWVudDwvYj4nICk7XG5cdCAqXG5cdCAqIFx0cmV0dXJuIGRvbUVsZW1lbnQ7XG5cdCAqIH07XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJZiBjaGFuZ2VzIGluIHlvdXIgVUkgZWxlbWVudCBzaG91bGQgdHJpZ2dlciBzb21lIGVkaXRvciBVSSB1cGRhdGUgeW91IHNob3VsZCBjYWxsXG5cdCAqIHRoZSB7QGxpbmsgbW9kdWxlOnVpL2VkaXRvcnVpL2VkaXRvcnVpfkVkaXRvclVJI3VwZGF0ZSBgZWRpdG9yLnVpLnVwZGF0ZSgpYH0gbWV0aG9kXG5cdCAqIGFmdGVyIHJlbmRlcmluZyB5b3VyIFVJIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21Db252ZXJ0ZXIgSW5zdGFuY2Ugb2YgdGhlIERvbUNvbnZlcnRlciB1c2VkIHRvIG9wdGltaXplIHRoZSBvdXRwdXQuXG5cdCAqLyByZW5kZXIoZG9tRG9jdW1lbnQsIGRvbUNvbnZlcnRlci8vIGVzbGludC1kaXNhYmxlLWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgKSB7XG4gICAgICAgIC8vIFByb3ZpZGUgYmFzaWMsIGRlZmF1bHQgb3V0cHV0LlxuICAgICAgICByZXR1cm4gdGhpcy50b0RvbUVsZW1lbnQoZG9tRG9jdW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBET00gZWxlbWVudCBiYXNlZCBvbiB0aGlzIHZpZXcgVUlFbGVtZW50LlxuXHQgKiBOb3RlIHRoYXQgZWFjaCB0aW1lIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCBuZXcgRE9NIGVsZW1lbnQgaXMgY3JlYXRlZC5cblx0ICovIHRvRG9tRWxlbWVudChkb21Eb2N1bWVudCkge1xuICAgICAgICBjb25zdCBkb21FbGVtZW50ID0gZG9tRG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLm5hbWUpO1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiB0aGlzLmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICBkb21FbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIHRoaXMuZ2V0QXR0cmlidXRlKGtleSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb21FbGVtZW50O1xuICAgIH1cbn1cbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cblVJRWxlbWVudC5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlLCBuYW1lKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICAgIHJldHVybiB0eXBlID09PSAndWlFbGVtZW50JyB8fCB0eXBlID09PSAndmlldzp1aUVsZW1lbnQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgICAgICB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcgfHwgdHlwZSA9PT0gJ25vZGUnIHx8IHR5cGUgPT09ICd2aWV3Om5vZGUnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICd1aUVsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OnVpRWxlbWVudCcgfHwgdHlwZSA9PT0gJ2VsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OmVsZW1lbnQnKTtcbiAgICB9XG59O1xuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIGluamVjdHMgVUkgZWxlbWVudCBoYW5kbGluZyB0byB0aGUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH0uXG4gKlxuICogQSBjYWxsYmFjayBpcyBhZGRlZCB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmtleWRvd24gZG9jdW1lbnQga2V5ZG93biBldmVudH0uXG4gKiBUaGUgY2FsbGJhY2sgaGFuZGxlcyB0aGUgc2l0dWF0aW9uIHdoZW4gcmlnaHQgYXJyb3cga2V5IGlzIHByZXNzZWQgYW5kIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgYmVmb3JlIGEgVUkgZWxlbWVudC5cbiAqIFdpdGhvdXQgdGhpcyBoYW5kbGVyLCBpdCB3b3VsZCBiZSBpbXBvc3NpYmxlIHRvIFwianVtcCBvdmVyXCIgVUkgZWxlbWVudCB1c2luZyByaWdodCBhcnJvdyBrZXkuXG4gKlxuICogQHBhcmFtIHZpZXcgVmlldyBjb250cm9sbGVyIHRvIHdoaWNoIHRoZSBxdWlya3MgaGFuZGxpbmcgd2lsbCBiZSBpbmplY3RlZC5cbiAqLyBmdW5jdGlvbiBpbmplY3RVaUVsZW1lbnRIYW5kbGluZyh2aWV3KSB7XG4gICAgdmlldy5kb2N1bWVudC5vbignYXJyb3dLZXknLCAoZXZ0LCBkYXRhKT0+anVtcE92ZXJVaUVsZW1lbnQoZXZ0LCBkYXRhLCB2aWV3LmRvbUNvbnZlcnRlciksIHtcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgfSk7XG59XG4vKipcbiAqIFJldHVybnMgYG51bGxgIGJlY2F1c2UgYmxvY2sgZmlsbGVyIGlzIG5vdCBuZWVkZWQgZm9yIFVJRWxlbWVudHMuXG4gKi8gZnVuY3Rpb24gZ2V0RmlsbGVyT2Zmc2V0JDEoKSB7XG4gICAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIFNlbGVjdGlvbiBjYW5ub3QgYmUgcGxhY2VkIGluIGEgYFVJRWxlbWVudGAuIFdoZW5ldmVyIGl0IGlzIHBsYWNlZCB0aGVyZSwgaXQgaXMgbW92ZWQgYmVmb3JlIGl0LiBUaGlzXG4gKiBjYXVzZXMgYSBzaXR1YXRpb24gd2hlbiBpdCBpcyBpbXBvc3NpYmxlIHRvIGp1bXAgb3ZlciBgVUlFbGVtZW50YCB1c2luZyByaWdodCBhcnJvdyBrZXksIGJlY2F1c2UgdGhlIHNlbGVjdGlvblxuICogZW5kcyB1cCBpbiB1aSBlbGVtZW50IChpbiBET00pIGFuZCBpcyBtb3ZlZCBiYWNrIHRvIHRoZSBsZWZ0LiBUaGlzIGhhbmRsZXIgZml4ZXMgdGhpcyBzaXR1YXRpb24uXG4gKi8gZnVuY3Rpb24ganVtcE92ZXJVaUVsZW1lbnQoZXZ0LCBkYXRhLCBkb21Db252ZXJ0ZXIpIHtcbiAgICBpZiAoZGF0YS5rZXlDb2RlID09IGtleUNvZGVzLmFycm93cmlnaHQpIHtcbiAgICAgICAgY29uc3QgZG9tU2VsZWN0aW9uID0gZGF0YS5kb21UYXJnZXQub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgZG9tU2VsZWN0aW9uQ29sbGFwc2VkID0gZG9tU2VsZWN0aW9uLnJhbmdlQ291bnQgPT0gMSAmJiBkb21TZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKS5jb2xsYXBzZWQ7XG4gICAgICAgIC8vIEp1bXAgb3ZlciBVSSBlbGVtZW50IGlmIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgb3Igc2hpZnQga2V5IGlzIHByZXNzZWQuIFRoZXNlIGFyZSB0aGUgY2FzZXMgd2hlbiBzZWxlY3Rpb24gd291bGQgZXh0ZW5kLlxuICAgICAgICBpZiAoZG9tU2VsZWN0aW9uQ29sbGFwc2VkIHx8IGRhdGEuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRvbVBhcmVudCA9IGRvbVNlbGVjdGlvbi5mb2N1c05vZGU7XG4gICAgICAgICAgICBjb25zdCBkb21PZmZzZXQgPSBkb21TZWxlY3Rpb24uZm9jdXNPZmZzZXQ7XG4gICAgICAgICAgICBjb25zdCB2aWV3UG9zaXRpb24gPSBkb21Db252ZXJ0ZXIuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tUGFyZW50LCBkb21PZmZzZXQpO1xuICAgICAgICAgICAgLy8gSW4gY2FzZSBpZiBkb20gZWxlbWVudCBpcyBub3QgY29udmVydGVkIHRvIHZpZXcgb3IgaXMgbm90IG1hcHBlZCBvciBzb21ldGhpbmcuIEhhcHBlbnMgZm9yIGV4YW1wbGUgaW4gc29tZSB0ZXN0cy5cbiAgICAgICAgICAgIGlmICh2aWV3UG9zaXRpb24gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTa2lwIGFsbCBmb2xsb3dpbmcgdWkgZWxlbWVudHMuXG4gICAgICAgICAgICBsZXQganVtcGVkT3ZlckFueVVpRWxlbWVudCA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgbmV4dFZpZXdQb3NpdGlvbiA9IHZpZXdQb3NpdGlvbi5nZXRMYXN0TWF0Y2hpbmdQb3NpdGlvbigodmFsdWUpPT57XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLml0ZW0uaXMoJ3VpRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbWVtYmVyIHRoYXQgdGhlcmUgd2FzIGF0IGxlYXN0IG9uZSB1aSBlbGVtZW50LlxuICAgICAgICAgICAgICAgICAgICBqdW1wZWRPdmVyQW55VWlFbGVtZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gSnVtcCBvdmVyIHVpIGVsZW1lbnRzLCBqdW1wIG92ZXIgZW1wdHkgYXR0cmlidXRlIGVsZW1lbnRzLCBtb3ZlIHVwIGZyb20gaW5zaWRlIG9mIGF0dHJpYnV0ZSBlbGVtZW50LlxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pdGVtLmlzKCd1aUVsZW1lbnQnKSB8fCB2YWx1ZS5pdGVtLmlzKCdhdHRyaWJ1dGVFbGVtZW50JykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIERvbid0IGp1bXAgb3ZlciB0ZXh0IG9yIGRvbid0IGdldCBvdXQgb2YgY29udGFpbmVyIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBJZiBhbnl0aGluZyBoYXMgYmVlbiBza2lwcGVkLCBmaXggcG9zaXRpb24uXG4gICAgICAgICAgICAvLyBUaGlzIGBpZmAgY291bGQgYmUgcG9zc2libHkgb21pdHRlZCBidXQgbWF5YmUgaXQgaXMgYmV0dGVyIG5vdCB0byBtZXNzIHdpdGggRE9NIHNlbGVjdGlvbiBpZiBub3QgbmVlZGVkLlxuICAgICAgICAgICAgaWYgKGp1bXBlZE92ZXJBbnlVaUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdEb21Qb3NpdGlvbiA9IGRvbUNvbnZlcnRlci52aWV3UG9zaXRpb25Ub0RvbShuZXh0Vmlld1Bvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBpZiAoZG9tU2VsZWN0aW9uQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNlbGVjdGlvbiB3YXMgY29sbGFwc2VkLCBzbyBjb2xsYXBzZSBpdCBhdCBmdXJ0aGVyIHBvc2l0aW9uLlxuICAgICAgICAgICAgICAgICAgICBkb21TZWxlY3Rpb24uY29sbGFwc2UobmV3RG9tUG9zaXRpb24ucGFyZW50LCBuZXdEb21Qb3NpdGlvbi5vZmZzZXQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNlbGVjdGlvbiB3YXMgbm90IGNvbGxhcHNlLCBzbyBleHRlbmQgaXQgaW5zdGVhZCBvZiBjb2xsYXBzaW5nLlxuICAgICAgICAgICAgICAgICAgICBkb21TZWxlY3Rpb24uZXh0ZW5kKG5ld0RvbVBvc2l0aW9uLnBhcmVudCwgbmV3RG9tUG9zaXRpb24ub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogVGhlIHJhdyBlbGVtZW50IGNsYXNzLlxuICpcbiAqIFRoZSByYXcgZWxlbWVudHMgd29yayBhcyBkYXRhIGNvbnRhaW5lcnMgKFwid3JhcHBlcnNcIiwgXCJzYW5kYm94ZXNcIikgYnV0IHRoZWlyIGNoaWxkcmVuIGFyZSBub3QgbWFuYWdlZCBvclxuICogZXZlbiByZWNvZ25pemVkIGJ5IHRoZSBlZGl0b3IuIFRoaXMgZW5jYXBzdWxhdGlvbiBhbGxvd3MgaW50ZWdyYXRpb25zIHRvIG1haW50YWluIGN1c3RvbSBET00gc3RydWN0dXJlc1xuICogaW4gdGhlIGVkaXRvciBjb250ZW50IHdpdGhvdXQsIGZvciBpbnN0YW5jZSwgd29ycnlpbmcgYWJvdXQgY29tcGF0aWJpbGl0eSB3aXRoIG90aGVyIGVkaXRvciBmZWF0dXJlcy5cbiAqIFJhdyBlbGVtZW50cyBhcmUgYSBwZXJmZWN0IHRvb2wgZm9yIGludGVncmF0aW9uIHdpdGggZXh0ZXJuYWwgZnJhbWV3b3JrcyBhbmQgZGF0YSBzb3VyY2VzLlxuICpcbiAqIFVubGlrZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgVUkgZWxlbWVudHN9LCByYXcgZWxlbWVudHMgYWN0IGxpa2UgcmVhbCBlZGl0b3JcbiAqIGNvbnRlbnQgKHNpbWlsYXIgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9IG9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnR9KSwgdGhleSBhcmUgY29uc2lkZXJlZCBieSB0aGUgZWRpdG9yIHNlbGVjdGlvbiBhbmRcbiAqIHtAbGluayBtb2R1bGU6d2lkZ2V0L3V0aWxzfnRvV2lkZ2V0IHRoZXkgY2FuIHdvcmsgYXMgd2lkZ2V0c30uXG4gKlxuICogVG8gY3JlYXRlIGEgbmV3IHJhdyBlbGVtZW50LCB1c2UgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZVJhd0VsZW1lbnQgYGRvd25jYXN0V3JpdGVyI2NyZWF0ZVJhd0VsZW1lbnQoKWB9IG1ldGhvZC5cbiAqLyBjbGFzcyBSYXdFbGVtZW50IGV4dGVuZHMgRWxlbWVudCQxIHtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiBhIHJhdyBlbGVtZW50LlxuXHQgKlxuXHQgKiBUaHJvd3MgdGhlIGB2aWV3LXJhd2VsZW1lbnQtY2Fubm90LWFkZGAge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gd2hlbiB0aGUgYGNoaWxkcmVuYFxuXHQgKiBwYXJhbWV0ZXIgaXMgcGFzc2VkIHRvIGluZm9ybSB0aGF0IHRoZSB1c2FnZSBvZiBgUmF3RWxlbWVudGAgaXMgaW5jb3JyZWN0IChhZGRpbmcgY2hpbGQgbm9kZXMgdG8gYFJhd0VsZW1lbnRgIGlzIGZvcmJpZGRlbikuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZVJhd0VsZW1lbnRcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgaW5zdGFuY2UgdG8gd2hpY2ggdGhpcyBlbGVtZW50IGJlbG9uZ3MuXG5cdCAqIEBwYXJhbSBuYW1lIE5vZGUgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIENvbGxlY3Rpb24gb2YgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBuYW1lLCBhdHRycywgY2hpbGRyZW4pe1xuICAgICAgICBzdXBlcihkb2N1bWVudCwgbmFtZSwgYXR0cnMsIGNoaWxkcmVuKTtcbiAgICAgICAgLy8gUmV0dXJucyBgbnVsbGAgYmVjYXVzZSBmaWxsZXIgaXMgbm90IG5lZWRlZCBmb3IgcmF3IGVsZW1lbnRzLlxuICAgICAgICB0aGlzLmdldEZpbGxlck9mZnNldCA9IGdldEZpbGxlck9mZnNldDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE92ZXJyaWRlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX2luc2VydENoaWxkfSBtZXRob2QuXG5cdCAqIFRocm93cyB0aGUgYHZpZXctcmF3ZWxlbWVudC1jYW5ub3QtYWRkYCB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSB0byBwcmV2ZW50XG5cdCAqIGFkZGluZyBhbnkgY2hpbGQgbm9kZXMgdG8gYSByYXcgZWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfaW5zZXJ0Q2hpbGQoaW5kZXgsIGl0ZW1zKSB7XG4gICAgICAgIGlmIChpdGVtcyAmJiAoaXRlbXMgaW5zdGFuY2VvZiBOb2RlJDIgfHwgQXJyYXkuZnJvbShpdGVtcykubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogQ2Fubm90IGFkZCBjaGlsZHJlbiB0byBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50fSBpbnN0YW5jZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy1yYXdlbGVtZW50LWNhbm5vdC1hZGRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1yYXdlbGVtZW50LWNhbm5vdC1hZGQnLCBbXG4gICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICBpdGVtc1xuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGlzIGFsbG93cyByZW5kZXJpbmcgdGhlIGNoaWxkcmVuIG9mIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYXdlbGVtZW50flJhd0VsZW1lbnR9IG9uIHRoZSBET00gbGV2ZWwuXG5cdCAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyfSB3aXRoIHRoZSByYXcgRE9NIGVsZW1lbnRcblx0ICogcGFzc2VkIGFzIGFuIGFyZ3VtZW50LCBsZWF2aW5nIHRoZSBudW1iZXIgYW5kIHNoYXBlIG9mIHRoZSBjaGlsZHJlbiB1cCB0byB0aGUgaW50ZWdyYXRvci5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgKiptdXN0IGJlIGRlZmluZWQqKiBmb3IgdGhlIHJhdyBlbGVtZW50IHRvIHdvcms6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IG15UmF3RWxlbWVudCA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVJhd0VsZW1lbnQoICdkaXYnICk7XG5cdCAqXG5cdCAqIG15UmF3RWxlbWVudC5yZW5kZXIgPSBmdW5jdGlvbiggZG9tRWxlbWVudCwgZG9tQ29udmVydGVyICkge1xuXHQgKiBcdGRvbUNvbnZlcnRlci5zZXRDb250ZW50T2YoIGRvbUVsZW1lbnQsICc8Yj5UaGlzIGlzIHRoZSByYXcgY29udGVudCBvZiBteVJhd0VsZW1lbnQuPC9iPicgKTtcblx0ICogfTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21FbGVtZW50IFRoZSBuYXRpdmUgRE9NIGVsZW1lbnQgcmVwcmVzZW50aW5nIHRoZSByYXcgdmlldyBlbGVtZW50LlxuXHQgKiBAcGFyYW0gZG9tQ29udmVydGVyIEluc3RhbmNlIG9mIHRoZSBEb21Db252ZXJ0ZXIgdXNlZCB0byBvcHRpbWl6ZSB0aGUgb3V0cHV0LlxuXHQgKi8gcmVuZGVyKGRvbUVsZW1lbnQsIGRvbUNvbnZlcnRlcikge31cbn1cbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cblJhd0VsZW1lbnQucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSwgbmFtZSkge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgICByZXR1cm4gdHlwZSA9PT0gJ3Jhd0VsZW1lbnQnIHx8IHR5cGUgPT09ICd2aWV3OnJhd0VsZW1lbnQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgICAgICB0eXBlID09PSB0aGlzLm5hbWUgfHwgdHlwZSA9PT0gJ3ZpZXc6JyArIHRoaXMubmFtZSB8fCB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcgfHwgdHlwZSA9PT0gJ25vZGUnIHx8IHR5cGUgPT09ICd2aWV3Om5vZGUnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICdyYXdFbGVtZW50JyB8fCB0eXBlID09PSAndmlldzpyYXdFbGVtZW50JyB8fCB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZWxlbWVudCcpO1xuICAgIH1cbn07XG4vKipcbiAqIFJldHVybnMgYG51bGxgIGJlY2F1c2UgYmxvY2sgZmlsbGVyIGlzIG5vdCBuZWVkZWQgZm9yIHJhdyBlbGVtZW50cy5cbiAqLyBmdW5jdGlvbiBnZXRGaWxsZXJPZmZzZXQoKSB7XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogRG9jdW1lbnQgZnJhZ21lbnQuXG4gKlxuICogVG8gY3JlYXRlIGEgbmV3IGRvY3VtZW50IGZyYWdtZW50IGluc3RhbmNlIHVzZSB0aGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdXBjYXN0d3JpdGVyflVwY2FzdFdyaXRlciNjcmVhdGVEb2N1bWVudEZyYWdtZW50IGBVcGNhc3RXcml0ZXIjY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpYH1cbiAqIG1ldGhvZC5cbiAqLyBsZXQgRG9jdW1lbnRGcmFnbWVudCQxID0gY2xhc3MgRG9jdW1lbnRGcmFnbWVudCBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oVHlwZUNoZWNrYWJsZSQxKSB7XG4gICAgLyoqXG5cdCAqIFRoZSBkb2N1bWVudCB0byB3aGljaCB0aGlzIGRvY3VtZW50IGZyYWdtZW50IGJlbG9uZ3MuXG5cdCAqLyBkb2N1bWVudDtcbiAgICAvKipcblx0ICogQXJyYXkgb2YgY2hpbGQgbm9kZXMuXG5cdCAqLyBfY2hpbGRyZW4gPSBbXTtcbiAgICAvKipcblx0ICogTWFwIG9mIGN1c3RvbSBwcm9wZXJ0aWVzLlxuXHQgKiBDdXN0b20gcHJvcGVydGllcyBjYW4gYmUgYWRkZWQgdG8gZG9jdW1lbnQgZnJhZ21lbnQgaW5zdGFuY2UuXG5cdCAqLyBfY3VzdG9tUHJvcGVydGllcyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBuZXcgRG9jdW1lbnRGcmFnbWVudCBpbnN0YW5jZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgZG9jdW1lbnQgdG8gd2hpY2ggdGhpcyBkb2N1bWVudCBmcmFnbWVudCBiZWxvbmdzLlxuXHQgKiBAcGFyYW0gY2hpbGRyZW4gQSBsaXN0IG9mIG5vZGVzIHRvIGJlIGluc2VydGVkIGludG8gdGhlIGNyZWF0ZWQgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCwgY2hpbGRyZW4pe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmRvY3VtZW50ID0gZG9jdW1lbnQ7XG4gICAgICAgIGlmIChjaGlsZHJlbikge1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0Q2hpbGQoMCwgY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgbm9kZXMgYWRkZWQgdG8gdGhpcyBkb2N1bWVudCBmcmFnbWVudC5cblx0ICovIFtTeW1ib2wuaXRlcmF0b3JdKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogTnVtYmVyIG9mIGNoaWxkIG5vZGVzIGluIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqLyBnZXQgY2hpbGRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIElzIGB0cnVlYCBpZiB0aGVyZSBhcmUgbm8gbm9kZXMgaW5zaWRlIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gZ2V0IGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkQ291bnQgPT09IDA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBcnRpZmljaWFsIHJvb3Qgb2YgYERvY3VtZW50RnJhZ21lbnRgLiBSZXR1cm5zIGl0c2VsZi4gQWRkZWQgZm9yIGNvbXBhdGliaWxpdHkgcmVhc29ucy5cblx0ICovIGdldCByb290KCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgcGFyZW50IG9mIGBEb2N1bWVudEZyYWdtZW50YC4gUmV0dXJucyBgbnVsbGAuIEFkZGVkIGZvciBjb21wYXRpYmlsaXR5IHJlYXNvbnMuXG5cdCAqLyBnZXQgcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgZWxlbWVudCBuYW1lLiBSZXR1cm5zIGB1bmRlZmluZWRgLiBBZGRlZCBmb3IgY29tcGF0aWJpbGl0eSByZWFzb25zLlxuXHQgKi8gZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBcnRpZmljaWFsIGVsZW1lbnQgZ2V0RmlsbGVyT2Zmc2V0LiBSZXR1cm5zIGB1bmRlZmluZWRgLiBBZGRlZCBmb3IgY29tcGF0aWJpbGl0eSByZWFzb25zLlxuXHQgKi8gZ2V0IGdldEZpbGxlck9mZnNldCgpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGN1c3RvbSBwcm9wZXJ0eSB2YWx1ZSBmb3IgdGhlIGdpdmVuIGtleS5cblx0ICovIGdldEN1c3RvbVByb3BlcnR5KGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3VzdG9tUHJvcGVydGllcy5nZXQoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmF0b3Igd2hpY2ggaXRlcmF0ZXMgb3ZlciB0aGlzIGRvY3VtZW50IGZyYWdtZW50J3MgY3VzdG9tIHByb3BlcnRpZXMuXG5cdCAqIEl0ZXJhdG9yIHByb3ZpZGVzIGBbIGtleSwgdmFsdWUgXWAgcGFpcnMgZm9yIGVhY2ggc3RvcmVkIHByb3BlcnR5LlxuXHQgKi8gKmdldEN1c3RvbVByb3BlcnRpZXMoKSB7XG4gICAgICAgIHlpZWxkKiB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzLmVudHJpZXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50I19pbnNlcnRDaGlsZCBJbnNlcnR9IGEgY2hpbGQgbm9kZSBvciBhIGxpc3Qgb2YgY2hpbGQgbm9kZXMgYXQgdGhlIGVuZFxuXHQgKiBhbmQgc2V0cyB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvIHRoaXMgZnJhZ21lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqIEByZXR1cm5zIE51bWJlciBvZiBhcHBlbmRlZCBub2Rlcy5cblx0ICovIF9hcHBlbmRDaGlsZChpdGVtcykge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5zZXJ0Q2hpbGQodGhpcy5jaGlsZENvdW50LCBpdGVtcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGNoaWxkIGF0IHRoZSBnaXZlbiBpbmRleC5cblx0ICpcblx0ICogQHBhcmFtIGluZGV4IEluZGV4IG9mIGNoaWxkLlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlLlxuXHQgKi8gZ2V0Q2hpbGQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuW2luZGV4XTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgaW5kZXggb2YgdGhlIGdpdmVuIGNoaWxkIG5vZGUuIFJldHVybnMgYC0xYCBpZiBjaGlsZCBub2RlIGlzIG5vdCBmb3VuZC5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgQ2hpbGQgbm9kZS5cblx0ICogQHJldHVybnMgSW5kZXggb2YgdGhlIGNoaWxkIG5vZGUuXG5cdCAqLyBnZXRDaGlsZEluZGV4KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmluZGV4T2Yobm9kZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGNoaWxkIG5vZGVzIGl0ZXJhdG9yLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlcyBpdGVyYXRvci5cblx0ICovIGdldENoaWxkcmVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyBhIGNoaWxkIG5vZGUgb3IgYSBsaXN0IG9mIGNoaWxkIG5vZGVzIG9uIHRoZSBnaXZlbiBpbmRleCBhbmQgc2V0cyB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvXG5cdCAqIHRoaXMgZnJhZ21lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaW5kZXggUG9zaXRpb24gd2hlcmUgbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqIEByZXR1cm5zIE51bWJlciBvZiBpbnNlcnRlZCBub2Rlcy5cblx0ICovIF9pbnNlcnRDaGlsZChpbmRleCwgaXRlbXMpIHtcbiAgICAgICAgdGhpcy5fZmlyZUNoYW5nZSgnY2hpbGRyZW4nLCB0aGlzLCB7XG4gICAgICAgICAgICBpbmRleFxuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgY29uc3Qgbm9kZXMgPSBub3JtYWxpemUkMih0aGlzLmRvY3VtZW50LCBpdGVtcyk7XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICAvLyBJZiBub2RlIHRoYXQgaXMgYmVpbmcgYWRkZWQgdG8gdGhpcyBlbGVtZW50IGlzIGFscmVhZHkgaW5zaWRlIGFub3RoZXIgZWxlbWVudCwgZmlyc3QgcmVtb3ZlIGl0IGZyb20gdGhlIG9sZCBwYXJlbnQuXG4gICAgICAgICAgICBpZiAobm9kZS5wYXJlbnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBub2RlLl9yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5vZGUucGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuX2NoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgbm9kZSk7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY291bnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIG51bWJlciBvZiBjaGlsZCBub2RlcyBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gaW5kZXggYW5kIHNldCB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvIGBudWxsYC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBpbmRleCBOdW1iZXIgb2YgdGhlIGZpcnN0IG5vZGUgdG8gcmVtb3ZlLlxuXHQgKiBAcGFyYW0gaG93TWFueSBOdW1iZXIgb2Ygbm9kZXMgdG8gcmVtb3ZlLlxuXHQgKiBAcmV0dXJucyBUaGUgYXJyYXkgb2YgcmVtb3ZlZCBub2Rlcy5cblx0ICovIF9yZW1vdmVDaGlsZHJlbihpbmRleCwgaG93TWFueSA9IDEpIHtcbiAgICAgICAgdGhpcy5fZmlyZUNoYW5nZSgnY2hpbGRyZW4nLCB0aGlzLCB7XG4gICAgICAgICAgICBpbmRleFxuICAgICAgICB9KTtcbiAgICAgICAgZm9yKGxldCBpID0gaW5kZXg7IGkgPCBpbmRleCArIGhvd01hbnk7IGkrKyl7XG4gICAgICAgICAgICB0aGlzLl9jaGlsZHJlbltpXS5wYXJlbnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIGhvd01hbnkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSB0eXBlIFR5cGUgb2YgdGhlIGNoYW5nZS5cblx0ICogQHBhcmFtIG5vZGUgQ2hhbmdlZCBub2RlLlxuXHQgKiBAcGFyYW0gZGF0YSBBZGRpdGlvbmFsIGRhdGEuXG5cdCAqIEBmaXJlcyBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlI2V2ZW50OmNoYW5nZVxuXHQgKi8gX2ZpcmVDaGFuZ2UodHlwZSwgbm9kZSwgZGF0YSkge1xuICAgICAgICB0aGlzLmZpcmUoYGNoYW5nZToke3R5cGV9YCwgbm9kZSwgZGF0YSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIGEgY3VzdG9tIHByb3BlcnR5LiBUaGV5IGNhbiBiZSB1c2VkIHRvIGFkZCBzcGVjaWFsIGRhdGEgdG8gZWxlbWVudHMuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3NldEN1c3RvbVByb3BlcnR5XG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3NldEN1c3RvbVByb3BlcnR5KGtleSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fY3VzdG9tUHJvcGVydGllcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIHRoZSBjdXN0b20gcHJvcGVydHkgc3RvcmVkIHVuZGVyIHRoZSBnaXZlbiBrZXkuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3JlbW92ZUN1c3RvbVByb3BlcnR5XG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmV0dXJucyBSZXR1cm5zIHRydWUgaWYgcHJvcGVydHkgd2FzIHJlbW92ZWQuXG5cdCAqLyBfcmVtb3ZlQ3VzdG9tUHJvcGVydHkoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jdXN0b21Qcm9wZXJ0aWVzLmRlbGV0ZShrZXkpO1xuICAgIH1cbn07XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5Eb2N1bWVudEZyYWdtZW50JDEucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnZG9jdW1lbnRGcmFnbWVudCcgfHwgdHlwZSA9PT0gJ3ZpZXc6ZG9jdW1lbnRGcmFnbWVudCc7XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBzdHJpbmdzIHRvIFRleHQgYW5kIG5vbi1pdGVyYWJsZXMgdG8gYXJyYXlzLlxuICovIGZ1bmN0aW9uIG5vcm1hbGl6ZSQyKGRvY3VtZW50LCBub2Rlcykge1xuICAgIC8vIFNlcGFyYXRlIGNvbmRpdGlvbiBiZWNhdXNlIHN0cmluZyBpcyBpdGVyYWJsZS5cbiAgICBpZiAodHlwZW9mIG5vZGVzID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgVGV4dCQxKGRvY3VtZW50LCBub2RlcylcbiAgICAgICAgXTtcbiAgICB9XG4gICAgaWYgKCFpc0l0ZXJhYmxlKG5vZGVzKSkge1xuICAgICAgICBub2RlcyA9IFtcbiAgICAgICAgICAgIG5vZGVzXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIEFycmF5LmZyb20gdG8gZW5hYmxlIC5tYXAoKSBvbiBub24tYXJyYXlzLlxuICAgIHJldHVybiBBcnJheS5mcm9tKG5vZGVzKS5tYXAoKG5vZGUpPT57XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0JDEoZG9jdW1lbnQsIG5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgVGV4dFByb3h5JDEpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGV4dCQxKGRvY3VtZW50LCBub2RlLmRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIFZpZXcgZG93bmNhc3Qgd3JpdGVyLlxuICpcbiAqIEl0IHByb3ZpZGVzIGEgc2V0IG9mIG1ldGhvZHMgdXNlZCB0byBtYW5pcHVsYXRlIHZpZXcgbm9kZXMuXG4gKlxuICogRG8gbm90IGNyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGlzIHdyaXRlciBtYW51YWxseS4gVG8gbW9kaWZ5IGEgdmlldyBzdHJ1Y3R1cmUsIHVzZVxuICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2NoYW5nZSBgVmlldyNjaGFuZ2UoKWB9IGJsb2NrLlxuICpcbiAqIFRoZSBgRG93bmNhc3RXcml0ZXJgIGlzIGRlc2lnbmVkIHRvIHdvcmsgd2l0aCBzZW1hbnRpYyB2aWV3cyB3aGljaCBhcmUgdGhlIHZpZXdzIHRoYXQgd2VyZS9hcmUgYmVpbmcgZG93bmNhc3RlZCBmcm9tIHRoZSBtb2RlbC5cbiAqIFRvIHdvcmsgd2l0aCBvcmRpbmFyeSB2aWV3cyAoZS5nLiBwYXJzZWQgZnJvbSBhIHBhc3RlZCBjb250ZW50KSB1c2UgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VwY2FzdHdyaXRlcn5VcGNhc3RXcml0ZXIgdXBjYXN0IHdyaXRlcn0uXG4gKlxuICogUmVhZCBtb3JlIGFib3V0IGNoYW5naW5nIHRoZSB2aWV3IGluIHRoZSB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjY2hhbmdpbmctdGhlLXZpZXcgQ2hhbmdpbmcgdGhlIHZpZXd9XG4gKiBzZWN0aW9uIG9mIHRoZSB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUgRWRpdGluZyBlbmdpbmUgYXJjaGl0ZWN0dXJlfSBndWlkZS5cbiAqLyBjbGFzcyBEb3duY2FzdFdyaXRlciB7XG4gICAgLyoqXG5cdCAqIFRoZSB2aWV3IGRvY3VtZW50IGluc3RhbmNlIGluIHdoaWNoIHRoaXMgd3JpdGVyIG9wZXJhdGVzLlxuXHQgKi8gZG9jdW1lbnQ7XG4gICAgLyoqXG5cdCAqIEhvbGRzIHJlZmVyZW5jZXMgdG8gdGhlIGF0dHJpYnV0ZSBncm91cHMgdGhhdCBzaGFyZSB0aGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCNpZCBpZH0uXG5cdCAqIFRoZSBrZXlzIGFyZSBgaWRgcywgdGhlIHZhbHVlcyBhcmUgYFNldGBzIGhvbGRpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9cy5cblx0ICovIF9jbG9uZUdyb3VwcyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogVGhlIHNsb3QgZmFjdG9yeSB1c2VkIGJ5IHRoZSBgZWxlbWVudFRvU3RydWN0dXJlYCBkb3duY2FzdCBoZWxwZXIuXG5cdCAqLyBfc2xvdEZhY3RvcnkgPSBudWxsO1xuICAgIC8qKlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIHZpZXcgZG9jdW1lbnQgaW5zdGFuY2UuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCl7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudDtcbiAgICB9XG4gICAgc2V0U2VsZWN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24uX3NldFRvKC4uLmFyZ3MpO1xuICAgIH1cbiAgICAvKipcblx0ICogTW92ZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiNmb2N1cyBzZWxlY3Rpb24ncyBmb2N1c30gdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbi5cblx0ICpcblx0ICogVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgaW4gdGhlIHNhbWUgZm9ybSBhcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjcmVhdGVQb3NpdGlvbkF0IHZpZXcuY3JlYXRlUG9zaXRpb25BdCgpfVxuXHQgKiBwYXJhbWV0ZXJzLlxuXHQgKlxuXHQgKiBAcGFyYW0gT2Zmc2V0IG9yIG9uZSBvZiB0aGUgZmxhZ3MuIFVzZWQgb25seSB3aGVuIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19LlxuXHQgKi8gc2V0U2VsZWN0aW9uRm9jdXMoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkge1xuICAgICAgICB0aGlzLmRvY3VtZW50LnNlbGVjdGlvbi5fc2V0Rm9jdXMoaXRlbU9yUG9zaXRpb24sIG9mZnNldCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fSBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIHRoZSBjcmVhdGVkIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKiBAcmV0dXJucyBUaGUgY3JlYXRlZCBkb2N1bWVudCBmcmFnbWVudC5cblx0ICovIGNyZWF0ZURvY3VtZW50RnJhZ21lbnQoY2hpbGRyZW4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEZyYWdtZW50JDEodGhpcy5kb2N1bWVudCwgY2hpbGRyZW4pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGV9LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIuY3JlYXRlVGV4dCggJ2ZvbycgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSB0ZXh0J3MgZGF0YS5cblx0ICogQHJldHVybnMgVGhlIGNyZWF0ZWQgdGV4dCBub2RlLlxuXHQgKi8gY3JlYXRlVGV4dChkYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGV4dCQxKHRoaXMuZG9jdW1lbnQsIGRhdGEpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudH0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KCAnc3Ryb25nJyApO1xuXHQgKiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCggJ2EnLCB7IGhyZWY6ICdmb28uYmFyJyB9ICk7XG5cdCAqXG5cdCAqIC8vIE1ha2UgYDxhPmAgZWxlbWVudCBjb250YWluIG90aGVyIGF0dHJpYnV0ZXMgZWxlbWVudCBzbyB0aGUgYDxhPmAgZWxlbWVudCBpcyBub3QgYnJva2VuLlxuXHQgKiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCggJ2EnLCB7IGhyZWY6ICdmb28uYmFyJyB9LCB7IHByaW9yaXR5OiA1IH0gKTtcblx0ICpcblx0ICogLy8gU2V0IGBpZGAgb2YgYSBtYXJrZXIgZWxlbWVudCBzbyBpdCBpcyBub3Qgam9pbmVkIG9yIG1lcmdlZCB3aXRoIFwibm9ybWFsXCIgZWxlbWVudHMuXG5cdCAqIHdyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KCAnc3BhbicsIHsgY2xhc3M6ICdteS1tYXJrZXInIH0sIHsgaWQ6ICdtYXJrZXI6bXknIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVzIEVsZW1lbnQncyBhdHRyaWJ1dGVzLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBFbGVtZW50J3Mgb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMucHJpb3JpdHkgRWxlbWVudCdzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50I3ByaW9yaXR5IHByaW9yaXR5fS5cblx0ICogQHBhcmFtIG9wdGlvbnMuaWQgRWxlbWVudCdzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50I2lkIGlkfS5cblx0ICogQHBhcmFtIG9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcyBBIGxpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGluIHRoZSBlZGl0aW5nXG5cdCAqIHBpcGVsaW5lIGV2ZW4gdGhvdWdoIHRoZXkgd291bGQgbm9ybWFsbHkgYmUgZmlsdGVyZWQgb3V0IGJ5IHVuc2FmZSBhdHRyaWJ1dGUgZGV0ZWN0aW9uIG1lY2hhbmlzbXMuXG5cdCAqIEByZXR1cm5zIENyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZUVsZW1lbnQgPSBuZXcgQXR0cmlidXRlRWxlbWVudCh0aGlzLmRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnByaW9yaXR5ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgYXR0cmlidXRlRWxlbWVudC5fcHJpb3JpdHkgPSBvcHRpb25zLnByaW9yaXR5O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmlkKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVFbGVtZW50Ll9pZCA9IG9wdGlvbnMuaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcykge1xuICAgICAgICAgICAgYXR0cmlidXRlRWxlbWVudC5fdW5zYWZlQXR0cmlidXRlc1RvUmVuZGVyLnB1c2goLi4ub3B0aW9ucy5yZW5kZXJVbnNhZmVBdHRyaWJ1dGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXR0cmlidXRlRWxlbWVudDtcbiAgICB9XG4gICAgY3JlYXRlQ29udGFpbmVyRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbk9yT3B0aW9ucyA9IHt9LCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgbGV0IGNoaWxkcmVuID0gbnVsbDtcbiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QoY2hpbGRyZW5Pck9wdGlvbnMpKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gY2hpbGRyZW5Pck9wdGlvbnM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuT3JPcHRpb25zO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckVsZW1lbnQgPSBuZXcgQ29udGFpbmVyRWxlbWVudCh0aGlzLmRvY3VtZW50LCBuYW1lLCBhdHRyaWJ1dGVzLCBjaGlsZHJlbik7XG4gICAgICAgIGlmIChvcHRpb25zLnJlbmRlclVuc2FmZUF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lckVsZW1lbnQuX3Vuc2FmZUF0dHJpYnV0ZXNUb1JlbmRlci5wdXNoKC4uLm9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lckVsZW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudH0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5jcmVhdGVFZGl0YWJsZUVsZW1lbnQoICdkaXYnICk7XG5cdCAqIHdyaXRlci5jcmVhdGVFZGl0YWJsZUVsZW1lbnQoICdkaXYnLCB7IGlkOiAnZm9vLTEyMzQnIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIE5vdGU6IFRoZSBlZGl0YWJsZSBlbGVtZW50IGlzIHRvIGJlIHVzZWQgaW4gdGhlIGVkaXRpbmcgcGlwZWxpbmUuIFVzdWFsbHksIHRvZ2V0aGVyIHdpdGhcblx0ICoge0BsaW5rIG1vZHVsZTp3aWRnZXQvdXRpbHN+dG9XaWRnZXRFZGl0YWJsZSBgdG9XaWRnZXRFZGl0YWJsZSgpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVzIEVsZW1lbnRzIGF0dHJpYnV0ZXMuXG5cdCAqIEBwYXJhbSBvcHRpb25zIEVsZW1lbnQncyBvcHRpb25zLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5yZW5kZXJVbnNhZmVBdHRyaWJ1dGVzIEEgbGlzdCBvZiBhdHRyaWJ1dGUgbmFtZXMgdGhhdCBzaG91bGQgYmUgcmVuZGVyZWQgaW4gdGhlIGVkaXRpbmdcblx0ICogcGlwZWxpbmUgZXZlbiB0aG91Z2ggdGhleSB3b3VsZCBub3JtYWxseSBiZSBmaWx0ZXJlZCBvdXQgYnkgdW5zYWZlIGF0dHJpYnV0ZSBkZXRlY3Rpb24gbWVjaGFuaXNtcy5cblx0ICogQHJldHVybnMgQ3JlYXRlZCBlbGVtZW50LlxuXHQgKi8gY3JlYXRlRWRpdGFibGVFbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBlZGl0YWJsZUVsZW1lbnQgPSBuZXcgRWRpdGFibGVFbGVtZW50KHRoaXMuZG9jdW1lbnQsIG5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgICAgICBpZiAob3B0aW9ucy5yZW5kZXJVbnNhZmVBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICBlZGl0YWJsZUVsZW1lbnQuX3Vuc2FmZUF0dHJpYnV0ZXNUb1JlbmRlci5wdXNoKC4uLm9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVkaXRhYmxlRWxlbWVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50fS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLmNyZWF0ZUVtcHR5RWxlbWVudCggJ2ltZycgKTtcblx0ICogd3JpdGVyLmNyZWF0ZUVtcHR5RWxlbWVudCggJ2ltZycsIHsgaWQ6ICdmb28tMTIzNCcgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIG5hbWUgTmFtZSBvZiB0aGUgZWxlbWVudC5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZXMgRWxlbWVudHMgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIG9wdGlvbnMgRWxlbWVudCdzIG9wdGlvbnMuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclVuc2FmZUF0dHJpYnV0ZXMgQSBsaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0aGF0IHNob3VsZCBiZSByZW5kZXJlZCBpbiB0aGUgZWRpdGluZ1xuXHQgKiBwaXBlbGluZSBldmVuIHRob3VnaCB0aGV5IHdvdWxkIG5vcm1hbGx5IGJlIGZpbHRlcmVkIG91dCBieSB1bnNhZmUgYXR0cmlidXRlIGRldGVjdGlvbiBtZWNoYW5pc21zLlxuXHQgKiBAcmV0dXJucyBDcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjcmVhdGVFbXB0eUVsZW1lbnQobmFtZSwgYXR0cmlidXRlcywgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGVtcHR5RWxlbWVudCA9IG5ldyBFbXB0eUVsZW1lbnQodGhpcy5kb2N1bWVudCwgbmFtZSwgYXR0cmlidXRlcyk7XG4gICAgICAgIGlmIChvcHRpb25zLnJlbmRlclVuc2FmZUF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIGVtcHR5RWxlbWVudC5fdW5zYWZlQXR0cmlidXRlc1RvUmVuZGVyLnB1c2goLi4ub3B0aW9ucy5yZW5kZXJVbnNhZmVBdHRyaWJ1dGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW1wdHlFbGVtZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIuY3JlYXRlVUlFbGVtZW50KCAnc3BhbicgKTtcblx0ICogd3JpdGVyLmNyZWF0ZVVJRWxlbWVudCggJ3NwYW4nLCB7IGlkOiAnZm9vLTEyMzQnIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEEgY3VzdG9tIHJlbmRlciBmdW5jdGlvbiBjYW4gYmUgcHJvdmlkZWQgYXMgdGhlIHRoaXJkIHBhcmFtZXRlcjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLmNyZWF0ZVVJRWxlbWVudCggJ3NwYW4nLCBudWxsLCBmdW5jdGlvbiggZG9tRG9jdW1lbnQgKSB7XG5cdCAqIFx0Y29uc3QgZG9tRWxlbWVudCA9IHRoaXMudG9Eb21FbGVtZW50KCBkb21Eb2N1bWVudCApO1xuXHQgKiBcdGRvbUVsZW1lbnQuaW5uZXJIVE1MID0gJzxiPnRoaXMgaXMgdWkgZWxlbWVudDwvYj4nO1xuXHQgKlxuXHQgKiBcdHJldHVybiBkb21FbGVtZW50O1xuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBVbmxpa2Uge0BsaW5rICNjcmVhdGVSYXdFbGVtZW50IHJhdyBlbGVtZW50c30sIFVJIGVsZW1lbnRzIGFyZSBieSBubyBtZWFucyBlZGl0b3IgY29udGVudCwgZm9yIGluc3RhbmNlLFxuXHQgKiB0aGV5IGFyZSBpZ25vcmVkIGJ5IHRoZSBlZGl0b3Igc2VsZWN0aW9uIHN5c3RlbS5cblx0ICpcblx0ICogWW91IHNob3VsZCBub3QgdXNlIFVJIGVsZW1lbnRzIGFzIGRhdGEgY29udGFpbmVycy4gQ2hlY2sgb3V0IHtAbGluayAjY3JlYXRlUmF3RWxlbWVudH0gaW5zdGVhZC5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVzIEVsZW1lbnQgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIHJlbmRlckZ1bmN0aW9uIEEgY3VzdG9tIHJlbmRlciBmdW5jdGlvbi5cblx0ICogQHJldHVybnMgVGhlIGNyZWF0ZWQgZWxlbWVudC5cblx0ICovIGNyZWF0ZVVJRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCByZW5kZXJGdW5jdGlvbikge1xuICAgICAgICBjb25zdCB1aUVsZW1lbnQgPSBuZXcgVUlFbGVtZW50KHRoaXMuZG9jdW1lbnQsIG5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgICAgICBpZiAocmVuZGVyRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHVpRWxlbWVudC5yZW5kZXIgPSByZW5kZXJGdW5jdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdWlFbGVtZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Jhd2VsZW1lbnR+UmF3RWxlbWVudH0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5jcmVhdGVSYXdFbGVtZW50KCAnc3BhbicsIHsgaWQ6ICdmb28tMTIzNCcgfSwgZnVuY3Rpb24oIGRvbUVsZW1lbnQgKSB7XG5cdCAqIFx0ZG9tRWxlbWVudC5pbm5lckhUTUwgPSAnPGI+VGhpcyBpcyB0aGUgcmF3IGNvbnRlbnQgb2YgdGhlIHJhdyBlbGVtZW50LjwvYj4nO1xuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBSYXcgZWxlbWVudHMgd29yayBhcyBkYXRhIGNvbnRhaW5lcnMgKFwid3JhcHBlcnNcIiwgXCJzYW5kYm94ZXNcIikgYnV0IHRoZWlyIGNoaWxkcmVuIGFyZSBub3QgbWFuYWdlZCBvclxuXHQgKiBldmVuIHJlY29nbml6ZWQgYnkgdGhlIGVkaXRvci4gVGhpcyBlbmNhcHN1bGF0aW9uIGFsbG93cyBpbnRlZ3JhdGlvbnMgdG8gbWFpbnRhaW4gY3VzdG9tIERPTSBzdHJ1Y3R1cmVzXG5cdCAqIGluIHRoZSBlZGl0b3IgY29udGVudCB3aXRob3V0LCBmb3IgaW5zdGFuY2UsIHdvcnJ5aW5nIGFib3V0IGNvbXBhdGliaWxpdHkgd2l0aCBvdGhlciBlZGl0b3IgZmVhdHVyZXMuXG5cdCAqIFJhdyBlbGVtZW50cyBhcmUgYSBwZXJmZWN0IHRvb2wgZm9yIGludGVncmF0aW9uIHdpdGggZXh0ZXJuYWwgZnJhbWV3b3JrcyBhbmQgZGF0YSBzb3VyY2VzLlxuXHQgKlxuXHQgKiBVbmxpa2Uge0BsaW5rICNjcmVhdGVVSUVsZW1lbnQgVUkgZWxlbWVudHN9LCByYXcgZWxlbWVudHMgYWN0IGxpa2UgXCJyZWFsXCIgZWRpdG9yIGNvbnRlbnQgKHNpbWlsYXIgdG9cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnR9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZW1wdHllbGVtZW50fkVtcHR5RWxlbWVudH0pLFxuXHQgKiBhbmQgdGhleSBhcmUgY29uc2lkZXJlZCBieSB0aGUgZWRpdG9yIHNlbGVjdGlvbi5cblx0ICpcblx0ICogWW91IHNob3VsZCBub3QgdXNlIHJhdyBlbGVtZW50cyB0byByZW5kZXIgdGhlIFVJIGluIHRoZSBlZGl0b3IgY29udGVudC4gQ2hlY2sgb3V0IHtAbGluayAjY3JlYXRlVUlFbGVtZW50IGAjY3JlYXRlVUlFbGVtZW50KClgfVxuXHQgKiBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgZWxlbWVudC5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZXMgRWxlbWVudCBhdHRyaWJ1dGVzLlxuXHQgKiBAcGFyYW0gcmVuZGVyRnVuY3Rpb24gQSBjdXN0b20gcmVuZGVyIGZ1bmN0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBFbGVtZW50J3Mgb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcyBBIGxpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGluIHRoZSBlZGl0aW5nXG5cdCAqIHBpcGVsaW5lIGV2ZW4gdGhvdWdoIHRoZXkgd291bGQgbm9ybWFsbHkgYmUgZmlsdGVyZWQgb3V0IGJ5IHVuc2FmZSBhdHRyaWJ1dGUgZGV0ZWN0aW9uIG1lY2hhbmlzbXMuXG5cdCAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjcmVhdGVSYXdFbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIHJlbmRlckZ1bmN0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgcmF3RWxlbWVudCA9IG5ldyBSYXdFbGVtZW50KHRoaXMuZG9jdW1lbnQsIG5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgICAgICBpZiAocmVuZGVyRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHJhd0VsZW1lbnQucmVuZGVyID0gcmVuZGVyRnVuY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucmVuZGVyVW5zYWZlQXR0cmlidXRlcykge1xuICAgICAgICAgICAgcmF3RWxlbWVudC5fdW5zYWZlQXR0cmlidXRlc1RvUmVuZGVyLnB1c2goLi4ub3B0aW9ucy5yZW5kZXJVbnNhZmVBdHRyaWJ1dGVzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmF3RWxlbWVudDtcbiAgICB9XG4gICAgc2V0QXR0cmlidXRlKGtleSwgdmFsdWUsIGVsZW1lbnRPck92ZXJ3cml0ZSwgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBlbGVtZW50Ll9zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSwgZWxlbWVudE9yT3ZlcndyaXRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVsZW1lbnRPck92ZXJ3cml0ZS5fc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZUF0dHJpYnV0ZShrZXksIGVsZW1lbnRPclRva2VucywgZWxlbWVudCkge1xuICAgICAgICBpZiAoZWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBlbGVtZW50Ll9yZW1vdmVBdHRyaWJ1dGUoa2V5LCBlbGVtZW50T3JUb2tlbnMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudE9yVG9rZW5zLl9yZW1vdmVBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBzcGVjaWZpZWQgY2xhc3MgdG8gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5hZGRDbGFzcyggJ2ZvbycsIGxpbmtFbGVtZW50ICk7XG5cdCAqIHdyaXRlci5hZGRDbGFzcyggWyAnZm9vJywgJ2JhcicgXSwgbGlua0VsZW1lbnQgKTtcblx0ICogYGBgXG5cdCAqLyBhZGRDbGFzcyhjbGFzc05hbWUsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5fYWRkQ2xhc3MoY2xhc3NOYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgc3BlY2lmaWVkIGNsYXNzIGZyb20gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5yZW1vdmVDbGFzcyggJ2ZvbycsIGxpbmtFbGVtZW50ICk7XG5cdCAqIHdyaXRlci5yZW1vdmVDbGFzcyggWyAnZm9vJywgJ2JhcicgXSwgbGlua0VsZW1lbnQgKTtcblx0ICogYGBgXG5cdCAqLyByZW1vdmVDbGFzcyhjbGFzc05hbWUsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5fcmVtb3ZlQ2xhc3MoY2xhc3NOYW1lKTtcbiAgICB9XG4gICAgc2V0U3R5bGUocHJvcGVydHksIHZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgIGlmIChpc1BsYWluT2JqZWN0KHByb3BlcnR5KSAmJiBlbGVtZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhbHVlLl9zZXRTdHlsZShwcm9wZXJ0eSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50Ll9zZXRTdHlsZShwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIHNwZWNpZmllZCBzdHlsZSBmcm9tIHRoZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIucmVtb3ZlU3R5bGUoICdjb2xvcicsIGVsZW1lbnQgKTsgLy8gUmVtb3ZlcyAnY29sb3InIHN0eWxlLlxuXHQgKiB3cml0ZXIucmVtb3ZlU3R5bGUoIFsgJ2NvbG9yJywgJ2JvcmRlci10b3AnIF0sIGVsZW1lbnQgKTsgLy8gUmVtb3ZlcyBib3RoICdjb2xvcicgYW5kICdib3JkZXItdG9wJyBzdHlsZXMuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVGhpcyBtZXRob2QgY2FuIHdvcmsgd2l0aCBub3JtYWxpemVkIHN0eWxlIG5hbWVzIGlmXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyBhIHBhcnRpY3VsYXIgc3R5bGUgcHJvY2Vzc29yIHJ1bGUgaXMgZW5hYmxlZH0uXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlc21hcH5TdHlsZXNNYXAjcmVtb3ZlIGBTdHlsZXNNYXAjcmVtb3ZlKClgfSBmb3IgZGV0YWlscy5cblx0ICovIHJlbW92ZVN0eWxlKHByb3BlcnR5LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuX3JlbW92ZVN0eWxlKHByb3BlcnR5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldHMgYSBjdXN0b20gcHJvcGVydHkgb24gZWxlbWVudC4gVW5saWtlIGF0dHJpYnV0ZXMsIGN1c3RvbSBwcm9wZXJ0aWVzIGFyZSBub3QgcmVuZGVyZWQgdG8gdGhlIERPTSxcblx0ICogc28gdGhleSBjYW4gYmUgdXNlZCB0byBhZGQgc3BlY2lhbCBkYXRhIHRvIGVsZW1lbnRzLlxuXHQgKi8gc2V0Q3VzdG9tUHJvcGVydHkoa2V5LCB2YWx1ZSwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50Ll9zZXRDdXN0b21Qcm9wZXJ0eShrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYSBjdXN0b20gcHJvcGVydHkgc3RvcmVkIHVuZGVyIHRoZSBnaXZlbiBrZXkuXG5cdCAqXG5cdCAqIEByZXR1cm5zIFJldHVybnMgdHJ1ZSBpZiBwcm9wZXJ0eSB3YXMgcmVtb3ZlZC5cblx0ICovIHJlbW92ZUN1c3RvbVByb3BlcnR5KGtleSwgZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5fcmVtb3ZlQ3VzdG9tUHJvcGVydHkoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEJyZWFrcyBhdHRyaWJ1dGUgZWxlbWVudHMgYXQgdGhlIHByb3ZpZGVkIHBvc2l0aW9uIG9yIGF0IHRoZSBib3VuZGFyaWVzIG9mIGEgcHJvdmlkZWQgcmFuZ2UuIEl0IGJyZWFrcyBhdHRyaWJ1dGUgZWxlbWVudHNcblx0ICogdXAgdG8gdGhlaXIgZmlyc3QgYW5jZXN0b3IgdGhhdCBpcyBhIGNvbnRhaW5lciBlbGVtZW50LlxuXHQgKlxuXHQgKiBJbiBmb2xsb3dpbmcgZXhhbXBsZXMgYDxwPmAgaXMgYSBjb250YWluZXIsIGA8Yj5gIGFuZCBgPHU+YCBhcmUgYXR0cmlidXRlIGVsZW1lbnRzOlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxwPmZvbzxiPjx1PmJhcnt9PC91PjwvYj48L3A+IC0+IDxwPmZvbzxiPjx1PmJhcjwvdT48L2I+W108L3A+XG5cdCAqIDxwPmZvbzxiPjx1Pnt9YmFyPC91PjwvYj48L3A+IC0+IDxwPmZvb3t9PGI+PHU+YmFyPC91PjwvYj48L3A+XG5cdCAqIDxwPmZvbzxiPjx1PmJ7fWFyPC91PjwvYj48L3A+IC0+IDxwPmZvbzxiPjx1PmI8L3U+PC9iPltdPGI+PHU+YXI8L3U+PC9iPjwvcD5cblx0ICogPHA+PGI+Zm97bzwvYj48dT5iYX1yPC91PjwvcD4gLT4gPHA+PGI+Zm88L2I+PGI+bzwvYj48dT5iYTwvdT48dT5yPC91PjwvYj48L3A+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGU6Kioge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgRG9jdW1lbnRGcmFnbWVudH0gaXMgdHJlYXRlZCBsaWtlIGEgY29udGFpbmVyLlxuXHQgKlxuXHQgKiAqKk5vdGU6KiogVGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2JyZWFrQXR0cmlidXRlcyBicmVha0F0dHJpYnV0ZXMoKX0gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYnJlYWtDb250YWluZXIgYnJlYWtDb250YWluZXIoKX0gaXMgdGhhdCBgYnJlYWtBdHRyaWJ1dGVzKClgIGJyZWFrcyBhbGxcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnRzfSB0aGF0IGFyZSBhbmNlc3RvcnMgb2YgYSBnaXZlbiBgcG9zaXRpb25gLFxuXHQgKiB1cCB0byB0aGUgZmlyc3QgZW5jb3VudGVyZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnR9LlxuXHQgKiBgYnJlYWtDb250YWluZXIoKWAgYXNzdW1lcyB0aGF0IGEgZ2l2ZW4gYHBvc2l0aW9uYCBpcyBkaXJlY3RseSBpbiB0aGUgY29udGFpbmVyIGVsZW1lbnQgYW5kIGJyZWFrcyB0aGF0IGNvbnRhaW5lciBlbGVtZW50LlxuXHQgKlxuXHQgKiBUaHJvd3MgdGhlIGB2aWV3LXdyaXRlci1pbnZhbGlkLXJhbmdlLWNvbnRhaW5lcmAge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn1cblx0ICogd2hlbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH1cblx0ICogYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0gcG9zaXRpb25zIG9mIGEgcGFzc2VkIHJhbmdlIGFyZSBub3QgcGxhY2VkIGluc2lkZSBzYW1lIHBhcmVudCBjb250YWluZXIuXG5cdCAqXG5cdCAqIFRocm93cyB0aGUgYHZpZXctd3JpdGVyLWNhbm5vdC1icmVhay1lbXB0eS1lbGVtZW50YCB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfVxuXHQgKiB3aGVuIHRyeWluZyB0byBicmVhayBhdHRyaWJ1dGVzIGluc2lkZSBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnQgRW1wdHlFbGVtZW50fS5cblx0ICpcblx0ICogVGhyb3dzIHRoZSBgdmlldy13cml0ZXItY2Fubm90LWJyZWFrLXVpLWVsZW1lbnRgIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9XG5cdCAqIHdoZW4gdHJ5aW5nIHRvIGJyZWFrIGF0dHJpYnV0ZXMgaW5zaWRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IFVJRWxlbWVudH0uXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudFxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnRcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYnJlYWtDb250YWluZXJcblx0ICogQHBhcmFtIHBvc2l0aW9uT3JSYW5nZSBUaGUgcG9zaXRpb24gd2hlcmUgdG8gYnJlYWsgYXR0cmlidXRlIGVsZW1lbnRzLlxuXHQgKiBAcmV0dXJucyBUaGUgbmV3IHBvc2l0aW9uIG9yIHJhbmdlLCBhZnRlciBicmVha2luZyB0aGUgYXR0cmlidXRlIGVsZW1lbnRzLlxuXHQgKi8gYnJlYWtBdHRyaWJ1dGVzKHBvc2l0aW9uT3JSYW5nZSkge1xuICAgICAgICBpZiAocG9zaXRpb25PclJhbmdlIGluc3RhbmNlb2YgUG9zaXRpb24kMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JyZWFrQXR0cmlidXRlcyhwb3NpdGlvbk9yUmFuZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JyZWFrQXR0cmlidXRlc1JhbmdlKHBvc2l0aW9uT3JSYW5nZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEJyZWFrcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50IGNvbnRhaW5lciB2aWV3IGVsZW1lbnR9IGludG8gdHdvLCBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqIFRoZSBwb3NpdGlvbiBoYXMgdG8gYmUgZGlyZWN0bHkgaW5zaWRlIHRoZSBjb250YWluZXIgZWxlbWVudCBhbmQgY2Fubm90IGJlIGluIHRoZSByb290LiBJdCBkb2VzIG5vdCBicmVhayB0aGUgY29ucmFpbmVyIHZpZXcgZWxlbWVudFxuXHQgKiBpZiB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvciBhdCB0aGUgZW5kIG9mIGl0cyBwYXJlbnQgZWxlbWVudC5cblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD5mb29eYmFyPC9wPiAtPiA8cD5mb288L3A+PHA+YmFyPC9wPlxuXHQgKiA8ZGl2PjxwPmZvbzwvcD5ePHA+YmFyPC9wPjwvZGl2PiAtPiA8ZGl2PjxwPmZvbzwvcD48L2Rpdj48ZGl2PjxwPmJhcjwvcD48L2Rpdj5cblx0ICogPHA+XmZvb2JhcjwvcD4gLT4gXjxwPmZvb2JhcjwvcD5cblx0ICogPHA+Zm9vYmFyXjwvcD4gLT4gPHA+Zm9vYmFyPC9wPl5cblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZToqKiBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYnJlYWtBdHRyaWJ1dGVzIGJyZWFrQXR0cmlidXRlcygpfSBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNicmVha0NvbnRhaW5lciBicmVha0NvbnRhaW5lcigpfSBpcyB0aGF0IGBicmVha0F0dHJpYnV0ZXMoKWAgYnJlYWtzIGFsbFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9IHRoYXQgYXJlIGFuY2VzdG9ycyBvZiBhIGdpdmVuIGBwb3NpdGlvbmAsXG5cdCAqIHVwIHRvIHRoZSBmaXJzdCBlbmNvdW50ZXJlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBjb250YWluZXIgZWxlbWVudH0uXG5cdCAqIGBicmVha0NvbnRhaW5lcigpYCBhc3N1bWVzIHRoYXQgdGhlIGdpdmVuIGBwb3NpdGlvbmAgaXMgZGlyZWN0bHkgaW4gdGhlIGNvbnRhaW5lciBlbGVtZW50IGFuZCBicmVha3MgdGhhdCBjb250YWluZXIgZWxlbWVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50XG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudFxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNicmVha0F0dHJpYnV0ZXNcblx0ICogQHBhcmFtIHBvc2l0aW9uIFRoZSBwb3NpdGlvbiB3aGVyZSB0byBicmVhayB0aGUgZWxlbWVudC5cblx0ICogQHJldHVybnMgVGhlIHBvc2l0aW9uIGJldHdlZW4gYnJva2VuIGVsZW1lbnRzLiBJZiBhbiBlbGVtZW50IGhhcyBub3QgYmVlbiBicm9rZW4sXG5cdCAqIHRoZSByZXR1cm5lZCBwb3NpdGlvbiBpcyBwbGFjZWQgZWl0aGVyIGJlZm9yZSBvciBhZnRlciBpdC5cblx0ICovIGJyZWFrQ29udGFpbmVyKHBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGlmICghZWxlbWVudC5pcygnY29udGFpbmVyRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRyeWluZyB0byBicmVhayBhbiBlbGVtZW50IHdoaWNoIGlzIG5vdCBhIGNvbnRhaW5lciBlbGVtZW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci1icmVhay1ub24tY29udGFpbmVyLWVsZW1lbnRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy13cml0ZXItYnJlYWstbm9uLWNvbnRhaW5lci1lbGVtZW50JywgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFlbGVtZW50LnBhcmVudCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUcnlpbmcgdG8gYnJlYWsgcm9vdCBlbGVtZW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci1icmVhay1yb290XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctd3JpdGVyLWJyZWFrLXJvb3QnLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zaXRpb24uaXNBdFN0YXJ0KSB7XG4gICAgICAgICAgICByZXR1cm4gUG9zaXRpb24kMS5fY3JlYXRlQmVmb3JlKGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKCFwb3NpdGlvbi5pc0F0RW5kKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdFbGVtZW50ID0gZWxlbWVudC5fY2xvbmUoZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQoUG9zaXRpb24kMS5fY3JlYXRlQWZ0ZXIoZWxlbWVudCksIG5ld0VsZW1lbnQpO1xuICAgICAgICAgICAgY29uc3Qgc291cmNlUmFuZ2UgPSBuZXcgUmFuZ2UkMShwb3NpdGlvbiwgUG9zaXRpb24kMS5fY3JlYXRlQXQoZWxlbWVudCwgJ2VuZCcpKTtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFBvc2l0aW9uID0gbmV3IFBvc2l0aW9uJDEobmV3RWxlbWVudCwgMCk7XG4gICAgICAgICAgICB0aGlzLm1vdmUoc291cmNlUmFuZ2UsIHRhcmdldFBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUG9zaXRpb24kMS5fY3JlYXRlQWZ0ZXIoZWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNZXJnZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnRzfS4gSXQgYWxzbyBtZXJnZXMgdGV4dCBub2RlcyBpZiBuZWVkZWQuXG5cdCAqIE9ubHkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjaXNTaW1pbGFyIHNpbWlsYXJ9IGF0dHJpYnV0ZSBlbGVtZW50cyBjYW4gYmUgbWVyZ2VkLlxuXHQgKlxuXHQgKiBJbiBmb2xsb3dpbmcgZXhhbXBsZXMgYDxwPmAgaXMgYSBjb250YWluZXIgYW5kIGA8Yj5gIGlzIGFuIGF0dHJpYnV0ZSBlbGVtZW50OlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxwPmZvb1tdYmFyPC9wPiAtPiA8cD5mb297fWJhcjwvcD5cblx0ICogPHA+PGI+Zm9vPC9iPltdPGI+YmFyPC9iPjwvcD4gLT4gPHA+PGI+Zm9ve31iYXI8L2I+PC9wPlxuXHQgKiA8cD48YiBmb289XCJiYXJcIj5hPC9iPltdPGIgZm9vPVwiYmF6XCI+YjwvYj48L3A+IC0+IDxwPjxiIGZvbz1cImJhclwiPmE8L2I+W108YiBmb289XCJiYXpcIj5iPC9iPjwvcD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEl0IHdpbGwgYWxzbyB0YWtlIGNhcmUgYWJvdXQgZW1wdHkgYXR0cmlidXRlcyB3aGVuIG1lcmdpbmc6XG5cdCAqXG5cdCAqIGBgYGh0bWxcblx0ICogPHA+PGI+W108L2I+PC9wPiAtPiA8cD5bXTwvcD5cblx0ICogPHA+PGI+Zm9vPC9iPjxpPltdPC9pPjxiPmJhcjwvYj48L3A+IC0+IDxwPjxiPmZvb3t9YmFyPC9iPjwvcD5cblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZToqKiBEaWZmZXJlbmNlIGJldHdlZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNtZXJnZUF0dHJpYnV0ZXMgbWVyZ2VBdHRyaWJ1dGVzfSBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNtZXJnZUNvbnRhaW5lcnMgbWVyZ2VDb250YWluZXJzfSBpcyB0aGF0IGBtZXJnZUF0dHJpYnV0ZXNgIG1lcmdlcyB0d29cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnRzfSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGVzfVxuXHQgKiB3aGlsZSBgbWVyZ2VDb250YWluZXJgIG1lcmdlcyB0d28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnRzfS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50XG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudFxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNtZXJnZUNvbnRhaW5lcnNcblx0ICogQHBhcmFtIHBvc2l0aW9uIE1lcmdlIHBvc2l0aW9uLlxuXHQgKiBAcmV0dXJucyBQb3NpdGlvbiBhZnRlciBtZXJnZS5cblx0ICovIG1lcmdlQXR0cmlidXRlcyhwb3NpdGlvbikge1xuICAgICAgICBjb25zdCBwb3NpdGlvbk9mZnNldCA9IHBvc2l0aW9uLm9mZnNldDtcbiAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIC8vIFdoZW4gaW5zaWRlIHRleHQgbm9kZSAtIG5vdGhpbmcgdG8gbWVyZ2UuXG4gICAgICAgIGlmIChwb3NpdGlvblBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdoZW4gaW5zaWRlIGVtcHR5IGF0dHJpYnV0ZSAtIHJlbW92ZSBpdC5cbiAgICAgICAgaWYgKHBvc2l0aW9uUGFyZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50JykgJiYgcG9zaXRpb25QYXJlbnQuY2hpbGRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gcG9zaXRpb25QYXJlbnQucGFyZW50O1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gcG9zaXRpb25QYXJlbnQuaW5kZXg7XG4gICAgICAgICAgICBwb3NpdGlvblBhcmVudC5fcmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVGcm9tQ2xvbmVkRWxlbWVudHNHcm91cChwb3NpdGlvblBhcmVudCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXJnZUF0dHJpYnV0ZXMobmV3IFBvc2l0aW9uJDEocGFyZW50LCBvZmZzZXQpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gcG9zaXRpb25QYXJlbnQuZ2V0Q2hpbGQocG9zaXRpb25PZmZzZXQgLSAxKTtcbiAgICAgICAgY29uc3Qgbm9kZUFmdGVyID0gcG9zaXRpb25QYXJlbnQuZ2V0Q2hpbGQocG9zaXRpb25PZmZzZXQpO1xuICAgICAgICAvLyBQb3NpdGlvbiBzaG91bGQgYmUgcGxhY2VkIGJldHdlZW4gdHdvIG5vZGVzLlxuICAgICAgICBpZiAoIW5vZGVCZWZvcmUgfHwgIW5vZGVBZnRlcikge1xuICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdoZW4gcG9zaXRpb24gaXMgYmV0d2VlbiB0d28gdGV4dCBub2Rlcy5cbiAgICAgICAgaWYgKG5vZGVCZWZvcmUuaXMoJyR0ZXh0JykgJiYgbm9kZUFmdGVyLmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVyZ2VUZXh0Tm9kZXMobm9kZUJlZm9yZSwgbm9kZUFmdGVyKTtcbiAgICAgICAgfSBlbHNlIGlmIChub2RlQmVmb3JlLmlzKCdhdHRyaWJ1dGVFbGVtZW50JykgJiYgbm9kZUFmdGVyLmlzKCdhdHRyaWJ1dGVFbGVtZW50JykgJiYgbm9kZUJlZm9yZS5pc1NpbWlsYXIobm9kZUFmdGVyKSkge1xuICAgICAgICAgICAgLy8gTW92ZSBhbGwgY2hpbGRyZW4gbm9kZXMgZnJvbSBub2RlIHBsYWNlZCBhZnRlciBzZWxlY3Rpb24gYW5kIHJlbW92ZSB0aGF0IG5vZGUuXG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IG5vZGVCZWZvcmUuY2hpbGRDb3VudDtcbiAgICAgICAgICAgIG5vZGVCZWZvcmUuX2FwcGVuZENoaWxkKG5vZGVBZnRlci5nZXRDaGlsZHJlbigpKTtcbiAgICAgICAgICAgIG5vZGVBZnRlci5fcmVtb3ZlKCk7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVGcm9tQ2xvbmVkRWxlbWVudHNHcm91cChub2RlQWZ0ZXIpO1xuICAgICAgICAgICAgLy8gTmV3IHBvc2l0aW9uIGlzIGxvY2F0ZWQgaW5zaWRlIHRoZSBmaXJzdCBub2RlLCBiZWZvcmUgbmV3IG5vZGVzLlxuICAgICAgICAgICAgLy8gQ2FsbCB0aGlzIG1ldGhvZCByZWN1cnNpdmVseSB0byBtZXJnZSBhZ2FpbiBpZiBuZWVkZWQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tZXJnZUF0dHJpYnV0ZXMobmV3IFBvc2l0aW9uJDEobm9kZUJlZm9yZSwgY291bnQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNZXJnZXMgdHdvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50IGNvbnRhaW5lciBlbGVtZW50c30gdGhhdCBhcmUgYmVmb3JlIGFuZCBhZnRlciBnaXZlbiBwb3NpdGlvbi5cblx0ICogUHJlY2lzZWx5LCB0aGUgZWxlbWVudCBhZnRlciB0aGUgcG9zaXRpb24gaXMgcmVtb3ZlZCBhbmQgaXQncyBjb250ZW50cyBhcmUgbW92ZWQgdG8gZWxlbWVudCBiZWZvcmUgdGhlIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxwPmZvbzwvcD5ePHA+YmFyPC9wPiAtPiA8cD5mb29eYmFyPC9wPlxuXHQgKiA8ZGl2PmZvbzwvZGl2Pl48cD5iYXI8L3A+IC0+IDxkaXY+Zm9vXmJhcjwvZGl2PlxuXHQgKiBgYGBcblx0ICpcblx0ICogKipOb3RlOioqIERpZmZlcmVuY2UgYmV0d2VlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI21lcmdlQXR0cmlidXRlcyBtZXJnZUF0dHJpYnV0ZXN9IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI21lcmdlQ29udGFpbmVycyBtZXJnZUNvbnRhaW5lcnN9IGlzIHRoYXQgYG1lcmdlQXR0cmlidXRlc2AgbWVyZ2VzIHR3b1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IHRleHQgbm9kZXN9XG5cdCAqIHdoaWxlIGBtZXJnZUNvbnRhaW5lcmAgbWVyZ2VzIHR3byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBjb250YWluZXIgZWxlbWVudHN9LlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnRcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50XG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI21lcmdlQXR0cmlidXRlc1xuXHQgKiBAcGFyYW0gcG9zaXRpb24gTWVyZ2UgcG9zaXRpb24uXG5cdCAqIEByZXR1cm5zIFBvc2l0aW9uIGFmdGVyIG1lcmdlLlxuXHQgKi8gbWVyZ2VDb250YWluZXJzKHBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IHByZXYgPSBwb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgICAgICBjb25zdCBuZXh0ID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICBpZiAoIXByZXYgfHwgIW5leHQgfHwgIXByZXYuaXMoJ2NvbnRhaW5lckVsZW1lbnQnKSB8fCAhbmV4dC5pcygnY29udGFpbmVyRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEVsZW1lbnQgYmVmb3JlIGFuZCBhZnRlciBnaXZlbiBwb3NpdGlvbiBjYW5ub3QgYmUgbWVyZ2VkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci1tZXJnZS1jb250YWluZXJzLWludmFsaWQtcG9zaXRpb25cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy13cml0ZXItbWVyZ2UtY29udGFpbmVycy1pbnZhbGlkLXBvc2l0aW9uJywgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGFzdENoaWxkID0gcHJldi5nZXRDaGlsZChwcmV2LmNoaWxkQ291bnQgLSAxKTtcbiAgICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSBsYXN0Q2hpbGQgaW5zdGFuY2VvZiBUZXh0JDEgPyBQb3NpdGlvbiQxLl9jcmVhdGVBdChsYXN0Q2hpbGQsICdlbmQnKSA6IFBvc2l0aW9uJDEuX2NyZWF0ZUF0KHByZXYsICdlbmQnKTtcbiAgICAgICAgdGhpcy5tb3ZlKFJhbmdlJDEuX2NyZWF0ZUluKG5leHQpLCBQb3NpdGlvbiQxLl9jcmVhdGVBdChwcmV2LCAnZW5kJykpO1xuICAgICAgICB0aGlzLnJlbW92ZShSYW5nZSQxLl9jcmVhdGVPbihuZXh0KSk7XG4gICAgICAgIHJldHVybiBuZXdQb3NpdGlvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgYSBub2RlIG9yIG5vZGVzIGF0IHNwZWNpZmllZCBwb3NpdGlvbi4gVGFrZXMgY2FyZSBhYm91dCBicmVha2luZyBhdHRyaWJ1dGVzIGJlZm9yZSBpbnNlcnRpb25cblx0ICogYW5kIG1lcmdpbmcgdGhlbSBhZnRlcndhcmRzLlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWluc2VydC1pbnZhbGlkLW5vZGVgIHdoZW4gbm9kZXMgdG8gaW5zZXJ0XG5cdCAqIGNvbnRhaW5zIGluc3RhbmNlcyB0aGF0IGFyZSBub3Qge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgVGV4dHN9LFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBBdHRyaWJ1dGVFbGVtZW50c30sXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50IENvbnRhaW5lckVsZW1lbnRzfSxcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IEVtcHR5RWxlbWVudHN9LFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Jhd2VsZW1lbnR+UmF3RWxlbWVudCBSYXdFbGVtZW50c30gb3Jcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IFVJRWxlbWVudHN9LlxuXHQgKlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gSW5zZXJ0aW9uIHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gbm9kZXMgTm9kZSBvciBub2RlcyB0byBpbnNlcnQuXG5cdCAqIEByZXR1cm5zIFJhbmdlIGFyb3VuZCBpbnNlcnRlZCBub2Rlcy5cblx0ICovIGluc2VydChwb3NpdGlvbiwgbm9kZXMpIHtcbiAgICAgICAgbm9kZXMgPSBpc0l0ZXJhYmxlKG5vZGVzKSA/IFtcbiAgICAgICAgICAgIC4uLm5vZGVzXG4gICAgICAgIF0gOiBbXG4gICAgICAgICAgICBub2Rlc1xuICAgICAgICBdO1xuICAgICAgICAvLyBDaGVjayBpZiBub2RlcyB0byBpbnNlcnQgYXJlIGluc3RhbmNlcyBvZiBBdHRyaWJ1dGVFbGVtZW50cywgQ29udGFpbmVyRWxlbWVudHMsIEVtcHR5RWxlbWVudHMsIFVJRWxlbWVudHMgb3IgVGV4dC5cbiAgICAgICAgdmFsaWRhdGVOb2Rlc1RvSW5zZXJ0KG5vZGVzLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgLy8gR3JvdXAgbm9kZXMgaW4gYmF0Y2hlcyBvZiBub2RlcyB0aGF0IHJlcXVpcmUgb3IgZG8gbm90IHJlcXVpcmUgYnJlYWtpbmcgYW4gQXR0cmlidXRlRWxlbWVudHMuXG4gICAgICAgIGNvbnN0IG5vZGVHcm91cHMgPSBub2Rlcy5yZWR1Y2UoKGdyb3Vwcywgbm9kZSk9PntcbiAgICAgICAgICAgIGNvbnN0IGxhc3RHcm91cCA9IGdyb3Vwc1tncm91cHMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAvLyBCcmVhayBhdHRyaWJ1dGVzIG9uIG5vZGVzIHRoYXQgZG8gZXhpc3QgaW4gdGhlIG1vZGVsIHRyZWUgc28gdGhleSBjYW4gaGF2ZSBhdHRyaWJ1dGVzLCBvdGhlciBlbGVtZW50c1xuICAgICAgICAgICAgLy8gY2FuJ3QgaGF2ZSBhbiBhdHRyaWJ1dGUgaW4gbW9kZWwgYW5kIHdvbid0IGdldCB3cmFwcGVkIHdpdGggYW4gQXR0cmlidXRlRWxlbWVudCB3aGlsZSBkb3duLWNhc3RlZC5cbiAgICAgICAgICAgIGNvbnN0IGJyZWFrQXR0cmlidXRlcyA9ICFub2RlLmlzKCd1aUVsZW1lbnQnKTtcbiAgICAgICAgICAgIGlmICghbGFzdEdyb3VwIHx8IGxhc3RHcm91cC5icmVha0F0dHJpYnV0ZXMgIT0gYnJlYWtBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBicmVha0F0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgIG5vZGVzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGFzdEdyb3VwLm5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZ3JvdXBzO1xuICAgICAgICB9LCBbXSk7XG4gICAgICAgIC8vIEluc2VydCBub2RlcyBpbiBiYXRjaGVzLlxuICAgICAgICBsZXQgc3RhcnQgPSBudWxsO1xuICAgICAgICBsZXQgZW5kID0gcG9zaXRpb247XG4gICAgICAgIGZvciAoY29uc3QgeyBub2RlcywgYnJlYWtBdHRyaWJ1dGVzIH0gb2Ygbm9kZUdyb3Vwcyl7XG4gICAgICAgICAgICBjb25zdCByYW5nZSA9IHRoaXMuX2luc2VydE5vZGVzKGVuZCwgbm9kZXMsIGJyZWFrQXR0cmlidXRlcyk7XG4gICAgICAgICAgICBpZiAoIXN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSByYW5nZS5zdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVuZCA9IHJhbmdlLmVuZDtcbiAgICAgICAgfVxuICAgICAgICAvLyBXaGVuIG5vIG5vZGVzIHdlcmUgaW5zZXJ0ZWQgLSByZXR1cm4gY29sbGFwc2VkIHJhbmdlLlxuICAgICAgICBpZiAoIXN0YXJ0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlJDEocG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgcHJvdmlkZWQgcmFuZ2UgZnJvbSB0aGUgY29udGFpbmVyLlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYCB3aGVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9IHBvc2l0aW9ucyBhcmUgbm90IHBsYWNlZCBpbnNpZGVcblx0ICogc2FtZSBwYXJlbnQgY29udGFpbmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2VPckl0ZW0gUmFuZ2UgdG8gcmVtb3ZlIGZyb20gY29udGFpbmVyXG5cdCAqIG9yIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIGl0ZW19IHRvIHJlbW92ZS4gSWYgcmFuZ2UgaXMgcHJvdmlkZWQsIGFmdGVyIHJlbW92aW5nLCBpdCB3aWxsIGJlIHVwZGF0ZWRcblx0ICogdG8gYSBjb2xsYXBzZWQgcmFuZ2Ugc2hvd2luZyB0aGUgbmV3IHBvc2l0aW9uLlxuXHQgKiBAcmV0dXJucyBEb2N1bWVudCBmcmFnbWVudCBjb250YWluaW5nIHJlbW92ZWQgbm9kZXMuXG5cdCAqLyByZW1vdmUocmFuZ2VPckl0ZW0pIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSByYW5nZU9ySXRlbSBpbnN0YW5jZW9mIFJhbmdlJDEgPyByYW5nZU9ySXRlbSA6IFJhbmdlJDEuX2NyZWF0ZU9uKHJhbmdlT3JJdGVtKTtcbiAgICAgICAgdmFsaWRhdGVSYW5nZUNvbnRhaW5lcihyYW5nZSwgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIC8vIElmIHJhbmdlIGlzIGNvbGxhcHNlZCAtIG5vdGhpbmcgdG8gcmVtb3ZlLlxuICAgICAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRGcmFnbWVudCQxKHRoaXMuZG9jdW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJyZWFrIGF0dHJpYnV0ZXMgYXQgcmFuZ2Ugc3RhcnQgYW5kIGVuZC5cbiAgICAgICAgY29uc3QgeyBzdGFydDogYnJlYWtTdGFydCwgZW5kOiBicmVha0VuZCB9ID0gdGhpcy5fYnJlYWtBdHRyaWJ1dGVzUmFuZ2UocmFuZ2UsIHRydWUpO1xuICAgICAgICBjb25zdCBwYXJlbnRDb250YWluZXIgPSBicmVha1N0YXJ0LnBhcmVudDtcbiAgICAgICAgY29uc3QgY291bnQgPSBicmVha0VuZC5vZmZzZXQgLSBicmVha1N0YXJ0Lm9mZnNldDtcbiAgICAgICAgLy8gUmVtb3ZlIG5vZGVzIGluIHJhbmdlLlxuICAgICAgICBjb25zdCByZW1vdmVkID0gcGFyZW50Q29udGFpbmVyLl9yZW1vdmVDaGlsZHJlbihicmVha1N0YXJ0Lm9mZnNldCwgY291bnQpO1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgcmVtb3ZlZCl7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVGcm9tQ2xvbmVkRWxlbWVudHNHcm91cChub2RlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBNZXJnZSBhZnRlciByZW1vdmluZy5cbiAgICAgICAgY29uc3QgbWVyZ2VQb3NpdGlvbiA9IHRoaXMubWVyZ2VBdHRyaWJ1dGVzKGJyZWFrU3RhcnQpO1xuICAgICAgICByYW5nZS5zdGFydCA9IG1lcmdlUG9zaXRpb247XG4gICAgICAgIHJhbmdlLmVuZCA9IG1lcmdlUG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgLy8gUmV0dXJuIHJlbW92ZWQgbm9kZXMuXG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRGcmFnbWVudCQxKHRoaXMuZG9jdW1lbnQsIHJlbW92ZWQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBtYXRjaGluZyBlbGVtZW50cyBmcm9tIGdpdmVuIHJhbmdlLlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYCB3aGVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9IHBvc2l0aW9ucyBhcmUgbm90IHBsYWNlZCBpbnNpZGVcblx0ICogc2FtZSBwYXJlbnQgY29udGFpbmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2UgUmFuZ2UgdG8gY2xlYXIuXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gcmVtb3ZlLlxuXHQgKi8gY2xlYXIocmFuZ2UsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFsaWRhdGVSYW5nZUNvbnRhaW5lcihyYW5nZSwgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIC8vIENyZWF0ZSB3YWxrZXIgb24gZ2l2ZW4gcmFuZ2UuXG4gICAgICAgIC8vIFdlIHdhbGsgYmFja3dhcmQgYmVjYXVzZSB3aGVuIHdlIHJlbW92ZSBlbGVtZW50IGR1cmluZyB3YWxrIGl0IG1vZGlmaWVzIHJhbmdlIGVuZCBwb3NpdGlvbi5cbiAgICAgICAgY29uc3Qgd2Fsa2VyID0gcmFuZ2UuZ2V0V2Fsa2VyKHtcbiAgICAgICAgICAgIGRpcmVjdGlvbjogJ2JhY2t3YXJkJyxcbiAgICAgICAgICAgIGlnbm9yZUVsZW1lbnRFbmQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIExldCdzIHdhbGsuXG4gICAgICAgIGZvciAoY29uc3QgY3VycmVudCBvZiB3YWxrZXIpe1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGN1cnJlbnQuaXRlbTtcbiAgICAgICAgICAgIGxldCByYW5nZVRvUmVtb3ZlO1xuICAgICAgICAgICAgLy8gV2hlbiBjdXJyZW50IGl0ZW0gbWF0Y2hlcyB0byB0aGUgZ2l2ZW4gZWxlbWVudC5cbiAgICAgICAgICAgIGlmIChpdGVtLmlzKCdlbGVtZW50JykgJiYgZWxlbWVudC5pc1NpbWlsYXIoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgcmFuZ2Ugb24gdGhpcyBlbGVtZW50LlxuICAgICAgICAgICAgICAgIHJhbmdlVG9SZW1vdmUgPSBSYW5nZSQxLl9jcmVhdGVPbihpdGVtKTtcbiAgICAgICAgICAgIC8vIFdoZW4gcmFuZ2Ugc3RhcnRzIGluc2lkZSBUZXh0IG9yIFRleHRQcm94eSBlbGVtZW50LlxuICAgICAgICAgICAgfSBlbHNlIGlmICghY3VycmVudC5uZXh0UG9zaXRpb24uaXNBZnRlcihyYW5nZS5zdGFydCkgJiYgaXRlbS5pcygnJHRleHRQcm94eScpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjaGVjayBpZiBwYXJlbnQgb2YgdGhpcyB0ZXh0IG1hdGNoZXMgdG8gZ2l2ZW4gZWxlbWVudC5cbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRFbGVtZW50ID0gaXRlbS5nZXRBbmNlc3RvcnMoKS5maW5kKChhbmNlc3Rvcik9PntcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFuY2VzdG9yLmlzKCdlbGVtZW50JykgJiYgZWxlbWVudC5pc1NpbWlsYXIoYW5jZXN0b3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIElmIGl0IGlzIHRoZW4gY3JlYXRlIHJhbmdlIGluc2lkZSB0aGlzIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VUb1JlbW92ZSA9IFJhbmdlJDEuX2NyZWF0ZUluKHBhcmVudEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgZm91bmQgZWxlbWVudCB0byByZW1vdmUuXG4gICAgICAgICAgICBpZiAocmFuZ2VUb1JlbW92ZSkge1xuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY2hlY2sgaWYgZWxlbWVudCByYW5nZSBzdGljayBvdXQgb2YgdGhlIGdpdmVuIHJhbmdlIGFuZCB0cnVuY2F0ZSBpZiBpdCBpcy5cbiAgICAgICAgICAgICAgICBpZiAocmFuZ2VUb1JlbW92ZS5lbmQuaXNBZnRlcihyYW5nZS5lbmQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlVG9SZW1vdmUuZW5kID0gcmFuZ2UuZW5kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmFuZ2VUb1JlbW92ZS5zdGFydC5pc0JlZm9yZShyYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VUb1JlbW92ZS5zdGFydCA9IHJhbmdlLnN0YXJ0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBBdCB0aGUgZW5kIHdlIHJlbW92ZSByYW5nZSB3aXRoIGZvdW5kIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2VUb1JlbW92ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIG5vZGVzIGZyb20gcHJvdmlkZWQgcmFuZ2UgdG8gdGFyZ2V0IHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYCB3aGVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9IHBvc2l0aW9ucyBhcmUgbm90IHBsYWNlZCBpbnNpZGVcblx0ICogc2FtZSBwYXJlbnQgY29udGFpbmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gc291cmNlUmFuZ2UgUmFuZ2UgY29udGFpbmluZyBub2RlcyB0byBtb3ZlLlxuXHQgKiBAcGFyYW0gdGFyZ2V0UG9zaXRpb24gUG9zaXRpb24gdG8gaW5zZXJ0LlxuXHQgKiBAcmV0dXJucyBSYW5nZSBpbiB0YXJnZXQgY29udGFpbmVyLiBJbnNlcnRlZCBub2RlcyBhcmUgcGxhY2VkIGJldHdlZW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0gcG9zaXRpb25zLlxuXHQgKi8gbW92ZShzb3VyY2VSYW5nZSwgdGFyZ2V0UG9zaXRpb24pIHtcbiAgICAgICAgbGV0IG5vZGVzO1xuICAgICAgICBpZiAodGFyZ2V0UG9zaXRpb24uaXNBZnRlcihzb3VyY2VSYW5nZS5lbmQpKSB7XG4gICAgICAgICAgICB0YXJnZXRQb3NpdGlvbiA9IHRoaXMuX2JyZWFrQXR0cmlidXRlcyh0YXJnZXRQb3NpdGlvbiwgdHJ1ZSk7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0YXJnZXRQb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgICAgICBjb25zdCBjb3VudEJlZm9yZSA9IHBhcmVudC5jaGlsZENvdW50O1xuICAgICAgICAgICAgc291cmNlUmFuZ2UgPSB0aGlzLl9icmVha0F0dHJpYnV0ZXNSYW5nZShzb3VyY2VSYW5nZSwgdHJ1ZSk7XG4gICAgICAgICAgICBub2RlcyA9IHRoaXMucmVtb3ZlKHNvdXJjZVJhbmdlKTtcbiAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uLm9mZnNldCArPSBwYXJlbnQuY2hpbGRDb3VudCAtIGNvdW50QmVmb3JlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9kZXMgPSB0aGlzLnJlbW92ZShzb3VyY2VSYW5nZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0KHRhcmdldFBvc2l0aW9uLCBub2Rlcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBXcmFwcyBlbGVtZW50cyB3aXRoaW4gcmFuZ2Ugd2l0aCBwcm92aWRlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBBdHRyaWJ1dGVFbGVtZW50fS5cblx0ICogSWYgYSBjb2xsYXBzZWQgcmFuZ2UgaXMgcHJvdmlkZWQsIGl0IHdpbGwgYmUgd3JhcHBlZCBvbmx5IGlmIGl0IGlzIGVxdWFsIHRvIHZpZXcgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBJZiBhIGNvbGxhcHNlZCByYW5nZSB3YXMgcGFzc2VkIGFuZCBpcyBzYW1lIGFzIHNlbGVjdGlvbiwgdGhlIHNlbGVjdGlvblxuXHQgKiB3aWxsIGJlIG1vdmVkIHRvIHRoZSBpbnNpZGUgb2YgdGhlIHdyYXBwZWQgYXR0cmlidXRlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYFxuXHQgKiB3aGVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnR9XG5cdCAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZH0gcG9zaXRpb25zIGFyZSBub3QgcGxhY2VkIGluc2lkZSBzYW1lIHBhcmVudCBjb250YWluZXIuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLXdyYXAtaW52YWxpZC1hdHRyaWJ1dGVgIHdoZW4gcGFzc2VkIGF0dHJpYnV0ZSBlbGVtZW50IGlzIG5vdFxuXHQgKiBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBBdHRyaWJ1dGVFbGVtZW50fS5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yfSBgdmlldy13cml0ZXItd3JhcC1ub25zZWxlY3Rpb24tY29sbGFwc2VkLXJhbmdlYCB3aGVuIHBhc3NlZCByYW5nZVxuXHQgKiBpcyBjb2xsYXBzZWQgYW5kIGRpZmZlcmVudCB0aGFuIHZpZXcgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2UgUmFuZ2UgdG8gd3JhcC5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZSBBdHRyaWJ1dGUgZWxlbWVudCB0byB1c2UgYXMgd3JhcHBlci5cblx0ICogQHJldHVybnMgcmFuZ2UgUmFuZ2UgYWZ0ZXIgd3JhcHBpbmcsIHNwYW5uaW5nIG92ZXIgd3JhcHBpbmcgYXR0cmlidXRlIGVsZW1lbnQuXG5cdCAqLyB3cmFwKHJhbmdlLCBhdHRyaWJ1dGUpIHtcbiAgICAgICAgaWYgKCEoYXR0cmlidXRlIGluc3RhbmNlb2YgQXR0cmlidXRlRWxlbWVudCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXdyaXRlci13cmFwLWludmFsaWQtYXR0cmlidXRlJywgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFsaWRhdGVSYW5nZUNvbnRhaW5lcihyYW5nZSwgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIGlmICghcmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIC8vIE5vbi1jb2xsYXBzZWQgcmFuZ2UuIFdyYXAgaXQgd2l0aCB0aGUgYXR0cmlidXRlIGVsZW1lbnQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JhcFJhbmdlKHJhbmdlLCBhdHRyaWJ1dGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ29sbGFwc2VkIHJhbmdlLiBXcmFwIHBvc2l0aW9uLlxuICAgICAgICAgICAgbGV0IHBvc2l0aW9uID0gcmFuZ2Uuc3RhcnQ7XG4gICAgICAgICAgICBpZiAocG9zaXRpb24ucGFyZW50LmlzKCdlbGVtZW50JykgJiYgIV9oYXNOb25VaUNoaWxkcmVuKHBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uLmdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCh2YWx1ZSk9PnZhbHVlLml0ZW0uaXMoJ3VpRWxlbWVudCcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5fd3JhcFBvc2l0aW9uKHBvc2l0aW9uLCBhdHRyaWJ1dGUpO1xuICAgICAgICAgICAgY29uc3Qgdmlld1NlbGVjdGlvbiA9IHRoaXMuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgLy8gSWYgd3JhcHBpbmcgcG9zaXRpb24gaXMgZXF1YWwgdG8gdmlldyBzZWxlY3Rpb24sIG1vdmUgdmlldyBzZWxlY3Rpb24gaW5zaWRlIHdyYXBwaW5nIGF0dHJpYnV0ZSBlbGVtZW50LlxuICAgICAgICAgICAgaWYgKHZpZXdTZWxlY3Rpb24uaXNDb2xsYXBzZWQgJiYgdmlld1NlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkuaXNFcXVhbChyYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbihwb3NpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlJDEocG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbndyYXBzIG5vZGVzIHdpdGhpbiBwcm92aWRlZCByYW5nZSBmcm9tIGF0dHJpYnV0ZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYCB3aGVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI2VuZCBlbmR9IHBvc2l0aW9ucyBhcmUgbm90IHBsYWNlZCBpbnNpZGVcblx0ICogc2FtZSBwYXJlbnQgY29udGFpbmVyLlxuXHQgKi8gdW53cmFwKHJhbmdlLCBhdHRyaWJ1dGUpIHtcbiAgICAgICAgaWYgKCEoYXR0cmlidXRlIGluc3RhbmNlb2YgQXR0cmlidXRlRWxlbWVudCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhlIGBhdHRyaWJ1dGVgIHBhc3NlZCB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3Vud3JhcCBgRG93bmNhc3RXcml0ZXIjdW53cmFwKClgfVxuXHRcdFx0ICogbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBgQXR0cmlidXRlRWxlbWVudGB9LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci11bndyYXAtaW52YWxpZC1hdHRyaWJ1dGVcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy13cml0ZXItdW53cmFwLWludmFsaWQtYXR0cmlidXRlJywgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFsaWRhdGVSYW5nZUNvbnRhaW5lcihyYW5nZSwgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIC8vIElmIHJhbmdlIGlzIGNvbGxhcHNlZCAtIG5vdGhpbmcgdG8gdW53cmFwLlxuICAgICAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiByYW5nZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCcmVhayBhdHRyaWJ1dGVzIGF0IHJhbmdlIHN0YXJ0IGFuZCBlbmQuXG4gICAgICAgIGNvbnN0IHsgc3RhcnQ6IGJyZWFrU3RhcnQsIGVuZDogYnJlYWtFbmQgfSA9IHRoaXMuX2JyZWFrQXR0cmlidXRlc1JhbmdlKHJhbmdlLCB0cnVlKTtcbiAgICAgICAgY29uc3QgcGFyZW50Q29udGFpbmVyID0gYnJlYWtTdGFydC5wYXJlbnQ7XG4gICAgICAgIC8vIFVud3JhcCBjaGlsZHJlbiBsb2NhdGVkIGJldHdlZW4gYnJlYWsgcG9pbnRzLlxuICAgICAgICBjb25zdCBuZXdSYW5nZSA9IHRoaXMuX3Vud3JhcENoaWxkcmVuKHBhcmVudENvbnRhaW5lciwgYnJlYWtTdGFydC5vZmZzZXQsIGJyZWFrRW5kLm9mZnNldCwgYXR0cmlidXRlKTtcbiAgICAgICAgLy8gTWVyZ2UgYXR0cmlidXRlcyBhdCB0aGUgYm90aCBlbmRzIGFuZCByZXR1cm4gYSBuZXcgcmFuZ2UuXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5tZXJnZUF0dHJpYnV0ZXMobmV3UmFuZ2Uuc3RhcnQpO1xuICAgICAgICAvLyBJZiBzdGFydCBwb3NpdGlvbiB3YXMgbWVyZ2VkIC0gbW92ZSBlbmQgcG9zaXRpb24gYmFjay5cbiAgICAgICAgaWYgKCFzdGFydC5pc0VxdWFsKG5ld1JhbmdlLnN0YXJ0KSkge1xuICAgICAgICAgICAgbmV3UmFuZ2UuZW5kLm9mZnNldC0tO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVuZCA9IHRoaXMubWVyZ2VBdHRyaWJ1dGVzKG5ld1JhbmdlLmVuZCk7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbmFtZXMgZWxlbWVudCBieSBjcmVhdGluZyBhIGNvcHkgb2YgcmVuYW1lZCBlbGVtZW50IGJ1dCB3aXRoIGNoYW5nZWQgbmFtZSBhbmQgdGhlbiBtb3ZpbmcgY29udGVudHMgb2YgdGhlXG5cdCAqIG9sZCBlbGVtZW50IHRvIHRoZSBuZXcgb25lLiBLZWVwIGluIG1pbmQgdGhhdCB0aGlzIHdpbGwgaW52YWxpZGF0ZSBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbnN9IHdoaWNoXG5cdCAqIGhhcyByZW5hbWVkIGVsZW1lbnQgYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbiNwYXJlbnQgYSBwYXJlbnR9LlxuXHQgKlxuXHQgKiBOZXcgZWxlbWVudCBoYXMgdG8gYmUgY3JlYXRlZCBiZWNhdXNlIGBFbGVtZW50I3RhZ05hbWVgIHByb3BlcnR5IGluIERPTSBpcyByZWFkb25seS5cblx0ICpcblx0ICogU2luY2UgdGhpcyBmdW5jdGlvbiBjcmVhdGVzIGEgbmV3IGVsZW1lbnQgYW5kIHJlbW92ZXMgdGhlIGdpdmVuIG9uZSwgdGhlIG5ldyBlbGVtZW50IGlzIHJldHVybmVkIHRvIGtlZXAgcmVmZXJlbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gbmV3TmFtZSBOZXcgbmFtZSBmb3IgZWxlbWVudC5cblx0ICogQHBhcmFtIHZpZXdFbGVtZW50IEVsZW1lbnQgdG8gYmUgcmVuYW1lZC5cblx0ICogQHJldHVybnMgRWxlbWVudCBjcmVhdGVkIGR1ZSB0byByZW5hbWUuXG5cdCAqLyByZW5hbWUobmV3TmFtZSwgdmlld0VsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9IG5ldyBDb250YWluZXJFbGVtZW50KHRoaXMuZG9jdW1lbnQsIG5ld05hbWUsIHZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZXMoKSk7XG4gICAgICAgIHRoaXMuaW5zZXJ0KFBvc2l0aW9uJDEuX2NyZWF0ZUFmdGVyKHZpZXdFbGVtZW50KSwgbmV3RWxlbWVudCk7XG4gICAgICAgIHRoaXMubW92ZShSYW5nZSQxLl9jcmVhdGVJbih2aWV3RWxlbWVudCksIFBvc2l0aW9uJDEuX2NyZWF0ZUF0KG5ld0VsZW1lbnQsIDApKTtcbiAgICAgICAgdGhpcy5yZW1vdmUoUmFuZ2UkMS5fY3JlYXRlT24odmlld0VsZW1lbnQpKTtcbiAgICAgICAgcmV0dXJuIG5ld0VsZW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDbGVhbnMgdXAgbWVtb3J5IGJ5IHJlbW92aW5nIG9ic29sZXRlIGNsb25lZCBlbGVtZW50cyBncm91cCBmcm9tIHRoZSB3cml0ZXIuXG5cdCAqXG5cdCAqIFNob3VsZCBiZSB1c2VkIHdoZW5ldmVyIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9XG5cdCAqIHdpdGggdGhlIHNhbWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjaWQgaWR9IGFyZSBnb2luZyB0byBiZSByZW1vdmVkIGZyb20gdGhlIHZpZXcgYW5kXG5cdCAqIHRoZSBncm91cCB3aWxsIG5vIGxvbmdlciBiZSBuZWVkZWQuXG5cdCAqXG5cdCAqIENsb25lZCBlbGVtZW50cyBncm91cCBhcmUgbm90IHJlbW92ZWQgYXV0b21hdGljYWxseSBpbiBjYXNlIGlmIHRoZSBncm91cCBpcyBzdGlsbCBuZWVkZWQgYWZ0ZXIgYWxsIGl0cyBlbGVtZW50c1xuXHQgKiB3ZXJlIHJlbW92ZWQgZnJvbSB0aGUgdmlldy5cblx0ICpcblx0ICogS2VlcCBpbiBtaW5kIHRoYXQgZ3JvdXAgbmFtZXMgYXJlIGVxdWFsIHRvIHRoZSBgaWRgIHByb3BlcnR5IG9mIHRoZSBhdHRyaWJ1dGUgZWxlbWVudC5cblx0ICpcblx0ICogQHBhcmFtIGdyb3VwTmFtZSBOYW1lIG9mIHRoZSBncm91cCB0byBjbGVhci5cblx0ICovIGNsZWFyQ2xvbmVkRWxlbWVudHNHcm91cChncm91cE5hbWUpIHtcbiAgICAgICAgdGhpcy5fY2xvbmVHcm91cHMuZGVsZXRlKGdyb3VwTmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIHBvc2l0aW9uIGF0IHRoZSBnaXZlbiBsb2NhdGlvbi4gVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgYXM6XG5cdCAqXG5cdCAqICogYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSxcblx0ICogKiBwYXJlbnQgZWxlbWVudCBhbmQgb2Zmc2V0IChvZmZzZXQgZGVmYXVsdHMgdG8gYDBgKSxcblx0ICogKiBwYXJlbnQgZWxlbWVudCBhbmQgYCdlbmQnYCAoc2V0cyBwb3NpdGlvbiBhdCB0aGUgZW5kIG9mIHRoYXQgZWxlbWVudCksXG5cdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgYCdiZWZvcmUnYCBvciBgJ2FmdGVyJ2AgKHNldHMgcG9zaXRpb24gYmVmb3JlIG9yIGFmdGVyIGdpdmVuIHZpZXcgaXRlbSkuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIGEgc2hvcnRjdXQgdG8gb3RoZXIgY29uc3RydWN0b3JzIHN1Y2ggYXM6XG5cdCAqXG5cdCAqICoge0BsaW5rICNjcmVhdGVQb3NpdGlvbkJlZm9yZX0sXG5cdCAqICoge0BsaW5rICNjcmVhdGVQb3NpdGlvbkFmdGVyfSxcblx0ICpcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvaXRlbX5JdGVtIHZpZXcgaXRlbX0uXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIFBvc2l0aW9uJDEuX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBwb3NpdGlvbiBhZnRlciBnaXZlbiB2aWV3IGl0ZW0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIFZpZXcgaXRlbSBhZnRlciB3aGljaCB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGxvY2F0ZWQuXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkFmdGVyKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIFBvc2l0aW9uJDEuX2NyZWF0ZUFmdGVyKGl0ZW0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBwb3NpdGlvbiBiZWZvcmUgZ2l2ZW4gdmlldyBpdGVtLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbSBWaWV3IGl0ZW0gYmVmb3JlIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgbG9jYXRlZC5cblx0ICovIGNyZWF0ZVBvc2l0aW9uQmVmb3JlKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZShpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSBzcGFubmluZyBmcm9tIGBzdGFydGAgcG9zaXRpb24gdG8gYGVuZGAgcG9zaXRpb24uXG5cdCAqXG5cdCAqICoqTm90ZToqKiBUaGlzIGZhY3RvcnkgbWV0aG9kIGNyZWF0ZXMgaXRzIG93biB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufSBpbnN0YW5jZXMgYmFzaW5nIG9uIHBhc3NlZCB2YWx1ZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBzdGFydCBTdGFydCBwb3NpdGlvbi5cblx0ICogQHBhcmFtIGVuZCBFbmQgcG9zaXRpb24uIElmIG5vdCBzZXQsIHJhbmdlIHdpbGwgYmUgY29sbGFwc2VkIGF0IGBzdGFydGAgcG9zaXRpb24uXG5cdCAqLyBjcmVhdGVSYW5nZShzdGFydCwgZW5kKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSB0aGF0IHN0YXJ0cyBiZWZvcmUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgZW5kcyBhZnRlciBpdC5cblx0ICovIGNyZWF0ZVJhbmdlT24oaXRlbSkge1xuICAgICAgICByZXR1cm4gUmFuZ2UkMS5fY3JlYXRlT24oaXRlbSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGZpcnN0IGNoaWxkIG9mXG5cdCAqIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgd2hpY2ggaXMgYSBwYXJlbnQgZm9yIHRoZSByYW5nZS5cblx0ICovIGNyZWF0ZVJhbmdlSW4oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gUmFuZ2UkMS5fY3JlYXRlSW4oZWxlbWVudCk7XG4gICAgfVxuICAgIGNyZWF0ZVNlbGVjdGlvbiguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBuZXcgU2VsZWN0aW9uJDEoLi4uYXJncyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIHBsYWNlaG9sZGVycyBmb3IgY2hpbGQgZWxlbWVudHMgb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkRvd25jYXN0SGVscGVycyNlbGVtZW50VG9TdHJ1Y3R1cmVcblx0ICogYGVsZW1lbnRUb1N0cnVjdHVyZSgpYH0gY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IHZpZXdTbG90ID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlU2xvdCgpO1xuXHQgKiBjb25zdCB2aWV3UG9zaXRpb24gPSBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCB2aWV3RWxlbWVudCwgMCApO1xuXHQgKlxuXHQgKiBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQoIHZpZXdQb3NpdGlvbiwgdmlld1Nsb3QgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEl0IGNvdWxkIGJlIGZpbHRlcmVkIGRvd24gdG8gYSBzcGVjaWZpYyBzdWJzZXQgb2YgY2hpbGRyZW4gKG9ubHkgYDxmb28+YCBtb2RlbCBlbGVtZW50cyBpbiB0aGlzIGNhc2UpOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCB2aWV3U2xvdCA9IGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZVNsb3QoIG5vZGUgPT4gbm9kZS5pcyggJ2VsZW1lbnQnLCAnZm9vJyApICk7XG5cdCAqIGNvbnN0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHZpZXdFbGVtZW50LCAwICk7XG5cdCAqXG5cdCAqIGNvbnZlcnNpb25BcGkud3JpdGVyLmluc2VydCggdmlld1Bvc2l0aW9uLCB2aWV3U2xvdCApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogV2hpbGUgcHJvdmlkaW5nIGEgZmlsdGVyZWQgc2xvdCwgbWFrZSBzdXJlIHRvIHByb3ZpZGUgc2xvdHMgZm9yIGFsbCBjaGlsZCBub2Rlcy4gQSBzaW5nbGUgbm9kZSBjYW4gbm90IGJlIGRvd25jYXN0ZWQgaW50b1xuXHQgKiBtdWx0aXBsZSBzbG90cy5cblx0ICpcblx0ICogKipOb3RlKio6IFlvdSBzaG91bGQgbm90IGNoYW5nZSB0aGUgb3JkZXIgb2Ygbm9kZXMuIFZpZXcgZWxlbWVudHMgc2hvdWxkIGJlIGluIHRoZSBzYW1lIG9yZGVyIGFzIG1vZGVsIG5vZGVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gbW9kZU9yRmlsdGVyIFRoZSBmaWx0ZXIgZm9yIGNoaWxkIG5vZGVzLlxuXHQgKiBAcmV0dXJucyBUaGUgc2xvdCBlbGVtZW50IHRvIGJlIHBsYWNlZCBpbiB0byB0aGUgdmlldyBzdHJ1Y3R1cmUgd2hpbGUgcHJvY2Vzc2luZ1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjZWxlbWVudFRvU3RydWN0dXJlIGBlbGVtZW50VG9TdHJ1Y3R1cmUoKWB9LlxuXHQgKi8gY3JlYXRlU2xvdChtb2RlT3JGaWx0ZXIgPSAnY2hpbGRyZW4nKSB7XG4gICAgICAgIGlmICghdGhpcy5fc2xvdEZhY3RvcnkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhlIGBjcmVhdGVTbG90KClgIG1ldGhvZCBpcyBvbmx5IGFsbG93ZWQgaW5zaWRlIHRoZSBgZWxlbWVudFRvU3RydWN0dXJlYCBkb3duY2FzdCBoZWxwZXIgY2FsbGJhY2suXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctd3JpdGVyLWludmFsaWQtY3JlYXRlLXNsb3QtY29udGV4dFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXdyaXRlci1pbnZhbGlkLWNyZWF0ZS1zbG90LWNvbnRleHQnLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fc2xvdEZhY3RvcnkodGhpcywgbW9kZU9yRmlsdGVyKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIHNsb3QgZmFjdG9yeS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBzbG90RmFjdG9yeSBUaGUgc2xvdCBmYWN0b3J5LlxuXHQgKi8gX3JlZ2lzdGVyU2xvdEZhY3Rvcnkoc2xvdEZhY3RvcnkpIHtcbiAgICAgICAgdGhpcy5fc2xvdEZhY3RvcnkgPSBzbG90RmFjdG9yeTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsZWFycyB0aGUgcmVnaXN0ZXJlZCBzbG90IGZhY3RvcnkuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2NsZWFyU2xvdEZhY3RvcnkoKSB7XG4gICAgICAgIHRoaXMuX3Nsb3RGYWN0b3J5ID0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgYSBub2RlIG9yIG5vZGVzIGF0IHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uIFRha2VzIGNhcmUgb2YgYnJlYWtpbmcgYXR0cmlidXRlcyBiZWZvcmUgaW5zZXJ0aW9uXG5cdCAqIGFuZCBtZXJnaW5nIHRoZW0gYWZ0ZXJ3YXJkcyBpZiByZXF1ZXN0ZWQgYnkgdGhlIGJyZWFrQXR0cmlidXRlcyBwYXJhbS5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIEluc2VydGlvbiBwb3NpdGlvbi5cblx0ICogQHBhcmFtIG5vZGVzIE5vZGUgb3Igbm9kZXMgdG8gaW5zZXJ0LlxuXHQgKiBAcGFyYW0gYnJlYWtBdHRyaWJ1dGVzIFdoZXRoZXIgYXR0cmlidXRlcyBzaG91bGQgYmUgYnJva2VuLlxuXHQgKiBAcmV0dXJucyBSYW5nZSBhcm91bmQgaW5zZXJ0ZWQgbm9kZXMuXG5cdCAqLyBfaW5zZXJ0Tm9kZXMocG9zaXRpb24sIG5vZGVzLCBicmVha0F0dHJpYnV0ZXMpIHtcbiAgICAgICAgbGV0IHBhcmVudEVsZW1lbnQ7XG4gICAgICAgIC8vIEJyZWFrIGF0dHJpYnV0ZXMgb24gbm9kZXMgdGhhdCBkbyBleGlzdCBpbiB0aGUgbW9kZWwgdHJlZSBzbyB0aGV5IGNhbiBoYXZlIGF0dHJpYnV0ZXMsIG90aGVyIGVsZW1lbnRzXG4gICAgICAgIC8vIGNhbid0IGhhdmUgYW4gYXR0cmlidXRlIGluIG1vZGVsIGFuZCB3b24ndCBnZXQgd3JhcHBlZCB3aXRoIGFuIEF0dHJpYnV0ZUVsZW1lbnQgd2hpbGUgZG93bi1jYXN0ZWQuXG4gICAgICAgIGlmIChicmVha0F0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIHBhcmVudEVsZW1lbnQgPSBnZXRQYXJlbnRDb250YWluZXIocG9zaXRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFyZW50RWxlbWVudCA9IHBvc2l0aW9uLnBhcmVudC5pcygnJHRleHQnKSA/IHBvc2l0aW9uLnBhcmVudC5wYXJlbnQgOiBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwYXJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFBvc2l0aW9uJ3MgcGFyZW50IGNvbnRhaW5lciBjYW5ub3QgYmUgZm91bmQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctd3JpdGVyLWludmFsaWQtcG9zaXRpb24tY29udGFpbmVyXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3ZpZXctd3JpdGVyLWludmFsaWQtcG9zaXRpb24tY29udGFpbmVyJywgdGhpcy5kb2N1bWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGluc2VydGlvblBvc2l0aW9uO1xuICAgICAgICBpZiAoYnJlYWtBdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICBpbnNlcnRpb25Qb3NpdGlvbiA9IHRoaXMuX2JyZWFrQXR0cmlidXRlcyhwb3NpdGlvbiwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnNlcnRpb25Qb3NpdGlvbiA9IHBvc2l0aW9uLnBhcmVudC5pcygnJHRleHQnKSA/IGJyZWFrVGV4dE5vZGUocG9zaXRpb24pIDogcG9zaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVuZ3RoID0gcGFyZW50RWxlbWVudC5faW5zZXJ0Q2hpbGQoaW5zZXJ0aW9uUG9zaXRpb24ub2Zmc2V0LCBub2Rlcyk7XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICB0aGlzLl9hZGRUb0Nsb25lZEVsZW1lbnRzR3JvdXAobm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW5kUG9zaXRpb24gPSBpbnNlcnRpb25Qb3NpdGlvbi5nZXRTaGlmdGVkQnkobGVuZ3RoKTtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLm1lcmdlQXR0cmlidXRlcyhpbnNlcnRpb25Qb3NpdGlvbik7XG4gICAgICAgIC8vIElmIHN0YXJ0IHBvc2l0aW9uIHdhcyBtZXJnZWQgLSBtb3ZlIGVuZCBwb3NpdGlvbi5cbiAgICAgICAgaWYgKCFzdGFydC5pc0VxdWFsKGluc2VydGlvblBvc2l0aW9uKSkge1xuICAgICAgICAgICAgZW5kUG9zaXRpb24ub2Zmc2V0LS07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW5kID0gdGhpcy5tZXJnZUF0dHJpYnV0ZXMoZW5kUG9zaXRpb24pO1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlJDEoc3RhcnQsIGVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBXcmFwcyBjaGlsZHJlbiB3aXRoIHByb3ZpZGVkIGB3cmFwRWxlbWVudGAuIE9ubHkgY2hpbGRyZW4gY29udGFpbmVkIGluIGBwYXJlbnRgIGVsZW1lbnQgYmV0d2VlblxuXHQgKiBgc3RhcnRPZmZzZXRgIGFuZCBgZW5kT2Zmc2V0YCB3aWxsIGJlIHdyYXBwZWQuXG5cdCAqLyBfd3JhcENoaWxkcmVuKHBhcmVudCwgc3RhcnRPZmZzZXQsIGVuZE9mZnNldCwgd3JhcEVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGkgPSBzdGFydE9mZnNldDtcbiAgICAgICAgY29uc3Qgd3JhcFBvc2l0aW9ucyA9IFtdO1xuICAgICAgICB3aGlsZShpIDwgZW5kT2Zmc2V0KXtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gcGFyZW50LmdldENoaWxkKGkpO1xuICAgICAgICAgICAgY29uc3QgaXNUZXh0ID0gY2hpbGQuaXMoJyR0ZXh0Jyk7XG4gICAgICAgICAgICBjb25zdCBpc0F0dHJpYnV0ZSA9IGNoaWxkLmlzKCdhdHRyaWJ1dGVFbGVtZW50Jyk7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gKEluIGFsbCBleGFtcGxlcywgYXNzdW1lIHRoYXQgYHdyYXBFbGVtZW50YCBpcyBgPHNwYW4gY2xhc3M9XCJmb29cIj5gIGVsZW1lbnQuKVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGB3cmFwRWxlbWVudGAgY2FuIGJlIGpvaW5lZCB3aXRoIHRoZSB3cmFwcGVkIGVsZW1lbnQuIE9uZSBvZiByZXF1aXJlbWVudHMgaXMgaGF2aW5nIHNhbWUgbmFtZS5cbiAgICAgICAgICAgIC8vIElmIHBvc3NpYmxlLCBqb2luIGVsZW1lbnRzLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIDxwPjxzcGFuIGNsYXNzPVwiYmFyXCI+YWJjPC9zcGFuPjwvcD4gIC0tPiAgPHA+PHNwYW4gY2xhc3M9XCJmb28gYmFyXCI+YWJjPC9zcGFuPjwvcD5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBpZiAoaXNBdHRyaWJ1dGUgJiYgY2hpbGQuX2Nhbk1lcmdlQXR0cmlidXRlc0Zyb20od3JhcEVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQuX21lcmdlQXR0cmlidXRlc0Zyb20od3JhcEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHdyYXBQb3NpdGlvbnMucHVzaChuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUZXh0IHx8ICFpc0F0dHJpYnV0ZSB8fCBzaG91bGRBQmVPdXRzaWRlQih3cmFwRWxlbWVudCwgY2hpbGQpKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2xvbmUgYXR0cmlidXRlLlxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0F0dHJpYnV0ZSA9IHdyYXBFbGVtZW50Ll9jbG9uZSgpO1xuICAgICAgICAgICAgICAgIC8vIFdyYXAgY3VycmVudCBub2RlIHdpdGggbmV3IGF0dHJpYnV0ZS5cbiAgICAgICAgICAgICAgICBjaGlsZC5fcmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgbmV3QXR0cmlidXRlLl9hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICAgICAgICAgICAgcGFyZW50Ll9pbnNlcnRDaGlsZChpLCBuZXdBdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRvQ2xvbmVkRWxlbWVudHNHcm91cChuZXdBdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICAgIHdyYXBQb3NpdGlvbnMucHVzaChuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkpKTtcbiAgICAgICAgICAgIH0gZWxzZSAvKiBpZiAoIGlzQXR0cmlidXRlICkgKi8ge1xuICAgICAgICAgICAgICAgIHRoaXMuX3dyYXBDaGlsZHJlbihjaGlsZCwgMCwgY2hpbGQuY2hpbGRDb3VudCwgd3JhcEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIC8vIE1lcmdlIGF0IGVhY2ggd3JhcC5cbiAgICAgICAgbGV0IG9mZnNldENoYW5nZSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2Ygd3JhcFBvc2l0aW9ucyl7XG4gICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQgLT0gb2Zmc2V0Q2hhbmdlO1xuICAgICAgICAgICAgLy8gRG8gbm90IG1lcmdlIHdpdGggZWxlbWVudHMgb3V0c2lkZSBzZWxlY3RlZCBjaGlsZHJlbi5cbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5vZmZzZXQgPT0gc3RhcnRPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gdGhpcy5tZXJnZUF0dHJpYnV0ZXMocG9zaXRpb24pO1xuICAgICAgICAgICAgLy8gSWYgbm9kZXMgd2VyZSBtZXJnZWQgLSBvdGhlciBtZXJnZSBvZmZzZXRzIHdpbGwgY2hhbmdlLlxuICAgICAgICAgICAgaWYgKCFuZXdQb3NpdGlvbi5pc0VxdWFsKHBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgIG9mZnNldENoYW5nZSsrO1xuICAgICAgICAgICAgICAgIGVuZE9mZnNldC0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSYW5nZSQxLl9jcmVhdGVGcm9tUGFyZW50c0FuZE9mZnNldHMocGFyZW50LCBzdGFydE9mZnNldCwgcGFyZW50LCBlbmRPZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogVW53cmFwcyBjaGlsZHJlbiBmcm9tIHByb3ZpZGVkIGB1bndyYXBFbGVtZW50YC4gT25seSBjaGlsZHJlbiBjb250YWluZWQgaW4gYHBhcmVudGAgZWxlbWVudCBiZXR3ZWVuXG5cdCAqIGBzdGFydE9mZnNldGAgYW5kIGBlbmRPZmZzZXRgIHdpbGwgYmUgdW53cmFwcGVkLlxuXHQgKi8gX3Vud3JhcENoaWxkcmVuKHBhcmVudCwgc3RhcnRPZmZzZXQsIGVuZE9mZnNldCwgdW53cmFwRWxlbWVudCkge1xuICAgICAgICBsZXQgaSA9IHN0YXJ0T2Zmc2V0O1xuICAgICAgICBjb25zdCB1bndyYXBQb3NpdGlvbnMgPSBbXTtcbiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGVhY2ggZWxlbWVudCBiZXR3ZWVuIHByb3ZpZGVkIG9mZnNldHMgaW5zaWRlIHBhcmVudC5cbiAgICAgICAgLy8gV2UgZG9uJ3QgdXNlIHRyZWUgd2Fsa2VyIG9yIHJhbmdlIGl0ZXJhdG9yIGJlY2F1c2Ugd2Ugd2lsbCBiZSByZW1vdmluZyBhbmQgbWVyZ2luZyBwb3RlbnRpYWxseSBtdWx0aXBsZSBub2RlcyxcbiAgICAgICAgLy8gc28gaXQgY291bGQgZ2V0IG1lc3N5LiBJdCBpcyBzYWZlciB0byBpdCBtYW51YWxseSBpbiB0aGlzIGNhc2UuXG4gICAgICAgIHdoaWxlKGkgPCBlbmRPZmZzZXQpe1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBwYXJlbnQuZ2V0Q2hpbGQoaSk7XG4gICAgICAgICAgICAvLyBTa2lwIGFsbCB0ZXh0IG5vZGVzLiBUaGVyZSBzaG91bGQgYmUgbm8gY29udGFpbmVyIGVsZW1lbnQncyBoZXJlIGVpdGhlci5cbiAgICAgICAgICAgIGlmICghY2hpbGQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAoSW4gYWxsIGV4YW1wbGVzLCBhc3N1bWUgdGhhdCBgdW53cmFwRWxlbWVudGAgaXMgYDxzcGFuIGNsYXNzPVwiZm9vXCI+YCBlbGVtZW50LilcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgc2ltaWxhciB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlIGVsZW1lbnQsIHVud3JhcCBpdCAtIGl0IHdpbGwgYmUgY29tcGxldGVseSByZW1vdmVkLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIDxwPjxzcGFuIGNsYXNzPVwiZm9vXCI+YWJjPC9zcGFuPnh5ejwvcD4gIC0tPiAgPHA+YWJjeHl6PC9wPlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGlmIChjaGlsZC5pc1NpbWlsYXIodW53cmFwRWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1bndyYXBwZWQgPSBjaGlsZC5nZXRDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY2hpbGQuY2hpbGRDb3VudDtcbiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIHdyYXBwZXIgZWxlbWVudCB3aXRoIGl0cyBjaGlsZHJlblxuICAgICAgICAgICAgICAgIGNoaWxkLl9yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBwYXJlbnQuX2luc2VydENoaWxkKGksIHVud3JhcHBlZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRnJvbUNsb25lZEVsZW1lbnRzR3JvdXAoY2hpbGQpO1xuICAgICAgICAgICAgICAgIC8vIFNhdmUgc3RhcnQgYW5kIGVuZCBwb3NpdGlvbiBvZiBtb3ZlZCBpdGVtcy5cbiAgICAgICAgICAgICAgICB1bndyYXBQb3NpdGlvbnMucHVzaChuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkpLCBuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkgKyBjb3VudCkpO1xuICAgICAgICAgICAgICAgIC8vIFNraXAgZWxlbWVudHMgdGhhdCB3ZXJlIHVud3JhcHBlZC4gQXNzdW1pbmcgdGhlcmUgd29uJ3QgYmUgYW5vdGhlciBlbGVtZW50IHRvIHVud3JhcCBpbiBjaGlsZCBlbGVtZW50cy5cbiAgICAgICAgICAgICAgICBpICs9IGNvdW50O1xuICAgICAgICAgICAgICAgIGVuZE9mZnNldCArPSBjb3VudCAtIDE7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIG5vdCBzaW1pbGFyIGJ1dCBpcyBhbiBhdHRyaWJ1dGUgZWxlbWVudCwgdHJ5IHBhcnRpYWwgdW53cmFwcGluZyAtIHJlbW92ZSB0aGUgc2FtZSBhdHRyaWJ1dGVzL3N0eWxlcy9jbGFzc2VzLlxuICAgICAgICAgICAgLy8gUGFydGlhbCB1bndyYXBwaW5nIHdpbGwgaGFwcGVuIG9ubHkgaWYgdGhlIGVsZW1lbnRzIGhhdmUgdGhlIHNhbWUgbmFtZS5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyA8cD48c3BhbiBjbGFzcz1cImZvbyBiYXJcIj5hYmM8L3NwYW4+eHl6PC9wPiAgLS0+ICA8cD48c3BhbiBjbGFzcz1cImJhclwiPmFiYzwvc3Bhbj54eXo8L3A+XG4gICAgICAgICAgICAvLyA8cD48aSBjbGFzcz1cImZvb1wiPmFiYzwvaT54eXo8L3A+ICAgICAgICAgICAgLS0+ICA8cD48aSBjbGFzcz1cImZvb1wiPmFiYzwvaT54eXo8L3A+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgaWYgKGNoaWxkLl9jYW5TdWJ0cmFjdEF0dHJpYnV0ZXNPZih1bndyYXBFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGNoaWxkLl9zdWJ0cmFjdEF0dHJpYnV0ZXNPZih1bndyYXBFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB1bndyYXBQb3NpdGlvbnMucHVzaChuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkpLCBuZXcgUG9zaXRpb24kMShwYXJlbnQsIGkgKyAxKSk7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIElmIG90aGVyIG5lc3RlZCBhdHRyaWJ1dGUgaXMgZm91bmQsIGxvb2sgdGhyb3VnaCBpdCdzIGNoaWxkcmVuIGZvciBlbGVtZW50cyB0byB1bndyYXAuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gPHA+PGk+PHNwYW4gY2xhc3M9XCJmb29cIj5hYmM8L3NwYW4+PC9pPjxwPiAgLS0+ICA8cD48aT5hYmM8L2k+PHA+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgdGhpcy5fdW53cmFwQ2hpbGRyZW4oY2hpbGQsIDAsIGNoaWxkLmNoaWxkQ291bnQsIHVud3JhcEVsZW1lbnQpO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIC8vIE1lcmdlIGF0IGVhY2ggdW53cmFwLlxuICAgICAgICBsZXQgb2Zmc2V0Q2hhbmdlID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBwb3NpdGlvbiBvZiB1bndyYXBQb3NpdGlvbnMpe1xuICAgICAgICAgICAgcG9zaXRpb24ub2Zmc2V0IC09IG9mZnNldENoYW5nZTtcbiAgICAgICAgICAgIC8vIERvIG5vdCBtZXJnZSB3aXRoIGVsZW1lbnRzIG91dHNpZGUgc2VsZWN0ZWQgY2hpbGRyZW4uXG4gICAgICAgICAgICBpZiAocG9zaXRpb24ub2Zmc2V0ID09IHN0YXJ0T2Zmc2V0IHx8IHBvc2l0aW9uLm9mZnNldCA9PSBlbmRPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gdGhpcy5tZXJnZUF0dHJpYnV0ZXMocG9zaXRpb24pO1xuICAgICAgICAgICAgLy8gSWYgbm9kZXMgd2VyZSBtZXJnZWQgLSBvdGhlciBtZXJnZSBvZmZzZXRzIHdpbGwgY2hhbmdlLlxuICAgICAgICAgICAgaWYgKCFuZXdQb3NpdGlvbi5pc0VxdWFsKHBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgIG9mZnNldENoYW5nZSsrO1xuICAgICAgICAgICAgICAgIGVuZE9mZnNldC0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBSYW5nZSQxLl9jcmVhdGVGcm9tUGFyZW50c0FuZE9mZnNldHMocGFyZW50LCBzdGFydE9mZnNldCwgcGFyZW50LCBlbmRPZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogSGVscGVyIGZ1bmN0aW9uIGZvciBgdmlldy53cml0ZXIud3JhcGAuIFdyYXBzIHJhbmdlIHdpdGggcHJvdmlkZWQgYXR0cmlidXRlIGVsZW1lbnQuXG5cdCAqIFRoaXMgbWV0aG9kIHdpbGwgYWxzbyBtZXJnZSBuZXdseSBhZGRlZCBhdHRyaWJ1dGUgZWxlbWVudCB3aXRoIGl0cyBzaWJsaW5ncyB3aGVuZXZlciBwb3NzaWJsZS5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yfSBgdmlldy13cml0ZXItd3JhcC1pbnZhbGlkLWF0dHJpYnV0ZWAgd2hlbiBwYXNzZWQgYXR0cmlidXRlIGVsZW1lbnQgaXMgbm90XG5cdCAqIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IEF0dHJpYnV0ZUVsZW1lbnR9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBOZXcgcmFuZ2UgYWZ0ZXIgd3JhcHBpbmcsIHNwYW5uaW5nIG92ZXIgd3JhcHBpbmcgYXR0cmlidXRlIGVsZW1lbnQuXG5cdCAqLyBfd3JhcFJhbmdlKHJhbmdlLCBhdHRyaWJ1dGUpIHtcbiAgICAgICAgLy8gQnJlYWsgYXR0cmlidXRlcyBhdCByYW5nZSBzdGFydCBhbmQgZW5kLlxuICAgICAgICBjb25zdCB7IHN0YXJ0OiBicmVha1N0YXJ0LCBlbmQ6IGJyZWFrRW5kIH0gPSB0aGlzLl9icmVha0F0dHJpYnV0ZXNSYW5nZShyYW5nZSwgdHJ1ZSk7XG4gICAgICAgIGNvbnN0IHBhcmVudENvbnRhaW5lciA9IGJyZWFrU3RhcnQucGFyZW50O1xuICAgICAgICAvLyBXcmFwIGFsbCBjaGlsZHJlbiB3aXRoIGF0dHJpYnV0ZS5cbiAgICAgICAgY29uc3QgbmV3UmFuZ2UgPSB0aGlzLl93cmFwQ2hpbGRyZW4ocGFyZW50Q29udGFpbmVyLCBicmVha1N0YXJ0Lm9mZnNldCwgYnJlYWtFbmQub2Zmc2V0LCBhdHRyaWJ1dGUpO1xuICAgICAgICAvLyBNZXJnZSBhdHRyaWJ1dGVzIGF0IHRoZSBib3RoIGVuZHMgYW5kIHJldHVybiBhIG5ldyByYW5nZS5cbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLm1lcmdlQXR0cmlidXRlcyhuZXdSYW5nZS5zdGFydCk7XG4gICAgICAgIC8vIElmIHN0YXJ0IHBvc2l0aW9uIHdhcyBtZXJnZWQgLSBtb3ZlIGVuZCBwb3NpdGlvbiBiYWNrLlxuICAgICAgICBpZiAoIXN0YXJ0LmlzRXF1YWwobmV3UmFuZ2Uuc3RhcnQpKSB7XG4gICAgICAgICAgICBuZXdSYW5nZS5lbmQub2Zmc2V0LS07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZW5kID0gdGhpcy5tZXJnZUF0dHJpYnV0ZXMobmV3UmFuZ2UuZW5kKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSQxKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogSGVscGVyIGZ1bmN0aW9uIGZvciB7QGxpbmsgI3dyYXB9LiBXcmFwcyBwb3NpdGlvbiB3aXRoIHByb3ZpZGVkIGF0dHJpYnV0ZSBlbGVtZW50LlxuXHQgKiBUaGlzIG1ldGhvZCB3aWxsIGFsc28gbWVyZ2UgbmV3bHkgYWRkZWQgYXR0cmlidXRlIGVsZW1lbnQgd2l0aCBpdHMgc2libGluZ3Mgd2hlbmV2ZXIgcG9zc2libGUuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLXdyYXAtaW52YWxpZC1hdHRyaWJ1dGVgIHdoZW4gcGFzc2VkIGF0dHJpYnV0ZSBlbGVtZW50IGlzIG5vdFxuXHQgKiBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBBdHRyaWJ1dGVFbGVtZW50fS5cblx0ICpcblx0ICogQHJldHVybnMgTmV3IHBvc2l0aW9uIGFmdGVyIHdyYXBwaW5nLlxuXHQgKi8gX3dyYXBQb3NpdGlvbihwb3NpdGlvbiwgYXR0cmlidXRlKSB7XG4gICAgICAgIC8vIFJldHVybiBzYW1lIHBvc2l0aW9uIHdoZW4gdHJ5aW5nIHRvIHdyYXAgd2l0aCBhdHRyaWJ1dGUgc2ltaWxhciB0byBwb3NpdGlvbiBwYXJlbnQuXG4gICAgICAgIGlmIChhdHRyaWJ1dGUuaXNTaW1pbGFyKHBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBtb3ZlUG9zaXRpb25Ub1RleHROb2RlKHBvc2l0aW9uLmNsb25lKCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdoZW4gcG9zaXRpb24gaXMgaW5zaWRlIHRleHQgbm9kZSAtIGJyZWFrIGl0IGFuZCBwbGFjZSBuZXcgcG9zaXRpb24gYmV0d2VlbiB0d28gdGV4dCBub2Rlcy5cbiAgICAgICAgaWYgKHBvc2l0aW9uLnBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSBicmVha1RleHROb2RlKHBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDcmVhdGUgZmFrZSBlbGVtZW50IHRoYXQgd2lsbCByZXByZXNlbnQgcG9zaXRpb24sIGFuZCB3aWxsIG5vdCBiZSBtZXJnZWQgd2l0aCBvdGhlciBhdHRyaWJ1dGVzLlxuICAgICAgICBjb25zdCBmYWtlRWxlbWVudCA9IHRoaXMuY3JlYXRlQXR0cmlidXRlRWxlbWVudCgnX3dyYXBQb3NpdGlvbi1mYWtlLWVsZW1lbnQnKTtcbiAgICAgICAgZmFrZUVsZW1lbnQuX3ByaW9yaXR5ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgICAgICBmYWtlRWxlbWVudC5pc1NpbWlsYXIgPSAoKT0+ZmFsc2U7XG4gICAgICAgIC8vIEluc2VydCBmYWtlIGVsZW1lbnQgaW4gcG9zaXRpb24gbG9jYXRpb24uXG4gICAgICAgIHBvc2l0aW9uLnBhcmVudC5faW5zZXJ0Q2hpbGQocG9zaXRpb24ub2Zmc2V0LCBmYWtlRWxlbWVudCk7XG4gICAgICAgIC8vIFJhbmdlIGFyb3VuZCBpbnNlcnRlZCBmYWtlIGF0dHJpYnV0ZSBlbGVtZW50LlxuICAgICAgICBjb25zdCB3cmFwUmFuZ2UgPSBuZXcgUmFuZ2UkMShwb3NpdGlvbiwgcG9zaXRpb24uZ2V0U2hpZnRlZEJ5KDEpKTtcbiAgICAgICAgLy8gV3JhcCBmYWtlIGVsZW1lbnQgd2l0aCBhdHRyaWJ1dGUgKGl0IHdpbGwgYWxzbyBtZXJnZSBpZiBwb3NzaWJsZSkuXG4gICAgICAgIHRoaXMud3JhcCh3cmFwUmFuZ2UsIGF0dHJpYnV0ZSk7XG4gICAgICAgIC8vIFJlbW92ZSBmYWtlIGVsZW1lbnQgYW5kIHBsYWNlIG5ldyBwb3NpdGlvbiB0aGVyZS5cbiAgICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMShmYWtlRWxlbWVudC5wYXJlbnQsIGZha2VFbGVtZW50LmluZGV4KTtcbiAgICAgICAgZmFrZUVsZW1lbnQuX3JlbW92ZSgpO1xuICAgICAgICAvLyBJZiBwb3NpdGlvbiBpcyBwbGFjZWQgYmV0d2VlbiB0ZXh0IG5vZGVzIC0gbWVyZ2UgdGhlbSBhbmQgcmV0dXJuIHBvc2l0aW9uIGluc2lkZS5cbiAgICAgICAgY29uc3Qgbm9kZUJlZm9yZSA9IG5ld1Bvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgIGNvbnN0IG5vZGVBZnRlciA9IG5ld1Bvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgaWYgKG5vZGVCZWZvcmUgJiYgbm9kZUJlZm9yZS5pcygndmlldzokdGV4dCcpICYmIG5vZGVBZnRlciAmJiBub2RlQWZ0ZXIuaXMoJ3ZpZXc6JHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG1lcmdlVGV4dE5vZGVzKG5vZGVCZWZvcmUsIG5vZGVBZnRlcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgcG9zaXRpb24gaXMgbmV4dCB0byB0ZXh0IG5vZGUgLSBtb3ZlIHBvc2l0aW9uIGluc2lkZS5cbiAgICAgICAgcmV0dXJuIG1vdmVQb3NpdGlvblRvVGV4dE5vZGUobmV3UG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogSGVscGVyIGZ1bmN0aW9uIHVzZWQgYnkgb3RoZXIgYERvd25jYXN0V3JpdGVyYCBtZXRob2RzLiBCcmVha3MgYXR0cmlidXRlIGVsZW1lbnRzIGF0IHRoZSBib3VuZGFyaWVzIG9mIGdpdmVuIHJhbmdlLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2UgUmFuZ2Ugd2hpY2ggYHN0YXJ0YCBhbmQgYGVuZGAgcG9zaXRpb25zIHdpbGwgYmUgdXNlZCB0byBicmVhayBhdHRyaWJ1dGVzLlxuXHQgKiBAcGFyYW0gZm9yY2VTcGxpdFRleHQgSWYgc2V0IHRvIGB0cnVlYCwgd2lsbCBicmVhayB0ZXh0IG5vZGVzIGV2ZW4gaWYgdGhleSBhcmUgZGlyZWN0bHkgaW4gY29udGFpbmVyIGVsZW1lbnQuXG5cdCAqIFRoaXMgYmVoYXZpb3Igd2lsbCByZXN1bHQgaW4gaW5jb3JyZWN0IHZpZXcgc3RhdGUsIGJ1dCBpcyBuZWVkZWQgYnkgb3RoZXIgdmlldyB3cml0aW5nIG1ldGhvZHMgd2hpY2ggdGhlbiBmaXhlcyB2aWV3IHN0YXRlLlxuXHQgKiBAcmV0dXJucyBOZXcgcmFuZ2Ugd2l0aCBsb2NhdGVkIGF0IGJyZWFrIHBvc2l0aW9ucy5cblx0ICovIF9icmVha0F0dHJpYnV0ZXNSYW5nZShyYW5nZSwgZm9yY2VTcGxpdFRleHQgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCByYW5nZVN0YXJ0ID0gcmFuZ2Uuc3RhcnQ7XG4gICAgICAgIGNvbnN0IHJhbmdlRW5kID0gcmFuZ2UuZW5kO1xuICAgICAgICB2YWxpZGF0ZVJhbmdlQ29udGFpbmVyKHJhbmdlLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgLy8gQnJlYWsgYXQgdGhlIGNvbGxhcHNlZCBwb3NpdGlvbi4gUmV0dXJuIG5ldyBjb2xsYXBzZWQgcmFuZ2UuXG4gICAgICAgIGlmIChyYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLl9icmVha0F0dHJpYnV0ZXMocmFuZ2Uuc3RhcnQsIGZvcmNlU3BsaXRUZXh0KTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMShwb3NpdGlvbiwgcG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJyZWFrRW5kID0gdGhpcy5fYnJlYWtBdHRyaWJ1dGVzKHJhbmdlRW5kLCBmb3JjZVNwbGl0VGV4dCk7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYnJlYWtFbmQucGFyZW50LmNoaWxkQ291bnQ7XG4gICAgICAgIGNvbnN0IGJyZWFrU3RhcnQgPSB0aGlzLl9icmVha0F0dHJpYnV0ZXMocmFuZ2VTdGFydCwgZm9yY2VTcGxpdFRleHQpO1xuICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IGJyZWFrIGVuZCBvZmZzZXQuXG4gICAgICAgIGJyZWFrRW5kLm9mZnNldCArPSBicmVha0VuZC5wYXJlbnQuY2hpbGRDb3VudCAtIGNvdW50O1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlJDEoYnJlYWtTdGFydCwgYnJlYWtFbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogSGVscGVyIGZ1bmN0aW9uIHVzZWQgYnkgb3RoZXIgYERvd25jYXN0V3JpdGVyYCBtZXRob2RzLiBCcmVha3MgYXR0cmlidXRlIGVsZW1lbnRzIGF0IGdpdmVuIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWNhbm5vdC1icmVhay1lbXB0eS1lbGVtZW50YCB3aGVuIGJyZWFrIHBvc2l0aW9uXG5cdCAqIGlzIHBsYWNlZCBpbnNpZGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IEVtcHR5RWxlbWVudH0uXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgdmlldy13cml0ZXItY2Fubm90LWJyZWFrLXVpLWVsZW1lbnRgIHdoZW4gYnJlYWsgcG9zaXRpb25cblx0ICogaXMgcGxhY2VkIGluc2lkZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgVUlFbGVtZW50fS5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHdoZXJlIHRvIGJyZWFrIGF0dHJpYnV0ZXMuXG5cdCAqIEBwYXJhbSBmb3JjZVNwbGl0VGV4dCBJZiBzZXQgdG8gYHRydWVgLCB3aWxsIGJyZWFrIHRleHQgbm9kZXMgZXZlbiBpZiB0aGV5IGFyZSBkaXJlY3RseSBpbiBjb250YWluZXIgZWxlbWVudC5cblx0ICogVGhpcyBiZWhhdmlvciB3aWxsIHJlc3VsdCBpbiBpbmNvcnJlY3QgdmlldyBzdGF0ZSwgYnV0IGlzIG5lZWRlZCBieSBvdGhlciB2aWV3IHdyaXRpbmcgbWV0aG9kcyB3aGljaCB0aGVuIGZpeGVzIHZpZXcgc3RhdGUuXG5cdCAqIEByZXR1cm5zIE5ldyBwb3NpdGlvbiBhZnRlciBicmVha2luZyB0aGUgYXR0cmlidXRlcy5cblx0ICovIF9icmVha0F0dHJpYnV0ZXMocG9zaXRpb24sIGZvcmNlU3BsaXRUZXh0ID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgcG9zaXRpb25PZmZzZXQgPSBwb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgICAgICAvLyBJZiBwb3NpdGlvbiBpcyBwbGFjZWQgaW5zaWRlIEVtcHR5RWxlbWVudCAtIHRocm93IGFuIGV4Y2VwdGlvbiBhcyB3ZSBjYW5ub3QgYnJlYWsgaW5zaWRlLlxuICAgICAgICBpZiAocG9zaXRpb24ucGFyZW50LmlzKCdlbXB0eUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3QgYnJlYWsgYW4gYEVtcHR5RWxlbWVudGAgaW5zdGFuY2UuXG5cdFx0XHQgKlxuXHRcdFx0ICogVGhpcyBlcnJvciBpcyB0aHJvd24gaWZcblx0XHRcdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjYnJlYWtBdHRyaWJ1dGVzIGBEb3duY2FzdFdyaXRlciNicmVha0F0dHJpYnV0ZXMoKWB9XG5cdFx0XHQgKiB3YXMgZXhlY3V0ZWQgaW4gYW4gaW5jb3JyZWN0IHBvc2l0aW9uLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci1jYW5ub3QtYnJlYWstZW1wdHktZWxlbWVudFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXdyaXRlci1jYW5ub3QtYnJlYWstZW1wdHktZWxlbWVudCcsIHRoaXMuZG9jdW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHBvc2l0aW9uIGlzIHBsYWNlZCBpbnNpZGUgVUlFbGVtZW50IC0gdGhyb3cgYW4gZXhjZXB0aW9uIGFzIHdlIGNhbm5vdCBicmVhayBpbnNpZGUuXG4gICAgICAgIGlmIChwb3NpdGlvbi5wYXJlbnQuaXMoJ3VpRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBicmVhayBhIGBVSUVsZW1lbnRgIGluc3RhbmNlLlxuXHRcdFx0ICpcblx0XHRcdCAqIFRoaXMgZXJyb3IgaXMgdGhyb3duIGlmXG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2JyZWFrQXR0cmlidXRlcyBgRG93bmNhc3RXcml0ZXIjYnJlYWtBdHRyaWJ1dGVzKClgfVxuXHRcdFx0ICogd2FzIGV4ZWN1dGVkIGluIGFuIGluY29ycmVjdCBwb3NpdGlvbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy13cml0ZXItY2Fubm90LWJyZWFrLXVpLWVsZW1lbnRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy13cml0ZXItY2Fubm90LWJyZWFrLXVpLWVsZW1lbnQnLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBwb3NpdGlvbiBpcyBwbGFjZWQgaW5zaWRlIFJhd0VsZW1lbnQgLSB0aHJvdyBhbiBleGNlcHRpb24gYXMgd2UgY2Fubm90IGJyZWFrIGluc2lkZS5cbiAgICAgICAgaWYgKHBvc2l0aW9uLnBhcmVudC5pcygncmF3RWxlbWVudCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBicmVhayBhIGBSYXdFbGVtZW50YCBpbnN0YW5jZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBUaGlzIGVycm9yIGlzIHRocm93biBpZlxuXHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNicmVha0F0dHJpYnV0ZXMgYERvd25jYXN0V3JpdGVyI2JyZWFrQXR0cmlidXRlcygpYH1cblx0XHRcdCAqIHdhcyBleGVjdXRlZCBpbiBhbiBpbmNvcnJlY3QgcG9zaXRpb24uXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctd3JpdGVyLWNhbm5vdC1icmVhay1yYXctZWxlbWVudFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXdyaXRlci1jYW5ub3QtYnJlYWstcmF3LWVsZW1lbnQnLCB0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGVyZSBhcmUgbm8gYXR0cmlidXRlcyB0byBicmVhayBhbmQgdGV4dCBub2RlcyBicmVha2luZyBpcyBub3QgZm9yY2VkLlxuICAgICAgICBpZiAoIWZvcmNlU3BsaXRUZXh0ICYmIHBvc2l0aW9uUGFyZW50LmlzKCckdGV4dCcpICYmIGlzQ29udGFpbmVyT3JGcmFnbWVudChwb3NpdGlvblBhcmVudC5wYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQb3NpdGlvbidzIHBhcmVudCBpcyBjb250YWluZXIsIHNvIG5vIGF0dHJpYnV0ZXMgdG8gYnJlYWsuXG4gICAgICAgIGlmIChpc0NvbnRhaW5lck9yRnJhZ21lbnQocG9zaXRpb25QYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCcmVhayB0ZXh0IGFuZCBzdGFydCBhZ2FpbiBpbiBuZXcgcG9zaXRpb24uXG4gICAgICAgIGlmIChwb3NpdGlvblBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JyZWFrQXR0cmlidXRlcyhicmVha1RleHROb2RlKHBvc2l0aW9uKSwgZm9yY2VTcGxpdFRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHBvc2l0aW9uUGFyZW50LmNoaWxkQ291bnQ7XG4gICAgICAgIC8vIDxwPmZvbzxiPjx1PmJhcnt9PC91PjwvYj48L3A+XG4gICAgICAgIC8vIDxwPmZvbzxiPjx1PmJhcjwvdT5bXTwvYj48L3A+XG4gICAgICAgIC8vIDxwPmZvbzxiPjx1PmJhcjwvdT48L2I+W108L3A+XG4gICAgICAgIGlmIChwb3NpdGlvbk9mZnNldCA9PSBsZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gbmV3IFBvc2l0aW9uJDEocG9zaXRpb25QYXJlbnQucGFyZW50LCBwb3NpdGlvblBhcmVudC5pbmRleCArIDEpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JyZWFrQXR0cmlidXRlcyhuZXdQb3NpdGlvbiwgZm9yY2VTcGxpdFRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gPHA+Zm9vPGI+PHU+e31iYXI8L3U+PC9iPjwvcD5cbiAgICAgICAgICAgIC8vIDxwPmZvbzxiPltdPHU+YmFyPC91PjwvYj48L3A+XG4gICAgICAgICAgICAvLyA8cD5mb297fTxiPjx1PmJhcjwvdT48L2I+PC9wPlxuICAgICAgICAgICAgaWYgKHBvc2l0aW9uT2Zmc2V0ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMShwb3NpdGlvblBhcmVudC5wYXJlbnQsIHBvc2l0aW9uUGFyZW50LmluZGV4KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJlYWtBdHRyaWJ1dGVzKG5ld1Bvc2l0aW9uLCBmb3JjZVNwbGl0VGV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldEFmdGVyID0gcG9zaXRpb25QYXJlbnQuaW5kZXggKyAxO1xuICAgICAgICAgICAgICAgIC8vIEJyZWFrIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgY29uc3QgY2xvbmVkTm9kZSA9IHBvc2l0aW9uUGFyZW50Ll9jbG9uZSgpO1xuICAgICAgICAgICAgICAgIC8vIEluc2VydCBjbG9uZWQgbm9kZSB0byBwb3NpdGlvbidzIHBhcmVudCBub2RlLlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uUGFyZW50LnBhcmVudC5faW5zZXJ0Q2hpbGQob2Zmc2V0QWZ0ZXIsIGNsb25lZE5vZGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRvQ2xvbmVkRWxlbWVudHNHcm91cChjbG9uZWROb2RlKTtcbiAgICAgICAgICAgICAgICAvLyBHZXQgbm9kZXMgdG8gbW92ZS5cbiAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IHBvc2l0aW9uUGFyZW50LmNoaWxkQ291bnQgLSBwb3NpdGlvbk9mZnNldDtcbiAgICAgICAgICAgICAgICBjb25zdCBub2Rlc1RvTW92ZSA9IHBvc2l0aW9uUGFyZW50Ll9yZW1vdmVDaGlsZHJlbihwb3NpdGlvbk9mZnNldCwgY291bnQpO1xuICAgICAgICAgICAgICAgIC8vIE1vdmUgbm9kZXMgdG8gY2xvbmVkIG5vZGUuXG4gICAgICAgICAgICAgICAgY2xvbmVkTm9kZS5fYXBwZW5kQ2hpbGQobm9kZXNUb01vdmUpO1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBuZXcgcG9zaXRpb24gdG8gd29yayBvbi5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQb3NpdGlvbiA9IG5ldyBQb3NpdGlvbiQxKHBvc2l0aW9uUGFyZW50LnBhcmVudCwgb2Zmc2V0QWZ0ZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9icmVha0F0dHJpYnV0ZXMobmV3UG9zaXRpb24sIGZvcmNlU3BsaXRUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU3RvcmVzIHRoZSBpbmZvcm1hdGlvbiB0aGF0IGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50fSB3YXNcblx0ICogYWRkZWQgdG8gdGhlIHRyZWUuIFNhdmVzIHRoZSByZWZlcmVuY2UgdG8gdGhlIGdyb3VwIGluIHRoZSBnaXZlbiBlbGVtZW50IGFuZCB1cGRhdGVzIHRoZSBncm91cCwgc28gb3RoZXIgZWxlbWVudHNcblx0ICogZnJvbSB0aGUgZ3JvdXAgbm93IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIGdpdmVuIGF0dHJpYnV0ZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBUaGUgY2xvbmVzIGdyb3VwIGNhbiBiZSBvYnRhaW5lZCB1c2luZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCNnZXRFbGVtZW50c1dpdGhTYW1lSWR9LlxuXHQgKlxuXHQgKiBEb2VzIG5vdGhpbmcgaWYgYWRkZWQgZWxlbWVudCBoYXMgbm8ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjaWQgaWR9LlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBBdHRyaWJ1dGUgZWxlbWVudCB0byBzYXZlLlxuXHQgKi8gX2FkZFRvQ2xvbmVkRWxlbWVudHNHcm91cChlbGVtZW50KSB7XG4gICAgICAgIC8vIEFkZCBvbmx5IGlmIHRoZSBlbGVtZW50IGlzIGluIGRvY3VtZW50IHRyZWUuXG4gICAgICAgIGlmICghZWxlbWVudC5yb290LmlzKCdyb290RWxlbWVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gVHJhdmVyc2UgdGhlIGVsZW1lbnQncyBjaGlsZHJlbiByZWN1cnNpdmVseSB0byBmaW5kIG90aGVyIGF0dHJpYnV0ZSBlbGVtZW50cyB0aGF0IGFsc28gbWlnaHQgZ290IGluc2VydGVkLlxuICAgICAgICAvLyBUaGUgbG9vcCBpcyBhdCB0aGUgYmVnaW5uaW5nIHNvIHdlIGNhbiBtYWtlIGZhc3QgcmV0dXJucyBsYXRlciBpbiB0aGUgY29kZS5cbiAgICAgICAgaWYgKGVsZW1lbnQuaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBlbGVtZW50LmdldENoaWxkcmVuKCkpe1xuICAgICAgICAgICAgICAgIHRoaXMuX2FkZFRvQ2xvbmVkRWxlbWVudHNHcm91cChjaGlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaWQgPSBlbGVtZW50LmlkO1xuICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGdyb3VwID0gdGhpcy5fY2xvbmVHcm91cHMuZ2V0KGlkKTtcbiAgICAgICAgaWYgKCFncm91cCkge1xuICAgICAgICAgICAgZ3JvdXAgPSBuZXcgU2V0KCk7XG4gICAgICAgICAgICB0aGlzLl9jbG9uZUdyb3Vwcy5zZXQoaWQsIGdyb3VwKTtcbiAgICAgICAgfVxuICAgICAgICBncm91cC5hZGQoZWxlbWVudCk7XG4gICAgICAgIGVsZW1lbnQuX2Nsb25lc0dyb3VwID0gZ3JvdXA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFsbCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50fVxuXHQgKiBmcm9tIGl0cyBjbG9uZXMgZ3JvdXAuXG5cdCAqXG5cdCAqIEtlZXAgaW4gbWluZCwgdGhhdCB0aGUgZWxlbWVudCB3aWxsIHN0aWxsIGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIGdyb3VwIChidXQgdGhlIGdyb3VwIHdpbGwgbm90IGtlZXAgYSByZWZlcmVuY2UgdG8gaXQpLlxuXHQgKiBUaGlzIGFsbG93cyB0byByZWZlcmVuY2UgdGhlIHdob2xlIGdyb3VwIGV2ZW4gaWYgdGhlIGVsZW1lbnQgd2FzIGFscmVhZHkgcmVtb3ZlZCBmcm9tIHRoZSB0cmVlLlxuXHQgKlxuXHQgKiBEb2VzIG5vdGhpbmcgaWYgdGhlIGVsZW1lbnQgaGFzIG5vIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50I2lkIGlkfS5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgQXR0cmlidXRlIGVsZW1lbnQgdG8gcmVtb3ZlLlxuXHQgKi8gX3JlbW92ZUZyb21DbG9uZWRFbGVtZW50c0dyb3VwKGVsZW1lbnQpIHtcbiAgICAgICAgLy8gVHJhdmVyc2UgdGhlIGVsZW1lbnQncyBjaGlsZHJlbiByZWN1cnNpdmVseSB0byBmaW5kIG90aGVyIGF0dHJpYnV0ZSBlbGVtZW50cyB0aGF0IGFsc28gZ290IHJlbW92ZWQuXG4gICAgICAgIC8vIFRoZSBsb29wIGlzIGF0IHRoZSBiZWdpbm5pbmcgc28gd2UgY2FuIG1ha2UgZmFzdCByZXR1cm5zIGxhdGVyIGluIHRoZSBjb2RlLlxuICAgICAgICBpZiAoZWxlbWVudC5pcygnZWxlbWVudCcpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGVsZW1lbnQuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRnJvbUNsb25lZEVsZW1lbnRzR3JvdXAoY2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlkID0gZWxlbWVudC5pZDtcbiAgICAgICAgaWYgKCFpZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdyb3VwID0gdGhpcy5fY2xvbmVHcm91cHMuZ2V0KGlkKTtcbiAgICAgICAgaWYgKCFncm91cCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGdyb3VwLmRlbGV0ZShlbGVtZW50KTtcbiAgICAvLyBOb3QgcmVtb3ZpbmcgZ3JvdXAgZnJvbSBlbGVtZW50IG9uIHB1cnBvc2UhXG4gICAgLy8gSWYgb3RoZXIgcGFydHMgb2YgY29kZSBoYXZlIHJlZmVyZW5jZSB0byB0aGlzIGVsZW1lbnQsIHRoZXkgd2lsbCBiZSBhYmxlIHRvIGdldCByZWZlcmVuY2VzIHRvIG90aGVyIGVsZW1lbnRzIGZyb20gdGhlIGdyb3VwLlxuICAgIH1cbn1cbi8vIEhlbHBlciBmdW5jdGlvbiBmb3IgYHZpZXcud3JpdGVyLndyYXBgLiBDaGVja3MgaWYgZ2l2ZW4gZWxlbWVudCBoYXMgYW55IGNoaWxkcmVuIHRoYXQgYXJlIG5vdCB1aSBlbGVtZW50cy5cbmZ1bmN0aW9uIF9oYXNOb25VaUNoaWxkcmVuKHBhcmVudCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHBhcmVudC5nZXRDaGlsZHJlbigpKS5zb21lKChjaGlsZCk9PiFjaGlsZC5pcygndWlFbGVtZW50JykpO1xufVxuLyoqXG4gKiBUaGUgYGF0dHJpYnV0ZWAgcGFzc2VkIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjd3JhcCBgRG93bmNhc3RXcml0ZXIjd3JhcCgpYH1cbiAqIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYEF0dHJpYnV0ZUVsZW1lbnRgfS5cbiAqXG4gKiBAZXJyb3Igdmlldy13cml0ZXItd3JhcC1pbnZhbGlkLWF0dHJpYnV0ZVxuICovIC8qKlxuICogUmV0dXJucyBmaXJzdCBwYXJlbnQgY29udGFpbmVyIG9mIHNwZWNpZmllZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIFBvc2l0aW9ufS5cbiAqIFBvc2l0aW9uJ3MgcGFyZW50IG5vZGUgaXMgY2hlY2tlZCBhcyBmaXJzdCwgdGhlbiBuZXh0IHBhcmVudHMgYXJlIGNoZWNrZWQuXG4gKiBOb3RlIHRoYXQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgRG9jdW1lbnRGcmFnbWVudH0gaXMgdHJlYXRlZCBsaWtlIGEgY29udGFpbmVyLlxuICpcbiAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiB1c2VkIGFzIGEgc3RhcnQgcG9pbnQgdG8gbG9jYXRlIHBhcmVudCBjb250YWluZXIuXG4gKiBAcmV0dXJucyBQYXJlbnQgY29udGFpbmVyIGVsZW1lbnQgb3IgYHVuZGVmaW5lZGAgaWYgY29udGFpbmVyIGlzIG5vdCBmb3VuZC5cbiAqLyBmdW5jdGlvbiBnZXRQYXJlbnRDb250YWluZXIocG9zaXRpb24pIHtcbiAgICBsZXQgcGFyZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgIHdoaWxlKCFpc0NvbnRhaW5lck9yRnJhZ21lbnQocGFyZW50KSl7XG4gICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBwYXJlbnQ7XG59XG4vKipcbiAqIENoZWNrcyBpZiBmaXJzdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBBdHRyaWJ1dGVFbGVtZW50fSBwcm92aWRlZCB0byB0aGUgZnVuY3Rpb25cbiAqIGNhbiBiZSB3cmFwcGVkIG91dHNpZGUgc2Vjb25kIGVsZW1lbnQuIEl0IGlzIGRvbmUgYnkgY29tcGFyaW5nIGVsZW1lbnRzJ1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQjcHJpb3JpdHkgcHJpb3JpdGllc30sIGlmIGJvdGggaGF2ZSBzYW1lIHByaW9yaXR5XG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNnZXRJZGVudGl0eSBpZGVudGl0aWVzfSBhcmUgY29tcGFyZWQuXG4gKi8gZnVuY3Rpb24gc2hvdWxkQUJlT3V0c2lkZUIoYSwgYikge1xuICAgIGlmIChhLnByaW9yaXR5IDwgYi5wcmlvcml0eSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGEucHJpb3JpdHkgPiBiLnByaW9yaXR5KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gV2hlbiBwcmlvcml0aWVzIGFyZSBlcXVhbCBhbmQgbmFtZXMgYXJlIGRpZmZlcmVudCAtIHVzZSBpZGVudGl0aWVzLlxuICAgIHJldHVybiBhLmdldElkZW50aXR5KCkgPCBiLmdldElkZW50aXR5KCk7XG59XG4vKipcbiAqIFJldHVybnMgbmV3IHBvc2l0aW9uIHRoYXQgaXMgbW92ZWQgdG8gbmVhciB0ZXh0IG5vZGUuIFJldHVybnMgc2FtZSBwb3NpdGlvbiBpZiB0aGVyZSBpcyBubyB0ZXh0IG5vZGUgYmVmb3JlIG9mIGFmdGVyXG4gKiBzcGVjaWZpZWQgcG9zaXRpb24uXG4gKlxuICogYGBgaHRtbFxuICogPHA+Zm9vW108L3A+ICAtPiAgPHA+Zm9ve308L3A+XG4gKiA8cD5bXWZvbzwvcD4gIC0+ICA8cD57fWZvbzwvcD5cbiAqIGBgYFxuICpcbiAqIEByZXR1cm5zIFBvc2l0aW9uIGxvY2F0ZWQgaW5zaWRlIHRleHQgbm9kZSBvciBzYW1lIHBvc2l0aW9uIGlmIHRoZXJlIGlzIG5vIHRleHQgbm9kZXNcbiAqIGJlZm9yZSBvciBhZnRlciBwb3NpdGlvbiBsb2NhdGlvbi5cbiAqLyBmdW5jdGlvbiBtb3ZlUG9zaXRpb25Ub1RleHROb2RlKHBvc2l0aW9uKSB7XG4gICAgY29uc3Qgbm9kZUJlZm9yZSA9IHBvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgaWYgKG5vZGVCZWZvcmUgJiYgbm9kZUJlZm9yZS5pcygnJHRleHQnKSkge1xuICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEobm9kZUJlZm9yZSwgbm9kZUJlZm9yZS5kYXRhLmxlbmd0aCk7XG4gICAgfVxuICAgIGNvbnN0IG5vZGVBZnRlciA9IHBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICBpZiAobm9kZUFmdGVyICYmIG5vZGVBZnRlci5pcygnJHRleHQnKSkge1xuICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEobm9kZUFmdGVyLCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uO1xufVxuLyoqXG4gKiBCcmVha3MgdGV4dCBub2RlIGludG8gdHdvIHRleHQgbm9kZXMgd2hlbiBwb3NzaWJsZS5cbiAqXG4gKiBgYGBodG1sXG4gKiA8cD5mb297fWJhcjwvcD4gLT4gPHA+Zm9vW11iYXI8L3A+XG4gKiA8cD57fWZvb2JhcjwvcD4gLT4gPHA+W11mb29iYXI8L3A+XG4gKiA8cD5mb29iYXJ7fTwvcD4gLT4gPHA+Zm9vYmFyW108L3A+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gdGhhdCBuZWVkIHRvIGJlIHBsYWNlZCBpbnNpZGUgdGV4dCBub2RlLlxuICogQHJldHVybnMgTmV3IHBvc2l0aW9uIGFmdGVyIGJyZWFraW5nIHRleHQgbm9kZS5cbiAqLyBmdW5jdGlvbiBicmVha1RleHROb2RlKHBvc2l0aW9uKSB7XG4gICAgaWYgKHBvc2l0aW9uLm9mZnNldCA9PSBwb3NpdGlvbi5wYXJlbnQuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbiQxKHBvc2l0aW9uLnBhcmVudC5wYXJlbnQsIHBvc2l0aW9uLnBhcmVudC5pbmRleCArIDEpO1xuICAgIH1cbiAgICBpZiAocG9zaXRpb24ub2Zmc2V0ID09PSAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24kMShwb3NpdGlvbi5wYXJlbnQucGFyZW50LCBwb3NpdGlvbi5wYXJlbnQuaW5kZXgpO1xuICAgIH1cbiAgICAvLyBHZXQgcGFydCBvZiB0aGUgdGV4dCB0aGF0IG5lZWQgdG8gYmUgbW92ZWQuXG4gICAgY29uc3QgdGV4dFRvTW92ZSA9IHBvc2l0aW9uLnBhcmVudC5kYXRhLnNsaWNlKHBvc2l0aW9uLm9mZnNldCk7XG4gICAgLy8gTGVhdmUgcmVzdCBvZiB0aGUgdGV4dCBpbiBwb3NpdGlvbidzIHBhcmVudC5cbiAgICBwb3NpdGlvbi5wYXJlbnQuX2RhdGEgPSBwb3NpdGlvbi5wYXJlbnQuZGF0YS5zbGljZSgwLCBwb3NpdGlvbi5vZmZzZXQpO1xuICAgIC8vIEluc2VydCBuZXcgdGV4dCBub2RlIGFmdGVyIHBvc2l0aW9uJ3MgcGFyZW50IHRleHQgbm9kZS5cbiAgICBwb3NpdGlvbi5wYXJlbnQucGFyZW50Ll9pbnNlcnRDaGlsZChwb3NpdGlvbi5wYXJlbnQuaW5kZXggKyAxLCBuZXcgVGV4dCQxKHBvc2l0aW9uLnJvb3QuZG9jdW1lbnQsIHRleHRUb01vdmUpKTtcbiAgICAvLyBSZXR1cm4gbmV3IHBvc2l0aW9uIGJldHdlZW4gdHdvIG5ld2x5IGNyZWF0ZWQgdGV4dCBub2Rlcy5cbiAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEocG9zaXRpb24ucGFyZW50LnBhcmVudCwgcG9zaXRpb24ucGFyZW50LmluZGV4ICsgMSk7XG59XG4vKipcbiAqIE1lcmdlcyB0d28gdGV4dCBub2RlcyBpbnRvIGZpcnN0IG5vZGUuIFJlbW92ZXMgc2Vjb25kIG5vZGUgYW5kIHJldHVybnMgbWVyZ2UgcG9zaXRpb24uXG4gKlxuICogQHBhcmFtIHQxIEZpcnN0IHRleHQgbm9kZSB0byBtZXJnZS4gRGF0YSBmcm9tIHNlY29uZCB0ZXh0IG5vZGUgd2lsbCBiZSBtb3ZlZCBhdCB0aGUgZW5kIG9mIHRoaXMgdGV4dCBub2RlLlxuICogQHBhcmFtIHQyIFNlY29uZCB0ZXh0IG5vZGUgdG8gbWVyZ2UuIFRoaXMgbm9kZSB3aWxsIGJlIHJlbW92ZWQgYWZ0ZXIgbWVyZ2luZy5cbiAqIEByZXR1cm5zIFBvc2l0aW9uIGFmdGVyIG1lcmdpbmcgdGV4dCBub2Rlcy5cbiAqLyBmdW5jdGlvbiBtZXJnZVRleHROb2Rlcyh0MSwgdDIpIHtcbiAgICAvLyBNZXJnZSB0ZXh0IGRhdGEgaW50byBmaXJzdCB0ZXh0IG5vZGUgYW5kIHJlbW92ZSBzZWNvbmQgb25lLlxuICAgIGNvbnN0IG5vZGVCZWZvcmVMZW5ndGggPSB0MS5kYXRhLmxlbmd0aDtcbiAgICB0MS5fZGF0YSArPSB0Mi5kYXRhO1xuICAgIHQyLl9yZW1vdmUoKTtcbiAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEodDEsIG5vZGVCZWZvcmVMZW5ndGgpO1xufVxuY29uc3QgdmFsaWROb2Rlc1RvSW5zZXJ0ID0gW1xuICAgIFRleHQkMSxcbiAgICBBdHRyaWJ1dGVFbGVtZW50LFxuICAgIENvbnRhaW5lckVsZW1lbnQsXG4gICAgRW1wdHlFbGVtZW50LFxuICAgIFJhd0VsZW1lbnQsXG4gICAgVUlFbGVtZW50XG5dO1xuLyoqXG4gKiBDaGVja3MgaWYgcHJvdmlkZWQgbm9kZXMgYXJlIHZhbGlkIHRvIGluc2VydC5cbiAqXG4gKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWluc2VydC1pbnZhbGlkLW5vZGVgIHdoZW4gbm9kZXMgdG8gaW5zZXJ0XG4gKiBjb250YWlucyBpbnN0YW5jZXMgdGhhdCBhcmUgbm90IHN1cHBvcnRlZCBvbmVzIChzZWUgZXJyb3IgZGVzY3JpcHRpb24gZm9yIHZhbGlkIG9uZXMuXG4gKi8gZnVuY3Rpb24gdmFsaWRhdGVOb2Rlc1RvSW5zZXJ0KG5vZGVzLCBlcnJvckNvbnRleHQpIHtcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICBpZiAoIXZhbGlkTm9kZXNUb0luc2VydC5zb21lKCh2YWxpZE5vZGUpPT5ub2RlIGluc3RhbmNlb2YgdmFsaWROb2RlKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBPbmUgb2YgdGhlIG5vZGVzIHRvIGJlIGluc2VydGVkIGlzIG9mIGFuIGludmFsaWQgdHlwZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBOb2RlcyB0byBiZSBpbnNlcnRlZCB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjaW5zZXJ0IGBEb3duY2FzdFdyaXRlciNpbnNlcnQoKWB9IHNob3VsZCBiZVxuXHRcdFx0ICogb2YgdGhlIGZvbGxvd2luZyB0eXBlczpcblx0XHRcdCAqXG5cdFx0XHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IEF0dHJpYnV0ZUVsZW1lbnR9LFxuXHRcdFx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBDb250YWluZXJFbGVtZW50fSxcblx0XHRcdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IEVtcHR5RWxlbWVudH0sXG5cdFx0XHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBVSUVsZW1lbnR9LFxuXHRcdFx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Jhd2VsZW1lbnR+UmF3RWxlbWVudCBSYXdFbGVtZW50fSxcblx0XHRcdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgVGV4dH0uXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHZpZXctd3JpdGVyLWluc2VydC1pbnZhbGlkLW5vZGUtdHlwZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LXdyaXRlci1pbnNlcnQtaW52YWxpZC1ub2RlLXR5cGUnLCBlcnJvckNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbm9kZS5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgdmFsaWRhdGVOb2Rlc1RvSW5zZXJ0KG5vZGUuZ2V0Q2hpbGRyZW4oKSwgZXJyb3JDb250ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIGlmIG5vZGUgaXMgQ29udGFpbmVyRWxlbWVudCBvciBEb2N1bWVudEZyYWdtZW50LCBiZWNhdXNlIGluIG1vc3QgY2FzZXMgdGhleSBzaG91bGQgYmUgdHJlYXRlZCB0aGUgc2FtZSB3YXkuXG4gKlxuICogQHJldHVybnMgUmV0dXJucyBgdHJ1ZWAgaWYgbm9kZSBpcyBpbnN0YW5jZSBvZiBDb250YWluZXJFbGVtZW50IG9yIERvY3VtZW50RnJhZ21lbnQuXG4gKi8gZnVuY3Rpb24gaXNDb250YWluZXJPckZyYWdtZW50KG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZSAmJiAobm9kZS5pcygnY29udGFpbmVyRWxlbWVudCcpIHx8IG5vZGUuaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSk7XG59XG4vKipcbiAqIENoZWNrcyBpZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHJhbmdlIHN0YXJ0fSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgcmFuZ2UgZW5kfSBhcmUgcGxhY2VkXG4gKiBpbnNpZGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBjb250YWluZXIgZWxlbWVudH0uXG4gKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYHZpZXctd3JpdGVyLWludmFsaWQtcmFuZ2UtY29udGFpbmVyYCB3aGVuIHZhbGlkYXRpb24gZmFpbHMuXG4gKi8gZnVuY3Rpb24gdmFsaWRhdGVSYW5nZUNvbnRhaW5lcihyYW5nZSwgZXJyb3JDb250ZXh0KSB7XG4gICAgY29uc3Qgc3RhcnRDb250YWluZXIgPSBnZXRQYXJlbnRDb250YWluZXIocmFuZ2Uuc3RhcnQpO1xuICAgIGNvbnN0IGVuZENvbnRhaW5lciA9IGdldFBhcmVudENvbnRhaW5lcihyYW5nZS5lbmQpO1xuICAgIGlmICghc3RhcnRDb250YWluZXIgfHwgIWVuZENvbnRhaW5lciB8fCBzdGFydENvbnRhaW5lciAhPT0gZW5kQ29udGFpbmVyKSB7XG4gICAgICAgIC8qKlxuXHRcdCAqIFRoZSBjb250YWluZXIgb2YgdGhlIGdpdmVuIHJhbmdlIGlzIGludmFsaWQuXG5cdFx0ICpcblx0XHQgKiBUaGlzIG1heSBoYXBwZW4gaWYge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCByYW5nZSBzdGFydH0gYW5kXG5cdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNlbmQgcmFuZ2UgZW5kfSBwb3NpdGlvbnMgYXJlIG5vdCBwbGFjZWQgaW5zaWRlIHRoZSBzYW1lIGNvbnRhaW5lciBlbGVtZW50IG9yXG5cdFx0ICogYSBwYXJlbnQgY29udGFpbmVyIGZvciB0aGVzZSBwb3NpdGlvbnMgY2Fubm90IGJlIGZvdW5kLlxuXHRcdCAqXG5cdFx0ICogTWV0aG9kcyBsaWtlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjd3JhcCBgRG93bmNhc3RXcml0ZXIjcmVtb3ZlKClgfSxcblx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3dyYXAgYERvd25jYXN0V3JpdGVyI2NsZWFuKClgfSxcblx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI3dyYXAgYERvd25jYXN0V3JpdGVyI3dyYXAoKWB9LFxuXHRcdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjd3JhcCBgRG93bmNhc3RXcml0ZXIjdW53cmFwKClgfSBuZWVkIHRvIGJlIGNhbGxlZFxuXHRcdCAqIG9uIGEgcmFuZ2UgdGhhdCBoYXMgaXRzIHN0YXJ0IGFuZCBlbmQgcG9zaXRpb25zIGxvY2F0ZWQgaW4gdGhlIHNhbWUgY29udGFpbmVyIGVsZW1lbnQuIEJvdGggcG9zaXRpb25zIGNhbiBiZVxuXHRcdCAqIG5lc3RlZCB3aXRoaW4gb3RoZXIgZWxlbWVudHMgKGUuZy4gYW4gYXR0cmlidXRlIGVsZW1lbnQpIGJ1dCB0aGUgY2xvc2VzdCBjb250YWluZXIgYW5jZXN0b3IgbXVzdCBiZSB0aGUgc2FtZS5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciB2aWV3LXdyaXRlci1pbnZhbGlkLXJhbmdlLWNvbnRhaW5lclxuXHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy13cml0ZXItaW52YWxpZC1yYW5nZS1jb250YWluZXInLCBlcnJvckNvbnRleHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBTZXQgb2YgdXRpbGl0aWVzIHJlbGF0ZWQgdG8gaGFuZGxpbmcgYmxvY2sgYW5kIGlubGluZSBmaWxsZXJzLlxuICpcbiAqIEJyb3dzZXJzIGRvIG5vdCBhbGxvdyB0byBwdXQgY2FyZXQgaW4gZWxlbWVudHMgd2hpY2ggZG9lcyBub3QgaGF2ZSBoZWlnaHQuIEJlY2F1c2Ugb2YgaXQsIHdlIG5lZWQgdG8gZmlsbCBhbGxcbiAqIGVtcHR5IGVsZW1lbnRzIHdoaWNoIHNob3VsZCBiZSBzZWxlY3RhYmxlIHdpdGggZWxlbWVudHMgb3IgY2hhcmFjdGVycyBjYWxsZWQgXCJmaWxsZXJzXCIuIFVuZm9ydHVuYXRlbHkgdGhlcmUgaXMgbm8gb25lXG4gKiB1bml2ZXJzYWwgZmlsbGVyLCB0aGlzIGlzIHdoeSB0d28gdHlwZXMgYXJlIHVzZXM6XG4gKlxuICogKiBCbG9jayBmaWxsZXIgaXMgYW4gZWxlbWVudCB3aGljaCBmaWxsIGJsb2NrIGVsZW1lbnRzLCBsaWtlIGA8cD5gLiBDS0VkaXRvciB1c2VzIGA8YnI+YCBhcyBhIGJsb2NrIGZpbGxlciBkdXJpbmcgdGhlIGVkaXRpbmcsXG4gKiBhcyBicm93c2VycyBkbyBuYXRpdmVseS4gU28gaW5zdGVhZCBvZiBhbiBlbXB0eSBgPHA+YCB0aGVyZSB3aWxsIGJlIGA8cD48YnI+PC9wPmAuIFRoZSBhZHZhbnRhZ2Ugb2YgYmxvY2sgZmlsbGVyIGlzIHRoYXRcbiAqIGl0IGlzIHRyYW5zcGFyZW50IGZvciB0aGUgc2VsZWN0aW9uLCBzbyB3aGVuIHRoZSBjYXJldCBpcyBiZWZvcmUgdGhlIGA8YnI+YCBhbmQgdXNlciBwcmVzc2VzIHJpZ2h0IGFycm93IGhlIHdpbGwgYmVcbiAqIG1vdmVkIHRvIHRoZSBuZXh0IHBhcmFncmFwaCwgbm90IGFmdGVyIHRoZSBgPGJyPmAuIFRoZSBkaXNhZHZhbnRhZ2UgaXMgdGhhdCBpdCBicmVha3MgYSBibG9jaywgc28gaXQgY2FuIG5vdCBiZSB1c2VkXG4gKiBpbiB0aGUgbWlkZGxlIG9mIGEgbGluZSBvZiB0ZXh0LiBUaGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXJ+QlJfRklMTEVSIGA8YnI+YCBmaWxsZXJ9IGNhbiBiZSByZXBsYWNlZCB3aXRoIGFueSBvdGhlclxuICogY2hhcmFjdGVyIGluIHRoZSBkYXRhIG91dHB1dCwgZm9yIGluc3RhbmNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfk5CU1BfRklMTEVSIG5vbi1icmVha2luZyBzcGFjZX0gb3JcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfk1BUktFRF9OQlNQX0ZJTExFUiBtYXJrZWQgbm9uLWJyZWFraW5nIHNwYWNlfS5cbiAqXG4gKiAqIElubGluZSBmaWxsZXIgaXMgYSBmaWxsZXIgd2hpY2ggZG9lcyBub3QgYnJlYWsgYSBsaW5lIG9mIHRleHQsIHNvIGl0IGNhbiBiZSB1c2VkIGluc2lkZSB0aGUgdGV4dCwgZm9yIGluc3RhbmNlIGluIHRoZSBlbXB0eVxuICogYDxiPmAgc3VycmVuZGVyZWQgYnkgdGV4dDogYGZvbzxiPjwvYj5iYXJgLCBpZiB3ZSB3YW50IHRvIHB1dCB0aGUgY2FyZXQgdGhlcmUuIENLRWRpdG9yIHVzZXMgYSBzZXF1ZW5jZSBvZiB0aGUgemVyby13aWR0aFxuICogc3BhY2VzIGFzIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfklOTElORV9GSUxMRVIgaW5saW5lIGZpbGxlcn0gaGF2aW5nIHRoZSBwcmVkZXRlcm1pbmVkXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5JTkxJTkVfRklMTEVSX0xFTkdUSCBsZW5ndGh9LiBBIHNlcXVlbmNlIGlzIHVzZWQsIGluc3RlYWQgb2YgYSBzaW5nbGUgY2hhcmFjdGVyIHRvXG4gKiBhdm9pZCB0cmVhdGluZyByYW5kb20gemVyby13aWR0aCBzcGFjZXMgYXMgdGhlIGlubGluZSBmaWxsZXIuIERpc2FkdmFudGFnZSBvZiB0aGUgaW5saW5lIGZpbGxlciBpcyB0aGF0IGl0IGlzIG5vdFxuICogdHJhbnNwYXJlbnQgZm9yIHRoZSBzZWxlY3Rpb24uIFRoZSBhcnJvdyBrZXkgbW92ZXMgdGhlIGNhcmV0IGJldHdlZW4gemVyby13aWR0aCBzcGFjZXMgY2hhcmFjdGVycywgc28gdGhlIGFkZGl0aW9uYWxcbiAqIGNvZGUgaXMgbmVlZGVkIHRvIGhhbmRsZSB0aGUgY2FyZXQuXG4gKlxuICogQm90aCBpbmxpbmUgYW5kIGJsb2NrIGZpbGxlcnMgYXJlIGhhbmRsZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmVuZGVyZXJ+UmVuZGVyZXIgcmVuZGVyZXJ9IGFuZCBhcmUgbm90IHByZXNlbnQgaW4gdGhlXG4gKiB2aWV3LlxuICpcbiAqIEBtb2R1bGUgZW5naW5lL3ZpZXcvZmlsbGVyXG4gKi8gLyoqXG4gKiBOb24tYnJlYWtpbmcgc3BhY2UgZmlsbGVyIGNyZWF0b3IuIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGUgYCZuYnNwO2AgdGV4dCBub2RlLlxuICogSXQgZGVmaW5lcyBob3cgdGhlIGZpbGxlciBpcyBjcmVhdGVkLlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5NQVJLRURfTkJTUF9GSUxMRVJcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5CUl9GSUxMRVJcbiAqLyBjb25zdCBOQlNQX0ZJTExFUiA9IChkb21Eb2N1bWVudCk9PmRvbURvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMEEwJyk7XG4vKipcbiAqIE1hcmtlZCBub24tYnJlYWtpbmcgc3BhY2UgZmlsbGVyIGNyZWF0b3IuIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGUgYDxzcGFuIGRhdGEtY2tlLWZpbGxlcj1cInRydWVcIj4mbmJzcDs8L3NwYW4+YCBlbGVtZW50LlxuICogSXQgZGVmaW5lcyBob3cgdGhlIGZpbGxlciBpcyBjcmVhdGVkLlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5OQlNQX0ZJTExFUlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfkJSX0ZJTExFUlxuICovIGNvbnN0IE1BUktFRF9OQlNQX0ZJTExFUiA9IChkb21Eb2N1bWVudCk9PntcbiAgICBjb25zdCBzcGFuID0gZG9tRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIHNwYW4uZGF0YXNldC5ja2VGaWxsZXIgPSAndHJ1ZSc7XG4gICAgc3Bhbi5pbm5lclRleHQgPSAnXFx1MDBBMCc7XG4gICAgcmV0dXJuIHNwYW47XG59O1xuLyoqXG4gKiBgPGJyPmAgZmlsbGVyIGNyZWF0b3IuIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGUgYDxiciBkYXRhLWNrZS1maWxsZXI9XCJ0cnVlXCI+YCBlbGVtZW50LlxuICogSXQgZGVmaW5lcyBob3cgdGhlIGZpbGxlciBpcyBjcmVhdGVkLlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5OQlNQX0ZJTExFUlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfk1BUktFRF9OQlNQX0ZJTExFUlxuICovIGNvbnN0IEJSX0ZJTExFUiA9IChkb21Eb2N1bWVudCk9PntcbiAgICBjb25zdCBmaWxsZXJCciA9IGRvbURvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJyk7XG4gICAgZmlsbGVyQnIuZGF0YXNldC5ja2VGaWxsZXIgPSAndHJ1ZSc7XG4gICAgcmV0dXJuIGZpbGxlckJyO1xufTtcbi8qKlxuICogTGVuZ3RoIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlcn5JTkxJTkVfRklMTEVSIElOTElORV9GSUxMRVJ9LlxuICovIGNvbnN0IElOTElORV9GSUxMRVJfTEVOR1RIID0gNztcbi8qKlxuICogSW5saW5lIGZpbGxlciB3aGljaCBpcyBhIHNlcXVlbmNlIG9mIHRoZSB3b3JkIGpvaW5lcnMuXG4gKi8gY29uc3QgSU5MSU5FX0ZJTExFUiA9ICdcXHUyMDYwJy5yZXBlYXQoSU5MSU5FX0ZJTExFUl9MRU5HVEgpO1xuLyoqXG4gKiBDaGVja3MgaWYgdGhlIG5vZGUgaXMgYSB0ZXh0IG5vZGUgd2hpY2ggc3RhcnRzIHdpdGggdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfklOTElORV9GSUxMRVIgaW5saW5lIGZpbGxlcn0uXG4gKlxuICogYGBgdHNcbiAqIHN0YXJ0c1dpdGhGaWxsZXIoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBJTkxJTkVfRklMTEVSICkgKTsgLy8gdHJ1ZVxuICogc3RhcnRzV2l0aEZpbGxlciggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIElOTElORV9GSUxMRVIgKyAnZm9vJyApICk7IC8vIHRydWVcbiAqIHN0YXJ0c1dpdGhGaWxsZXIoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCAnZm9vJyApICk7IC8vIGZhbHNlXG4gKiBzdGFydHNXaXRoRmlsbGVyKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAncCcgKSApOyAvLyBmYWxzZVxuICogYGBgXG4gKlxuICogQHBhcmFtIGRvbU5vZGUgRE9NIG5vZGUuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0ZXh0IG5vZGUgc3RhcnRzIHdpdGggdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfklOTElORV9GSUxMRVIgaW5saW5lIGZpbGxlcn0uXG4gKi8gZnVuY3Rpb24gc3RhcnRzV2l0aEZpbGxlcihkb21Ob2RlKSB7XG4gICAgaWYgKHR5cGVvZiBkb21Ob2RlID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBkb21Ob2RlLnN1YnN0cigwLCBJTkxJTkVfRklMTEVSX0xFTkdUSCkgPT09IElOTElORV9GSUxMRVI7XG4gICAgfVxuICAgIHJldHVybiBpc1RleHQoZG9tTm9kZSkgJiYgZG9tTm9kZS5kYXRhLnN1YnN0cigwLCBJTkxJTkVfRklMTEVSX0xFTkdUSCkgPT09IElOTElORV9GSUxMRVI7XG59XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgdGV4dCBub2RlIGNvbnRhaW5zIG9ubHkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyfklOTElORV9GSUxMRVIgaW5saW5lIGZpbGxlcn0uXG4gKlxuICogYGBgdHNcbiAqIGlzSW5saW5lRmlsbGVyKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggSU5MSU5FX0ZJTExFUiApICk7IC8vIHRydWVcbiAqIGlzSW5saW5lRmlsbGVyKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggSU5MSU5FX0ZJTExFUiArICdmb28nICkgKTsgLy8gZmFsc2VcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBkb21UZXh0IERPTSB0ZXh0IG5vZGUuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0ZXh0IG5vZGUgY29udGFpbnMgb25seSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXJ+SU5MSU5FX0ZJTExFUiBpbmxpbmUgZmlsbGVyfS5cbiAqLyBmdW5jdGlvbiBpc0lubGluZUZpbGxlcihkb21UZXh0KSB7XG4gICAgcmV0dXJuIGRvbVRleHQuZGF0YS5sZW5ndGggPT0gSU5MSU5FX0ZJTExFUl9MRU5HVEggJiYgc3RhcnRzV2l0aEZpbGxlcihkb21UZXh0KTtcbn1cbi8qKlxuICogR2V0IHN0cmluZyBkYXRhIGZyb20gdGhlIHRleHQgbm9kZSwgcmVtb3ZpbmcgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXJ+SU5MSU5FX0ZJTExFUiBpbmxpbmUgZmlsbGVyfSBmcm9tIGl0LFxuICogaWYgdGV4dCBub2RlIGNvbnRhaW5zIGl0LlxuICpcbiAqIGBgYHRzXG4gKiBnZXREYXRhV2l0aG91dEZpbGxlciggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIElOTElORV9GSUxMRVIgKyAnZm9vJyApICkgPT0gJ2ZvbycgLy8gdHJ1ZVxuICogZ2V0RGF0YVdpdGhvdXRGaWxsZXIoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCAnZm9vJyApICkgPT0gJ2ZvbycgLy8gdHJ1ZVxuICogYGBgXG4gKlxuICogQHBhcmFtIGRvbVRleHQgRE9NIHRleHQgbm9kZSwgcG9zc2libGUgd2l0aCBpbmxpbmUgZmlsbGVyLlxuICogQHJldHVybnMgRGF0YSB3aXRob3V0IGZpbGxlci5cbiAqLyBmdW5jdGlvbiBnZXREYXRhV2l0aG91dEZpbGxlcihkb21UZXh0KSB7XG4gICAgY29uc3QgZGF0YSA9IHR5cGVvZiBkb21UZXh0ID09ICdzdHJpbmcnID8gZG9tVGV4dCA6IGRvbVRleHQuZGF0YTtcbiAgICBpZiAoc3RhcnRzV2l0aEZpbGxlcihkb21UZXh0KSkge1xuICAgICAgICByZXR1cm4gZGF0YS5zbGljZShJTkxJTkVfRklMTEVSX0xFTkdUSCk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuLyoqXG4gKiBBc3NpZ24ga2V5IG9ic2VydmVyIHdoaWNoIG1vdmUgY3Vyc29yIGZyb20gdGhlIGVuZCBvZiB0aGUgaW5saW5lIGZpbGxlciB0byB0aGUgYmVnaW5uaW5nIG9mIGl0IHdoZW5cbiAqIHRoZSBsZWZ0IGFycm93IGlzIHByZXNzZWQsIHNvIHRoZSBmaWxsZXIgZG9lcyBub3QgYnJlYWsgbmF2aWdhdGlvbi5cbiAqXG4gKiBAcGFyYW0gdmlldyBWaWV3IGNvbnRyb2xsZXIgaW5zdGFuY2Ugd2Ugc2hvdWxkIGluamVjdCBxdWlya3MgaGFuZGxpbmcgb24uXG4gKi8gZnVuY3Rpb24gaW5qZWN0UXVpcmtzSGFuZGxpbmcodmlldykge1xuICAgIHZpZXcuZG9jdW1lbnQub24oJ2Fycm93S2V5JywganVtcE92ZXJJbmxpbmVGaWxsZXIsIHtcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgfSk7XG59XG4vKipcbiAqIE1vdmUgY3Vyc29yIGZyb20gdGhlIGVuZCBvZiB0aGUgaW5saW5lIGZpbGxlciB0byB0aGUgYmVnaW5uaW5nIG9mIGl0IHdoZW4sIHNvIHRoZSBmaWxsZXIgZG9lcyBub3QgYnJlYWsgbmF2aWdhdGlvbi5cbiAqLyBmdW5jdGlvbiBqdW1wT3ZlcklubGluZUZpbGxlcihldnQsIGRhdGEpIHtcbiAgICBpZiAoZGF0YS5rZXlDb2RlID09IGtleUNvZGVzLmFycm93bGVmdCkge1xuICAgICAgICBjb25zdCBkb21TZWxlY3Rpb24gPSBkYXRhLmRvbVRhcmdldC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LmdldFNlbGVjdGlvbigpO1xuICAgICAgICBpZiAoZG9tU2VsZWN0aW9uLnJhbmdlQ291bnQgPT0gMSAmJiBkb21TZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKS5jb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGRvbVBhcmVudCA9IGRvbVNlbGVjdGlvbi5nZXRSYW5nZUF0KDApLnN0YXJ0Q29udGFpbmVyO1xuICAgICAgICAgICAgY29uc3QgZG9tT2Zmc2V0ID0gZG9tU2VsZWN0aW9uLmdldFJhbmdlQXQoMCkuc3RhcnRPZmZzZXQ7XG4gICAgICAgICAgICBpZiAoc3RhcnRzV2l0aEZpbGxlcihkb21QYXJlbnQpICYmIGRvbU9mZnNldCA8PSBJTkxJTkVfRklMTEVSX0xFTkdUSCkge1xuICAgICAgICAgICAgICAgIGRvbVNlbGVjdGlvbi5jb2xsYXBzZShkb21QYXJlbnQsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFJlbmRlcmVyIGlzIHJlc3BvbnNpYmxlIGZvciB1cGRhdGluZyB0aGUgRE9NIHN0cnVjdHVyZSBhbmQgdGhlIERPTSBzZWxlY3Rpb24gYmFzZWQgb25cbiAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JlbmRlcmVyflJlbmRlcmVyI21hcmtUb1N5bmMgaW5mb3JtYXRpb24gYWJvdXQgdXBkYXRlZCB2aWV3IG5vZGVzfS5cbiAqIEluIG90aGVyIHdvcmRzLCBpdCByZW5kZXJzIHRoZSB2aWV3IHRvIHRoZSBET00uXG4gKlxuICogSXRzIG1haW4gcmVzcG9uc2liaWxpdHkgaXMgdG8gbWFrZSBvbmx5IHRoZSBuZWNlc3NhcnksIG1pbmltYWwgY2hhbmdlcyB0byB0aGUgRE9NLiBIb3dldmVyLCB1bmxpa2UgaW4gbWFueVxuICogdmlydHVhbCBET00gaW1wbGVtZW50YXRpb25zLCB0aGUgcHJpbWFyeSByZWFzb24gZm9yIGRvaW5nIG1pbmltYWwgY2hhbmdlcyBpcyBub3QgdGhlIHBlcmZvcm1hbmNlIGJ1dCBlbnN1cmluZ1xuICogdGhhdCBuYXRpdmUgZWRpdGluZyBmZWF0dXJlcyBzdWNoIGFzIHRleHQgY29tcG9zaXRpb24sIGF1dG9jb21wbGV0aW9uLCBzcGVsbCBjaGVja2luZywgc2VsZWN0aW9uJ3MgeC1pbmRleCBhcmVcbiAqIGFmZmVjdGVkIGFzIGxpdHRsZSBhcyBwb3NzaWJsZS5cbiAqXG4gKiBSZW5kZXJlciB1c2VzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlcn0gdG8gdHJhbnNmb3JtIHZpZXcgbm9kZXMgYW5kIHBvc2l0aW9uc1xuICogdG8gYW5kIGZyb20gdGhlIERPTS5cbiAqLyBjbGFzcyBSZW5kZXJlciBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBPYnNlcnZhYmxlTWl4aW4oKSB7XG4gICAgLyoqXG5cdCAqIFNldCBvZiBET00gRG9jdW1lbnRzIGluc3RhbmNlcy5cblx0ICovIGRvbURvY3VtZW50cyA9IG5ldyBTZXQoKTtcbiAgICAvKipcblx0ICogQ29udmVydGVyIGluc3RhbmNlLlxuXHQgKi8gZG9tQ29udmVydGVyO1xuICAgIC8qKlxuXHQgKiBTZXQgb2Ygbm9kZXMgd2hpY2ggYXR0cmlidXRlcyBjaGFuZ2VkIGFuZCBtYXkgbmVlZCB0byBiZSByZW5kZXJlZC5cblx0ICovIG1hcmtlZEF0dHJpYnV0ZXMgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIFNldCBvZiBlbGVtZW50cyB3aGljaCBjaGlsZCBsaXN0cyBjaGFuZ2VkIGFuZCBtYXkgbmVlZCB0byBiZSByZW5kZXJlZC5cblx0ICovIG1hcmtlZENoaWxkcmVuID0gbmV3IFNldCgpO1xuICAgIC8qKlxuXHQgKiBTZXQgb2YgdGV4dCBub2RlcyB3aGljaCB0ZXh0IGRhdGEgY2hhbmdlZCBhbmQgbWF5IG5lZWQgdG8gYmUgcmVuZGVyZWQuXG5cdCAqLyBtYXJrZWRUZXh0cyA9IG5ldyBTZXQoKTtcbiAgICAvKipcblx0ICogVmlldyBzZWxlY3Rpb24uIFJlbmRlcmVyIHVwZGF0ZXMgRE9NIHNlbGVjdGlvbiBiYXNlZCBvbiB0aGUgdmlldyBzZWxlY3Rpb24uXG5cdCAqLyBzZWxlY3Rpb247XG4gICAgLyoqXG5cdCAqIFRoZSB0ZXh0IG5vZGUgaW4gd2hpY2ggdGhlIGlubGluZSBmaWxsZXIgd2FzIHJlbmRlcmVkLlxuXHQgKi8gX2lubGluZUZpbGxlciA9IG51bGw7XG4gICAgLyoqXG5cdCAqIERPTSBlbGVtZW50IGNvbnRhaW5pbmcgZmFrZSBzZWxlY3Rpb24uXG5cdCAqLyBfZmFrZVNlbGVjdGlvbkNvbnRhaW5lciA9IG51bGw7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByZW5kZXJlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIGRvbUNvbnZlcnRlciBDb252ZXJ0ZXIgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBzZWxlY3Rpb24gVmlldyBzZWxlY3Rpb24uXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb21Db252ZXJ0ZXIsIHNlbGVjdGlvbil7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyID0gZG9tQ29udmVydGVyO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbiA9IHNlbGVjdGlvbjtcbiAgICAgICAgdGhpcy5zZXQoJ2lzRm9jdXNlZCcsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5zZXQoJ2lzU2VsZWN0aW5nJywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgnaXNDb21wb3NpbmcnLCBmYWxzZSk7XG4gICAgICAgIC8vIFJlbmRlcmluZyB0aGUgc2VsZWN0aW9uIGFuZCBpbmxpbmUgZmlsbGVyIG1hbmlwdWxhdGlvbiBzaG91bGQgYmUgcG9zdHBvbmVkIGluIChub24tQW5kcm9pZCkgQmxpbmsgdW50aWwgdGhlIHVzZXIgZmluaXNoZXNcbiAgICAgICAgLy8gY3JlYXRpbmcgdGhlIHNlbGVjdGlvbiBpbiBET00gdG8gYXZvaWQgYWNjaWRlbnRhbCBzZWxlY3Rpb24gY29sbGFwc2luZ1xuICAgICAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTA1NjIsIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEwNzIzKS5cbiAgICAgICAgLy8gV2hlbiB0aGUgdXNlciBzdG9wcyBzZWxlY3RpbmcsIGFsbCBwZW5kaW5nIGNoYW5nZXMgc2hvdWxkIGJlIHJlbmRlcmVkIEFTQVAsIHRob3VnaC5cbiAgICAgICAgaWYgKGVudi5pc0JsaW5rICYmICFlbnYuaXNBbmRyb2lkKSB7XG4gICAgICAgICAgICB0aGlzLm9uKCdjaGFuZ2U6aXNTZWxlY3RpbmcnLCAoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc1NlbGVjdGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYXJrcyBhIHZpZXcgbm9kZSB0byBiZSB1cGRhdGVkIGluIHRoZSBET00gYnkge0BsaW5rICNyZW5kZXIgYHJlbmRlcigpYH0uXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBvbmx5IHZpZXcgbm9kZXMgd2hvc2UgcGFyZW50cyBoYXZlIGNvcnJlc3BvbmRpbmcgRE9NIGVsZW1lbnRzIG5lZWQgdG8gYmUgbWFya2VkIHRvIGJlIHN5bmNocm9uaXplZC5cblx0ICpcblx0ICogQHNlZSAjbWFya2VkQXR0cmlidXRlc1xuXHQgKiBAc2VlICNtYXJrZWRDaGlsZHJlblxuXHQgKiBAc2VlICNtYXJrZWRUZXh0c1xuXHQgKlxuXHQgKiBAcGFyYW0gdHlwZSBUeXBlIG9mIHRoZSBjaGFuZ2UuXG5cdCAqIEBwYXJhbSBub2RlIFZpZXdOb2RlIHRvIGJlIG1hcmtlZC5cblx0ICovIG1hcmtUb1N5bmModHlwZSwgbm9kZSkge1xuICAgICAgICBpZiAodHlwZSA9PT0gJ3RleHQnKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKG5vZGUucGFyZW50KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFya2VkVGV4dHMuYWRkKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgdGhlIG5vZGUgaGFzIG5vIERPTSBlbGVtZW50IGl0IGlzIG5vdCByZW5kZXJlZCB5ZXQsXG4gICAgICAgICAgICAvLyBpdHMgY2hpbGRyZW4vYXR0cmlidXRlcyBkbyBub3QgbmVlZCB0byBiZSBtYXJrZWQgdG8gYmUgc3luYy5cbiAgICAgICAgICAgIGlmICghdGhpcy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdhdHRyaWJ1dGVzJykge1xuICAgICAgICAgICAgICAgIHRoaXMubWFya2VkQXR0cmlidXRlcy5hZGQobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjaGlsZHJlbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtlZENoaWxkcmVuLmFkZChub2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFVua25vd24gdHlwZSBwYXNzZWQgdG8gUmVuZGVyZXIubWFya1RvU3luYy5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIHZpZXctcmVuZGVyZXItdW5rbm93bi10eXBlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1yZW5kZXJlci11bmtub3duLXR5cGUnLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVuZGVycyBhbGwgYnVmZmVyZWQgY2hhbmdlcyAoe0BsaW5rICNtYXJrZWRBdHRyaWJ1dGVzfSwge0BsaW5rICNtYXJrZWRDaGlsZHJlbn0gYW5kIHtAbGluayAjbWFya2VkVGV4dHN9KSBhbmRcblx0ICogdGhlIGN1cnJlbnQgdmlldyBzZWxlY3Rpb24gKGlmIG5lZWRlZCkgdG8gdGhlIERPTSBieSBhcHBseWluZyBhIG1pbmltYWwgc2V0IG9mIGNoYW5nZXMgdG8gaXQuXG5cdCAqXG5cdCAqIFJlbmRlcmVyIHRyaWVzIG5vdCB0byBicmVhayB0aGUgdGV4dCBjb21wb3NpdGlvbiAoZS5nLiBJTUUpIGFuZCB4LWluZGV4IG9mIHRoZSBzZWxlY3Rpb24sXG5cdCAqIHNvIGl0IGRvZXMgYXMgbGl0dGxlIGFzIGl0IGlzIG5lZWRlZCB0byB1cGRhdGUgdGhlIERPTS5cblx0ICpcblx0ICogUmVuZGVyZXIgYWxzbyBoYW5kbGVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcnN9LiBFc3BlY2lhbGx5LCBpdCBjaGVja3MgaWYgdGhlIGlubGluZSBmaWxsZXIgaXMgbmVlZGVkXG5cdCAqIGF0IHRoZSBzZWxlY3Rpb24gcG9zaXRpb24gYW5kIGFkZHMgb3IgcmVtb3ZlcyBpdC4gVG8gcHJldmVudCBicmVha2luZyB0ZXh0IGNvbXBvc2l0aW9uIGlubGluZSBmaWxsZXIgd2lsbCBub3QgYmVcblx0ICogcmVtb3ZlZCBhcyBsb25nIGFzIHRoZSBzZWxlY3Rpb24gaXMgaW4gdGhlIHRleHQgbm9kZSB3aGljaCBuZWVkZWQgaXQgYXQgZmlyc3QuXG5cdCAqLyByZW5kZXIoKSB7XG4gICAgICAgIC8vIElnbm9yZSByZW5kZXJpbmcgd2hpbGUgaW4gdGhlIGNvbXBvc2l0aW9uIG1vZGUuIENvbXBvc2l0aW9uIGV2ZW50cyBhcmUgbm90IGNhbmNlbGxhYmxlIGFuZCBicm93c2VyIHdpbGwgbW9kaWZ5IHRoZSBET00gdHJlZS5cbiAgICAgICAgLy8gQWxsIG1hcmtlZCBlbGVtZW50cywgYXR0cmlidXRlcywgZXRjLiB3aWxsIHdhaXQgdW50aWwgbmV4dCByZW5kZXIgYWZ0ZXIgdGhlIGNvbXBvc2l0aW9uIGVuZHMuXG4gICAgICAgIC8vIE9uIEFuZHJvaWQgY29tcG9zaXRpb24gZXZlbnRzIGFyZSBpbW1lZGlhdGVseSBhcHBsaWVkIHRvIHRoZSBtb2RlbCwgc28gd2UgZG9uJ3QgbmVlZCB0byBza2lwIHJlbmRlcmluZyxcbiAgICAgICAgLy8gYW5kIHdlIHNob3VsZCBub3QgZG8gaXQgYmVjYXVzZSB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHZpZXcgYW5kIERPTSBjb3VsZCBsZWFkIHRvIHBvc2l0aW9uIG1hcHBpbmcgcHJvYmxlbXMuXG4gICAgICAgIGlmICh0aGlzLmlzQ29tcG9zaW5nICYmICFlbnYuaXNBbmRyb2lkKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggJyVjW1JlbmRlcmVyXSVjIFJlbmRlcmluZyBhYm9ydGVkIHdoaWxlIGlzQ29tcG9zaW5nLicsXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsICdmb250LXN0eWxlOiBpdGFsaWMnXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmdyb3VwKCAnJWNbUmVuZGVyZXJdJWMgUmVuZGVyaW5nJyxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC13ZWlnaHQ6IGJvbGQnXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgbGV0IGlubGluZUZpbGxlclBvc2l0aW9uID0gbnVsbDtcbiAgICAgICAgY29uc3QgaXNJbmxpbmVGaWxsZXJSZW5kZXJpbmdQb3NzaWJsZSA9IGVudi5pc0JsaW5rICYmICFlbnYuaXNBbmRyb2lkID8gIXRoaXMuaXNTZWxlY3RpbmcgOiB0cnVlO1xuICAgICAgICAvLyBSZWZyZXNoIG1hcHBpbmdzLlxuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgdGhpcy5tYXJrZWRDaGlsZHJlbil7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDaGlsZHJlbk1hcHBpbmdzKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvbid0IG1hbmlwdWxhdGUgaW5saW5lIGZpbGxlcnMgd2hpbGUgdGhlIHNlbGVjdGlvbiBpcyBiZWluZyBtYWRlIGluIChub24tQW5kcm9pZCkgQmxpbmsgdG8gcHJldmVudCBhY2NpZGVudGFsXG4gICAgICAgIC8vIERPTSBzZWxlY3Rpb24gY29sbGFwc2luZ1xuICAgICAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTA1NjIsIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEwNzIzKS5cbiAgICAgICAgaWYgKGlzSW5saW5lRmlsbGVyUmVuZGVyaW5nUG9zc2libGUpIHtcbiAgICAgICAgICAgIC8vIFRoZXJlIHdhcyBpbmxpbmUgZmlsbGVyIHJlbmRlcmVkIGluIHRoZSBET00gYnV0IGl0J3Mgbm90XG4gICAgICAgICAgICAvLyBhdCB0aGUgc2VsZWN0aW9uIHBvc2l0aW9uIGFueSBtb3JlLCBzbyB3ZSBjYW4gcmVtb3ZlIGl0XG4gICAgICAgICAgICAvLyAoY2F1c2UgZXZlbiBpZiBpdCdzIG5lZWRlZCwgaXQgbXVzdCBiZSBwbGFjZWQgaW4gYW5vdGhlciBsb2NhdGlvbikuXG4gICAgICAgICAgICBpZiAodGhpcy5faW5saW5lRmlsbGVyICYmICF0aGlzLl9pc1NlbGVjdGlvbkluSW5saW5lRmlsbGVyKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVJbmxpbmVGaWxsZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlJ3ZlIGdvdCB0aGUgZmlsbGVyLCBsZXQncyB0cnkgdG8gZ3Vlc3MgaXRzIHBvc2l0aW9uIGluIHRoZSB2aWV3LlxuICAgICAgICAgICAgaWYgKHRoaXMuX2lubGluZUZpbGxlcikge1xuICAgICAgICAgICAgICAgIGlubGluZUZpbGxlclBvc2l0aW9uID0gdGhpcy5fZ2V0SW5saW5lRmlsbGVyUG9zaXRpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fbmVlZHNJbmxpbmVGaWxsZXJBdFNlbGVjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgaW5saW5lRmlsbGVyUG9zaXRpb24gPSB0aGlzLnNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy8gRG8gbm90IHVzZSBgbWFya1RvU3luY2Agc28gaXQgd2lsbCBiZSBhZGRlZCBldmVuIGlmIHRoZSBwYXJlbnQgaXMgYWxyZWFkeSBhZGRlZC5cbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtlZENoaWxkcmVuLmFkZChpbmxpbmVGaWxsZXJQb3NpdGlvbi5wYXJlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2lubGluZUZpbGxlciAmJiB0aGlzLl9pbmxpbmVGaWxsZXIucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgLy8gV2hpbGUgdGhlIHVzZXIgaXMgbWFraW5nIHNlbGVjdGlvbiwgcHJlc2VydmUgdGhlIGlubGluZSBmaWxsZXIgYXQgaXRzIG9yaWdpbmFsIHBvc2l0aW9uLlxuICAgICAgICAgICAgaW5saW5lRmlsbGVyUG9zaXRpb24gPSB0aGlzLmRvbUNvbnZlcnRlci5kb21Qb3NpdGlvblRvVmlldyh0aGlzLl9pbmxpbmVGaWxsZXIpO1xuICAgICAgICAgICAgLy8gV2hpbGUgZG93bi1jYXN0aW5nIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gYXR0cmlidXRlcywgYWxsIGV4aXN0aW5nIGVtcHR5XG4gICAgICAgICAgICAvLyBhdHRyaWJ1dGUgZWxlbWVudHMgKGZvciBzZWxlY3Rpb24gcG9zaXRpb24pIGFyZSByZW1vdmVkIGZyb20gdGhlIHZpZXcgYW5kIERPTSxcbiAgICAgICAgICAgIC8vIHNvIG1ha2Ugc3VyZSB0aGF0IHdlIHdlcmUgYWJsZSB0byBtYXAgZmlsbGVyIHBvc2l0aW9uLlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTIwMjZcbiAgICAgICAgICAgIGlmIChpbmxpbmVGaWxsZXJQb3NpdGlvbiAmJiBpbmxpbmVGaWxsZXJQb3NpdGlvbi5wYXJlbnQuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgaW5saW5lIGZpbGxlciBwb3NpdGlvbiBpcyBleHBlY3RlZCB0byBiZSBiZWZvcmUgdGhlIHRleHQgbm9kZS5cbiAgICAgICAgICAgICAgICBpbmxpbmVGaWxsZXJQb3NpdGlvbiA9IFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZShpbmxpbmVGaWxsZXJQb3NpdGlvbi5wYXJlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLm1hcmtlZEF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQXR0cnMoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMubWFya2VkQ2hpbGRyZW4pe1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ2hpbGRyZW4oZWxlbWVudCwge1xuICAgICAgICAgICAgICAgIGlubGluZUZpbGxlclBvc2l0aW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpcy5tYXJrZWRUZXh0cyl7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWFya2VkQ2hpbGRyZW4uaGFzKG5vZGUucGFyZW50KSAmJiB0aGlzLmRvbUNvbnZlcnRlci5tYXBWaWV3VG9Eb20obm9kZS5wYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlVGV4dChub2RlLCB7XG4gICAgICAgICAgICAgICAgICAgIGlubGluZUZpbGxlclBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gKiBDaGVjayB3aGV0aGVyIHRoZSBpbmxpbmUgZmlsbGVyIGlzIHJlcXVpcmVkIGFuZCB3aGVyZSBpdCByZWFsbHkgaXMgaW4gdGhlIERPTS5cbiAgICAgICAgLy8gICBBdCB0aGlzIHBvaW50IGluIG1vc3QgY2FzZXMgaXQgd2lsbCBiZSBpbiB0aGUgRE9NLCBidXQgdGhlcmUgYXJlIGV4Y2VwdGlvbnMuXG4gICAgICAgIC8vICAgRm9yIGV4YW1wbGUsIGlmIHRoZSBpbmxpbmUgZmlsbGVyIHdhcyBkZWVwIGluIHRoZSBjcmVhdGVkIERPTSBzdHJ1Y3R1cmUsIGl0IHdpbGwgbm90IGJlIGNyZWF0ZWQuXG4gICAgICAgIC8vICAgU2ltaWxhcmx5LCBpZiBpdCB3YXMgcmVtb3ZlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgZnVuY3Rpb24gYW5kIHRoZW4gbmVpdGhlciB0ZXh0IG5vciBjaGlsZHJlbiB3ZXJlIHVwZGF0ZWQsXG4gICAgICAgIC8vICAgaXQgd2lsbCBub3QgYmUgcHJlc2VudC4gRml4IHRob3NlIGFuZCBzaW1pbGFyIHNjZW5hcmlvcy5cbiAgICAgICAgLy8gKiBEb24ndCBtYW5pcHVsYXRlIGlubGluZSBmaWxsZXJzIHdoaWxlIHRoZSBzZWxlY3Rpb24gaXMgYmVpbmcgbWFkZSBpbiAobm9uLUFuZHJvaWQpIEJsaW5rIHRvIHByZXZlbnQgYWNjaWRlbnRhbFxuICAgICAgICAvLyAgIERPTSBzZWxlY3Rpb24gY29sbGFwc2luZ1xuICAgICAgICAvLyAgIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMDU2MiwgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTA3MjMpLlxuICAgICAgICBpZiAoaXNJbmxpbmVGaWxsZXJSZW5kZXJpbmdQb3NzaWJsZSkge1xuICAgICAgICAgICAgaWYgKGlubGluZUZpbGxlclBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsbGVyRG9tUG9zaXRpb24gPSB0aGlzLmRvbUNvbnZlcnRlci52aWV3UG9zaXRpb25Ub0RvbShpbmxpbmVGaWxsZXJQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgY29uc3QgZG9tRG9jdW1lbnQgPSBmaWxsZXJEb21Qb3NpdGlvbi5wYXJlbnQub3duZXJEb2N1bWVudDtcbiAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0c1dpdGhGaWxsZXIoZmlsbGVyRG9tUG9zaXRpb24ucGFyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaWxsZXIgaGFzIG5vdCBiZWVuIGNyZWF0ZWQgYXQgZmlsbGVyIHBvc2l0aW9uLiBDcmVhdGUgaXQgbm93LlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbmxpbmVGaWxsZXIgPSBhZGRJbmxpbmVGaWxsZXIoZG9tRG9jdW1lbnQsIGZpbGxlckRvbVBvc2l0aW9uLnBhcmVudCwgZmlsbGVyRG9tUG9zaXRpb24ub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaWxsZXIgaGFzIGJlZW4gZm91bmQsIHNhdmUgaXQuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lubGluZUZpbGxlciA9IGZpbGxlckRvbVBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGZpbGxlciBuZWVkZWQuXG4gICAgICAgICAgICAgICAgdGhpcy5faW5saW5lRmlsbGVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBGaXJzdCBmb2N1cyB0aGUgbmV3IGVkaXRpbmcgaG9zdCwgdGhlbiB1cGRhdGUgdGhlIHNlbGVjdGlvbi5cbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBGRiBtYXkgdGhyb3cgYW4gZXJyb3IgKGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzcyMSkuXG4gICAgICAgIHRoaXMuX3VwZGF0ZUZvY3VzKCk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLmRvbUNvbnZlcnRlci5fY2xlYXJUZW1wb3JhcnlDdXN0b21Qcm9wZXJ0aWVzKCk7XG4gICAgICAgIHRoaXMubWFya2VkVGV4dHMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5tYXJrZWRBdHRyaWJ1dGVzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMubWFya2VkQ2hpbGRyZW4uY2xlYXIoKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIG1hcHBpbmdzIG9mIHZpZXcgZWxlbWVudCdzIGNoaWxkcmVuLlxuXHQgKlxuXHQgKiBDaGlsZHJlbiB0aGF0IHdlcmUgcmVwbGFjZWQgaW4gdGhlIHZpZXcgc3RydWN0dXJlIGJ5IHNpbWlsYXIgZWxlbWVudHMgKHNhbWUgdGFnIG5hbWUpIGFyZSB0cmVhdGVkIGFzICdyZXBsYWNlZCcuXG5cdCAqIFRoaXMgbWVhbnMgdGhhdCB0aGVpciBtYXBwaW5ncyBjYW4gYmUgdXBkYXRlZCBzbyB0aGUgbmV3IHZpZXcgZWxlbWVudHMgYXJlIG1hcHBlZCB0byB0aGUgZXhpc3RpbmcgRE9NIGVsZW1lbnRzLlxuXHQgKiBUaGFua3MgdG8gdGhhdCB0aGVzZSBlbGVtZW50cyBkbyBub3QgbmVlZCB0byBiZSByZS1yZW5kZXJlZCBjb21wbGV0ZWx5LlxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnQgVGhlIHZpZXcgZWxlbWVudCB3aG9zZSBjaGlsZHJlbiBtYXBwaW5ncyB3aWxsIGJlIHVwZGF0ZWQuXG5cdCAqLyBfdXBkYXRlQ2hpbGRyZW5NYXBwaW5ncyh2aWV3RWxlbWVudCkge1xuICAgICAgICBjb25zdCBkb21FbGVtZW50ID0gdGhpcy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHZpZXdFbGVtZW50KTtcbiAgICAgICAgaWYgKCFkb21FbGVtZW50KSB7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBgZG9tRWxlbWVudGAgaXQgbWVhbnMgdGhhdCBpdCB3YXMgYWxyZWFkeSByZW1vdmVkIGZyb20gRE9NIGFuZCB0aGVyZSBpcyBubyBuZWVkIHRvIHByb2Nlc3MgaXQuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVtb3Zpbmcgbm9kZXMgZnJvbSB0aGUgRE9NIGFzIHdlIGl0ZXJhdGUgY2FuIGNhdXNlIGBhY3R1YWxEb21DaGlsZHJlbmBcbiAgICAgICAgLy8gKHdoaWNoIGlzIGEgbGl2ZS11cGRhdGluZyBgTm9kZUxpc3RgKSB0byBnZXQgb3V0IG9mIHN5bmMgd2l0aCB0aGVcbiAgICAgICAgLy8gaW5kaWNlcyB0aGF0IHdlIGNvbXB1dGUgYXMgd2UgaXRlcmF0ZSBvdmVyIGBhY3Rpb25zYC5cbiAgICAgICAgLy8gVGhpcyB3b3VsZCBwcm9kdWNlIGluY29ycmVjdCBlbGVtZW50IG1hcHBpbmdzLlxuICAgICAgICAvL1xuICAgICAgICAvLyBDb252ZXJ0aW5nIGxpdmUgbGlzdCB0byBhbiBhcnJheSB0byBtYWtlIHRoZSBsaXN0IHN0YXRpYy5cbiAgICAgICAgY29uc3QgYWN0dWFsRG9tQ2hpbGRyZW4gPSBBcnJheS5mcm9tKGRvbUVsZW1lbnQuY2hpbGROb2Rlcyk7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkRG9tQ2hpbGRyZW4gPSBBcnJheS5mcm9tKHRoaXMuZG9tQ29udmVydGVyLnZpZXdDaGlsZHJlblRvRG9tKHZpZXdFbGVtZW50LCB7XG4gICAgICAgICAgICB3aXRoQ2hpbGRyZW46IGZhbHNlXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgZGlmZiA9IHRoaXMuX2RpZmZOb2RlTGlzdHMoYWN0dWFsRG9tQ2hpbGRyZW4sIGV4cGVjdGVkRG9tQ2hpbGRyZW4pO1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5fZmluZFVwZGF0ZUFjdGlvbnMoZGlmZiwgYWN0dWFsRG9tQ2hpbGRyZW4sIGV4cGVjdGVkRG9tQ2hpbGRyZW4sIGFyZVNpbWlsYXJFbGVtZW50cyk7XG4gICAgICAgIGlmIChhY3Rpb25zLmluZGV4T2YoJ3VwZGF0ZScpICE9PSAtMSkge1xuICAgICAgICAgICAgY29uc3QgY291bnRlciA9IHtcbiAgICAgICAgICAgICAgICBlcXVhbDogMCxcbiAgICAgICAgICAgICAgICBpbnNlcnQ6IDAsXG4gICAgICAgICAgICAgICAgZGVsZXRlOiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucyl7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ3VwZGF0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zZXJ0SW5kZXggPSBjb3VudGVyLmVxdWFsICsgY291bnRlci5pbnNlcnQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlbGV0ZUluZGV4ID0gY291bnRlci5lcXVhbCArIGNvdW50ZXIuZGVsZXRlO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3Q2hpbGQgPSB2aWV3RWxlbWVudC5nZXRDaGlsZChpbnNlcnRJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVJRWxlbWVudCBhbmQgUmF3RWxlbWVudCBhcmUgc3BlY2lhbCBjYXNlcy4gVGhlaXIgY2hpbGRyZW4gYXJlIG5vdCBzdG9yZWQgaW4gYSB2aWV3ICgjNzk5KVxuICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBjYW5ub3QgdXNlIHRoZW0gd2l0aCByZXBsYWNpbmcgZmxvdyAoc2luY2UgdGhleSB1c2UgdmlldyBjaGlsZHJlbiBkdXJpbmcgcmVuZGVyaW5nXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoaWNoIHdpbGwgYWx3YXlzIHJlc3VsdCBpbiByZW5kZXJpbmcgZW1wdHkgZWxlbWVudHMpLlxuICAgICAgICAgICAgICAgICAgICBpZiAodmlld0NoaWxkICYmICF2aWV3Q2hpbGQuaXMoJ3VpRWxlbWVudCcpICYmICF2aWV3Q2hpbGQuaXMoJ3Jhd0VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlRWxlbWVudE1hcHBpbmdzKHZpZXdDaGlsZCwgYWN0dWFsRG9tQ2hpbGRyZW5bZGVsZXRlSW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZW1vdmUkMShleHBlY3RlZERvbUNoaWxkcmVuW2luc2VydEluZGV4XSk7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50ZXIuZXF1YWwrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb3VudGVyW2FjdGlvbl0rKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFVwZGF0ZXMgbWFwcGluZ3Mgb2YgYSBnaXZlbiB2aWV3IGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3RWxlbWVudCBUaGUgdmlldyBlbGVtZW50IHdob3NlIG1hcHBpbmdzIHdpbGwgYmUgdXBkYXRlZC5cblx0ICogQHBhcmFtIGRvbUVsZW1lbnQgVGhlIERPTSBlbGVtZW50IHJlcHJlc2VudGluZyB0aGUgZ2l2ZW4gdmlldyBlbGVtZW50LlxuXHQgKi8gX3VwZGF0ZUVsZW1lbnRNYXBwaW5ncyh2aWV3RWxlbWVudCwgZG9tRWxlbWVudCkge1xuICAgICAgICAvLyBSZW1hcCAnRG9tQ29udmVydGVyJyBiaW5kaW5ncy5cbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIudW5iaW5kRG9tRWxlbWVudChkb21FbGVtZW50KTtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuYmluZEVsZW1lbnRzKGRvbUVsZW1lbnQsIHZpZXdFbGVtZW50KTtcbiAgICAgICAgLy8gVmlldyBlbGVtZW50IG1heSBoYXZlIGNoaWxkcmVuIHdoaWNoIG5lZWRzIHRvIGJlIHVwZGF0ZWQsIGJ1dCBhcmUgbm90IG1hcmtlZCwgbWFyayB0aGVtIHRvIHVwZGF0ZS5cbiAgICAgICAgdGhpcy5tYXJrZWRDaGlsZHJlbi5hZGQodmlld0VsZW1lbnQpO1xuICAgICAgICAvLyBCZWNhdXNlIHdlIHJlcGxhY2UgbmV3IHZpZXcgZWxlbWVudCBtYXBwaW5nIHdpdGggdGhlIGV4aXN0aW5nIG9uZSwgdGhlIGNvcnJlc3BvbmRpbmcgRE9NIGVsZW1lbnRcbiAgICAgICAgLy8gd2lsbCBub3QgYmUgcmVyZW5kZXJlZC4gVGhlIG5ldyB2aWV3IGVsZW1lbnQgbWF5IGhhdmUgZGlmZmVyZW50IGF0dHJpYnV0ZXMgdGhhbiB0aGUgcHJldmlvdXMgb25lLlxuICAgICAgICAvLyBTaW5jZSBpdHMgY29ycmVzcG9uZGluZyBET00gZWxlbWVudCB3aWxsIG5vdCBiZSByZXJlbmRlcmVkLCBuZXcgYXR0cmlidXRlcyB3aWxsIG5vdCBiZSBhZGRlZFxuICAgICAgICAvLyB0byB0aGUgRE9NLCBzbyB3ZSBuZWVkIHRvIG1hcmsgaXQgaGVyZSB0byBtYWtlIHN1cmUgaXRzIGF0dHJpYnV0ZXMgZ2V0cyB1cGRhdGVkLiBTZWUgIzE0MjcgZm9yIG1vcmVcbiAgICAgICAgLy8gZGV0YWlsZWQgY2FzZSBzdHVkeS5cbiAgICAgICAgLy8gQWxzbyB0aGVyZSBhcmUgY2FzZXMgd2hlcmUgcmVwbGFjZWQgZWxlbWVudCBpcyByZW1vdmVkIGZyb20gdGhlIHZpZXcgc3RydWN0dXJlIGFuZCB0aGVuIGhhc1xuICAgICAgICAvLyBpdHMgYXR0cmlidXRlcyBjaGFuZ2VkIG9yIHJlbW92ZWQuIEluIHN1Y2ggY2FzZXMgdGhlIGVsZW1lbnQgd2lsbCBub3QgYmUgcHJlc2VudCBpbiBgbWFya2VkQXR0cmlidXRlc2BcbiAgICAgICAgLy8gYW5kIGFsc28gbWF5IGJlIHRoZSBzYW1lIChgZWxlbWVudC5pc1NpbWlsYXIoKWApIGFzIHRoZSByZXVzZWQgZWxlbWVudCBub3QgaGF2aW5nIGl0cyBhdHRyaWJ1dGVzIHVwZGF0ZWQuXG4gICAgICAgIC8vIFRvIHByZXZlbnQgc3VjaCBzaXR1YXRpb25zIHdlIGFsd2F5cyBtYXJrIHJldXNlZCBlbGVtZW50IHRvIGhhdmUgaXRzIGF0dHJpYnV0ZXMgcmVyZW5kZXJkICgjMTU2MCkuXG4gICAgICAgIHRoaXMubWFya2VkQXR0cmlidXRlcy5hZGQodmlld0VsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyB0aGUgcG9zaXRpb24gb2YgdGhlIGlubGluZSBmaWxsZXIgYmFzZWQgb24gdGhlIGN1cnJlbnQgc2VsZWN0aW9uLlxuXHQgKiBIZXJlLCB3ZSBhc3N1bWUgdGhhdCB3ZSBrbm93IHRoYXQgdGhlIGZpbGxlciBpcyBuZWVkZWQgYW5kXG5cdCAqIHtAbGluayAjX2lzU2VsZWN0aW9uSW5JbmxpbmVGaWxsZXIgaXMgYXQgdGhlIHNlbGVjdGlvbiBwb3NpdGlvbn0sIGFuZCwgc2luY2UgaXQgaXMgbmVlZGVkLFxuXHQgKiBpdCBpcyBzb21ld2hlcmUgYXQgdGhlIHNlbGVjdGlvbiBwb3NpdGlvbi5cblx0ICpcblx0ICogTm90ZTogVGhlIGZpbGxlciBwb3NpdGlvbiBjYW5ub3QgYmUgcmVzdG9yZWQgYmFzZWQgb24gdGhlIGZpbGxlcidzIERPTSB0ZXh0IG5vZGUsIGJlY2F1c2Vcblx0ICogd2hlbiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgKGJlZm9yZSByZW5kZXJpbmcpLCB0aGUgYmluZGluZ3Mgd2lsbCBvZnRlbiBiZSBicm9rZW4uIFZpZXctdG8tRE9NXG5cdCAqIGJpbmRpbmdzIGFyZSBvbmx5IGRlcGVuZGFibGUgYWZ0ZXIgcmVuZGVyaW5nLlxuXHQgKi8gX2dldElubGluZUZpbGxlclBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBmaXJzdFBvcyA9IHRoaXMuc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgaWYgKGZpcnN0UG9zLnBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZShmaXJzdFBvcy5wYXJlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZpcnN0UG9zO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc2VsZWN0aW9uIGhhcyBub3QgbGVmdCB0aGUgaW5saW5lIGZpbGxlcidzIHRleHQgbm9kZS5cblx0ICogSWYgaXQgaXMgYHRydWVgLCBpdCBtZWFucyB0aGF0IHRoZSBmaWxsZXIgaGFkIGJlZW4gYWRkZWQgZm9yIGEgcmVhc29uIGFuZCB0aGUgc2VsZWN0aW9uIGRpZCBub3Rcblx0ICogbGVhdmUgdGhlIGZpbGxlcidzIHRleHQgbm9kZS4gRm9yIGV4YW1wbGUsIHRoZSB1c2VyIGNhbiBiZSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcG9zaXRpb24gc28gaXQgc2hvdWxkIG5vdCBiZSB0b3VjaGVkLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGlubGluZSBmaWxsZXIgYW5kIHNlbGVjdGlvbiBhcmUgaW4gdGhlIHNhbWUgcGxhY2UuXG5cdCAqLyBfaXNTZWxlY3Rpb25JbklubGluZUZpbGxlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uLnJhbmdlQ291bnQgIT0gMSB8fCAhdGhpcy5zZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3RlLCB3ZSBjYW4ndCBjaGVjayBpZiBzZWxlY3Rpb24ncyBwb3NpdGlvbiBlcXVhbHMgcG9zaXRpb24gb2YgdGhlXG4gICAgICAgIC8vIHRoaXMuX2lubGluZUZpbGxlciBub2RlLCBiZWNhdXNlIG9mICM2NjMuIFdlIG1heSBub3QgYmUgYWJsZSB0byBjYWxjdWxhdGVcbiAgICAgICAgLy8gdGhlIGZpbGxlcidzIHBvc2l0aW9uIGluIHRoZSB2aWV3IGF0IHRoaXMgc3RhZ2UuXG4gICAgICAgIC8vIEluc3RlYWQsIHdlIGNoZWNrIGl0IHRoZSBvdGhlciB3YXkg4oCTIHdoZXRoZXIgc2VsZWN0aW9uIGlzIGFuY2hvcmVkIGluXG4gICAgICAgIC8vIHRoYXQgdGV4dCBub2RlIG9yIG5leHQgdG8gaXQuXG4gICAgICAgIC8vIFBvc3NpYmxlIG9wdGlvbnMgYXJlOlxuICAgICAgICAvLyBcIkZJTExFUnt9XCJcbiAgICAgICAgLy8gXCJGSUxMRVJhZGRlZC10ZXh0e31cIlxuICAgICAgICBjb25zdCBzZWxlY3Rpb25Qb3NpdGlvbiA9IHRoaXMuc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmRvbUNvbnZlcnRlci52aWV3UG9zaXRpb25Ub0RvbShzZWxlY3Rpb25Qb3NpdGlvbik7XG4gICAgICAgIGlmIChwb3NpdGlvbiAmJiBpc1RleHQocG9zaXRpb24ucGFyZW50KSAmJiBzdGFydHNXaXRoRmlsbGVyKHBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgdGhlIGlubGluZSBmaWxsZXIuXG5cdCAqLyBfcmVtb3ZlSW5saW5lRmlsbGVyKCkge1xuICAgICAgICBjb25zdCBkb21GaWxsZXJOb2RlID0gdGhpcy5faW5saW5lRmlsbGVyO1xuICAgICAgICAvLyBTb21ldGhpbmcgd2VpcmQgaGFwcGVuZWQgYW5kIHRoZSBzdG9yZWQgbm9kZSBkb2Vzbid0IGNvbnRhaW4gdGhlIGZpbGxlcidzIHRleHQuXG4gICAgICAgIGlmICghc3RhcnRzV2l0aEZpbGxlcihkb21GaWxsZXJOb2RlKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgaW5saW5lIGZpbGxlciBub2RlIHdhcyBsb3N0LiBNb3N0IGxpa2VseSwgc29tZXRoaW5nIG92ZXJ3cm90ZSB0aGUgZmlsbGVyIHRleHQgbm9kZVxuXHRcdFx0ICogaW4gdGhlIERPTS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy1yZW5kZXJlci1maWxsZXItd2FzLWxvc3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigndmlldy1yZW5kZXJlci1maWxsZXItd2FzLWxvc3QnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNJbmxpbmVGaWxsZXIoZG9tRmlsbGVyTm9kZSkpIHtcbiAgICAgICAgICAgIGRvbUZpbGxlck5vZGUucmVtb3ZlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb21GaWxsZXJOb2RlLmRhdGEgPSBkb21GaWxsZXJOb2RlLmRhdGEuc3Vic3RyKElOTElORV9GSUxMRVJfTEVOR1RIKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pbmxpbmVGaWxsZXIgPSBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBpbmxpbmUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXIgZmlsbGVyfSBzaG91bGQgYmUgYWRkZWQuXG5cdCAqXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgaW5saW5lIGZpbGxlciBzaG91bGQgYmUgYWRkZWQuXG5cdCAqLyBfbmVlZHNJbmxpbmVGaWxsZXJBdFNlbGVjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uLnJhbmdlQ291bnQgIT0gMSB8fCAhdGhpcy5zZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZWxlY3Rpb25Qb3NpdGlvbiA9IHRoaXMuc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uUGFyZW50ID0gc2VsZWN0aW9uUG9zaXRpb24ucGFyZW50O1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25PZmZzZXQgPSBzZWxlY3Rpb25Qb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIERPTSByb290IHdlIGRvIG5vdCBjYXJlIGFib3V0IGZpbGxlcnMuXG4gICAgICAgIGlmICghdGhpcy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHNlbGVjdGlvblBhcmVudC5yb290KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc2VsZWN0aW9uUGFyZW50LmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQcmV2ZW50IGFkZGluZyBpbmxpbmUgZmlsbGVyIGluc2lkZSBlbGVtZW50cyB3aXRoIGNvbnRlbnRlZGl0YWJsZT1mYWxzZS5cbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzExNzBcbiAgICAgICAgaWYgKCFpc0VkaXRhYmxlKHNlbGVjdGlvblBhcmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gc2VsZWN0aW9uUG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgY29uc3Qgbm9kZUFmdGVyID0gc2VsZWN0aW9uUG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICBpZiAobm9kZUJlZm9yZSBpbnN0YW5jZW9mIFRleHQkMSB8fCBub2RlQWZ0ZXIgaW5zdGFuY2VvZiBUZXh0JDEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBoYXZlIGJsb2NrIGZpbGxlciwgd2UgZG8gbm90IG5lZWQgaW5saW5lIG9uZS5cbiAgICAgICAgaWYgKHNlbGVjdGlvbk9mZnNldCA9PT0gc2VsZWN0aW9uUGFyZW50LmdldEZpbGxlck9mZnNldCgpICYmICghbm9kZUJlZm9yZSB8fCAhbm9kZUJlZm9yZS5pcygnZWxlbWVudCcsICdicicpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvIG5vdCB1c2UgaW5saW5lIGZpbGxlciB3aGlsZSB0eXBpbmcgb3V0c2lkZSBpbmxpbmUgZWxlbWVudHMgb24gQW5kcm9pZC5cbiAgICAgICAgLy8gVGhlIGRlbGV0ZUNvbnRlbnRCYWNrd2FyZCB3b3VsZCByZW1vdmUgcGFydCBvZiB0aGUgaW5saW5lIGZpbGxlciBpbnN0ZWFkIG9mIHJlbW92aW5nIGxhc3QgbGV0dGVyIGluIGEgbGluay5cbiAgICAgICAgaWYgKGVudi5pc0FuZHJvaWQgJiYgKG5vZGVCZWZvcmUgfHwgbm9kZUFmdGVyKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRleHQgbmVlZHMgdG8gYmUgdXBkYXRlZCBhbmQgcG9zc2libHkgdXBkYXRlcyBpdC5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdUZXh0IFZpZXcgdGV4dCB0byB1cGRhdGUuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmlubGluZUZpbGxlclBvc2l0aW9uIFRoZSBwb3NpdGlvbiB3aGVyZSB0aGUgaW5saW5lIGZpbGxlciBzaG91bGQgYmUgcmVuZGVyZWQuXG5cdCAqLyBfdXBkYXRlVGV4dCh2aWV3VGV4dCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCBkb21UZXh0ID0gdGhpcy5kb21Db252ZXJ0ZXIuZmluZENvcnJlc3BvbmRpbmdEb21UZXh0KHZpZXdUZXh0KTtcbiAgICAgICAgY29uc3QgbmV3RG9tVGV4dCA9IHRoaXMuZG9tQ29udmVydGVyLnZpZXdUb0RvbSh2aWV3VGV4dCk7XG4gICAgICAgIGxldCBleHBlY3RlZFRleHQgPSBuZXdEb21UZXh0LmRhdGE7XG4gICAgICAgIGNvbnN0IGZpbGxlciA9IG9wdGlvbnMuaW5saW5lRmlsbGVyUG9zaXRpb247XG4gICAgICAgIGlmIChmaWxsZXIgJiYgZmlsbGVyLnBhcmVudCA9PSB2aWV3VGV4dC5wYXJlbnQgJiYgZmlsbGVyLm9mZnNldCA9PSB2aWV3VGV4dC5pbmRleCkge1xuICAgICAgICAgICAgZXhwZWN0ZWRUZXh0ID0gSU5MSU5FX0ZJTExFUiArIGV4cGVjdGVkVGV4dDtcbiAgICAgICAgfVxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cCggJyVjW1JlbmRlcmVyXSVjIFVwZGF0ZSB0ZXh0JyxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC13ZWlnaHQ6IG5vcm1hbCdcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdCk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICB0aGlzLl91cGRhdGVUZXh0Tm9kZShkb21UZXh0LCBleHBlY3RlZFRleHQpO1xuICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBhdHRyaWJ1dGUgbGlzdCBuZWVkcyB0byBiZSB1cGRhdGVkIGFuZCBwb3NzaWJseSB1cGRhdGVzIGl0LlxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnQgVGhlIHZpZXcgZWxlbWVudCB0byB1cGRhdGUuXG5cdCAqLyBfdXBkYXRlQXR0cnModmlld0VsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgZG9tRWxlbWVudCA9IHRoaXMuZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbSh2aWV3RWxlbWVudCk7XG4gICAgICAgIGlmICghZG9tRWxlbWVudCkge1xuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gYGRvbUVsZW1lbnRgIGl0IG1lYW5zIHRoYXQgJ3ZpZXdFbGVtZW50JyBpcyBvdXRkYXRlZCBhcyBpdHMgbWFwcGluZyB3YXMgdXBkYXRlZFxuICAgICAgICAgICAgLy8gaW4gJ3RoaXMuX3VwZGF0ZUNoaWxkcmVuTWFwcGluZ3MoKScuIFRoZXJlIGlzIG5vIG5lZWQgdG8gcHJvY2VzcyBpdCBhcyBuZXcgdmlldyBlbGVtZW50IHdoaWNoXG4gICAgICAgICAgICAvLyByZXBsYWNlZCBvbGQgJ3ZpZXdFbGVtZW50JyBtYXBwaW5nIHdhcyBhbHNvIGFkZGVkIHRvICd0aGlzLm1hcmtlZEF0dHJpYnV0ZXMnXG4gICAgICAgICAgICAvLyBpbiAndGhpcy5fdXBkYXRlQ2hpbGRyZW5NYXBwaW5ncygpJyBzbyBpdCB3aWxsIGJlIHByb2Nlc3NlZCBzZXBhcmF0ZWx5LlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBhdHRyaWJ1dGVzIGZyb20gRE9NIGVsZW1lbnRzIGlmIHRoZXkgZG8gbm90IGV4aXN0IGluIHRoZSB2aWV3LlxuICAgICAgICAvL1xuICAgICAgICAvLyBOb3RlOiBJdCBpcyBpbXBvcnRhbnQgdG8gZmlyc3QgcmVtb3ZlIERPTSBhdHRyaWJ1dGVzIGFuZCB0aGVuIHNldCBuZXcgb25lcywgYmVjYXVzZSBzb21lIHZpZXcgYXR0cmlidXRlcyBtYXkgYmUgcmVuYW1lZFxuICAgICAgICAvLyBhcyB0aGV5IGFyZSBzZXQgb24gRE9NIChkdWUgdG8gdW5zYWZlIGF0dHJpYnV0ZXMgaGFuZGxpbmcpLiBJZiB3ZSBzZXQgdGhlIHZpZXcgYXR0cmlidXRlIGZpcnN0LCBhbmQgdGhlbiByZW1vdmVcbiAgICAgICAgLy8gbm9uLWV4aXN0aW5nIERPTSBhdHRyaWJ1dGVzLCB0aGVuIHdlIHdvdWxkIHJlbW92ZSB0aGUgYXR0cmlidXRlIHRoYXQgd2UganVzdCBzZXQuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIE5vdGU6IFRoZSBkb21FbGVtZW50LmF0dHJpYnV0ZXMgaXMgYSBsaXZlIGNvbGxlY3Rpb24sIHNvIHdlIG5lZWQgdG8gY29udmVydCBpdCB0byBhbiBhcnJheSB0byBhdm9pZCBpc3N1ZXMuXG4gICAgICAgIGZvciAoY29uc3QgZG9tQXR0ciBvZiBBcnJheS5mcm9tKGRvbUVsZW1lbnQuYXR0cmlidXRlcykpe1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gZG9tQXR0ci5uYW1lO1xuICAgICAgICAgICAgLy8gQWxsIG90aGVyIGF0dHJpYnV0ZXMgbm90IHByZXNlbnQgaW4gdGhlIERPTSBzaG91bGQgYmUgcmVtb3ZlZC5cbiAgICAgICAgICAgIGlmICghdmlld0VsZW1lbnQuaGFzQXR0cmlidXRlKGtleSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRvbUNvbnZlcnRlci5yZW1vdmVEb21FbGVtZW50QXR0cmlidXRlKGRvbUVsZW1lbnQsIGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWRkIG9yIG92ZXJ3cml0ZSBhdHRyaWJ1dGVzLlxuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiB2aWV3RWxlbWVudC5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuc2V0RG9tRWxlbWVudEF0dHJpYnV0ZShkb21FbGVtZW50LCBrZXksIHZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZShrZXkpLCB2aWV3RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBlbGVtZW50cyBjaGlsZCBsaXN0IG5lZWRzIHRvIGJlIHVwZGF0ZWQgYW5kIHBvc3NpYmx5IHVwZGF0ZXMgaXQuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBvbiBBbmRyb2lkLCB0byByZWR1Y2UgdGhlIHJpc2sgb2YgY29tcG9zaXRpb24gYnJlYWtzLCBpdCB0cmllcyB0byB1cGRhdGUgZGF0YSBvZiBhbiBleGlzdGluZ1xuXHQgKiBjaGlsZCB0ZXh0IG5vZGVzIGluc3RlYWQgb2YgcmVwbGFjaW5nIHRoZW0gY29tcGxldGVseS5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdFbGVtZW50IFZpZXcgZWxlbWVudCB0byB1cGRhdGUuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmlubGluZUZpbGxlclBvc2l0aW9uIFRoZSBwb3NpdGlvbiB3aGVyZSB0aGUgaW5saW5lIGZpbGxlciBzaG91bGQgYmUgcmVuZGVyZWQuXG5cdCAqLyBfdXBkYXRlQ2hpbGRyZW4odmlld0VsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgZG9tRWxlbWVudCA9IHRoaXMuZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbSh2aWV3RWxlbWVudCk7XG4gICAgICAgIGlmICghZG9tRWxlbWVudCkge1xuICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gYGRvbUVsZW1lbnRgIGl0IG1lYW5zIHRoYXQgaXQgd2FzIGFscmVhZHkgcmVtb3ZlZCBmcm9tIERPTS5cbiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gcHJvY2VzcyBpdC4gSXQgd2lsbCBiZSBwcm9jZXNzZWQgd2hlbiByZS1pbnNlcnRlZC5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cCggJyVjW1JlbmRlcmVyXSVjIFVwZGF0ZSBjaGlsZHJlbicsXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCdjb2xvcjogZ3JlZW47IGZvbnQtd2VpZ2h0OiBib2xkJywgJ2ZvbnQtd2VpZ2h0OiBub3JtYWwnXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgLy8gSU1FIG9uIEFuZHJvaWQgaW5zZXJ0cyBhIG5ldyB0ZXh0IG5vZGUgd2hpbGUgdHlwaW5nIGFmdGVyIGEgbGlua1xuICAgICAgICAvLyBpbnN0ZWFkIG9mIHVwZGF0aW5nIGFuIGV4aXN0aW5nIHRleHQgbm9kZSB0aGF0IGZvbGxvd3MgdGhlIGxpbmsuXG4gICAgICAgIC8vIFdlIG11c3Qgbm9ybWFsaXplIHRob3NlIHRleHQgbm9kZXMgc28gdGhlIGRpZmYgd29uJ3QgZ2V0IGNvbmZ1c2VkLlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMjU3NC5cbiAgICAgICAgaWYgKGVudi5pc0FuZHJvaWQpIHtcbiAgICAgICAgICAgIGxldCBwcmV2aW91c0RvbU5vZGUgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChjb25zdCBkb21Ob2RlIG9mIEFycmF5LmZyb20oZG9tRWxlbWVudC5jaGlsZE5vZGVzKSl7XG4gICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzRG9tTm9kZSAmJiBpc1RleHQocHJldmlvdXNEb21Ob2RlKSAmJiBpc1RleHQoZG9tTm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9tRWxlbWVudC5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByZXZpb3VzRG9tTm9kZSA9IGRvbU5vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5saW5lRmlsbGVyUG9zaXRpb24gPSBvcHRpb25zLmlubGluZUZpbGxlclBvc2l0aW9uO1xuICAgICAgICBjb25zdCBhY3R1YWxEb21DaGlsZHJlbiA9IGRvbUVsZW1lbnQuY2hpbGROb2RlcztcbiAgICAgICAgY29uc3QgZXhwZWN0ZWREb21DaGlsZHJlbiA9IEFycmF5LmZyb20odGhpcy5kb21Db252ZXJ0ZXIudmlld0NoaWxkcmVuVG9Eb20odmlld0VsZW1lbnQsIHtcbiAgICAgICAgICAgIGJpbmQ6IHRydWVcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBJbmxpbmUgZmlsbGVyIGVsZW1lbnQgaGFzIHRvIGJlIGNyZWF0ZWQgYXMgaXQgaXMgcHJlc2VudCBpbiB0aGUgRE9NLCBidXQgbm90IGluIHRoZSB2aWV3LiBJdCBpcyByZXF1aXJlZFxuICAgICAgICAvLyBkdXJpbmcgZGlmZmluZyBzbyB0ZXh0IG5vZGVzIGNvdWxkIGJlIGNvbXBhcmVkIGNvcnJlY3RseSBhbmQgYWxzbyBkdXJpbmcgcmVuZGVyaW5nIHRvIG1haW50YWluXG4gICAgICAgIC8vIHByb3BlciBvcmRlciBhbmQgaW5kZXhlcyB3aGlsZSB1cGRhdGluZyB0aGUgRE9NLlxuICAgICAgICBpZiAoaW5saW5lRmlsbGVyUG9zaXRpb24gJiYgaW5saW5lRmlsbGVyUG9zaXRpb24ucGFyZW50ID09PSB2aWV3RWxlbWVudCkge1xuICAgICAgICAgICAgYWRkSW5saW5lRmlsbGVyKGRvbUVsZW1lbnQub3duZXJEb2N1bWVudCwgZXhwZWN0ZWREb21DaGlsZHJlbiwgaW5saW5lRmlsbGVyUG9zaXRpb24ub2Zmc2V0KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkaWZmID0gdGhpcy5fZGlmZk5vZGVMaXN0cyhhY3R1YWxEb21DaGlsZHJlbiwgZXhwZWN0ZWREb21DaGlsZHJlbik7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgd2UgdXBkYXRlIHRoZSBleGlzdGluZyB0ZXh0IG5vZGUgYW5kIG5vdCByZXBsYWNlIGl0IHdpdGggYW5vdGhlciBvbmUuXG4gICAgICAgIC8vIFRoZSBjb21wb3NpdGlvbiBhbmQgZGlmZmVyZW50IFwibGFuZ3VhZ2VcIiBicm93c2VyIGV4dGVuc2lvbnMgYXJlIGZyYWdpbGUgdG8gdGV4dCBub2RlIGJlaW5nIGNvbXBsZXRlbHkgcmVwbGFjZWQuXG4gICAgICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLl9maW5kVXBkYXRlQWN0aW9ucyhkaWZmLCBhY3R1YWxEb21DaGlsZHJlbiwgZXhwZWN0ZWREb21DaGlsZHJlbiwgYXJlVGV4dE5vZGVzKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyAmJiBhY3Rpb25zLmV2ZXJ5KCBhID0+IGEgPT0gJ2VxdWFsJyApICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5pbmZvKCAnJWNbUmVuZGVyZXJdJWMgTm90aGluZyB0byB1cGRhdGUuJyxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC1zdHlsZTogaXRhbGljJ1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgY29uc3Qgbm9kZXNUb1VuYmluZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgLy8gSGFuZGxlIGRlbGV0aW9ucyBmaXJzdC5cbiAgICAgICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IGEgc2l0dWF0aW9uIHdoZXJlIGFuIGVsZW1lbnQgdGhhdCBhbHJlYWR5IGV4aXN0cyBpbiBgYWN0dWFsRG9tQ2hpbGRyZW5gIGlzIGluc2VydGVkIGF0IGEgZGlmZmVyZW50XG4gICAgICAgIC8vIGluZGV4IGluIGBhY3R1YWxEb21DaGlsZHJlbmAuIFNpbmNlIGBhY3R1YWxEb21DaGlsZHJlbmAgaXMgYSBgTm9kZUxpc3RgLCB0aGlzIHdvcmtzIGxpa2UgbW92ZSwgbm90IGxpa2UgYW4gaW5zZXJ0LFxuICAgICAgICAvLyBhbmQgaXQgZGlzcnVwdHMgdGhlIHdob2xlIGFsZ29yaXRobS4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzYzNjcuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEl0IGRvZXNuJ3QgbWF0dGVyIGluIHdoYXQgb3JkZXIgd2UgcmVtb3ZlIG9yIGFkZCBub2RlcywgYXMgbG9uZyBhcyB3ZSByZW1vdmUgYW5kIGFkZCBjb3JyZWN0IG5vZGVzIGF0IGNvcnJlY3QgaW5kZXhlcy5cbiAgICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucyl7XG4gICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnZGVsZXRlJykge1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0Y29uc3Qgbm9kZSA9IGFjdHVhbERvbUNoaWxkcmVuWyBpIF07XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGlmICggaXNUZXh0KCBub2RlICkgKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0Y29uc29sZS5pbmZvKCAnJWNbUmVuZGVyZXJdJWMgUmVtb3ZlIHRleHQgbm9kZScgK1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdFx0YCR7IHRoaXMuaXNDb21wb3NpbmcgPyAnIHdoaWxlIGNvbXBvc2luZyAobWF5IGJyZWFrIGNvbXBvc2l0aW9uKScgOiAnJyB9OiBgICtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHRcdGAlYyR7IF9lc2NhcGVUZXh0Tm9kZURhdGEoIG5vZGUuZGF0YSApIH0lYyAoJHsgbm9kZS5kYXRhLmxlbmd0aCB9KWAsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0XHR0aGlzLmlzQ29tcG9zaW5nID8gJ2NvbG9yOiByZWQ7IGZvbnQtd2VpZ2h0OiBib2xkJyA6ICcnLCAnY29sb3I6IGJsdWUnLCAnJ1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCk7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0Y29uc29sZS5pbmZvKCAnJWNbUmVuZGVyZXJdJWMgUmVtb3ZlIGVsZW1lbnQnICtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHRcdGAkeyB0aGlzLmlzQ29tcG9zaW5nID8gJyB3aGlsZSBjb21wb3NpbmcgKG1heSBicmVhayBjb21wb3NpdGlvbiknIDogJycgfTogYCxcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHRcdCdjb2xvcjogZ3JlZW47IGZvbnQtd2VpZ2h0OiBib2xkJyxcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHRcdHRoaXMuaXNDb21wb3NpbmcgPyAnY29sb3I6IHJlZDsgZm9udC13ZWlnaHQ6IGJvbGQnIDogJycsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0XHRub2RlXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0KTtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0fVxuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICAgICAgICAgIG5vZGVzVG9VbmJpbmQuYWRkKGFjdHVhbERvbUNoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgICAgICByZW1vdmUkMShhY3R1YWxEb21DaGlsZHJlbltpXSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2VxdWFsJyB8fCBhY3Rpb24gPT09ICd1cGRhdGUnKSB7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGkgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKXtcbiAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vXHRjb25zdCBub2RlID0gZXhwZWN0ZWREb21DaGlsZHJlblsgaSBdO1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy9cdGlmICggaXNUZXh0KCBub2RlICkgKSB7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHRjb25zb2xlLmluZm8oICclY1tSZW5kZXJlcl0lYyBJbnNlcnQgdGV4dCBub2RlJyArXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHRcdGAkeyB0aGlzLmlzQ29tcG9zaW5nID8gJyB3aGlsZSBjb21wb3NpbmcgKG1heSBicmVhayBjb21wb3NpdGlvbiknIDogJycgfTogYCArXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHRcdGAlYyR7IF9lc2NhcGVUZXh0Tm9kZURhdGEoIG5vZGUuZGF0YSApIH0lYyAoJHsgbm9kZS5kYXRhLmxlbmd0aCB9KWAsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHRcdCdjb2xvcjogZ3JlZW47IGZvbnQtd2VpZ2h0OiBib2xkJyxcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vXHRcdFx0dGhpcy5pc0NvbXBvc2luZyA/ICdjb2xvcjogcmVkOyBmb250LXdlaWdodDogYm9sZCcgOiAnJyxcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vXHRcdFx0J2NvbG9yOiBibHVlJywgJydcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vXHRcdCk7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0fSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vXHRcdGNvbnNvbGUuaW5mbyggJyVjW1JlbmRlcmVyXSVjIEluc2VydCBlbGVtZW50OicsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHRcdCdjb2xvcjogZ3JlZW47IGZvbnQtd2VpZ2h0OiBib2xkJywgJ2ZvbnQtd2VpZ2h0OiBub3JtYWwnLFxuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy9cdFx0XHRub2RlXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvL1x0XHQpO1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy9cdH1cbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgICAgICAgICBpbnNlcnRBdChkb21FbGVtZW50LCBpLCBleHBlY3RlZERvbUNoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ3VwZGF0ZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVUZXh0Tm9kZShhY3R1YWxEb21DaGlsZHJlbltpXSwgZXhwZWN0ZWREb21DaGlsZHJlbltpXS5kYXRhKTtcbiAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2VxdWFsJykge1xuICAgICAgICAgICAgICAgIC8vIEZvcmNlIHVwZGF0aW5nIHRleHQgbm9kZXMgaW5zaWRlIGVsZW1lbnRzIHdoaWNoIGRpZCBub3QgY2hhbmdlIGFuZCBkbyBub3QgbmVlZCB0byBiZSByZS1yZW5kZXJlZCAoIzExMjUpLlxuICAgICAgICAgICAgICAgIC8vIERvIGl0IGhlcmUgKG5vdCBpbiB0aGUgbG9vcCBhYm92ZSkgYmVjYXVzZSBvbmx5IGFmdGVyIGluc2VydGlvbnMgdGhlIGBpYCBpbmRleCBpcyBjb3JyZWN0LlxuICAgICAgICAgICAgICAgIHRoaXMuX21hcmtEZXNjZW5kYW50VGV4dFRvU3luYyh0aGlzLmRvbUNvbnZlcnRlci5kb21Ub1ZpZXcoZXhwZWN0ZWREb21DaGlsZHJlbltpXSkpO1xuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBVbmJpbmQgcmVtb3ZlZCBub2Rlcy4gV2hlbiBub2RlIGRvZXMgbm90IGhhdmUgYSBwYXJlbnQgaXQgbWVhbnMgdGhhdCBpdCB3YXMgcmVtb3ZlZCBmcm9tIERPTSB0cmVlIGR1cmluZ1xuICAgICAgICAvLyBjb21wYXJpc29uIHdpdGggdGhlIGV4cGVjdGVkIERPTS4gV2UgZG9uJ3QgbmVlZCB0byBjaGVjayBjaGlsZCBub2RlcywgYmVjYXVzZSBpZiBjaGlsZCBub2RlIHdhcyByZWluc2VydGVkLFxuICAgICAgICAvLyBpdCB3YXMgbW92ZWQgdG8gRE9NIHRyZWUgb3V0IG9mIHRoZSByZW1vdmVkIG5vZGUuXG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlc1RvVW5iaW5kKXtcbiAgICAgICAgICAgIGlmICghbm9kZS5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIudW5iaW5kRG9tRWxlbWVudChub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0aGFuZCBmb3IgZGlmZmluZyB0d28gYXJyYXlzIG9yIG5vZGUgbGlzdHMgb2YgRE9NIG5vZGVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gYWN0dWFsRG9tQ2hpbGRyZW4gQWN0dWFsIERPTSBjaGlsZHJlblxuXHQgKiBAcGFyYW0gZXhwZWN0ZWREb21DaGlsZHJlbiBFeHBlY3RlZCBET00gY2hpbGRyZW4uXG5cdCAqIEByZXR1cm5zIFRoZSBsaXN0IG9mIGFjdGlvbnMgYmFzZWQgb24gdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvZGlmZn5kaWZmfSBmdW5jdGlvbi5cblx0ICovIF9kaWZmTm9kZUxpc3RzKGFjdHVhbERvbUNoaWxkcmVuLCBleHBlY3RlZERvbUNoaWxkcmVuKSB7XG4gICAgICAgIGFjdHVhbERvbUNoaWxkcmVuID0gZmlsdGVyT3V0RmFrZVNlbGVjdGlvbkNvbnRhaW5lcihhY3R1YWxEb21DaGlsZHJlbiwgdGhpcy5fZmFrZVNlbGVjdGlvbkNvbnRhaW5lcik7XG4gICAgICAgIHJldHVybiBkaWZmKGFjdHVhbERvbUNoaWxkcmVuLCBleHBlY3RlZERvbUNoaWxkcmVuLCBzYW1lTm9kZXMkMS5iaW5kKG51bGwsIHRoaXMuZG9tQ29udmVydGVyKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaW5kcyBET00gbm9kZXMgdGhhdCB3ZXJlIHJlcGxhY2VkIHdpdGggdGhlIHNpbWlsYXIgbm9kZXMgKHNhbWUgdGFnIG5hbWUpIGluIHRoZSB2aWV3LiBBbGwgbm9kZXMgYXJlIGNvbXBhcmVkXG5cdCAqIHdpdGhpbiBvbmUgYGluc2VydGAvYGRlbGV0ZWAgYWN0aW9uIGdyb3VwLCBmb3IgZXhhbXBsZTpcblx0ICpcblx0ICogYGBgXG5cdCAqIEFjdHVhbCBET006XHRcdDxwPjxiPkZvbzwvYj5CYXI8aT5CYXo8L2k+PGI+QmF4PC9iPjwvcD5cblx0ICogRXhwZWN0ZWQgRE9NOlx0PHA+QmFyPGI+MTIzPC9iPjxpPkJhejwvaT48Yj40NTY8L2I+PC9wPlxuXHQgKiBJbnB1dCBhY3Rpb25zOlx0WyBpbnNlcnQsIGluc2VydCwgZGVsZXRlLCBkZWxldGUsIGVxdWFsLCBpbnNlcnQsIGRlbGV0ZSBdXG5cdCAqIE91dHB1dCBhY3Rpb25zOlx0WyBpbnNlcnQsIHJlcGxhY2UsIGRlbGV0ZSwgZXF1YWwsIHJlcGxhY2UgXVxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGFjdGlvbnMgQWN0aW9ucyBhcnJheSB3aGljaCBpcyBhIHJlc3VsdCBvZiB0aGUge0BsaW5rIG1vZHVsZTp1dGlscy9kaWZmfmRpZmZ9IGZ1bmN0aW9uLlxuXHQgKiBAcGFyYW0gYWN0dWFsRG9tIEFjdHVhbCBET00gY2hpbGRyZW5cblx0ICogQHBhcmFtIGV4cGVjdGVkRG9tIEV4cGVjdGVkIERPTSBjaGlsZHJlbi5cblx0ICogQHBhcmFtIGNvbXBhcmF0b3IgQSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRoYXQgc2hvdWxkIHJldHVybiBgdHJ1ZWAgaWYgdGhlIGdpdmVuIG5vZGUgc2hvdWxkIGJlIHJldXNlZFxuXHQgKiAoZWl0aGVyIGJ5IHRoZSB1cGRhdGUgb2YgYSB0ZXh0IG5vZGUgZGF0YSBvciBhbiBlbGVtZW50IGNoaWxkcmVuIGxpc3QgZm9yIHNpbWlsYXIgZWxlbWVudHMpLlxuXHQgKiBAcmV0dXJucyBBY3Rpb25zIGFycmF5IG1vZGlmaWVkIHdpdGggdGhlIGB1cGRhdGVgIGFjdGlvbnMuXG5cdCAqLyBfZmluZFVwZGF0ZUFjdGlvbnMoYWN0aW9ucywgYWN0dWFsRG9tLCBleHBlY3RlZERvbSwgY29tcGFyYXRvcikge1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBib3RoICdpbnNlcnQnIGFuZCAnZGVsZXRlJyBhY3Rpb25zLCBubyBuZWVkIHRvIGNoZWNrIGZvciByZXBsYWNlZCBlbGVtZW50cy5cbiAgICAgICAgaWYgKGFjdGlvbnMuaW5kZXhPZignaW5zZXJ0JykgPT09IC0xIHx8IGFjdGlvbnMuaW5kZXhPZignZGVsZXRlJykgPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBsZXQgbmV3QWN0aW9ucyA9IFtdO1xuICAgICAgICBsZXQgYWN0dWFsU2xpY2UgPSBbXTtcbiAgICAgICAgbGV0IGV4cGVjdGVkU2xpY2UgPSBbXTtcbiAgICAgICAgY29uc3QgY291bnRlciA9IHtcbiAgICAgICAgICAgIGVxdWFsOiAwLFxuICAgICAgICAgICAgaW5zZXJ0OiAwLFxuICAgICAgICAgICAgZGVsZXRlOiAwXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpe1xuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAgICAgICBleHBlY3RlZFNsaWNlLnB1c2goZXhwZWN0ZWREb21bY291bnRlci5lcXVhbCArIGNvdW50ZXIuaW5zZXJ0XSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICAgICAgICBhY3R1YWxTbGljZS5wdXNoKGFjdHVhbERvbVtjb3VudGVyLmVxdWFsICsgY291bnRlci5kZWxldGVdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3QWN0aW9ucyA9IG5ld0FjdGlvbnMuY29uY2F0KGRpZmYoYWN0dWFsU2xpY2UsIGV4cGVjdGVkU2xpY2UsIGNvbXBhcmF0b3IpLm1hcCgoYWN0aW9uKT0+YWN0aW9uID09PSAnZXF1YWwnID8gJ3VwZGF0ZScgOiBhY3Rpb24pKTtcbiAgICAgICAgICAgICAgICBuZXdBY3Rpb25zLnB1c2goJ2VxdWFsJyk7XG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgc3RvcmVkIGVsZW1lbnRzIG9uICdlcXVhbCcuXG4gICAgICAgICAgICAgICAgYWN0dWFsU2xpY2UgPSBbXTtcbiAgICAgICAgICAgICAgICBleHBlY3RlZFNsaWNlID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb3VudGVyW2FjdGlvbl0rKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3QWN0aW9ucy5jb25jYXQoZGlmZihhY3R1YWxTbGljZSwgZXhwZWN0ZWRTbGljZSwgY29tcGFyYXRvcikubWFwKChhY3Rpb24pPT5hY3Rpb24gPT09ICdlcXVhbCcgPyAndXBkYXRlJyA6IGFjdGlvbikpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRleHQgbmVlZHMgdG8gYmUgdXBkYXRlZCBhbmQgcG9zc2libHkgdXBkYXRlcyBpdCBieSByZW1vdmluZyBhbmQgaW5zZXJ0aW5nIG9ubHkgcGFydHNcblx0ICogb2YgdGhlIGRhdGEgZnJvbSB0aGUgZXhpc3RpbmcgdGV4dCBub2RlIHRvIHJlZHVjZSBpbXBhY3Qgb24gdGhlIElNRSBjb21wb3NpdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIGRvbVRleHQgRE9NIHRleHQgbm9kZSB0byB1cGRhdGUuXG5cdCAqIEBwYXJhbSBleHBlY3RlZFRleHQgVGhlIGV4cGVjdGVkIGRhdGEgb2YgYSB0ZXh0IG5vZGUuXG5cdCAqLyBfdXBkYXRlVGV4dE5vZGUoZG9tVGV4dCwgZXhwZWN0ZWRUZXh0KSB7XG4gICAgICAgIGNvbnN0IGFjdHVhbFRleHQgPSBkb21UZXh0LmRhdGE7XG4gICAgICAgIGlmIChhY3R1YWxUZXh0ID09IGV4cGVjdGVkVGV4dCkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tSZW5kZXJlcl0lYyBUZXh0IG5vZGUgZG9lcyBub3QgbmVlZCB1cGRhdGU6JWMgJyArXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHRgJHsgX2VzY2FwZVRleHROb2RlRGF0YSggYWN0dWFsVGV4dCApIH0lYyAoJHsgYWN0dWFsVGV4dC5sZW5ndGggfSlgLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC1zdHlsZTogaXRhbGljJywgJ2NvbG9yOiBibHVlJywgJydcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3VyIGFwcHJvYWNoIHRvIGludGVybGVhdmluZyBzcGFjZSBjaGFyYWN0ZXIgd2l0aCBOQlNQIG1pZ2h0IGRpZmZlciB3aXRoIHRoZSBvbmUgaW1wbGVtZW50ZWQgYnkgdGhlIGJyb3dzZXIuXG4gICAgICAgIC8vIEF2b2lkIG1vZGlmeWluZyB0aGUgdGV4dCBub2RlIGluIHRoZSBET00gaWYgb25seSBOQlNQcyBhbmQgc3BhY2VzIGFyZSBpbnRlcmNoYW5nZWQuXG4gICAgICAgIC8vIFdlIHNob3VsZCBhdm9pZCBET00gbW9kaWZpY2F0aW9ucyB3aGlsZSBjb21wb3NpbmcgdG8gYXZvaWQgYnJlYWthZ2Ugb2YgY29tcG9zaXRpb24uXG4gICAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTM5OTQuXG4gICAgICAgIGlmIChlbnYuaXNBbmRyb2lkICYmIHRoaXMuaXNDb21wb3NpbmcgJiYgYWN0dWFsVGV4dC5yZXBsYWNlKC9cXHUwMEEwL2csICcgJykgPT0gZXhwZWN0ZWRUZXh0LnJlcGxhY2UoL1xcdTAwQTAvZywgJyAnKSkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tSZW5kZXJlcl0lYyBUZXh0IG5vZGUgaWdub3JlIE5CU1AgY2hhbmdlcyB3aGlsZSBjb21wb3Npbmc6ICcgK1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0YCVjJHsgX2VzY2FwZVRleHROb2RlRGF0YSggYWN0dWFsVGV4dCApIH0lYyAoJHsgYWN0dWFsVGV4dC5sZW5ndGggfSkgLT5gICtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdGAgJWMkeyBfZXNjYXBlVGV4dE5vZGVEYXRhKCBleHBlY3RlZFRleHQgKSB9JWMgKCR7IGV4cGVjdGVkVGV4dC5sZW5ndGggfSlgLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC1zdHlsZTogaXRhbGljJywgJ2NvbG9yOiBibHVlJywgJycsICdjb2xvcjogYmx1ZScsICcnXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tSZW5kZXJlcl0lYyBVcGRhdGUgdGV4dCBub2RlJyArXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdGAkeyB0aGlzLmlzQ29tcG9zaW5nID8gJyB3aGlsZSBjb21wb3NpbmcgKG1heSBicmVhayBjb21wb3NpdGlvbiknIDogJycgfTogYCArXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdGAlYyR7IF9lc2NhcGVUZXh0Tm9kZURhdGEoIGFjdHVhbFRleHQgKSB9JWMgKCR7IGFjdHVhbFRleHQubGVuZ3RoIH0pIC0+YCArXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdGAgJWMkeyBfZXNjYXBlVGV4dE5vZGVEYXRhKCBleHBlY3RlZFRleHQgKSB9JWMgKCR7IGV4cGVjdGVkVGV4dC5sZW5ndGggfSlgLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsIHRoaXMuaXNDb21wb3NpbmcgPyAnY29sb3I6IHJlZDsgZm9udC13ZWlnaHQ6IGJvbGQnIDogJycsXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCdjb2xvcjogYmx1ZScsICcnLCAnY29sb3I6IGJsdWUnLCAnJ1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZVRleHROb2RlSW50ZXJuYWwoZG9tVGV4dCwgZXhwZWN0ZWRUZXh0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBhcnQgb2YgdGhlIGBfdXBkYXRlVGV4dE5vZGVgIG1ldGhvZCBleHRyYWN0ZWQgZm9yIGVhc2llciB0ZXN0aW5nLlxuXHQgKi8gX3VwZGF0ZVRleHROb2RlSW50ZXJuYWwoZG9tVGV4dCwgZXhwZWN0ZWRUZXh0KSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbnMgPSBmYXN0RGlmZihkb21UZXh0LmRhdGEsIGV4cGVjdGVkVGV4dCk7XG4gICAgICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpe1xuICAgICAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgICAgIGRvbVRleHQuaW5zZXJ0RGF0YShhY3Rpb24uaW5kZXgsIGFjdGlvbi52YWx1ZXMuam9pbignJykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkb21UZXh0LmRlbGV0ZURhdGEoYWN0aW9uLmluZGV4LCBhY3Rpb24uaG93TWFueSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIE1hcmtzIHRleHQgbm9kZXMgdG8gYmUgc3luY2hyb25pemVkLlxuXHQgKlxuXHQgKiBJZiBhIHRleHQgbm9kZSBpcyBwYXNzZWQsIGl0IHdpbGwgYmUgbWFya2VkLiBJZiBhbiBlbGVtZW50IGlzIHBhc3NlZCwgYWxsIGRlc2NlbmRhbnQgdGV4dCBub2RlcyBpbnNpZGUgaXQgd2lsbCBiZSBtYXJrZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3Tm9kZSBWaWV3IG5vZGUgdG8gc3luYy5cblx0ICovIF9tYXJrRGVzY2VuZGFudFRleHRUb1N5bmModmlld05vZGUpIHtcbiAgICAgICAgaWYgKCF2aWV3Tm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aWV3Tm9kZS5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgdGhpcy5tYXJrZWRUZXh0cy5hZGQodmlld05vZGUpO1xuICAgICAgICB9IGVsc2UgaWYgKHZpZXdOb2RlLmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygdmlld05vZGUuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFya0Rlc2NlbmRhbnRUZXh0VG9TeW5jKGNoaWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBzZWxlY3Rpb24gbmVlZHMgdG8gYmUgdXBkYXRlZCBhbmQgcG9zc2libHkgdXBkYXRlcyBpdC5cblx0ICovIF91cGRhdGVTZWxlY3Rpb24oKSB7XG4gICAgICAgIC8vIEJsb2NrIHVwZGF0aW5nIERPTSBzZWxlY3Rpb24gaW4gKG5vbi1BbmRyb2lkKSBCbGluayB3aGlsZSB0aGUgdXNlciBpcyBzZWxlY3RpbmcgdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbGVjdGlvbiBjb2xsYXBzaW5nLlxuICAgICAgICAvLyBOb3RlOiBTdHJ1Y3R1cmFsIGNoYW5nZXMgaW4gRE9NIG11c3QgdHJpZ2dlciBzZWxlY3Rpb24gcmVuZGVyaW5nLCB0aG91Z2guIE5vZGVzIHRoZSBzZWxlY3Rpb24gd2FzIGFuY2hvcmVkXG4gICAgICAgIC8vIHRvLCBtYXkgZGlzYXBwZWFyIGluIERPTSB3aGljaCB3b3VsZCBicmVhayB0aGUgc2VsZWN0aW9uIChlLmcuIGluIHJlYWwtdGltZSBjb2xsYWJvcmF0aW9uIHNjZW5hcmlvcykuXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEwNTYyLCBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMDcyM1xuICAgICAgICBpZiAoZW52LmlzQmxpbmsgJiYgIWVudi5pc0FuZHJvaWQgJiYgdGhpcy5pc1NlbGVjdGluZyAmJiAhdGhpcy5tYXJrZWRDaGlsZHJlbi5zaXplKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gc2VsZWN0aW9uIC0gcmVtb3ZlIERPTSBhbmQgZmFrZSBzZWxlY3Rpb25zLlxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb24ucmFuZ2VDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRG9tU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVGYWtlU2VsZWN0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZG9tUm9vdCA9IHRoaXMuZG9tQ29udmVydGVyLm1hcFZpZXdUb0RvbSh0aGlzLnNlbGVjdGlvbi5lZGl0YWJsZUVsZW1lbnQpO1xuICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRoZXJlIGlzIG5vIGZvY3VzLCBvciB0aGVyZSBpcyBubyBET00gZWxlbWVudCBjb3JyZXNwb25kaW5nIHRvIHNlbGVjdGlvbidzIGVkaXRhYmxlIGVsZW1lbnQuXG4gICAgICAgIGlmICghdGhpcy5pc0ZvY3VzZWQgfHwgIWRvbVJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZW5kZXIgZmFrZSBzZWxlY3Rpb24gLSBjcmVhdGUgdGhlIGZha2Ugc2VsZWN0aW9uIGNvbnRhaW5lciAoaWYgbmVlZGVkKSBhbmQgbW92ZSBET00gc2VsZWN0aW9uIHRvIGl0LlxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb24uaXNGYWtlKSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVGYWtlU2VsZWN0aW9uKGRvbVJvb3QpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2Zha2VTZWxlY3Rpb25Db250YWluZXIgJiYgdGhpcy5fZmFrZVNlbGVjdGlvbkNvbnRhaW5lci5pc0Nvbm5lY3RlZCkge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRmFrZVNlbGVjdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlRG9tU2VsZWN0aW9uKGRvbVJvb3QpO1xuICAgICAgICB9IGVsc2UgaWYgKCEodGhpcy5pc0NvbXBvc2luZyAmJiBlbnYuaXNBbmRyb2lkKSkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlRG9tU2VsZWN0aW9uKGRvbVJvb3QpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIHRoZSBmYWtlIHNlbGVjdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIGRvbVJvb3QgQSB2YWxpZCBET00gcm9vdCB3aGVyZSB0aGUgZmFrZSBzZWxlY3Rpb24gY29udGFpbmVyIHNob3VsZCBiZSBhZGRlZC5cblx0ICovIF91cGRhdGVGYWtlU2VsZWN0aW9uKGRvbVJvb3QpIHtcbiAgICAgICAgY29uc3QgZG9tRG9jdW1lbnQgPSBkb21Sb290Lm93bmVyRG9jdW1lbnQ7XG4gICAgICAgIGlmICghdGhpcy5fZmFrZVNlbGVjdGlvbkNvbnRhaW5lcikge1xuICAgICAgICAgICAgdGhpcy5fZmFrZVNlbGVjdGlvbkNvbnRhaW5lciA9IGNyZWF0ZUZha2VTZWxlY3Rpb25Db250YWluZXIoZG9tRG9jdW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuX2Zha2VTZWxlY3Rpb25Db250YWluZXI7XG4gICAgICAgIC8vIEJpbmQgZmFrZSBzZWxlY3Rpb24gY29udGFpbmVyIHdpdGggdGhlIGN1cnJlbnQgc2VsZWN0aW9uICpwb3NpdGlvbiouXG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyLmJpbmRGYWtlU2VsZWN0aW9uKGNvbnRhaW5lciwgdGhpcy5zZWxlY3Rpb24pO1xuICAgICAgICBpZiAoIXRoaXMuX2Zha2VTZWxlY3Rpb25OZWVkc1VwZGF0ZShkb21Sb290KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udGFpbmVyLnBhcmVudEVsZW1lbnQgfHwgY29udGFpbmVyLnBhcmVudEVsZW1lbnQgIT0gZG9tUm9vdCkge1xuICAgICAgICAgICAgZG9tUm9vdC5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IHRoaXMuc2VsZWN0aW9uLmZha2VTZWxlY3Rpb25MYWJlbCB8fCAnXFx1MDBBMCc7XG4gICAgICAgIGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvbURvY3VtZW50LmdldFNlbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBkb21SYW5nZSA9IGRvbURvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIGRvbVNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgZG9tUmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKGNvbnRhaW5lcik7XG4gICAgICAgIGRvbVNlbGVjdGlvbi5hZGRSYW5nZShkb21SYW5nZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIHRoZSBET00gc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tUm9vdCBBIHZhbGlkIERPTSByb290IHdoZXJlIHRoZSBET00gc2VsZWN0aW9uIHNob3VsZCBiZSByZW5kZXJlZC5cblx0ICovIF91cGRhdGVEb21TZWxlY3Rpb24oZG9tUm9vdCkge1xuICAgICAgICBjb25zdCBkb21TZWxlY3Rpb24gPSBkb21Sb290Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIC8vIExldCdzIGNoZWNrIHdoZXRoZXIgRE9NIHNlbGVjdGlvbiBuZWVkcyB1cGRhdGluZyBhdCBhbGwuXG4gICAgICAgIGlmICghdGhpcy5fZG9tU2VsZWN0aW9uTmVlZHNVcGRhdGUoZG9tU2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIE11bHRpLXJhbmdlIHNlbGVjdGlvbiBpcyBub3QgYXZhaWxhYmxlIGluIG1vc3QgYnJvd3NlcnMsIGFuZCwgYXQgbGVhc3QgaW4gQ2hyb21lLCB0cnlpbmcgdG9cbiAgICAgICAgLy8gc2V0IHN1Y2ggc2VsZWN0aW9uLCB0aGF0IGlzIG5vdCBjb250aW51b3VzLCB0aHJvd3MgYW4gZXJyb3IuIEJlY2F1c2Ugb2YgdGhhdCwgd2Ugd2lsbCBqdXN0IHVzZSBhbmNob3JcbiAgICAgICAgLy8gYW5kIGZvY3VzIG9mIHZpZXcgc2VsZWN0aW9uLlxuICAgICAgICAvLyBTaW5jZSB3ZSBhcmUgbm90IHN1cHBvcnRpbmcgbXVsdGktcmFuZ2Ugc2VsZWN0aW9uLCB3ZSBhbHNvIGRvIG5vdCBuZWVkIHRvIGNoZWNrIGlmIHByb3BlciBlZGl0YWJsZSBpc1xuICAgICAgICAvLyBzZWxlY3RlZC4gSWYgdGhlcmUgaXMgYW55IGVkaXRhYmxlIHNlbGVjdGVkLCBpdCBpcyBva2F5IChlZGl0YWJsZSBpcyB0YWtlbiBmcm9tIHNlbGVjdGlvbiBhbmNob3IpLlxuICAgICAgICBjb25zdCBhbmNob3IgPSB0aGlzLmRvbUNvbnZlcnRlci52aWV3UG9zaXRpb25Ub0RvbSh0aGlzLnNlbGVjdGlvbi5hbmNob3IpO1xuICAgICAgICBjb25zdCBmb2N1cyA9IHRoaXMuZG9tQ29udmVydGVyLnZpZXdQb3NpdGlvblRvRG9tKHRoaXMuc2VsZWN0aW9uLmZvY3VzKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggJyVjW1JlbmRlcmVyXSVjIFVwZGF0ZSBET00gc2VsZWN0aW9uOicsXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCdjb2xvcjogZ3JlZW47IGZvbnQtd2VpZ2h0OiBib2xkJywgJycsIGFuY2hvciwgZm9jdXNcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdCk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICBkb21TZWxlY3Rpb24uc2V0QmFzZUFuZEV4dGVudChhbmNob3IucGFyZW50LCBhbmNob3Iub2Zmc2V0LCBmb2N1cy5wYXJlbnQsIGZvY3VzLm9mZnNldCk7XG4gICAgICAgIC8vIEZpcmVmb3jigJNzcGVjaWZpYyBoYWNrIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvMTQzOSkuXG4gICAgICAgIGlmIChlbnYuaXNHZWNrbykge1xuICAgICAgICAgICAgZml4R2Vja29TZWxlY3Rpb25BZnRlckJyKGZvY3VzLCBkb21TZWxlY3Rpb24pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBhIGdpdmVuIERPTSBzZWxlY3Rpb24gbmVlZHMgdG8gYmUgdXBkYXRlZC5cblx0ICpcblx0ICogQHBhcmFtIGRvbVNlbGVjdGlvbiBUaGUgRE9NIHNlbGVjdGlvbiB0byBjaGVjay5cblx0ICovIF9kb21TZWxlY3Rpb25OZWVkc1VwZGF0ZShkb21TZWxlY3Rpb24pIHtcbiAgICAgICAgaWYgKCF0aGlzLmRvbUNvbnZlcnRlci5pc0RvbVNlbGVjdGlvbkNvcnJlY3QoZG9tU2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgLy8gQ3VycmVudCBET00gc2VsZWN0aW9uIGlzIGluIGluY29ycmVjdCBwb3NpdGlvbi4gV2UgbmVlZCB0byB1cGRhdGUgaXQuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRWaWV3U2VsZWN0aW9uID0gZG9tU2VsZWN0aW9uICYmIHRoaXMuZG9tQ29udmVydGVyLmRvbVNlbGVjdGlvblRvVmlldyhkb21TZWxlY3Rpb24pO1xuICAgICAgICBpZiAob2xkVmlld1NlbGVjdGlvbiAmJiB0aGlzLnNlbGVjdGlvbi5pc0VxdWFsKG9sZFZpZXdTZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgc2VsZWN0aW9uIGlzIG5vdCBjb2xsYXBzZWQsIGl0IGRvZXMgbm90IG5lZWQgdG8gYmUgdXBkYXRlZCBpZiBpdCBpcyBzaW1pbGFyLlxuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmIHRoaXMuc2VsZWN0aW9uLmlzU2ltaWxhcihvbGRWaWV3U2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgLy8gU2VsZWN0aW9uIGRpZCBub3QgY2hhbmdlZCBhbmQgaXMgY29ycmVjdCwgZG8gbm90IHVwZGF0ZS5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTZWxlY3Rpb25zIGFyZSBub3Qgc2ltaWxhci5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgZmFrZSBzZWxlY3Rpb24gbmVlZHMgdG8gYmUgdXBkYXRlZC5cblx0ICpcblx0ICogQHBhcmFtIGRvbVJvb3QgQSB2YWxpZCBET00gcm9vdCB3aGVyZSBhIG5ldyBmYWtlIHNlbGVjdGlvbiBjb250YWluZXIgc2hvdWxkIGJlIGFkZGVkLlxuXHQgKi8gX2Zha2VTZWxlY3Rpb25OZWVkc1VwZGF0ZShkb21Sb290KSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuX2Zha2VTZWxlY3Rpb25Db250YWluZXI7XG4gICAgICAgIGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvbVJvb3Qub3duZXJEb2N1bWVudC5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgLy8gRmFrZSBzZWxlY3Rpb24gbmVlZHMgdG8gYmUgdXBkYXRlZCBpZiB0aGVyZSdzIG5vIGZha2Ugc2VsZWN0aW9uIGNvbnRhaW5lciwgb3IgdGhlIGNvbnRhaW5lciBjdXJyZW50bHkgc2l0c1xuICAgICAgICAvLyBpbiBhIGRpZmZlcmVudCByb290LlxuICAgICAgICBpZiAoIWNvbnRhaW5lciB8fCBjb250YWluZXIucGFyZW50RWxlbWVudCAhPT0gZG9tUm9vdCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIHNlbGVjdGlvbiBhY3R1YWxseSBpcyB3aXRoaW4gdGhlIGZha2Ugc2VsZWN0aW9uLlxuICAgICAgICBpZiAoZG9tU2VsZWN0aW9uLmFuY2hvck5vZGUgIT09IGNvbnRhaW5lciAmJiAhY29udGFpbmVyLmNvbnRhaW5zKGRvbVNlbGVjdGlvbi5hbmNob3JOb2RlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci50ZXh0Q29udGVudCAhPT0gdGhpcy5zZWxlY3Rpb24uZmFrZVNlbGVjdGlvbkxhYmVsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyB0aGUgRE9NIHNlbGVjdGlvbi5cblx0ICovIF9yZW1vdmVEb21TZWxlY3Rpb24oKSB7XG4gICAgICAgIGZvciAoY29uc3QgZG9jIG9mIHRoaXMuZG9tRG9jdW1lbnRzKXtcbiAgICAgICAgICAgIGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvYy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIGlmIChkb21TZWxlY3Rpb24ucmFuZ2VDb3VudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZURvbUVsZW1lbnQgPSBkb2MuYWN0aXZlRWxlbWVudDtcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHRoaXMuZG9tQ29udmVydGVyLm1hcERvbVRvVmlldyhhY3RpdmVEb21FbGVtZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlRG9tRWxlbWVudCAmJiB2aWV3RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBkb21TZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIHRoZSBmYWtlIHNlbGVjdGlvbi5cblx0ICovIF9yZW1vdmVGYWtlU2VsZWN0aW9uKCkge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLl9mYWtlU2VsZWN0aW9uQ29udGFpbmVyO1xuICAgICAgICBpZiAoY29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBmb2N1cyBuZWVkcyB0byBiZSB1cGRhdGVkIGFuZCBwb3NzaWJseSB1cGRhdGVzIGl0LlxuXHQgKi8gX3VwZGF0ZUZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVkaXRhYmxlID0gdGhpcy5zZWxlY3Rpb24uZWRpdGFibGVFbGVtZW50O1xuICAgICAgICAgICAgaWYgKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuZm9jdXMoZWRpdGFibGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBDaGVja3MgaWYgcHJvdmlkZWQgZWxlbWVudCBpcyBlZGl0YWJsZS5cbiAqLyBmdW5jdGlvbiBpc0VkaXRhYmxlKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScpID09ICdmYWxzZScpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBwYXJlbnQgPSBlbGVtZW50LmZpbmRBbmNlc3RvcigoZWxlbWVudCk9PmVsZW1lbnQuaGFzQXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSk7XG4gICAgcmV0dXJuICFwYXJlbnQgfHwgcGFyZW50LmdldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykgPT0gJ3RydWUnO1xufVxuLyoqXG4gKiBBZGRzIGlubGluZSBmaWxsZXIgYXQgYSBnaXZlbiBwb3NpdGlvbi5cbiAqXG4gKiBUaGUgcG9zaXRpb24gY2FuIGJlIGdpdmVuIGFzIGFuIGFycmF5IG9mIERPTSBub2RlcyBhbmQgYW4gb2Zmc2V0IGluIHRoYXQgYXJyYXksXG4gKiBvciBhIERPTSBwYXJlbnQgZWxlbWVudCBhbmQgYW4gb2Zmc2V0IGluIHRoYXQgZWxlbWVudC5cbiAqXG4gKiBAcmV0dXJucyBUaGUgRE9NIHRleHQgbm9kZSB0aGF0IGNvbnRhaW5zIGFuIGlubGluZSBmaWxsZXIuXG4gKi8gZnVuY3Rpb24gYWRkSW5saW5lRmlsbGVyKGRvbURvY3VtZW50LCBkb21QYXJlbnRPckFycmF5LCBvZmZzZXQpIHtcbiAgICBjb25zdCBjaGlsZE5vZGVzID0gZG9tUGFyZW50T3JBcnJheSBpbnN0YW5jZW9mIEFycmF5ID8gZG9tUGFyZW50T3JBcnJheSA6IGRvbVBhcmVudE9yQXJyYXkuY2hpbGROb2RlcztcbiAgICBjb25zdCBub2RlQWZ0ZXJGaWxsZXIgPSBjaGlsZE5vZGVzW29mZnNldF07XG4gICAgaWYgKGlzVGV4dChub2RlQWZ0ZXJGaWxsZXIpKSB7XG4gICAgICAgIG5vZGVBZnRlckZpbGxlci5kYXRhID0gSU5MSU5FX0ZJTExFUiArIG5vZGVBZnRlckZpbGxlci5kYXRhO1xuICAgICAgICByZXR1cm4gbm9kZUFmdGVyRmlsbGVyO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGZpbGxlck5vZGUgPSBkb21Eb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShJTkxJTkVfRklMTEVSKTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZG9tUGFyZW50T3JBcnJheSkpIHtcbiAgICAgICAgICAgIGNoaWxkTm9kZXMuc3BsaWNlKG9mZnNldCwgMCwgZmlsbGVyTm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbnNlcnRBdChkb21QYXJlbnRPckFycmF5LCBvZmZzZXQsIGZpbGxlck5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxsZXJOb2RlO1xuICAgIH1cbn1cbi8qKlxuICogV2hldGhlciB0d28gRE9NIG5vZGVzIHNob3VsZCBiZSBjb25zaWRlcmVkIGFzIHNpbWlsYXIuXG4gKiBOb2RlcyBhcmUgY29uc2lkZXJlZCBzaW1pbGFyIGlmIHRoZXkgaGF2ZSB0aGUgc2FtZSB0YWcgbmFtZS5cbiAqLyBmdW5jdGlvbiBhcmVTaW1pbGFyRWxlbWVudHMobm9kZTEsIG5vZGUyKSB7XG4gICAgcmV0dXJuIGlzTm9kZShub2RlMSkgJiYgaXNOb2RlKG5vZGUyKSAmJiAhaXNUZXh0KG5vZGUxKSAmJiAhaXNUZXh0KG5vZGUyKSAmJiAhaXNDb21tZW50KG5vZGUxKSAmJiAhaXNDb21tZW50KG5vZGUyKSAmJiBub2RlMS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5vZGUyLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbn1cbi8qKlxuICogV2hldGhlciB0d28gRE9NIG5vZGVzIGFyZSB0ZXh0IG5vZGVzLlxuICovIGZ1bmN0aW9uIGFyZVRleHROb2Rlcyhub2RlMSwgbm9kZTIpIHtcbiAgICByZXR1cm4gaXNOb2RlKG5vZGUxKSAmJiBpc05vZGUobm9kZTIpICYmIGlzVGV4dChub2RlMSkgJiYgaXNUZXh0KG5vZGUyKTtcbn1cbi8qKlxuICogV2hldGhlciB0d28gZG9tIG5vZGVzIHNob3VsZCBiZSBjb25zaWRlcmVkIGFzIHRoZSBzYW1lLlxuICogVHdvIG5vZGVzIHdoaWNoIGFyZSBjb25zaWRlcmVkIHRoZSBzYW1lIGFyZTpcbiAqXG4gKiAqIFRleHQgbm9kZXMgd2l0aCB0aGUgc2FtZSB0ZXh0LlxuICogKiBFbGVtZW50IG5vZGVzIHJlcHJlc2VudGVkIGJ5IHRoZSBzYW1lIG9iamVjdC5cbiAqICogVHdvIGJsb2NrIGZpbGxlciBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gYmxvY2tGaWxsZXJNb2RlIEJsb2NrIGZpbGxlciBtb2RlLCBzZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2Jsb2NrRmlsbGVyTW9kZX0uXG4gKi8gZnVuY3Rpb24gc2FtZU5vZGVzJDEoZG9tQ29udmVydGVyLCBhY3R1YWxEb21DaGlsZCwgZXhwZWN0ZWREb21DaGlsZCkge1xuICAgIC8vIEVsZW1lbnRzLlxuICAgIGlmIChhY3R1YWxEb21DaGlsZCA9PT0gZXhwZWN0ZWREb21DaGlsZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGlzVGV4dChhY3R1YWxEb21DaGlsZCkgJiYgaXNUZXh0KGV4cGVjdGVkRG9tQ2hpbGQpKSB7XG4gICAgICAgIHJldHVybiBhY3R1YWxEb21DaGlsZC5kYXRhID09PSBleHBlY3RlZERvbUNoaWxkLmRhdGE7XG4gICAgfSBlbHNlIGlmIChkb21Db252ZXJ0ZXIuaXNCbG9ja0ZpbGxlcihhY3R1YWxEb21DaGlsZCkgJiYgZG9tQ29udmVydGVyLmlzQmxvY2tGaWxsZXIoZXhwZWN0ZWREb21DaGlsZCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIE5vdCBtYXRjaGluZyB0eXBlcy5cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIFRoZSBmb2xsb3dpbmcgaXMgYSBGaXJlZm944oCTc3BlY2lmaWMgaGFjayAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE0MzkpLlxuICogV2hlbiB0aGUgbmF0aXZlIERPTSBzZWxlY3Rpb24gaXMgYXQgdGhlIGVuZCBvZiB0aGUgYmxvY2sgYW5kIHByZWNlZGVkIGJ5IDxiciAvPiBlLmcuXG4gKlxuICogYGBgaHRtbFxuICogPHA+Zm9vPGJyLz5bXTwvcD5cbiAqIGBgYFxuICpcbiAqIHdoaWNoIGhhcHBlbnMgYSBsb3Qgd2hlbiB1c2luZyB0aGUgc29mdCBsaW5lIGJyZWFrLCB0aGUgYnJvd3NlciBmYWlscyB0byAodmlzdWFsbHkpIG1vdmUgdGhlXG4gKiBjYXJldCB0byB0aGUgbmV3IGxpbmUuIEEgcXVpY2sgZml4IGlzIGFzIHNpbXBsZSBhcyBmb3JjZeKAk3JlZnJlc2hpbmcgdGhlIHNlbGVjdGlvbiB3aXRoIHRoZSBzYW1lIHJhbmdlLlxuICovIGZ1bmN0aW9uIGZpeEdlY2tvU2VsZWN0aW9uQWZ0ZXJCcihmb2N1cywgZG9tU2VsZWN0aW9uKSB7XG4gICAgbGV0IHBhcmVudCA9IGZvY3VzLnBhcmVudDtcbiAgICBsZXQgb2Zmc2V0ID0gZm9jdXMub2Zmc2V0O1xuICAgIGlmIChpc1RleHQocGFyZW50KSAmJiBpc0lubGluZUZpbGxlcihwYXJlbnQpKSB7XG4gICAgICAgIG9mZnNldCA9IGluZGV4T2YocGFyZW50KSArIDE7XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnROb2RlO1xuICAgIH1cbiAgICAvLyBUaGlzIGZpeCB3b3JrcyBvbmx5IHdoZW4gdGhlIGZvY3VzIHBvaW50IGlzIGF0IHRoZSB2ZXJ5IGVuZCBvZiBhbiBlbGVtZW50LlxuICAgIC8vIFRoZXJlIGlzIG5vIHBvaW50IGluIHJ1bm5pbmcgaXQgaW4gY2FzZXMgdW5yZWxhdGVkIHRvIHRoZSBicm93c2VyIGJ1Zy5cbiAgICBpZiAocGFyZW50Lm5vZGVUeXBlICE9IE5vZGUuRUxFTUVOVF9OT0RFIHx8IG9mZnNldCAhPSBwYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgY2hpbGRBdE9mZnNldCA9IHBhcmVudC5jaGlsZE5vZGVzW29mZnNldF07XG4gICAgLy8gVG8gc3RheSBvbiB0aGUgc2FmZSBzaWRlLCB0aGUgZml4IGJlaW5nIGFzIHNwZWNpZmljIGFzIHBvc3NpYmxlLCBpdCB0YXJnZXRzIG9ubHkgdGhlXG4gICAgLy8gc2VsZWN0aW9uIHdoaWNoIGlzIGF0IHRoZSB2ZXJ5IGVuZCBvZiB0aGUgZWxlbWVudCBhbmQgcHJlY2VkZWQgYnkgPGJyIC8+LlxuICAgIGlmIChjaGlsZEF0T2Zmc2V0ICYmIGNoaWxkQXRPZmZzZXQudGFnTmFtZSA9PSAnQlInKSB7XG4gICAgICAgIGRvbVNlbGVjdGlvbi5hZGRSYW5nZShkb21TZWxlY3Rpb24uZ2V0UmFuZ2VBdCgwKSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZmlsdGVyT3V0RmFrZVNlbGVjdGlvbkNvbnRhaW5lcihkb21DaGlsZExpc3QsIGZha2VTZWxlY3Rpb25Db250YWluZXIpIHtcbiAgICBjb25zdCBjaGlsZExpc3QgPSBBcnJheS5mcm9tKGRvbUNoaWxkTGlzdCk7XG4gICAgaWYgKGNoaWxkTGlzdC5sZW5ndGggPT0gMCB8fCAhZmFrZVNlbGVjdGlvbkNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gY2hpbGRMaXN0O1xuICAgIH1cbiAgICBjb25zdCBsYXN0ID0gY2hpbGRMaXN0W2NoaWxkTGlzdC5sZW5ndGggLSAxXTtcbiAgICBpZiAobGFzdCA9PSBmYWtlU2VsZWN0aW9uQ29udGFpbmVyKSB7XG4gICAgICAgIGNoaWxkTGlzdC5wb3AoKTtcbiAgICB9XG4gICAgcmV0dXJuIGNoaWxkTGlzdDtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIGZha2Ugc2VsZWN0aW9uIGNvbnRhaW5lciBmb3IgYSBnaXZlbiBkb2N1bWVudC5cbiAqLyBmdW5jdGlvbiBjcmVhdGVGYWtlU2VsZWN0aW9uQ29udGFpbmVyKGRvbURvY3VtZW50KSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9tRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9ICdjay1mYWtlLXNlbGVjdGlvbi1jb250YWluZXInO1xuICAgIE9iamVjdC5hc3NpZ24oY29udGFpbmVyLnN0eWxlLCB7XG4gICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6ICctOTk5OXB4JyxcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzc1Mi5cbiAgICAgICAgd2lkdGg6ICc0MnB4J1xuICAgIH0pO1xuICAgIC8vIEZpbGwgaXQgd2l0aCBhIHRleHQgbm9kZSBzbyB3ZSBjYW4gdXBkYXRlIGl0IGxhdGVyLlxuICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9ICdcXHUwMEEwJztcbiAgICByZXR1cm4gY29udGFpbmVyO1xufSAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGZ1bmN0aW9uIF9lc2NhcGVUZXh0Tm9kZURhdGEoIHRleHQgKSB7XG4gLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnN0IGVzY2FwZWRUZXh0ID0gdGV4dFxuIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdC5yZXBsYWNlKCAvJi9nLCAnJmFtcDsnIClcbiAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQucmVwbGFjZSggL1xcdTAwQTAvZywgJyZuYnNwOycgKVxuIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdC5yZXBsYWNlKCAvXFx1MjA2MC9nLCAnJk5vQnJlYWs7JyApO1xuIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy9cbiAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0cmV0dXJuIGBcIiR7IGVzY2FwZWRUZXh0IH1cImA7XG4gLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG5cbmNvbnN0IEJSX0ZJTExFUl9SRUYgPSBCUl9GSUxMRVIoZ2xvYmFsLmRvY3VtZW50KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwXG5jb25zdCBOQlNQX0ZJTExFUl9SRUYgPSBOQlNQX0ZJTExFUihnbG9iYWwuZG9jdW1lbnQpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5ldy1jYXBcbmNvbnN0IE1BUktFRF9OQlNQX0ZJTExFUl9SRUYgPSBNQVJLRURfTkJTUF9GSUxMRVIoZ2xvYmFsLmRvY3VtZW50KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwXG5jb25zdCBVTlNBRkVfQVRUUklCVVRFX05BTUVfUFJFRklYID0gJ2RhdGEtY2stdW5zYWZlLWF0dHJpYnV0ZS0nO1xuY29uc3QgVU5TQUZFX0VMRU1FTlRfUkVQTEFDRU1FTlRfQVRUUklCVVRFID0gJ2RhdGEtY2stdW5zYWZlLWVsZW1lbnQnO1xuLyoqXG4gKiBgRG9tQ29udmVydGVyYCBpcyBhIHNldCBvZiB0b29scyB0byBkbyB0cmFuc2Zvcm1hdGlvbnMgYmV0d2VlbiBET00gbm9kZXMgYW5kIHZpZXcgbm9kZXMuIEl0IGFsc28gaGFuZGxlc1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2JpbmRFbGVtZW50cyBiaW5kaW5nc30gYmV0d2VlbiB0aGVzZSBub2Rlcy5cbiAqXG4gKiBBbiBpbnN0YW5jZSBvZiB0aGUgRE9NIGNvbnZlcnRlciBpcyBhdmFpbGFibGUgdW5kZXJcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2RvbUNvbnZlcnRlciBgZWRpdG9yLmVkaXRpbmcudmlldy5kb21Db252ZXJ0ZXJgfS5cbiAqXG4gKiBUaGUgRE9NIGNvbnZlcnRlciBkb2VzIG5vdCBjaGVjayB3aGljaCBub2RlcyBzaG91bGQgYmUgcmVuZGVyZWQgKHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JlbmRlcmVyflJlbmRlcmVyfSksIGRvZXMgbm90IGtlZXAgdGhlXG4gKiBzdGF0ZSBvZiBhIHRyZWUgbm9yIGtlZXBzIHRoZSBzeW5jaHJvbml6YXRpb24gYmV0d2VlbiB0aGUgdHJlZSB2aWV3IGFuZCB0aGUgRE9NIHRyZWUgKHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50fSkuXG4gKlxuICogVGhlIERPTSBjb252ZXJ0ZXIga2VlcHMgRE9NIGVsZW1lbnRzIHRvIHZpZXcgZWxlbWVudCBiaW5kaW5ncywgc28gd2hlbiB0aGUgY29udmVydGVyIGdldHMgZGVzdHJveWVkLCB0aGUgYmluZGluZ3MgYXJlIGxvc3QuXG4gKiBUd28gY29udmVydGVycyB3aWxsIGtlZXAgc2VwYXJhdGUgYmluZGluZyBtYXBzLCBzbyBvbmUgdHJlZSB2aWV3IGNhbiBiZSBib3VuZCB3aXRoIHR3byBET00gdHJlZXMuXG4gKi8gY2xhc3MgRG9tQ29udmVydGVyIHtcbiAgICBkb2N1bWVudDtcbiAgICAvKipcblx0ICogV2hldGhlciB0byBsZWF2ZSB0aGUgVmlldy10by1ET00gY29udmVyc2lvbiByZXN1bHQgdW5jaGFuZ2VkIG9yIGltcHJvdmUgZWRpdGluZyBleHBlcmllbmNlIGJ5IGZpbHRlcmluZyBvdXQgaW50ZXJhY3RpdmUgZGF0YS5cblx0ICovIHJlbmRlcmluZ01vZGU7XG4gICAgLyoqXG5cdCAqIFRoZSBtb2RlIG9mIGEgYmxvY2sgZmlsbGVyIHVzZWQgYnkgdGhlIERPTSBjb252ZXJ0ZXIuXG5cdCAqLyBibG9ja0ZpbGxlck1vZGU7XG4gICAgLyoqXG5cdCAqIEVsZW1lbnRzIHdoaWNoIGFyZSBjb25zaWRlcmVkIHByZS1mb3JtYXR0ZWQgZWxlbWVudHMuXG5cdCAqLyBwcmVFbGVtZW50cztcbiAgICAvKipcblx0ICogRWxlbWVudHMgd2hpY2ggYXJlIGNvbnNpZGVyZWQgYmxvY2sgZWxlbWVudHMgKGFuZCBoZW5jZSBzaG91bGQgYmUgZmlsbGVkIHdpdGggYVxuXHQgKiB7QGxpbmsgI2lzQmxvY2tGaWxsZXIgYmxvY2sgZmlsbGVyfSkuXG5cdCAqXG5cdCAqIFdoZXRoZXIgYW4gZWxlbWVudCBpcyBjb25zaWRlcmVkIGEgYmxvY2sgZWxlbWVudCBhbHNvIGFmZmVjdHMgaGFuZGxpbmcgb2YgdHJhaWxpbmcgd2hpdGVzcGFjZXMuXG5cdCAqXG5cdCAqIFlvdSBjYW4gZXh0ZW5kIHRoaXMgYXJyYXkgaWYgeW91IGludHJvZHVjZSBzdXBwb3J0IGZvciBibG9jayBlbGVtZW50cyB3aGljaCBhcmUgbm90IHlldCByZWNvZ25pemVkIGhlcmUuXG5cdCAqLyBibG9ja0VsZW1lbnRzO1xuICAgIC8qKlxuXHQgKiBBIGxpc3Qgb2YgZWxlbWVudHMgdGhhdCBleGlzdCBpbmxpbmUgKGluIHRleHQpIGJ1dCB0aGVpciBpbm5lciBzdHJ1Y3R1cmUgY2Fubm90IGJlIGVkaXRlZCBiZWNhdXNlXG5cdCAqIG9mIHRoZSB3YXkgdGhleSBhcmUgcmVuZGVyZWQgYnkgdGhlIGJyb3dzZXIuIFRoZXkgYXJlIG1vc3RseSBIVE1MIGZvcm0gZWxlbWVudHMgYnV0IHRoZXJlIGFyZSBvdGhlclxuXHQgKiBlbGVtZW50cyBzdWNoIGFzIGA8aW1nPmAgb3IgYDxpZnJhbWU+YCB0aGF0IGFsc28gaGF2ZSBub24tZWRpdGFibGUgY2hpbGRyZW4gb3Igbm8gY2hpbGRyZW4gd2hhdHNvZXZlci5cblx0ICpcblx0ICogV2hldGhlciBhbiBlbGVtZW50IGlzIGNvbnNpZGVyZWQgYW4gaW5saW5lIG9iamVjdCBoYXMgYW4gaW1wYWN0IG9uIHdoaXRlIHNwYWNlIHJlbmRlcmluZyAodHJpbW1pbmcpXG5cdCAqIGFyb3VuZCAoYW5kIGluc2lkZSBvZiBpdCkuIEluIHNob3J0LCB3aGl0ZSBzcGFjZXMgaW4gdGV4dCBub2RlcyBuZXh0IHRvIGlubGluZSBvYmplY3RzIGFyZSBub3QgdHJpbW1lZC5cblx0ICpcblx0ICogWW91IGNhbiBleHRlbmQgdGhpcyBhcnJheSBpZiB5b3UgaW50cm9kdWNlIHN1cHBvcnQgZm9yIGlubGluZSBvYmplY3QgZWxlbWVudHMgd2hpY2ggYXJlIG5vdCB5ZXQgcmVjb2duaXplZCBoZXJlLlxuXHQgKi8gaW5saW5lT2JqZWN0RWxlbWVudHM7XG4gICAgLyoqXG5cdCAqIEEgbGlzdCBvZiBlbGVtZW50cyB3aGljaCBtYXkgYWZmZWN0IHRoZSBlZGl0aW5nIGV4cGVyaWVuY2UuIFRvIGF2b2lkIHRoaXMsIHRob3NlIGVsZW1lbnRzIGFyZSByZXBsYWNlZCB3aXRoXG5cdCAqIGA8c3BhbiBkYXRhLWNrLXVuc2FmZS1lbGVtZW50PVwiW2VsZW1lbnQgbmFtZV1cIj48L3NwYW4+YCB3aGlsZSByZW5kZXJpbmcgaW4gdGhlIGVkaXRpbmcgbW9kZS5cblx0ICovIHVuc2FmZUVsZW1lbnRzO1xuICAgIC8qKlxuXHQgKiBUaGUgRE9NIERvY3VtZW50IHVzZWQgdG8gY3JlYXRlIERPTSBub2Rlcy5cblx0ICovIF9kb21Eb2N1bWVudDtcbiAgICAvKipcblx0ICogVGhlIERPTS10by12aWV3IG1hcHBpbmcuXG5cdCAqLyBfZG9tVG9WaWV3TWFwcGluZyA9IG5ldyBXZWFrTWFwKCk7XG4gICAgLyoqXG5cdCAqIFRoZSB2aWV3LXRvLURPTSBtYXBwaW5nLlxuXHQgKi8gX3ZpZXdUb0RvbU1hcHBpbmcgPSBuZXcgV2Vha01hcCgpO1xuICAgIC8qKlxuXHQgKiBIb2xkcyB0aGUgbWFwcGluZyBiZXR3ZWVuIGZha2Ugc2VsZWN0aW9uIGNvbnRhaW5lcnMgYW5kIGNvcnJlc3BvbmRpbmcgdmlldyBzZWxlY3Rpb25zLlxuXHQgKi8gX2Zha2VTZWxlY3Rpb25NYXBwaW5nID0gbmV3IFdlYWtNYXAoKTtcbiAgICAvKipcblx0ICogTWF0Y2hlciBmb3IgdmlldyBlbGVtZW50cyB3aG9zZSBjb250ZW50IHNob3VsZCBiZSB0cmVhdGVkIGFzIHJhdyBkYXRhXG5cdCAqIGFuZCBub3QgcHJvY2Vzc2VkIGR1cmluZyB0aGUgY29udmVyc2lvbiBmcm9tIERPTSBub2RlcyB0byB2aWV3IGVsZW1lbnRzLlxuXHQgKi8gX3Jhd0NvbnRlbnRFbGVtZW50TWF0Y2hlciA9IG5ldyBNYXRjaGVyKCk7XG4gICAgLyoqXG5cdCAqIE1hdGNoZXIgZm9yIGlubGluZSBvYmplY3QgdmlldyBlbGVtZW50cy4gVGhpcyBpcyBhbiBleHRlbnNpb24gb2YgYSBzaW1wbGUge0BsaW5rICNpbmxpbmVPYmplY3RFbGVtZW50c30gYXJyYXkgb2YgZWxlbWVudCBuYW1lcy5cblx0ICovIF9pbmxpbmVPYmplY3RFbGVtZW50TWF0Y2hlciA9IG5ldyBNYXRjaGVyKCk7XG4gICAgLyoqXG5cdCAqIFNldCBvZiBlbGVtZW50cyB3aXRoIHRlbXBvcmFyeSBjdXN0b20gcHJvcGVydGllcyB0aGF0IHJlcXVpcmUgY2xlYXJpbmcgYWZ0ZXIgcmVuZGVyLlxuXHQgKi8gX2VsZW1lbnRzV2l0aFRlbXBvcmFyeUN1c3RvbVByb3BlcnRpZXMgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBET00gY29udmVydGVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIHZpZXcgZG9jdW1lbnQgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBvcHRpb25zIEFuIG9iamVjdCB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuYmxvY2tGaWxsZXJNb2RlIFRoZSB0eXBlIG9mIHRoZSBibG9jayBmaWxsZXIgdG8gdXNlLlxuXHQgKiBEZWZhdWx0IHZhbHVlIGRlcGVuZHMgb24gdGhlIG9wdGlvbnMucmVuZGVyaW5nTW9kZTpcblx0ICogICduYnNwJyB3aGVuIG9wdGlvbnMucmVuZGVyaW5nTW9kZSA9PSAnZGF0YScsXG5cdCAqICAnYnInIHdoZW4gb3B0aW9ucy5yZW5kZXJpbmdNb2RlID09ICdlZGl0aW5nJy5cblx0ICogQHBhcmFtIG9wdGlvbnMucmVuZGVyaW5nTW9kZSBXaGV0aGVyIHRvIGxlYXZlIHRoZSBWaWV3LXRvLURPTSBjb252ZXJzaW9uIHJlc3VsdCB1bmNoYW5nZWRcblx0ICogb3IgaW1wcm92ZSBlZGl0aW5nIGV4cGVyaWVuY2UgYnkgZmlsdGVyaW5nIG91dCBpbnRlcmFjdGl2ZSBkYXRhLlxuXHQgKi8gY29uc3RydWN0b3IoZG9jdW1lbnQsIHsgYmxvY2tGaWxsZXJNb2RlLCByZW5kZXJpbmdNb2RlID0gJ2VkaXRpbmcnIH0gPSB7fSl7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudDtcbiAgICAgICAgdGhpcy5yZW5kZXJpbmdNb2RlID0gcmVuZGVyaW5nTW9kZTtcbiAgICAgICAgdGhpcy5ibG9ja0ZpbGxlck1vZGUgPSBibG9ja0ZpbGxlck1vZGUgfHwgKHJlbmRlcmluZ01vZGUgPT09ICdlZGl0aW5nJyA/ICdicicgOiAnbmJzcCcpO1xuICAgICAgICB0aGlzLnByZUVsZW1lbnRzID0gW1xuICAgICAgICAgICAgJ3ByZScsXG4gICAgICAgICAgICAndGV4dGFyZWEnXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuYmxvY2tFbGVtZW50cyA9IFtcbiAgICAgICAgICAgICdhZGRyZXNzJyxcbiAgICAgICAgICAgICdhcnRpY2xlJyxcbiAgICAgICAgICAgICdhc2lkZScsXG4gICAgICAgICAgICAnYmxvY2txdW90ZScsXG4gICAgICAgICAgICAnY2FwdGlvbicsXG4gICAgICAgICAgICAnY2VudGVyJyxcbiAgICAgICAgICAgICdkZCcsXG4gICAgICAgICAgICAnZGV0YWlscycsXG4gICAgICAgICAgICAnZGlyJyxcbiAgICAgICAgICAgICdkaXYnLFxuICAgICAgICAgICAgJ2RsJyxcbiAgICAgICAgICAgICdkdCcsXG4gICAgICAgICAgICAnZmllbGRzZXQnLFxuICAgICAgICAgICAgJ2ZpZ2NhcHRpb24nLFxuICAgICAgICAgICAgJ2ZpZ3VyZScsXG4gICAgICAgICAgICAnZm9vdGVyJyxcbiAgICAgICAgICAgICdmb3JtJyxcbiAgICAgICAgICAgICdoMScsXG4gICAgICAgICAgICAnaDInLFxuICAgICAgICAgICAgJ2gzJyxcbiAgICAgICAgICAgICdoNCcsXG4gICAgICAgICAgICAnaDUnLFxuICAgICAgICAgICAgJ2g2JyxcbiAgICAgICAgICAgICdoZWFkZXInLFxuICAgICAgICAgICAgJ2hncm91cCcsXG4gICAgICAgICAgICAnbGVnZW5kJyxcbiAgICAgICAgICAgICdsaScsXG4gICAgICAgICAgICAnbWFpbicsXG4gICAgICAgICAgICAnbWVudScsXG4gICAgICAgICAgICAnbmF2JyxcbiAgICAgICAgICAgICdvbCcsXG4gICAgICAgICAgICAncCcsXG4gICAgICAgICAgICAncHJlJyxcbiAgICAgICAgICAgICdzZWN0aW9uJyxcbiAgICAgICAgICAgICdzdW1tYXJ5JyxcbiAgICAgICAgICAgICd0YWJsZScsXG4gICAgICAgICAgICAndGJvZHknLFxuICAgICAgICAgICAgJ3RkJyxcbiAgICAgICAgICAgICd0Zm9vdCcsXG4gICAgICAgICAgICAndGgnLFxuICAgICAgICAgICAgJ3RoZWFkJyxcbiAgICAgICAgICAgICd0cicsXG4gICAgICAgICAgICAndWwnXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuaW5saW5lT2JqZWN0RWxlbWVudHMgPSBbXG4gICAgICAgICAgICAnb2JqZWN0JyxcbiAgICAgICAgICAgICdpZnJhbWUnLFxuICAgICAgICAgICAgJ2lucHV0JyxcbiAgICAgICAgICAgICdidXR0b24nLFxuICAgICAgICAgICAgJ3RleHRhcmVhJyxcbiAgICAgICAgICAgICdzZWxlY3QnLFxuICAgICAgICAgICAgJ29wdGlvbicsXG4gICAgICAgICAgICAndmlkZW8nLFxuICAgICAgICAgICAgJ2VtYmVkJyxcbiAgICAgICAgICAgICdhdWRpbycsXG4gICAgICAgICAgICAnaW1nJyxcbiAgICAgICAgICAgICdjYW52YXMnXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMudW5zYWZlRWxlbWVudHMgPSBbXG4gICAgICAgICAgICAnc2NyaXB0JyxcbiAgICAgICAgICAgICdzdHlsZSdcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5fZG9tRG9jdW1lbnQgPSB0aGlzLnJlbmRlcmluZ01vZGUgPT09ICdlZGl0aW5nJyA/IGdsb2JhbC5kb2N1bWVudCA6IGdsb2JhbC5kb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoJycpO1xuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgYSBnaXZlbiBET00gZWxlbWVudCB0aGF0IHJlcHJlc2VudHMgZmFrZSBzZWxlY3Rpb24gdG8gYSAqKnBvc2l0aW9uKiogb2YgYVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uIGRvY3VtZW50IHNlbGVjdGlvbn0uXG5cdCAqIERvY3VtZW50IHNlbGVjdGlvbiBjb3B5IGlzIHN0b3JlZCBhbmQgY2FuIGJlIHJldHJpZXZlZCBieSB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2Zha2VTZWxlY3Rpb25Ub1ZpZXd9IG1ldGhvZC5cblx0ICovIGJpbmRGYWtlU2VsZWN0aW9uKGRvbUVsZW1lbnQsIHZpZXdEb2N1bWVudFNlbGVjdGlvbikge1xuICAgICAgICB0aGlzLl9mYWtlU2VsZWN0aW9uTWFwcGluZy5zZXQoZG9tRWxlbWVudCwgbmV3IFNlbGVjdGlvbiQxKHZpZXdEb2N1bWVudFNlbGVjdGlvbikpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbiB2aWV3IHNlbGVjdGlvbn0gaW5zdGFuY2UgY29ycmVzcG9uZGluZyB0byBhIGdpdmVuXG5cdCAqIERPTSBlbGVtZW50IHRoYXQgcmVwcmVzZW50cyBmYWtlIHNlbGVjdGlvbi4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBiaW5kaW5nIHRvIHRoZSBnaXZlbiBET00gZWxlbWVudCBkb2VzIG5vdCBleGlzdC5cblx0ICovIGZha2VTZWxlY3Rpb25Ub1ZpZXcoZG9tRWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmFrZVNlbGVjdGlvbk1hcHBpbmcuZ2V0KGRvbUVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgRE9NIGFuZCB2aWV3IGVsZW1lbnRzLCBzbyBpdCB3aWxsIGJlIHBvc3NpYmxlIHRvIGdldCBjb3JyZXNwb25kaW5nIGVsZW1lbnRzIHVzaW5nXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNtYXBEb21Ub1ZpZXd9IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjbWFwVmlld1RvRG9tfS5cblx0ICpcblx0ICogQHBhcmFtIGRvbUVsZW1lbnQgVGhlIERPTSBlbGVtZW50IHRvIGJpbmQuXG5cdCAqIEBwYXJhbSB2aWV3RWxlbWVudCBUaGUgdmlldyBlbGVtZW50IHRvIGJpbmQuXG5cdCAqLyBiaW5kRWxlbWVudHMoZG9tRWxlbWVudCwgdmlld0VsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fZG9tVG9WaWV3TWFwcGluZy5zZXQoZG9tRWxlbWVudCwgdmlld0VsZW1lbnQpO1xuICAgICAgICB0aGlzLl92aWV3VG9Eb21NYXBwaW5nLnNldCh2aWV3RWxlbWVudCwgZG9tRWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbmJpbmRzIGEgZ2l2ZW4gRE9NIGVsZW1lbnQgZnJvbSB0aGUgdmlldyBlbGVtZW50IGl0IHdhcyBib3VuZCB0by4gVW5iaW5kaW5nIGlzIGRlZXAsIG1lYW5pbmcgdGhhdCBhbGwgY2hpbGRyZW4gb2Zcblx0ICogdGhlIERPTSBlbGVtZW50IHdpbGwgYmUgdW5ib3VuZCB0b28uXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21FbGVtZW50IFRoZSBET00gZWxlbWVudCB0byB1bmJpbmQuXG5cdCAqLyB1bmJpbmREb21FbGVtZW50KGRvbUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSB0aGlzLl9kb21Ub1ZpZXdNYXBwaW5nLmdldChkb21FbGVtZW50KTtcbiAgICAgICAgaWYgKHZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9kb21Ub1ZpZXdNYXBwaW5nLmRlbGV0ZShkb21FbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuX3ZpZXdUb0RvbU1hcHBpbmcuZGVsZXRlKHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZG9tRWxlbWVudC5jaGlsZHJlbil7XG4gICAgICAgICAgICAgICAgdGhpcy51bmJpbmREb21FbGVtZW50KGNoaWxkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgRE9NIGFuZCB2aWV3IGRvY3VtZW50IGZyYWdtZW50cywgc28gaXQgd2lsbCBiZSBwb3NzaWJsZSB0byBnZXQgY29ycmVzcG9uZGluZyBkb2N1bWVudCBmcmFnbWVudHMgdXNpbmdcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI21hcERvbVRvVmlld30gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNtYXBWaWV3VG9Eb219LlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tRnJhZ21lbnQgVGhlIERPTSBkb2N1bWVudCBmcmFnbWVudCB0byBiaW5kLlxuXHQgKiBAcGFyYW0gdmlld0ZyYWdtZW50IFRoZSB2aWV3IGRvY3VtZW50IGZyYWdtZW50IHRvIGJpbmQuXG5cdCAqLyBiaW5kRG9jdW1lbnRGcmFnbWVudHMoZG9tRnJhZ21lbnQsIHZpZXdGcmFnbWVudCkge1xuICAgICAgICB0aGlzLl9kb21Ub1ZpZXdNYXBwaW5nLnNldChkb21GcmFnbWVudCwgdmlld0ZyYWdtZW50KTtcbiAgICAgICAgdGhpcy5fdmlld1RvRG9tTWFwcGluZy5zZXQodmlld0ZyYWdtZW50LCBkb21GcmFnbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZWNpZGVzIHdoZXRoZXIgYSBnaXZlbiBwYWlyIG9mIGF0dHJpYnV0ZSBrZXkgYW5kIHZhbHVlIHNob3VsZCBiZSBwYXNzZWQgZnVydGhlciBkb3duIHRoZSBwaXBlbGluZS5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnROYW1lIEVsZW1lbnQgbmFtZSBpbiBsb3dlciBjYXNlLlxuXHQgKi8gc2hvdWxkUmVuZGVyQXR0cmlidXRlKGF0dHJpYnV0ZUtleSwgYXR0cmlidXRlVmFsdWUsIGVsZW1lbnROYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmluZ01vZGUgPT09ICdkYXRhJykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYXR0cmlidXRlS2V5ID0gYXR0cmlidXRlS2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChhdHRyaWJ1dGVLZXkuc3RhcnRzV2l0aCgnb24nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhdHRyaWJ1dGVLZXkgPT09ICdzcmNkb2MnICYmIGF0dHJpYnV0ZVZhbHVlLm1hdGNoKC9cXGJvblxcUytcXHMqPXxqYXZhc2NyaXB0Onw8XFxzKlxcLypzY3JpcHQvaSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudE5hbWUgPT09ICdpbWcnICYmIChhdHRyaWJ1dGVLZXkgPT09ICdzcmMnIHx8IGF0dHJpYnV0ZUtleSA9PT0gJ3NyY3NldCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudE5hbWUgPT09ICdzb3VyY2UnICYmIGF0dHJpYnV0ZUtleSA9PT0gJ3NyY3NldCcpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhdHRyaWJ1dGVWYWx1ZS5tYXRjaCgvXlxccyooamF2YXNjcmlwdDp8ZGF0YTooaW1hZ2VcXC9zdmd8dGV4dFxcL3g/aHRtbCkpL2kpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXQgYGRvbUVsZW1lbnRgJ3MgY29udGVudCB1c2luZyBwcm92aWRlZCBgaHRtbGAgYXJndW1lbnQuIEFwcGx5IG5lY2Vzc2FyeSBmaWx0ZXJpbmcgZm9yIHRoZSBlZGl0aW5nIHBpcGVsaW5lLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tRWxlbWVudCBET00gZWxlbWVudCB0aGF0IHNob3VsZCBoYXZlIGBodG1sYCBzZXQgYXMgaXRzIGNvbnRlbnQuXG5cdCAqIEBwYXJhbSBodG1sIFRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIEhUTUwgdGhhdCB3aWxsIGJlIHNldCBvbiBgZG9tRWxlbWVudGAuXG5cdCAqLyBzZXRDb250ZW50T2YoZG9tRWxlbWVudCwgaHRtbCkge1xuICAgICAgICAvLyBGb3IgZGF0YSBwaXBlbGluZSB3ZSBwYXNzIHRoZSBIVE1MIGFzLWlzLlxuICAgICAgICBpZiAodGhpcy5yZW5kZXJpbmdNb2RlID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgIGRvbUVsZW1lbnQuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpO1xuICAgICAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgY29uc3QgYm9keUNoaWxkTm9kZXMgPSBkb2N1bWVudC5ib2R5LmNoaWxkTm9kZXM7XG4gICAgICAgIHdoaWxlKGJvZHlDaGlsZE5vZGVzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoYm9keUNoaWxkTm9kZXNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRyZWVXYWxrZXIgPSBkb2N1bWVudC5jcmVhdGVUcmVlV2Fsa2VyKGZyYWdtZW50LCBOb2RlRmlsdGVyLlNIT1dfRUxFTUVOVCk7XG4gICAgICAgIGNvbnN0IG5vZGVzID0gW107XG4gICAgICAgIGxldCBjdXJyZW50Tm9kZTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbmQtYXNzaWduXG4gICAgICAgIHdoaWxlKGN1cnJlbnROb2RlID0gdHJlZVdhbGtlci5uZXh0Tm9kZSgpKXtcbiAgICAgICAgICAgIG5vZGVzLnB1c2goY3VycmVudE5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgY3VycmVudE5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBub2RlcyB0byByZW1vdmUgdGhvc2UgdGhhdCBhcmUgcHJvaGliaXRlZCBpbiBlZGl0aW5nIHBpcGVsaW5lLlxuICAgICAgICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGVOYW1lIG9mIGN1cnJlbnROb2RlLmdldEF0dHJpYnV0ZU5hbWVzKCkpe1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RG9tRWxlbWVudEF0dHJpYnV0ZShjdXJyZW50Tm9kZSwgYXR0cmlidXRlTmFtZSwgY3VycmVudE5vZGUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnROYW1lID0gY3VycmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgLy8gVGhlcmUgYXJlIGNlcnRhaW4gbm9kZXMsIHRoYXQgc2hvdWxkIGJlIHJlbmFtZWQgdG8gPHNwYW4+IGluIGVkaXRpbmcgcGlwZWxpbmUuXG4gICAgICAgICAgICBpZiAodGhpcy5fc2hvdWxkUmVuYW1lRWxlbWVudChlbGVtZW50TmFtZSkpIHtcbiAgICAgICAgICAgICAgICBfbG9nVW5zYWZlRWxlbWVudChlbGVtZW50TmFtZSk7XG4gICAgICAgICAgICAgICAgY3VycmVudE5vZGUucmVwbGFjZVdpdGgodGhpcy5fY3JlYXRlUmVwbGFjZW1lbnREb21FbGVtZW50KGVsZW1lbnROYW1lLCBjdXJyZW50Tm9kZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEVtcHR5IHRoZSB0YXJnZXQgZWxlbWVudC5cbiAgICAgICAgd2hpbGUoZG9tRWxlbWVudC5maXJzdENoaWxkKXtcbiAgICAgICAgICAgIGRvbUVsZW1lbnQuZmlyc3RDaGlsZC5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBkb21FbGVtZW50LmFwcGVuZChmcmFnbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyB0aGUgdmlldyB0byB0aGUgRE9NLiBGb3IgYWxsIHRleHQgbm9kZXMsIG5vdCBib3VuZCBlbGVtZW50cyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIG5ldyBpdGVtcyB3aWxsXG5cdCAqIGJlIGNyZWF0ZWQuIEZvciBib3VuZCBlbGVtZW50cyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIHRoZSBtZXRob2Qgd2lsbCByZXR1cm4gY29ycmVzcG9uZGluZyBpdGVtcy5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdOb2RlIFZpZXcgbm9kZSBvciBkb2N1bWVudCBmcmFnbWVudCB0byB0cmFuc2Zvcm0uXG5cdCAqIEBwYXJhbSBvcHRpb25zIENvbnZlcnNpb24gb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuYmluZCBEZXRlcm1pbmVzIHdoZXRoZXIgbmV3IGVsZW1lbnRzIHdpbGwgYmUgYm91bmQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLndpdGhDaGlsZHJlbiBJZiBgZmFsc2VgLCBub2RlJ3MgYW5kIGRvY3VtZW50IGZyYWdtZW50J3MgY2hpbGRyZW4gd2lsbCBub3QgYmUgY29udmVydGVkLlxuXHQgKiBAcmV0dXJucyBDb252ZXJ0ZWQgbm9kZSBvciBEb2N1bWVudEZyYWdtZW50LlxuXHQgKi8gdmlld1RvRG9tKHZpZXdOb2RlLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgaWYgKHZpZXdOb2RlLmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICBjb25zdCB0ZXh0RGF0YSA9IHRoaXMuX3Byb2Nlc3NEYXRhRnJvbVZpZXdUZXh0KHZpZXdOb2RlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kb21Eb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0RGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3RWxlbWVudE9yRnJhZ21lbnQgPSB2aWV3Tm9kZTtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hcFZpZXdUb0RvbSh2aWV3RWxlbWVudE9yRnJhZ21lbnQpKSB7XG4gICAgICAgICAgICAgICAgLy8gRG8gbm90IHJldXNlIGVsZW1lbnQgdGhhdCBpcyBtYXJrZWQgdG8gbm90IHJldXNlIChmb3IgZXhhbXBsZSBhbiBJTUcgZWxlbWVudFxuICAgICAgICAgICAgICAgIC8vIHNvIGl0IGNhbiBpbW1lZGlhdGVseSBkaXNwbGF5IGEgcGxhY2Vob2xkZXIgYmFja2dyb3VuZCBpbnN0ZWFkIG9mIHdhaXRpbmcgZm9yIHRoZSBuZXcgc3JjIHRvIGxvYWQpLlxuICAgICAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudE9yRnJhZ21lbnQuZ2V0Q3VzdG9tUHJvcGVydHkoJ2VkaXRpbmdQaXBlbGluZTpkb05vdFJldXNlT25jZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRzV2l0aFRlbXBvcmFyeUN1c3RvbVByb3BlcnRpZXMuYWRkKHZpZXdFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwVmlld1RvRG9tKHZpZXdFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGRvbUVsZW1lbnQ7XG4gICAgICAgICAgICBpZiAodmlld0VsZW1lbnRPckZyYWdtZW50LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgRE9NIGRvY3VtZW50IGZyYWdtZW50LlxuICAgICAgICAgICAgICAgIGRvbUVsZW1lbnQgPSB0aGlzLl9kb21Eb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYmluZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmREb2N1bWVudEZyYWdtZW50cyhkb21FbGVtZW50LCB2aWV3RWxlbWVudE9yRnJhZ21lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmlld0VsZW1lbnRPckZyYWdtZW50LmlzKCd1aUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudE9yRnJhZ21lbnQubmFtZSA9PT0gJyRjb21tZW50Jykge1xuICAgICAgICAgICAgICAgICAgICBkb21FbGVtZW50ID0gdGhpcy5fZG9tRG9jdW1lbnQuY3JlYXRlQ29tbWVudCh2aWV3RWxlbWVudE9yRnJhZ21lbnQuZ2V0Q3VzdG9tUHJvcGVydHkoJyRyYXdDb250ZW50JykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVJRWxlbWVudCBoYXMgaXRzIG93biByZW5kZXIoKSBtZXRob2QgKHNlZSAjNzk5KS5cbiAgICAgICAgICAgICAgICAgICAgZG9tRWxlbWVudCA9IHZpZXdFbGVtZW50T3JGcmFnbWVudC5yZW5kZXIodGhpcy5fZG9tRG9jdW1lbnQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5iaW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEVsZW1lbnRzKGRvbUVsZW1lbnQsIHZpZXdFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkb21FbGVtZW50O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgRE9NIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Nob3VsZFJlbmFtZUVsZW1lbnQodmlld0VsZW1lbnRPckZyYWdtZW50Lm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIF9sb2dVbnNhZmVFbGVtZW50KHZpZXdFbGVtZW50T3JGcmFnbWVudC5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgZG9tRWxlbWVudCA9IHRoaXMuX2NyZWF0ZVJlcGxhY2VtZW50RG9tRWxlbWVudCh2aWV3RWxlbWVudE9yRnJhZ21lbnQubmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2aWV3RWxlbWVudE9yRnJhZ21lbnQuaGFzQXR0cmlidXRlKCd4bWxucycpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbUVsZW1lbnQgPSB0aGlzLl9kb21Eb2N1bWVudC5jcmVhdGVFbGVtZW50TlModmlld0VsZW1lbnRPckZyYWdtZW50LmdldEF0dHJpYnV0ZSgneG1sbnMnKSwgdmlld0VsZW1lbnRPckZyYWdtZW50Lm5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbUVsZW1lbnQgPSB0aGlzLl9kb21Eb2N1bWVudC5jcmVhdGVFbGVtZW50KHZpZXdFbGVtZW50T3JGcmFnbWVudC5uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gUmF3RWxlbWVudCB0YWtlIGNhcmUgb2YgdGhlaXIgY2hpbGRyZW4gaW4gUmF3RWxlbWVudCNyZW5kZXIoKSBtZXRob2Qgd2hpY2ggY2FuIGJlIGN1c3RvbWl6ZWRcbiAgICAgICAgICAgICAgICAvLyAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzQ0NjkpLlxuICAgICAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudE9yRnJhZ21lbnQuaXMoJ3Jhd0VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgICAgICB2aWV3RWxlbWVudE9yRnJhZ21lbnQucmVuZGVyKGRvbUVsZW1lbnQsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5iaW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmluZEVsZW1lbnRzKGRvbUVsZW1lbnQsIHZpZXdFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENvcHkgZWxlbWVudCdzIGF0dHJpYnV0ZXMuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Ygdmlld0VsZW1lbnRPckZyYWdtZW50LmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RG9tRWxlbWVudEF0dHJpYnV0ZShkb21FbGVtZW50LCBrZXksIHZpZXdFbGVtZW50T3JGcmFnbWVudC5nZXRBdHRyaWJ1dGUoa2V5KSwgdmlld0VsZW1lbnRPckZyYWdtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3B0aW9ucy53aXRoQ2hpbGRyZW4gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLnZpZXdDaGlsZHJlblRvRG9tKHZpZXdFbGVtZW50T3JGcmFnbWVudCwgb3B0aW9ucykpe1xuICAgICAgICAgICAgICAgICAgICBpZiAoZG9tRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxUZW1wbGF0ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbUVsZW1lbnQuY29udGVudC5hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb21FbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb21FbGVtZW50O1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHRoZSBhdHRyaWJ1dGUgb24gYSBET00gZWxlbWVudC5cblx0ICpcblx0ICogKipOb3RlKio6IFRvIHJlbW92ZSB0aGUgYXR0cmlidXRlLCB1c2Uge0BsaW5rICNyZW1vdmVEb21FbGVtZW50QXR0cmlidXRlfS5cblx0ICpcblx0ICogQHBhcmFtIGRvbUVsZW1lbnQgVGhlIERPTSBlbGVtZW50IHRoZSBhdHRyaWJ1dGUgc2hvdWxkIGJlIHNldCBvbi5cblx0ICogQHBhcmFtIGtleSBUaGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlLlxuXHQgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUuXG5cdCAqIEBwYXJhbSByZWxhdGVkVmlld0VsZW1lbnQgVGhlIHZpZXcgZWxlbWVudCByZWxhdGVkIHRvIHRoZSBgZG9tRWxlbWVudGAgKGlmIHRoZXJlIGlzIGFueSkuXG5cdCAqIEl0IGhlbHBzIGRlY2lkZSB3aGV0aGVyIHRoZSBhdHRyaWJ1dGUgc2V0IGlzIHVuc2FmZS4gRm9yIGluc3RhbmNlLCB2aWV3IGVsZW1lbnRzIGNyZWF0ZWQgdmlhIHRoZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSBtZXRob2RzIGNhbiBhbGxvdyBjZXJ0YWluIGF0dHJpYnV0ZXMgdGhhdCB3b3VsZCBub3JtYWxseSBiZSBmaWx0ZXJlZCBvdXQuXG5cdCAqLyBzZXREb21FbGVtZW50QXR0cmlidXRlKGRvbUVsZW1lbnQsIGtleSwgdmFsdWUsIHJlbGF0ZWRWaWV3RWxlbWVudCkge1xuICAgICAgICBjb25zdCBzaG91bGRSZW5kZXJBdHRyaWJ1dGUgPSB0aGlzLnNob3VsZFJlbmRlckF0dHJpYnV0ZShrZXksIHZhbHVlLCBkb21FbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSkgfHwgcmVsYXRlZFZpZXdFbGVtZW50ICYmIHJlbGF0ZWRWaWV3RWxlbWVudC5zaG91bGRSZW5kZXJVbnNhZmVBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgaWYgKCFzaG91bGRSZW5kZXJBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIGxvZ1dhcm5pbmcoJ2RvbWNvbnZlcnRlci11bnNhZmUtYXR0cmlidXRlLWRldGVjdGVkJywge1xuICAgICAgICAgICAgICAgIGRvbUVsZW1lbnQsXG4gICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzVmFsaWRBdHRyaWJ1dGVOYW1lKGtleSkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogSW52YWxpZCBhdHRyaWJ1dGUgbmFtZSB3YXMgaWdub3JlZCBkdXJpbmcgcmVuZGVyaW5nLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBkb21jb252ZXJ0ZXItaW52YWxpZC1hdHRyaWJ1dGUtZGV0ZWN0ZWRcblx0XHRcdCAqLyBsb2dXYXJuaW5nKCdkb21jb252ZXJ0ZXItaW52YWxpZC1hdHRyaWJ1dGUtZGV0ZWN0ZWQnLCB7XG4gICAgICAgICAgICAgICAgZG9tRWxlbWVudCxcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBvbGQgdmFsdWUgd2FzIHNhZmUgYnV0IHRoZSBuZXcgdmFsdWUgaXMgdW5zYWZlLlxuICAgICAgICBpZiAoZG9tRWxlbWVudC5oYXNBdHRyaWJ1dGUoa2V5KSAmJiAhc2hvdWxkUmVuZGVyQXR0cmlidXRlKSB7XG4gICAgICAgICAgICBkb21FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgICAgICB9IGVsc2UgaWYgKGRvbUVsZW1lbnQuaGFzQXR0cmlidXRlKFVOU0FGRV9BVFRSSUJVVEVfTkFNRV9QUkVGSVggKyBrZXkpICYmIHNob3VsZFJlbmRlckF0dHJpYnV0ZSkge1xuICAgICAgICAgICAgZG9tRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoVU5TQUZFX0FUVFJJQlVURV9OQU1FX1BSRUZJWCArIGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdGhlIGF0dHJpYnV0ZSBzaG91bGQgbm90IGJlIHJlbmRlcmVkLCByZW5hbWUgaXQgKGluc3RlYWQgb2YgcmVtb3ZpbmcpIHRvIGdpdmUgZGV2ZWxvcGVycyBzb21lIGlkZWEgb2Ygd2hhdFxuICAgICAgICAvLyBpcyBnb2luZyBvbiAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTA4MDEpLlxuICAgICAgICBkb21FbGVtZW50LnNldEF0dHJpYnV0ZShzaG91bGRSZW5kZXJBdHRyaWJ1dGUgPyBrZXkgOiBVTlNBRkVfQVRUUklCVVRFX05BTUVfUFJFRklYICsga2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFuIGF0dHJpYnV0ZSBmcm9tIGEgRE9NIGVsZW1lbnQuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUbyBzZXQgdGhlIGF0dHJpYnV0ZSwgdXNlIHtAbGluayAjc2V0RG9tRWxlbWVudEF0dHJpYnV0ZX0uXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21FbGVtZW50IFRoZSBET00gZWxlbWVudCB0aGUgYXR0cmlidXRlIHNob3VsZCBiZSByZW1vdmVkIGZyb20uXG5cdCAqIEBwYXJhbSBrZXkgVGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZS5cblx0ICovIHJlbW92ZURvbUVsZW1lbnRBdHRyaWJ1dGUoZG9tRWxlbWVudCwga2V5KSB7XG4gICAgICAgIC8vIFNlZSAjX2NyZWF0ZVJlcGxhY2VtZW50RG9tRWxlbWVudCgpIHRvIGxlYXJuIHdoYXQgdGhpcyBpcy5cbiAgICAgICAgaWYgKGtleSA9PSBVTlNBRkVfRUxFTUVOVF9SRVBMQUNFTUVOVF9BVFRSSUJVVEUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkb21FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgICAgICAvLyBTZWUgc2V0RG9tRWxlbWVudEF0dHJpYnV0ZSgpIHRvIGxlYXJuIHdoYXQgdGhpcyBpcy5cbiAgICAgICAgZG9tRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoVU5TQUZFX0FUVFJJQlVURV9OQU1FX1BSRUZJWCArIGtleSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBjaGlsZHJlbiBvZiB0aGUgdmlldyBlbGVtZW50IHRvIERPTSB1c2luZyB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI3ZpZXdUb0RvbX0gbWV0aG9kLlxuXHQgKiBBZGRpdGlvbmFsbHksIHRoaXMgbWV0aG9kIGFkZHMgYmxvY2sge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXIgZmlsbGVyfSB0byB0aGUgbGlzdCBvZiBjaGlsZHJlbiwgaWYgbmVlZGVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnQgUGFyZW50IHZpZXcgZWxlbWVudC5cblx0ICogQHBhcmFtIG9wdGlvbnMgU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciN2aWV3VG9Eb219IG9wdGlvbnMgcGFyYW1ldGVyLlxuXHQgKiBAcmV0dXJucyBET00gbm9kZXMuXG5cdCAqLyAqdmlld0NoaWxkcmVuVG9Eb20odmlld0VsZW1lbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBmaWxsZXJQb3NpdGlvbk9mZnNldCA9IHZpZXdFbGVtZW50LmdldEZpbGxlck9mZnNldCAmJiB2aWV3RWxlbWVudC5nZXRGaWxsZXJPZmZzZXQoKTtcbiAgICAgICAgbGV0IG9mZnNldCA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGRWaWV3IG9mIHZpZXdFbGVtZW50LmdldENoaWxkcmVuKCkpe1xuICAgICAgICAgICAgaWYgKGZpbGxlclBvc2l0aW9uT2Zmc2V0ID09PSBvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLl9nZXRCbG9ja0ZpbGxlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdHJhbnNwYXJlbnRSZW5kZXJpbmcgPSBjaGlsZFZpZXcuaXMoJ2VsZW1lbnQnKSAmJiAhIWNoaWxkVmlldy5nZXRDdXN0b21Qcm9wZXJ0eSgnZGF0YVBpcGVsaW5lOnRyYW5zcGFyZW50UmVuZGVyaW5nJykgJiYgIWZpcnN0KGNoaWxkVmlldy5nZXRBdHRyaWJ1dGVzKCkpO1xuICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50UmVuZGVyaW5nICYmIHRoaXMucmVuZGVyaW5nTW9kZSA9PSAnZGF0YScpIHtcbiAgICAgICAgICAgICAgICAvLyBgUmF3RWxlbWVudGAgZG9lc24ndCBoYXZlICNjaGlsZHJlbiBkZWZpbmVkLCBzbyB0aGV5IG5lZWQgdG8gYmUgdGVtcG9yYXJpbHkgcmVuZGVyZWRcbiAgICAgICAgICAgICAgICAvLyBhbmQgZXh0cmFjdGVkIGRpcmVjdGx5LlxuICAgICAgICAgICAgICAgIGlmIChjaGlsZFZpZXcuaXMoJ3Jhd0VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wRWxlbWVudCA9IHRoaXMuX2RvbURvY3VtZW50LmNyZWF0ZUVsZW1lbnQoY2hpbGRWaWV3Lm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBjaGlsZFZpZXcucmVuZGVyKHRlbXBFbGVtZW50LCB0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQqIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRlbXBFbGVtZW50LmNoaWxkTm9kZXNcbiAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCogdGhpcy52aWV3Q2hpbGRyZW5Ub0RvbShjaGlsZFZpZXcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50UmVuZGVyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHRcdCAqIFRoZSBgZGF0YVBpcGVsaW5lOnRyYW5zcGFyZW50UmVuZGVyaW5nYCBmbGFnIGlzIHN1cHBvcnRlZCBvbmx5IGluIHRoZSBkYXRhIHBpcGVsaW5lLlxuXHRcdFx0XHRcdCAqXG5cdFx0XHRcdFx0ICogQGVycm9yIGRvbWNvbnZlcnRlci10cmFuc3BhcmVudC1yZW5kZXJpbmctdW5zdXBwb3J0ZWQtaW4tZWRpdGluZy1waXBlbGluZVxuXHRcdFx0XHRcdCAqLyBsb2dXYXJuaW5nKCdkb21jb252ZXJ0ZXItdHJhbnNwYXJlbnQtcmVuZGVyaW5nLXVuc3VwcG9ydGVkLWluLWVkaXRpbmctcGlwZWxpbmUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3RWxlbWVudDogY2hpbGRWaWV3XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLnZpZXdUb0RvbShjaGlsZFZpZXcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbGxlclBvc2l0aW9uT2Zmc2V0ID09PSBvZmZzZXQpIHtcbiAgICAgICAgICAgIHlpZWxkIHRoaXMuX2dldEJsb2NrRmlsbGVyKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHZpZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZX0gdG8gRE9NIHJhbmdlLlxuXHQgKiBJbmxpbmUgYW5kIGJsb2NrIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcnN9IGFyZSBoYW5kbGVkIGR1cmluZyB0aGUgY29udmVyc2lvbi5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdSYW5nZSBWaWV3IHJhbmdlLlxuXHQgKiBAcmV0dXJucyBET00gcmFuZ2UuXG5cdCAqLyB2aWV3UmFuZ2VUb0RvbSh2aWV3UmFuZ2UpIHtcbiAgICAgICAgY29uc3QgZG9tU3RhcnQgPSB0aGlzLnZpZXdQb3NpdGlvblRvRG9tKHZpZXdSYW5nZS5zdGFydCk7XG4gICAgICAgIGNvbnN0IGRvbUVuZCA9IHRoaXMudmlld1Bvc2l0aW9uVG9Eb20odmlld1JhbmdlLmVuZCk7XG4gICAgICAgIGNvbnN0IGRvbVJhbmdlID0gdGhpcy5fZG9tRG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgZG9tUmFuZ2Uuc2V0U3RhcnQoZG9tU3RhcnQucGFyZW50LCBkb21TdGFydC5vZmZzZXQpO1xuICAgICAgICBkb21SYW5nZS5zZXRFbmQoZG9tRW5kLnBhcmVudCwgZG9tRW5kLm9mZnNldCk7XG4gICAgICAgIHJldHVybiBkb21SYW5nZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHZpZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0gdG8gRE9NIHBhcmVudCBhbmQgb2Zmc2V0LlxuXHQgKlxuXHQgKiBJbmxpbmUgYW5kIGJsb2NrIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcnN9IGFyZSBoYW5kbGVkIGR1cmluZyB0aGUgY29udmVyc2lvbi5cblx0ICogSWYgdGhlIGNvbnZlcnRlZCBwb3NpdGlvbiBpcyBkaXJlY3RseSBiZWZvcmUgaW5saW5lIGZpbGxlciBpdCBpcyBtb3ZlZCBpbnNpZGUgdGhlIGZpbGxlci5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdQb3NpdGlvbiBWaWV3IHBvc2l0aW9uLlxuXHQgKiBAcmV0dXJucyBET00gcG9zaXRpb24gb3IgYG51bGxgIGlmIHZpZXcgcG9zaXRpb24gY291bGQgbm90IGJlIGNvbnZlcnRlZCB0byBET00uXG5cdCAqIERPTSBwb3NpdGlvbiBoYXMgdHdvIHByb3BlcnRpZXM6XG5cdCAqICogYHBhcmVudGAgLSBET00gcG9zaXRpb24gcGFyZW50LlxuXHQgKiAqIGBvZmZzZXRgIC0gRE9NIHBvc2l0aW9uIG9mZnNldC5cblx0ICovIHZpZXdQb3NpdGlvblRvRG9tKHZpZXdQb3NpdGlvbikge1xuICAgICAgICBjb25zdCB2aWV3UGFyZW50ID0gdmlld1Bvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgaWYgKHZpZXdQYXJlbnQuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIGNvbnN0IGRvbVBhcmVudCA9IHRoaXMuZmluZENvcnJlc3BvbmRpbmdEb21UZXh0KHZpZXdQYXJlbnQpO1xuICAgICAgICAgICAgaWYgKCFkb21QYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBQb3NpdGlvbiBpcyBpbiBhIHZpZXcgdGV4dCBub2RlIHRoYXQgaGFzIG5vdCBiZWVuIHJlbmRlcmVkIHRvIERPTSB5ZXQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb2Zmc2V0ID0gdmlld1Bvc2l0aW9uLm9mZnNldDtcbiAgICAgICAgICAgIGlmIChzdGFydHNXaXRoRmlsbGVyKGRvbVBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gSU5MSU5FX0ZJTExFUl9MRU5HVEg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHBhcmVudDogZG9tUGFyZW50LFxuICAgICAgICAgICAgICAgIG9mZnNldFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHZpZXdQYXJlbnQgaXMgaW5zdGFuY2Ugb2YgVmlld0VsZW1lbnQuXG4gICAgICAgICAgICBsZXQgZG9tUGFyZW50LCBkb21CZWZvcmUsIGRvbUFmdGVyO1xuICAgICAgICAgICAgaWYgKHZpZXdQb3NpdGlvbi5vZmZzZXQgPT09IDApIHtcbiAgICAgICAgICAgICAgICBkb21QYXJlbnQgPSB0aGlzLm1hcFZpZXdUb0RvbSh2aWV3UGFyZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoIWRvbVBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBQb3NpdGlvbiBpcyBpbiBhIHZpZXcgZWxlbWVudCB0aGF0IGhhcyBub3QgYmVlbiByZW5kZXJlZCB0byBET00geWV0LlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZG9tQWZ0ZXIgPSBkb21QYXJlbnQuY2hpbGROb2Rlc1swXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZUJlZm9yZSA9IHZpZXdQb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgICAgICAgICAgICAgIGRvbUJlZm9yZSA9IG5vZGVCZWZvcmUuaXMoJyR0ZXh0JykgPyB0aGlzLmZpbmRDb3JyZXNwb25kaW5nRG9tVGV4dChub2RlQmVmb3JlKSA6IHRoaXMubWFwVmlld1RvRG9tKG5vZGVCZWZvcmUpO1xuICAgICAgICAgICAgICAgIGlmICghZG9tQmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uIGlzIGFmdGVyIGEgdmlldyBlbGVtZW50IHRoYXQgaGFzIG5vdCBiZWVuIHJlbmRlcmVkIHRvIERPTSB5ZXQuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkb21QYXJlbnQgPSBkb21CZWZvcmUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICBkb21BZnRlciA9IGRvbUJlZm9yZS5uZXh0U2libGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGlubGluZSBmaWxsZXIgYXQgcG9zaXRpb24gcmV0dXJuIHBvc2l0aW9uIGluc2lkZSB0aGUgZmlsbGVyLiBXZSBzaG91bGQgbmV2ZXIgcmV0dXJuXG4gICAgICAgICAgICAvLyB0aGUgcG9zaXRpb24gYmVmb3JlIHRoZSBpbmxpbmUgZmlsbGVyLlxuICAgICAgICAgICAgaWYgKGlzVGV4dChkb21BZnRlcikgJiYgc3RhcnRzV2l0aEZpbGxlcihkb21BZnRlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IGRvbUFmdGVyLFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IElOTElORV9GSUxMRVJfTEVOR1RIXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGRvbUJlZm9yZSA/IGluZGV4T2YoZG9tQmVmb3JlKSArIDEgOiAwO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IGRvbVBhcmVudCxcbiAgICAgICAgICAgICAgICBvZmZzZXRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIERPTSB0byB2aWV3LiBGb3IgYWxsIHRleHQgbm9kZXMsIG5vdCBib3VuZCBlbGVtZW50cyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIG5ldyBpdGVtcyB3aWxsXG5cdCAqIGJlIGNyZWF0ZWQuIEZvciBib3VuZCBlbGVtZW50cyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGNvcnJlc3BvbmRpbmcgaXRlbXMuIEZvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlciBmaWxsZXJzfSBgbnVsbGAgd2lsbCBiZSByZXR1cm5lZC5cblx0ICogRm9yIGFsbCBET00gZWxlbWVudHMgcmVuZGVyZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fSB0aGF0IFVJRWxlbWVudCB3aWxsIGJlIHJldHVybmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tTm9kZSBET00gbm9kZSBvciBkb2N1bWVudCBmcmFnbWVudCB0byB0cmFuc2Zvcm0uXG5cdCAqIEBwYXJhbSBvcHRpb25zIENvbnZlcnNpb24gb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuYmluZCBEZXRlcm1pbmVzIHdoZXRoZXIgbmV3IGVsZW1lbnRzIHdpbGwgYmUgYm91bmQuIEZhbHNlIGJ5IGRlZmF1bHQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLndpdGhDaGlsZHJlbiBJZiBgdHJ1ZWAsIG5vZGUncyBhbmQgZG9jdW1lbnQgZnJhZ21lbnQncyBjaGlsZHJlbiB3aWxsIGJlIGNvbnZlcnRlZCB0b28uIFRydWUgYnkgZGVmYXVsdC5cblx0ICogQHBhcmFtIG9wdGlvbnMua2VlcE9yaWdpbmFsQ2FzZSBJZiBgZmFsc2VgLCBub2RlJ3MgdGFnIG5hbWUgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gbG93ZXIgY2FzZS4gRmFsc2UgYnkgZGVmYXVsdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuc2tpcENvbW1lbnRzIElmIGBmYWxzZWAsIGNvbW1lbnQgbm9kZXMgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYCRjb21tZW50YFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgdmlldyBVSSBlbGVtZW50c30uIEZhbHNlIGJ5IGRlZmF1bHQuXG5cdCAqIEByZXR1cm5zIENvbnZlcnRlZCBub2RlIG9yIGRvY3VtZW50IGZyYWdtZW50IG9yIGBudWxsYCBpZiBET00gbm9kZSBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcn1cblx0ICogb3IgdGhlIGdpdmVuIG5vZGUgaXMgYW4gZW1wdHkgdGV4dCBub2RlLlxuXHQgKi8gZG9tVG9WaWV3KGRvbU5vZGUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBpbmxpbmVOb2RlcyA9IFtdO1xuICAgICAgICBjb25zdCBnZW5lcmF0b3IgPSB0aGlzLl9kb21Ub1ZpZXcoZG9tTm9kZSwgb3B0aW9ucywgaW5saW5lTm9kZXMpO1xuICAgICAgICAvLyBHZXQgdGhlIGZpcnN0IHlpZWxkZWQgdmFsdWUgb3IgYSByZXR1cm5lZCB2YWx1ZS5cbiAgICAgICAgY29uc3Qgbm9kZSA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7XG4gICAgICAgIGlmICghbm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVHJpZ2dlciBjaGlsZHJlbiBoYW5kbGluZy5cbiAgICAgICAgZ2VuZXJhdG9yLm5leHQoKTtcbiAgICAgICAgLy8gV2hpdGVzcGFjZSBjbGVhbmluZy5cbiAgICAgICAgdGhpcy5fcHJvY2Vzc0RvbUlubGluZU5vZGVzKG51bGwsIGlubGluZU5vZGVzLCBvcHRpb25zKTtcbiAgICAgICAgLy8gVGhpcyB3YXMgYSBzaW5nbGUgYmxvY2sgZmlsbGVyIHNvIGp1c3QgcmVtb3ZlIGl0LlxuICAgICAgICBpZiAodGhpcy5ibG9ja0ZpbGxlck1vZGUgPT0gJ2JyJyAmJiBpc1ZpZXdCckZpbGxlcihub2RlKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGV4dCBub3QgZ290IHRyaW1tZWQgdG8gYW4gZW1wdHkgc3RyaW5nIHNvIHRoZXJlIGlzIG5vIHJlc3VsdCBub2RlLlxuICAgICAgICBpZiAobm9kZS5pcygnJHRleHQnKSAmJiBub2RlLmRhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgY2hpbGRyZW4gb2YgdGhlIERPTSBlbGVtZW50IHRvIHZpZXcgbm9kZXMgdXNpbmdcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNkb21Ub1ZpZXd9IG1ldGhvZC5cblx0ICogQWRkaXRpb25hbGx5IHRoaXMgbWV0aG9kIG9taXRzIGJsb2NrIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcn0sIGlmIGl0IGV4aXN0cyBpbiB0aGUgRE9NIHBhcmVudC5cblx0ICpcblx0ICogQHBhcmFtIGRvbUVsZW1lbnQgUGFyZW50IERPTSBlbGVtZW50LlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2RvbVRvVmlld30gb3B0aW9ucyBwYXJhbWV0ZXIuXG5cdCAqIEBwYXJhbSBpbmxpbmVOb2RlcyBBbiBhcnJheSB0aGF0IHdpbGwgYmUgcG9wdWxhdGVkIHdpdGggaW5saW5lIG5vZGVzLiBJdCdzIHVzZWQgaW50ZXJuYWxseSBmb3Igd2hpdGVzcGFjZSBwcm9jZXNzaW5nLlxuXHQgKiBAcmV0dXJucyBWaWV3IG5vZGVzLlxuXHQgKi8gKmRvbUNoaWxkcmVuVG9WaWV3KGRvbUVsZW1lbnQsIG9wdGlvbnMgPSB7fSwgaW5saW5lTm9kZXMgPSBbXSkge1xuICAgICAgICAvLyBHZXQgY2hpbGQgbm9kZXMgZnJvbSBjb250ZW50IGRvY3VtZW50IGZyYWdtZW50IGlmIGVsZW1lbnQgaXMgdGVtcGxhdGVcbiAgICAgICAgbGV0IGNoaWxkTm9kZXMgPSBbXTtcbiAgICAgICAgaWYgKGRvbUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MVGVtcGxhdGVFbGVtZW50KSB7XG4gICAgICAgICAgICBjaGlsZE5vZGVzID0gW1xuICAgICAgICAgICAgICAgIC4uLmRvbUVsZW1lbnQuY29udGVudC5jaGlsZE5vZGVzXG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2hpbGROb2RlcyA9IFtcbiAgICAgICAgICAgICAgICAuLi5kb21FbGVtZW50LmNoaWxkTm9kZXNcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGNoaWxkTm9kZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgY29uc3QgZG9tQ2hpbGQgPSBjaGlsZE5vZGVzW2ldO1xuICAgICAgICAgICAgY29uc3QgZ2VuZXJhdG9yID0gdGhpcy5fZG9tVG9WaWV3KGRvbUNoaWxkLCBvcHRpb25zLCBpbmxpbmVOb2Rlcyk7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGZpcnN0IHlpZWxkZWQgdmFsdWUgb3IgYSByZXR1cm5lZCB2YWx1ZS5cbiAgICAgICAgICAgIGNvbnN0IHZpZXdDaGlsZCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7XG4gICAgICAgICAgICBpZiAodmlld0NoaWxkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gV2hpdGVzcGFjZSBjbGVhbmluZyBiZWZvcmUgZW50ZXJpbmcgYSBibG9jayBlbGVtZW50IChiZXR3ZWVuIGJsb2NrIGVsZW1lbnRzKS5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNCbG9ja1ZpZXdFbGVtZW50KHZpZXdDaGlsZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc0RvbUlubGluZU5vZGVzKGRvbUVsZW1lbnQsIGlubGluZU5vZGVzLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gWWllbGQgb25seSBpZiB0aGlzIGlzIG5vdCBhIGJsb2NrIGZpbGxlci5cbiAgICAgICAgICAgICAgICBpZiAoISh0aGlzLmJsb2NrRmlsbGVyTW9kZSA9PSAnYnInICYmIGlzVmlld0JyRmlsbGVyKHZpZXdDaGlsZCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHZpZXdDaGlsZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVHJpZ2dlciBjaGlsZHJlbiBoYW5kbGluZy5cbiAgICAgICAgICAgICAgICBnZW5lcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFdoaXRlc3BhY2UgY2xlYW5pbmcgYmVmb3JlIGxlYXZpbmcgYSBibG9jayBlbGVtZW50IChjb250ZW50IG9mIGJsb2NrIGVsZW1lbnQpLlxuICAgICAgICB0aGlzLl9wcm9jZXNzRG9tSW5saW5lTm9kZXMoZG9tRWxlbWVudCwgaW5saW5lTm9kZXMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgRE9NIHNlbGVjdGlvbiB0byB2aWV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbn0uXG5cdCAqIFJhbmdlcyB3aGljaCBjYW5ub3QgYmUgY29udmVydGVkIHdpbGwgYmUgb21pdHRlZC5cblx0ICpcblx0ICogQHBhcmFtIGRvbVNlbGVjdGlvbiBET00gc2VsZWN0aW9uLlxuXHQgKiBAcmV0dXJucyBWaWV3IHNlbGVjdGlvbi5cblx0ICovIGRvbVNlbGVjdGlvblRvVmlldyhkb21TZWxlY3Rpb24pIHtcbiAgICAgICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy85NjM1LlxuICAgICAgICBpZiAoaXNHZWNrb1Jlc3RyaWN0ZWREb21TZWxlY3Rpb24oZG9tU2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24kMShbXSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRE9NIHNlbGVjdGlvbiBtaWdodCBiZSBwbGFjZWQgaW4gZmFrZSBzZWxlY3Rpb24gY29udGFpbmVyLlxuICAgICAgICAvLyBJZiBjb250YWluZXIgY29udGFpbnMgZmFrZSBzZWxlY3Rpb24gLSByZXR1cm4gY29ycmVzcG9uZGluZyB2aWV3IHNlbGVjdGlvbi5cbiAgICAgICAgaWYgKGRvbVNlbGVjdGlvbi5yYW5nZUNvdW50ID09PSAxKSB7XG4gICAgICAgICAgICBsZXQgY29udGFpbmVyID0gZG9tU2VsZWN0aW9uLmdldFJhbmdlQXQoMCkuc3RhcnRDb250YWluZXI7XG4gICAgICAgICAgICAvLyBUaGUgRE9NIHNlbGVjdGlvbiBtaWdodCBiZSBtb3ZlZCB0byB0aGUgdGV4dCBub2RlIGluc2lkZSB0aGUgZmFrZSBzZWxlY3Rpb24gY29udGFpbmVyLlxuICAgICAgICAgICAgaWYgKGlzVGV4dChjb250YWluZXIpKSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudE5vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2aWV3U2VsZWN0aW9uID0gdGhpcy5mYWtlU2VsZWN0aW9uVG9WaWV3KGNvbnRhaW5lcik7XG4gICAgICAgICAgICBpZiAodmlld1NlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3U2VsZWN0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzQmFja3dhcmQgPSB0aGlzLmlzRG9tU2VsZWN0aW9uQmFja3dhcmQoZG9tU2VsZWN0aW9uKTtcbiAgICAgICAgY29uc3Qgdmlld1JhbmdlcyA9IFtdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZG9tU2VsZWN0aW9uLnJhbmdlQ291bnQ7IGkrKyl7XG4gICAgICAgICAgICAvLyBET00gUmFuZ2UgaGF2ZSBjb3JyZWN0IHN0YXJ0IGFuZCBlbmQsIG5vIG1hdHRlciB3aGF0IGlzIHRoZSBET00gU2VsZWN0aW9uIGRpcmVjdGlvbi4gU28gd2UgZG9uJ3QgaGF2ZSB0byBmaXggYW55dGhpbmcuXG4gICAgICAgICAgICBjb25zdCBkb21SYW5nZSA9IGRvbVNlbGVjdGlvbi5nZXRSYW5nZUF0KGkpO1xuICAgICAgICAgICAgY29uc3Qgdmlld1JhbmdlID0gdGhpcy5kb21SYW5nZVRvVmlldyhkb21SYW5nZSk7XG4gICAgICAgICAgICBpZiAodmlld1JhbmdlKSB7XG4gICAgICAgICAgICAgICAgdmlld1Jhbmdlcy5wdXNoKHZpZXdSYW5nZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24kMSh2aWV3UmFuZ2VzLCB7XG4gICAgICAgICAgICBiYWNrd2FyZDogaXNCYWNrd2FyZFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIERPTSBSYW5nZSB0byB2aWV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2V9LlxuXHQgKiBJZiB0aGUgc3RhcnQgb3IgZW5kIHBvc2l0aW9uIGNhbiBub3QgYmUgY29udmVydGVkIGBudWxsYCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogQHBhcmFtIGRvbVJhbmdlIERPTSByYW5nZS5cblx0ICogQHJldHVybnMgVmlldyByYW5nZS5cblx0ICovIGRvbVJhbmdlVG9WaWV3KGRvbVJhbmdlKSB7XG4gICAgICAgIGNvbnN0IHZpZXdTdGFydCA9IHRoaXMuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tUmFuZ2Uuc3RhcnRDb250YWluZXIsIGRvbVJhbmdlLnN0YXJ0T2Zmc2V0KTtcbiAgICAgICAgY29uc3Qgdmlld0VuZCA9IHRoaXMuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tUmFuZ2UuZW5kQ29udGFpbmVyLCBkb21SYW5nZS5lbmRPZmZzZXQpO1xuICAgICAgICBpZiAodmlld1N0YXJ0ICYmIHZpZXdFbmQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMSh2aWV3U3RhcnQsIHZpZXdFbmQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgRE9NIHBhcmVudCBhbmQgb2Zmc2V0IHRvIHZpZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9wb3NpdGlvbn5Qb3NpdGlvbn0uXG5cdCAqXG5cdCAqIElmIHRoZSBwb3NpdGlvbiBpcyBpbnNpZGUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2ZpbGxlciBmaWxsZXJ9IHdoaWNoIGhhcyBubyBjb3JyZXNwb25kaW5nIHZpZXcgbm9kZSxcblx0ICogcG9zaXRpb24gb2YgdGhlIGZpbGxlciB3aWxsIGJlIGNvbnZlcnRlZCBhbmQgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIElmIHRoZSBwb3NpdGlvbiBpcyBpbnNpZGUgRE9NIGVsZW1lbnQgcmVuZGVyZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fVxuXHQgKiB0aGF0IHBvc2l0aW9uIHdpbGwgYmUgY29udmVydGVkIHRvIHZpZXcgcG9zaXRpb24gYmVmb3JlIHRoYXQgVUlFbGVtZW50LlxuXHQgKlxuXHQgKiBJZiBzdHJ1Y3R1cmVzIGFyZSB0b28gZGlmZmVyZW50IGFuZCBpdCBpcyBub3QgcG9zc2libGUgdG8gZmluZCBjb3JyZXNwb25kaW5nIHBvc2l0aW9uIHRoZW4gYG51bGxgIHdpbGwgYmUgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21QYXJlbnQgRE9NIHBvc2l0aW9uIHBhcmVudC5cblx0ICogQHBhcmFtIGRvbU9mZnNldCBET00gcG9zaXRpb24gb2Zmc2V0LiBZb3UgY2FuIHNraXAgaXQgd2hlbiBjb252ZXJ0aW5nIHRoZSBpbmxpbmUgZmlsbGVyIG5vZGUuXG5cdCAqIEByZXR1cm5zIFZpZXcgcG9zaXRpb24uXG5cdCAqLyBkb21Qb3NpdGlvblRvVmlldyhkb21QYXJlbnQsIGRvbU9mZnNldCA9IDApIHtcbiAgICAgICAgaWYgKHRoaXMuaXNCbG9ja0ZpbGxlcihkb21QYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kb21Qb3NpdGlvblRvVmlldyhkb21QYXJlbnQucGFyZW50Tm9kZSwgaW5kZXhPZihkb21QYXJlbnQpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBwb3NpdGlvbiBpcyBzb21ld2hlcmUgaW5zaWRlIFVJRWxlbWVudCBvciBhIFJhd0VsZW1lbnQgLSByZXR1cm4gcG9zaXRpb24gYmVmb3JlIHRoYXQgZWxlbWVudC5cbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSB0aGlzLm1hcERvbVRvVmlldyhkb21QYXJlbnQpO1xuICAgICAgICBpZiAodmlld0VsZW1lbnQgJiYgKHZpZXdFbGVtZW50LmlzKCd1aUVsZW1lbnQnKSB8fCB2aWV3RWxlbWVudC5pcygncmF3RWxlbWVudCcpKSkge1xuICAgICAgICAgICAgcmV0dXJuIFBvc2l0aW9uJDEuX2NyZWF0ZUJlZm9yZSh2aWV3RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzVGV4dChkb21QYXJlbnQpKSB7XG4gICAgICAgICAgICBpZiAoaXNJbmxpbmVGaWxsZXIoZG9tUGFyZW50KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRvbVBvc2l0aW9uVG9WaWV3KGRvbVBhcmVudC5wYXJlbnROb2RlLCBpbmRleE9mKGRvbVBhcmVudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgdmlld1BhcmVudCA9IHRoaXMuZmluZENvcnJlc3BvbmRpbmdWaWV3VGV4dChkb21QYXJlbnQpO1xuICAgICAgICAgICAgbGV0IG9mZnNldCA9IGRvbU9mZnNldDtcbiAgICAgICAgICAgIGlmICghdmlld1BhcmVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0YXJ0c1dpdGhGaWxsZXIoZG9tUGFyZW50KSkge1xuICAgICAgICAgICAgICAgIG9mZnNldCAtPSBJTkxJTkVfRklMTEVSX0xFTkdUSDtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPCAwID8gMCA6IG9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24kMSh2aWV3UGFyZW50LCBvZmZzZXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGRvbU9mZnNldCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdQYXJlbnQgPSB0aGlzLm1hcERvbVRvVmlldyhkb21QYXJlbnQpO1xuICAgICAgICAgICAgICAgIGlmICh2aWV3UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24kMSh2aWV3UGFyZW50LCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvbUJlZm9yZSA9IGRvbVBhcmVudC5jaGlsZE5vZGVzW2RvbU9mZnNldCAtIDFdO1xuICAgICAgICAgICAgICAgIC8vIEp1bXAgb3ZlciBhbiBpbmxpbmUgZmlsbGVyIChhbmQgYWxzbyBvbiBGaXJlZm94IGp1bXAgb3ZlciBhIGJsb2NrIGZpbGxlciB3aGlsZSBwcmVzc2luZyBiYWNrc3BhY2UgaW4gYW4gZW1wdHkgcGFyYWdyYXBoKS5cbiAgICAgICAgICAgICAgICBpZiAoaXNUZXh0KGRvbUJlZm9yZSkgJiYgaXNJbmxpbmVGaWxsZXIoZG9tQmVmb3JlKSB8fCBkb21CZWZvcmUgJiYgdGhpcy5pc0Jsb2NrRmlsbGVyKGRvbUJlZm9yZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tUG9zaXRpb25Ub1ZpZXcoZG9tQmVmb3JlLnBhcmVudE5vZGUsIGluZGV4T2YoZG9tQmVmb3JlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdCZWZvcmUgPSBpc1RleHQoZG9tQmVmb3JlKSA/IHRoaXMuZmluZENvcnJlc3BvbmRpbmdWaWV3VGV4dChkb21CZWZvcmUpIDogdGhpcy5tYXBEb21Ub1ZpZXcoZG9tQmVmb3JlKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPICM2NjNcbiAgICAgICAgICAgICAgICBpZiAodmlld0JlZm9yZSAmJiB2aWV3QmVmb3JlLnBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEodmlld0JlZm9yZS5wYXJlbnQsIHZpZXdCZWZvcmUuaW5kZXggKyAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjb3JyZXNwb25kaW5nIHZpZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgRWxlbWVudH0gb3Jcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9IGZvciBwcm92aWRlZCBET00gZWxlbWVudCBvclxuXHQgKiBkb2N1bWVudCBmcmFnbWVudC4gSWYgdGhlcmUgaXMgbm8gdmlldyBpdGVtIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNiaW5kRWxlbWVudHMgYm91bmR9XG5cdCAqIHRvIHRoZSBnaXZlbiBET00gLSBgdW5kZWZpbmVkYCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogRm9yIGFsbCBET00gZWxlbWVudHMgcmVuZGVyZWQgYnkgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9IG9yXG5cdCAqIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYXdlbGVtZW50flJhd0VsZW1lbnR9LCB0aGUgcGFyZW50IGBVSUVsZW1lbnRgIG9yIGBSYXdFbGVtZW50YCB3aWxsIGJlIHJldHVybmVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tRWxlbWVudE9yRG9jdW1lbnRGcmFnbWVudCBET00gZWxlbWVudCBvciBkb2N1bWVudCBmcmFnbWVudC5cblx0ICogQHJldHVybnMgQ29ycmVzcG9uZGluZyB2aWV3IGVsZW1lbnQsIGRvY3VtZW50IGZyYWdtZW50IG9yIGB1bmRlZmluZWRgIGlmIG5vIGVsZW1lbnQgd2FzIGJvdW5kLlxuXHQgKi8gbWFwRG9tVG9WaWV3KGRvbUVsZW1lbnRPckRvY3VtZW50RnJhZ21lbnQpIHtcbiAgICAgICAgY29uc3QgaG9zdEVsZW1lbnQgPSB0aGlzLmdldEhvc3RWaWV3RWxlbWVudChkb21FbGVtZW50T3JEb2N1bWVudEZyYWdtZW50KTtcbiAgICAgICAgcmV0dXJuIGhvc3RFbGVtZW50IHx8IHRoaXMuX2RvbVRvVmlld01hcHBpbmcuZ2V0KGRvbUVsZW1lbnRPckRvY3VtZW50RnJhZ21lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogRmluZHMgY29ycmVzcG9uZGluZyB0ZXh0IG5vZGUuIFRleHQgbm9kZXMgYXJlIG5vdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjYmluZEVsZW1lbnRzIGJvdW5kfSxcblx0ICogY29ycmVzcG9uZGluZyB0ZXh0IG5vZGUgaXMgcmV0dXJuZWQgYmFzZWQgb24gdGhlIHNpYmxpbmcgb3IgcGFyZW50LlxuXHQgKlxuXHQgKiBJZiB0aGUgZGlyZWN0bHkgcHJldmlvdXMgc2libGluZyBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNiaW5kRWxlbWVudHMgYm91bmR9IGVsZW1lbnQsIGl0IGlzIHVzZWRcblx0ICogdG8gZmluZCB0aGUgY29ycmVzcG9uZGluZyB0ZXh0IG5vZGUuXG5cdCAqXG5cdCAqIElmIHRoaXMgaXMgYSBmaXJzdCBjaGlsZCBpbiB0aGUgcGFyZW50IGFuZCB0aGUgcGFyZW50IGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2JpbmRFbGVtZW50cyBib3VuZH1cblx0ICogZWxlbWVudCwgaXQgaXMgdXNlZCB0byBmaW5kIHRoZSBjb3JyZXNwb25kaW5nIHRleHQgbm9kZS5cblx0ICpcblx0ICogRm9yIGFsbCB0ZXh0IG5vZGVzIHJlbmRlcmVkIGJ5IGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50fSBvclxuXHQgKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50fSwgdGhlIHBhcmVudCBgVUlFbGVtZW50YCBvciBgUmF3RWxlbWVudGAgd2lsbCBiZSByZXR1cm5lZC5cblx0ICpcblx0ICogT3RoZXJ3aXNlIGBudWxsYCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogTm90ZSB0aGF0IGZvciB0aGUgYmxvY2sgb3IgaW5saW5lIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZmlsbGVyIGZpbGxlcn0gdGhpcyBtZXRob2QgcmV0dXJucyBgbnVsbGAuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21UZXh0IERPTSB0ZXh0IG5vZGUuXG5cdCAqIEByZXR1cm5zIENvcnJlc3BvbmRpbmcgdmlldyB0ZXh0IG5vZGUgb3IgYG51bGxgLCBpZiBpdCB3YXMgbm90IHBvc3NpYmxlIHRvIGZpbmQgYSBjb3JyZXNwb25kaW5nIG5vZGUuXG5cdCAqLyBmaW5kQ29ycmVzcG9uZGluZ1ZpZXdUZXh0KGRvbVRleHQpIHtcbiAgICAgICAgaWYgKGlzSW5saW5lRmlsbGVyKGRvbVRleHQpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBET00gdGV4dCB3YXMgcmVuZGVyZWQgYnkgYSBVSUVsZW1lbnQgb3IgYSBSYXdFbGVtZW50IC0gcmV0dXJuIHRoaXMgcGFyZW50IGVsZW1lbnQuXG4gICAgICAgIGNvbnN0IGhvc3RFbGVtZW50ID0gdGhpcy5nZXRIb3N0Vmlld0VsZW1lbnQoZG9tVGV4dCk7XG4gICAgICAgIGlmIChob3N0RWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGhvc3RFbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IGRvbVRleHQucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAvLyBUcnkgdG8gdXNlIHByZXZpb3VzIHNpYmxpbmcgdG8gZmluZCB0aGUgY29ycmVzcG9uZGluZyB0ZXh0IG5vZGUuXG4gICAgICAgIGlmIChwcmV2aW91c1NpYmxpbmcpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc0VsZW1lbnQocHJldmlvdXNTaWJsaW5nKSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBwcmV2aW91cyBpcyB0ZXh0IG9yIGNvbW1lbnQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHRoaXMubWFwRG9tVG9WaWV3KHByZXZpb3VzU2libGluZyk7XG4gICAgICAgICAgICBpZiAodmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0U2libGluZyA9IHZpZXdFbGVtZW50Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICAgIC8vIEl0IG1pZ2h0IGJlIGZpbGxlciB3aGljaCBoYXMgbm8gY29ycmVzcG9uZGluZyB2aWV3IG5vZGUuXG4gICAgICAgICAgICAgICAgaWYgKG5leHRTaWJsaW5nIGluc3RhbmNlb2YgVGV4dCQxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0U2libGluZztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHRoaXMubWFwRG9tVG9WaWV3KGRvbVRleHQucGFyZW50Tm9kZSk7XG4gICAgICAgICAgICBpZiAodmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkID0gdmlld0VsZW1lbnQuZ2V0Q2hpbGQoMCk7XG4gICAgICAgICAgICAgICAgLy8gSXQgbWlnaHQgYmUgZmlsbGVyIHdoaWNoIGhhcyBubyBjb3JyZXNwb25kaW5nIHZpZXcgbm9kZS5cbiAgICAgICAgICAgICAgICBpZiAoZmlyc3RDaGlsZCBpbnN0YW5jZW9mIFRleHQkMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmlyc3RDaGlsZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIG1hcFZpZXdUb0RvbShkb2N1bWVudEZyYWdtZW50T3JFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92aWV3VG9Eb21NYXBwaW5nLmdldChkb2N1bWVudEZyYWdtZW50T3JFbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEZpbmRzIGNvcnJlc3BvbmRpbmcgdGV4dCBub2RlLiBUZXh0IG5vZGVzIGFyZSBub3Qge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2JpbmRFbGVtZW50cyBib3VuZH0sXG5cdCAqIGNvcnJlc3BvbmRpbmcgdGV4dCBub2RlIGlzIHJldHVybmVkIGJhc2VkIG9uIHRoZSBzaWJsaW5nIG9yIHBhcmVudC5cblx0ICpcblx0ICogSWYgdGhlIGRpcmVjdGx5IHByZXZpb3VzIHNpYmxpbmcgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjYmluZEVsZW1lbnRzIGJvdW5kfSBlbGVtZW50LCBpdCBpcyB1c2VkXG5cdCAqIHRvIGZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgdGV4dCBub2RlLlxuXHQgKlxuXHQgKiBJZiB0aGlzIGlzIGEgZmlyc3QgY2hpbGQgaW4gdGhlIHBhcmVudCBhbmQgdGhlIHBhcmVudCBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNiaW5kRWxlbWVudHMgYm91bmR9XG5cdCAqIGVsZW1lbnQsIGl0IGlzIHVzZWQgdG8gZmluZCB0aGUgY29ycmVzcG9uZGluZyB0ZXh0IG5vZGUuXG5cdCAqXG5cdCAqIE90aGVyd2lzZSBgbnVsbGAgaXMgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3VGV4dCBWaWV3IHRleHQgbm9kZS5cblx0ICogQHJldHVybnMgQ29ycmVzcG9uZGluZyBET00gdGV4dCBub2RlIG9yIGBudWxsYCwgaWYgaXQgd2FzIG5vdCBwb3NzaWJsZSB0byBmaW5kIGEgY29ycmVzcG9uZGluZyBub2RlLlxuXHQgKi8gZmluZENvcnJlc3BvbmRpbmdEb21UZXh0KHZpZXdUZXh0KSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IHZpZXdUZXh0LnByZXZpb3VzU2libGluZztcbiAgICAgICAgLy8gVHJ5IHRvIHVzZSBwcmV2aW91cyBzaWJsaW5nIHRvIGZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgdGV4dCBub2RlLlxuICAgICAgICBpZiAocHJldmlvdXNTaWJsaW5nICYmIHRoaXMubWFwVmlld1RvRG9tKHByZXZpb3VzU2libGluZykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcFZpZXdUb0RvbShwcmV2aW91c1NpYmxpbmcpLm5leHRTaWJsaW5nO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoaXMgaXMgYSBmaXJzdCBub2RlLCB0cnkgdG8gdXNlIHBhcmVudCB0byBmaW5kIHRoZSBjb3JyZXNwb25kaW5nIHRleHQgbm9kZS5cbiAgICAgICAgaWYgKCFwcmV2aW91c1NpYmxpbmcgJiYgdmlld1RleHQucGFyZW50ICYmIHRoaXMubWFwVmlld1RvRG9tKHZpZXdUZXh0LnBhcmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcFZpZXdUb0RvbSh2aWV3VGV4dC5wYXJlbnQpLmNoaWxkTm9kZXNbMF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb2N1c2VzIERPTSBlZGl0YWJsZSB0aGF0IGlzIGNvcnJlc3BvbmRpbmcgdG8gcHJvdmlkZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lZGl0YWJsZWVsZW1lbnR+RWRpdGFibGVFbGVtZW50fS5cblx0ICovIGZvY3VzKHZpZXdFZGl0YWJsZSkge1xuICAgICAgICBjb25zdCBkb21FZGl0YWJsZSA9IHRoaXMubWFwVmlld1RvRG9tKHZpZXdFZGl0YWJsZSk7XG4gICAgICAgIGlmIChkb21FZGl0YWJsZSAmJiBkb21FZGl0YWJsZS5vd25lckRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IGRvbUVkaXRhYmxlKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBzY3JvbGxYIGFuZCBzY3JvbGxZIHBvc2l0aW9ucyBiZWZvcmUgdGhlIGZvY3VzLlxuICAgICAgICAgICAgY29uc3QgeyBzY3JvbGxYLCBzY3JvbGxZIH0gPSBnbG9iYWwud2luZG93O1xuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsUG9zaXRpb25zID0gW107XG4gICAgICAgICAgICAvLyBTYXZlIGFsbCBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgdmFsdWVzIHN0YXJ0aW5nIGZyb20gZG9tRWRpdGFibGUgdXAgdG9cbiAgICAgICAgICAgIC8vIGRvY3VtZW50I2RvY3VtZW50RWxlbWVudC5cbiAgICAgICAgICAgIGZvckVhY2hEb21FbGVtZW50QW5jZXN0b3IoZG9tRWRpdGFibGUsIChub2RlKT0+e1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wIH0gPSBub2RlO1xuICAgICAgICAgICAgICAgIHNjcm9sbFBvc2l0aW9ucy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTGVmdCxcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRvbUVkaXRhYmxlLmZvY3VzKCk7XG4gICAgICAgICAgICAvLyBSZXN0b3JlIHNjcm9sbExlZnQgYW5kIHNjcm9sbFRvcCB2YWx1ZXMgc3RhcnRpbmcgZnJvbSBkb21FZGl0YWJsZSB1cCB0b1xuICAgICAgICAgICAgLy8gZG9jdW1lbnQjZG9jdW1lbnRFbGVtZW50LlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzk1MVxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzk1N1xuICAgICAgICAgICAgZm9yRWFjaERvbUVsZW1lbnRBbmNlc3Rvcihkb21FZGl0YWJsZSwgKG5vZGUpPT57XG4gICAgICAgICAgICAgICAgY29uc3QgW3Njcm9sbExlZnQsIHNjcm9sbFRvcF0gPSBzY3JvbGxQb3NpdGlvbnMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBub2RlLnNjcm9sbExlZnQgPSBzY3JvbGxMZWZ0O1xuICAgICAgICAgICAgICAgIG5vZGUuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBzY3JvbGxYIGFuZCBzY3JvbGxZIHBvc2l0aW9ucyBhZnRlciB0aGUgZm9jdXMuXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvOTUxXG4gICAgICAgICAgICBnbG9iYWwud2luZG93LnNjcm9sbFRvKHNjcm9sbFgsIHNjcm9sbFkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmUgRE9NIHNlbGVjdGlvbiBmcm9tIGJsdXJyZWQgZWRpdGFibGUsIHNvIGl0IHdvbid0IGludGVyZmVyZSB3aXRoIGNsaWNraW5nIG9uIGRyb3Bkb3ducyAoZXNwZWNpYWxseSBvbiBpT1MpLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9jbGVhckRvbVNlbGVjdGlvbigpIHtcbiAgICAgICAgY29uc3QgZG9tRWRpdGFibGUgPSB0aGlzLm1hcFZpZXdUb0RvbSh0aGlzLmRvY3VtZW50LnNlbGVjdGlvbi5lZGl0YWJsZUVsZW1lbnQpO1xuICAgICAgICBpZiAoIWRvbUVkaXRhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2sgaWYgRE9NIHNlbGVjdGlvbiBpcyBpbnNpZGUgZWRpdG9yIGVkaXRhYmxlIGVsZW1lbnQuXG4gICAgICAgIGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvbUVkaXRhYmxlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IG5ld1ZpZXdTZWxlY3Rpb24gPSB0aGlzLmRvbVNlbGVjdGlvblRvVmlldyhkb21TZWxlY3Rpb24pO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25JbkVkaXRhYmxlID0gbmV3Vmlld1NlbGVjdGlvbiAmJiBuZXdWaWV3U2VsZWN0aW9uLnJhbmdlQ291bnQgPiAwO1xuICAgICAgICBpZiAoc2VsZWN0aW9uSW5FZGl0YWJsZSkge1xuICAgICAgICAgICAgZG9tU2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIGBub2RlLm5vZGVUeXBlYCBlcXVhbHMgYE5vZGUuRUxFTUVOVF9OT0RFYC5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgTm9kZSB0byBjaGVjay5cblx0ICovIGlzRWxlbWVudChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlICYmIG5vZGUubm9kZVR5cGUgPT0gTm9kZS5FTEVNRU5UX05PREU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCB3aGVuIGBub2RlLm5vZGVUeXBlYCBlcXVhbHMgYE5vZGUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERWAuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIE5vZGUgdG8gY2hlY2suXG5cdCAqLyBpc0RvY3VtZW50RnJhZ21lbnQobm9kZSkge1xuICAgICAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5vZGVUeXBlID09IE5vZGUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgbm9kZSBpcyBhbiBpbnN0YW5jZSBvZiB0aGUgYmxvY2sgZmlsbGVyIGZvciB0aGlzIERPTSBjb252ZXJ0ZXIuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IGNvbnZlcnRlciA9IG5ldyBEb21Db252ZXJ0ZXIoIHZpZXdEb2N1bWVudCwgeyBibG9ja0ZpbGxlck1vZGU6ICdicicgfSApO1xuXHQgKlxuXHQgKiBjb252ZXJ0ZXIuaXNCbG9ja0ZpbGxlciggQlJfRklMTEVSKCBkb2N1bWVudCApICk7IC8vIHRydWVcblx0ICogY29udmVydGVyLmlzQmxvY2tGaWxsZXIoIE5CU1BfRklMTEVSKCBkb2N1bWVudCApICk7IC8vIGZhbHNlXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGU6Kio6IEZvciB0aGUgYCduYnNwJ2AgbW9kZSB0aGUgbWV0aG9kIGFsc28gY2hlY2tzIGNvbnRleHQgb2YgYSBub2RlIHNvIGl0IGNhbm5vdCBiZSBhIGRldGFjaGVkIG5vZGUuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBBIHNwZWNpYWwgY2FzZSBpbiB0aGUgYCduYnNwJ2AgbW9kZSBleGlzdHMgd2hlcmUgdGhlIGA8YnI+YCBpbiBgPHA+PGJyPjwvcD5gIGlzIHRyZWF0ZWQgYXMgYSBibG9jayBmaWxsZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21Ob2RlIERPTSBub2RlIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBUcnVlIGlmIGEgbm9kZSBpcyBjb25zaWRlcmVkIGEgYmxvY2sgZmlsbGVyIGZvciBnaXZlbiBtb2RlLlxuXHQgKi8gaXNCbG9ja0ZpbGxlcihkb21Ob2RlKSB7XG4gICAgICAgIGlmICh0aGlzLmJsb2NrRmlsbGVyTW9kZSA9PSAnYnInKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9tTm9kZS5pc0VxdWFsTm9kZShCUl9GSUxMRVJfUkVGKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIDxwPjxicj48L3A+IGluIHdoaWNoIDxicj4gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgZmlsbGVyIGV2ZW4gd2hlbiB3ZSBhcmUgbm90IGluIHRoZSAnYnInIG1vZGUuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy81NTY0LlxuICAgICAgICBpZiAoaXNPbmx5QnJJbkJsb2NrKGRvbU5vZGUsIHRoaXMuYmxvY2tFbGVtZW50cykpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIG5vdCBpbiAnYnInIG1vZGUsIHRyeSByZWNvZ25pemluZyBib3RoIG1hcmtlZCBhbmQgcmVndWxhciBuYnNwIGJsb2NrIGZpbGxlcnMuXG4gICAgICAgIHJldHVybiBkb21Ob2RlLmlzRXF1YWxOb2RlKE1BUktFRF9OQlNQX0ZJTExFUl9SRUYpIHx8IGlzTmJzcEJsb2NrRmlsbGVyKGRvbU5vZGUsIHRoaXMuYmxvY2tFbGVtZW50cyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiBnaXZlbiBzZWxlY3Rpb24gaXMgYSBiYWNrd2FyZCBzZWxlY3Rpb24sIHRoYXQgaXMsIGlmIGl0J3MgYGZvY3VzYCBpcyBiZWZvcmUgYGFuY2hvcmAuXG5cdCAqXG5cdCAqIEBwYXJhbSBET00gU2VsZWN0aW9uIGluc3RhbmNlIHRvIGNoZWNrLlxuXHQgKi8gaXNEb21TZWxlY3Rpb25CYWNrd2FyZChzZWxlY3Rpb24pIHtcbiAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNpbmNlIGl0IHRha2VzIG11bHRpcGxlIGxpbmVzIG9mIGNvZGUgdG8gY2hlY2sgd2hldGhlciBhIFwiRE9NIFBvc2l0aW9uXCIgaXMgYmVmb3JlL2FmdGVyIGFub3RoZXIgXCJET00gUG9zaXRpb25cIixcbiAgICAgICAgLy8gd2Ugd2lsbCB1c2UgdGhlIGZhY3QgdGhhdCByYW5nZSB3aWxsIGNvbGxhcHNlIGlmIGl0J3MgZW5kIGlzIGJlZm9yZSBpdCdzIHN0YXJ0LlxuICAgICAgICBjb25zdCByYW5nZSA9IHRoaXMuX2RvbURvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByYW5nZS5zZXRTdGFydChzZWxlY3Rpb24uYW5jaG9yTm9kZSwgc2VsZWN0aW9uLmFuY2hvck9mZnNldCk7XG4gICAgICAgICAgICByYW5nZS5zZXRFbmQoc2VsZWN0aW9uLmZvY3VzTm9kZSwgc2VsZWN0aW9uLmZvY3VzT2Zmc2V0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gU2FmYXJpIHNvbWV0aW1lcyBnaXZlcyB1cyBhIHNlbGVjdGlvbiB0aGF0IG1ha2VzIFJhbmdlLnNldHtTdGFydCxFbmR9IHRocm93LlxuICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEyMzc1LlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJhY2t3YXJkID0gcmFuZ2UuY29sbGFwc2VkO1xuICAgICAgICByYW5nZS5kZXRhY2goKTtcbiAgICAgICAgcmV0dXJuIGJhY2t3YXJkO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHBhcmVudCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50fVxuXHQgKiB0aGF0IGhvc3RzIHRoZSBwcm92aWRlZCBET00gbm9kZS4gUmV0dXJucyBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gc3VjaCBwYXJlbnQuXG5cdCAqLyBnZXRIb3N0Vmlld0VsZW1lbnQoZG9tTm9kZSkge1xuICAgICAgICBjb25zdCBhbmNlc3RvcnMgPSBnZXRBbmNlc3RvcnMoZG9tTm9kZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkb21Ob2RlIGZyb20gdGhlIGxpc3QuXG4gICAgICAgIGFuY2VzdG9ycy5wb3AoKTtcbiAgICAgICAgd2hpbGUoYW5jZXN0b3JzLmxlbmd0aCl7XG4gICAgICAgICAgICBjb25zdCBkb21Ob2RlID0gYW5jZXN0b3JzLnBvcCgpO1xuICAgICAgICAgICAgY29uc3Qgdmlld05vZGUgPSB0aGlzLl9kb21Ub1ZpZXdNYXBwaW5nLmdldChkb21Ob2RlKTtcbiAgICAgICAgICAgIGlmICh2aWV3Tm9kZSAmJiAodmlld05vZGUuaXMoJ3VpRWxlbWVudCcpIHx8IHZpZXdOb2RlLmlzKCdyYXdFbGVtZW50JykpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdOb2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBnaXZlbiBzZWxlY3Rpb24ncyBib3VuZGFyaWVzIGFyZSBhdCBjb3JyZWN0IHBsYWNlcy5cblx0ICpcblx0ICogVGhlIGZvbGxvd2luZyBwbGFjZXMgYXJlIGNvbnNpZGVyZWQgYXMgaW5jb3JyZWN0IGZvciBzZWxlY3Rpb24gYm91bmRhcmllczpcblx0ICpcblx0ICogKiBiZWZvcmUgb3IgaW4gdGhlIG1pZGRsZSBvZiBhbiBpbmxpbmUgZmlsbGVyIHNlcXVlbmNlLFxuXHQgKiAqIGluc2lkZSBhIERPTSBlbGVtZW50IHdoaWNoIHJlcHJlc2VudHMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IGEgdmlldyBVSSBlbGVtZW50fSxcblx0ICogKiBpbnNpZGUgYSBET00gZWxlbWVudCB3aGljaCByZXByZXNlbnRzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50IGEgdmlldyByYXcgZWxlbWVudH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21TZWxlY3Rpb24gVGhlIERPTSBzZWxlY3Rpb24gb2JqZWN0IHRvIGJlIGNoZWNrZWQuXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gc2VsZWN0aW9uIGlzIGF0IGEgY29ycmVjdCBwbGFjZSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBpc0RvbVNlbGVjdGlvbkNvcnJlY3QoZG9tU2VsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RvbVNlbGVjdGlvblBvc2l0aW9uQ29ycmVjdChkb21TZWxlY3Rpb24uYW5jaG9yTm9kZSwgZG9tU2VsZWN0aW9uLmFuY2hvck9mZnNldCkgJiYgdGhpcy5faXNEb21TZWxlY3Rpb25Qb3NpdGlvbkNvcnJlY3QoZG9tU2VsZWN0aW9uLmZvY3VzTm9kZSwgZG9tU2VsZWN0aW9uLmZvY3VzT2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyUGF0dGVybn0gZm9yIHZpZXcgZWxlbWVudHMgd2hvc2UgY29udGVudCBzaG91bGQgYmUgdHJlYXRlZCBhcyByYXcgZGF0YVxuXHQgKiBhbmQgbm90IHByb2Nlc3NlZCBkdXJpbmcgdGhlIGNvbnZlcnNpb24gZnJvbSBET00gbm9kZXMgdG8gdmlldyBlbGVtZW50cy5cblx0ICpcblx0ICogVGhpcyBpcyBhZmZlY3RpbmcgaG93IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNkb21Ub1ZpZXd9IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjZG9tQ2hpbGRyZW5Ub1ZpZXd9IHByb2Nlc3MgRE9NIG5vZGVzLlxuXHQgKlxuXHQgKiBUaGUgcmF3IGRhdGEgY2FuIGJlIGxhdGVyIGFjY2Vzc2VkIGJ5IGFcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjZ2V0Q3VzdG9tUHJvcGVydHkgY3VzdG9tIHByb3BlcnR5IG9mIGEgdmlldyBlbGVtZW50fSBjYWxsZWQgYFwiJHJhd0NvbnRlbnRcImAuXG5cdCAqXG5cdCAqIEBwYXJhbSBwYXR0ZXJuIFBhdHRlcm4gbWF0Y2hpbmcgYSB2aWV3IGVsZW1lbnQgd2hvc2UgY29udGVudCBzaG91bGRcblx0ICogYmUgdHJlYXRlZCBhcyByYXcgZGF0YS5cblx0ICovIHJlZ2lzdGVyUmF3Q29udGVudE1hdGNoZXIocGF0dGVybikge1xuICAgICAgICB0aGlzLl9yYXdDb250ZW50RWxlbWVudE1hdGNoZXIuYWRkKHBhdHRlcm4pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVnaXN0ZXJzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXJQYXR0ZXJufSBmb3IgaW5saW5lIG9iamVjdCB2aWV3IGVsZW1lbnRzLlxuXHQgKlxuXHQgKiBUaGlzIGlzIGFmZmVjdGluZyBob3cge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyI2RvbVRvVmlld30gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNkb21DaGlsZHJlblRvVmlld30gcHJvY2VzcyBET00gbm9kZXMuXG5cdCAqXG5cdCAqIFRoaXMgaXMgYW4gZXh0ZW5zaW9uIG9mIGEgc2ltcGxlIHtAbGluayAjaW5saW5lT2JqZWN0RWxlbWVudHN9IGFycmF5IG9mIGVsZW1lbnQgbmFtZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBwYXR0ZXJuIFBhdHRlcm4gbWF0Y2hpbmcgYSB2aWV3IGVsZW1lbnQgd2hpY2ggc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYW4gaW5saW5lIG9iamVjdC5cblx0ICovIHJlZ2lzdGVySW5saW5lT2JqZWN0TWF0Y2hlcihwYXR0ZXJuKSB7XG4gICAgICAgIHRoaXMuX2lubGluZU9iamVjdEVsZW1lbnRNYXRjaGVyLmFkZChwYXR0ZXJuKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsZWFyIHRlbXBvcmFyeSBjdXN0b20gcHJvcGVydGllcy5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfY2xlYXJUZW1wb3JhcnlDdXN0b21Qcm9wZXJ0aWVzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgdGhpcy5fZWxlbWVudHNXaXRoVGVtcG9yYXJ5Q3VzdG9tUHJvcGVydGllcyl7XG4gICAgICAgICAgICBlbGVtZW50Ll9yZW1vdmVDdXN0b21Qcm9wZXJ0eSgnZWRpdGluZ1BpcGVsaW5lOmRvTm90UmV1c2VPbmNlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZWxlbWVudHNXaXRoVGVtcG9yYXJ5Q3VzdG9tUHJvcGVydGllcy5jbGVhcigpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgYmxvY2sge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9maWxsZXIgZmlsbGVyfSBub2RlIGJhc2VkIG9uIHRoZSBjdXJyZW50IHtAbGluayAjYmxvY2tGaWxsZXJNb2RlfSBzZXR0aW5nLlxuXHQgKi8gX2dldEJsb2NrRmlsbGVyKCkge1xuICAgICAgICBzd2l0Y2godGhpcy5ibG9ja0ZpbGxlck1vZGUpe1xuICAgICAgICAgICAgY2FzZSAnbmJzcCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIE5CU1BfRklMTEVSKHRoaXMuX2RvbURvY3VtZW50KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwXG4gICAgICAgICAgICBjYXNlICdtYXJrZWROYnNwJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gTUFSS0VEX05CU1BfRklMTEVSKHRoaXMuX2RvbURvY3VtZW50KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwXG4gICAgICAgICAgICBjYXNlICdicic6XG4gICAgICAgICAgICAgICAgcmV0dXJuIEJSX0ZJTExFUih0aGlzLl9kb21Eb2N1bWVudCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbmV3LWNhcFxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGdpdmVuIERPTSBwb3NpdGlvbiBpcyBhIGNvcnJlY3QgcGxhY2UgZm9yIHNlbGVjdGlvbiBib3VuZGFyeS4gU2VlIHtAbGluayAjaXNEb21TZWxlY3Rpb25Db3JyZWN0fS5cblx0ICpcblx0ICogQHBhcmFtIGRvbVBhcmVudCBQb3NpdGlvbiBwYXJlbnQuXG5cdCAqIEBwYXJhbSBvZmZzZXQgUG9zaXRpb24gb2Zmc2V0LlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgZ2l2ZW4gcG9zaXRpb24gaXMgYXQgYSBjb3JyZWN0IHBsYWNlIGZvciBzZWxlY3Rpb24gYm91bmRhcnksIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX2lzRG9tU2VsZWN0aW9uUG9zaXRpb25Db3JyZWN0KGRvbVBhcmVudCwgb2Zmc2V0KSB7XG4gICAgICAgIC8vIElmIHNlbGVjdGlvbiBpcyBiZWZvcmUgb3IgaW4gdGhlIG1pZGRsZSBvZiBpbmxpbmUgZmlsbGVyIHN0cmluZywgaXQgaXMgaW5jb3JyZWN0LlxuICAgICAgICBpZiAoaXNUZXh0KGRvbVBhcmVudCkgJiYgc3RhcnRzV2l0aEZpbGxlcihkb21QYXJlbnQpICYmIG9mZnNldCA8IElOTElORV9GSUxMRVJfTEVOR1RIKSB7XG4gICAgICAgICAgICAvLyBTZWxlY3Rpb24gaW4gYSB0ZXh0IG5vZGUsIGF0IHdyb25nIHBvc2l0aW9uIChiZWZvcmUgb3IgaW4gdGhlIG1pZGRsZSBvZiBmaWxsZXIpLlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzRWxlbWVudChkb21QYXJlbnQpICYmIHN0YXJ0c1dpdGhGaWxsZXIoZG9tUGFyZW50LmNoaWxkTm9kZXNbb2Zmc2V0XSkpIHtcbiAgICAgICAgICAgIC8vIFNlbGVjdGlvbiBpbiBhbiBlbGVtZW50IG5vZGUsIGJlZm9yZSBmaWxsZXIgdGV4dCBub2RlLlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdQYXJlbnQgPSB0aGlzLm1hcERvbVRvVmlldyhkb21QYXJlbnQpO1xuICAgICAgICAvLyBUaGUgcG9zaXRpb24gaXMgaW5jb3JyZWN0IHdoZW4gYW5jaG9yZWQgaW5zaWRlIGEgVUlFbGVtZW50IG9yIGEgUmF3RWxlbWVudC5cbiAgICAgICAgLy8gTm90ZTogSW4gY2FzZSBvZiBVSUVsZW1lbnQgYW5kIFJhd0VsZW1lbnQsIG1hcERvbVRvVmlldygpIHJldHVybnMgYSBwYXJlbnQgZWxlbWVudCBmb3IgYW55IERPTSBjaGlsZFxuICAgICAgICAvLyBzbyB0aGVyZSdzIG5vIG5lZWQgdG8gcGVyZm9ybSBhbnkgYWRkaXRpb25hbCBjaGVja3MuXG4gICAgICAgIGlmICh2aWV3UGFyZW50ICYmICh2aWV3UGFyZW50LmlzKCd1aUVsZW1lbnQnKSB8fCB2aWV3UGFyZW50LmlzKCdyYXdFbGVtZW50JykpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnRlcm5hbCBnZW5lcmF0b3IgZm9yIHtAbGluayAjZG9tVG9WaWV3fS4gQWxzbyB1c2VkIGJ5IHtAbGluayAjZG9tQ2hpbGRyZW5Ub1ZpZXd9LlxuXHQgKiBTZXBhcmF0ZXMgRE9NIG5vZGVzIGNvbnZlcnNpb24gZnJvbSB3aGl0ZXNwYWNlcyBwcm9jZXNzaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tTm9kZSBET00gbm9kZSBvciBkb2N1bWVudCBmcmFnbWVudCB0byB0cmFuc2Zvcm0uXG5cdCAqIEBwYXJhbSBpbmxpbmVOb2RlcyBBbiBhcnJheSBvZiByZWNlbnRseSBlbmNvdW50ZXJlZCBpbmxpbmUgbm9kZXMgdHJ1bmNhdGVkIHRvIHRoZSBibG9jayBlbGVtZW50IGJvdW5kYXJpZXMuXG5cdCAqIFVzZWQgbGF0ZXIgdG8gcHJvY2VzcyB3aGl0ZXNwYWNlcy5cblx0ICovICpfZG9tVG9WaWV3KGRvbU5vZGUsIG9wdGlvbnMsIGlubGluZU5vZGVzKSB7XG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgPHA+PGJyPjwvcD4gaW4gd2hpY2ggPGJyPiBzaG91bGQgYmUgdHJlYXRlZCBhcyBmaWxsZXIgZXZlbiB3aGVuIHdlIGFyZSBub3QgaW4gdGhlICdicicgbW9kZS5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzU1NjQuXG4gICAgICAgIGlmICh0aGlzLmJsb2NrRmlsbGVyTW9kZSAhPSAnYnInICYmIGlzT25seUJySW5CbG9jayhkb21Ob2RlLCB0aGlzLmJsb2NrRWxlbWVudHMpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBXaGVuIG5vZGUgaXMgaW5zaWRlIGEgVUlFbGVtZW50IG9yIGEgUmF3RWxlbWVudCByZXR1cm4gdGhhdCBwYXJlbnQgYXMgaXQncyB2aWV3IHJlcHJlc2VudGF0aW9uLlxuICAgICAgICBjb25zdCBob3N0RWxlbWVudCA9IHRoaXMuZ2V0SG9zdFZpZXdFbGVtZW50KGRvbU5vZGUpO1xuICAgICAgICBpZiAoaG9zdEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBob3N0RWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNDb21tZW50KGRvbU5vZGUpICYmIG9wdGlvbnMuc2tpcENvbW1lbnRzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNUZXh0KGRvbU5vZGUpKSB7XG4gICAgICAgICAgICBpZiAoaXNJbmxpbmVGaWxsZXIoZG9tTm9kZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dERhdGEgPSBkb21Ob2RlLmRhdGE7XG4gICAgICAgICAgICAgICAgaWYgKHRleHREYXRhID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdGV4dE5vZGUgPSBuZXcgVGV4dCQxKHRoaXMuZG9jdW1lbnQsIHRleHREYXRhKTtcbiAgICAgICAgICAgICAgICBpbmxpbmVOb2Rlcy5wdXNoKHRleHROb2RlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dE5vZGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgdmlld0VsZW1lbnQgPSB0aGlzLm1hcERvbVRvVmlldyhkb21Ob2RlKTtcbiAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0lubGluZU9iamVjdEVsZW1lbnQodmlld0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlubGluZU5vZGVzLnB1c2godmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdmlld0VsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5pc0RvY3VtZW50RnJhZ21lbnQoZG9tTm9kZSkpIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdmlldyBkb2N1bWVudCBmcmFnbWVudC5cbiAgICAgICAgICAgICAgICB2aWV3RWxlbWVudCA9IG5ldyBEb2N1bWVudEZyYWdtZW50JDEodGhpcy5kb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYmluZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmREb2N1bWVudEZyYWdtZW50cyhkb21Ob2RlLCB2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdmlldyBlbGVtZW50LlxuICAgICAgICAgICAgICAgIHZpZXdFbGVtZW50ID0gdGhpcy5fY3JlYXRlVmlld0VsZW1lbnQoZG9tTm9kZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYmluZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJpbmRFbGVtZW50cyhkb21Ob2RlLCB2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENvcHkgZWxlbWVudCdzIGF0dHJpYnV0ZXMuXG4gICAgICAgICAgICAgICAgY29uc3QgYXR0cnMgPSBkb21Ob2RlLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICAgICAgaWYgKGF0dHJzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgbCA9IGF0dHJzLmxlbmd0aCwgaSA9IDA7IGkgPCBsOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlld0VsZW1lbnQuX3NldEF0dHJpYnV0ZShhdHRyc1tpXS5uYW1lLCBhdHRyc1tpXS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVHJlYXQgdGhpcyBlbGVtZW50J3MgY29udGVudCBhcyBhIHJhdyBkYXRhIGlmIGl0IHdhcyByZWdpc3RlcmVkIGFzIHN1Y2guXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzVmlld0VsZW1lbnRXaXRoUmF3Q29udGVudCh2aWV3RWxlbWVudCwgb3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgICAgICAgdmlld0VsZW1lbnQuX3NldEN1c3RvbVByb3BlcnR5KCckcmF3Q29udGVudCcsIGRvbU5vZGUuaW5uZXJIVE1MKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0Jsb2NrVmlld0VsZW1lbnQodmlld0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmxpbmVOb2Rlcy5wdXNoKHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld0VsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIENvbW1lbnQgbm9kZSBpcyBhbHNvIHRyZWF0ZWQgYXMgYW4gZWxlbWVudCB3aXRoIHJhdyBkYXRhLlxuICAgICAgICAgICAgICAgIGlmIChpc0NvbW1lbnQoZG9tTm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmlld0VsZW1lbnQuX3NldEN1c3RvbVByb3BlcnR5KCckcmF3Q29udGVudCcsIGRvbU5vZGUuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3RWxlbWVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBZaWVsZCB0aGUgZWxlbWVudCBmaXJzdCBzbyB0aGUgZmxvdyBvZiBuZXN0ZWQgaW5saW5lIG5vZGVzIGlzIG5vdCByZXZlcnNlZCBpbnNpZGUgZWxlbWVudHMuXG4gICAgICAgICAgICB5aWVsZCB2aWV3RWxlbWVudDtcbiAgICAgICAgICAgIGNvbnN0IG5lc3RlZElubGluZU5vZGVzID0gW107XG4gICAgICAgICAgICBpZiAob3B0aW9ucy53aXRoQ2hpbGRyZW4gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmRvbUNoaWxkcmVuVG9WaWV3KGRvbU5vZGUsIG9wdGlvbnMsIG5lc3RlZElubGluZU5vZGVzKSl7XG4gICAgICAgICAgICAgICAgICAgIHZpZXdFbGVtZW50Ll9hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhbiBpbmxpbmUgb2JqZWN0IGFmdGVyIHByb2Nlc3NpbmcgY2hpbGQgbm9kZXMgc28gbWF0Y2hlclxuICAgICAgICAgICAgLy8gZm9yIGlubGluZSBvYmplY3RzIGNhbiB2ZXJpZnkgaWYgdGhlIGVsZW1lbnQgaXMgZW1wdHkuXG4gICAgICAgICAgICBpZiAodGhpcy5faXNJbmxpbmVPYmplY3RFbGVtZW50KHZpZXdFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGlubGluZU5vZGVzLnB1c2godmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgICAgIC8vIElubGluZSBvYmplY3QgY29udGVudCBzaG91bGQgYmUgaGFuZGxlZCBhcyBhIGZsb3ctcm9vdC5cbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzRG9tSW5saW5lTm9kZXMobnVsbCwgbmVzdGVkSW5saW5lTm9kZXMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJdCdzIGFuIGlubGluZSBlbGVtZW50IHRoYXQgaXMgbm90IGFuIG9iamVjdCAobGlrZSA8Yj4sIDxpPikgb3IgYSBibG9jayBlbGVtZW50LlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5saW5lTm9kZSBvZiBuZXN0ZWRJbmxpbmVOb2Rlcyl7XG4gICAgICAgICAgICAgICAgICAgIGlubGluZU5vZGVzLnB1c2goaW5saW5lTm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnRlcm5hbCBoZWxwZXIgdGhhdCB3YWxrcyB0aGUgbGlzdCBvZiBpbmxpbmUgdmlldyBub2RlcyBhbHJlYWR5IGdlbmVyYXRlZCBmcm9tIERPTSBub2Rlc1xuXHQgKiBhbmQgaGFuZGxlcyB3aGl0ZXNwYWNlcyBhbmQgTkJTUHMuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21QYXJlbnQgVGhlIERPTSBwYXJlbnQgb2YgdGhlIGdpdmVuIGlubGluZSBub2Rlcy4gVGhpcyBzaG91bGQgYmUgYSBkb2N1bWVudCBmcmFnbWVudCBvclxuXHQgKiBhIGJsb2NrIGVsZW1lbnQgdG8gd2hpdGVzcGFjZSBwcm9jZXNzaW5nIHN0YXJ0IGNsZWFuaW5nLlxuXHQgKiBAcGFyYW0gaW5saW5lTm9kZXMgQW4gYXJyYXkgb2YgcmVjZW50bHkgZW5jb3VudGVyZWQgaW5saW5lIG5vZGVzIHRydW5jYXRlZCB0byB0aGUgYmxvY2sgZWxlbWVudCBib3VuZGFyaWVzLlxuXHQgKi8gX3Byb2Nlc3NEb21JbmxpbmVOb2Rlcyhkb21QYXJlbnQsIGlubGluZU5vZGVzLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghaW5saW5lTm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gUHJvY2VzcyB0ZXh0IG5vZGVzIG9ubHkgYWZ0ZXIgcmVhY2hpbmcgYSBibG9jayBvciBkb2N1bWVudCBmcmFnbWVudCxcbiAgICAgICAgLy8gZG8gbm90IGFsdGVyIHdoaXRlc3BhY2VzIHdoaWxlIHByb2Nlc3NpbmcgYW4gaW5saW5lIGVsZW1lbnQgbGlrZSA8Yj4gb3IgPGk+LlxuICAgICAgICBpZiAoZG9tUGFyZW50ICYmICF0aGlzLmlzRG9jdW1lbnRGcmFnbWVudChkb21QYXJlbnQpICYmICF0aGlzLl9pc0Jsb2NrRG9tRWxlbWVudChkb21QYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHByZXZOb2RlRW5kc1dpdGhTcGFjZSA9IGZhbHNlO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgaW5saW5lTm9kZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGlubGluZU5vZGVzW2ldO1xuICAgICAgICAgICAgaWYgKCFub2RlLmlzKCckdGV4dCcpKSB7XG4gICAgICAgICAgICAgICAgcHJldk5vZGVFbmRzV2l0aFNwYWNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgICAgIGxldCBub2RlRW5kc1dpdGhTcGFjZSA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2lzUHJlRm9ybWF0dGVkKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGdldERhdGFXaXRob3V0RmlsbGVyKG5vZGUuZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIENoYW5nZSBhbGwgY29uc2VjdXRpdmUgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzIChmcm9tIHRoZSBbIFxcblxcdFxccl0gc2V0IOKAk1xuICAgICAgICAgICAgICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvODIyI2lzc3VlY29tbWVudC0zMTE2NzAyNDkpIHRvIGEgc2luZ2xlIHNwYWNlIGNoYXJhY3Rlci5cbiAgICAgICAgICAgICAgICAvLyBUaGF0J3MgaG93IG11bHRpcGxlIHdoaXRlc3BhY2VzIGFyZSB0cmVhdGVkIHdoZW4gcmVuZGVyZWQsIHNvIHdlIG5vcm1hbGl6ZSB0aG9zZSB3aGl0ZXNwYWNlcy5cbiAgICAgICAgICAgICAgICAvLyBXZSdyZSByZXBsYWNpbmcgMSsgKGFuZCBub3QgMispIHRvIGFsc28gbm9ybWFsaXplIHNpbmd1bGFyIFxcblxcdFxcciBjaGFyYWN0ZXJzICgjODIyKS5cbiAgICAgICAgICAgICAgICBkYXRhID0gbm9kZS5kYXRhLnJlcGxhY2UoL1sgXFxuXFx0XFxyXXsxLH0vZywgJyAnKTtcbiAgICAgICAgICAgICAgICBub2RlRW5kc1dpdGhTcGFjZSA9IC9bXlxcU1xcdTAwQTBdLy50ZXN0KGRhdGEuY2hhckF0KGRhdGEubGVuZ3RoIC0gMSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZOb2RlID0gaSA+IDAgPyBpbmxpbmVOb2Rlc1tpIC0gMV0gOiBudWxsO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5leHROb2RlID0gaSArIDEgPCBpbmxpbmVOb2Rlcy5sZW5ndGggPyBpbmxpbmVOb2Rlc1tpICsgMV0gOiBudWxsO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNob3VsZExlZnRUcmltID0gIXByZXZOb2RlIHx8IHByZXZOb2RlLmlzKCdlbGVtZW50JykgJiYgcHJldk5vZGUubmFtZSA9PSAnYnInIHx8IHByZXZOb2RlRW5kc1dpdGhTcGFjZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRSaWdodFRyaW0gPSBuZXh0Tm9kZSA/IGZhbHNlIDogIXN0YXJ0c1dpdGhGaWxsZXIobm9kZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAvLyBEbyBub3QgdHJ5IHRvIGNsZWFyIHdoaXRlc3BhY2VzIGlmIHRoaXMgaXMgZmxhdCBtYXBwaW5nIGZvciB0aGUgcHVycG9zZSBvZiBtdXRhdGlvbiBvYnNlcnZlciBhbmQgZGlmZmVyIGluIHJlbmRlcmluZy5cbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy53aXRoQ2hpbGRyZW4gIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBwcmV2aW91cyBkb20gdGV4dCBub2RlIGRvZXMgbm90IGV4aXN0IG9yIGl0IGVuZHMgYnkgd2hpdGVzcGFjZSBjaGFyYWN0ZXIsIHJlbW92ZSBzcGFjZSBjaGFyYWN0ZXIgZnJvbSB0aGVcbiAgICAgICAgICAgICAgICAgICAgLy8gYmVnaW5uaW5nIG9mIHRoaXMgdGV4dCBub2RlLiBTdWNoIHNwYWNlIGNoYXJhY3RlciBpcyB0cmVhdGVkIGFzIGEgd2hpdGVzcGFjZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZExlZnRUcmltKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9eIC8sICcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCB0ZXh0IG5vZGUgZG9lcyBub3QgZXhpc3QgcmVtb3ZlIHNwYWNlIGNoYXJhY3RlciBmcm9tIHRoZSBlbmQgb2YgdGhpcyB0ZXh0IG5vZGUuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzaG91bGRSaWdodFRyaW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoLyAkLywgJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEF0IHRoZSBiZWdpbm5pbmcgYW5kIGVuZCBvZiBhIGJsb2NrIGVsZW1lbnQsIEZpcmVmb3ggaW5zZXJ0cyBub3JtYWwgc3BhY2UgKyA8YnI+IGluc3RlYWQgb2Ygbm9uLWJyZWFraW5nIHNwYWNlLlxuICAgICAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCB0aGUgdGV4dCBub2RlIHN0YXJ0cy9lbmQgd2l0aCBub3JtYWwgc3BhY2UgaW5zdGVhZCBvZiBub24tYnJlYWtpbmcgc3BhY2UuXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjYXVzZXMgYSBwcm9ibGVtIGJlY2F1c2UgdGhlIG5vcm1hbCBzcGFjZSB3b3VsZCBiZSByZW1vdmVkIGluIGAucmVwbGFjZWAgY2FsbHMgYWJvdmUuIFRvIHByZXZlbnQgdGhhdCxcbiAgICAgICAgICAgICAgICAvLyB0aGUgaW5saW5lIGZpbGxlciBpcyByZW1vdmVkIG9ubHkgYWZ0ZXIgdGhlIGRhdGEgaXMgaW5pdGlhbGx5IHByb2Nlc3NlZCAoYnkgdGhlIGAucmVwbGFjZWAgYWJvdmUpLiBTZWUgY2tlZGl0b3I1IzY5Mi5cbiAgICAgICAgICAgICAgICBkYXRhID0gZ2V0RGF0YVdpdGhvdXRGaWxsZXIoZGF0YSk7XG4gICAgICAgICAgICAgICAgLy8gQmxvY2sgZmlsbGVyIGhhbmRsaW5nLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJsb2NrRmlsbGVyTW9kZSAhPSAnYnInICYmIG5vZGUucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1ZpZXdNYXJrZWROYnNwRmlsbGVyKG5vZGUucGFyZW50LCBkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBibG9jayBlbGVtZW50IGFzIGl0IGhhcyBhIGJsb2NrIGZpbGxlciBhbmQgcmVtb3ZlIHRoZSBgPHNwYW4gZGF0YS1ja2UtZmlsbGVyPVwidHJ1ZVwiPmAgZWxlbWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnBhcmVudC5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnBhcmVudC5wYXJlbnQuX3NldEN1c3RvbVByb3BlcnR5KCckaGFzQmxvY2tGaWxsZXInLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnBhcmVudC5fcmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNWaWV3TmJzcEZpbGxlcihub2RlLnBhcmVudCwgZGF0YSwgdGhpcy5ibG9ja0VsZW1lbnRzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQuX3NldEN1c3RvbVByb3BlcnR5KCckaGFzQmxvY2tGaWxsZXInLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHdlIHNob3VsZCBoYXZlIHJlbW92ZWQgYWxsIHdoaXRlc3BhY2VzIGZyb20gRE9NIHRleHQgZGF0YS5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIE5vdywgV2Ugd2lsbCByZXZlcnNlIHRoZSBwcm9jZXNzIHRoYXQgaGFwcGVucyBpbiBgX3Byb2Nlc3NEYXRhRnJvbVZpZXdUZXh0YC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgdG8gY2hhbmdlICZuYnNwOyBjaGFycywgdGhhdCB3ZXJlIGluIERPTSB0ZXh0IGRhdGEgYmVjYXVzZSBvZiByZW5kZXJpbmcgcmVhc29ucywgdG8gc3BhY2VzLlxuICAgICAgICAgICAgICAgIC8vIEZpcnN0LCBjaGFuZ2UgYWxsIGAgXFx1MDBBMGAgcGFpcnMgKHNwYWNlICsgJm5ic3A7KSB0byB0d28gc3BhY2VzLiBET00gY29udmVydGVyIGNoYW5nZXMgdHdvIHNwYWNlcyBmcm9tIG1vZGVsL3ZpZXcgdG9cbiAgICAgICAgICAgICAgICAvLyBgIFxcdTAwQTBgIHRvIGVuc3VyZSBwcm9wZXIgcmVuZGVyaW5nLiBTaW5jZSBoZXJlIHdlIGNvbnZlcnQgYmFjaywgd2UgcmVjb2duaXplIHRob3NlIHBhaXJzIGFuZCBjaGFuZ2UgdGhlbSBiYWNrIHRvIGAgIGAuXG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvIFxcdTAwQTAvZywgJyAgJyk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNOZXh0Tm9kZUlubGluZU9iamVjdEVsZW1lbnQgPSBuZXh0Tm9kZSAmJiBuZXh0Tm9kZS5pcygnZWxlbWVudCcpICYmIG5leHROb2RlLm5hbWUgIT0gJ2JyJztcbiAgICAgICAgICAgICAgICBjb25zdCBpc05leHROb2RlU3RhcnRpbmdXaXRoU3BhY2UgPSBuZXh0Tm9kZSAmJiBuZXh0Tm9kZS5pcygnJHRleHQnKSAmJiBuZXh0Tm9kZS5kYXRhLmNoYXJBdCgwKSA9PSAnICc7XG4gICAgICAgICAgICAgICAgLy8gVGhlbiwgbGV0J3MgY2hhbmdlIHRoZSBsYXN0IG5ic3AgdG8gYSBzcGFjZS5cbiAgICAgICAgICAgICAgICBpZiAoL1sgXFx1MDBBMF1cXHUwMEEwJC8udGVzdChkYXRhKSB8fCAhbmV4dE5vZGUgfHwgaXNOZXh0Tm9kZUlubGluZU9iamVjdEVsZW1lbnQgfHwgaXNOZXh0Tm9kZVN0YXJ0aW5nV2l0aFNwYWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL1xcdTAwQTAkLywgJyAnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVGhlbiwgY2hhbmdlICZuYnNwOyBjaGFyYWN0ZXIgdGhhdCBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSB0ZXh0IG5vZGUgdG8gc3BhY2UgY2hhcmFjdGVyLlxuICAgICAgICAgICAgICAgIC8vIFdlIGRvIHRoYXQgcmVwbGFjZW1lbnQgb25seSBpZiB0aGlzIGlzIHRoZSBmaXJzdCBub2RlIG9yIHRoZSBwcmV2aW91cyBub2RlIGVuZHMgb24gd2hpdGVzcGFjZSBjaGFyYWN0ZXIuXG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZExlZnRUcmltIHx8IHByZXZOb2RlICYmIHByZXZOb2RlLmlzKCdlbGVtZW50JykgJiYgcHJldk5vZGUubmFtZSAhPSAnYnInKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL15cXHUwMEEwLywgJyAnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBdCB0aGlzIHBvaW50LCBhbGwgd2hpdGVzcGFjZXMgc2hvdWxkIGJlIHJlbW92ZWQgYW5kIGFsbCAmbmJzcDsgY3JlYXRlZCBmb3IgcmVuZGVyaW5nIHJlYXNvbnMgc2hvdWxkIGJlXG4gICAgICAgICAgICAvLyBjaGFuZ2VkIHRvIG5vcm1hbCBzcGFjZS4gQWxsIGxlZnQgJm5ic3A7IGFyZSAmbmJzcDsgaW5zZXJ0ZWQgaW50ZW50aW9uYWxseS5cbiAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PSAwICYmIG5vZGUucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgbm9kZS5fcmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgaW5saW5lTm9kZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbm9kZS5fZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgcHJldk5vZGVFbmRzV2l0aFNwYWNlID0gbm9kZUVuZHNXaXRoU3BhY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5saW5lTm9kZXMubGVuZ3RoID0gMDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRha2VzIHRleHQgZGF0YSBmcm9tIGEgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQjZGF0YX0gYW5kIHByb2Nlc3NlcyBpdCBzb1xuXHQgKiBpdCBpcyBjb3JyZWN0bHkgZGlzcGxheWVkIGluIHRoZSBET00uXG5cdCAqXG5cdCAqIEZvbGxvd2luZyBjaGFuZ2VzIGFyZSBkb25lOlxuXHQgKlxuXHQgKiAqIGEgc3BhY2UgYXQgdGhlIGJlZ2lubmluZyBpcyBjaGFuZ2VkIHRvIGAmbmJzcDtgIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHRleHQgbm9kZSBpbiBpdHMgY29udGFpbmVyXG5cdCAqIGVsZW1lbnQgb3IgaWYgYSBwcmV2aW91cyB0ZXh0IG5vZGUgZW5kcyB3aXRoIGEgc3BhY2UgY2hhcmFjdGVyLFxuXHQgKiAqIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIHRleHQgbm9kZSBpcyBjaGFuZ2VkIHRvIGAmbmJzcDtgIGlmIHRoZXJlIGFyZSB0d28gc3BhY2VzIGF0IHRoZSBlbmQgb2YgYSBub2RlIG9yIGlmIG5leHQgbm9kZVxuXHQgKiBzdGFydHMgd2l0aCBhIHNwYWNlIG9yIGlmIGl0IGlzIHRoZSBsYXN0IHRleHQgbm9kZSBpbiBpdHMgY29udGFpbmVyLFxuXHQgKiAqIHJlbWFpbmluZyBzcGFjZXMgYXJlIHJlcGxhY2VkIHRvIGEgY2hhaW4gb2Ygc3BhY2VzIGFuZCBgJm5ic3A7YCAoZS5nLiBgJ3ggICB4J2AgYmVjb21lcyBgJ3ggJm5ic3A7IHgnYCkuXG5cdCAqXG5cdCAqIENvbnRlbnQgb2Yge0BsaW5rICNwcmVFbGVtZW50c30gaXMgbm90IHByb2Nlc3NlZC5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgVmlldyB0ZXh0IG5vZGUgdG8gcHJvY2Vzcy5cblx0ICogQHJldHVybnMgUHJvY2Vzc2VkIHRleHQgZGF0YS5cblx0ICovIF9wcm9jZXNzRGF0YUZyb21WaWV3VGV4dChub2RlKSB7XG4gICAgICAgIGxldCBkYXRhID0gbm9kZS5kYXRhO1xuICAgICAgICAvLyBJZiB0aGUgY3VycmVudGx5IHByb2Nlc3NlZCB2aWV3IHRleHQgbm9kZSBpcyBwcmVmb3JtYXR0ZWQsIHdlIHNob3VsZCBub3QgY2hhbmdlIHdoaXRlc3BhY2VzLlxuICAgICAgICBpZiAodGhpcy5faXNQcmVGb3JtYXR0ZWQobm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIC8vIDEuIFJlcGxhY2UgdGhlIGZpcnN0IHNwYWNlIHdpdGggYSBuYnNwIGlmIHRoZSBwcmV2aW91cyBub2RlIGVuZHMgd2l0aCBhIHNwYWNlIG9yIHRoZXJlIGlzIG5vIHByZXZpb3VzIG5vZGVcbiAgICAgICAgLy8gKGNvbnRhaW5lciBlbGVtZW50IGJvdW5kYXJ5KS5cbiAgICAgICAgaWYgKGRhdGEuY2hhckF0KDApID09ICcgJykge1xuICAgICAgICAgICAgY29uc3QgcHJldk5vZGUgPSB0aGlzLl9nZXRUb3VjaGluZ0lubGluZVZpZXdOb2RlKG5vZGUsIGZhbHNlKTtcbiAgICAgICAgICAgIGNvbnN0IHByZXZFbmRzV2l0aFNwYWNlID0gcHJldk5vZGUgJiYgcHJldk5vZGUuaXMoJyR0ZXh0UHJveHknKSAmJiB0aGlzLl9ub2RlRW5kc1dpdGhTcGFjZShwcmV2Tm9kZSk7XG4gICAgICAgICAgICBpZiAocHJldkVuZHNXaXRoU3BhY2UgfHwgIXByZXZOb2RlKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9ICdcXHUwMEEwJyArIGRhdGEuc3Vic3RyKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIDIuIFJlcGxhY2UgdGhlIGxhc3Qgc3BhY2Ugd2l0aCBuYnNwIGlmIHRoZXJlIGFyZSB0d28gc3BhY2VzIGF0IHRoZSBlbmQgb3IgaWYgdGhlIG5leHQgbm9kZSBzdGFydHMgd2l0aCBzcGFjZSBvciB0aGVyZSBpcyBub1xuICAgICAgICAvLyBuZXh0IG5vZGUgKGNvbnRhaW5lciBlbGVtZW50IGJvdW5kYXJ5KS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gS2VlcCBpbiBtaW5kIHRoYXQgRmlyZWZveCBwcmVmZXJzICRuYnNwOyBiZWZvcmUgdGFnLCBub3QgaW5zaWRlIGl0OlxuICAgICAgICAvL1xuICAgICAgICAvLyBGb28gPHNwYW4+Jm5ic3A7YmFyPC9zcGFuPiAgPC0tIGJhZC5cbiAgICAgICAgLy8gRm9vJm5ic3A7PHNwYW4+IGJhcjwvc3Bhbj4gIDwtLSBnb29kLlxuICAgICAgICAvL1xuICAgICAgICAvLyBNb3JlIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2lzc3Vlcy8xNzQ3LlxuICAgICAgICBpZiAoZGF0YS5jaGFyQXQoZGF0YS5sZW5ndGggLSAxKSA9PSAnICcpIHtcbiAgICAgICAgICAgIGNvbnN0IG5leHROb2RlID0gdGhpcy5fZ2V0VG91Y2hpbmdJbmxpbmVWaWV3Tm9kZShub2RlLCB0cnVlKTtcbiAgICAgICAgICAgIGNvbnN0IG5leHRTdGFydHNXaXRoU3BhY2UgPSBuZXh0Tm9kZSAmJiBuZXh0Tm9kZS5pcygnJHRleHRQcm94eScpICYmIG5leHROb2RlLmRhdGEuY2hhckF0KDApID09ICcgJztcbiAgICAgICAgICAgIGlmIChkYXRhLmNoYXJBdChkYXRhLmxlbmd0aCAtIDIpID09ICcgJyB8fCAhbmV4dE5vZGUgfHwgbmV4dFN0YXJ0c1dpdGhTcGFjZSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnN1YnN0cigwLCBkYXRhLmxlbmd0aCAtIDEpICsgJ1xcdTAwQTAnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIDMuIENyZWF0ZSBzcGFjZStuYnNwIHBhaXJzLlxuICAgICAgICByZXR1cm4gZGF0YS5yZXBsYWNlKC8gezJ9L2csICcgXFx1MDBBMCcpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gbm9kZSBlbmRzIHdpdGggYSBzcGFjZSBjaGFyYWN0ZXIgYWZ0ZXIgY2hhbmdpbmcgYXBwcm9wcmlhdGUgc3BhY2UgY2hhcmFjdGVycyB0byBgJm5ic3A7YHMuXG5cdCAqXG5cdCAqIEBwYXJhbSAgbm9kZSBOb2RlIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgZ2l2ZW4gYG5vZGVgIGVuZHMgd2l0aCBzcGFjZSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBfbm9kZUVuZHNXaXRoU3BhY2Uobm9kZSkge1xuICAgICAgICBpZiAodGhpcy5faXNQcmVGb3JtYXR0ZWQobm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fcHJvY2Vzc0RhdGFGcm9tVmlld1RleHQobm9kZSk7XG4gICAgICAgIHJldHVybiBkYXRhLmNoYXJBdChkYXRhLmxlbmd0aCAtIDEpID09ICcgJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIGdpdmVuIHRleHQgY29udGFpbnMgcHJlZm9ybWF0dGVkIHdoaXRlIHNwYWNlLiBUaGlzIGlzIHRoZSBjYXNlIGlmXG5cdCAqICogYW55IG9mIG5vZGUgYW5jZXN0b3JzIGhhcyBhIG5hbWUgd2hpY2ggaXMgaW4gYHByZUVsZW1lbnRzYCBhcnJheSwgb3Jcblx0ICogKiB0aGUgY2xvc2VzdCBhbmNlc3RvciB0aGF0IGhhcyB0aGUgYHdoaXRlLXNwYWNlYCBDU1MgcHJvcGVydHkgc2V0cyBpdCB0byBhIHZhbHVlIHRoYXQgcHJlc2VydmVzIHNwYWNlc1xuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBOb2RlIHRvIGNoZWNrXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBnaXZlbiBub2RlIGNvbnRhaW5zIHByZWZvcm1hdHRlZCB3aGl0ZSBzcGFjZSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBfaXNQcmVGb3JtYXR0ZWQobm9kZSkge1xuICAgICAgICBpZiAoX2hhc1ZpZXdQYXJlbnRPZlR5cGUobm9kZSwgdGhpcy5wcmVFbGVtZW50cykpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgYW5jZXN0b3Igb2Ygbm9kZS5nZXRBbmNlc3RvcnMoe1xuICAgICAgICAgICAgcGFyZW50Rmlyc3Q6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKCFhbmNlc3Rvci5pcygnZWxlbWVudCcpIHx8ICFhbmNlc3Rvci5oYXNTdHlsZSgnd2hpdGUtc3BhY2UnKSB8fCBhbmNlc3Rvci5nZXRTdHlsZSgnd2hpdGUtc3BhY2UnKSA9PT0gJ2luaGVyaXQnKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBjb250YWlucyB0aGUgYHdoaXRlLXNwYWNlYCBwcm9wZXJ0eSB3aXRoIGEgdmFsdWUgdGhhdCBkb2VzIG5vdCBwcmVzZXJ2ZSBzcGFjZXMsIGl0IHdpbGwgdGFrZVxuICAgICAgICAgICAgLy8gcHJlY2VkZW5jZSBvdmVyIGFueSB3aGl0ZS1zcGFjZSBzZXR0aW5ncyBpdHMgYW5jZXN0b3JzIGNvbnRhaW4sIHNvIG5vIGZ1cnRoZXIgcGFyZW50IGNoZWNraW5nIG5lZWRzIHRvXG4gICAgICAgICAgICAvLyBiZSBkb25lLlxuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAncHJlJyxcbiAgICAgICAgICAgICAgICAncHJlLXdyYXAnLFxuICAgICAgICAgICAgICAgICdicmVhay1zcGFjZXMnXG4gICAgICAgICAgICBdLmluY2x1ZGVzKGFuY2VzdG9yLmdldFN0eWxlKCd3aGl0ZS1zcGFjZScpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIZWxwZXIgZnVuY3Rpb24uIEZvciBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB2aWV3IHRleHQgbm9kZX0sIGl0IGZpbmRzIHByZXZpb3VzIG9yIG5leHQgc2libGluZ1xuXHQgKiB0aGF0IGlzIGNvbnRhaW5lZCBpbiB0aGUgc2FtZSBjb250YWluZXIgZWxlbWVudC4gSWYgdGhlcmUgaXMgbm8gc3VjaCBzaWJsaW5nLCBgbnVsbGAgaXMgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIFJlZmVyZW5jZSBub2RlLlxuXHQgKiBAcmV0dXJucyBUb3VjaGluZyB0ZXh0IG5vZGUsIGFuIGlubGluZSBvYmplY3Rcblx0ICogb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIG5leHQgb3IgcHJldmlvdXMgdG91Y2hpbmcgdGV4dCBub2RlLlxuXHQgKi8gX2dldFRvdWNoaW5nSW5saW5lVmlld05vZGUobm9kZSwgZ2V0TmV4dCkge1xuICAgICAgICBjb25zdCB0cmVlV2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIkMSh7XG4gICAgICAgICAgICBzdGFydFBvc2l0aW9uOiBnZXROZXh0ID8gUG9zaXRpb24kMS5fY3JlYXRlQWZ0ZXIobm9kZSkgOiBQb3NpdGlvbiQxLl9jcmVhdGVCZWZvcmUobm9kZSksXG4gICAgICAgICAgICBkaXJlY3Rpb246IGdldE5leHQgPyAnZm9yd2FyZCcgOiAnYmFja3dhcmQnXG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGNvbnN0IHsgaXRlbSB9IG9mIHRyZWVXYWxrZXIpe1xuICAgICAgICAgICAgLy8gRm91bmQgYSB0ZXh0IG5vZGUgaW4gdGhlIHNhbWUgY29udGFpbmVyIGVsZW1lbnQuXG4gICAgICAgICAgICBpZiAoaXRlbS5pcygnJHRleHRQcm94eScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSAmJiBpdGVtLmdldEN1c3RvbVByb3BlcnR5KCdkYXRhUGlwZWxpbmU6dHJhbnNwYXJlbnRSZW5kZXJpbmcnKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlzKCdlbGVtZW50JywgJ2JyJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5faXNJbmxpbmVPYmplY3RFbGVtZW50KGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaXMoJ2NvbnRhaW5lckVsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBgdHJ1ZWAgaWYgYSBET00gbm9kZSBiZWxvbmdzIHRvIHtAbGluayAjYmxvY2tFbGVtZW50c30uIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX2lzQmxvY2tEb21FbGVtZW50KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNFbGVtZW50KG5vZGUpICYmIHRoaXMuYmxvY2tFbGVtZW50cy5pbmNsdWRlcyhub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiBhIHZpZXcgbm9kZSBiZWxvbmdzIHRvIHtAbGluayAjYmxvY2tFbGVtZW50c30uIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX2lzQmxvY2tWaWV3RWxlbWVudChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlLmlzKCdlbGVtZW50JykgJiYgdGhpcy5ibG9ja0VsZW1lbnRzLmluY2x1ZGVzKG5vZGUubmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiBhIERPTSBub2RlIGJlbG9uZ3MgdG8ge0BsaW5rICNpbmxpbmVPYmplY3RFbGVtZW50c30uIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX2lzSW5saW5lT2JqZWN0RWxlbWVudChub2RlKSB7XG4gICAgICAgIGlmICghbm9kZS5pcygnZWxlbWVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGUubmFtZSA9PSAnYnInIHx8IHRoaXMuaW5saW5lT2JqZWN0RWxlbWVudHMuaW5jbHVkZXMobm9kZS5uYW1lKSB8fCAhIXRoaXMuX2lubGluZU9iamVjdEVsZW1lbnRNYXRjaGVyLm1hdGNoKG5vZGUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyB2aWV3IGVsZW1lbnQgYmFzaW5nIG9uIHRoZSBub2RlIHR5cGUuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIERPTSBub2RlIHRvIGNoZWNrLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBDb252ZXJzaW9uIG9wdGlvbnMuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjZG9tVG9WaWV3fSBvcHRpb25zIHBhcmFtZXRlci5cblx0ICovIF9jcmVhdGVWaWV3RWxlbWVudChub2RlLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChpc0NvbW1lbnQobm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVUlFbGVtZW50KHRoaXMuZG9jdW1lbnQsICckY29tbWVudCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdOYW1lID0gb3B0aW9ucy5rZWVwT3JpZ2luYWxDYXNlID8gbm9kZS50YWdOYW1lIDogbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBuZXcgRWxlbWVudCQxKHRoaXMuZG9jdW1lbnQsIHZpZXdOYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB2aWV3IGVsZW1lbnQncyBjb250ZW50IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgcmF3IGRhdGEuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3RWxlbWVudCBWaWV3IGVsZW1lbnQgdG8gY2hlY2suXG5cdCAqIEBwYXJhbSBvcHRpb25zIENvbnZlcnNpb24gb3B0aW9ucy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9tY29udmVydGVyfkRvbUNvbnZlcnRlciNkb21Ub1ZpZXd9IG9wdGlvbnMgcGFyYW1ldGVyLlxuXHQgKi8gX2lzVmlld0VsZW1lbnRXaXRoUmF3Q29udGVudCh2aWV3RWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy53aXRoQ2hpbGRyZW4gIT09IGZhbHNlICYmIHZpZXdFbGVtZW50LmlzKCdlbGVtZW50JykgJiYgISF0aGlzLl9yYXdDb250ZW50RWxlbWVudE1hdGNoZXIubWF0Y2godmlld0VsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgYSBnaXZlbiBlbGVtZW50IG5hbWUgc2hvdWxkIGJlIHJlbmFtZWQgaW4gYSBjdXJyZW50IHJlbmRlcmluZyBtb2RlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudE5hbWUgVGhlIG5hbWUgb2YgdmlldyBlbGVtZW50LlxuXHQgKi8gX3Nob3VsZFJlbmFtZUVsZW1lbnQoZWxlbWVudE5hbWUpIHtcbiAgICAgICAgY29uc3QgbmFtZSA9IGVsZW1lbnROYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbmRlcmluZ01vZGUgPT09ICdlZGl0aW5nJyAmJiB0aGlzLnVuc2FmZUVsZW1lbnRzLmluY2x1ZGVzKG5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJuIGEgPHNwYW4+IGVsZW1lbnQgd2l0aCBhIHNwZWNpYWwgYXR0cmlidXRlIGhvbGRpbmcgdGhlIG5hbWUgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQuXG5cdCAqIE9wdGlvbmFsbHksIGNvcHkgYWxsIHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBvcmlnaW5hbCBlbGVtZW50IGlmIHRoYXQgZWxlbWVudCBpcyBwcm92aWRlZC5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnROYW1lIFRoZSBuYW1lIG9mIHZpZXcgZWxlbWVudC5cblx0ICogQHBhcmFtIG9yaWdpbmFsRG9tRWxlbWVudCBUaGUgb3JpZ2luYWwgRE9NIGVsZW1lbnQgdG8gY29weSBhdHRyaWJ1dGVzIGFuZCBjb250ZW50IGZyb20uXG5cdCAqLyBfY3JlYXRlUmVwbGFjZW1lbnREb21FbGVtZW50KGVsZW1lbnROYW1lLCBvcmlnaW5hbERvbUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgbmV3RG9tRWxlbWVudCA9IHRoaXMuX2RvbURvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgLy8gTWFyayB0aGUgc3BhbiByZXBsYWNpbmcgYSBzY3JpcHQgYXMgaGlkZGVuLlxuICAgICAgICBuZXdEb21FbGVtZW50LnNldEF0dHJpYnV0ZShVTlNBRkVfRUxFTUVOVF9SRVBMQUNFTUVOVF9BVFRSSUJVVEUsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgaWYgKG9yaWdpbmFsRG9tRWxlbWVudCkge1xuICAgICAgICAgICAgd2hpbGUob3JpZ2luYWxEb21FbGVtZW50LmZpcnN0Q2hpbGQpe1xuICAgICAgICAgICAgICAgIG5ld0RvbUVsZW1lbnQuYXBwZW5kQ2hpbGQob3JpZ2luYWxEb21FbGVtZW50LmZpcnN0Q2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGVOYW1lIG9mIG9yaWdpbmFsRG9tRWxlbWVudC5nZXRBdHRyaWJ1dGVOYW1lcygpKXtcbiAgICAgICAgICAgICAgICBuZXdEb21FbGVtZW50LnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBvcmlnaW5hbERvbUVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3RG9tRWxlbWVudDtcbiAgICB9XG59XG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbi5cbiAqIFVzZWQgdG8gY2hlY2sgaWYgZ2l2ZW4gbmF0aXZlIGBFbGVtZW50YCBvciBgVGV4dGAgbm9kZSBoYXMgcGFyZW50IHdpdGggdGFnIG5hbWUgZnJvbSBgdHlwZXNgIGFycmF5LlxuICpcbiAqIEByZXR1cm5zYHRydWVgIGlmIHN1Y2ggcGFyZW50IGV4aXN0cyBvciBgZmFsc2VgIGlmIGl0IGRvZXMgbm90LlxuICovIGZ1bmN0aW9uIF9oYXNWaWV3UGFyZW50T2ZUeXBlKG5vZGUsIHR5cGVzKSB7XG4gICAgcmV0dXJuIG5vZGUuZ2V0QW5jZXN0b3JzKCkuc29tZSgocGFyZW50KT0+cGFyZW50LmlzKCdlbGVtZW50JykgJiYgdHlwZXMuaW5jbHVkZXMocGFyZW50Lm5hbWUpKTtcbn1cbi8qKlxuICogQSBoZWxwZXIgdGhhdCBleGVjdXRlcyBnaXZlbiBjYWxsYmFjayBmb3IgZWFjaCBET00gbm9kZSdzIGFuY2VzdG9yLCBzdGFydGluZyBmcm9tIHRoZSBnaXZlbiBub2RlXG4gKiBhbmQgZW5kaW5nIGluIGRvY3VtZW50I2RvY3VtZW50RWxlbWVudC5cbiAqXG4gKiBAcGFyYW0gY2FsbGJhY2sgQSBjYWxsYmFjayB0byBiZSBleGVjdXRlZCBmb3IgZWFjaCBhbmNlc3Rvci5cbiAqLyBmdW5jdGlvbiBmb3JFYWNoRG9tRWxlbWVudEFuY2VzdG9yKGVsZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgbGV0IG5vZGUgPSBlbGVtZW50O1xuICAgIHdoaWxlKG5vZGUpe1xuICAgICAgICBjYWxsYmFjayhub2RlKTtcbiAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50RWxlbWVudDtcbiAgICB9XG59XG4vKipcbiAqIENoZWNrcyBpZiBnaXZlbiBET00gbm9kZSBpcyBhIG5ic3AgYmxvY2sgZmlsbGVyLlxuICpcbiAqIEEgJm5ic3A7IGlzIGEgYmxvY2sgZmlsbGVyIG9ubHkgaWYgaXQgaXMgYSBzaW5nbGUgY2hpbGQgb2YgYSBibG9jayBlbGVtZW50LlxuICpcbiAqIEBwYXJhbSBkb21Ob2RlIERPTSBub2RlLlxuICovIGZ1bmN0aW9uIGlzTmJzcEJsb2NrRmlsbGVyKGRvbU5vZGUsIGJsb2NrRWxlbWVudHMpIHtcbiAgICBjb25zdCBpc05CU1AgPSBkb21Ob2RlLmlzRXF1YWxOb2RlKE5CU1BfRklMTEVSX1JFRik7XG4gICAgcmV0dXJuIGlzTkJTUCAmJiBoYXNCbG9ja1BhcmVudChkb21Ob2RlLCBibG9ja0VsZW1lbnRzKSAmJiBkb21Ob2RlLnBhcmVudE5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT09IDE7XG59XG4vKipcbiAqIENoZWNrcyBpZiBkb21Ob2RlIGhhcyBibG9jayBwYXJlbnQuXG4gKlxuICogQHBhcmFtIGRvbU5vZGUgRE9NIG5vZGUuXG4gKi8gZnVuY3Rpb24gaGFzQmxvY2tQYXJlbnQoZG9tTm9kZSwgYmxvY2tFbGVtZW50cykge1xuICAgIGNvbnN0IHBhcmVudCA9IGRvbU5vZGUucGFyZW50Tm9kZTtcbiAgICByZXR1cm4gISFwYXJlbnQgJiYgISFwYXJlbnQudGFnTmFtZSAmJiBibG9ja0VsZW1lbnRzLmluY2x1ZGVzKHBhcmVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgZ2l2ZW4gdmlldyBub2RlIGlzIGEgbmJzcCBibG9jayBmaWxsZXIuXG4gKlxuICogQSAmbmJzcDsgaXMgYSBibG9jayBmaWxsZXIgb25seSBpZiBpdCBpcyBhIHNpbmdsZSBjaGlsZCBvZiBhIGJsb2NrIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gaXNWaWV3TmJzcEZpbGxlcihwYXJlbnQsIGRhdGEsIGJsb2NrRWxlbWVudHMpIHtcbiAgICByZXR1cm4gZGF0YSA9PSAnXFx1MDBBMCcgJiYgcGFyZW50ICYmIHBhcmVudC5pcygnZWxlbWVudCcpICYmIHBhcmVudC5jaGlsZENvdW50ID09IDEgJiYgYmxvY2tFbGVtZW50cy5pbmNsdWRlcyhwYXJlbnQubmFtZSk7XG59XG4vKipcbiAqIENoZWNrcyBpZiBnaXZlbiB2aWV3IG5vZGUgaXMgYSBtYXJrZWQtbmJzcCBibG9jayBmaWxsZXIuXG4gKlxuICogQSAmbmJzcDsgaXMgYSBibG9jayBmaWxsZXIgb25seSBpZiBpdCBpcyB3cmFwcGVkIGluIGA8c3BhbiBkYXRhLWNrZS1maWxsZXI9XCJ0cnVlXCI+YCBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGlzVmlld01hcmtlZE5ic3BGaWxsZXIocGFyZW50LCBkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEgPT0gJ1xcdTAwQTAnICYmIHBhcmVudCAmJiBwYXJlbnQuaXMoJ2VsZW1lbnQnLCAnc3BhbicpICYmIHBhcmVudC5jaGlsZENvdW50ID09IDEgJiYgcGFyZW50Lmhhc0F0dHJpYnV0ZSgnZGF0YS1ja2UtZmlsbGVyJyk7XG59XG4vKipcbiAqIENoZWNrcyBpZiBnaXZlbiB2aWV3IG5vZGUgaXMgYSBiciBibG9jayBmaWxsZXIuXG4gKlxuICogQSA8YnI+IGlzIGEgYmxvY2sgZmlsbGVyIG9ubHkgaWYgaXQgaGFzIGRhdGEtY2tlLWZpbGxlciBhdHRyaWJ1dGUgc2V0LlxuICovIGZ1bmN0aW9uIGlzVmlld0JyRmlsbGVyKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5pcygnZWxlbWVudCcsICdicicpICYmIG5vZGUuaGFzQXR0cmlidXRlKCdkYXRhLWNrZS1maWxsZXInKTtcbn1cbi8qKlxuICogU3BlY2lhbCBjYXNlIGZvciBgPHA+PGJyPjwvcD5gIGluIHdoaWNoIGA8YnI+YCBzaG91bGQgYmUgdHJlYXRlZCBhcyBmaWxsZXIgZXZlbiB3aGVuIHdlIGFyZSBub3QgaW4gdGhlICdicicgbW9kZS5cbiAqLyBmdW5jdGlvbiBpc09ubHlCckluQmxvY2soZG9tTm9kZSwgYmxvY2tFbGVtZW50cykge1xuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy81NTY0LlxuICAgIHJldHVybiBkb21Ob2RlLnRhZ05hbWUgPT09ICdCUicgJiYgaGFzQmxvY2tQYXJlbnQoZG9tTm9kZSwgYmxvY2tFbGVtZW50cykgJiYgZG9tTm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxO1xufVxuLyoqXG4gKiBMb2cgdG8gY29uc29sZSB0aGUgaW5mb3JtYXRpb24gYWJvdXQgZWxlbWVudCB0aGF0IHdhcyByZXBsYWNlZC5cbiAqIENoZWNrIFVOU0FGRV9FTEVNRU5UUyBmb3IgYWxsIHJlY29nbml6ZWQgdW5zYWZlIGVsZW1lbnRzLlxuICpcbiAqIEBwYXJhbSBlbGVtZW50TmFtZSBUaGUgbmFtZSBvZiB0aGUgdmlldyBlbGVtZW50LlxuICovIGZ1bmN0aW9uIF9sb2dVbnNhZmVFbGVtZW50KGVsZW1lbnROYW1lKSB7XG4gICAgaWYgKGVsZW1lbnROYW1lID09PSAnc2NyaXB0Jykge1xuICAgICAgICBsb2dXYXJuaW5nKCdkb21jb252ZXJ0ZXItdW5zYWZlLXNjcmlwdC1lbGVtZW50LWRldGVjdGVkJyk7XG4gICAgfVxuICAgIGlmIChlbGVtZW50TmFtZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICBsb2dXYXJuaW5nKCdkb21jb252ZXJ0ZXItdW5zYWZlLXN0eWxlLWVsZW1lbnQtZGV0ZWN0ZWQnKTtcbiAgICB9XG59XG4vKipcbiAqIEluIGNlcnRhaW4gY2FzZXMsIEZpcmVmb3ggbXlzdGVyaW91c2x5IGFzc2lnbnMgc28gY2FsbGVkIFwicmVzdHJpY3RlZCBvYmplY3RzXCIgdG8gbmF0aXZlIERPTSBSYW5nZSBwcm9wZXJ0aWVzLlxuICogQW55IGF0dGVtcHQgYXQgYWNjZXNzaW5nIHJlc3RyaWN0ZWQgb2JqZWN0J3MgcHJvcGVydGllcyBjYXVzZXMgZXJyb3JzLlxuICogU2VlOiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy85NjM1LlxuICovIGZ1bmN0aW9uIGlzR2Vja29SZXN0cmljdGVkRG9tU2VsZWN0aW9uKGRvbVNlbGVjdGlvbikge1xuICAgIGlmICghZW52LmlzR2Vja28pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIWRvbVNlbGVjdGlvbi5yYW5nZUNvdW50KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9tU2VsZWN0aW9uLmdldFJhbmdlQXQoMCkuc3RhcnRDb250YWluZXI7XG4gICAgdHJ5IHtcbiAgICAgICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGNvbnRhaW5lcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbiAvKipcbiAqIFdoaWxlIHJlbmRlcmluZyB0aGUgZWRpdG9yIGNvbnRlbnQsIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXJ9IGRldGVjdGVkIGEgYDxzY3JpcHQ+YCBlbGVtZW50IHRoYXQgbWF5XG4gKiBkaXNydXB0IHRoZSBlZGl0aW5nIGV4cGVyaWVuY2UuIFRvIGF2b2lkIHRoaXMsIHRoZSBgPHNjcmlwdD5gIGVsZW1lbnQgd2FzIHJlcGxhY2VkIHdpdGggYDxzcGFuIGRhdGEtY2stdW5zYWZlLWVsZW1lbnQ9XCJzY3JpcHRcIj48L3NwYW4+YC5cbiAqXG4gKiBAZXJyb3IgZG9tY29udmVydGVyLXVuc2FmZS1zY3JpcHQtZWxlbWVudC1kZXRlY3RlZFxuICovICAvKipcbiAqIFdoaWxlIHJlbmRlcmluZyB0aGUgZWRpdG9yIGNvbnRlbnQsIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXJ9IGRldGVjdGVkIGEgYDxzdHlsZT5gIGVsZW1lbnQgdGhhdCBtYXkgYWZmZWN0XG4gKiB0aGUgZWRpdGluZyBleHBlcmllbmNlLiBUbyBhdm9pZCB0aGlzLCB0aGUgYDxzdHlsZT5gIGVsZW1lbnQgd2FzIHJlcGxhY2VkIHdpdGggYDxzcGFuIGRhdGEtY2stdW5zYWZlLWVsZW1lbnQ9XCJzdHlsZVwiPjwvc3Bhbj5gLlxuICpcbiAqIEBlcnJvciBkb21jb252ZXJ0ZXItdW5zYWZlLXN0eWxlLWVsZW1lbnQtZGV0ZWN0ZWRcbiAqLyAgLyoqXG4gKiBUaGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyfSBkZXRlY3RlZCBhbiBpbnRlcmFjdGl2ZSBhdHRyaWJ1dGUgaW4gdGhlXG4gKiB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjZWRpdGluZy1waXBlbGluZSBlZGl0aW5nIHBpcGVsaW5lfS4gRm9yIHRoZSBiZXN0XG4gKiBlZGl0aW5nIGV4cGVyaWVuY2UsIHRoZSBhdHRyaWJ1dGUgd2FzIHJlbmFtZWQgdG8gYGRhdGEtY2stdW5zYWZlLWF0dHJpYnV0ZS1bb3JpZ2luYWwgYXR0cmlidXRlIG5hbWVdYC5cbiAqXG4gKiBJZiB5b3UgYXJlIHRoZSBhdXRob3Igb2YgdGhlIHBsdWdpbiB0aGF0IGdlbmVyYXRlZCB0aGlzIGF0dHJpYnV0ZSBhbmQgeW91IHdhbnQgaXQgdG8gYmUgcHJlc2VydmVkXG4gKiBpbiB0aGUgZWRpdGluZyBwaXBlbGluZSwgeW91IGNhbiBjb25maWd1cmUgdGhpcyB3aGVuIGNyZWF0aW5nIHRoZSBlbGVtZW50XG4gKiB1c2luZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyfSBkdXJpbmcgdGhlXG4gKiB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjY29udmVyc2lvbiBtb2RlbOKAk3ZpZXcgY29udmVyc2lvbn0uIE1ldGhvZHMgc3VjaCBhc1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb3duY2FzdHdyaXRlcn5Eb3duY2FzdFdyaXRlciNjcmVhdGVDb250YWluZXJFbGVtZW50fSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlQXR0cmlidXRlRWxlbWVudH0sIG9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyI2NyZWF0ZUVtcHR5RWxlbWVudH1cbiAqIGFjY2VwdCBhbiBvcHRpb24gdGhhdCB3aWxsIGRpc2FibGUgZmlsdGVyaW5nIG9mIHNwZWNpZmljIGF0dHJpYnV0ZXM6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAncCcsXG4gKiBcdHtcbiAqIFx0XHRjbGFzczogJ2NsaWNrYWJsZS1wYXJhZ3JhcGgnLFxuICogXHRcdG9uY2xpY2s6ICdhbGVydCggXCJQYXJhZ3JhcGggY2xpY2tlZCFcIiApJ1xuICogXHR9LFxuICogXHR7XG4gKiBcdFx0Ly8gTWFrZSBzdXJlIHRoZSBcIm9uY2xpY2tcIiBhdHRyaWJ1dGUgd2lsbCBwYXNzIHRocm91Z2guXG4gKiBcdFx0cmVuZGVyVW5zYWZlQXR0cmlidXRlczogWyAnb25jbGljaycgXVxuICogXHR9XG4gKiApO1xuICogYGBgXG4gKlxuICogQGVycm9yIGRvbWNvbnZlcnRlci11bnNhZmUtYXR0cmlidXRlLWRldGVjdGVkXG4gKiBAcGFyYW0gZG9tRWxlbWVudCBUaGUgRE9NIGVsZW1lbnQgdGhlIGF0dHJpYnV0ZSB3YXMgc2V0IG9uLlxuICogQHBhcmFtIGtleSBUaGUgb3JpZ2luYWwgbmFtZSBvZiB0aGUgYXR0cmlidXRlXG4gKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBvcmlnaW5hbCBhdHRyaWJ1dGVcbiAqL1xuXG4vKipcbiAqIEFic3RyYWN0IGJhc2Ugb2JzZXJ2ZXIgY2xhc3MuIE9ic2VydmVycyBhcmUgY2xhc3NlcyB3aGljaCBsaXN0ZW4gdG8gRE9NIGV2ZW50cywgZG8gdGhlIHByZWxpbWluYXJ5XG4gKiBwcm9jZXNzaW5nIGFuZCBmaXJlIGV2ZW50cyBvbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudH0gb2JqZWN0cy5cbiAqIE9ic2VydmVycyBjYW4gYWxzbyBhZGQgZmVhdHVyZXMgdG8gdGhlIHZpZXcsIGZvciBpbnN0YW5jZSBieSB1cGRhdGluZyBpdHMgc3RhdHVzIG9yIG1hcmtpbmcgZWxlbWVudHNcbiAqIHdoaWNoIG5lZWQgYSByZWZyZXNoIG9uIERPTSBldmVudHMuXG4gKi8gY2xhc3MgT2JzZXJ2ZXIgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRG9tRW1pdHRlck1peGluKCkge1xuICAgIC8qKlxuXHQgKiBBbiBpbnN0YW5jZSBvZiB0aGUgdmlldyBjb250cm9sbGVyLlxuXHQgKi8gdmlldztcbiAgICAvKipcblx0ICogQSByZWZlcmVuY2UgdG8gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnR9IG9iamVjdC5cblx0ICovIGRvY3VtZW50O1xuICAgIC8qKlxuXHQgKiBUaGUgc3RhdGUgb2YgdGhlIG9ic2VydmVyLiBJZiBpdCBpcyBkaXNhYmxlZCwgbm8gZXZlbnRzIHdpbGwgYmUgZmlyZWQuXG5cdCAqLyBfaXNFbmFibGVkID0gZmFsc2U7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIG9ic2VydmVyLlxuXHQgKi8gY29uc3RydWN0b3Iodmlldyl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMudmlldyA9IHZpZXc7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIHN0YXRlIG9mIHRoZSBvYnNlcnZlci4gSWYgaXQgaXMgZGlzYWJsZWQsIG5vIGV2ZW50cyB3aWxsIGJlIGZpcmVkLlxuXHQgKi8gZ2V0IGlzRW5hYmxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEVuYWJsZXMgdGhlIG9ic2VydmVyLiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbiB0aGUgb2JzZXJ2ZXIgaXMgcmVnaXN0ZXJlZCB0byB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXd9IGFuZCBhZnRlciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNmb3JjZVJlbmRlciByZW5kZXJpbmd9XG5cdCAqIChhbGwgb2JzZXJ2ZXJzIGFyZSB7QGxpbmsgI2Rpc2FibGUgZGlzYWJsZWR9IGJlZm9yZSByZW5kZXJpbmcpLlxuXHQgKlxuXHQgKiBBIHR5cGljYWwgdXNlIGNhc2UgZm9yIGRpc2FibGluZyBvYnNlcnZlcnMgaXMgdGhhdCBtdXRhdGlvbiBvYnNlcnZlcnMgbmVlZCB0byBiZSBkaXNhYmxlZCBmb3IgdGhlIHJlbmRlcmluZy5cblx0ICogSG93ZXZlciwgYSBjaGlsZCBjbGFzcyBtYXkgbm90IG5lZWQgdG8gYmUgZGlzYWJsZWQsIHNvIGl0IGNhbiBpbXBsZW1lbnQgYW4gZW1wdHkgbWV0aG9kLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9vYnNlcnZlcn5PYnNlcnZlciNkaXNhYmxlXG5cdCAqLyBlbmFibGUoKSB7XG4gICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEaXNhYmxlcyB0aGUgb2JzZXJ2ZXIuIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBiZWZvcmVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZm9yY2VSZW5kZXIgcmVuZGVyaW5nfSB0byBwcmV2ZW50IGZpcmluZyBldmVudHMgZHVyaW5nIHJlbmRlcmluZy5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIjZW5hYmxlXG5cdCAqLyBkaXNhYmxlKCkge1xuICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERpc2FibGVzIGFuZCBkZXN0cm95cyB0aGUgb2JzZXJ2ZXIsIGFtb25nIG90aGVycyByZW1vdmVzIGV2ZW50IGxpc3RlbmVycyBjcmVhdGVkIGJ5IHRoZSBvYnNlcnZlci5cblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZSgpO1xuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIGEgZ2l2ZW4gRE9NIGV2ZW50IHNob3VsZCBiZSBpZ25vcmVkIChzaG91bGQgbm90IGJlIHR1cm5lZCBpbnRvIGEgc3ludGhldGljIHZpZXcgZG9jdW1lbnQgZXZlbnQpLlxuXHQgKlxuXHQgKiBDdXJyZW50bHksIGFuIGV2ZW50IHdpbGwgYmUgaWdub3JlZCBvbmx5IGlmIGl0cyB0YXJnZXQgb3IgYW55IG9mIGl0cyBhbmNlc3RvcnMgaGFzIHRoZSBgZGF0YS1ja2UtaWdub3JlLWV2ZW50c2AgYXR0cmlidXRlLlxuXHQgKiBUaGlzIGF0dHJpYnV0ZSBjYW4gYmUgdXNlZCBpbnNpZGUgdGhlIHN0cnVjdHVyZXMgZ2VuZXJhdGVkIGJ5XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIjY3JlYXRlVUlFbGVtZW50IGBEb3duY2FzdFdyaXRlciNjcmVhdGVVSUVsZW1lbnQoKWB9IHRvIGlnbm9yZSBldmVudHNcblx0ICogZmlyZWQgd2l0aGluIGEgVUkgdGhhdCBzaG91bGQgYmUgZXhjbHVkZWQgZnJvbSBDS0VkaXRvciA1J3MgcmVhbG1zLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tVGFyZ2V0IFRoZSBET00gZXZlbnQgdGFyZ2V0IHRvIGNoZWNrICh1c3VhbGx5IGFuIGVsZW1lbnQsIHNvbWV0aW1lcyBhIHRleHQgbm9kZSBhbmRcblx0ICogcG90ZW50aWFsbHkgc29tZXRpbWVzIGEgZG9jdW1lbnQsIHRvbykuXG5cdCAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBldmVudCBzaG91bGQgYmUgaWdub3JlZCBieSB0aGUgb2JzZXJ2ZXIuXG5cdCAqLyBjaGVja1Nob3VsZElnbm9yZUV2ZW50RnJvbVRhcmdldChkb21UYXJnZXQpIHtcbiAgICAgICAgaWYgKGRvbVRhcmdldCAmJiBkb21UYXJnZXQubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIGRvbVRhcmdldCA9IGRvbVRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZG9tVGFyZ2V0IHx8IGRvbVRhcmdldC5ub2RlVHlwZSAhPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkb21UYXJnZXQubWF0Y2hlcygnW2RhdGEtY2tlLWlnbm9yZS1ldmVudHNdLCBbZGF0YS1ja2UtaWdub3JlLWV2ZW50c10gKicpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbmZvcm1hdGlvbiBhYm91dCBhIERPTSBldmVudCBpbiBjb250ZXh0IG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50fS5cbiAqIEl0IHdyYXBzIHRoZSBuYXRpdmUgZXZlbnQsIHdoaWNoIHVzdWFsbHkgc2hvdWxkIG5vdCBiZSB1c2VkIGFzIHRoZSB3cmFwcGVyIGNvbnRhaW5zXG4gKiBhZGRpdGlvbmFsIGRhdGEgKGxpa2Uga2V5IGNvZGUgZm9yIGtleWJvYXJkIGV2ZW50cykuXG4gKlxuICogQHR5cGVQYXJhbSBURXZlbnQgVGhlIHR5cGUgb2YgRE9NIEV2ZW50IHRoYXQgdGhpcyBjbGFzcyByZXByZXNlbnRzLlxuICovIGNsYXNzIERvbUV2ZW50RGF0YSB7XG4gICAgLyoqXG5cdCAqIEluc3RhbmNlIG9mIHRoZSB2aWV3IGNvbnRyb2xsZXIuXG5cdCAqLyB2aWV3O1xuICAgIC8qKlxuXHQgKiBUaGUgaW5zdGFuY2Ugb2YgdGhlIGRvY3VtZW50LlxuXHQgKi8gZG9jdW1lbnQ7XG4gICAgLyoqXG5cdCAqIFRoZSBET00gZXZlbnQuXG5cdCAqLyBkb21FdmVudDtcbiAgICAvKipcblx0ICogVGhlIERPTSB0YXJnZXQuXG5cdCAqLyBkb21UYXJnZXQ7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSB2aWV3IFRoZSBpbnN0YW5jZSBvZiB0aGUgdmlldyBjb250cm9sbGVyLlxuXHQgKiBAcGFyYW0gZG9tRXZlbnQgVGhlIERPTSBldmVudC5cblx0ICogQHBhcmFtIGFkZGl0aW9uYWxEYXRhIEFkZGl0aW9uYWwgcHJvcGVydGllcyB0aGF0IHRoZSBpbnN0YW5jZSBzaG91bGQgY29udGFpbi5cblx0ICovIGNvbnN0cnVjdG9yKHZpZXcsIGRvbUV2ZW50LCBhZGRpdGlvbmFsRGF0YSl7XG4gICAgICAgIHRoaXMudmlldyA9IHZpZXc7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50O1xuICAgICAgICB0aGlzLmRvbUV2ZW50ID0gZG9tRXZlbnQ7XG4gICAgICAgIHRoaXMuZG9tVGFyZ2V0ID0gZG9tRXZlbnQudGFyZ2V0O1xuICAgICAgICBleHRlbmQodGhpcywgYWRkaXRpb25hbERhdGEpO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIHRyZWUgdmlldyBlbGVtZW50IHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0LlxuXHQgKi8gZ2V0IHRhcmdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5kb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KHRoaXMuZG9tVGFyZ2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFByZXZlbnRzIHRoZSBuYXRpdmUncyBldmVudCBkZWZhdWx0IGFjdGlvbi5cblx0ICovIHByZXZlbnREZWZhdWx0KCkge1xuICAgICAgICB0aGlzLmRvbUV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTdG9wcyBuYXRpdmUgZXZlbnQgcHJvcGFnYXRpb24uXG5cdCAqLyBzdG9wUHJvcGFnYXRpb24oKSB7XG4gICAgICAgIHRoaXMuZG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEJhc2UgY2xhc3MgZm9yIERPTSBldmVudCBvYnNlcnZlcnMuIFRoaXMgY2xhc3MgaGFuZGxlc1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9vYnNlcnZlcn5PYnNlcnZlciNvYnNlcnZlIGFkZGluZ30gbGlzdGVuZXJzIHRvIERPTSBlbGVtZW50cyxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIjZGlzYWJsZSBkaXNhYmxpbmd9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9vYnNlcnZlcn5PYnNlcnZlciNlbmFibGUgcmUtZW5hYmxpbmd9IGV2ZW50cy5cbiAqIENoaWxkIGNsYXNzIG5lZWRzIHRvIGRlZmluZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9kb21ldmVudG9ic2VydmVyfkRvbUV2ZW50T2JzZXJ2ZXIjZG9tRXZlbnRUeXBlIERPTSBldmVudCB0eXBlfSBhbmRcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvZG9tZXZlbnRvYnNlcnZlcn5Eb21FdmVudE9ic2VydmVyI29uRG9tRXZlbnQgY2FsbGJhY2t9LlxuICpcbiAqIEZvciBpbnN0YW5jZTpcbiAqXG4gKiBgYGB0c1xuICogY2xhc3MgQ2xpY2tPYnNlcnZlciBleHRlbmRzIERvbUV2ZW50T2JzZXJ2ZXI8J2NsaWNrJz4ge1xuICogXHQvLyBJdCBjYW4gYWxzbyBiZSBkZWZpbmVkIGFzIGEgbm9ybWFsIHByb3BlcnR5IGluIHRoZSBjb25zdHJ1Y3Rvci5cbiAqIFx0Z2V0IGRvbUV2ZW50VHlwZSgpOiAnY2xpY2snIHtcbiAqIFx0XHRyZXR1cm4gJ2NsaWNrJztcbiAqIFx0fVxuICpcbiAqIFx0b25Eb21FdmVudCggZG9tRXZlbnQ6IE1vdXNlRXZlbnQgKTogdm9pZCB7XG4gKiBcdFx0dGhpcy5maXJlKCAnY2xpY2snLCBkb21FdmVudCApO1xuICogXHR9XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBAdHlwZVBhcmFtIEV2ZW50VHlwZSBET00gRXZlbnQgdHlwZSBuYW1lIG9yIGFuIHVuaW9uIG9mIHRob3NlLlxuICogQHR5cGVQYXJhbSBBZGRpdGlvbmFsRGF0YSBBZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGFsb25nIHdpdGggdGhlIGV2ZW50LlxuICovIGNsYXNzIERvbUV2ZW50T2JzZXJ2ZXIgZXh0ZW5kcyBPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIElmIHNldCB0byBgdHJ1ZWAgRE9NIGV2ZW50cyB3aWxsIGJlIGxpc3RlbmVkIG9uIHRoZSBjYXB0dXJpbmcgcGhhc2UuXG5cdCAqIERlZmF1bHQgdmFsdWUgaXMgYGZhbHNlYC5cblx0ICovIHVzZUNhcHR1cmUgPSBmYWxzZTtcbiAgICAvKipcblx0ICogSWYgc2V0IHRvIGB0cnVlYCwgaW5kaWNhdGVzIHRoYXQgdGhlIGZ1bmN0aW9uIHNwZWNpZmllZCBieSBsaXN0ZW5lciB3aWxsIG5ldmVyIGNhbGwgYHByZXZlbnREZWZhdWx0KClgLlxuXHQgKiBEZWZhdWx0IHZhbHVlIGlzIGBmYWxzZWAuXG5cdCAqLyB1c2VQYXNzaXZlID0gZmFsc2U7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvYnNlcnZlKGRvbUVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgdHlwZXMgPSB0eXBlb2YgdGhpcy5kb21FdmVudFR5cGUgPT0gJ3N0cmluZycgPyBbXG4gICAgICAgICAgICB0aGlzLmRvbUV2ZW50VHlwZVxuICAgICAgICBdIDogdGhpcy5kb21FdmVudFR5cGU7XG4gICAgICAgIHR5cGVzLmZvckVhY2goKHR5cGUpPT57XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKGRvbUVsZW1lbnQsIHR5cGUsIChldmVudEluZm8sIGRvbUV2ZW50KT0+e1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRW5hYmxlZCAmJiAhdGhpcy5jaGVja1Nob3VsZElnbm9yZUV2ZW50RnJvbVRhcmdldChkb21FdmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25Eb21FdmVudChkb21FdmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRoaXMudXNlQ2FwdHVyZSxcbiAgICAgICAgICAgICAgICB1c2VQYXNzaXZlOiB0aGlzLnVzZVBhc3NpdmVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdG9wT2JzZXJ2aW5nKGRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKGRvbUVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2FsbHMgYERvY3VtZW50I2ZpcmUoKWAgaWYgb2JzZXJ2ZXIge0BsaW5rICNpc0VuYWJsZWQgaXMgZW5hYmxlZH0uXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOnV0aWxzL2VtaXR0ZXJtaXhpbn5FbWl0dGVyI2ZpcmVcblx0ICogQHBhcmFtIGV2ZW50VHlwZSBUaGUgZXZlbnQgdHlwZSAobmFtZSkuXG5cdCAqIEBwYXJhbSBkb21FdmVudCBUaGUgRE9NIGV2ZW50LlxuXHQgKiBAcGFyYW0gYWRkaXRpb25hbERhdGEgVGhlIGFkZGl0aW9uYWwgZGF0YSB3aGljaCBzaG91bGQgZXh0ZW5kIHRoZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2RvbWV2ZW50ZGF0YX5Eb21FdmVudERhdGEgZXZlbnQgZGF0YX0gb2JqZWN0LlxuXHQgKi8gZmlyZShldmVudFR5cGUsIGRvbUV2ZW50LCBhZGRpdGlvbmFsRGF0YSkge1xuICAgICAgICBpZiAodGhpcy5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuZmlyZShldmVudFR5cGUsIG5ldyBEb21FdmVudERhdGEodGhpcy52aWV3LCBkb21FdmVudCwgYWRkaXRpb25hbERhdGEpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBPYnNlcnZlciBmb3IgZXZlbnRzIGNvbm5lY3RlZCB3aXRoIHByZXNzaW5nIGtleWJvYXJkIGtleXMuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgb2JzZXJ2ZXIgaXMgYXR0YWNoZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fSBhbmQgaXMgYXZhaWxhYmxlIGJ5IGRlZmF1bHQuXG4gKi8gY2xhc3MgS2V5T2JzZXJ2ZXIgZXh0ZW5kcyBEb21FdmVudE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRvbUV2ZW50VHlwZSA9IFtcbiAgICAgICAgJ2tleWRvd24nLFxuICAgICAgICAna2V5dXAnXG4gICAgXTtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIG9uRG9tRXZlbnQoZG9tRXZ0KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICBrZXlDb2RlOiBkb21FdnQua2V5Q29kZSxcbiAgICAgICAgICAgIGFsdEtleTogZG9tRXZ0LmFsdEtleSxcbiAgICAgICAgICAgIGN0cmxLZXk6IGRvbUV2dC5jdHJsS2V5LFxuICAgICAgICAgICAgc2hpZnRLZXk6IGRvbUV2dC5zaGlmdEtleSxcbiAgICAgICAgICAgIG1ldGFLZXk6IGRvbUV2dC5tZXRhS2V5LFxuICAgICAgICAgICAgZ2V0IGtleXN0cm9rZSAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvZGUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlyZShkb21FdnQudHlwZSwgZG9tRXZ0LCBkYXRhKTtcbiAgICB9XG59XG5cbi8qKlxuICogRmFrZSBzZWxlY3Rpb24gb2JzZXJ2ZXIgY2xhc3MuIElmIHZpZXcgc2VsZWN0aW9uIGlzIGZha2UgaXQgaXMgcGxhY2VkIGluIGR1bW15IERPTSBjb250YWluZXIuIFRoaXMgb2JzZXJ2ZXIgbGlzdGVuc1xuICogb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDprZXlkb3duIGtleWRvd259IGV2ZW50cyBhbmQgaGFuZGxlcyBtb3ZpbmcgZmFrZSB2aWV3IHNlbGVjdGlvbiB0byB0aGUgY29ycmVjdCBwbGFjZVxuICogaWYgYXJyb3cga2V5cyBhcmUgcHJlc3NlZC5cbiAqIEZpcmVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6c2VsZWN0aW9uQ2hhbmdlIHNlbGVjdGlvbkNoYW5nZSBldmVudH0gc2ltdWxhdGluZyBuYXR1cmFsIGJlaGF2aW91ciBvZlxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9zZWxlY3Rpb25vYnNlcnZlcn5TZWxlY3Rpb25PYnNlcnZlciBTZWxlY3Rpb25PYnNlcnZlcn0uXG4gKi8gY2xhc3MgRmFrZVNlbGVjdGlvbk9ic2VydmVyIGV4dGVuZHMgT2JzZXJ2ZXIge1xuICAgIC8qKlxuXHQgKiBGaXJlcyBkZWJvdW5jZWQgZXZlbnQgYHNlbGVjdGlvbkNoYW5nZURvbmVgLiBJdCB1c2VzIGBsb2Rhc2gjZGVib3VuY2VgIG1ldGhvZCB0byBkZWxheSBmdW5jdGlvbiBjYWxsLlxuXHQgKi8gX2ZpcmVTZWxlY3Rpb25DaGFuZ2VEb25lRGVib3VuY2VkO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBGYWtlU2VsZWN0aW9uT2JzZXJ2ZXIgaW5zdGFuY2UuXG5cdCAqLyBjb25zdHJ1Y3Rvcih2aWV3KXtcbiAgICAgICAgc3VwZXIodmlldyk7XG4gICAgICAgIHRoaXMuX2ZpcmVTZWxlY3Rpb25DaGFuZ2VEb25lRGVib3VuY2VkID0gZGVib3VuY2UoKGRhdGEpPT57XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50LmZpcmUoJ3NlbGVjdGlvbkNoYW5nZURvbmUnLCBkYXRhKTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvYnNlcnZlKCkge1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IHRoaXMuZG9jdW1lbnQ7XG4gICAgICAgIGRvY3VtZW50Lm9uKCdhcnJvd0tleScsIChldmVudEluZm8sIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBkb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uLmlzRmFrZSAmJiB0aGlzLmlzRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIC8vIFByZXZlbnRzIGRlZmF1bHQga2V5IGRvd24gaGFuZGxpbmcgLSBubyBzZWxlY3Rpb24gY2hhbmdlIHdpbGwgb2NjdXIuXG4gICAgICAgICAgICAgICAgZGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBjb250ZXh0OiAnJGNhcHR1cmUnXG4gICAgICAgIH0pO1xuICAgICAgICBkb2N1bWVudC5vbignYXJyb3dLZXknLCAoZXZlbnRJbmZvLCBkYXRhKT0+e1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0Zha2UgJiYgdGhpcy5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVTZWxlY3Rpb25Nb3ZlKGRhdGEua2V5Q29kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdG9wT2JzZXJ2aW5nKCkge31cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fZmlyZVNlbGVjdGlvbkNoYW5nZURvbmVEZWJvdW5jZWQuY2FuY2VsKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIYW5kbGVzIGNvbGxhcHNpbmcgdmlldyBzZWxlY3Rpb24gYWNjb3JkaW5nIHRvIGdpdmVuIGtleSBjb2RlLiBJZiBsZWZ0IG9yIHVwIGtleSBpcyBwcm92aWRlZCAtIG5ldyBzZWxlY3Rpb24gd2lsbCBiZVxuXHQgKiBjb2xsYXBzZWQgdG8gbGVmdC4gSWYgcmlnaHQgb3IgZG93biBrZXkgaXMgcHJlc3NlZCAtIG5ldyBzZWxlY3Rpb24gd2lsbCBiZSBjb2xsYXBzZWQgdG8gcmlnaHQuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGZpcmVzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6c2VsZWN0aW9uQ2hhbmdlfSBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpzZWxlY3Rpb25DaGFuZ2VEb25lfSBldmVudHMgaW1pdGF0aW5nIGJlaGF2aW91ciBvZlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL3NlbGVjdGlvbm9ic2VydmVyflNlbGVjdGlvbk9ic2VydmVyfS5cblx0ICovIF9oYW5kbGVTZWxlY3Rpb25Nb3ZlKGtleUNvZGUpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9IG5ldyBTZWxlY3Rpb24kMShzZWxlY3Rpb24uZ2V0UmFuZ2VzKCksIHtcbiAgICAgICAgICAgIGJhY2t3YXJkOiBzZWxlY3Rpb24uaXNCYWNrd2FyZCxcbiAgICAgICAgICAgIGZha2U6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBMZWZ0IG9yIHVwIGFycm93IHByZXNzZWQgLSBtb3ZlIHNlbGVjdGlvbiB0byBzdGFydC5cbiAgICAgICAgaWYgKGtleUNvZGUgPT0ga2V5Q29kZXMuYXJyb3dsZWZ0IHx8IGtleUNvZGUgPT0ga2V5Q29kZXMuYXJyb3d1cCkge1xuICAgICAgICAgICAgbmV3U2VsZWN0aW9uLnNldFRvKG5ld1NlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJpZ2h0IG9yIGRvd24gYXJyb3cgcHJlc3NlZCAtIG1vdmUgc2VsZWN0aW9uIHRvIGVuZC5cbiAgICAgICAgaWYgKGtleUNvZGUgPT0ga2V5Q29kZXMuYXJyb3dyaWdodCB8fCBrZXlDb2RlID09IGtleUNvZGVzLmFycm93ZG93bikge1xuICAgICAgICAgICAgbmV3U2VsZWN0aW9uLnNldFRvKG5ld1NlbGVjdGlvbi5nZXRMYXN0UG9zaXRpb24oKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgIG9sZFNlbGVjdGlvbjogc2VsZWN0aW9uLFxuICAgICAgICAgICAgbmV3U2VsZWN0aW9uLFxuICAgICAgICAgICAgZG9tU2VsZWN0aW9uOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIC8vIEZpcmUgZHVtbXkgc2VsZWN0aW9uIGNoYW5nZSBldmVudC5cbiAgICAgICAgdGhpcy5kb2N1bWVudC5maXJlKCdzZWxlY3Rpb25DaGFuZ2UnLCBkYXRhKTtcbiAgICAgICAgLy8gQ2FsbGAgI19maXJlU2VsZWN0aW9uQ2hhbmdlRG9uZURlYm91bmNlZGAgZXZlcnkgdGltZSB3aGVuIGBzZWxlY3Rpb25DaGFuZ2VgIGV2ZW50IGlzIGZpcmVkLlxuICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGRlYm91bmNlZCB3aGF0IG1lYW5zIHRoYXQgYHNlbGVjdGlvbkNoYW5nZURvbmVgIGV2ZW50IHdpbGwgYmUgZmlyZWQgb25seSB3aGVuXG4gICAgICAgIC8vIGRlZmluZWQgaW50IHRoZSBmdW5jdGlvbiB0aW1lIHdpbGwgZWxhcHNlIHNpbmNlIHRoZSBsYXN0IHRpbWUgdGhlIGZ1bmN0aW9uIHdhcyBjYWxsZWQuXG4gICAgICAgIC8vIFNvIGBzZWxlY3Rpb25DaGFuZ2VEb25lYCB3aWxsIGJlIGZpcmVkIHdoZW4gc2VsZWN0aW9uIHdpbGwgc3RvcCBjaGFuZ2luZy5cbiAgICAgICAgdGhpcy5fZmlyZVNlbGVjdGlvbkNoYW5nZURvbmVEZWJvdW5jZWQoZGF0YSk7XG4gICAgfVxufVxuXG4vLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGNvbnN0IHsgX2RlYm91bmNlZExpbmUgfSA9IHJlcXVpcmUoICcuLi8uLi9kZXYtdXRpbHMvdXRpbHMuanMnICk7XG4vKipcbiAqIE11dGF0aW9uIG9ic2VydmVyJ3Mgcm9sZSBpcyB0byB3YXRjaCBmb3IgYW55IERPTSBjaGFuZ2VzIGluc2lkZSB0aGUgZWRpdG9yIHRoYXQgd2VyZW4ndFxuICogZG9uZSBieSB0aGUgZWRpdG9yJ3Mge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlcn0gaXRzZWxmIGFuZCByZXZlcnRpbmcgdGhlc2UgY2hhbmdlcy5cbiAqXG4gKiBJdCBkb2VzIHRoaXMgYnkgb2JzZXJ2aW5nIGFsbCBtdXRhdGlvbnMgaW4gdGhlIERPTSwgbWFya2luZyByZWxhdGVkIHZpZXcgZWxlbWVudHMgYXMgY2hhbmdlZCBhbmQgY2FsbGluZ1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlciNyZW5kZXJ9LiBCZWNhdXNlIGFsbCBtdXRhdGVkIG5vZGVzIGFyZSBtYXJrZWQgYXNcbiAqIFwidG8gYmUgcmVuZGVyZWRcIiBhbmQgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmVuZGVyZXJ+UmVuZGVyZXIjcmVuZGVyIGByZW5kZXIoKWB9IG1ldGhvZCBpcyBjYWxsZWQsXG4gKiBhbGwgY2hhbmdlcyBhcmUgcmV2ZXJ0ZWQgaW4gdGhlIERPTSAodGhlIERPTSBpcyBzeW5jZWQgd2l0aCB0aGUgZWRpdG9yJ3MgdmlldyBzdHJ1Y3R1cmUpLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIG9ic2VydmVyIGlzIGF0dGFjaGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gYW5kIGlzIGF2YWlsYWJsZSBieSBkZWZhdWx0LlxuICovIGNsYXNzIE11dGF0aW9uT2JzZXJ2ZXIgZXh0ZW5kcyBPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIFJlZmVyZW5jZSB0byB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjZG9tQ29udmVydGVyfS5cblx0ICovIGRvbUNvbnZlcnRlcjtcbiAgICAvKipcblx0ICogTmF0aXZlIG11dGF0aW9uIG9ic2VydmVyIGNvbmZpZy5cblx0ICovIF9jb25maWc7XG4gICAgLyoqXG5cdCAqIE9ic2VydmVkIERPTSBlbGVtZW50cy5cblx0ICovIF9kb21FbGVtZW50cztcbiAgICAvKipcblx0ICogTmF0aXZlIG11dGF0aW9uIG9ic2VydmVyLlxuXHQgKi8gX211dGF0aW9uT2JzZXJ2ZXI7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBjb25zdHJ1Y3Rvcih2aWV3KXtcbiAgICAgICAgc3VwZXIodmlldyk7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IHtcbiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXG4gICAgICAgICAgICBzdWJ0cmVlOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyID0gdmlldy5kb21Db252ZXJ0ZXI7XG4gICAgICAgIHRoaXMuX2RvbUVsZW1lbnRzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLl9tdXRhdGlvbk9ic2VydmVyID0gbmV3IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyKHRoaXMuX29uTXV0YXRpb25zLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICAvKipcblx0ICogU3luY2hyb25vdXNseSBoYW5kbGVzIG11dGF0aW9ucyBhbmQgZW1wdGllcyB0aGUgcXVldWUuXG5cdCAqLyBmbHVzaCgpIHtcbiAgICAgICAgdGhpcy5fb25NdXRhdGlvbnModGhpcy5fbXV0YXRpb25PYnNlcnZlci50YWtlUmVjb3JkcygpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvYnNlcnZlKGRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fZG9tRWxlbWVudHMuYWRkKGRvbUVsZW1lbnQpO1xuICAgICAgICBpZiAodGhpcy5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX211dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShkb21FbGVtZW50LCB0aGlzLl9jb25maWcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RvcE9ic2VydmluZyhkb21FbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2RvbUVsZW1lbnRzLmRlbGV0ZShkb21FbGVtZW50KTtcbiAgICAgICAgaWYgKHRoaXMuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICAvLyBVbmZvcnR1bmF0ZWx5LCBpdCBpcyBub3QgcG9zc2libGUgdG8gc3RvcCBvYnNlcnZpbmcgcGFydGljdWxhciBET00gZWxlbWVudC5cbiAgICAgICAgICAgIC8vIEluIG9yZGVyIHRvIHN0b3Agb2JzZXJ2aW5nIG9uZSBvZiBtdWx0aXBsZSBET00gZWxlbWVudHMsIHdlIG5lZWQgdG8gcmUtY29ubmVjdCB0aGUgbXV0YXRpb24gb2JzZXJ2ZXIuXG4gICAgICAgICAgICB0aGlzLl9tdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZG9tRWxlbWVudCBvZiB0aGlzLl9kb21FbGVtZW50cyl7XG4gICAgICAgICAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGRvbUVsZW1lbnQsIHRoaXMuX2NvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBlbmFibGUoKSB7XG4gICAgICAgIHN1cGVyLmVuYWJsZSgpO1xuICAgICAgICBmb3IgKGNvbnN0IGRvbUVsZW1lbnQgb2YgdGhpcy5fZG9tRWxlbWVudHMpe1xuICAgICAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKGRvbUVsZW1lbnQsIHRoaXMuX2NvbmZpZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBkaXNhYmxlKCkge1xuICAgICAgICBzdXBlci5kaXNhYmxlKCk7XG4gICAgICAgIHRoaXMuX211dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fbXV0YXRpb25PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIYW5kbGVzIG11dGF0aW9ucy4gTWFyayB2aWV3IGVsZW1lbnRzIHRvIHN5bmMgYW5kIGNhbGwgcmVuZGVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tTXV0YXRpb25zIEFycmF5IG9mIG5hdGl2ZSBtdXRhdGlvbnMuXG5cdCAqLyBfb25NdXRhdGlvbnMoZG9tTXV0YXRpb25zKSB7XG4gICAgICAgIC8vIEFzIGEgcmVzdWx0IG9mIHRoaXMuZmx1c2goKSB3ZSBjYW4gaGF2ZSBhbiBlbXB0eSBjb2xsZWN0aW9uLlxuICAgICAgICBpZiAoZG9tTXV0YXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRvbUNvbnZlcnRlciA9IHRoaXMuZG9tQ29udmVydGVyO1xuICAgICAgICAvLyBVc2UgbWFwIGFuZCBzZXQgZm9yIGRlZHVwbGljYXRpb24uXG4gICAgICAgIGNvbnN0IG11dGF0ZWRUZXh0Tm9kZXMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzV2l0aE11dGF0ZWRDaGlsZHJlbiA9IG5ldyBTZXQoKTtcbiAgICAgICAgLy8gSGFuZGxlIGBjaGlsZExpc3RgIG11dGF0aW9ucyBmaXJzdCwgc28gd2Ugd2lsbCBiZSBhYmxlIHRvIGNoZWNrIGlmIHRoZSBgY2hhcmFjdGVyRGF0YWAgbXV0YXRpb24gaXMgaW4gdGhlXG4gICAgICAgIC8vIGVsZW1lbnQgd2l0aCBjaGFuZ2VkIHN0cnVjdHVyZSBhbnl3YXkuXG4gICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgZG9tTXV0YXRpb25zKXtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KG11dGF0aW9uLnRhcmdldCk7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERvIG5vdCBjb2xsZWN0IG11dGF0aW9ucyBmcm9tIFVJRWxlbWVudHMgYW5kIFJhd0VsZW1lbnRzLlxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoJ3VpRWxlbWVudCcpIHx8IGVsZW1lbnQuaXMoJ3Jhd0VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdjaGlsZExpc3QnICYmICF0aGlzLl9pc0JvZ3VzQnJNdXRhdGlvbihtdXRhdGlvbikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50c1dpdGhNdXRhdGVkQ2hpbGRyZW4uYWRkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEhhbmRsZSBgY2hhcmFjdGVyRGF0YWAgbXV0YXRpb25zIGxhdGVyLCB3aGVuIHdlIGhhdmUgdGhlIGZ1bGwgbGlzdCBvZiBub2RlcyB3aGljaCBjaGFuZ2VkIHN0cnVjdHVyZS5cbiAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBkb21NdXRhdGlvbnMpe1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvbUNvbnZlcnRlci5tYXBEb21Ub1ZpZXcobXV0YXRpb24udGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIERvIG5vdCBjb2xsZWN0IG11dGF0aW9ucyBmcm9tIFVJRWxlbWVudHMgYW5kIFJhd0VsZW1lbnRzLlxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgKGVsZW1lbnQuaXMoJ3VpRWxlbWVudCcpIHx8IGVsZW1lbnQuaXMoJ3Jhd0VsZW1lbnQnKSkpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAnY2hhcmFjdGVyRGF0YScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gZG9tQ29udmVydGVyLmZpbmRDb3JyZXNwb25kaW5nVmlld1RleHQobXV0YXRpb24udGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAodGV4dCAmJiAhZWxlbWVudHNXaXRoTXV0YXRlZENoaWxkcmVuLmhhcyh0ZXh0LnBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbXV0YXRlZFRleHROb2Rlcy5hZGQodGV4dCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGV4dCAmJiBzdGFydHNXaXRoRmlsbGVyKG11dGF0aW9uLnRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudHNXaXRoTXV0YXRlZENoaWxkcmVuLmFkZChkb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KG11dGF0aW9uLnRhcmdldC5wYXJlbnROb2RlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE5vdyB3ZSBidWlsZCB0aGUgbGlzdCBvZiBtdXRhdGlvbnMgdG8gbWFyayBlbGVtZW50cy4gV2UgZGlkIG5vdCBkbyBpdCBlYXJsaWVyIHRvIGF2b2lkIG1hcmtpbmcgdGhlXG4gICAgICAgIC8vIHNhbWUgbm9kZSBtdWx0aXBsZSB0aW1lcyBpbiBjYXNlIG9mIGR1cGxpY2F0aW9uLlxuICAgICAgICBjb25zdCBtdXRhdGlvbnMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB0ZXh0Tm9kZSBvZiBtdXRhdGVkVGV4dE5vZGVzKXtcbiAgICAgICAgICAgIG11dGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgbm9kZTogdGV4dE5vZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qgdmlld0VsZW1lbnQgb2YgZWxlbWVudHNXaXRoTXV0YXRlZENoaWxkcmVuKXtcbiAgICAgICAgICAgIGNvbnN0IGRvbUVsZW1lbnQgPSBkb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdDaGlsZHJlbiA9IEFycmF5LmZyb20odmlld0VsZW1lbnQuZ2V0Q2hpbGRyZW4oKSk7XG4gICAgICAgICAgICBjb25zdCBuZXdWaWV3Q2hpbGRyZW4gPSBBcnJheS5mcm9tKGRvbUNvbnZlcnRlci5kb21DaGlsZHJlblRvVmlldyhkb21FbGVtZW50LCB7XG4gICAgICAgICAgICAgICAgd2l0aENoaWxkcmVuOiBmYWxzZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgLy8gSXQgbWF5IGhhcHBlbiB0aGF0IGFzIGEgcmVzdWx0IG9mIG1hbnkgY2hhbmdlcyAoc3RoIHdhcyBpbnNlcnRlZCBhbmQgdGhlbiByZW1vdmVkKSxcbiAgICAgICAgICAgIC8vIGJvdGggZWxlbWVudHMgaGF2ZW4ndCByZWFsbHkgY2hhbmdlZC4gIzEwMzFcbiAgICAgICAgICAgIGlmICghaXNFcXVhbFdpdGgodmlld0NoaWxkcmVuLCBuZXdWaWV3Q2hpbGRyZW4sIHNhbWVOb2RlcykpIHtcbiAgICAgICAgICAgICAgICBtdXRhdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGlsZHJlbicsXG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IHZpZXdFbGVtZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW4gY2FzZSBvbmx5IG5vbi1yZWxldmFudCBtdXRhdGlvbnMgd2VyZSByZWNvcmRlZCBpdCBza2lwcyB0aGUgZXZlbnQgYW5kIGZvcmNlIHJlbmRlciAoIzU2MDApLlxuICAgICAgICBpZiAobXV0YXRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRfZGVib3VuY2VkTGluZSgpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuZ3JvdXAoICclY1tNdXRhdGlvbk9ic2VydmVyXSVjIE11dGF0aW9ucyBkZXRlY3RlZCcsXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiBncmVlbicsICdmb250LXdlaWdodDogYm9sZCdcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50LmZpcmUoJ211dGF0aW9ucycsIHtcbiAgICAgICAgICAgICAgICBtdXRhdGlvbnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIG11dGF0aW9uIHdhcyBnZW5lcmF0ZWQgYnkgdGhlIGJyb3dzZXIgaW5zZXJ0aW5nIGJvZ3VzIGJyIG9uIHRoZSBlbmQgb2YgdGhlIGJsb2NrIGVsZW1lbnQuXG5cdCAqIFN1Y2ggbXV0YXRpb25zIGFyZSBnZW5lcmF0ZWQgd2hpbGUgcHJlc3Npbmcgc3BhY2Ugb3IgcGVyZm9ybWluZyBuYXRpdmUgc3BlbGxjaGVja2VyIGNvcnJlY3Rpb25cblx0ICogb24gdGhlIGVuZCBvZiB0aGUgYmxvY2sgZWxlbWVudCBpbiBGaXJlZm94IGJyb3dzZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBtdXRhdGlvbiBOYXRpdmUgbXV0YXRpb24gb2JqZWN0LlxuXHQgKi8gX2lzQm9ndXNCck11dGF0aW9uKG11dGF0aW9uKSB7XG4gICAgICAgIGxldCBhZGRlZE5vZGUgPSBudWxsO1xuICAgICAgICAvLyBDaGVjayBpZiBtdXRhdGlvbiBhZGRlZCBvbmx5IG9uZSBub2RlIG9uIHRoZSBlbmQgb2YgaXRzIHBhcmVudC5cbiAgICAgICAgaWYgKG11dGF0aW9uLm5leHRTaWJsaW5nID09PSBudWxsICYmIG11dGF0aW9uLnJlbW92ZWROb2Rlcy5sZW5ndGggPT09IDAgJiYgbXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgYWRkZWROb2RlID0gdGhpcy5kb21Db252ZXJ0ZXIuZG9tVG9WaWV3KG11dGF0aW9uLmFkZGVkTm9kZXNbMF0sIHtcbiAgICAgICAgICAgICAgICB3aXRoQ2hpbGRyZW46IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWRkZWROb2RlICYmIGFkZGVkTm9kZS5pcygnZWxlbWVudCcsICdicicpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNhbWVOb2RlcyhjaGlsZDEsIGNoaWxkMikge1xuICAgIC8vIEZpcnN0IGxldmVsIG9mIGNvbXBhcmlzb24gKGFycmF5IG9mIGNoaWxkcmVuIHZzIGFycmF5IG9mIGNoaWxkcmVuKSDigJMgdXNlIHRoZSBMb2Rhc2gncyBkZWZhdWx0IGJlaGF2aW9yLlxuICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkMSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBFbGVtZW50cy5cbiAgICBpZiAoY2hpbGQxID09PSBjaGlsZDIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIGlmIChjaGlsZDEuaXMoJyR0ZXh0JykgJiYgY2hpbGQyLmlzKCckdGV4dCcpKSB7XG4gICAgICAgIHJldHVybiBjaGlsZDEuZGF0YSA9PT0gY2hpbGQyLmRhdGE7XG4gICAgfVxuICAgIC8vIE5vdCBtYXRjaGluZyB0eXBlcy5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpmb2N1cyBGb2N1c31cbiAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmJsdXIgYmx1cn0gZXZlbnRzIG9ic2VydmVyLlxuICogRm9jdXMgb2JzZXJ2ZXIgaGFuZGxlIGFsc28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yb290ZWRpdGFibGVlbGVtZW50flJvb3RFZGl0YWJsZUVsZW1lbnQjaXNGb2N1c2VkIGlzRm9jdXNlZH0gcHJvcGVydHkgb2YgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Jvb3RlZGl0YWJsZWVsZW1lbnR+Um9vdEVkaXRhYmxlRWxlbWVudCByb290IGVsZW1lbnRzfS5cbiAqXG4gKiBOb3RlIHRoYXQgdGhpcyBvYnNlcnZlciBpcyBhdHRhY2hlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXd9IGFuZCBpcyBhdmFpbGFibGUgYnkgZGVmYXVsdC5cbiAqLyBjbGFzcyBGb2N1c09ic2VydmVyIGV4dGVuZHMgRG9tRXZlbnRPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIElkZW50aWZpZXIgb2YgdGhlIHRpbWVvdXQgY3VycmVudGx5IHVzZWQgYnkgZm9jdXMgbGlzdGVuZXIgdG8gZGVsYXkgcmVuZGVyaW5nIGV4ZWN1dGlvbi5cblx0ICovIF9yZW5kZXJUaW1lb3V0SWQgPSBudWxsO1xuICAgIC8qKlxuXHQgKiBTZXQgdG8gYHRydWVgIGlmIHRoZSBkb2N1bWVudCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBzZXR0aW5nIHRoZSBmb2N1cy5cblx0ICpcblx0ICogVGhlIGZsYWcgaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IHNldHRpbmcgdGhlIGZvY3VzIGlzIGluIHByb2dyZXNzLlxuXHQgKi8gX2lzRm9jdXNDaGFuZ2luZyA9IGZhbHNlO1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZG9tRXZlbnRUeXBlID0gW1xuICAgICAgICAnZm9jdXMnLFxuICAgICAgICAnYmx1cidcbiAgICBdO1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gY29uc3RydWN0b3Iodmlldyl7XG4gICAgICAgIHN1cGVyKHZpZXcpO1xuICAgICAgICB0aGlzLnVzZUNhcHR1cmUgPSB0cnVlO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IHRoaXMuZG9jdW1lbnQ7XG4gICAgICAgIGRvY3VtZW50Lm9uKCdmb2N1cycsICgpPT50aGlzLl9oYW5kbGVGb2N1cygpKTtcbiAgICAgICAgZG9jdW1lbnQub24oJ2JsdXInLCAoZXZ0LCBkYXRhKT0+dGhpcy5faGFuZGxlQmx1cihkYXRhKSk7XG4gICAgICAgIC8vIEZvY3VzIHRoZSBlZGl0b3IgaW4gY2FzZXMgd2hlcmUgYnJvd3NlciBkaXNwYXRjaGVzIGBiZWZvcmVpbnB1dGAgZXZlbnQgdG8gYSBub3QtZm9jdXNlZCBlZGl0YWJsZSBlbGVtZW50LlxuICAgICAgICAvLyBUaGlzIGlzIGZsdXNoZWQgYnkgdGhlIGJlZm9yZWlucHV0IGxpc3RlbmVyIGluIHRoZSBgSW5zZXJ0VGV4dE9ic2VydmVyYC5cbiAgICAgICAgLy8gTm90ZSB0aGF0IGZvY3VzIGlzIHNldCBvbmx5IGlmIHRoZSBkb2N1bWVudCBpcyBub3QgZm9jdXNlZCB5ZXQuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xNDcwMi5cbiAgICAgICAgZG9jdW1lbnQub24oJ2JlZm9yZWlucHV0JywgKCk9PntcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEZpbmlzaGVzIHNldHRpbmcgdGhlIGRvY3VtZW50IGZvY3VzIHN0YXRlLlxuXHQgKi8gZmx1c2goKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc0ZvY3VzQ2hhbmdpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX2lzRm9jdXNDaGFuZ2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudC5pc0ZvY3VzZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gb25Eb21FdmVudChkb21FdmVudCkge1xuICAgICAgICB0aGlzLmZpcmUoZG9tRXZlbnQudHlwZSwgZG9tRXZlbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2NsZWFyVGltZW91dCgpO1xuICAgICAgICBzdXBlci5kZXN0cm95KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgYGZvY3VzYCBldmVudCBoYW5kbGVyLlxuXHQgKi8gX2hhbmRsZUZvY3VzKCkge1xuICAgICAgICB0aGlzLl9jbGVhclRpbWVvdXQoKTtcbiAgICAgICAgdGhpcy5faXNGb2N1c0NoYW5naW5nID0gdHJ1ZTtcbiAgICAgICAgLy8gVW5mb3J0dW5hdGVseSBuYXRpdmUgYHNlbGVjdGlvbmNoYW5nZWAgZXZlbnQgaXMgZmlyZWQgYXN5bmNocm9ub3VzbHkuXG4gICAgICAgIC8vIFdlIG5lZWQgdG8gd2FpdCB1bnRpbCBgU2VsZWN0aW9uT2JzZXJ2ZXJgIGhhbmRsZSB0aGUgZXZlbnQgYW5kIHRoZW4gcmVuZGVyLiBPdGhlcndpc2UgcmVuZGVyaW5nIHdpbGxcbiAgICAgICAgLy8gb3ZlcndyaXRlIG5ldyBET00gc2VsZWN0aW9uIHdpdGggc2VsZWN0aW9uIGZyb20gdGhlIHZpZXcuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvNzk1IGZvciBtb3JlIGRldGFpbHMuXG4gICAgICAgIC8vIExvbmcgdGltZW91dCBpcyBuZWVkZWQgdG8gc29sdmUgIzY3NiBhbmQgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzExNTcgaXNzdWVzLlxuICAgICAgICAvL1xuICAgICAgICAvLyBVc2luZyBgdmlldy5jaGFuZ2UoKWAgaW5zdGVhZCBvZiBgdmlldy5mb3JjZVJlbmRlcigpYCB0byBwcmV2ZW50IGRvdWJsZSByZW5kZXJpbmdcbiAgICAgICAgLy8gaW4gYSBzaXR1YXRpb24gd2hlcmUgYHNlbGVjdGlvbmNoYW5nZWAgYWxyZWFkeSBjYXVzZWQgc2VsZWN0aW9uIGNoYW5nZS5cbiAgICAgICAgdGhpcy5fcmVuZGVyVGltZW91dElkID0gc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZmx1c2goKTtcbiAgICAgICAgICAgIHRoaXMudmlldy5jaGFuZ2UoKCk9Pnt9KTtcbiAgICAgICAgfSwgNTApO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIGBibHVyYCBldmVudCBoYW5kbGVyLlxuXHQgKi8gX2hhbmRsZUJsdXIoZGF0YSkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZEVkaXRhYmxlID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24uZWRpdGFibGVFbGVtZW50O1xuICAgICAgICBpZiAoc2VsZWN0ZWRFZGl0YWJsZSA9PT0gbnVsbCB8fCBzZWxlY3RlZEVkaXRhYmxlID09PSBkYXRhLnRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudC5pc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX2lzRm9jdXNDaGFuZ2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gUmUtcmVuZGVyIHRoZSBkb2N1bWVudCB0byB1cGRhdGUgdmlldyBlbGVtZW50c1xuICAgICAgICAgICAgLy8gKGNoYW5naW5nIGRvY3VtZW50LmlzRm9jdXNlZCBhbHJlYWR5IG1hcmtlZCB2aWV3IGFzIGNoYW5nZWQgc2luY2UgbGFzdCByZW5kZXJpbmcpLlxuICAgICAgICAgICAgdGhpcy52aWV3LmNoYW5nZSgoKT0+e30pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDbGVhcnMgdGltZW91dC5cblx0ICovIF9jbGVhclRpbWVvdXQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9yZW5kZXJUaW1lb3V0SWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9yZW5kZXJUaW1lb3V0SWQpO1xuICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBTZWxlY3Rpb24gb2JzZXJ2ZXIgY2xhc3Mgb2JzZXJ2ZXMgc2VsZWN0aW9uIGNoYW5nZXMgaW4gdGhlIGRvY3VtZW50LiBJZiBhIHNlbGVjdGlvbiBjaGFuZ2VzIG9uIHRoZSBkb2N1bWVudCB0aGlzXG4gKiBvYnNlcnZlciBjaGVja3MgaWYgdGhlIERPTSBzZWxlY3Rpb24gaXMgZGlmZmVyZW50IGZyb20gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjc2VsZWN0aW9uIHZpZXcgc2VsZWN0aW9ufS5cbiAqIFRoZSBzZWxlY3Rpb24gb2JzZXJ2ZXIgZmlyZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpzZWxlY3Rpb25DaGFuZ2V9IGV2ZW50IG9ubHkgaWZcbiAqIGEgc2VsZWN0aW9uIGNoYW5nZSB3YXMgdGhlIG9ubHkgY2hhbmdlIGluIHRoZSBkb2N1bWVudCBhbmQgdGhlIERPTSBzZWxlY3Rpb24gaXMgZGlmZmVyZW50IGZyb20gdGhlIHZpZXcgc2VsZWN0aW9uLlxuICpcbiAqIFRoaXMgb2JzZXJ2ZXIgYWxzbyBtYW5hZ2VzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2lzU2VsZWN0aW5nfSBwcm9wZXJ0eSBvZiB0aGUgdmlldyBkb2N1bWVudC5cbiAqXG4gKiBOb3RlIHRoYXQgdGhpcyBvYnNlcnZlciBpcyBhdHRhY2hlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXd9IGFuZCBpcyBhdmFpbGFibGUgYnkgZGVmYXVsdC5cbiAqLyBjbGFzcyBTZWxlY3Rpb25PYnNlcnZlciBleHRlbmRzIE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogSW5zdGFuY2Ugb2YgdGhlIG11dGF0aW9uIG9ic2VydmVyLiBTZWxlY3Rpb24gb2JzZXJ2ZXIgY2FsbHNcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9tdXRhdGlvbm9ic2VydmVyfk11dGF0aW9uT2JzZXJ2ZXIjZmx1c2h9IHRvIGVuc3VyZSB0aGF0IHRoZSBtdXRhdGlvbnMgd2lsbCBiZSBoYW5kbGVkXG5cdCAqIGJlZm9yZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpzZWxlY3Rpb25DaGFuZ2V9IGV2ZW50IGlzIGZpcmVkLlxuXHQgKi8gbXV0YXRpb25PYnNlcnZlcjtcbiAgICAvKipcblx0ICogSW5zdGFuY2Ugb2YgdGhlIGZvY3VzIG9ic2VydmVyLiBGb2N1cyBvYnNlcnZlciBjYWxsc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2ZvY3Vzb2JzZXJ2ZXJ+Rm9jdXNPYnNlcnZlciNmbHVzaH0gdG8gbWFyayB0aGUgbGF0ZXN0IGZvY3VzIGNoYW5nZSBhcyBjb21wbGV0ZS5cblx0ICovIGZvY3VzT2JzZXJ2ZXI7XG4gICAgLyoqXG5cdCAqIFJlZmVyZW5jZSB0byB0aGUgdmlldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufSBvYmplY3QgdXNlZCB0byBjb21wYXJlXG5cdCAqIG5ldyBzZWxlY3Rpb24gd2l0aCBpdC5cblx0ICovIHNlbGVjdGlvbjtcbiAgICAvKipcblx0ICogUmVmZXJlbmNlIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNkb21Db252ZXJ0ZXJ9LlxuXHQgKi8gZG9tQ29udmVydGVyO1xuICAgIC8qKlxuXHQgKiBBIHNldCBvZiBkb2N1bWVudHMgd2hpY2ggaGF2ZSBhZGRlZCBgc2VsZWN0aW9uY2hhbmdlYCBsaXN0ZW5lciB0byBhdm9pZCBhZGRpbmcgYSBsaXN0ZW5lciB0d2ljZSB0byB0aGUgc2FtZVxuXHQgKiBkb2N1bWVudC5cblx0ICovIF9kb2N1bWVudHM7XG4gICAgLyoqXG5cdCAqIEZpcmVzIGRlYm91bmNlZCBldmVudCBgc2VsZWN0aW9uQ2hhbmdlRG9uZWAuIEl0IHVzZXMgYGxvZGFzaCNkZWJvdW5jZWAgbWV0aG9kIHRvIGRlbGF5IGZ1bmN0aW9uIGNhbGwuXG5cdCAqLyBfZmlyZVNlbGVjdGlvbkNoYW5nZURvbmVEZWJvdW5jZWQ7XG4gICAgLyoqXG5cdCAqIFdoZW4gY2FsbGVkLCBzdGFydHMgY2xlYXJpbmcgdGhlIHtAbGluayAjX2xvb3BiYWNrQ291bnRlcn0gY291bnRlciBpbiB0aW1lIGludGVydmFscy4gV2hlbiB0aGUgbnVtYmVyIG9mIHNlbGVjdGlvblxuXHQgKiBjaGFuZ2VzIGV4Y2VlZHMgYSBjZXJ0YWluIGxpbWl0IHdpdGhpbiB0aGUgaW50ZXJ2YWwgb2YgdGltZSwgdGhlIG9ic2VydmVyIHdpbGwgbm90IGZpcmUgYHNlbGVjdGlvbkNoYW5nZWAgYnV0IHdhcm4gYWJvdXRcblx0ICogcG9zc2libGUgaW5maW5pdGUgc2VsZWN0aW9uIGxvb3AuXG5cdCAqLyBfY2xlYXJJbmZpbml0ZUxvb3BJbnRlcnZhbDtcbiAgICAvKipcblx0ICogVW5sb2NrcyB0aGUgYGlzU2VsZWN0aW5nYCBzdGF0ZSBvZiB0aGUgdmlldyBkb2N1bWVudCBpbiBjYXNlIHRoZSBzZWxlY3Rpb24gb2JzZXJ2ZXIgZGlkIG5vdCByZWNvcmQgdGhpcyBmYWN0XG5cdCAqIGNvcnJlY3RseSAoZm9yIHdoYXRldmVyIHJlYXNvbikuIEl0IGlzIGEgc2FmZWd1YXJkIChwYXJhbm9pZCBjaGVjayksIHRoYXQgcmV0dXJucyBkb2N1bWVudCB0byB0aGUgbm9ybWFsIHN0YXRlXG5cdCAqIGFmdGVyIGEgY2VydGFpbiBwZXJpb2Qgb2YgdGltZSAoZGVib3VuY2VkLCBwb3N0cG9uZWQgYnkgZWFjaCBzZWxlY3Rpb25jaGFuZ2UgZXZlbnQpLlxuXHQgKi8gX2RvY3VtZW50SXNTZWxlY3RpbmdJbmFjdGl2aXR5VGltZW91dERlYm91bmNlZDtcbiAgICAvKipcblx0ICogUHJpdmF0ZSBwcm9wZXJ0eSB0byBjaGVjayBpZiB0aGUgY29kZSBkb2VzIG5vdCBlbnRlciBpbmZpbml0ZSBsb29wLlxuXHQgKi8gX2xvb3BiYWNrQ291bnRlcjtcbiAgICBjb25zdHJ1Y3Rvcih2aWV3KXtcbiAgICAgICAgc3VwZXIodmlldyk7XG4gICAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IHZpZXcuZ2V0T2JzZXJ2ZXIoTXV0YXRpb25PYnNlcnZlcik7XG4gICAgICAgIHRoaXMuZm9jdXNPYnNlcnZlciA9IHZpZXcuZ2V0T2JzZXJ2ZXIoRm9jdXNPYnNlcnZlcik7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyID0gdmlldy5kb21Db252ZXJ0ZXI7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50cyA9IG5ldyBXZWFrU2V0KCk7XG4gICAgICAgIHRoaXMuX2ZpcmVTZWxlY3Rpb25DaGFuZ2VEb25lRGVib3VuY2VkID0gZGVib3VuY2UoKGRhdGEpPT57XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50LmZpcmUoJ3NlbGVjdGlvbkNoYW5nZURvbmUnLCBkYXRhKTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgdGhpcy5fY2xlYXJJbmZpbml0ZUxvb3BJbnRlcnZhbCA9IHNldEludGVydmFsKCgpPT50aGlzLl9jbGVhckluZmluaXRlTG9vcCgpLCAxMDAwKTtcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRJc1NlbGVjdGluZ0luYWN0aXZpdHlUaW1lb3V0RGVib3VuY2VkID0gZGVib3VuY2UoKCk9PnRoaXMuZG9jdW1lbnQuaXNTZWxlY3RpbmcgPSBmYWxzZSwgNTAwMCk7XG4gICAgICAgIHRoaXMuX2xvb3BiYWNrQ291bnRlciA9IDA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gb2JzZXJ2ZShkb21FbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGRvbURvY3VtZW50ID0gZG9tRWxlbWVudC5vd25lckRvY3VtZW50O1xuICAgICAgICBjb25zdCBzdGFydERvY3VtZW50SXNTZWxlY3RpbmcgPSAoKT0+e1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudC5pc1NlbGVjdGluZyA9IHRydWU7XG4gICAgICAgICAgICAvLyBMZXQncyBhY3RpdmF0ZSB0aGUgc2FmZXR5IHRpbWVvdXQgZWFjaCB0aW1lIHRoZSBkb2N1bWVudCBlbnRlcnMgdGhlIFwiaXMgc2VsZWN0aW5nXCIgc3RhdGUuXG4gICAgICAgICAgICB0aGlzLl9kb2N1bWVudElzU2VsZWN0aW5nSW5hY3Rpdml0eVRpbWVvdXREZWJvdW5jZWQoKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZW5kRG9jdW1lbnRJc1NlbGVjdGluZyA9ICgpPT57XG4gICAgICAgICAgICBpZiAoIXRoaXMuZG9jdW1lbnQuaXNTZWxlY3RpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBtb2RlbCBzZWxlY3Rpb24gaXMgdXAtdG8tZGF0ZSBhdCB0aGUgZW5kIG9mIHNlbGVjdGluZyBwcm9jZXNzLlxuICAgICAgICAgICAgLy8gU29tZXRpbWVzIGBzZWxlY3Rpb25jaGFuZ2VgIGV2ZW50cyBjb3VsZCBhcnJpdmUgYWZ0ZXIgdGhlIGBtb3VzZXVwYCBldmVudCBhbmQgdGhhdCBzZWxlY3Rpb24gY291bGQgYmUgYWxyZWFkeSBvdXRkYXRlZC5cbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZVNlbGVjdGlvbkNoYW5nZShkb21Eb2N1bWVudCk7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50LmlzU2VsZWN0aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBUaGUgc2FmZXR5IHRpbWVvdXQgY2FuIGJlIGNhbmNlbGVkIHdoZW4gdGhlIGRvY3VtZW50IGxlYXZlcyB0aGUgXCJpcyBzZWxlY3RpbmdcIiBzdGF0ZS5cbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50SXNTZWxlY3RpbmdJbmFjdGl2aXR5VGltZW91dERlYm91bmNlZC5jYW5jZWwoKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gVGhlIGRvY3VtZW50IGhhcyB0aGUgXCJpcyBzZWxlY3RpbmdcIiBzdGF0ZSB3aGlsZSB0aGUgdXNlciBrZWVwcyBtYWtpbmcgKGV4dGVuZGluZykgdGhlIHNlbGVjdGlvblxuICAgICAgICAvLyAoZS5nLiBieSBob2xkaW5nIHRoZSBtb3VzZSBidXR0b24gYW5kIG1vdmluZyB0aGUgY3Vyc29yKS4gVGhlIHN0YXRlIHJlc2V0cyB3aGVuIHRoZXkgZWl0aGVyIHJlbGVhc2VkXG4gICAgICAgIC8vIHRoZSBtb3VzZSBidXR0b24gb3IgaW50ZXJydXB0ZWQgdGhlIHByb2Nlc3MgYnkgcHJlc3Npbmcgb3IgcmVsZWFzaW5nIGFueSBrZXkuXG4gICAgICAgIHRoaXMubGlzdGVuVG8oZG9tRWxlbWVudCwgJ3NlbGVjdHN0YXJ0Jywgc3RhcnREb2N1bWVudElzU2VsZWN0aW5nLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxpc3RlblRvKGRvbUVsZW1lbnQsICdrZXlkb3duJywgZW5kRG9jdW1lbnRJc1NlbGVjdGluZywge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0JyxcbiAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZG9tRWxlbWVudCwgJ2tleXVwJywgZW5kRG9jdW1lbnRJc1NlbGVjdGluZywge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0JyxcbiAgICAgICAgICAgIHVzZUNhcHR1cmU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEFkZCBkb2N1bWVudC13aWRlIGxpc3RlbmVycyBvbmx5IG9uY2UuIFRoaXMgbWV0aG9kIGNvdWxkIGJlIGNhbGxlZCBmb3IgbXVsdGlwbGUgZWRpdGluZyByb290cy5cbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50cy5oYXMoZG9tRG9jdW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhpcyBsaXN0ZW5lciBpcyB1c2luZyBjYXB0dXJlIG1vZGUgdG8gbWFrZSBzdXJlIHRoYXQgc2VsZWN0aW9uIGlzIHVwY2FzdGVkIGJlZm9yZSBhbnkgb3RoZXJcbiAgICAgICAgLy8gaGFuZGxlciB3b3VsZCBsaWtlIHRvIGNoZWNrIGl0IGFuZCB1cGRhdGUgKGZvciBleGFtcGxlIHRhYmxlIG11bHRpIGNlbGwgc2VsZWN0aW9uKS5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhkb21Eb2N1bWVudCwgJ21vdXNldXAnLCBlbmREb2N1bWVudElzU2VsZWN0aW5nLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnLFxuICAgICAgICAgICAgdXNlQ2FwdHVyZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhkb21Eb2N1bWVudCwgJ3NlbGVjdGlvbmNoYW5nZScsICgpPT57XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdF9kZWJvdW5jZWRMaW5lKCk7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc3QgZG9tU2VsZWN0aW9uID0gZG9tRG9jdW1lbnQuZGVmYXVsdFZpZXchLmdldFNlbGVjdGlvbigpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuZ3JvdXAoICclY1tTZWxlY3Rpb25PYnNlcnZlcl0lYyBzZWxlY3Rpb25jaGFuZ2UnLCAnY29sb3I6IGdyZWVuJywgJydcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggJyVjW1NlbGVjdGlvbk9ic2VydmVyXSVjIERPTSBTZWxlY3Rpb246JywgJ2ZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogZ3JlZW4nLCAnJyxcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdHsgbm9kZTogZG9tU2VsZWN0aW9uIS5hbmNob3JOb2RlLCBvZmZzZXQ6IGRvbVNlbGVjdGlvbiEuYW5jaG9yT2Zmc2V0IH0sXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHR7IG5vZGU6IGRvbVNlbGVjdGlvbiEuZm9jdXNOb2RlLCBvZmZzZXQ6IGRvbVNlbGVjdGlvbiEuZm9jdXNPZmZzZXQgfVxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdCk7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgICAgIC8vIFRoZSBSZW5kZXJlciBpcyBkaXNhYmxlZCB3aGlsZSBjb21wb3Npbmcgb24gbm9uLWFuZHJvaWQgYnJvd3NlcnMsIHNvIHdlIGNhbid0IHVwZGF0ZSB0aGUgdmlldyBzZWxlY3Rpb25cbiAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIERPTSBhbmQgdmlldyB0cmVlIGRyaWZ0ZWQgYXBhcnQuIFBvc2l0aW9uIG1hcHBpbmcgY291bGQgZmFpbCBiZWNhdXNlIG9mIGl0LlxuICAgICAgICAgICAgaWYgKHRoaXMuZG9jdW1lbnQuaXNDb21wb3NpbmcgJiYgIWVudi5pc0FuZHJvaWQpIHtcbiAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tTZWxlY3Rpb25PYnNlcnZlcl0lYyBTZWxlY3Rpb24gY2hhbmdlIGlnbm9yZWQgKGlzQ29tcG9zaW5nKScsXG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2ZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogZ3JlZW4nLCAnJ1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5faGFuZGxlU2VsZWN0aW9uQ2hhbmdlKGRvbURvY3VtZW50KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICAvLyBEZWZlciB0aGUgc2FmZXR5IHRpbWVvdXQgd2hlbiB0aGUgc2VsZWN0aW9uIGNoYW5nZXMgKGUuZy4gdGhlIHVzZXIga2VlcHMgZXh0ZW5kaW5nIHRoZSBzZWxlY3Rpb25cbiAgICAgICAgICAgIC8vIHVzaW5nIHRoZWlyIG1vdXNlKS5cbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50SXNTZWxlY3RpbmdJbmFjdGl2aXR5VGltZW91dERlYm91bmNlZCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbCBEb2N1bWVudFNlbGVjdGlvbiBqdXN0IGFmdGVyIHRoZSBSZW5kZXJlciBhbmQgdGhlIFNlbGVjdGlvbk9ic2VydmVyIGFyZSBsb2NrZWQuXG4gICAgICAgIC8vIFdlIGRvIHRoaXMgc3luY2hyb25vdXNseSAod2l0aG91dCB3YWl0aW5nIGZvciB0aGUgYHNlbGVjdGlvbmNoYW5nZWAgRE9NIGV2ZW50KSBhcyBicm93c2VyIHVwZGF0ZXNcbiAgICAgICAgLy8gdGhlIERPTSBzZWxlY3Rpb24gKGJ1dCBub3QgdmlzdWFsbHkpIHRvIHNwYW4gdGhlIHRleHQgdGhhdCBpcyB1bmRlciBjb21wb3NpdGlvbiBhbmQgY291bGQgYmUgcmVwbGFjZWQuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy52aWV3LmRvY3VtZW50LCAnY29tcG9zaXRpb25zdGFydCcsICgpPT57XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvbURvY3VtZW50LmRlZmF1bHRWaWV3IS5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmdyb3VwKCAnJWNbU2VsZWN0aW9uT2JzZXJ2ZXJdJWMgdXBkYXRlIHNlbGVjdGlvbiBvbiBjb21wb3NpdGlvbnN0YXJ0JywgJ2NvbG9yOiBncmVlbicsICcnXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tTZWxlY3Rpb25PYnNlcnZlcl0lYyBET00gU2VsZWN0aW9uOicsICdmb250LXdlaWdodDogYm9sZDsgY29sb3I6IGdyZWVuJywgJycsXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHR7IG5vZGU6IGRvbVNlbGVjdGlvbiEuYW5jaG9yTm9kZSwgb2Zmc2V0OiBkb21TZWxlY3Rpb24hLmFuY2hvck9mZnNldCB9LFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0eyBub2RlOiBkb21TZWxlY3Rpb24hLmZvY3VzTm9kZSwgb2Zmc2V0OiBkb21TZWxlY3Rpb24hLmZvY3VzT2Zmc2V0IH1cbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVTZWxlY3Rpb25DaGFuZ2UoZG9tRG9jdW1lbnQpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3dlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9kb2N1bWVudHMuYWRkKGRvbURvY3VtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdG9wT2JzZXJ2aW5nKGRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKGRvbUVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9jbGVhckluZmluaXRlTG9vcEludGVydmFsKTtcbiAgICAgICAgdGhpcy5fZmlyZVNlbGVjdGlvbkNoYW5nZURvbmVEZWJvdW5jZWQuY2FuY2VsKCk7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50SXNTZWxlY3RpbmdJbmFjdGl2aXR5VGltZW91dERlYm91bmNlZC5jYW5jZWwoKTtcbiAgICB9XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgLS0gQHByZXNlcnZlICovIF9yZXBvcnRJbmZpbml0ZUxvb3AoKSB7XG4gICAgLy8gQGlmIENLX0RFQlVHIC8vXHRcdHRocm93IG5ldyBFcnJvcihcbiAgICAvLyBAaWYgQ0tfREVCVUcgLy9cdFx0XHQnU2VsZWN0aW9uIGNoYW5nZSBvYnNlcnZlciBkZXRlY3RlZCBhbiBpbmZpbml0ZSByZW5kZXJpbmcgbG9vcC5cXG5cXG4nICtcbiAgICAvLyBAaWYgQ0tfREVCVUcgLy9cdCBcdFx0J+KaoO+4j+KaoO+4jyBSZXBvcnQgdGhpcyBlcnJvciBvbiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMTY1OC4nXG4gICAgLy8gQGlmIENLX0RFQlVHIC8vXHRcdCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWxlY3Rpb24gY2hhbmdlIGxpc3RlbmVyLiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL211dGF0aW9ub2JzZXJ2ZXJ+TXV0YXRpb25PYnNlcnZlciNmbHVzaCBGbHVzaH0gbXV0YXRpb25zLCBjaGVjayBpZlxuXHQgKiBhIHNlbGVjdGlvbiBjaGFuZ2VzIGFuZCBmaXJlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OnNlbGVjdGlvbkNoYW5nZX0gZXZlbnQgb24gZXZlcnkgY2hhbmdlXG5cdCAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OnNlbGVjdGlvbkNoYW5nZURvbmV9IHdoZW4gYSBzZWxlY3Rpb24gc3RvcCBjaGFuZ2luZy5cblx0ICpcblx0ICogQHBhcmFtIGRvbURvY3VtZW50IERPTSBkb2N1bWVudC5cblx0ICovIF9oYW5kbGVTZWxlY3Rpb25DaGFuZ2UoZG9tRG9jdW1lbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRvbVNlbGVjdGlvbiA9IGRvbURvY3VtZW50LmRlZmF1bHRWaWV3LmdldFNlbGVjdGlvbigpO1xuICAgICAgICBpZiAodGhpcy5jaGVja1Nob3VsZElnbm9yZUV2ZW50RnJvbVRhcmdldChkb21TZWxlY3Rpb24uYW5jaG9yTm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBFbnN1cmUgdGhlIG11dGF0aW9uIGV2ZW50IHdpbGwgYmUgYmVmb3JlIHNlbGVjdGlvbiBldmVudCBvbiBhbGwgYnJvd3NlcnMuXG4gICAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlci5mbHVzaCgpO1xuICAgICAgICBjb25zdCBuZXdWaWV3U2VsZWN0aW9uID0gdGhpcy5kb21Db252ZXJ0ZXIuZG9tU2VsZWN0aW9uVG9WaWV3KGRvbVNlbGVjdGlvbik7XG4gICAgICAgIC8vIERvIG5vdCBjb252ZXJ0IHNlbGVjdGlvbiBjaGFuZ2UgaWYgdGhlIG5ldyB2aWV3IHNlbGVjdGlvbiBoYXMgbm8gcmFuZ2VzIGluIGl0LlxuICAgICAgICAvL1xuICAgICAgICAvLyBJdCBtZWFucyB0aGF0IHRoZSBET00gc2VsZWN0aW9uIGlzIGluIHNvbWUgd2F5IGluY29ycmVjdC4gUmFuZ2VzIHRoYXQgd2VyZSBpbiB0aGUgRE9NIHNlbGVjdGlvbiBjb3VsZCBub3QgYmVcbiAgICAgICAgLy8gY29udmVydGVkIHRvIHRoZSB2aWV3LiBUaGlzIGhhcHBlbnMgd2hlbiB0aGUgRE9NIHNlbGVjdGlvbiB3YXMgbW92ZWQgb3V0c2lkZSBvZiB0aGUgZWRpdGFibGUgZWxlbWVudC5cbiAgICAgICAgaWYgKG5ld1ZpZXdTZWxlY3Rpb24ucmFuZ2VDb3VudCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcuaGFzRG9tU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy52aWV3Lmhhc0RvbVNlbGVjdGlvbiA9IHRydWU7XG4gICAgICAgIC8vIE1hcmsgdGhlIGxhdGVzdCBmb2N1cyBjaGFuZ2UgYXMgY29tcGxldGUgKHdlIGdvdCBuZXcgc2VsZWN0aW9uIGFmdGVyIHRoZSBmb2N1cyBzbyB0aGUgc2VsZWN0aW9uIGlzIGluIHRoZSBmb2N1c2VkIGVsZW1lbnQpLlxuICAgICAgICB0aGlzLmZvY3VzT2JzZXJ2ZXIuZmx1c2goKTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uLmlzRXF1YWwobmV3Vmlld1NlbGVjdGlvbikgJiYgdGhpcy5kb21Db252ZXJ0ZXIuaXNEb21TZWxlY3Rpb25Db3JyZWN0KGRvbVNlbGVjdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBFbnN1cmUgd2UgYXJlIG5vdCBpbiB0aGUgaW5maW5pdGUgbG9vcCAoIzQwMCkuXG4gICAgICAgIC8vIFRoaXMgY291bnRlciBpcyByZXNldCBlYWNoIHNlY29uZC4gNjAgc2VsZWN0aW9uIGNoYW5nZXMgaW4gMSBzZWNvbmQgaXMgZW5vdWdoIGhpZ2ggbnVtYmVyXG4gICAgICAgIC8vIHRvIGJlIHZlcnkgZGlmZmljdWx0IChpbXBvc3NpYmxlKSB0byBhY2hpZXZlIHVzaW5nIGp1c3Qga2V5Ym9hcmQga2V5cyAoZHVyaW5nIG5vcm1hbCBlZGl0b3IgdXNlKS5cbiAgICAgICAgaWYgKCsrdGhpcy5fbG9vcGJhY2tDb3VudGVyID4gNjApIHtcbiAgICAgICAgICAgIC8vIFNlbGVjdGlvbiBjaGFuZ2Ugb2JzZXJ2ZXIgZGV0ZWN0ZWQgYW4gaW5maW5pdGUgcmVuZGVyaW5nIGxvb3AuXG4gICAgICAgICAgICAvLyBNb3N0IHByb2JhYmx5IHlvdSB0cnkgdG8gcHV0IHRoZSBzZWxlY3Rpb24gaW4gdGhlIHBvc2l0aW9uIHdoaWNoIGlzIG5vdCBhbGxvd2VkXG4gICAgICAgICAgICAvLyBieSB0aGUgYnJvd3NlciBhbmQgYnJvd3NlciBmaXhlcyBpdCBhdXRvbWF0aWNhbGx5IHdoYXQgY2F1c2VzIGBzZWxlY3Rpb25jaGFuZ2VgIGV2ZW50IG9uXG4gICAgICAgICAgICAvLyB3aGljaCBhIGxvb3BiYWNrIHRocm91Z2ggYSBtb2RlbCB0cmllcyB0byByZS1yZW5kZXIgdGhlIHdyb25nIHNlbGVjdGlvbiBhbmQgYWdhaW4uXG4gICAgICAgICAgICB0aGlzLl9yZXBvcnRJbmZpbml0ZUxvb3AoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb24uaXNTaW1pbGFyKG5ld1ZpZXdTZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICAvLyBJZiBzZWxlY3Rpb24gd2FzIGVxdWFsIGFuZCB3ZSBhcmUgYXQgdGhpcyBwb2ludCBvZiBhbGdvcml0aG0sIGl0IG1lYW5zIHRoYXQgaXQgd2FzIGluY29ycmVjdC5cbiAgICAgICAgICAgIC8vIEp1c3QgcmUtcmVuZGVyIGl0LCBubyBuZWVkIHRvIGZpcmUgYW55IGV2ZW50cywgZXRjLlxuICAgICAgICAgICAgdGhpcy52aWV3LmZvcmNlUmVuZGVyKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgICAgIG9sZFNlbGVjdGlvbjogdGhpcy5zZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0aW9uOiBuZXdWaWV3U2VsZWN0aW9uLFxuICAgICAgICAgICAgICAgIGRvbVNlbGVjdGlvblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5pbmZvKCAnJWNbU2VsZWN0aW9uT2JzZXJ2ZXJdJWMgRmlyZSBzZWxlY3Rpb24gY2hhbmdlOicsXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiBncmVlbicsICcnLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0bmV3Vmlld1NlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKClcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICAvLyBQcmVwYXJlIGRhdGEgZm9yIG5ldyBzZWxlY3Rpb24gYW5kIGZpcmUgYXBwcm9wcmlhdGUgZXZlbnRzLlxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudC5maXJlKCdzZWxlY3Rpb25DaGFuZ2UnLCBkYXRhKTtcbiAgICAgICAgICAgIC8vIENhbGwgYCNfZmlyZVNlbGVjdGlvbkNoYW5nZURvbmVEZWJvdW5jZWRgIGV2ZXJ5IHRpbWUgd2hlbiBgc2VsZWN0aW9uQ2hhbmdlYCBldmVudCBpcyBmaXJlZC5cbiAgICAgICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgZGVib3VuY2VkIHdoYXQgbWVhbnMgdGhhdCBgc2VsZWN0aW9uQ2hhbmdlRG9uZWAgZXZlbnQgd2lsbCBiZSBmaXJlZCBvbmx5IHdoZW5cbiAgICAgICAgICAgIC8vIGRlZmluZWQgaW50IHRoZSBmdW5jdGlvbiB0aW1lIHdpbGwgZWxhcHNlIHNpbmNlIHRoZSBsYXN0IHRpbWUgdGhlIGZ1bmN0aW9uIHdhcyBjYWxsZWQuXG4gICAgICAgICAgICAvLyBTbyBgc2VsZWN0aW9uQ2hhbmdlRG9uZWAgd2lsbCBiZSBmaXJlZCB3aGVuIHNlbGVjdGlvbiB3aWxsIHN0b3AgY2hhbmdpbmcuXG4gICAgICAgICAgICB0aGlzLl9maXJlU2VsZWN0aW9uQ2hhbmdlRG9uZURlYm91bmNlZChkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2xlYXJzIGBTZWxlY3Rpb25PYnNlcnZlcmAgaW50ZXJuYWwgcHJvcGVydGllcyBjb25uZWN0ZWQgd2l0aCBwcmV2ZW50aW5nIGluZmluaXRlIGxvb3AuXG5cdCAqLyBfY2xlYXJJbmZpbml0ZUxvb3AoKSB7XG4gICAgICAgIHRoaXMuX2xvb3BiYWNrQ291bnRlciA9IDA7XG4gICAgfVxufVxuXG4vLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGNvbnN0IHsgX2RlYm91bmNlZExpbmUgfSA9IHJlcXVpcmUoICcuLi8uLi9kZXYtdXRpbHMvdXRpbHMuanMnICk7XG4vKipcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y29tcG9zaXRpb25zdGFydCBDb21wb3NpdGlvbnN0YXJ0fSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y29tcG9zaXRpb251cGRhdGUgY29tcG9zaXRpb251cGRhdGV9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpjb21wb3NpdGlvbmVuZCBjb21wb3NpdGlvbmVuZH0gZXZlbnRzIG9ic2VydmVyLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIG9ic2VydmVyIGlzIGF0dGFjaGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gYW5kIGlzIGF2YWlsYWJsZSBieSBkZWZhdWx0LlxuICovIGNsYXNzIENvbXBvc2l0aW9uT2JzZXJ2ZXIgZXh0ZW5kcyBEb21FdmVudE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRvbUV2ZW50VHlwZSA9IFtcbiAgICAgICAgJ2NvbXBvc2l0aW9uc3RhcnQnLFxuICAgICAgICAnY29tcG9zaXRpb251cGRhdGUnLFxuICAgICAgICAnY29tcG9zaXRpb25lbmQnXG4gICAgXTtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNvbnN0cnVjdG9yKHZpZXcpe1xuICAgICAgICBzdXBlcih2aWV3KTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSB0aGlzLmRvY3VtZW50O1xuICAgICAgICBkb2N1bWVudC5vbignY29tcG9zaXRpb25zdGFydCcsICgpPT57XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUubG9nKCAnJWNbQ29tcG9zaXRpb25PYnNlcnZlcl0gJyArXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQn4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAIGlzQ29tcG9zaW5nID0gdHJ1ZSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJAnLFxuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2ZvbnQtd2VpZ2h0OiBib2xkOyBjb2xvcjogZ3JlZW4nXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICAgICAgZG9jdW1lbnQuaXNDb21wb3NpbmcgPSB0cnVlO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIGRvY3VtZW50Lm9uKCdjb21wb3NpdGlvbmVuZCcsICgpPT57XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUubG9nKCAnJWNbQ29tcG9zaXRpb25PYnNlcnZlcl0gJyArXG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQn4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAIGlzQ29tcG9zaW5nID0gZmFsc2Ug4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYJyxcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCdmb250LXdlaWdodDogYm9sZDsgY29sb3I6IGdyZWVuJ1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdCk7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgICAgIGRvY3VtZW50LmlzQ29tcG9zaW5nID0gZmFsc2U7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvbkRvbUV2ZW50KGRvbUV2ZW50KSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRfZGVib3VuY2VkTGluZSgpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cCggYCVjW0NvbXBvc2l0aW9uT2JzZXJ2ZXJdJWMgJHsgZG9tRXZlbnQudHlwZSB9YCwgJ2NvbG9yOiBncmVlbicsICcnICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICB0aGlzLmZpcmUoZG9tRXZlbnQudHlwZSwgZG9tRXZlbnQsIHtcbiAgICAgICAgICAgIGRhdGE6IGRvbUV2ZW50LmRhdGFcbiAgICAgICAgfSk7XG4gICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSBlbmdpbmUvdmlldy9kYXRhdHJhbnNmZXJcbiAqLyAvKipcbiAqIEEgZmFjYWRlIG92ZXIgdGhlIG5hdGl2ZSBbYERhdGFUcmFuc2ZlcmBdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9EYXRhVHJhbnNmZXIpIG9iamVjdC5cbiAqLyBjbGFzcyBEYXRhVHJhbnNmZXIge1xuICAgIC8qKlxuXHQgKiBUaGUgYXJyYXkgb2YgZmlsZXMgY3JlYXRlZCBmcm9tIHRoZSBuYXRpdmUgYERhdGFUcmFuc2ZlciNmaWxlc2Agb3IgYERhdGFUcmFuc2ZlciNpdGVtc2AuXG5cdCAqLyBfZmlsZXM7XG4gICAgLyoqXG5cdCAqIFRoZSBuYXRpdmUgRGF0YVRyYW5zZmVyIG9iamVjdC5cblx0ICovIF9uYXRpdmU7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBuYXRpdmVEYXRhVHJhbnNmZXIgVGhlIG5hdGl2ZSBbYERhdGFUcmFuc2ZlcmBdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9EYXRhVHJhbnNmZXIpIG9iamVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuY2FjaGVGaWxlcyBXaGV0aGVyIGBmaWxlc2AgbGlzdCBzaG91bGQgYmUgaW5pdGlhbGl6ZWQgaW4gdGhlIGNvbnN0cnVjdG9yLlxuXHQgKi8gY29uc3RydWN0b3IobmF0aXZlRGF0YVRyYW5zZmVyLCBvcHRpb25zID0ge30pe1xuICAgICAgICAvLyBXZSBzaG91bGQgc3RvcmUgcmVmZXJlbmNlcyB0byB0aGUgRmlsZSBpbnN0YW5jZXMgaW4gY2FzZSBzb21lb25lIHdvdWxkIGxpa2UgdG8gcHJvY2VzcyB0aGlzIGZpbGVzXG4gICAgICAgIC8vIG91dHNpZGUgdGhlIGV2ZW50IGhhbmRsZXIuIEZpbGVzIGFyZSBzdG9yZWQgb25seSBmb3IgYGRyb3BgIGFuZCBgcGFzdGVgIGV2ZW50cyBiZWNhdXNlIHRoZXkgYXJlIG5vdCB1c2FibGVcbiAgICAgICAgLy8gaW4gb3RoZXIgZXZlbnRzIGFuZCBhcmUgZ2VuZXJhdGluZyBhIGh1Z2UgZGVsYXkgb24gRmlyZWZveCB3aGlsZSBkcmFnZ2luZy5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEzMzY2LlxuICAgICAgICB0aGlzLl9maWxlcyA9IG9wdGlvbnMuY2FjaGVGaWxlcyA/IGdldEZpbGVzKG5hdGl2ZURhdGFUcmFuc2ZlcikgOiBudWxsO1xuICAgICAgICB0aGlzLl9uYXRpdmUgPSBuYXRpdmVEYXRhVHJhbnNmZXI7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgYXJyYXkgb2YgZmlsZXMgY3JlYXRlZCBmcm9tIHRoZSBuYXRpdmUgYERhdGFUcmFuc2ZlciNmaWxlc2Agb3IgYERhdGFUcmFuc2ZlciNpdGVtc2AuXG5cdCAqLyBnZXQgZmlsZXMoKSB7XG4gICAgICAgIGlmICghdGhpcy5fZmlsZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpbGVzID0gZ2V0RmlsZXModGhpcy5fbmF0aXZlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZmlsZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGFycmF5IG9mIGF2YWlsYWJsZSBuYXRpdmUgY29udGVudCB0eXBlcy5cblx0ICovIGdldCB0eXBlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25hdGl2ZS50eXBlcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIGRhdGEgZnJvbSB0aGUgZGF0YSB0cmFuc2ZlciBieSBpdHMgTUlNRSB0eXBlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBkYXRhVHJhbnNmZXIuZ2V0RGF0YSggJ3RleHQvcGxhaW4nICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gdHlwZSBUaGUgTUlNRSB0eXBlLiBFLmcuIGB0ZXh0L2h0bWxgIG9yIGB0ZXh0L3BsYWluYC5cblx0ICovIGdldERhdGEodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmF0aXZlLmdldERhdGEodHlwZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHRoZSBkYXRhIGluIHRoZSBkYXRhIHRyYW5zZmVyLlxuXHQgKlxuXHQgKiBAcGFyYW0gdHlwZSBUaGUgTUlNRSB0eXBlLiBFLmcuIGB0ZXh0L2h0bWxgIG9yIGB0ZXh0L3BsYWluYC5cblx0ICovIHNldERhdGEodHlwZSwgZGF0YSkge1xuICAgICAgICB0aGlzLl9uYXRpdmUuc2V0RGF0YSh0eXBlLCBkYXRhKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBlZmZlY3QgdGhhdCBpcyBhbGxvd2VkIGZvciBhIGRyYWcgb3BlcmF0aW9uLlxuXHQgKi8gc2V0IGVmZmVjdEFsbG93ZWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fbmF0aXZlLmVmZmVjdEFsbG93ZWQgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0IGVmZmVjdEFsbG93ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9uYXRpdmUuZWZmZWN0QWxsb3dlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBhY3R1YWwgZHJvcCBlZmZlY3QuXG5cdCAqLyBzZXQgZHJvcEVmZmVjdCh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9uYXRpdmUuZHJvcEVmZmVjdCA9IHZhbHVlO1xuICAgIH1cbiAgICBnZXQgZHJvcEVmZmVjdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25hdGl2ZS5kcm9wRWZmZWN0O1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0IGEgcHJldmlldyBpbWFnZSBvZiB0aGUgZHJhZ2dlZCBjb250ZW50LlxuXHQgKi8gc2V0RHJhZ0ltYWdlKGltYWdlLCB4LCB5KSB7XG4gICAgICAgIHRoaXMuX25hdGl2ZS5zZXREcmFnSW1hZ2UoaW1hZ2UsIHgsIHkpO1xuICAgIH1cbiAgICAvKipcblx0ICogV2hldGhlciB0aGUgZHJhZ2dpbmcgb3BlcmF0aW9uIHdhcyBjYW5jZWxlZC5cblx0ICovIGdldCBpc0NhbmNlbGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmF0aXZlLmRyb3BFZmZlY3QgPT0gJ25vbmUnIHx8ICEhdGhpcy5fbmF0aXZlLm1velVzZXJDYW5jZWxsZWQ7XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0RmlsZXMobmF0aXZlRGF0YVRyYW5zZmVyKSB7XG4gICAgLy8gRGF0YVRyYW5zZmVyLmZpbGVzIGFuZCBpdGVtcyBhcmUgYXJyYXktbGlrZSBhbmQgbWlnaHQgbm90IGhhdmUgYW4gaXRlcmFibGUgaW50ZXJmYWNlLlxuICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShuYXRpdmVEYXRhVHJhbnNmZXIuZmlsZXMgfHwgW10pO1xuICAgIGNvbnN0IGl0ZW1zID0gQXJyYXkuZnJvbShuYXRpdmVEYXRhVHJhbnNmZXIuaXRlbXMgfHwgW10pO1xuICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZpbGVzO1xuICAgIH1cbiAgICAvLyBDaHJvbWUgaGFzIGVtcHR5IERhdGFUcmFuc2Zlci5maWxlcywgYnV0IGFsbG93cyBnZXR0aW5nIGZpbGVzIHRocm91Z2ggdGhlIGl0ZW1zIGludGVyZmFjZS5cbiAgICByZXR1cm4gaXRlbXMuZmlsdGVyKChpdGVtKT0+aXRlbS5raW5kID09PSAnZmlsZScpLm1hcCgoaXRlbSk9Pml0ZW0uZ2V0QXNGaWxlKCkpO1xufVxuXG4vLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGNvbnN0IHsgX2RlYm91bmNlZExpbmUgfSA9IHJlcXVpcmUoICcuLi8uLi9kZXYtdXRpbHMvdXRpbHMuanMnICk7XG4vKipcbiAqIE9ic2VydmVyIGZvciBldmVudHMgY29ubmVjdGVkIHdpdGggZGF0YSBpbnB1dC5cbiAqXG4gKiAqKk5vdGUqKjogVGhpcyBvYnNlcnZlciBpcyBhdHRhY2hlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gYW5kIGF2YWlsYWJsZSBieSBkZWZhdWx0IGluIGFsbFxuICogZWRpdG9yIGluc3RhbmNlcy5cbiAqLyBjbGFzcyBJbnB1dE9ic2VydmVyIGV4dGVuZHMgRG9tRXZlbnRPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBkb21FdmVudFR5cGUgPSAnYmVmb3JlaW5wdXQnO1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gb25Eb21FdmVudChkb21FdmVudCkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0X2RlYm91bmNlZExpbmUoKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuZ3JvdXAoIGAlY1tJbnB1dE9ic2VydmVyXSVjICR7IGRvbUV2ZW50LnR5cGUgfTogJHsgZG9tRXZlbnQuaW5wdXRUeXBlIH1gLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuJywgJ2NvbG9yOiBkZWZhdWx0J1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIGNvbnN0IGRvbVRhcmdldFJhbmdlcyA9IGRvbUV2ZW50LmdldFRhcmdldFJhbmdlcygpO1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy52aWV3O1xuICAgICAgICBjb25zdCB2aWV3RG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50O1xuICAgICAgICBsZXQgZGF0YVRyYW5zZmVyID0gbnVsbDtcbiAgICAgICAgbGV0IGRhdGEgPSBudWxsO1xuICAgICAgICBsZXQgdGFyZ2V0UmFuZ2VzID0gW107XG4gICAgICAgIGlmIChkb21FdmVudC5kYXRhVHJhbnNmZXIpIHtcbiAgICAgICAgICAgIGRhdGFUcmFuc2ZlciA9IG5ldyBEYXRhVHJhbnNmZXIoZG9tRXZlbnQuZGF0YVRyYW5zZmVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9tRXZlbnQuZGF0YSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZGF0YSA9IGRvbUV2ZW50LmRhdGE7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oIGAlY1tJbnB1dE9ic2VydmVyXSVjIGV2ZW50IGRhdGE6ICVjJHsgSlNPTi5zdHJpbmdpZnkoIGRhdGEgKSB9YCxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0J2NvbG9yOiBncmVlbjsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnZm9udC13ZWlnaHQ6IGJvbGQnLCAnY29sb3I6IGJsdWU7J1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YVRyYW5zZmVyKSB7XG4gICAgICAgICAgICBkYXRhID0gZGF0YVRyYW5zZmVyLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggYCVjW0lucHV0T2JzZXJ2ZXJdJWMgZXZlbnQgZGF0YSB0cmFuc2ZlcjogJWMkeyBKU09OLnN0cmluZ2lmeSggZGF0YSApIH1gLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsICdmb250LXdlaWdodDogYm9sZCcsICdjb2xvcjogYmx1ZTsnXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHQpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB0aGUgZWRpdG9yIHNlbGVjdGlvbiBpcyBmYWtlIChhbiBvYmplY3QgaXMgc2VsZWN0ZWQpLCB0aGUgRE9NIHJhbmdlIGRvZXMgbm90IG1ha2Ugc2Vuc2UgYmVjYXVzZSBpdCBpcyBhbmNob3JlZFxuICAgICAgICAvLyBpbiB0aGUgZmFrZSBzZWxlY3Rpb24gY29udGFpbmVyLlxuICAgICAgICBpZiAodmlld0RvY3VtZW50LnNlbGVjdGlvbi5pc0Zha2UpIHtcbiAgICAgICAgICAgIC8vIEZ1dHVyZS1wcm9vZjogaW4gY2FzZSBvZiBtdWx0aS1yYW5nZSBmYWtlIHNlbGVjdGlvbnMgYmVpbmcgcG9zc2libGUuXG4gICAgICAgICAgICB0YXJnZXRSYW5nZXMgPSBBcnJheS5mcm9tKHZpZXdEb2N1bWVudC5zZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIGlmICggKCB3aW5kb3cgYXMgYW55ICkubG9nQ0tFVHlwaW5nICkge1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5pbmZvKCAnJWNbSW5wdXRPYnNlcnZlcl0lYyB1c2luZyBmYWtlIHNlbGVjdGlvbjonLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsICdmb250LXdlaWdodDogYm9sZCcsIHRhcmdldFJhbmdlcyxcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdFx0dmlld0RvY3VtZW50LnNlbGVjdGlvbi5pc0Zha2UgPyAnZmFrZSB2aWV3IHNlbGVjdGlvbicgOiAnZmFrZSBET00gcGFyZW50J1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIH0gZWxzZSBpZiAoZG9tVGFyZ2V0UmFuZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGFyZ2V0UmFuZ2VzID0gZG9tVGFyZ2V0UmFuZ2VzLm1hcCgoZG9tUmFuZ2UpPT57XG4gICAgICAgICAgICAgICAgLy8gU29tZXRpbWVzIGJyb3dzZXIgcHJvdmlkZXMgcmFuZ2UgdGhhdCBzdGFydHMgYmVmb3JlIGVkaXRhYmxlIG5vZGUuXG4gICAgICAgICAgICAgICAgLy8gV2UgdHJ5IHRvIGZhbGwgYmFjayB0byBjb2xsYXBzZWQgcmFuZ2UgYXQgdGhlIHZhbGlkIGVuZCBwb3NpdGlvbi5cbiAgICAgICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTQ0MTEuXG4gICAgICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE0MDUwLlxuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdTdGFydCA9IHZpZXcuZG9tQ29udmVydGVyLmRvbVBvc2l0aW9uVG9WaWV3KGRvbVJhbmdlLnN0YXJ0Q29udGFpbmVyLCBkb21SYW5nZS5zdGFydE9mZnNldCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgdmlld0VuZCA9IHZpZXcuZG9tQ29udmVydGVyLmRvbVBvc2l0aW9uVG9WaWV3KGRvbVJhbmdlLmVuZENvbnRhaW5lciwgZG9tUmFuZ2UuZW5kT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBpZiAodmlld1N0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3LmNyZWF0ZVJhbmdlKHZpZXdTdGFydCwgdmlld0VuZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2aWV3RW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3LmNyZWF0ZVJhbmdlKHZpZXdFbmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmZpbHRlcigocmFuZ2UpPT4hIXJhbmdlKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggJyVjW0lucHV0T2JzZXJ2ZXJdJWMgdXNpbmcgdGFyZ2V0IHJhbmdlczonLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsICdmb250LXdlaWdodDogYm9sZCcsIHRhcmdldFJhbmdlc1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIH0gZWxzZSBpZiAoZW52LmlzQW5kcm9pZCkge1xuICAgICAgICAgICAgY29uc3QgZG9tU2VsZWN0aW9uID0gZG9tRXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgICB0YXJnZXRSYW5nZXMgPSBBcnJheS5mcm9tKHZpZXcuZG9tQ29udmVydGVyLmRvbVNlbGVjdGlvblRvVmlldyhkb21TZWxlY3Rpb24pLmdldFJhbmdlcygpKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdGNvbnNvbGUuaW5mbyggJyVjW0lucHV0T2JzZXJ2ZXJdJWMgdXNpbmcgc2VsZWN0aW9uIHJhbmdlczonLFxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0XHQnY29sb3I6IGdyZWVuOyBmb250LXdlaWdodDogYm9sZCcsICdmb250LXdlaWdodDogYm9sZCcsIHRhcmdldFJhbmdlc1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0KTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQW5kcm9pZCBzb21ldGltZXMgZmlyZXMgaW5zZXJ0Q29tcG9zaXRpb25UZXh0IHdpdGggYSBuZXctbGluZSBjaGFyYWN0ZXIgYXQgdGhlIGVuZCBvZiB0aGUgZGF0YVxuICAgICAgICAvLyBpbnN0ZWFkIG9mIGZpcmluZyBpbnNlcnRQYXJhZ3JhcGggYmVmb3JlSW5wdXQgZXZlbnQuXG4gICAgICAgIC8vIEZpcmUgdGhlIGNvcnJlY3QgdHlwZSBvZiBiZWZvcmVJbnB1dCBldmVudCBhbmQgaWdub3JlIHRoZSByZXBsYWNlZCBmcmFnbWVudCBvZiB0ZXh0IGJlY2F1c2VcbiAgICAgICAgLy8gaXQgd2FudHMgdG8gcmVwbGFjZSBcInRlc3RcIiB3aXRoIFwidGVzdFxcblwiLlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMjM2OC5cbiAgICAgICAgaWYgKGVudi5pc0FuZHJvaWQgJiYgZG9tRXZlbnQuaW5wdXRUeXBlID09ICdpbnNlcnRDb21wb3NpdGlvblRleHQnICYmIGRhdGEgJiYgZGF0YS5lbmRzV2l0aCgnXFxuJykpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZShkb21FdmVudC50eXBlLCBkb21FdmVudCwge1xuICAgICAgICAgICAgICAgIGlucHV0VHlwZTogJ2luc2VydFBhcmFncmFwaCcsXG4gICAgICAgICAgICAgICAgdGFyZ2V0UmFuZ2VzOiBbXG4gICAgICAgICAgICAgICAgICAgIHZpZXcuY3JlYXRlUmFuZ2UodGFyZ2V0UmFuZ2VzWzBdLmVuZClcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm9ybWFsaXplIHRoZSBpbnNlcnRUZXh0IGRhdGEgdGhhdCBpbmNsdWRlcyBuZXctbGluZSBjaGFyYWN0ZXJzLlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8yMDQ1LlxuICAgICAgICBpZiAoZG9tRXZlbnQuaW5wdXRUeXBlID09ICdpbnNlcnRUZXh0JyAmJiBkYXRhICYmIGRhdGEuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICAgICAgICAvLyBUaGVyZSBtaWdodCBiZSBhIHNpbmdsZSBuZXctbGluZSBvciBkb3VibGUgZm9yIG5ldyBwYXJhZ3JhcGgsIGJ1dCB3ZSB0cmFuc2xhdGVcbiAgICAgICAgICAgIC8vIGl0IHRvIHBhcmFncmFwaHMgYXMgaXQgaXMgb3VyIGRlZmF1bHQgYWN0aW9uIGZvciBlbnRlciBoYW5kbGluZy5cbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0YS5zcGxpdCgvXFxuezEsMn0vZyk7XG4gICAgICAgICAgICBsZXQgcGFydFRhcmdldFJhbmdlcyA9IHRhcmdldFJhbmdlcztcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YVBhcnQgPSBwYXJ0c1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVBhcnQgIT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKGRvbUV2ZW50LnR5cGUsIGRvbUV2ZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhUGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUcmFuc2ZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFJhbmdlczogcGFydFRhcmdldFJhbmdlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0VHlwZTogZG9tRXZlbnQuaW5wdXRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNDb21wb3Npbmc6IGRvbUV2ZW50LmlzQ29tcG9zaW5nXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHJlc3VsdCB2aWV3IHNlbGVjdGlvbiBzbyBmb2xsb3dpbmcgZXZlbnRzIHdpbGwgYmUgYWRkZWQgb25lIGFmdGVyIGFub3RoZXIuXG4gICAgICAgICAgICAgICAgICAgIHBhcnRUYXJnZXRSYW5nZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3RG9jdW1lbnQuc2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKVxuICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBwYXJ0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKGRvbUV2ZW50LnR5cGUsIGRvbUV2ZW50LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dFR5cGU6ICdpbnNlcnRQYXJhZ3JhcGgnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UmFuZ2VzOiBwYXJ0VGFyZ2V0UmFuZ2VzXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHJlc3VsdCB2aWV3IHNlbGVjdGlvbiBzbyBmb2xsb3dpbmcgZXZlbnRzIHdpbGwgYmUgYWRkZWQgb25lIGFmdGVyIGFub3RoZXIuXG4gICAgICAgICAgICAgICAgICAgIHBhcnRUYXJnZXRSYW5nZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3RG9jdW1lbnQuc2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKVxuICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRmlyZSB0aGUgbm9ybWFsaXplZCBiZWZvcmVJbnB1dCBldmVudC5cbiAgICAgICAgdGhpcy5maXJlKGRvbUV2ZW50LnR5cGUsIGRvbUV2ZW50LCB7XG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgZGF0YVRyYW5zZmVyLFxuICAgICAgICAgICAgdGFyZ2V0UmFuZ2VzLFxuICAgICAgICAgICAgaW5wdXRUeXBlOiBkb21FdmVudC5pbnB1dFR5cGUsXG4gICAgICAgICAgICBpc0NvbXBvc2luZzogZG9tRXZlbnQuaXNDb21wb3NpbmdcbiAgICAgICAgfSk7XG4gICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBpZiAoICggd2luZG93IGFzIGFueSApLmxvZ0NLRVR5cGluZyApIHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfVFlQSU5HIC8vIFx0Y29uc29sZS5ncm91cEVuZCgpO1xuICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBcnJvdyBrZXlzIG9ic2VydmVyIGludHJvZHVjZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6YXJyb3dLZXkgYERvY3VtZW50I2Fycm93S2V5YH0gZXZlbnQuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgb2JzZXJ2ZXIgaXMgYXR0YWNoZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fSBhbmQgaXMgYXZhaWxhYmxlIGJ5IGRlZmF1bHQuXG4gKi8gY2xhc3MgQXJyb3dLZXlzT2JzZXJ2ZXIgZXh0ZW5kcyBPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBjb25zdHJ1Y3Rvcih2aWV3KXtcbiAgICAgICAgc3VwZXIodmlldyk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQub24oJ2tleWRvd24nLCAoZXZlbnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAodGhpcy5pc0VuYWJsZWQgJiYgaXNBcnJvd0tleUNvZGUoZGF0YS5rZXlDb2RlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50SW5mbyA9IG5ldyBCdWJibGluZ0V2ZW50SW5mbyh0aGlzLmRvY3VtZW50LCAnYXJyb3dLZXknLCB0aGlzLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCkpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuZmlyZShldmVudEluZm8sIGRhdGEpO1xuICAgICAgICAgICAgICAgIGlmIChldmVudEluZm8uc3RvcC5jYWxsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gb2JzZXJ2ZSgpIHt9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdG9wT2JzZXJ2aW5nKCkge31cbn1cblxuLyoqXG4gKiBUYWIgb2JzZXJ2ZXIgaW50cm9kdWNlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDp0YWIgYERvY3VtZW50I3RhYmB9IGV2ZW50LlxuICpcbiAqIE5vdGUgdGhhdCBiZWNhdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvdGFib2JzZXJ2ZXJ+VGFiT2JzZXJ2ZXJ9IGlzIGF0dGFjaGVkIGJ5IHRoZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXd9LCB0aGlzIGV2ZW50IGlzIGF2YWlsYWJsZSBieSBkZWZhdWx0LlxuICovIGNsYXNzIFRhYk9ic2VydmVyIGV4dGVuZHMgT2JzZXJ2ZXIge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gY29uc3RydWN0b3Iodmlldyl7XG4gICAgICAgIHN1cGVyKHZpZXcpO1xuICAgICAgICBjb25zdCBkb2MgPSB0aGlzLmRvY3VtZW50O1xuICAgICAgICBkb2Mub24oJ2tleWRvd24nLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRW5hYmxlZCB8fCBkYXRhLmtleUNvZGUgIT0ga2V5Q29kZXMudGFiIHx8IGRhdGEuY3RybEtleSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEJ1YmJsaW5nRXZlbnRJbmZvKGRvYywgJ3RhYicsIGRvYy5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpKTtcbiAgICAgICAgICAgIGRvYy5maXJlKGV2ZW50LCBkYXRhKTtcbiAgICAgICAgICAgIGlmIChldmVudC5zdG9wLmNhbGxlZCkge1xuICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIG9ic2VydmUoKSB7fVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RvcE9ic2VydmluZygpIHt9XG59XG5cbi8qKlxuICogRWRpdG9yJ3MgdmlldyBjb250cm9sbGVyIGNsYXNzLiBJdHMgbWFpbiByZXNwb25zaWJpbGl0eSBpcyBET00gLSBWaWV3IG1hbmFnZW1lbnQgZm9yIGVkaXRpbmcgcHVycG9zZXMsIHRvIHByb3ZpZGVcbiAqIGFic3RyYWN0aW9uIG92ZXIgdGhlIERPTSBzdHJ1Y3R1cmUgYW5kIGV2ZW50cyBhbmQgaGlkZSBhbGwgYnJvd3NlcnMgcXVpcmtzLlxuICpcbiAqIFZpZXcgY29udHJvbGxlciByZW5kZXJzIHZpZXcgZG9jdW1lbnQgdG8gRE9NIHdoZW5ldmVyIHZpZXcgc3RydWN0dXJlIGNoYW5nZXMuIFRvIGRldGVybWluZSB3aGVuIHZpZXcgY2FuIGJlIHJlbmRlcmVkLFxuICogYWxsIGNoYW5nZXMgbmVlZCB0byBiZSBkb25lIHVzaW5nIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjaGFuZ2V9IG1ldGhvZCwgdXNpbmdcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXJ9OlxuICpcbiAqIGBgYHRzXG4gKiB2aWV3LmNoYW5nZSggd3JpdGVyID0+IHtcbiAqIFx0d3JpdGVyLmluc2VydCggcG9zaXRpb24sIHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApICk7XG4gKiB9ICk7XG4gKiBgYGBcbiAqXG4gKiBWaWV3IGNvbnRyb2xsZXIgYWxzbyByZWdpc3RlciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyIG9ic2VydmVyc30gd2hpY2ggb2JzZXJ2ZXMgY2hhbmdlc1xuICogb24gRE9NIGFuZCBmaXJlIGV2ZW50cyBvbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBEb2N1bWVudH0uXG4gKiBOb3RlIHRoYXQgdGhlIGZvbGxvd2luZyBvYnNlcnZlcnMgYXJlIGFkZGVkIGJ5IHRoZSBjbGFzcyBjb25zdHJ1Y3RvciBhbmQgYXJlIGFsd2F5cyBhdmFpbGFibGU6XG4gKlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL3NlbGVjdGlvbm9ic2VydmVyflNlbGVjdGlvbk9ic2VydmVyfSxcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9mb2N1c29ic2VydmVyfkZvY3VzT2JzZXJ2ZXJ9LFxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2tleW9ic2VydmVyfktleU9ic2VydmVyfSxcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9mYWtlc2VsZWN0aW9ub2JzZXJ2ZXJ+RmFrZVNlbGVjdGlvbk9ic2VydmVyfS5cbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9vYnNlcnZlci9jb21wb3NpdGlvbm9ic2VydmVyfkNvbXBvc2l0aW9uT2JzZXJ2ZXJ9LlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL2lucHV0b2JzZXJ2ZXJ+SW5wdXRPYnNlcnZlcn0uXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvYXJyb3drZXlzb2JzZXJ2ZXJ+QXJyb3dLZXlzT2JzZXJ2ZXJ9LlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL3RhYm9ic2VydmVyflRhYk9ic2VydmVyfS5cbiAqXG4gKiBUaGlzIGNsYXNzIGFsc28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjYXR0YWNoRG9tUm9vdCBiaW5kcyB0aGUgRE9NIGFuZCB0aGUgdmlldyBlbGVtZW50c30uXG4gKlxuICogSWYgeW91IGRvIG5vdCBuZWVkIGZ1bGwgYSBET00gLSB2aWV3IG1hbmFnZW1lbnQsIGFuZCBvbmx5IHdhbnQgdG8gdHJhbnNmb3JtIGEgdHJlZSBvZiB2aWV3IGVsZW1lbnRzIHRvIGEgdHJlZSBvZiBET01cbiAqIGVsZW1lbnRzIHlvdSBkbyBub3QgbmVlZCB0aGlzIGNvbnRyb2xsZXIuIFlvdSBjYW4gdXNlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIgRG9tQ29udmVydGVyfSBpbnN0ZWFkLlxuICovIGNsYXNzIFZpZXcgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gT2JzZXJ2YWJsZU1peGluKCkge1xuICAgIC8qKlxuXHQgKiBJbnN0YW5jZSBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudH0gYXNzb2NpYXRlZCB3aXRoIHRoaXMgdmlldyBjb250cm9sbGVyLlxuXHQgKi8gZG9jdW1lbnQ7XG4gICAgLyoqXG5cdCAqIEluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIgZG9tQ29udmVydGVyfSB1c2VkIGJ5XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I19yZW5kZXJlciByZW5kZXJlcn1cblx0ICogYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIgb2JzZXJ2ZXJzfS5cblx0ICovIGRvbUNvbnZlcnRlcjtcbiAgICAvKipcblx0ICogUm9vdHMgb2YgdGhlIERPTSB0cmVlLiBNYXAgb24gdGhlIGBIVE1MRWxlbWVudGBzIHdpdGggcm9vdHMgbmFtZXMgYXMga2V5cy5cblx0ICovIGRvbVJvb3RzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBJbnN0YW5jZSBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlciByZW5kZXJlcn0uXG5cdCAqLyBfcmVuZGVyZXI7XG4gICAgLyoqXG5cdCAqIEEgRE9NIHJvb3QgYXR0cmlidXRlcyBjYWNoZS4gSXQgc2F2ZXMgdGhlIGluaXRpYWwgdmFsdWVzIG9mIERPTSByb290IGF0dHJpYnV0ZXMgYmVmb3JlIHRoZSBET00gZWxlbWVudFxuXHQgKiBpcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNhdHRhY2hEb21Sb290IGF0dGFjaGVkfSB0byB0aGUgdmlldyBzbyBsYXRlciBvbiwgd2hlblxuXHQgKiB0aGUgdmlldyBpcyBkZXN0cm95ZWQgKHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2RldGFjaERvbVJvb3R9KSwgdGhleSBjYW4gYmUgZWFzaWx5IHJlc3RvcmVkLlxuXHQgKiBUaGlzIHdheSwgdGhlIERPTSBlbGVtZW50IGNhbiBnbyBiYWNrIHRvIHRoZSAoY2xlYW4pIHN0YXRlIGFzIGlmIHRoZSBlZGl0aW5nIHZpZXcgbmV2ZXIgdXNlZCBpdC5cblx0ICovIF9pbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMgPSBuZXcgV2Vha01hcCgpO1xuICAgIC8qKlxuXHQgKiBNYXAgb2YgcmVnaXN0ZXJlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyIG9ic2VydmVyc30uXG5cdCAqLyBfb2JzZXJ2ZXJzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBEb3duY2FzdFdyaXRlciBpbnN0YW5jZSB1c2VkIGluIHtAbGluayAjY2hhbmdlIGNoYW5nZSBtZXRob2R9IGNhbGxiYWNrcy5cblx0ICovIF93cml0ZXI7XG4gICAgLyoqXG5cdCAqIElzIHNldCB0byBgdHJ1ZWAgd2hlbiB7QGxpbmsgI2NoYW5nZSB2aWV3IGNoYW5nZXN9IGFyZSBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MuXG5cdCAqLyBfb25nb2luZ0NoYW5nZSA9IGZhbHNlO1xuICAgIC8qKlxuXHQgKiBVc2VkIHRvIHByZXZlbnQgY2FsbGluZyB7QGxpbmsgI2ZvcmNlUmVuZGVyfSBhbmQge0BsaW5rICNjaGFuZ2V9IGR1cmluZyByZW5kZXJpbmcgdmlldyB0byB0aGUgRE9NLlxuXHQgKi8gX3Bvc3RGaXhlcnNJblByb2dyZXNzID0gZmFsc2U7XG4gICAgLyoqXG5cdCAqIEludGVybmFsIGZsYWcgdG8gdGVtcG9yYXJ5IGRpc2FibGUgcmVuZGVyaW5nLiBTZWUgdGhlIHVzYWdlIGluIHRoZSB7QGxpbmsgI19kaXNhYmxlUmVuZGVyaW5nfS5cblx0ICovIF9yZW5kZXJpbmdEaXNhYmxlZCA9IGZhbHNlO1xuICAgIC8qKlxuXHQgKiBJbnRlcm5hbCBmbGFnIHRoYXQgZGlzYWJsZXMgcmVuZGVyaW5nIHdoZW4gdGhlcmUgYXJlIG5vIGNoYW5nZXMgc2luY2UgdGhlIGxhc3QgcmVuZGVyaW5nLlxuXHQgKiBJdCBzdG9yZXMgaW5mb3JtYXRpb24gYWJvdXQgY2hhbmdlZCBzZWxlY3Rpb24gYW5kIGNoYW5nZWQgZWxlbWVudHMgZnJvbSBhdHRhY2hlZCBkb2N1bWVudCByb290cy5cblx0ICovIF9oYXNDaGFuZ2VkU2luY2VUaGVMYXN0UmVuZGVyaW5nID0gZmFsc2U7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBzdHlsZXNQcm9jZXNzb3IgVGhlIHN0eWxlcyBwcm9jZXNzb3IgaW5zdGFuY2UuXG5cdCAqLyBjb25zdHJ1Y3RvcihzdHlsZXNQcm9jZXNzb3Ipe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmRvY3VtZW50ID0gbmV3IERvY3VtZW50JDEoc3R5bGVzUHJvY2Vzc29yKTtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIgPSBuZXcgRG9tQ29udmVydGVyKHRoaXMuZG9jdW1lbnQpO1xuICAgICAgICB0aGlzLnNldCgnaXNSZW5kZXJpbmdJblByb2dyZXNzJywgZmFsc2UpO1xuICAgICAgICB0aGlzLnNldCgnaGFzRG9tU2VsZWN0aW9uJywgZmFsc2UpO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG5ldyBSZW5kZXJlcih0aGlzLmRvbUNvbnZlcnRlciwgdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24pO1xuICAgICAgICB0aGlzLl9yZW5kZXJlci5iaW5kKCdpc0ZvY3VzZWQnLCAnaXNTZWxlY3RpbmcnLCAnaXNDb21wb3NpbmcnKS50byh0aGlzLmRvY3VtZW50LCAnaXNGb2N1c2VkJywgJ2lzU2VsZWN0aW5nJywgJ2lzQ29tcG9zaW5nJyk7XG4gICAgICAgIHRoaXMuX3dyaXRlciA9IG5ldyBEb3duY2FzdFdyaXRlcih0aGlzLmRvY3VtZW50KTtcbiAgICAgICAgLy8gQWRkIGRlZmF1bHQgb2JzZXJ2ZXJzLlxuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGlzIGxpc3QgbWF0Y2hlcyBBbHdheXNSZWdpc3RlcmVkT2JzZXJ2ZXJzIHR5cGUuXG4gICAgICAgIHRoaXMuYWRkT2JzZXJ2ZXIoTXV0YXRpb25PYnNlcnZlcik7XG4gICAgICAgIHRoaXMuYWRkT2JzZXJ2ZXIoRm9jdXNPYnNlcnZlcik7XG4gICAgICAgIHRoaXMuYWRkT2JzZXJ2ZXIoU2VsZWN0aW9uT2JzZXJ2ZXIpO1xuICAgICAgICB0aGlzLmFkZE9ic2VydmVyKEtleU9ic2VydmVyKTtcbiAgICAgICAgdGhpcy5hZGRPYnNlcnZlcihGYWtlU2VsZWN0aW9uT2JzZXJ2ZXIpO1xuICAgICAgICB0aGlzLmFkZE9ic2VydmVyKENvbXBvc2l0aW9uT2JzZXJ2ZXIpO1xuICAgICAgICB0aGlzLmFkZE9ic2VydmVyKEFycm93S2V5c09ic2VydmVyKTtcbiAgICAgICAgdGhpcy5hZGRPYnNlcnZlcihJbnB1dE9ic2VydmVyKTtcbiAgICAgICAgdGhpcy5hZGRPYnNlcnZlcihUYWJPYnNlcnZlcik7XG4gICAgICAgIC8vIEluamVjdCBxdWlya3MgaGFuZGxlcnMuXG4gICAgICAgIGluamVjdFF1aXJrc0hhbmRsaW5nKHRoaXMpO1xuICAgICAgICBpbmplY3RVaUVsZW1lbnRIYW5kbGluZyh0aGlzKTtcbiAgICAgICAgLy8gVXNlICdub3JtYWwnIHByaW9yaXR5IHNvIHRoYXQgcmVuZGVyaW5nIGlzIHBlcmZvcm1lZCBhcyBmaXJzdCB3aGVuIHVzaW5nIHRoYXQgcHJpb3JpdHkuXG4gICAgICAgIHRoaXMub24oJ3JlbmRlcicsICgpPT57XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgICAgICAgIC8vIEluZm9ybXMgdGhhdCBsYXlvdXQgaGFzIGNoYW5nZWQgYWZ0ZXIgcmVuZGVyLlxuICAgICAgICAgICAgdGhpcy5kb2N1bWVudC5maXJlKCdsYXlvdXRDaGFuZ2VkJyk7XG4gICAgICAgICAgICAvLyBSZXNldCB0aGUgYF9oYXNDaGFuZ2VkU2luY2VUaGVMYXN0UmVuZGVyaW5nYCBmbGFnIGFmdGVyIHJlbmRlcmluZy5cbiAgICAgICAgICAgIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIExpc3RlbiB0byB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIGNoYW5nZXMgZGlyZWN0bHkuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5kb2N1bWVudC5zZWxlY3Rpb24sICdjaGFuZ2UnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5faGFzQ2hhbmdlZFNpbmNlVGhlTGFzdFJlbmRlcmluZyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUcmlnZ2VyIHJlLXJlbmRlciBpZiBvbmx5IHRoZSBmb2N1cyBjaGFuZ2VkLlxuICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMuZG9jdW1lbnQsICdjaGFuZ2U6aXNGb2N1c2VkJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVtb3ZlIHJhbmdlcyBmcm9tIERPTSBzZWxlY3Rpb24gaWYgZWRpdG9yIGlzIGJsdXJyZWQuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy81NzUzLlxuICAgICAgICBpZiAoZW52LmlzaU9TKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMuZG9jdW1lbnQsICdibHVyJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGVkVmlld0VsZW1lbnQgPSB0aGlzLmRvbUNvbnZlcnRlci5tYXBEb21Ub1ZpZXcoZGF0YS5kb21FdmVudC5yZWxhdGVkVGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAvLyBEbyBub3QgbW9kaWZ5IERPTSBzZWxlY3Rpb24gaWYgZm9jdXMgaXMgbW92ZWQgdG8gb3RoZXIgZWRpdGFibGUgb2YgdGhlIHNhbWUgZWRpdG9yLlxuICAgICAgICAgICAgICAgIGlmICghcmVsYXRlZFZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZG9tQ29udmVydGVyLl9jbGVhckRvbVNlbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIExpc3RlbiB0byBleHRlcm5hbCBjb250ZW50IG11dGF0aW9ucyAoZGlyZWN0bHkgaW4gdGhlIERPTSkgYW5kIG1hcmsgdGhlbSB0byBnZXQgdmVyaWZpZWQgYnkgdGhlIHJlbmRlcmVyLlxuICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMuZG9jdW1lbnQsICdtdXRhdGlvbnMnLCAoZXZ0LCB7IG11dGF0aW9ucyB9KT0+e1xuICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goKG11dGF0aW9uKT0+dGhpcy5fcmVuZGVyZXIubWFya1RvU3luYyhtdXRhdGlvbi50eXBlLCBtdXRhdGlvbi5ub2RlKSk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQWZ0ZXIgYWxsIG11dGF0ZWQgbm9kZXMgd2VyZSBtYXJrZWQgdG8gc3luYyB3ZSBjYW4gdHJpZ2dlciB2aWV3IHRvIERPTSBzeW5jaHJvbml6YXRpb25cbiAgICAgICAgLy8gdG8gbWFrZSBzdXJlIHRoZSBET00gc3RydWN0dXJlIG1hdGNoZXMgdGhlIHZpZXcuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5kb2N1bWVudCwgJ211dGF0aW9ucycsICgpPT57XG4gICAgICAgICAgICB0aGlzLmZvcmNlUmVuZGVyKCk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEF0dGFjaGVzIGEgRE9NIHJvb3QgZWxlbWVudCB0byB0aGUgdmlldyBlbGVtZW50IGFuZCBlbmFibGUgYWxsIG9ic2VydmVycyBvbiB0aGF0IGVsZW1lbnQuXG5cdCAqIEFsc28ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yZW5kZXJlcn5SZW5kZXJlciNtYXJrVG9TeW5jIG1hcmsgZWxlbWVudH0gdG8gYmUgc3luY2hyb25pemVkXG5cdCAqIHdpdGggdGhlIHZpZXcgd2hhdCBtZWFucyB0aGF0IGFsbCBjaGlsZCBub2RlcyB3aWxsIGJlIHJlbW92ZWQgYW5kIHJlcGxhY2VkIHdpdGggY29udGVudCBvZiB0aGUgdmlldyByb290LlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBhbHNvIHdpbGwgY2hhbmdlIHZpZXcgZWxlbWVudCBuYW1lIGFzIHRoZSBzYW1lIGFzIHRhZyBuYW1lIG9mIGdpdmVuIGRvbSByb290LlxuXHQgKiBOYW1lIGlzIGFsd2F5cyB0cmFuc2Zvcm1lZCB0byBsb3dlciBjYXNlLlxuXHQgKlxuXHQgKiAqKk5vdGU6KiogVXNlIHtAbGluayAjZGV0YWNoRG9tUm9vdCBgZGV0YWNoRG9tUm9vdCgpYH0gdG8gcmV2ZXJ0IHRoaXMgYWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9tUm9vdCBET00gcm9vdCBlbGVtZW50LlxuXHQgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSByb290LlxuXHQgKi8gYXR0YWNoRG9tUm9vdChkb21Sb290LCBuYW1lID0gJ21haW4nKSB7XG4gICAgICAgIGNvbnN0IHZpZXdSb290ID0gdGhpcy5kb2N1bWVudC5nZXRSb290KG5hbWUpO1xuICAgICAgICAvLyBTZXQgdmlldyByb290IG5hbWUgdGhlIHNhbWUgYXMgRE9NIHJvb3QgdGFnIG5hbWUuXG4gICAgICAgIHZpZXdSb290Ll9uYW1lID0gZG9tUm9vdC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IGluaXRpYWxEb21Sb290QXR0cmlidXRlcyA9IHt9O1xuICAgICAgICAvLyAxLiBDb3B5IGFuZCBjYWNoZSB0aGUgYXR0cmlidXRlcyB0byByZW1lbWJlciB0aGUgc3RhdGUgb2YgdGhlIGVsZW1lbnQgYmVmb3JlIGF0dGFjaGluZy5cbiAgICAgICAgLy8gICAgVGhlIGNhY2hlZCBhdHRyaWJ1dGVzIHdpbGwgYmUgcmVzdG9yZWQgaW4gZGV0YWNoRG9tUm9vdCgpIHNvIHRoZSBlbGVtZW50IGdvZXMgdG8gdGhlXG4gICAgICAgIC8vICAgIGNsZWFuIHN0YXRlIGFzIGlmIHRoZSBlZGl0aW5nIHZpZXcgbmV2ZXIgdXNlZCBpdC5cbiAgICAgICAgLy8gMi4gQXBwbHkgdGhlIGF0dHJpYnV0ZXMgdXNpbmcgdGhlIHZpZXcgd3JpdGVyLCBzbyB0aGV5IGFsbCBnbyB1bmRlciB0aGUgY29udHJvbCBvZiB0aGUgZW5naW5lLlxuICAgICAgICAvLyAgICBUaGUgZWRpdGluZyB2aWV3IHRha2VzIG92ZXIgdGhlIGF0dHJpYnV0ZSBtYW5hZ2VtZW50IGNvbXBsZXRlbHkgYmVjYXVzZSB2YXJpb3VzXG4gICAgICAgIC8vICAgIGZlYXR1cmVzIChlLmcuIGFkZFBsYWNlaG9sZGVyKCkpIHJlcXVpcmUgZHluYW1pYyBjaGFuZ2VzIG9mIHRob3NlIGF0dHJpYnV0ZXMgYW5kIHRoZXlcbiAgICAgICAgLy8gICAgY2Fubm90IGJlIG1hbmFnZWQgYnkgdGhlIGVuZ2luZSBhbmQgdGhlIFVJIGxpYnJhcnkgYXQgdGhlIHNhbWUgdGltZS5cbiAgICAgICAgZm9yIChjb25zdCB7IG5hbWUsIHZhbHVlIH0gb2YgQXJyYXkuZnJvbShkb21Sb290LmF0dHJpYnV0ZXMpKXtcbiAgICAgICAgICAgIGluaXRpYWxEb21Sb290QXR0cmlidXRlc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgLy8gRG8gbm90IHVzZSB3cml0ZXIuc2V0QXR0cmlidXRlKCkgZm9yIHRoZSBjbGFzcyBhdHRyaWJ1dGUuIFRoZSBFZGl0YWJsZVVJVmlldyBjbGFzc1xuICAgICAgICAgICAgLy8gYW5kIGl0cyBkZXNjZW5kYW50cyBjb3VsZCBoYXZlIGFscmVhZHkgc2V0IHNvbWUgdXNpbmcgdGhlIHdyaXRlci5hZGRDbGFzcygpIG9uIHRoZSB2aWV3XG4gICAgICAgICAgICAvLyBkb2N1bWVudCByb290LiBUaGV5IGhhdmVuJ3QgYmVlbiByZW5kZXJlZCB5ZXQgc28gdGhleSBhcmUgbm90IHByZXNlbnQgaW4gdGhlIERPTSByb290LlxuICAgICAgICAgICAgLy8gVXNpbmcgd3JpdGVyLnNldEF0dHJpYnV0ZSggJ2NsYXNzJywgLi4uICkgd291bGQgb3ZlcnJpZGUgdGhlbSBjb21wbGV0ZWx5LlxuICAgICAgICAgICAgaWYgKG5hbWUgPT09ICdjbGFzcycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZXIuYWRkQ2xhc3ModmFsdWUuc3BsaXQoJyAnKSwgdmlld1Jvb3QpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBhIGNoYW5jZSB0aGF0IHNvbWUgYXR0cmlidXRlcyBoYXZlIGFscmVhZHkgYmVlbiBzZXQgb24gdGhlIHZpZXcgcm9vdCBiZWZvcmUgYXR0YWNoaW5nXG4gICAgICAgICAgICAgICAgLy8gdGhlIERPTSByb290IGFuZCBzaG91bGQgYmUgcHJlc2VydmVkLiBUaGlzIGlzIGEgc2ltaWxhciBjYXNlIHRvIHRoZSBcImNsYXNzXCIgYXR0cmlidXRlIGV4Y2VwdFxuICAgICAgICAgICAgICAgIC8vIHRoaXMgdGltZSB0aGVyZSBpcyBubyB3b3JrYXJvdW5kIHVzaW5nIGEgc29tZSBsb3ctbGV2ZWwgQVBJLlxuICAgICAgICAgICAgICAgIGlmICghdmlld1Jvb3QuaGFzQXR0cmlidXRlKG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3dyaXRlci5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUsIHZpZXdSb290KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faW5pdGlhbERvbVJvb3RBdHRyaWJ1dGVzLnNldChkb21Sb290LCBpbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMpO1xuICAgICAgICBjb25zdCB1cGRhdGVDb250ZW50ZWRpdGFibGVBdHRyaWJ1dGUgPSAoKT0+e1xuICAgICAgICAgICAgdGhpcy5fd3JpdGVyLnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgKCF2aWV3Um9vdC5pc1JlYWRPbmx5KS50b1N0cmluZygpLCB2aWV3Um9vdCk7XG4gICAgICAgICAgICBpZiAodmlld1Jvb3QuaXNSZWFkT25seSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3dyaXRlci5hZGRDbGFzcygnY2stcmVhZC1vbmx5Jywgdmlld1Jvb3QpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl93cml0ZXIucmVtb3ZlQ2xhc3MoJ2NrLXJlYWQtb25seScsIHZpZXdSb290KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gU2V0IGluaXRpYWwgdmFsdWUuXG4gICAgICAgIHVwZGF0ZUNvbnRlbnRlZGl0YWJsZUF0dHJpYnV0ZSgpO1xuICAgICAgICB0aGlzLmRvbVJvb3RzLnNldChuYW1lLCBkb21Sb290KTtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuYmluZEVsZW1lbnRzKGRvbVJvb3QsIHZpZXdSb290KTtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIubWFya1RvU3luYygnY2hpbGRyZW4nLCB2aWV3Um9vdCk7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLm1hcmtUb1N5bmMoJ2F0dHJpYnV0ZXMnLCB2aWV3Um9vdCk7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLmRvbURvY3VtZW50cy5hZGQoZG9tUm9vdC5vd25lckRvY3VtZW50KTtcbiAgICAgICAgdmlld1Jvb3Qub24oJ2NoYW5nZTpjaGlsZHJlbicsIChldnQsIG5vZGUpPT50aGlzLl9yZW5kZXJlci5tYXJrVG9TeW5jKCdjaGlsZHJlbicsIG5vZGUpKTtcbiAgICAgICAgdmlld1Jvb3Qub24oJ2NoYW5nZTphdHRyaWJ1dGVzJywgKGV2dCwgbm9kZSk9PnRoaXMuX3JlbmRlcmVyLm1hcmtUb1N5bmMoJ2F0dHJpYnV0ZXMnLCBub2RlKSk7XG4gICAgICAgIHZpZXdSb290Lm9uKCdjaGFuZ2U6dGV4dCcsIChldnQsIG5vZGUpPT50aGlzLl9yZW5kZXJlci5tYXJrVG9TeW5jKCd0ZXh0Jywgbm9kZSkpO1xuICAgICAgICB2aWV3Um9vdC5vbignY2hhbmdlOmlzUmVhZE9ubHknLCAoKT0+dGhpcy5jaGFuZ2UodXBkYXRlQ29udGVudGVkaXRhYmxlQXR0cmlidXRlKSk7XG4gICAgICAgIHZpZXdSb290Lm9uKCdjaGFuZ2UnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5faGFzQ2hhbmdlZFNpbmNlVGhlTGFzdFJlbmRlcmluZyA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGNvbnN0IG9ic2VydmVyIG9mIHRoaXMuX29ic2VydmVycy52YWx1ZXMoKSl7XG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGRvbVJvb3QsIG5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXRhY2hlcyBhIERPTSByb290IGVsZW1lbnQgZnJvbSB0aGUgdmlldyBlbGVtZW50IGFuZCByZXN0b3JlcyBpdHMgYXR0cmlidXRlcyB0byB0aGUgc3RhdGUgYmVmb3JlXG5cdCAqIHtAbGluayAjYXR0YWNoRG9tUm9vdCBgYXR0YWNoRG9tUm9vdCgpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIHJvb3QgdG8gZGV0YWNoLlxuXHQgKi8gZGV0YWNoRG9tUm9vdChuYW1lKSB7XG4gICAgICAgIGNvbnN0IGRvbVJvb3QgPSB0aGlzLmRvbVJvb3RzLmdldChuYW1lKTtcbiAgICAgICAgLy8gUmVtb3ZlIGFsbCByb290IGF0dHJpYnV0ZXMgc28gdGhlIERPTSBlbGVtZW50IGlzIFwiYmFyZVwiLlxuICAgICAgICBBcnJheS5mcm9tKGRvbVJvb3QuYXR0cmlidXRlcykuZm9yRWFjaCgoeyBuYW1lIH0pPT5kb21Sb290LnJlbW92ZUF0dHJpYnV0ZShuYW1lKSk7XG4gICAgICAgIGNvbnN0IGluaXRpYWxEb21Sb290QXR0cmlidXRlcyA9IHRoaXMuX2luaXRpYWxEb21Sb290QXR0cmlidXRlcy5nZXQoZG9tUm9vdCk7XG4gICAgICAgIC8vIFJldmVydCBhbGwgdmlldyByb290IGF0dHJpYnV0ZXMgYmFjayB0byB0aGUgc3RhdGUgYmVmb3JlIGF0dGFjaERvbVJvb3Qgd2FzIGNhbGxlZC5cbiAgICAgICAgZm9yKGNvbnN0IGF0dHJpYnV0ZSBpbiBpbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgZG9tUm9vdC5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCBpbml0aWFsRG9tUm9vdEF0dHJpYnV0ZXNbYXR0cmlidXRlXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kb21Sb290cy5kZWxldGUobmFtZSk7XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyLnVuYmluZERvbUVsZW1lbnQoZG9tUm9vdCk7XG4gICAgICAgIGZvciAoY29uc3Qgb2JzZXJ2ZXIgb2YgdGhpcy5fb2JzZXJ2ZXJzLnZhbHVlcygpKXtcbiAgICAgICAgICAgIG9ic2VydmVyLnN0b3BPYnNlcnZpbmcoZG9tUm9vdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgRE9NIHJvb3QgZWxlbWVudC5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgIE5hbWUgb2YgdGhlIHJvb3QuXG5cdCAqIEByZXR1cm5zIERPTSByb290IGVsZW1lbnQgaW5zdGFuY2UuXG5cdCAqLyBnZXREb21Sb290KG5hbWUgPSAnbWFpbicpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9tUm9vdHMuZ2V0KG5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBvYnNlcnZlciBvZiB0aGUgZ2l2ZW4gdHlwZSBpZiBub3QgeWV0IGNyZWF0ZWQsIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXIjZW5hYmxlIGVuYWJsZXN9IGl0XG5cdCAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L29ic2VydmVyL29ic2VydmVyfk9ic2VydmVyI29ic2VydmUgYXR0YWNoZXN9IHRvIGFsbCBleGlzdGluZyBhbmQgZnV0dXJlXG5cdCAqIHtAbGluayAjZG9tUm9vdHMgRE9NIHJvb3RzfS5cblx0ICpcblx0ICogTm90ZTogT2JzZXJ2ZXJzIGFyZSByZWNvZ25pemVkIGJ5IHRoZWlyIGNvbnN0cnVjdG9yIChjbGFzc2VzKS4gQSBzaW5nbGUgb2JzZXJ2ZXIgd2lsbCBiZSBpbnN0YW50aWF0ZWQgYW5kIHVzZWQgb25seVxuXHQgKiB3aGVuIHJlZ2lzdGVyZWQgZm9yIHRoZSBmaXJzdCB0aW1lLiBUaGlzIG1lYW5zIHRoYXQgZmVhdHVyZXMgYW5kIG90aGVyIGNvbXBvbmVudHMgY2FuIHJlZ2lzdGVyIGEgc2luZ2xlIG9ic2VydmVyXG5cdCAqIG11bHRpcGxlIHRpbWVzIHdpdGhvdXQgY2FyaW5nIHdoZXRoZXIgaXQgaGFzIGJlZW4gYWxyZWFkeSBhZGRlZCBvciBub3QuXG5cdCAqXG5cdCAqIEBwYXJhbSBPYnNlcnZlckNvbnN0cnVjdG9yIFRoZSBjb25zdHJ1Y3RvciBvZiBhbiBvYnNlcnZlciB0byBhZGQuXG5cdCAqIFNob3VsZCBjcmVhdGUgYW4gaW5zdGFuY2UgaW5oZXJpdGluZyBmcm9tIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvb2JzZXJ2ZXIvb2JzZXJ2ZXJ+T2JzZXJ2ZXJ9LlxuXHQgKiBAcmV0dXJucyBBZGRlZCBvYnNlcnZlciBpbnN0YW5jZS5cblx0ICovIGFkZE9ic2VydmVyKE9ic2VydmVyQ29uc3RydWN0b3IpIHtcbiAgICAgICAgbGV0IG9ic2VydmVyID0gdGhpcy5fb2JzZXJ2ZXJzLmdldChPYnNlcnZlckNvbnN0cnVjdG9yKTtcbiAgICAgICAgaWYgKG9ic2VydmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgT2JzZXJ2ZXJDb25zdHJ1Y3Rvcih0aGlzKTtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnNldChPYnNlcnZlckNvbnN0cnVjdG9yLCBvYnNlcnZlcik7XG4gICAgICAgIGZvciAoY29uc3QgW25hbWUsIGRvbUVsZW1lbnRdIG9mIHRoaXMuZG9tUm9vdHMpe1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb21FbGVtZW50LCBuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBvYnNlcnZlci5lbmFibGUoKTtcbiAgICAgICAgcmV0dXJuIG9ic2VydmVyO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBvYnNlcnZlciBvZiB0aGUgZ2l2ZW4gdHlwZSBvciBgdW5kZWZpbmVkYCBpZiBzdWNoIG9ic2VydmVyIGhhcyBub3QgYmVlbiBhZGRlZCB5ZXQuXG5cdCAqXG5cdCAqIEBwYXJhbSBPYnNlcnZlckNvbnN0cnVjdG9yIFRoZSBjb25zdHJ1Y3RvciBvZiBhbiBvYnNlcnZlciB0byBnZXQuXG5cdCAqIEByZXR1cm5zIE9ic2VydmVyIGluc3RhbmNlIG9yIHVuZGVmaW5lZC5cblx0ICovIGdldE9ic2VydmVyKE9ic2VydmVyQ29uc3RydWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29ic2VydmVycy5nZXQoT2JzZXJ2ZXJDb25zdHJ1Y3Rvcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEaXNhYmxlcyBhbGwgYWRkZWQgb2JzZXJ2ZXJzLlxuXHQgKi8gZGlzYWJsZU9ic2VydmVycygpIHtcbiAgICAgICAgZm9yIChjb25zdCBvYnNlcnZlciBvZiB0aGlzLl9vYnNlcnZlcnMudmFsdWVzKCkpe1xuICAgICAgICAgICAgb2JzZXJ2ZXIuZGlzYWJsZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFbmFibGVzIGFsbCBhZGRlZCBvYnNlcnZlcnMuXG5cdCAqLyBlbmFibGVPYnNlcnZlcnMoKSB7XG4gICAgICAgIGZvciAoY29uc3Qgb2JzZXJ2ZXIgb2YgdGhpcy5fb2JzZXJ2ZXJzLnZhbHVlcygpKXtcbiAgICAgICAgICAgIG9ic2VydmVyLmVuYWJsZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTY3JvbGxzIHRoZSBwYWdlIHZpZXdwb3J0IGFuZCB7QGxpbmsgI2RvbVJvb3RzfSB3aXRoIHRoZWlyIGFuY2VzdG9ycyB0byByZXZlYWwgdGhlXG5cdCAqIGNhcmV0LCAqKmlmIG5vdCBhbHJlYWR5IHZpc2libGUgdG8gdGhlIHVzZXIqKi5cblx0ICpcblx0ICogKipOb3RlKio6IENhbGxpbmcgdGhpcyBtZXRob2QgZmlyZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3U2Nyb2xsVG9UaGVTZWxlY3Rpb25FdmVudH0gZXZlbnQgdGhhdFxuXHQgKiBhbGxvd3MgY3VzdG9tIGJlaGF2aW9ycy5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBjb25maWd1cmF0aW9uIG9mIHRoZSBzY3JvbGxpbmcgYmVoYXZpb3IuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnZpZXdwb3J0T2Zmc2V0IEEgZGlzdGFuY2UgYmV0d2VlbiB0aGUgRE9NIHNlbGVjdGlvbiBhbmQgdGhlIHZpZXdwb3J0IGJvdW5kYXJ5IHRvIGJlIG1haW50YWluZWRcblx0ICogd2hpbGUgc2Nyb2xsaW5nIHRvIHRoZSBzZWxlY3Rpb24gKGRlZmF1bHQgaXMgMjBweCkuIFNldHRpbmcgdGhpcyB2YWx1ZSB0byBgMGAgd2lsbCByZXZlYWwgdGhlIHNlbGVjdGlvbiBwcmVjaXNlbHkgYXRcblx0ICogdGhlIHZpZXdwb3J0IGJvdW5kYXJ5LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5hbmNlc3Rvck9mZnNldCBBIGRpc3RhbmNlIGJldHdlZW4gdGhlIERPTSBzZWxlY3Rpb24gYW5kIHNjcm9sbGFibGUgRE9NIHJvb3QgYW5jZXN0b3IocykgdG8gYmUgbWFpbnRhaW5lZFxuXHQgKiB3aGlsZSBzY3JvbGxpbmcgdG8gdGhlIHNlbGVjdGlvbiAoZGVmYXVsdCBpcyAyMHB4KS4gU2V0dGluZyB0aGlzIHZhbHVlIHRvIGAwYCB3aWxsIHJldmVhbCB0aGUgc2VsZWN0aW9uIHByZWNpc2VseSBhdFxuXHQgKiB0aGUgc2Nyb2xsYWJsZSBhbmNlc3RvcihzKSBib3VuZGFyeS5cblx0ICogQHBhcmFtIG9wdGlvbnMuYWxpZ25Ub1RvcCBXaGVuIHNldCBgdHJ1ZWAsIHRoZSBET00gc2VsZWN0aW9uIHdpbGwgYmUgYWxpZ25lZCB0byB0aGUgdG9wIG9mIHRoZSB2aWV3cG9ydCBpZiBub3QgYWxyZWFkeSB2aXNpYmxlXG5cdCAqIChzZWUgYGZvcmNlU2Nyb2xsYCB0byBsZWFybiBtb3JlKS5cblx0ICogQHBhcmFtIG9wdGlvbnMuZm9yY2VTY3JvbGwgV2hlbiBzZXQgYHRydWVgLCB0aGUgRE9NIHNlbGVjdGlvbiB3aWxsIGJlIGFsaWduZWQgdG8gdGhlIHRvcCBvZiB0aGUgdmlld3BvcnQgYW5kIHNjcm9sbGFibGUgYW5jZXN0b3JzXG5cdCAqIHdoZXRoZXIgaXQgaXMgYWxyZWFkeSB2aXNpYmxlIG9yIG5vdC4gVGhpcyBvcHRpb24gd2lsbCBvbmx5IHdvcmsgd2hlbiBgYWxpZ25Ub1RvcGAgaXMgYHRydWVgLlxuXHQgKi8gc2Nyb2xsVG9UaGVTZWxlY3Rpb24oeyBhbGlnblRvVG9wLCBmb3JjZVNjcm9sbCwgdmlld3BvcnRPZmZzZXQgPSAyMCwgYW5jZXN0b3JPZmZzZXQgPSAyMCB9ID0ge30pIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7XG4gICAgICAgIGlmICghcmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDbG9uZSB0byBtYWtlIHN1cmUgcHJvcGVydGllcyBsaWtlIGB2aWV3cG9ydE9mZnNldGAgYXJlIG5vdCBtdXRhdGVkIGluIHRoZSBldmVudCBsaXN0ZW5lcnMuXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQXJncyA9IGNsb25lRGVlcCh7XG4gICAgICAgICAgICBhbGlnblRvVG9wLFxuICAgICAgICAgICAgZm9yY2VTY3JvbGwsXG4gICAgICAgICAgICB2aWV3cG9ydE9mZnNldCxcbiAgICAgICAgICAgIGFuY2VzdG9yT2Zmc2V0XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodHlwZW9mIHZpZXdwb3J0T2Zmc2V0ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgdmlld3BvcnRPZmZzZXQgPSB7XG4gICAgICAgICAgICAgICAgdG9wOiB2aWV3cG9ydE9mZnNldCxcbiAgICAgICAgICAgICAgICBib3R0b206IHZpZXdwb3J0T2Zmc2V0LFxuICAgICAgICAgICAgICAgIGxlZnQ6IHZpZXdwb3J0T2Zmc2V0LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiB2aWV3cG9ydE9mZnNldFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgdGFyZ2V0OiB0aGlzLmRvbUNvbnZlcnRlci52aWV3UmFuZ2VUb0RvbShyYW5nZSksXG4gICAgICAgICAgICB2aWV3cG9ydE9mZnNldCxcbiAgICAgICAgICAgIGFuY2VzdG9yT2Zmc2V0LFxuICAgICAgICAgICAgYWxpZ25Ub1RvcCxcbiAgICAgICAgICAgIGZvcmNlU2Nyb2xsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlyZSgnc2Nyb2xsVG9UaGVTZWxlY3Rpb24nLCBvcHRpb25zLCBvcmlnaW5hbEFyZ3MpO1xuICAgICAgICBzY3JvbGxWaWV3cG9ydFRvU2hvd1RhcmdldChvcHRpb25zKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEl0IHdpbGwgZm9jdXMgRE9NIGVsZW1lbnQgcmVwcmVzZW50aW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWRpdGFibGVlbGVtZW50fkVkaXRhYmxlRWxlbWVudCBFZGl0YWJsZUVsZW1lbnR9XG5cdCAqIHRoYXQgaXMgY3VycmVudGx5IGhhdmluZyBzZWxlY3Rpb24gaW5zaWRlLlxuXHQgKi8gZm9jdXMoKSB7XG4gICAgICAgIGlmICghdGhpcy5kb2N1bWVudC5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVkaXRhYmxlID0gdGhpcy5kb2N1bWVudC5zZWxlY3Rpb24uZWRpdGFibGVFbGVtZW50O1xuICAgICAgICAgICAgaWYgKGVkaXRhYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuZm9jdXMoZWRpdGFibGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9yY2VSZW5kZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogVGhlIGBjaGFuZ2UoKWAgbWV0aG9kIGlzIHRoZSBwcmltYXJ5IHdheSBvZiBjaGFuZ2luZyB0aGUgdmlldy4gWW91IHNob3VsZCB1c2UgaXQgdG8gbW9kaWZ5IGFueSBub2RlIGluIHRoZSB2aWV3IHRyZWUuXG5cdCAqIEl0IG1ha2VzIHN1cmUgdGhhdCBhZnRlciBhbGwgY2hhbmdlcyBhcmUgbWFkZSB0aGUgdmlldyBpcyByZW5kZXJlZCB0byB0aGUgRE9NIChhc3N1bWluZyB0aGF0IHRoZSB2aWV3IHdpbGwgYmUgY2hhbmdlZFxuXHQgKiBpbnNpZGUgdGhlIGNhbGxiYWNrKS4gSXQgcHJldmVudHMgc2l0dWF0aW9ucyB3aGVuIHRoZSBET00gaXMgdXBkYXRlZCB3aGVuIHRoZSB2aWV3IHN0YXRlIGlzIG5vdCB5ZXQgY29ycmVjdC4gSXQgYWxsb3dzXG5cdCAqIHRvIG5lc3QgY2FsbHMgb25lIGluc2lkZSBhbm90aGVyIGFuZCBzdGlsbCBwZXJmb3JtcyBhIHNpbmdsZSByZW5kZXJpbmcgYWZ0ZXIgYWxsIHRob3NlIGNoYW5nZXMgYXJlIG1hZGUuXG5cdCAqIEl0IGFsc28gcmV0dXJucyB0aGUgcmV0dXJuIHZhbHVlIG9mIGl0cyBjYWxsYmFjay5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdGV4dCA9IHZpZXcuY2hhbmdlKCB3cml0ZXIgPT4ge1xuXHQgKiBcdGNvbnN0IG5ld1RleHQgPSB3cml0ZXIuY3JlYXRlVGV4dCggJ2ZvbycgKTtcblx0ICogXHR3cml0ZXIuaW5zZXJ0KCBwb3NpdGlvbjEsIG5ld1RleHQgKTtcblx0ICpcblx0ICogXHR2aWV3LmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHRcdHdyaXRlci5pbnNlcnQoIHBvc2l0aW9uMiwgd3JpdGVyLmNyZWF0ZVRleHQoICdiYXInICkgKTtcblx0ICogXHR9ICk7XG5cdCAqXG5cdCAqIFx0d3JpdGVyLnJlbW92ZSggcmFuZ2UgKTtcblx0ICpcblx0ICogXHRyZXR1cm4gbmV3VGV4dDtcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogV2hlbiB0aGUgb3V0ZXJtb3N0IGNoYW5nZSBibG9jayBpcyBkb25lIGFuZCByZW5kZXJpbmcgdG8gdGhlIERPTSBpcyBvdmVyIHRoZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNldmVudDpyZW5kZXIgYFZpZXcjcmVuZGVyYH0gZXZlbnQgaXMgZmlyZWQuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIHRocm93cyBhIGBhcHBseWluZy12aWV3LWNoYW5nZXMtb24tcmVuZGVyaW5nYCBlcnJvciB3aGVuXG5cdCAqIHRoZSBjaGFuZ2UgYmxvY2sgaXMgdXNlZCBhZnRlciByZW5kZXJpbmcgdG8gdGhlIERPTSBoYXMgc3RhcnRlZC5cblx0ICpcblx0ICogQHBhcmFtIGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIG1heSBtb2RpZnkgdGhlIHZpZXcuXG5cdCAqIEByZXR1cm5zIFZhbHVlIHJldHVybmVkIGJ5IHRoZSBjYWxsYmFjay5cblx0ICovIGNoYW5nZShjYWxsYmFjaykge1xuICAgICAgICBpZiAodGhpcy5pc1JlbmRlcmluZ0luUHJvZ3Jlc3MgfHwgdGhpcy5fcG9zdEZpeGVyc0luUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhyb3duIHdoZW4gdGhlcmUgaXMgYW4gYXR0ZW1wdCB0byBtYWtlIGNoYW5nZXMgdG8gdGhlIHZpZXcgdHJlZSB3aGVuIGl0IGlzIGluIGluY29ycmVjdCBzdGF0ZS4gVGhpcyBtYXlcblx0XHRcdCAqIGNhdXNlIHNvbWUgdW5leHBlY3RlZCBiZWhhdmlvdXIgYW5kIGluY29uc2lzdGVuY3kgYmV0d2VlbiB0aGUgRE9NIGFuZCB0aGUgdmlldy5cblx0XHRcdCAqIFRoaXMgbWF5IGJlIGNhdXNlZCBieTpcblx0XHRcdCAqXG5cdFx0XHQgKiAqIGNhbGxpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjY2hhbmdlfSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNmb3JjZVJlbmRlcn0gZHVyaW5nIHJlbmRlcmluZ1xuXHRcdFx0ICogcHJvY2Vzcyxcblx0XHRcdCAqICogY2FsbGluZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNjaGFuZ2V9IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2ZvcmNlUmVuZGVyfSBpbnNpZGUgb2Zcblx0XHRcdCAqICAge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNyZWdpc3RlclBvc3RGaXhlciBwb3N0LWZpeGVyIGZ1bmN0aW9ufS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgY2Fubm90LWNoYW5nZS12aWV3LXRyZWVcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY2Fubm90LWNoYW5nZS12aWV3LXRyZWUnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gUmVjdXJzaXZlIGNhbGwgdG8gdmlldy5jaGFuZ2UoKSBtZXRob2QgLSBleGVjdXRlIGxpc3RlbmVyIGltbWVkaWF0ZWx5LlxuICAgICAgICAgICAgaWYgKHRoaXMuX29uZ29pbmdDaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodGhpcy5fd3JpdGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoaXMgbG9jayB3aWxsIGFzc3VyZSB0aGF0IGFsbCByZWN1cnNpdmUgY2FsbHMgdG8gdmlldy5jaGFuZ2UoKSB3aWxsIGVuZCB1cCBpbiBzYW1lIGJsb2NrIC0gb25lIFwicmVuZGVyXCJcbiAgICAgICAgICAgIC8vIGV2ZW50IGZvciBhbGwgbmVzdGVkIGNhbGxzLlxuICAgICAgICAgICAgdGhpcy5fb25nb2luZ0NoYW5nZSA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCBjYWxsYmFja1Jlc3VsdCA9IGNhbGxiYWNrKHRoaXMuX3dyaXRlcik7XG4gICAgICAgICAgICB0aGlzLl9vbmdvaW5nQ2hhbmdlID0gZmFsc2U7XG4gICAgICAgICAgICAvLyBUaGlzIGxvY2sgaXMgdXNlZCBieSBlZGl0aW5nIGNvbnRyb2xsZXIgdG8gcmVuZGVyIGNoYW5nZXMgZnJvbSBvdXRlciBtb3N0IG1vZGVsLmNoYW5nZSgpIG9uY2UuIEFzIHBsdWdpbnMgbWlnaHQgY2FsbFxuICAgICAgICAgICAgLy8gdmlldy5jaGFuZ2UoKSBpbnNpZGUgbW9kZWwuY2hhbmdlKCkgYmxvY2sgLSB0aGlzIHdpbGwgZW5zdXJlcyB0aGF0IHBvc3RmaXhlcnMgYW5kIHJlbmRlcmluZyBhcmUgY2FsbGVkIG9uY2UgYWZ0ZXIgYWxsXG4gICAgICAgICAgICAvLyBjaGFuZ2VzLiBBbHNvLCB3ZSBkb24ndCBuZWVkIHRvIHJlbmRlciBhbnl0aGluZyBpZiB0aGVyZSdyZSBubyBjaGFuZ2VzIHNpbmNlIGxhc3QgcmVuZGVyaW5nLlxuICAgICAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJpbmdEaXNhYmxlZCAmJiB0aGlzLl9oYXNDaGFuZ2VkU2luY2VUaGVMYXN0UmVuZGVyaW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9zdEZpeGVyc0luUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQuX2NhbGxQb3N0Rml4ZXJzKHRoaXMuX3dyaXRlcik7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9zdEZpeGVyc0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3JlbmRlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrUmVzdWx0O1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyB0aHJvdyBlcnI7XG4gICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAtLSBAcHJlc2VydmUgKi8gQ0tFZGl0b3JFcnJvci5yZXRocm93VW5leHBlY3RlZEVycm9yKGVyciwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEZvcmNlcyByZW5kZXJpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCB2aWV3IGRvY3VtZW50fSB0byBET00uIElmIGFueSB2aWV3IGNoYW5nZXMgYXJlXG5cdCAqIGN1cnJlbnRseSBpbiBwcm9ncmVzcywgcmVuZGVyaW5nIHdpbGwgc3RhcnQgYWZ0ZXIgYWxsIHtAbGluayAjY2hhbmdlIGNoYW5nZSBibG9ja3N9IGFyZSBwcm9jZXNzZWQuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGlzIG1ldGhvZCBpcyBkZWRpY2F0ZWQgZm9yIHNwZWNpYWwgY2FzZXMuIEFsbCB2aWV3IGNoYW5nZXMgc2hvdWxkIGJlIHdyYXBwZWQgaW4gdGhlIHtAbGluayAjY2hhbmdlfVxuXHQgKiBibG9jayBhbmQgdGhlIHZpZXcgd2lsbCBhdXRvbWF0aWNhbGx5IGNoZWNrIHdoZXRoZXIgaXQgbmVlZHMgdG8gcmVuZGVyIERPTSBvciBub3QuXG5cdCAqXG5cdCAqIFRocm93cyB7QGxpbmsgbW9kdWxlOnV0aWxzL2NrZWRpdG9yZXJyb3J+Q0tFZGl0b3JFcnJvciBDS0VkaXRvckVycm9yfSBgYXBwbHlpbmctdmlldy1jaGFuZ2VzLW9uLXJlbmRlcmluZ2Agd2hlblxuXHQgKiB0cnlpbmcgdG8gcmUtcmVuZGVyIHdoZW4gcmVuZGVyaW5nIHRvIERPTSBoYXMgYWxyZWFkeSBzdGFydGVkLlxuXHQgKi8gZm9yY2VSZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuX2hhc0NoYW5nZWRTaW5jZVRoZUxhc3RSZW5kZXJpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmdldE9ic2VydmVyKEZvY3VzT2JzZXJ2ZXIpLmZsdXNoKCk7XG4gICAgICAgIHRoaXMuY2hhbmdlKCgpPT57fSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXN0cm95cyB0aGlzIGluc3RhbmNlLiBNYWtlcyBzdXJlIHRoYXQgYWxsIG9ic2VydmVycyBhcmUgZGVzdHJveWVkIGFuZCBsaXN0ZW5lcnMgcmVtb3ZlZC5cblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIGZvciAoY29uc3Qgb2JzZXJ2ZXIgb2YgdGhpcy5fb2JzZXJ2ZXJzLnZhbHVlcygpKXtcbiAgICAgICAgICAgIG9ic2VydmVyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvY3VtZW50LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIHBvc2l0aW9uIGF0IHRoZSBnaXZlbiBsb2NhdGlvbi4gVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgYXM6XG5cdCAqXG5cdCAqICogYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSxcblx0ICogKiBwYXJlbnQgZWxlbWVudCBhbmQgb2Zmc2V0IChvZmZzZXQgZGVmYXVsdHMgdG8gYDBgKSxcblx0ICogKiBwYXJlbnQgZWxlbWVudCBhbmQgYCdlbmQnYCAoc2V0cyBwb3NpdGlvbiBhdCB0aGUgZW5kIG9mIHRoYXQgZWxlbWVudCksXG5cdCAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgYCdiZWZvcmUnYCBvciBgJ2FmdGVyJ2AgKHNldHMgcG9zaXRpb24gYmVmb3JlIG9yIGFmdGVyIGdpdmVuIHZpZXcgaXRlbSkuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIGEgc2hvcnRjdXQgdG8gb3RoZXIgY29uc3RydWN0b3JzIHN1Y2ggYXM6XG5cdCAqXG5cdCAqICoge0BsaW5rICNjcmVhdGVQb3NpdGlvbkJlZm9yZX0sXG5cdCAqICoge0BsaW5rICNjcmVhdGVQb3NpdGlvbkFmdGVyfSxcblx0ICpcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfS5cblx0ICovIGNyZWF0ZVBvc2l0aW9uQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkge1xuICAgICAgICByZXR1cm4gUG9zaXRpb24kMS5fY3JlYXRlQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHBvc2l0aW9uIGFmdGVyIGdpdmVuIHZpZXcgaXRlbS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gVmlldyBpdGVtIGFmdGVyIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgbG9jYXRlZC5cblx0ICovIGNyZWF0ZVBvc2l0aW9uQWZ0ZXIoaXRlbSkge1xuICAgICAgICByZXR1cm4gUG9zaXRpb24kMS5fY3JlYXRlQWZ0ZXIoaXRlbSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHBvc2l0aW9uIGJlZm9yZSBnaXZlbiB2aWV3IGl0ZW0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIFZpZXcgaXRlbSBiZWZvcmUgd2hpY2ggdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBsb2NhdGVkLlxuXHQgKi8gY3JlYXRlUG9zaXRpb25CZWZvcmUoaXRlbSkge1xuICAgICAgICByZXR1cm4gUG9zaXRpb24kMS5fY3JlYXRlQmVmb3JlKGl0ZW0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHNwYW5uaW5nIGZyb20gYHN0YXJ0YCBwb3NpdGlvbiB0byBgZW5kYCBwb3NpdGlvbi5cblx0ICpcblx0ICogKipOb3RlOioqIFRoaXMgZmFjdG9yeSBtZXRob2QgY3JlYXRlcyBpdCdzIG93biB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9ufSBpbnN0YW5jZXMgYmFzaW5nIG9uIHBhc3NlZCB2YWx1ZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBzdGFydCBTdGFydCBwb3NpdGlvbi5cblx0ICogQHBhcmFtIGVuZCBFbmQgcG9zaXRpb24uIElmIG5vdCBzZXQsIHJhbmdlIHdpbGwgYmUgY29sbGFwc2VkIGF0IGBzdGFydGAgcG9zaXRpb24uXG5cdCAqLyBjcmVhdGVSYW5nZShzdGFydCwgZW5kKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSB0aGF0IHN0YXJ0cyBiZWZvcmUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9pdGVtfkl0ZW0gdmlldyBpdGVtfSBhbmQgZW5kcyBhZnRlciBpdC5cblx0ICovIGNyZWF0ZVJhbmdlT24oaXRlbSkge1xuICAgICAgICByZXR1cm4gUmFuZ2UkMS5fY3JlYXRlT24oaXRlbSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGZpcnN0IGNoaWxkIG9mXG5cdCAqIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgd2hpY2ggaXMgYSBwYXJlbnQgZm9yIHRoZSByYW5nZS5cblx0ICovIGNyZWF0ZVJhbmdlSW4oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gUmFuZ2UkMS5fY3JlYXRlSW4oZWxlbWVudCk7XG4gICAgfVxuICAgIGNyZWF0ZVNlbGVjdGlvbiguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBuZXcgU2VsZWN0aW9uJDEoLi4uYXJncyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEaXNhYmxlcyBvciBlbmFibGVzIHJlbmRlcmluZy4gSWYgdGhlIGZsYWcgaXMgc2V0IHRvIGB0cnVlYCB0aGVuIHRoZSByZW5kZXJpbmcgd2lsbCBiZSBkaXNhYmxlZC5cblx0ICogSWYgdGhlIGZsYWcgaXMgc2V0IHRvIGBmYWxzZWAgYW5kIGlmIHRoZXJlIHdhcyBzb21lIGNoYW5nZSBpbiB0aGUgbWVhbnRpbWUsIHRoZW4gdGhlIHJlbmRlcmluZyBhY3Rpb24gd2lsbCBiZSBwZXJmb3JtZWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZmxhZyBBIGZsYWcgaW5kaWNhdGVzIHdoZXRoZXIgdGhlIHJlbmRlcmluZyBzaG91bGQgYmUgZGlzYWJsZWQuXG5cdCAqLyBfZGlzYWJsZVJlbmRlcmluZyhmbGFnKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlcmluZ0Rpc2FibGVkID0gZmxhZztcbiAgICAgICAgaWYgKGZsYWcgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIC8vIFJlbmRlciB3aGVuIHlvdSBzdG9wIGJsb2NraW5nIHJlbmRlcmluZy5cbiAgICAgICAgICAgIHRoaXMuY2hhbmdlKCgpPT57fSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbmRlcnMgYWxsIGNoYW5nZXMuIEluIG9yZGVyIHRvIGF2b2lkIHRyaWdnZXJpbmcgdGhlIG9ic2VydmVycyAoZS5nLiBzZWxlY3Rpb24pIGFsbCBvYnNlcnZlcnMgYXJlIGRpc2FibGVkXG5cdCAqIGJlZm9yZSByZW5kZXJpbmcgYW5kIHJlLWVuYWJsZWQgYWZ0ZXIgdGhhdC5cblx0ICovIF9yZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuaXNSZW5kZXJpbmdJblByb2dyZXNzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5kaXNhYmxlT2JzZXJ2ZXJzKCk7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbmRlcigpO1xuICAgICAgICB0aGlzLmVuYWJsZU9ic2VydmVycygpO1xuICAgICAgICB0aGlzLmlzUmVuZGVyaW5nSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSBlbmdpbmUvbW9kZWwvdHlwZWNoZWNrYWJsZVxuICovIGNsYXNzIFR5cGVDaGVja2FibGUge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyBpcygpIHtcbiAgICAgICAgLy8gVGhlcmUgYXJlIGEgbG90IG9mIG92ZXJsb2FkcyBhYm92ZS5cbiAgICAgICAgLy8gT3ZlcnJpZGluZyBtZXRob2QgaW4gZGVyaXZlZCBjbGFzc2VzIHJlbW92ZSB0aGVtIGFuZCBvbmx5IGBpcyggdHlwZTogc3RyaW5nICk6IGJvb2xlYW5gIGlzIHZpc2libGUgd2hpY2ggd2UgZG9uJ3Qgd2FudC5cbiAgICAgICAgLy8gT25lIG9wdGlvbiB3b3VsZCBiZSB0byBjb3B5IHRoZW0gYWxsIHRvIGFsbCBjbGFzc2VzLCBidXQgdGhhdCdzIHVnbHkuXG4gICAgICAgIC8vIEl0J3MgYmVzdCB3aGVuIFR5cGVTY3JpcHQgY29tcGlsZXIgZG9lc24ndCBzZWUgdGhvc2Ugb3ZlcmxvYWRzLCBleGNlcHQgdGhlIG9uZSBpbiB0aGUgdG9wIGJhc2UgY2xhc3MuXG4gICAgICAgIC8vIFRvIG92ZXJsb2FkIGEgbWV0aG9kLCBidXQgbm90IGxldCB0aGUgY29tcGlsZXIgc2VlIGl0LCBkbyBhZnRlciBjbGFzcyBkZWZpbml0aW9uOlxuICAgICAgICAvLyBgTXlDbGFzcy5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbiggdHlwZTogc3RyaW5nICkgey4uLn1gXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignaXMoKSBtZXRob2QgaXMgYWJzdHJhY3QnKTtcbiAgICB9XG59XG5cbi8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gY29uc3QgeyBjb252ZXJ0TWFwVG9TdHJpbmdpZmllZE9iamVjdCB9ID0gcmVxdWlyZSggJy4uL2Rldi11dGlscy91dGlscycgKTtcbi8qKlxuICogYFRleHRQcm94eWAgcmVwcmVzZW50cyBhIHBhcnQgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0IHRleHQgbm9kZX0uXG4gKlxuICogU2luY2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb25zfSBjYW4gYmUgcGxhY2VkIGJldHdlZW4gY2hhcmFjdGVycyBvZiBhIHRleHQgbm9kZSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlc30gbWF5IGNvbnRhaW4gb25seSBwYXJ0cyBvZiB0ZXh0IG5vZGVzLiBXaGVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlI2dldEl0ZW1zXG4gKiBnZXR0aW5nIGl0ZW1zfVxuICogY29udGFpbmVkIGluIHN1Y2ggcmFuZ2UsIHdlIG5lZWQgdG8gcmVwcmVzZW50IGEgcGFydCBvZiB0aGF0IHRleHQgbm9kZSwgc2luY2UgcmV0dXJuaW5nIHRoZSB3aG9sZSB0ZXh0IG5vZGUgd291bGQgYmUgaW5jb3JyZWN0LlxuICogYFRleHRQcm94eWAgc29sdmVzIHRoaXMgaXNzdWUuXG4gKlxuICogYFRleHRQcm94eWAgaGFzIGFuIEFQSSBzaW1pbGFyIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCBUZXh0fSBhbmQgYWxsb3dzIHRvIGRvIG1vc3Qgb2YgdGhlIGNvbW1vbiB0YXNrcyBwZXJmb3JtZWRcbiAqIG9uIG1vZGVsIG5vZGVzLlxuICpcbiAqICoqTm90ZToqKiBTb21lIGBUZXh0UHJveHlgIGluc3RhbmNlcyBtYXkgcmVwcmVzZW50IHdob2xlIHRleHQgbm9kZSwgbm90IGp1c3QgYSBwYXJ0IG9mIGl0LlxuICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHRwcm94eX5UZXh0UHJveHkjaXNQYXJ0aWFsfS5cbiAqXG4gKiAqKk5vdGU6KiogYFRleHRQcm94eWAgaXMgbm90IGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSBub2RlfS4gS2VlcCB0aGlzIGluIG1pbmQgd2hlbiB1c2luZyBpdCBhcyBhXG4gKiBwYXJhbWV0ZXIgb2YgbWV0aG9kcy5cbiAqXG4gKiAqKk5vdGU6KiogYFRleHRQcm94eWAgaXMgYSByZWFkb25seSBpbnRlcmZhY2UuIElmIHlvdSB3YW50IHRvIHBlcmZvcm0gY2hhbmdlcyBvbiBtb2RlbCBkYXRhIHJlcHJlc2VudGVkIGJ5IGEgYFRleHRQcm94eWBcbiAqIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyIG1vZGVsIHdyaXRlciBBUEl9LlxuICpcbiAqICoqTm90ZToqKiBgVGV4dFByb3h5YCBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgb24gdGhlIGZseSwgYmFzaW5nIG9uIHRoZSBjdXJyZW50IHN0YXRlIG9mIG1vZGVsLiBCZWNhdXNlIG9mIHRoaXMsIGl0IGlzXG4gKiBoaWdobHkgdW5yZWNvbW1lbmRlZCB0byBzdG9yZSByZWZlcmVuY2VzIHRvIGBUZXh0UHJveHlgIGluc3RhbmNlcy4gYFRleHRQcm94eWAgaW5zdGFuY2VzIGFyZSBub3QgcmVmcmVzaGVkIHdoZW5cbiAqIG1vZGVsIGNoYW5nZXMsIHNvIHRoZXkgbWlnaHQgZ2V0IGludmFsaWRhdGVkLiBJbnN0ZWFkLCBjb25zaWRlciBjcmVhdGluZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcG9zaXRpb25+TGl2ZVBvc2l0aW9uIGxpdmVcbiAqIHBvc2l0aW9ufS5cbiAqXG4gKiBgVGV4dFByb3h5YCBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyIG1vZGVsIHRyZWUgd2Fsa2VyfS4gWW91IHNob3VsZCBub3QgbmVlZCB0byBjcmVhdGVcbiAqIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgYnkgeW91ciBvd24uXG4gKi8gY2xhc3MgVGV4dFByb3h5IGV4dGVuZHMgVHlwZUNoZWNrYWJsZSB7XG4gICAgLyoqXG5cdCAqIFRleHQgbm9kZSB3aGljaCBwYXJ0IGlzIHJlcHJlc2VudGVkIGJ5IHRoaXMgdGV4dCBwcm94eS5cblx0ICovIHRleHROb2RlO1xuICAgIC8qKlxuXHQgKiBUZXh0IGRhdGEgcmVwcmVzZW50ZWQgYnkgdGhpcyB0ZXh0IHByb3h5LlxuXHQgKi8gZGF0YTtcbiAgICAvKipcblx0ICogT2Zmc2V0IGluIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHRwcm94eX5UZXh0UHJveHkjdGV4dE5vZGUgdGV4dCBub2RlfSBmcm9tIHdoaWNoIHRoZSB0ZXh0IHByb3h5IHN0YXJ0cy5cblx0ICovIG9mZnNldEluVGV4dDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHRleHQgcHJveHkuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gdGV4dE5vZGUgVGV4dCBub2RlIHdoaWNoIHBhcnQgaXMgcmVwcmVzZW50ZWQgYnkgdGhpcyB0ZXh0IHByb3h5LlxuXHQgKiBAcGFyYW0gb2Zmc2V0SW5UZXh0IE9mZnNldCBpbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0cHJveHl+VGV4dFByb3h5I3RleHROb2RlIHRleHQgbm9kZX0gZnJvbSB3aGljaCB0aGUgdGV4dCBwcm94eVxuXHQgKiBzdGFydHMuXG5cdCAqIEBwYXJhbSBsZW5ndGggVGV4dCBwcm94eSBsZW5ndGgsIHRoYXQgaXMgaG93IG1hbnkgdGV4dCBub2RlJ3MgY2hhcmFjdGVycywgc3RhcnRpbmcgZnJvbSBgb2Zmc2V0SW5UZXh0YCBpdCByZXByZXNlbnRzLlxuXHQgKi8gY29uc3RydWN0b3IodGV4dE5vZGUsIG9mZnNldEluVGV4dCwgbGVuZ3RoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy50ZXh0Tm9kZSA9IHRleHROb2RlO1xuICAgICAgICBpZiAob2Zmc2V0SW5UZXh0IDwgMCB8fCBvZmZzZXRJblRleHQgPiB0ZXh0Tm9kZS5vZmZzZXRTaXplKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEdpdmVuIGBvZmZzZXRJblRleHRgIHZhbHVlIGlzIGluY29ycmVjdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtdGV4dHByb3h5LXdyb25nLW9mZnNldGludGV4dFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC10ZXh0cHJveHktd3Jvbmctb2Zmc2V0aW50ZXh0JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlbmd0aCA8IDAgfHwgb2Zmc2V0SW5UZXh0ICsgbGVuZ3RoID4gdGV4dE5vZGUub2Zmc2V0U2l6ZSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHaXZlbiBgbGVuZ3RoYCB2YWx1ZSBpcyBpbmNvcnJlY3QuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1vZGVsLXRleHRwcm94eS13cm9uZy1sZW5ndGhcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtdGV4dHByb3h5LXdyb25nLWxlbmd0aCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGF0YSA9IHRleHROb2RlLmRhdGEuc3Vic3RyaW5nKG9mZnNldEluVGV4dCwgb2Zmc2V0SW5UZXh0ICsgbGVuZ3RoKTtcbiAgICAgICAgdGhpcy5vZmZzZXRJblRleHQgPSBvZmZzZXRJblRleHQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPZmZzZXQgYXQgd2hpY2ggdGhpcyB0ZXh0IHByb3h5IHN0YXJ0cyBpbiBpdCdzIHBhcmVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSNzdGFydE9mZnNldFxuXHQgKi8gZ2V0IHN0YXJ0T2Zmc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0Tm9kZS5zdGFydE9mZnNldCAhPT0gbnVsbCA/IHRoaXMudGV4dE5vZGUuc3RhcnRPZmZzZXQgKyB0aGlzLm9mZnNldEluVGV4dCA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPZmZzZXQgc2l6ZSBvZiB0aGlzIHRleHQgcHJveHkuIEVxdWFsIHRvIHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycyByZXByZXNlbnRlZCBieSB0aGUgdGV4dCBwcm94eS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSNvZmZzZXRTaXplXG5cdCAqLyBnZXQgb2Zmc2V0U2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPZmZzZXQgYXQgd2hpY2ggdGhpcyB0ZXh0IHByb3h5IGVuZHMgaW4gaXQncyBwYXJlbnQuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjZW5kT2Zmc2V0XG5cdCAqLyBnZXQgZW5kT2Zmc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydE9mZnNldCAhPT0gbnVsbCA/IHRoaXMuc3RhcnRPZmZzZXQgKyB0aGlzLm9mZnNldFNpemUgOiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgYFRleHRQcm94eWAgaW5zdGFuY2UgY292ZXJzIG9ubHkgcGFydCBvZiB0aGUgb3JpZ2luYWwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0IHRleHQgbm9kZX1cblx0ICogKGB0cnVlYCkgb3IgdGhlIHdob2xlIHRleHQgbm9kZSAoYGZhbHNlYCkuXG5cdCAqXG5cdCAqIFRoaXMgaXMgYGZhbHNlYCB3aGVuIHRleHQgcHJveHkgc3RhcnRzIGF0IHRoZSB2ZXJ5IGJlZ2lubmluZyBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0cHJveHl+VGV4dFByb3h5I3RleHROb2RlIHRleHROb2RlfVxuXHQgKiAoe0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eSNvZmZzZXRJblRleHQgb2Zmc2V0SW5UZXh0fSBlcXVhbHMgYDBgKSBhbmQgdGV4dCBwcm94eSBzaXplcyBpcyBlcXVhbCB0b1xuXHQgKiB0ZXh0IG5vZGUgc2l6ZS5cblx0ICovIGdldCBpc1BhcnRpYWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9mZnNldFNpemUgIT09IHRoaXMudGV4dE5vZGUub2Zmc2V0U2l6ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBhcmVudCBvZiB0aGlzIHRleHQgcHJveHksIHdoaWNoIGlzIHNhbWUgYXMgcGFyZW50IG9mIHRleHQgbm9kZSByZXByZXNlbnRlZCBieSB0aGlzIHRleHQgcHJveHkuXG5cdCAqLyBnZXQgcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0Tm9kZS5wYXJlbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSb290IG9mIHRoaXMgdGV4dCBwcm94eSwgd2hpY2ggaXMgc2FtZSBhcyByb290IG9mIHRleHQgbm9kZSByZXByZXNlbnRlZCBieSB0aGlzIHRleHQgcHJveHkuXG5cdCAqLyBnZXQgcm9vdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGV4dE5vZGUucm9vdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgcGF0aCB0byB0aGlzIHRleHQgcHJveHkuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjZ2V0UGF0aFxuXHQgKi8gZ2V0UGF0aCgpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMudGV4dE5vZGUuZ2V0UGF0aCgpO1xuICAgICAgICBpZiAocGF0aC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBwYXRoW3BhdGgubGVuZ3RoIC0gMV0gKz0gdGhpcy5vZmZzZXRJblRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuY2VzdG9ycyBhcnJheSBvZiB0aGlzIHRleHQgcHJveHkuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5pbmNsdWRlU2VsZiBXaGVuIHNldCB0byBgdHJ1ZWAgdGhpcyB0ZXh0IHByb3h5IHdpbGwgYmUgYWxzbyBpbmNsdWRlZCBpbiBwYXJlbnQncyBhcnJheS5cblx0ICogQHBhcmFtIG9wdGlvbnMucGFyZW50Rmlyc3QgV2hlbiBzZXQgdG8gYHRydWVgLCBhcnJheSB3aWxsIGJlIHNvcnRlZCBmcm9tIHRleHQgcHJveHkgcGFyZW50IHRvIHJvb3QgZWxlbWVudCxcblx0ICogb3RoZXJ3aXNlIHJvb3QgZWxlbWVudCB3aWxsIGJlIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBhcnJheS5cblx0ICogQHJldHVybnMgQXJyYXkgd2l0aCBhbmNlc3RvcnMuXG5cdCAqLyBnZXRBbmNlc3RvcnMob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9ycyA9IFtdO1xuICAgICAgICBsZXQgcGFyZW50ID0gb3B0aW9ucy5pbmNsdWRlU2VsZiA/IHRoaXMgOiB0aGlzLnBhcmVudDtcbiAgICAgICAgd2hpbGUocGFyZW50KXtcbiAgICAgICAgICAgIGFuY2VzdG9yc1tvcHRpb25zLnBhcmVudEZpcnN0ID8gJ3B1c2gnIDogJ3Vuc2hpZnQnXShwYXJlbnQpO1xuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYW5jZXN0b3JzO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoaXMgdGV4dCBwcm94eSBoYXMgYW4gYXR0cmlidXRlIGZvciBnaXZlbiBrZXkuXG5cdCAqXG5cdCAqIEBwYXJhbSBrZXkgS2V5IG9mIGF0dHJpYnV0ZSB0byBjaGVjay5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBpcyBzZXQgb24gdGV4dCBwcm94eSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBoYXNBdHRyaWJ1dGUoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHROb2RlLmhhc0F0dHJpYnV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBhbiBhdHRyaWJ1dGUgdmFsdWUgZm9yIGdpdmVuIGtleSBvciBgdW5kZWZpbmVkYCBpZiB0aGF0IGF0dHJpYnV0ZSBpcyBub3Qgc2V0IG9uIHRleHQgcHJveHkuXG5cdCAqXG5cdCAqIEBwYXJhbSBrZXkgS2V5IG9mIGF0dHJpYnV0ZSB0byBsb29rIGZvci5cblx0ICogQHJldHVybnMgQXR0cmlidXRlIHZhbHVlIG9yIGB1bmRlZmluZWRgLlxuXHQgKi8gZ2V0QXR0cmlidXRlKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0Tm9kZS5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgbm9kZSdzIGF0dHJpYnV0ZXMuIEF0dHJpYnV0ZXMgYXJlIHJldHVybmVkIGFzIGFycmF5cyBjb250YWluaW5nIHR3b1xuXHQgKiBpdGVtcy4gRmlyc3Qgb25lIGlzIGF0dHJpYnV0ZSBrZXkgYW5kIHNlY29uZCBpcyBhdHRyaWJ1dGUgdmFsdWUuXG5cdCAqXG5cdCAqIFRoaXMgZm9ybWF0IGlzIGFjY2VwdGVkIGJ5IG5hdGl2ZSBgTWFwYCBvYmplY3QgYW5kIGFsc28gY2FuIGJlIHBhc3NlZCBpbiBgTm9kZWAgY29uc3RydWN0b3IuXG5cdCAqLyBnZXRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0Tm9kZS5nZXRBdHRyaWJ1dGVzKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGl0ZXJhdG9yIHRoYXQgaXRlcmF0ZXMgb3ZlciB0aGlzIG5vZGUncyBhdHRyaWJ1dGUga2V5cy5cblx0ICovIGdldEF0dHJpYnV0ZUtleXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHROb2RlLmdldEF0dHJpYnV0ZUtleXMoKTtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5UZXh0UHJveHkucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnJHRleHRQcm94eScgfHwgdHlwZSA9PT0gJ21vZGVsOiR0ZXh0UHJveHknIHx8IC8vIFRoaXMgYXJlIGxlZ2FjeSB2YWx1ZXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICB0eXBlID09PSAndGV4dFByb3h5JyB8fCB0eXBlID09PSAnbW9kZWw6dGV4dFByb3h5Jztcbn07XG5cbi8qKlxuICogUG9zaXRpb24gaXRlcmF0b3IgY2xhc3MuIEl0IGFsbG93cyB0byBpdGVyYXRlIGZvcndhcmQgYW5kIGJhY2t3YXJkIG92ZXIgdGhlIGRvY3VtZW50LlxuICovIGNsYXNzIFRyZWVXYWxrZXIge1xuICAgIC8qKlxuXHQgKiBXYWxraW5nIGRpcmVjdGlvbi4gRGVmYXVsdHMgYCdmb3J3YXJkJ2AuXG5cdCAqLyBkaXJlY3Rpb247XG4gICAgLyoqXG5cdCAqIEl0ZXJhdG9yIGJvdW5kYXJpZXMuXG5cdCAqXG5cdCAqIFdoZW4gdGhlIGl0ZXJhdG9yIGlzIHdhbGtpbmcgYCdmb3J3YXJkJ2Agb24gdGhlIGVuZCBvZiBib3VuZGFyeSBvciBpcyB3YWxraW5nIGAnYmFja3dhcmQnYFxuXHQgKiBvbiB0aGUgc3RhcnQgb2YgYm91bmRhcnksIHRoZW4gYHsgZG9uZTogdHJ1ZSB9YCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogSWYgYm91bmRhcmllcyBhcmUgbm90IGRlZmluZWQgdGhleSBhcmUgc2V0IGJlZm9yZSBmaXJzdCBhbmQgYWZ0ZXIgbGFzdCBjaGlsZCBvZiB0aGUgcm9vdCBub2RlLlxuXHQgKi8gYm91bmRhcmllcztcbiAgICAvKipcblx0ICogRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgYWxsIGNvbnNlY3V0aXZlIGNoYXJhY3RlcnMgd2l0aCB0aGUgc2FtZSBhdHRyaWJ1dGVzIHNob3VsZCBiZVxuXHQgKiByZXR1cm5lZCBhcyBvbmUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eX0gKGB0cnVlYCkgb3Igb25lIGJ5IG9uZSAoYGZhbHNlYCkuXG5cdCAqLyBzaW5nbGVDaGFyYWN0ZXJzO1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBpdGVyYXRvciBzaG91bGQgZW50ZXIgZWxlbWVudHMgb3Igbm90LiBJZiB0aGUgaXRlcmF0b3IgaXMgc2hhbGxvdyBjaGlsZCBub2RlcyBvZiBhbnlcblx0ICogaXRlcmF0ZWQgbm9kZSB3aWxsIG5vdCBiZSByZXR1cm5lZCBhbG9uZyB3aXRoIGBlbGVtZW50RW5kYCB0YWcuXG5cdCAqLyBzaGFsbG93O1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRpbmcgd2hldGhlciBpdGVyYXRvciBzaG91bGQgaWdub3JlIGBlbGVtZW50RW5kYCB0YWdzLiBJZiB0aGUgb3B0aW9uIGlzIHRydWUgd2Fsa2VyIHdpbGwgbm90XG5cdCAqIHJldHVybiBhIHBhcmVudCBub2RlIG9mIHRoZSBzdGFydCBwb3NpdGlvbi4gSWYgdGhpcyBvcHRpb24gaXMgYHRydWVgIGVhY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fSB3aWxsXG5cdCAqIGJlIHJldHVybmVkIG9uY2UsIHdoaWxlIGlmIHRoZSBvcHRpb24gaXMgYGZhbHNlYCB0aGV5IG1pZ2h0IGJlIHJldHVybmVkIHR3aWNlOlxuXHQgKiBmb3IgYCdlbGVtZW50U3RhcnQnYCBhbmQgYCdlbGVtZW50RW5kJ2AuXG5cdCAqLyBpZ25vcmVFbGVtZW50RW5kO1xuICAgIC8qKlxuXHQgKiBJdGVyYXRvciBwb3NpdGlvbi4gVGhpcyBpcyBhbHdheXMgc3RhdGljIHBvc2l0aW9uLCBldmVuIGlmIHRoZSBpbml0aWFsIHBvc2l0aW9uIHdhcyBhXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVwb3NpdGlvbn5MaXZlUG9zaXRpb24gbGl2ZSBwb3NpdGlvbn0uIElmIHN0YXJ0IHBvc2l0aW9uIGlzIG5vdCBkZWZpbmVkIHRoZW4gcG9zaXRpb24gZGVwZW5kc1xuXHQgKiBvbiB7QGxpbmsgI2RpcmVjdGlvbn0uIElmIGRpcmVjdGlvbiBpcyBgJ2ZvcndhcmQnYCBwb3NpdGlvbiBzdGFydHMgZm9ybSB0aGUgYmVnaW5uaW5nLCB3aGVuIGRpcmVjdGlvblxuXHQgKiBpcyBgJ2JhY2t3YXJkJ2AgcG9zaXRpb24gc3RhcnRzIGZyb20gdGhlIGVuZC5cblx0ICovIF9wb3NpdGlvbjtcbiAgICAvKipcblx0ICogU3RhcnQgYm91bmRhcnkgY2FjaGVkIGZvciBvcHRpbWl6YXRpb24gcHVycG9zZXMuXG5cdCAqLyBfYm91bmRhcnlTdGFydFBhcmVudDtcbiAgICAvKipcblx0ICogRW5kIGJvdW5kYXJ5IGNhY2hlZCBmb3Igb3B0aW1pemF0aW9uIHB1cnBvc2VzLlxuXHQgKi8gX2JvdW5kYXJ5RW5kUGFyZW50O1xuICAgIC8qKlxuXHQgKiBQYXJlbnQgb2YgdGhlIG1vc3QgcmVjZW50bHkgdmlzaXRlZCBub2RlLiBDYWNoZWQgZm9yIG9wdGltaXphdGlvbiBwdXJwb3Nlcy5cblx0ICovIF92aXNpdGVkUGFyZW50O1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaXRlcmF0b3IuIEFsbCBwYXJhbWV0ZXJzIGFyZSBvcHRpb25hbCwgYnV0IHlvdSBoYXZlIHRvIHNwZWNpZnkgZWl0aGVyIGBib3VuZGFyaWVzYCBvciBgc3RhcnRQb3NpdGlvbmAuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9iamVjdCB3aXRoIGNvbmZpZ3VyYXRpb24uXG5cdCAqLyBjb25zdHJ1Y3RvcihvcHRpb25zKXtcbiAgICAgICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLmJvdW5kYXJpZXMgJiYgIW9wdGlvbnMuc3RhcnRQb3NpdGlvbikge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBOZWl0aGVyIGJvdW5kYXJpZXMgbm9yIHN0YXJ0aW5nIHBvc2l0aW9uIG9mIGEgYFRyZWVXYWxrZXJgIGhhdmUgYmVlbiBkZWZpbmVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb2RlbC10cmVlLXdhbGtlci1uby1zdGFydC1wb3NpdGlvblxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC10cmVlLXdhbGtlci1uby1zdGFydC1wb3NpdGlvbicsIG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IG9wdGlvbnMuZGlyZWN0aW9uIHx8ICdmb3J3YXJkJztcbiAgICAgICAgaWYgKGRpcmVjdGlvbiAhPSAnZm9yd2FyZCcgJiYgZGlyZWN0aW9uICE9ICdiYWNrd2FyZCcpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogT25seSBgYmFja3dhcmRgIGFuZCBgZm9yd2FyZGAgZGlyZWN0aW9uIGFsbG93ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1vZGVsLXRyZWUtd2Fsa2VyLXVua25vd24tZGlyZWN0aW9uXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXRyZWUtd2Fsa2VyLXVua25vd24tZGlyZWN0aW9uJywgb3B0aW9ucywge1xuICAgICAgICAgICAgICAgIGRpcmVjdGlvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XG4gICAgICAgIHRoaXMuYm91bmRhcmllcyA9IG9wdGlvbnMuYm91bmRhcmllcyB8fCBudWxsO1xuICAgICAgICBpZiAob3B0aW9ucy5zdGFydFBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IG9wdGlvbnMuc3RhcnRQb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBQb3NpdGlvbi5fY3JlYXRlQXQodGhpcy5ib3VuZGFyaWVzW3RoaXMuZGlyZWN0aW9uID09ICdiYWNrd2FyZCcgPyAnZW5kJyA6ICdzdGFydCddKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZXNldCBwb3NpdGlvbiBzdGlja2luZXNzIGluIGNhc2UgaXQgd2FzIHNldCB0byBvdGhlciB2YWx1ZSwgYXMgdGhlIHN0aWNraW5lc3MgaXMga2VwdCBhZnRlciBjbG9uaW5nLlxuICAgICAgICB0aGlzLnBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9Ob25lJztcbiAgICAgICAgdGhpcy5zaW5nbGVDaGFyYWN0ZXJzID0gISFvcHRpb25zLnNpbmdsZUNoYXJhY3RlcnM7XG4gICAgICAgIHRoaXMuc2hhbGxvdyA9ICEhb3B0aW9ucy5zaGFsbG93O1xuICAgICAgICB0aGlzLmlnbm9yZUVsZW1lbnRFbmQgPSAhIW9wdGlvbnMuaWdub3JlRWxlbWVudEVuZDtcbiAgICAgICAgdGhpcy5fYm91bmRhcnlTdGFydFBhcmVudCA9IHRoaXMuYm91bmRhcmllcyA/IHRoaXMuYm91bmRhcmllcy5zdGFydC5wYXJlbnQgOiBudWxsO1xuICAgICAgICB0aGlzLl9ib3VuZGFyeUVuZFBhcmVudCA9IHRoaXMuYm91bmRhcmllcyA/IHRoaXMuYm91bmRhcmllcy5lbmQucGFyZW50IDogbnVsbDtcbiAgICAgICAgdGhpcy5fdmlzaXRlZFBhcmVudCA9IHRoaXMucG9zaXRpb24ucGFyZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmFibGUgaW50ZXJmYWNlLlxuXHQgKlxuXHQgKiBAcmV0dXJucyB7SXRlcmFibGUuPG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWU+fVxuXHQgKi8gW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmF0b3IgcG9zaXRpb24uIFRoaXMgaXMgYWx3YXlzIHN0YXRpYyBwb3NpdGlvbiwgZXZlbiBpZiB0aGUgaW5pdGlhbCBwb3NpdGlvbiB3YXMgYVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcG9zaXRpb25+TGl2ZVBvc2l0aW9uIGxpdmUgcG9zaXRpb259LiBJZiBzdGFydCBwb3NpdGlvbiBpcyBub3QgZGVmaW5lZCB0aGVuIHBvc2l0aW9uIGRlcGVuZHNcblx0ICogb24ge0BsaW5rICNkaXJlY3Rpb259LiBJZiBkaXJlY3Rpb24gaXMgYCdmb3J3YXJkJ2AgcG9zaXRpb24gc3RhcnRzIGZvcm0gdGhlIGJlZ2lubmluZywgd2hlbiBkaXJlY3Rpb25cblx0ICogaXMgYCdiYWNrd2FyZCdgIHBvc2l0aW9uIHN0YXJ0cyBmcm9tIHRoZSBlbmQuXG5cdCAqLyBnZXQgcG9zaXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIHtAbGluayAjcG9zaXRpb259IGluIHRoZSB7QGxpbmsgI2RpcmVjdGlvbn0gc2tpcHBpbmcgdmFsdWVzIGFzIGxvbmcgYXMgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHJldHVybnMgYHRydWVgLlxuXHQgKlxuXHQgKiBGb3IgZXhhbXBsZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogd2Fsa2VyLnNraXAoIHZhbHVlID0+IHZhbHVlLnR5cGUgPT0gJ3RleHQnICk7IC8vIDxwYXJhZ3JhcGg+W11mb288L3BhcmFncmFwaD4gLT4gPHBhcmFncmFwaD5mb29bXTwvcGFyYWdyYXBoPlxuXHQgKiB3YWxrZXIuc2tpcCggKCkgPT4gdHJ1ZSApOyAvLyBNb3ZlIHRoZSBwb3NpdGlvbiB0byB0aGUgZW5kOiA8cGFyYWdyYXBoPltdZm9vPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Zm9vPC9wYXJhZ3JhcGg+W11cblx0ICogd2Fsa2VyLnNraXAoICgpID0+IGZhbHNlICk7IC8vIERvIG5vdCBtb3ZlIHRoZSBwb3NpdGlvbi5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBza2lwIENhbGxiYWNrIGZ1bmN0aW9uLiBHZXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RyZWV3YWxrZXJ+VHJlZVdhbGtlclZhbHVlfSBhbmQgc2hvdWxkXG5cdCAqIHJldHVybiBgdHJ1ZWAgaWYgdGhlIHZhbHVlIHNob3VsZCBiZSBza2lwcGVkIG9yIGBmYWxzZWAgaWYgbm90LlxuXHQgKi8gc2tpcChza2lwKSB7XG4gICAgICAgIGxldCBkb25lLCB2YWx1ZSwgcHJldlBvc2l0aW9uLCBwcmV2VmlzaXRlZFBhcmVudDtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgcHJldlBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgICAgIHByZXZWaXNpdGVkUGFyZW50ID0gdGhpcy5fdmlzaXRlZFBhcmVudDtcbiAgICAgICAgICAgICh7IGRvbmUsIHZhbHVlIH0gPSB0aGlzLm5leHQoKSk7XG4gICAgICAgIH13aGlsZSAoIWRvbmUgJiYgc2tpcCh2YWx1ZSkpXG4gICAgICAgIGlmICghZG9uZSkge1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwcmV2UG9zaXRpb247XG4gICAgICAgICAgICB0aGlzLl92aXNpdGVkUGFyZW50ID0gcHJldlZpc2l0ZWRQYXJlbnQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIHRyZWUgd2Fsa2VyIHtAbGluayAjcG9zaXRpb259IHRvIHByb3ZpZGVkIGBwb3NpdGlvbmAuIFRyZWUgd2Fsa2VyIHdpbGxcblx0ICogY29udGludWUgdHJhdmVyc2luZyBmcm9tIHRoYXQgcG9zaXRpb24uXG5cdCAqXG5cdCAqIE5vdGU6IGluIGNvbnRyYXJ5IHRvIHtAbGluayB+VHJlZVdhbGtlciNza2lwfSwgdGhpcyBtZXRob2QgZG9lcyBub3QgaXRlcmF0ZSBvdmVyIHRoZSBub2RlcyBhbG9uZyB0aGUgd2F5LlxuXHQgKiBJdCBzaW1wbHkgc2V0cyB0aGUgY3VycmVudCB0cmVlIHdhbGtlciBwb3NpdGlvbiB0byBhIG5ldyBvbmUuXG5cdCAqIEZyb20gdGhlIHBlcmZvcm1hbmNlIHN0YW5kcG9pbnQsIGl0IGlzIGJldHRlciB0byB1c2Uge0BsaW5rIH5UcmVlV2Fsa2VyI2p1bXBUb30gcmF0aGVyIHRoYW4ge0BsaW5rIH5UcmVlV2Fsa2VyI3NraXB9LlxuXHQgKlxuXHQgKiBJZiB0aGUgcHJvdmlkZWQgcG9zaXRpb24gaXMgYmVmb3JlIHRoZSBzdGFydCBib3VuZGFyeSwgdGhlIHBvc2l0aW9uIHdpbGwgYmVcblx0ICogc2V0IHRvIHRoZSBzdGFydCBib3VuZGFyeS4gSWYgdGhlIHByb3ZpZGVkIHBvc2l0aW9uIGlzIGFmdGVyIHRoZSBlbmQgYm91bmRhcnksXG5cdCAqIHRoZSBwb3NpdGlvbiB3aWxsIGJlIHNldCB0byB0aGUgZW5kIGJvdW5kYXJ5LlxuXHQgKiBUaGlzIGlzIGRvbmUgdG8gcHJldmVudCB0aGUgdHJlZXdhbGtlciBmcm9tIHRyYXZlcnNpbmcgb3V0c2lkZSB0aGUgYm91bmRhcmllcy5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHRvIGp1bXAgdG8uXG5cdCAqLyBqdW1wVG8ocG9zaXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuX2JvdW5kYXJ5U3RhcnRQYXJlbnQgJiYgcG9zaXRpb24uaXNCZWZvcmUodGhpcy5ib3VuZGFyaWVzLnN0YXJ0KSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmJvdW5kYXJpZXMuc3RhcnQ7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm91bmRhcnlFbmRQYXJlbnQgJiYgcG9zaXRpb24uaXNBZnRlcih0aGlzLmJvdW5kYXJpZXMuZW5kKSkge1xuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmJvdW5kYXJpZXMuZW5kO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgdGhpcy5fdmlzaXRlZFBhcmVudCA9IHBvc2l0aW9uLnBhcmVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIG5leHQgdHJlZSB3YWxrZXIncyB2YWx1ZS5cblx0ICovIG5leHQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAnZm9yd2FyZCcpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogTWFrZXMgYSBzdGVwIGZvcndhcmQgaW4gbW9kZWwuIE1vdmVzIHRoZSB7QGxpbmsgI3Bvc2l0aW9ufSB0byB0aGUgbmV4dCBwb3NpdGlvbiBhbmQgcmV0dXJucyB0aGUgZW5jb3VudGVyZWQgdmFsdWUuXG5cdCAqLyBfbmV4dCgpIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLl92aXNpdGVkUGFyZW50O1xuICAgICAgICAvLyBXZSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgcm9vdC5cbiAgICAgICAgaWYgKHBhcmVudC5wYXJlbnQgPT09IG51bGwgJiYgcG9zaXRpb24ub2Zmc2V0ID09PSBwYXJlbnQubWF4T2Zmc2V0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSByZWFjaGVkIHRoZSB3YWxrZXIgYm91bmRhcnkuXG4gICAgICAgIGlmIChwYXJlbnQgPT09IHRoaXMuX2JvdW5kYXJ5RW5kUGFyZW50ICYmIHBvc2l0aW9uLm9mZnNldCA9PSB0aGlzLmJvdW5kYXJpZXMuZW5kLm9mZnNldCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2V0IG5vZGUganVzdCBhZnRlciB0aGUgY3VycmVudCBwb3NpdGlvbi5cbiAgICAgICAgLy8gVXNlIGEgaGlnaGx5IG9wdGltaXplZCB2ZXJzaW9uIGluc3RlYWQgb2YgY2hlY2tpbmcgdGhlIHRleHQgbm9kZSBmaXJzdCBhbmQgdGhlbiBnZXR0aW5nIHRoZSBub2RlIGFmdGVyLiBTZWUgIzY1ODIuXG4gICAgICAgIGNvbnN0IHRleHROb2RlQXRQb3NpdGlvbiA9IGdldFRleHROb2RlQXRQb3NpdGlvbihwb3NpdGlvbiwgcGFyZW50KTtcbiAgICAgICAgY29uc3Qgbm9kZSA9IHRleHROb2RlQXRQb3NpdGlvbiB8fCBnZXROb2RlQWZ0ZXJQb3NpdGlvbihwb3NpdGlvbiwgcGFyZW50LCB0ZXh0Tm9kZUF0UG9zaXRpb24pO1xuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmlzKCdtb2RlbDplbGVtZW50JykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5zaGFsbG93KSB7XG4gICAgICAgICAgICAgICAgLy8gTWFudWFsIG9wZXJhdGlvbnMgb24gcGF0aCBpbnRlcm5hbHMgZm9yIG9wdGltaXphdGlvbiBwdXJwb3Nlcy4gSGVyZSBhbmQgaW4gdGhlIHJlc3Qgb2YgdGhlIG1ldGhvZC5cbiAgICAgICAgICAgICAgICBwb3NpdGlvbi5wYXRoLnB1c2goMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmlzaXRlZFBhcmVudCA9IG5vZGU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFdlIGFyZSBwYXN0IHRoZSB3YWxrZXIgYm91bmRhcmllcy5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ib3VuZGFyaWVzICYmIHRoaXMuYm91bmRhcmllcy5lbmQuaXNCZWZvcmUocG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0UmV0dXJuVmFsdWUoJ2VsZW1lbnRTdGFydCcsIG5vZGUsIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZSAmJiBub2RlLmlzKCdtb2RlbDokdGV4dCcpKSB7XG4gICAgICAgICAgICBsZXQgY2hhcmFjdGVyc0NvdW50O1xuICAgICAgICAgICAgaWYgKHRoaXMuc2luZ2xlQ2hhcmFjdGVycykge1xuICAgICAgICAgICAgICAgIGNoYXJhY3RlcnNDb3VudCA9IDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSBub2RlLmVuZE9mZnNldDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYm91bmRhcnlFbmRQYXJlbnQgPT0gcGFyZW50ICYmIHRoaXMuYm91bmRhcmllcy5lbmQub2Zmc2V0IDwgb2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IHRoaXMuYm91bmRhcmllcy5lbmQub2Zmc2V0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzQ291bnQgPSBvZmZzZXQgLSBwb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvZmZzZXRJblRleHROb2RlID0gcG9zaXRpb24ub2Zmc2V0IC0gbm9kZS5zdGFydE9mZnNldDtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgVGV4dFByb3h5KG5vZGUsIG9mZnNldEluVGV4dE5vZGUsIGNoYXJhY3RlcnNDb3VudCk7XG4gICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQgKz0gY2hhcmFjdGVyc0NvdW50O1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXRSZXR1cm5WYWx1ZSgndGV4dCcsIGl0ZW0sIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uLCBjaGFyYWN0ZXJzQ291bnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGBub2RlYCBpcyBub3Qgc2V0LCB3ZSByZWFjaGVkIHRoZSBlbmQgb2YgY3VycmVudCBgcGFyZW50YC5cbiAgICAgICAgcG9zaXRpb24ucGF0aC5wb3AoKTtcbiAgICAgICAgcG9zaXRpb24ub2Zmc2V0Kys7XG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHRoaXMuX3Zpc2l0ZWRQYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICBpZiAodGhpcy5pZ25vcmVFbGVtZW50RW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudEVuZCcsIHBhcmVudCwgcHJldmlvdXNQb3NpdGlvbiwgcG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogTWFrZXMgYSBzdGVwIGJhY2t3YXJkIGluIG1vZGVsLiBNb3ZlcyB0aGUge0BsaW5rICNwb3NpdGlvbn0gdG8gdGhlIHByZXZpb3VzIHBvc2l0aW9uIGFuZCByZXR1cm5zIHRoZSBlbmNvdW50ZXJlZCB2YWx1ZS5cblx0ICovIF9wcmV2aW91cygpIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLl92aXNpdGVkUGFyZW50O1xuICAgICAgICAvLyBXZSBhcmUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcm9vdC5cbiAgICAgICAgaWYgKHBhcmVudC5wYXJlbnQgPT09IG51bGwgJiYgcG9zaXRpb24ub2Zmc2V0ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRvbmU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSByZWFjaGVkIHRoZSB3YWxrZXIgYm91bmRhcnkuXG4gICAgICAgIGlmIChwYXJlbnQgPT0gdGhpcy5fYm91bmRhcnlTdGFydFBhcmVudCAmJiBwb3NpdGlvbi5vZmZzZXQgPT0gdGhpcy5ib3VuZGFyaWVzLnN0YXJ0Lm9mZnNldCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2V0IG5vZGUganVzdCBiZWZvcmUgdGhlIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgICAgIC8vIFVzZSBhIGhpZ2hseSBvcHRpbWl6ZWQgdmVyc2lvbiBpbnN0ZWFkIG9mIGNoZWNraW5nIHRoZSB0ZXh0IG5vZGUgZmlyc3QgYW5kIHRoZW4gZ2V0dGluZyB0aGUgbm9kZSBiZWZvcmUuIFNlZSAjNjU4Mi5cbiAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHRleHROb2RlQXRQb3NpdGlvbiA9IGdldFRleHROb2RlQXRQb3NpdGlvbihwb3NpdGlvbiwgcG9zaXRpb25QYXJlbnQpO1xuICAgICAgICBjb25zdCBub2RlID0gdGV4dE5vZGVBdFBvc2l0aW9uIHx8IGdldE5vZGVCZWZvcmVQb3NpdGlvbihwb3NpdGlvbiwgcG9zaXRpb25QYXJlbnQsIHRleHROb2RlQXRQb3NpdGlvbik7XG4gICAgICAgIGlmIChub2RlICYmIG5vZGUuaXMoJ21vZGVsOmVsZW1lbnQnKSkge1xuICAgICAgICAgICAgcG9zaXRpb24ub2Zmc2V0LS07XG4gICAgICAgICAgICBpZiAodGhpcy5zaGFsbG93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0UmV0dXJuVmFsdWUoJ2VsZW1lbnRTdGFydCcsIG5vZGUsIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvc2l0aW9uLnBhdGgucHVzaChub2RlLm1heE9mZnNldCk7XG4gICAgICAgICAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICAgICAgdGhpcy5fdmlzaXRlZFBhcmVudCA9IG5vZGU7XG4gICAgICAgICAgICBpZiAodGhpcy5pZ25vcmVFbGVtZW50RW5kKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0UmV0dXJuVmFsdWUoJ2VsZW1lbnRFbmQnLCBub2RlLCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5pcygnbW9kZWw6JHRleHQnKSkge1xuICAgICAgICAgICAgbGV0IGNoYXJhY3RlcnNDb3VudDtcbiAgICAgICAgICAgIGlmICh0aGlzLnNpbmdsZUNoYXJhY3RlcnMpIHtcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzQ291bnQgPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gbm9kZS5zdGFydE9mZnNldDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYm91bmRhcnlTdGFydFBhcmVudCA9PSBwYXJlbnQgJiYgdGhpcy5ib3VuZGFyaWVzLnN0YXJ0Lm9mZnNldCA+IG9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSB0aGlzLmJvdW5kYXJpZXMuc3RhcnQub2Zmc2V0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJzQ291bnQgPSBwb3NpdGlvbi5vZmZzZXQgLSBvZmZzZXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvZmZzZXRJblRleHROb2RlID0gcG9zaXRpb24ub2Zmc2V0IC0gbm9kZS5zdGFydE9mZnNldDtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgVGV4dFByb3h5KG5vZGUsIG9mZnNldEluVGV4dE5vZGUgLSBjaGFyYWN0ZXJzQ291bnQsIGNoYXJhY3RlcnNDb3VudCk7XG4gICAgICAgICAgICBwb3NpdGlvbi5vZmZzZXQgLT0gY2hhcmFjdGVyc0NvdW50O1xuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXRSZXR1cm5WYWx1ZSgndGV4dCcsIGl0ZW0sIHByZXZpb3VzUG9zaXRpb24sIHBvc2l0aW9uLCBjaGFyYWN0ZXJzQ291bnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGBub2RlYCBpcyBub3Qgc2V0LCB3ZSByZWFjaGVkIHRoZSBiZWdpbm5pbmcgb2YgY3VycmVudCBgcGFyZW50YC5cbiAgICAgICAgcG9zaXRpb24ucGF0aC5wb3AoKTtcbiAgICAgICAgdGhpcy5fcG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5fdmlzaXRlZFBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgICAgIHJldHVybiBmb3JtYXRSZXR1cm5WYWx1ZSgnZWxlbWVudFN0YXJ0JywgcGFyZW50LCBwcmV2aW91c1Bvc2l0aW9uLCBwb3NpdGlvbiwgMSk7XG4gICAgfVxufVxuZnVuY3Rpb24gZm9ybWF0UmV0dXJuVmFsdWUodHlwZSwgaXRlbSwgcHJldmlvdXNQb3NpdGlvbiwgbmV4dFBvc2l0aW9uLCBsZW5ndGgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBkb25lOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBpdGVtLFxuICAgICAgICAgICAgcHJldmlvdXNQb3NpdGlvbixcbiAgICAgICAgICAgIG5leHRQb3NpdGlvbixcbiAgICAgICAgICAgIGxlbmd0aFxuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgcG9zaXRpb24gaW4gdGhlIG1vZGVsIHRyZWUuXG4gKlxuICogQSBwb3NpdGlvbiBpcyByZXByZXNlbnRlZCBieSBpdHMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcm9vdH0gYW5kXG4gKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhdGh9IGluIHRoYXQgcm9vdC5cbiAqXG4gKiBZb3UgY2FuIGNyZWF0ZSBwb3NpdGlvbiBpbnN0YW5jZXMgdmlhIGl0cyBjb25zdHJ1Y3RvciBvciB0aGUgYGNyZWF0ZVBvc2l0aW9uKigpYCBmYWN0b3J5IG1ldGhvZHMgb2ZcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsfSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlcn0uXG4gKlxuICogKipOb3RlOioqIFBvc2l0aW9uIGlzIGJhc2VkIG9uIG9mZnNldHMsIG5vdCBpbmRleGVzLiBUaGlzIG1lYW5zIHRoYXQgYSBwb3NpdGlvbiBiZXR3ZWVuIHR3byB0ZXh0IG5vZGVzXG4gKiBgZm9vYCBhbmQgYGJhcmAgaGFzIG9mZnNldCBgM2AsIG5vdCBgMWAuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXRofSBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAqXG4gKiBTaW5jZSBhIHBvc2l0aW9uIGluIHRoZSBtb2RlbCBpcyByZXByZXNlbnRlZCBieSBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3Jvb3QgcG9zaXRpb24gcm9vdH0gYW5kXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXRoIHBvc2l0aW9uIHBhdGh9IGl0IGlzIHBvc3NpYmxlIHRvIGNyZWF0ZSBwb3NpdGlvbnMgcGxhY2VkIGluIG5vbi1leGlzdGluZyBwbGFjZXMuXG4gKiBUaGlzIHJlcXVpcmVtZW50IGlzIGltcG9ydGFudCBmb3Igb3BlcmF0aW9uYWwgdHJhbnNmb3JtYXRpb24gYWxnb3JpdGhtcy5cbiAqXG4gKiBBbHNvLCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiBvcGVyYXRpb25zfVxuICoga2VwdCBpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjaGlzdG9yeSBkb2N1bWVudCBoaXN0b3J5fVxuICogYXJlIHN0b3JpbmcgcG9zaXRpb25zIChhbmQgcmFuZ2VzKSB3aGljaCB3ZXJlIGNvcnJlY3Qgd2hlbiB0aG9zZSBvcGVyYXRpb25zIHdlcmUgYXBwbGllZCwgYnV0IG1heSBub3QgYmUgY29ycmVjdFxuICogYWZ0ZXIgdGhlIGRvY3VtZW50IGhhcyBjaGFuZ2VkLlxuICpcbiAqIFdoZW4gY2hhbmdlcyBhcmUgYXBwbGllZCB0byB0aGUgbW9kZWwsIGl0IG1heSBhbHNvIGhhcHBlbiB0aGF0IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudCBwb3NpdGlvbiBwYXJlbnR9XG4gKiB3aWxsIGNoYW5nZSBldmVuIGlmIHBvc2l0aW9uIHBhdGggaGFzIG5vdCBjaGFuZ2VkLiBLZWVwIGluIG1pbmQsIHRoYXQgaWYgYSBwb3NpdGlvbiBsZWFkcyB0byBub24tZXhpc3RpbmcgZWxlbWVudCxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudH0gYW5kIHNvbWUgb3RoZXIgcHJvcGVydGllcyBhbmQgbWV0aG9kcyB3aWxsIHRocm93IGVycm9ycy5cbiAqXG4gKiBJbiBtb3N0IGNhc2VzLCBwb3NpdGlvbiB3aXRoIHdyb25nIHBhdGggaXMgY2F1c2VkIGJ5IGFuIGVycm9yIGluIGNvZGUsIGJ1dCBpdCBpcyBzb21ldGltZXMgbmVlZGVkLCBhcyBkZXNjcmliZWQgYWJvdmUuXG4gKi8gY2xhc3MgUG9zaXRpb24gZXh0ZW5kcyBUeXBlQ2hlY2thYmxlIHtcbiAgICAvKipcblx0ICogUm9vdCBvZiB0aGUgcG9zaXRpb24gcGF0aC5cblx0ICovIHJvb3Q7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIG9mIHRoZSBub2RlIGluIHRoZSB0cmVlLiAqKlBhdGggY29udGFpbnMgb2Zmc2V0cywgbm90IGluZGV4ZXMuKipcblx0ICpcblx0ICogUG9zaXRpb24gY2FuIGJlIHBsYWNlZCBiZWZvcmUsIGFmdGVyIG9yIGluIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlIG5vZGV9IGlmIHRoYXQgbm9kZSBoYXNcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI29mZnNldFNpemV9IGdyZWF0ZXIgdGhhbiBgMWAuIEl0ZW1zIGluIHBvc2l0aW9uIHBhdGggYXJlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSNzdGFydE9mZnNldCBzdGFydGluZyBvZmZzZXRzfSBvZiBwb3NpdGlvbiBhbmNlc3RvcnMsIHN0YXJ0aW5nIGZyb20gZGlyZWN0IHJvb3QgY2hpbGRyZW4sXG5cdCAqIGRvd24gdG8gdGhlIHBvc2l0aW9uIG9mZnNldCBpbiBpdCdzIHBhcmVudC5cblx0ICpcblx0ICogYGBgXG5cdCAqIFJPT1Rcblx0ICogIHwtIFAgICAgICAgICAgICBiZWZvcmU6IFsgMCBdICAgICAgICAgYWZ0ZXI6IFsgMSBdXG5cdCAqICB8LSBVTCAgICAgICAgICAgYmVmb3JlOiBbIDEgXSAgICAgICAgIGFmdGVyOiBbIDIgXVxuXHQgKiAgICAgfC0gTEkgICAgICAgIGJlZm9yZTogWyAxLCAwIF0gICAgICBhZnRlcjogWyAxLCAxIF1cblx0ICogICAgIHwgIHwtIGZvbyAgICBiZWZvcmU6IFsgMSwgMCwgMCBdICAgYWZ0ZXI6IFsgMSwgMCwgMyBdXG5cdCAqICAgICB8LSBMSSAgICAgICAgYmVmb3JlOiBbIDEsIDEgXSAgICAgIGFmdGVyOiBbIDEsIDIgXVxuXHQgKiAgICAgICAgfC0gYmFyICAgIGJlZm9yZTogWyAxLCAxLCAwIF0gICBhZnRlcjogWyAxLCAxLCAzIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIGBmb29gIGFuZCBgYmFyYCBhcmUgcmVwcmVzZW50aW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCB0ZXh0IG5vZGVzfS4gU2luY2UgdGV4dCBub2RlcyBoYXMgb2Zmc2V0IHNpemVcblx0ICogZ3JlYXRlciB0aGFuIGAxYCB5b3UgY2FuIHBsYWNlIHBvc2l0aW9uIG9mZnNldCBiZXR3ZWVuIHRoZWlyIHN0YXJ0IGFuZCBlbmQ6XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiBST09UXG5cdCAqICB8LSBQXG5cdCAqICB8LSBVTFxuXHQgKiAgICAgfC0gTElcblx0ICogICAgIHwgIHwtIGZeb3xvICBeIGhhcyBwYXRoOiBbIDEsIDAsIDEgXSAgIHwgaGFzIHBhdGg6IFsgMSwgMCwgMiBdXG5cdCAqICAgICB8LSBMSVxuXHQgKiAgICAgICAgfC0gYl5hfHIgIF4gaGFzIHBhdGg6IFsgMSwgMSwgMSBdICAgfCBoYXMgcGF0aDogWyAxLCAxLCAyIF1cblx0ICogYGBgXG5cdCAqLyBwYXRoO1xuICAgIC8qKlxuXHQgKiBQb3NpdGlvbiBzdGlja2luZXNzLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb25TdGlja2luZXNzfS5cblx0ICovIHN0aWNraW5lc3M7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBwb3NpdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHJvb3QgUm9vdCBvZiB0aGUgcG9zaXRpb24uXG5cdCAqIEBwYXJhbSBwYXRoIFBvc2l0aW9uIHBhdGguIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXRofS5cblx0ICogQHBhcmFtIHN0aWNraW5lc3MgUG9zaXRpb24gc3RpY2tpbmVzcy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uU3RpY2tpbmVzc30uXG5cdCAqLyBjb25zdHJ1Y3Rvcihyb290LCBwYXRoLCBzdGlja2luZXNzID0gJ3RvTm9uZScpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBpZiAoIXJvb3QuaXMoJ2VsZW1lbnQnKSAmJiAhcm9vdC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFBvc2l0aW9uIHJvb3QgaXMgaW52YWxpZC5cblx0XHRcdCAqXG5cdFx0XHQgKiBQb3NpdGlvbnMgY2FuIG9ubHkgYmUgYW5jaG9yZWQgaW4gZWxlbWVudHMgb3IgZG9jdW1lbnQgZnJhZ21lbnRzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb2RlbC1wb3NpdGlvbi1yb290LWludmFsaWRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtcG9zaXRpb24tcm9vdC1pbnZhbGlkJywgcm9vdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhdGgpIHx8IHBhdGgubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFBvc2l0aW9uIHBhdGggbXVzdCBiZSBhbiBhcnJheSB3aXRoIGF0IGxlYXN0IG9uZSBpdGVtLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb2RlbC1wb3NpdGlvbi1wYXRoLWluY29ycmVjdC1mb3JtYXRcblx0XHRcdCAqIEBwYXJhbSBwYXRoXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXBvc2l0aW9uLXBhdGgtaW5jb3JyZWN0LWZvcm1hdCcsIHJvb3QsIHtcbiAgICAgICAgICAgICAgICBwYXRoXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3JtYWxpemUgdGhlIHJvb3QgYW5kIHBhdGggd2hlbiBlbGVtZW50IChub3Qgcm9vdCkgaXMgcGFzc2VkLlxuICAgICAgICBpZiAocm9vdC5pcygncm9vdEVsZW1lbnQnKSkge1xuICAgICAgICAgICAgcGF0aCA9IHBhdGguc2xpY2UoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhdGggPSBbXG4gICAgICAgICAgICAgICAgLi4ucm9vdC5nZXRQYXRoKCksXG4gICAgICAgICAgICAgICAgLi4ucGF0aFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHJvb3QgPSByb290LnJvb3Q7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yb290ID0gcm9vdDtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5zdGlja2luZXNzID0gc3RpY2tpbmVzcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIE9mZnNldCBhdCB3aGljaCB0aGlzIHBvc2l0aW9uIGlzIGxvY2F0ZWQgaW4gaXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudCBwYXJlbnR9LiBJdCBpcyBlcXVhbFxuXHQgKiB0byB0aGUgbGFzdCBpdGVtIGluIHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhdGggcGF0aH0uXG5cdCAqXG5cdCAqIEB0eXBlIHtOdW1iZXJ9XG5cdCAqLyBnZXQgb2Zmc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoW3RoaXMucGF0aC5sZW5ndGggLSAxXTtcbiAgICB9XG4gICAgc2V0IG9mZnNldChuZXdPZmZzZXQpIHtcbiAgICAgICAgdGhpcy5wYXRoW3RoaXMucGF0aC5sZW5ndGggLSAxXSA9IG5ld09mZnNldDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBhcmVudCBlbGVtZW50IG9mIHRoaXMgcG9zaXRpb24uXG5cdCAqXG5cdCAqIEtlZXAgaW4gbWluZCB0aGF0IGBwYXJlbnRgIHZhbHVlIGlzIGNhbGN1bGF0ZWQgd2hlbiB0aGUgcHJvcGVydHkgaXMgYWNjZXNzZWQuXG5cdCAqIElmIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhdGggcG9zaXRpb24gcGF0aH1cblx0ICogbGVhZHMgdG8gYSBub24tZXhpc3RpbmcgZWxlbWVudCwgYHBhcmVudGAgcHJvcGVydHkgd2lsbCB0aHJvdyBlcnJvci5cblx0ICpcblx0ICogQWxzbyBpdCBpcyBhIGdvb2QgaWRlYSB0byBjYWNoZSBgcGFyZW50YCBwcm9wZXJ0eSBpZiBpdCBpcyB1c2VkIGZyZXF1ZW50bHkgaW4gYW4gYWxnb3JpdGhtIChpLmUuIGluIGEgbG9uZyBsb29wKS5cblx0ICovIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIGxldCBwYXJlbnQgPSB0aGlzLnJvb3Q7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnBhdGgubGVuZ3RoIC0gMTsgaSsrKXtcbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5nZXRDaGlsZEF0T2Zmc2V0KHRoaXMucGF0aFtpXSk7XG4gICAgICAgICAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUaGUgcG9zaXRpb24ncyBwYXRoIGlzIGluY29ycmVjdC4gVGhpcyBtZWFucyB0aGF0IGEgcG9zaXRpb24gZG9lcyBub3QgcG9pbnQgdG9cblx0XHRcdFx0ICogYSBjb3JyZWN0IHBsYWNlIGluIHRoZSB0cmVlIGFuZCBoZW5jZSwgc29tZSBvZiBpdHMgbWV0aG9kcyBhbmQgZ2V0dGVycyBjYW5ub3Qgd29yayBjb3JyZWN0bHkuXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqICoqTm90ZSoqOiBVbmxpa2UgRE9NIGFuZCB2aWV3IHBvc2l0aW9ucywgaW4gdGhlIG1vZGVsLCB0aGVcblx0XHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcGFyZW50IHBvc2l0aW9uJ3MgcGFyZW50fSBpcyBhbHdheXMgYW4gZWxlbWVudCBvciBhIGRvY3VtZW50IGZyYWdtZW50LlxuXHRcdFx0XHQgKiBUaGUgbGFzdCBvZmZzZXQgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhdGggcG9zaXRpb24ncyBwYXRofSBpcyB0aGUgcG9pbnQgaW4gdGhpcyBlbGVtZW50XG5cdFx0XHRcdCAqIHdoZXJlIHRoaXMgcG9zaXRpb24gcG9pbnRzLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBSZWFkIG1vcmUgYWJvdXQgbW9kZWwgcG9zaXRpb25zIGFuZCBvZmZzZXRzIGluXG5cdFx0XHRcdCAqIHRoZSB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjaW5kZXhlcy1hbmQtb2Zmc2V0cyBFZGl0aW5nIGVuZ2luZSBhcmNoaXRlY3R1cmV9IGd1aWRlLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgbW9kZWwtcG9zaXRpb24tcGF0aC1pbmNvcnJlY3Rcblx0XHRcdFx0ICogQHBhcmFtIHBvc2l0aW9uIFRoZSBpbmNvcnJlY3QgcG9zaXRpb24uXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtcG9zaXRpb24tcGF0aC1pbmNvcnJlY3QnLCB0aGlzLCB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB0aGlzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcmVudC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXBvc2l0aW9uLXBhdGgtaW5jb3JyZWN0JywgdGhpcywge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB0aGlzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogUG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jb2Zmc2V0IG9mZnNldH0gY29udmVydGVkIHRvIGFuIGluZGV4IGluIHBvc2l0aW9uJ3MgcGFyZW50IG5vZGUuIEl0IGlzXG5cdCAqIGVxdWFsIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjaW5kZXggaW5kZXh9IG9mIGEgbm9kZSBhZnRlciB0aGlzIHBvc2l0aW9uLiBJZiBwb3NpdGlvbiBpcyBwbGFjZWRcblx0ICogaW4gdGV4dCBub2RlLCBwb3NpdGlvbiBpbmRleCBpcyBlcXVhbCB0byB0aGUgaW5kZXggb2YgdGhhdCB0ZXh0IG5vZGUuXG5cdCAqLyBnZXQgaW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5vZmZzZXRUb0luZGV4KHRoaXMub2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0IHRleHQgbm9kZX0gaW5zdGFuY2UgaW4gd2hpY2ggdGhpcyBwb3NpdGlvbiBpcyBwbGFjZWQgb3IgYG51bGxgIGlmIHRoaXNcblx0ICogcG9zaXRpb24gaXMgbm90IGluIGEgdGV4dCBub2RlLlxuXHQgKi8gZ2V0IHRleHROb2RlKCkge1xuICAgICAgICByZXR1cm4gZ2V0VGV4dE5vZGVBdFBvc2l0aW9uKHRoaXMsIHRoaXMucGFyZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE5vZGUgZGlyZWN0bHkgYWZ0ZXIgdGhpcyBwb3NpdGlvbi4gUmV0dXJucyBgbnVsbGAgaWYgdGhpcyBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIGl0cyBwYXJlbnQsIG9yIGlmIGl0IGlzIGluIGEgdGV4dCBub2RlLlxuXHQgKi8gZ2V0IG5vZGVBZnRlcigpIHtcbiAgICAgICAgLy8gQ2FjaGUgdGhlIHBhcmVudCBhbmQgcmV1c2UgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuIFNlZSAjNjU3OSBhbmQgIzY1ODIuXG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50O1xuICAgICAgICByZXR1cm4gZ2V0Tm9kZUFmdGVyUG9zaXRpb24odGhpcywgcGFyZW50LCBnZXRUZXh0Tm9kZUF0UG9zaXRpb24odGhpcywgcGFyZW50KSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOb2RlIGRpcmVjdGx5IGJlZm9yZSB0aGlzIHBvc2l0aW9uLiBSZXR1cm5zIGBudWxsYCBpZiB0aGlzIHBvc2l0aW9uIGlzIGF0IHRoZSBzdGFydCBvZiBpdHMgcGFyZW50LCBvciBpZiBpdCBpcyBpbiBhIHRleHQgbm9kZS5cblx0ICovIGdldCBub2RlQmVmb3JlKCkge1xuICAgICAgICAvLyBDYWNoZSB0aGUgcGFyZW50IGFuZCByZXVzZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucy4gU2VlICM2NTc5IGFuZCAjNjU4Mi5cbiAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7XG4gICAgICAgIHJldHVybiBnZXROb2RlQmVmb3JlUG9zaXRpb24odGhpcywgcGFyZW50LCBnZXRUZXh0Tm9kZUF0UG9zaXRpb24odGhpcywgcGFyZW50KSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJcyBgdHJ1ZWAgaWYgcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiBpdHMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcGFyZW50IHBhcmVudH0sIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gZ2V0IGlzQXRTdGFydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ID09PSAwO1xuICAgIH1cbiAgICAvKipcblx0ICogSXMgYHRydWVgIGlmIHBvc2l0aW9uIGlzIGF0IHRoZSBlbmQgb2YgaXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhcmVudCBwYXJlbnR9LCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGdldCBpc0F0RW5kKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXQgPT0gdGhpcy5wYXJlbnQubWF4T2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIHBvc2l0aW9uIGlzIHZhbGlkIGluIGN1cnJlbnQgbW9kZWwgdHJlZSwgdGhhdCBpcyB3aGV0aGVyIGl0IHBvaW50cyB0byBhbiBleGlzdGluZyBwbGFjZSBpbiB0aGUgbW9kZWwuXG5cdCAqLyBpc1ZhbGlkKCkge1xuICAgICAgICBpZiAodGhpcy5vZmZzZXQgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBhcmVudCA9IHRoaXMucm9vdDtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMucGF0aC5sZW5ndGggLSAxOyBpKyspe1xuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LmdldENoaWxkQXRPZmZzZXQodGhpcy5wYXRoW2ldKTtcbiAgICAgICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLm9mZnNldCA8PSBwYXJlbnQubWF4T2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhpcyBwb3NpdGlvbiBpcyBiZWZvcmUgb3IgYWZ0ZXIgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIHNhZmUgdG8gdXNlIGl0IG9uIG5vbi1leGlzdGluZyBwb3NpdGlvbnMgKGZvciBleGFtcGxlIGR1cmluZyBvcGVyYXRpb25hbCB0cmFuc2Zvcm1hdGlvbikuXG5cdCAqLyBjb21wYXJlV2l0aChvdGhlclBvc2l0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLnJvb3QgIT0gb3RoZXJQb3NpdGlvbi5yb290KSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RpZmZlcmVudCc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyZUFycmF5cyh0aGlzLnBhdGgsIG90aGVyUG9zaXRpb24ucGF0aCk7XG4gICAgICAgIHN3aXRjaChyZXN1bHQpe1xuICAgICAgICAgICAgY2FzZSAnc2FtZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdzYW1lJztcbiAgICAgICAgICAgIGNhc2UgJ3ByZWZpeCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdiZWZvcmUnO1xuICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2FmdGVyJztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGF0aFtyZXN1bHRdIDwgb3RoZXJQb3NpdGlvbi5wYXRoW3Jlc3VsdF0gPyAnYmVmb3JlJyA6ICdhZnRlcic7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIGZhcnRoZXN0IHBvc2l0aW9uIHdoaWNoIG1hdGNoZXMgdGhlIGNhbGxiYWNrIHVzaW5nXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RyZWV3YWxrZXJ+VHJlZVdhbGtlciBUcmVlV2Fsa2VyfS5cblx0ICpcblx0ICogRm9yIGV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCB2YWx1ZSA9PiB2YWx1ZS50eXBlID09ICd0ZXh0JyApO1xuXHQgKiAvLyA8cGFyYWdyYXBoPltdZm9vPC9wYXJhZ3JhcGg+IC0+IDxwYXJhZ3JhcGg+Zm9vW108L3BhcmFncmFwaD5cblx0ICpcblx0ICogZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oIHZhbHVlID0+IHZhbHVlLnR5cGUgPT0gJ3RleHQnLCB7IGRpcmVjdGlvbjogJ2JhY2t3YXJkJyB9ICk7XG5cdCAqIC8vIDxwYXJhZ3JhcGg+Zm9vW108L3BhcmFncmFwaD4gLT4gPHBhcmFncmFwaD5bXWZvbzwvcGFyYWdyYXBoPlxuXHQgKlxuXHQgKiBnZXRMYXN0TWF0Y2hpbmdQb3NpdGlvbiggdmFsdWUgPT4gZmFsc2UgKTtcblx0ICogLy8gRG8gbm90IG1vdmUgdGhlIHBvc2l0aW9uLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIHNraXAgQ2FsbGJhY2sgZnVuY3Rpb24uIEdldHMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWV9IGFuZCBzaG91bGRcblx0ICogcmV0dXJuIGB0cnVlYCBpZiB0aGUgdmFsdWUgc2hvdWxkIGJlIHNraXBwZWQgb3IgYGZhbHNlYCBpZiBub3QuXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9iamVjdCB3aXRoIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RyZWV3YWxrZXJ+VHJlZVdhbGtlcn0uXG5cdCAqXG5cdCAqIEByZXR1cm5zIFRoZSBwb3NpdGlvbiBhZnRlciB0aGUgbGFzdCBpdGVtIHdoaWNoIG1hdGNoZXMgdGhlIGBza2lwYCBjYWxsYmFjayB0ZXN0LlxuXHQgKi8gZ2V0TGFzdE1hdGNoaW5nUG9zaXRpb24oc2tpcCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIG9wdGlvbnMuc3RhcnRQb3NpdGlvbiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHRyZWVXYWxrZXIgPSBuZXcgVHJlZVdhbGtlcihvcHRpb25zKTtcbiAgICAgICAgdHJlZVdhbGtlci5za2lwKHNraXApO1xuICAgICAgICByZXR1cm4gdHJlZVdhbGtlci5wb3NpdGlvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBwYXRoIHRvIHRoaXMgcG9zaXRpb24ncyBwYXJlbnQuIFBhcmVudCBwYXRoIGlzIGVxdWFsIHRvIHBvc2l0aW9uIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3BhdGggcGF0aH1cblx0ICogYnV0IHdpdGhvdXQgdGhlIGxhc3QgaXRlbS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgc2FmZSB0byB1c2UgaXQgb24gbm9uLWV4aXN0aW5nIHBvc2l0aW9ucyAoZm9yIGV4YW1wbGUgZHVyaW5nIG9wZXJhdGlvbmFsIHRyYW5zZm9ybWF0aW9uKS5cblx0ICpcblx0ICogQHJldHVybnMgUGF0aCB0byB0aGUgcGFyZW50LlxuXHQgKi8gZ2V0UGFyZW50UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5zbGljZSgwLCAtMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuY2VzdG9ycyBhcnJheSBvZiB0aGlzIHBvc2l0aW9uLCB0aGF0IGlzIHRoaXMgcG9zaXRpb24ncyBwYXJlbnQgYW5kIGl0cyBhbmNlc3RvcnMuXG5cdCAqXG5cdCAqIEByZXR1cm5zIEFycmF5IHdpdGggYW5jZXN0b3JzLlxuXHQgKi8gZ2V0QW5jZXN0b3JzKCkge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIHBhcmVudFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuZ2V0QW5jZXN0b3JzKHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlU2VsZjogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIHBhcmVudCBlbGVtZW50IG9mIHRoZSBnaXZlbiBuYW1lLiBSZXR1cm5zIG51bGwgaWYgdGhlIHBvc2l0aW9uIGlzIG5vdCBpbnNpZGUgdGhlIGRlc2lyZWQgcGFyZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gcGFyZW50TmFtZSBUaGUgbmFtZSBvZiB0aGUgcGFyZW50IGVsZW1lbnQgdG8gZmluZC5cblx0ICovIGZpbmRBbmNlc3RvcihwYXJlbnROYW1lKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50O1xuICAgICAgICBpZiAocGFyZW50LmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuZmluZEFuY2VzdG9yKHBhcmVudE5hbWUsIHtcbiAgICAgICAgICAgICAgICBpbmNsdWRlU2VsZjogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBzbGljZSBvZiB0d28gcG9zaXRpb24ge0BsaW5rICNwYXRoIHBhdGhzfSB3aGljaCBpcyBpZGVudGljYWwuIFRoZSB7QGxpbmsgI3Jvb3Qgcm9vdHN9XG5cdCAqIG9mIHRoZXNlIHR3byBwYXRocyBtdXN0IGJlIGlkZW50aWNhbC5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgc2FmZSB0byB1c2UgaXQgb24gbm9uLWV4aXN0aW5nIHBvc2l0aW9ucyAoZm9yIGV4YW1wbGUgZHVyaW5nIG9wZXJhdGlvbmFsIHRyYW5zZm9ybWF0aW9uKS5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFRoZSBzZWNvbmQgcG9zaXRpb24uXG5cdCAqIEByZXR1cm5zIFRoZSBjb21tb24gcGF0aC5cblx0ICovIGdldENvbW1vblBhdGgocG9zaXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMucm9vdCAhPSBwb3NpdGlvbi5yb290KSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgZmluZCBvbiB3aGljaCB0cmVlLWxldmVsIHN0YXJ0IGFuZCBlbmQgaGF2ZSB0aGUgbG93ZXN0IGNvbW1vbiBhbmNlc3RvclxuICAgICAgICBjb25zdCBjbXAgPSBjb21wYXJlQXJyYXlzKHRoaXMucGF0aCwgcG9zaXRpb24ucGF0aCk7XG4gICAgICAgIC8vIElmIGNvbXBhcmlzb24gcmV0dXJuZWQgc3RyaW5nIGl0IG1lYW5zIHRoYXQgYXJyYXlzIGFyZSBzYW1lLlxuICAgICAgICBjb25zdCBkaWZmQXQgPSB0eXBlb2YgY21wID09ICdzdHJpbmcnID8gTWF0aC5taW4odGhpcy5wYXRoLmxlbmd0aCwgcG9zaXRpb24ucGF0aC5sZW5ndGgpIDogY21wO1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnNsaWNlKDAsIGRpZmZBdCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fVxuXHQgKiB3aGljaCBpcyBhIGNvbW1vbiBhbmNlc3RvciBvZiBib3RoIHBvc2l0aW9ucy4gVGhlIHtAbGluayAjcm9vdCByb290c30gb2YgdGhlc2UgdHdvIHBvc2l0aW9ucyBtdXN0IGJlIGlkZW50aWNhbC5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFRoZSBzZWNvbmQgcG9zaXRpb24uXG5cdCAqLyBnZXRDb21tb25BbmNlc3Rvcihwb3NpdGlvbikge1xuICAgICAgICBjb25zdCBhbmNlc3RvcnNBID0gdGhpcy5nZXRBbmNlc3RvcnMoKTtcbiAgICAgICAgY29uc3QgYW5jZXN0b3JzQiA9IHBvc2l0aW9uLmdldEFuY2VzdG9ycygpO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHdoaWxlKGFuY2VzdG9yc0FbaV0gPT0gYW5jZXN0b3JzQltpXSAmJiBhbmNlc3RvcnNBW2ldKXtcbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaSA9PT0gMCA/IG51bGwgOiBhbmNlc3RvcnNBW2kgLSAxXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBuZXcgaW5zdGFuY2Ugb2YgYFBvc2l0aW9uYCwgdGhhdCBoYXMgc2FtZSB7QGxpbmsgI3BhcmVudCBwYXJlbnR9IGJ1dCBpdCdzIG9mZnNldFxuXHQgKiBpcyBzaGlmdGVkIGJ5IGBzaGlmdGAgdmFsdWUgKGNhbiBiZSBhIG5lZ2F0aXZlIHZhbHVlKS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgc2FmZSB0byB1c2UgaXQgb24gbm9uLWV4aXN0aW5nIHBvc2l0aW9ucyAoZm9yIGV4YW1wbGUgZHVyaW5nIG9wZXJhdGlvbmFsIHRyYW5zZm9ybWF0aW9uKS5cblx0ICpcblx0ICogQHBhcmFtIHNoaWZ0IE9mZnNldCBzaGlmdC4gQ2FuIGJlIGEgbmVnYXRpdmUgdmFsdWUuXG5cdCAqIEByZXR1cm5zIFNoaWZ0ZWQgcG9zaXRpb24uXG5cdCAqLyBnZXRTaGlmdGVkQnkoc2hpZnQpIHtcbiAgICAgICAgY29uc3Qgc2hpZnRlZCA9IHRoaXMuY2xvbmUoKTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hpZnRlZC5vZmZzZXQgKyBzaGlmdDtcbiAgICAgICAgc2hpZnRlZC5vZmZzZXQgPSBvZmZzZXQgPCAwID8gMCA6IG9mZnNldDtcbiAgICAgICAgcmV0dXJuIHNoaWZ0ZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHBvc2l0aW9uIGlzIGFmdGVyIGdpdmVuIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyBzYWZlIHRvIHVzZSBpdCBvbiBub24tZXhpc3RpbmcgcG9zaXRpb25zIChmb3IgZXhhbXBsZSBkdXJpbmcgb3BlcmF0aW9uYWwgdHJhbnNmb3JtYXRpb24pLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jaXNCZWZvcmVcblx0ICogQHBhcmFtICBvdGhlclBvc2l0aW9uIFBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgVHJ1ZSBpZiB0aGlzIHBvc2l0aW9uIGlzIGFmdGVyIGdpdmVuIHBvc2l0aW9uLlxuXHQgKi8gaXNBZnRlcihvdGhlclBvc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVXaXRoKG90aGVyUG9zaXRpb24pID09ICdhZnRlcic7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHBvc2l0aW9uIGlzIGJlZm9yZSBnaXZlbiBwb3NpdGlvbi5cblx0ICpcblx0ICogKipOb3RlOioqIHdhdGNoIG91dCB3aGVuIHVzaW5nIG5lZ2F0aW9uIG9mIHRoZSB2YWx1ZSByZXR1cm5lZCBieSB0aGlzIG1ldGhvZCwgYmVjYXVzZSB0aGUgbmVnYXRpb24gd2lsbCBhbHNvXG5cdCAqIGJlIGB0cnVlYCBpZiBwb3NpdGlvbnMgYXJlIGluIGRpZmZlcmVudCByb290cyBhbmQgeW91IG1pZ2h0IG5vdCBleHBlY3QgdGhpcy4gWW91IHNob3VsZCBwcm9iYWJseSB1c2Vcblx0ICogYGEuaXNBZnRlciggYiApIHx8IGEuaXNFcXVhbCggYiApYCBvciBgIWEuaXNCZWZvcmUoIHAgKSAmJiBhLnJvb3QgPT0gYi5yb290YCBpbiBtb3N0IHNjZW5hcmlvcy4gSWYgeW91clxuXHQgKiBjb25kaXRpb24gdXNlcyBtdWx0aXBsZSBgaXNBZnRlcmAgYW5kIGBpc0JlZm9yZWAgY2hlY2tzLCBidWlsZCB0aGVtIHNvIHRoZXkgZG8gbm90IHVzZSBuZWdhdGVkIHZhbHVlcywgaS5lLjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogaWYgKCBhLmlzQmVmb3JlKCBiICkgJiYgYy5pc0FmdGVyKCBkICkgKSB7XG5cdCAqIFx0Ly8gZG8gQS5cblx0ICogfSBlbHNlIHtcblx0ICogXHQvLyBkbyBCLlxuXHQgKiB9XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBvciwgaWYgeW91IGhhdmUgb25seSBvbmUgaWYtYnJhbmNoOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBpZiAoICEoIGEuaXNCZWZvcmUoIGIgKSAmJiBjLmlzQWZ0ZXIoIGQgKSApIHtcblx0ICogXHQvLyBkbyBCLlxuXHQgKiB9XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiByYXRoZXIgdGhhbjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogaWYgKCAhYS5pc0JlZm9yZSggYiApIHx8ICYmICFjLmlzQWZ0ZXIoIGQgKSApIHtcblx0ICogXHQvLyBkbyBCLlxuXHQgKiB9IGVsc2Uge1xuXHQgKiBcdC8vIGRvIEEuXG5cdCAqIH1cblx0ICogYGBgXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIHNhZmUgdG8gdXNlIGl0IG9uIG5vbi1leGlzdGluZyBwb3NpdGlvbnMgKGZvciBleGFtcGxlIGR1cmluZyBvcGVyYXRpb25hbCB0cmFuc2Zvcm1hdGlvbikuXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclBvc2l0aW9uIFBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgVHJ1ZSBpZiB0aGlzIHBvc2l0aW9uIGlzIGJlZm9yZSBnaXZlbiBwb3NpdGlvbi5cblx0ICovIGlzQmVmb3JlKG90aGVyUG9zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZVdpdGgob3RoZXJQb3NpdGlvbikgPT0gJ2JlZm9yZSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHBvc2l0aW9uIGlzIGVxdWFsIHRvIGdpdmVuIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyBzYWZlIHRvIHVzZSBpdCBvbiBub24tZXhpc3RpbmcgcG9zaXRpb25zIChmb3IgZXhhbXBsZSBkdXJpbmcgb3BlcmF0aW9uYWwgdHJhbnNmb3JtYXRpb24pLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJQb3NpdGlvbiBQb3NpdGlvbiB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIFRydWUgaWYgcG9zaXRpb25zIGFyZSBzYW1lLlxuXHQgKi8gaXNFcXVhbChvdGhlclBvc2l0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVXaXRoKG90aGVyUG9zaXRpb24pID09ICdzYW1lJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoaXMgcG9zaXRpb24gaXMgdG91Y2hpbmcgZ2l2ZW4gcG9zaXRpb24uIFBvc2l0aW9ucyB0b3VjaCB3aGVuIHRoZXJlIGFyZSBubyB0ZXh0IG5vZGVzXG5cdCAqIG9yIGVtcHR5IG5vZGVzIGluIGEgcmFuZ2UgYmV0d2VlbiB0aGVtLiBUZWNobmljYWxseSwgdGhvc2UgcG9zaXRpb25zIGFyZSBub3QgZXF1YWwgYnV0IGluIG1hbnkgY2FzZXNcblx0ICogdGhleSBhcmUgdmVyeSBzaW1pbGFyIG9yIGV2ZW4gaW5kaXN0aW5ndWlzaGFibGUuXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclBvc2l0aW9uIFBvc2l0aW9uIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgVHJ1ZSBpZiBwb3NpdGlvbnMgdG91Y2guXG5cdCAqLyBpc1RvdWNoaW5nKG90aGVyUG9zaXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMucm9vdCAhPT0gb3RoZXJQb3NpdGlvbi5yb290KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29tbW9uTGV2ZWwgPSBNYXRoLm1pbih0aGlzLnBhdGgubGVuZ3RoLCBvdGhlclBvc2l0aW9uLnBhdGgubGVuZ3RoKTtcbiAgICAgICAgZm9yKGxldCBsZXZlbCA9IDA7IGxldmVsIDwgY29tbW9uTGV2ZWw7IGxldmVsKyspe1xuICAgICAgICAgICAgY29uc3QgZGlmZiA9IHRoaXMucGF0aFtsZXZlbF0gLSBvdGhlclBvc2l0aW9uLnBhdGhbbGV2ZWxdO1xuICAgICAgICAgICAgLy8gUG9zaXRpb25zIGFyZSBzcHJlYWQgYnkgYSBub2RlLCBzbyB0aGV5IGFyZSBub3QgdG91Y2hpbmcuXG4gICAgICAgICAgICBpZiAoZGlmZiA8IC0xIHx8IGRpZmYgPiAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkaWZmID09PSAxKSB7XG4gICAgICAgICAgICAgICAgLy8gYG90aGVyUG9zaXRpb25gIGlzIG9uIHRoZSBsZWZ0LlxuICAgICAgICAgICAgICAgIC8vIGB0aGlzYCBpcyBvbiB0aGUgcmlnaHQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrVG91Y2hpbmdCcmFuY2gob3RoZXJQb3NpdGlvbiwgdGhpcywgbGV2ZWwpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkaWZmID09PSAtMSkge1xuICAgICAgICAgICAgICAgIC8vIGB0aGlzYCBpcyBvbiB0aGUgbGVmdC5cbiAgICAgICAgICAgICAgICAvLyBgb3RoZXJQb3NpdGlvbmAgaXMgb24gdGhlIHJpZ2h0LlxuICAgICAgICAgICAgICAgIHJldHVybiBjaGVja1RvdWNoaW5nQnJhbmNoKHRoaXMsIG90aGVyUG9zaXRpb24sIGxldmVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgLy8gYGRpZmYgPT09IDBgLlxuICAgICAgICAvLyBQb3NpdGlvbnMgYXJlIGluc2lkZSB0aGUgc2FtZSBlbGVtZW50IG9uIHRoaXMgbGV2ZWwsIGNvbXBhcmUgZGVlcGVyLlxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGVuZGVkIHVwIGhlcmUsIGl0IG1lYW5zIHRoYXQgcG9zaXRpb25zIHBhdGhzIGhhdmUgdGhlIHNhbWUgYmVnaW5uaW5nLlxuICAgICAgICAvLyBJZiB0aGUgcGF0aHMgaGF2ZSB0aGUgc2FtZSBsZW5ndGgsIHRoZW4gaXQgbWVhbnMgdGhhdCB0aGV5IGFyZSBpZGVudGljYWwsIHNvIHRoZSBwb3NpdGlvbnMgYXJlIHNhbWUuXG4gICAgICAgIGlmICh0aGlzLnBhdGgubGVuZ3RoID09PSBvdGhlclBvc2l0aW9uLnBhdGgubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhdGgubGVuZ3RoID4gb3RoZXJQb3NpdGlvbi5wYXRoLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGNoZWNrT25seVplcm9lcyh0aGlzLnBhdGgsIGNvbW1vbkxldmVsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjaGVja09ubHlaZXJvZXMob3RoZXJQb3NpdGlvbi5wYXRoLCBjb21tb25MZXZlbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0d28gcG9zaXRpb25zIGFyZSBpbiB0aGUgc2FtZSBwYXJlbnQuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIHNhZmUgdG8gdXNlIGl0IG9uIG5vbi1leGlzdGluZyBwb3NpdGlvbnMgKGZvciBleGFtcGxlIGR1cmluZyBvcGVyYXRpb25hbCB0cmFuc2Zvcm1hdGlvbikuXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBwb3NpdGlvbnMgaGF2ZSB0aGUgc2FtZSBwYXJlbnQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gaGFzU2FtZVBhcmVudEFzKHBvc2l0aW9uKSB7XG4gICAgICAgIGlmICh0aGlzLnJvb3QgIT09IHBvc2l0aW9uLnJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0aGlzUGFyZW50UGF0aCA9IHRoaXMuZ2V0UGFyZW50UGF0aCgpO1xuICAgICAgICBjb25zdCBwb3NQYXJlbnRQYXRoID0gcG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpO1xuICAgICAgICByZXR1cm4gY29tcGFyZUFycmF5cyh0aGlzUGFyZW50UGF0aCwgcG9zUGFyZW50UGF0aCkgPT0gJ3NhbWUnO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBwb3NpdGlvbiB0aGF0IGlzIHRyYW5zZm9ybWVkIGJ5IGdpdmVuIGBvcGVyYXRpb25gLlxuXHQgKlxuXHQgKiBUaGUgbmV3IHBvc2l0aW9uJ3MgcGFyYW1ldGVycyBhcmUgdXBkYXRlZCBhY2NvcmRpbmdseSB0byB0aGUgZWZmZWN0IG9mIHRoZSBgb3BlcmF0aW9uYC5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUsIGlmIGBuYCBub2RlcyBhcmUgaW5zZXJ0ZWQgYmVmb3JlIHRoZSBwb3NpdGlvbiwgdGhlIHJldHVybmVkIHBvc2l0aW9uIHtAbGluayB+UG9zaXRpb24jb2Zmc2V0fSB3aWxsIGJlXG5cdCAqIGluY3JlYXNlZCBieSBgbmAuIElmIHRoZSBwb3NpdGlvbiB3YXMgaW4gYSBtZXJnZWQgZWxlbWVudCwgaXQgd2lsbCBiZSBhY2NvcmRpbmdseSBtb3ZlZCB0byB0aGUgbmV3IGVsZW1lbnQsIGV0Yy5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgc2FmZSB0byB1c2UgaXQgb24gbm9uLWV4aXN0aW5nIHBvc2l0aW9ucyAoZm9yIGV4YW1wbGUgZHVyaW5nIG9wZXJhdGlvbmFsIHRyYW5zZm9ybWF0aW9uKS5cblx0ICpcblx0ICogQHBhcmFtIG9wZXJhdGlvbiBPcGVyYXRpb24gdG8gdHJhbnNmb3JtIGJ5LlxuXHQgKiBAcmV0dXJucyBUcmFuc2Zvcm1lZCBwb3NpdGlvbi5cblx0ICovIGdldFRyYW5zZm9ybWVkQnlPcGVyYXRpb24ob3BlcmF0aW9uKSB7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIHN3aXRjaChvcGVyYXRpb24udHlwZSl7XG4gICAgICAgICAgICBjYXNlICdpbnNlcnQnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21vdmUnOlxuICAgICAgICAgICAgY2FzZSAncmVtb3ZlJzpcbiAgICAgICAgICAgIGNhc2UgJ3JlaW5zZXJ0JzpcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3BsaXQnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWVyZ2UnOlxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBQb3NpdGlvbi5fY3JlYXRlQXQodGhpcyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBjb3B5IG9mIHRoaXMgcG9zaXRpb24gdHJhbnNmb3JtZWQgYnkgYW4gaW5zZXJ0IG9wZXJhdGlvbi5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24ob3BlcmF0aW9uLnBvc2l0aW9uLCBvcGVyYXRpb24uaG93TWFueSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgY29weSBvZiB0aGlzIHBvc2l0aW9uIHRyYW5zZm9ybWVkIGJ5IGEgbW92ZSBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKG9wZXJhdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUob3BlcmF0aW9uLnNvdXJjZVBvc2l0aW9uLCBvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24sIG9wZXJhdGlvbi5ob3dNYW55KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBjb3B5IG9mIHRoaXMgcG9zaXRpb24gdHJhbnNmb3JtZWQgYnkgYSBzcGxpdCBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgY29uc3QgbW92ZWRSYW5nZSA9IG9wZXJhdGlvbi5tb3ZlZFJhbmdlO1xuICAgICAgICBjb25zdCBpc0NvbnRhaW5lZCA9IG1vdmVkUmFuZ2UuY29udGFpbnNQb3NpdGlvbih0aGlzKSB8fCBtb3ZlZFJhbmdlLnN0YXJ0LmlzRXF1YWwodGhpcykgJiYgdGhpcy5zdGlja2luZXNzID09ICd0b05leHQnO1xuICAgICAgICBpZiAoaXNDb250YWluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRDb21iaW5lZChvcGVyYXRpb24uc3BsaXRQb3NpdGlvbiwgb3BlcmF0aW9uLm1vdmVUYXJnZXRQb3NpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob3BlcmF0aW9uLmdyYXZleWFyZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKG9wZXJhdGlvbi5ncmF2ZXlhcmRQb3NpdGlvbiwgb3BlcmF0aW9uLmluc2VydGlvblBvc2l0aW9uLCAxKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24ob3BlcmF0aW9uLmluc2VydGlvblBvc2l0aW9uLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBwb3NpdGlvbiB0cmFuc2Zvcm1lZCBieSBtZXJnZSBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgY29uc3QgbW92ZWRSYW5nZSA9IG9wZXJhdGlvbi5tb3ZlZFJhbmdlO1xuICAgICAgICBjb25zdCBpc0NvbnRhaW5lZCA9IG1vdmVkUmFuZ2UuY29udGFpbnNQb3NpdGlvbih0aGlzKSB8fCBtb3ZlZFJhbmdlLnN0YXJ0LmlzRXF1YWwodGhpcyk7XG4gICAgICAgIGxldCBwb3M7XG4gICAgICAgIGlmIChpc0NvbnRhaW5lZCkge1xuICAgICAgICAgICAgcG9zID0gdGhpcy5fZ2V0Q29tYmluZWQob3BlcmF0aW9uLnNvdXJjZVBvc2l0aW9uLCBvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24pO1xuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbi5pc0JlZm9yZShvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgLy8gQWJvdmUgaGFwcGVucyBkdXJpbmcgT1Qgd2hlbiB0aGUgbWVyZ2VkIGVsZW1lbnQgaXMgbW92ZWQgYmVmb3JlIHRoZSBtZXJnZWQtdG8gZWxlbWVudC5cbiAgICAgICAgICAgICAgICBwb3MgPSBwb3MuX2dldFRyYW5zZm9ybWVkQnlEZWxldGlvbihvcGVyYXRpb24uZGVsZXRpb25Qb3NpdGlvbiwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0VxdWFsKG9wZXJhdGlvbi5kZWxldGlvblBvc2l0aW9uKSkge1xuICAgICAgICAgICAgcG9zID0gUG9zaXRpb24uX2NyZWF0ZUF0KG9wZXJhdGlvbi5kZWxldGlvblBvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBvcyA9IHRoaXMuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKG9wZXJhdGlvbi5kZWxldGlvblBvc2l0aW9uLCBvcGVyYXRpb24uZ3JhdmV5YXJkUG9zaXRpb24sIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwb3M7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgY29weSBvZiB0aGlzIHBvc2l0aW9uIHRoYXQgaXMgdXBkYXRlZCBieSByZW1vdmluZyBgaG93TWFueWAgbm9kZXMgc3RhcnRpbmcgZnJvbSBgZGVsZXRlUG9zaXRpb25gLlxuXHQgKiBJdCBtYXkgaGFwcGVuIHRoYXQgdGhpcyBwb3NpdGlvbiBpcyBpbiBhIHJlbW92ZWQgbm9kZS4gSWYgdGhhdCBpcyB0aGUgY2FzZSwgYG51bGxgIGlzIHJldHVybmVkIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZGVsZXRlUG9zaXRpb24gUG9zaXRpb24gYmVmb3JlIHRoZSBmaXJzdCByZW1vdmVkIG5vZGUuXG5cdCAqIEBwYXJhbSBob3dNYW55IEhvdyBtYW55IG5vZGVzIGFyZSByZW1vdmVkLlxuXHQgKiBAcmV0dXJucyBUcmFuc2Zvcm1lZCBwb3NpdGlvbiBvciBgbnVsbGAuXG5cdCAqLyBfZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKGRlbGV0ZVBvc2l0aW9uLCBob3dNYW55KSB7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gUG9zaXRpb24uX2NyZWF0ZUF0KHRoaXMpO1xuICAgICAgICAvLyBUaGlzIHBvc2l0aW9uIGNhbid0IGJlIGFmZmVjdGVkIGlmIGRlbGV0aW9uIHdhcyBpbiBhIGRpZmZlcmVudCByb290LlxuICAgICAgICBpZiAodGhpcy5yb290ICE9IGRlbGV0ZVBvc2l0aW9uLnJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tcGFyZUFycmF5cyhkZWxldGVQb3NpdGlvbi5nZXRQYXJlbnRQYXRoKCksIHRoaXMuZ2V0UGFyZW50UGF0aCgpKSA9PSAnc2FtZScpIHtcbiAgICAgICAgICAgIC8vIElmIG5vZGVzIGFyZSByZW1vdmVkIGZyb20gdGhlIG5vZGUgdGhhdCBpcyBwb2ludGVkIGJ5IHRoaXMgcG9zaXRpb24uLi5cbiAgICAgICAgICAgIGlmIChkZWxldGVQb3NpdGlvbi5vZmZzZXQgPCB0aGlzLm9mZnNldCkge1xuICAgICAgICAgICAgICAgIC8vIEFuZCBhcmUgcmVtb3ZlZCBmcm9tIGJlZm9yZSBhbiBvZmZzZXQgb2YgdGhhdCBwb3NpdGlvbi4uLlxuICAgICAgICAgICAgICAgIGlmIChkZWxldGVQb3NpdGlvbi5vZmZzZXQgKyBob3dNYW55ID4gdGhpcy5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUG9zaXRpb24gaXMgaW4gcmVtb3ZlZCByYW5nZSwgaXQncyBubyBsb25nZXIgaW4gdGhlIHRyZWUuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERlY3JlbWVudCB0aGUgb2Zmc2V0IGFjY29yZGluZ2x5LlxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZC5vZmZzZXQgLT0gaG93TWFueTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoY29tcGFyZUFycmF5cyhkZWxldGVQb3NpdGlvbi5nZXRQYXJlbnRQYXRoKCksIHRoaXMuZ2V0UGFyZW50UGF0aCgpKSA9PSAncHJlZml4Jykge1xuICAgICAgICAgICAgLy8gSWYgbm9kZXMgYXJlIHJlbW92ZWQgZnJvbSBhIG5vZGUgdGhhdCBpcyBvbiBhIHBhdGggdG8gdGhpcyBwb3NpdGlvbi4uLlxuICAgICAgICAgICAgY29uc3QgaSA9IGRlbGV0ZVBvc2l0aW9uLnBhdGgubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGlmIChkZWxldGVQb3NpdGlvbi5vZmZzZXQgPD0gdGhpcy5wYXRoW2ldKSB7XG4gICAgICAgICAgICAgICAgLy8gQW5kIGFyZSByZW1vdmVkIGZyb20gYmVmb3JlIG5leHQgbm9kZSBvZiB0aGF0IHBhdGguLi5cbiAgICAgICAgICAgICAgICBpZiAoZGVsZXRlUG9zaXRpb24ub2Zmc2V0ICsgaG93TWFueSA+IHRoaXMucGF0aFtpXSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCBub2RlIG9mIHRoYXQgcGF0aCBpcyByZW1vdmVkIHJldHVybiBudWxsXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlIG5vZGUgY29udGFpbmluZyB0aGlzIHBvc2l0aW9uIGdvdCByZW1vdmVkLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGRlY3JlbWVudCBpbmRleCBvbiB0aGF0IHBhdGguXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkLnBhdGhbaV0gLT0gaG93TWFueTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyBwb3NpdGlvbiB0aGF0IGlzIHVwZGF0ZWQgYnkgaW5zZXJ0aW5nIGBob3dNYW55YCBub2RlcyBhdCBgaW5zZXJ0UG9zaXRpb25gLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGluc2VydFBvc2l0aW9uIFBvc2l0aW9uIHdoZXJlIG5vZGVzIGFyZSBpbnNlcnRlZC5cblx0ICogQHBhcmFtIGhvd01hbnkgSG93IG1hbnkgbm9kZXMgYXJlIGluc2VydGVkLlxuXHQgKiBAcmV0dXJucyBUcmFuc2Zvcm1lZCBwb3NpdGlvbi5cblx0ICovIF9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0aW9uKGluc2VydFBvc2l0aW9uLCBob3dNYW55KSB7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gUG9zaXRpb24uX2NyZWF0ZUF0KHRoaXMpO1xuICAgICAgICAvLyBUaGlzIHBvc2l0aW9uIGNhbid0IGJlIGFmZmVjdGVkIGlmIGluc2VydGlvbiB3YXMgaW4gYSBkaWZmZXJlbnQgcm9vdC5cbiAgICAgICAgaWYgKHRoaXMucm9vdCAhPSBpbnNlcnRQb3NpdGlvbi5yb290KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbXBhcmVBcnJheXMoaW5zZXJ0UG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpLCB0aGlzLmdldFBhcmVudFBhdGgoKSkgPT0gJ3NhbWUnKSB7XG4gICAgICAgICAgICAvLyBJZiBub2RlcyBhcmUgaW5zZXJ0ZWQgaW4gdGhlIG5vZGUgdGhhdCBpcyBwb2ludGVkIGJ5IHRoaXMgcG9zaXRpb24uLi5cbiAgICAgICAgICAgIGlmIChpbnNlcnRQb3NpdGlvbi5vZmZzZXQgPCB0aGlzLm9mZnNldCB8fCBpbnNlcnRQb3NpdGlvbi5vZmZzZXQgPT0gdGhpcy5vZmZzZXQgJiYgdGhpcy5zdGlja2luZXNzICE9ICd0b1ByZXZpb3VzJykge1xuICAgICAgICAgICAgICAgIC8vIEFuZCBhcmUgaW5zZXJ0ZWQgYmVmb3JlIGFuIG9mZnNldCBvZiB0aGF0IHBvc2l0aW9uLi4uXG4gICAgICAgICAgICAgICAgLy8gXCJQdXNoXCIgdGhpcyBwb3NpdGlvbnMgb2Zmc2V0LlxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkLm9mZnNldCArPSBob3dNYW55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVBcnJheXMoaW5zZXJ0UG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpLCB0aGlzLmdldFBhcmVudFBhdGgoKSkgPT0gJ3ByZWZpeCcpIHtcbiAgICAgICAgICAgIC8vIElmIG5vZGVzIGFyZSBpbnNlcnRlZCBpbiBhIG5vZGUgdGhhdCBpcyBvbiBhIHBhdGggdG8gdGhpcyBwb3NpdGlvbi4uLlxuICAgICAgICAgICAgY29uc3QgaSA9IGluc2VydFBvc2l0aW9uLnBhdGgubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGlmIChpbnNlcnRQb3NpdGlvbi5vZmZzZXQgPD0gdGhpcy5wYXRoW2ldKSB7XG4gICAgICAgICAgICAgICAgLy8gQW5kIGFyZSBpbnNlcnRlZCBiZWZvcmUgbmV4dCBub2RlIG9mIHRoYXQgcGF0aC4uLlxuICAgICAgICAgICAgICAgIC8vIFwiUHVzaFwiIHRoZSBpbmRleCBvbiB0aGF0IHBhdGguXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtZWQucGF0aFtpXSArPSBob3dNYW55O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBjb3B5IG9mIHRoaXMgcG9zaXRpb24gdGhhdCBpcyB1cGRhdGVkIGJ5IG1vdmluZyBgaG93TWFueWAgbm9kZXMgZnJvbSBgc291cmNlUG9zaXRpb25gIHRvIGB0YXJnZXRQb3NpdGlvbmAuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gc291cmNlUG9zaXRpb24gUG9zaXRpb24gYmVmb3JlIHRoZSBmaXJzdCBlbGVtZW50IHRvIG1vdmUuXG5cdCAqIEBwYXJhbSB0YXJnZXRQb3NpdGlvbiBQb3NpdGlvbiB3aGVyZSBtb3ZlZCBlbGVtZW50cyB3aWxsIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gaG93TWFueSBIb3cgbWFueSBjb25zZWN1dGl2ZSBub2RlcyB0byBtb3ZlLCBzdGFydGluZyBmcm9tIGBzb3VyY2VQb3NpdGlvbmAuXG5cdCAqIEByZXR1cm5zIFRyYW5zZm9ybWVkIHBvc2l0aW9uLlxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlNb3ZlKHNvdXJjZVBvc2l0aW9uLCB0YXJnZXRQb3NpdGlvbiwgaG93TWFueSkge1xuICAgICAgICAvLyBVcGRhdGUgdGFyZ2V0IHBvc2l0aW9uLCBhcyBpdCBjb3VsZCBiZSBhZmZlY3RlZCBieSBub2RlcyByZW1vdmFsLlxuICAgICAgICB0YXJnZXRQb3NpdGlvbiA9IHRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oc291cmNlUG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICBpZiAoc291cmNlUG9zaXRpb24uaXNFcXVhbCh0YXJnZXRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIC8vIElmIGB0YXJnZXRQb3NpdGlvbmAgaXMgZXF1YWwgdG8gYHNvdXJjZVBvc2l0aW9uYCB0aGlzIGlzbid0IHJlYWxseSBhbnkgbW92ZS4gSnVzdCByZXR1cm4gcG9zaXRpb24gYXMgaXQgaXMuXG4gICAgICAgICAgICByZXR1cm4gUG9zaXRpb24uX2NyZWF0ZUF0KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE1vdmluZyBhIHJhbmdlIHJlbW92ZXMgbm9kZXMgZnJvbSB0aGVpciBvcmlnaW5hbCBwb3NpdGlvbi4gV2UgYWNrbm93bGVkZ2UgdGhpcyBieSBwcm9wZXIgdHJhbnNmb3JtYXRpb24uXG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gdGhpcy5fZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKHNvdXJjZVBvc2l0aW9uLCBob3dNYW55KTtcbiAgICAgICAgY29uc3QgaXNNb3ZlZCA9IHRyYW5zZm9ybWVkID09PSBudWxsIHx8IHNvdXJjZVBvc2l0aW9uLmlzRXF1YWwodGhpcykgJiYgdGhpcy5zdGlja2luZXNzID09ICd0b05leHQnIHx8IHNvdXJjZVBvc2l0aW9uLmdldFNoaWZ0ZWRCeShob3dNYW55KS5pc0VxdWFsKHRoaXMpICYmIHRoaXMuc3RpY2tpbmVzcyA9PSAndG9QcmV2aW91cyc7XG4gICAgICAgIGlmIChpc01vdmVkKSB7XG4gICAgICAgICAgICAvLyBUaGlzIHBvc2l0aW9uIGlzIGluc2lkZSBtb3ZlZCByYW5nZSAob3Igc3RpY2tzIHRvIGl0KS5cbiAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSwgd2UgY2FsY3VsYXRlIGEgY29tYmluYXRpb24gb2YgdGhpcyBwb3NpdGlvbiwgbW92ZSBzb3VyY2UgcG9zaXRpb24gYW5kIHRhcmdldCBwb3NpdGlvbi5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRDb21iaW5lZChzb3VyY2VQb3NpdGlvbiwgdGFyZ2V0UG9zaXRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVGhpcyBwb3NpdGlvbiBpcyBub3QgaW5zaWRlIGEgcmVtb3ZlZCByYW5nZS5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBJbiBuZXh0IHN0ZXAsIHdlIHNpbXBseSByZWZsZWN0IGluc2VydGluZyBgaG93TWFueWAgbm9kZXMsIHdoaWNoIG1pZ2h0IGZ1cnRoZXIgYWZmZWN0IHRoZSBwb3NpdGlvbi5cbiAgICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1lZC5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbih0YXJnZXRQb3NpdGlvbiwgaG93TWFueSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBuZXcgcG9zaXRpb24gdGhhdCBpcyBhIGNvbWJpbmF0aW9uIG9mIHRoaXMgcG9zaXRpb24gYW5kIGdpdmVuIHBvc2l0aW9ucy5cblx0ICpcblx0ICogVGhlIGNvbWJpbmVkIHBvc2l0aW9uIGlzIGEgY29weSBvZiB0aGlzIHBvc2l0aW9uIHRyYW5zZm9ybWVkIGJ5IG1vdmluZyBhIHJhbmdlIHN0YXJ0aW5nIGF0IGBzb3VyY2VgIHBvc2l0aW9uXG5cdCAqIHRvIHRoZSBgdGFyZ2V0YCBwb3NpdGlvbi4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIHBvc2l0aW9uIGlzIGluc2lkZSB0aGUgbW92ZWQgcmFuZ2UuXG5cdCAqXG5cdCAqIEV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGxldCBvcmlnaW5hbCA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMiwgMywgMSBdICk7XG5cdCAqIGxldCBzb3VyY2UgPSBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDIsIDIgXSApO1xuXHQgKiBsZXQgdGFyZ2V0ID0gbW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggb3RoZXJSb290LCBbIDEsIDEsIDMgXSApO1xuXHQgKiBvcmlnaW5hbC5fZ2V0Q29tYmluZWQoIHNvdXJjZSwgdGFyZ2V0ICk7IC8vIHBhdGggaXMgWyAxLCAxLCA0LCAxIF0sIHJvb3QgaXMgYG90aGVyUm9vdGBcblx0ICogYGBgXG5cdCAqXG5cdCAqIEV4cGxhbmF0aW9uOlxuXHQgKlxuXHQgKiBXZSBoYXZlIGEgcG9zaXRpb24gYFsgMiwgMywgMSBdYCBhbmQgbW92ZSBzb21lIG5vZGVzIGZyb20gYFsgMiwgMiBdYCB0byBgWyAxLCAxLCAzIF1gLiBUaGUgb3JpZ2luYWwgcG9zaXRpb25cblx0ICogd2FzIGluc2lkZSBtb3ZlZCBub2RlcyBhbmQgbm93IHNob3VsZCBwb2ludCB0byB0aGUgbmV3IHBsYWNlLiBUaGUgbW92ZWQgbm9kZXMgd2lsbCBiZSBhZnRlclxuXHQgKiBwb3NpdGlvbnMgYFsgMSwgMSwgMyBdYCwgYFsgMSwgMSwgNCBdYCwgYFsgMSwgMSwgNSBdYC4gU2luY2Ugb3VyIHBvc2l0aW9uIHdhcyBpbiB0aGUgc2Vjb25kIG1vdmVkIG5vZGUsXG5cdCAqIHRoZSB0cmFuc2Zvcm1lZCBwb3NpdGlvbiB3aWxsIGJlIGluIGEgc3ViLXRyZWUgb2YgYSBub2RlIGF0IGBbIDEsIDEsIDQgXWAuIExvb2tpbmcgYXQgb3JpZ2luYWwgcGF0aCwgd2Vcblx0ICogdG9vayBjYXJlIG9mIGBbIDIsIDMgXWAgcGFydCBvZiBpdC4gTm93IHdlIGhhdmUgdG8gYWRkIHRoZSByZXN0IG9mIHRoZSBvcmlnaW5hbCBwYXRoIHRvIHRoZSB0cmFuc2Zvcm1lZCBwYXRoLlxuXHQgKiBGaW5hbGx5LCB0aGUgdHJhbnNmb3JtZWQgcG9zaXRpb24gd2lsbCBwb2ludCB0byBgWyAxLCAxLCA0LCAxIF1gLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHNvdXJjZSBCZWdpbm5pbmcgb2YgdGhlIG1vdmVkIHJhbmdlLlxuXHQgKiBAcGFyYW0gdGFyZ2V0IFBvc2l0aW9uIHdoZXJlIHRoZSByYW5nZSBpcyBtb3ZlZC5cblx0ICogQHJldHVybnMgQ29tYmluZWQgcG9zaXRpb24uXG5cdCAqLyBfZ2V0Q29tYmluZWQoc291cmNlLCB0YXJnZXQpIHtcbiAgICAgICAgY29uc3QgaSA9IHNvdXJjZS5wYXRoLmxlbmd0aCAtIDE7XG4gICAgICAgIC8vIFRoZSBmaXJzdCBwYXJ0IG9mIGEgcGF0aCB0byBjb21iaW5lZCBwb3NpdGlvbiBpcyBhIHBhdGggdG8gdGhlIHBsYWNlIHdoZXJlIG5vZGVzIHdlcmUgbW92ZWQuXG4gICAgICAgIGNvbnN0IGNvbWJpbmVkID0gUG9zaXRpb24uX2NyZWF0ZUF0KHRhcmdldCk7XG4gICAgICAgIGNvbWJpbmVkLnN0aWNraW5lc3MgPSB0aGlzLnN0aWNraW5lc3M7XG4gICAgICAgIC8vIFRoZW4gd2UgaGF2ZSB0byB1cGRhdGUgdGhlIHJlc3Qgb2YgdGhlIHBhdGguXG4gICAgICAgIC8vIEZpeCB0aGUgb2Zmc2V0IGJlY2F1c2UgdGhpcyBwb3NpdGlvbiBtaWdodCBiZSBhZnRlciBgZnJvbWAgcG9zaXRpb24gYW5kIHdlIGhhdmUgdG8gcmVmbGVjdCB0aGF0LlxuICAgICAgICBjb21iaW5lZC5vZmZzZXQgPSBjb21iaW5lZC5vZmZzZXQgKyB0aGlzLnBhdGhbaV0gLSBzb3VyY2Uub2Zmc2V0O1xuICAgICAgICAvLyBUaGVuLCBhZGQgdGhlIHJlc3Qgb2YgdGhlIHBhdGguXG4gICAgICAgIC8vIElmIHRoaXMgcG9zaXRpb24gaXMgYXQgdGhlIHNhbWUgbGV2ZWwgYXMgYGZyb21gIHBvc2l0aW9uIG5vdGhpbmcgd2lsbCBnZXQgYWRkZWQuXG4gICAgICAgIGNvbWJpbmVkLnBhdGggPSBbXG4gICAgICAgICAgICAuLi5jb21iaW5lZC5wYXRoLFxuICAgICAgICAgICAgLi4udGhpcy5wYXRoLnNsaWNlKGkgKyAxKVxuICAgICAgICBdO1xuICAgICAgICByZXR1cm4gY29tYmluZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm9vdDogdGhpcy5yb290LnRvSlNPTigpLFxuICAgICAgICAgICAgcGF0aDogQXJyYXkuZnJvbSh0aGlzLnBhdGgpLFxuICAgICAgICAgICAgc3RpY2tpbmVzczogdGhpcy5zdGlja2luZXNzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgbmV3IHBvc2l0aW9uIHRoYXQgaXMgZXF1YWwgdG8gY3VycmVudCBwb3NpdGlvbi5cblx0ICovIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5yb290LCB0aGlzLnBhdGgsIHRoaXMuc3RpY2tpbmVzcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIHBvc2l0aW9uIGF0IHRoZSBnaXZlbiBsb2NhdGlvbi4gVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgYXM6XG5cdCAqXG5cdCAqICogYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbn0sXG5cdCAqICogcGFyZW50IGVsZW1lbnQgYW5kIG9mZnNldCAob2Zmc2V0IGRlZmF1bHRzIHRvIGAwYCksXG5cdCAqICogcGFyZW50IGVsZW1lbnQgYW5kIGAnZW5kJ2AgKHNldHMgcG9zaXRpb24gYXQgdGhlIGVuZCBvZiB0aGF0IGVsZW1lbnQpLFxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfSBhbmQgYCdiZWZvcmUnYCBvciBgJ2FmdGVyJ2AgKHNldHMgcG9zaXRpb24gYmVmb3JlIG9yIGFmdGVyIGdpdmVuIG1vZGVsIGl0ZW0pLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyBhIHNob3J0Y3V0IHRvIG90aGVyIGZhY3RvcnkgbWV0aG9kcyBzdWNoIGFzOlxuXHQgKlxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uLl9jcmVhdGVCZWZvcmV9LFxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uLl9jcmVhdGVBZnRlcn0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBvciBvbmUgb2YgdGhlIGZsYWdzLiBVc2VkIG9ubHkgd2hlbiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKiBAcGFyYW0gc3RpY2tpbmVzcyBQb3NpdGlvbiBzdGlja2luZXNzLiBVc2VkIG9ubHkgd2hlbiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gc3RhdGljIF9jcmVhdGVBdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0LCBzdGlja2luZXNzID0gJ3RvTm9uZScpIHtcbiAgICAgICAgaWYgKGl0ZW1PclBvc2l0aW9uLmlzKCdtb2RlbDpwb3NpdGlvbicpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGl0ZW1PclBvc2l0aW9uLnJvb3QsIGl0ZW1PclBvc2l0aW9uLnBhdGgsIGl0ZW1PclBvc2l0aW9uLnN0aWNraW5lc3MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGl0ZW1PclBvc2l0aW9uO1xuICAgICAgICAgICAgaWYgKG9mZnNldCA9PSAnZW5kJykge1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IG5vZGUubWF4T2Zmc2V0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvZmZzZXQgPT0gJ2JlZm9yZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQmVmb3JlKG5vZGUsIHN0aWNraW5lc3MpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChvZmZzZXQgPT0gJ2FmdGVyJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVBZnRlcihub2RlLCBzdGlja2luZXNzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob2Zmc2V0ICE9PSAwICYmICFvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY3JlYXRlUG9zaXRpb25BdCBgTW9kZWwjY3JlYXRlUG9zaXRpb25BdCgpYH1cblx0XHRcdFx0ICogcmVxdWlyZXMgdGhlIG9mZnNldCB0byBiZSBzcGVjaWZpZWQgd2hlbiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGEgbW9kZWwgaXRlbS5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIG1vZGVsLWNyZWF0ZXBvc2l0aW9uYXQtb2Zmc2V0LXJlcXVpcmVkXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtY3JlYXRlcG9zaXRpb25hdC1vZmZzZXQtcmVxdWlyZWQnLCBbXG4gICAgICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1PclBvc2l0aW9uXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW5vZGUuaXMoJ2VsZW1lbnQnKSAmJiAhbm9kZS5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFBvc2l0aW9uIHBhcmVudCBoYXZlIHRvIGJlIGEgbW9kZWwgZWxlbWVudCBvciBtb2RlbCBkb2N1bWVudCBmcmFnbWVudC5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogQGVycm9yIG1vZGVsLXBvc2l0aW9uLXBhcmVudC1pbmNvcnJlY3Rcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1wb3NpdGlvbi1wYXJlbnQtaW5jb3JyZWN0JywgW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgICAgICBpdGVtT3JQb3NpdGlvblxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IG5vZGUuZ2V0UGF0aCgpO1xuICAgICAgICAgICAgcGF0aC5wdXNoKG9mZnNldCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IHRoaXMobm9kZS5yb290LCBwYXRoLCBzdGlja2luZXNzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBwb3NpdGlvbiwgYWZ0ZXIgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSBhZnRlciB3aGljaCB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIHBsYWNlZC5cblx0ICogQHBhcmFtIHN0aWNraW5lc3MgUG9zaXRpb24gc3RpY2tpbmVzcy5cblx0ICovIHN0YXRpYyBfY3JlYXRlQWZ0ZXIoaXRlbSwgc3RpY2tpbmVzcykge1xuICAgICAgICBpZiAoIWl0ZW0ucGFyZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFlvdSBjYW4gbm90IG1ha2UgYSBwb3NpdGlvbiBhZnRlciBhIHJvb3QgZWxlbWVudC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtcG9zaXRpb24tYWZ0ZXItcm9vdFxuXHRcdFx0ICogQHBhcmFtIHJvb3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtcG9zaXRpb24tYWZ0ZXItcm9vdCcsIFtcbiAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgICAgIF0sIHtcbiAgICAgICAgICAgICAgICByb290OiBpdGVtXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQXQoaXRlbS5wYXJlbnQsIGl0ZW0uZW5kT2Zmc2V0LCBzdGlja2luZXNzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgcG9zaXRpb24sIGJlZm9yZSB0aGUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSBiZWZvcmUgd2hpY2ggdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBwbGFjZWQuXG5cdCAqIEBwYXJhbSBzdGlja2luZXNzIFBvc2l0aW9uIHN0aWNraW5lc3MuXG5cdCAqLyBzdGF0aWMgX2NyZWF0ZUJlZm9yZShpdGVtLCBzdGlja2luZXNzKSB7XG4gICAgICAgIGlmICghaXRlbS5wYXJlbnQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogWW91IGNhbiBub3QgbWFrZSBhIHBvc2l0aW9uIGJlZm9yZSBhIHJvb3QgZWxlbWVudC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtcG9zaXRpb24tYmVmb3JlLXJvb3Rcblx0XHRcdCAqIEBwYXJhbSByb290XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXBvc2l0aW9uLWJlZm9yZS1yb290JywgaXRlbSwge1xuICAgICAgICAgICAgICAgIHJvb3Q6IGl0ZW1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVBdChpdGVtLnBhcmVudCwgaXRlbS5zdGFydE9mZnNldCwgc3RpY2tpbmVzcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgYFBvc2l0aW9uYCBpbnN0YW5jZSBmcm9tIGdpdmVuIHBsYWluIG9iamVjdCAoaS5lLiBwYXJzZWQgSlNPTiBzdHJpbmcpLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBQbGFpbiBvYmplY3QgdG8gYmUgY29udmVydGVkIHRvIGBQb3NpdGlvbmAuXG5cdCAqIEBwYXJhbSBkb2MgRG9jdW1lbnQgb2JqZWN0IHRoYXQgd2lsbCBiZSBwb3NpdGlvbiBvd25lci5cblx0ICogQHJldHVybnMgYFBvc2l0aW9uYCBpbnN0YW5jZSBjcmVhdGVkIHVzaW5nIGdpdmVuIHBsYWluIG9iamVjdC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2MpIHtcbiAgICAgICAgaWYgKGpzb24ucm9vdCA9PT0gJyRncmF2ZXlhcmQnKSB7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBuZXcgUG9zaXRpb24oZG9jLmdyYXZleWFyZCwganNvbi5wYXRoKTtcbiAgICAgICAgICAgIHBvcy5zdGlja2luZXNzID0ganNvbi5zdGlja2luZXNzO1xuICAgICAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRvYy5nZXRSb290KGpzb24ucm9vdCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogQ2Fubm90IGNyZWF0ZSBwb3NpdGlvbiBmb3IgZG9jdW1lbnQuIFJvb3Qgd2l0aCBzcGVjaWZpZWQgbmFtZSBkb2VzIG5vdCBleGlzdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtcG9zaXRpb24tZnJvbWpzb24tbm8tcm9vdFxuXHRcdFx0ICogQHBhcmFtIHJvb3ROYW1lXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXBvc2l0aW9uLWZyb21qc29uLW5vLXJvb3QnLCBkb2MsIHtcbiAgICAgICAgICAgICAgICByb290TmFtZToganNvbi5yb290XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKGRvYy5nZXRSb290KGpzb24ucm9vdCksIGpzb24ucGF0aCwganNvbi5zdGlja2luZXNzKTtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5Qb3NpdGlvbi5wcm90b3R5cGUuaXMgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgPT09ICdwb3NpdGlvbicgfHwgdHlwZSA9PT0gJ21vZGVsOnBvc2l0aW9uJztcbn07XG4vKipcbiAqIFJldHVybnMgYSB0ZXh0IG5vZGUgYXQgdGhlIGdpdmVuIHBvc2l0aW9uLlxuICpcbiAqIFRoaXMgaXMgYSBoZWxwZXIgZnVuY3Rpb24gb3B0aW1pemVkIHRvIHJldXNlIHRoZSBwb3NpdGlvbiBwYXJlbnQgaW5zdGFuY2UgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMuXG4gKlxuICogTm9ybWFsbHksIHlvdSBzaG91bGQgdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3RleHROb2RlIGBQb3NpdGlvbiN0ZXh0Tm9kZWB9LlxuICogSWYgeW91IHN0YXJ0IGhpdHRpbmcgcGVyZm9ybWFuY2UgaXNzdWVzIHdpdGgge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcGFyZW50IGBQb3NpdGlvbiNwYXJlbnRgfVxuICogY2hlY2sgaWYgeW91ciBhbGdvcml0aG0gZG9lcyBub3QgYWNjZXNzIGl0IG11bHRpcGxlIHRpbWVzICh3aGljaCBjYW4gaGFwcGVuIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkgdmlhIG90aGVyIHBvc2l0aW9uIHByb3BlcnRpZXMpLlxuICpcbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy82NTc5LlxuICpcbiAqIFNlZSBhbHNvOlxuICpcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+Z2V0Tm9kZUFmdGVyUG9zaXRpb259XG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9ufmdldE5vZGVCZWZvcmVQb3NpdGlvbn1cbiAqXG4gKiBAcGFyYW0gcG9zaXRpb25cbiAqIEBwYXJhbSBwb3NpdGlvblBhcmVudCBUaGUgcGFyZW50IG9mIHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAqLyBmdW5jdGlvbiBnZXRUZXh0Tm9kZUF0UG9zaXRpb24ocG9zaXRpb24sIHBvc2l0aW9uUGFyZW50KSB7XG4gICAgY29uc3Qgbm9kZSA9IHBvc2l0aW9uUGFyZW50LmdldENoaWxkQXRPZmZzZXQocG9zaXRpb24ub2Zmc2V0KTtcbiAgICBpZiAobm9kZSAmJiBub2RlLmlzKCckdGV4dCcpICYmIG5vZGUuc3RhcnRPZmZzZXQgPCBwb3NpdGlvbi5vZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBub2RlIGFmdGVyIHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAqXG4gKiBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIG9wdGltaXplZCB0byByZXVzZSB0aGUgcG9zaXRpb24gcGFyZW50IGluc3RhbmNlIGFuZCB0aGUgY2FsY3VsYXRpb24gb2YgdGhlIHRleHQgbm9kZSBhdCB0aGVcbiAqIHNwZWNpZmljIHBvc2l0aW9uIGZvciBwZXJmb3JtYW5jZSByZWFzb25zLlxuICpcbiAqIE5vcm1hbGx5LCB5b3Ugc2hvdWxkIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNub2RlQWZ0ZXIgYFBvc2l0aW9uI25vZGVBZnRlcmB9LlxuICogSWYgeW91IHN0YXJ0IGhpdHRpbmcgcGVyZm9ybWFuY2UgaXNzdWVzIHdpdGgge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcGFyZW50IGBQb3NpdGlvbiNwYXJlbnRgfSBhbmQvb3JcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI3RleHROb2RlIGBQb3NpdGlvbiN0ZXh0Tm9kZWB9XG4gKiBjaGVjayBpZiB5b3VyIGFsZ29yaXRobSBkb2VzIG5vdCBhY2Nlc3MgdGhvc2UgcHJvcGVydGllcyBtdWx0aXBsZSB0aW1lc1xuICogKHdoaWNoIGNhbiBoYXBwZW4gZGlyZWN0bHkgb3IgaW5kaXJlY3RseSB2aWEgb3RoZXIgcG9zaXRpb24gcHJvcGVydGllcykuXG4gKlxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzY1NzkgYW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzY1ODIuXG4gKlxuICogU2VlIGFsc286XG4gKlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5nZXRUZXh0Tm9kZUF0UG9zaXRpb259XG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9ufmdldE5vZGVCZWZvcmVQb3NpdGlvbn1cbiAqXG4gKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gdG8gY2hlY2suXG4gKiBAcGFyYW0gcG9zaXRpb25QYXJlbnQgVGhlIHBhcmVudCBvZiB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gKiBAcGFyYW0gdGV4dE5vZGUgVGV4dCBub2RlIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAqLyBmdW5jdGlvbiBnZXROb2RlQWZ0ZXJQb3NpdGlvbihwb3NpdGlvbiwgcG9zaXRpb25QYXJlbnQsIHRleHROb2RlKSB7XG4gICAgaWYgKHRleHROb2RlICE9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb25QYXJlbnQuZ2V0Q2hpbGRBdE9mZnNldChwb3NpdGlvbi5vZmZzZXQpO1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBub2RlIGJlZm9yZSB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gKlxuICogUmVmZXIgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+Z2V0Tm9kZUJlZm9yZVBvc2l0aW9ufSBmb3IgZG9jdW1lbnRhdGlvbiBvbiB3aGVuIHRvIHVzZSB0aGlzIHV0aWwgbWV0aG9kLlxuICpcbiAqIFNlZSBhbHNvOlxuICpcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+Z2V0VGV4dE5vZGVBdFBvc2l0aW9ufVxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5nZXROb2RlQWZ0ZXJQb3NpdGlvbn1cbiAqXG4gKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gdG8gY2hlY2suXG4gKiBAcGFyYW0gcG9zaXRpb25QYXJlbnQgVGhlIHBhcmVudCBvZiB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gKiBAcGFyYW0gdGV4dE5vZGUgVGV4dCBub2RlIGF0IHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAqLyBmdW5jdGlvbiBnZXROb2RlQmVmb3JlUG9zaXRpb24ocG9zaXRpb24sIHBvc2l0aW9uUGFyZW50LCB0ZXh0Tm9kZSkge1xuICAgIGlmICh0ZXh0Tm9kZSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uUGFyZW50LmdldENoaWxkKHBvc2l0aW9uUGFyZW50Lm9mZnNldFRvSW5kZXgocG9zaXRpb24ub2Zmc2V0KSAtIDEpO1xufVxuLyoqXG4gKiBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIGZvciBgUG9zaXRpb24jaXNUb3VjaGluZygpYC5cbiAqXG4gKiBJdCBjaGVja3Mgd2hldGhlciB0byBnaXZlbiBwb3NpdGlvbnMgYXJlIHRvdWNoaW5nLCBjb25zaWRlcmluZyB0aGF0IHRoZXkgaGF2ZSB0aGUgc2FtZSByb290IGFuZCBwYXRoc1xuICogdW50aWwgZ2l2ZW4gbGV2ZWwsIGFuZCBhdCBnaXZlbiBsZXZlbCB0aGV5IGRpZmZlciBieSAxIChzbyB0aGV5IGFyZSBicmFuY2hpbmcgYXQgYGxldmVsYCBwb2ludCkuXG4gKlxuICogVGhlIGV4YWN0IHJlcXVpcmVtZW50cyBmb3IgdG91Y2hpbmcgcG9zaXRpb25zIGFyZSBkZXNjcmliZWQgaW4gYFBvc2l0aW9uI2lzVG91Y2hpbmcoKWAgYW5kIGFsc29cbiAqIGluIHRoZSBib2R5IG9mIHRoaXMgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIGxlZnQgUG9zaXRpb24gXCJvbiB0aGUgbGVmdFwiIChpdCBpcyBiZWZvcmUgYHJpZ2h0YCkuXG4gKiBAcGFyYW0gcmlnaHQgUG9zaXRpb24gXCJvbiB0aGUgcmlnaHRcIiAoaXQgaXMgYWZ0ZXIgYGxlZnRgKS5cbiAqIEBwYXJhbSBsZXZlbCBMZXZlbCBvbiB3aGljaCB0aGUgcG9zaXRpb25zIGFyZSBkaWZmZXJlbnQuXG4gKi8gZnVuY3Rpb24gY2hlY2tUb3VjaGluZ0JyYW5jaChsZWZ0LCByaWdodCwgbGV2ZWwpIHtcbiAgICBpZiAobGV2ZWwgKyAxID09PSBsZWZ0LnBhdGgubGVuZ3RoKSB7XG4gICAgICAgIC8vIExlZnQgcG9zaXRpb24gZG9lcyBub3QgaGF2ZSBhbnkgbW9yZSBlbnRyaWVzIGFmdGVyIHRoZSBwb2ludCB3aGVyZSB0aGUgcG9zaXRpb25zIGRpZmZlci5cbiAgICAgICAgLy8gWyAyIF0gdnMgWyAzIF1cbiAgICAgICAgLy8gWyAyIF0gdnMgWyAzLCAwLCAwIF1cbiAgICAgICAgLy8gVGhlIHBvc2l0aW9ucyBhcmUgc3ByZWFkIGJ5IG5vZGUgYXQgWyAyIF0uXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFjaGVja09ubHlaZXJvZXMocmlnaHQucGF0aCwgbGV2ZWwgKyAxKSkge1xuICAgICAgICAvLyBSaWdodCBwb3NpdGlvbiBkb2VzIG5vdCBoYXZlIG9ubHkgemVyb2VzLCBzbyB3ZSBoYXZlIHNpdHVhdGlvbiBsaWtlOlxuICAgICAgICAvLyBbIDIsIG1heE9mZnNldCBdIHZzIFsgMywgMSBdXG4gICAgICAgIC8vIFsgMiwgbWF4T2Zmc2V0IF0gdnMgWyAzLCAxLCAwLCAwIF1cbiAgICAgICAgLy8gVGhlIHBvc2l0aW9ucyBhcmUgc3ByZWFkIGJ5IG5vZGUgYXQgWyAzLCAwIF0uXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKCFjaGVja09ubHlNYXhPZmZzZXQobGVmdCwgbGV2ZWwgKyAxKSkge1xuICAgICAgICAvLyBMZWZ0IHBvc2l0aW9uIGRvZXMgbm90IGhhdmUgb25seSBtYXggb2Zmc2V0cywgc28gd2UgaGF2ZSBzaXR1YXRpb24gbGlrZTpcbiAgICAgICAgLy8gWyAyLCA0IF0gdnMgWyAzIF1cbiAgICAgICAgLy8gWyAyLCA0IF0gdnMgWyAzLCAwLCAwIF1cbiAgICAgICAgLy8gVGhlIHBvc2l0aW9ucyBhcmUgc3ByZWFkIGJ5IG5vZGUgYXQgWyAyLCA1IF0uXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gTGVmdCBwb3NpdGlvbiBoYXMgb25seSBtYXggb2Zmc2V0cyBhbmQgcmlnaHQgcG9zaXRpb24gaGFzIG9ubHkgemVyb2VzIG9yIG5vdGhpbmcuXG4gICAgLy8gWyAyLCBtYXhPZmZzZXQgXSB2cyBbIDMgXVxuICAgIC8vIFsgMiwgbWF4T2Zmc2V0LCBtYXhPZmZzZXQgXSB2cyBbIDMsIDAgXVxuICAgIC8vIFRoZXJlIGFyZSBub3QgZWxlbWVudHMgYmV0d2VlbiBwb3NpdGlvbnMuIFRoZSBwb3NpdGlvbnMgYXJlIHRvdWNoaW5nLlxuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBmb3IgZ2l2ZW4gYXJyYXksIHN0YXJ0aW5nIGZyb20gZ2l2ZW4gaW5kZXggdW50aWwgdGhlIGVuZCBvZiB0aGUgYXJyYXksIGFsbCBpdGVtcyBhcmUgYDBgcy5cbiAqXG4gKiBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIGZvciBgUG9zaXRpb24jaXNUb3VjaGluZygpYC5cbiAqLyBmdW5jdGlvbiBjaGVja09ubHlaZXJvZXMoYXJyLCBpZHgpIHtcbiAgICB3aGlsZShpZHggPCBhcnIubGVuZ3RoKXtcbiAgICAgICAgaWYgKGFycltpZHhdICE9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWR4Kys7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBmb3IgZ2l2ZW4gcG9zaXRpb24sIHN0YXJ0aW5nIGZyb20gZ2l2ZW4gcGF0aCBsZXZlbCwgd2hldGhlciB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGVuZCBvZlxuICogaXRzIHBhcmVudCBhbmQgd2hldGhlciBlYWNoIGVsZW1lbnQgb24gdGhlIHBhdGggdG8gdGhlIHBvc2l0aW9uIGlzIGFsc28gYXQgYXQgdGhlIGVuZCBvZiBpdHMgcGFyZW50LlxuICpcbiAqIFRoaXMgaXMgYSBoZWxwZXIgZnVuY3Rpb24gZm9yIGBQb3NpdGlvbiNpc1RvdWNoaW5nKClgLlxuICovIGZ1bmN0aW9uIGNoZWNrT25seU1heE9mZnNldChwb3MsIGxldmVsKSB7XG4gICAgbGV0IHBhcmVudCA9IHBvcy5wYXJlbnQ7XG4gICAgbGV0IGlkeCA9IHBvcy5wYXRoLmxlbmd0aCAtIDE7XG4gICAgbGV0IGFkZCA9IDA7XG4gICAgd2hpbGUoaWR4ID49IGxldmVsKXtcbiAgICAgICAgaWYgKHBvcy5wYXRoW2lkeF0gKyBhZGQgIT09IHBhcmVudC5tYXhPZmZzZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBZnRlciB0aGUgZmlyc3QgY2hlY2ssIHdlIFwiZ28gdXBcIiwgYW5kIGNoZWNrIHdoZXRoZXIgdGhlIHBvc2l0aW9uJ3MgcGFyZW50LXBhcmVudCBpcyB0aGUgbGFzdCBlbGVtZW50LlxuICAgICAgICAvLyBIb3dldmVyLCB3ZSBuZWVkIHRvIGFkZCAxIHRvIHRoZSB2YWx1ZSBpbiB0aGUgcGF0aCB0byBcInNpbXVsYXRlXCIgbW92aW5nIHRoZSBwYXRoIGFmdGVyIHRoZSBwYXJlbnQuXG4gICAgICAgIC8vIEl0IGhhcHBlbnMganVzdCBvbmNlLlxuICAgICAgICBhZGQgPSAxO1xuICAgICAgICBpZHgtLTtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHJhbmdlIGluIHRoZSBtb2RlbCB0cmVlLlxuICpcbiAqIEEgcmFuZ2UgaXMgZGVmaW5lZCBieSBpdHMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2Ujc3RhcnR9IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSNlbmR9XG4gKiBwb3NpdGlvbnMuXG4gKlxuICogWW91IGNhbiBjcmVhdGUgcmFuZ2UgaW5zdGFuY2VzIHZpYSBpdHMgY29uc3RydWN0b3Igb3IgdGhlIGBjcmVhdGVSYW5nZSooKWAgZmFjdG9yeSBtZXRob2RzIG9mXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbH0gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXJ9LlxuICovIGNsYXNzIFJhbmdlIGV4dGVuZHMgVHlwZUNoZWNrYWJsZSB7XG4gICAgLyoqXG5cdCAqIFN0YXJ0IHBvc2l0aW9uLlxuXHQgKi8gc3RhcnQ7XG4gICAgLyoqXG5cdCAqIEVuZCBwb3NpdGlvbi5cblx0ICovIGVuZDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHNwYW5uaW5nIGZyb20gYHN0YXJ0YCBwb3NpdGlvbiB0byBgZW5kYCBwb3NpdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHN0YXJ0IFRoZSBzdGFydCBwb3NpdGlvbi5cblx0ICogQHBhcmFtIGVuZCBUaGUgZW5kIHBvc2l0aW9uLiBJZiBub3Qgc2V0LCB0aGUgcmFuZ2Ugd2lsbCBiZSBjb2xsYXBzZWQgYXQgdGhlIGBzdGFydGAgcG9zaXRpb24uXG5cdCAqLyBjb25zdHJ1Y3RvcihzdGFydCwgZW5kKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zdGFydCA9IFBvc2l0aW9uLl9jcmVhdGVBdChzdGFydCk7XG4gICAgICAgIHRoaXMuZW5kID0gZW5kID8gUG9zaXRpb24uX2NyZWF0ZUF0KGVuZCkgOiBQb3NpdGlvbi5fY3JlYXRlQXQoc3RhcnQpO1xuICAgICAgICAvLyBJZiB0aGUgcmFuZ2UgaXMgY29sbGFwc2VkLCB0cmVhdCBpbiBhIHNpbWlsYXIgd2F5IGFzIGEgcG9zaXRpb24gYW5kIHNldCBpdHMgYm91bmRhcmllcyBzdGlja2luZXNzIHRvICd0b05vbmUnLlxuICAgICAgICAvLyBJbiBvdGhlciBjYXNlLCBtYWtlIHRoZSBib3VuZGFyaWVzIHN0aWNrIHRvIHRoZSBcImluc2lkZVwiIG9mIHRoZSByYW5nZS5cbiAgICAgICAgdGhpcy5zdGFydC5zdGlja2luZXNzID0gdGhpcy5pc0NvbGxhcHNlZCA/ICd0b05vbmUnIDogJ3RvTmV4dCc7XG4gICAgICAgIHRoaXMuZW5kLnN0aWNraW5lc3MgPSB0aGlzLmlzQ29sbGFwc2VkID8gJ3RvTm9uZScgOiAndG9QcmV2aW91cyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgYWxsIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBpdGVtc30gdGhhdCBhcmUgaW4gdGhpcyByYW5nZSBhbmQgcmV0dXJuc1xuXHQgKiB0aGVtIHRvZ2V0aGVyIHdpdGggYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBsaWtlIGxlbmd0aCBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbnN9LFxuXHQgKiBncm91cGVkIGFzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RyZWV3YWxrZXJ+VHJlZVdhbGtlclZhbHVlfS5cblx0ICogSXQgaXRlcmF0ZXMgb3ZlciBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eSB0ZXh0IGNvbnRlbnRzfSB0aGF0IGFyZSBpbnNpZGUgdGhlIHJhbmdlXG5cdCAqIGFuZCBhbGwgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH1zIHRoYXQgYXJlIGVudGVyZWQgaW50byB3aGVuIGl0ZXJhdGluZyBvdmVyIHRoaXMgcmFuZ2UuXG5cdCAqXG5cdCAqIFRoaXMgaXRlcmF0b3IgdXNlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90cmVld2Fsa2VyflRyZWVXYWxrZXJ9IHdpdGggYGJvdW5kYXJpZXNgIHNldCB0byB0aGlzIHJhbmdlXG5cdCAqIGFuZCBgaWdub3JlRWxlbWVudEVuZGAgb3B0aW9uIHNldCB0byBgdHJ1ZWAuXG5cdCAqLyAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHlpZWxkKiBuZXcgVHJlZVdhbGtlcih7XG4gICAgICAgICAgICBib3VuZGFyaWVzOiB0aGlzLFxuICAgICAgICAgICAgaWdub3JlRWxlbWVudEVuZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc2NyaWJlcyB3aGV0aGVyIHRoZSByYW5nZSBpcyBjb2xsYXBzZWQsIHRoYXQgaXMgaWYge0BsaW5rICNzdGFydH0gYW5kXG5cdCAqIHtAbGluayAjZW5kfSBwb3NpdGlvbnMgYXJlIGVxdWFsLlxuXHQgKi8gZ2V0IGlzQ29sbGFwc2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5pc0VxdWFsKHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc2NyaWJlcyB3aGV0aGVyIHRoaXMgcmFuZ2UgaXMgZmxhdCwgdGhhdCBpcyBpZiB7QGxpbmsgI3N0YXJ0fSBwb3NpdGlvbiBhbmRcblx0ICoge0BsaW5rICNlbmR9IHBvc2l0aW9uIGFyZSBpbiB0aGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXJlbnR9LlxuXHQgKi8gZ2V0IGlzRmxhdCgpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRQYXJlbnRQYXRoID0gdGhpcy5zdGFydC5nZXRQYXJlbnRQYXRoKCk7XG4gICAgICAgIGNvbnN0IGVuZFBhcmVudFBhdGggPSB0aGlzLmVuZC5nZXRQYXJlbnRQYXRoKCk7XG4gICAgICAgIHJldHVybiBjb21wYXJlQXJyYXlzKHN0YXJ0UGFyZW50UGF0aCwgZW5kUGFyZW50UGF0aCkgPT0gJ3NhbWUnO1xuICAgIH1cbiAgICAvKipcblx0ICogUmFuZ2Ugcm9vdCBlbGVtZW50LlxuXHQgKi8gZ2V0IHJvb3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0LnJvb3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHJhbmdlIGNvbnRhaW5zIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufS5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb259IGlzIGNvbnRhaW5lZFxuXHQgKiBpbiB0aGlzIHJhbmdlLGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gY29udGFpbnNQb3NpdGlvbihwb3NpdGlvbikge1xuICAgICAgICByZXR1cm4gcG9zaXRpb24uaXNBZnRlcih0aGlzLnN0YXJ0KSAmJiBwb3NpdGlvbi5pc0JlZm9yZSh0aGlzLmVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGlzIHJhbmdlIGNvbnRhaW5zIGdpdmVuIHtAbGluayB+UmFuZ2UgcmFuZ2V9LlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjaGVjay5cblx0ICogQHBhcmFtIGxvb3NlIFdoZXRoZXIgdGhlIGNoZWNrIGlzIGxvb3NlIG9yIHN0cmljdC4gSWYgdGhlIGNoZWNrIGlzIHN0cmljdCAoYGZhbHNlYCksIGNvbXBhcmVkIHJhbmdlIGNhbm5vdFxuXHQgKiBzdGFydCBvciBlbmQgYXQgdGhlIHNhbWUgcG9zaXRpb24gYXMgdGhpcyByYW5nZSBib3VuZGFyaWVzLiBJZiB0aGUgY2hlY2sgaXMgbG9vc2UgKGB0cnVlYCksIGNvbXBhcmVkIHJhbmdlIGNhbiBzdGFydCwgZW5kIG9yXG5cdCAqIGV2ZW4gYmUgZXF1YWwgdG8gdGhpcyByYW5nZS4gTm90ZSB0aGF0IGNvbGxhcHNlZCByYW5nZXMgYXJlIGFsd2F5cyBjb21wYXJlZCBpbiBzdHJpY3QgbW9kZS5cblx0ICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiBnaXZlbiB7QGxpbmsgflJhbmdlIHJhbmdlfSBib3VuZGFyaWVzIGFyZSBjb250YWluZWQgYnkgdGhpcyByYW5nZSwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBjb250YWluc1JhbmdlKG90aGVyUmFuZ2UsIGxvb3NlID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKG90aGVyUmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIGxvb3NlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFpbnNTdGFydCA9IHRoaXMuY29udGFpbnNQb3NpdGlvbihvdGhlclJhbmdlLnN0YXJ0KSB8fCBsb29zZSAmJiB0aGlzLnN0YXJ0LmlzRXF1YWwob3RoZXJSYW5nZS5zdGFydCk7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5zRW5kID0gdGhpcy5jb250YWluc1Bvc2l0aW9uKG90aGVyUmFuZ2UuZW5kKSB8fCBsb29zZSAmJiB0aGlzLmVuZC5pc0VxdWFsKG90aGVyUmFuZ2UuZW5kKTtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5zU3RhcnQgJiYgY29udGFpbnNFbmQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW19IGlzIGluc2lkZSB0aGlzIHJhbmdlLlxuXHQgKi8gY29udGFpbnNJdGVtKGl0ZW0pIHtcbiAgICAgICAgY29uc3QgcG9zID0gUG9zaXRpb24uX2NyZWF0ZUJlZm9yZShpdGVtKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbnNQb3NpdGlvbihwb3MpIHx8IHRoaXMuc3RhcnQuaXNFcXVhbChwb3MpO1xuICAgIH1cbiAgICAvKipcblx0ICogVHdvIHJhbmdlcyBhcmUgZXF1YWwgaWYgdGhlaXIge0BsaW5rICNzdGFydH0gYW5kIHtAbGluayAjZW5kfSBwb3NpdGlvbnMgYXJlIGVxdWFsLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBjb21wYXJlIHdpdGguXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiByYW5nZXMgYXJlIGVxdWFsLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGlzRXF1YWwob3RoZXJSYW5nZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5pc0VxdWFsKG90aGVyUmFuZ2Uuc3RhcnQpICYmIHRoaXMuZW5kLmlzRXF1YWwob3RoZXJSYW5nZS5lbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGFuZCByZXR1cm5zIHdoZXRoZXIgdGhpcyByYW5nZSBpbnRlcnNlY3RzIHdpdGggZ2l2ZW4gcmFuZ2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclJhbmdlIFJhbmdlIHRvIGNvbXBhcmUgd2l0aC5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIHJhbmdlcyBpbnRlcnNlY3QsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gaXNJbnRlcnNlY3Rpbmcob3RoZXJSYW5nZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5pc0JlZm9yZShvdGhlclJhbmdlLmVuZCkgJiYgdGhpcy5lbmQuaXNBZnRlcihvdGhlclJhbmdlLnN0YXJ0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbXB1dGVzIHdoaWNoIHBhcnQocykgb2YgdGhpcyB7QGxpbmsgflJhbmdlIHJhbmdlfSBpcyBub3QgYSBwYXJ0IG9mIGdpdmVuIHtAbGluayB+UmFuZ2UgcmFuZ2V9LlxuXHQgKiBSZXR1cm5lZCBhcnJheSBjb250YWlucyB6ZXJvLCBvbmUgb3IgdHdvIHtAbGluayB+UmFuZ2UgcmFuZ2VzfS5cblx0ICpcblx0ICogRXhhbXBsZXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGxldCByYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKFxuXHQgKiBcdG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMiwgNyBdICksXG5cdCAqIFx0bW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyA0LCAwLCAxIF0gKVxuXHQgKiApO1xuXHQgKiBsZXQgb3RoZXJSYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDEgXSApLCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDUgXSApICk7XG5cdCAqIGxldCB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldERpZmZlcmVuY2UoIG90aGVyUmFuZ2UgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG5vIHJhbmdlcyBiZWNhdXNlIGBvdGhlclJhbmdlYCBjb250YWlucyBgcmFuZ2VgXG5cdCAqXG5cdCAqIG90aGVyUmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZSggbW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyAxIF0gKSwgbW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyAzIF0gKSApO1xuXHQgKiB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldERpZmZlcmVuY2UoIG90aGVyUmFuZ2UgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG9uZSByYW5nZTogZnJvbSBbIDMgXSB0byBbIDQsIDAsIDEgXVxuXHQgKlxuXHQgKiBvdGhlclJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2UoIG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMyBdICksIG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgNCBdICkgKTtcblx0ICogdHJhbnNmb3JtZWQgPSByYW5nZS5nZXREaWZmZXJlbmNlKCBvdGhlclJhbmdlICk7XG5cdCAqIC8vIHRyYW5zZm9ybWVkIGFycmF5IGhhcyB0d28gcmFuZ2VzOiBmcm9tIFsgMiwgNyBdIHRvIFsgMyBdIGFuZCBmcm9tIFsgNCBdIHRvIFsgNCwgMCwgMSBdXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gb3RoZXJSYW5nZSBSYW5nZSB0byBkaWZmZXJlbnRpYXRlIGFnYWluc3QuXG5cdCAqIEByZXR1cm5zIFRoZSBkaWZmZXJlbmNlIGJldHdlZW4gcmFuZ2VzLlxuXHQgKi8gZ2V0RGlmZmVyZW5jZShvdGhlclJhbmdlKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgICAgICBpZiAodGhpcy5pc0ludGVyc2VjdGluZyhvdGhlclJhbmdlKSkge1xuICAgICAgICAgICAgLy8gUmFuZ2VzIGludGVyc2VjdC5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICAvLyBHaXZlbiByYW5nZSBzdGFydCBpcyBpbnNpZGUgdGhpcyByYW5nZS4gVGhpcyBtZWFucyB0aGF0IHdlIGhhdmUgdG9cbiAgICAgICAgICAgICAgICAvLyBhZGQgc2hydW5rZW4gcmFuZ2UgLSBmcm9tIHRoZSBzdGFydCB0byB0aGUgbWlkZGxlIG9mIHRoaXMgcmFuZ2UuXG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKHRoaXMuc3RhcnQsIG90aGVyUmFuZ2Uuc3RhcnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5lbmQpKSB7XG4gICAgICAgICAgICAgICAgLy8gR2l2ZW4gcmFuZ2UgZW5kIGlzIGluc2lkZSB0aGlzIHJhbmdlLiBUaGlzIG1lYW5zIHRoYXQgd2UgaGF2ZSB0b1xuICAgICAgICAgICAgICAgIC8vIGFkZCBzaHJ1bmtlbiByYW5nZSAtIGZyb20gdGhlIG1pZGRsZSBvZiB0aGlzIHJhbmdlIHRvIHRoZSBlbmQuXG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKG90aGVyUmFuZ2UuZW5kLCB0aGlzLmVuZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUmFuZ2VzIGRvIG5vdCBpbnRlcnNlY3QsIHJldHVybiB0aGUgb3JpZ2luYWwgcmFuZ2UuXG4gICAgICAgICAgICByYW5nZXMucHVzaChuZXcgUmFuZ2UodGhpcy5zdGFydCwgdGhpcy5lbmQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpbnRlcnNlY3Rpb24gb2YgdGhpcyB7QGxpbmsgflJhbmdlIHJhbmdlfSBhbmQgZ2l2ZW4ge0BsaW5rIH5SYW5nZSByYW5nZX0uXG5cdCAqIEludGVyc2VjdGlvbiBpcyBhIGNvbW1vbiBwYXJ0IG9mIGJvdGggb2YgdGhvc2UgcmFuZ2VzLiBJZiByYW5nZXMgaGFzIG5vIGNvbW1vbiBwYXJ0LCByZXR1cm5zIGBudWxsYC5cblx0ICpcblx0ICogRXhhbXBsZXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGxldCByYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKFxuXHQgKiBcdG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMiwgNyBdICksXG5cdCAqIFx0bW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyA0LCAwLCAxIF0gKVxuXHQgKiApO1xuXHQgKiBsZXQgb3RoZXJSYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDEgXSApLCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDIgXSApICk7XG5cdCAqIGxldCB0cmFuc2Zvcm1lZCA9IHJhbmdlLmdldEludGVyc2VjdGlvbiggb3RoZXJSYW5nZSApOyAvLyBudWxsIC0gcmFuZ2VzIGhhdmUgbm8gY29tbW9uIHBhcnRcblx0ICpcblx0ICogb3RoZXJSYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDMgXSApLCBtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDUgXSApICk7XG5cdCAqIHRyYW5zZm9ybWVkID0gcmFuZ2UuZ2V0SW50ZXJzZWN0aW9uKCBvdGhlclJhbmdlICk7IC8vIHJhbmdlIGZyb20gWyAzIF0gdG8gWyA0LCAwLCAxIF1cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclJhbmdlIFJhbmdlIHRvIGNoZWNrIGZvciBpbnRlcnNlY3Rpb24uXG5cdCAqIEByZXR1cm5zIEEgY29tbW9uIHBhcnQgb2YgZ2l2ZW4gcmFuZ2VzIG9yIGBudWxsYCBpZiByYW5nZXMgaGF2ZSBubyBjb21tb24gcGFydC5cblx0ICovIGdldEludGVyc2VjdGlvbihvdGhlclJhbmdlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzSW50ZXJzZWN0aW5nKG90aGVyUmFuZ2UpKSB7XG4gICAgICAgICAgICAvLyBSYW5nZXMgaW50ZXJzZWN0LCBzbyBhIGNvbW1vbiByYW5nZSB3aWxsIGJlIHJldHVybmVkLlxuICAgICAgICAgICAgLy8gQXQgbW9zdCwgaXQgd2lsbCBiZSBzYW1lIGFzIHRoaXMgcmFuZ2UuXG4gICAgICAgICAgICBsZXQgY29tbW9uUmFuZ2VTdGFydCA9IHRoaXMuc3RhcnQ7XG4gICAgICAgICAgICBsZXQgY29tbW9uUmFuZ2VFbmQgPSB0aGlzLmVuZDtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9zaXRpb24ob3RoZXJSYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICAvLyBHaXZlbiByYW5nZSBzdGFydCBpcyBpbnNpZGUgdGhpcyByYW5nZS4gVGhpcyBtZWFucyB0aGFOdCB3ZSBoYXZlIHRvXG4gICAgICAgICAgICAgICAgLy8gc2hyaW5rIGNvbW1vbiByYW5nZSB0byB0aGUgZ2l2ZW4gcmFuZ2Ugc3RhcnQuXG4gICAgICAgICAgICAgICAgY29tbW9uUmFuZ2VTdGFydCA9IG90aGVyUmFuZ2Uuc3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5jb250YWluc1Bvc2l0aW9uKG90aGVyUmFuZ2UuZW5kKSkge1xuICAgICAgICAgICAgICAgIC8vIEdpdmVuIHJhbmdlIGVuZCBpcyBpbnNpZGUgdGhpcyByYW5nZS4gVGhpcyBtZWFucyB0aGF0IHdlIGhhdmUgdG9cbiAgICAgICAgICAgICAgICAvLyBzaHJpbmsgY29tbW9uIHJhbmdlIHRvIHRoZSBnaXZlbiByYW5nZSBlbmQuXG4gICAgICAgICAgICAgICAgY29tbW9uUmFuZ2VFbmQgPSBvdGhlclJhbmdlLmVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UoY29tbW9uUmFuZ2VTdGFydCwgY29tbW9uUmFuZ2VFbmQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJhbmdlcyBkbyBub3QgaW50ZXJzZWN0LCBzbyB0aGV5IGRvIG5vdCBoYXZlIGNvbW1vbiBwYXJ0LlxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByYW5nZSBjcmVhdGVkIGJ5IGpvaW5pbmcgdGhpcyB7QGxpbmsgflJhbmdlIHJhbmdlfSB3aXRoIHRoZSBnaXZlbiB7QGxpbmsgflJhbmdlIHJhbmdlfS5cblx0ICogSWYgcmFuZ2VzIGhhdmUgbm8gY29tbW9uIHBhcnQsIHJldHVybnMgYG51bGxgLlxuXHQgKlxuXHQgKiBFeGFtcGxlczpcblx0ICpcblx0ICogYGBgdHNcblx0ICogbGV0IHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2UoXG5cdCAqIFx0bW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyAyLCA3IF0gKSxcblx0ICogXHRtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDQsIDAsIDEgXSApXG5cdCAqICk7XG5cdCAqIGxldCBvdGhlclJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2UoXG5cdCAqIFx0bW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyAxIF0gKSxcblx0ICogXHRtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDIgXSApXG4gXHQgKiApO1xuXHQgKiBsZXQgdHJhbnNmb3JtZWQgPSByYW5nZS5nZXRKb2luZWQoIG90aGVyUmFuZ2UgKTsgLy8gbnVsbCAtIHJhbmdlcyBoYXZlIG5vIGNvbW1vbiBwYXJ0XG5cdCAqXG5cdCAqIG90aGVyUmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZShcblx0ICogXHRtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDMgXSApLFxuXHQgKiBcdG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgNSBdIClcblx0ICogKTtcblx0ICogdHJhbnNmb3JtZWQgPSByYW5nZS5nZXRKb2luZWQoIG90aGVyUmFuZ2UgKTsgLy8gcmFuZ2UgZnJvbSBbIDIsIDcgXSB0byBbIDUgXVxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIG90aGVyUmFuZ2UgUmFuZ2UgdG8gYmUgam9pbmVkLlxuXHQgKiBAcGFyYW0gbG9vc2UgV2hldGhlciB0aGUgaW50ZXJzZWN0aW9uIGNoZWNrIGlzIGxvb3NlIG9yIHN0cmljdC4gSWYgdGhlIGNoZWNrIGlzIHN0cmljdCAoYGZhbHNlYCksXG5cdCAqIHJhbmdlcyBhcmUgdGVzdGVkIGZvciBpbnRlcnNlY3Rpb24gb3Igd2hldGhlciBzdGFydC9lbmQgcG9zaXRpb25zIGFyZSBlcXVhbC4gSWYgdGhlIGNoZWNrIGlzIGxvb3NlIChgdHJ1ZWApLFxuXHQgKiBjb21wYXJlZCByYW5nZSBpcyBhbHNvIGNoZWNrZWQgaWYgaXQncyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNpc1RvdWNoaW5nIHRvdWNoaW5nfSBjdXJyZW50IHJhbmdlLlxuXHQgKiBAcmV0dXJucyBBIHN1bSBvZiBnaXZlbiByYW5nZXMgb3IgYG51bGxgIGlmIHJhbmdlcyBoYXZlIG5vIGNvbW1vbiBwYXJ0LlxuXHQgKi8gZ2V0Sm9pbmVkKG90aGVyUmFuZ2UsIGxvb3NlID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IHNob3VsZEpvaW4gPSB0aGlzLmlzSW50ZXJzZWN0aW5nKG90aGVyUmFuZ2UpO1xuICAgICAgICBpZiAoIXNob3VsZEpvaW4pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0LmlzQmVmb3JlKG90aGVyUmFuZ2Uuc3RhcnQpKSB7XG4gICAgICAgICAgICAgICAgc2hvdWxkSm9pbiA9IGxvb3NlID8gdGhpcy5lbmQuaXNUb3VjaGluZyhvdGhlclJhbmdlLnN0YXJ0KSA6IHRoaXMuZW5kLmlzRXF1YWwob3RoZXJSYW5nZS5zdGFydCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3VsZEpvaW4gPSBsb29zZSA/IG90aGVyUmFuZ2UuZW5kLmlzVG91Y2hpbmcodGhpcy5zdGFydCkgOiBvdGhlclJhbmdlLmVuZC5pc0VxdWFsKHRoaXMuc3RhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghc2hvdWxkSm9pbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHN0YXJ0UG9zaXRpb24gPSB0aGlzLnN0YXJ0O1xuICAgICAgICBsZXQgZW5kUG9zaXRpb24gPSB0aGlzLmVuZDtcbiAgICAgICAgaWYgKG90aGVyUmFuZ2Uuc3RhcnQuaXNCZWZvcmUoc3RhcnRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHN0YXJ0UG9zaXRpb24gPSBvdGhlclJhbmdlLnN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvdGhlclJhbmdlLmVuZC5pc0FmdGVyKGVuZFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgZW5kUG9zaXRpb24gPSBvdGhlclJhbmdlLmVuZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbXB1dGVzIGFuZCByZXR1cm5zIHRoZSBzbWFsbGVzdCBzZXQgb2Yge0BsaW5rICNpc0ZsYXQgZmxhdH0gcmFuZ2VzLCB0aGF0IGNvdmVycyB0aGlzIHJhbmdlIGluIHdob2xlLlxuXHQgKlxuXHQgKiBTZWUgYW4gZXhhbXBsZSBvZiBhIG1vZGVsIHN0cnVjdHVyZSAoYFtgIGFuZCBgXWAgYXJlIHJhbmdlIGJvdW5kYXJpZXMpOlxuXHQgKlxuXHQgKiBgYGBcblx0ICogcm9vdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3Rcblx0ICogIHwtIGVsZW1lbnQgRElWICAgICAgICAgICAgICAgICAgICAgICAgIERJViAgICAgICAgICAgICBQMiAgICAgICAgICAgICAgUDMgICAgICAgICAgICAgRElWXG5cdCAqICB8ICAgfC0gZWxlbWVudCBIICAgICAgICAgICAgICAgICAgIEggICAgICAgIFAxICAgICAgICBmIG8gbyAgICAgICAgICAgYiBhIHIgICAgICAgSCAgICAgICAgIFA0XG5cdCAqICB8ICAgfCAgIHwtIFwiZmlyW3N0XCIgICAgICAgICAgICAgZmlyW3N0ICAgICBsb3JlbSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZV1jb25kICAgICBpcHN1bVxuXHQgKiAgfCAgIHwtIGVsZW1lbnQgUDFcblx0ICogIHwgICB8ICAgfC0gXCJsb3JlbVwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8XG5cdCAqICB8LSBlbGVtZW50IFAyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcblx0ICogIHwgICB8LSBcImZvb1wiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZWXG5cdCAqICB8LSBlbGVtZW50IFAzXG5cdCAqICB8ICAgfC0gXCJiYXJcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3Rcblx0ICogIHwtIGVsZW1lbnQgRElWICAgICAgICAgICAgICAgICAgICAgICAgIERJViAgICAgICAgICAgICBbUDIgICAgICAgICAgICAgUDNdICAgICAgICAgICAgIERJVlxuXHQgKiAgfCAgIHwtIGVsZW1lbnQgSCAgICAgICAgICAgICAgICAgICBIICAgICAgIFtQMV0gICAgICAgZiBvIG8gICAgICAgICAgIGIgYSByICAgICAgICBIICAgICAgICAgUDRcblx0ICogIHwgICB8ICAgfC0gXCJzZV1jb25kXCIgICAgICAgICAgICBmaXJbc3RdICAgIGxvcmVtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtzZV1jb25kICAgICBpcHN1bVxuXHQgKiAgfCAgIHwtIGVsZW1lbnQgUDRcblx0ICogIHwgICB8ICAgfC0gXCJpcHN1bVwiXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBBcyBpdCBjYW4gYmUgc2VlbiwgbGV0dGVycyBjb250YWluZWQgaW4gdGhlIHJhbmdlIGFyZTogYHN0bG9yZW1mb29iYXJzZWAsIHNwcmVhZCBhY3Jvc3MgZGlmZmVyZW50IHBhcmVudHMuXG5cdCAqIFdlIGFyZSBsb29raW5nIGZvciBtaW5pbWFsIHNldCBvZiBmbGF0IHJhbmdlcyB0aGF0IGNvbnRhaW5zIHRoZSBzYW1lIG5vZGVzLlxuXHQgKlxuXHQgKiBNaW5pbWFsIGZsYXQgcmFuZ2VzIGZvciBhYm92ZSByYW5nZSBgKCBbIDAsIDAsIDMgXSwgWyAzLCAwLCAyIF0gKWAgd2lsbCBiZTpcblx0ICpcblx0ICogYGBgXG5cdCAqICggWyAwLCAwLCAzIF0sIFsgMCwgMCwgNSBdICkgPSBcInN0XCJcblx0ICogKCBbIDAsIDEgXSwgWyAwLCAyIF0gKSA9IGVsZW1lbnQgUDEgKFwibG9yZW1cIilcblx0ICogKCBbIDEgXSwgWyAzIF0gKSA9IGVsZW1lbnQgUDIsIGVsZW1lbnQgUDMgKFwiZm9vYmFyXCIpXG5cdCAqICggWyAzLCAwLCAwIF0sIFsgMywgMCwgMiBdICkgPSBcInNlXCJcblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZToqKiBpZiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gaXMgbm90IHdob2xseSBjb250YWluZWQgaW4gdGhpcyByYW5nZSwgaXQgd29uJ3QgYmUgcmV0dXJuZWRcblx0ICogaW4gYW55IG9mIHRoZSByZXR1cm5lZCBmbGF0IHJhbmdlcy4gU2VlIGluIHRoZSBleGFtcGxlIGhvdyBgSGAgZWxlbWVudHMgYXQgdGhlIGJlZ2lubmluZyBhbmQgYXQgdGhlIGVuZCBvZiB0aGUgcmFuZ2Vcblx0ICogd2VyZSBvbWl0dGVkLiBPbmx5IHRoZWlyIHBhcnRzIHRoYXQgd2VyZSB3aG9sbHkgaW4gdGhlIHJhbmdlIHdlcmUgcmV0dXJuZWQuXG5cdCAqXG5cdCAqICoqTm90ZToqKiB0aGlzIG1ldGhvZCBpcyBub3QgcmV0dXJuaW5nIGZsYXQgcmFuZ2VzIHRoYXQgY29udGFpbiBubyBub2Rlcy5cblx0ICpcblx0ICogQHJldHVybnMgQXJyYXkgb2YgZmxhdCByYW5nZXMgY292ZXJpbmcgdGhpcyByYW5nZS5cblx0ICovIGdldE1pbmltYWxGbGF0UmFuZ2VzKCkge1xuICAgICAgICBjb25zdCByYW5nZXMgPSBbXTtcbiAgICAgICAgY29uc3QgZGlmZkF0ID0gdGhpcy5zdGFydC5nZXRDb21tb25QYXRoKHRoaXMuZW5kKS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHBvcyA9IFBvc2l0aW9uLl9jcmVhdGVBdCh0aGlzLnN0YXJ0KTtcbiAgICAgICAgbGV0IHBvc1BhcmVudCA9IHBvcy5wYXJlbnQ7XG4gICAgICAgIC8vIEdvIHVwLlxuICAgICAgICB3aGlsZShwb3MucGF0aC5sZW5ndGggPiBkaWZmQXQgKyAxKXtcbiAgICAgICAgICAgIGNvbnN0IGhvd01hbnkgPSBwb3NQYXJlbnQubWF4T2Zmc2V0IC0gcG9zLm9mZnNldDtcbiAgICAgICAgICAgIGlmIChob3dNYW55ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKHBvcywgcG9zLmdldFNoaWZ0ZWRCeShob3dNYW55KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zLnBhdGggPSBwb3MucGF0aC5zbGljZSgwLCAtMSk7XG4gICAgICAgICAgICBwb3Mub2Zmc2V0Kys7XG4gICAgICAgICAgICBwb3NQYXJlbnQgPSBwb3NQYXJlbnQucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIC8vIEdvIGRvd24uXG4gICAgICAgIHdoaWxlKHBvcy5wYXRoLmxlbmd0aCA8PSB0aGlzLmVuZC5wYXRoLmxlbmd0aCl7XG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLmVuZC5wYXRoW3Bvcy5wYXRoLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgY29uc3QgaG93TWFueSA9IG9mZnNldCAtIHBvcy5vZmZzZXQ7XG4gICAgICAgICAgICBpZiAoaG93TWFueSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShwb3MsIHBvcy5nZXRTaGlmdGVkQnkoaG93TWFueSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvcy5vZmZzZXQgPSBvZmZzZXQ7XG4gICAgICAgICAgICBwb3MucGF0aC5wdXNoKDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyIFRyZWVXYWxrZXJ9IGluc3RhbmNlIHdpdGggdGhpcyByYW5nZSBhcyBhIGJvdW5kYXJ5LlxuXHQgKlxuXHQgKiBGb3IgZXhhbXBsZSwgdG8gaXRlcmF0ZSBvdmVyIGFsbCBpdGVtcyBpbiB0aGUgZW50aXJlIGRvY3VtZW50IHJvb3Q6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIENyZWF0ZSBhIHJhbmdlIHNwYW5uaW5nIG92ZXIgdGhlIGVudGlyZSByb290IGNvbnRlbnQ6XG5cdCAqIGNvbnN0IHJhbmdlID0gZWRpdG9yLm1vZGVsLmNyZWF0ZVJhbmdlSW4oIGVkaXRvci5tb2RlbC5kb2N1bWVudC5nZXRSb290KCkgKTtcblx0ICpcblx0ICogLy8gSXRlcmF0ZSBvdmVyIGFsbCBpdGVtcyBpbiB0aGlzIHJhbmdlOlxuXHQgKiBmb3IgKCBjb25zdCB2YWx1ZSBvZiByYW5nZS5nZXRXYWxrZXIoKSApIHtcblx0ICogXHRjb25zb2xlLmxvZyggdmFsdWUuaXRlbSApO1xuXHQgKiB9XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPYmplY3Qgd2l0aCBjb25maWd1cmF0aW9uIG9wdGlvbnMuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90cmVld2Fsa2VyflRyZWVXYWxrZXJ9LlxuXHQgKi8gZ2V0V2Fsa2VyKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBvcHRpb25zLmJvdW5kYXJpZXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFRyZWVXYWxrZXIob3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIHRoYXQgaXRlcmF0ZXMgb3ZlciBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIGl0ZW1zfSB0aGF0IGFyZSBpbiB0aGlzIHJhbmdlIGFuZCByZXR1cm5zXG5cdCAqIHRoZW0uXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfSB3aXRoIGBib3VuZGFyaWVzYCBzZXQgdG8gdGhpcyByYW5nZSBhbmQgYGlnbm9yZUVsZW1lbnRFbmRgIG9wdGlvblxuXHQgKiBzZXQgdG8gYHRydWVgLiBIb3dldmVyIGl0IHJldHVybnMgb25seSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbXN9LFxuXHQgKiBub3Qge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWV9LlxuXHQgKlxuXHQgKiBZb3UgbWF5IHNwZWNpZnkgYWRkaXRpb25hbCBvcHRpb25zIGZvciB0aGUgdHJlZSB3YWxrZXIuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90cmVld2Fsa2VyflRyZWVXYWxrZXJ9IGZvclxuXHQgKiBhIGZ1bGwgbGlzdCBvZiBhdmFpbGFibGUgb3B0aW9ucy5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgT2JqZWN0IHdpdGggY29uZmlndXJhdGlvbiBvcHRpb25zLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfS5cblx0ICovICpnZXRJdGVtcyhvcHRpb25zID0ge30pIHtcbiAgICAgICAgb3B0aW9ucy5ib3VuZGFyaWVzID0gdGhpcztcbiAgICAgICAgb3B0aW9ucy5pZ25vcmVFbGVtZW50RW5kID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgdHJlZVdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKG9wdGlvbnMpO1xuICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHRyZWVXYWxrZXIpe1xuICAgICAgICAgICAgeWllbGQgdmFsdWUuaXRlbTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgYWxsIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9uc30gdGhhdCBhcmUgYm91bmRhcmllcyBvclxuXHQgKiBjb250YWluZWQgaW4gdGhpcyByYW5nZS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgdXNlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90cmVld2Fsa2VyflRyZWVXYWxrZXJ9IHdpdGggYGJvdW5kYXJpZXNgIHNldCB0byB0aGlzIHJhbmdlLiBIb3dldmVyIGl0IHJldHVybnMgb25seVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbnN9LCBub3Qge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyVmFsdWV9LlxuXHQgKlxuXHQgKiBZb3UgbWF5IHNwZWNpZnkgYWRkaXRpb25hbCBvcHRpb25zIGZvciB0aGUgdHJlZSB3YWxrZXIuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90cmVld2Fsa2VyflRyZWVXYWxrZXJ9IGZvclxuXHQgKiBhIGZ1bGwgbGlzdCBvZiBhdmFpbGFibGUgb3B0aW9ucy5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgT2JqZWN0IHdpdGggY29uZmlndXJhdGlvbiBvcHRpb25zLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdHJlZXdhbGtlcn5UcmVlV2Fsa2VyfS5cblx0ICovICpnZXRQb3NpdGlvbnMob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIG9wdGlvbnMuYm91bmRhcmllcyA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHRyZWVXYWxrZXIgPSBuZXcgVHJlZVdhbGtlcihvcHRpb25zKTtcbiAgICAgICAgeWllbGQgdHJlZVdhbGtlci5wb3NpdGlvbjtcbiAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0cmVlV2Fsa2VyKXtcbiAgICAgICAgICAgIHlpZWxkIHZhbHVlLm5leHRQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHJhbmdlIHRoYXQgaXMgYSByZXN1bHQgb2YgdHJhbnNmb3JtaW5nIHRoaXMgcmFuZ2UgYnkgZ2l2ZW4gYG9wZXJhdGlvbmAuXG5cdCAqXG5cdCAqICoqTm90ZToqKiB0cmFuc2Zvcm1hdGlvbiBtYXkgYnJlYWsgb25lIHJhbmdlIGludG8gbXVsdGlwbGUgcmFuZ2VzIChmb3IgZXhhbXBsZSwgd2hlbiBhIHBhcnQgb2YgdGhlIHJhbmdlIGlzXG5cdCAqIG1vdmVkIHRvIGEgZGlmZmVyZW50IHBhcnQgb2YgZG9jdW1lbnQgdHJlZSkuIEZvciB0aGlzIHJlYXNvbiwgYW4gYXJyYXkgaXMgcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QgYW5kIGl0XG5cdCAqIG1heSBjb250YWluIG9uZSBvciBtb3JlIGBSYW5nZWAgaW5zdGFuY2VzLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3BlcmF0aW9uIE9wZXJhdGlvbiB0byB0cmFuc2Zvcm0gcmFuZ2UgYnkuXG5cdCAqIEByZXR1cm5zIFJhbmdlIHdoaWNoIGlzIHRoZSByZXN1bHQgb2YgdHJhbnNmb3JtYXRpb24uXG5cdCAqLyBnZXRUcmFuc2Zvcm1lZEJ5T3BlcmF0aW9uKG9wZXJhdGlvbikge1xuICAgICAgICBzd2l0Y2gob3BlcmF0aW9uLnR5cGUpe1xuICAgICAgICAgICAgY2FzZSAnaW5zZXJ0JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgY2FzZSAnbW92ZSc6XG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxuICAgICAgICAgICAgY2FzZSAncmVpbnNlcnQnOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgY2FzZSAnc3BsaXQnOlxuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihvcGVyYXRpb24pXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNhc2UgJ21lcmdlJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24ob3BlcmF0aW9uKVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBSYW5nZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZClcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByYW5nZSB0aGF0IGlzIGEgcmVzdWx0IG9mIHRyYW5zZm9ybWluZyB0aGlzIHJhbmdlIGJ5IG11bHRpcGxlIGBvcGVyYXRpb25zYC5cblx0ICpcblx0ICogQHNlZSB+UmFuZ2UjZ2V0VHJhbnNmb3JtZWRCeU9wZXJhdGlvblxuXHQgKiBAcGFyYW0gb3BlcmF0aW9ucyBPcGVyYXRpb25zIHRvIHRyYW5zZm9ybSB0aGUgcmFuZ2UgYnkuXG5cdCAqIEByZXR1cm5zIFJhbmdlIHdoaWNoIGlzIHRoZSByZXN1bHQgb2YgdHJhbnNmb3JtYXRpb24uXG5cdCAqLyBnZXRUcmFuc2Zvcm1lZEJ5T3BlcmF0aW9ucyhvcGVyYXRpb25zKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtcbiAgICAgICAgICAgIG5ldyBSYW5nZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZClcbiAgICAgICAgXTtcbiAgICAgICAgZm9yIChjb25zdCBvcGVyYXRpb24gb2Ygb3BlcmF0aW9ucyl7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByYW5nZXNbaV0uZ2V0VHJhbnNmb3JtZWRCeU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgICAgIHJhbmdlcy5zcGxpY2UoaSwgMSwgLi4ucmVzdWx0KTtcbiAgICAgICAgICAgICAgICBpICs9IHJlc3VsdC5sZW5ndGggLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEl0IG1heSBoYXBwZW4gdGhhdCBhIHJhbmdlIGlzIHNwbGl0IGludG8gdHdvLCBhbmQgdGhlbiB0aGUgcGFydCBvZiBzZWNvbmQgXCJwaWVjZVwiIGlzIG1vdmVkIGludG8gZmlyc3RcbiAgICAgICAgLy8gXCJwaWVjZVwiLiBJbiB0aGlzIGNhc2Ugd2Ugd2lsbCBoYXZlIGluY29ycmVjdCB0aGlyZCByYW5nZSwgd2hpY2ggc2hvdWxkIG5vdCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0IC0tXG4gICAgICAgIC8vIGJlY2F1c2UgaXQgaXMgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgZmlyc3QgXCJwaWVjZVwiLiBJbiB0aGlzIGxvb3Agd2UgYXJlIGxvb2tpbmcgZm9yIGFsbCBzdWNoIHJhbmdlcyB0aGF0XG4gICAgICAgIC8vIGFyZSBpbnNpZGUgb3RoZXIgcmFuZ2VzIGFuZCB3ZSBzaW1wbHkgcmVtb3ZlIHRoZW0uXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSByYW5nZXNbaV07XG4gICAgICAgICAgICBmb3IobGV0IGogPSBpICsgMTsgaiA8IHJhbmdlcy5sZW5ndGg7IGorKyl7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IHJhbmdlc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAocmFuZ2UuY29udGFpbnNSYW5nZShuZXh0KSB8fCBuZXh0LmNvbnRhaW5zUmFuZ2UocmFuZ2UpIHx8IHJhbmdlLmlzRXF1YWwobmV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VzLnNwbGljZShqLCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmdlcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9XG5cdCAqIHdoaWNoIGlzIGEgY29tbW9uIGFuY2VzdG9yIG9mIHRoZSByYW5nZSdzIGJvdGggZW5kcyAoaW4gd2hpY2ggdGhlIGVudGlyZSByYW5nZSBpcyBjb250YWluZWQpLlxuXHQgKi8gZ2V0Q29tbW9uQW5jZXN0b3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0LmdldENvbW1vbkFuY2VzdG9yKHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IEVsZW1lbnR9IGNvbnRhaW5lZCBieSB0aGUgcmFuZ2UuXG5cdCAqIFRoZSBlbGVtZW50IHdpbGwgYmUgcmV0dXJuZWQgd2hlbiBpdCBpcyB0aGUgKipvbmx5Kiogbm9kZSB3aXRoaW4gdGhlIHJhbmdlIGFuZCAqKmZ1bGx54oCTY29udGFpbmVkKipcblx0ICogYXQgdGhlIHNhbWUgdGltZS5cblx0ICovIGdldENvbnRhaW5lZEVsZW1lbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub2RlQWZ0ZXJTdGFydCA9IHRoaXMuc3RhcnQubm9kZUFmdGVyO1xuICAgICAgICBjb25zdCBub2RlQmVmb3JlRW5kID0gdGhpcy5lbmQubm9kZUJlZm9yZTtcbiAgICAgICAgaWYgKG5vZGVBZnRlclN0YXJ0ICYmIG5vZGVBZnRlclN0YXJ0LmlzKCdlbGVtZW50JykgJiYgbm9kZUFmdGVyU3RhcnQgPT09IG5vZGVCZWZvcmVFbmQpIHtcbiAgICAgICAgICAgIHJldHVybiBub2RlQWZ0ZXJTdGFydDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIGBSYW5nZWAgdG8gcGxhaW4gb2JqZWN0IGFuZCByZXR1cm5zIGl0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBgTm9kZWAgY29udmVydGVkIHRvIHBsYWluIG9iamVjdC5cblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnN0YXJ0LnRvSlNPTigpLFxuICAgICAgICAgICAgZW5kOiB0aGlzLmVuZC50b0pTT04oKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIG5ldyByYW5nZSB0aGF0IGlzIGVxdWFsIHRvIGN1cnJlbnQgcmFuZ2UuXG5cdCAqLyBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuc3RhcnQsIHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByZXN1bHQgb2YgdHJhbnNmb3JtaW5nIGEgY29weSBvZiB0aGlzIHJhbmdlIGJ5IGluc2VydCBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIE9uZSBvciBtb3JlIHJhbmdlcyBtYXkgYmUgcmV0dXJuZWQgYXMgYSByZXN1bHQgb2YgdGhpcyB0cmFuc2Zvcm1hdGlvbi5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihvcGVyYXRpb24sIHNwcmVhZCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0aW9uKG9wZXJhdGlvbi5wb3NpdGlvbiwgb3BlcmF0aW9uLmhvd01hbnksIHNwcmVhZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgcmVzdWx0IG9mIHRyYW5zZm9ybWluZyBhIGNvcHkgb2YgdGhpcyByYW5nZSBieSBtb3ZlIG9wZXJhdGlvbi5cblx0ICpcblx0ICogT25lIG9yIG1vcmUgcmFuZ2VzIG1heSBiZSByZXR1cm5lZCBhcyBhIHJlc3VsdCBvZiB0aGlzIHRyYW5zZm9ybWF0aW9uLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihvcGVyYXRpb24sIHNwcmVhZCA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZVBvc2l0aW9uID0gb3BlcmF0aW9uLnNvdXJjZVBvc2l0aW9uO1xuICAgICAgICBjb25zdCBob3dNYW55ID0gb3BlcmF0aW9uLmhvd01hbnk7XG4gICAgICAgIGNvbnN0IHRhcmdldFBvc2l0aW9uID0gb3BlcmF0aW9uLnRhcmdldFBvc2l0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUoc291cmNlUG9zaXRpb24sIHRhcmdldFBvc2l0aW9uLCBob3dNYW55LCBzcHJlYWQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHJlc3VsdCBvZiB0cmFuc2Zvcm1pbmcgYSBjb3B5IG9mIHRoaXMgcmFuZ2UgYnkgc3BsaXQgb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBBbHdheXMgb25lIHJhbmdlIGlzIHJldHVybmVkLiBUaGUgdHJhbnNmb3JtYXRpb24gaXMgZG9uZSBpbiBhIHdheSB0byBub3QgYnJlYWsgdGhlIHJhbmdlLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24ob3BlcmF0aW9uKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIGxldCBlbmQgPSB0aGlzLmVuZC5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIGlmICh0aGlzLmVuZC5pc0VxdWFsKG9wZXJhdGlvbi5pbnNlcnRpb25Qb3NpdGlvbikpIHtcbiAgICAgICAgICAgIGVuZCA9IHRoaXMuZW5kLmdldFNoaWZ0ZWRCeSgxKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBCZWxvdyBtYXkgaGFwcGVuIHdoZW4gcmFuZ2UgY29udGFpbnMgZ3JhdmV5YXJkIGVsZW1lbnQgdXNlZCBieSBzcGxpdCBvcGVyYXRpb24uXG4gICAgICAgIGlmIChzdGFydC5yb290ICE9IGVuZC5yb290KSB7XG4gICAgICAgICAgICAvLyBFbmQgcG9zaXRpb24gd2FzIG5leHQgdG8gdGhlIG1vdmVkIGdyYXZleWFyZCBlbGVtZW50IGFuZCB3YXMgbW92ZWQgd2l0aCBpdC5cbiAgICAgICAgICAgIC8vIEZpeCBpdCBieSB1c2luZyBvbGQgYGVuZGAgd2hpY2ggaGFzIHByb3BlciBgcm9vdGAuXG4gICAgICAgICAgICBlbmQgPSB0aGlzLmVuZC5nZXRTaGlmdGVkQnkoLTEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnQsIGVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgcmVzdWx0IG9mIHRyYW5zZm9ybWluZyBhIGNvcHkgb2YgdGhpcyByYW5nZSBieSBtZXJnZSBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEFsd2F5cyBvbmUgcmFuZ2UgaXMgcmV0dXJuZWQuIFRoZSB0cmFuc2Zvcm1hdGlvbiBpcyBkb25lIGluIGEgd2F5IHRvIG5vdCBicmVhayB0aGUgcmFuZ2UuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIHdoZW4gdGhlIG1hcmtlciBpcyBzZXQgb24gXCJ0aGUgY2xvc2luZyB0YWdcIiBvZiBhbiBlbGVtZW50LiBNYXJrZXIgY2FuIGJlIHNldCBsaWtlIHRoYXQgZHVyaW5nXG4gICAgICAgIC8vIHRyYW5zZm9ybWF0aW9ucywgZXNwZWNpYWxseSB3aGVuIGEgY29udGVudCBvZiBhIGZldyBibG9jayBlbGVtZW50cyB3ZXJlIHJlbW92ZWQuIEZvciBleGFtcGxlOlxuICAgICAgICAvL1xuICAgICAgICAvLyB7fSBpcyB0aGUgdHJhbnNmb3JtZWQgcmFuZ2UsIFtdIGlzIHRoZSByZW1vdmVkIHJhbmdlLlxuICAgICAgICAvLyA8cD5GW297bzwvcD48cD5CfWFyPC9wPjxwPlh5XXo8L3A+XG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxwPkZve288L3A+PHA+Qn1hcjwvcD48cD56PC9wPlxuICAgICAgICAvLyA8cD5GezwvcD48cD5CfWFyPC9wPjxwPno8L3A+XG4gICAgICAgIC8vIDxwPkZ7PC9wPn08cD56PC9wPlxuICAgICAgICAvLyA8cD5Ge316PC9wPlxuICAgICAgICAvL1xuICAgICAgICBpZiAodGhpcy5zdGFydC5pc0VxdWFsKG9wZXJhdGlvbi50YXJnZXRQb3NpdGlvbikgJiYgdGhpcy5lbmQuaXNFcXVhbChvcGVyYXRpb24uZGVsZXRpb25Qb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5zdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIGxldCBlbmQgPSB0aGlzLmVuZC5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIGlmIChzdGFydC5yb290ICE9IGVuZC5yb290KSB7XG4gICAgICAgICAgICAvLyBUaGlzIGhhcHBlbnMgd2hlbiB0aGUgZW5kIHBvc2l0aW9uIHdhcyBuZXh0IHRvIHRoZSBtZXJnZWQgKGRlbGV0ZWQpIGVsZW1lbnQuXG4gICAgICAgICAgICAvLyBUaGVuLCB0aGUgZW5kIHBvc2l0aW9uIHdhcyBtb3ZlZCB0byB0aGUgZ3JhdmV5YXJkIHJvb3QuIEluIHRoaXMgY2FzZSB3ZSBuZWVkIHRvIGZpeFxuICAgICAgICAgICAgLy8gdGhlIHJhbmdlIGNhdXNlIGl0cyBib3VuZGFyaWVzIHdvdWxkIGJlIGluIGRpZmZlcmVudCByb290cy5cbiAgICAgICAgICAgIGVuZCA9IHRoaXMuZW5kLmdldFNoaWZ0ZWRCeSgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0LmlzQWZ0ZXIoZW5kKSkge1xuICAgICAgICAgICAgLy8gVGhpcyBoYXBwZW5zIGluIHRocmVlIGZvbGxvd2luZyBjYXNlczpcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBDYXNlIDE6IE1lcmdlIG9wZXJhdGlvbiBzb3VyY2UgcG9zaXRpb24gaXMgYmVmb3JlIHRoZSB0YXJnZXQgcG9zaXRpb24gKGR1ZSB0byBzb21lIHRyYW5zZm9ybWF0aW9ucywgT1QsIGV0Yy4pXG4gICAgICAgICAgICAvLyAgICAgICAgIFRoaXMgbWVhbnMgdGhhdCBzdGFydCBjYW4gYmUgbW92ZWQgYmVmb3JlIHRoZSBlbmQgb2YgdGhlIHJhbmdlLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJlZm9yZTogPHA+YXthPC9wPjxwPmJ9YjwvcD48cD5jYzwvcD5cbiAgICAgICAgICAgIC8vIE1lcmdlOiAgPHA+Yn1iPC9wPjxwPmNjYXthPC9wPlxuICAgICAgICAgICAgLy8gRml4OiAgICA8cD57Yn1iPC9wPjxwPmNjYWE8L3A+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gQ2FzZSAyOiBSYW5nZSBzdGFydCBpcyBiZWZvcmUgbWVyZ2VkIG5vZGUgYnV0IG5vdCBkaXJlY3RseS5cbiAgICAgICAgICAgIC8vICAgICAgICAgUmVzdWx0IHNob3VsZCBpbmNsdWRlIGFsbCBub2RlcyB0aGF0IHdlcmUgaW4gdGhlIG9yaWdpbmFsIHJhbmdlLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJlZm9yZTogPHA+YWE8L3A+ezxwPmNjPC9wPjxwPmJ9YjwvcD5cbiAgICAgICAgICAgIC8vIE1lcmdlOiAgPHA+YWFifWI8L3A+ezxwPmNjPC9wPlxuICAgICAgICAgICAgLy8gRml4OiAgICA8cD5hYXtiYjwvcD48cD5jYzwvcD59XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgICAgICBUaGUgcmFuZ2UgaXMgZXhwYW5kZWQgYnkgYW4gYWRkaXRpb25hbCBgYmAgbGV0dGVyIGJ1dCBpdCBpcyBiZXR0ZXIgdGhhbiBkcm9wcGluZyB0aGUgd2hvbGUgYGNjYCBwYXJhZ3JhcGguXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gQ2FzZSAzOiBSYW5nZSBzdGFydCBpcyBkaXJlY3RseSBiZWZvcmUgbWVyZ2VkIG5vZGUuXG4gICAgICAgICAgICAvLyAgICAgICAgIFJlc3VsdGluZyByYW5nZSBzaG91bGQgaW5jbHVkZSBvbmx5IG5vZGVzIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50OlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJlZm9yZTogPHA+YWE8L3A+ezxwPmJ9YjwvcD48cD5jYzwvcD5cbiAgICAgICAgICAgIC8vIE1lcmdlOiAgPHA+YWFifWI8L3A+ezxwPmNjPC9wPlxuICAgICAgICAgICAgLy8gRml4OiAgICA8cD5hYXtifWI8L3A+PHA+Y2M8L3A+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbi5pc0JlZm9yZShvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2FzZSAxLlxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gUG9zaXRpb24uX2NyZWF0ZUF0KGVuZCk7XG4gICAgICAgICAgICAgICAgc3RhcnQub2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvcGVyYXRpb24uZGVsZXRpb25Qb3NpdGlvbi5pc0VxdWFsKHN0YXJ0KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYXNlIDIuXG4gICAgICAgICAgICAgICAgICAgIGVuZCA9IG9wZXJhdGlvbi5kZWxldGlvblBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBJbiBib3RoIGNhc2UgMiBhbmQgMyBzdGFydCBpcyBhdCB0aGUgZW5kIG9mIHRoZSBtZXJnZS10byBlbGVtZW50LlxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gb3BlcmF0aW9uLnRhcmdldFBvc2l0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShzdGFydCwgZW5kKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIG9uZSBvciB0d28ge0BsaW5rIH5SYW5nZSByYW5nZXN9IHRoYXQgYXJlIGEgcmVzdWx0IG9mIHRyYW5zZm9ybWluZyB0aGlzXG5cdCAqIHtAbGluayB+UmFuZ2UgcmFuZ2V9IGJ5IGluc2VydGluZyBgaG93TWFueWAgbm9kZXMgYXQgYGluc2VydFBvc2l0aW9uYC4gVHdvIHtAbGluayB+UmFuZ2UgcmFuZ2VzfSBhcmVcblx0ICogcmV0dXJuZWQgaWYgdGhlIGluc2VydGlvbiB3YXMgaW5zaWRlIHRoaXMge0BsaW5rIH5SYW5nZSByYW5nZX0gYW5kIGBzcHJlYWRgIGlzIHNldCB0byBgdHJ1ZWAuXG5cdCAqXG5cdCAqIEV4YW1wbGVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBsZXQgcmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZShcblx0ICogXHRtb2RlbC5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBbIDIsIDcgXSApLFxuXHQgKiBcdG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgNCwgMCwgMSBdIClcblx0ICogKTtcblx0ICogbGV0IHRyYW5zZm9ybWVkID0gcmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oIG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMSBdICksIDIgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG9uZSByYW5nZSBmcm9tIFsgNCwgNyBdIHRvIFsgNiwgMCwgMSBdXG5cdCAqXG5cdCAqIHRyYW5zZm9ybWVkID0gcmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oIG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgNCwgMCwgMCBdICksIDQgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG9uZSByYW5nZSBmcm9tIFsgMiwgNyBdIHRvIFsgNCwgMCwgNSBdXG5cdCAqXG5cdCAqIHRyYW5zZm9ybWVkID0gcmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oIG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIFsgMywgMiBdICksIDQgKTtcblx0ICogLy8gdHJhbnNmb3JtZWQgYXJyYXkgaGFzIG9uZSByYW5nZSwgd2hpY2ggaXMgZXF1YWwgdG8gb3JpZ2luYWwgcmFuZ2Vcblx0ICpcblx0ICogdHJhbnNmb3JtZWQgPSByYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbiggbW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aCggcm9vdCwgWyAzLCAyIF0gKSwgNCwgdHJ1ZSApO1xuXHQgKiAvLyB0cmFuc2Zvcm1lZCBhcnJheSBoYXMgdHdvIHJhbmdlczogZnJvbSBbIDIsIDcgXSB0byBbIDMsIDIgXSBhbmQgZnJvbSBbIDMsIDYgXSB0byBbIDQsIDAsIDEgXVxuXHQgKiBgYGBcblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBpbnNlcnRQb3NpdGlvbiBQb3NpdGlvbiB3aGVyZSBub2RlcyBhcmUgaW5zZXJ0ZWQuXG5cdCAqIEBwYXJhbSBob3dNYW55IEhvdyBtYW55IG5vZGVzIGFyZSBpbnNlcnRlZC5cblx0ICogQHBhcmFtIHNwcmVhZCBGbGFnIGluZGljYXRpbmcgd2hldGhlciB0aGlzIHJhbmdlIHNob3VsZCBiZSBzcHJlYWQgaWYgaW5zZXJ0aW9uXG5cdCAqIHdhcyBpbnNpZGUgdGhlIHJhbmdlLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuXHQgKiBAcmV0dXJucyBSZXN1bHQgb2YgdGhlIHRyYW5zZm9ybWF0aW9uLlxuXHQgKi8gX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oaW5zZXJ0UG9zaXRpb24sIGhvd01hbnksIHNwcmVhZCA9IGZhbHNlKSB7XG4gICAgICAgIGlmIChzcHJlYWQgJiYgdGhpcy5jb250YWluc1Bvc2l0aW9uKGluc2VydFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgLy8gUmFuZ2UgaGFzIHRvIGJlIHNwcmVhZC4gVGhlIGZpcnN0IHBhcnQgaXMgZnJvbSBvcmlnaW5hbCBzdGFydCB0byB0aGUgc3ByZWFkIHBvaW50LlxuICAgICAgICAgICAgLy8gVGhlIG90aGVyIHBhcnQgaXMgZnJvbSBzcHJlYWQgcG9pbnQgdG8gdGhlIG9yaWdpbmFsIGVuZCwgYnV0IHRyYW5zZm9ybWVkIGJ5XG4gICAgICAgICAgICAvLyBpbnNlcnRpb24gdG8gcmVmbGVjdCBpbnNlcnRpb24gY2hhbmdlcy5cbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IFJhbmdlKHRoaXMuc3RhcnQsIGluc2VydFBvc2l0aW9uKSxcbiAgICAgICAgICAgICAgICBuZXcgUmFuZ2UoaW5zZXJ0UG9zaXRpb24uZ2V0U2hpZnRlZEJ5KGhvd01hbnkpLCB0aGlzLmVuZC5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihpbnNlcnRQb3NpdGlvbiwgaG93TWFueSkpXG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBuZXcgUmFuZ2UodGhpcy5zdGFydCwgdGhpcy5lbmQpO1xuICAgICAgICAgICAgcmFuZ2Uuc3RhcnQgPSByYW5nZS5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihpbnNlcnRQb3NpdGlvbiwgaG93TWFueSk7XG4gICAgICAgICAgICByYW5nZS5lbmQgPSByYW5nZS5lbmQuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oaW5zZXJ0UG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICByYW5nZVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHtAbGluayB+UmFuZ2UgcmFuZ2VzfSB0aGF0IGFyZSBhIHJlc3VsdCBvZiB0cmFuc2Zvcm1pbmcgdGhpc1xuXHQgKiB7QGxpbmsgflJhbmdlIHJhbmdlfSBieSBtb3ZpbmcgYGhvd01hbnlgIG5vZGVzIGZyb20gYHNvdXJjZVBvc2l0aW9uYCB0byBgdGFyZ2V0UG9zaXRpb25gLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHNvdXJjZVBvc2l0aW9uIFBvc2l0aW9uIGZyb20gd2hpY2ggbm9kZXMgYXJlIG1vdmVkLlxuXHQgKiBAcGFyYW0gdGFyZ2V0UG9zaXRpb24gUG9zaXRpb24gdG8gd2hlcmUgbm9kZXMgYXJlIG1vdmVkLlxuXHQgKiBAcGFyYW0gaG93TWFueSBIb3cgbWFueSBub2RlcyBhcmUgbW92ZWQuXG5cdCAqIEBwYXJhbSBzcHJlYWQgV2hldGhlciB0aGUgcmFuZ2Ugc2hvdWxkIGJlIHNwcmVhZCBpZiB0aGUgbW92ZSBwb2ludHMgaW5zaWRlIHRoZSByYW5nZS5cblx0ICogQHJldHVybnMgIFJlc3VsdCBvZiB0aGUgdHJhbnNmb3JtYXRpb24uXG5cdCAqLyBfZ2V0VHJhbnNmb3JtZWRCeU1vdmUoc291cmNlUG9zaXRpb24sIHRhcmdldFBvc2l0aW9uLCBob3dNYW55LCBzcHJlYWQgPSBmYWxzZSkge1xuICAgICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIHRyYW5zZm9ybWluZyBhIGNvbGxhcHNlZCByYW5nZS4gSnVzdCB0cmFuc2Zvcm0gaXQgbGlrZSBhIHBvc2l0aW9uLlxuICAgICAgICBpZiAodGhpcy5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3UG9zID0gdGhpcy5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUoc291cmNlUG9zaXRpb24sIHRhcmdldFBvc2l0aW9uLCBob3dNYW55KTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IFJhbmdlKG5ld1BvcylcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciB0cmFuc2Zvcm1hdGlvbiB3aGVuIGEgcGFydCBvZiB0aGUgcmFuZ2UgaXMgbW92ZWQgdG93YXJkcyB0aGUgcmFuZ2UuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEV4YW1wbGVzOlxuICAgICAgICAvL1xuICAgICAgICAvLyA8ZGl2PjxwPmFiPC9wPjxwPmNbZDwvcD48L2Rpdj48cD5lXWY8L3A+IC0tPiA8ZGl2PjxwPmFiPC9wPjwvZGl2PjxwPmNbZDwvcD48cD5lXWY8L3A+XG4gICAgICAgIC8vIDxwPmVbZjwvcD48ZGl2PjxwPmFdYjwvcD48cD5jZDwvcD48L2Rpdj4gLS0+IDxwPmVbZjwvcD48cD5hXWI8L3A+PGRpdj48cD5jZDwvcD48L2Rpdj5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gV2l0aG91dCB0aGlzIHNwZWNpYWwgY29uZGl0aW9uLCB0aGUgZGVmYXVsdCBhbGdvcml0aG0gbGVhdmVzIGFuIFwiYXJ0aWZhY3RcIiByYW5nZSBmcm9tIG9uZSBvZiBgZGlmZmVyZW5jZVNldGAgcGFydHM6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxkaXY+PHA+YWI8L3A+PHA+Y1tkPC9wPjwvZGl2PjxwPmVdZjwvcD4gLS0+IDxkaXY+PHA+YWI8L3A+ezwvZGl2Pn08cD5jW2Q8L3A+PHA+ZV1mPC9wPlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGlzIHNwZWNpYWwgY2FzZSBpcyBhcHBsaWVkIG9ubHkgaWYgdGhlIHJhbmdlIGlzIHRvIGJlIGtlcHQgdG9nZXRoZXIgKG5vdCBzcHJlYWQpLlxuICAgICAgICBjb25zdCBtb3ZlUmFuZ2UgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQoc291cmNlUG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICBjb25zdCBpbnNlcnRQb3NpdGlvbiA9IHRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oc291cmNlUG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICBpZiAodGhpcy5jb250YWluc1Bvc2l0aW9uKHRhcmdldFBvc2l0aW9uKSAmJiAhc3ByZWFkKSB7XG4gICAgICAgICAgICBpZiAobW92ZVJhbmdlLmNvbnRhaW5zUG9zaXRpb24odGhpcy5zdGFydCkgfHwgbW92ZVJhbmdlLmNvbnRhaW5zUG9zaXRpb24odGhpcy5lbmQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLnN0YXJ0Ll9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShzb3VyY2VQb3NpdGlvbiwgdGFyZ2V0UG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHRoaXMuZW5kLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShzb3VyY2VQb3NpdGlvbiwgdGFyZ2V0UG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgIG5ldyBSYW5nZShzdGFydCwgZW5kKVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRGVmYXVsdCBhbGdvcml0aG0uXG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGNvbnN0IGRpZmZlcmVuY2VTZXQgPSB0aGlzLmdldERpZmZlcmVuY2UobW92ZVJhbmdlKTtcbiAgICAgICAgbGV0IGRpZmZlcmVuY2UgPSBudWxsO1xuICAgICAgICBjb25zdCBjb21tb24gPSB0aGlzLmdldEludGVyc2VjdGlvbihtb3ZlUmFuZ2UpO1xuICAgICAgICBpZiAoZGlmZmVyZW5jZVNldC5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgLy8gYG1vdmVSYW5nZWAgYW5kIHRoaXMgcmFuZ2UgbWF5IGludGVyc2VjdCBidXQgbWF5IGJlIHNlcGFyYXRlLlxuICAgICAgICAgICAgZGlmZmVyZW5jZSA9IG5ldyBSYW5nZShkaWZmZXJlbmNlU2V0WzBdLnN0YXJ0Ll9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oc291cmNlUG9zaXRpb24sIGhvd01hbnkpLCBkaWZmZXJlbmNlU2V0WzBdLmVuZC5fZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKHNvdXJjZVBvc2l0aW9uLCBob3dNYW55KSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZGlmZmVyZW5jZVNldC5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgLy8gYG1vdmVSYW5nZWAgaXMgaW5zaWRlIHRoaXMgcmFuZ2UuXG4gICAgICAgICAgICBkaWZmZXJlbmNlID0gbmV3IFJhbmdlKHRoaXMuc3RhcnQsIHRoaXMuZW5kLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oc291cmNlUG9zaXRpb24sIGhvd01hbnkpKTtcbiAgICAgICAgfSAvLyBlbHNlLCBgbW92ZVJhbmdlYCBjb250YWlucyB0aGlzIHJhbmdlLlxuICAgICAgICBpZiAoZGlmZmVyZW5jZSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gZGlmZmVyZW5jZS5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihpbnNlcnRQb3NpdGlvbiwgaG93TWFueSwgY29tbW9uICE9PSBudWxsIHx8IHNwcmVhZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tbW9uKSB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZENvbW1vbiA9IG5ldyBSYW5nZShjb21tb24uc3RhcnQuX2dldENvbWJpbmVkKG1vdmVSYW5nZS5zdGFydCwgaW5zZXJ0UG9zaXRpb24pLCBjb21tb24uZW5kLl9nZXRDb21iaW5lZChtb3ZlUmFuZ2Uuc3RhcnQsIGluc2VydFBvc2l0aW9uKSk7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnNwbGljZSgxLCAwLCB0cmFuc2Zvcm1lZENvbW1vbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRyYW5zZm9ybWVkQ29tbW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhpcyByYW5nZSB0aGF0IGlzIHRyYW5zZm9ybWVkIGJ5IGRlbGV0aW9uIG9mIGBob3dNYW55YCBub2RlcyBmcm9tIGBkZWxldGVQb3NpdGlvbmAuXG5cdCAqXG5cdCAqIElmIHRoZSBkZWxldGVkIHJhbmdlIGlzIGludGVyc2VjdGluZyB3aXRoIHRoZSB0cmFuc2Zvcm1lZCByYW5nZSwgdGhlIHRyYW5zZm9ybWVkIHJhbmdlIHdpbGwgYmUgc2hyYW5rLlxuXHQgKlxuXHQgKiBJZiB0aGUgZGVsZXRlZCByYW5nZSBjb250YWlucyB0cmFuc2Zvcm1lZCByYW5nZSwgYG51bGxgIHdpbGwgYmUgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZGVsZXRpb25Qb3NpdGlvbiBQb3NpdGlvbiBmcm9tIHdoaWNoIG5vZGVzIGFyZSByZW1vdmVkLlxuXHQgKiBAcGFyYW0gaG93TWFueSBIb3cgbWFueSBub2RlcyBhcmUgcmVtb3ZlZC5cblx0ICogQHJldHVybnMgUmVzdWx0IG9mIHRoZSB0cmFuc2Zvcm1hdGlvbi5cblx0ICovIF9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oZGVsZXRlUG9zaXRpb24sIGhvd01hbnkpIHtcbiAgICAgICAgbGV0IG5ld1N0YXJ0ID0gdGhpcy5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKGRlbGV0ZVBvc2l0aW9uLCBob3dNYW55KTtcbiAgICAgICAgbGV0IG5ld0VuZCA9IHRoaXMuZW5kLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oZGVsZXRlUG9zaXRpb24sIGhvd01hbnkpO1xuICAgICAgICBpZiAobmV3U3RhcnQgPT0gbnVsbCAmJiBuZXdFbmQgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld1N0YXJ0ID09IG51bGwpIHtcbiAgICAgICAgICAgIG5ld1N0YXJ0ID0gZGVsZXRlUG9zaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0VuZCA9PSBudWxsKSB7XG4gICAgICAgICAgICBuZXdFbmQgPSBkZWxldGVQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKG5ld1N0YXJ0LCBuZXdFbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyByYW5nZSwgc3ByZWFkaW5nIGZyb20gc3BlY2lmaWVkIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSB0byBhIHBvc2l0aW9uIG1vdmVkIGJ5XG5cdCAqIGdpdmVuIGBzaGlmdGAuIElmIGBzaGlmdGAgaXMgYSBuZWdhdGl2ZSB2YWx1ZSwgc2hpZnRlZCBwb3NpdGlvbiBpcyB0cmVhdGVkIGFzIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJhbmdlLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHBvc2l0aW9uIEJlZ2lubmluZyBvZiB0aGUgcmFuZ2UuXG5cdCAqIEBwYXJhbSBzaGlmdCBIb3cgbG9uZyB0aGUgcmFuZ2Ugc2hvdWxkIGJlLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChwb3NpdGlvbiwgc2hpZnQpIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBwb3NpdGlvbjtcbiAgICAgICAgY29uc3QgZW5kID0gcG9zaXRpb24uZ2V0U2hpZnRlZEJ5KHNoaWZ0KTtcbiAgICAgICAgcmV0dXJuIHNoaWZ0ID4gMCA/IG5ldyB0aGlzKHN0YXJ0LCBlbmQpIDogbmV3IHRoaXMoZW5kLCBzdGFydCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB3aGljaCBzdGFydHMgYmVmb3JlIHRoZSBmaXJzdCBjaGlsZCBvZlxuXHQgKiB0aGF0IGVsZW1lbnQgYW5kIGVuZHMgYWZ0ZXIgdGhlIGxhc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBpcyBhIHBhcmVudCBmb3IgdGhlIHJhbmdlLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVJbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcyhQb3NpdGlvbi5fY3JlYXRlQXQoZWxlbWVudCwgMCksIFBvc2l0aW9uLl9jcmVhdGVBdChlbGVtZW50LCBlbGVtZW50Lm1heE9mZnNldCkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHRoYXQgc3RhcnRzIGJlZm9yZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbX0gYW5kIGVuZHMgYWZ0ZXIgaXQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gc3RhdGljIF9jcmVhdGVPbihpdGVtKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKGl0ZW0pLCBpdGVtLm9mZnNldFNpemUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29tYmluZXMgYWxsIHJhbmdlcyBmcm9tIHRoZSBwYXNzZWQgYXJyYXkgaW50byBhIG9uZSByYW5nZS4gQXQgbGVhc3Qgb25lIHJhbmdlIGhhcyB0byBiZSBwYXNzZWQuXG5cdCAqIFBhc3NlZCByYW5nZXMgbXVzdCBub3QgaGF2ZSBjb21tb24gcGFydHMuXG5cdCAqXG5cdCAqIFRoZSBmaXJzdCByYW5nZSBmcm9tIHRoZSBhcnJheSBpcyBhIHJlZmVyZW5jZSByYW5nZS4gSWYgb3RoZXIgcmFuZ2VzIHN0YXJ0IG9yIGVuZCBvbiB0aGUgZXhhY3RseSBzYW1lIHBvc2l0aW9uIHdoZXJlXG5cdCAqIHRoZSByZWZlcmVuY2UgcmFuZ2UsIHRoZXkgZ2V0IGNvbWJpbmVkIGludG8gb25lIHJhbmdlLlxuXHQgKlxuXHQgKiBgYGBcblx0ICogWyAgXVtdICBbICAgIF1bIF1bICAgICAgICAgICAgIF1bIF1bXSAgWyAgXSAgLy8gUGFzc2VkIHJhbmdlcywgc2hvd24gc29ydGVkXG5cdCAqIFsgICAgXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uIGlmIHRoZSBmaXJzdCByYW5nZSB3YXMgYSByZWZlcmVuY2UgcmFuZ2UuXG5cdCAqICAgICAgICAgWyAgICAgICAgICAgICAgICAgICAgICAgICAgIF0gICAgICAgIC8vIFRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uIGlmIHRoZSB0aGlyZC10by1zZXZlbnRoIHJhbmdlIHdhcyBhIHJlZmVyZW5jZSByYW5nZS5cblx0ICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWyAgXSAgLy8gVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24gaWYgdGhlIGxhc3QgcmFuZ2Ugd2FzIGEgcmVmZXJlbmNlIHJhbmdlLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSByYW5nZXMgUmFuZ2VzIHRvIGNvbWJpbmUuXG5cdCAqIEByZXR1cm5zIENvbWJpbmVkIHJhbmdlLlxuXHQgKi8gc3RhdGljIF9jcmVhdGVGcm9tUmFuZ2VzKHJhbmdlcykge1xuICAgICAgICBpZiAocmFuZ2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBBdCBsZWFzdCBvbmUgcmFuZ2UgaGFzIHRvIGJlIHBhc3NlZCB0b1xuXHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UuX2NyZWF0ZUZyb21SYW5nZXMgYFJhbmdlLl9jcmVhdGVGcm9tUmFuZ2VzKClgfS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgcmFuZ2UtY3JlYXRlLWZyb20tcmFuZ2VzLWVtcHR5LWFycmF5XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3JhbmdlLWNyZWF0ZS1mcm9tLXJhbmdlcy1lbXB0eS1hcnJheScsIG51bGwpO1xuICAgICAgICB9IGVsc2UgaWYgKHJhbmdlcy5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHJhbmdlc1swXS5jbG9uZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIDEuIFNldCB0aGUgZmlyc3QgcmFuZ2UgaW4gYHJhbmdlc2AgYXJyYXkgYXMgYSByZWZlcmVuY2UgcmFuZ2UuXG4gICAgICAgIC8vIElmIHdlIGFyZSBnb2luZyB0byByZXR1cm4ganVzdCBhIG9uZSByYW5nZSwgb25lIG9mIHRoZSByYW5nZXMgbmVlZCB0byBiZSB0aGUgcmVmZXJlbmNlIG9uZS5cbiAgICAgICAgLy8gT3RoZXIgcmFuZ2VzIHdpbGwgYmUgc3R1Y2sgdG8gdGhhdCByYW5nZSwgaWYgcG9zc2libGUuXG4gICAgICAgIGNvbnN0IHJlZiA9IHJhbmdlc1swXTtcbiAgICAgICAgLy8gMi4gU29ydCBhbGwgdGhlIHJhbmdlcywgc28gaXQncyBlYXNpZXIgdG8gcHJvY2VzcyB0aGVtLlxuICAgICAgICByYW5nZXMuc29ydCgoYSwgYik9PntcbiAgICAgICAgICAgIHJldHVybiBhLnN0YXJ0LmlzQWZ0ZXIoYi5zdGFydCkgPyAxIDogLTE7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyAzLiBDaGVjayBhdCB3aGljaCBpbmRleCB0aGUgcmVmZXJlbmNlIHJhbmdlIGlzIG5vdy5cbiAgICAgICAgY29uc3QgcmVmSW5kZXggPSByYW5nZXMuaW5kZXhPZihyZWYpO1xuICAgICAgICAvLyA0LiBBdCB0aGlzIG1vbWVudCB3ZSBkb24ndCBuZWVkIHRoZSBvcmlnaW5hbCByYW5nZS5cbiAgICAgICAgLy8gV2UgYXJlIGdvaW5nIHRvIG1vZGlmeSB0aGUgcmVzdWx0LCBhbmQgd2UgbmVlZCB0byByZXR1cm4gYSBuZXcgaW5zdGFuY2Ugb2YgUmFuZ2UuXG4gICAgICAgIC8vIFdlIGhhdmUgdG8gY3JlYXRlIGEgY29weSBvZiB0aGUgcmVmZXJlbmNlIHJhbmdlLlxuICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgdGhpcyhyZWYuc3RhcnQsIHJlZi5lbmQpO1xuICAgICAgICAvLyA1LiBSYW5nZXMgc2hvdWxkIGJlIGNoZWNrZWQgYW5kIGdsdWVkIHN0YXJ0aW5nIGZyb20gdGhlIHJhbmdlIHRoYXQgaXMgY2xvc2VzdCB0byB0aGUgcmVmZXJlbmNlIHJhbmdlLlxuICAgICAgICAvLyBTaW5jZSByYW5nZXMgYXJlIHNvcnRlZCwgc3RhcnQgd2l0aCB0aGUgcmFuZ2Ugd2l0aCBpbmRleCB0aGF0IGlzIGNsb3Nlc3QgdG8gcmVmZXJlbmNlIHJhbmdlIGluZGV4LlxuICAgICAgICBmb3IobGV0IGkgPSByZWZJbmRleCAtIDE7IGkgPj0gMDsgaS0tKXtcbiAgICAgICAgICAgIGlmIChyYW5nZXNbaV0uZW5kLmlzRXF1YWwocmVzdWx0LnN0YXJ0KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGFydCA9IFBvc2l0aW9uLl9jcmVhdGVBdChyYW5nZXNbaV0uc3RhcnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyA2LiBSYW5nZXMgc2hvdWxkIGJlIGNoZWNrZWQgYW5kIGdsdWVkIHN0YXJ0aW5nIGZyb20gdGhlIHJhbmdlIHRoYXQgaXMgY2xvc2VzdCB0byB0aGUgcmVmZXJlbmNlIHJhbmdlLlxuICAgICAgICAvLyBTaW5jZSByYW5nZXMgYXJlIHNvcnRlZCwgc3RhcnQgd2l0aCB0aGUgcmFuZ2Ugd2l0aCBpbmRleCB0aGF0IGlzIGNsb3Nlc3QgdG8gcmVmZXJlbmNlIHJhbmdlIGluZGV4LlxuICAgICAgICBmb3IobGV0IGkgPSByZWZJbmRleCArIDE7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgaWYgKHJhbmdlc1tpXS5zdGFydC5pc0VxdWFsKHJlc3VsdC5lbmQpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmVuZCA9IFBvc2l0aW9uLl9jcmVhdGVBdChyYW5nZXNbaV0uZW5kKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBgUmFuZ2VgIGluc3RhbmNlIGZyb20gZ2l2ZW4gcGxhaW4gb2JqZWN0IChpLmUuIHBhcnNlZCBKU09OIHN0cmluZykuXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIFBsYWluIG9iamVjdCB0byBiZSBjb252ZXJ0ZWQgdG8gYFJhbmdlYC5cblx0ICogQHBhcmFtIGRvYyBEb2N1bWVudCBvYmplY3QgdGhhdCB3aWxsIGJlIHJhbmdlIG93bmVyLlxuXHQgKiBAcmV0dXJucyBgUmFuZ2VgIGluc3RhbmNlIGNyZWF0ZWQgdXNpbmcgZ2l2ZW4gcGxhaW4gb2JqZWN0LlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24sIGRvYykge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMoUG9zaXRpb24uZnJvbUpTT04oanNvbi5zdGFydCwgZG9jKSwgUG9zaXRpb24uZnJvbUpTT04oanNvbi5lbmQsIGRvYykpO1xuICAgIH1cbn1cbi8vIFRoZSBtYWdpYyBvZiB0eXBlIGluZmVyZW5jZSB1c2luZyBgaXNgIG1ldGhvZCBpcyBjZW50cmFsaXplZCBpbiBgVHlwZUNoZWNrYWJsZWAgY2xhc3MuXG4vLyBQcm9wZXIgb3ZlcmxvYWQgd291bGQgaW50ZXJmZXJlIHdpdGggdGhhdC5cblJhbmdlLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ3JhbmdlJyB8fCB0eXBlID09PSAnbW9kZWw6cmFuZ2UnO1xufTtcblxuLyoqXG4gKiBNYXBzIGVsZW1lbnRzLCBwb3NpdGlvbnMgYW5kIG1hcmtlcnMgYmV0d2VlbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCB2aWV3fSBhbmRcbiAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbCBtb2RlbH0uXG4gKlxuICogVGhlIGluc3RhbmNlIG9mIHRoZSBNYXBwZXIgdXNlZCBmb3IgdGhlIGVkaXRpbmcgcGlwZWxpbmUgaXMgYXZhaWxhYmxlIGluXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2VkaXRpbmdjb250cm9sbGVyfkVkaXRpbmdDb250cm9sbGVyI21hcHBlciBgZWRpdG9yLmVkaXRpbmcubWFwcGVyYH0uXG4gKlxuICogTWFwcGVyIHVzZXMgYm91bmQgZWxlbWVudHMgdG8gZmluZCBjb3JyZXNwb25kaW5nIGVsZW1lbnRzIGFuZCBwb3NpdGlvbnMsIHNvLCB0byBnZXQgcHJvcGVyIHJlc3VsdHMsXG4gKiBhbGwgbW9kZWwgZWxlbWVudHMgc2hvdWxkIGJlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlciNiaW5kRWxlbWVudHMgYm91bmR9LlxuICpcbiAqIFRvIG1hcCB0aGUgY29tcGxleCBtb2RlbCB0by9mcm9tIHZpZXcgcmVsYXRpb25zLCB5b3UgbWF5IHByb3ZpZGUgY3VzdG9tIGNhbGxiYWNrcyBmb3IgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXIjZXZlbnQ6bW9kZWxUb1ZpZXdQb3NpdGlvbiBtb2RlbFRvVmlld1Bvc2l0aW9uIGV2ZW50fSBhbmRcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlciNldmVudDp2aWV3VG9Nb2RlbFBvc2l0aW9uIHZpZXdUb01vZGVsUG9zaXRpb24gZXZlbnR9IHRoYXQgYXJlIGZpcmVkIHdoZW5ldmVyXG4gKiBhIHBvc2l0aW9uIG1hcHBpbmcgcmVxdWVzdCBvY2N1cnMuXG4gKiBUaG9zZSBldmVudHMgYXJlIGZpcmVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXIjdG9WaWV3UG9zaXRpb24gdG9WaWV3UG9zaXRpb259XG4gKiBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tYXBwZXJ+TWFwcGVyI3RvTW9kZWxQb3NpdGlvbiB0b01vZGVsUG9zaXRpb259IG1ldGhvZHMuIGBNYXBwZXJgIGFkZHMgaXRzIG93biBkZWZhdWx0IGNhbGxiYWNrc1xuICogd2l0aCBgJ2xvd2VzdCdgIHByaW9yaXR5LiBUbyBvdmVycmlkZSBkZWZhdWx0IGBNYXBwZXJgIG1hcHBpbmcsIGFkZCBjdXN0b20gY2FsbGJhY2sgd2l0aCBoaWdoZXIgcHJpb3JpdHkgYW5kXG4gKiBzdG9wIHRoZSBldmVudC5cbiAqLyBjbGFzcyBNYXBwZXIgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKCkge1xuICAgIC8qKlxuXHQgKiBNb2RlbCBlbGVtZW50IHRvIHZpZXcgZWxlbWVudCBtYXBwaW5nLlxuXHQgKi8gX21vZGVsVG9WaWV3TWFwcGluZyA9IG5ldyBXZWFrTWFwKCk7XG4gICAgLyoqXG5cdCAqIFZpZXcgZWxlbWVudCB0byBtb2RlbCBlbGVtZW50IG1hcHBpbmcuXG5cdCAqLyBfdmlld1RvTW9kZWxNYXBwaW5nID0gbmV3IFdlYWtNYXAoKTtcbiAgICAvKipcblx0ICogQSBtYXAgY29udGFpbmluZyBjYWxsYmFja3MgYmV0d2VlbiB2aWV3IGVsZW1lbnQgbmFtZXMgYW5kIGZ1bmN0aW9ucyBldmFsdWF0aW5nIGxlbmd0aCBvZiB2aWV3IGVsZW1lbnRzXG5cdCAqIGluIG1vZGVsLlxuXHQgKi8gX3ZpZXdUb01vZGVsTGVuZ3RoQ2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBNb2RlbCBtYXJrZXIgbmFtZSB0byB2aWV3IGVsZW1lbnRzIG1hcHBpbmcuXG5cdCAqXG5cdCAqIEtleXMgYXJlIGBTdHJpbmdgcyB3aGlsZSB2YWx1ZXMgYXJlIGBTZXRgcyB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudHN9LlxuXHQgKiBPbmUgbWFya2VyIChuYW1lKSBjYW4gYmUgbWFwcGVkIHRvIG11bHRpcGxlIGVsZW1lbnRzLlxuXHQgKi8gX21hcmtlck5hbWVUb0VsZW1lbnRzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBWaWV3IGVsZW1lbnQgdG8gbW9kZWwgbWFya2VyIG5hbWVzIG1hcHBpbmcuXG5cdCAqXG5cdCAqIFRoaXMgaXMgcmV2ZXJzZSB0byB7QGxpbmsgfk1hcHBlciNfbWFya2VyTmFtZVRvRWxlbWVudHN9IG1hcC5cblx0ICovIF9lbGVtZW50VG9NYXJrZXJOYW1lcyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogVGhlIG1hcCBvZiByZW1vdmVkIHZpZXcgZWxlbWVudHMgd2l0aCB0aGVpciBjdXJyZW50IHJvb3QgKHVzZWQgZm9yIGRlZmVycmVkIHVuYmluZGluZykuXG5cdCAqLyBfZGVmZXJyZWRCaW5kaW5nUmVtb3ZhbHMgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIFN0b3JlcyBtYXJrZXIgbmFtZXMgb2YgbWFya2VycyB3aGljaCBoYXZlIGNoYW5nZWQgZHVlIHRvIHVuYmluZGluZyBhIHZpZXcgZWxlbWVudCAoc28gaXQgaXMgYXNzdW1lZCB0aGF0IHRoZSB2aWV3IGVsZW1lbnRcblx0ICogaGFzIGJlZW4gcmVtb3ZlZCwgbW92ZWQgb3IgcmVuYW1lZCkuXG5cdCAqLyBfdW5ib3VuZE1hcmtlck5hbWVzID0gbmV3IFNldCgpO1xuICAgIC8qKlxuXHQgKiBNYW5hZ2VzIGR5bmFtaWMgY2FjaGUgZm9yIHRoZSBgTWFwcGVyYCB0byBpbXByb3ZlIHRoZSBwZXJmb3JtYW5jZS5cblx0ICovIF9jYWNoZSA9IG5ldyBNYXBwZXJDYWNoZSgpO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBtYXBwZXIuXG5cdCAqLyBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICAvLyBEZWZhdWx0IG1hcHBlciBhbGdvcml0aG0gZm9yIG1hcHBpbmcgbW9kZWwgcG9zaXRpb24gdG8gdmlldyBwb3NpdGlvbi5cbiAgICAgICAgdGhpcy5vbignbW9kZWxUb1ZpZXdQb3NpdGlvbicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAoZGF0YS52aWV3UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2aWV3Q29udGFpbmVyID0gdGhpcy5fbW9kZWxUb1ZpZXdNYXBwaW5nLmdldChkYXRhLm1vZGVsUG9zaXRpb24ucGFyZW50KTtcbiAgICAgICAgICAgIGlmICghdmlld0NvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBBIG1vZGVsIHBvc2l0aW9uIGNvdWxkIG5vdCBiZSBtYXBwZWQgdG8gdGhlIHZpZXcgYmVjYXVzZSB0aGUgcGFyZW50IG9mIHRoZSBtb2RlbCBwb3NpdGlvblxuXHRcdFx0XHQgKiBkb2VzIG5vdCBoYXZlIGEgbWFwcGVkIHZpZXcgZWxlbWVudCAobWlnaHQgaGF2ZSBub3QgYmVlbiBjb252ZXJ0ZWQgeWV0IG9yIGl0IGhhcyBubyBjb252ZXJ0ZXIpLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBNYWtlIHN1cmUgdGhhdCB0aGUgbW9kZWwgZWxlbWVudCBpcyBjb3JyZWN0bHkgY29udmVydGVkIHRvIHRoZSB2aWV3LlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgbWFwcGluZy1tb2RlbC1wb3NpdGlvbi12aWV3LXBhcmVudC1ub3QtZm91bmRcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtYXBwaW5nLW1vZGVsLXBvc2l0aW9uLXZpZXctcGFyZW50LW5vdC1mb3VuZCcsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWxQb3NpdGlvbjogZGF0YS5tb2RlbFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhLnZpZXdQb3NpdGlvbiA9IHRoaXMuZmluZFBvc2l0aW9uSW4odmlld0NvbnRhaW5lciwgZGF0YS5tb2RlbFBvc2l0aW9uLm9mZnNldCk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gRGVmYXVsdCBtYXBwZXIgYWxnb3JpdGhtIGZvciBtYXBwaW5nIHZpZXcgcG9zaXRpb24gdG8gbW9kZWwgcG9zaXRpb24uXG4gICAgICAgIHRoaXMub24oJ3ZpZXdUb01vZGVsUG9zaXRpb24nLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgaWYgKGRhdGEubW9kZWxQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHZpZXdCbG9jayA9IHRoaXMuZmluZE1hcHBlZFZpZXdBbmNlc3RvcihkYXRhLnZpZXdQb3NpdGlvbik7XG4gICAgICAgICAgICBjb25zdCBtb2RlbFBhcmVudCA9IHRoaXMuX3ZpZXdUb01vZGVsTWFwcGluZy5nZXQodmlld0Jsb2NrKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsT2Zmc2V0ID0gdGhpcy5fdG9Nb2RlbE9mZnNldChkYXRhLnZpZXdQb3NpdGlvbi5wYXJlbnQsIGRhdGEudmlld1Bvc2l0aW9uLm9mZnNldCwgdmlld0Jsb2NrKTtcbiAgICAgICAgICAgIGRhdGEubW9kZWxQb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChtb2RlbFBhcmVudCwgbW9kZWxPZmZzZXQpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYXJrcyBtb2RlbCBhbmQgdmlldyBlbGVtZW50cyBhcyBjb3JyZXNwb25kaW5nLiBDb3JyZXNwb25kaW5nIGVsZW1lbnRzIGNhbiBiZSByZXRyaWV2ZWQgYnkgdXNpbmdcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlciN0b01vZGVsRWxlbWVudCB0b01vZGVsRWxlbWVudH0gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlciN0b1ZpZXdFbGVtZW50IHRvVmlld0VsZW1lbnR9IG1ldGhvZHMuXG5cdCAqIFRoZSBpbmZvcm1hdGlvbiB0aGF0IGVsZW1lbnRzIGFyZSBib3VuZCBpcyBhbHNvIHVzZWQgdG8gdHJhbnNsYXRlIHBvc2l0aW9ucy5cblx0ICpcblx0ICogQHBhcmFtIG1vZGVsRWxlbWVudCBNb2RlbCBlbGVtZW50LlxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnQgVmlldyBlbGVtZW50LlxuXHQgKi8gYmluZEVsZW1lbnRzKG1vZGVsRWxlbWVudCwgdmlld0VsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fbW9kZWxUb1ZpZXdNYXBwaW5nLnNldChtb2RlbEVsZW1lbnQsIHZpZXdFbGVtZW50KTtcbiAgICAgICAgdGhpcy5fdmlld1RvTW9kZWxNYXBwaW5nLnNldCh2aWV3RWxlbWVudCwgbW9kZWxFbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVuYmluZHMgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0gZnJvbSB0aGUgbWFwLlxuXHQgKlxuXHQgKiAqKk5vdGU6Kiogdmlldy10by1tb2RlbCBiaW5kaW5nIHdpbGwgYmUgcmVtb3ZlZCwgaWYgaXQgZXhpc3RlZC4gSG93ZXZlciwgY29ycmVzcG9uZGluZyBtb2RlbC10by12aWV3IGJpbmRpbmdcblx0ICogd2lsbCBiZSByZW1vdmVkIG9ubHkgaWYgbW9kZWwgZWxlbWVudCBpcyBzdGlsbCBib3VuZCB0byB0aGUgcGFzc2VkIGB2aWV3RWxlbWVudGAuXG5cdCAqXG5cdCAqIFRoaXMgYmVoYXZpb3IgYWxsb3dzIGZvciByZS1iaW5kaW5nIG1vZGVsIGVsZW1lbnQgdG8gYW5vdGhlciB2aWV3IGVsZW1lbnQgd2l0aG91dCBmZWFyIG9mIGxvc2luZyB0aGUgbmV3IGJpbmRpbmdcblx0ICogd2hlbiB0aGUgcHJldmlvdXNseSBib3VuZCB2aWV3IGVsZW1lbnQgaXMgdW5ib3VuZC5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdFbGVtZW50IFZpZXcgZWxlbWVudCB0byB1bmJpbmQuXG5cdCAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuZGVmZXIgQ29udHJvbHMgd2hldGhlciB0aGUgYmluZGluZyBzaG91bGQgYmUgcmVtb3ZlZCBpbW1lZGlhdGVseSBvciBkZWZlcnJlZCB1bnRpbCBhXG5cdCAqIHtAbGluayAjZmx1c2hEZWZlcnJlZEJpbmRpbmdzIGBmbHVzaERlZmVycmVkQmluZGluZ3MoKWB9IGNhbGwuXG5cdCAqLyB1bmJpbmRWaWV3RWxlbWVudCh2aWV3RWxlbWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IG1vZGVsRWxlbWVudCA9IHRoaXMudG9Nb2RlbEVsZW1lbnQodmlld0VsZW1lbnQpO1xuICAgICAgICBpZiAodGhpcy5fZWxlbWVudFRvTWFya2VyTmFtZXMuaGFzKHZpZXdFbGVtZW50KSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBtYXJrZXJOYW1lIG9mIHRoaXMuX2VsZW1lbnRUb01hcmtlck5hbWVzLmdldCh2aWV3RWxlbWVudCkpe1xuICAgICAgICAgICAgICAgIHRoaXMuX3VuYm91bmRNYXJrZXJOYW1lcy5hZGQobWFya2VyTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZGVmZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2RlZmVycmVkQmluZGluZ1JlbW92YWxzLnNldCh2aWV3RWxlbWVudCwgdmlld0VsZW1lbnQucm9vdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB3YXNGb3VuZCA9IHRoaXMuX3ZpZXdUb01vZGVsTWFwcGluZy5kZWxldGUodmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKHdhc0ZvdW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gU3RvcCB0cmFja2luZyBhZnRlciB0aGUgZWxlbWVudCBpcyBubyBsb25nZXIgbWFwcGVkLiBXZSB3YW50IHRvIHRyYWNrIGFsbCBtYXBwZWQgZWxlbWVudHMgYW5kIG9ubHkgbWFwcGVkIGVsZW1lbnRzLlxuICAgICAgICAgICAgICAgIHRoaXMuX2NhY2hlLnN0b3BUcmFja2luZyh2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fbW9kZWxUb1ZpZXdNYXBwaW5nLmdldChtb2RlbEVsZW1lbnQpID09IHZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWxUb1ZpZXdNYXBwaW5nLmRlbGV0ZShtb2RlbEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbmJpbmRzIHRoZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgbW9kZWwgZWxlbWVudH0gZnJvbSB0aGUgbWFwLlxuXHQgKlxuXHQgKiAqKk5vdGU6KiogdGhlIG1vZGVsLXRvLXZpZXcgYmluZGluZyB3aWxsIGJlIHJlbW92ZWQsIGlmIGl0IGV4aXN0ZWQuIEhvd2V2ZXIsIHRoZSBjb3JyZXNwb25kaW5nIHZpZXctdG8tbW9kZWwgYmluZGluZ1xuXHQgKiB3aWxsIGJlIHJlbW92ZWQgb25seSBpZiB0aGUgdmlldyBlbGVtZW50IGlzIHN0aWxsIGJvdW5kIHRvIHRoZSBwYXNzZWQgYG1vZGVsRWxlbWVudGAuXG5cdCAqXG5cdCAqIFRoaXMgYmVoYXZpb3IgbGV0cyBmb3IgcmUtYmluZGluZyB2aWV3IGVsZW1lbnQgdG8gYW5vdGhlciBtb2RlbCBlbGVtZW50IHdpdGhvdXQgZmVhciBvZiBsb3NpbmcgdGhlIG5ldyBiaW5kaW5nXG5cdCAqIHdoZW4gdGhlIHByZXZpb3VzbHkgYm91bmQgbW9kZWwgZWxlbWVudCBpcyB1bmJvdW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gbW9kZWxFbGVtZW50IE1vZGVsIGVsZW1lbnQgdG8gdW5iaW5kLlxuXHQgKi8gdW5iaW5kTW9kZWxFbGVtZW50KG1vZGVsRWxlbWVudCkge1xuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHRoaXMudG9WaWV3RWxlbWVudChtb2RlbEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl9tb2RlbFRvVmlld01hcHBpbmcuZGVsZXRlKG1vZGVsRWxlbWVudCk7XG4gICAgICAgIGlmICh0aGlzLl92aWV3VG9Nb2RlbE1hcHBpbmcuZ2V0KHZpZXdFbGVtZW50KSA9PSBtb2RlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhc0ZvdW5kID0gdGhpcy5fdmlld1RvTW9kZWxNYXBwaW5nLmRlbGV0ZSh2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICBpZiAod2FzRm91bmQpIHtcbiAgICAgICAgICAgICAgICAvLyBTdG9wIHRyYWNraW5nIGFmdGVyIHRoZSBlbGVtZW50IGlzIG5vIGxvbmdlciBtYXBwZWQuIFdlIHdhbnQgdG8gdHJhY2sgYWxsIG1hcHBlZCBlbGVtZW50cyBhbmQgb25seSBtYXBwZWQgZWxlbWVudHMuXG4gICAgICAgICAgICAgICAgdGhpcy5fY2FjaGUuc3RvcFRyYWNraW5nKHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgdGhlIGdpdmVuIG1hcmtlciBuYW1lIHdpdGggdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0uIFRoZSBlbGVtZW50XG5cdCAqIHdpbGwgYmUgYWRkZWQgdG8gdGhlIGN1cnJlbnQgc2V0IG9mIGVsZW1lbnRzIGJvdW5kIHdpdGggdGhlIGdpdmVuIG1hcmtlciBuYW1lLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIGJpbmQuXG5cdCAqIEBwYXJhbSBuYW1lIE1hcmtlciBuYW1lLlxuXHQgKi8gYmluZEVsZW1lbnRUb01hcmtlcihlbGVtZW50LCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5fbWFya2VyTmFtZVRvRWxlbWVudHMuZ2V0KG5hbWUpIHx8IG5ldyBTZXQoKTtcbiAgICAgICAgZWxlbWVudHMuYWRkKGVsZW1lbnQpO1xuICAgICAgICBjb25zdCBuYW1lcyA9IHRoaXMuX2VsZW1lbnRUb01hcmtlck5hbWVzLmdldChlbGVtZW50KSB8fCBuZXcgU2V0KCk7XG4gICAgICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgICAgICAgdGhpcy5fbWFya2VyTmFtZVRvRWxlbWVudHMuc2V0KG5hbWUsIGVsZW1lbnRzKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudFRvTWFya2VyTmFtZXMuc2V0KGVsZW1lbnQsIG5hbWVzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVuYmluZHMgYW4gZWxlbWVudCBmcm9tIGdpdmVuIG1hcmtlciBuYW1lLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIHVuYmluZC5cblx0ICogQHBhcmFtIG5hbWUgTWFya2VyIG5hbWUuXG5cdCAqLyB1bmJpbmRFbGVtZW50RnJvbU1hcmtlck5hbWUoZWxlbWVudCwgbmFtZSkge1xuICAgICAgICBjb25zdCBuYW1lVG9FbGVtZW50cyA9IHRoaXMuX21hcmtlck5hbWVUb0VsZW1lbnRzLmdldChuYW1lKTtcbiAgICAgICAgaWYgKG5hbWVUb0VsZW1lbnRzKSB7XG4gICAgICAgICAgICBuYW1lVG9FbGVtZW50cy5kZWxldGUoZWxlbWVudCk7XG4gICAgICAgICAgICBpZiAobmFtZVRvRWxlbWVudHMuc2l6ZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFya2VyTmFtZVRvRWxlbWVudHMuZGVsZXRlKG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVsZW1lbnRUb05hbWVzID0gdGhpcy5fZWxlbWVudFRvTWFya2VyTmFtZXMuZ2V0KGVsZW1lbnQpO1xuICAgICAgICBpZiAoZWxlbWVudFRvTmFtZXMpIHtcbiAgICAgICAgICAgIGVsZW1lbnRUb05hbWVzLmRlbGV0ZShuYW1lKTtcbiAgICAgICAgICAgIGlmIChlbGVtZW50VG9OYW1lcy5zaXplID09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9lbGVtZW50VG9NYXJrZXJOYW1lcy5kZWxldGUoZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYWxsIG1hcmtlciBuYW1lcyBvZiBtYXJrZXJzIHdoaWNoIGhhdmUgY2hhbmdlZCBkdWUgdG8gdW5iaW5kaW5nIGEgdmlldyBlbGVtZW50IChzbyBpdCBpcyBhc3N1bWVkIHRoYXQgdGhlIHZpZXcgZWxlbWVudFxuXHQgKiBoYXMgYmVlbiByZW1vdmVkLCBtb3ZlZCBvciByZW5hbWVkKSBzaW5jZSB0aGUgbGFzdCBmbHVzaC4gQWZ0ZXIgcmV0dXJuaW5nLCB0aGUgbWFya2VyIG5hbWVzIGxpc3QgaXMgY2xlYXJlZC5cblx0ICovIGZsdXNoVW5ib3VuZE1hcmtlck5hbWVzKCkge1xuICAgICAgICBjb25zdCBtYXJrZXJOYW1lcyA9IEFycmF5LmZyb20odGhpcy5fdW5ib3VuZE1hcmtlck5hbWVzKTtcbiAgICAgICAgdGhpcy5fdW5ib3VuZE1hcmtlck5hbWVzLmNsZWFyKCk7XG4gICAgICAgIHJldHVybiBtYXJrZXJOYW1lcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVuYmluZHMgYWxsIGRlZmVycmVkIGJpbmRpbmcgcmVtb3ZhbHMgb2YgdmlldyBlbGVtZW50cyB0aGF0IGluIHRoZSBtZWFudGltZSB3ZXJlIG5vdCByZS1hdHRhY2hlZCB0byBzb21lIHJvb3Qgb3IgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqXG5cdCAqIFNlZToge0BsaW5rICN1bmJpbmRWaWV3RWxlbWVudCBgdW5iaW5kVmlld0VsZW1lbnQoKWB9LlxuXHQgKi8gZmx1c2hEZWZlcnJlZEJpbmRpbmdzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IFt2aWV3RWxlbWVudCwgcm9vdF0gb2YgdGhpcy5fZGVmZXJyZWRCaW5kaW5nUmVtb3ZhbHMpe1xuICAgICAgICAgICAgLy8gVW5iaW5kIGl0IG9ubHkgaWYgaXQgd2Fzbid0IHJlLWF0dGFjaGVkIHRvIHNvbWUgcm9vdCBvciBkb2N1bWVudCBmcmFnbWVudC5cbiAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudC5yb290ID09IHJvb3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVuYmluZFZpZXdFbGVtZW50KHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kZWZlcnJlZEJpbmRpbmdSZW1vdmFscyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYWxsIG1vZGVsIHRvIHZpZXcgYW5kIHZpZXcgdG8gbW9kZWwgYmluZGluZ3MuXG5cdCAqLyBjbGVhckJpbmRpbmdzKCkge1xuICAgICAgICB0aGlzLl9tb2RlbFRvVmlld01hcHBpbmcgPSBuZXcgV2Vha01hcCgpO1xuICAgICAgICB0aGlzLl92aWV3VG9Nb2RlbE1hcHBpbmcgPSBuZXcgV2Vha01hcCgpO1xuICAgICAgICB0aGlzLl9tYXJrZXJOYW1lVG9FbGVtZW50cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudFRvTWFya2VyTmFtZXMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuX3VuYm91bmRNYXJrZXJOYW1lcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgdGhpcy5fZGVmZXJyZWRCaW5kaW5nUmVtb3ZhbHMgPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIHRvTW9kZWxFbGVtZW50KHZpZXdFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92aWV3VG9Nb2RlbE1hcHBpbmcuZ2V0KHZpZXdFbGVtZW50KTtcbiAgICB9XG4gICAgdG9WaWV3RWxlbWVudChtb2RlbEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21vZGVsVG9WaWV3TWFwcGluZy5nZXQobW9kZWxFbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIGNvcnJlc3BvbmRpbmcgbW9kZWwgcmFuZ2UuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3UmFuZ2UgVmlldyByYW5nZS5cblx0ICogQHJldHVybnMgQ29ycmVzcG9uZGluZyBtb2RlbCByYW5nZS5cblx0ICovIHRvTW9kZWxSYW5nZSh2aWV3UmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSh0aGlzLnRvTW9kZWxQb3NpdGlvbih2aWV3UmFuZ2Uuc3RhcnQpLCB0aGlzLnRvTW9kZWxQb3NpdGlvbih2aWV3UmFuZ2UuZW5kKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBjb3JyZXNwb25kaW5nIHZpZXcgcmFuZ2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBtb2RlbFJhbmdlIE1vZGVsIHJhbmdlLlxuXHQgKiBAcmV0dXJucyBDb3JyZXNwb25kaW5nIHZpZXcgcmFuZ2UuXG5cdCAqLyB0b1ZpZXdSYW5nZShtb2RlbFJhbmdlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UkMSh0aGlzLnRvVmlld1Bvc2l0aW9uKG1vZGVsUmFuZ2Uuc3RhcnQpLCB0aGlzLnRvVmlld1Bvc2l0aW9uKG1vZGVsUmFuZ2UuZW5kKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBjb3JyZXNwb25kaW5nIG1vZGVsIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBAZmlyZXMgdmlld1RvTW9kZWxQb3NpdGlvblxuXHQgKiBAcGFyYW0gdmlld1Bvc2l0aW9uIFZpZXcgcG9zaXRpb24uXG5cdCAqIEByZXR1cm5zIENvcnJlc3BvbmRpbmcgbW9kZWwgcG9zaXRpb24uXG5cdCAqLyB0b01vZGVsUG9zaXRpb24odmlld1Bvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICB2aWV3UG9zaXRpb24sXG4gICAgICAgICAgICBtYXBwZXI6IHRoaXNcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5maXJlKCd2aWV3VG9Nb2RlbFBvc2l0aW9uJywgZGF0YSk7XG4gICAgICAgIHJldHVybiBkYXRhLm1vZGVsUG9zaXRpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBjb3JyZXNwb25kaW5nIHZpZXcgcG9zaXRpb24uXG5cdCAqXG5cdCAqIEBmaXJlcyBtb2RlbFRvVmlld1Bvc2l0aW9uXG5cdCAqIEBwYXJhbSBtb2RlbFBvc2l0aW9uIE1vZGVsIHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMgZm9yIHBvc2l0aW9uIG1hcHBpbmcgcHJvY2Vzcy5cblx0ICogQHBhcmFtIG9wdGlvbnMuaXNQaGFudG9tIFNob3VsZCBiZSBzZXQgdG8gYHRydWVgIGlmIHRoZSBtb2RlbCBwb3NpdGlvbiB0byBtYXAgaXMgcG9pbnRpbmcgdG8gYSBwbGFjZVxuXHQgKiBpbiBtb2RlbCB0cmVlIHdoaWNoIG5vIGxvbmdlciBleGlzdHMuIEZvciBleGFtcGxlLCBpdCBjb3VsZCBiZSBhbiBlbmQgb2YgYSByZW1vdmVkIG1vZGVsIHJhbmdlLlxuXHQgKiBAcmV0dXJucyBDb3JyZXNwb25kaW5nIHZpZXcgcG9zaXRpb24uXG5cdCAqLyB0b1ZpZXdQb3NpdGlvbihtb2RlbFBvc2l0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgIG1vZGVsUG9zaXRpb24sXG4gICAgICAgICAgICBtYXBwZXI6IHRoaXMsXG4gICAgICAgICAgICBpc1BoYW50b206IG9wdGlvbnMuaXNQaGFudG9tXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlyZSgnbW9kZWxUb1ZpZXdQb3NpdGlvbicsIGRhdGEpO1xuICAgICAgICByZXR1cm4gZGF0YS52aWV3UG9zaXRpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGFsbCB2aWV3IGVsZW1lbnRzIGJvdW5kIHRvIHRoZSBnaXZlbiBtYXJrZXIgbmFtZS5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgTWFya2VyIG5hbWUuXG5cdCAqIEByZXR1cm5zIFZpZXcgZWxlbWVudHMgYm91bmQgd2l0aCB0aGUgZ2l2ZW4gbWFya2VyIG5hbWUgb3IgYG51bGxgXG5cdCAqIGlmIG5vIGVsZW1lbnRzIGFyZSBib3VuZCB0byB0aGUgZ2l2ZW4gbWFya2VyIG5hbWUuXG5cdCAqLyBtYXJrZXJOYW1lVG9FbGVtZW50cyhuYW1lKSB7XG4gICAgICAgIGNvbnN0IGJvdW5kRWxlbWVudHMgPSB0aGlzLl9tYXJrZXJOYW1lVG9FbGVtZW50cy5nZXQobmFtZSk7XG4gICAgICAgIGlmICghYm91bmRFbGVtZW50cykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBuZXcgU2V0KCk7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBib3VuZEVsZW1lbnRzKXtcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50JykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNsb25lIG9mIGVsZW1lbnQuZ2V0RWxlbWVudHNXaXRoU2FtZUlkKCkpe1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5hZGQoY2xvbmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMuYWRkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbGVtZW50cztcbiAgICB9XG4gICAgLyoqXG5cdCAqICoqVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIG9uZSBvZiB0aGUgZnV0dXJlIENLRWRpdG9yIDUgcmVsZWFzZXMuKipcblx0ICpcblx0ICogKipVc2luZyB0aGlzIG1ldGhvZCB3aWxsIHR1cm4gb2ZmIGBNYXBwZXJgIGNhY2hpbmcgc3lzdGVtIGFuZCBtYXkgZGVncmFkZSBwZXJmb3JtYW5jZSB3aGVuIG9wZXJhdGluZyBvbiBiaWdnZXIgZG9jdW1lbnRzLioqXG5cdCAqXG5cdCAqIFJlZ2lzdGVycyBhIGNhbGxiYWNrIHRoYXQgZXZhbHVhdGVzIHRoZSBsZW5ndGggaW4gdGhlIG1vZGVsIG9mIGEgdmlldyBlbGVtZW50IHdpdGggdGhlIGdpdmVuIG5hbWUuXG5cdCAqXG5cdCAqIFRoZSBjYWxsYmFjayBpcyBmaXJlZCB3aXRoIG9uZSBhcmd1bWVudCwgd2hpY2ggaXMgYSB2aWV3IGVsZW1lbnQgaW5zdGFuY2UuIFRoZSBjYWxsYmFjayBpcyBleHBlY3RlZCB0byByZXR1cm5cblx0ICogYSBudW1iZXIgcmVwcmVzZW50aW5nIHRoZSBsZW5ndGggb2YgdGhlIHZpZXcgZWxlbWVudCBpbiB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIExpc3QgaXRlbSBpbiB2aWV3IG1heSBjb250YWluIG5lc3RlZCBsaXN0LCB3aGljaCBoYXZlIG90aGVyIGxpc3QgaXRlbXMuIEluIG1vZGVsIHRob3VnaCxcblx0ICogLy8gdGhlIGxpc3RzIGFyZSByZXByZXNlbnRlZCBieSBmbGF0IHN0cnVjdHVyZS4gQmVjYXVzZSBvZiB0aG9zZSBkaWZmZXJlbmNlcywgbGVuZ3RoIG9mIGxpc3QgdmlldyBlbGVtZW50XG5cdCAqIC8vIG1heSBiZSBncmVhdGVyIHRoYW4gb25lLiBJbiB0aGUgY2FsbGJhY2sgaXQncyBjaGVja2VkIGhvdyBtYW55IG5lc3RlZCBsaXN0IGl0ZW1zIGFyZSBpbiBldmFsdWF0ZWQgbGlzdCBpdGVtLlxuXHQgKlxuXHQgKiBmdW5jdGlvbiBnZXRWaWV3TGlzdEl0ZW1MZW5ndGgoIGVsZW1lbnQgKSB7XG5cdCAqIFx0bGV0IGxlbmd0aCA9IDE7XG5cdCAqXG5cdCAqIFx0Zm9yICggbGV0IGNoaWxkIG9mIGVsZW1lbnQuZ2V0Q2hpbGRyZW4oKSApIHtcblx0ICogXHRcdGlmICggY2hpbGQubmFtZSA9PSAndWwnIHx8IGNoaWxkLm5hbWUgPT0gJ29sJyApIHtcblx0ICogXHRcdFx0Zm9yICggbGV0IGl0ZW0gb2YgY2hpbGQuZ2V0Q2hpbGRyZW4oKSApIHtcblx0ICogXHRcdFx0XHRsZW5ndGggKz0gZ2V0Vmlld0xpc3RJdGVtTGVuZ3RoKCBpdGVtICk7XG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH1cblx0ICogXHR9XG5cdCAqXG5cdCAqIFx0cmV0dXJuIGxlbmd0aDtcblx0ICogfVxuXHQgKlxuXHQgKiBtYXBwZXIucmVnaXN0ZXJWaWV3VG9Nb2RlbExlbmd0aCggJ2xpJywgZ2V0Vmlld0xpc3RJdGVtTGVuZ3RoICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnROYW1lIE5hbWUgb2YgdmlldyBlbGVtZW50IGZvciB3aGljaCBjYWxsYmFjayBpcyByZWdpc3RlcmVkLlxuXHQgKiBAcGFyYW0gbGVuZ3RoQ2FsbGJhY2sgRnVuY3Rpb24gcmV0dXJuIGEgbGVuZ3RoIG9mIHZpZXcgZWxlbWVudCBpbnN0YW5jZSBpbiBtb2RlbC5cblx0ICogQGRlcHJlY2F0ZWRcblx0ICovIHJlZ2lzdGVyVmlld1RvTW9kZWxMZW5ndGgodmlld0VsZW1lbnROYW1lLCBsZW5ndGhDYWxsYmFjaykge1xuICAgICAgICB0aGlzLl92aWV3VG9Nb2RlbExlbmd0aENhbGxiYWNrcy5zZXQodmlld0VsZW1lbnROYW1lLCBsZW5ndGhDYWxsYmFjayk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb3IgdGhlIGdpdmVuIGB2aWV3UG9zaXRpb25gLCBmaW5kcyBhbmQgcmV0dXJucyB0aGUgY2xvc2VzdCBhbmNlc3RvciBvZiB0aGlzIHBvc2l0aW9uIHRoYXQgaGFzIGEgbWFwcGluZyB0b1xuXHQgKiB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3UG9zaXRpb24gUG9zaXRpb24gZm9yIHdoaWNoIGEgbWFwcGVkIGFuY2VzdG9yIHNob3VsZCBiZSBmb3VuZC5cblx0ICovIGZpbmRNYXBwZWRWaWV3QW5jZXN0b3Iodmlld1Bvc2l0aW9uKSB7XG4gICAgICAgIGxldCBwYXJlbnQgPSB2aWV3UG9zaXRpb24ucGFyZW50O1xuICAgICAgICB3aGlsZSghdGhpcy5fdmlld1RvTW9kZWxNYXBwaW5nLmhhcyhwYXJlbnQpKXtcbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcmVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENhbGN1bGF0ZXMgbW9kZWwgb2Zmc2V0IGJhc2VkIG9uIHRoZSB2aWV3IHBvc2l0aW9uIGFuZCB0aGUgYmxvY2sgZWxlbWVudC5cblx0ICpcblx0ICogRXhhbXBsZTpcblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD5mb288Yj5iYXxyPC9iPjwvcD4gLy8gX3RvTW9kZWxPZmZzZXQoIGIsIDIsIHAgKSAtPiA1XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJcyBhIHN1bSBvZjpcblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD5mb298PGI+YmFyPC9iPjwvcD4gLy8gX3RvTW9kZWxPZmZzZXQoIHAsIDMsIHAgKSAtPiAzXG5cdCAqIDxwPmZvbzxiPmJhfHI8L2I+PC9wPiAvLyBfdG9Nb2RlbE9mZnNldCggYiwgMiwgYiApIC0+IDJcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3UGFyZW50IFBvc2l0aW9uIHBhcmVudC5cblx0ICogQHBhcmFtIHZpZXdPZmZzZXQgUG9zaXRpb24gb2Zmc2V0LlxuXHQgKiBAcGFyYW0gdmlld0Jsb2NrIEJsb2NrIHVzZWQgYXMgYSBiYXNlIHRvIGNhbGN1bGF0ZSBvZmZzZXQuXG5cdCAqIEByZXR1cm5zIE9mZnNldCBpbiB0aGUgbW9kZWwuXG5cdCAqLyBfdG9Nb2RlbE9mZnNldCh2aWV3UGFyZW50LCB2aWV3T2Zmc2V0LCB2aWV3QmxvY2spIHtcbiAgICAgICAgaWYgKHZpZXdCbG9jayAhPSB2aWV3UGFyZW50KSB7XG4gICAgICAgICAgICAvLyBTZWUgZXhhbXBsZS5cbiAgICAgICAgICAgIGNvbnN0IG9mZnNldFRvUGFyZW50U3RhcnQgPSB0aGlzLl90b01vZGVsT2Zmc2V0KHZpZXdQYXJlbnQucGFyZW50LCB2aWV3UGFyZW50LmluZGV4LCB2aWV3QmxvY2spO1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0SW5QYXJlbnQgPSB0aGlzLl90b01vZGVsT2Zmc2V0KHZpZXdQYXJlbnQsIHZpZXdPZmZzZXQsIHZpZXdQYXJlbnQpO1xuICAgICAgICAgICAgcmV0dXJuIG9mZnNldFRvUGFyZW50U3RhcnQgKyBvZmZzZXRJblBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICAvLyB2aWV3QmxvY2sgPT0gdmlld1BhcmVudCwgc28gd2UgbmVlZCB0byBjYWxjdWxhdGUgdGhlIG9mZnNldCBpbiB0aGUgcGFyZW50IGVsZW1lbnQuXG4gICAgICAgIC8vIElmIHRoZSBwb3NpdGlvbiBpcyBhIHRleHQgaXQgaXMgc2ltcGxlIChcImJhfHJcIiAtPiAyKS5cbiAgICAgICAgaWYgKHZpZXdQYXJlbnQuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiB2aWV3T2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBwb3NpdGlvbiBpcyBpbiBhbiBlbGVtZW50IHdlIG5lZWQgdG8gc3VtIGxlbmd0aHMgb2Ygc2libGluZ3MgKCA8Yj4gYmFyIDwvYj4gZm9vIHwgLT4gMyArIDMgPSA2ICkuXG4gICAgICAgIGxldCBtb2RlbE9mZnNldCA9IDA7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB2aWV3T2Zmc2V0OyBpKyspe1xuICAgICAgICAgICAgbW9kZWxPZmZzZXQgKz0gdGhpcy5nZXRNb2RlbExlbmd0aCh2aWV3UGFyZW50LmdldENoaWxkKGkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbW9kZWxPZmZzZXQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBsZW5ndGggb2YgdGhlIHZpZXcgZWxlbWVudCBpbiB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIFRoZSBsZW5ndGggaXMgY2FsY3VsYXRlZCBhcyBmb2xsb3dzOlxuXHQgKiAqIGlmIGEge0BsaW5rICNyZWdpc3RlclZpZXdUb01vZGVsTGVuZ3RoIGxlbmd0aCBtYXBwaW5nIGNhbGxiYWNrfSBpcyBwcm92aWRlZCBmb3IgdGhlIGdpdmVuIGB2aWV3Tm9kZWAsIGl0IGlzIHVzZWQgdG9cblx0ICogZXZhbHVhdGUgdGhlIG1vZGVsIGxlbmd0aCAoYHZpZXdOb2RlYCBpcyB1c2VkIGFzIGZpcnN0IGFuZCBvbmx5IHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrKSxcblx0ICogKiBsZW5ndGggb2YgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGV9IGlzIGVxdWFsIHRvIHRoZSBsZW5ndGggb2YgaXRzXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0I2RhdGEgZGF0YX0sXG5cdCAqICogbGVuZ3RoIG9mIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IHVpIGVsZW1lbnR9IGlzIGVxdWFsIHRvIDAsXG5cdCAqICogbGVuZ3RoIG9mIGEgbWFwcGVkIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IGlzIGVxdWFsIHRvIDEsXG5cdCAqICogbGVuZ3RoIG9mIGEgbm9uLW1hcHBlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSBpcyBlcXVhbCB0byB0aGUgbGVuZ3RoIG9mIGl0cyBjaGlsZHJlbi5cblx0ICpcblx0ICogRXhhbXBsZXM6XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiBmb28gICAgICAgICAgICAgICAgICAgICAgICAgIC0+IDMgLy8gVGV4dCBsZW5ndGggaXMgZXF1YWwgdG8gaXRzIGRhdGEgbGVuZ3RoLlxuXHQgKiA8cD5mb288L3A+ICAgICAgICAgICAgICAgICAgIC0+IDEgLy8gTGVuZ3RoIG9mIGFuIGVsZW1lbnQgd2hpY2ggaXMgbWFwcGVkIGlzIGJ5IGRlZmF1bHQgZXF1YWwgdG8gMS5cblx0ICogPGI+Zm9vPC9iPiAgICAgICAgICAgICAgICAgICAtPiAzIC8vIExlbmd0aCBvZiBhbiBlbGVtZW50IHdoaWNoIGlzIG5vdCBtYXBwZWQgaXMgYSBsZW5ndGggb2YgaXRzIGNoaWxkcmVuLlxuXHQgKiA8ZGl2PjxwPng8L3A+PHA+eTwvcD48L2Rpdj4gIC0+IDIgLy8gQXNzdW1pbmcgdGhhdCA8ZGl2PiBpcyBub3QgbWFwcGVkIGFuZCA8cD4gYXJlIG1hcHBlZC5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3Tm9kZSBWaWV3IG5vZGUuXG5cdCAqIEByZXR1cm5zIExlbmd0aCBvZiB0aGUgbm9kZSBpbiB0aGUgdHJlZSBtb2RlbC5cblx0ICovIGdldE1vZGVsTGVuZ3RoKHZpZXdOb2RlKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gW1xuICAgICAgICAgICAgdmlld05vZGVcbiAgICAgICAgXTtcbiAgICAgICAgbGV0IGxlbiA9IDA7XG4gICAgICAgIHdoaWxlKHN0YWNrLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IHN0YWNrLnBvcCgpO1xuICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBub2RlLm5hbWUgJiYgdGhpcy5fdmlld1RvTW9kZWxMZW5ndGhDYWxsYmFja3Muc2l6ZSA+IDAgJiYgdGhpcy5fdmlld1RvTW9kZWxMZW5ndGhDYWxsYmFja3MuZ2V0KG5vZGUubmFtZSk7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBsZW4gKz0gY2FsbGJhY2sobm9kZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX3ZpZXdUb01vZGVsTWFwcGluZy5oYXMobm9kZSkpIHtcbiAgICAgICAgICAgICAgICBsZW4gKz0gMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgICAgIGxlbiArPSBub2RlLmRhdGEubGVuZ3RoO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmlzKCd1aUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGVuO1xuICAgIH1cbiAgICAvKipcblx0ICogRmluZHMgdGhlIHBvc2l0aW9uIGluIGEgdmlldyBlbGVtZW50IG9yIHZpZXcgZG9jdW1lbnQgZnJhZ21lbnQgbm9kZSAob3IgaW4gaXRzIGNoaWxkcmVuKSB3aXRoIHRoZSBleHBlY3RlZCBtb2RlbCBvZmZzZXQuXG5cdCAqXG5cdCAqIElmIHRoZSBwYXNzZWQgYHZpZXdDb250YWluZXJgIGlzIGJvdW5kIHRvIG1vZGVsLCBgTWFwcGVyYCB3aWxsIHVzZSBjYWNoaW5nIG1lY2hhbmlzbSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gdmlld0NvbnRhaW5lciBUcmVlIHZpZXcgZWxlbWVudCBpbiB3aGljaCB3ZSBhcmUgbG9va2luZyBmb3IgdGhlIHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gbW9kZWxPZmZzZXQgRXhwZWN0ZWQgb2Zmc2V0LlxuXHQgKiBAcmV0dXJucyBGb3VuZCBwb3NpdGlvbi5cblx0ICovIGZpbmRQb3NpdGlvbkluKHZpZXdDb250YWluZXIsIG1vZGVsT2Zmc2V0KSB7XG4gICAgICAgIGlmIChtb2RlbE9mZnNldCA9PT0gMCkge1xuICAgICAgICAgICAgLy8gUXVpY2tseSByZXR1cm4gaWYgYXNrZWQgZm9yIGEgcG9zaXRpb24gYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgY29udGFpbmVyLiBObyBuZWVkIHRvIGZpcmUgY29tcGxleCBtZWNoYW5pc21zIHRvIGZpbmQgaXQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbW92ZVZpZXdQb3NpdGlvblRvVGV4dE5vZGUobmV3IFBvc2l0aW9uJDEodmlld0NvbnRhaW5lciwgMCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzZSBjYWNoZSBvbmx5IGlmIHRoZXJlIGFyZSBubyBjdXN0b20gdmlldy10by1tb2RlbCBsZW5ndGggY2FsbGJhY2tzIGFuZCBvbmx5IGZvciBib3VuZCBlbGVtZW50cy5cbiAgICAgICAgLy8gVmlldy10by1tb2RlbCBsZW5ndGggY2FsbGJhY2tzIGFyZSBkZXByZWNhdGVkIGFuZCBzaG91bGQgYmUgcmVtb3ZlZCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyByZWxlYXNlcy5cbiAgICAgICAgLy8gVGhlbiBpdCB3aWxsIGJlIHBvc3NpYmxlIHRvIHNpbXBsaWZ5IHNvbWUgbG9naWMgaW5zaWRlIGBNYXBwZXJgLlxuICAgICAgICAvLyBOb3RlOiB3ZSBjb3VsZCBjb25zaWRlciByZXF1aXJpbmcgYHZpZXdDb250YWluZXJgIHRvIGJlIGEgbWFwcGVkIGl0ZW0uXG4gICAgICAgIGNvbnN0IHVzZUNhY2hlID0gdGhpcy5fdmlld1RvTW9kZWxMZW5ndGhDYWxsYmFja3Muc2l6ZSA9PSAwICYmIHRoaXMuX3ZpZXdUb01vZGVsTWFwcGluZy5oYXModmlld0NvbnRhaW5lcik7XG4gICAgICAgIGlmICh1c2VDYWNoZSkge1xuICAgICAgICAgICAgY29uc3QgY2FjaGVJdGVtID0gdGhpcy5fY2FjaGUuZ2V0Q2xvc2VzdCh2aWV3Q29udGFpbmVyLCBtb2RlbE9mZnNldCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZmluZFBvc2l0aW9uU3RhcnRpbmdGcm9tKGNhY2hlSXRlbS52aWV3UG9zaXRpb24sIGNhY2hlSXRlbS5tb2RlbE9mZnNldCwgbW9kZWxPZmZzZXQsIHZpZXdDb250YWluZXIsIHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmRQb3NpdGlvblN0YXJ0aW5nRnJvbShuZXcgUG9zaXRpb24kMSh2aWV3Q29udGFpbmVyLCAwKSwgMCwgbW9kZWxPZmZzZXQsIHZpZXdDb250YWluZXIsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUGVyZm9ybXMgbW9zdCBvZiB0aGUgbG9naWMgZm9yIGBNYXBwZXIjZmluZFBvc2l0aW9uSW4oKWAuXG5cdCAqXG5cdCAqIEl0IGFsbG93cyB0byBzdGFydCBsb29raW5nIGZvciB0aGUgcmVxdWVzdGVkIG1vZGVsIG9mZnNldCBmcm9tIGEgZ2l2ZW4gc3RhcnRpbmcgcG9zaXRpb24sIHRvIGVuYWJsZSBjYWNoaW5nLiBVc2luZyB0aGUgY2FjaGUsXG5cdCAqIHlvdSBjYW4gc2V0IHRoZSBzdGFydGluZyBwb2ludCBhbmQgc2tpcCBhbGwgdGhlIGNhbGN1bGF0aW9ucyB0aGF0IHdlcmUgYWxyZWFkeSBwcmV2aW91c2x5IGRvbmUuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIHVzZXMgcmVjdXJzaW9uIHRvIGZpbmQgcG9zaXRpb25zIGluc2lkZSBkZWVwIHN0cnVjdHVyZXMuIEV4YW1wbGU6XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiA8cD5mbzxiPmJhcjwvYj5ib208L3A+ICAtPiB0YXJnZXQgb2Zmc2V0OiA0XG5cdCAqIDxwPnxmbzxiPmJhcjwvYj5ib208L3A+IC0+IHRhcmdldCBvZmZzZXQ6IDQsIHRyYXZlcnNlZCBvZmZzZXQ6IDBcblx0ICogPHA+Zm98PGI+YmFyPC9iPmJvbTwvcD4gLT4gdGFyZ2V0IG9mZnNldDogNCwgdHJhdmVyc2VkIG9mZnNldDogMlxuXHQgKiA8cD5mbzxiPmJhcjwvYj58Ym9tPC9wPiAtPiB0YXJnZXQgb2Zmc2V0OiA0LCB0cmF2ZXJzZWQgb2Zmc2V0OiA1IC0+IHdlIGFyZSB0b28gZmFyLCBsb29rIHJlY3Vyc2l2ZWx5IGluIDxiPi5cblx0ICpcblx0ICogPHA+Zm88Yj58YmFyPC9iPmJvbTwvcD4gLT4gdGFyZ2V0IG9mZnNldDogNCwgdHJhdmVyc2VkIG9mZnNldDogMlxuXHQgKiA8cD5mbzxiPmJhcnw8L2I+Ym9tPC9wPiAtPiB0YXJnZXQgb2Zmc2V0OiA0LCB0cmF2ZXJzZWQgb2Zmc2V0OiA1IC0+IHdlIGFyZSB0b28gZmFyLCBsb29rIGluc2lkZSBcImJhclwiLlxuXHQgKlxuXHQgKiA8cD5mbzxiPmJhfHI8L2I+Ym9tPC9wPiAtPiB0YXJnZXQgb2Zmc2V0OiA0LCB0cmF2ZXJzZWQgb2Zmc2V0OiAyIC0+IHBvc2l0aW9uIGlzIGluc2lkZSB0ZXh0IG5vZGUgYXQgb2Zmc2V0IDQtMiA9IDIuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gc3RhcnRWaWV3UG9zaXRpb24gVmlldyBwb3NpdGlvbiB0byBzdGFydCBsb29raW5nIGZyb20uXG5cdCAqIEBwYXJhbSBzdGFydE1vZGVsT2Zmc2V0IE1vZGVsIG9mZnNldCByZWxhdGVkIHRvIGBzdGFydFZpZXdQb3NpdGlvbmAuXG5cdCAqIEBwYXJhbSB0YXJnZXRNb2RlbE9mZnNldCBUYXJnZXQgbW9kZWwgb2Zmc2V0IHRvIGZpbmQuXG5cdCAqIEBwYXJhbSB2aWV3Q29udGFpbmVyIE1hcHBlZCBhbmNlc3RvciBvZiBgc3RhcnRWaWV3UG9zaXRpb25gLiBgc3RhcnRNb2RlbE9mZnNldGAgaXMgdGhlIG9mZnNldCBpbnNpZGUgYSBtb2RlbCBlbGVtZW50IG9yIG1vZGVsXG5cdCAqIGRvY3VtZW50IGZyYWdtZW50IG1hcHBlZCB0byBgdmlld0NvbnRhaW5lcmAuXG5cdCAqIEBwYXJhbSB1c2VDYWNoZSBXaGV0aGVyIGBNYXBwZXJgIHNob3VsZCBjYWNoZSBwb3NpdGlvbnMgd2hpbGUgdHJhdmVyc2luZyB0aGUgdmlldyB0cmVlIGxvb2tpbmcgZm9yIGBleHBlY3RlZE1vZGVsT2Zmc2V0YC5cblx0ICogQHJldHVybnMgVmlldyBwb3NpdGlvbiBtYXBwZWQgdG8gYHRhcmdldE1vZGVsT2Zmc2V0YC5cblx0ICovIF9maW5kUG9zaXRpb25TdGFydGluZ0Zyb20oc3RhcnRWaWV3UG9zaXRpb24sIHN0YXJ0TW9kZWxPZmZzZXQsIHRhcmdldE1vZGVsT2Zmc2V0LCB2aWV3Q29udGFpbmVyLCB1c2VDYWNoZSkge1xuICAgICAgICBsZXQgdmlld1BhcmVudCA9IHN0YXJ0Vmlld1Bvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgbGV0IHZpZXdPZmZzZXQgPSBzdGFydFZpZXdQb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgIC8vIEluIHRoZSB0ZXh0IG5vZGUgaXQgaXMgc2ltcGxlOiB0aGUgb2Zmc2V0IGluIHRoZSBtb2RlbCBlcXVhbHMgdGhlIG9mZnNldCBpbiB0aGUgdGV4dC5cbiAgICAgICAgaWYgKHZpZXdQYXJlbnQuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24kMSh2aWV3UGFyZW50LCB0YXJnZXRNb2RlbE9mZnNldCAtIHN0YXJ0TW9kZWxPZmZzZXQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIExhc3Qgc2Nhbm5lZCB2aWV3IG5vZGUuXG4gICAgICAgIGxldCB2aWV3Tm9kZTtcbiAgICAgICAgLy8gVG90YWwgbW9kZWwgb2Zmc2V0IG9mIHRoZSB2aWV3IG5vZGVzIHRoYXQgd2VyZSB2aXNpdGVkIHNvIGZhci5cbiAgICAgICAgbGV0IHRyYXZlcnNlZE1vZGVsT2Zmc2V0ID0gc3RhcnRNb2RlbE9mZnNldDtcbiAgICAgICAgLy8gTW9kZWwgbGVuZ3RoIG9mIHRoZSBsYXN0IHRyYXZlcnNlZCB2aWV3IG5vZGUuXG4gICAgICAgIGxldCBsYXN0TGVuZ3RoID0gMDtcbiAgICAgICAgd2hpbGUodHJhdmVyc2VkTW9kZWxPZmZzZXQgPCB0YXJnZXRNb2RlbE9mZnNldCl7XG4gICAgICAgICAgICB2aWV3Tm9kZSA9IHZpZXdQYXJlbnQuZ2V0Q2hpbGQodmlld09mZnNldCk7XG4gICAgICAgICAgICBpZiAoIXZpZXdOb2RlKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgd2Ugc3RpbGwgaGF2ZW4ndCByZWFjaGVkIHRoZSBtb2RlbCBvZmZzZXQsIGJ1dCB3ZSByZWFjaGVkIGVuZCBvZiB0aGlzIGB2aWV3UGFyZW50YCwgdGhlbiB3ZSBuZWVkIHRvIFwibGVhdmVcIiB0aGlzXG4gICAgICAgICAgICAgICAgLy8gZWxlbWVudCBhbmQgXCJnbyB1cFwiLCBsb29raW5nIGZ1cnRoZXIgZm9yIHRoZSB0YXJnZXQgbW9kZWwgb2Zmc2V0LiBUaGlzIGNhbiBoYXBwZW4gd2hlbiBjYWNoZWQgbW9kZWwgb2Zmc2V0IGlzIFwiZGVlcGVyXCJcbiAgICAgICAgICAgICAgICAvLyBidXQgdGFyZ2V0IG1vZGVsIG9mZnNldCBpcyBcImhpZ2hlclwiIGluIHRoZSB2aWV3IHRyZWUuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBFeGFtcGxlOiBgPHA+Rm9vPHN0cm9uZz48ZW0+QmFyPC9lbT5eQmF6PC9zdHJvbmc+WHl6PC9wPmBcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIENvbnNpZGVyIGBeYCBpcyBsYXN0IGNhY2hlZCBwb3NpdGlvbiwgd2hlbiB0aGUgYHRhcmdldE1vZGVsT2Zmc2V0YCBpcyBgMTJgLiBJbiBzdWNoIGNhc2UsIHdlIG5lZWQgdG8gXCJnbyB1cFwiIGZyb21cbiAgICAgICAgICAgICAgICAvLyBgPHN0cm9uZz5gIGFuZCBjb250aW51ZSB0cmF2ZXJzaW5nIGluIGA8cD5gLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgaWYgKHZpZXdQYXJlbnQgPT0gdmlld0NvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICAgICAvKipcblx0XHRcdFx0XHQgKiBBIG1vZGVsIHBvc2l0aW9uIGNvdWxkIG5vdCBiZSBtYXBwZWQgdG8gdGhlIHZpZXcgYmVjYXVzZSBzcGVjaWZpZWQgbW9kZWwgb2Zmc2V0IHdhcyB0b28gYmlnIGFuZCBjb3VsZCBub3QgYmVcblx0XHRcdFx0XHQgKiBmb3VuZCBpbnNpZGUgdGhlIG1hcHBlZCB2aWV3IGVsZW1lbnQgb3IgdmlldyBkb2N1bWVudCBmcmFnbWVudC5cblx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdCAqIEBlcnJvciBtYXBwaW5nLW1vZGVsLW9mZnNldC1ub3QtZm91bmRcblx0XHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21hcHBpbmctbW9kZWwtb2Zmc2V0LW5vdC1mb3VuZCcsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsT2Zmc2V0OiB0YXJnZXRNb2RlbE9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdDb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmlld09mZnNldCA9IHZpZXdQYXJlbnQucGFyZW50LmdldENoaWxkSW5kZXgodmlld1BhcmVudCkgKyAxO1xuICAgICAgICAgICAgICAgICAgICB2aWV3UGFyZW50ID0gdmlld1BhcmVudC5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxhc3RMZW5ndGggPSB0aGlzLmdldE1vZGVsTGVuZ3RoKHZpZXdOb2RlKTtcbiAgICAgICAgICAgIHRyYXZlcnNlZE1vZGVsT2Zmc2V0ICs9IGxhc3RMZW5ndGg7XG4gICAgICAgICAgICB2aWV3T2Zmc2V0Kys7XG4gICAgICAgICAgICBpZiAodXNlQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICAvLyBOb3RlLCB0aGF0IHdlIGNhY2hlIHRoZSB2aWV3IHBvc2l0aW9uIGJlZm9yZSBhbmQgYWZ0ZXIgYSB2aXNpdGVkIGVsZW1lbnQgaGVyZSwgc28gYmVmb3JlIHdlIChwb3NzaWJseSkgXCJlbnRlclwiIGl0XG4gICAgICAgICAgICAgICAgLy8gKHNlZSBgZWxzZWAgYmVsb3cpLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gU2luY2UgYE1hcHBlckNhY2hlI3NhdmVgIGRvZXMgbm90IG92ZXJ3cml0ZSBhbHJlYWR5IGNhY2hlZCBtb2RlbCBvZmZzZXRzLCB0aGlzIHdheSB0aGUgY2FjaGVkIHBvc2l0aW9uIGlzIHNldCB0b1xuICAgICAgICAgICAgICAgIC8vIGEgY29ycmVjdCBsb2NhdGlvbiwgdGhhdCBpcyB0aGUgY2xvc2VzdCB0byB0aGUgbWFwcGVkIGB2aWV3Q29udGFpbmVyYC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIEhvd2V2ZXIsIGluIHNvbWUgY2FzZXMsIHdlIHN0aWxsIG5lZWQgdG8gXCJob2lzdFwiIHRoZSBjYWNoZWQgcG9zaXRpb24gKHNlZSBgTWFwcGVyQ2FjaGUjX2hvaXN0Vmlld1Bvc2l0aW9uKClgKS5cbiAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZS5zYXZlKHZpZXdQYXJlbnQsIHZpZXdPZmZzZXQsIHZpZXdDb250YWluZXIsIHRyYXZlcnNlZE1vZGVsT2Zmc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHJhdmVyc2VkTW9kZWxPZmZzZXQgPT0gdGFyZ2V0TW9kZWxPZmZzZXQpIHtcbiAgICAgICAgICAgIC8vIElmIGl0IGVxdWFscyB3ZSBmb3VuZCB0aGUgcG9zaXRpb24uXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbW92ZVZpZXdQb3NpdGlvblRvVGV4dE5vZGUobmV3IFBvc2l0aW9uJDEodmlld1BhcmVudCwgdmlld09mZnNldCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgaXQgaXMgaGlnaGVyIHdlIG92ZXJzdGVwcGVkIHdpdGggdGhlIGxhc3QgdHJhdmVyc2VkIHZpZXcgbm9kZS5cbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gXCJlbnRlclwiIGl0LCBhbmQgbG9vayBmb3IgdGhlIHZpZXcgcG9zaXRpb24gLyBtb2RlbCBvZmZzZXQgaW5zaWRlIHRoZSBsYXN0IHZpc2l0ZWQgdmlldyBub2RlLlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmRQb3NpdGlvblN0YXJ0aW5nRnJvbShuZXcgUG9zaXRpb24kMSh2aWV3Tm9kZSwgMCksIHRyYXZlcnNlZE1vZGVsT2Zmc2V0IC0gbGFzdExlbmd0aCwgdGFyZ2V0TW9kZWxPZmZzZXQsIHZpZXdDb250YWluZXIsIHVzZUNhY2hlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQmVjYXVzZSB3ZSBwcmVmZXIgcG9zaXRpb25zIGluIHRoZSB0ZXh0IG5vZGVzIG92ZXIgcG9zaXRpb25zIG5leHQgdG8gdGV4dCBub2RlcywgaWYgdGhlIHZpZXcgcG9zaXRpb24gd2FzIG5leHQgdG8gYSB0ZXh0IG5vZGUsXG5cdCAqIGl0IG1vdmVzIGl0IGludG8gdGhlIHRleHQgbm9kZSBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBgYGBcblx0ICogPHA+W108Yj5mb288L2I+PC9wPiAtPiA8cD5bXTxiPmZvbzwvYj48L3A+IC8vIGRvIG5vdCB0b3VjaCBpZiBwb3NpdGlvbiBpcyBub3QgZGlyZWN0bHkgbmV4dCB0byB0ZXh0XG5cdCAqIDxwPmZvb1tdPGI+Zm9vPC9iPjwvcD4gLT4gPHA+Zm9ve308Yj5mb288L2I+PC9wPiAvLyBtb3ZlIHRvIHRleHQgbm9kZVxuXHQgKiA8cD48Yj5bXWZvbzwvYj48L3A+IC0+IDxwPjxiPnt9Zm9vPC9iPjwvcD4gLy8gbW92ZSB0byB0ZXh0IG5vZGVcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3UG9zaXRpb24gUG9zaXRpb24gcG90ZW50aWFsbHkgbmV4dCB0byB0aGUgdGV4dCBub2RlLlxuXHQgKiBAcmV0dXJucyBQb3NpdGlvbiBpbiB0aGUgdGV4dCBub2RlIGlmIHBvc3NpYmxlLlxuXHQgKi8gX21vdmVWaWV3UG9zaXRpb25Ub1RleHROb2RlKHZpZXdQb3NpdGlvbikge1xuICAgICAgICAvLyBJZiB0aGUgcG9zaXRpb24gaXMganVzdCBhZnRlciBhIHRleHQgbm9kZSwgcHV0IGl0IGF0IHRoZSBlbmQgb2YgdGhhdCB0ZXh0IG5vZGUuXG4gICAgICAgIC8vIElmIHRoZSBwb3NpdGlvbiBpcyBqdXN0IGJlZm9yZSBhIHRleHQgbm9kZSwgcHV0IGl0IGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhhdCB0ZXh0IG5vZGUuXG4gICAgICAgIGNvbnN0IG5vZGVCZWZvcmUgPSB2aWV3UG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgY29uc3Qgbm9kZUFmdGVyID0gdmlld1Bvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgaWYgKG5vZGVCZWZvcmUgJiYgbm9kZUJlZm9yZS5pcygndmlldzokdGV4dCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEobm9kZUJlZm9yZSwgbm9kZUJlZm9yZS5kYXRhLmxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAobm9kZUFmdGVyICYmIG5vZGVBZnRlci5pcygndmlldzokdGV4dCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uJDEobm9kZUFmdGVyLCAwKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBPdGhlcndpc2UsIGp1c3QgcmV0dXJuIHRoZSBnaXZlbiBwb3NpdGlvbi5cbiAgICAgICAgcmV0dXJuIHZpZXdQb3NpdGlvbjtcbiAgICB9XG59XG4vKipcbiAqIENhY2hlIG1lY2hhbmlzbSBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tYXBwZXJ+TWFwcGVyIE1hcHBlcn0uXG4gKlxuICogYE1hcHBlckNhY2hlYCBpbXByb3ZlcyBwZXJmb3JtYW5jZSBmb3IgbW9kZWwtdG8tdmlldyBwb3NpdGlvbiBtYXBwaW5nLCB3aGljaCBpcyB0aGUgbWFpbiBgTWFwcGVyYCB0YXNrLiBBc2tpbmcgZm9yIGEgbWFwcGluZyBpcyBtdWNoXG4gKiBtb3JlIGZyZXF1ZW50IHRoYW4gYWN0dWFsbHkgcGVyZm9ybWluZyBjaGFuZ2VzLCBhbmQgZXZlbiBpZiB0aGUgY2hhbmdlIGhhcHBlbnMsIHdlIGNhbiBzdGlsbCBwYXJ0aWFsbHkga2VlcCB0aGUgY2FjaGUuIFRoaXMgbWFrZXNcbiAqIGNhY2hpbmcgYSB1c2VmdWwgc3RyYXRlZ3kgZm9yIGBNYXBwZXJgLlxuICpcbiAqIGBNYXBwZXJDYWNoZWAgd2lsbCBzdG9yZSBzb21lIGRhdGEgZm9yIHZpZXcgZWxlbWVudHMgb3IgdmlldyBkb2N1bWVudCBmcmFnbWVudHMgdGhhdCBhcmUgbWFwcGVkIGJ5IHRoZSBgTWFwcGVyYC4gVGhlc2UgdmlldyBpdGVtc1xuICogYXJlIFwidHJhY2tlZFwiIGJ5IHRoZSBgTWFwcGVyQ2FjaGVgLiBGb3Igc3VjaCB2aWV3IGl0ZW1zLCB3ZSB3aWxsIGtlZXAgZW50cmllcyBvZiBtb2RlbCBvZmZzZXRzIGluc2lkZSB0aGVpciBtYXBwZWQgY291bnRlcnBhcnQuIEZvclxuICogdGhlIGNhY2hlZCBtb2RlbCBvZmZzZXRzLCB3ZSB3aWxsIGtlZXAgYSB2aWV3IHBvc2l0aW9uIHRoYXQgaXMgaW5zaWRlIHRoZSB0cmFja2VkIGl0ZW0uIFRoaXMgYWxsb3dzIHVzIHRvIGVpdGhlciBnZXQgdGhlIG1hcHBpbmdcbiAqIGluc3RhbnRseSwgb3IgYXQgbGVhc3QgaW4gbGVzcyBzdGVwcyB0aGFuIHdoZW4gY2FsY3VsYXRpbmcgaXQgZnJvbSB0aGUgYmVnaW5uaW5nLlxuICpcbiAqIEltcG9ydGFudCBwcm9ibGVtIHJlbGF0ZWQgdG8gY2FjaGluZyBpcyBpbnZhbGlkYXRpbmcgdGhlIGNhY2hlLiBUaGUgY2FjaGUgbXVzdCBiZSBpbnZhbGlkYXRlZCBlYWNoIHRpbWUgdGhlIHRyYWNrZWQgdmlldyBpdGVtIGNoYW5nZXMuXG4gKiBBZGRpdGlvbmFsbHksIHdlIHNob3VsZCBpbnZhbGlkYXRlIGFzIHNtYWxsIHBhcnQgb2YgdGhlIGNhY2hlIGFzIHBvc3NpYmxlLiBTaW5jZSBhbGwgdGhlIGxvZ2ljIGlzIGVuY2Fwc3VsYXRlZCBpbnNpZGUgYE1hcHBlckNhY2hlYCxcbiAqIHRoZSBgTWFwcGVyQ2FjaGVgIGxpc3RlbnMgdG8gdmlldyBpdGVtcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Vmlld05vZGVDaGFuZ2VFdmVudCBgY2hhbmdlYCBldmVudH0gYW5kIHJlYWN0cyB0byBpdC5cbiAqIFRoZW4sIGl0IGludmFsaWRhdGVzIGp1c3QgdGhlIHBhcnQgb2YgdGhlIGNhY2hlIHRoYXQgaXMgXCJhZnRlclwiIHRoZSBjaGFuZ2VkIHBhcnQgb2YgdGhlIHZpZXcuXG4gKlxuICogQXMgbWVudGlvbmVkLCBgTWFwcGVyQ2FjaGVgIGN1cnJlbnRseSBpcyB1c2VkIG9ubHkgZm9yIG1vZGVsLXRvLXZpZXcgcG9zaXRpb24gbWFwcGluZyBhcyBpdCB3YXMgbXVjaCBiaWdnZXIgcHJvYmxlbSB0aGFuIHZpZXctdG8tbW9kZWxcbiAqIG1hcHBpbmcuIEhvd2V2ZXIsIGl0IHNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgaXQgYWxzbyBmb3Igdmlldy10by1tb2RlbC5cbiAqXG4gKiBUaGUgbWFpbiBhc3N1bXB0aW9ucyByZWdhcmRpbmcgYE1hcHBlckNhY2hlYCBhcmU6XG4gKlxuICogKiBpdCBpcyBhbiBpbnRlcm5hbCB0b29sLCB1c2VkIGJ5IGBNYXBwZXJgLCB0cmFuc3BhcmVudCB0byB0aGUgb3V0c2lkZSAobm8gYWRkaXRpb25hbCBlZmZvcnQgd2hlbiBkZXZlbG9waW5nIGEgcGx1Z2luIG9yIGEgY29udmVydGVyKSxcbiAqICogaXQgc3RvcmVzIGFsbCB0aGUgbmVjZXNzYXJ5IGRhdGEgaW50ZXJuYWxseSwgd2hpY2ggbWFrZXMgaXQgZWFzaWVyIHRvIGRpc2FibGUgb3IgZGVidWcsXG4gKiAqIGl0IGlzIG9wdGltaXplZCBmb3IgaW5pdGlhbCBkb3duY2FzdCBwcm9jZXNzIChsb25nIGluc2VydGlvbnMpLCB3aGljaCBpcyBjcnVjaWFsIGZvciBlZGl0b3IgaW5pdCBhbmQgZGF0YSBzYXZlLFxuICogKiBpdCBkb2VzIG5vdCBzYXZlIGFsbCBwb3NzaWJsZSBwb3NpdGlvbnMgZm9yIG1lbW9yeSBjb25zaWRlcmF0aW9ucywgYWx0aG91Z2ggaXQgaXMgYSBwb3NzaWJsZSBpbXByb3ZlbWVudCwgd2hpY2ggbWF5IGhhdmUgaW5jcmVhc2VcbiAqICAgcGVyZm9ybWFuY2UsIGFzIHdlbGwgYXMgc2ltcGxpZnkgc29tZSBwYXJ0cyBvZiB0aGUgYE1hcHBlckNhY2hlYCBsb2dpYy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBNYXBwZXJDYWNoZSBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSB7XG4gICAgLyoqXG5cdCAqIEZvciBldmVyeSB2aWV3IGVsZW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQgdHJhY2tlZCBieSBgTWFwcGVyQ2FjaGVgLCBpdCBob2xkcyBjdXJyZW50bHkgY2FjaGVkIGRhdGEsIG9yIG1vcmUgcHJlY2lzZWx5LFxuXHQgKiBtb2RlbCBvZmZzZXQgdG8gdmlldyBwb3NpdGlvbiBtYXBwaW5ncy4gU2VlIGFsc28gYE1hcHBpbmdDYWNoZWAgYW5kIGBDYWNoZUl0ZW1gLlxuXHQgKlxuXHQgKiBJZiBhbiBpdGVtIGlzIHRyYWNrZWQgYnkgYE1hcHBlckNhY2hlYCBpdCBoYXMgYW4gZW50cnkgaW4gdGhpcyBzdHJ1Y3R1cmUsIHNvIHRoaXMgc3RydWN0dXJlIGNhbiBiZSB1c2VkIHRvIGNoZWNrIHdoaWNoIGl0ZW1zXG5cdCAqIGFyZSB0cmFja2VkIGJ5IGBNYXBwZXJDYWNoZWAuIFdoZW4gYW4gaXRlbSBpcyBubyBsb25nZXIgdHJhY2tlZCwgaXQgaXMgcmVtb3ZlZCBmcm9tIHRoaXMgc3RydWN0dXJlLlxuXHQgKlxuXHQgKiBBbHRob3VnaCBgTWFwcGluZ0NhY2hlYCBhbmQgYENhY2hlSXRlbWAgc3RydWN0dXJlcyBhbGxvd3MgZm9yIGNhY2hpbmcgYW55IG1vZGVsIG9mZnNldHMgYW5kIHZpZXcgcG9zaXRpb25zLCB3ZSBvbmx5IGNhY2hlXG5cdCAqIHZhbHVlcyBmb3IgbW9kZWwgb2Zmc2V0cyB0aGF0IGFyZSBhZnRlciBhIHZpZXcgbm9kZS4gU28sIGluIGVzc2VuY2UsIHBvc2l0aW9ucyBpbnNpZGUgdGV4dCBub2RlcyBhcmUgbm90IGNhY2hlZC4gSG93ZXZlciwgaXQgdGFrZXNcblx0ICogZnJvbSBvbmUgdG8gYXQgbW9zdCBhIGZldyBzdGVwcywgdG8gZ2V0IGZyb20gYSBjYWNoZWQgcG9zaXRpb24gdG8gYSBwb3NpdGlvbiB0aGF0IGlzIGluc2lkZSBhIHZpZXcgdGV4dCBub2RlLlxuXHQgKlxuXHQgKiBBZGRpdGlvbmFsbHksIG9ubHkgb25lIGl0ZW0gcGVyIGBtb2RlbE9mZnNldGAgaXMgY2FjaGVkLiBUaGVyZSBjYW4gYmUgc2V2ZXJhbCB2aWV3IG5vZGVzIHRoYXQgXCJlbmRcIiBhdCB0aGUgc2FtZSBgbW9kZWxPZmZzZXRgLlxuXHQgKiBJbiB0aGlzIGNhc2UsIHdlIGZhdm91ciBwb3NpdGlvbnMgdGhhdCBhcmUgY2xvc2VyIHRvIHRoZSBtYXBwZWQgaXRlbS4gRm9yIGV4YW1wbGVcblx0ICpcblx0ICogKiBmb3IgbW9kZWw6IGA8cGFyYWdyYXBoPlNvbWUgPCR0ZXh0IGJvbGQ9dHJ1ZSBpdGFsaWM9dHJ1ZT5mb3JtYXR0ZWQ8LyR0ZXh0PiB0ZXh0LjwvcGFyYWdyYXBoPmAsXG5cdCAqICogYW5kIHZpZXc6IGA8cD5Tb21lIDxlbT48c3Ryb25nPmZvcm1hdHRlZDwvc3Ryb25nPjwvZW0+IHRleHQuPC9wPmAsXG5cdCAqXG5cdCAqIGZvciBtb2RlbCBvZmZzZXQgYDE0YCAoYWZ0ZXIgXCJkXCIpLCB3ZSBzdG9yZSB2aWV3IHBvc2l0aW9uIGFmdGVyIGA8ZW0+YCBlbGVtZW50IChpLmUuIHZpZXcgcG9zaXRpb246IGF0IGA8cD5gLCBvZmZzZXQgYDJgKS5cblx0ICovIF9jYWNoZWRNYXBwaW5nID0gbmV3IFdlYWtNYXAoKTtcbiAgICAvKipcblx0ICogV2hlbiBgTWFwcGVyQ2FjaGVgIHtAbGluayB+TWFwcGVyQ2FjaGUjc2F2ZSBzYXZlc30gdmlldyBwb3NpdGlvbiAtPiBtb2RlbCBvZmZzZXQgbWFwcGluZywgYSBgQ2FjaGVJdGVtYCBpcyBpbnNlcnRlZCBpbnRvIGNlcnRhaW5cblx0ICogYE1hcHBpbmdDYWNoZSNjYWNoZUxpc3RgIGF0IHNvbWUgaW5kZXguIEFkZGl0aW9uYWxseSwgd2Ugc3RvcmUgdGhhdCBpbmRleCB3aXRoIHRoZSB2aWV3IG5vZGUgdGhhdCBpcyBiZWZvcmUgdGhlIGNhY2hlZCB2aWV3IHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUaGlzIGFsbG93cyB0byBxdWlja2x5IGdldCBhIGNhY2hlIGxpc3QgaXRlbSByZWxhdGVkIHRvIGNlcnRhaW4gdmlldyBub2RlLCBhbmQgaGVuY2UsIGZvciBmYXN0IGNhY2hlIGludmFsaWRhdGlvbi5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUsIGNvbnNpZGVyIHZpZXc6IGA8cD5Tb21lIDxzdHJvbmc+Ym9sZDwvc3Ryb25nPiB0ZXh0LjwvcD5gLCB3aGVyZSBgPHA+YCBpcyBhIHZpZXcgZWxlbWVudCB0cmFja2VkIGJ5IGBNYXBwZXJDYWNoZWAuXG5cdCAqIElmIGFsbCBgPHA+YCBjaGlsZHJlbiB3ZXJlIHZpc2l0ZWQgYnkgYE1hcHBlckNhY2hlYCwgdGhlbiBgPHA+YCBjYWNoZSBsaXN0IHdvdWxkIGhhdmUgZm91ciBpdGVtcywgcmVsYXRlZCB0byBmb2xsb3dpbmcgbW9kZWwgb2Zmc2V0czpcblx0ICogYDBgLCBgNWAsIGA5YCwgYDE1YC4gVGhlbiwgdmlldyBub2RlIGBcIlNvbWUgXCJgIHdvdWxkIGhhdmUgaW5kZXggYDFgLCBgPHN0cm9uZz5gIGluZGV4IGAyYCwgYW5kIGBcIiB0ZXh0LlwiIGluZGV4IGAzYC5cblx0ICpcblx0ICogTm90ZSB0aGF0IHRoZSBpbmRleCByZWxhdGVkIHdpdGggYSBub2RlIGlzIGFsd2F5cyBncmVhdGVyIHRoYW4gYDBgLiBUaGUgZmlyc3QgaXRlbSBpbiBjYWNoZSBsaXN0IGlzIGFsd2F5cyBmb3IgbW9kZWwgb2Zmc2V0IGAwYFxuXHQgKiAoYW5kIHZpZXcgb2Zmc2V0IGAwYCksIGFuZCBpdCBpcyBub3QgcmVsYXRlZCB0byBhbnkgbm9kZS5cblx0ICovIF9ub2RlVG9DYWNoZUxpc3RJbmRleCA9IG5ldyBXZWFrTWFwKCk7XG4gICAgLyoqXG5cdCAqIENhbGxiYWNrIGZpcmVkIHdoZW5ldmVyIHRoZXJlIGlzIGEgZGlyZWN0IG9yIGluZGlyZWN0IGNoaWxkcmVuIGNoYW5nZSBpbiB0cmFja2VkIHZpZXcgZWxlbWVudCBvciB0cmFja2VkIHZpZXcgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqXG5cdCAqIFRoaXMgaXMgc3BlY2lmaWVkIGFzIGEgcHJvcGVydHkgdG8gbWFrZSBpdCBlYXNpZXIgdG8gc2V0IGFzIGFuIGV2ZW50IGNhbGxiYWNrIGFuZCB0byBsYXRlciB0dXJuIG9mZiB0aGF0IGV2ZW50LlxuXHQgKi8gX2ludmFsaWRhdGVPbkNoaWxkcmVuQ2hhbmdlQ2FsbGJhY2sgPSAoZXZ0LCB2aWV3Tm9kZSwgZGF0YSk9PntcbiAgICAgICAgLy8gVmlldyBlbGVtZW50IG9yIGRvY3VtZW50IGZyYWdtZW50IGNoYW5nZWQgaXRzIGNoaWxkcmVuIGF0IGBkYXRhLmluZGV4YC4gQ2xlYXIgYWxsIGNhY2hlIHN0YXJ0aW5nIGZyb20gYmVmb3JlIHRoYXQgaW5kZXguXG4gICAgICAgIHRoaXMuX2NsZWFyQ2FjaGVJbnNpZGVQYXJlbnQodmlld05vZGUsIGRhdGEuaW5kZXgpO1xuICAgIH07XG4gICAgLyoqXG5cdCAqIENhbGxiYWNrIGZpcmVkIHdoZW5ldmVyIGEgdmlldyB0ZXh0IG5vZGUgZGlyZWN0bHkgb3IgaW5kaXJlY3RseSBpbnNpZGUgYSB0cmFja2VkIHZpZXcgZWxlbWVudCBvciB0cmFja2VkIHZpZXcgZG9jdW1lbnQgZnJhZ21lbnRcblx0ICogY2hhbmdlcyBpdHMgdGV4dCBkYXRhLlxuXHQgKlxuXHQgKiBUaGlzIGlzIHNwZWNpZmllZCBhcyBhIHByb3BlcnR5IHRvIG1ha2UgaXQgZWFzaWVyIHRvIHNldCBhcyBhbiBldmVudCBjYWxsYmFjayBhbmQgdG8gbGF0ZXIgdHVybiBvZmYgdGhhdCBldmVudC5cblx0ICovIF9pbnZhbGlkYXRlT25UZXh0Q2hhbmdlQ2FsbGJhY2sgPSAoZXZ0LCB2aWV3Tm9kZSk9PntcbiAgICAgICAgLy8gVGV4dCBub2RlIGhhcyBjaGFuZ2VkLiBDbGVhciBhbGwgdGhlIGNhY2hlIHN0YXJ0aW5nIGZyb20gYmVmb3JlIHRoaXMgdGV4dCBub2RlLlxuICAgICAgICB0aGlzLl9jbGVhckNhY2hlU3RhcnRpbmdCZWZvcmUodmlld05vZGUpO1xuICAgIH07XG4gICAgLyoqXG5cdCAqIFNhdmVzIGNhY2hlIGZvciBnaXZlbiB2aWV3IHBvc2l0aW9uIG1hcHBpbmcgPC0+IG1vZGVsIG9mZnNldCBtYXBwaW5nLiBUaGUgdmlldyBwb3NpdGlvbiBzaG91bGQgYmUgYWZ0ZXIgYSBub2RlIChpLmUuIGl0IGNhbm5vdFxuXHQgKiBiZSB0aGUgZmlyc3QgcG9zaXRpb24gaW5zaWRlIGl0cyBwYXJlbnQsIG9yIGluIG90aGVyIHdvcmRzLCBgdmlld09mZnNldGAgbXVzdCBiZSBncmVhdGVyIHRoYW4gYDBgKS5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdQYXJlbnQgVmlldyBwb3NpdGlvbiBwYXJlbnQuXG5cdCAqIEBwYXJhbSB2aWV3T2Zmc2V0IFZpZXcgcG9zaXRpb24gb2Zmc2V0LiBNdXN0IGJlIGdyZWF0ZXIgdGhhbiBgMGAuXG5cdCAqIEBwYXJhbSB2aWV3Q29udGFpbmVyIFRyYWNrZWQgdmlldyBwb3NpdGlvbiBhc2NlbmRhbnQgKGl0IG1heSBiZSB0aGUgZGlyZWN0IHBhcmVudCBvZiB0aGUgdmlldyBwb3NpdGlvbikuXG5cdCAqIEBwYXJhbSBtb2RlbE9mZnNldCBNb2RlbCBvZmZzZXQgaW4gdGhlIG1vZGVsIGVsZW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQgd2hpY2ggaXMgbWFwcGVkIHRvIGB2aWV3Q29udGFpbmVyYC5cblx0ICovIHNhdmUodmlld1BhcmVudCwgdmlld09mZnNldCwgdmlld0NvbnRhaW5lciwgbW9kZWxPZmZzZXQpIHtcbiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY2FjaGUgZm9yIHRoZSB0cmFja2VkIGFuY2VzdG9yLlxuICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuX2NhY2hlZE1hcHBpbmcuZ2V0KHZpZXdDb250YWluZXIpO1xuICAgICAgICAvLyBTZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNhY2hlIGRlZmluZWQgZm9yIGBtb2RlbE9mZnNldGAuXG4gICAgICAgIGNvbnN0IGNhY2hlSXRlbSA9IGNhY2hlLmNhY2hlTWFwLmdldChtb2RlbE9mZnNldCk7XG4gICAgICAgIGlmIChjYWNoZUl0ZW0pIHtcbiAgICAgICAgICAgIC8vIFdlIGFscmVhZHkgY2FjaGVkIHRoaXMgb2Zmc2V0LiBEb24ndCBvdmVyd3JpdGUgdGhlIGNhY2hlLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFRoaXMgYXNzdW1lcyB0aGF0IGBNYXBwZXJgIHdvcmtzIGluIGEgd2F5IHRoYXQgd2UgZmlyc3QgY2FjaGUgdGhlIHBhcmVudCBhbmQgb25seSB0aGVuIGNhY2hlIGNoaWxkcmVuLCBhcyB3ZSBwcmVmZXIgcG9zaXRpb25cbiAgICAgICAgICAgIC8vIGFmdGVyIHRoZSBwYXJlbnQgKFwiY2xvc2VyXCIgdG8gdGhlIHRyYWNrZWQgYW5jZXN0b3IpLiBJdCBtaWdodCBiZSBzYWZlciB0byBjaGVjayB3aGljaCBwb3NpdGlvbiBpcyBwcmVmZXJyZWQgKG5ld2x5IHNhdmVkIG9yXG4gICAgICAgICAgICAvLyB0aGUgb25lIGN1cnJlbnRseSBpbiBjYWNoZSkgYnV0IGl0IHdvdWxkIHJlcXVpcmUgYWRkaXRpb25hbCBwcm9jZXNzaW5nLiBGb3Igbm93LCBgTWFwcGVyI19maW5kUG9zaXRpb25JbigpYCBhbmRcbiAgICAgICAgICAgIC8vIGBNYXBwZXIjZ2V0TW9kZWxMZW5ndGgoKWAgYXJlIGltcGxlbWVudGVkIHNvIHRoYXQgcGFyZW50cyBhcmUgY2FjaGVkIGJlZm9yZSB0aGVpciBjaGlsZHJlbi5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBTbywgZG9uJ3QgY3JlYXRlIG5ldyBjYWNoZSBpZiBvbmUgYWxyZWFkeSBleGlzdHMuIEluc3RlYWQsIG9ubHkgc2F2ZSBgX25vZGVUb0NhY2hlTGlzdEluZGV4YCB2YWx1ZSBmb3IgdGhlIHJlbGF0ZWQgdmlldyBub2RlLlxuICAgICAgICAgICAgY29uc3Qgdmlld0NoaWxkID0gdmlld1BhcmVudC5nZXRDaGlsZCh2aWV3T2Zmc2V0IC0gMSk7XG4gICAgICAgICAgICAvLyBGaWd1cmUgb3V0IHdoYXQgaW5kZXggdG8gc2F2ZSB3aXRoIGB2aWV3Q2hpbGRgLlxuICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIGBjYWNoZUl0ZW1gIGZvciB0aGUgYG1vZGVsT2Zmc2V0YCwgc28gd2UgY2FuIGdldCBhIGB2aWV3UG9zaXRpb25gIGZyb20gdGhlcmUuIEJlZm9yZSB0aGF0IHZpZXcgcG9zaXRpb24sIHRoZXJlXG4gICAgICAgICAgICAvLyBtdXN0IGJlIGEgbm9kZS4gVGhhdCBub2RlIG11c3QgaGF2ZSBhbiBpbmRleCBzZXQuIFRoaXMgd2lsbCBiZSB0aGUgaW5kZXggd2Ugd2lsbCB3YW50IHRvIHVzZS5cbiAgICAgICAgICAgIC8vIFNpbmNlIHdlIGV4cGVjdCBgdmlld09mZnNldGAgdG8gYmUgZ3JlYXRlciB0aGFuIDAsIHRoZW4gaW4gYWxtb3N0IGFsbCBjYXNlcyBgbW9kZWxPZmZzZXRgIHdpbGwgYmUgZ3JlYXRlciB0aGFuIDAgYXMgd2VsbC5cbiAgICAgICAgICAgIC8vIEFzIGEgcmVzdWx0LCB3ZSBjYW4gZXhwZWN0IGBjYWNoZUl0ZW0udmlld1Bvc2l0aW9uLm5vZGVCZWZvcmVgIHRvIGJlIHNldC5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBIb3dldmVyLCBpbiBhbiBlZGdlIGNhc2UsIHdlcmUgdGhlIHRyYWNrZWQgZWxlbWVudCBjb250YWlucyBhIDAtbW9kZWwtbGVuZ3RoIHZpZXcgZWxlbWVudCBhcyB0aGUgZmlyc3QgY2hpbGQgKFVJIGVsZW1lbnQgb3JcbiAgICAgICAgICAgIC8vIGFuIGVtcHR5IGF0dHJpYnV0ZSBlbGVtZW50KSwgdGhlbiBgbW9kZWxPZmZzZXRgIHdpbGwgYmUgMCwgYW5kIGBjYWNoZUl0ZW1gIHdpbGwgYmUgdGhlIGZpcnN0IGNhY2hlIGl0ZW0sIHdoaWNoIGlzIGJlZm9yZSBhbnlcbiAgICAgICAgICAgIC8vIHZpZXcgbm9kZS4gSW4gc3VjaCBlZGdlIGNhc2UsIGBjYWNoZUl0ZW0udmlld1Bvc2l0aW9uLm5vZGVCZWZvcmVgIGlzIHVuZGVmaW5lZCwgYW5kIHdlIG1hbnVhbGx5IHNldCB0byBgMGAuXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGNhY2hlSXRlbS52aWV3UG9zaXRpb24ubm9kZUJlZm9yZSA/IHRoaXMuX25vZGVUb0NhY2hlTGlzdEluZGV4LmdldChjYWNoZUl0ZW0udmlld1Bvc2l0aW9uLm5vZGVCZWZvcmUpIDogMDtcbiAgICAgICAgICAgIHRoaXMuX25vZGVUb0NhY2hlTGlzdEluZGV4LnNldCh2aWV3Q2hpbGQsIGluZGV4KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3UG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMSh2aWV3UGFyZW50LCB2aWV3T2Zmc2V0KTtcbiAgICAgICAgY29uc3QgbmV3Q2FjaGVJdGVtID0ge1xuICAgICAgICAgICAgdmlld1Bvc2l0aW9uLFxuICAgICAgICAgICAgbW9kZWxPZmZzZXRcbiAgICAgICAgfTtcbiAgICAgICAgLy8gRXh0ZW5kIHRoZSB2YWxpZCBjYWNoZSByYW5nZS5cbiAgICAgICAgY2FjaGUubWF4TW9kZWxPZmZzZXQgPSBtb2RlbE9mZnNldCA+IGNhY2hlLm1heE1vZGVsT2Zmc2V0ID8gbW9kZWxPZmZzZXQgOiBjYWNoZS5tYXhNb2RlbE9mZnNldDtcbiAgICAgICAgLy8gU2F2ZSB0aGUgbmV3IGNhY2hlIGl0ZW0gdG8gdGhlIGBjYWNoZU1hcGAuXG4gICAgICAgIGNhY2hlLmNhY2hlTWFwLnNldChtb2RlbE9mZnNldCwgbmV3Q2FjaGVJdGVtKTtcbiAgICAgICAgLy8gU2F2ZSB0aGUgbmV3IGNhY2hlIGl0ZW0gdG8gdGhlIGBjYWNoZUxpc3RgLlxuICAgICAgICBsZXQgaSA9IGNhY2hlLmNhY2hlTGlzdC5sZW5ndGggLSAxO1xuICAgICAgICAvLyBNb3N0bHksIHdlIGNhY2hlIGVsZW1lbnRzIGF0IHRoZSBlbmQgb2YgYGNhY2hlTGlzdGAgYW5kIHRoZSBsb29wIGRvZXMgbm90IGV4ZWN1dGUgZXZlbiBvbmNlLiBCdXQgd2hlbiB3ZSByZWN1cnNpdmVseSB2aXNpdCBub2Rlc1xuICAgICAgICAvLyBpbiBgTWFwcGVyI19maW5kUG9zaXRpb25JbigpYCwgdGhlbiB3ZSB3aWxsIGZpcnN0IGNhY2hlIHRoZSBwYXJlbnQsIGFuZCB0aGVuIGl0J3MgY2hpbGRyZW4sIGFuZCB0aGV5IHdpbGwgbm90IGJlIGFkZGVkIGF0IHRoZVxuICAgICAgICAvLyBlbmQgb2YgYGNhY2hlTGlzdGAuIFRoaXMgaXMgd2h5IHdlIG5lZWQgdG8gZmluZCBjb3JyZWN0IGluZGV4IHRvIGluc2VydCB0aGVtLlxuICAgICAgICB3aGlsZShpID49IDAgJiYgY2FjaGUuY2FjaGVMaXN0W2ldLm1vZGVsT2Zmc2V0ID4gbW9kZWxPZmZzZXQpe1xuICAgICAgICAgICAgaS0tO1xuICAgICAgICB9XG4gICAgICAgIGNhY2hlLmNhY2hlTGlzdC5zcGxpY2UoaSArIDEsIDAsIG5ld0NhY2hlSXRlbSk7XG4gICAgICAgIGlmICh2aWV3T2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgdmlld0NoaWxkID0gdmlld1BhcmVudC5nZXRDaGlsZCh2aWV3T2Zmc2V0IC0gMSk7XG4gICAgICAgICAgICAvLyBUaGVyZSB3YXMgYW4gaWRlYSB0byBhbHNvIGNhY2hlIGB2aWV3Q29udGFpbmVyYCBoZXJlIGJ1dCwgaXQgY291bGQgbGVhZCB0byB3cm9uZyByZXN1bHRzLiBJZiB3ZSB3YW50ZWQgdG8gY2FjaGVcbiAgICAgICAgICAgIC8vIGB2aWV3Q29udGFpbmVyYCwgd2UgcHJvYmFibHkgd291bGQgbmVlZCB0byBjbGVhciBgdGhpcy5fbm9kZVRvQ2FjaGVMaXN0SW5kZXhgIHdoZW4gY2FjaGUgaXMgY2xlYXJlZC5cbiAgICAgICAgICAgIC8vIEFsc28sIHRoZXJlIHdhcyBubyBnYWluIGZyb20gY2FjaGluZyB0aGlzIHZhbHVlLCB0aGUgcmVzdWx0cyB3ZXJlIGFsbW9zdCB0aGUgc2FtZSAoc3RhdGlzdGljYWwgZXJyb3IpLlxuICAgICAgICAgICAgdGhpcy5fbm9kZVRvQ2FjaGVMaXN0SW5kZXguc2V0KHZpZXdDaGlsZCwgaSArIDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb3IgZ2l2ZW4gYG1vZGVsT2Zmc2V0YCBpbnNpZGUgYSBtb2RlbCBlbGVtZW50IG1hcHBlZCB0byBnaXZlbiBgdmlld0NvbnRhaW5lcmAsIGl0IHJldHVybnMgdGhlIGNsb3Nlc3Qgc2F2ZWQgY2FjaGUgaXRlbVxuXHQgKiAodmlldyBwb3NpdGlvbiBhbmQgcmVsYXRlZCBtb2RlbCBvZmZzZXQpIHRvIHRoZSByZXF1ZXN0ZWQgb25lLlxuXHQgKlxuXHQgKiBJdCBjYW4gYmUgZXhhY3RseSB0aGUgcmVxdWVzdGVkIG1hcHBpbmcsIG9yIGl0IGNhbiBiZSBtYXBwaW5nIHRoYXQgaXMgdGhlIGNsb3Nlc3Qgc3RhcnRpbmcgcG9pbnQgdG8gbG9vayBmb3IgdGhlIHJlcXVlc3RlZCBtYXBwaW5nLlxuXHQgKlxuXHQgKiBgdmlld0NvbnRhaW5lcmAgbXVzdCBiZSBhIHZpZXcgZWxlbWVudCBvciBkb2N1bWVudCBmcmFnbWVudCB0aGF0IGlzIG1hcHBlZCBieSB0aGUge0BsaW5rIH5NYXBwZXIgTWFwcGVyfS5cblx0ICpcblx0ICogSWYgYHZpZXdDb250YWluZXJgIGlzIG5vdCB5ZXQgdHJhY2tlZCBieSB0aGUgYE1hcHBlckNhY2hlYCwgaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IHRyYWNrZWQgYWZ0ZXIgY2FsbGluZyB0aGlzIG1ldGhvZC5cblx0ICpcblx0ICogTm90ZTogdGhpcyBtZXRob2Qgd2lsbCBhdXRvbWF0aWNhbGx5IFwiaG9pc3RcIiBjYWNoZWQgcG9zaXRpb25zLCBpLmUuIGl0IHdpbGwgcmV0dXJuIGEgcG9zaXRpb24gdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSB0cmFja2VkIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEZvciBleGFtcGxlLCBpZiBgPHA+YCBpcyB0cmFja2VkIGVsZW1lbnQsIGFuZCBgXmAgaXMgY2FjaGVkIHBvc2l0aW9uOlxuXHQgKlxuXHQgKiBgYGBcblx0ICogPHA+VGhpcyBpcyA8c3Ryb25nPnNvbWUgPGVtPmhlYXZpbHkgPHU+Zm9ybWF0dGVkPC91Pl48L2VtPjwvc3Ryb25nPiB0ZXh0LjwvcD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIHRoaXMgcG9zaXRpb24gd291bGQgYmUgcmV0dXJuZWQsIGluc3RlYWQsIGEgcG9zaXRpb24gZGlyZWN0bHkgaW4gYDxwPmAgd291bGQgYmUgcmV0dXJuZWQ6XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiA8cD5UaGlzIGlzIDxzdHJvbmc+c29tZSA8ZW0+aGVhdmlseSA8dT5mb3JtYXR0ZWQ8L3U+PC9lbT48L3N0cm9uZz5eIHRleHQuPC9wPlxuXHQgKiBgYGBcblx0ICpcblx0ICogTm90ZSwgdGhhdCBgbW9kZWxPZmZzZXRgIGZvciBib3RoIHBvc2l0aW9ucyBpcyB0aGUgc2FtZS5cblx0ICpcblx0ICogQHBhcmFtIHZpZXdDb250YWluZXIgVHJhY2tlZCB2aWV3IGVsZW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQsIHdoaWNoIGNhY2hlIHdpbGwgYmUgdXNlZC5cblx0ICogQHBhcmFtIG1vZGVsT2Zmc2V0IE1vZGVsIG9mZnNldCBpbiBhIG1vZGVsIGVsZW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQsIHdoaWNoIGlzIG1hcHBlZCB0byBgdmlld0NvbnRhaW5lcmAuXG5cdCAqLyBnZXRDbG9zZXN0KHZpZXdDb250YWluZXIsIG1vZGVsT2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fY2FjaGVkTWFwcGluZy5nZXQodmlld0NvbnRhaW5lcik7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGlmIChjYWNoZSkge1xuICAgICAgICAgICAgaWYgKG1vZGVsT2Zmc2V0ID4gY2FjaGUubWF4TW9kZWxPZmZzZXQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBjYWNoZS5jYWNoZUxpc3RbY2FjaGUuY2FjaGVMaXN0Lmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWNoZUl0ZW0gPSBjYWNoZS5jYWNoZU1hcC5nZXQobW9kZWxPZmZzZXQpO1xuICAgICAgICAgICAgICAgIGlmIChjYWNoZUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY2FjaGVJdGVtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuX2ZpbmRJbkNhY2hlTGlzdChjYWNoZS5jYWNoZUxpc3QsIG1vZGVsT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLnN0YXJ0VHJhY2tpbmcodmlld0NvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gdGhpcy5faG9pc3RWaWV3UG9zaXRpb24ocmVzdWx0LnZpZXdQb3NpdGlvbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtb2RlbE9mZnNldDogcmVzdWx0Lm1vZGVsT2Zmc2V0LFxuICAgICAgICAgICAgdmlld1Bvc2l0aW9uXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyBhIHZpZXcgcG9zaXRpb24gdG8gYSBwcmVmZXJyZWQgbG9jYXRpb24uXG5cdCAqXG5cdCAqIFRoZSB2aWV3IHBvc2l0aW9uIGlzIG1vdmVkIHVwIGZyb20gYSBub24tdHJhY2tlZCB2aWV3IGVsZW1lbnQgYXMgbG9uZyBhcyBpdCByZW1haW5zIGF0IHRoZSBlbmQgb2YgaXRzIGN1cnJlbnQgcGFyZW50LlxuXHQgKlxuXHQgKiBTZWUgZXhhbXBsZSBiZWxvdyB0byB1bmRlcnN0YW5kIHdoZW4gaXQgaXMgaW1wb3J0YW50OlxuXHQgKlxuXHQgKiBTdGFydGluZyBzdGF0ZTpcblx0ICpcblx0ICogYGBgXG5cdCAqIDxwPlRoaXMgaXMgPHN0cm9uZz5zb21lIDxlbT5oZWF2aWx5IDx1PmZvcm1hdHRlZDwvdT5eIHBpZWNlIG9mPC9lbT48L3N0cm9uZz4gdGV4dC48L3A+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGVuIHdlIHJlbW92ZSBcIiBwaWVjZSBvZiBcIiBhbmQgaW52YWxpZGF0ZSBzb21lIGNhY2hlOlxuXHQgKlxuXHQgKiBgYGBcblx0ICogPHA+VGhpcyBpcyA8c3Ryb25nPnNvbWUgPGVtPmhlYXZpbHkgPHU+Zm9ybWF0dGVkPC91Pl48L2VtPjwvc3Ryb25nPiB0ZXh0LjwvcD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIE5vdywgaWYgd2UgYXNrIGZvciBtb2RlbCBvZmZzZXQgYWZ0ZXIgbGV0dGVyIFwiZFwiIGluIFwiZm9ybWF0dGVkXCIsIHdlIHNob3VsZCBnZXQgYSBwb3NpdGlvbiBpbiBcIiB0ZXh0XCIsIGJ1dCB3ZSB3aWxsIGdldCBpbiBgPGVtPmAuXG5cdCAqIEZvciB0aGlzIHNjZW5hcmlvLCB3ZSBuZWVkIHRvIGhvaXN0IHRoZSBwb3NpdGlvbi5cblx0ICpcblx0ICogYGBgXG5cdCAqIDxwPlRoaXMgaXMgPHN0cm9uZz5zb21lIDxlbT5oZWF2aWx5IDx1PmZvcm1hdHRlZDwvdT48L2VtPjwvc3Ryb25nPl4gdGV4dC48L3A+XG5cdCAqIGBgYFxuXHQgKi8gX2hvaXN0Vmlld1Bvc2l0aW9uKHZpZXdQb3NpdGlvbikge1xuICAgICAgICB3aGlsZSh2aWV3UG9zaXRpb24ucGFyZW50LnBhcmVudCAmJiAhdGhpcy5fY2FjaGVkTWFwcGluZy5oYXModmlld1Bvc2l0aW9uLnBhcmVudCkgJiYgdmlld1Bvc2l0aW9uLmlzQXRFbmQpe1xuICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdmlld1Bvc2l0aW9uLnBhcmVudC5wYXJlbnQ7XG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleCh2aWV3UG9zaXRpb24ucGFyZW50KSArIDE7XG4gICAgICAgICAgICB2aWV3UG9zaXRpb24gPSBuZXcgUG9zaXRpb24kMShwYXJlbnQsIG9mZnNldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZpZXdQb3NpdGlvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyB0cmFja2luZyBnaXZlbiBgdmlld0NvbnRhaW5lcmAsIHdoaWNoIG11c3QgYmUgbWFwcGVkIHRvIGEgbW9kZWwgZWxlbWVudCBvciBtb2RlbCBkb2N1bWVudCBmcmFnbWVudC5cblx0ICpcblx0ICogTm90ZSwgdGhhdCB0aGlzIG1ldGhvZCBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCBieVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXJDYWNoZSNnZXRDbG9zZXN0IGBNYXBwZXJDYWNoZSNnZXRDbG9zZXN0KClgfSBhbmQgdGhlcmUgaXMgbm8gbmVlZCB0byBjYWxsIGl0IG1hbnVhbGx5LlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpbml0aWFsaXplcyB0aGUgY2FjaGUgZm9yIGB2aWV3Q29udGFpbmVyYCBhbmQgYWRkcyBjYWxsYmFja3MgZm9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5WaWV3Tm9kZUNoYW5nZUV2ZW50IGBjaGFuZ2VgIGV2ZW50fSBmaXJlZCBieSBgdmlld0NvbnRhaW5lcmAuIGBNYXBwZXJDYWNoZWAgbGlzdGVucyB0byBgY2hhbmdlYCBldmVudFxuXHQgKiBvbiB0aGUgdHJhY2tlZCBlbGVtZW50cyB0byBpbnZhbGlkYXRlIHRoZSBzdG9yZWQgY2FjaGUuXG5cdCAqLyBzdGFydFRyYWNraW5nKHZpZXdDb250YWluZXIpIHtcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gbmV3IFBvc2l0aW9uJDEodmlld0NvbnRhaW5lciwgMCk7XG4gICAgICAgIGNvbnN0IGluaXRpYWxDYWNoZUl0ZW0gPSB7XG4gICAgICAgICAgICB2aWV3UG9zaXRpb24sXG4gICAgICAgICAgICBtb2RlbE9mZnNldDogMFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBpbml0aWFsQ2FjaGUgPSB7XG4gICAgICAgICAgICBtYXhNb2RlbE9mZnNldDogMCxcbiAgICAgICAgICAgIGNhY2hlTGlzdDogW1xuICAgICAgICAgICAgICAgIGluaXRpYWxDYWNoZUl0ZW1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBjYWNoZU1hcDogbmV3IE1hcChbXG4gICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICAgICBpbml0aWFsQ2FjaGVJdGVtXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgXSlcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fY2FjaGVkTWFwcGluZy5zZXQodmlld0NvbnRhaW5lciwgaW5pdGlhbENhY2hlKTtcbiAgICAgICAgLy8gTGlzdGVuIHRvIGNoYW5nZXMgaW4gdHJhY2tlZCB2aWV3IGNvbnRhaW5lcnMgaW4gb3JkZXIgdG8gaW52YWxpZGF0ZSB0aGUgY2FjaGUuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFBvc3NpYmxlIHBlcmZvcm1hbmNlIGltcHJvdmVtZW50LiBUaGlzIGV2ZW50IGJ1YmJsZXMsIHNvIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSB0cmFja2VkIChtYXBwZWQpIGVsZW1lbnRzIHRoYXQgYXJlIGFuY2VzdG9yc1xuICAgICAgICAvLyB0aGVuIHRoaXMgd2lsbCBiZSB1bm5lY2Vzc2FyaWx5IGZpcmVkIGZvciBlYWNoIGFuY2VzdG9yLiBUaGlzIGNvdWxkIGJlIHJld3JpdHRlbiB0byBsaXN0ZW4gb25seSB0byByb290cyBhbmQgZG9jdW1lbnQgZnJhZ21lbnRzLlxuICAgICAgICB2aWV3Q29udGFpbmVyLm9uKCdjaGFuZ2U6Y2hpbGRyZW4nLCB0aGlzLl9pbnZhbGlkYXRlT25DaGlsZHJlbkNoYW5nZUNhbGxiYWNrKTtcbiAgICAgICAgdmlld0NvbnRhaW5lci5vbignY2hhbmdlOnRleHQnLCB0aGlzLl9pbnZhbGlkYXRlT25UZXh0Q2hhbmdlQ2FsbGJhY2spO1xuICAgICAgICByZXR1cm4gaW5pdGlhbENhY2hlSXRlbTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0b3BzIHRyYWNraW5nIGdpdmVuIGB2aWV3Q29udGFpbmVyYC5cblx0ICpcblx0ICogSXQgcmVtb3ZlcyB0aGUgY2FjaGVkIGRhdGEgYW5kIHN0b3BzIGxpc3RlbmluZyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Vmlld05vZGVDaGFuZ2VFdmVudCBgY2hhbmdlYCBldmVudH0gb24gdGhlXG5cdCAqIGB2aWV3Q29udGFpbmVyYC5cblx0ICovIHN0b3BUcmFja2luZyh2aWV3Q29udGFpbmVyKSB7XG4gICAgICAgIHZpZXdDb250YWluZXIub2ZmKCdjaGFuZ2U6Y2hpbGRyZW4nLCB0aGlzLl9pbnZhbGlkYXRlT25DaGlsZHJlbkNoYW5nZUNhbGxiYWNrKTtcbiAgICAgICAgdmlld0NvbnRhaW5lci5vZmYoJ2NoYW5nZTp0ZXh0JywgdGhpcy5faW52YWxpZGF0ZU9uVGV4dENoYW5nZUNhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5fY2FjaGVkTWFwcGluZy5kZWxldGUodmlld0NvbnRhaW5lcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnZhbGlkYXRlcyBjYWNoZSBpbnNpZGUgYHZpZXdQYXJlbnRgLCBzdGFydGluZyBmcm9tIGdpdmVuIGBpbmRleGAgaW4gdGhhdCBwYXJlbnQuXG5cdCAqLyBfY2xlYXJDYWNoZUluc2lkZVBhcmVudCh2aWV3UGFyZW50LCBpbmRleCkge1xuICAgICAgICBpZiAoaW5kZXggPT0gMCkge1xuICAgICAgICAgICAgLy8gQ2hhbmdlIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHBhcmVudC5cbiAgICAgICAgICAgIGlmICh0aGlzLl9jYWNoZWRNYXBwaW5nLmhhcyh2aWV3UGFyZW50KSkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSB0cmFja2VkIGVsZW1lbnQsIGNsZWFyIGFsbCBjYWNoZS5cbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhckNhY2hlQWxsKHZpZXdQYXJlbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIG5vdCBhIHRyYWNrZWQgZWxlbWVudCwgcmVtb3ZlIGNhY2hlIHN0YXJ0aW5nIGZyb20gYmVmb3JlIHRoaXMgZWxlbWVudC5cbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhckNhY2hlU3RhcnRpbmdCZWZvcmUodmlld1BhcmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDaGFuZ2UgaW4gdGhlIG1pZGRsZSBvZiB0aGUgcGFyZW50LiBHZXQgYSB2aWV3IG5vZGUgdGhhdCdzIGJlZm9yZSB0aGUgY2hhbmdlLlxuICAgICAgICAgICAgY29uc3QgbGFzdFZhbGlkTm9kZSA9IHZpZXdQYXJlbnQuZ2V0Q2hpbGQoaW5kZXggLSAxKTtcbiAgICAgICAgICAgIC8vIFRoZW4sIGNsZWFyIGFsbCBjYWNoZSBzdGFydGluZyBmcm9tIGJlZm9yZSB0aGlzIHZpZXcgbm9kZS5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBQb3NzaWJsZSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudC4gV2UgY291bGQgaGF2ZSBoYWQgYF9jbGVhckNhY2hlQWZ0ZXIoIGxhc3RWYWxpZE5vZGUgKWAgaW5zdGVhZC5cbiAgICAgICAgICAgIC8vIElmIHRoZSBgbGFzdFZhbGlkTm9kZWAgaXMgdGhlIGxhc3QgdW5jaGFuZ2VkIG5vZGUsIHRoZW4gd2UgY291bGQgY2xlYXIgZXZlcnl0aGluZyBBRlRFUiBpdCwgbm90IGJlZm9yZS5cbiAgICAgICAgICAgIC8vIEhvd2V2ZXIsIHdpdGggdGhlIGN1cnJlbnQgc2V0dXAsIGl0IGRpZG4ndCB3b3JrIHByb3Blcmx5IGFuZCB0aGUgYWN0dWFsIGdhaW4gd2Fzbid0IHRoYXQgYmlnIG9uIHRoZSB0ZXN0ZWQgZGF0YS5cbiAgICAgICAgICAgIC8vIFRoZSBwcm9ibGVtIHdhcyB3aXRoIGZvbGxvd2luZyBleGFtcGxlOiA8cD5Gb288ZW0+PHN0cm9uZz5YeXo8L3N0cm9uZz48L2VtPkJhcjwvcD4uXG4gICAgICAgICAgICAvLyBJbiB0aGlzIGV4YW1wbGUgd2UgY2FjaGUgcG9zaXRpb24gYWZ0ZXIgPGVtPiwgaS5lLiB2aWV3IHBvc2l0aW9uIGA8cD5gIDIgaXMgc2F2ZWQgd2l0aCBtb2RlbCBvZmZzZXQgNi5cbiAgICAgICAgICAgIC8vIE5vdywgaWYgd2UgYWRkIHNvbWUgdGV4dCBpbiBgPGVtPmAsIHdlIHdvbid0IHZhbGlkYXRlIHRoaXMgY2FjaGVkIGl0ZW0gZXZlbiB0aG91Z2ggaXQgZ2V0cyBvdXRkYXRlZC5cbiAgICAgICAgICAgIC8vIFNvLCBpZiB0aGVyZSdzIGEgbmVlZCB0byBoYXZlIGBfY2xlYXJDYWNoZUFmdGVyKClgLCB3ZSBuZWVkIHRvIHNvbHZlIHRoZSBhYm92ZSBjYXNlIGZpcnN0LlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ2FjaGVTdGFydGluZ0JlZm9yZShsYXN0VmFsaWROb2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2xlYXJzIGFsbCB0aGUgY2FjaGUgZm9yIGdpdmVuIHRyYWNrZWQgYHZpZXdDb250YWluZXJgLlxuXHQgKi8gX2NsZWFyQ2FjaGVBbGwodmlld0NvbnRhaW5lcikge1xuICAgICAgICBjb25zdCBjYWNoZSA9IHRoaXMuX2NhY2hlZE1hcHBpbmcuZ2V0KHZpZXdDb250YWluZXIpO1xuICAgICAgICBpZiAoY2FjaGUubWF4TW9kZWxPZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICBjYWNoZS5tYXhNb2RlbE9mZnNldCA9IDA7XG4gICAgICAgICAgICBjYWNoZS5jYWNoZUxpc3QubGVuZ3RoID0gMTtcbiAgICAgICAgICAgIGNhY2hlLmNhY2hlTWFwLmNsZWFyKCk7XG4gICAgICAgICAgICBjYWNoZS5jYWNoZU1hcC5zZXQoMCwgY2FjaGUuY2FjaGVMaXN0WzBdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ2xlYXJzIGFsbCB0aGUgc3RvcmVkIGNhY2hlIHN0YXJ0aW5nIGJlZm9yZSBnaXZlbiBgdmlld05vZGVgLiBUaGUgYHZpZXdOb2RlYCBjYW4gYmUgYW55IG5vZGUgdGhhdCBpcyBpbnNpZGUgYSB0cmFja2VkIHZpZXcgZWxlbWVudFxuXHQgKiBvciB2aWV3IGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKi8gX2NsZWFyQ2FjaGVTdGFydGluZ0JlZm9yZSh2aWV3Tm9kZSkge1xuICAgICAgICAvLyBUbyBxdWlja2x5IGludmFsaWRhdGUgdGhlIGNhY2hlLCB3ZSBiYXNlIG9uIHRoZSBjYWNoZSBsaXN0IGluZGV4IHN0b3JlZCB3aXRoIHRoZSBub2RlLiBTZWUgZG9jcyBmb3IgYHRoaXMuX25vZGVUb0NhY2hlTGlzdEluZGV4YC5cbiAgICAgICAgY29uc3QgY2FjaGVMaXN0SW5kZXggPSB0aGlzLl9ub2RlVG9DYWNoZUxpc3RJbmRleC5nZXQodmlld05vZGUpO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBpbmRleCBzdG9yZWQsIGl0IG1lYW5zIHRoYXQgdGhpcyBgdmlld05vZGVgIGhhcyBub3QgYmVlbiBjYWNoZWQgeWV0LlxuICAgICAgICBpZiAoY2FjaGVMaXN0SW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIG5vZGUgaXMgbm90IGNhY2hlZCwgbWF5YmUgaXQncyBwYXJlbnQgaXMuIFdlIHdpbGwgdHJ5IHRvIGludmFsaWRhdGUgdGhlIGNhY2hlIHN0YXJ0aW5nIGZyb20gYmVmb3JlIHRoZSBwYXJlbnQuXG4gICAgICAgICAgICAvLyBOb3RlLCB0aGF0IHRoZXJlIGFsd2F5cyBtdXN0IGJlIGEgcGFyZW50IGlmIHdlIGdvdCBoZXJlLlxuICAgICAgICAgICAgY29uc3Qgdmlld1BhcmVudCA9IHZpZXdOb2RlLnBhcmVudDtcbiAgICAgICAgICAgIC8vIElmIHRoZSBwYXJlbnQgaXMgYSBub24tdHJhY2tlZCBlbGVtZW50LCB0cnkgY2xlYXJpbmcgdGhlIGNhY2hlIHN0YXJ0aW5nIGJlZm9yZSBpdC5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBUaGlzIHNpdHVhdGlvbiBtYXkgaGFwcGVuIGUuZy4gaWYgc3RydWN0dXJlIGxpa2UgYDxwPjxzdHJvbmc+PGVtPkZvbzwvZW0+PC9zdHJvbmc+Li4uYCB3YXMgc3RlcHBlZCBvdmVyIGluXG4gICAgICAgICAgICAvLyBgTWFwcGVyI19maW5kUG9zaXRpb25JbigpYCBhbmQgdGhlIGNoaWxkcmVuIGFyZSBub3QgY2FjaGVkIHlldCwgYnV0IHRoZSBgPHN0cm9uZz5gIGVsZW1lbnQgaXMuIElmIHNvbWV0aGluZyBjaGFuZ2VzXG4gICAgICAgICAgICAvLyBpbnNpZGUgdGhpcyBzdHJ1Y3R1cmUsIG1ha2Ugc3VyZSB0byBpbnZhbGlkYXRlIGFsbCB0aGUgY2FjaGUgYWZ0ZXIgYDxzdHJvbmc+YC5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBJZiB0aGUgcGFyZW50IGlzIGEgdHJhY2tlZCBlbGVtZW50LCB0aGVuIGl0IG1lYW5zIHRoZXJlJ3Mgbm8gY2FjaGUgdG8gY2xlYXIgKG5vdGhpbmcgYWZ0ZXIgdGhlIGVsZW1lbnQgaXMgY2FjaGVkKS5cbiAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSwgdGhlcmUncyBub3RoaW5nIHRvIGRvLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGlmICghdGhpcy5fY2FjaGVkTWFwcGluZy5oYXModmlld1BhcmVudCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhckNhY2hlU3RhcnRpbmdCZWZvcmUodmlld1BhcmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm90ZTogdGhlcmUgd2FzIGEgY29uc2lkZXJhdGlvbiB0byBzYXZlIHRoZSBgdmlld0NvbnRhaW5lcmAgdmFsdWUgdG9nZXRoZXIgd2l0aCBgY2FjaGVMaXN0SW5kZXhgIHZhbHVlLlxuICAgICAgICAvLyBIb3dldmVyLCBpdCBpcyBsaWtlIGl0IGlzIG9uIHB1cnBvc2UuIFdlIHdhbnQgdG8gZmluZCAqY3VycmVudCogbWFwcGVkIGFuY2VzdG9yIGZvciB0aGUgYHZpZXdOb2RlYC5cbiAgICAgICAgLy8gVGhpcyBpcyBhbiBlc3NlbnRpYWwgc3RlcCB0byB2ZXJpZnkgaWYgdGhlIGNhY2hlIGlzIHN0aWxsIHVwLXRvLWRhdGUuXG4gICAgICAgIC8vIEFjdHVhbGx5LCB3ZSBjb3VsZCBzYXZlIGB2aWV3Q29udGFpbmVyYCBhbmQgY29tcGFyZSBpdCB0byBjdXJyZW50IHRyYWNrZWQgYW5jZXN0b3IgdG8gcXVpY2tseSBpbnZhbGlkYXRlLlxuICAgICAgICAvLyBCdXQgdGhpcyBraW5kYSBoYXBwZW5zIHdpdGggb3VyIGZsb3cgYW5kIG90aGVyIGFzc3VtcHRpb25zIGFyb3VuZCBjYWNoaW5nIGxpc3QgaW5kZXggYW55d2F5LlxuICAgICAgICBsZXQgdmlld0NvbnRhaW5lciA9IHZpZXdOb2RlLnBhcmVudDtcbiAgICAgICAgd2hpbGUoIXRoaXMuX2NhY2hlZE1hcHBpbmcuaGFzKHZpZXdDb250YWluZXIpKXtcbiAgICAgICAgICAgIHZpZXdDb250YWluZXIgPSB2aWV3Q29udGFpbmVyLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jbGVhckNhY2hlRnJvbUluZGV4KHZpZXdDb250YWluZXIsIGNhY2hlTGlzdEluZGV4KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsZWFycyBhbGwgdGhlIGNhY2hlIGluIHRoZSBjYWNoZSBsaXN0IHJlbGF0ZWQgdG8gZ2l2ZW4gYHZpZXdDb250YWluZXJgLCBzdGFydGluZyBmcm9tIGBpbmRleGAgKGluY2x1c2l2ZSkuXG5cdCAqLyBfY2xlYXJDYWNoZUZyb21JbmRleCh2aWV3Q29udGFpbmVyLCBpbmRleCkge1xuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIC8vIERvbid0IHJlbW92ZSB0aGUgZmlyc3QgZW50cnkgaW4gdGhlIGNhY2hlICh0aGlzIGVudHJ5IGlzIGFsd2F5cyBhIG1hcHBpbmcgYmV0d2VlbiB2aWV3IG9mZnNldCAwIDwtPiBtb2RlbCBvZmZzZXQgMCxcbiAgICAgICAgICAgIC8vIGFuZCBpdCBpcyBhIGRlZmF1bHQgdmFsdWUgdGhhdCBpcyBhbHdheXMgZXhwZWN0ZWQgdG8gYmUgaW4gdGhlIGNhY2hlIGxpc3QpLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFRoZSBjYWNoZSBtZWNoYW5pc20gbWF5IGFzayB0byBjbGVhciBmcm9tIGluZGV4IGAwYCBpbiBhIGNhc2Ugd2hlcmUgYSAwLW1vZGVsLWxlbmd0aCB2aWV3IGVsZW1lbnQgKFVJIGVsZW1lbnQgb3IgZW1wdHlcbiAgICAgICAgICAgIC8vIGF0dHJpYnV0ZSBlbGVtZW50KSB3YXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0cmFja2VkIGVsZW1lbnQuIEluIHN1Y2ggc2NlbmFyaW8sIHRoZSB2aWV3IGVsZW1lbnQgaXMgbWFwcGVkIHRocm91Z2hcbiAgICAgICAgICAgIC8vIGBub2RlVG9DYWNoZUxpc3RJbmRleGAgdG8gaW5kZXggYDBgLlxuICAgICAgICAgICAgaW5kZXggPSAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhY2hlIGlzIGFsd2F5cyBhdmFpbGFibGUgaGVyZSBiZWNhdXNlIHdlIGluaXRpYWxpemUgaXQganVzdCBiZWZvcmUgYWRkaW5nIGEgbGlzdGVuZXIgdGhhdCBmaXJlcyBgX2NsZWFyQ2FjaGVGcm9tSW5kZXgoKWAuXG4gICAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5fY2FjaGVkTWFwcGluZy5nZXQodmlld0NvbnRhaW5lcik7XG4gICAgICAgIGNvbnN0IGNhY2hlSXRlbSA9IGNhY2hlLmNhY2hlTGlzdFtpbmRleCAtIDFdO1xuICAgICAgICBpZiAoIWNhY2hlSXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhY2hlLm1heE1vZGVsT2Zmc2V0ID0gY2FjaGVJdGVtLm1vZGVsT2Zmc2V0O1xuICAgICAgICAvLyBSZW1vdmUgZnJvbSBjYWNoZSBhbGwgYENhY2hlSXRlbWBzIHRoYXQgYXJlIFwiYWZ0ZXJcIiB0aGUgaW5kZXggdG8gY2xlYXIgZnJvbS5cbiAgICAgICAgY29uc3QgY2xlYXJlZEl0ZW1zID0gY2FjaGUuY2FjaGVMaXN0LnNwbGljZShpbmRleCk7XG4gICAgICAgIC8vIEZvciBlYWNoIHJlbW92ZWQgaXRlbSwgbWFrZSBzdXJlIHRvIGFsc28gcmVtb3ZlIGl0IGZyb20gYGNhY2hlTWFwYCBhbmQgY2xlYXIgcmVsYXRlZCBlbnRyeSBpbiBgX25vZGVUb0NhY2hlTGlzdEluZGV4YC5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGNsZWFyZWRJdGVtcyl7XG4gICAgICAgICAgICBjYWNoZS5jYWNoZU1hcC5kZWxldGUoaXRlbS5tb2RlbE9mZnNldCk7XG4gICAgICAgICAgICBjb25zdCB2aWV3Tm9kZSA9IGl0ZW0udmlld1Bvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgICAgICB0aGlzLl9ub2RlVG9DYWNoZUxpc3RJbmRleC5kZWxldGUodmlld05vZGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaW5kcyBhIGNhY2hlIGl0ZW0gaW4gdGhlIGdpdmVuIGNhY2hlIGxpc3QsIHdoaWNoIGBtb2RlbE9mZnNldGAgaXMgY2xvc2VzdCAoYnV0IHNtYWxsZXIgb3IgZXF1YWwpIHRvIGdpdmVuIGBvZmZzZXRgLlxuXHQgKlxuXHQgKiBTaW5jZSBgY2FjaGVMaXN0YCBpcyBhIHNvcnRlZCBhcnJheSwgdGhpcyB1c2VzIGJpbmFyeSBzZWFyY2ggdG8gcmV0cmlldmUgdGhlIGl0ZW0gcXVpY2tseS5cblx0ICovIF9maW5kSW5DYWNoZUxpc3QoY2FjaGVMaXN0LCBvZmZzZXQpIHtcbiAgICAgICAgbGV0IHN0YXJ0ID0gMDtcbiAgICAgICAgbGV0IGVuZCA9IGNhY2hlTGlzdC5sZW5ndGggLSAxO1xuICAgICAgICBsZXQgaW5kZXggPSBlbmQgLSBzdGFydCA+PiAxO1xuICAgICAgICBsZXQgaXRlbSA9IGNhY2hlTGlzdFtpbmRleF07XG4gICAgICAgIHdoaWxlKHN0YXJ0IDwgZW5kKXtcbiAgICAgICAgICAgIGlmIChpdGVtLm1vZGVsT2Zmc2V0IDwgb2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSBpbmRleCArIDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVuZCA9IGluZGV4IC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluZGV4ID0gc3RhcnQgKyAoZW5kIC0gc3RhcnQgPj4gMSk7XG4gICAgICAgICAgICBpdGVtID0gY2FjaGVMaXN0W2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXRlbS5tb2RlbE9mZnNldCA8PSBvZmZzZXQgPyBpdGVtIDogY2FjaGVMaXN0W2luZGV4IC0gMV07XG4gICAgfVxufVxuXG4vKipcbiAqIE1hbmFnZXMgYSBsaXN0IG9mIGNvbnN1bWFibGUgdmFsdWVzIGZvciB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW1zfS5cbiAqXG4gKiBDb25zdW1hYmxlcyBhcmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBtb2RlbC4gQSBtb2RlbCBpdGVtIGNhbiBiZSBicm9rZW4gZG93biBpbnRvIHNlcGFyYXRlLCBzaW5nbGUgcHJvcGVydGllcyB0aGF0IG1pZ2h0IGJlXG4gKiB0YWtlbiBpbnRvIGNvbnNpZGVyYXRpb24gd2hlbiBjb252ZXJ0aW5nIHRoYXQgaXRlbS5cbiAqXG4gKiBgTW9kZWxDb25zdW1hYmxlYCBpcyB1c2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlcn0gd2hpbGUgYW5hbHl6aW5nIHRoZSBjaGFuZ2VkXG4gKiBwYXJ0cyBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCB0aGUgZG9jdW1lbnR9LiBUaGUgYWRkZWQgLyBjaGFuZ2VkIC8gcmVtb3ZlZCBtb2RlbCBpdGVtcyBhcmUgYnJva2VuIGRvd25cbiAqIGludG8gc2luZ3VsYXIgcHJvcGVydGllcyAodGhlIGl0ZW0gaXRzZWxmIGFuZCBpdHMgYXR0cmlidXRlcykuIEFsbCB0aG9zZSBwYXJ0cyBhcmUgc2F2ZWQgaW4gYE1vZGVsQ29uc3VtYWJsZWAuIFRoZW4sXG4gKiBkdXJpbmcgY29udmVyc2lvbiwgd2hlbiB0aGUgZ2l2ZW4gcGFydCBvZiBhIG1vZGVsIGl0ZW0gaXMgY29udmVydGVkIChpLmUuIHRoZSB2aWV3IGVsZW1lbnQgaGFzIGJlZW4gaW5zZXJ0ZWQgaW50byB0aGUgdmlldyxcbiAqIGJ1dCB3aXRob3V0IGF0dHJpYnV0ZXMpLCB0aGUgY29uc3VtYWJsZSB2YWx1ZSBpcyByZW1vdmVkIGZyb20gYE1vZGVsQ29uc3VtYWJsZWAuXG4gKlxuICogRm9yIG1vZGVsIGl0ZW1zLCBgTW9kZWxDb25zdW1hYmxlYCBzdG9yZXMgY29uc3VtYWJsZSB2YWx1ZXMgb2Ygb25lIG9mIGZvbGxvd2luZyB0eXBlczogYGluc2VydGAsIGBhZGRhdHRyaWJ1dGU6PGF0dHJpYnV0ZUtleT5gLFxuICogYGNoYW5nZWF0dHJpYnV0ZXM6PGF0dHJpYnV0ZUtleT5gLCBgcmVtb3ZlYXR0cmlidXRlczo8YXR0cmlidXRlS2V5PmAuXG4gKlxuICogSW4gbW9zdCBjYXNlcywgaXQgaXMgZW5vdWdoIHRvIGxldCB0aCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXJ9XG4gKiBnYXRoZXIgY29uc3VtYWJsZSB2YWx1ZXMsIHNvIHRoZXJlIGlzIG5vIG5lZWQgdG8gdXNlXG4gKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tb2RlbGNvbnN1bWFibGV+TW9kZWxDb25zdW1hYmxlI2FkZCBhZGQgbWV0aG9kfSBkaXJlY3RseS5cbiAqIEhvd2V2ZXIsIGl0IGlzIGltcG9ydGFudCB0byB1bmRlcnN0YW5kIGhvdyBjb25zdW1hYmxlIHZhbHVlcyBjYW4gYmVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbW9kZWxjb25zdW1hYmxlfk1vZGVsQ29uc3VtYWJsZSNjb25zdW1lIGNvbnN1bWVkfS5cbiAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVycyBkZWZhdWx0IGRvd25jYXN0IGNvbnZlcnRlcnN9IGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICpcbiAqIEtlZXAgaW4gbWluZCB0aGF0IG9uZSBjb252ZXJzaW9uIGV2ZW50IG1heSBoYXZlIG11bHRpcGxlIGNhbGxiYWNrcyAoY29udmVydGVycykgYXR0YWNoZWQgdG8gaXQuIEVhY2ggb2YgdGhvc2UgaXNcbiAqIGFibGUgdG8gY29udmVydCBvbmUgb3IgbW9yZSBwYXJ0cyBvZiB0aGUgbW9kZWwuIEhvd2V2ZXIsIHdoZW4gb25lIG9mIHRob3NlIGNhbGxiYWNrcyBhY3R1YWxseSBjb252ZXJ0c1xuICogc29tZXRoaW5nLCB0aGUgb3RoZXJzIHNob3VsZCBub3QsIGJlY2F1c2UgdGhleSB3b3VsZCBkdXBsaWNhdGUgdGhlIHJlc3VsdHMuIFVzaW5nIGBNb2RlbENvbnN1bWFibGVgIGhlbHBzIHRvIGF2b2lkXG4gKiB0aGlzIHNpdHVhdGlvbiwgYmVjYXVzZSBjYWxsYmFja3Mgc2hvdWxkIG9ubHkgY29udmVydCB0aGVzZSB2YWx1ZXMgdGhhdCB3ZXJlIG5vdCB5ZXQgY29uc3VtZWQgZnJvbSBgTW9kZWxDb25zdW1hYmxlYC5cbiAqXG4gKiBDb25zdW1pbmcgbXVsdGlwbGUgdmFsdWVzIGluIGEgc2luZ2xlIGNhbGxiYWNrOlxuICpcbiAqIGBgYHRzXG4gKiAvLyBDb252ZXJ0ZXIgZm9yIGN1c3RvbSBgaW1hZ2VCbG9ja2AgZWxlbWVudCB0aGF0IG1pZ2h0IGhhdmUgYSBgY2FwdGlvbmAgZWxlbWVudCBpbnNpZGUgd2hpY2ggY2hhbmdlc1xuICogLy8gaG93IHRoZSBpbWFnZSBpcyBkaXNwbGF5ZWQgaW4gdGhlIHZpZXc6XG4gKiAvL1xuICogLy8gTW9kZWw6XG4gKiAvL1xuICogLy8gW2ltYWdlQmxvY2tdXG4gKiAvLyAgIOKUlOKUgCBbY2FwdGlvbl1cbiAqIC8vICAgICAgIOKUlOKUgCBmb29cbiAqIC8vXG4gKiAvLyBWaWV3OlxuICogLy9cbiAqIC8vIDxmaWd1cmU+XG4gKiAvLyAgIOKUnOKUgCA8aW1nIC8+XG4gKiAvLyAgIOKUlOKUgCA8Y2FwdGlvbj5cbiAqIC8vICAgICAgIOKUlOKUgCBmb29cbiAqIG1vZGVsQ29udmVyc2lvbkRpc3BhdGNoZXIub24oICdpbnNlcnQ6aW1hZ2VCbG9jaycsICggZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuICogXHQvLyBGaXJzdCwgY29uc3VtZSB0aGUgYGltYWdlQmxvY2tgIGVsZW1lbnQuXG4gKiBcdGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKCBkYXRhLml0ZW0sICdpbnNlcnQnICk7XG4gKlxuICogXHQvLyBKdXN0IGNyZWF0ZSBub3JtYWwgaW1hZ2UgZWxlbWVudCBmb3IgdGhlIHZpZXcuXG4gKiBcdC8vIE1heWJlIGl0IHdpbGwgYmUgXCJkZWNvcmF0ZWRcIiBsYXRlci5cbiAqIFx0Y29uc3Qgdmlld0ltYWdlID0gbmV3IFZpZXdFbGVtZW50KCAnaW1nJyApO1xuICogXHRjb25zdCBpbnNlcnRQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKCBkYXRhLnJhbmdlLnN0YXJ0ICk7XG4gKiBcdGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAqXG4gKiBcdC8vIENoZWNrIGlmIHRoZSBgaW1hZ2VCbG9ja2AgZWxlbWVudCBoYXMgY2hpbGRyZW4uXG4gKiBcdGlmICggZGF0YS5pdGVtLmNoaWxkQ291bnQgPiAwICkge1xuICogXHRcdGNvbnN0IG1vZGVsQ2FwdGlvbiA9IGRhdGEuaXRlbS5nZXRDaGlsZCggMCApO1xuICpcbiAqIFx0XHQvLyBgbW9kZWxDYXB0aW9uYCBpbnNlcnRpb24gY2hhbmdlIGlzIGNvbnN1bWVkIGZyb20gY29uc3VtYWJsZSB2YWx1ZXMuXG4gKiBcdFx0Ly8gSXQgd2lsbCBub3QgYmUgY29udmVydGVkIGJ5IG90aGVyIGNvbnZlcnRlcnMsIGJ1dCBpdCdzIGNoaWxkcmVuIChwcm9iYWJseSBzb21lIHRleHQpIHdpbGwgYmUuXG4gKiBcdFx0Ly8gVGhyb3VnaCBtYXBwaW5nLCBjb252ZXJ0ZXJzIGZvciB0ZXh0IHdpbGwga25vdyB3aGVyZSB0byBpbnNlcnQgY29udGVudHMgb2YgYG1vZGVsQ2FwdGlvbmAuXG4gKiBcdFx0aWYgKCBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZSggbW9kZWxDYXB0aW9uLCAnaW5zZXJ0JyApICkge1xuICogXHRcdFx0Y29uc3Qgdmlld0NhcHRpb24gPSBuZXcgVmlld0VsZW1lbnQoICdmaWdjYXB0aW9uJyApO1xuICpcbiAqIFx0XHRcdGNvbnN0IHZpZXdJbWFnZUhvbGRlciA9IG5ldyBWaWV3RWxlbWVudCggJ2ZpZ3VyZScsIG51bGwsIFsgdmlld0ltYWdlLCB2aWV3Q2FwdGlvbiBdICk7XG4gKlxuICogXHRcdFx0Y29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRzKCBtb2RlbENhcHRpb24sIHZpZXdDYXB0aW9uICk7XG4gKiBcdFx0XHRjb252ZXJzaW9uQXBpLm1hcHBlci5iaW5kRWxlbWVudHMoIGRhdGEuaXRlbSwgdmlld0ltYWdlSG9sZGVyICk7XG4gKiBcdFx0XHR2aWV3V3JpdGVyLmluc2VydCggaW5zZXJ0UG9zaXRpb24sIHZpZXdJbWFnZUhvbGRlciApO1xuICogXHRcdH1cbiAqIFx0fSBlbHNlIHtcbiAqIFx0XHRjb252ZXJzaW9uQXBpLm1hcHBlci5iaW5kRWxlbWVudHMoIGRhdGEuaXRlbSwgdmlld0ltYWdlICk7XG4gKiBcdFx0dmlld1dyaXRlci5pbnNlcnQoIGluc2VydFBvc2l0aW9uLCB2aWV3SW1hZ2UgKTtcbiAqIFx0fVxuICpcbiAqIFx0ZXZ0LnN0b3AoKTtcbiAqIH0gKTtcbiAqIGBgYFxuICovIGNsYXNzIE1vZGVsQ29uc3VtYWJsZSB7XG4gICAgLyoqXG5cdCAqIENvbnRhaW5zIGxpc3Qgb2YgY29uc3VtYWJsZSB2YWx1ZXMuXG5cdCAqLyBfY29uc3VtYWJsZSA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogRm9yIGVhY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eX0gYWRkZWQgdG8gYE1vZGVsQ29uc3VtYWJsZWAsIHRoaXMgcmVnaXN0cnkgaG9sZHMgYSBwYXJlbnRcblx0ICogb2YgdGhhdCBgVGV4dFByb3h5YCBhbmQgdGhlIHN0YXJ0IGFuZCBlbmQgaW5kaWNlcyBvZiB0aGF0IGBUZXh0UHJveHlgLiBUaGlzIGFsbG93cyBpZGVudGlmaWNhdGlvbiBvZiB0aGUgYFRleHRQcm94eWBcblx0ICogaW5zdGFuY2VzIHRoYXQgcG9pbnQgdG8gdGhlIHNhbWUgcGFydCBvZiB0aGUgbW9kZWwgYnV0IGFyZSBkaWZmZXJlbnQgaW5zdGFuY2VzLiBFYWNoIGRpc3RpbmN0IGBUZXh0UHJveHlgXG5cdCAqIGlzIGdpdmVuIGEgdW5pcXVlIGBTeW1ib2xgIHdoaWNoIGlzIHRoZW4gcmVnaXN0ZXJlZCBhcyBjb25zdW1hYmxlLiBUaGlzIHByb2Nlc3MgaXMgdHJhbnNwYXJlbnQgZm9yIHRoZSBgTW9kZWxDb25zdW1hYmxlYFxuXHQgKiBBUEkgdXNlciBiZWNhdXNlIHdoZW5ldmVyIGBUZXh0UHJveHlgIGlzIGFkZGVkLCB0ZXN0ZWQsIGNvbnN1bWVkIG9yIHJldmVydGVkLCB0aGUgaW50ZXJuYWwgbWVjaGFuaXNtcyBvZlxuXHQgKiBgTW9kZWxDb25zdW1hYmxlYCB0cmFuc2xhdGUgYFRleHRQcm94eWAgdG8gdGhhdCB1bmlxdWUgYFN5bWJvbGAuXG5cdCAqLyBfdGV4dFByb3h5UmVnaXN0cnkgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIEFkZHMgYSBjb25zdW1hYmxlIHZhbHVlIHRvIHRoZSBjb25zdW1hYmxlcyBsaXN0IGFuZCBsaW5rcyBpdCB3aXRoIGEgZ2l2ZW4gbW9kZWwgaXRlbS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogbW9kZWxDb25zdW1hYmxlLmFkZCggbW9kZWxFbGVtZW50LCAnaW5zZXJ0JyApOyAvLyBBZGQgYG1vZGVsRWxlbWVudGAgaW5zZXJ0aW9uIGNoYW5nZSB0byBjb25zdW1hYmxlIHZhbHVlcy5cblx0ICogbW9kZWxDb25zdW1hYmxlLmFkZCggbW9kZWxFbGVtZW50LCAnYWRkQXR0cmlidXRlOmJvbGQnICk7IC8vIEFkZCBgYm9sZGAgYXR0cmlidXRlIGluc2VydGlvbiBvbiBgbW9kZWxFbGVtZW50YCBjaGFuZ2UuXG5cdCAqIG1vZGVsQ29uc3VtYWJsZS5hZGQoIG1vZGVsRWxlbWVudCwgJ3JlbW92ZUF0dHJpYnV0ZTpib2xkJyApOyAvLyBBZGQgYGJvbGRgIGF0dHJpYnV0ZSByZW1vdmFsIG9uIGBtb2RlbEVsZW1lbnRgIGNoYW5nZS5cblx0ICogbW9kZWxDb25zdW1hYmxlLmFkZCggbW9kZWxTZWxlY3Rpb24sICdzZWxlY3Rpb24nICk7IC8vIEFkZCBgbW9kZWxTZWxlY3Rpb25gIHRvIGNvbnN1bWFibGUgdmFsdWVzLlxuXHQgKiBtb2RlbENvbnN1bWFibGUuYWRkKCBtb2RlbFJhbmdlLCAncmFuZ2UnICk7IC8vIEFkZCBgbW9kZWxSYW5nZWAgdG8gY29uc3VtYWJsZSB2YWx1ZXMuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbSBNb2RlbCBpdGVtLCByYW5nZSBvciBzZWxlY3Rpb24gdGhhdCBoYXMgdGhlIGNvbnN1bWFibGUuXG5cdCAqIEBwYXJhbSB0eXBlIENvbnN1bWFibGUgdHlwZS4gV2lsbCBiZSBub3JtYWxpemVkIHRvIGEgcHJvcGVyIGZvcm0sIHRoYXQgaXMgZWl0aGVyIGA8d29yZD5gIG9yIGA8cGFydD46PHBhcnQ+YC5cblx0ICogU2Vjb25kIGNvbG9uIGFuZCBldmVyeXRoaW5nIGFmdGVyIHdpbGwgYmUgY3V0LiBQYXNzaW5nIGV2ZW50IG5hbWUgaXMgYSBzYWZlIGFuZCBnb29kIHByYWN0aWNlLlxuXHQgKi8gYWRkKGl0ZW0sIHR5cGUpIHtcbiAgICAgICAgdHlwZSA9IF9ub3JtYWxpemVDb25zdW1hYmxlVHlwZSh0eXBlKTtcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBUZXh0UHJveHkpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9nZXRTeW1ib2xGb3JUZXh0UHJveHkoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9jb25zdW1hYmxlLmhhcyhpdGVtKSkge1xuICAgICAgICAgICAgdGhpcy5fY29uc3VtYWJsZS5zZXQoaXRlbSwgbmV3IE1hcCgpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jb25zdW1hYmxlLmdldChpdGVtKS5zZXQodHlwZSwgdHJ1ZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGEgZ2l2ZW4gY29uc3VtYWJsZSB2YWx1ZSBmcm9tIGEgZ2l2ZW4gbW9kZWwgaXRlbS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogbW9kZWxDb25zdW1hYmxlLmNvbnN1bWUoIG1vZGVsRWxlbWVudCwgJ2luc2VydCcgKTsgLy8gUmVtb3ZlIGBtb2RlbEVsZW1lbnRgIGluc2VydGlvbiBjaGFuZ2UgZnJvbSBjb25zdW1hYmxlIHZhbHVlcy5cblx0ICogbW9kZWxDb25zdW1hYmxlLmNvbnN1bWUoIG1vZGVsRWxlbWVudCwgJ2FkZEF0dHJpYnV0ZTpib2xkJyApOyAvLyBSZW1vdmUgYGJvbGRgIGF0dHJpYnV0ZSBpbnNlcnRpb24gb24gYG1vZGVsRWxlbWVudGAgY2hhbmdlLlxuXHQgKiBtb2RlbENvbnN1bWFibGUuY29uc3VtZSggbW9kZWxFbGVtZW50LCAncmVtb3ZlQXR0cmlidXRlOmJvbGQnICk7IC8vIFJlbW92ZSBgYm9sZGAgYXR0cmlidXRlIHJlbW92YWwgb24gYG1vZGVsRWxlbWVudGAgY2hhbmdlLlxuXHQgKiBtb2RlbENvbnN1bWFibGUuY29uc3VtZSggbW9kZWxTZWxlY3Rpb24sICdzZWxlY3Rpb24nICk7IC8vIFJlbW92ZSBgbW9kZWxTZWxlY3Rpb25gIGZyb20gY29uc3VtYWJsZSB2YWx1ZXMuXG5cdCAqIG1vZGVsQ29uc3VtYWJsZS5jb25zdW1lKCBtb2RlbFJhbmdlLCAncmFuZ2UnICk7IC8vIFJlbW92ZSAnbW9kZWxSYW5nZScgZnJvbSBjb25zdW1hYmxlIHZhbHVlcy5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIE1vZGVsIGl0ZW0sIHJhbmdlIG9yIHNlbGVjdGlvbiBmcm9tIHdoaWNoIGNvbnN1bWFibGUgd2lsbCBiZSBjb25zdW1lZC5cblx0ICogQHBhcmFtIHR5cGUgQ29uc3VtYWJsZSB0eXBlLiBXaWxsIGJlIG5vcm1hbGl6ZWQgdG8gYSBwcm9wZXIgZm9ybSwgdGhhdCBpcyBlaXRoZXIgYDx3b3JkPmAgb3IgYDxwYXJ0Pjo8cGFydD5gLlxuXHQgKiBTZWNvbmQgY29sb24gYW5kIGV2ZXJ5dGhpbmcgYWZ0ZXIgd2lsbCBiZSBjdXQuIFBhc3NpbmcgZXZlbnQgbmFtZSBpcyBhIHNhZmUgYW5kIGdvb2QgcHJhY3RpY2UuXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBjb25zdW1hYmxlIHZhbHVlIHdhcyBhdmFpbGFibGUgYW5kIHdhcyBjb25zdW1lZCwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBjb25zdW1lKGl0ZW0sIHR5cGUpIHtcbiAgICAgICAgdHlwZSA9IF9ub3JtYWxpemVDb25zdW1hYmxlVHlwZSh0eXBlKTtcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBUZXh0UHJveHkpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9nZXRTeW1ib2xGb3JUZXh0UHJveHkoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudGVzdChpdGVtLCB0eXBlKSkge1xuICAgICAgICAgICAgdGhpcy5fY29uc3VtYWJsZS5nZXQoaXRlbSkuc2V0KHR5cGUsIGZhbHNlKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUZXN0cyB3aGV0aGVyIHRoZXJlIGlzIGEgY29uc3VtYWJsZSB2YWx1ZSBvZiBhIGdpdmVuIHR5cGUgY29ubmVjdGVkIHdpdGggYSBnaXZlbiBtb2RlbCBpdGVtLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBtb2RlbENvbnN1bWFibGUudGVzdCggbW9kZWxFbGVtZW50LCAnaW5zZXJ0JyApOyAvLyBDaGVjayBmb3IgYG1vZGVsRWxlbWVudGAgaW5zZXJ0aW9uIGNoYW5nZS5cblx0ICogbW9kZWxDb25zdW1hYmxlLnRlc3QoIG1vZGVsRWxlbWVudCwgJ2FkZEF0dHJpYnV0ZTpib2xkJyApOyAvLyBDaGVjayBmb3IgYGJvbGRgIGF0dHJpYnV0ZSBpbnNlcnRpb24gb24gYG1vZGVsRWxlbWVudGAgY2hhbmdlLlxuXHQgKiBtb2RlbENvbnN1bWFibGUudGVzdCggbW9kZWxFbGVtZW50LCAncmVtb3ZlQXR0cmlidXRlOmJvbGQnICk7IC8vIENoZWNrIGZvciBgYm9sZGAgYXR0cmlidXRlIHJlbW92YWwgb24gYG1vZGVsRWxlbWVudGAgY2hhbmdlLlxuXHQgKiBtb2RlbENvbnN1bWFibGUudGVzdCggbW9kZWxTZWxlY3Rpb24sICdzZWxlY3Rpb24nICk7IC8vIENoZWNrIGlmIGBtb2RlbFNlbGVjdGlvbmAgaXMgY29uc3VtYWJsZS5cblx0ICogbW9kZWxDb25zdW1hYmxlLnRlc3QoIG1vZGVsUmFuZ2UsICdyYW5nZScgKTsgLy8gQ2hlY2sgaWYgYG1vZGVsUmFuZ2VgIGlzIGNvbnN1bWFibGUuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbSBNb2RlbCBpdGVtLCByYW5nZSBvciBzZWxlY3Rpb24gdG8gYmUgdGVzdGVkLlxuXHQgKiBAcGFyYW0gdHlwZSBDb25zdW1hYmxlIHR5cGUuIFdpbGwgYmUgbm9ybWFsaXplZCB0byBhIHByb3BlciBmb3JtLCB0aGF0IGlzIGVpdGhlciBgPHdvcmQ+YCBvciBgPHBhcnQ+OjxwYXJ0PmAuXG5cdCAqIFNlY29uZCBjb2xvbiBhbmQgZXZlcnl0aGluZyBhZnRlciB3aWxsIGJlIGN1dC4gUGFzc2luZyBldmVudCBuYW1lIGlzIGEgc2FmZSBhbmQgZ29vZCBwcmFjdGljZS5cblx0ICogQHJldHVybnMgYG51bGxgIGlmIHN1Y2ggY29uc3VtYWJsZSB3YXMgbmV2ZXIgYWRkZWQsIGBmYWxzZWAgaWYgdGhlIGNvbnN1bWFibGUgdmFsdWVzIHdhc1xuXHQgKiBhbHJlYWR5IGNvbnN1bWVkIG9yIGB0cnVlYCBpZiBpdCB3YXMgYWRkZWQgYW5kIG5vdCBjb25zdW1lZCB5ZXQuXG5cdCAqLyB0ZXN0KGl0ZW0sIHR5cGUpIHtcbiAgICAgICAgdHlwZSA9IF9ub3JtYWxpemVDb25zdW1hYmxlVHlwZSh0eXBlKTtcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBUZXh0UHJveHkpIHtcbiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9nZXRTeW1ib2xGb3JUZXh0UHJveHkoaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbUNvbnN1bWFibGVzID0gdGhpcy5fY29uc3VtYWJsZS5nZXQoaXRlbSk7XG4gICAgICAgIGlmIChpdGVtQ29uc3VtYWJsZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWUgPSBpdGVtQ29uc3VtYWJsZXMuZ2V0KHR5cGUpO1xuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV2ZXJ0cyBjb25zdW1pbmcgb2YgYSBjb25zdW1hYmxlIHZhbHVlLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBtb2RlbENvbnN1bWFibGUucmV2ZXJ0KCBtb2RlbEVsZW1lbnQsICdpbnNlcnQnICk7IC8vIFJldmVydCBjb25zdW1pbmcgYG1vZGVsRWxlbWVudGAgaW5zZXJ0aW9uIGNoYW5nZS5cblx0ICogbW9kZWxDb25zdW1hYmxlLnJldmVydCggbW9kZWxFbGVtZW50LCAnYWRkQXR0cmlidXRlOmJvbGQnICk7IC8vIFJldmVydCBjb25zdW1pbmcgYGJvbGRgIGF0dHJpYnV0ZSBpbnNlcnQgZnJvbSBgbW9kZWxFbGVtZW50YC5cblx0ICogbW9kZWxDb25zdW1hYmxlLnJldmVydCggbW9kZWxFbGVtZW50LCAncmVtb3ZlQXR0cmlidXRlOmJvbGQnICk7IC8vIFJldmVydCBjb25zdW1pbmcgYGJvbGRgIGF0dHJpYnV0ZSByZW1vdmUgZnJvbSBgbW9kZWxFbGVtZW50YC5cblx0ICogbW9kZWxDb25zdW1hYmxlLnJldmVydCggbW9kZWxTZWxlY3Rpb24sICdzZWxlY3Rpb24nICk7IC8vIFJldmVydCBjb25zdW1pbmcgYG1vZGVsU2VsZWN0aW9uYC5cblx0ICogbW9kZWxDb25zdW1hYmxlLnJldmVydCggbW9kZWxSYW5nZSwgJ3JhbmdlJyApOyAvLyBSZXZlcnQgY29uc3VtaW5nIGBtb2RlbFJhbmdlYC5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIE1vZGVsIGl0ZW0sIHJhbmdlIG9yIHNlbGVjdGlvbiB0byBiZSByZXZlcnRlZC5cblx0ICogQHBhcmFtIHR5cGUgQ29uc3VtYWJsZSB0eXBlLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgY29uc3VtYWJsZSBoYXMgYmVlbiByZXZlcnNlZCwgYGZhbHNlYCBvdGhlcndpc2UuIGBudWxsYCBpZiB0aGUgY29uc3VtYWJsZSBoYXNcblx0ICogbmV2ZXIgYmVlbiBhZGRlZC5cblx0ICovIHJldmVydChpdGVtLCB0eXBlKSB7XG4gICAgICAgIHR5cGUgPSBfbm9ybWFsaXplQ29uc3VtYWJsZVR5cGUodHlwZSk7XG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgVGV4dFByb3h5KSB7XG4gICAgICAgICAgICBpdGVtID0gdGhpcy5fZ2V0U3ltYm9sRm9yVGV4dFByb3h5KGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRlc3QgPSB0aGlzLnRlc3QoaXRlbSwgdHlwZSk7XG4gICAgICAgIGlmICh0ZXN0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5fY29uc3VtYWJsZS5nZXQoaXRlbSkuc2V0KHR5cGUsIHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAodGVzdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogVmVyaWZpZXMgaWYgYWxsIGV2ZW50cyBmcm9tIHRoZSBzcGVjaWZpZWQgZ3JvdXAgd2VyZSBjb25zdW1lZC5cblx0ICpcblx0ICogQHBhcmFtIGV2ZW50R3JvdXAgVGhlIGV2ZW50cyBncm91cCB0byB2ZXJpZnkuXG5cdCAqLyB2ZXJpZnlBbGxDb25zdW1lZChldmVudEdyb3VwKSB7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gW107XG4gICAgICAgIGZvciAoY29uc3QgW2l0ZW0sIGNvbnN1bWFibGVzXSBvZiB0aGlzLl9jb25zdW1hYmxlKXtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2V2ZW50LCBjYW5Db25zdW1lXSBvZiBjb25zdW1hYmxlcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnRQcmVmaXggPSBldmVudC5zcGxpdCgnOicpWzBdO1xuICAgICAgICAgICAgICAgIGlmIChjYW5Db25zdW1lICYmIGV2ZW50R3JvdXAgPT0gZXZlbnRQcmVmaXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IGl0ZW0ubmFtZSB8fCBpdGVtLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFNvbWUgb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtc30gd2VyZSBub3QgY29uc3VtZWQgd2hpbGUgZG93bmNhc3RpbmcgdGhlIG1vZGVsIHRvIHZpZXcuXG5cdFx0XHQgKlxuXHRcdFx0ICogVGhpcyBtaWdodCBiZSB0aGUgZWZmZWN0IG9mOlxuXHRcdFx0ICpcblx0XHRcdCAqICogQSBtaXNzaW5nIGNvbnZlcnRlciBmb3Igc29tZSBtb2RlbCBlbGVtZW50cy4gTWFrZSBzdXJlIHRoYXQgeW91IHJlZ2lzdGVyZWQgZG93bmNhc3QgY29udmVydGVycyBmb3IgYWxsIG1vZGVsIGVsZW1lbnRzLlxuXHRcdFx0ICogKiBBIGN1c3RvbSBjb252ZXJ0ZXIgdGhhdCBkb2VzIG5vdCBjb25zdW1lIGNvbnZlcnRlZCBpdGVtcy4gTWFrZSBzdXJlIHRoYXQgeW91XG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21vZGVsY29uc3VtYWJsZX5Nb2RlbENvbnN1bWFibGUjY29uc3VtZSBjb25zdW1lZH0gYWxsIG1vZGVsIGVsZW1lbnRzIHRoYXQgeW91IGNvbnZlcnRlZFxuXHRcdFx0ICogZnJvbSB0aGUgbW9kZWwgdG8gdGhlIHZpZXcuXG5cdFx0XHQgKiAqIEEgY3VzdG9tIGNvbnZlcnRlciB0aGF0IGNhbGxlZCBgZXZlbnQuc3RvcCgpYC4gV2hlbiBwcm92aWRpbmcgYSBjdXN0b20gY29udmVydGVyLCBrZWVwIGluIG1pbmQgdGhhdCB5b3Ugc2hvdWxkIG5vdCBzdG9wXG5cdFx0XHQgKiB0aGUgZXZlbnQuIElmIHlvdSBzdG9wIGl0IHRoZW4gdGhlIGRlZmF1bHQgY29udmVydGVyIGF0IHRoZSBgbG93ZXN0YCBwcmlvcml0eSB3aWxsIG5vdCB0cmlnZ2VyIHRoZSBjb252ZXJzaW9uIG9mIHRoaXMgbm9kZSdzXG5cdFx0XHQgKiBhdHRyaWJ1dGVzIGFuZCBjaGlsZCBub2Rlcy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgY29udmVyc2lvbi1tb2RlbC1jb25zdW1hYmxlLW5vdC1jb25zdW1lZFxuXHRcdFx0ICogQHBhcmFtIHtBcnJheS48bW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0+fSBpdGVtcyBJdGVtcyB0aGF0IHdlcmUgbm90IGNvbnN1bWVkLlxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb252ZXJzaW9uLW1vZGVsLWNvbnN1bWFibGUtbm90LWNvbnN1bWVkJywgbnVsbCwge1xuICAgICAgICAgICAgICAgIGl0ZW1zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBhIHVuaXF1ZSBzeW1ib2wgZm9yIHRoZSBwYXNzZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eX0gaW5zdGFuY2UuIEFsbCBgVGV4dFByb3h5YCBpbnN0YW5jZXMgdGhhdFxuXHQgKiBoYXZlIHNhbWUgcGFyZW50LCBzYW1lIHN0YXJ0IGluZGV4IGFuZCBzYW1lIGVuZCBpbmRleCB3aWxsIGdldCB0aGUgc2FtZSBzeW1ib2wuXG5cdCAqXG5cdCAqIFVzZWQgaW50ZXJuYWxseSB0byBjb3JyZWN0bHkgY29uc3VtZSBgVGV4dFByb3h5YCBpbnN0YW5jZXMuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gdGV4dFByb3h5IGBUZXh0UHJveHlgIGluc3RhbmNlIHRvIGdldCBhIHN5bWJvbCBmb3IuXG5cdCAqIEByZXR1cm5zIFN5bWJvbCByZXByZXNlbnRpbmcgYWxsIGVxdWFsIGluc3RhbmNlcyBvZiBgVGV4dFByb3h5YC5cblx0ICovIF9nZXRTeW1ib2xGb3JUZXh0UHJveHkodGV4dFByb3h5KSB7XG4gICAgICAgIGxldCBzeW1ib2wgPSBudWxsO1xuICAgICAgICBjb25zdCBzdGFydE1hcCA9IHRoaXMuX3RleHRQcm94eVJlZ2lzdHJ5LmdldCh0ZXh0UHJveHkuc3RhcnRPZmZzZXQpO1xuICAgICAgICBpZiAoc3RhcnRNYXApIHtcbiAgICAgICAgICAgIGNvbnN0IGVuZE1hcCA9IHN0YXJ0TWFwLmdldCh0ZXh0UHJveHkuZW5kT2Zmc2V0KTtcbiAgICAgICAgICAgIGlmIChlbmRNYXApIHtcbiAgICAgICAgICAgICAgICBzeW1ib2wgPSBlbmRNYXAuZ2V0KHRleHRQcm94eS5wYXJlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghc3ltYm9sKSB7XG4gICAgICAgICAgICBzeW1ib2wgPSB0aGlzLl9hZGRTeW1ib2xGb3JUZXh0UHJveHkodGV4dFByb3h5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3ltYm9sO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBhIHN5bWJvbCBmb3IgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHRwcm94eX5UZXh0UHJveHl9IGluc3RhbmNlLlxuXHQgKlxuXHQgKiBVc2VkIGludGVybmFsbHkgdG8gY29ycmVjdGx5IGNvbnN1bWUgYFRleHRQcm94eWAgaW5zdGFuY2VzLlxuXHQgKlxuXHQgKiBAcGFyYW0gdGV4dFByb3h5IFRleHQgcHJveHkgaW5zdGFuY2UuXG5cdCAqIEByZXR1cm5zIFN5bWJvbCBnZW5lcmF0ZWQgZm9yIGdpdmVuIGBUZXh0UHJveHlgLlxuXHQgKi8gX2FkZFN5bWJvbEZvclRleHRQcm94eSh0ZXh0UHJveHkpIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSB0ZXh0UHJveHkuc3RhcnRPZmZzZXQ7XG4gICAgICAgIGNvbnN0IGVuZCA9IHRleHRQcm94eS5lbmRPZmZzZXQ7XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IHRleHRQcm94eS5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHN5bWJvbCA9IFN5bWJvbCgnJHRleHRQcm94eTonICsgdGV4dFByb3h5LmRhdGEpO1xuICAgICAgICBsZXQgc3RhcnRNYXA7XG4gICAgICAgIGxldCBlbmRNYXA7XG4gICAgICAgIHN0YXJ0TWFwID0gdGhpcy5fdGV4dFByb3h5UmVnaXN0cnkuZ2V0KHN0YXJ0KTtcbiAgICAgICAgaWYgKCFzdGFydE1hcCkge1xuICAgICAgICAgICAgc3RhcnRNYXAgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICB0aGlzLl90ZXh0UHJveHlSZWdpc3RyeS5zZXQoc3RhcnQsIHN0YXJ0TWFwKTtcbiAgICAgICAgfVxuICAgICAgICBlbmRNYXAgPSBzdGFydE1hcC5nZXQoZW5kKTtcbiAgICAgICAgaWYgKCFlbmRNYXApIHtcbiAgICAgICAgICAgIGVuZE1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgICAgIHN0YXJ0TWFwLnNldChlbmQsIGVuZE1hcCk7XG4gICAgICAgIH1cbiAgICAgICAgZW5kTWFwLnNldChwYXJlbnQsIHN5bWJvbCk7XG4gICAgICAgIHJldHVybiBzeW1ib2w7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGEgbm9ybWFsaXplZCBjb25zdW1hYmxlIHR5cGUgbmFtZSBmcm9tIHRoZSBnaXZlbiBzdHJpbmcuIEEgbm9ybWFsaXplZCBjb25zdW1hYmxlIHR5cGUgbmFtZSBpcyBhIHN0cmluZyB0aGF0IGhhc1xuICogYXQgbW9zdCBvbmUgY29sb24sIGZvciBleGFtcGxlOiBgaW5zZXJ0YCBvciBgYWRkTWFya2VyOmhpZ2hsaWdodGAuIElmIGEgc3RyaW5nIHRvIG5vcm1hbGl6ZSBoYXMgbW9yZSBcInBhcnRzXCIgKG1vcmUgY29sb25zKSxcbiAqIHRoZSBmdXJ0aGVyIHBhcnRzIGFyZSBkcm9wcGVkLCBmb3IgZXhhbXBsZTogYGFkZGF0dHJpYnV0ZTpib2xkOiR0ZXh0YCAtPiBgYWRkYXR0cmlidXRlczpib2xkYC5cbiAqXG4gKiBAcGFyYW0gdHlwZSBDb25zdW1hYmxlIHR5cGUuXG4gKiBAcmV0dXJucyBOb3JtYWxpemVkIGNvbnN1bWFibGUgdHlwZS5cbiAqLyBmdW5jdGlvbiBfbm9ybWFsaXplQ29uc3VtYWJsZVR5cGUodHlwZSkge1xuICAgIGNvbnN0IHBhcnRzID0gdHlwZS5zcGxpdCgnOicpO1xuICAgIC8vIEZvciBpbnNlcnRzIGFsbG93IHBhc3NpbmcgZXZlbnQgbmFtZSwgaXQncyBzdG9yZWQgaW4gdGhlIGNvbnRleHQgb2YgYSBzcGVjaWZpZWQgZWxlbWVudCBzbyB0aGUgZWxlbWVudCBuYW1lIGlzIG5vdCBuZWVkZWQuXG4gICAgaWYgKHBhcnRzWzBdID09ICdpbnNlcnQnKSB7XG4gICAgICAgIHJldHVybiBwYXJ0c1swXTtcbiAgICB9XG4gICAgLy8gTWFya2VycyBhcmUgaWRlbnRpZmllZCBieSB0aGUgd2hvbGUgbmFtZSAob3RoZXJ3aXNlIHdlIHdvdWxkIGNvbnN1bWUgdGhlIHdob2xlIG1hcmtlcnMgZ3JvdXApLlxuICAgIGlmIChwYXJ0c1swXSA9PSAnYWRkTWFya2VyJyB8fCBwYXJ0c1swXSA9PSAncmVtb3ZlTWFya2VyJykge1xuICAgICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzLmxlbmd0aCA+IDEgPyBwYXJ0c1swXSArICc6JyArIHBhcnRzWzFdIDogcGFydHNbMF07XG59XG5cbi8qKlxuICogVGhlIGRvd25jYXN0IGRpc3BhdGNoZXIgaXMgYSBjZW50cmFsIHBvaW50IG9mIGRvd25jYXN0aW5nIChjb252ZXJzaW9uIGZyb20gdGhlIG1vZGVsIHRvIHRoZSB2aWV3KSwgd2hpY2ggaXMgYSBwcm9jZXNzIG9mIHJlYWN0aW5nXG4gKiB0byBjaGFuZ2VzIGluIHRoZSBtb2RlbCBhbmQgZmlyaW5nIGEgc2V0IG9mIGV2ZW50cy4gVGhlIGNhbGxiYWNrcyBsaXN0ZW5pbmcgdG8gdGhlc2UgZXZlbnRzIGFyZSBjYWxsZWQgY29udmVydGVycy4gVGhlXG4gKiBjb252ZXJ0ZXJzJyByb2xlIGlzIHRvIGNvbnZlcnQgdGhlIG1vZGVsIGNoYW5nZXMgdG8gY2hhbmdlcyBpbiB2aWV3IChmb3IgZXhhbXBsZSwgYWRkaW5nIHZpZXcgbm9kZXMgb3JcbiAqIGNoYW5naW5nIGF0dHJpYnV0ZXMgb24gdmlldyBlbGVtZW50cykuXG4gKlxuICogRHVyaW5nIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MsIGRvd25jYXN0IGRpc3BhdGNoZXIgZmlyZXMgZXZlbnRzIGJhc2luZyBvbiB0aGUgc3RhdGUgb2YgdGhlIG1vZGVsIGFuZCBwcmVwYXJlc1xuICogZGF0YSBmb3IgdGhlc2UgZXZlbnRzLiBJdCBpcyBpbXBvcnRhbnQgdG8gdW5kZXJzdGFuZCB0aGF0IHRoZSBldmVudHMgYXJlIGNvbm5lY3RlZCB3aXRoIHRoZSBjaGFuZ2VzIGRvbmUgb24gdGhlIG1vZGVsLFxuICogZm9yIGV4YW1wbGU6IFwiYSBub2RlIGhhcyBiZWVuIGluc2VydGVkXCIgb3IgXCJhbiBhdHRyaWJ1dGUgaGFzIGNoYW5nZWRcIi4gVGhpcyBpcyBpbiBjb250cmFyeSB0byB1cGNhc3RpbmcgKGEgdmlldy10by1tb2RlbCBjb252ZXJzaW9uKVxuICogd2hlcmUgeW91IGNvbnZlcnQgdGhlIHZpZXcgc3RhdGUgKHZpZXcgbm9kZXMpIHRvIGEgbW9kZWwgdHJlZS5cbiAqXG4gKiBUaGUgZXZlbnRzIGFyZSBwcmVwYXJlZCBiYXNpbmcgb24gYSBkaWZmIGNyZWF0ZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RpZmZlcn5EaWZmZXIgRGlmZmVyfSwgd2hpY2ggYnVmZmVycyB0aGVtXG4gKiBhbmQgdGhlbiBwYXNzZXMgdG8gdGhlIGRvd25jYXN0IGRpc3BhdGNoZXIgYXMgYSBkaWZmIGJldHdlZW4gdGhlIG9sZCBtb2RlbCBzdGF0ZSBhbmQgdGhlIG5ldyBtb2RlbCBzdGF0ZS5cbiAqXG4gKiBOb3RlIHRoYXQgYmVjYXVzZSB0aGUgY2hhbmdlcyBhcmUgY29udmVydGVkLCB0aGVyZSBpcyBhIG5lZWQgdG8gaGF2ZSBhIG1hcHBpbmcgYmV0d2VlbiB0aGUgbW9kZWwgc3RydWN0dXJlIGFuZCB0aGUgdmlldyBzdHJ1Y3R1cmUuXG4gKiBUbyBtYXAgcG9zaXRpb25zIGFuZCBlbGVtZW50cyBkdXJpbmcgdGhlIGRvd25jYXN0IChhIG1vZGVsLXRvLXZpZXcgY29udmVyc2lvbiksIHVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXJ9LlxuICpcbiAqIERvd25jYXN0IGRpc3BhdGNoZXIgZmlyZXMgdGhlIGZvbGxvd2luZyBldmVudHMgZm9yIG1vZGVsIHRyZWUgY2hhbmdlczpcbiAqXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDppbnNlcnQgYGluc2VydGB9ICZuZGFzaDtcbiAqIElmIGEgcmFuZ2Ugb2Ygbm9kZXMgd2FzIGluc2VydGVkIHRvIHRoZSBtb2RlbCB0cmVlLlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6cmVtb3ZlIGByZW1vdmVgfSAmbmRhc2g7XG4gKiBJZiBhIHJhbmdlIG9mIG5vZGVzIHdhcyByZW1vdmVkIGZyb20gdGhlIG1vZGVsIHRyZWUuXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDphdHRyaWJ1dGUgYGF0dHJpYnV0ZWB9ICZuZGFzaDtcbiAqIElmIGFuIGF0dHJpYnV0ZSB3YXMgYWRkZWQsIGNoYW5nZWQgb3IgcmVtb3ZlZCBmcm9tIGEgbW9kZWwgbm9kZS5cbiAqXG4gKiBGb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50Omluc2VydCBgaW5zZXJ0YH1cbiAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6YXR0cmlidXRlIGBhdHRyaWJ1dGVgfSxcbiAqIHRoZSBkb3duY2FzdCBkaXNwYXRjaGVyIGdlbmVyYXRlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21vZGVsY29uc3VtYWJsZX5Nb2RlbENvbnN1bWFibGUgY29uc3VtYWJsZXN9LlxuICogVGhlc2UgYXJlIHVzZWQgdG8gaGF2ZSBjb250cm9sIG92ZXIgd2hpY2ggY2hhbmdlcyBoYXZlIGFscmVhZHkgYmVlbiBjb25zdW1lZC4gSXQgaXMgdXNlZnVsIHdoZW4gc29tZSBjb252ZXJ0ZXJzXG4gKiBvdmVyd3JpdGUgb3RoZXJzIG9yIGNvbnZlcnQgbXVsdGlwbGUgY2hhbmdlcyAoZm9yIGV4YW1wbGUsIGl0IGNvbnZlcnRzIGFuIGluc2VydGlvbiBvZiBhbiBlbGVtZW50IGFuZCBhbHNvIGNvbnZlcnRzIHRoYXRcbiAqIGVsZW1lbnQncyBhdHRyaWJ1dGVzIGR1cmluZyB0aGUgaW5zZXJ0aW9uKS5cbiAqXG4gKiBBZGRpdGlvbmFsbHksIGRvd25jYXN0IGRpc3BhdGNoZXIgZmlyZXMgZXZlbnRzIGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXJ9IGNoYW5nZXM6XG4gKlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6YWRkTWFya2VyIGBhZGRNYXJrZXJgfSAmbmRhc2g7IElmIGEgbWFya2VyIHdhcyBhZGRlZC5cbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OnJlbW92ZU1hcmtlciBgcmVtb3ZlTWFya2VyYH0gJm5kYXNoOyBJZiBhIG1hcmtlciB3YXNcbiAqIHJlbW92ZWQuXG4gKlxuICogTm90ZSB0aGF0IGNoYW5naW5nIGEgbWFya2VyIGlzIGRvbmUgdGhyb3VnaCByZW1vdmluZyB0aGUgbWFya2VyIGZyb20gdGhlIG9sZCByYW5nZSBhbmQgYWRkaW5nIGl0IHRvIHRoZSBuZXcgcmFuZ2UsXG4gKiBzbyBib3RoIG9mIHRoZXNlIGV2ZW50cyBhcmUgZmlyZWQuXG4gKlxuICogRmluYWxseSwgYSBkb3duY2FzdCBkaXNwYXRjaGVyIGFsc28gaGFuZGxlcyBmaXJpbmcgZXZlbnRzIGZvciB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uIG1vZGVsIHNlbGVjdGlvbn1cbiAqIGNvbnZlcnNpb246XG4gKlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6c2VsZWN0aW9uIGBzZWxlY3Rpb25gfVxuICogJm5kYXNoOyBDb252ZXJ0cyB0aGUgc2VsZWN0aW9uIGZyb20gdGhlIG1vZGVsIHRvIHRoZSB2aWV3LlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6YXR0cmlidXRlIGBhdHRyaWJ1dGVgfVxuICogJm5kYXNoOyBGaXJlZCBmb3IgZXZlcnkgc2VsZWN0aW9uIGF0dHJpYnV0ZS5cbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmFkZE1hcmtlciBgYWRkTWFya2VyYH1cbiAqICZuZGFzaDsgRmlyZWQgZm9yIGV2ZXJ5IG1hcmtlciB0aGF0IGNvbnRhaW5zIGEgc2VsZWN0aW9uLlxuICpcbiAqIFVubGlrZSB0aGUgbW9kZWwgdHJlZSBhbmQgdGhlIG1hcmtlcnMsIHRoZSBldmVudHMgZm9yIHNlbGVjdGlvbiBhcmUgbm90IGZpcmVkIGZvciBjaGFuZ2VzIGJ1dCBmb3IgYSBzZWxlY3Rpb24gc3RhdGUuXG4gKlxuICogV2hlbiBwcm92aWRpbmcgY3VzdG9tIGxpc3RlbmVycyBmb3IgYSBkb3duY2FzdCBkaXNwYXRjaGVyLCByZW1lbWJlciB0byBjaGVjayB3aGV0aGVyIGEgZ2l2ZW4gY2hhbmdlIGhhcyBub3QgYmVlblxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tb2RlbGNvbnN1bWFibGV+TW9kZWxDb25zdW1hYmxlI2NvbnN1bWUgY29uc3VtZWR9IHlldC5cbiAqXG4gKiBXaGVuIHByb3ZpZGluZyBjdXN0b20gbGlzdGVuZXJzIGZvciBhIGRvd25jYXN0IGRpc3BhdGNoZXIsIGtlZXAgaW4gbWluZCB0aGF0IHlvdSAqKnNob3VsZCBub3QqKiBzdG9wIHRoZSBldmVudC4gSWYgeW91IHN0b3AgaXQsXG4gKiB0aGVuIHRoZSBkZWZhdWx0IGNvbnZlcnRlciBhdCB0aGUgYGxvd2VzdGAgcHJpb3JpdHkgd2lsbCBub3QgdHJpZ2dlciB0aGUgY29udmVyc2lvbiBvZiB0aGlzIG5vZGUncyBhdHRyaWJ1dGVzIGFuZCBjaGlsZCBub2Rlcy5cbiAqXG4gKiBXaGVuIHByb3ZpZGluZyBjdXN0b20gbGlzdGVuZXJzIGZvciBhIGRvd25jYXN0IGRpc3BhdGNoZXIsIHJlbWVtYmVyIHRvIHVzZSB0aGUgcHJvdmlkZWRcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIgdmlldyBkb3duY2FzdCB3cml0ZXJ9IHRvIGFwcGx5IGNoYW5nZXMgdG8gdGhlIHZpZXcgZG9jdW1lbnQuXG4gKlxuICogWW91IGNhbiByZWFkIG1vcmUgYWJvdXQgY29udmVyc2lvbiBpbiB0aGUgZm9sbG93aW5nIGd1aWRlOlxuICpcbiAqICoge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL2NvbnZlcnNpb24vZG93bmNhc3QgRG93bmNhc3QgY29udmVyc2lvbn1cbiAqXG4gKiBBbiBleGFtcGxlIG9mIGEgY3VzdG9tIGNvbnZlcnRlciBmb3IgdGhlIGRvd25jYXN0IGRpc3BhdGNoZXI6XG4gKlxuICogYGBgdHNcbiAqIC8vIFlvdSB3aWxsIGNvbnZlcnQgaW5zZXJ0aW5nIGEgXCJwYXJhZ3JhcGhcIiBtb2RlbCBlbGVtZW50IGludG8gdGhlIG1vZGVsLlxuICogZG93bmNhc3REaXNwYXRjaGVyLm9uKCAnaW5zZXJ0OnBhcmFncmFwaCcsICggZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuICogXHQvLyBSZW1lbWJlciB0byBjaGVjayB3aGV0aGVyIHRoZSBjaGFuZ2UgaGFzIG5vdCBiZWVuIGNvbnN1bWVkIHlldCBhbmQgY29uc3VtZSBpdC5cbiAqIFx0aWYgKCAhY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoIGRhdGEuaXRlbSwgJ2luc2VydCcgKSApIHtcbiAqIFx0XHRyZXR1cm47XG4gKiBcdH1cbiAqXG4gKiBcdC8vIFRyYW5zbGF0ZSB0aGUgcG9zaXRpb24gaW4gdGhlIG1vZGVsIHRvIGEgcG9zaXRpb24gaW4gdGhlIHZpZXcuXG4gKiBcdGNvbnN0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKCBkYXRhLnJhbmdlLnN0YXJ0ICk7XG4gKlxuICogXHQvLyBDcmVhdGUgYSA8cD4gZWxlbWVudCB0aGF0IHdpbGwgYmUgaW5zZXJ0ZWQgaW50byB0aGUgdmlldyBhdCB0aGUgYHZpZXdQb3NpdGlvbmAuXG4gKiBcdGNvbnN0IHZpZXdFbGVtZW50ID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ3AnICk7XG4gKlxuICogXHQvLyBCaW5kIHRoZSBuZXdseSBjcmVhdGVkIHZpZXcgZWxlbWVudCB0byB0aGUgbW9kZWwgZWxlbWVudCBzbyBwb3NpdGlvbnMgd2lsbCBtYXAgYWNjb3JkaW5nbHkgaW4gdGhlIGZ1dHVyZS5cbiAqIFx0Y29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRzKCBkYXRhLml0ZW0sIHZpZXdFbGVtZW50ICk7XG4gKlxuICogXHQvLyBBZGQgdGhlIG5ld2x5IGNyZWF0ZWQgdmlldyBlbGVtZW50IHRvIHRoZSB2aWV3LlxuICogXHRjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQoIHZpZXdQb3NpdGlvbiwgdmlld0VsZW1lbnQgKTtcbiAqIH0gKTtcbiAqIGBgYFxuICovIGNsYXNzIERvd25jYXN0RGlzcGF0Y2hlciBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSB7XG4gICAgLyoqXG5cdCAqIEEgdGVtcGxhdGUgZm9yIGFuIGludGVyZmFjZSBwYXNzZWQgYnkgdGhlIGRpc3BhdGNoZXIgdG8gdGhlIGV2ZW50IGNhbGxiYWNrcy5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfY29udmVyc2lvbkFwaTtcbiAgICAvKipcblx0ICogQSBtYXAgb2YgYWxyZWFkeSBmaXJlZCBldmVudHMgZm9yIGEgZ2l2ZW4gYE1vZGVsQ29uc3VtYWJsZWAuXG5cdCAqLyBfZmlyZWRFdmVudHNNYXA7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBkb3duY2FzdCBkaXNwYXRjaGVyIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3RDb252ZXJzaW9uQXBpXG5cdCAqXG5cdCAqIEBwYXJhbSBjb252ZXJzaW9uQXBpIEFkZGl0aW9uYWwgcHJvcGVydGllcyBmb3IgYW4gaW50ZXJmYWNlIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gZXZlbnRzIGZpcmVkXG5cdCAqIGJ5IHRoZSBkb3duY2FzdCBkaXNwYXRjaGVyLlxuXHQgKi8gY29uc3RydWN0b3IoY29udmVyc2lvbkFwaSl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX2NvbnZlcnNpb25BcGkgPSB7XG4gICAgICAgICAgICBkaXNwYXRjaGVyOiB0aGlzLFxuICAgICAgICAgICAgLi4uY29udmVyc2lvbkFwaVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9maXJlZEV2ZW50c01hcCA9IG5ldyBXZWFrTWFwKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBjaGFuZ2VzIGJ1ZmZlcmVkIGluIHRoZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kaWZmZXJ+RGlmZmVyIG1vZGVsIGRpZmZlcn1cblx0ICogYW5kIGZpcmVzIGNvbnZlcnNpb24gZXZlbnRzIGJhc2VkIG9uIGl0LlxuXHQgKlxuXHQgKiBAZmlyZXMgaW5zZXJ0XG5cdCAqIEBmaXJlcyByZW1vdmVcblx0ICogQGZpcmVzIGF0dHJpYnV0ZVxuXHQgKiBAZmlyZXMgYWRkTWFya2VyXG5cdCAqIEBmaXJlcyByZW1vdmVNYXJrZXJcblx0ICogQGZpcmVzIHJlZHVjZUNoYW5nZXNcblx0ICogQHBhcmFtIGRpZmZlciBUaGUgZGlmZmVyIG9iamVjdCB3aXRoIGJ1ZmZlcmVkIGNoYW5nZXMuXG5cdCAqIEBwYXJhbSBtYXJrZXJzIE1hcmtlcnMgcmVsYXRlZCB0byB0aGUgbW9kZWwgZnJhZ21lbnQgdG8gY29udmVydC5cblx0ICogQHBhcmFtIHdyaXRlciBUaGUgdmlldyB3cml0ZXIgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBtb2RpZnkgdGhlIHZpZXcgZG9jdW1lbnQuXG5cdCAqLyBjb252ZXJ0Q2hhbmdlcyhkaWZmZXIsIG1hcmtlcnMsIHdyaXRlcikge1xuICAgICAgICBjb25zdCBjb252ZXJzaW9uQXBpID0gdGhpcy5fY3JlYXRlQ29udmVyc2lvbkFwaSh3cml0ZXIsIGRpZmZlci5nZXRSZWZyZXNoZWRJdGVtcygpKTtcbiAgICAgICAgLy8gQmVmb3JlIHRoZSB2aWV3IGlzIHVwZGF0ZWQsIHJlbW92ZSBtYXJrZXJzIHdoaWNoIGhhdmUgY2hhbmdlZC5cbiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgZGlmZmVyLmdldE1hcmtlcnNUb1JlbW92ZSgpKXtcbiAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRNYXJrZXJSZW1vdmUoY2hhbmdlLm5hbWUsIGNoYW5nZS5yYW5nZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTGV0IGZlYXR1cmVzIG1vZGlmeSB0aGUgY2hhbmdlIGxpc3QgKGZvciBleGFtcGxlIHRvIGFsbG93IHJlY29udmVyc2lvbikuXG4gICAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLl9yZWR1Y2VDaGFuZ2VzKGRpZmZlci5nZXRDaGFuZ2VzKCkpO1xuICAgICAgICAvLyBDb252ZXJ0IGNoYW5nZXMgdGhhdCBoYXBwZW5lZCBvbiBtb2RlbCB0cmVlLlxuICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGNoYW5nZXMpe1xuICAgICAgICAgICAgaWYgKGVudHJ5LnR5cGUgPT09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29udmVydEluc2VydChSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQoZW50cnkucG9zaXRpb24sIGVudHJ5Lmxlbmd0aCksIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09PSAncmVpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29udmVydFJlaW5zZXJ0KFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChlbnRyeS5wb3NpdGlvbiwgZW50cnkubGVuZ3RoKSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LnR5cGUgPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29udmVydFJlbW92ZShlbnRyeS5wb3NpdGlvbiwgZW50cnkubGVuZ3RoLCBlbnRyeS5uYW1lLCBjb252ZXJzaW9uQXBpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRGVmYXVsdHMgdG8gJ2F0dHJpYnV0ZScgY2hhbmdlLlxuICAgICAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRBdHRyaWJ1dGUoZW50cnkucmFuZ2UsIGVudHJ5LmF0dHJpYnV0ZUtleSwgZW50cnkuYXR0cmlidXRlT2xkVmFsdWUsIGVudHJ5LmF0dHJpYnV0ZU5ld1ZhbHVlLCBjb252ZXJzaW9uQXBpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBSZW1vdmUgbWFwcGluZ3MgZm9yIGFsbCByZW1vdmVkIHZpZXcgZWxlbWVudHMuXG4gICAgICAgIC8vIFJlbW92ZSB0aGVzZSBtYXBwaW5ncyBhcyBzb29uIGFzIHRoZXkgYXJlIG5vdCBuZWVkZWQgKGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE1NDExKS5cbiAgICAgICAgY29udmVyc2lvbkFwaS5tYXBwZXIuZmx1c2hEZWZlcnJlZEJpbmRpbmdzKCk7XG4gICAgICAgIGZvciAoY29uc3QgbWFya2VyTmFtZSBvZiBjb252ZXJzaW9uQXBpLm1hcHBlci5mbHVzaFVuYm91bmRNYXJrZXJOYW1lcygpKXtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtlclJhbmdlID0gbWFya2Vycy5nZXQobWFya2VyTmFtZSkuZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRNYXJrZXJSZW1vdmUobWFya2VyTmFtZSwgbWFya2VyUmFuZ2UsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAgICAgdGhpcy5fY29udmVydE1hcmtlckFkZChtYXJrZXJOYW1lLCBtYXJrZXJSYW5nZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWZ0ZXIgdGhlIHZpZXcgaXMgdXBkYXRlZCwgY29udmVydCBtYXJrZXJzIHdoaWNoIGhhdmUgY2hhbmdlZC5cbiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgZGlmZmVyLmdldE1hcmtlcnNUb0FkZCgpKXtcbiAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRNYXJrZXJBZGQoY2hhbmdlLm5hbWUsIGNoYW5nZS5yYW5nZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVmVyaWZ5IGlmIGFsbCBpbnNlcnQgY29uc3VtYWJsZXMgd2VyZSBjb25zdW1lZC5cbiAgICAgICAgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnZlcmlmeUFsbENvbnN1bWVkKCdpbnNlcnQnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyBhIGNvbnZlcnNpb24gb2YgYSBtb2RlbCByYW5nZSBhbmQgdGhlIHByb3ZpZGVkIG1hcmtlcnMuXG5cdCAqXG5cdCAqIEBmaXJlcyBpbnNlcnRcblx0ICogQGZpcmVzIGF0dHJpYnV0ZVxuXHQgKiBAZmlyZXMgYWRkTWFya2VyXG5cdCAqIEBwYXJhbSByYW5nZSBUaGUgaW5zZXJ0ZWQgcmFuZ2UuXG5cdCAqIEBwYXJhbSBtYXJrZXJzIFRoZSBtYXAgb2YgbWFya2VycyB0aGF0IHNob3VsZCBiZSBkb3duLWNhc3RlZC5cblx0ICogQHBhcmFtIHdyaXRlciBUaGUgdmlldyB3cml0ZXIgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBtb2RpZnkgdGhlIHZpZXcgZG9jdW1lbnQuXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0IHBhc3NlZCB0byBgY29udmVydGlvbkFwaS5vcHRpb25zYC5cblx0ICovIGNvbnZlcnQocmFuZ2UsIG1hcmtlcnMsIHdyaXRlciwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGNvbnZlcnNpb25BcGkgPSB0aGlzLl9jcmVhdGVDb252ZXJzaW9uQXBpKHdyaXRlciwgdW5kZWZpbmVkLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5fY29udmVydEluc2VydChyYW5nZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGZvciAoY29uc3QgW25hbWUsIHJhbmdlXSBvZiBtYXJrZXJzKXtcbiAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRNYXJrZXJBZGQobmFtZSwgcmFuZ2UsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFZlcmlmeSBpZiBhbGwgaW5zZXJ0IGNvbnN1bWFibGVzIHdlcmUgY29uc3VtZWQuXG4gICAgICAgIGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS52ZXJpZnlBbGxDb25zdW1lZCgnaW5zZXJ0Jyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTdGFydHMgdGhlIG1vZGVsIHNlbGVjdGlvbiBjb252ZXJzaW9uLlxuXHQgKlxuXHQgKiBGaXJlcyBldmVudHMgZm9yIGEgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiBzZWxlY3Rpb259IHRvIHN0YXJ0IHRoZSBzZWxlY3Rpb24gY29udmVyc2lvbi5cblx0ICpcblx0ICogQGZpcmVzIHNlbGVjdGlvblxuXHQgKiBAZmlyZXMgYWRkTWFya2VyXG5cdCAqIEBmaXJlcyBhdHRyaWJ1dGVcblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIHRvIGNvbnZlcnQuXG5cdCAqIEBwYXJhbSBtYXJrZXJzIE1hcmtlcnMgY29ubmVjdGVkIHdpdGggdGhlIGNvbnZlcnRlZCBtb2RlbC5cblx0ICogQHBhcmFtIHdyaXRlciBWaWV3IHdyaXRlciB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIG1vZGlmeSB0aGUgdmlldyBkb2N1bWVudC5cblx0ICovIGNvbnZlcnRTZWxlY3Rpb24oc2VsZWN0aW9uLCBtYXJrZXJzLCB3cml0ZXIpIHtcbiAgICAgICAgY29uc3QgY29udmVyc2lvbkFwaSA9IHRoaXMuX2NyZWF0ZUNvbnZlcnNpb25BcGkod3JpdGVyKTtcbiAgICAgICAgLy8gRmlyc3QgcGVyZm9ybSBhIGNsZWFuLXVwIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uIG9mIHRoZSBzZWxlY3Rpb24uXG4gICAgICAgIHRoaXMuZmlyZSgnY2xlYW5TZWxlY3Rpb24nLCB7XG4gICAgICAgICAgICBzZWxlY3Rpb25cbiAgICAgICAgfSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIC8vIERvbid0IGNvbnZlcnQgc2VsZWN0aW9uIGlmIGl0IGlzIGluIGEgbW9kZWwgcm9vdCB0aGF0IGRvZXMgbm90IGhhdmUgYSB2aWV3IHJvb3QgKGZvciBub3cgdGhpcyBpcyBvbmx5IHRoZSBncmF2ZXlhcmQgcm9vdCkuXG4gICAgICAgIGNvbnN0IG1vZGVsUm9vdCA9IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkucm9vdDtcbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KG1vZGVsUm9vdCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3csIHBlcmZvcm0gYWN0dWFsIHNlbGVjdGlvbiBjb252ZXJzaW9uLlxuICAgICAgICBjb25zdCBtYXJrZXJzQXRTZWxlY3Rpb24gPSBBcnJheS5mcm9tKG1hcmtlcnMuZ2V0TWFya2Vyc0F0UG9zaXRpb24oc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKSkpO1xuICAgICAgICB0aGlzLl9hZGRDb25zdW1hYmxlc0ZvclNlbGVjdGlvbihjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUsIHNlbGVjdGlvbiwgbWFya2Vyc0F0U2VsZWN0aW9uKTtcbiAgICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb24nLCB7XG4gICAgICAgICAgICBzZWxlY3Rpb25cbiAgICAgICAgfSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgbWFya2Vyc0F0U2VsZWN0aW9uKXtcbiAgICAgICAgICAgIC8vIERvIG5vdCBmaXJlIGV2ZW50IGlmIHRoZSBtYXJrZXIgaGFzIGJlZW4gY29uc3VtZWQuXG4gICAgICAgICAgICBpZiAoY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3Qoc2VsZWN0aW9uLCAnYWRkTWFya2VyOicgKyBtYXJrZXIubmFtZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXJSYW5nZSA9IG1hcmtlci5nZXRSYW5nZSgpO1xuICAgICAgICAgICAgICAgIGlmICghc2hvdWxkTWFya2VyQ2hhbmdlQmVDb252ZXJ0ZWQoc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKSwgbWFya2VyLCBjb252ZXJzaW9uQXBpLm1hcHBlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IHNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyTmFtZTogbWFya2VyLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlclJhbmdlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoYGFkZE1hcmtlcjoke21hcmtlci5uYW1lfWAsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIHNlbGVjdGlvbi5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICAgICAgLy8gRG8gbm90IGZpcmUgZXZlbnQgaWYgdGhlIGF0dHJpYnV0ZSBoYXMgYmVlbiBjb25zdW1lZC5cbiAgICAgICAgICAgIGlmIChjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdChzZWxlY3Rpb24sICdhdHRyaWJ1dGU6JyArIGtleSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBpdGVtOiBzZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiBzZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVLZXk6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5ld1ZhbHVlOiBzZWxlY3Rpb24uZ2V0QXR0cmlidXRlKGtleSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyZShgYXR0cmlidXRlOiR7a2V5fTokdGV4dGAsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyBpbnNlcnRpb24gY29udmVyc2lvbiBvZiBhIHJhbmdlIG9mIG5vZGVzLlxuXHQgKlxuXHQgKiBGb3IgZWFjaCBub2RlIGluIHRoZSByYW5nZSwge0BsaW5rICNldmVudDppbnNlcnQgYGluc2VydGAgZXZlbnQgaXMgZmlyZWR9LiBGb3IgZWFjaCBhdHRyaWJ1dGUgb24gZWFjaCBub2RlLFxuXHQgKiB7QGxpbmsgI2V2ZW50OmF0dHJpYnV0ZSBgYXR0cmlidXRlYCBldmVudCBpcyBmaXJlZH0uXG5cdCAqXG5cdCAqIEBmaXJlcyBpbnNlcnRcblx0ICogQGZpcmVzIGF0dHJpYnV0ZVxuXHQgKiBAcGFyYW0gcmFuZ2UgVGhlIGluc2VydGVkIHJhbmdlLlxuXHQgKiBAcGFyYW0gY29udmVyc2lvbkFwaSBUaGUgY29udmVyc2lvbiBBUEkgb2JqZWN0LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5kb05vdEFkZENvbnN1bWFibGVzIFdoZXRoZXIgdGhlIE1vZGVsQ29uc3VtYWJsZSBzaG91bGQgbm90IGdldCBwb3B1bGF0ZWRcblx0ICogZm9yIGl0ZW1zIGluIHRoZSBwcm92aWRlZCByYW5nZS5cblx0ICovIF9jb252ZXJ0SW5zZXJ0KHJhbmdlLCBjb252ZXJzaW9uQXBpLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgaWYgKCFvcHRpb25zLmRvTm90QWRkQ29uc3VtYWJsZXMpIHtcbiAgICAgICAgICAgIC8vIENvbGxlY3QgYSBsaXN0IG9mIHRoaW5ncyB0aGF0IGNhbiBiZSBjb25zdW1lZCwgY29uc2lzdGluZyBvZiBub2RlcyBhbmQgdGhlaXIgYXR0cmlidXRlcy5cbiAgICAgICAgICAgIHRoaXMuX2FkZENvbnN1bWFibGVzRm9ySW5zZXJ0KGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZSwgcmFuZ2UpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpcmUgYSBzZXBhcmF0ZSBpbnNlcnQgZXZlbnQgZm9yIGVhY2ggbm9kZSBhbmQgdGV4dCBmcmFnbWVudCBjb250YWluZWQgaW4gdGhlIHJhbmdlLlxuICAgICAgICBmb3IgKGNvbnN0IGRhdGEgb2YgcmFuZ2UuZ2V0V2Fsa2VyKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgdGhpcy5fdGVzdEFuZEZpcmUoJ2luc2VydCcsIHdhbGtlclZhbHVlVG9FdmVudERhdGEoZGF0YSksIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyBjb252ZXJzaW9uIG9mIGEgc2luZ2xlIG5vZGUgcmVtb3ZhbC4gRmlyZXMge0BsaW5rICNldmVudDpyZW1vdmUgcmVtb3ZlIGV2ZW50fSB3aXRoIHByb3ZpZGVkIGRhdGEuXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiBmcm9tIHdoaWNoIG5vZGUgd2FzIHJlbW92ZWQuXG5cdCAqIEBwYXJhbSBsZW5ndGggT2Zmc2V0IHNpemUgb2YgcmVtb3ZlZCBub2RlLlxuXHQgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHJlbW92ZWQgbm9kZS5cblx0ICogQHBhcmFtIGNvbnZlcnNpb25BcGkgVGhlIGNvbnZlcnNpb24gQVBJIG9iamVjdC5cblx0ICovIF9jb252ZXJ0UmVtb3ZlKHBvc2l0aW9uLCBsZW5ndGgsIG5hbWUsIGNvbnZlcnNpb25BcGkpIHtcbiAgICAgICAgdGhpcy5maXJlKGByZW1vdmU6JHtuYW1lfWAsIHtcbiAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgbGVuZ3RoXG4gICAgICAgIH0sIGNvbnZlcnNpb25BcGkpO1xuICAgIH1cbiAgICAvKipcblx0ICogU3RhcnRzIGEgY29udmVyc2lvbiBvZiBhbiBhdHRyaWJ1dGUgY2hhbmdlIG9uIGEgZ2l2ZW4gYHJhbmdlYC5cblx0ICpcblx0ICogRm9yIGVhY2ggbm9kZSBpbiB0aGUgZ2l2ZW4gYHJhbmdlYCwge0BsaW5rICNldmVudDphdHRyaWJ1dGUgYXR0cmlidXRlIGV2ZW50fSBpcyBmaXJlZCB3aXRoIHRoZSBwYXNzZWQgZGF0YS5cblx0ICpcblx0ICogQGZpcmVzIGF0dHJpYnV0ZVxuXHQgKiBAcGFyYW0gcmFuZ2UgQ2hhbmdlZCByYW5nZS5cblx0ICogQHBhcmFtIGtleSBLZXkgb2YgdGhlIGF0dHJpYnV0ZSB0aGF0IGhhcyBjaGFuZ2VkLlxuXHQgKiBAcGFyYW0gb2xkVmFsdWUgQXR0cmlidXRlIHZhbHVlIGJlZm9yZSB0aGUgY2hhbmdlIG9yIGBudWxsYCBpZiB0aGUgYXR0cmlidXRlIGhhcyBub3QgYmVlbiBzZXQgYmVmb3JlLlxuXHQgKiBAcGFyYW0gbmV3VmFsdWUgTmV3IGF0dHJpYnV0ZSB2YWx1ZSBvciBgbnVsbGAgaWYgdGhlIGF0dHJpYnV0ZSBoYXMgYmVlbiByZW1vdmVkLlxuXHQgKiBAcGFyYW0gY29udmVyc2lvbkFwaSBUaGUgY29udmVyc2lvbiBBUEkgb2JqZWN0LlxuXHQgKi8gX2NvbnZlcnRBdHRyaWJ1dGUocmFuZ2UsIGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlLCBjb252ZXJzaW9uQXBpKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIGxpc3Qgd2l0aCBhdHRyaWJ1dGVzIHRvIGNvbnN1bWUuXG4gICAgICAgIHRoaXMuX2FkZENvbnN1bWFibGVzRm9yUmFuZ2UoY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLCByYW5nZSwgYGF0dHJpYnV0ZToke2tleX1gKTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgc2VwYXJhdGUgYXR0cmlidXRlIGV2ZW50IGZvciBlYWNoIG5vZGUgaW4gdGhlIHJhbmdlLlxuICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlKXtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaXRlbTogdmFsdWUuaXRlbSxcbiAgICAgICAgICAgICAgICByYW5nZTogUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHZhbHVlLnByZXZpb3VzUG9zaXRpb24sIHZhbHVlLmxlbmd0aCksXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IG9sZFZhbHVlLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZU5ld1ZhbHVlOiBuZXdWYWx1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuX3Rlc3RBbmRGaXJlKGBhdHRyaWJ1dGU6JHtrZXl9YCwgZGF0YSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEZpcmVzIHJlLWluc2VydGlvbiBjb252ZXJzaW9uICh3aXRoIGEgYHJlY29udmVyc2lvbmAgZmxhZyBwYXNzZWQgdG8gYGluc2VydGAgZXZlbnRzKVxuXHQgKiBvZiBhIHJhbmdlIG9mIGVsZW1lbnRzIChvbmx5IGVsZW1lbnRzIG9uIHRoZSByYW5nZSBkZXB0aCwgd2l0aG91dCBjaGlsZHJlbikuXG5cdCAqXG5cdCAqIEZvciBlYWNoIG5vZGUgaW4gdGhlIHJhbmdlIG9uIGl0cyBkZXB0aCAod2l0aG91dCBjaGlsZHJlbiksIHtAbGluayAjZXZlbnQ6aW5zZXJ0IGBpbnNlcnRgIGV2ZW50fSBpcyBmaXJlZC5cblx0ICogRm9yIGVhY2ggYXR0cmlidXRlIG9uIGVhY2ggbm9kZSwge0BsaW5rICNldmVudDphdHRyaWJ1dGUgYGF0dHJpYnV0ZWAgZXZlbnR9IGlzIGZpcmVkLlxuXHQgKlxuXHQgKiBAZmlyZXMgaW5zZXJ0XG5cdCAqIEBmaXJlcyBhdHRyaWJ1dGVcblx0ICogQHBhcmFtIHJhbmdlIFRoZSByYW5nZSB0byByZWluc2VydC5cblx0ICogQHBhcmFtIGNvbnZlcnNpb25BcGkgVGhlIGNvbnZlcnNpb24gQVBJIG9iamVjdC5cblx0ICovIF9jb252ZXJ0UmVpbnNlcnQocmFuZ2UsIGNvbnZlcnNpb25BcGkpIHtcbiAgICAgICAgLy8gQ29udmVydCB0aGUgZWxlbWVudHMgLSB3aXRob3V0IGNvbnZlcnRpbmcgY2hpbGRyZW4uXG4gICAgICAgIGNvbnN0IHdhbGtlclZhbHVlcyA9IEFycmF5LmZyb20ocmFuZ2UuZ2V0V2Fsa2VyKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBDb2xsZWN0IGEgbGlzdCBvZiB0aGluZ3MgdGhhdCBjYW4gYmUgY29uc3VtZWQsIGNvbnNpc3Rpbmcgb2Ygbm9kZXMgYW5kIHRoZWlyIGF0dHJpYnV0ZXMuXG4gICAgICAgIHRoaXMuX2FkZENvbnN1bWFibGVzRm9ySW5zZXJ0KGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZSwgd2Fsa2VyVmFsdWVzKTtcbiAgICAgICAgLy8gRmlyZSBhIHNlcGFyYXRlIGluc2VydCBldmVudCBmb3IgZWFjaCBub2RlIGFuZCB0ZXh0IGZyYWdtZW50IGNvbnRhaW5lZCBzaGFsbG93bHkgaW4gdGhlIHJhbmdlLlxuICAgICAgICBmb3IgKGNvbnN0IGRhdGEgb2Ygd2Fsa2VyVmFsdWVzLm1hcCh3YWxrZXJWYWx1ZVRvRXZlbnREYXRhKSl7XG4gICAgICAgICAgICB0aGlzLl90ZXN0QW5kRmlyZSgnaW5zZXJ0Jywge1xuICAgICAgICAgICAgICAgIC4uLmRhdGEsXG4gICAgICAgICAgICAgICAgcmVjb252ZXJzaW9uOiB0cnVlXG4gICAgICAgICAgICB9LCBjb252ZXJzaW9uQXBpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgdGhlIGFkZGVkIG1hcmtlci4gRmlyZXMgdGhlIHtAbGluayAjZXZlbnQ6YWRkTWFya2VyIGBhZGRNYXJrZXJgfSBldmVudCBmb3IgZWFjaCBpdGVtXG5cdCAqIGluIHRoZSBtYXJrZXIncyByYW5nZS4gSWYgdGhlIHJhbmdlIGlzIGNvbGxhcHNlZCwgYSBzaW5nbGUgZXZlbnQgaXMgZGlzcGF0Y2hlZC4gU2VlIHRoZSBldmVudCBkZXNjcmlwdGlvbiBmb3IgbW9yZSBkZXRhaWxzLlxuXHQgKlxuXHQgKiBAZmlyZXMgYWRkTWFya2VyXG5cdCAqIEBwYXJhbSBtYXJrZXJOYW1lIE1hcmtlciBuYW1lLlxuXHQgKiBAcGFyYW0gbWFya2VyUmFuZ2UgVGhlIG1hcmtlciByYW5nZS5cblx0ICogQHBhcmFtIGNvbnZlcnNpb25BcGkgVGhlIGNvbnZlcnNpb24gQVBJIG9iamVjdC5cblx0ICovIF9jb252ZXJ0TWFya2VyQWRkKG1hcmtlck5hbWUsIG1hcmtlclJhbmdlLCBjb252ZXJzaW9uQXBpKSB7XG4gICAgICAgIC8vIERvIG5vdCBjb252ZXJ0IGlmIHJhbmdlIGlzIGluIGdyYXZleWFyZC5cbiAgICAgICAgaWYgKG1hcmtlclJhbmdlLnJvb3Qucm9vdE5hbWUgPT0gJyRncmF2ZXlhcmQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW4gbWFya2VycycgY2FzZSwgZXZlbnQgbmFtZSA9PSBjb25zdW1hYmxlIG5hbWUuXG4gICAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IGBhZGRNYXJrZXI6JHttYXJrZXJOYW1lfWA7XG4gICAgICAgIC8vXG4gICAgICAgIC8vIEZpcnN0LCBmaXJlIGFuIGV2ZW50IGZvciB0aGUgd2hvbGUgbWFya2VyLlxuICAgICAgICAvL1xuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuYWRkKG1hcmtlclJhbmdlLCBldmVudE5hbWUpO1xuICAgICAgICB0aGlzLmZpcmUoZXZlbnROYW1lLCB7XG4gICAgICAgICAgICBtYXJrZXJOYW1lLFxuICAgICAgICAgICAgbWFya2VyUmFuZ2VcbiAgICAgICAgfSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vIERvIG5vdCBmaXJlIGV2ZW50cyBmb3IgZWFjaCBpdGVtIGluc2lkZSB0aGUgcmFuZ2UgaWYgdGhlIHJhbmdlIGdvdCBjb25zdW1lZC5cbiAgICAgICAgLy8gQWxzbyBjb25zdW1lIHRoZSB3aG9sZSBtYXJrZXIgY29uc3VtYWJsZSBpZiBpdCB3YXNuJ3QgY29uc3VtZWQuXG4gICAgICAgIC8vXG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUobWFya2VyUmFuZ2UsIGV2ZW50TmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGVuLCBmaXJlIGFuIGV2ZW50IGZvciBlYWNoIGl0ZW0gaW5zaWRlIHRoZSBtYXJrZXIgcmFuZ2UuXG4gICAgICAgIC8vXG4gICAgICAgIHRoaXMuX2FkZENvbnN1bWFibGVzRm9yUmFuZ2UoY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLCBtYXJrZXJSYW5nZSwgZXZlbnROYW1lKTtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIG1hcmtlclJhbmdlLmdldEl0ZW1zKCkpe1xuICAgICAgICAgICAgLy8gRG8gbm90IGZpcmUgZXZlbnQgZm9yIGFscmVhZHkgY29uc3VtZWQgaXRlbXMuXG4gICAgICAgICAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGl0ZW0sIGV2ZW50TmFtZSkpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICByYW5nZTogUmFuZ2UuX2NyZWF0ZU9uKGl0ZW0pLFxuICAgICAgICAgICAgICAgIG1hcmtlck5hbWUsXG4gICAgICAgICAgICAgICAgbWFya2VyUmFuZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmZpcmUoZXZlbnROYW1lLCBkYXRhLCBjb252ZXJzaW9uQXBpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogRmlyZXMgdGhlIGNvbnZlcnNpb24gb2YgdGhlIG1hcmtlciByZW1vdmFsLiBGaXJlcyB0aGUge0BsaW5rICNldmVudDpyZW1vdmVNYXJrZXIgYHJlbW92ZU1hcmtlcmB9IGV2ZW50IHdpdGggdGhlIHByb3ZpZGVkIGRhdGEuXG5cdCAqXG5cdCAqIEBmaXJlcyByZW1vdmVNYXJrZXJcblx0ICogQHBhcmFtIG1hcmtlck5hbWUgTWFya2VyIG5hbWUuXG5cdCAqIEBwYXJhbSBtYXJrZXJSYW5nZSBUaGUgbWFya2VyIHJhbmdlLlxuXHQgKiBAcGFyYW0gY29udmVyc2lvbkFwaSBUaGUgY29udmVyc2lvbiBBUEkgb2JqZWN0LlxuXHQgKi8gX2NvbnZlcnRNYXJrZXJSZW1vdmUobWFya2VyTmFtZSwgbWFya2VyUmFuZ2UsIGNvbnZlcnNpb25BcGkpIHtcbiAgICAgICAgLy8gRG8gbm90IGNvbnZlcnQgaWYgcmFuZ2UgaXMgaW4gZ3JhdmV5YXJkLlxuICAgICAgICBpZiAobWFya2VyUmFuZ2Uucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpcmUoYHJlbW92ZU1hcmtlcjoke21hcmtlck5hbWV9YCwge1xuICAgICAgICAgICAgbWFya2VyTmFtZSxcbiAgICAgICAgICAgIG1hcmtlclJhbmdlXG4gICAgICAgIH0sIGNvbnZlcnNpb25BcGkpO1xuICAgIH1cbiAgICAvKipcblx0ICogRmlyZXMgdGhlIHJlZHVjdGlvbiBvZiBjaGFuZ2VzIGJ1ZmZlcmVkIGluIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kaWZmZXJ+RGlmZmVyIGBEaWZmZXJgfS5cblx0ICpcblx0ICogRmVhdHVyZXMgY2FuIHJlcGxhY2Ugc2VsZWN0ZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZGlmZmVyfkRpZmZJdGVtIGBEaWZmSXRlbWB9cyB3aXRoIGByZWluc2VydGAgZW50cmllcyB0byB0cmlnZ2VyXG5cdCAqIHJlY29udmVyc2lvbi4gVGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkRvd25jYXN0SGVscGVycyNlbGVtZW50VG9TdHJ1Y3R1cmVcblx0ICogYERvd25jYXN0SGVscGVycy5lbGVtZW50VG9TdHJ1Y3R1cmUoKWB9IGlzIHVzaW5nIHRoaXMgZXZlbnQgdG8gdHJpZ2dlciByZWNvbnZlcnNpb24uXG5cdCAqXG5cdCAqIEBmaXJlcyByZWR1Y2VDaGFuZ2VzXG5cdCAqLyBfcmVkdWNlQ2hhbmdlcyhjaGFuZ2VzKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICBjaGFuZ2VzXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZmlyZSgncmVkdWNlQ2hhbmdlcycsIGRhdGEpO1xuICAgICAgICByZXR1cm4gZGF0YS5jaGFuZ2VzO1xuICAgIH1cbiAgICAvKipcblx0ICogUG9wdWxhdGVzIHByb3ZpZGVkIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbW9kZWxjb25zdW1hYmxlfk1vZGVsQ29uc3VtYWJsZX0gd2l0aCB2YWx1ZXMgdG8gY29uc3VtZSBmcm9tIGEgZ2l2ZW4gcmFuZ2UsXG5cdCAqIGFzc3VtaW5nIHRoYXQgdGhlIHJhbmdlIGhhcyBqdXN0IGJlZW4gaW5zZXJ0ZWQgdG8gdGhlIG1vZGVsLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZSBUaGUgY29uc3VtYWJsZS5cblx0ICogQHBhcmFtIHdhbGtlclZhbHVlcyBUaGUgd2Fsa2VyIHZhbHVlcyBmb3IgdGhlIGluc2VydGVkIHJhbmdlLlxuXHQgKiBAcmV0dXJucyBUaGUgdmFsdWVzIHRvIGNvbnN1bWUuXG5cdCAqLyBfYWRkQ29uc3VtYWJsZXNGb3JJbnNlcnQoY29uc3VtYWJsZSwgd2Fsa2VyVmFsdWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2Ygd2Fsa2VyVmFsdWVzKXtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB2YWx1ZS5pdGVtO1xuICAgICAgICAgICAgLy8gQWRkIGNvbnN1bWFibGUgaWYgaXQgd2Fzbid0IHRoZXJlIHlldC5cbiAgICAgICAgICAgIGlmIChjb25zdW1hYmxlLnRlc3QoaXRlbSwgJ2luc2VydCcpID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3VtYWJsZS5hZGQoaXRlbSwgJ2luc2VydCcpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGl0ZW0uZ2V0QXR0cmlidXRlS2V5cygpKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3VtYWJsZS5hZGQoaXRlbSwgJ2F0dHJpYnV0ZTonICsga2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnN1bWFibGU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQb3B1bGF0ZXMgcHJvdmlkZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tb2RlbGNvbnN1bWFibGV+TW9kZWxDb25zdW1hYmxlfSB3aXRoIHZhbHVlcyB0byBjb25zdW1lIGZvciBhIGdpdmVuIHJhbmdlLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZSBUaGUgY29uc3VtYWJsZS5cblx0ICogQHBhcmFtIHJhbmdlIFRoZSBhZmZlY3RlZCByYW5nZS5cblx0ICogQHBhcmFtIHR5cGUgQ29uc3VtYWJsZSB0eXBlLlxuXHQgKiBAcmV0dXJucyBUaGUgdmFsdWVzIHRvIGNvbnN1bWUuXG5cdCAqLyBfYWRkQ29uc3VtYWJsZXNGb3JSYW5nZShjb25zdW1hYmxlLCByYW5nZSwgdHlwZSkge1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmFuZ2UuZ2V0SXRlbXMoKSl7XG4gICAgICAgICAgICBjb25zdW1hYmxlLmFkZChpdGVtLCB0eXBlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29uc3VtYWJsZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBvcHVsYXRlcyBwcm92aWRlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21vZGVsY29uc3VtYWJsZX5Nb2RlbENvbnN1bWFibGV9IHdpdGggc2VsZWN0aW9uIGNvbnN1bWFibGUgdmFsdWVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uc3VtYWJsZSBUaGUgY29uc3VtYWJsZS5cblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIHRvIGNyZWF0ZSB0aGUgY29uc3VtYWJsZSBmcm9tLlxuXHQgKiBAcGFyYW0gbWFya2VycyBNYXJrZXJzIHRoYXQgY29udGFpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBAcmV0dXJucyBUaGUgdmFsdWVzIHRvIGNvbnN1bWUuXG5cdCAqLyBfYWRkQ29uc3VtYWJsZXNGb3JTZWxlY3Rpb24oY29uc3VtYWJsZSwgc2VsZWN0aW9uLCBtYXJrZXJzKSB7XG4gICAgICAgIGNvbnN1bWFibGUuYWRkKHNlbGVjdGlvbiwgJ3NlbGVjdGlvbicpO1xuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiBtYXJrZXJzKXtcbiAgICAgICAgICAgIGNvbnN1bWFibGUuYWRkKHNlbGVjdGlvbiwgJ2FkZE1hcmtlcjonICsgbWFya2VyLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIHNlbGVjdGlvbi5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICAgICAgY29uc3VtYWJsZS5hZGQoc2VsZWN0aW9uLCAnYXR0cmlidXRlOicgKyBrZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25zdW1hYmxlO1xuICAgIH1cbiAgICAvKipcblx0ICogVGVzdHMgd2hldGhlciBnaXZlbiBldmVudCB3YXNuJ3QgYWxyZWFkeSBmaXJlZCBhbmQgaWYgc28sIGZpcmVzIGl0LlxuXHQgKlxuXHQgKiBAZmlyZXMgaW5zZXJ0XG5cdCAqIEBmaXJlcyBhdHRyaWJ1dGVcblx0ICogQHBhcmFtIHR5cGUgRXZlbnQgdHlwZS5cblx0ICogQHBhcmFtIGRhdGEgRXZlbnQgZGF0YS5cblx0ICogQHBhcmFtIGNvbnZlcnNpb25BcGkgVGhlIGNvbnZlcnNpb24gQVBJIG9iamVjdC5cblx0ICovIF90ZXN0QW5kRmlyZSh0eXBlLCBkYXRhLCBjb252ZXJzaW9uQXBpKSB7XG4gICAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IGdldEV2ZW50TmFtZSh0eXBlLCBkYXRhKTtcbiAgICAgICAgY29uc3QgaXRlbUtleSA9IGRhdGEuaXRlbS5pcygnJHRleHRQcm94eScpID8gY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLl9nZXRTeW1ib2xGb3JUZXh0UHJveHkoZGF0YS5pdGVtKSA6IGRhdGEuaXRlbTtcbiAgICAgICAgY29uc3QgZXZlbnRzRmlyZWRGb3JDb252ZXJzaW9uID0gdGhpcy5fZmlyZWRFdmVudHNNYXAuZ2V0KGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBjb25zdCBldmVudHNGaXJlZEZvckl0ZW0gPSBldmVudHNGaXJlZEZvckNvbnZlcnNpb24uZ2V0KGl0ZW1LZXkpO1xuICAgICAgICBpZiAoIWV2ZW50c0ZpcmVkRm9ySXRlbSkge1xuICAgICAgICAgICAgZXZlbnRzRmlyZWRGb3JDb252ZXJzaW9uLnNldChpdGVtS2V5LCBuZXcgU2V0KFtcbiAgICAgICAgICAgICAgICBldmVudE5hbWVcbiAgICAgICAgICAgIF0pKTtcbiAgICAgICAgfSBlbHNlIGlmICghZXZlbnRzRmlyZWRGb3JJdGVtLmhhcyhldmVudE5hbWUpKSB7XG4gICAgICAgICAgICBldmVudHNGaXJlZEZvckl0ZW0uYWRkKGV2ZW50TmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXJlKGV2ZW50TmFtZSwgZGF0YSwgY29udmVyc2lvbkFwaSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyBub3QgYWxyZWFkeSBmaXJlZCBldmVudHMgZm9yIHNldHRpbmcgYXR0cmlidXRlcyBvbiBqdXN0IGluc2VydGVkIGl0ZW0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIFRoZSBtb2RlbCBpdGVtIHRvIGNvbnZlcnQgYXR0cmlidXRlcyBmb3IuXG5cdCAqIEBwYXJhbSBjb252ZXJzaW9uQXBpIFRoZSBjb252ZXJzaW9uIEFQSSBvYmplY3QuXG5cdCAqLyBfdGVzdEFuZEZpcmVBZGRBdHRyaWJ1dGVzKGl0ZW0sIGNvbnZlcnNpb25BcGkpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICByYW5nZTogUmFuZ2UuX2NyZWF0ZU9uKGl0ZW0pXG4gICAgICAgIH07XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGRhdGEuaXRlbS5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICAgICAgZGF0YS5hdHRyaWJ1dGVLZXkgPSBrZXk7XG4gICAgICAgICAgICBkYXRhLmF0dHJpYnV0ZU9sZFZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgIGRhdGEuYXR0cmlidXRlTmV3VmFsdWUgPSBkYXRhLml0ZW0uZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgICAgICAgICB0aGlzLl90ZXN0QW5kRmlyZShgYXR0cmlidXRlOiR7a2V5fWAsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBCdWlsZHMgYW4gaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0Q29udmVyc2lvbkFwaX0gZnJvbSBhIHRlbXBsYXRlIGFuZCBhIGdpdmVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIgYERvd25jYXN0V3JpdGVyYH0gYW5kIG9wdGlvbnMgb2JqZWN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gd3JpdGVyIFZpZXcgd3JpdGVyIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gbW9kaWZ5IHRoZSB2aWV3IGRvY3VtZW50LlxuXHQgKiBAcGFyYW0gcmVmcmVzaGVkSXRlbXMgQSBzZXQgb2YgbW9kZWwgZWxlbWVudHMgdGhhdCBzaG91bGQgbm90IHJldXNlIHRoZWlyXG5cdCAqIHByZXZpb3VzIHZpZXcgcmVwcmVzZW50YXRpb25zLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25hbCBvcHRpb25zIHBhc3NlZCB0byBgY29udmVydGlvbkFwaS5vcHRpb25zYC5cblx0ICogQHJldHVybiBUaGUgY29udmVyc2lvbiBBUEkgb2JqZWN0LlxuXHQgKi8gX2NyZWF0ZUNvbnZlcnNpb25BcGkod3JpdGVyLCByZWZyZXNoZWRJdGVtcyA9IG5ldyBTZXQoKSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGNvbnZlcnNpb25BcGkgPSB7XG4gICAgICAgICAgICAuLi50aGlzLl9jb252ZXJzaW9uQXBpLFxuICAgICAgICAgICAgY29uc3VtYWJsZTogbmV3IE1vZGVsQ29uc3VtYWJsZSgpLFxuICAgICAgICAgICAgd3JpdGVyLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIGNvbnZlcnRJdGVtOiAoaXRlbSk9PnRoaXMuX2NvbnZlcnRJbnNlcnQoUmFuZ2UuX2NyZWF0ZU9uKGl0ZW0pLCBjb252ZXJzaW9uQXBpKSxcbiAgICAgICAgICAgIGNvbnZlcnRDaGlsZHJlbjogKGVsZW1lbnQpPT50aGlzLl9jb252ZXJ0SW5zZXJ0KFJhbmdlLl9jcmVhdGVJbihlbGVtZW50KSwgY29udmVyc2lvbkFwaSwge1xuICAgICAgICAgICAgICAgICAgICBkb05vdEFkZENvbnN1bWFibGVzOiB0cnVlXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjb252ZXJ0QXR0cmlidXRlczogKGl0ZW0pPT50aGlzLl90ZXN0QW5kRmlyZUFkZEF0dHJpYnV0ZXMoaXRlbSwgY29udmVyc2lvbkFwaSksXG4gICAgICAgICAgICBjYW5SZXVzZVZpZXc6ICh2aWV3RWxlbWVudCk9PiFyZWZyZXNoZWRJdGVtcy5oYXMoY29udmVyc2lvbkFwaS5tYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld0VsZW1lbnQpKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9maXJlZEV2ZW50c01hcC5zZXQoY29udmVyc2lvbkFwaSwgbmV3IE1hcCgpKTtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnNpb25BcGk7XG4gICAgfVxufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24sIGNoZWNrcyB3aGV0aGVyIGNoYW5nZSBvZiBgbWFya2VyYCBhdCBgbW9kZWxQb3NpdGlvbmAgc2hvdWxkIGJlIGNvbnZlcnRlZC4gTWFya2VyIGNoYW5nZXMgYXJlIG5vdFxuICogY29udmVydGVkIGlmIHRoZXkgaGFwcGVuIGluc2lkZSBhbiBlbGVtZW50IHdpdGggY3VzdG9tIGNvbnZlcnNpb24gbWV0aG9kLlxuICovIGZ1bmN0aW9uIHNob3VsZE1hcmtlckNoYW5nZUJlQ29udmVydGVkKG1vZGVsUG9zaXRpb24sIG1hcmtlciwgbWFwcGVyKSB7XG4gICAgY29uc3QgcmFuZ2UgPSBtYXJrZXIuZ2V0UmFuZ2UoKTtcbiAgICBjb25zdCBhbmNlc3RvcnMgPSBBcnJheS5mcm9tKG1vZGVsUG9zaXRpb24uZ2V0QW5jZXN0b3JzKCkpO1xuICAgIGFuY2VzdG9ycy5zaGlmdCgpOyAvLyBSZW1vdmUgcm9vdCBlbGVtZW50LiBJdCBjYW5ub3QgYmUgcGFzc2VkIHRvIGBtb2RlbC5SYW5nZSNjb250YWluc0l0ZW1gLlxuICAgIGFuY2VzdG9ycy5yZXZlcnNlKCk7XG4gICAgY29uc3QgaGFzQ3VzdG9tSGFuZGxpbmcgPSBhbmNlc3RvcnMuc29tZSgoZWxlbWVudCk9PntcbiAgICAgICAgaWYgKHJhbmdlLmNvbnRhaW5zSXRlbShlbGVtZW50KSkge1xuICAgICAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBtYXBwZXIudG9WaWV3RWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybiAhIXZpZXdFbGVtZW50LmdldEN1c3RvbVByb3BlcnR5KCdhZGRIaWdobGlnaHQnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiAhaGFzQ3VzdG9tSGFuZGxpbmc7XG59XG5mdW5jdGlvbiBnZXRFdmVudE5hbWUodHlwZSwgZGF0YSkge1xuICAgIGNvbnN0IG5hbWUgPSBkYXRhLml0ZW0uaXMoJ2VsZW1lbnQnKSA/IGRhdGEuaXRlbS5uYW1lIDogJyR0ZXh0JztcbiAgICByZXR1cm4gYCR7dHlwZX06JHtuYW1lfWA7XG59XG5mdW5jdGlvbiB3YWxrZXJWYWx1ZVRvRXZlbnREYXRhKHZhbHVlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaXRlbTogdmFsdWUuaXRlbSxcbiAgICAgICAgcmFuZ2U6IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdCh2YWx1ZS5wcmV2aW91c1Bvc2l0aW9uLCB2YWx1ZS5sZW5ndGgpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBNb2RlbCBub2RlLiBNb3N0IGJhc2ljIHN0cnVjdHVyZSBvZiBtb2RlbCB0cmVlLlxuICpcbiAqIFRoaXMgaXMgYW4gYWJzdHJhY3QgY2xhc3MgdGhhdCBpcyBhIGJhc2UgZm9yIG90aGVyIGNsYXNzZXMgcmVwcmVzZW50aW5nIGRpZmZlcmVudCBub2RlcyBpbiBtb2RlbC5cbiAqXG4gKiAqKk5vdGU6KiogSWYgYSBub2RlIGlzIGRldGFjaGVkIGZyb20gdGhlIG1vZGVsIHRyZWUsIHlvdSBjYW4gbWFuaXB1bGF0ZSBpdCB1c2luZyBpdCdzIEFQSS5cbiAqIEhvd2V2ZXIsIGl0IGlzICoqdmVyeSBpbXBvcnRhbnQqKiB0aGF0IG5vZGVzIGFscmVhZHkgYXR0YWNoZWQgdG8gbW9kZWwgdHJlZSBzaG91bGQgYmUgb25seSBjaGFuZ2VkIHRocm91Z2hcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgV3JpdGVyIEFQSX0uXG4gKlxuICogQ2hhbmdlcyBkb25lIGJ5IGBOb2RlYCBtZXRob2RzLCBsaWtlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCNfaW5zZXJ0Q2hpbGQgX2luc2VydENoaWxkfSBvclxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI19zZXRBdHRyaWJ1dGUgX3NldEF0dHJpYnV0ZX1cbiAqIGRvIG5vdCBnZW5lcmF0ZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiBvcGVyYXRpb25zfVxuICogd2hpY2ggYXJlIGVzc2VudGlhbCBmb3IgY29ycmVjdCBlZGl0b3Igd29yayBpZiB5b3UgbW9kaWZ5IG5vZGVzIGluIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50IGRvY3VtZW50fSByb290LlxuICpcbiAqIFRoZSBmbG93IG9mIHdvcmtpbmcgb24gYE5vZGVgIChhbmQgY2xhc3NlcyB0aGF0IGluaGVyaXRzIGZyb20gaXQpIGlzIGFzIHN1Y2g6XG4gKiAxLiBZb3UgY2FuIGNyZWF0ZSBhIGBOb2RlYCBpbnN0YW5jZSwgbW9kaWZ5IGl0IHVzaW5nIGl0J3MgQVBJLlxuICogMi4gQWRkIGBOb2RlYCB0byB0aGUgbW9kZWwgdXNpbmcgYEJhdGNoYCBBUEkuXG4gKiAzLiBDaGFuZ2UgYE5vZGVgIHRoYXQgd2FzIGFscmVhZHkgYWRkZWQgdG8gdGhlIG1vZGVsIHVzaW5nIGBCYXRjaGAgQVBJLlxuICpcbiAqIFNpbWlsYXJseSwgeW91IGNhbm5vdCB1c2UgYEJhdGNoYCBBUEkgb24gYSBub2RlIHRoYXQgaGFzIG5vdCBiZWVuIGFkZGVkIHRvIHRoZSBtb2RlbCB0cmVlLCB3aXRoIHRoZSBleGNlcHRpb25cbiAqIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjaW5zZXJ0IGluc2VydGluZ30gdGhhdCBub2RlIHRvIHRoZSBtb2RlbCB0cmVlLlxuICpcbiAqIEJlIGF3YXJlIHRoYXQgdXNpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNyZW1vdmUgcmVtb3ZlIGZyb20gQmF0Y2ggQVBJfSBkb2VzIG5vdCBhbGxvdyB0byB1c2UgYE5vZGVgIEFQSSBiZWNhdXNlXG4gKiB0aGUgaW5mb3JtYXRpb24gYWJvdXQgYE5vZGVgIGlzIHN0aWxsIGtlcHQgaW4gbW9kZWwgZG9jdW1lbnQuXG4gKlxuICogSW4gY2FzZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudCBub2RlfSwgYWRkaW5nIGFuZCByZW1vdmluZyBjaGlsZHJlbiBhbHNvIGNvdW50cyBhcyBjaGFuZ2luZyBhIG5vZGUgYW5kXG4gKiBmb2xsb3dzIHNhbWUgcnVsZXMuXG4gKi8gbGV0IE5vZGUkMSA9IGNsYXNzIE5vZGUgZXh0ZW5kcyBUeXBlQ2hlY2thYmxlIHtcbiAgICAvKipcblx0ICogUGFyZW50IG9mIHRoaXMgbm9kZS4gSXQgY291bGQgYmUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fVxuXHQgKiBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9LlxuXHQgKiBFcXVhbHMgdG8gYG51bGxgIGlmIHRoZSBub2RlIGhhcyBubyBwYXJlbnQuXG5cdCAqLyBwYXJlbnQgPSBudWxsO1xuICAgIC8qKlxuXHQgKiBBdHRyaWJ1dGVzIHNldCBvbiB0aGlzIG5vZGUuXG5cdCAqLyBfYXR0cnM7XG4gICAgLyoqXG5cdCAqIEluZGV4IG9mIHRoaXMgbm9kZSBpbiBpdHMgcGFyZW50IG9yIGBudWxsYCBpZiB0aGUgbm9kZSBoYXMgbm8gcGFyZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9pbmRleCA9IG51bGw7XG4gICAgLyoqXG5cdCAqIE9mZnNldCBhdCB3aGljaCB0aGlzIG5vZGUgc3RhcnRzIGluIGl0cyBwYXJlbnQgb3IgYG51bGxgIGlmIHRoZSBub2RlIGhhcyBubyBwYXJlbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3N0YXJ0T2Zmc2V0ID0gbnVsbDtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1vZGVsIG5vZGUuXG5cdCAqXG5cdCAqIFRoaXMgaXMgYW4gYWJzdHJhY3QgY2xhc3MsIHNvIHRoaXMgY29uc3RydWN0b3Igc2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5LlxuXHQgKlxuXHQgKiBAcGFyYW0gYXR0cnMgTm9kZSdzIGF0dHJpYnV0ZXMuIFNlZSB7QGxpbmsgbW9kdWxlOnV0aWxzL3RvbWFwfnRvTWFwfSBmb3IgYSBsaXN0IG9mIGFjY2VwdGVkIHZhbHVlcy5cblx0ICovIGNvbnN0cnVjdG9yKGF0dHJzKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fYXR0cnMgPSB0b01hcChhdHRycyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBEb2N1bWVudH0gdGhhdCBvd25zIHRoaXMgcm9vdCBlbGVtZW50LlxuXHQgKi8gZ2V0IGRvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluZGV4IG9mIHRoaXMgbm9kZSBpbiBpdHMgcGFyZW50IG9yIGBudWxsYCBpZiB0aGUgbm9kZSBoYXMgbm8gcGFyZW50LlxuXHQgKi8gZ2V0IGluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5kZXg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPZmZzZXQgYXQgd2hpY2ggdGhpcyBub2RlIHN0YXJ0cyBpbiBpdHMgcGFyZW50LiBJdCBpcyBlcXVhbCB0byB0aGUgc3VtIG9mIHtAbGluayAjb2Zmc2V0U2l6ZSBvZmZzZXRTaXplfVxuXHQgKiBvZiBhbGwgaXRzIHByZXZpb3VzIHNpYmxpbmdzLiBFcXVhbHMgdG8gYG51bGxgIGlmIG5vZGUgaGFzIG5vIHBhcmVudC5cblx0ICovIGdldCBzdGFydE9mZnNldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0T2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogT2Zmc2V0IHNpemUgb2YgdGhpcyBub2RlLlxuXHQgKlxuXHQgKiBSZXByZXNlbnRzIGhvdyBtdWNoIFwib2Zmc2V0IHNwYWNlXCIgaXMgb2NjdXBpZWQgYnkgdGhlIG5vZGUgaW4gaXRzIHBhcmVudC4gSXQgaXMgaW1wb3J0YW50IGZvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbn0uIFdoZW4gbm9kZSBoYXMgYG9mZnNldFNpemVgIGdyZWF0ZXIgdGhhbiBgMWAsIHBvc2l0aW9uIGNhbiBiZSBwbGFjZWQgYmV0d2VlblxuXHQgKiB0aGF0IG5vZGUgc3RhcnQgYW5kIGVuZC4gYG9mZnNldFNpemVgIGdyZWF0ZXIgdGhhbiBgMWAgaXMgZm9yIG5vZGVzIHRoYXQgcmVwcmVzZW50cyBtb3JlIHRoYW4gb25lIGVudGl0eSwgaS5lLlxuXHQgKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCB0ZXh0IG5vZGV9LlxuXHQgKi8gZ2V0IG9mZnNldFNpemUoKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICAvKipcblx0ICogT2Zmc2V0IGF0IHdoaWNoIHRoaXMgbm9kZSBlbmRzIGluIGl0cyBwYXJlbnQuIEl0IGlzIGVxdWFsIHRvIHRoZSBzdW0gb2YgdGhpcyBub2RlJ3Ncblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI3N0YXJ0T2Zmc2V0IHN0YXJ0IG9mZnNldH0gYW5kIHtAbGluayAjb2Zmc2V0U2l6ZSBvZmZzZXQgc2l6ZX0uXG5cdCAqIEVxdWFscyB0byBgbnVsbGAgaWYgdGhlIG5vZGUgaGFzIG5vIHBhcmVudC5cblx0ICovIGdldCBlbmRPZmZzZXQoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0T2Zmc2V0ID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdGFydE9mZnNldCArIHRoaXMub2Zmc2V0U2l6ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE5vZGUncyBuZXh0IHNpYmxpbmcgb3IgYG51bGxgIGlmIHRoZSBub2RlIGlzIGEgbGFzdCBjaGlsZCBvZiBpdCdzIHBhcmVudCBvciBpZiB0aGUgbm9kZSBoYXMgbm8gcGFyZW50LlxuXHQgKi8gZ2V0IG5leHRTaWJsaW5nKCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgICAgIHJldHVybiBpbmRleCAhPT0gbnVsbCAmJiB0aGlzLnBhcmVudC5nZXRDaGlsZChpbmRleCArIDEpIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOb2RlJ3MgcHJldmlvdXMgc2libGluZyBvciBgbnVsbGAgaWYgdGhlIG5vZGUgaXMgYSBmaXJzdCBjaGlsZCBvZiBpdCdzIHBhcmVudCBvciBpZiB0aGUgbm9kZSBoYXMgbm8gcGFyZW50LlxuXHQgKi8gZ2V0IHByZXZpb3VzU2libGluZygpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmluZGV4O1xuICAgICAgICByZXR1cm4gaW5kZXggIT09IG51bGwgJiYgdGhpcy5wYXJlbnQuZ2V0Q2hpbGQoaW5kZXggLSAxKSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIHRvcC1tb3N0IGFuY2VzdG9yIG9mIHRoZSBub2RlLiBJZiBub2RlIGhhcyBubyBwYXJlbnQgaXQgaXMgdGhlIHJvb3QgaXRzZWxmLiBJZiB0aGUgbm9kZSBpcyBhIHBhcnRcblx0ICogb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fSwgaXQncyBgcm9vdGAgaXMgZXF1YWwgdG8gdGhhdCBgRG9jdW1lbnRGcmFnbWVudGAuXG5cdCAqLyBnZXQgcm9vdCgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzLCBjb25zaXN0ZW50LXRoaXNcbiAgICAgICAgbGV0IHJvb3QgPSB0aGlzO1xuICAgICAgICB3aGlsZShyb290LnBhcmVudCl7XG4gICAgICAgICAgICByb290ID0gcm9vdC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgbm9kZSBpcyBpbnNpZGUgYSBkb2N1bWVudCByb290IHRoYXQgaXMgYXR0YWNoZWQgdG8gdGhlIGRvY3VtZW50LlxuXHQgKi8gaXNBdHRhY2hlZCgpIHtcbiAgICAgICAgLy8gSWYgdGhlIG5vZGUgaGFzIG5vIHBhcmVudCBpdCBtZWFucyB0aGF0IGl0IGlzIGEgcm9vdC5cbiAgICAgICAgLy8gQnV0IHRoaXMgaXMgbm90IGEgYFJvb3RFbGVtZW50YCwgc28gaXQgbWVhbnMgdGhhdCBpdCBpcyBub3QgYXR0YWNoZWQuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIElmIHRoaXMgaXMgbm90IHRoZSByb290LCBjaGVjayBpZiB0aGlzIGVsZW1lbnQncyByb290IGlzIGF0dGFjaGVkLlxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQgPT09IG51bGwgPyBmYWxzZSA6IHRoaXMucm9vdC5pc0F0dGFjaGVkKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHBhdGggdG8gdGhlIG5vZGUuIFRoZSBwYXRoIGlzIGFuIGFycmF5IGNvbnRhaW5pbmcgc3RhcnRpbmcgb2Zmc2V0cyBvZiBjb25zZWN1dGl2ZSBhbmNlc3RvcnMgb2YgdGhpcyBub2RlLFxuXHQgKiBiZWdpbm5pbmcgZnJvbSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjcm9vdCByb290fSwgZG93biB0byB0aGlzIG5vZGUncyBzdGFydGluZyBvZmZzZXQuIFRoZSBwYXRoIGNhbiBiZSB1c2VkIHRvXG5cdCAqIGNyZWF0ZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBQb3NpdGlvbn0gaW5zdGFuY2UuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IGFiYyA9IG5ldyBUZXh0KCAnYWJjJyApO1xuXHQgKiBjb25zdCBmb28gPSBuZXcgVGV4dCggJ2ZvbycgKTtcblx0ICogY29uc3QgaDEgPSBuZXcgRWxlbWVudCggJ2gxJywgbnVsbCwgbmV3IFRleHQoICdoZWFkZXInICkgKTtcblx0ICogY29uc3QgcCA9IG5ldyBFbGVtZW50KCAncCcsIG51bGwsIFsgYWJjLCBmb28gXSApO1xuXHQgKiBjb25zdCBkaXYgPSBuZXcgRWxlbWVudCggJ2RpdicsIG51bGwsIFsgaDEsIHAgXSApO1xuXHQgKiBmb28uZ2V0UGF0aCgpOyAvLyBSZXR1cm5zIFsgMSwgMyBdLiBgZm9vYCBpcyBpbiBgcGAgd2hpY2ggaXMgaW4gYGRpdmAuIGBwYCBzdGFydHMgYXQgb2Zmc2V0IDEsIHdoaWxlIGBmb29gIGF0IDMuXG5cdCAqIGgxLmdldFBhdGgoKTsgLy8gUmV0dXJucyBbIDAgXS5cblx0ICogZGl2LmdldFBhdGgoKTsgLy8gUmV0dXJucyBbXS5cblx0ICogYGBgXG5cdCAqLyBnZXRQYXRoKCkge1xuICAgICAgICBjb25zdCBwYXRoID0gW107XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdGhpcy1hbGlhcywgY29uc2lzdGVudC10aGlzXG4gICAgICAgIGxldCBub2RlID0gdGhpcztcbiAgICAgICAgd2hpbGUobm9kZS5wYXJlbnQpe1xuICAgICAgICAgICAgcGF0aC51bnNoaWZ0KG5vZGUuc3RhcnRPZmZzZXQpO1xuICAgICAgICAgICAgbm9kZSA9IG5vZGUucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXRoO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbmNlc3RvcnMgYXJyYXkgb2YgdGhpcyBub2RlLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25zIG9iamVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuaW5jbHVkZVNlbGYgV2hlbiBzZXQgdG8gYHRydWVgIHRoaXMgbm9kZSB3aWxsIGJlIGFsc28gaW5jbHVkZWQgaW4gcGFyZW50J3MgYXJyYXkuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnBhcmVudEZpcnN0IFdoZW4gc2V0IHRvIGB0cnVlYCwgYXJyYXkgd2lsbCBiZSBzb3J0ZWQgZnJvbSBub2RlJ3MgcGFyZW50IHRvIHJvb3QgZWxlbWVudCxcblx0ICogb3RoZXJ3aXNlIHJvb3QgZWxlbWVudCB3aWxsIGJlIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBhcnJheS5cblx0ICogQHJldHVybnMgQXJyYXkgd2l0aCBhbmNlc3RvcnMuXG5cdCAqLyBnZXRBbmNlc3RvcnMob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9ycyA9IFtdO1xuICAgICAgICBsZXQgcGFyZW50ID0gb3B0aW9ucy5pbmNsdWRlU2VsZiA/IHRoaXMgOiB0aGlzLnBhcmVudDtcbiAgICAgICAgd2hpbGUocGFyZW50KXtcbiAgICAgICAgICAgIGFuY2VzdG9yc1tvcHRpb25zLnBhcmVudEZpcnN0ID8gJ3B1c2gnIDogJ3Vuc2hpZnQnXShwYXJlbnQpO1xuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYW5jZXN0b3JzO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudH0gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fVxuXHQgKiB3aGljaCBpcyBhIGNvbW1vbiBhbmNlc3RvciBvZiBib3RoIG5vZGVzLlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBUaGUgc2Vjb25kIG5vZGUuXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5pbmNsdWRlU2VsZiBXaGVuIHNldCB0byBgdHJ1ZWAgYm90aCBub2RlcyB3aWxsIGJlIGNvbnNpZGVyZWQgXCJhbmNlc3RvcnNcIiB0b28uXG5cdCAqIFdoaWNoIG1lYW5zIHRoYXQgaWYgZS5nLiBub2RlIEEgaXMgaW5zaWRlIEIsIHRoZW4gdGhlaXIgY29tbW9uIGFuY2VzdG9yIHdpbGwgYmUgQi5cblx0ICovIGdldENvbW1vbkFuY2VzdG9yKG5vZGUsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBhbmNlc3RvcnNBID0gdGhpcy5nZXRBbmNlc3RvcnMob3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9yc0IgPSBub2RlLmdldEFuY2VzdG9ycyhvcHRpb25zKTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICB3aGlsZShhbmNlc3RvcnNBW2ldID09IGFuY2VzdG9yc0JbaV0gJiYgYW5jZXN0b3JzQVtpXSl7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGkgPT09IDAgPyBudWxsIDogYW5jZXN0b3JzQVtpIC0gMV07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBub2RlIGlzIGJlZm9yZSBnaXZlbiBub2RlLiBgZmFsc2VgIGlzIHJldHVybmVkIGlmIG5vZGVzIGFyZSBpbiBkaWZmZXJlbnQgdHJlZXMgKGZvciBleGFtcGxlLFxuXHQgKiBpbiBkaWZmZXJlbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fXMpLlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBOb2RlIHRvIGNvbXBhcmUgd2l0aC5cblx0ICovIGlzQmVmb3JlKG5vZGUpIHtcbiAgICAgICAgLy8gR2l2ZW4gbm9kZSBpcyBub3QgYmVmb3JlIHRoaXMgbm9kZSBpZiB0aGV5IGFyZSBzYW1lLlxuICAgICAgICBpZiAodGhpcyA9PSBub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIGBmYWxzZWAgaWYgaXQgaXMgaW1wb3NzaWJsZSB0byBjb21wYXJlIG5vZGVzLlxuICAgICAgICBpZiAodGhpcy5yb290ICE9PSBub2RlLnJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0aGlzUGF0aCA9IHRoaXMuZ2V0UGF0aCgpO1xuICAgICAgICBjb25zdCBub2RlUGF0aCA9IG5vZGUuZ2V0UGF0aCgpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlQXJyYXlzKHRoaXNQYXRoLCBub2RlUGF0aCk7XG4gICAgICAgIHN3aXRjaChyZXN1bHQpe1xuICAgICAgICAgICAgY2FzZSAncHJlZml4JzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGNhc2UgJ2V4dGVuc2lvbic6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1BhdGhbcmVzdWx0XSA8IG5vZGVQYXRoW3Jlc3VsdF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgd2hldGhlciB0aGlzIG5vZGUgaXMgYWZ0ZXIgZ2l2ZW4gbm9kZS4gYGZhbHNlYCBpcyByZXR1cm5lZCBpZiBub2RlcyBhcmUgaW4gZGlmZmVyZW50IHRyZWVzIChmb3IgZXhhbXBsZSxcblx0ICogaW4gZGlmZmVyZW50IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudH1zKS5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgTm9kZSB0byBjb21wYXJlIHdpdGguXG5cdCAqLyBpc0FmdGVyKG5vZGUpIHtcbiAgICAgICAgLy8gR2l2ZW4gbm9kZSBpcyBub3QgYmVmb3JlIHRoaXMgbm9kZSBpZiB0aGV5IGFyZSBzYW1lLlxuICAgICAgICBpZiAodGhpcyA9PSBub2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIGBmYWxzZWAgaWYgaXQgaXMgaW1wb3NzaWJsZSB0byBjb21wYXJlIG5vZGVzLlxuICAgICAgICBpZiAodGhpcy5yb290ICE9PSBub2RlLnJvb3QpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbiBvdGhlciBjYXNlcywganVzdCBjaGVjayBpZiB0aGUgYG5vZGVgIGlzIGJlZm9yZSwgYW5kIHJldHVybiB0aGUgb3Bwb3NpdGUuXG4gICAgICAgIHJldHVybiAhdGhpcy5pc0JlZm9yZShub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgbm9kZSBoYXMgYW4gYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5LlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhdHRyaWJ1dGUgdG8gY2hlY2suXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgaXMgc2V0IG9uIG5vZGUsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gaGFzQXR0cmlidXRlKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMuaGFzKGtleSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGFuIGF0dHJpYnV0ZSB2YWx1ZSBmb3IgZ2l2ZW4ga2V5IG9yIGB1bmRlZmluZWRgIGlmIHRoYXQgYXR0cmlidXRlIGlzIG5vdCBzZXQgb24gbm9kZS5cblx0ICpcblx0ICogQHBhcmFtIGtleSBLZXkgb2YgYXR0cmlidXRlIHRvIGxvb2sgZm9yLlxuXHQgKiBAcmV0dXJucyBBdHRyaWJ1dGUgdmFsdWUgb3IgYHVuZGVmaW5lZGAuXG5cdCAqLyBnZXRBdHRyaWJ1dGUoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdHRycy5nZXQoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgbm9kZSdzIGF0dHJpYnV0ZXMuXG5cdCAqXG5cdCAqIEF0dHJpYnV0ZXMgYXJlIHJldHVybmVkIGFzIGFycmF5cyBjb250YWluaW5nIHR3byBpdGVtcy4gRmlyc3Qgb25lIGlzIGF0dHJpYnV0ZSBrZXkgYW5kIHNlY29uZCBpcyBhdHRyaWJ1dGUgdmFsdWUuXG5cdCAqIFRoaXMgZm9ybWF0IGlzIGFjY2VwdGVkIGJ5IG5hdGl2ZSBgTWFwYCBvYmplY3QgYW5kIGFsc28gY2FuIGJlIHBhc3NlZCBpbiBgTm9kZWAgY29uc3RydWN0b3IuXG5cdCAqLyBnZXRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMuZW50cmllcygpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhpcyBub2RlJ3MgYXR0cmlidXRlIGtleXMuXG5cdCAqLyBnZXRBdHRyaWJ1dGVLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMua2V5cygpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgYE5vZGVgIHRvIHBsYWluIG9iamVjdCBhbmQgcmV0dXJucyBpdC5cblx0ICpcblx0ICogQHJldHVybnMgYE5vZGVgIGNvbnZlcnRlZCB0byBwbGFpbiBvYmplY3QuXG5cdCAqLyB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGpzb24gPSB7fTtcbiAgICAgICAgLy8gU2VyaWFsaXplcyBhdHRyaWJ1dGVzIHRvIHRoZSBvYmplY3QuXG4gICAgICAgIC8vIGF0dHJpYnV0ZXMgPSB7IGE6ICdmb28nLCBiOiAxLCBjOiB0cnVlIH0uXG4gICAgICAgIGlmICh0aGlzLl9hdHRycy5zaXplKSB7XG4gICAgICAgICAgICBqc29uLmF0dHJpYnV0ZXMgPSBBcnJheS5mcm9tKHRoaXMuX2F0dHJzKS5yZWR1Y2UoKHJlc3VsdCwgYXR0cik9PntcbiAgICAgICAgICAgICAgICByZXN1bHRbYXR0clswXV0gPSBhdHRyWzFdO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9LCB7fSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgY29weSBvZiB0aGlzIG5vZGUsIHRoYXQgaXMgYSBub2RlIHdpdGggZXhhY3RseSBzYW1lIGF0dHJpYnV0ZXMsIGFuZCByZXR1cm5zIGl0LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHJldHVybnMgTm9kZSB3aXRoIHNhbWUgYXR0cmlidXRlcyBhcyB0aGlzIG5vZGUuXG5cdCAqLyBfY2xvbmUoX2RlZXApIHtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX2F0dHJzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgdGhpcyBub2RlIGZyb20gaXRzIHBhcmVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI3JlbW92ZVxuXHQgKi8gX3JlbW92ZSgpIHtcbiAgICAgICAgdGhpcy5wYXJlbnQuX3JlbW92ZUNoaWxkcmVuKHRoaXMuaW5kZXgpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyBhdHRyaWJ1dGUgb24gdGhlIG5vZGUuIElmIGF0dHJpYnV0ZSB3aXRoIHRoZSBzYW1lIGtleSBhbHJlYWR5IGlzIHNldCwgaXQncyB2YWx1ZSBpcyBvdmVyd3JpdHRlbi5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjc2V0QXR0cmlidXRlXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhdHRyaWJ1dGUgdG8gc2V0LlxuXHQgKiBAcGFyYW0gdmFsdWUgQXR0cmlidXRlIHZhbHVlLlxuXHQgKi8gX3NldEF0dHJpYnV0ZShrZXksIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2F0dHJzLnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYWxsIGF0dHJpYnV0ZXMgZnJvbSB0aGUgbm9kZSBhbmQgc2V0cyBnaXZlbiBhdHRyaWJ1dGVzLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRBdHRyaWJ1dGVzXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gYXR0cnMgQXR0cmlidXRlcyB0byBzZXQuIFNlZSB7QGxpbmsgbW9kdWxlOnV0aWxzL3RvbWFwfnRvTWFwfSBmb3IgYSBsaXN0IG9mIGFjY2VwdGVkIHZhbHVlcy5cblx0ICovIF9zZXRBdHRyaWJ1dGVzVG8oYXR0cnMpIHtcbiAgICAgICAgdGhpcy5fYXR0cnMgPSB0b01hcChhdHRycyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFuIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBmcm9tIHRoZSBub2RlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNyZW1vdmVBdHRyaWJ1dGVcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBrZXkgS2V5IG9mIGF0dHJpYnV0ZSB0byByZW1vdmUuXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIHdhcyBzZXQgb24gdGhlIGVsZW1lbnQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX3JlbW92ZUF0dHJpYnV0ZShrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJzLmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhbGwgYXR0cmlidXRlcyBmcm9tIHRoZSBub2RlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNjbGVhckF0dHJpYnV0ZXNcblx0ICogQGludGVybmFsXG5cdCAqLyBfY2xlYXJBdHRyaWJ1dGVzKCkge1xuICAgICAgICB0aGlzLl9hdHRycy5jbGVhcigpO1xuICAgIH1cbn07XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5Ob2RlJDEucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnbm9kZScgfHwgdHlwZSA9PT0gJ21vZGVsOm5vZGUnO1xufTtcblxuLyoqXG4gKiBTZWxlY3Rpb24gaXMgYSBzZXQgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2VzfS4gSXQgaGFzIGEgZGlyZWN0aW9uIHNwZWNpZmllZCBieSBpdHNcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24jYW5jaG9yIGFuY2hvcn0gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24jZm9jdXMgZm9jdXN9XG4gKiAoaXQgY2FuIGJlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24jaXNCYWNrd2FyZCBmb3J3YXJkIG9yIGJhY2t3YXJkfSkuXG4gKiBBZGRpdGlvbmFsbHksIHNlbGVjdGlvbiBtYXkgaGF2ZSBpdHMgb3duIGF0dHJpYnV0ZXMgKHRoaW5rIOKAkyB3aGV0aGVyIHRleHQgdHlwZWQgaW4gaW4gdGhpcyBzZWxlY3Rpb25cbiAqIHNob3VsZCBoYXZlIHRob3NlIGF0dHJpYnV0ZXMg4oCTIGUuZy4gd2hldGhlciB5b3UgdHlwZSBhIGJvbGRlZCB0ZXh0KS5cbiAqLyBjbGFzcyBTZWxlY3Rpb24gZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKFR5cGVDaGVja2FibGUpIHtcbiAgICAvKipcblx0ICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGxhc3QgYWRkZWQgcmFuZ2Ugd2FzIGFkZGVkIGFzIGEgYmFja3dhcmQgb3IgZm9yd2FyZCByYW5nZS5cblx0ICovIF9sYXN0UmFuZ2VCYWNrd2FyZCA9IGZhbHNlO1xuICAgIC8qKlxuXHQgKiBMaXN0IG9mIGF0dHJpYnV0ZXMgc2V0IG9uIGN1cnJlbnQgc2VsZWN0aW9uLlxuXHQgKi8gX2F0dHJzID0gbmV3IE1hcCgpO1xuICAgIC8qKiBAaW50ZXJuYWwgKi8gX3JhbmdlcyA9IFtdO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHNlbGVjdGlvbiBpbnN0YW5jZSBiYXNlZCBvbiB0aGUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGFibGUgc2VsZWN0YWJsZX1cblx0ICogb3IgY3JlYXRlcyBhbiBlbXB0eSBzZWxlY3Rpb24gaWYgbm8gYXJndW1lbnRzIHdlcmUgcGFzc2VkLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBDcmVhdGVzIGVtcHR5IHNlbGVjdGlvbiB3aXRob3V0IHJhbmdlcy5cblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbigpO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcmFuZ2UuXG5cdCAqIGNvbnN0IHJhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFydCwgZW5kICk7XG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHJhbmdlICk7XG5cdCAqXG5cdCAqIC8vIENyZWF0ZXMgc2VsZWN0aW9uIGF0IHRoZSBnaXZlbiByYW5nZXNcblx0ICogY29uc3QgcmFuZ2VzID0gWyB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0MSwgZW5kMiApLCB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXIyLCBlbmQyICkgXTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcmFuZ2VzICk7XG5cdCAqXG5cdCAqIC8vIENyZWF0ZXMgc2VsZWN0aW9uIGZyb20gdGhlIG90aGVyIHNlbGVjdGlvbi5cblx0ICogLy8gTm90ZTogSXQgZG9lc24ndCBjb3B5IHNlbGVjdGlvbiBhdHRyaWJ1dGVzLlxuXHQgKiBjb25zdCBvdGhlclNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oKTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggb3RoZXJTZWxlY3Rpb24gKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBzZWxlY3Rpb24gZnJvbSB0aGUgZ2l2ZW4gZG9jdW1lbnQgc2VsZWN0aW9uLlxuXHQgKiAvLyBOb3RlOiBJdCBkb2Vzbid0IGNvcHkgc2VsZWN0aW9uIGF0dHJpYnV0ZXMuXG5cdCAqIGNvbnN0IGRvY3VtZW50U2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuXHQgKiBjb25zdCBzZWxlY3Rpb24gPSB3cml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBkb2N1bWVudFNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIHNlbGVjdGlvbiBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqIGNvbnN0IHBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoIHJvb3QsIHBhdGggKTtcblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcG9zaXRpb24gKTtcblx0ICpcblx0ICogLy8gQ3JlYXRlcyBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIG9mZnNldCBpbiB0aGUgZ2l2ZW4gZWxlbWVudC5cblx0ICogY29uc3QgcGFyYWdyYXBoID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYXJhZ3JhcGgnICk7XG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHBhcmFncmFwaCwgb2Zmc2V0ICk7XG5cdCAqXG5cdCAqIC8vIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IGVsZW1lbnR9IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlXG5cdCAqIC8vIGZpcnN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudCBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdCBjaGlsZCBvZiB0aGF0IGVsZW1lbnQuXG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHBhcmFncmFwaCwgJ2luJyApO1xuXHQgKlxuXHQgKiAvLyBDcmVhdGVzIGEgcmFuZ2Ugb24gYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIGl0ZW19IHdoaWNoIHN0YXJ0cyBiZWZvcmUgdGhlIGl0ZW0gYW5kIGVuZHNcblx0ICogLy8ganVzdCBhZnRlciB0aGUgaXRlbS5cblx0ICogY29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnb24nICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBTZWxlY3Rpb24ncyBjb25zdHJ1Y3RvciBhbGxvdyBwYXNzaW5nIGFkZGl0aW9uYWwgb3B0aW9ucyAoYCdiYWNrd2FyZCdgKSBhcyB0aGUgbGFzdCBhcmd1bWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gQ3JlYXRlcyBiYWNrd2FyZCBzZWxlY3Rpb24uXG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHJhbmdlLCB7IGJhY2t3YXJkOiB0cnVlIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gY29uc3RydWN0b3IoLi4uYXJncyl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5zZXRUbyguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2VsZWN0aW9uIGFuY2hvci4gQW5jaG9yIGlzIHRoZSBwb3NpdGlvbiBmcm9tIHdoaWNoIHRoZSBzZWxlY3Rpb24gd2FzIHN0YXJ0ZWQuIElmIGEgdXNlciBpcyBtYWtpbmcgYSBzZWxlY3Rpb25cblx0ICogYnkgZHJhZ2dpbmcgdGhlIG1vdXNlLCB0aGUgYW5jaG9yIGlzIHdoZXJlIHRoZSB1c2VyIHByZXNzZWQgdGhlIG1vdXNlIGJ1dHRvbiAodGhlIGJlZ2lubmluZyBvZiB0aGUgc2VsZWN0aW9uKS5cblx0ICpcblx0ICogQW5jaG9yIGFuZCB7QGxpbmsgI2ZvY3VzfSBkZWZpbmUgdGhlIGRpcmVjdGlvbiBvZiB0aGUgc2VsZWN0aW9uLCB3aGljaCBpcyBpbXBvcnRhbnRcblx0ICogd2hlbiBleHBhbmRpbmcvc2hyaW5raW5nIHNlbGVjdGlvbi4gVGhlIGZvY3VzIG1vdmVzLCB3aGlsZSB0aGUgYW5jaG9yIHNob3VsZCByZW1haW4gaW4gdGhlIHNhbWUgcGxhY2UuXG5cdCAqXG5cdCAqIEFuY2hvciBpcyBhbHdheXMgc2V0IHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSNzdGFydCBzdGFydH0gb3Jcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0gcG9zaXRpb24gb2YgdGhlIGxhc3Qgb2Ygc2VsZWN0aW9uJ3MgcmFuZ2VzLiBXaGV0aGVyIGl0IGlzXG5cdCAqIHRoZSBgc3RhcnRgIG9yIGBlbmRgIGRlcGVuZHMgb24gdGhlIHNwZWNpZmllZCBgb3B0aW9ucy5iYWNrd2FyZGAuIFNlZSB0aGUge0BsaW5rICNzZXRUbyBgc2V0VG8oKWB9IG1ldGhvZC5cblx0ICpcblx0ICogTWF5IGJlIHNldCB0byBgbnVsbGAgaWYgdGhlcmUgYXJlIG5vIHJhbmdlcyBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAc2VlICNmb2N1c1xuXHQgKi8gZ2V0IGFuY2hvcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Jhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCByYW5nZSA9IHRoaXMuX3Jhbmdlc1t0aGlzLl9yYW5nZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPyByYW5nZS5lbmQgOiByYW5nZS5zdGFydDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlbGVjdGlvbiBmb2N1cy4gRm9jdXMgaXMgdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gZW5kcy4gSWYgYSB1c2VyIGlzIG1ha2luZyBhIHNlbGVjdGlvblxuXHQgKiBieSBkcmFnZ2luZyB0aGUgbW91c2UsIHRoZSBmb2N1cyBpcyB3aGVyZSB0aGUgbW91c2UgY3Vyc29yIGlzLlxuXHQgKlxuXHQgKiBNYXkgYmUgc2V0IHRvIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEBzZWUgI2FuY2hvclxuXHQgKi8gZ2V0IGZvY3VzKCkge1xuICAgICAgICBpZiAodGhpcy5fcmFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gdGhpcy5fcmFuZ2VzW3RoaXMuX3Jhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA/IHJhbmdlLnN0YXJ0IDogcmFuZ2UuZW5kO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogV2hldGhlciB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZC4gU2VsZWN0aW9uIGlzIGNvbGxhcHNlZCB3aGVuIHRoZXJlIGlzIGV4YWN0bHkgb25lIHJhbmdlIGluIGl0XG5cdCAqIGFuZCBpdCBpcyBjb2xsYXBzZWQuXG5cdCAqLyBnZXQgaXNDb2xsYXBzZWQoKSB7XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IHRoaXMuX3Jhbmdlcy5sZW5ndGg7XG4gICAgICAgIGlmIChsZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYW5nZXNbMF0uaXNDb2xsYXBzZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIG51bWJlciBvZiByYW5nZXMgaW4gdGhlIHNlbGVjdGlvbi5cblx0ICovIGdldCByYW5nZUNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmFuZ2VzLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBzZWxlY3Rpb24ncyB7QGxpbmsgI2ZvY3VzfSBwcmVjZWRlcyB0aGUgc2VsZWN0aW9uJ3Mge0BsaW5rICNhbmNob3J9LlxuXHQgKi8gZ2V0IGlzQmFja3dhcmQoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5pc0NvbGxhcHNlZCAmJiB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoaXMgc2VsZWN0aW9uIGlzIGVxdWFsIHRvIHRoZSBnaXZlbiBzZWxlY3Rpb24uIFNlbGVjdGlvbnMgYXJlIGVxdWFsIGlmIHRoZXkgaGF2ZSB0aGUgc2FtZSBkaXJlY3Rpb25zLFxuXHQgKiB0aGUgc2FtZSBudW1iZXIgb2YgcmFuZ2VzIGFuZCBhbGwgcmFuZ2VzIGZyb20gb25lIHNlbGVjdGlvbiBlcXVhbCB0byByYW5nZXMgZnJvbSB0aGUgYW5vdGhlciBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBvdGhlclNlbGVjdGlvbiBTZWxlY3Rpb24gdG8gY29tcGFyZSB3aXRoLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgc2VsZWN0aW9ucyBhcmUgZXF1YWwsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gaXNFcXVhbChvdGhlclNlbGVjdGlvbikge1xuICAgICAgICBpZiAodGhpcy5yYW5nZUNvdW50ICE9IG90aGVyU2VsZWN0aW9uLnJhbmdlQ291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJhbmdlQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5hbmNob3IuaXNFcXVhbChvdGhlclNlbGVjdGlvbi5hbmNob3IpIHx8ICF0aGlzLmZvY3VzLmlzRXF1YWwob3RoZXJTZWxlY3Rpb24uZm9jdXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0aGlzUmFuZ2Ugb2YgdGhpcy5fcmFuZ2VzKXtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBvdGhlclJhbmdlIG9mIG90aGVyU2VsZWN0aW9uLl9yYW5nZXMpe1xuICAgICAgICAgICAgICAgIGlmICh0aGlzUmFuZ2UuaXNFcXVhbChvdGhlclJhbmdlKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZm91bmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhYmxlIG9iamVjdCB0aGF0IGl0ZXJhdGVzIG92ZXIgY29waWVzIG9mIHNlbGVjdGlvbiByYW5nZXMuXG5cdCAqLyAqZ2V0UmFuZ2VzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHRoaXMuX3Jhbmdlcyl7XG4gICAgICAgICAgICB5aWVsZCBuZXcgUmFuZ2UocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSBmaXJzdCByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBGaXJzdCByYW5nZSBpcyB0aGUgb25lIHdoaWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fSBwb3NpdGlvblxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNpc0JlZm9yZSBpcyBiZWZvcmV9IHN0YXJ0IHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXNcblx0ICogKG5vdCB0byBjb25mdXNlIHdpdGggdGhlIGZpcnN0IHJhbmdlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24pLlxuXHQgKlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICovIGdldEZpcnN0UmFuZ2UoKSB7XG4gICAgICAgIGxldCBmaXJzdCA9IG51bGw7XG4gICAgICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgdGhpcy5fcmFuZ2VzKXtcbiAgICAgICAgICAgIGlmICghZmlyc3QgfHwgcmFuZ2Uuc3RhcnQuaXNCZWZvcmUoZmlyc3Quc3RhcnQpKSB7XG4gICAgICAgICAgICAgICAgZmlyc3QgPSByYW5nZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlyc3QgPyBuZXcgUmFuZ2UoZmlyc3Quc3RhcnQsIGZpcnN0LmVuZCkgOiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGxhc3QgcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbi5cblx0ICogTGFzdCByYW5nZSBpcyB0aGUgb25lIHdoaWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlI2VuZCBlbmR9IHBvc2l0aW9uXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI2lzQWZ0ZXIgaXMgYWZ0ZXJ9IGVuZCBwb3NpdGlvbiBvZiBhbGwgb3RoZXIgcmFuZ2VzIChub3QgdG8gY29uZnVzZSB3aXRoIHRoZSByYW5nZSBtb3N0XG5cdCAqIHJlY2VudGx5IGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24pLlxuXHQgKlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICovIGdldExhc3RSYW5nZSgpIHtcbiAgICAgICAgbGV0IGxhc3QgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHRoaXMuX3Jhbmdlcyl7XG4gICAgICAgICAgICBpZiAoIWxhc3QgfHwgcmFuZ2UuZW5kLmlzQWZ0ZXIobGFzdC5lbmQpKSB7XG4gICAgICAgICAgICAgICAgbGFzdCA9IHJhbmdlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsYXN0ID8gbmV3IFJhbmdlKGxhc3Quc3RhcnQsIGxhc3QuZW5kKSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBmaXJzdCBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBGaXJzdCBwb3NpdGlvbiBpcyB0aGUgcG9zaXRpb24gdGhhdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNpc0JlZm9yZSBpcyBiZWZvcmV9XG5cdCAqIGFueSBvdGhlciBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICovIGdldEZpcnN0UG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5nZXRGaXJzdFJhbmdlKCk7XG4gICAgICAgIHJldHVybiBmaXJzdCA/IGZpcnN0LnN0YXJ0LmNsb25lKCkgOiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgbGFzdCBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBMYXN0IHBvc2l0aW9uIGlzIHRoZSBwb3NpdGlvbiB0aGF0IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI2lzQWZ0ZXIgaXMgYWZ0ZXJ9XG5cdCAqIGFueSBvdGhlciBwb3NpdGlvbiBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICovIGdldExhc3RQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3QgbGFzdFJhbmdlID0gdGhpcy5nZXRMYXN0UmFuZ2UoKTtcbiAgICAgICAgcmV0dXJuIGxhc3RSYW5nZSA/IGxhc3RSYW5nZS5lbmQuY2xvbmUoKSA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHRoaXMgc2VsZWN0aW9uJ3MgcmFuZ2VzIGFuZCBkaXJlY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbiBiYXNlZCBvbiB0aGUgZ2l2ZW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGFibGUgc2VsZWN0YWJsZX0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIFJlbW92ZXMgYWxsIHNlbGVjdGlvbidzIHJhbmdlcy5cblx0ICogc2VsZWN0aW9uLnNldFRvKCBudWxsICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgc2VsZWN0aW9uIHRvIHRoZSBnaXZlbiByYW5nZS5cblx0ICogY29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTtcblx0ICogc2VsZWN0aW9uLnNldFRvKCByYW5nZSApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiB0byBnaXZlbiByYW5nZXMuXG5cdCAqIGNvbnN0IHJhbmdlcyA9IFsgd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFydDEsIGVuZDIgKSwgd3JpdGVyLmNyZWF0ZVJhbmdlKCBzdGFyMiwgZW5kMiApIF07XG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcmFuZ2VzICk7XG5cdCAqXG5cdCAqIC8vIFNldHMgc2VsZWN0aW9uIHRvIG90aGVyIHNlbGVjdGlvbi5cblx0ICogLy8gTm90ZTogSXQgZG9lc24ndCBjb3B5IHNlbGVjdGlvbiBhdHRyaWJ1dGVzLlxuXHQgKiBjb25zdCBvdGhlclNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oKTtcblx0ICogc2VsZWN0aW9uLnNldFRvKCBvdGhlclNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIHNlbGVjdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgc2VsZWN0aW9uLlxuXHQgKiAvLyBOb3RlOiBJdCBkb2Vzbid0IGNvcHkgc2VsZWN0aW9uIGF0dHJpYnV0ZXMuXG5cdCAqIGNvbnN0IGRvY3VtZW50U2VsZWN0aW9uID0gbmV3IERvY3VtZW50U2VsZWN0aW9uKCBkb2MgKTtcblx0ICogc2VsZWN0aW9uLnNldFRvKCBkb2N1bWVudFNlbGVjdGlvbiApO1xuXHQgKlxuXHQgKiAvLyBTZXRzIGNvbGxhcHNlZCBzZWxlY3Rpb24gYXQgdGhlIGdpdmVuIHBvc2l0aW9uLlxuXHQgKiBjb25zdCBwb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkZyb21QYXRoKCByb290LCBwYXRoICk7XG5cdCAqIHNlbGVjdGlvbi5zZXRUbyggcG9zaXRpb24gKTtcblx0ICpcblx0ICogLy8gU2V0cyBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IHRoZSBwb3NpdGlvbiBvZiB0aGUgZ2l2ZW4gbm9kZSBhbmQgYW4gb2Zmc2V0LlxuXHQgKiBzZWxlY3Rpb24uc2V0VG8oIHBhcmFncmFwaCwgb2Zmc2V0ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2UgaW5zaWRlIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB3aGljaCBzdGFydHMgYmVmb3JlIHRoZSBmaXJzdCBjaGlsZCBvZlxuIFx0ICogdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2VsZWN0aW9uLnNldFRvKCBwYXJhZ3JhcGgsICdpbicgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSBvbiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gaXRlbX0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgaXRlbSBhbmQgZW5kcyBqdXN0IGFmdGVyIHRoZSBpdGVtLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzZWxlY3Rpb24uc2V0VG8oIHBhcmFncmFwaCwgJ29uJyApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogYFNlbGVjdGlvbiNzZXRUbygpYCcgbWV0aG9kIGFsbG93IHBhc3NpbmcgYWRkaXRpb25hbCBvcHRpb25zIChgYmFja3dhcmRgKSBhcyB0aGUgbGFzdCBhcmd1bWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gU2V0cyBiYWNrd2FyZCBzZWxlY3Rpb24uXG5cdCAqIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24oIHJhbmdlLCB7IGJhY2t3YXJkOiB0cnVlIH0gKTtcblx0ICogYGBgXG5cdCAqLyBzZXRUbyguLi5hcmdzKSB7XG4gICAgICAgIGxldCBbc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCwgb3B0aW9uc10gPSBhcmdzO1xuICAgICAgICBpZiAodHlwZW9mIHBsYWNlT3JPZmZzZXQgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBwbGFjZU9yT2Zmc2V0O1xuICAgICAgICAgICAgcGxhY2VPck9mZnNldCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZWN0YWJsZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtdKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoc2VsZWN0YWJsZS5nZXRSYW5nZXMoKSwgc2VsZWN0YWJsZS5pc0JhY2t3YXJkKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlICYmIHR5cGVvZiBzZWxlY3RhYmxlLmdldFJhbmdlcyA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAvLyBXZSBhc3N1bWUgdGhhdCB0aGUgc2VsZWN0YWJsZSBpcyBhIERvY3VtZW50U2VsZWN0aW9uLlxuICAgICAgICAgICAgLy8gSXQgY2FuJ3QgYmUgaW1wb3J0ZWQgaGVyZSwgYmVjYXVzZSBpdCB3b3VsZCBsZWFkIHRvIGNpcmN1bGFyIGltcG9ydHMuXG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoc2VsZWN0YWJsZS5nZXRSYW5nZXMoKSwgc2VsZWN0YWJsZS5pc0JhY2t3YXJkKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlIGluc3RhbmNlb2YgUmFuZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldFJhbmdlcyhbXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZVxuICAgICAgICAgICAgXSwgISFvcHRpb25zICYmICEhb3B0aW9ucy5iYWNrd2FyZCk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIFBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9zZXRSYW5nZXMoW1xuICAgICAgICAgICAgICAgIG5ldyBSYW5nZShzZWxlY3RhYmxlKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIE5vZGUkMSkge1xuICAgICAgICAgICAgY29uc3QgYmFja3dhcmQgPSAhIW9wdGlvbnMgJiYgISFvcHRpb25zLmJhY2t3YXJkO1xuICAgICAgICAgICAgbGV0IHJhbmdlO1xuICAgICAgICAgICAgaWYgKHBsYWNlT3JPZmZzZXQgPT0gJ2luJykge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gUmFuZ2UuX2NyZWF0ZUluKHNlbGVjdGFibGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwbGFjZU9yT2Zmc2V0ID09ICdvbicpIHtcbiAgICAgICAgICAgICAgICByYW5nZSA9IFJhbmdlLl9jcmVhdGVPbihzZWxlY3RhYmxlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGxhY2VPck9mZnNldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSBuZXcgUmFuZ2UoUG9zaXRpb24uX2NyZWF0ZUF0KHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIHNlbGVjdGlvbi5zZXRUbyByZXF1aXJlcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSBub2RlLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgbW9kZWwtc2VsZWN0aW9uLXNldHRvLXJlcXVpcmVkLXNlY29uZC1wYXJhbWV0ZXJcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1zZWxlY3Rpb24tc2V0dG8tcmVxdWlyZWQtc2Vjb25kLXBhcmFtZXRlcicsIFtcbiAgICAgICAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0YWJsZVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fc2V0UmFuZ2VzKFtcbiAgICAgICAgICAgICAgICByYW5nZVxuICAgICAgICAgICAgXSwgYmFja3dhcmQpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzSXRlcmFibGUoc2VsZWN0YWJsZSkpIHtcbiAgICAgICAgICAgIC8vIFdlIGFzc3VtZSB0aGF0IHRoZSBzZWxlY3RhYmxlIGlzIGFuIGl0ZXJhYmxlIG9mIHJhbmdlcy5cbiAgICAgICAgICAgIHRoaXMuX3NldFJhbmdlcyhzZWxlY3RhYmxlLCBvcHRpb25zICYmICEhb3B0aW9ucy5iYWNrd2FyZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBzZXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgZ2l2ZW4gcGxhY2UuXG5cdFx0XHQgKlxuXHRcdFx0ICogSW52YWxpZCBwYXJhbWV0ZXJzIHdlcmUgc3BlY2lmaWVkIHdoZW4gc2V0dGluZyB0aGUgc2VsZWN0aW9uLiBDb21tb24gaXNzdWVzOlxuXHRcdFx0ICpcblx0XHRcdCAqICogQSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0cHJveHl+VGV4dFByb3h5fSBpbnN0YW5jZSB3YXMgcGFzc2VkIGluc3RlYWQgb2Zcblx0XHRcdCAqIGEgcmVhbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0flRleHR9LlxuXHRcdFx0ICogKiBWaWV3IG5vZGVzIHdlcmUgcGFzc2VkIGluc3RlYWQgb2YgbW9kZWwgbm9kZXMuXG5cdFx0XHQgKiAqIGBudWxsYC9gdW5kZWZpbmVkYCB3YXMgcGFzc2VkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb2RlbC1zZWxlY3Rpb24tc2V0dG8tbm90LXNlbGVjdGFibGVcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtc2VsZWN0aW9uLXNldHRvLW5vdC1zZWxlY3RhYmxlJywgW1xuICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAgc2VsZWN0YWJsZVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlcGxhY2VzIGFsbCByYW5nZXMgdGhhdCB3ZXJlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24gd2l0aCBnaXZlbiBhcnJheSBvZiByYW5nZXMuIExhc3QgcmFuZ2Ugb2YgdGhlIGFycmF5XG5cdCAqIGlzIHRyZWF0ZWQgbGlrZSB0aGUgbGFzdCBhZGRlZCByYW5nZSBhbmQgaXMgdXNlZCB0byBzZXQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiNhbmNob3J9IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uI2ZvY3VzfS4gQWNjZXB0cyBhIGZsYWcgZGVzY3JpYmluZyBpbiB3aGljaCBkaXJlY3Rpb24gdGhlIHNlbGVjdGlvbiBpcyBtYWRlLlxuXHQgKlxuXHQgKiBAZmlyZXMgY2hhbmdlOnJhbmdlXG5cdCAqIEBwYXJhbSBuZXdSYW5nZXMgUmFuZ2VzIHRvIHNldC5cblx0ICogQHBhcmFtIGlzTGFzdEJhY2t3YXJkIEZsYWcgZGVzY3JpYmluZyBpZiBsYXN0IGFkZGVkIHJhbmdlIHdhcyBzZWxlY3RlZCBmb3J3YXJkIC0gZnJvbSBzdGFydCB0byBlbmQgKGBmYWxzZWApXG5cdCAqIG9yIGJhY2t3YXJkIC0gZnJvbSBlbmQgdG8gc3RhcnQgKGB0cnVlYCkuXG5cdCAqLyBfc2V0UmFuZ2VzKG5ld1JhbmdlcywgaXNMYXN0QmFja3dhcmQgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCByYW5nZXMgPSBBcnJheS5mcm9tKG5ld1Jhbmdlcyk7XG4gICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlcmUgaXMgYW55IHJhbmdlIGluIG5ldyByYW5nZXMgc2V0IHRoYXQgaXMgZGlmZmVyZW50IHRoYW4gYWxsIGFscmVhZHkgYWRkZWQgcmFuZ2VzLlxuICAgICAgICBjb25zdCBhbnlOZXdSYW5nZSA9IHJhbmdlcy5zb21lKChuZXdSYW5nZSk9PntcbiAgICAgICAgICAgIGlmICghKG5ld1JhbmdlIGluc3RhbmNlb2YgUmFuZ2UpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFNlbGVjdGlvbiByYW5nZSBzZXQgdG8gYW4gb2JqZWN0IHRoYXQgaXMgbm90IGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlfS5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogT25seSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZX0gaW5zdGFuY2VzIGNhbiBiZSB1c2VkIHRvIHNldCBhIHNlbGVjdGlvbi5cblx0XHRcdFx0ICogQ29tbW9uIG1pc3Rha2VzIGxlYWRpbmcgdG8gdGhpcyBlcnJvciBhcmU6XG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqICogdXNpbmcgRE9NIGBSYW5nZWAgb2JqZWN0LFxuXHRcdFx0XHQgKiAqIGluY29ycmVjdCBDS0VkaXRvciA1IGluc3RhbGxhdGlvbiB3aXRoIG11bHRpcGxlIGBja2VkaXRvcjUtZW5naW5lYCBwYWNrYWdlcyBoYXZpbmcgZGlmZmVyZW50IHZlcnNpb25zLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgbW9kZWwtc2VsZWN0aW9uLXNldC1yYW5nZXMtbm90LXJhbmdlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtc2VsZWN0aW9uLXNldC1yYW5nZXMtbm90LXJhbmdlJywgW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgICAgICBuZXdSYW5nZXNcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYW5nZXMuZXZlcnkoKG9sZFJhbmdlKT0+e1xuICAgICAgICAgICAgICAgIHJldHVybiAhb2xkUmFuZ2UuaXNFcXVhbChuZXdSYW5nZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIERvbid0IGRvIGFueXRoaW5nIGlmIG5vdGhpbmcgY2hhbmdlZC5cbiAgICAgICAgaWYgKHJhbmdlcy5sZW5ndGggPT09IHRoaXMuX3Jhbmdlcy5sZW5ndGggJiYgIWFueU5ld1JhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVwbGFjZUFsbFJhbmdlcyhyYW5nZXMpO1xuICAgICAgICB0aGlzLl9sYXN0UmFuZ2VCYWNrd2FyZCA9ICEhaXNMYXN0QmFja3dhcmQ7XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOnJhbmdlJywge1xuICAgICAgICAgICAgZGlyZWN0Q2hhbmdlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogTW92ZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiNmb2N1c30gdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbi5cblx0ICpcblx0ICogVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgaW4gdGhlIHNhbWUgZm9ybSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVBvc2l0aW9uQXQgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoKX0gcGFyYW1ldGVycy5cblx0ICpcblx0ICogQGZpcmVzIGNoYW5nZTpyYW5nZVxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBvciBvbmUgb2YgdGhlIGZsYWdzLiBVc2VkIG9ubHkgd2hlbiBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbX0uXG5cdCAqLyBzZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgICAgIGlmICh0aGlzLmFuY2hvciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3Qgc2V0IHNlbGVjdGlvbiBmb2N1cyBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtc2VsZWN0aW9uLXNldGZvY3VzLW5vLXJhbmdlc1xuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1zZWxlY3Rpb24tc2V0Zm9jdXMtbm8tcmFuZ2VzJywgW1xuICAgICAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAgICAgaXRlbU9yUG9zaXRpb25cbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5ld0ZvY3VzID0gUG9zaXRpb24uX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgICAgICBpZiAobmV3Rm9jdXMuY29tcGFyZVdpdGgodGhpcy5mb2N1cykgPT0gJ3NhbWUnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYW5jaG9yID0gdGhpcy5hbmNob3I7XG4gICAgICAgIGlmICh0aGlzLl9yYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9wb3BSYW5nZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdGb2N1cy5jb21wYXJlV2l0aChhbmNob3IpID09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICB0aGlzLl9wdXNoUmFuZ2UobmV3IFJhbmdlKG5ld0ZvY3VzLCBhbmNob3IpKTtcbiAgICAgICAgICAgIHRoaXMuX2xhc3RSYW5nZUJhY2t3YXJkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3B1c2hSYW5nZShuZXcgUmFuZ2UoYW5jaG9yLCBuZXdGb2N1cykpO1xuICAgICAgICAgICAgdGhpcy5fbGFzdFJhbmdlQmFja3dhcmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZTpyYW5nZScsIHtcbiAgICAgICAgICAgIGRpcmVjdENoYW5nZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgYW4gYXR0cmlidXRlIHZhbHVlIGZvciBnaXZlbiBrZXkgb3IgYHVuZGVmaW5lZGAgaWYgdGhhdCBhdHRyaWJ1dGUgaXMgbm90IHNldCBvbiB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhdHRyaWJ1dGUgdG8gbG9vayBmb3IuXG5cdCAqIEByZXR1cm5zIEF0dHJpYnV0ZSB2YWx1ZSBvciBgdW5kZWZpbmVkYC5cblx0ICovIGdldEF0dHJpYnV0ZShrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJzLmdldChrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBpdGVyYWJsZSB0aGF0IGl0ZXJhdGVzIG92ZXIgdGhpcyBzZWxlY3Rpb24ncyBhdHRyaWJ1dGVzLlxuXHQgKlxuXHQgKiBBdHRyaWJ1dGVzIGFyZSByZXR1cm5lZCBhcyBhcnJheXMgY29udGFpbmluZyB0d28gaXRlbXMuIEZpcnN0IG9uZSBpcyBhdHRyaWJ1dGUga2V5IGFuZCBzZWNvbmQgaXMgYXR0cmlidXRlIHZhbHVlLlxuXHQgKiBUaGlzIGZvcm1hdCBpcyBhY2NlcHRlZCBieSBuYXRpdmUgYE1hcGAgb2JqZWN0IGFuZCBhbHNvIGNhbiBiZSBwYXNzZWQgaW4gYE5vZGVgIGNvbnN0cnVjdG9yLlxuXHQgKi8gZ2V0QXR0cmlidXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJzLmVudHJpZXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmFibGUgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgc2VsZWN0aW9uJ3MgYXR0cmlidXRlIGtleXMuXG5cdCAqLyBnZXRBdHRyaWJ1dGVLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXR0cnMua2V5cygpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBzZWxlY3Rpb24gaGFzIGFuIGF0dHJpYnV0ZSBmb3IgZ2l2ZW4ga2V5LlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhdHRyaWJ1dGUgdG8gY2hlY2suXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgaXMgc2V0IG9uIHNlbGVjdGlvbiwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBoYXNBdHRyaWJ1dGUoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdHRycy5oYXMoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYW4gYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IGZyb20gdGhlIHNlbGVjdGlvbi5cblx0ICpcblx0ICogSWYgZ2l2ZW4gYXR0cmlidXRlIHdhcyBzZXQgb24gdGhlIHNlbGVjdGlvbiwgZmlyZXMgdGhlIHtAbGluayAjZXZlbnQ6Y2hhbmdlOnJhbmdlfSBldmVudCB3aXRoXG5cdCAqIHJlbW92ZWQgYXR0cmlidXRlIGtleS5cblx0ICpcblx0ICogQGZpcmVzIGNoYW5nZTphdHRyaWJ1dGVcblx0ICogQHBhcmFtIGtleSBLZXkgb2YgYXR0cmlidXRlIHRvIHJlbW92ZS5cblx0ICovIHJlbW92ZUF0dHJpYnV0ZShrZXkpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzQXR0cmlidXRlKGtleSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2F0dHJzLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2U6YXR0cmlidXRlJywge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUtleXM6IFtcbiAgICAgICAgICAgICAgICAgICAga2V5XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBkaXJlY3RDaGFuZ2U6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIGF0dHJpYnV0ZSBvbiB0aGUgc2VsZWN0aW9uLiBJZiBhdHRyaWJ1dGUgd2l0aCB0aGUgc2FtZSBrZXkgYWxyZWFkeSBpcyBzZXQsIGl0J3MgdmFsdWUgaXMgb3ZlcndyaXR0ZW4uXG5cdCAqXG5cdCAqIElmIHRoZSBhdHRyaWJ1dGUgdmFsdWUgaGFzIGNoYW5nZWQsIGZpcmVzIHRoZSB7QGxpbmsgI2V2ZW50OmNoYW5nZTpyYW5nZX0gZXZlbnQgd2l0aFxuXHQgKiB0aGUgYXR0cmlidXRlIGtleS5cblx0ICpcblx0ICogQGZpcmVzIGNoYW5nZTphdHRyaWJ1dGVcblx0ICogQHBhcmFtIGtleSBLZXkgb2YgYXR0cmlidXRlIHRvIHNldC5cblx0ICogQHBhcmFtIHZhbHVlIEF0dHJpYnV0ZSB2YWx1ZS5cblx0ICovIHNldEF0dHJpYnV0ZShrZXksIHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLmdldEF0dHJpYnV0ZShrZXkpICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fYXR0cnMuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2U6YXR0cmlidXRlJywge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUtleXM6IFtcbiAgICAgICAgICAgICAgICAgICAga2V5XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBkaXJlY3RDaGFuZ2U6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBzZWxlY3RlZCBlbGVtZW50LiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgRWxlbWVudH0gaXMgY29uc2lkZXJlZCBhcyBzZWxlY3RlZCBpZiB0aGVyZSBpcyBvbmx5XG5cdCAqIG9uZSByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLCBhbmQgdGhhdCByYW5nZSBjb250YWlucyBleGFjdGx5IG9uZSBlbGVtZW50LlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzZWxlY3RlZCBlbGVtZW50LlxuXHQgKi8gZ2V0U2VsZWN0ZWRFbGVtZW50KCkge1xuICAgICAgICBpZiAodGhpcy5yYW5nZUNvdW50ICE9PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaXJzdFJhbmdlKCkuZ2V0Q29udGFpbmVkRWxlbWVudCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBlbGVtZW50cyBvZiB0eXBlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNCbG9jayBcImJsb2NrXCJ9IHRvdWNoZWQgYnkgdGhlIHNlbGVjdGlvbi5cblx0ICpcblx0ICogVGhpcyBtZXRob2QncyByZXN1bHQgY2FuIGJlIHVzZWQgZm9yIGV4YW1wbGUgdG8gYXBwbHkgYmxvY2sgc3R5bGluZyB0byBhbGwgYmxvY2tzIGNvdmVyZWQgYnkgdGhpcyBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqICoqTm90ZToqKiBgZ2V0U2VsZWN0ZWRCbG9ja3MoKWAgcmV0dXJucyBibG9ja3MgdGhhdCBhcmUgbmVzdGVkIGluIG90aGVyIG5vbi1ibG9jayBlbGVtZW50c1xuXHQgKiBidXQgd2lsbCBub3QgcmV0dXJuIGJsb2NrcyBuZXN0ZWQgaW4gb3RoZXIgYmxvY2tzLlxuXHQgKlxuXHQgKiBJbiB0aGlzIGNhc2UgdGhlIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGV4YWN0bHkgYWxsIDMgcGFyYWdyYXBocyAobm90ZTogYDxibG9ja1F1b3RlPmAgaXMgbm90IGEgYmxvY2sgaXRzZWxmKTpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDxwYXJhZ3JhcGg+W2E8L3BhcmFncmFwaD5cblx0ICogPGJsb2NrUXVvdGU+XG5cdCAqIFx0PHBhcmFncmFwaD5iPC9wYXJhZ3JhcGg+XG5cdCAqIDwvYmxvY2tRdW90ZT5cblx0ICogPHBhcmFncmFwaD5jXWQ8L3BhcmFncmFwaD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEluIHRoaXMgY2FzZSB0aGUgcGFyYWdyYXBoIHdpbGwgYWxzbyBiZSByZXR1cm5lZCwgZGVzcGl0ZSB0aGUgY29sbGFwc2VkIHNlbGVjdGlvbjpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDxwYXJhZ3JhcGg+W11hPC9wYXJhZ3JhcGg+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbiBzdWNoIGEgc2NlbmFyaW8sIGhvd2V2ZXIsIG9ubHkgYmxvY2tzIEEsIEIgJiBFIHdpbGwgYmUgcmV0dXJuZWQgYXMgYmxvY2tzIEMgJiBEIGFyZSBuZXN0ZWQgaW4gYmxvY2sgQjpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIFs8YmxvY2tBPjwvYmxvY2tBPlxuXHQgKiA8YmxvY2tCPlxuXHQgKiBcdDxibG9ja0M+PC9ibG9ja0M+XG5cdCAqIFx0PGJsb2NrRD48L2Jsb2NrRD5cblx0ICogPC9ibG9ja0I+XG5cdCAqIDxibG9ja0U+PC9ibG9ja0U+XVxuXHQgKiBgYGBcblx0ICpcblx0ICogSWYgdGhlIHNlbGVjdGlvbiBpcyBpbnNpZGUgYSBibG9jayBhbGwgdGhlIGlubmVyIGJsb2NrcyAoQSAmIEIpIGFyZSByZXR1cm5lZDpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDxibG9jaz5cblx0ICogXHQ8YmxvY2tBPlthPC9ibG9ja0E+XG5cdCAqIFx0PGJsb2NrQj5iXTwvYmxvY2tCPlxuXHQgKiA8L2Jsb2NrPlxuXHQgKiBgYGBcblx0ICpcblx0ICogKipTcGVjaWFsIGNhc2UqKjogU2VsZWN0aW9uIGlnbm9yZXMgZmlyc3QgYW5kL29yIGxhc3QgYmxvY2tzIGlmIG5vdGhpbmcgKGZyb20gdXNlciBwZXJzcGVjdGl2ZSkgaXMgc2VsZWN0ZWQgaW4gdGhlbS5cblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIC8vIFNlbGVjdGlvbiBlbmRzIGFuZCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsYXN0IGJsb2NrLlxuXHQgKiA8cGFyYWdyYXBoPlthPC9wYXJhZ3JhcGg+XG5cdCAqIDxwYXJhZ3JhcGg+YjwvcGFyYWdyYXBoPlxuXHQgKiA8cGFyYWdyYXBoPl1jPC9wYXJhZ3JhcGg+IC8vIFRoaXMgYmxvY2sgd2lsbCBub3QgYmUgcmV0dXJuZWRcblx0ICpcblx0ICogLy8gU2VsZWN0aW9uIGJlZ2lucyBhdCB0aGUgZW5kIG9mIHRoZSBmaXJzdCBibG9jay5cblx0ICogPHBhcmFncmFwaD5hWzwvcGFyYWdyYXBoPiAvLyBUaGlzIGJsb2NrIHdpbGwgbm90IGJlIHJldHVybmVkXG5cdCAqIDxwYXJhZ3JhcGg+YjwvcGFyYWdyYXBoPlxuXHQgKiA8cGFyYWdyYXBoPmNdPC9wYXJhZ3JhcGg+XG5cdCAqXG5cdCAqIC8vIFNlbGVjdGlvbiBiZWdpbmdzIGF0IHRoZSBlbmQgb2YgdGhlIGZpcnN0IGJsb2NrIGFuZCBlbmRzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGxhc3QgYmxvY2suXG5cdCAqIDxwYXJhZ3JhcGg+YVs8L3BhcmFncmFwaD4gLy8gVGhpcyBibG9jayB3aWxsIG5vdCBiZSByZXR1cm5lZFxuXHQgKiA8cGFyYWdyYXBoPmI8L3BhcmFncmFwaD5cblx0ICogPHBhcmFncmFwaD5dYzwvcGFyYWdyYXBoPiAvLyBUaGlzIGJsb2NrIHdpbGwgbm90IGJlIHJldHVybmVkXG5cdCAqIGBgYFxuXHQgKi8gKmdldFNlbGVjdGVkQmxvY2tzKCkge1xuICAgICAgICBjb25zdCB2aXNpdGVkID0gbmV3IFdlYWtTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLmdldFJhbmdlcygpKXtcbiAgICAgICAgICAgIC8vIEdldCBzdGFydCBibG9jayBvZiByYW5nZSBpbiBjYXNlIG9mIGEgY29sbGFwc2VkIHJhbmdlLlxuICAgICAgICAgICAgY29uc3Qgc3RhcnRCbG9jayA9IGdldFBhcmVudEJsb2NrJDEocmFuZ2Uuc3RhcnQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgaWYgKGlzU3RhcnRCbG9ja1NlbGVjdGVkKHN0YXJ0QmxvY2ssIHJhbmdlKSkge1xuICAgICAgICAgICAgICAgIHlpZWxkIHN0YXJ0QmxvY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0cmVld2Fsa2VyID0gcmFuZ2UuZ2V0V2Fsa2VyKCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHRyZWV3YWxrZXIpe1xuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2NrID0gdmFsdWUuaXRlbTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUudHlwZSA9PSAnZWxlbWVudEVuZCcgJiYgaXNVbnZpc2l0ZWRUb3BCbG9jayhibG9jaywgdmlzaXRlZCwgcmFuZ2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGJsb2NrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUudHlwZSA9PSAnZWxlbWVudFN0YXJ0JyAmJiBibG9jay5pcygnbW9kZWw6ZWxlbWVudCcpICYmIGJsb2NrLnJvb3QuZG9jdW1lbnQubW9kZWwuc2NoZW1hLmlzQmxvY2soYmxvY2spKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyZWV3YWxrZXIuanVtcFRvKFBvc2l0aW9uLl9jcmVhdGVBdChibG9jaywgJ2VuZCcpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBlbmRCbG9jayA9IGdldFBhcmVudEJsb2NrJDEocmFuZ2UuZW5kLCB2aXNpdGVkKTtcbiAgICAgICAgICAgIGlmIChpc0VuZEJsb2NrU2VsZWN0ZWQoZW5kQmxvY2ssIHJhbmdlKSkge1xuICAgICAgICAgICAgICAgIHlpZWxkIGVuZEJsb2NrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgc2VsZWN0aW9uIGNvbnRhaW5zIHRoZSBlbnRpcmUgY29udGVudCBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4gVGhpcyBtZWFucyB0aGF0IHNlbGVjdGlvbiBtdXN0IHN0YXJ0XG5cdCAqIGF0IGEgcG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jaXNUb3VjaGluZyB0b3VjaGluZ30gdGhlIGVsZW1lbnQncyBzdGFydCBhbmQgZW5kcyBhdCBwb3NpdGlvblxuXHQgKiB0b3VjaGluZyB0aGUgZWxlbWVudCdzIGVuZC5cblx0ICpcblx0ICogQnkgZGVmYXVsdCwgdGhpcyBtZXRob2Qgd2lsbCBjaGVjayB3aGV0aGVyIHRoZSBlbnRpcmUgY29udGVudCBvZiB0aGUgc2VsZWN0aW9uJ3MgY3VycmVudCByb290IGlzIHNlbGVjdGVkLlxuXHQgKiBVc2VmdWwgdG8gY2hlY2sgaWYgZS5nLiB0aGUgdXNlciBoYXMganVzdCBwcmVzc2VkIDxrYmQ+Q3RybDwva2JkPiArIDxrYmQ+QTwva2JkPi5cblx0ICovIGNvbnRhaW5zRW50aXJlQ29udGVudChlbGVtZW50ID0gdGhpcy5hbmNob3Iucm9vdCkge1xuICAgICAgICBjb25zdCBsaW1pdFN0YXJ0UG9zaXRpb24gPSBQb3NpdGlvbi5fY3JlYXRlQXQoZWxlbWVudCwgMCk7XG4gICAgICAgIGNvbnN0IGxpbWl0RW5kUG9zaXRpb24gPSBQb3NpdGlvbi5fY3JlYXRlQXQoZWxlbWVudCwgJ2VuZCcpO1xuICAgICAgICByZXR1cm4gbGltaXRTdGFydFBvc2l0aW9uLmlzVG91Y2hpbmcodGhpcy5nZXRGaXJzdFBvc2l0aW9uKCkpICYmIGxpbWl0RW5kUG9zaXRpb24uaXNUb3VjaGluZyh0aGlzLmdldExhc3RQb3NpdGlvbigpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgZ2l2ZW4gcmFuZ2UgdG8gaW50ZXJuYWwge0BsaW5rICNfcmFuZ2VzIHJhbmdlcyBhcnJheX0uIFRocm93cyBhbiBlcnJvclxuXHQgKiBpZiBnaXZlbiByYW5nZSBpcyBpbnRlcnNlY3Rpbmcgd2l0aCBhbnkgcmFuZ2UgdGhhdCBpcyBhbHJlYWR5IHN0b3JlZCBpbiB0aGlzIHNlbGVjdGlvbi5cblx0ICovIF9wdXNoUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgdGhpcy5fY2hlY2tSYW5nZShyYW5nZSk7XG4gICAgICAgIHRoaXMuX3Jhbmdlcy5wdXNoKG5ldyBSYW5nZShyYW5nZS5zdGFydCwgcmFuZ2UuZW5kKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgaWYgZ2l2ZW4gcmFuZ2UgaW50ZXJzZWN0cyB3aXRoIHJhbmdlcyB0aGF0IGFyZSBhbHJlYWR5IGluIHRoZSBzZWxlY3Rpb24uIFRocm93cyBhbiBlcnJvciBpZiBpdCBkb2VzLlxuXHQgKi8gX2NoZWNrUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX3Jhbmdlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBpZiAocmFuZ2UuaXNJbnRlcnNlY3RpbmcodGhpcy5fcmFuZ2VzW2ldKSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUcnlpbmcgdG8gYWRkIGEgcmFuZ2UgdGhhdCBpbnRlcnNlY3RzIHdpdGggYW5vdGhlciByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgbW9kZWwtc2VsZWN0aW9uLXJhbmdlLWludGVyc2VjdHNcblx0XHRcdFx0ICogQHBhcmFtIGFkZGVkUmFuZ2UgUmFuZ2UgdGhhdCB3YXMgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbi5cblx0XHRcdFx0ICogQHBhcmFtIGludGVyc2VjdGluZ1JhbmdlIFJhbmdlIGluIHRoZSBzZWxlY3Rpb24gdGhhdCBpbnRlcnNlY3RzIHdpdGggYGFkZGVkUmFuZ2VgLlxuXHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLXNlbGVjdGlvbi1yYW5nZS1pbnRlcnNlY3RzJywgW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgICAgICByYW5nZVxuICAgICAgICAgICAgICAgIF0sIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkZWRSYW5nZTogcmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIGludGVyc2VjdGluZ1JhbmdlOiB0aGlzLl9yYW5nZXNbaV1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVwbGFjZXMgYWxsIHRoZSByYW5nZXMgYnkgdGhlIGdpdmVuIG9uZXMuXG5cdCAqIFVzZXMge0BsaW5rICNfcG9wUmFuZ2UgX3BvcFJhbmdlfSBhbmQge0BsaW5rICNfcHVzaFJhbmdlIF9wdXNoUmFuZ2V9IHRvIGVuc3VyZSBwcm9wZXIgcmFuZ2VzIHJlbW92YWwgYW5kIGFkZGl0aW9uLlxuXHQgKi8gX3JlcGxhY2VBbGxSYW5nZXMocmFuZ2VzKSB7XG4gICAgICAgIHRoaXMuX3JlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHJhbmdlcyl7XG4gICAgICAgICAgICB0aGlzLl9wdXNoUmFuZ2UocmFuZ2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZWxldGVzIHJhbmdlcyBmcm9tIGludGVybmFsIHJhbmdlIGFycmF5LiBVc2VzIHtAbGluayAjX3BvcFJhbmdlIF9wb3BSYW5nZX0gdG9cblx0ICogZW5zdXJlIHByb3BlciByYW5nZXMgcmVtb3ZhbC5cblx0ICovIF9yZW1vdmVBbGxSYW5nZXMoKSB7XG4gICAgICAgIHdoaWxlKHRoaXMuX3Jhbmdlcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgIHRoaXMuX3BvcFJhbmdlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgbW9zdCByZWNlbnRseSBhZGRlZCByYW5nZSBmcm9tIHRoZSBzZWxlY3Rpb24uXG5cdCAqLyBfcG9wUmFuZ2UoKSB7XG4gICAgICAgIHRoaXMuX3Jhbmdlcy5wb3AoKTtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5TZWxlY3Rpb24ucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnc2VsZWN0aW9uJyB8fCB0eXBlID09PSAnbW9kZWw6c2VsZWN0aW9uJztcbn07XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBlbGVtZW50IGV4dGVuZHMgJGJsb2NrIGluIHRoZSBzY2hlbWEgYW5kIGhhcyBhIHBhcmVudCAoaXMgbm90IGEgcm9vdCkuXG4gKiBNYXJrcyBpdCBhcyBhbHJlYWR5IHZpc2l0ZWQuXG4gKi8gZnVuY3Rpb24gaXNVbnZpc2l0ZWRCbG9jayhlbGVtZW50LCB2aXNpdGVkKSB7XG4gICAgaWYgKHZpc2l0ZWQuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmlzaXRlZC5hZGQoZWxlbWVudCk7XG4gICAgcmV0dXJuIGVsZW1lbnQucm9vdC5kb2N1bWVudC5tb2RlbC5zY2hlbWEuaXNCbG9jayhlbGVtZW50KSAmJiAhIWVsZW1lbnQucGFyZW50O1xufVxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgYSAkYmxvY2sgd2FzIG5vdCBwcmV2aW91c2x5IHZpc2l0ZWQgYW5kIGlzIGEgdG9wIGJsb2NrIGluIGEgcmFuZ2UuXG4gKi8gZnVuY3Rpb24gaXNVbnZpc2l0ZWRUb3BCbG9jayhlbGVtZW50LCB2aXNpdGVkLCByYW5nZSkge1xuICAgIHJldHVybiBpc1VudmlzaXRlZEJsb2NrKGVsZW1lbnQsIHZpc2l0ZWQpICYmIGlzVG9wQmxvY2tJblJhbmdlKGVsZW1lbnQsIHJhbmdlKTtcbn1cbi8qKlxuICogRmluZHMgdGhlIGxvd2VzdCBlbGVtZW50IGluIHBvc2l0aW9uJ3MgYW5jZXN0b3JzIHdoaWNoIGlzIGEgYmxvY2suXG4gKiBJdCB3aWxsIHNlYXJjaCB1bnRpbCBmaXJzdCBhbmNlc3RvciB0aGF0IGlzIGEgbGltaXQgZWxlbWVudC5cbiAqIE1hcmtzIGFsbCBhbmNlc3RvcnMgYXMgYWxyZWFkeSB2aXNpdGVkIHRvIG5vdCBpbmNsdWRlIGFueSBvZiB0aGVtIGxhdGVyIG9uLlxuICovIGZ1bmN0aW9uIGdldFBhcmVudEJsb2NrJDEocG9zaXRpb24sIHZpc2l0ZWQpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgIGNvbnN0IHNjaGVtYSA9IGVsZW1lbnQucm9vdC5kb2N1bWVudC5tb2RlbC5zY2hlbWE7XG4gICAgY29uc3QgYW5jZXN0b3JzID0gcG9zaXRpb24ucGFyZW50LmdldEFuY2VzdG9ycyh7XG4gICAgICAgIHBhcmVudEZpcnN0OiB0cnVlLFxuICAgICAgICBpbmNsdWRlU2VsZjogdHJ1ZVxuICAgIH0pO1xuICAgIGxldCBoYXNQYXJlbnRMaW1pdCA9IGZhbHNlO1xuICAgIGNvbnN0IGJsb2NrID0gYW5jZXN0b3JzLmZpbmQoKGVsZW1lbnQpPT57XG4gICAgICAgIC8vIFN0b3Agc2VhcmNoaW5nIGFmdGVyIGZpcnN0IHBhcmVudCBub2RlIHRoYXQgaXMgbGltaXQgZWxlbWVudC5cbiAgICAgICAgaWYgKGhhc1BhcmVudExpbWl0KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaGFzUGFyZW50TGltaXQgPSBzY2hlbWEuaXNMaW1pdChlbGVtZW50KTtcbiAgICAgICAgcmV0dXJuICFoYXNQYXJlbnRMaW1pdCAmJiBpc1VudmlzaXRlZEJsb2NrKGVsZW1lbnQsIHZpc2l0ZWQpO1xuICAgIH0pO1xuICAgIC8vIE1hcmsgYWxsIGFuY2VzdG9ycyBvZiB0aGlzIHBvc2l0aW9uJ3MgcGFyZW50LCBiZWNhdXNlIGZpbmQoKSBtaWdodCd2ZSBzdG9wcGVkIGVhcmx5IGFuZFxuICAgIC8vIHRoZSBmb3VuZCBibG9jayBtYXkgYmUgYSBjaGlsZCBvZiBhbm90aGVyIGJsb2NrLlxuICAgIGFuY2VzdG9ycy5mb3JFYWNoKChlbGVtZW50KT0+dmlzaXRlZC5hZGQoZWxlbWVudCkpO1xuICAgIHJldHVybiBibG9jaztcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBibG9ja3MgaXMgbm90IG5lc3RlZCBpbiBvdGhlciBibG9jayBpbnNpZGUgYSByYW5nZS5cbiAqLyBmdW5jdGlvbiBpc1RvcEJsb2NrSW5SYW5nZShibG9jaywgcmFuZ2UpIHtcbiAgICBjb25zdCBwYXJlbnRCbG9jayA9IGZpbmRBbmNlc3RvckJsb2NrKGJsb2NrKTtcbiAgICBpZiAoIXBhcmVudEJsb2NrKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvLyBBZGQgbG9vc2UgZmxhZyB0byBjaGVjayBhcyBwYXJlbnRSYW5nZSBjYW4gYmUgZXF1YWwgdG8gcmFuZ2UuXG4gICAgY29uc3QgaXNQYXJlbnRJblJhbmdlID0gcmFuZ2UuY29udGFpbnNSYW5nZShSYW5nZS5fY3JlYXRlT24ocGFyZW50QmxvY2spLCB0cnVlKTtcbiAgICByZXR1cm4gIWlzUGFyZW50SW5SYW5nZTtcbn1cbi8qKlxuICogSWYgYSBzZWxlY3Rpb24gc3RhcnRzIGF0IHRoZSBlbmQgb2YgYSBibG9jaywgdGhhdCBibG9jayBpcyBub3QgcmV0dXJuZWQgYXMgZnJvbSB0aGUgdXNlcidzIHBlcnNwZWN0aXZlIHRoaXMgYmxvY2sgd2Fzbid0IHNlbGVjdGVkLlxuICogU2VlIFsjMTE1ODVdKGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzExNTg1KSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIGBgYHhtbFxuICogPHBhcmFncmFwaD5hWzwvcGFyYWdyYXBoPiAvLyBUaGlzIGJsb2NrIHdpbGwgbm90IGJlIHJldHVybmVkXG4gKiA8cGFyYWdyYXBoPmI8L3BhcmFncmFwaD5cbiAqIDxwYXJhZ3JhcGg+Y108L3BhcmFncmFwaD5cbiAqIGBgYFxuICpcbiAqIENvbGxhcHNlZCBzZWxlY3Rpb24gaXMgbm90IGFmZmVjdGVkIGJ5IGl0OlxuICpcbiAqIGBgYHhtbFxuICogPHBhcmFncmFwaD5hW108L3BhcmFncmFwaD4gLy8gVGhpcyBibG9jayB3aWxsIGJlIHJldHVybmVkXG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBpc1N0YXJ0QmxvY2tTZWxlY3RlZChzdGFydEJsb2NrLCByYW5nZSkge1xuICAgIGlmICghc3RhcnRCbG9jaykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChyYW5nZS5pc0NvbGxhcHNlZCB8fCBzdGFydEJsb2NrLmlzRW1wdHkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChyYW5nZS5zdGFydC5pc1RvdWNoaW5nKFBvc2l0aW9uLl9jcmVhdGVBdChzdGFydEJsb2NrLCBzdGFydEJsb2NrLm1heE9mZnNldCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzVG9wQmxvY2tJblJhbmdlKHN0YXJ0QmxvY2ssIHJhbmdlKTtcbn1cbi8qKlxuICogSWYgYSBzZWxlY3Rpb24gZW5kcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgYmxvY2ssIHRoYXQgYmxvY2sgaXMgbm90IHJldHVybmVkIGFzIGZyb20gdGhlIHVzZXIncyBwZXJzcGVjdGl2ZSB0aGlzIGJsb2NrIHdhc24ndCBzZWxlY3RlZC5cbiAqIFNlZSBbIzk4NF0oaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzk4NCkgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBgYGB4bWxcbiAqIDxwYXJhZ3JhcGg+W2E8L3BhcmFncmFwaD5cbiAqIDxwYXJhZ3JhcGg+YjwvcGFyYWdyYXBoPlxuICogPHBhcmFncmFwaD5dYzwvcGFyYWdyYXBoPiAvLyB0aGlzIGJsb2NrIHdpbGwgbm90IGJlIHJldHVybmVkXG4gKiBgYGBcbiAqXG4gKiBDb2xsYXBzZWQgc2VsZWN0aW9uIGlzIG5vdCBhZmZlY3RlZCBieSBpdDpcbiAqXG4gKiBgYGB4bWxcbiAqIDxwYXJhZ3JhcGg+W11hPC9wYXJhZ3JhcGg+IC8vIHRoaXMgYmxvY2sgd2lsbCBiZSByZXR1cm5lZFxuICogYGBgXG4gKi8gZnVuY3Rpb24gaXNFbmRCbG9ja1NlbGVjdGVkKGVuZEJsb2NrLCByYW5nZSkge1xuICAgIGlmICghZW5kQmxvY2spIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQgfHwgZW5kQmxvY2suaXNFbXB0eSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHJhbmdlLmVuZC5pc1RvdWNoaW5nKFBvc2l0aW9uLl9jcmVhdGVBdChlbmRCbG9jaywgMCkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzVG9wQmxvY2tJblJhbmdlKGVuZEJsb2NrLCByYW5nZSk7XG59XG4vKipcbiAqIFJldHVybnMgZmlyc3QgYW5jZXN0b3IgYmxvY2sgb2YgYSBub2RlLlxuICovIGZ1bmN0aW9uIGZpbmRBbmNlc3RvckJsb2NrKG5vZGUpIHtcbiAgICBjb25zdCBzY2hlbWEgPSBub2RlLnJvb3QuZG9jdW1lbnQubW9kZWwuc2NoZW1hO1xuICAgIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgICB3aGlsZShwYXJlbnQpe1xuICAgICAgICBpZiAoc2NoZW1hLmlzQmxvY2socGFyZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgIH1cbn1cblxuLyoqXG4gKiBgTGl2ZVJhbmdlYCBpcyBhIHR5cGUgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgUmFuZ2V9XG4gKiB0aGF0IHVwZGF0ZXMgaXRzZWxmIGFzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50IGRvY3VtZW50fVxuICogaXMgY2hhbmdlZCB0aHJvdWdoIG9wZXJhdGlvbnMuIEl0IG1heSBiZSB1c2VkIGFzIGEgYm9va21hcmsuXG4gKlxuICogKipOb3RlOioqIEJlIHZlcnkgY2FyZWZ1bCB3aGVuIGRlYWxpbmcgd2l0aCBgTGl2ZVJhbmdlYC4gRWFjaCBgTGl2ZVJhbmdlYCBpbnN0YW5jZSBiaW5kIGV2ZW50cyB0aGF0IG1pZ2h0XG4gKiBoYXZlIHRvIGJlIHVuYm91bmQuIFVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcmFuZ2V+TGl2ZVJhbmdlI2RldGFjaCBkZXRhY2h9IHdoZW5ldmVyIHlvdSBkb24ndCBuZWVkIGBMaXZlUmFuZ2VgIGFueW1vcmUuXG4gKi8gY2xhc3MgTGl2ZVJhbmdlIGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbihSYW5nZSkge1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbGl2ZSByYW5nZS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlXG5cdCAqLyBjb25zdHJ1Y3RvcihzdGFydCwgZW5kKXtcbiAgICAgICAgc3VwZXIoc3RhcnQsIGVuZCk7XG4gICAgICAgIGJpbmRXaXRoRG9jdW1lbnQkMS5jYWxsKHRoaXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogVW5iaW5kcyBhbGwgZXZlbnRzIHByZXZpb3VzbHkgYm91bmQgYnkgYExpdmVSYW5nZWAuIFVzZSBpdCB3aGVuZXZlciB5b3UgZG9uJ3QgbmVlZCBgTGl2ZVJhbmdlYCBpbnN0YW5jZVxuXHQgKiBhbnltb3JlIChpLmUuIHdoZW4gbGVhdmluZyBzY29wZSBpbiB3aGljaCBpdCB3YXMgZGVjbGFyZWQgb3IgYmVmb3JlIHJlLWFzc2lnbmluZyB2YXJpYWJsZSB0aGF0IHdhc1xuXHQgKiByZWZlcnJpbmcgdG8gaXQpLlxuXHQgKi8gZGV0YWNoKCkge1xuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSByYW5nZSBpbnN0YW5jZX0gdGhhdCBpcyBlcXVhbCB0byB0aGlzIGxpdmUgcmFuZ2UuXG5cdCAqLyB0b1JhbmdlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHRoaXMuc3RhcnQsIHRoaXMuZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBgTGl2ZVJhbmdlYCBpbnN0YW5jZSB0aGF0IGlzIGVxdWFsIHRvIHRoZSBnaXZlbiByYW5nZS5cblx0ICovIHN0YXRpYyBmcm9tUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMaXZlUmFuZ2UocmFuZ2Uuc3RhcnQsIHJhbmdlLmVuZCk7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuTGl2ZVJhbmdlLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ2xpdmVSYW5nZScgfHwgdHlwZSA9PT0gJ21vZGVsOmxpdmVSYW5nZScgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgdHlwZSA9PSAncmFuZ2UnIHx8IHR5cGUgPT09ICdtb2RlbDpyYW5nZSc7XG59O1xuLyoqXG4gKiBCaW5kcyB0aGlzIGBMaXZlUmFuZ2VgIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH1cbiAqIHRoYXQgb3ducyB0aGlzIHJhbmdlJ3Mge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2Ujcm9vdCByb290fS5cbiAqLyBmdW5jdGlvbiBiaW5kV2l0aERvY3VtZW50JDEoKSB7XG4gICAgdGhpcy5saXN0ZW5Ubyh0aGlzLnJvb3QuZG9jdW1lbnQubW9kZWwsICdhcHBseU9wZXJhdGlvbicsIChldmVudCwgYXJncyk9PntcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gYXJnc1swXTtcbiAgICAgICAgaWYgKCFvcGVyYXRpb24uaXNEb2N1bWVudE9wZXJhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRyYW5zZm9ybSQyLmNhbGwodGhpcywgb3BlcmF0aW9uKTtcbiAgICB9LCB7XG4gICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgIH0pO1xufVxuLyoqXG4gKiBVcGRhdGVzIHRoaXMgcmFuZ2UgYWNjb3JkaW5nbHkgdG8gdGhlIHVwZGF0ZXMgYXBwbGllZCB0byB0aGUgbW9kZWwuIEJhc2VzIG9uIGNoYW5nZSBldmVudHMuXG4gKi8gZnVuY3Rpb24gdHJhbnNmb3JtJDIob3BlcmF0aW9uKSB7XG4gICAgLy8gVHJhbnNmb3JtIHRoZSByYW5nZSBieSB0aGUgb3BlcmF0aW9uLiBKb2luIHRoZSByZXN1bHQgcmFuZ2VzIGlmIG5lZWRlZC5cbiAgICBjb25zdCByYW5nZXMgPSB0aGlzLmdldFRyYW5zZm9ybWVkQnlPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICBjb25zdCByZXN1bHQgPSBSYW5nZS5fY3JlYXRlRnJvbVJhbmdlcyhyYW5nZXMpO1xuICAgIGNvbnN0IGJvdW5kYXJpZXNDaGFuZ2VkID0gIXJlc3VsdC5pc0VxdWFsKHRoaXMpO1xuICAgIGNvbnN0IGNvbnRlbnRDaGFuZ2VkID0gZG9lc09wZXJhdGlvbkNoYW5nZVJhbmdlQ29udGVudCh0aGlzLCBvcGVyYXRpb24pO1xuICAgIGxldCBkZWxldGlvblBvc2l0aW9uID0gbnVsbDtcbiAgICBpZiAoYm91bmRhcmllc0NoYW5nZWQpIHtcbiAgICAgICAgLy8gSWYgcmFuZ2UgYm91bmRhcmllcyBoYXZlIGNoYW5nZWQsIGZpcmUgYGNoYW5nZTpyYW5nZWAgZXZlbnQuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChyZXN1bHQucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSByYW5nZSB3YXMgbW92ZWQgdG8gdGhlIGdyYXZleWFyZCByb290LCBzZXQgYGRlbGV0aW9uUG9zaXRpb25gLlxuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi50eXBlID09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRpb25Qb3NpdGlvbiA9IG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gTWVyZ2Ugb3BlcmF0aW9uLlxuICAgICAgICAgICAgICAgIGRlbGV0aW9uUG9zaXRpb24gPSBvcGVyYXRpb24uZGVsZXRpb25Qb3NpdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRSYW5nZSA9IHRoaXMudG9SYW5nZSgpO1xuICAgICAgICB0aGlzLnN0YXJ0ID0gcmVzdWx0LnN0YXJ0O1xuICAgICAgICB0aGlzLmVuZCA9IHJlc3VsdC5lbmQ7XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOnJhbmdlJywgb2xkUmFuZ2UsIHtcbiAgICAgICAgICAgIGRlbGV0aW9uUG9zaXRpb25cbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChjb250ZW50Q2hhbmdlZCkge1xuICAgICAgICAvLyBJZiByYW5nZSBib3VuZGFyaWVzIGhhdmUgbm90IGNoYW5nZWQsIGJ1dCB0aGVyZSB3YXMgY2hhbmdlIGluc2lkZSB0aGUgcmFuZ2UsIGZpcmUgYGNoYW5nZTpjb250ZW50YCBldmVudC5cbiAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2U6Y29udGVudCcsIHRoaXMudG9SYW5nZSgpLCB7XG4gICAgICAgICAgICBkZWxldGlvblBvc2l0aW9uXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gb3BlcmF0aW9uIGNoYW5nZXMgc29tZXRoaW5nIGluc2lkZSB0aGUgcmFuZ2UgKGV2ZW4gaWYgaXQgZG9lcyBub3QgY2hhbmdlIGJvdW5kYXJpZXMpLlxuICovIGZ1bmN0aW9uIGRvZXNPcGVyYXRpb25DaGFuZ2VSYW5nZUNvbnRlbnQocmFuZ2UsIG9wZXJhdGlvbikge1xuICAgIHN3aXRjaChvcGVyYXRpb24udHlwZSl7XG4gICAgICAgIGNhc2UgJ2luc2VydCc6XG4gICAgICAgICAgICByZXR1cm4gcmFuZ2UuY29udGFpbnNQb3NpdGlvbihvcGVyYXRpb24ucG9zaXRpb24pO1xuICAgICAgICBjYXNlICdtb3ZlJzpcbiAgICAgICAgY2FzZSAncmVtb3ZlJzpcbiAgICAgICAgY2FzZSAncmVpbnNlcnQnOlxuICAgICAgICBjYXNlICdtZXJnZSc6XG4gICAgICAgICAgICByZXR1cm4gcmFuZ2UuY29udGFpbnNQb3NpdGlvbihvcGVyYXRpb24uc291cmNlUG9zaXRpb24pIHx8IHJhbmdlLnN0YXJ0LmlzRXF1YWwob3BlcmF0aW9uLnNvdXJjZVBvc2l0aW9uKSB8fCByYW5nZS5jb250YWluc1Bvc2l0aW9uKG9wZXJhdGlvbi50YXJnZXRQb3NpdGlvbik7XG4gICAgICAgIGNhc2UgJ3NwbGl0JzpcbiAgICAgICAgICAgIHJldHVybiByYW5nZS5jb250YWluc1Bvc2l0aW9uKG9wZXJhdGlvbi5zcGxpdFBvc2l0aW9uKSB8fCByYW5nZS5jb250YWluc1Bvc2l0aW9uKG9wZXJhdGlvbi5pbnNlcnRpb25Qb3NpdGlvbik7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zdCB7IGNvbnZlcnRNYXBUb1N0cmluZ2lmaWVkT2JqZWN0IH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLyoqXG4gKiBNb2RlbCB0ZXh0IG5vZGUuIFR5cGUgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlIG5vZGV9IHRoYXQgY29udGFpbnMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0I2RhdGEgdGV4dCBkYXRhfS5cbiAqXG4gKiAqKkltcG9ydGFudDoqKiBzZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSB0byByZWFkIGFib3V0IHJlc3RyaWN0aW9ucyB1c2luZyBgVGV4dGAgYW5kIGBOb2RlYCBBUEkuXG4gKlxuICogKipOb3RlOioqIGtlZXAgaW4gbWluZCB0aGF0IGBUZXh0YCBpbnN0YW5jZXMgbWlnaHQgaW5kaXJlY3RseSBnb3QgcmVtb3ZlZCBmcm9tIG1vZGVsIHRyZWUgd2hlbiBtb2RlbCBpcyBjaGFuZ2VkLlxuICogVGhpcyBoYXBwZW5zIHdoZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciBtb2RlbCB3cml0ZXJ9IGlzIHVzZWQgdG8gY2hhbmdlIG1vZGVsIGFuZCB0aGUgdGV4dCBub2RlIGlzIG1lcmdlZCB3aXRoXG4gKiBhbm90aGVyIHRleHQgbm9kZS4gVGhlbiwgYm90aCB0ZXh0IG5vZGVzIGFyZSByZW1vdmVkIGFuZCBhIG5ldyB0ZXh0IG5vZGUgaXMgaW5zZXJ0ZWQgaW50byB0aGUgbW9kZWwuIEJlY2F1c2Ugb2ZcbiAqIHRoaXMgYmVoYXZpb3IsIGtlZXBpbmcgcmVmZXJlbmNlcyB0byBgVGV4dGAgaXMgbm90IHJlY29tbWVuZGVkLiBJbnN0ZWFkLCBjb25zaWRlciBjcmVhdGluZ1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbGl2ZXBvc2l0aW9ufkxpdmVQb3NpdGlvbiBsaXZlIHBvc2l0aW9ufSBwbGFjZWQgYmVmb3JlIHRoZSB0ZXh0IG5vZGUuXG4gKi8gY2xhc3MgVGV4dCBleHRlbmRzIE5vZGUkMSB7XG4gICAgLyoqXG5cdCAqIFRleHQgZGF0YSBjb250YWluZWQgaW4gdGhpcyB0ZXh0IG5vZGUuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2RhdGE7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB0ZXh0IG5vZGUuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBDb25zdHJ1Y3RvciBvZiB0aGlzIGNsYXNzIHNob3VsZG4ndCBiZSB1c2VkIGRpcmVjdGx5IGluIHRoZSBjb2RlLlxuXHQgKiBVc2UgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjY3JlYXRlVGV4dH0gbWV0aG9kIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZGF0YSBOb2RlJ3MgdGV4dC5cblx0ICogQHBhcmFtIGF0dHJzIE5vZGUncyBhdHRyaWJ1dGVzLiBTZWUge0BsaW5rIG1vZHVsZTp1dGlscy90b21hcH50b01hcH0gZm9yIGEgbGlzdCBvZiBhY2NlcHRlZCB2YWx1ZXMuXG5cdCAqLyBjb25zdHJ1Y3RvcihkYXRhLCBhdHRycyl7XG4gICAgICAgIHN1cGVyKGF0dHJzKTtcbiAgICAgICAgdGhpcy5fZGF0YSA9IGRhdGEgfHwgJyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IG9mZnNldFNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHRleHQgZGF0YSBjb250YWluZWQgaW4gdGhlIG5vZGUuXG5cdCAqLyBnZXQgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGE7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBgVGV4dGAgaW5zdGFuY2UgdG8gcGxhaW4gb2JqZWN0IGFuZCByZXR1cm5zIGl0LlxuXHQgKlxuXHQgKiBAcmV0dXJuc2BUZXh0YCBpbnN0YW5jZSBjb252ZXJ0ZWQgdG8gcGxhaW4gb2JqZWN0LlxuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICBjb25zdCBqc29uID0gc3VwZXIudG9KU09OKCk7XG4gICAgICAgIGpzb24uZGF0YSA9IHRoaXMuZGF0YTtcbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgY29weSBvZiB0aGlzIHRleHQgbm9kZSBhbmQgcmV0dXJucyBpdC4gQ3JlYXRlZCB0ZXh0IG5vZGUgaGFzIHNhbWUgdGV4dCBkYXRhIGFuZCBhdHRyaWJ1dGVzIGFzIG9yaWdpbmFsIHRleHQgbm9kZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEByZXR1cm5zIGBUZXh0YCBpbnN0YW5jZSBjcmVhdGVkIHVzaW5nIGdpdmVuIHBsYWluIG9iamVjdC5cblx0ICovIF9jbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KHRoaXMuZGF0YSwgdGhpcy5nZXRBdHRyaWJ1dGVzKCkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIGBUZXh0YCBpbnN0YW5jZSBmcm9tIGdpdmVuIHBsYWluIG9iamVjdCAoaS5lLiBwYXJzZWQgSlNPTiBzdHJpbmcpLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBQbGFpbiBvYmplY3QgdG8gYmUgY29udmVydGVkIHRvIGBUZXh0YC5cblx0ICogQHJldHVybnMgYFRleHRgIGluc3RhbmNlIGNyZWF0ZWQgdXNpbmcgZ2l2ZW4gcGxhaW4gb2JqZWN0LlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KGpzb24uZGF0YSwganNvbi5hdHRyaWJ1dGVzKTtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5UZXh0LnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJyR0ZXh0JyB8fCB0eXBlID09PSAnbW9kZWw6JHRleHQnIHx8IC8vIFRoaXMgYXJlIGxlZ2FjeSB2YWx1ZXMga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICB0eXBlID09PSAndGV4dCcgfHwgdHlwZSA9PT0gJ21vZGVsOnRleHQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgIHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAnbW9kZWw6bm9kZSc7XG59O1xuXG5jb25zdCBzdG9yZVByZWZpeCA9ICdzZWxlY3Rpb246Jztcbi8qKlxuICogYERvY3VtZW50U2VsZWN0aW9uYCBpcyBhIHNwZWNpYWwgc2VsZWN0aW9uIHdoaWNoIGlzIHVzZWQgYXMgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCNzZWxlY3Rpb24gZG9jdW1lbnQncyBzZWxlY3Rpb259LlxuICogVGhlcmUgY2FuIGJlIG9ubHkgb25lIGluc3RhbmNlIG9mIGBEb2N1bWVudFNlbGVjdGlvbmAgcGVyIGRvY3VtZW50LlxuICpcbiAqIERvY3VtZW50IHNlbGVjdGlvbiBjYW4gb25seSBiZSBjaGFuZ2VkIGJ5IHVzaW5nIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyfSBpbnN0YW5jZVxuICogaW5zaWRlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2UgYGNoYW5nZSgpYH0gYmxvY2ssIGFzIGl0IHByb3ZpZGVzIGEgc2VjdXJlIHdheSB0byBtb2RpZnkgbW9kZWwuXG4gKlxuICogYERvY3VtZW50U2VsZWN0aW9uYCBpcyBhdXRvbWF0aWNhbGx5IHVwZGF0ZWQgdXBvbiBjaGFuZ2VzIGluIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH1cbiAqIHRvIGFsd2F5cyBjb250YWluIHZhbGlkIHJhbmdlcy4gSXRzIGF0dHJpYnV0ZXMgYXJlIGluaGVyaXRlZCBmcm9tIHRoZSB0ZXh0IHVubGVzcyBzZXQgZXhwbGljaXRseS5cbiAqXG4gKiBEaWZmZXJlbmNlcyBiZXR3ZWVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb259IGFuZCBgRG9jdW1lbnRTZWxlY3Rpb25gIGFyZTpcbiAqICogdGhlcmUgaXMgYWx3YXlzIGEgcmFuZ2UgaW4gYERvY3VtZW50U2VsZWN0aW9uYCAtIGV2ZW4gaWYgbm8gcmFuZ2VzIHdlcmUgYWRkZWQgdGhlcmUgaXMgYSBcImRlZmF1bHQgcmFuZ2VcIlxuICogcHJlc2VudCBpbiB0aGUgc2VsZWN0aW9uLFxuICogKiByYW5nZXMgYWRkZWQgdG8gdGhpcyBzZWxlY3Rpb24gdXBkYXRlcyBhdXRvbWF0aWNhbGx5IHdoZW4gdGhlIGRvY3VtZW50IGNoYW5nZXMsXG4gKiAqIGF0dHJpYnV0ZXMgb2YgYERvY3VtZW50U2VsZWN0aW9uYCBhcmUgdXBkYXRlZCBhdXRvbWF0aWNhbGx5IGFjY29yZGluZyB0byBzZWxlY3Rpb24gcmFuZ2VzLlxuICpcbiAqIFNpbmNlIGBEb2N1bWVudFNlbGVjdGlvbmAgdXNlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcmFuZ2V+TGl2ZVJhbmdlIGxpdmUgcmFuZ2VzfVxuICogYW5kIGlzIHVwZGF0ZWQgd2hlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH1cbiAqIGNoYW5nZXMsIGl0IGNhbm5vdCBiZSBzZXQgb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlIG5vZGVzfVxuICogdGhhdCBhcmUgaW5zaWRlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH0uXG4gKiBJZiB5b3UgbmVlZCB0byByZXByZXNlbnQgYSBzZWxlY3Rpb24gaW4gZG9jdW1lbnQgZnJhZ21lbnQsXG4gKiB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiBTZWxlY3Rpb24gY2xhc3N9IGluc3RlYWQuXG4gKi8gY2xhc3MgRG9jdW1lbnRTZWxlY3Rpb24gZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gRW1pdHRlck1peGluKFR5cGVDaGVja2FibGUpIHtcbiAgICAvKipcblx0ICogU2VsZWN0aW9uIHVzZWQgaW50ZXJuYWxseSBieSB0aGF0IGNsYXNzIChgRG9jdW1lbnRTZWxlY3Rpb25gIGlzIGEgcHJveHkgdG8gdGhhdCBzZWxlY3Rpb24pLlxuXHQgKi8gX3NlbGVjdGlvbjtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBlbXB0eSBsaXZlIHNlbGVjdGlvbiBmb3IgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnR9LlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9jIERvY3VtZW50IHdoaWNoIG93bnMgdGhpcyBzZWxlY3Rpb24uXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2Mpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24gPSBuZXcgTGl2ZVNlbGVjdGlvbihkb2MpO1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24uZGVsZWdhdGUoJ2NoYW5nZTpyYW5nZScpLnRvKHRoaXMpO1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24uZGVsZWdhdGUoJ2NoYW5nZTphdHRyaWJ1dGUnKS50byh0aGlzKTtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uLmRlbGVnYXRlKCdjaGFuZ2U6bWFya2VyJykudG8odGhpcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXNjcmliZXMgd2hldGhlciB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZC4gU2VsZWN0aW9uIGlzIGNvbGxhcHNlZCB3aGVuIHRoZXJlIGlzIGV4YWN0bHkgb25lIHJhbmdlIHdoaWNoIGlzXG5cdCAqIGNvbGxhcHNlZC5cblx0ICovIGdldCBpc0NvbGxhcHNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5pc0NvbGxhcHNlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlbGVjdGlvbiBhbmNob3IuIEFuY2hvciBtYXkgYmUgZGVzY3JpYmVkIGFzIGEgcG9zaXRpb24gd2hlcmUgdGhlIG1vc3QgcmVjZW50IHBhcnQgb2YgdGhlIHNlbGVjdGlvbiBzdGFydHMuXG5cdCAqIFRvZ2V0aGVyIHdpdGgge0BsaW5rICNmb2N1c30gdGhleSBkZWZpbmUgdGhlIGRpcmVjdGlvbiBvZiBzZWxlY3Rpb24sIHdoaWNoIGlzIGltcG9ydGFudFxuXHQgKiB3aGVuIGV4cGFuZGluZy9zaHJpbmtpbmcgc2VsZWN0aW9uLiBBbmNob3IgaXMgYWx3YXlzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlI3N0YXJ0IHN0YXJ0fSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSNlbmQgZW5kfSBwb3NpdGlvbiBvZiB0aGUgbW9zdCByZWNlbnRseSBhZGRlZCByYW5nZS5cblx0ICpcblx0ICogSXMgc2V0IHRvIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICpcblx0ICogQHNlZSAjZm9jdXNcblx0ICovIGdldCBhbmNob3IoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uYW5jaG9yO1xuICAgIH1cbiAgICAvKipcblx0ICogU2VsZWN0aW9uIGZvY3VzLiBGb2N1cyBpcyBhIHBvc2l0aW9uIHdoZXJlIHRoZSBzZWxlY3Rpb24gZW5kcy5cblx0ICpcblx0ICogSXMgc2V0IHRvIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICpcblx0ICogQHNlZSAjYW5jaG9yXG5cdCAqLyBnZXQgZm9jdXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZm9jdXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOdW1iZXIgb2YgcmFuZ2VzIGluIHNlbGVjdGlvbi5cblx0ICovIGdldCByYW5nZUNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLnJhbmdlQ291bnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXNjcmliZXMgd2hldGhlciBgRG9jdW1lbnRzZWxlY3Rpb25gIGhhcyBvd24gcmFuZ2Uocykgc2V0LCBvciBpZiBpdCBpcyBkZWZhdWx0ZWQgdG9cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjX2dldERlZmF1bHRSYW5nZSBkb2N1bWVudCdzIGRlZmF1bHQgcmFuZ2V9LlxuXHQgKi8gZ2V0IGhhc093blJhbmdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmhhc093blJhbmdlO1xuICAgIH1cbiAgICAvKipcblx0ICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHtAbGluayAjZm9jdXN9XG5cdCAqIHByZWNlZGVzIHtAbGluayAjYW5jaG9yfS5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqIEB0eXBlIHtCb29sZWFufVxuXHQgKi8gZ2V0IGlzQmFja3dhcmQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uaXNCYWNrd2FyZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc2NyaWJlcyB3aGV0aGVyIHRoZSBncmF2aXR5IGlzIG92ZXJyaWRkZW4gKHVzaW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjb3ZlcnJpZGVTZWxlY3Rpb25HcmF2aXR5fSkgb3Igbm90LlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgdGhlIGdyYXZpdHkgcmVtYWlucyBvdmVycmlkZGVuIGFzIGxvbmcgYXMgd2lsbCBub3QgYmUgcmVzdG9yZWQgdGhlIHNhbWUgbnVtYmVyIG9mIHRpbWVzIGFzIGl0IHdhcyBvdmVycmlkZGVuLlxuXHQgKi8gZ2V0IGlzR3Jhdml0eU92ZXJyaWRkZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uaXNHcmF2aXR5T3ZlcnJpZGRlbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgY29sbGVjdGlvbiBvZiBzZWxlY3Rpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIgbWFya2Vyc30uXG5cdCAqIE1hcmtlciBpcyBhIHNlbGVjdGlvbiBtYXJrZXIgd2hlbiBzZWxlY3Rpb24gcmFuZ2UgaXMgaW5zaWRlIHRoZSBtYXJrZXIgcmFuZ2UuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBPbmx5IG1hcmtlcnMgZnJvbSB7QGxpbmsgfkRvY3VtZW50U2VsZWN0aW9uI29ic2VydmVNYXJrZXJzIG9ic2VydmVkIG1hcmtlcnMgZ3JvdXBzfSBhcmUgY29sbGVjdGVkLlxuXHQgKi8gZ2V0IG1hcmtlcnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24ubWFya2VycztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVzZWQgZm9yIHRoZSBjb21wYXRpYmlsaXR5IHdpdGggdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24jaXNFcXVhbH0gbWV0aG9kLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIGdldCBfcmFuZ2VzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLl9yYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhYmxlIHRoYXQgaXRlcmF0ZXMgb3ZlciBjb3BpZXMgb2Ygc2VsZWN0aW9uIHJhbmdlcy5cblx0ICovIGdldFJhbmdlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5nZXRSYW5nZXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGZpcnN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqIEZpcnN0IHBvc2l0aW9uIGlzIHRoZSBwb3NpdGlvbiB0aGF0IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI2lzQmVmb3JlIGlzIGJlZm9yZX1cblx0ICogYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0Rmlyc3RQb3NpdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBsYXN0IHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqIExhc3QgcG9zaXRpb24gaXMgdGhlIHBvc2l0aW9uIHRoYXQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn1cblx0ICogYW55IG90aGVyIHBvc2l0aW9uIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0TGFzdFBvc2l0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGZpcnN0IHJhbmdlIGluIHRoZSBzZWxlY3Rpb24uXG5cdCAqIEZpcnN0IHJhbmdlIGlzIHRoZSBvbmUgd2hpY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2Ujc3RhcnQgc3RhcnR9IHBvc2l0aW9uXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uI2lzQmVmb3JlIGlzIGJlZm9yZX0gc3RhcnQgcG9zaXRpb24gb2YgYWxsIG90aGVyIHJhbmdlc1xuXHQgKiAobm90IHRvIGNvbmZ1c2Ugd2l0aCB0aGUgZmlyc3QgcmFuZ2UgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbikuXG5cdCAqXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0Rmlyc3RSYW5nZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgbGFzdCByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBMYXN0IHJhbmdlIGlzIHRoZSBvbmUgd2hpY2gge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UjZW5kIGVuZH0gcG9zaXRpb25cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jaXNBZnRlciBpcyBhZnRlcn0gZW5kIHBvc2l0aW9uIG9mIGFsbCBvdGhlciByYW5nZXMgKG5vdCB0byBjb25mdXNlIHdpdGggdGhlIHJhbmdlIG1vc3Rcblx0ICogcmVjZW50bHkgYWRkZWQgdG8gdGhlIHNlbGVjdGlvbikuXG5cdCAqXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGFyZSBubyByYW5nZXMgaW4gc2VsZWN0aW9uLlxuXHQgKi8gZ2V0TGFzdFJhbmdlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldExhc3RSYW5nZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBlbGVtZW50cyBvZiB0eXBlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNCbG9jayBcImJsb2NrXCJ9IHRvdWNoZWQgYnkgdGhlIHNlbGVjdGlvbi5cblx0ICpcblx0ICogVGhpcyBtZXRob2QncyByZXN1bHQgY2FuIGJlIHVzZWQgZm9yIGV4YW1wbGUgdG8gYXBwbHkgYmxvY2sgc3R5bGluZyB0byBhbGwgYmxvY2tzIGNvdmVyZWQgYnkgdGhpcyBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqICoqTm90ZToqKiBgZ2V0U2VsZWN0ZWRCbG9ja3MoKWAgcmV0dXJucyBibG9ja3MgdGhhdCBhcmUgbmVzdGVkIGluIG90aGVyIG5vbi1ibG9jayBlbGVtZW50c1xuXHQgKiBidXQgd2lsbCBub3QgcmV0dXJuIGJsb2NrcyBuZXN0ZWQgaW4gb3RoZXIgYmxvY2tzLlxuXHQgKlxuXHQgKiBJbiB0aGlzIGNhc2UgdGhlIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIGV4YWN0bHkgYWxsIDMgcGFyYWdyYXBocyAobm90ZTogYDxibG9ja1F1b3RlPmAgaXMgbm90IGEgYmxvY2sgaXRzZWxmKTpcblx0ICpcblx0ICogYGBgXG5cdCAqIDxwYXJhZ3JhcGg+W2E8L3BhcmFncmFwaD5cblx0ICogPGJsb2NrUXVvdGU+XG5cdCAqIFx0PHBhcmFncmFwaD5iPC9wYXJhZ3JhcGg+XG5cdCAqIDwvYmxvY2tRdW90ZT5cblx0ICogPHBhcmFncmFwaD5jXWQ8L3BhcmFncmFwaD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEluIHRoaXMgY2FzZSB0aGUgcGFyYWdyYXBoIHdpbGwgYWxzbyBiZSByZXR1cm5lZCwgZGVzcGl0ZSB0aGUgY29sbGFwc2VkIHNlbGVjdGlvbjpcblx0ICpcblx0ICogYGBgXG5cdCAqIDxwYXJhZ3JhcGg+W11hPC9wYXJhZ3JhcGg+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbiBzdWNoIGEgc2NlbmFyaW8sIGhvd2V2ZXIsIG9ubHkgYmxvY2tzIEEsIEIgJiBFIHdpbGwgYmUgcmV0dXJuZWQgYXMgYmxvY2tzIEMgJiBEIGFyZSBuZXN0ZWQgaW4gYmxvY2sgQjpcblx0ICpcblx0ICogYGBgXG5cdCAqIFs8YmxvY2tBPjwvYmxvY2tBPlxuXHQgKiA8YmxvY2tCPlxuXHQgKiBcdDxibG9ja0M+PC9ibG9ja0M+XG5cdCAqIFx0PGJsb2NrRD48L2Jsb2NrRD5cblx0ICogPC9ibG9ja0I+XG5cdCAqIDxibG9ja0U+PC9ibG9ja0U+XVxuXHQgKiBgYGBcblx0ICpcblx0ICogSWYgdGhlIHNlbGVjdGlvbiBpcyBpbnNpZGUgYSBibG9jayBhbGwgdGhlIGlubmVyIGJsb2NrcyAoQSAmIEIpIGFyZSByZXR1cm5lZDpcblx0ICpcblx0ICogYGBgXG5cdCAqIDxibG9jaz5cblx0ICogXHQ8YmxvY2tBPlthPC9ibG9ja0E+XG5cdCAqIFx0PGJsb2NrQj5iXTwvYmxvY2tCPlxuXHQgKiA8L2Jsb2NrPlxuXHQgKiBgYGBcblx0ICpcblx0ICogKipTcGVjaWFsIGNhc2UqKjogSWYgYSBzZWxlY3Rpb24gZW5kcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgYmxvY2ssIHRoYXQgYmxvY2sgaXMgbm90IHJldHVybmVkIGFzIGZyb20gdXNlciBwZXJzcGVjdGl2ZVxuXHQgKiB0aGlzIGJsb2NrIHdhc24ndCBzZWxlY3RlZC4gU2VlIFsjOTg0XShodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvOTg0KSBmb3IgbW9yZSBkZXRhaWxzLlxuXHQgKlxuXHQgKiBgYGBcblx0ICogPHBhcmFncmFwaD5bYTwvcGFyYWdyYXBoPlxuXHQgKiA8cGFyYWdyYXBoPmI8L3BhcmFncmFwaD5cblx0ICogPHBhcmFncmFwaD5dYzwvcGFyYWdyYXBoPiAvLyB0aGlzIGJsb2NrIHdpbGwgbm90IGJlIHJldHVybmVkXG5cdCAqIGBgYFxuXHQgKi8gZ2V0U2VsZWN0ZWRCbG9ja3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIHNlbGVjdGVkIGVsZW1lbnQuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCBFbGVtZW50fSBpcyBjb25zaWRlcmVkIGFzIHNlbGVjdGVkIGlmIHRoZXJlIGlzIG9ubHlcblx0ICogb25lIHJhbmdlIGluIHRoZSBzZWxlY3Rpb24sIGFuZCB0aGF0IHJhbmdlIGNvbnRhaW5zIGV4YWN0bHkgb25lIGVsZW1lbnQuXG5cdCAqIFJldHVybnMgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHNlbGVjdGVkIGVsZW1lbnQuXG5cdCAqLyBnZXRTZWxlY3RlZEVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgc2VsZWN0aW9uIGNvbnRhaW5zIHRoZSBlbnRpcmUgY29udGVudCBvZiB0aGUgZ2l2ZW4gZWxlbWVudC4gVGhpcyBtZWFucyB0aGF0IHNlbGVjdGlvbiBtdXN0IHN0YXJ0XG5cdCAqIGF0IGEgcG9zaXRpb24ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jaXNUb3VjaGluZyB0b3VjaGluZ30gdGhlIGVsZW1lbnQncyBzdGFydCBhbmQgZW5kcyBhdCBwb3NpdGlvblxuXHQgKiB0b3VjaGluZyB0aGUgZWxlbWVudCdzIGVuZC5cblx0ICpcblx0ICogQnkgZGVmYXVsdCwgdGhpcyBtZXRob2Qgd2lsbCBjaGVjayB3aGV0aGVyIHRoZSBlbnRpcmUgY29udGVudCBvZiB0aGUgc2VsZWN0aW9uJ3MgY3VycmVudCByb290IGlzIHNlbGVjdGVkLlxuXHQgKiBVc2VmdWwgdG8gY2hlY2sgaWYgZS5nLiB0aGUgdXNlciBoYXMganVzdCBwcmVzc2VkIDxrYmQ+Q3RybDwva2JkPiArIDxrYmQ+QTwva2JkPi5cblx0ICovIGNvbnRhaW5zRW50aXJlQ29udGVudChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uY29udGFpbnNFbnRpcmVDb250ZW50KGVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogVW5iaW5kcyBhbGwgZXZlbnRzIHByZXZpb3VzbHkgYm91bmQgYnkgZG9jdW1lbnQgc2VsZWN0aW9uLlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmFibGUgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgc2VsZWN0aW9uJ3MgYXR0cmlidXRlIGtleXMuXG5cdCAqLyBnZXRBdHRyaWJ1dGVLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldEF0dHJpYnV0ZUtleXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmFibGUgdGhhdCBpdGVyYXRlcyBvdmVyIHRoaXMgc2VsZWN0aW9uJ3MgYXR0cmlidXRlcy5cblx0ICpcblx0ICogQXR0cmlidXRlcyBhcmUgcmV0dXJuZWQgYXMgYXJyYXlzIGNvbnRhaW5pbmcgdHdvIGl0ZW1zLiBGaXJzdCBvbmUgaXMgYXR0cmlidXRlIGtleSBhbmQgc2Vjb25kIGlzIGF0dHJpYnV0ZSB2YWx1ZS5cblx0ICogVGhpcyBmb3JtYXQgaXMgYWNjZXB0ZWQgYnkgbmF0aXZlIGBNYXBgIG9iamVjdCBhbmQgYWxzbyBjYW4gYmUgcGFzc2VkIGluIGBOb2RlYCBjb25zdHJ1Y3Rvci5cblx0ICovIGdldEF0dHJpYnV0ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uZ2V0QXR0cmlidXRlcygpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyBhbiBhdHRyaWJ1dGUgdmFsdWUgZm9yIGdpdmVuIGtleSBvciBgdW5kZWZpbmVkYCBpZiB0aGF0IGF0dHJpYnV0ZSBpcyBub3Qgc2V0IG9uIHRoZSBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBrZXkgS2V5IG9mIGF0dHJpYnV0ZSB0byBsb29rIGZvci5cblx0ICogQHJldHVybnMgQXR0cmlidXRlIHZhbHVlIG9yIGB1bmRlZmluZWRgLlxuXHQgKi8gZ2V0QXR0cmlidXRlKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldEF0dHJpYnV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZSBzZWxlY3Rpb24gaGFzIGFuIGF0dHJpYnV0ZSBmb3IgZ2l2ZW4ga2V5LlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhdHRyaWJ1dGUgdG8gY2hlY2suXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgaXMgc2V0IG9uIHNlbGVjdGlvbiwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBoYXNBdHRyaWJ1dGUoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3Rpb24uaGFzQXR0cmlidXRlKGtleSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWZyZXNoZXMgc2VsZWN0aW9uIGF0dHJpYnV0ZXMgYW5kIG1hcmtlcnMgYWNjb3JkaW5nIHRvIHRoZSBjdXJyZW50IHBvc2l0aW9uIGluIHRoZSBtb2RlbC5cblx0ICovIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMuX3NlbGVjdGlvbi51cGRhdGVNYXJrZXJzKCk7XG4gICAgICAgIHRoaXMuX3NlbGVjdGlvbi5fdXBkYXRlQXR0cmlidXRlcyhmYWxzZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgYSBtYXJrZXIgZ3JvdXAgcHJlZml4IG9yIGEgbWFya2VyIG5hbWUgdG8gYmUgY29sbGVjdGVkIGluIHRoZVxuXHQgKiB7QGxpbmsgfkRvY3VtZW50U2VsZWN0aW9uI21hcmtlcnMgc2VsZWN0aW9uIG1hcmtlcnMgY29sbGVjdGlvbn0uXG5cdCAqXG5cdCAqIFNlZSBhbHNvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyQ29sbGVjdGlvbiNnZXRNYXJrZXJzR3JvdXAgYE1hcmtlckNvbGxlY3Rpb24jZ2V0TWFya2Vyc0dyb3VwKClgfS5cblx0ICpcblx0ICogQHBhcmFtIHByZWZpeE9yTmFtZSBUaGUgbWFya2VyIGdyb3VwIHByZWZpeCBvciBtYXJrZXIgbmFtZS5cblx0ICovIG9ic2VydmVNYXJrZXJzKHByZWZpeE9yTmFtZSkge1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24ub2JzZXJ2ZU1hcmtlcnMocHJlZml4T3JOYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vdmVzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uI2ZvY3VzfSB0byB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uLlxuXHQgKiBTaG91bGQgYmUgdXNlZCBvbmx5IHdpdGhpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRTZWxlY3Rpb25Gb2N1c30gbWV0aG9kLlxuXHQgKlxuXHQgKiBUaGUgbG9jYXRpb24gY2FuIGJlIHNwZWNpZmllZCBpbiB0aGUgc2FtZSBmb3JtIGFzXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjY3JlYXRlUG9zaXRpb25BdCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCgpfSBwYXJhbWV0ZXJzLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRTZWxlY3Rpb25Gb2N1c1xuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW5cblx0ICogZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gX3NldEZvY3VzKGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uLnNldEZvY3VzKGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB0aGlzIHNlbGVjdGlvbidzIHJhbmdlcyBhbmQgZGlyZWN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24gYmFzZWQgb24gdGhlIGdpdmVuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3RhYmxlIHNlbGVjdGFibGV9LlxuXHQgKiBTaG91bGQgYmUgdXNlZCBvbmx5IHdpdGhpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRTZWxlY3Rpb259IG1ldGhvZC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjc2V0U2VsZWN0aW9uXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3NldFRvKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uLnNldFRvKC4uLmFyZ3MpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyBhdHRyaWJ1dGUgb24gdGhlIHNlbGVjdGlvbi4gSWYgYXR0cmlidXRlIHdpdGggdGhlIHNhbWUga2V5IGFscmVhZHkgaXMgc2V0LCBpdCdzIHZhbHVlIGlzIG92ZXJ3cml0dGVuLlxuXHQgKiBTaG91bGQgYmUgdXNlZCBvbmx5IHdpdGhpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRTZWxlY3Rpb25BdHRyaWJ1dGV9IG1ldGhvZC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjc2V0U2VsZWN0aW9uQXR0cmlidXRlXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiB0aGUgYXR0cmlidXRlIHRvIHNldC5cblx0ICogQHBhcmFtIHZhbHVlIEF0dHJpYnV0ZSB2YWx1ZS5cblx0ICovIF9zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24uc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhbiBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgZnJvbSB0aGUgc2VsZWN0aW9uLlxuXHQgKiBJZiB0aGUgZ2l2ZW4gYXR0cmlidXRlIHdhcyBzZXQgb24gdGhlIHNlbGVjdGlvbiwgZmlyZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24jZXZlbnQ6Y2hhbmdlOnJhbmdlfVxuXHQgKiBldmVudCB3aXRoIHJlbW92ZWQgYXR0cmlidXRlIGtleS5cblx0ICogU2hvdWxkIGJlIHVzZWQgb25seSB3aXRoaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjcmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlfSBtZXRob2QuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI3JlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZVxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGtleSBLZXkgb2YgdGhlIGF0dHJpYnV0ZSB0byByZW1vdmUuXG5cdCAqLyBfcmVtb3ZlQXR0cmlidXRlKGtleSkge1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24ucmVtb3ZlQXR0cmlidXRlKGtleSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGl0ZXJhYmxlIHRoYXQgaXRlcmF0ZXMgdGhyb3VnaCBhbGwgc2VsZWN0aW9uIGF0dHJpYnV0ZXMgc3RvcmVkIGluIGN1cnJlbnQgc2VsZWN0aW9uJ3MgcGFyZW50LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9nZXRTdG9yZWRBdHRyaWJ1dGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLmdldFN0b3JlZEF0dHJpYnV0ZXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRlbXBvcmFyaWx5IGNoYW5nZXMgdGhlIGdyYXZpdHkgb2YgdGhlIHNlbGVjdGlvbiBmcm9tIHRoZSBsZWZ0IHRvIHRoZSByaWdodC5cblx0ICpcblx0ICogVGhlIGdyYXZpdHkgZGVmaW5lcyBmcm9tIHdoaWNoIGRpcmVjdGlvbiB0aGUgc2VsZWN0aW9uIGluaGVyaXRzIGl0cyBhdHRyaWJ1dGVzLiBJZiBpdCdzIHRoZSBkZWZhdWx0IGxlZnRcblx0ICogZ3Jhdml0eSwgdGhlIHNlbGVjdGlvbiAoYWZ0ZXIgYmVpbmcgbW92ZWQgYnkgdGhlIHRoZSB1c2VyKSBpbmhlcml0cyBhdHRyaWJ1dGVzIGZyb20gaXRzIGxlZnQgaGFuZCBzaWRlLlxuXHQgKiBUaGlzIG1ldGhvZCBhbGxvd3MgdG8gdGVtcG9yYXJpbHkgb3ZlcnJpZGUgdGhpcyBiZWhhdmlvciBieSBmb3JjaW5nIHRoZSBncmF2aXR5IHRvIHRoZSByaWdodC5cblx0ICpcblx0ICogSXQgcmV0dXJucyBhbiB1bmlxdWUgaWRlbnRpZmllciB3aGljaCBpcyByZXF1aXJlZCB0byByZXN0b3JlIHRoZSBncmF2aXR5LiBJdCBndWFyYW50ZWVzIHRoZSBzeW1tZXRyeVxuXHQgKiBvZiB0aGUgcHJvY2Vzcy5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjb3ZlcnJpZGVTZWxlY3Rpb25HcmF2aXR5XG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcmV0dXJucyBUaGUgdW5pcXVlIGlkIHdoaWNoIGFsbG93cyByZXN0b3JpbmcgdGhlIGdyYXZpdHkuXG5cdCAqLyBfb3ZlcnJpZGVHcmF2aXR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0aW9uLm92ZXJyaWRlR3Jhdml0eSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVzdG9yZXMgdGhlIHtAbGluayB+RG9jdW1lbnRTZWxlY3Rpb24jX292ZXJyaWRlR3Jhdml0eSBvdmVycmlkZGVuIGdyYXZpdHl9LlxuXHQgKlxuXHQgKiBSZXN0b3JpbmcgdGhlIGdyYXZpdHkgaXMgb25seSBwb3NzaWJsZSB1c2luZyB0aGUgdW5pcXVlIGlkZW50aWZpZXIgcmV0dXJuZWQgYnlcblx0ICoge0BsaW5rIH5Eb2N1bWVudFNlbGVjdGlvbiNfb3ZlcnJpZGVHcmF2aXR5fS4gTm90ZSB0aGF0IHRoZSBncmF2aXR5IHJlbWFpbnMgb3ZlcnJpZGRlbiBhcyBsb25nIGFzIHdvbid0IGJlIHJlc3RvcmVkXG5cdCAqIHRoZSBzYW1lIG51bWJlciBvZiB0aW1lcyBpdCB3YXMgb3ZlcnJpZGRlbi5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjcmVzdG9yZVNlbGVjdGlvbkdyYXZpdHlcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSB1aWQgVGhlIHVuaXF1ZSBpZCByZXR1cm5lZCBieSB7QGxpbmsgI19vdmVycmlkZUdyYXZpdHl9LlxuXHQgKi8gX3Jlc3RvcmVHcmF2aXR5KHVpZCkge1xuICAgICAgICB0aGlzLl9zZWxlY3Rpb24ucmVzdG9yZUdyYXZpdHkodWlkKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdlbmVyYXRlcyBhbmQgcmV0dXJucyBhbiBhdHRyaWJ1dGUga2V5IGZvciBzZWxlY3Rpb24gYXR0cmlidXRlcyBzdG9yZSwgYmFzaW5nIG9uIG9yaWdpbmFsIGF0dHJpYnV0ZSBrZXkuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBrZXkgdG8gY29udmVydC5cblx0ICogQHJldHVybnMgQ29udmVydGVkIGF0dHJpYnV0ZSBrZXksIGFwcGxpY2FibGUgZm9yIHNlbGVjdGlvbiBzdG9yZS5cblx0ICovIHN0YXRpYyBfZ2V0U3RvcmVBdHRyaWJ1dGVLZXkoa2V5KSB7XG4gICAgICAgIHJldHVybiBzdG9yZVByZWZpeCArIGtleTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBhdHRyaWJ1dGUga2V5IGlzIGFuIGF0dHJpYnV0ZSBzdG9yZWQgb24gYW4gZWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBzdGF0aWMgX2lzU3RvcmVBdHRyaWJ1dGVLZXkoa2V5KSB7XG4gICAgICAgIHJldHVybiBrZXkuc3RhcnRzV2l0aChzdG9yZVByZWZpeCk7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuRG9jdW1lbnRTZWxlY3Rpb24ucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnc2VsZWN0aW9uJyB8fCB0eXBlID09ICdtb2RlbDpzZWxlY3Rpb24nIHx8IHR5cGUgPT0gJ2RvY3VtZW50U2VsZWN0aW9uJyB8fCB0eXBlID09ICdtb2RlbDpkb2N1bWVudFNlbGVjdGlvbic7XG59O1xuLyoqXG4gKiBgTGl2ZVNlbGVjdGlvbmAgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9ufSBhbmQgc2hvdWxkbid0IGJlIHVzZWQgZGlyZWN0bHkuXG4gKlxuICogTGl2ZVNlbGVjdGlvbmAgaXMgYXV0b21hdGljYWxseSB1cGRhdGVkIHVwb24gY2hhbmdlcyBpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQgZG9jdW1lbnR9XG4gKiB0byBhbHdheXMgY29udGFpbiB2YWxpZCByYW5nZXMuIEl0cyBhdHRyaWJ1dGVzIGFyZSBpbmhlcml0ZWQgZnJvbSB0aGUgdGV4dCB1bmxlc3Mgc2V0IGV4cGxpY2l0bHkuXG4gKlxuICogRGlmZmVyZW5jZXMgYmV0d2VlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufSBhbmQgYExpdmVTZWxlY3Rpb25gIGFyZTpcbiAqICogdGhlcmUgaXMgYWx3YXlzIGEgcmFuZ2UgaW4gYExpdmVTZWxlY3Rpb25gIC0gZXZlbiBpZiBubyByYW5nZXMgd2VyZSBhZGRlZCB0aGVyZSBpcyBhIFwiZGVmYXVsdCByYW5nZVwiXG4gKiBwcmVzZW50IGluIHRoZSBzZWxlY3Rpb24sXG4gKiAqIHJhbmdlcyBhZGRlZCB0byB0aGlzIHNlbGVjdGlvbiB1cGRhdGVzIGF1dG9tYXRpY2FsbHkgd2hlbiB0aGUgZG9jdW1lbnQgY2hhbmdlcyxcbiAqICogYXR0cmlidXRlcyBvZiBgTGl2ZVNlbGVjdGlvbmAgYXJlIHVwZGF0ZWQgYXV0b21hdGljYWxseSBhY2NvcmRpbmcgdG8gc2VsZWN0aW9uIHJhbmdlcy5cbiAqLyBjbGFzcyBMaXZlU2VsZWN0aW9uIGV4dGVuZHMgU2VsZWN0aW9uIHtcbiAgICAvKipcblx0ICogTGlzdCBvZiBzZWxlY3Rpb24gbWFya2Vycy5cblx0ICogTWFya2VyIGlzIGEgc2VsZWN0aW9uIG1hcmtlciB3aGVuIHNlbGVjdGlvbiByYW5nZSBpcyBpbnNpZGUgdGhlIG1hcmtlciByYW5nZS5cblx0ICovIG1hcmtlcnMgPSBuZXcgQ29sbGVjdGlvbih7XG4gICAgICAgIGlkUHJvcGVydHk6ICduYW1lJ1xuICAgIH0pO1xuICAgIC8qKlxuXHQgKiBEb2N1bWVudCB3aGljaCBvd25zIHRoaXMgc2VsZWN0aW9uLlxuXHQgKi8gX21vZGVsO1xuICAgIC8qKlxuXHQgKiBEb2N1bWVudCB3aGljaCBvd25zIHRoaXMgc2VsZWN0aW9uLlxuXHQgKi8gX2RvY3VtZW50O1xuICAgIC8qKlxuXHQgKiBLZWVwcyBtYXBwaW5nIG9mIGF0dHJpYnV0ZSBuYW1lIHRvIHByaW9yaXR5IHdpdGggd2hpY2ggdGhlIGF0dHJpYnV0ZSBnb3QgbW9kaWZpZWQgKGFkZGVkL2NoYW5nZWQvcmVtb3ZlZClcblx0ICogbGFzdCB0aW1lLiBQb3NzaWJsZSB2YWx1ZXMgb2YgcHJpb3JpdHkgYXJlOiBgJ2xvdydgIGFuZCBgJ25vcm1hbCdgLlxuXHQgKlxuXHQgKiBQcmlvcml0aWVzIGFyZSB1c2VkIGJ5IGludGVybmFsIGBMaXZlU2VsZWN0aW9uYCBtZWNoYW5pc21zLiBBbGwgYXR0cmlidXRlcyBzZXQgdXNpbmcgYExpdmVTZWxlY3Rpb25gXG5cdCAqIGF0dHJpYnV0ZXMgQVBJIGFyZSBzZXQgd2l0aCBgJ25vcm1hbCdgIHByaW9yaXR5LlxuXHQgKi8gX2F0dHJpYnV0ZVByaW9yaXR5ID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBQb3NpdGlvbiB0byB3aGljaCB0aGUgc2VsZWN0aW9uIHNob3VsZCBiZSBzZXQgaWYgdGhlIGxhc3Qgc2VsZWN0aW9uIHJhbmdlIHdhcyBtb3ZlZCB0byB0aGUgZ3JhdmV5YXJkLlxuXHQgKi8gX3NlbGVjdGlvblJlc3RvcmVQb3NpdGlvbiA9IG51bGw7XG4gICAgLyoqXG5cdCAqIEZsYWcgdGhhdCBpbmZvcm1zIHdoZXRoZXIgdGhlIHNlbGVjdGlvbiByYW5nZXMgaGF2ZSBjaGFuZ2VkLiBJdCBpcyBjaGFuZ2VkIG9uIHRydWUgd2hlbiBgTGl2ZVJhbmdlI2NoYW5nZTpyYW5nZWAgZXZlbnQgaXMgZmlyZWQuXG5cdCAqLyBfaGFzQ2hhbmdlZFJhbmdlID0gZmFsc2U7XG4gICAgLyoqXG5cdCAqIEVhY2ggb3ZlcnJpZGluZyBncmF2aXR5IGFkZHMgYW4gVUlEIHRvIHRoZSBzZXQgYW5kIGVhY2ggcmVtb3ZhbCByZW1vdmVzIGl0LlxuXHQgKiBHcmF2aXR5IGlzIG92ZXJyaWRkZW4gd2hlbiB0aGVyZSdzIGF0IGxlYXN0IG9uZSBVSUQgaW4gdGhlIHNldC5cblx0ICogR3Jhdml0eSBpcyByZXN0b3JlZCB3aGVuIHRoZSBzZXQgaXMgZW1wdHkuXG5cdCAqIFRoaXMgaXMgdG8gcHJldmVudCBjb25mbGljdHMgd2hlbiBncmF2aXR5IGlzIG92ZXJyaWRkZW4gYnkgbW9yZSB0aGFuIG9uZSBmZWF0dXJlIGF0IHRoZSBzYW1lIHRpbWUuXG5cdCAqLyBfb3ZlcnJpZGRlbkdyYXZpdHlSZWdpc3RlciA9IG5ldyBTZXQoKTtcbiAgICAvKipcblx0ICogUHJlZml4ZXMgb2YgbWFya2VyIG5hbWVzIHRoYXQgc2hvdWxkIGFmZmVjdCBgTGl2ZVNlbGVjdGlvbiNtYXJrZXJzYCBjb2xsZWN0aW9uLlxuXHQgKi8gX29ic2VydmVkTWFya2VycyA9IG5ldyBTZXQoKTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBlbXB0eSBsaXZlIHNlbGVjdGlvbiBmb3IgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnR9LlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9jIERvY3VtZW50IHdoaWNoIG93bnMgdGhpcyBzZWxlY3Rpb24uXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2Mpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9tb2RlbCA9IGRvYy5tb2RlbDtcbiAgICAgICAgdGhpcy5fZG9jdW1lbnQgPSBkb2M7XG4gICAgICAgIC8vIEVuc3VyZSBzZWxlY3Rpb24gaXMgY29ycmVjdCBhZnRlciBlYWNoIG9wZXJhdGlvbi5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLl9tb2RlbCwgJ2FwcGx5T3BlcmF0aW9uJywgKGV2dCwgYXJncyk9PntcbiAgICAgICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGFyZ3NbMF07XG4gICAgICAgICAgICBpZiAoIW9wZXJhdGlvbi5pc0RvY3VtZW50T3BlcmF0aW9uIHx8IG9wZXJhdGlvbi50eXBlID09ICdtYXJrZXInIHx8IG9wZXJhdGlvbi50eXBlID09ICdyZW5hbWUnIHx8IG9wZXJhdGlvbi50eXBlID09ICdub29wJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZpeCBzZWxlY3Rpb24gaWYgdGhlIGxhc3QgcmFuZ2Ugd2FzIHJlbW92ZWQgZnJvbSBpdCBhbmQgd2UgaGF2ZSBhIHBvc2l0aW9uIHRvIHdoaWNoIHdlIGNhbiByZXN0b3JlIHRoZSBzZWxlY3Rpb24uXG4gICAgICAgICAgICBpZiAodGhpcy5fcmFuZ2VzLmxlbmd0aCA9PSAwICYmIHRoaXMuX3NlbGVjdGlvblJlc3RvcmVQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpeEdyYXZleWFyZFNlbGVjdGlvbih0aGlzLl9zZWxlY3Rpb25SZXN0b3JlUG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gXCJGb3JnZXRcIiB0aGUgcmVzdG9yZSBwb3NpdGlvbiBldmVuIGlmIGl0IHdhcyBub3QgXCJ1c2VkXCIuXG4gICAgICAgICAgICB0aGlzLl9zZWxlY3Rpb25SZXN0b3JlUG9zaXRpb24gPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2hhc0NoYW5nZWRSYW5nZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhc0NoYW5nZWRSYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOnJhbmdlJywge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3RDaGFuZ2U6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gRW5zdXJlIHNlbGVjdGlvbiBpcyBjb3JyZWN0IGFuZCB1cCB0byBkYXRlIGFmdGVyIGVhY2ggcmFuZ2UgY2hhbmdlLlxuICAgICAgICB0aGlzLm9uKCdjaGFuZ2U6cmFuZ2UnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5fdmFsaWRhdGVTZWxlY3Rpb25SYW5nZXModGhpcy5nZXRSYW5nZXMoKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBVcGRhdGUgbWFya2VycyBkYXRhIHN0b3JlZCBieSB0aGUgc2VsZWN0aW9uIGFmdGVyIGVhY2ggbWFya2VyIGNoYW5nZS5cbiAgICAgICAgLy8gVGhpcyBoYW5kbGVzIG9ubHkgbWFya2VyIGNoYW5nZXMgZG9uZSB0aHJvdWdoIG1hcmtlciBvcGVyYXRpb25zIChub3QgbW9kZWwgdHJlZSBjaGFuZ2VzKS5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLl9tb2RlbC5tYXJrZXJzLCAndXBkYXRlJywgKGV2dCwgbWFya2VyLCBvbGRSYW5nZSwgbmV3UmFuZ2UpPT57XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVNYXJrZXIobWFya2VyLCBuZXdSYW5nZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBFbnN1cmUgc2VsZWN0aW9uIGlzIHVwIHRvIGRhdGUgYWZ0ZXIgZWFjaCBjaGFuZ2UgYmxvY2suXG4gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5fZG9jdW1lbnQsICdjaGFuZ2UnLCAoZXZ0LCBiYXRjaCk9PntcbiAgICAgICAgICAgIGNsZWFyQXR0cmlidXRlc1N0b3JlZEluRWxlbWVudCh0aGlzLl9tb2RlbCwgYmF0Y2gpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGlzQ29sbGFwc2VkKCkge1xuICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLl9yYW5nZXMubGVuZ3RoO1xuICAgICAgICByZXR1cm4gbGVuZ3RoID09PSAwID8gdGhpcy5fZG9jdW1lbnQuX2dldERlZmF1bHRSYW5nZSgpLmlzQ29sbGFwc2VkIDogc3VwZXIuaXNDb2xsYXBzZWQ7XG4gICAgfVxuICAgIGdldCBhbmNob3IoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5hbmNob3IgfHwgdGhpcy5fZG9jdW1lbnQuX2dldERlZmF1bHRSYW5nZSgpLnN0YXJ0O1xuICAgIH1cbiAgICBnZXQgZm9jdXMoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5mb2N1cyB8fCB0aGlzLl9kb2N1bWVudC5fZ2V0RGVmYXVsdFJhbmdlKCkuZW5kO1xuICAgIH1cbiAgICBnZXQgcmFuZ2VDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jhbmdlcy5sZW5ndGggPyB0aGlzLl9yYW5nZXMubGVuZ3RoIDogMTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc2NyaWJlcyB3aGV0aGVyIGBMaXZlU2VsZWN0aW9uYCBoYXMgb3duIHJhbmdlKHMpIHNldCwgb3IgaWYgaXQgaXMgZGVmYXVsdGVkIHRvXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I19nZXREZWZhdWx0UmFuZ2UgZG9jdW1lbnQncyBkZWZhdWx0IHJhbmdlfS5cblx0ICovIGdldCBoYXNPd25SYW5nZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jhbmdlcy5sZW5ndGggPiAwO1xuICAgIH1cbiAgICAvKipcblx0ICogV2hlbiBzZXQgdG8gYHRydWVgIHRoZW4gc2VsZWN0aW9uIGF0dHJpYnV0ZXMgb24gbm9kZSBiZWZvcmUgdGhlIGNhcmV0IHdvbid0IGJlIHRha2VuXG5cdCAqIGludG8gY29uc2lkZXJhdGlvbiB3aGlsZSB1cGRhdGluZyBzZWxlY3Rpb24gYXR0cmlidXRlcy5cblx0ICovIGdldCBpc0dyYXZpdHlPdmVycmlkZGVuKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLl9vdmVycmlkZGVuR3Jhdml0eVJlZ2lzdGVyLnNpemU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbmJpbmRzIGFsbCBldmVudHMgcHJldmlvdXNseSBib3VuZCBieSBsaXZlIHNlbGVjdGlvbi5cblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLl9yYW5nZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgdGhpcy5fcmFuZ2VzW2ldLmRldGFjaCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpO1xuICAgIH1cbiAgICAqZ2V0UmFuZ2VzKCkge1xuICAgICAgICBpZiAodGhpcy5fcmFuZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgeWllbGQqIHN1cGVyLmdldFJhbmdlcygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeWllbGQgdGhpcy5fZG9jdW1lbnQuX2dldERlZmF1bHRSYW5nZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldEZpcnN0UmFuZ2UoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRGaXJzdFJhbmdlKCkgfHwgdGhpcy5fZG9jdW1lbnQuX2dldERlZmF1bHRSYW5nZSgpO1xuICAgIH1cbiAgICBnZXRMYXN0UmFuZ2UoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRMYXN0UmFuZ2UoKSB8fCB0aGlzLl9kb2N1bWVudC5fZ2V0RGVmYXVsdFJhbmdlKCk7XG4gICAgfVxuICAgIHNldFRvKC4uLmFyZ3MpIHtcbiAgICAgICAgc3VwZXIuc2V0VG8oLi4uYXJncyk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUF0dHJpYnV0ZXModHJ1ZSk7XG4gICAgICAgIHRoaXMudXBkYXRlTWFya2VycygpO1xuICAgIH1cbiAgICBzZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgICAgIHN1cGVyLnNldEZvY3VzKGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgICAgICB0aGlzLl91cGRhdGVBdHRyaWJ1dGVzKHRydWUpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1hcmtlcnMoKTtcbiAgICB9XG4gICAgc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldEF0dHJpYnV0ZShrZXksIHZhbHVlKSkge1xuICAgICAgICAgICAgLy8gRmlyZSBldmVudCB3aXRoIGV4YWN0IGRhdGEuXG4gICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVLZXlzID0gW1xuICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOmF0dHJpYnV0ZScsIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVLZXlzLFxuICAgICAgICAgICAgICAgIGRpcmVjdENoYW5nZTogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVtb3ZlQXR0cmlidXRlKGtleSkge1xuICAgICAgICBpZiAodGhpcy5fcmVtb3ZlQXR0cmlidXRlKGtleSkpIHtcbiAgICAgICAgICAgIC8vIEZpcmUgZXZlbnQgd2l0aCBleGFjdCBkYXRhLlxuICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlS2V5cyA9IFtcbiAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZTphdHRyaWJ1dGUnLCB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlS2V5cyxcbiAgICAgICAgICAgICAgICBkaXJlY3RDaGFuZ2U6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIG92ZXJyaWRlR3Jhdml0eSgpIHtcbiAgICAgICAgY29uc3Qgb3ZlcnJpZGVVaWQgPSB1aWQoKTtcbiAgICAgICAgLy8gUmVtZW1iZXIgdGhhdCBhbm90aGVyIG92ZXJyaWRpbmcgaGFzIGJlZW4gcmVxdWVzdGVkLiBJdCB3aWxsIG5lZWQgdG8gYmUgcmVtb3ZlZFxuICAgICAgICAvLyBiZWZvcmUgdGhlIGdyYXZpdHkgaXMgdG8gYmUgcmVzdG9yZWQuXG4gICAgICAgIHRoaXMuX292ZXJyaWRkZW5HcmF2aXR5UmVnaXN0ZXIuYWRkKG92ZXJyaWRlVWlkKTtcbiAgICAgICAgaWYgKHRoaXMuX292ZXJyaWRkZW5HcmF2aXR5UmVnaXN0ZXIuc2l6ZSA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQXR0cmlidXRlcyh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3ZlcnJpZGVVaWQ7XG4gICAgfVxuICAgIHJlc3RvcmVHcmF2aXR5KHVpZCkge1xuICAgICAgICBpZiAoIXRoaXMuX292ZXJyaWRkZW5HcmF2aXR5UmVnaXN0ZXIuaGFzKHVpZCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogUmVzdG9yaW5nIGdyYXZpdHkgZm9yIGFuIHVua25vd24gVUlEIGlzIG5vdCBwb3NzaWJsZS4gTWFrZSBzdXJlIHlvdSBhcmUgdXNpbmcgYSBjb3JyZWN0XG5cdFx0XHQgKiBVSUQgb2J0YWluZWQgZnJvbSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNvdmVycmlkZVNlbGVjdGlvbkdyYXZpdHl9IHRvIHJlc3RvcmUuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGRvY3VtZW50LXNlbGVjdGlvbi1ncmF2aXR5LXdyb25nLXJlc3RvcmVcblx0XHRcdCAqIEBwYXJhbSB1aWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIHJldHVybmVkIGJ5XG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiNfb3ZlcnJpZGVHcmF2aXR5fS5cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZG9jdW1lbnQtc2VsZWN0aW9uLWdyYXZpdHktd3JvbmctcmVzdG9yZScsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICB1aWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX292ZXJyaWRkZW5HcmF2aXR5UmVnaXN0ZXIuZGVsZXRlKHVpZCk7XG4gICAgICAgIC8vIFJlc3RvcmUgZ3Jhdml0eSBvbmx5IHdoZW4gYWxsIG92ZXJyaWRpbmcgaGF2ZSBiZWVuIHJlc3RvcmVkLlxuICAgICAgICBpZiAoIXRoaXMuaXNHcmF2aXR5T3ZlcnJpZGRlbikge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQXR0cmlidXRlcyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvYnNlcnZlTWFya2VycyhwcmVmaXhPck5hbWUpIHtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZWRNYXJrZXJzLmFkZChwcmVmaXhPck5hbWUpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1hcmtlcnMoKTtcbiAgICB9XG4gICAgX3JlcGxhY2VBbGxSYW5nZXMocmFuZ2VzKSB7XG4gICAgICAgIHRoaXMuX3ZhbGlkYXRlU2VsZWN0aW9uUmFuZ2VzKHJhbmdlcyk7XG4gICAgICAgIHN1cGVyLl9yZXBsYWNlQWxsUmFuZ2VzKHJhbmdlcyk7XG4gICAgfVxuICAgIF9wb3BSYW5nZSgpIHtcbiAgICAgICAgdGhpcy5fcmFuZ2VzLnBvcCgpLmRldGFjaCgpO1xuICAgIH1cbiAgICBfcHVzaFJhbmdlKHJhbmdlKSB7XG4gICAgICAgIGNvbnN0IGxpdmVSYW5nZSA9IHRoaXMuX3ByZXBhcmVSYW5nZShyYW5nZSk7XG4gICAgICAgIC8vIGB1bmRlZmluZWRgIGlzIHJldHVybmVkIHdoZW4gZ2l2ZW4gYHJhbmdlYCBpcyBpbiBncmF2ZXlhcmQgcm9vdC5cbiAgICAgICAgaWYgKGxpdmVSYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5fcmFuZ2VzLnB1c2gobGl2ZVJhbmdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfdmFsaWRhdGVTZWxlY3Rpb25SYW5nZXMocmFuZ2VzKSB7XG4gICAgICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgcmFuZ2VzKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5fZG9jdW1lbnQuX3ZhbGlkYXRlU2VsZWN0aW9uUmFuZ2UocmFuZ2UpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFJhbmdlIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb24gZG9jdW1lbnQgc2VsZWN0aW9ufVxuXHRcdFx0XHQgKiBzdGFydHMgb3IgZW5kcyBhdCBpbmNvcnJlY3QgcG9zaXRpb24uXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIEBlcnJvciBkb2N1bWVudC1zZWxlY3Rpb24td3JvbmctcG9zaXRpb25cblx0XHRcdFx0ICogQHBhcmFtIHJhbmdlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZG9jdW1lbnQtc2VsZWN0aW9uLXdyb25nLXBvc2l0aW9uJywgdGhpcywge1xuICAgICAgICAgICAgICAgICAgICByYW5nZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQcmVwYXJlcyBnaXZlbiByYW5nZSB0byBiZSBhZGRlZCB0byBzZWxlY3Rpb24uIENoZWNrcyBpZiBpdCBpcyBjb3JyZWN0LFxuXHQgKiBjb252ZXJ0cyBpdCB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcmFuZ2V+TGl2ZVJhbmdlIExpdmVSYW5nZX1cblx0ICogYW5kIHNldHMgbGlzdGVuZXJzIGxpc3RlbmluZyB0byB0aGUgcmFuZ2UncyBjaGFuZ2UgZXZlbnQuXG5cdCAqLyBfcHJlcGFyZVJhbmdlKHJhbmdlKSB7XG4gICAgICAgIHRoaXMuX2NoZWNrUmFuZ2UocmFuZ2UpO1xuICAgICAgICBpZiAocmFuZ2Uucm9vdCA9PSB0aGlzLl9kb2N1bWVudC5ncmF2ZXlhcmQpIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdUcnlpbmcgdG8gYWRkIGEgUmFuZ2UgdGhhdCBpcyBpbiB0aGUgZ3JhdmV5YXJkIHJvb3QuIFJhbmdlIHJlamVjdGVkLicgKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaXZlUmFuZ2UgPSBMaXZlUmFuZ2UuZnJvbVJhbmdlKHJhbmdlKTtcbiAgICAgICAgLy8gSWYgc2VsZWN0aW9uIHJhbmdlIGlzIG1vdmVkIHRvIHRoZSBncmF2ZXlhcmQgcmVtb3ZlIGl0IGZyb20gdGhlIHNlbGVjdGlvbiBvYmplY3QuXG4gICAgICAgIC8vIEFsc28sIHNhdmUgc29tZSBkYXRhIHRoYXQgY2FuIGJlIHVzZWQgdG8gcmVzdG9yZSBzZWxlY3Rpb24gbGF0ZXIsIG9uIGBNb2RlbCNhcHBseU9wZXJhdGlvbmAgZXZlbnQuXG4gICAgICAgIGxpdmVSYW5nZS5vbignY2hhbmdlOnJhbmdlJywgKGV2dCwgb2xkUmFuZ2UsIGRhdGEpPT57XG4gICAgICAgICAgICB0aGlzLl9oYXNDaGFuZ2VkUmFuZ2UgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGxpdmVSYW5nZS5yb290ID09IHRoaXMuX2RvY3VtZW50LmdyYXZleWFyZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdGlvblJlc3RvcmVQb3NpdGlvbiA9IGRhdGEuZGVsZXRpb25Qb3NpdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3Jhbmdlcy5pbmRleE9mKGxpdmVSYW5nZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmFuZ2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgbGl2ZVJhbmdlLmRldGFjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGxpdmVSYW5nZTtcbiAgICB9XG4gICAgdXBkYXRlTWFya2VycygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9vYnNlcnZlZE1hcmtlcnMuc2l6ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hcmtlcnMgPSBbXTtcbiAgICAgICAgbGV0IGNoYW5nZWQgPSBmYWxzZTtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5fbW9kZWwubWFya2Vycyl7XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJHcm91cCA9IG1hcmtlci5uYW1lLnNwbGl0KCc6JywgMSlbMF07XG4gICAgICAgICAgICBpZiAoIXRoaXMuX29ic2VydmVkTWFya2Vycy5oYXMobWFya2VyR3JvdXApKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJSYW5nZSA9IG1hcmtlci5nZXRSYW5nZSgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBzZWxlY3Rpb25SYW5nZSBvZiB0aGlzLmdldFJhbmdlcygpKXtcbiAgICAgICAgICAgICAgICBpZiAobWFya2VyUmFuZ2UuY29udGFpbnNSYW5nZShzZWxlY3Rpb25SYW5nZSwgIXNlbGVjdGlvblJhbmdlLmlzQ29sbGFwc2VkKSkge1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkTWFya2VycyA9IEFycmF5LmZyb20odGhpcy5tYXJrZXJzKTtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgbWFya2Vycyl7XG4gICAgICAgICAgICBpZiAoIXRoaXMubWFya2Vycy5oYXMobWFya2VyKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFya2Vycy5hZGQobWFya2VyKTtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiBBcnJheS5mcm9tKHRoaXMubWFya2Vycykpe1xuICAgICAgICAgICAgaWYgKCFtYXJrZXJzLmluY2x1ZGVzKG1hcmtlcikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtlcnMucmVtb3ZlKG1hcmtlcik7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOm1hcmtlcicsIHtcbiAgICAgICAgICAgICAgICBvbGRNYXJrZXJzLFxuICAgICAgICAgICAgICAgIGRpcmVjdENoYW5nZTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIF91cGRhdGVNYXJrZXIobWFya2VyLCBtYXJrZXJSYW5nZSkge1xuICAgICAgICBjb25zdCBtYXJrZXJHcm91cCA9IG1hcmtlci5uYW1lLnNwbGl0KCc6JywgMSlbMF07XG4gICAgICAgIGlmICghdGhpcy5fb2JzZXJ2ZWRNYXJrZXJzLmhhcyhtYXJrZXJHcm91cCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY2hhbmdlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBvbGRNYXJrZXJzID0gQXJyYXkuZnJvbSh0aGlzLm1hcmtlcnMpO1xuICAgICAgICBjb25zdCBoYXNNYXJrZXIgPSB0aGlzLm1hcmtlcnMuaGFzKG1hcmtlcik7XG4gICAgICAgIGlmICghbWFya2VyUmFuZ2UpIHtcbiAgICAgICAgICAgIGlmIChoYXNNYXJrZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtlcnMucmVtb3ZlKG1hcmtlcik7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgY29udGFpbmVkID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNlbGVjdGlvblJhbmdlIG9mIHRoaXMuZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAgICAgICAgIGlmIChtYXJrZXJSYW5nZS5jb250YWluc1JhbmdlKHNlbGVjdGlvblJhbmdlLCAhc2VsZWN0aW9uUmFuZ2UuaXNDb2xsYXBzZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb250YWluZWQgJiYgIWhhc01hcmtlcikge1xuICAgICAgICAgICAgICAgIHRoaXMubWFya2Vycy5hZGQobWFya2VyKTtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWNvbnRhaW5lZCAmJiBoYXNNYXJrZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1hcmtlcnMucmVtb3ZlKG1hcmtlcik7XG4gICAgICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOm1hcmtlcicsIHtcbiAgICAgICAgICAgICAgICBvbGRNYXJrZXJzLFxuICAgICAgICAgICAgICAgIGRpcmVjdENoYW5nZTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIHRoaXMgc2VsZWN0aW9uIGF0dHJpYnV0ZXMgYWNjb3JkaW5nIHRvIGl0cyByYW5nZXMgYW5kIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBtb2RlbCBkb2N1bWVudH0uXG5cdCAqLyBfdXBkYXRlQXR0cmlidXRlcyhjbGVhckFsbCkge1xuICAgICAgICBjb25zdCBuZXdBdHRyaWJ1dGVzID0gdG9NYXAodGhpcy5fZ2V0U3Vycm91bmRpbmdBdHRyaWJ1dGVzKCkpO1xuICAgICAgICBjb25zdCBvbGRBdHRyaWJ1dGVzID0gdG9NYXAodGhpcy5nZXRBdHRyaWJ1dGVzKCkpO1xuICAgICAgICBpZiAoY2xlYXJBbGwpIHtcbiAgICAgICAgICAgIC8vIElmIGBjbGVhckFsbGAgcmVtb3ZlIGFsbCBhdHRyaWJ1dGVzIGFuZCByZXNldCBwcmlvcml0aWVzLlxuICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlUHJpb3JpdHkgPSBuZXcgTWFwKCk7XG4gICAgICAgICAgICB0aGlzLl9hdHRycyA9IG5ldyBNYXAoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIElmIG5vdCwgcmVtb3ZlIG9ubHkgYXR0cmlidXRlcyBhZGRlZCB3aXRoIGBsb3dgIHByaW9yaXR5LlxuICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCBwcmlvcml0eV0gb2YgdGhpcy5fYXR0cmlidXRlUHJpb3JpdHkpe1xuICAgICAgICAgICAgICAgIGlmIChwcmlvcml0eSA9PSAnbG93Jykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdHRycy5kZWxldGUoa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXR0cmlidXRlUHJpb3JpdHkuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NldEF0dHJpYnV0ZXNUbyhuZXdBdHRyaWJ1dGVzKTtcbiAgICAgICAgLy8gTGV0J3MgZXZhbHVhdGUgd2hpY2ggYXR0cmlidXRlcyByZWFsbHkgY2hhbmdlZC5cbiAgICAgICAgY29uc3QgY2hhbmdlZCA9IFtdO1xuICAgICAgICAvLyBGaXJzdCwgbG9vcCB0aHJvdWdoIGFsbCBhdHRyaWJ1dGVzIHRoYXQgYXJlIHNldCBvbiBzZWxlY3Rpb24gcmlnaHQgbm93LlxuICAgICAgICAvLyBDaGVjayB3aGljaCBvZiB0aGVtIGFyZSBkaWZmZXJlbnQgdGhhbiBvbGQgYXR0cmlidXRlcy5cbiAgICAgICAgZm9yIChjb25zdCBbbmV3S2V5LCBuZXdWYWx1ZV0gb2YgdGhpcy5nZXRBdHRyaWJ1dGVzKCkpe1xuICAgICAgICAgICAgaWYgKCFvbGRBdHRyaWJ1dGVzLmhhcyhuZXdLZXkpIHx8IG9sZEF0dHJpYnV0ZXMuZ2V0KG5ld0tleSkgIT09IG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlZC5wdXNoKG5ld0tleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlbiwgY2hlY2sgd2hpY2ggb2Ygb2xkIGF0dHJpYnV0ZXMgZ290IHJlbW92ZWQuXG4gICAgICAgIGZvciAoY29uc3QgW29sZEtleV0gb2Ygb2xkQXR0cmlidXRlcyl7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaGFzQXR0cmlidXRlKG9sZEtleSkpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkLnB1c2gob2xkS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBGaXJlIGV2ZW50IHdpdGggZXhhY3QgZGF0YSAoZmlyZSBvbmx5IGlmIGFueXRoaW5nIGNoYW5nZWQpLlxuICAgICAgICBpZiAoY2hhbmdlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZTphdHRyaWJ1dGUnLCB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlS2V5czogY2hhbmdlZCxcbiAgICAgICAgICAgICAgICBkaXJlY3RDaGFuZ2U6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogSW50ZXJuYWwgbWV0aG9kIGZvciBzZXR0aW5nIGBMaXZlU2VsZWN0aW9uYCBhdHRyaWJ1dGUuIFN1cHBvcnRzIGF0dHJpYnV0ZSBwcmlvcml0aWVzICh0aHJvdWdoIGBkaXJlY3RDaGFuZ2VgXG5cdCAqIHBhcmFtZXRlcikuXG5cdCAqLyBfc2V0QXR0cmlidXRlKGtleSwgdmFsdWUsIGRpcmVjdENoYW5nZSA9IHRydWUpIHtcbiAgICAgICAgY29uc3QgcHJpb3JpdHkgPSBkaXJlY3RDaGFuZ2UgPyAnbm9ybWFsJyA6ICdsb3cnO1xuICAgICAgICBpZiAocHJpb3JpdHkgPT0gJ2xvdycgJiYgdGhpcy5fYXR0cmlidXRlUHJpb3JpdHkuZ2V0KGtleSkgPT0gJ25vcm1hbCcpIHtcbiAgICAgICAgICAgIC8vIFByaW9yaXR5IHRvbyBsb3cuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdXBlci5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgaWYgdmFsdWUgaGFzIG5vdCBjaGFuZ2VkLlxuICAgICAgICBpZiAob2xkVmFsdWUgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXR0cnMuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICAvLyBVcGRhdGUgcHJpb3JpdGllcyBtYXAuXG4gICAgICAgIHRoaXMuX2F0dHJpYnV0ZVByaW9yaXR5LnNldChrZXksIHByaW9yaXR5KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnRlcm5hbCBtZXRob2QgZm9yIHJlbW92aW5nIGBMaXZlU2VsZWN0aW9uYCBhdHRyaWJ1dGUuIFN1cHBvcnRzIGF0dHJpYnV0ZSBwcmlvcml0aWVzICh0aHJvdWdoIGBkaXJlY3RDaGFuZ2VgXG5cdCAqIHBhcmFtZXRlcikuXG5cdCAqXG5cdCAqIE5PVEU6IEV2ZW4gaWYgYXR0cmlidXRlIGlzIG5vdCBwcmVzZW50IGluIHRoZSBzZWxlY3Rpb24gYnV0IGlzIHByb3ZpZGVkIHRvIHRoaXMgbWV0aG9kLCBpdCdzIHByaW9yaXR5IHdpbGxcblx0ICogYmUgY2hhbmdlZCBhY2NvcmRpbmcgdG8gYGRpcmVjdENoYW5nZWAgcGFyYW1ldGVyLlxuXHQgKi8gX3JlbW92ZUF0dHJpYnV0ZShrZXksIGRpcmVjdENoYW5nZSA9IHRydWUpIHtcbiAgICAgICAgY29uc3QgcHJpb3JpdHkgPSBkaXJlY3RDaGFuZ2UgPyAnbm9ybWFsJyA6ICdsb3cnO1xuICAgICAgICBpZiAocHJpb3JpdHkgPT0gJ2xvdycgJiYgdGhpcy5fYXR0cmlidXRlUHJpb3JpdHkuZ2V0KGtleSkgPT0gJ25vcm1hbCcpIHtcbiAgICAgICAgICAgIC8vIFByaW9yaXR5IHRvbyBsb3cuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIHByaW9yaXRpZXMgbWFwLlxuICAgICAgICB0aGlzLl9hdHRyaWJ1dGVQcmlvcml0eS5zZXQoa2V5LCBwcmlvcml0eSk7XG4gICAgICAgIC8vIERvbid0IGRvIGFueXRoaW5nIGlmIHZhbHVlIGhhcyBub3QgY2hhbmdlZC5cbiAgICAgICAgaWYgKCFzdXBlci5oYXNBdHRyaWJ1dGUoa2V5KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2F0dHJzLmRlbGV0ZShrZXkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEludGVybmFsIG1ldGhvZCBmb3Igc2V0dGluZyBtdWx0aXBsZSBgTGl2ZVNlbGVjdGlvbmAgYXR0cmlidXRlcy4gU3VwcG9ydHMgYXR0cmlidXRlIHByaW9yaXRpZXMgKHRocm91Z2hcblx0ICogYGRpcmVjdENoYW5nZWAgcGFyYW1ldGVyKS5cblx0ICovIF9zZXRBdHRyaWJ1dGVzVG8oYXR0cnMpIHtcbiAgICAgICAgY29uc3QgY2hhbmdlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCBbb2xkS2V5LCBvbGRWYWx1ZV0gb2YgdGhpcy5nZXRBdHRyaWJ1dGVzKCkpe1xuICAgICAgICAgICAgLy8gRG8gbm90IHJlbW92ZSBhdHRyaWJ1dGUgaWYgYXR0cmlidXRlIHdpdGggc2FtZSBrZXkgYW5kIHZhbHVlIGlzIGFib3V0IHRvIGJlIHNldC5cbiAgICAgICAgICAgIGlmIChhdHRycy5nZXQob2xkS2V5KSA9PT0gb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFsbCByZXN0IGF0dHJpYnV0ZXMgd2lsbCBiZSByZW1vdmVkIHNvIGNoYW5nZWQgYXR0cmlidXRlcyB3b24ndCBjaGFuZ2UgLlxuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQXR0cmlidXRlKG9sZEtleSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIGF0dHJzKXtcbiAgICAgICAgICAgIC8vIEF0dHJpYnV0ZSBtYXkgbm90IGJlIHNldCBiZWNhdXNlIG9mIGF0dHJpYnV0ZXMgb3IgYmVjYXVzZSBzYW1lIGtleS92YWx1ZSBpcyBhbHJlYWR5IGFkZGVkLlxuICAgICAgICAgICAgY29uc3QgZ290QWRkZWQgPSB0aGlzLl9zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKGdvdEFkZGVkKSB7XG4gICAgICAgICAgICAgICAgY2hhbmdlZC5hZGQoa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhbmdlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmFibGUgdGhhdCBpdGVyYXRlcyB0aHJvdWdoIGFsbCBzZWxlY3Rpb24gYXR0cmlidXRlcyBzdG9yZWQgaW4gY3VycmVudCBzZWxlY3Rpb24ncyBwYXJlbnQuXG5cdCAqLyAqZ2V0U3RvcmVkQXR0cmlidXRlcygpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uUGFyZW50ID0gdGhpcy5nZXRGaXJzdFBvc2l0aW9uKCkucGFyZW50O1xuICAgICAgICBpZiAodGhpcy5pc0NvbGxhcHNlZCAmJiBzZWxlY3Rpb25QYXJlbnQuaXNFbXB0eSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Ygc2VsZWN0aW9uUGFyZW50LmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKHN0b3JlUHJlZml4KSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZWFsS2V5ID0ga2V5LnN1YnN0cihzdG9yZVByZWZpeC5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCBbXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFsS2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uUGFyZW50LmdldEF0dHJpYnV0ZShrZXkpXG4gICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgbW9kZWwgdGV4dCBub2RlcyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZSBzZWxlY3Rpb24ncyBmaXJzdCBwb3NpdGlvbiBhbmQgcmV0dXJucyBhdHRyaWJ1dGVzIG9mIGZpcnN0XG5cdCAqIGZvdW5kIGVsZW1lbnQuIElmIHRoZXJlIGFyZSBubyB0ZXh0IG5vZGVzIGluIHNlbGVjdGlvbidzIGZpcnN0IHBvc2l0aW9uIHBhcmVudCwgaXQgcmV0dXJucyBzZWxlY3Rpb25cblx0ICogYXR0cmlidXRlcyBzdG9yZWQgaW4gdGhhdCBwYXJlbnQuXG5cdCAqLyBfZ2V0U3Vycm91bmRpbmdBdHRyaWJ1dGVzKCkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLl9tb2RlbC5zY2hlbWE7XG4gICAgICAgIGlmIChwb3NpdGlvbi5yb290LnJvb3ROYW1lID09ICckZ3JhdmV5YXJkJykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGF0dHJzID0gbnVsbDtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAvLyAxLiBJZiBzZWxlY3Rpb24gaXMgYSByYW5nZS4uLlxuICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLmdldEZpcnN0UmFuZ2UoKTtcbiAgICAgICAgICAgIC8vIC4uLmxvb2sgZm9yIGEgZmlyc3QgY2hhcmFjdGVyIG5vZGUgaW4gdGhhdCByYW5nZSBhbmQgdGFrZSBhdHRyaWJ1dGVzIGZyb20gaXQuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlKXtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaXRlbSBpcyBhbiBvYmplY3QsIHdlIGRvbid0IHdhbnQgdG8gZ2V0IGF0dHJpYnV0ZXMgZnJvbSBpdHMgY2hpbGRyZW4uLi5cbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaXRlbS5pcygnZWxlbWVudCcpICYmIHNjaGVtYS5pc09iamVjdCh2YWx1ZS5pdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyAuLi5idXQgY29sbGVjdCBhdHRyaWJ1dGVzIGZyb20gaW5saW5lIG9iamVjdC5cbiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSBnZXRUZXh0QXR0cmlidXRlcyh2YWx1ZS5pdGVtLCBzY2hlbWEpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLnR5cGUgPT0gJ3RleHQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJzID0gdmFsdWUuaXRlbS5nZXRBdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIDIuIElmIHRoZSBzZWxlY3Rpb24gaXMgYSBjYXJldCBvciB0aGUgcmFuZ2UgZG9lcyBub3QgY29udGFpbiBhIGNoYXJhY3RlciBub2RlLi4uXG4gICAgICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gcG9zaXRpb24udGV4dE5vZGUgPyBwb3NpdGlvbi50ZXh0Tm9kZSA6IHBvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXIgPSBwb3NpdGlvbi50ZXh0Tm9kZSA/IHBvc2l0aW9uLnRleHROb2RlIDogcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICAgICAgLy8gV2hlbiBncmF2aXR5IGlzIG92ZXJyaWRkZW4gdGhlbiBkb24ndCB0YWtlIG5vZGUgYmVmb3JlIGludG8gY29uc2lkZXJhdGlvbi5cbiAgICAgICAgICAgIGlmICghdGhpcy5pc0dyYXZpdHlPdmVycmlkZGVuKSB7XG4gICAgICAgICAgICAgICAgLy8gLi4ubG9vayBhdCB0aGUgbm9kZSBiZWZvcmUgY2FyZXQgYW5kIHRha2UgYXR0cmlidXRlcyBmcm9tIGl0IGlmIGl0IGlzIGEgY2hhcmFjdGVyIG5vZGUuXG4gICAgICAgICAgICAgICAgYXR0cnMgPSBnZXRUZXh0QXR0cmlidXRlcyhub2RlQmVmb3JlLCBzY2hlbWEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gMy4gSWYgbm90LCBsb29rIGF0IHRoZSBub2RlIGFmdGVyIGNhcmV0Li4uXG4gICAgICAgICAgICBpZiAoIWF0dHJzKSB7XG4gICAgICAgICAgICAgICAgYXR0cnMgPSBnZXRUZXh0QXR0cmlidXRlcyhub2RlQWZ0ZXIsIHNjaGVtYSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyA0LiBJZiBub3QsIHRyeSB0byBmaW5kIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb24gdGhlIGxlZnQsIHRoYXQgaXMgaW4gdGhlIHNhbWUgbm9kZS5cbiAgICAgICAgICAgIC8vIFdoZW4gZ3Jhdml0eSBpcyBvdmVycmlkZGVuIHRoZW4gZG9uJ3QgdGFrZSBub2RlIGJlZm9yZSBpbnRvIGNvbnNpZGVyYXRpb24uXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNHcmF2aXR5T3ZlcnJpZGRlbiAmJiAhYXR0cnMpIHtcbiAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IG5vZGVCZWZvcmU7XG4gICAgICAgICAgICAgICAgd2hpbGUobm9kZSAmJiAhYXR0cnMpe1xuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJzID0gZ2V0VGV4dEF0dHJpYnV0ZXMobm9kZSwgc2NoZW1hKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyA1LiBJZiBub3QgZm91bmQsIHRyeSB0byBmaW5kIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb24gdGhlIHJpZ2h0LCB0aGF0IGlzIGluIHRoZSBzYW1lIG5vZGUuXG4gICAgICAgICAgICBpZiAoIWF0dHJzKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBub2RlQWZ0ZXI7XG4gICAgICAgICAgICAgICAgd2hpbGUobm9kZSAmJiAhYXR0cnMpe1xuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSBnZXRUZXh0QXR0cmlidXRlcyhub2RlLCBzY2hlbWEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIDYuIElmIG5vdCBmb3VuZCwgc2VsZWN0aW9uIHNob3VsZCByZXRyaWV2ZSBhdHRyaWJ1dGVzIGZyb20gcGFyZW50LlxuICAgICAgICAgICAgaWYgKCFhdHRycykge1xuICAgICAgICAgICAgICAgIGF0dHJzID0gdGhpcy5nZXRTdG9yZWRBdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF0dHJzO1xuICAgIH1cbiAgICAvKipcblx0ICogRml4ZXMgdGhlIHNlbGVjdGlvbiBhZnRlciBhbGwgaXRzIHJhbmdlcyBnb3QgcmVtb3ZlZC5cblx0ICogQHBhcmFtIGRlbGV0aW9uUG9zaXRpb24gUG9zaXRpb24gd2hlcmUgdGhlIGRlbGV0aW9uIGhhcHBlbmVkLlxuXHQgKi8gX2ZpeEdyYXZleWFyZFNlbGVjdGlvbihkZWxldGlvblBvc2l0aW9uKSB7XG4gICAgICAgIC8vIEZpbmQgYSByYW5nZSB0aGF0IGlzIGEgY29ycmVjdCBzZWxlY3Rpb24gcmFuZ2UgYW5kIGlzIGNsb3Nlc3QgdG8gdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBkZWxldGlvbiBoYXBwZW5lZC5cbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uUmFuZ2UgPSB0aGlzLl9tb2RlbC5zY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKGRlbGV0aW9uUG9zaXRpb24pO1xuICAgICAgICAvLyBJZiBuZWFyZXN0IHZhbGlkIHNlbGVjdGlvbiByYW5nZSBoYXMgYmVlbiBmb3VuZCAtIGFkZCBpdCBpbiB0aGUgcGxhY2Ugb2Ygb2xkIHJhbmdlLlxuICAgICAgICBpZiAoc2VsZWN0aW9uUmFuZ2UpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIHRoZSByYW5nZSwgY29udmVydCBpdCB0byBsaXZlIHJhbmdlLCBiaW5kIGV2ZW50cywgZXRjLlxuICAgICAgICAgICAgdGhpcy5fcHVzaFJhbmdlKHNlbGVjdGlvblJhbmdlKTtcbiAgICAgICAgfVxuICAgIC8vIElmIG5lYXJlc3QgdmFsaWQgc2VsZWN0aW9uIHJhbmdlIGNhbm5vdCBiZSBmb3VuZCBkb24ndCBhZGQgYW55IHJhbmdlLiBTZWxlY3Rpb24gd2lsbCBiZSBzZXQgdG8gdGhlIGRlZmF1bHQgcmFuZ2UuXG4gICAgfVxufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2xpdmVzZWxlY3Rpb25+TGl2ZVNlbGVjdGlvbiNfdXBkYXRlQXR0cmlidXRlc30uXG4gKlxuICogSXQgY2hlY2tzIGlmIHRoZSBwYXNzZWQgbW9kZWwgaXRlbSBpcyBhIHRleHQgbm9kZSAob3IgdGV4dCBwcm94eSkgYW5kLCBpZiBzbywgcmV0dXJucyBpdCdzIGF0dHJpYnV0ZXMuXG4gKiBJZiBub3QsIGl0IGNoZWNrcyBpZiBpdGVtIGlzIGFuIGlubGluZSBvYmplY3QgYW5kIGRvZXMgdGhlIHNhbWUuIE90aGVyd2lzZSBpdCByZXR1cm5zIGBudWxsYC5cbiAqLyBmdW5jdGlvbiBnZXRUZXh0QXR0cmlidXRlcyhub2RlLCBzY2hlbWEpIHtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmIChub2RlIGluc3RhbmNlb2YgVGV4dFByb3h5IHx8IG5vZGUgaW5zdGFuY2VvZiBUZXh0KSB7XG4gICAgICAgIHJldHVybiBub2RlLmdldEF0dHJpYnV0ZXMoKTtcbiAgICB9XG4gICAgaWYgKCFzY2hlbWEuaXNJbmxpbmUobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIFN0b3Agb24gaW5saW5lIGVsZW1lbnRzIChzdWNoIGFzIGA8c29mdEJyZWFrPmApIHRoYXQgYXJlIG5vdCBvYmplY3RzIChzdWNoIGFzIGA8aW1hZ2VJbmxpbmU+YCBvciBgPG1hdGhtbD5gKS5cbiAgICBpZiAoIXNjaGVtYS5pc09iamVjdChub2RlKSkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAvLyBDb2xsZWN0IGFsbCBhdHRyaWJ1dGVzIHRoYXQgY2FuIGJlIGFwcGxpZWQgdG8gdGhlIHRleHQgbm9kZS5cbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBub2RlLmdldEF0dHJpYnV0ZXMoKSl7XG4gICAgICAgIGlmIChzY2hlbWEuY2hlY2tBdHRyaWJ1dGUoJyR0ZXh0Jywga2V5KSAmJiBzY2hlbWEuZ2V0QXR0cmlidXRlUHJvcGVydGllcyhrZXkpLmNvcHlGcm9tT2JqZWN0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFtcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhdHRyaWJ1dGVzO1xufVxuLyoqXG4gKiBSZW1vdmVzIHNlbGVjdGlvbiBhdHRyaWJ1dGVzIGZyb20gZWxlbWVudCB3aGljaCBpcyBub3QgZW1wdHkgYW55bW9yZS5cbiAqLyBmdW5jdGlvbiBjbGVhckF0dHJpYnV0ZXNTdG9yZWRJbkVsZW1lbnQobW9kZWwsIGJhdGNoKSB7XG4gICAgY29uc3QgZGlmZmVyID0gbW9kZWwuZG9jdW1lbnQuZGlmZmVyO1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZGlmZmVyLmdldENoYW5nZXMoKSl7XG4gICAgICAgIGlmIChlbnRyeS50eXBlICE9ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFuZ2VQYXJlbnQgPSBlbnRyeS5wb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IGlzTm9Mb25nZXJFbXB0eSA9IGVudHJ5Lmxlbmd0aCA9PT0gY2hhbmdlUGFyZW50Lm1heE9mZnNldDtcbiAgICAgICAgaWYgKGlzTm9Mb25nZXJFbXB0eSkge1xuICAgICAgICAgICAgbW9kZWwuZW5xdWV1ZUNoYW5nZShiYXRjaCwgKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9yZWRBdHRyaWJ1dGVzID0gQXJyYXkuZnJvbShjaGFuZ2VQYXJlbnQuZ2V0QXR0cmlidXRlS2V5cygpKS5maWx0ZXIoKGtleSk9PmtleS5zdGFydHNXaXRoKHN0b3JlUHJlZml4KSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Ygc3RvcmVkQXR0cmlidXRlcyl7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoa2V5LCBjaGFuZ2VQYXJlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFuIGludGVyZmFjZSB0byBvcGVyYXRlIG9uIGEgbGlzdCBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUgbm9kZXN9LiBgTm9kZUxpc3RgIGlzIHVzZWQgaW50ZXJuYWxseVxuICogaW4gY2xhc3NlcyBsaWtlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCBFbGVtZW50fVxuICogb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IERvY3VtZW50RnJhZ21lbnR9LlxuICovIGNsYXNzIE5vZGVMaXN0IHtcbiAgICAvKipcblx0ICogTm9kZXMgY29udGFpbmVkIGluIHRoaXMgbm9kZSBsaXN0LlxuXHQgKi8gX25vZGVzID0gW107XG4gICAgLyoqXG5cdCAqIFRoaXMgYXJyYXkgbWFwcyBudW1iZXJzIChvZmZzZXRzKSB0byBub2RlIHRoYXQgaXMgcGxhY2VkIGF0IHRoYXQgb2Zmc2V0LlxuXHQgKlxuXHQgKiBUaGlzIGFycmF5IGlzIHNpbWlsYXIgdG8gYF9ub2Rlc2Agd2l0aCB0aGUgZGlmZmVyZW5jZSB0aGF0IG9uZSBub2RlIG1heSBvY2N1cHkgbXVsdGlwbGUgY29uc2VjdXRpdmUgaXRlbXMgaW4gdGhlIGFycmF5LlxuXHQgKlxuXHQgKiBUaGlzIGFycmF5IGlzIG5lZWRlZCB0byBxdWlja2x5IHJldHJpZXZlIGEgbm9kZSB0aGF0IGlzIHBsYWNlZCBhdCBnaXZlbiBvZmZzZXQuXG5cdCAqLyBfb2Zmc2V0VG9Ob2RlID0gW107XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBub2RlIGxpc3QuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gbm9kZXMgTm9kZXMgY29udGFpbmVkIGluIHRoaXMgbm9kZSBsaXN0LlxuXHQgKi8gY29uc3RydWN0b3Iobm9kZXMpe1xuICAgICAgICBpZiAobm9kZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2luc2VydE5vZGVzKDAsIG5vZGVzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmFibGUgaW50ZXJmYWNlLlxuXHQgKlxuXHQgKiBJdGVyYXRlcyBvdmVyIGFsbCBub2RlcyBjb250YWluZWQgaW5zaWRlIHRoaXMgbm9kZSBsaXN0LlxuXHQgKi8gW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ub2Rlc1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOdW1iZXIgb2Ygbm9kZXMgY29udGFpbmVkIGluc2lkZSB0aGlzIG5vZGUgbGlzdC5cblx0ICovIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ub2Rlcy5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTdW0gb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI29mZnNldFNpemUgb2Zmc2V0IHNpemVzfSBvZiBhbGwgbm9kZXMgY29udGFpbmVkIGluc2lkZSB0aGlzIG5vZGUgbGlzdC5cblx0ICovIGdldCBtYXhPZmZzZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXRUb05vZGUubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyB0aGUgbm9kZSBhdCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMgYG51bGxgIGlmIGluY29ycmVjdCBpbmRleCB3YXMgcGFzc2VkLlxuXHQgKi8gZ2V0Tm9kZShpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbm9kZXNbaW5kZXhdIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBub2RlIGF0IHRoZSBnaXZlbiBvZmZzZXQuIFJldHVybnMgYG51bGxgIGlmIGluY29ycmVjdCBvZmZzZXQgd2FzIHBhc3NlZC5cblx0ICovIGdldE5vZGVBdE9mZnNldChvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldFRvTm9kZVtvZmZzZXRdIHx8IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIGluZGV4IG9mIHRoZSBnaXZlbiBub2RlIG9yIGBudWxsYCBpZiBnaXZlbiBub2RlIGRvZXMgbm90IGhhdmUgYSBwYXJlbnQuXG5cdCAqXG5cdCAqIFRoaXMgaXMgYW4gYWxpYXMgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI2luZGV4fS5cblx0ICovIGdldE5vZGVJbmRleChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlLmluZGV4O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgb2Zmc2V0IGF0IHdoaWNoIGdpdmVuIG5vZGUgaXMgcGxhY2VkIGluIGl0cyBwYXJlbnQgb3IgYG51bGxgIGlmIGdpdmVuIG5vZGUgZG9lcyBub3QgaGF2ZSBhIHBhcmVudC5cblx0ICpcblx0ICogVGhpcyBpcyBhbiBhbGlhcyB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjc3RhcnRPZmZzZXR9LlxuXHQgKi8gZ2V0Tm9kZVN0YXJ0T2Zmc2V0KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUuc3RhcnRPZmZzZXQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBpbmRleCB0byBvZmZzZXQgaW4gbm9kZSBsaXN0LlxuXHQgKlxuXHQgKiBUaHJvd3Mge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgQ0tFZGl0b3JFcnJvcn0gYG1vZGVsLW5vZGVsaXN0LWluZGV4LW91dC1vZi1ib3VuZHNgIGlmIGdpdmVuIGluZGV4IGlzIGxlc3Ncblx0ICogdGhhbiBgMGAgb3IgbW9yZSB0aGFuIHtAbGluayAjbGVuZ3RofS5cblx0ICovIGluZGV4VG9PZmZzZXQoaW5kZXgpIHtcbiAgICAgICAgaWYgKGluZGV4ID09IHRoaXMuX25vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF4T2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLl9ub2Rlc1tpbmRleF07XG4gICAgICAgIGlmICghbm9kZSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHaXZlbiBpbmRleCBjYW5ub3QgYmUgZm91bmQgaW4gdGhlIG5vZGUgbGlzdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtbm9kZWxpc3QtaW5kZXgtb3V0LW9mLWJvdW5kc1xuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1ub2RlbGlzdC1pbmRleC1vdXQtb2YtYm91bmRzJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Tm9kZVN0YXJ0T2Zmc2V0KG5vZGUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgb2Zmc2V0IGluIG5vZGUgbGlzdCB0byBpbmRleC5cblx0ICpcblx0ICogVGhyb3dzIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIENLRWRpdG9yRXJyb3J9IGBtb2RlbC1ub2RlbGlzdC1vZmZzZXQtb3V0LW9mLWJvdW5kc2AgaWYgZ2l2ZW4gb2Zmc2V0IGlzIGxlc3Ncblx0ICogdGhhbiBgMGAgb3IgbW9yZSB0aGFuIHtAbGluayAjbWF4T2Zmc2V0fS5cblx0ICovIG9mZnNldFRvSW5kZXgob2Zmc2V0KSB7XG4gICAgICAgIGlmIChvZmZzZXQgPT0gdGhpcy5fb2Zmc2V0VG9Ob2RlLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25vZGVzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBub2RlID0gdGhpcy5fb2Zmc2V0VG9Ob2RlW29mZnNldF07XG4gICAgICAgIGlmICghbm9kZSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHaXZlbiBvZmZzZXQgY2Fubm90IGJlIGZvdW5kIGluIHRoZSBub2RlIGxpc3QuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1vZGVsLW5vZGVsaXN0LW9mZnNldC1vdXQtb2YtYm91bmRzXG5cdFx0XHQgKiBAcGFyYW0gb2Zmc2V0XG5cdFx0XHQgKiBAcGFyYW0gbm9kZUxpc3QgU3RyaW5naWZpZWQgbm9kZSBsaXN0LlxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1ub2RlbGlzdC1vZmZzZXQtb3V0LW9mLWJvdW5kcycsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICAgICAgbm9kZUxpc3Q6IHRoaXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldE5vZGVJbmRleChub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgZ2l2ZW4gbm9kZXMgYXQgZ2l2ZW4gaW5kZXguXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaW5kZXggSW5kZXggYXQgd2hpY2ggbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gbm9kZXMgTm9kZXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqLyBfaW5zZXJ0Tm9kZXMoaW5kZXgsIG5vZGVzKSB7XG4gICAgICAgIGNvbnN0IG5vZGVzQXJyYXkgPSBbXTtcbiAgICAgICAgLy8gVmFsaWRhdGlvbi5cbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKXtcbiAgICAgICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBOb2RlJDEpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFRyeWluZyB0byBpbnNlcnQgYW4gb2JqZWN0IHdoaWNoIGlzIG5vdCBhIE5vZGUgaW5zdGFuY2UuXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIEBlcnJvciBtb2RlbC1ub2RlbGlzdC1pbnNlcnRub2Rlcy1ub3Qtbm9kZVxuXHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLW5vZGVsaXN0LWluc2VydG5vZGVzLW5vdC1ub2RlJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2Rlc0FycmF5LnB1c2gobm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG9mZnNldCA9IHRoaXMuaW5kZXhUb09mZnNldChpbmRleCk7XG4gICAgICAgIC8vIFNwbGljZSBub2RlcyBhcnJheSBhbmQgb2Zmc2V0cyBhcnJheSBpbnRvIHRoZSBub2RlbGlzdC5cbiAgICAgICAgc3BsaWNlQXJyYXkodGhpcy5fbm9kZXMsIG5vZGVzQXJyYXksIGluZGV4KTtcbiAgICAgICAgc3BsaWNlQXJyYXkodGhpcy5fb2Zmc2V0VG9Ob2RlLCBtYWtlT2Zmc2V0c0FycmF5KG5vZGVzQXJyYXkpLCBvZmZzZXQpO1xuICAgICAgICAvLyBSZWZyZXNoIGluZGV4ZXMgYW5kIG9mZnNldHMgZm9yIG5vZGVzIGluc2lkZSB0aGlzIG5vZGUgbGlzdC4gV2UgbmVlZCB0byBkbyB0aGlzIGZvciBhbGwgaW5zZXJ0ZWQgbm9kZXMgYW5kIGFsbCBub2RlcyBhZnRlciB0aGVtLlxuICAgICAgICBmb3IobGV0IGkgPSBpbmRleDsgaSA8IHRoaXMuX25vZGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIHRoaXMuX25vZGVzW2ldLl9pbmRleCA9IGk7XG4gICAgICAgICAgICB0aGlzLl9ub2Rlc1tpXS5fc3RhcnRPZmZzZXQgPSBvZmZzZXQ7XG4gICAgICAgICAgICBvZmZzZXQgKz0gdGhpcy5fbm9kZXNbaV0ub2Zmc2V0U2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBvbmUgb3IgbW9yZSBub2RlcyBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gaW5kZXguXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaW5kZXhTdGFydCBJbmRleCBvZiB0aGUgZmlyc3Qgbm9kZSB0byByZW1vdmUuXG5cdCAqIEBwYXJhbSBob3dNYW55IE51bWJlciBvZiBub2RlcyB0byByZW1vdmUuXG5cdCAqIEByZXR1cm5zIEFycmF5IGNvbnRhaW5pbmcgcmVtb3ZlZCBub2Rlcy5cblx0ICovIF9yZW1vdmVOb2RlcyhpbmRleFN0YXJ0LCBob3dNYW55ID0gMSkge1xuICAgICAgICBpZiAoaG93TWFueSA9PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVtb3ZlIG5vZGVzIGZyb20gdGhpcyBub2RlbGlzdC5cbiAgICAgICAgbGV0IG9mZnNldCA9IHRoaXMuaW5kZXhUb09mZnNldChpbmRleFN0YXJ0KTtcbiAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLl9ub2Rlcy5zcGxpY2UoaW5kZXhTdGFydCwgaG93TWFueSk7XG4gICAgICAgIGNvbnN0IGxhc3ROb2RlID0gbm9kZXNbbm9kZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIGNvbnN0IHJlbW92ZWRPZmZzZXRTdW0gPSBsYXN0Tm9kZS5zdGFydE9mZnNldCArIGxhc3ROb2RlLm9mZnNldFNpemUgLSBvZmZzZXQ7XG4gICAgICAgIHRoaXMuX29mZnNldFRvTm9kZS5zcGxpY2Uob2Zmc2V0LCByZW1vdmVkT2Zmc2V0U3VtKTtcbiAgICAgICAgLy8gUmVzZXQgaW5kZXggYW5kIHN0YXJ0IG9mZnNldCBwcm9wZXJ0aWVzIGZvciB0aGUgcmVtb3ZlZCBub2RlcyAtLSB0aGV5IGRvIG5vdCBoYXZlIGEgcGFyZW50IGFueW1vcmUuXG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICBub2RlLl9pbmRleCA9IG51bGw7XG4gICAgICAgICAgICBub2RlLl9zdGFydE9mZnNldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZm9yKGxldCBpID0gaW5kZXhTdGFydDsgaSA8IHRoaXMuX25vZGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIHRoaXMuX25vZGVzW2ldLl9pbmRleCA9IGk7XG4gICAgICAgICAgICB0aGlzLl9ub2Rlc1tpXS5fc3RhcnRPZmZzZXQgPSBvZmZzZXQ7XG4gICAgICAgICAgICBvZmZzZXQgKz0gdGhpcy5fbm9kZXNbaV0ub2Zmc2V0U2l6ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGNoaWxkcmVuIG5vZGVzIHByb3ZpZGVkIGFzIGFuIGFycmF5LiBUaGVzZSBub2RlcyBkbyBub3QgbmVlZCB0byBiZSBkaXJlY3Qgc2libGluZ3MuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGlzIGZhc3RlciB0aGFuIHJlbW92aW5nIG5vZGVzIG9uZSBieSBvbmUsIGFzIGl0IHJlY2FsY3VsYXRlcyBvZmZzZXRzIG9ubHkgb25jZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBub2RlcyBBcnJheSBvZiBub2Rlcy5cblx0ICovIF9yZW1vdmVOb2Rlc0FycmF5KG5vZGVzKSB7XG4gICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICBub2RlLl9pbmRleCA9IG51bGw7XG4gICAgICAgICAgICBub2RlLl9zdGFydE9mZnNldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbm9kZXMgPSB0aGlzLl9ub2Rlcy5maWx0ZXIoKG5vZGUpPT5ub2RlLmluZGV4ICE9PSBudWxsKTtcbiAgICAgICAgdGhpcy5fb2Zmc2V0VG9Ob2RlID0gdGhpcy5fb2Zmc2V0VG9Ob2RlLmZpbHRlcigobm9kZSk9Pm5vZGUuaW5kZXggIT09IG51bGwpO1xuICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX25vZGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIHRoaXMuX25vZGVzW2ldLl9pbmRleCA9IGk7XG4gICAgICAgICAgICB0aGlzLl9ub2Rlc1tpXS5fc3RhcnRPZmZzZXQgPSBvZmZzZXQ7XG4gICAgICAgICAgICBvZmZzZXQgKz0gdGhpcy5fbm9kZXNbaV0ub2Zmc2V0U2l6ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgYE5vZGVMaXN0YCBpbnN0YW5jZSB0byBhbiBhcnJheSBjb250YWluaW5nIG5vZGVzIHRoYXQgd2VyZSBpbnNlcnRlZCBpbiB0aGUgbm9kZSBsaXN0LiBOb2Rlc1xuXHQgKiBhcmUgYWxzbyBjb252ZXJ0ZWQgdG8gdGhlaXIgcGxhaW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBgTm9kZUxpc3RgIGluc3RhbmNlIGNvbnZlcnRlZCB0byBgQXJyYXlgLlxuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbm9kZXMubWFwKChub2RlKT0+bm9kZS50b0pTT04oKSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGFuIGFycmF5IG9mIG5vZGVzIGluIHRoZSBmb3JtYXQgYXMgaW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZWxpc3R+Tm9kZUxpc3QjX29mZnNldFRvTm9kZX0sIGkuZS4gb25lIG5vZGUgd2lsbFxuICogb2NjdXB5IG11bHRpcGxlIGl0ZW1zIGlmIGl0cyBvZmZzZXQgc2l6ZSBpcyBncmVhdGVyIHRoYW4gb25lLlxuICovIGZ1bmN0aW9uIG1ha2VPZmZzZXRzQXJyYXkobm9kZXMpIHtcbiAgICBjb25zdCBvZmZzZXRzID0gW107XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbm9kZS5vZmZzZXRTaXplOyBpKyspe1xuICAgICAgICAgICAgb2Zmc2V0c1tpbmRleCsrXSA9IG5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldHM7XG59XG5cbi8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gY29uc3QgeyBzdHJpbmdpZnlNYXAsIGNvbnZlcnRNYXBUb1N0cmluZ2lmaWVkT2JqZWN0LCBjb252ZXJ0TWFwVG9UYWdzIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLyoqXG4gKiBNb2RlbCBlbGVtZW50LiBUeXBlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSBub2RlfSB0aGF0IGhhcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCNuYW1lIG5hbWV9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50I2dldENoaWxkcmVuIGNoaWxkIG5vZGVzfS5cbiAqXG4gKiAqKkltcG9ydGFudCoqOiBzZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSB0byByZWFkIGFib3V0IHJlc3RyaWN0aW9ucyB1c2luZyBgRWxlbWVudGAgYW5kIGBOb2RlYCBBUEkuXG4gKi8gY2xhc3MgRWxlbWVudCBleHRlbmRzIE5vZGUkMSB7XG4gICAgLyoqXG5cdCAqIEVsZW1lbnQgbmFtZS5cblx0ICovIG5hbWU7XG4gICAgLyoqXG5cdCAqIExpc3Qgb2YgY2hpbGRyZW4gbm9kZXMuXG5cdCAqLyBfY2hpbGRyZW4gPSBuZXcgTm9kZUxpc3QoKTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1vZGVsIGVsZW1lbnQuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBDb25zdHJ1Y3RvciBvZiB0aGlzIGNsYXNzIHNob3VsZG4ndCBiZSB1c2VkIGRpcmVjdGx5IGluIHRoZSBjb2RlLlxuXHQgKiBVc2UgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjY3JlYXRlRWxlbWVudH0gbWV0aG9kIGluc3RlYWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gbmFtZSBFbGVtZW50J3MgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIEVsZW1lbnQncyBhdHRyaWJ1dGVzLiBTZWUge0BsaW5rIG1vZHVsZTp1dGlscy90b21hcH50b01hcH0gZm9yIGEgbGlzdCBvZiBhY2NlcHRlZCB2YWx1ZXMuXG5cdCAqIEBwYXJhbSBjaGlsZHJlbiBPbmUgb3IgbW9yZSBub2RlcyB0byBiZSBpbnNlcnRlZCBhcyBjaGlsZHJlbiBvZiBjcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjb25zdHJ1Y3RvcihuYW1lLCBhdHRycywgY2hpbGRyZW4pe1xuICAgICAgICBzdXBlcihhdHRycyk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIGlmIChjaGlsZHJlbikge1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0Q2hpbGQoMCwgY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBOdW1iZXIgb2YgdGhpcyBlbGVtZW50J3MgY2hpbGRyZW4uXG5cdCAqLyBnZXQgY2hpbGRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN1bSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjb2Zmc2V0U2l6ZSBvZmZzZXQgc2l6ZXN9IG9mIGFsbCBvZiB0aGlzIGVsZW1lbnQncyBjaGlsZHJlbi5cblx0ICovIGdldCBtYXhPZmZzZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5tYXhPZmZzZXQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJcyBgdHJ1ZWAgaWYgdGhlcmUgYXJlIG5vIG5vZGVzIGluc2lkZSB0aGlzIGVsZW1lbnQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gZ2V0IGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkQ291bnQgPT09IDA7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBjaGlsZCBhdCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMgYG51bGxgIGlmIGluY29ycmVjdCBpbmRleCB3YXMgcGFzc2VkLlxuXHQgKlxuXHQgKiBAcGFyYW0gaW5kZXggSW5kZXggaW4gdGhpcyBlbGVtZW50LlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlLlxuXHQgKi8gZ2V0Q2hpbGQoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmdldE5vZGUoaW5kZXgpO1xuICAgIH1cbiAgICAvKipcblx0ICogR2V0cyB0aGUgY2hpbGQgYXQgdGhlIGdpdmVuIG9mZnNldC4gUmV0dXJucyBgbnVsbGAgaWYgaW5jb3JyZWN0IGluZGV4IHdhcyBwYXNzZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IGluIHRoaXMgZWxlbWVudC5cblx0ICogQHJldHVybnMgQ2hpbGQgbm9kZS5cblx0ICovIGdldENoaWxkQXRPZmZzZXQob2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5nZXROb2RlQXRPZmZzZXQob2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCBvZiB0aGlzIGVsZW1lbnQncyBjaGlsZHJlbi5cblx0ICovIGdldENoaWxkcmVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpbmRleCBvZiB0aGUgZ2l2ZW4gY2hpbGQgbm9kZS4gUmV0dXJucyBgbnVsbGAgaWYgZ2l2ZW4gbm9kZSBpcyBub3QgYSBjaGlsZCBvZiB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIENoaWxkIG5vZGUgdG8gbG9vayBmb3IuXG5cdCAqIEByZXR1cm5zIENoaWxkIG5vZGUncyBpbmRleCBpbiB0aGlzIGVsZW1lbnQuXG5cdCAqLyBnZXRDaGlsZEluZGV4KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmdldE5vZGVJbmRleChub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIHN0YXJ0aW5nIG9mZnNldCBvZiBnaXZlbiBjaGlsZC4gU3RhcnRpbmcgb2Zmc2V0IGlzIGVxdWFsIHRvIHRoZSBzdW0gb2Zcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI29mZnNldFNpemUgb2Zmc2V0IHNpemVzfSBvZiBhbGwgbm9kZSdzIHNpYmxpbmdzIHRoYXQgYXJlIGJlZm9yZSBpdC4gUmV0dXJucyBgbnVsbGAgaWZcblx0ICogZ2l2ZW4gbm9kZSBpcyBub3QgYSBjaGlsZCBvZiB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIENoaWxkIG5vZGUgdG8gbG9vayBmb3IuXG5cdCAqIEByZXR1cm5zIENoaWxkIG5vZGUncyBzdGFydGluZyBvZmZzZXQuXG5cdCAqLyBnZXRDaGlsZFN0YXJ0T2Zmc2V0KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmdldE5vZGVTdGFydE9mZnNldChub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaW5kZXggb2YgYSBub2RlIHRoYXQgb2NjdXBpZXMgZ2l2ZW4gb2Zmc2V0LiBJZiBnaXZlbiBvZmZzZXQgaXMgdG9vIGxvdywgcmV0dXJucyBgMGAuIElmIGdpdmVuIG9mZnNldCBpc1xuXHQgKiB0b28gaGlnaCwgcmV0dXJucyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQjZ2V0Q2hpbGRJbmRleCBpbmRleCBhZnRlciBsYXN0IGNoaWxkfS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdGV4dE5vZGUgPSBuZXcgVGV4dCggJ2ZvbycgKTtcblx0ICogY29uc3QgcEVsZW1lbnQgPSBuZXcgRWxlbWVudCggJ3AnICk7XG5cdCAqIGNvbnN0IGRpdkVsZW1lbnQgPSBuZXcgRWxlbWVudCggWyB0ZXh0Tm9kZSwgcEVsZW1lbnQgXSApO1xuXHQgKiBkaXZFbGVtZW50Lm9mZnNldFRvSW5kZXgoIC0xICk7IC8vIFJldHVybnMgMCwgYmVjYXVzZSBvZmZzZXQgaXMgdG9vIGxvdy5cblx0ICogZGl2RWxlbWVudC5vZmZzZXRUb0luZGV4KCAwICk7IC8vIFJldHVybnMgMCwgYmVjYXVzZSBvZmZzZXQgMCBpcyB0YWtlbiBieSBgdGV4dE5vZGVgIHdoaWNoIGlzIGF0IGluZGV4IDAuXG5cdCAqIGRpdkVsZW1lbnQub2Zmc2V0VG9JbmRleCggMSApOyAvLyBSZXR1cm5zIDAsIGJlY2F1c2UgYHRleHROb2RlYCBoYXMgYG9mZnNldFNpemVgIGVxdWFsIHRvIDMsIHNvIGl0IG9jY3VwaWVzIG9mZnNldCAxIHRvby5cblx0ICogZGl2RWxlbWVudC5vZmZzZXRUb0luZGV4KCAyICk7IC8vIFJldHVybnMgMC5cblx0ICogZGl2RWxlbWVudC5vZmZzZXRUb0luZGV4KCAzICk7IC8vIFJldHVybnMgMS5cblx0ICogZGl2RWxlbWVudC5vZmZzZXRUb0luZGV4KCA0ICk7IC8vIFJldHVybnMgMi4gVGhlcmUgYXJlIG5vIG5vZGVzIGF0IG9mZnNldCA0LCBzbyBsYXN0IGF2YWlsYWJsZSBpbmRleCBpcyByZXR1cm5lZC5cblx0ICogYGBgXG5cdCAqLyBvZmZzZXRUb0luZGV4KG9mZnNldCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4ub2Zmc2V0VG9JbmRleChvZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGRlc2NlbmRhbnQgbm9kZSBieSBpdHMgcGF0aCByZWxhdGl2ZSB0byB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIDx0aGlzPmE8Yj5jPC9iPjwvdGhpcz5cblx0ICogdGhpcy5nZXROb2RlQnlQYXRoKCBbIDAgXSApOyAgICAgLy8gLT4gXCJhXCJcblx0ICogdGhpcy5nZXROb2RlQnlQYXRoKCBbIDEgXSApOyAgICAgLy8gLT4gPGI+XG5cdCAqIHRoaXMuZ2V0Tm9kZUJ5UGF0aCggWyAxLCAwIF0gKTsgIC8vIC0+IFwiY1wiXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIFBhdGggb2YgdGhlIG5vZGUgdG8gZmluZCwgcmVsYXRpdmUgdG8gdGhpcyBlbGVtZW50LlxuXHQgKi8gZ2V0Tm9kZUJ5UGF0aChyZWxhdGl2ZVBhdGgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzLCBjb25zaXN0ZW50LXRoaXNcbiAgICAgICAgbGV0IG5vZGUgPSB0aGlzO1xuICAgICAgICBmb3IgKGNvbnN0IG9mZnNldCBvZiByZWxhdGl2ZVBhdGgpe1xuICAgICAgICAgICAgbm9kZSA9IG5vZGUuZ2V0Q2hpbGRBdE9mZnNldChvZmZzZXQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgcGFyZW50IGVsZW1lbnQgb2YgdGhlIGdpdmVuIG5hbWUuIFJldHVybnMgbnVsbCBpZiB0aGUgZWxlbWVudCBpcyBub3QgaW5zaWRlIHRoZSBkZXNpcmVkIHBhcmVudC5cblx0ICpcblx0ICogQHBhcmFtIHBhcmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmVudCBlbGVtZW50IHRvIGZpbmQuXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5pbmNsdWRlU2VsZiBXaGVuIHNldCB0byBgdHJ1ZWAgdGhpcyBub2RlIHdpbGwgYmUgYWxzbyBpbmNsdWRlZCB3aGlsZSBzZWFyY2hpbmcuXG5cdCAqLyBmaW5kQW5jZXN0b3IocGFyZW50TmFtZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGxldCBwYXJlbnQgPSBvcHRpb25zLmluY2x1ZGVTZWxmID8gdGhpcyA6IHRoaXMucGFyZW50O1xuICAgICAgICB3aGlsZShwYXJlbnQpe1xuICAgICAgICAgICAgaWYgKHBhcmVudC5uYW1lID09PSBwYXJlbnROYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBgRWxlbWVudGAgaW5zdGFuY2UgdG8gcGxhaW4gb2JqZWN0IGFuZCByZXR1cm5zIGl0LiBUYWtlcyBjYXJlIG9mIGNvbnZlcnRpbmcgYWxsIG9mIHRoaXMgZWxlbWVudCdzIGNoaWxkcmVuLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBgRWxlbWVudGAgaW5zdGFuY2UgY29udmVydGVkIHRvIHBsYWluIG9iamVjdC5cblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBqc29uLm5hbWUgPSB0aGlzLm5hbWU7XG4gICAgICAgIGlmICh0aGlzLl9jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBqc29uLmNoaWxkcmVuID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpcy5fY2hpbGRyZW4pe1xuICAgICAgICAgICAgICAgIGpzb24uY2hpbGRyZW4ucHVzaChub2RlLnRvSlNPTigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgZWxlbWVudCBhbmQgcmV0dXJucyBpdC4gQ3JlYXRlZCBlbGVtZW50IGhhcyB0aGUgc2FtZSBuYW1lIGFuZCBhdHRyaWJ1dGVzIGFzIHRoZSBvcmlnaW5hbCBlbGVtZW50LlxuXHQgKiBJZiBjbG9uZSBpcyBkZWVwLCB0aGUgb3JpZ2luYWwgZWxlbWVudCdzIGNoaWxkcmVuIGFyZSBhbHNvIGNsb25lZC4gSWYgbm90LCB0aGVuIGVtcHR5IGVsZW1lbnQgaXMgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gZGVlcCBJZiBzZXQgdG8gYHRydWVgIGNsb25lcyBlbGVtZW50IGFuZCBhbGwgaXRzIGNoaWxkcmVuIHJlY3Vyc2l2ZWx5LiBXaGVuIHNldCB0byBgZmFsc2VgLFxuXHQgKiBlbGVtZW50IHdpbGwgYmUgY2xvbmVkIHdpdGhvdXQgYW55IGNoaWxkLlxuXHQgKi8gX2Nsb25lKGRlZXAgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGRlZXAgPyBjbG9uZU5vZGVzKHRoaXMuX2NoaWxkcmVuKSA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50KHRoaXMubmFtZSwgdGhpcy5nZXRBdHRyaWJ1dGVzKCksIGNoaWxkcmVuKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2VsZW1lbnR+RWxlbWVudCNfaW5zZXJ0Q2hpbGQgSW5zZXJ0c30gb25lIG9yIG1vcmUgbm9kZXMgYXQgdGhlIGVuZCBvZiB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2FwcGVuZFxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIG5vZGVzIE5vZGVzIHRvIGJlIGluc2VydGVkLlxuXHQgKi8gX2FwcGVuZENoaWxkKG5vZGVzKSB7XG4gICAgICAgIHRoaXMuX2luc2VydENoaWxkKHRoaXMuY2hpbGRDb3VudCwgbm9kZXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyBvbmUgb3IgbW9yZSBub2RlcyBhdCB0aGUgZ2l2ZW4gaW5kZXggYW5kIHNldHMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI3BhcmVudCBwYXJlbnR9IG9mIHRoZXNlIG5vZGVzXG5cdCAqIHRvIHRoaXMgZWxlbWVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjaW5zZXJ0XG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaW5kZXggSW5kZXggYXQgd2hpY2ggbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqLyBfaW5zZXJ0Q2hpbGQoaW5kZXgsIGl0ZW1zKSB7XG4gICAgICAgIGNvbnN0IG5vZGVzID0gbm9ybWFsaXplJDEoaXRlbXMpO1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICAgICAgLy8gSWYgbm9kZSB0aGF0IGlzIGJlaW5nIGFkZGVkIHRvIHRoaXMgZWxlbWVudCBpcyBhbHJlYWR5IGluc2lkZSBhbm90aGVyIGVsZW1lbnQsIGZpcnN0IHJlbW92ZSBpdCBmcm9tIHRoZSBvbGQgcGFyZW50LlxuICAgICAgICAgICAgaWYgKG5vZGUucGFyZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbm9kZS5fcmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2hpbGRyZW4uX2luc2VydE5vZGVzKGluZGV4LCBub2Rlcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIG9uZSBvciBtb3JlIG5vZGVzIHN0YXJ0aW5nIGF0IHRoZSBnaXZlbiBpbmRleCBhbmQgc2V0c1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjcGFyZW50IHBhcmVudH0gb2YgdGhlc2Ugbm9kZXMgdG8gYG51bGxgLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNyZW1vdmVcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgZmlyc3Qgbm9kZSB0byByZW1vdmUuXG5cdCAqIEBwYXJhbSBob3dNYW55IE51bWJlciBvZiBub2RlcyB0byByZW1vdmUuXG5cdCAqIEByZXR1cm5zIEFycmF5IGNvbnRhaW5pbmcgcmVtb3ZlZCBub2Rlcy5cblx0ICovIF9yZW1vdmVDaGlsZHJlbihpbmRleCwgaG93TWFueSA9IDEpIHtcbiAgICAgICAgY29uc3Qgbm9kZXMgPSB0aGlzLl9jaGlsZHJlbi5fcmVtb3ZlTm9kZXMoaW5kZXgsIGhvd01hbnkpO1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICAgICAgbm9kZS5wYXJlbnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgY2hpbGRyZW4gbm9kZXMgcHJvdmlkZWQgYXMgYW4gYXJyYXkgYW5kIHNldHNcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL25vZGV+Tm9kZSNwYXJlbnQgcGFyZW50fSBvZiB0aGVzZSBub2RlcyB0byBgbnVsbGAuXG5cdCAqXG5cdCAqIFRoZXNlIG5vZGVzIGRvIG5vdCBuZWVkIHRvIGJlIGRpcmVjdCBzaWJsaW5ncy5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgZmFzdGVyIHRoYW4gcmVtb3Zpbmcgbm9kZXMgb25lIGJ5IG9uZSwgYXMgaXQgcmVjYWxjdWxhdGVzIG9mZnNldHMgb25seSBvbmNlLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIG5vZGVzIEFycmF5IG9mIG5vZGVzLlxuXHQgKi8gX3JlbW92ZUNoaWxkcmVuQXJyYXkobm9kZXMpIHtcbiAgICAgICAgdGhpcy5fY2hpbGRyZW4uX3JlbW92ZU5vZGVzQXJyYXkobm9kZXMpO1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICAgICAgbm9kZS5wYXJlbnQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGBFbGVtZW50YCBpbnN0YW5jZSBmcm9tIGdpdmVuIHBsYWluIG9iamVjdCAoaS5lLiBwYXJzZWQgSlNPTiBzdHJpbmcpLlxuXHQgKiBDb252ZXJ0cyBgRWxlbWVudGAgY2hpbGRyZW4gdG8gcHJvcGVyIG5vZGVzLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBQbGFpbiBvYmplY3QgdG8gYmUgY29udmVydGVkIHRvIGBFbGVtZW50YC5cblx0ICogQHJldHVybnMgYEVsZW1lbnRgIGluc3RhbmNlIGNyZWF0ZWQgdXNpbmcgZ2l2ZW4gcGxhaW4gb2JqZWN0LlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24pIHtcbiAgICAgICAgbGV0IGNoaWxkcmVuO1xuICAgICAgICBpZiAoanNvbi5jaGlsZHJlbikge1xuICAgICAgICAgICAgY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YganNvbi5jaGlsZHJlbil7XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgY2hpbGQgaGFzIG5hbWUgcHJvcGVydHksIGl0IGlzIGFuIEVsZW1lbnQuXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goRWxlbWVudC5mcm9tSlNPTihjaGlsZCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaXQgaXMgYSBUZXh0IG5vZGUuXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goVGV4dC5mcm9tSlNPTihjaGlsZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IEVsZW1lbnQoanNvbi5uYW1lLCBqc29uLmF0dHJpYnV0ZXMsIGNoaWxkcmVuKTtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5FbGVtZW50LnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUgPT09ICdlbGVtZW50JyB8fCB0eXBlID09PSAnbW9kZWw6ZWxlbWVudCcgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgICAgIHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAnbW9kZWw6bm9kZSc7XG4gICAgfVxuICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICdlbGVtZW50JyB8fCB0eXBlID09PSAnbW9kZWw6ZWxlbWVudCcpO1xufTtcbi8qKlxuICogQ29udmVydHMgc3RyaW5ncyB0byBUZXh0IGFuZCBub24taXRlcmFibGVzIHRvIGFycmF5cy5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemUkMShub2Rlcykge1xuICAgIC8vIFNlcGFyYXRlIGNvbmRpdGlvbiBiZWNhdXNlIHN0cmluZyBpcyBpdGVyYWJsZS5cbiAgICBpZiAodHlwZW9mIG5vZGVzID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgVGV4dChub2RlcylcbiAgICAgICAgXTtcbiAgICB9XG4gICAgaWYgKCFpc0l0ZXJhYmxlKG5vZGVzKSkge1xuICAgICAgICBub2RlcyA9IFtcbiAgICAgICAgICAgIG5vZGVzXG4gICAgICAgIF07XG4gICAgfVxuICAgIGNvbnN0IG5vcm1hbGl6ZWROb2RlcyA9IFtdO1xuICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbm9ybWFsaXplZE5vZGVzLnB1c2gobmV3IFRleHQobm9kZSkpO1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGUgaW5zdGFuY2VvZiBUZXh0UHJveHkpIHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZWROb2Rlcy5wdXNoKG5ldyBUZXh0KG5vZGUuZGF0YSwgbm9kZS5nZXRBdHRyaWJ1dGVzKCkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZWROb2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVkTm9kZXM7XG59XG5mdW5jdGlvbiBjbG9uZU5vZGVzKG5vZGVzKSB7XG4gICAgY29uc3QgY2xvbmVkTm9kZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICBjbG9uZWROb2Rlcy5wdXNoKG5vZGUuX2Nsb25lKHRydWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIGNsb25lZE5vZGVzO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIGVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25oZWxwZXJzXG4gKi8gLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBjb252ZXJzaW9uIGhlbHBlcnMuXG4gKi8gY2xhc3MgQ29udmVyc2lvbkhlbHBlcnMge1xuICAgIF9kaXNwYXRjaGVycztcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIGNvbnZlcnNpb24gaGVscGVycyBpbnN0YW5jZS5cblx0ICovIGNvbnN0cnVjdG9yKGRpc3BhdGNoZXJzKXtcbiAgICAgICAgdGhpcy5fZGlzcGF0Y2hlcnMgPSBkaXNwYXRjaGVycztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIGNvbnZlcnNpb24gaGVscGVyLlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogU2VlIGZ1bGwgdXNhZ2UgZXhhbXBsZSBpbiB0aGUgYHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBjb252ZXJzaW9uLmZvcigpfWBcblx0ICogbWV0aG9kIGRlc2NyaXB0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29udmVyc2lvbkhlbHBlciBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uIGV2ZW50LlxuXHQgKi8gYWRkKGNvbnZlcnNpb25IZWxwZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBkaXNwYXRjaGVyIG9mIHRoaXMuX2Rpc3BhdGNoZXJzKXtcbiAgICAgICAgICAgIGNvbnZlcnNpb25IZWxwZXIoZGlzcGF0Y2hlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuXG4vKipcbiAqIERvd25jYXN0IGNvbnZlcnNpb24gaGVscGVyIGZ1bmN0aW9ucy5cbiAqXG4gKiBMZWFybiBtb3JlIGFib3V0IHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9jb252ZXJzaW9uL2Rvd25jYXN0IGRvd25jYXN0IGhlbHBlcnN9LlxuICpcbiAqIEBleHRlbmRzIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9uaGVscGVyc35Db252ZXJzaW9uSGVscGVyc1xuICovIGNsYXNzIERvd25jYXN0SGVscGVycyBleHRlbmRzIENvbnZlcnNpb25IZWxwZXJzIHtcbiAgICAvKipcblx0ICogTW9kZWwgZWxlbWVudCB0byB2aWV3IGVsZW1lbnQgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIFRoaXMgY29udmVyc2lvbiByZXN1bHRzIGluIGNyZWF0aW5nIGEgdmlldyBlbGVtZW50LiBGb3IgZXhhbXBsZSwgbW9kZWwgYDxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+YCBiZWNvbWVzIGA8cD5Gb288L3A+YCBpbiB0aGUgdmlldy5cblx0ICpcblx0ICogYGBgdHNcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkuZWxlbWVudFRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAncGFyYWdyYXBoJyxcblx0ICogXHR2aWV3OiAncCdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdwYXJhZ3JhcGgnLFxuXHQgKiBcdHZpZXc6ICdkaXYnLFxuXHQgKiBcdGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdmYW5jeVBhcmFncmFwaCcsXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0bmFtZTogJ3AnLFxuXHQgKiBcdFx0Y2xhc3NlczogJ2ZhbmN5J1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdoZWFkaW5nJyxcblx0ICogXHR2aWV3OiAoIG1vZGVsRWxlbWVudCwgY29udmVyc2lvbkFwaSApID0+IHtcblx0ICogXHRcdGNvbnN0IHsgd3JpdGVyIH0gPSBjb252ZXJzaW9uQXBpO1xuXHQgKlxuXHQgKiBcdFx0cmV0dXJuIHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAnaCcgKyBtb2RlbEVsZW1lbnQuZ2V0QXR0cmlidXRlKCAnbGV2ZWwnICkgKTtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFRoZSBlbGVtZW50LXRvLWVsZW1lbnQgY29udmVyc2lvbiBzdXBwb3J0cyB0aGUgcmVjb252ZXJzaW9uIG1lY2hhbmlzbS4gSXQgY2FuIGJlIGVuYWJsZWQgYnkgdXNpbmcgZWl0aGVyIHRoZSBgYXR0cmlidXRlc2Agb3Jcblx0ICogdGhlIGBjaGlsZHJlbmAgcHJvcHMgb24gYSBtb2RlbCBkZXNjcmlwdGlvbi4gWW91IHdpbGwgZmluZCBhIGNvdXBsZSBleGFtcGxlcyBiZWxvdy5cblx0ICpcblx0ICogSW4gb3JkZXIgdG8gcmVjb252ZXJ0IGFuIGVsZW1lbnQgaWYgYW55IG9mIGl0cyBkaXJlY3QgY2hpbGRyZW4gaGF2ZSBiZWVuIGFkZGVkIG9yIHJlbW92ZWQsIHVzZSB0aGUgYGNoaWxkcmVuYCBwcm9wZXJ0eSBvbiBhIGBtb2RlbGBcblx0ICogZGVzY3JpcHRpb24uIEZvciBleGFtcGxlLCB0aGlzIG1vZGVsOlxuXHQgKlxuXHQgKiBgYGB4bWxcblx0ICogPGJveD5cblx0ICogXHQ8cGFyYWdyYXBoPlNvbWUgdGV4dC48L3BhcmFncmFwaD5cblx0ICogPC9ib3g+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiB3aWxsIGJlIGNvbnZlcnRlZCBpbnRvIHRoaXMgc3RydWN0dXJlIGluIHRoZSB2aWV3OlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxkaXYgY2xhc3M9XCJib3hcIiBkYXRhLXR5cGU9XCJzaW5nbGVcIj5cblx0ICogXHQ8cD5Tb21lIHRleHQuPC9wPlxuXHQgKiA8L2Rpdj5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEJ1dCBpZiBtb3JlIGl0ZW1zIHdlcmUgaW5zZXJ0ZWQgaW4gdGhlIG1vZGVsOlxuXHQgKlxuXHQgKiBgYGB4bWxcblx0ICogPGJveD5cblx0ICogXHQ8cGFyYWdyYXBoPlNvbWUgdGV4dC48L3BhcmFncmFwaD5cblx0ICogXHQ8cGFyYWdyYXBoPk90aGVyIGl0ZW0uPC9wYXJhZ3JhcGg+XG5cdCAqIDwvYm94PlxuXHQgKiBgYGBcblx0ICpcblx0ICogaXQgd2lsbCBiZSBjb252ZXJ0ZWQgaW50byB0aGlzIHN0cnVjdHVyZSBpbiB0aGUgdmlldyAobm90ZSB0aGUgZWxlbWVudCBgZGF0YS10eXBlYCBjaGFuZ2UpOlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxkaXYgY2xhc3M9XCJib3hcIiBkYXRhLXR5cGU9XCJtdWx0aXBsZVwiPlxuXHQgKiBcdDxwPlNvbWUgdGV4dC48L3A+XG5cdCAqIFx0PHA+T3RoZXIgaXRlbS48L3A+XG5cdCAqIDwvZGl2PlxuXHQgKiBgYGBcblx0ICpcblx0ICogU3VjaCBhIGNvbnZlcnRlciB3b3VsZCBsb29rIGxpa2UgdGhpcyAobm90ZSB0aGF0IHRoZSBgcGFyYWdyYXBoYCBlbGVtZW50cyBhcmUgY29udmVydGVkIHNlcGFyYXRlbHkpOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6IHtcblx0ICogXHRcdG5hbWU6ICdib3gnLFxuXHQgKiBcdFx0Y2hpbGRyZW46IHRydWVcblx0ICogXHR9LFxuXHQgKiBcdHZpZXc6ICggbW9kZWxFbGVtZW50LCBjb252ZXJzaW9uQXBpICkgPT4ge1xuXHQgKiBcdFx0Y29uc3QgeyB3cml0ZXIgfSA9IGNvbnZlcnNpb25BcGk7XG5cdCAqXG5cdCAqIFx0XHRyZXR1cm4gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICdkaXYnLCB7XG5cdCAqIFx0XHRcdGNsYXNzOiAnYm94Jyxcblx0ICogXHRcdFx0J2RhdGEtdHlwZSc6IG1vZGVsRWxlbWVudC5jaGlsZENvdW50ID09IDEgPyAnc2luZ2xlJyA6ICdtdWx0aXBsZSdcblx0ICogXHRcdH0gKTtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEluIG9yZGVyIHRvIHJlY29udmVydCBlbGVtZW50IGlmIGFueSBvZiBpdHMgYXR0cmlidXRlcyBoYXZlIGJlZW4gdXBkYXRlZCwgdXNlIHRoZSBgYXR0cmlidXRlc2AgcHJvcGVydHkgb24gYSBgbW9kZWxgXG5cdCAqIGRlc2NyaXB0aW9uLiBGb3IgZXhhbXBsZSwgdGhpcyBtb2RlbDpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDxoZWFkaW5nIGxldmVsPVwiMlwiPlNvbWUgdGV4dC48L2hlYWRpbmc+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiB3aWxsIGJlIGNvbnZlcnRlZCBpbnRvIHRoaXMgc3RydWN0dXJlIGluIHRoZSB2aWV3OlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxoMj5Tb21lIHRleHQuPC9oMj5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEJ1dCBpZiB0aGUgYGhlYWRpbmdgIGVsZW1lbnQncyBgbGV2ZWxgIGF0dHJpYnV0ZSBoYXMgYmVlbiB1cGRhdGVkIHRvIGAzYCBmb3IgZXhhbXBsZSwgdGhlblxuXHQgKiBpdCB3aWxsIGJlIGNvbnZlcnRlZCBpbnRvIHRoaXMgc3RydWN0dXJlIGluIHRoZSB2aWV3OlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxoMz5Tb21lIHRleHQuPC9oMz5cblx0ICogYGBgXG5cdCAqXG5cdCAqIFN1Y2ggYSBjb252ZXJ0ZXIgd291bGQgbG9vayBhcyBmb2xsb3dzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6IHtcblx0ICogXHRcdG5hbWU6ICdoZWFkaW5nJyxcblx0ICogXHRcdGF0dHJpYnV0ZXM6ICdsZXZlbCdcblx0ICogXHR9LFxuXHQgKiBcdHZpZXc6ICggbW9kZWxFbGVtZW50LCBjb252ZXJzaW9uQXBpICkgPT4ge1xuXHQgKiBcdFx0Y29uc3QgeyB3cml0ZXIgfSA9IGNvbnZlcnNpb25BcGk7XG5cdCAqXG5cdCAqIFx0XHRyZXR1cm4gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICdoJyArIG1vZGVsRWxlbWVudC5nZXRBdHRyaWJ1dGUoICdsZXZlbCcgKSApO1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBgY29udmVyc2lvbi5mb3IoKWB9IHRvIGxlYXJuIGhvdyB0byBhZGQgYSBjb252ZXJ0ZXJcblx0ICogdG8gdGhlIGNvbnZlcnNpb24gcHJvY2Vzcy5cblx0ICpcblx0ICogWW91IGNhbiByZWFkIG1vcmUgYWJvdXQgdGhlIGVsZW1lbnQtdG8tZWxlbWVudCBjb252ZXJzaW9uIGluIHRoZVxuXHQgKiB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvY29udmVyc2lvbi9kb3duY2FzdCBkb3duY2FzdCBjb252ZXJzaW9ufSBndWlkZS5cblx0ICpcblx0ICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG5cdCAqIEBwYXJhbSBjb25maWcubW9kZWwgVGhlIGRlc2NyaXB0aW9uIG9yIGEgbmFtZSBvZiB0aGUgbW9kZWwgZWxlbWVudCB0byBjb252ZXJ0LlxuXHQgKiBAcGFyYW0gY29uZmlnLm1vZGVsLmF0dHJpYnV0ZXMgVGhlIGxpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIGJlIGNvbnN1bWVkIHdoaWxlIGNyZWF0aW5nXG5cdCAqIHRoZSB2aWV3IGVsZW1lbnQuIE5vdGUgdGhhdCB0aGUgdmlldyB3aWxsIGJlIHJlY29udmVydGVkIGlmIGFueSBvZiB0aGUgbGlzdGVkIGF0dHJpYnV0ZXMgY2hhbmdlcy5cbiBcdCAqIEBwYXJhbSBjb25maWcubW9kZWwuY2hpbGRyZW4gU3BlY2lmaWVzIHdoZXRoZXIgdGhlIHZpZXcgZWxlbWVudCByZXF1aXJlcyByZWNvbnZlcnNpb24gaWYgdGhlIGxpc3Rcblx0ICogb2YgdGhlIG1vZGVsIGNoaWxkIG5vZGVzIGNoYW5nZWQuXG5cdCAqIEBwYXJhbSBjb25maWcudmlldyBBIHZpZXcgZWxlbWVudCBkZWZpbml0aW9uIG9yIGEgZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgbW9kZWwgZWxlbWVudCBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3RDb252ZXJzaW9uQXBpIGRvd25jYXN0IGNvbnZlcnNpb24gQVBJfVxuXHQgKiBhcyBwYXJhbWV0ZXJzIGFuZCByZXR1cm5zIGEgdmlldyBjb250YWluZXIgZWxlbWVudC5cblx0ICovIGVsZW1lbnRUb0VsZW1lbnQoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZChkb3duY2FzdEVsZW1lbnRUb0VsZW1lbnQoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgbW9kZWwgZWxlbWVudCB0byB2aWV3IHN0cnVjdHVyZSAoc2V2ZXJhbCBlbGVtZW50cykgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIFRoaXMgY29udmVyc2lvbiByZXN1bHRzIGluIGNyZWF0aW5nIGEgdmlldyBzdHJ1Y3R1cmUgd2l0aCBvbmUgb3IgbW9yZSBzbG90cyBkZWZpbmVkIGZvciB0aGUgY2hpbGQgbm9kZXMuXG5cdCAqIEZvciBleGFtcGxlLCBhIG1vZGVsIGA8dGFibGU+YCBtYXkgYmVjb21lIHRoaXMgc3RydWN0dXJlIGluIHRoZSB2aWV3OlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxmaWd1cmUgY2xhc3M9XCJ0YWJsZVwiPlxuXHQgKiBcdDx0YWJsZT5cblx0ICogXHRcdDx0Ym9keT4keyBzbG90IGZvciB0YWJsZSByb3dzIH08L3Rib2R5PlxuXHQgKiBcdDwvdGFibGU+XG5cdCAqIDwvZmlndXJlPlxuXHQgKiBgYGBcblx0ICpcblx0ICogVGhlIGNoaWxkcmVuIG9mIHRoZSBtb2RlbCdzIGA8dGFibGU+YCBlbGVtZW50IHdpbGwgYmUgaW5zZXJ0ZWQgaW50byB0aGUgYDx0Ym9keT5gIGVsZW1lbnQuXG5cdCAqIElmIHRoZSBgZWxlbWVudFRvRWxlbWVudCgpYCBoZWxwZXIgd2FzIHVzZWQsIHRoZSBjaGlsZHJlbiB3b3VsZCBiZSBpbnNlcnRlZCBpbnRvIHRoZSBgPGZpZ3VyZT5gLlxuXHQgKlxuXHQgKiBJbWFnaW5lIGEgdGFibGUgZmVhdHVyZSB3aGVyZSBmb3IgdGhpcyBtb2RlbCBzdHJ1Y3R1cmU6XG5cdCAqXG5cdCAqIGBgYHhtbFxuXHQgKiA8dGFibGUgaGVhZGluZ1Jvd3M9XCIxXCI+XG5cdCAqIFx0PHRhYmxlUm93PiAuLi4gdGFibGUgY2VsbHMgMSAuLi4gPC90YWJsZVJvdz5cblx0ICogXHQ8dGFibGVSb3c+IC4uLiB0YWJsZSBjZWxscyAyIC4uLiA8L3RhYmxlUm93PlxuXHQgKiBcdDx0YWJsZVJvdz4gLi4uIHRhYmxlIGNlbGxzIDMgLi4uIDwvdGFibGVSb3c+XG5cdCAqIFx0PGNhcHRpb24+Q2FwdGlvbiB0ZXh0PC9jYXB0aW9uPlxuXHQgKiA8L3RhYmxlPlxuXHQgKiBgYGBcblx0ICpcblx0ICogd2Ugd2FudCB0byBnZW5lcmF0ZSB0aGlzIHZpZXcgc3RydWN0dXJlOlxuXHQgKlxuXHQgKiBgYGBodG1sXG5cdCAqIDxmaWd1cmUgY2xhc3M9XCJ0YWJsZVwiPlxuXHQgKiBcdDx0YWJsZT5cblx0ICogXHRcdDx0aGVhZD5cblx0ICogXHRcdFx0PHRyPiAuLi4gdGFibGUgY2VsbHMgMSAuLi4gPC90cj5cblx0ICogXHRcdDwvdGhlYWQ+XG5cdCAqIFx0XHQ8dGJvZHk+XG5cdCAqIFx0XHRcdDx0cj4gLi4uIHRhYmxlIGNlbGxzIDIgLi4uIDwvdHI+XG5cdCAqIFx0XHRcdDx0cj4gLi4uIHRhYmxlIGNlbGxzIDMgLi4uIDwvdHI+XG5cdCAqIFx0XHQ8L3Rib2R5PlxuXHQgKiBcdDwvdGFibGU+XG5cdCAqIFx0PGZpZ2NhcHRpb24+Q2FwdGlvbiB0ZXh0PC9maWdjYXB0aW9uPlxuXHQgKiA8L2ZpZ3VyZT5cblx0ICogYGBgXG5cdCAqXG5cdCAqIFRoZSBjb252ZXJ0ZXIgaGFzIHRvIHRha2UgdGhlIGBoZWFkaW5nUm93c2AgYXR0cmlidXRlIGludG8gY29uc2lkZXJhdGlvbiB3aGVuIGFsbG9jYXRpbmcgdGhlIGA8dGFibGVSb3c+YCBlbGVtZW50c1xuXHQgKiBpbnRvIHRoZSBgPHRib2R5PmAgYW5kIGA8dGhlYWQ+YCBlbGVtZW50cy4gSGVuY2UsIHdlIG5lZWQgdHdvIHNsb3RzIGFuZCBuZWVkIHRvIGRlZmluZSBwcm9wZXIgZmlsdGVyIGNhbGxiYWNrcyBmb3IgdGhlbS5cblx0ICpcblx0ICogQWRkaXRpb25hbGx5LCBhbGwgZWxlbWVudHMgb3RoZXIgdGhhbiBgPHRhYmxlUm93PmAgc2hvdWxkIGJlIHBsYWNlZCBvdXRzaWRlIHRoZSBgPHRhYmxlPmAgdGFnLlxuXHQgKiBJbiB0aGUgZXhhbXBsZSBhYm92ZSwgdGhpcyB3aWxsIGhhbmRsZSB0aGUgdGFibGUgY2FwdGlvbi5cblx0ICpcblx0ICogU3VjaCBhIGNvbnZlcnRlciB3b3VsZCBsb29rIGxpa2UgdGhpczpcblx0ICpcblx0ICogYGBgdHNcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkuZWxlbWVudFRvU3RydWN0dXJlKCB7XG5cdCAqIFx0bW9kZWw6IHtcblx0ICogXHRcdG5hbWU6ICd0YWJsZScsXG5cdCAqIFx0XHRhdHRyaWJ1dGVzOiBbICdoZWFkaW5nUm93cycgXVxuXHQgKiBcdH0sXG5cdCAqIFx0dmlldzogKCBtb2RlbEVsZW1lbnQsIGNvbnZlcnNpb25BcGkgKSA9PiB7XG5cdCAqIFx0XHRjb25zdCB7IHdyaXRlciB9ID0gY29udmVyc2lvbkFwaTtcblx0ICpcblx0ICogXHRcdGNvbnN0IGZpZ3VyZUVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ2ZpZ3VyZScsIHsgY2xhc3M6ICd0YWJsZScgfSApO1xuXHQgKiBcdFx0Y29uc3QgdGFibGVFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICd0YWJsZScgKTtcblx0ICpcblx0ICogXHRcdHdyaXRlci5pbnNlcnQoIHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCBmaWd1cmVFbGVtZW50LCAwICksIHRhYmxlRWxlbWVudCApO1xuXHQgKlxuXHQgKiBcdFx0Y29uc3QgaGVhZGluZ1Jvd3MgPSBtb2RlbEVsZW1lbnQuZ2V0QXR0cmlidXRlKCAnaGVhZGluZ1Jvd3MnICkgfHwgMDtcblx0ICpcblx0ICogXHRcdGlmICggaGVhZGluZ1Jvd3MgPiAwICkge1xuXHQgKiBcdFx0XHRjb25zdCB0YWJsZUhlYWQgPSB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ3RoZWFkJyApO1xuXHQgKlxuXHQgKiBcdFx0XHRjb25zdCBoZWFkU2xvdCA9IHdyaXRlci5jcmVhdGVTbG90KCBub2RlID0+IG5vZGUuaXMoICdlbGVtZW50JywgJ3RhYmxlUm93JyApICYmIG5vZGUuaW5kZXggPCBoZWFkaW5nUm93cyApO1xuXHQgKlxuXHQgKiBcdFx0XHR3cml0ZXIuaW5zZXJ0KCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCggdGFibGVFbGVtZW50LCAnZW5kJyApLCB0YWJsZUhlYWQgKTtcblx0ICogXHRcdFx0d3JpdGVyLmluc2VydCggd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHRhYmxlSGVhZCwgMCApLCBoZWFkU2xvdCApO1xuXHQgKiBcdFx0fVxuXHQgKlxuXHQgKiBcdFx0aWYgKCBoZWFkaW5nUm93cyA8IHRhYmxlVXRpbHMuZ2V0Um93cyggdGFibGUgKSApIHtcblx0ICogXHRcdFx0Y29uc3QgdGFibGVCb2R5ID0gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICd0Ym9keScgKTtcblx0ICpcblx0ICogXHRcdFx0Y29uc3QgYm9keVNsb3QgPSB3cml0ZXIuY3JlYXRlU2xvdCggbm9kZSA9PiBub2RlLmlzKCAnZWxlbWVudCcsICd0YWJsZVJvdycgKSAmJiBub2RlLmluZGV4ID49IGhlYWRpbmdSb3dzICk7XG5cdCAqXG5cdCAqIFx0XHRcdHdyaXRlci5pbnNlcnQoIHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCB0YWJsZUVsZW1lbnQsICdlbmQnICksIHRhYmxlQm9keSApO1xuXHQgKiBcdFx0XHR3cml0ZXIuaW5zZXJ0KCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCggdGFibGVCb2R5LCAwICksIGJvZHlTbG90ICk7XG5cdCAqIFx0XHR9XG5cdCAqXG5cdCAqIFx0XHRjb25zdCByZXN0U2xvdCA9IHdyaXRlci5jcmVhdGVTbG90KCBub2RlID0+ICFub2RlLmlzKCAnZWxlbWVudCcsICd0YWJsZVJvdycgKSApO1xuXHQgKlxuXHQgKiBcdFx0d3JpdGVyLmluc2VydCggd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIGZpZ3VyZUVsZW1lbnQsICdlbmQnICksIHJlc3RTbG90ICk7XG5cdCAqXG5cdCAqIFx0XHRyZXR1cm4gZmlndXJlRWxlbWVudDtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIE5vdGU6IFRoZSBjaGlsZHJlbiBvZiBhIG1vZGVsIGVsZW1lbnQgdGhhdCdzIGJlaW5nIGNvbnZlcnRlZCBtdXN0IGJlIGFsbG9jYXRlZCBpbiB0aGUgc2FtZSBvcmRlciBpbiB0aGUgdmlld1xuXHQgKiBpbiB3aGljaCB0aGV5IGFyZSBwbGFjZWQgaW4gdGhlIG1vZGVsLlxuXHQgKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBjb252ZXJzaW9uLmZvcigpYH0gdG8gbGVhcm4gaG93IHRvIGFkZCBhIGNvbnZlcnRlclxuXHQgKiB0byB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiBcdCAqIEBwYXJhbSBjb25maWcubW9kZWwgVGhlIGRlc2NyaXB0aW9uIG9yIGEgbmFtZSBvZiB0aGUgbW9kZWwgZWxlbWVudCB0byBjb252ZXJ0LlxuXHQgKiBAcGFyYW0gY29uZmlnLm1vZGVsLm5hbWUgVGhlIG5hbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnQgdG8gY29udmVydC5cbiBcdCAqIEBwYXJhbSBjb25maWcubW9kZWwuYXR0cmlidXRlcyBUaGUgbGlzdCBvZiBhdHRyaWJ1dGUgbmFtZXMgdGhhdCBzaG91bGQgYmUgY29uc3VtZWQgd2hpbGUgY3JlYXRpbmdcblx0ICogdGhlIHZpZXcgc3RydWN0dXJlLiBOb3RlIHRoYXQgdGhlIHZpZXcgd2lsbCBiZSByZWNvbnZlcnRlZCBpZiBhbnkgb2YgdGhlIGxpc3RlZCBhdHRyaWJ1dGVzIHdpbGwgY2hhbmdlLlxuXHQgKiBAcGFyYW0gY29uZmlnLnZpZXcgQSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBtb2RlbCBlbGVtZW50IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9IGFzIHBhcmFtZXRlcnNcblx0ICogYW5kIHJldHVybnMgYSB2aWV3IGNvbnRhaW5lciBlbGVtZW50IHdpdGggc2xvdHMgZm9yIG1vZGVsIGNoaWxkIG5vZGVzIHRvIGJlIGNvbnZlcnRlZCBpbnRvLlxuXHQgKi8gZWxlbWVudFRvU3RydWN0dXJlKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQoZG93bmNhc3RFbGVtZW50VG9TdHJ1Y3R1cmUoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb2RlbCBhdHRyaWJ1dGUgdG8gdmlldyBlbGVtZW50IGNvbnZlcnNpb24gaGVscGVyLlxuXHQgKlxuXHQgKiBUaGlzIGNvbnZlcnNpb24gcmVzdWx0cyBpbiB3cmFwcGluZyB2aWV3IG5vZGVzIHdpdGggYSB2aWV3IGF0dHJpYnV0ZSBlbGVtZW50LiBGb3IgZXhhbXBsZSwgYSBtb2RlbCB0ZXh0IG5vZGUgd2l0aFxuXHQgKiBgXCJGb29cImAgYXMgZGF0YSBhbmQgdGhlIGBib2xkYCBhdHRyaWJ1dGUgYmVjb21lcyBgPHN0cm9uZz5Gb288L3N0cm9uZz5gIGluIHRoZSB2aWV3LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5hdHRyaWJ1dGVUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDogJ2JvbGQnLFxuXHQgKiBcdHZpZXc6ICdzdHJvbmcnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkuYXR0cmlidXRlVG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdib2xkJyxcblx0ICogXHR2aWV3OiAnYicsXG5cdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAnaW52ZXJ0Jyxcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRjbGFzc2VzOiBbICdmb250LWxpZ2h0JywgJ2JnLWRhcmsnIF1cblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkuYXR0cmlidXRlVG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6IHtcblx0ICogXHRcdGtleTogJ2ZvbnRTaXplJyxcblx0ICogXHRcdHZhbHVlczogWyAnYmlnJywgJ3NtYWxsJyBdXG5cdCAqIFx0fSxcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRiaWc6IHtcblx0ICogXHRcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0XHRzdHlsZXM6IHtcblx0ICogXHRcdFx0XHQnZm9udC1zaXplJzogJzEuMmVtJ1xuXHQgKiBcdFx0XHR9XG5cdCAqIFx0XHR9LFxuXHQgKiBcdFx0c21hbGw6IHtcblx0ICogXHRcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0XHRzdHlsZXM6IHtcblx0ICogXHRcdFx0XHQnZm9udC1zaXplJzogJzAuOGVtJ1xuXHQgKiBcdFx0XHR9XG5cdCAqIFx0XHR9XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAnYm9sZCcsXG5cdCAqIFx0dmlldzogKCBtb2RlbEF0dHJpYnV0ZVZhbHVlLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuXHQgKiBcdFx0Y29uc3QgeyB3cml0ZXIgfSA9IGNvbnZlcnNpb25BcGk7XG5cdCAqXG5cdCAqIFx0XHRyZXR1cm4gd3JpdGVyLmNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoICdzcGFuJywge1xuXHQgKiBcdFx0XHRzdHlsZTogJ2ZvbnQtd2VpZ2h0OicgKyBtb2RlbEF0dHJpYnV0ZVZhbHVlXG5cdCAqIFx0XHR9ICk7XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRrZXk6ICdjb2xvcicsXG5cdCAqIFx0XHRuYW1lOiAnJHRleHQnXG5cdCAqIFx0fSxcblx0ICogXHR2aWV3OiAoIG1vZGVsQXR0cmlidXRlVmFsdWUsIGNvbnZlcnNpb25BcGkgKSA9PiB7XG5cdCAqIFx0XHRjb25zdCB7IHdyaXRlciB9ID0gY29udmVyc2lvbkFwaTtcblx0ICpcblx0ICogXHRcdHJldHVybiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCggJ3NwYW4nLCB7XG5cdCAqIFx0XHRcdHN0eWxlOiAnY29sb3I6JyArIG1vZGVsQXR0cmlidXRlVmFsdWVcblx0ICogXHRcdH0gKTtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNmb3IgYGNvbnZlcnNpb24uZm9yKClgfSB0byBsZWFybiBob3cgdG8gYWRkIGEgY29udmVydGVyXG5cdCAqIHRvIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gY29uZmlnLm1vZGVsIFRoZSBrZXkgb2YgdGhlIGF0dHJpYnV0ZSB0byBjb252ZXJ0IGZyb20gb3IgYSBgeyBrZXksIHZhbHVlcyB9YCBvYmplY3QuIGB2YWx1ZXNgIGlzIGFuIGFycmF5XG5cdCAqIG9mIGBTdHJpbmdgcyB3aXRoIHBvc3NpYmxlIHZhbHVlcyBpZiB0aGUgbW9kZWwgYXR0cmlidXRlIGlzIGFuIGVudW1lcmFibGUuXG5cdCAqIEBwYXJhbSBjb25maWcudmlldyBBIHZpZXcgZWxlbWVudCBkZWZpbml0aW9uIG9yIGEgZnVuY3Rpb25cblx0ICogdGhhdCB0YWtlcyB0aGUgbW9kZWwgYXR0cmlidXRlIHZhbHVlIGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9IGFzIHBhcmFtZXRlcnMgYW5kIHJldHVybnMgYSB2aWV3XG5cdCAqIGF0dHJpYnV0ZSBlbGVtZW50LiBJZiBgY29uZmlnLm1vZGVsLnZhbHVlc2AgaXMgZ2l2ZW4sIGBjb25maWcudmlld2Agc2hvdWxkIGJlIGFuIG9iamVjdCBhc3NpZ25pbmcgdmFsdWVzIGZyb20gYGNvbmZpZy5tb2RlbC52YWx1ZXNgXG5cdCAqIHRvIHZpZXcgZWxlbWVudCBkZWZpbml0aW9ucyBvciBmdW5jdGlvbnMuXG5cdCAqIEBwYXJhbSBjb25maWcuY29udmVydGVyUHJpb3JpdHkgQ29udmVydGVyIHByaW9yaXR5LlxuXHQgKi8gYXR0cmlidXRlVG9FbGVtZW50KGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQoZG93bmNhc3RBdHRyaWJ1dGVUb0VsZW1lbnQoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb2RlbCBhdHRyaWJ1dGUgdG8gdmlldyBhdHRyaWJ1dGUgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIFRoaXMgY29udmVyc2lvbiByZXN1bHRzIGluIGFkZGluZyBhbiBhdHRyaWJ1dGUgdG8gYSB2aWV3IG5vZGUsIGJhc2luZyBvbiBhbiBhdHRyaWJ1dGUgZnJvbSBhIG1vZGVsIG5vZGUuIEZvciBleGFtcGxlLFxuXHQgKiBgPGltYWdlSW5saW5lIHNyYz0nZm9vLmpwZyc+PC9pbWFnZUlubGluZT5gIGlzIGNvbnZlcnRlZCB0byBgPGltZyBzcmM9J2Zvby5qcGcnPjwvaW1nPmAuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvQXR0cmlidXRlKCB7XG5cdCAqIFx0bW9kZWw6ICdzb3VyY2UnLFxuXHQgKiBcdHZpZXc6ICdzcmMnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkuYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHRtb2RlbDogJ3NvdXJjZScsXG5cdCAqIFx0dmlldzogJ2hyZWYnLFxuXHQgKiBcdGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRuYW1lOiAnaW1hZ2VJbmxpbmUnLFxuXHQgKiBcdFx0a2V5OiAnc291cmNlJ1xuXHQgKiBcdH0sXG5cdCAqIFx0dmlldzogJ3NyYydcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRuYW1lOiAnc3R5bGVkJyxcblx0ICogXHRcdHZhbHVlczogWyAnZGFyaycsICdsaWdodCcgXVxuXHQgKiBcdH0sXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0ZGFyazoge1xuXHQgKiBcdFx0XHRrZXk6ICdjbGFzcycsXG5cdCAqIFx0XHRcdHZhbHVlOiBbICdzdHlsZWQnLCAnc3R5bGVkLWRhcmsnIF1cblx0ICogXHRcdH0sXG5cdCAqIFx0XHRsaWdodDoge1xuXHQgKiBcdFx0XHRrZXk6ICdjbGFzcycsXG5cdCAqIFx0XHRcdHZhbHVlOiBbICdzdHlsZWQnLCAnc3R5bGVkLWxpZ2h0JyBdXG5cdCAqIFx0XHR9XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvQXR0cmlidXRlKCB7XG5cdCAqIFx0bW9kZWw6ICdzdHlsZWQnLFxuXHQgKiBcdHZpZXc6IG1vZGVsQXR0cmlidXRlVmFsdWUgPT4gKCB7XG5cdCAqIFx0XHRrZXk6ICdjbGFzcycsXG5cdCAqIFx0XHR2YWx1ZTogJ3N0eWxlZC0nICsgbW9kZWxBdHRyaWJ1dGVWYWx1ZVxuXHQgKiBcdH0gKVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGUqKjogRG93bmNhc3RpbmcgdG8gYSBzdHlsZSBwcm9wZXJ0eSByZXF1aXJlcyBwcm92aWRpbmcgYHZhbHVlYCBhcyBhbiBvYmplY3Q6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmF0dHJpYnV0ZVRvQXR0cmlidXRlKCB7XG5cdCAqIFx0bW9kZWw6ICdsaW5lSGVpZ2h0Jyxcblx0ICogXHR2aWV3OiBtb2RlbEF0dHJpYnV0ZVZhbHVlID0+ICgge1xuXHQgKiBcdFx0a2V5OiAnc3R5bGUnLFxuXHQgKiBcdFx0dmFsdWU6IHtcblx0ICogXHRcdFx0J2xpbmUtaGVpZ2h0JzogbW9kZWxBdHRyaWJ1dGVWYWx1ZSxcblx0ICogXHRcdFx0J2JvcmRlci1ib3R0b20nOiAnMXB4IGRvdHRlZCAjYmEyJ1xuXHQgKiBcdFx0fVxuXHQgKiBcdH0gKVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBjb252ZXJzaW9uLmZvcigpYH0gdG8gbGVhcm4gaG93IHRvIGFkZCBhIGNvbnZlcnRlclxuXHQgKiB0byB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cblx0ICogQHBhcmFtIGNvbmZpZy5tb2RlbCBUaGUga2V5IG9mIHRoZSBhdHRyaWJ1dGUgdG8gY29udmVydCBmcm9tIG9yIGEgYHsga2V5LCB2YWx1ZXMsIFsgbmFtZSBdIH1gIG9iamVjdCBkZXNjcmliaW5nXG5cdCAqIHRoZSBhdHRyaWJ1dGUga2V5LCBwb3NzaWJsZSB2YWx1ZXMgYW5kLCBvcHRpb25hbGx5LCBhbiBlbGVtZW50IG5hbWUgdG8gY29udmVydCBmcm9tLlxuXHQgKiBAcGFyYW0gY29uZmlnLnZpZXcgQSB2aWV3IGF0dHJpYnV0ZSBrZXksIG9yIGEgYHsga2V5LCB2YWx1ZSB9YCBvYmplY3Qgb3IgYSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBtb2RlbCBhdHRyaWJ1dGUgdmFsdWUgYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0Q29udmVyc2lvbkFwaSBkb3duY2FzdCBjb252ZXJzaW9uIEFQSX1cblx0ICogYXMgcGFyYW1ldGVycyBhbmQgcmV0dXJucyBhIGB7IGtleSwgdmFsdWUgfWAgb2JqZWN0LiBJZiB0aGUgYGtleWAgaXMgYCdjbGFzcydgLCB0aGUgYHZhbHVlYCBjYW4gYmUgYSBgU3RyaW5nYCBvciBhblxuXHQgKiBhcnJheSBvZiBgU3RyaW5nYHMuIElmIHRoZSBga2V5YCBpcyBgJ3N0eWxlJ2AsIHRoZSBgdmFsdWVgIGlzIGFuIG9iamVjdCB3aXRoIGtleS12YWx1ZSBwYWlycy4gSW4gb3RoZXIgY2FzZXMsIGB2YWx1ZWAgaXMgYSBgU3RyaW5nYC5cblx0ICogSWYgYGNvbmZpZy5tb2RlbC52YWx1ZXNgIGlzIHNldCwgYGNvbmZpZy52aWV3YCBzaG91bGQgYmUgYW4gb2JqZWN0IGFzc2lnbmluZyB2YWx1ZXMgZnJvbSBgY29uZmlnLm1vZGVsLnZhbHVlc2AgdG9cblx0ICogYHsga2V5LCB2YWx1ZSB9YCBvYmplY3RzIG9yIGEgZnVuY3Rpb25zLlxuXHQgKiBAcGFyYW0gY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IENvbnZlcnRlciBwcmlvcml0eS5cblx0ICovIGF0dHJpYnV0ZVRvQXR0cmlidXRlKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQoZG93bmNhc3RBdHRyaWJ1dGVUb0F0dHJpYnV0ZShjb25maWcpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vZGVsIG1hcmtlciB0byB2aWV3IGVsZW1lbnQgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgdXNlZCBtYWlubHkgZm9yIGVkaXRpbmcgdGhlIGRvd25jYXN0IGFuZCBpdCBpcyByZWNvbW1lbmRlZFxuXHQgKiB0byB1c2UgdGhlIHtAbGluayAjbWFya2VyVG9EYXRhIGAjbWFya2VyVG9EYXRhKClgfSBoZWxwZXIgaW5zdGVhZC5cblx0ICpcblx0ICogVGhpcyBoZWxwZXIgbWF5IHByb2R1Y2UgaW52YWxpZCBIVE1MIGNvZGUgKGUuZy4gYSBzcGFuIGJldHdlZW4gdGFibGUgY2VsbHMpLlxuXHQgKiBJdCBzaG91bGQgb25seSBiZSB1c2VkIHdoZW4geW91IGFyZSBzdXJlIHRoYXQgdGhlIHByb2R1Y2VkIEhUTUwgd2lsbCBiZSBzZW1hbnRpY2FsbHkgY29ycmVjdC5cblx0ICpcblx0ICogVGhpcyBjb252ZXJzaW9uIHJlc3VsdHMgaW4gY3JlYXRpbmcgYSB2aWV3IGVsZW1lbnQgb24gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGNvbnZlcnRlZCBtYXJrZXIuIElmIHRoZSBjb252ZXJ0ZWQgbWFya2VyXG5cdCAqIGlzIGNvbGxhcHNlZCwgb25seSBvbmUgZWxlbWVudCBpcyBjcmVhdGVkLiBGb3IgZXhhbXBsZSwgYSBtb2RlbCBtYXJrZXIgc2V0IGxpa2UgdGhpczogYDxwYXJhZ3JhcGg+RltvbyBiXWFyPC9wYXJhZ3JhcGg+YFxuXHQgKiBiZWNvbWVzIGA8cD5GPHNwYW4gZGF0YS1tYXJrZXI9XCJzZWFyY2hcIj48L3NwYW4+b28gYjxzcGFuIGRhdGEtbWFya2VyPVwic2VhcmNoXCI+PC9zcGFuPmFyPC9wPmAgaW4gdGhlIHZpZXcuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2VkaXRpbmdEb3duY2FzdCcgKS5tYXJrZXJUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDogJ3NlYXJjaCcsXG5cdCAqIFx0dmlldzogJ21hcmtlci1zZWFyY2gnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZWRpdGluZ0Rvd25jYXN0JyApLm1hcmtlclRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAnc2VhcmNoJyxcblx0ICogXHR2aWV3OiAnc2VhcmNoLXJlc3VsdCcsXG5cdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2VkaXRpbmdEb3duY2FzdCcgKS5tYXJrZXJUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDogJ3NlYXJjaCcsXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0YXR0cmlidXRlczoge1xuXHQgKiBcdFx0XHQnZGF0YS1tYXJrZXInOiAnc2VhcmNoJ1xuXHQgKiBcdFx0fVxuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdlZGl0aW5nRG93bmNhc3QnICkubWFya2VyVG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdzZWFyY2gnLFxuXHQgKiBcdHZpZXc6ICggbWFya2VyRGF0YSwgY29udmVyc2lvbkFwaSApID0+IHtcblx0ICogXHRcdGNvbnN0IHsgd3JpdGVyIH0gPSBjb252ZXJzaW9uQXBpO1xuXHQgKlxuXHQgKiBcdFx0cmV0dXJuIHdyaXRlci5jcmVhdGVVSUVsZW1lbnQoICdzcGFuJywge1xuXHQgKiBcdFx0XHQnZGF0YS1tYXJrZXInOiAnc2VhcmNoJyxcblx0ICogXHRcdFx0J2RhdGEtc3RhcnQnOiBtYXJrZXJEYXRhLmlzT3BlbmluZ1xuXHQgKiBcdFx0fSApO1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogSWYgYSBmdW5jdGlvbiBpcyBwYXNzZWQgYXMgdGhlIGBjb25maWcudmlld2AgcGFyYW1ldGVyLCBpdCB3aWxsIGJlIHVzZWQgdG8gZ2VuZXJhdGUgYm90aCBib3VuZGFyeSBlbGVtZW50cy4gVGhlIGZ1bmN0aW9uXG5cdCAqIHJlY2VpdmVzIHRoZSBgZGF0YWAgb2JqZWN0IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9XG5cdCAqIGFzIGEgcGFyYW1ldGVycyBhbmQgc2hvdWxkIHJldHVybiBhbiBpbnN0YW5jZSBvZiB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IHZpZXcgVUkgZWxlbWVudH0uIFRoZSBgZGF0YWAgb2JqZWN0IGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgYGNvbnZlcnNpb25BcGlgfSBhcmUgcGFzc2VkIGZyb21cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmFkZE1hcmtlcn0uIEFkZGl0aW9uYWxseSxcblx0ICogdGhlIGBkYXRhLmlzT3BlbmluZ2AgcGFyYW1ldGVyIGlzIHBhc3NlZCwgd2hpY2ggaXMgc2V0IHRvIGB0cnVlYCBmb3IgdGhlIG1hcmtlciBzdGFydCBib3VuZGFyeSBlbGVtZW50LCBhbmQgYGZhbHNlYCBmb3Jcblx0ICogdGhlIG1hcmtlciBlbmQgYm91bmRhcnkgZWxlbWVudC5cblx0ICpcblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBgY29udmVyc2lvbi5mb3IoKWB9IHRvIGxlYXJuIGhvdyB0byBhZGQgYSBjb252ZXJ0ZXJcblx0ICogdG8gdGhlIGNvbnZlcnNpb24gcHJvY2Vzcy5cblx0ICpcblx0ICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG5cdCAqIEBwYXJhbSBjb25maWcubW9kZWwgVGhlIG5hbWUgb2YgdGhlIG1vZGVsIG1hcmtlciAob3IgbW9kZWwgbWFya2VyIGdyb3VwKSB0byBjb252ZXJ0LlxuXHQgKiBAcGFyYW0gY29uZmlnLnZpZXcgQSB2aWV3IGVsZW1lbnQgZGVmaW5pdGlvbiBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIG1vZGVsIG1hcmtlciBkYXRhIGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9IGFzIGEgcGFyYW1ldGVyc1xuXHQgKiBhbmQgcmV0dXJucyBhIHZpZXcgVUkgZWxlbWVudC5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBtYXJrZXJUb0VsZW1lbnQoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZChkb3duY2FzdE1hcmtlclRvRWxlbWVudChjb25maWcpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1vZGVsIG1hcmtlciB0byBoaWdobGlnaHQgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIFRoaXMgY29udmVyc2lvbiByZXN1bHRzIGluIGNyZWF0aW5nIGEgaGlnaGxpZ2h0IG9uIHZpZXcgbm9kZXMuIEZvciB0aGlzIGtpbmQgb2YgY29udmVyc2lvbixcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkhpZ2hsaWdodERlc2NyaXB0b3J9IHNob3VsZCBiZSBwcm92aWRlZC5cblx0ICpcblx0ICogRm9yIHRleHQgbm9kZXMsIGEgYDxzcGFuPmAge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnR9IGlzIGNyZWF0ZWQgYW5kIGl0IHdyYXBzIGFsbCB0ZXh0IG5vZGVzXG5cdCAqIGluIHRoZSBjb252ZXJ0ZWQgbWFya2VyIHJhbmdlLiBGb3IgZXhhbXBsZSwgYSBtb2RlbCBtYXJrZXIgc2V0IGxpa2UgdGhpczogYDxwYXJhZ3JhcGg+RltvbyBiXWFyPC9wYXJhZ3JhcGg+YCBiZWNvbWVzXG5cdCAqIGA8cD5GPHNwYW4gY2xhc3M9XCJjb21tZW50XCI+b28gYjwvc3Bhbj5hcjwvcD5gIGluIHRoZSB2aWV3LlxuXHQgKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudH0gbWF5IHByb3ZpZGUgYSBjdXN0b20gd2F5IG9mIGhhbmRsaW5nIGhpZ2hsaWdodC4gTW9zdCBvZnRlbixcblx0ICogdGhlIGVsZW1lbnQgaXRzZWxmIGlzIGdpdmVuIGNsYXNzZXMgYW5kIGF0dHJpYnV0ZXMgZGVzY3JpYmVkIGluIHRoZSBoaWdobGlnaHQgZGVzY3JpcHRvciAoaW5zdGVhZCBvZiBiZWluZyB3cmFwcGVkIGluIGA8c3Bhbj5gKS5cblx0ICogRm9yIGV4YW1wbGUsIGEgbW9kZWwgbWFya2VyIHNldCBsaWtlIHRoaXM6XG5cdCAqIGBbPGltYWdlSW5saW5lIHNyYz1cImZvby5qcGdcIj48L2ltYWdlSW5saW5lPl1gIGJlY29tZXMgYDxpbWcgc3JjPVwiZm9vLmpwZ1wiIGNsYXNzPVwiY29tbWVudFwiPjwvaW1nPmAgaW4gdGhlIHZpZXcuXG5cdCAqXG5cdCAqIEZvciBjb250YWluZXIgZWxlbWVudHMsIHRoZSBjb252ZXJzaW9uIGlzIHR3by1zdGVwLiBXaGlsZSB0aGUgY29udmVydGVyIHByb2Nlc3NlcyB0aGUgaGlnaGxpZ2h0IGRlc2NyaXB0b3IgYW5kIHBhc3NlcyBpdFxuXHQgKiB0byBhIGNvbnRhaW5lciBlbGVtZW50LCBpdCBpcyB0aGUgY29udGFpbmVyIGVsZW1lbnQgaW5zdGFuY2UgaXRzZWxmIHRoYXQgYXBwbGllcyB2YWx1ZXMgZnJvbSB0aGUgaGlnaGxpZ2h0IGRlc2NyaXB0b3IuXG5cdCAqIFNvLCBpbiBhIHNlbnNlLCB0aGUgY29udmVydGVyIHRha2VzIGNhcmUgb2Ygc3RhdGluZyB3aGF0IHNob3VsZCBiZSBhcHBsaWVkIG9uIHdoYXQsIHdoaWxlIHRoZSBlbGVtZW50IGRlY2lkZXMgaG93IHRvIGFwcGx5IHRoYXQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLm1hcmtlclRvSGlnaGxpZ2h0KCB7IG1vZGVsOiAnY29tbWVudCcsIHZpZXc6IHsgY2xhc3NlczogJ2NvbW1lbnQnIH0gfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5tYXJrZXJUb0hpZ2hsaWdodCgge1xuXHQgKiBcdG1vZGVsOiAnY29tbWVudCcsXG5cdCAqIFx0dmlldzogeyBjbGFzc2VzOiAnY29tbWVudCcgfSxcblx0ICogXHRjb252ZXJ0ZXJQcmlvcml0eTogJ2hpZ2gnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZG93bmNhc3QnICkubWFya2VyVG9IaWdobGlnaHQoIHtcblx0ICogXHRtb2RlbDogJ2NvbW1lbnQnLFxuXHQgKiBcdHZpZXc6ICggZGF0YSwgY29udmVyc2lvbkFwaSApID0+IHtcblx0ICogXHRcdC8vIEFzc3VtaW5nIHRoYXQgdGhlIG1hcmtlciBuYW1lIGlzIGluIGEgZm9ybSBvZiBjb21tZW50OmNvbW1lbnRUeXBlOmNvbW1lbnRJZC5cblx0ICogXHRcdGNvbnN0IFsgLCBjb21tZW50VHlwZSwgY29tbWVudElkIF0gPSBkYXRhLm1hcmtlck5hbWUuc3BsaXQoICc6JyApO1xuXHQgKlxuXHQgKiBcdFx0cmV0dXJuIHtcblx0ICogXHRcdFx0Y2xhc3NlczogWyAnY29tbWVudCcsICdjb21tZW50LScgKyBjb21tZW50VHlwZSBdLFxuXHQgKiBcdFx0XHRhdHRyaWJ1dGVzOiB7ICdkYXRhLWNvbW1lbnQtaWQnOiBjb21tZW50SWQgfVxuXHQgKiBcdFx0fTtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIGEgZnVuY3Rpb24gaXMgcGFzc2VkIGFzIHRoZSBgY29uZmlnLnZpZXdgIHBhcmFtZXRlciwgaXQgd2lsbCBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBoaWdobGlnaHQgZGVzY3JpcHRvci4gVGhlIGZ1bmN0aW9uXG5cdCAqIHJlY2VpdmVzIHRoZSBgZGF0YWAgb2JqZWN0IGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9XG5cdCAqIGFzIHRoZSBwYXJhbWV0ZXJzIGFuZCBzaG91bGQgcmV0dXJuIGFcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+SGlnaGxpZ2h0RGVzY3JpcHRvciBoaWdobGlnaHQgZGVzY3JpcHRvcn0uXG5cdCAqIFRoZSBgZGF0YWAgb2JqZWN0IHByb3BlcnRpZXMgYXJlIHBhc3NlZCBmcm9tIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDphZGRNYXJrZXJ9LlxuXHQgKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBjb252ZXJzaW9uLmZvcigpYH0gdG8gbGVhcm4gaG93IHRvIGFkZCBhIGNvbnZlcnRlclxuXHQgKiB0byB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cblx0ICogQHBhcmFtIGNvbmZpZy5tb2RlbCBUaGUgbmFtZSBvZiB0aGUgbW9kZWwgbWFya2VyIChvciBtb2RlbCBtYXJrZXIgZ3JvdXApIHRvIGNvbnZlcnQuXG5cdCAqIEBwYXJhbSBjb25maWcudmlldyBBIGhpZ2hsaWdodCBkZXNjcmlwdG9yIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBoaWdobGlnaHRpbmcgb3IgYSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBtb2RlbCBtYXJrZXIgZGF0YSBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3RDb252ZXJzaW9uQXBpIGRvd25jYXN0IGNvbnZlcnNpb24gQVBJfSBhcyBhIHBhcmFtZXRlcnNcblx0ICogYW5kIHJldHVybnMgYSBoaWdobGlnaHQgZGVzY3JpcHRvci5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBtYXJrZXJUb0hpZ2hsaWdodChjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKGRvd25jYXN0TWFya2VyVG9IaWdobGlnaHQoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb2RlbCBtYXJrZXIgY29udmVydGVyIGZvciBkYXRhIGRvd25jYXN0LlxuXHQgKlxuXHQgKiBUaGlzIGNvbnZlcnNpb24gY3JlYXRlcyBhIHJlcHJlc2VudGF0aW9uIGZvciBtb2RlbCBtYXJrZXIgYm91bmRhcmllcyBpbiB0aGUgdmlldzpcblx0ICpcblx0ICogKiBJZiB0aGUgbWFya2VyIGJvdW5kYXJ5IGlzIGJlZm9yZSBvciBhZnRlciBhIG1vZGVsIGVsZW1lbnQsIGEgdmlldyBhdHRyaWJ1dGUgaXMgc2V0IG9uIGEgY29ycmVzcG9uZGluZyB2aWV3IGVsZW1lbnQuXG5cdCAqICogSW4gb3RoZXIgY2FzZXMsIGEgdmlldyBlbGVtZW50IHdpdGggdGhlIHNwZWNpZmllZCB0YWcgbmFtZSBpcyBpbnNlcnRlZCBhdCB0aGUgY29ycmVzcG9uZGluZyB2aWV3IHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBUeXBpY2FsbHksIHRoZSBtYXJrZXIgbmFtZXMgdXNlIHRoZSBgZ3JvdXA6dW5pcXVlSWQ6b3RoZXJEYXRhYCBjb252ZW50aW9uLiBGb3IgZXhhbXBsZTogYGNvbW1lbnQ6ZTM0emZrOWsybjQ1OWRmNTNzamwzNDp6eDMyY2AuXG5cdCAqIFRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgY29udmVyc2lvbiBpcyB0aGF0IHRoZSBmaXJzdCBwYXJ0IGlzIHRoZSBgZ3JvdXBgIHBhcnQgYW5kIHRoZSByZXN0IG9mXG5cdCAqIHRoZSBtYXJrZXIgbmFtZSBiZWNvbWVzIHRoZSBgbmFtZWAgcGFydC5cblx0ICpcblx0ICogVGFnIGFuZCBhdHRyaWJ1dGUgbmFtZXMgYW5kIHZhbHVlcyBhcmUgZ2VuZXJhdGVkIGZyb20gdGhlIG1hcmtlciBuYW1lOlxuXHQgKlxuXHQgKiAqIFRoZSB0ZW1wbGF0ZXMgZm9yIGF0dHJpYnV0ZXMgYXJlIGBkYXRhLVtncm91cF0tc3RhcnQtYmVmb3JlPVwiW25hbWVdXCJgLCBgZGF0YS1bZ3JvdXBdLXN0YXJ0LWFmdGVyPVwiW25hbWVdXCJgLFxuXHQgKiBgZGF0YS1bZ3JvdXBdLWVuZC1iZWZvcmU9XCJbbmFtZV1cImAgYW5kIGBkYXRhLVtncm91cF0tZW5kLWFmdGVyPVwiW25hbWVdXCJgLlxuXHQgKiAqIFRoZSB0ZW1wbGF0ZXMgZm9yIHZpZXcgZWxlbWVudHMgYXJlIGA8W2dyb3VwXS1zdGFydCBuYW1lPVwiW25hbWVdXCI+YCBhbmQgYDxbZ3JvdXBdLWVuZCBuYW1lPVwiW25hbWVdXCI+YC5cblx0ICpcblx0ICogQXR0cmlidXRlcyBtYXJrIHdoZXRoZXIgdGhlIGdpdmVuIG1hcmtlcidzIHN0YXJ0IG9yIGVuZCBib3VuZGFyeSBpcyBiZWZvcmUgb3IgYWZ0ZXIgdGhlIGdpdmVuIGVsZW1lbnQuXG5cdCAqIFRoZSBgZGF0YS1bZ3JvdXBdLXN0YXJ0LWJlZm9yZWAgYW5kIGBkYXRhLVtncm91cF0tZW5kLWFmdGVyYCBhdHRyaWJ1dGVzIGFyZSBmYXZvcmVkLlxuXHQgKiBUaGUgb3RoZXIgdHdvIGFyZSB1c2VkIHdoZW4gdGhlIGZvcm1lciB0d28gY2Fubm90IGJlIHVzZWQuXG5cdCAqXG5cdCAqIFRoZSBjb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24gY2FuIHRha2UgYSBmdW5jdGlvbiB0aGF0IHdpbGwgZ2VuZXJhdGUgZGlmZmVyZW50IGdyb3VwIGFuZCBuYW1lIHBhcnRzLlxuXHQgKiBJZiBzdWNoIGEgZnVuY3Rpb24gaXMgc2V0IGFzIHRoZSBgY29uZmlnLnZpZXdgIHBhcmFtZXRlciwgaXQgaXMgcGFzc2VkIGEgbWFya2VyIG5hbWUgYW5kIGl0IGlzIGV4cGVjdGVkIHRvIHJldHVybiBhbiBvYmplY3Qgd2l0aCB0d29cblx0ICogcHJvcGVydGllczogYGdyb3VwYCBhbmQgYG5hbWVgLiBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyBhIGZhbHN5IHZhbHVlLCB0aGUgY29udmVyc2lvbiB3aWxsIG5vdCB0YWtlIHBsYWNlLlxuXHQgKlxuXHQgKiBCYXNpYyB1c2FnZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gVXNpbmcgdGhlIGRlZmF1bHQgY29udmVyc2lvbi5cblx0ICogLy8gSW4gdGhpcyBjYXNlLCBhbGwgbWFya2VycyB3aXRoIG5hbWVzIHN0YXJ0aW5nIHdpdGggJ2NvbW1lbnQ6JyB3aWxsIGJlIGNvbnZlcnRlZC5cblx0ICogLy8gVGhlIGBncm91cGAgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IHRvIGBjb21tZW50YC5cblx0ICogLy8gVGhlIGBuYW1lYCBwYXJhbWV0ZXIgd2lsbCBiZSB0aGUgcmVzdCBvZiB0aGUgbWFya2VyIG5hbWUgKHdpdGhvdXQgdGhlIGA6YCkuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2RhdGFEb3duY2FzdCcgKS5tYXJrZXJUb0RhdGEoIHtcblx0ICogXHRtb2RlbDogJ2NvbW1lbnQnXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEFuIGV4YW1wbGUgb2YgYSB2aWV3IHRoYXQgbWF5IGJlIGdlbmVyYXRlZCBieSB0aGlzIGNvbnZlcnNpb24gKGFzc3VtaW5nIGEgbWFya2VyIHdpdGggdGhlIG5hbWUgYGNvbW1lbnQ6Y29tbWVudElkOnVpZGAgbWFya2VkXG5cdCAqIGJ5IGBbXWApOlxuXHQgKlxuXHQgKiBgYGBcblx0ICogLy8gTW9kZWw6XG5cdCAqIDxwYXJhZ3JhcGg+Rm9vW2JhcjwvcGFyYWdyYXBoPlxuXHQgKiA8aW1hZ2VCbG9jayBzcmM9XCJhYmMuanBnXCI+PC9pbWFnZUJsb2NrPl1cblx0ICpcblx0ICogLy8gVmlldzpcblx0ICogPHA+Rm9vPGNvbW1lbnQtc3RhcnQgbmFtZT1cImNvbW1lbnRJZDp1aWRcIj48L2NvbW1lbnQtc3RhcnQ+YmFyPC9wPlxuXHQgKiA8ZmlndXJlIGRhdGEtY29tbWVudC1lbmQtYWZ0ZXI9XCJjb21tZW50SWQ6dWlkXCIgY2xhc3M9XCJpbWFnZVwiPjxpbWcgc3JjPVwiYWJjLmpwZ1wiIC8+PC9maWd1cmU+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbiB0aGUgZXhhbXBsZSBhYm92ZSwgdGhlIGNvbW1lbnQgc3RhcnRzIGJlZm9yZSBcImJhclwiIGFuZCBlbmRzIGFmdGVyIHRoZSBpbWFnZS5cblx0ICpcblx0ICogSWYgdGhlIGBuYW1lYCBwYXJ0IGlzIGVtcHR5LCB0aGUgZm9sbG93aW5nIHZpZXcgbWF5IGJlIGdlbmVyYXRlZDpcblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD5Gb28gPG15TWFya2VyLXN0YXJ0PjwvbXlNYXJrZXItc3RhcnQ+YmFyPC9wPlxuXHQgKiA8ZmlndXJlIGRhdGEtbXlNYXJrZXItZW5kLWFmdGVyPVwiXCIgY2xhc3M9XCJpbWFnZVwiPjxpbWcgc3JjPVwiYWJjLmpwZ1wiIC8+PC9maWd1cmU+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGU6KiogQSBzaXR1YXRpb24gd2hlcmUgc29tZSBtYXJrZXJzIGhhdmUgdGhlIGBuYW1lYCBwYXJ0IGFuZCBzb21lIGRvIG5vdCwgaXMgaW5jb3JyZWN0IGFuZCBzaG91bGQgYmUgYXZvaWRlZC5cblx0ICpcblx0ICogRXhhbXBsZXMgd2hlcmUgYGRhdGEtZ3JvdXAtc3RhcnQtYWZ0ZXJgIGFuZCBgZGF0YS1ncm91cC1lbmQtYmVmb3JlYCBhcmUgdXNlZDpcblx0ICpcblx0ICogYGBgXG5cdCAqIC8vIE1vZGVsOlxuXHQgKiA8YmxvY2tRdW90ZT5bXTxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+PC9ibG9ja1F1b3RlPlxuXHQgKlxuXHQgKiAvLyBWaWV3OlxuXHQgKiA8YmxvY2txdW90ZT48cCBkYXRhLWdyb3VwLWVuZC1iZWZvcmU9XCJuYW1lXCIgZGF0YS1ncm91cC1zdGFydC1iZWZvcmU9XCJuYW1lXCI+Rm9vPC9wPjwvYmxvY2txdW90ZT5cblx0ICogYGBgXG5cdCAqXG5cdCAqIFNpbWlsYXJseSwgd2hlbiBhIG1hcmtlciBpcyBjb2xsYXBzZWQgYWZ0ZXIgdGhlIGxhc3QgZWxlbWVudDpcblx0ICpcblx0ICogYGBgXG5cdCAqIC8vIE1vZGVsOlxuXHQgKiA8YmxvY2tRdW90ZT48cGFyYWdyYXBoPkZvbzwvcGFyYWdyYXBoPltdPC9ibG9ja1F1b3RlPlxuXHQgKlxuXHQgKiAvLyBWaWV3OlxuXHQgKiA8YmxvY2txdW90ZT48cCBkYXRhLWdyb3VwLWVuZC1hZnRlcj1cIm5hbWVcIiBkYXRhLWdyb3VwLXN0YXJ0LWFmdGVyPVwibmFtZVwiPkZvbzwvcD48L2Jsb2NrcXVvdGU+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBXaGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBtYXJrZXJzIGZyb20gdGhlIHNhbWUgZ3JvdXAgc3RvcmVkIGluIHRoZSBzYW1lIGF0dHJpYnV0ZSBvZiB0aGUgc2FtZSBlbGVtZW50LCB0aGVpclxuXHQgKiBuYW1lIHBhcnRzIGFyZSBwdXQgdG9nZXRoZXIgaW4gdGhlIGF0dHJpYnV0ZSB2YWx1ZSwgZm9yIGV4YW1wbGU6IGBkYXRhLWdyb3VwLXN0YXJ0LWJlZm9yZT1cIm5hbWUxLG5hbWUyLG5hbWUzXCJgLlxuXHQgKlxuXHQgKiBPdGhlciBleGFtcGxlcyBvZiB1c2FnZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gVXNpbmcgYSBjdXN0b20gZnVuY3Rpb24gd2hpY2ggaXMgdGhlIHNhbWUgYXMgdGhlIGRlZmF1bHQgY29udmVyc2lvbjpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZGF0YURvd25jYXN0JyApLm1hcmtlclRvRGF0YSgge1xuXHQgKiBcdG1vZGVsOiAnY29tbWVudCcsXG5cdCAqIFx0dmlldzogbWFya2VyTmFtZSA9PiAoIHtcblx0ICogXHRcdGdyb3VwOiAnY29tbWVudCcsXG5cdCAqIFx0XHRuYW1lOiBtYXJrZXJOYW1lLnN1YnN0ciggOCApIC8vIFJlbW92ZXMgJ2NvbW1lbnQ6JyBwYXJ0LlxuXHQgKiBcdH0gKVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIC8vIFVzaW5nIHRoZSBjb252ZXJ0ZXIgcHJpb3JpdHk6XG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2RhdGFEb3duY2FzdCcgKS5tYXJrZXJUb0RhdGEoIHtcblx0ICogXHRtb2RlbDogJ2NvbW1lbnQnLFxuXHQgKiBcdHZpZXc6IG1hcmtlck5hbWUgPT4gKCB7XG5cdCAqIFx0XHRncm91cDogJ2NvbW1lbnQnLFxuXHQgKiBcdFx0bmFtZTogbWFya2VyTmFtZS5zdWJzdHIoIDggKSAvLyBSZW1vdmVzICdjb21tZW50OicgcGFydC5cblx0ICogXHR9ICksXG5cdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGlzIGtpbmQgb2YgY29udmVyc2lvbiBpcyB1c2VmdWwgZm9yIHNhdmluZyBkYXRhIGludG8gdGhlIGRhdGFiYXNlLCBzbyBpdCBzaG91bGQgYmUgdXNlZCBpbiB0aGUgZGF0YSBjb252ZXJzaW9uIHBpcGVsaW5lLlxuXHQgKlxuXHQgKiBTZWUgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBgY29udmVyc2lvbi5mb3IoKWB9IEFQSSBndWlkZSB0byBsZWFybiBob3cgdG9cblx0ICogYWRkIGEgY29udmVydGVyIHRvIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gY29uZmlnLm1vZGVsIFRoZSBuYW1lIG9mIHRoZSBtb2RlbCBtYXJrZXIgKG9yIHRoZSBtb2RlbCBtYXJrZXIgZ3JvdXApIHRvIGNvbnZlcnQuXG5cdCAqIEBwYXJhbSBjb25maWcudmlldyBBIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIG1vZGVsIG1hcmtlciBuYW1lIGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkgZG93bmNhc3QgY29udmVyc2lvbiBBUEl9IGFzIHRoZSBwYXJhbWV0ZXJzXG5cdCAqIGFuZCByZXR1cm5zIGFuIG9iamVjdCB3aXRoIHRoZSBgZ3JvdXBgIGFuZCBgbmFtZWAgcHJvcGVydGllcy5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBtYXJrZXJUb0RhdGEoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZChkb3duY2FzdE1hcmtlclRvRGF0YShjb25maWcpKTtcbiAgICB9XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnkgdGhhdCBjcmVhdGVzIGEgZGVmYXVsdCBkb3duY2FzdCBjb252ZXJ0ZXIgZm9yIHRleHQgaW5zZXJ0aW9uIGNoYW5nZXMuXG4gKlxuICogVGhlIGNvbnZlcnRlciBhdXRvbWF0aWNhbGx5IGNvbnN1bWVzIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlIGZyb20gdGhlIGNvbnN1bWFibGVzIGxpc3QgYW5kIHN0b3BzIHRoZSBldmVudCAoc2VlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXJ9KS5cbiAqXG4gKiBgYGB0c1xuICogbW9kZWxEaXNwYXRjaGVyLm9uKCAnaW5zZXJ0OiR0ZXh0JywgaW5zZXJ0VGV4dCgpICk7XG4gKiBgYGBcbiAqXG4gKiBAcmV0dXJucyBJbnNlcnQgdGV4dCBldmVudCBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gaW5zZXJ0VGV4dCgpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sIGV2dC5uYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3UG9zaXRpb24oZGF0YS5yYW5nZS5zdGFydCk7XG4gICAgICAgIGNvbnN0IHZpZXdUZXh0ID0gdmlld1dyaXRlci5jcmVhdGVUZXh0KGRhdGEuaXRlbS5kYXRhKTtcbiAgICAgICAgdmlld1dyaXRlci5pbnNlcnQodmlld1Bvc2l0aW9uLCB2aWV3VGV4dCk7XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBkZWZhdWx0IGRvd25jYXN0IGNvbnZlcnRlciBmb3IgdHJpZ2dlcmluZyBhdHRyaWJ1dGVzIGFuZCBjaGlsZHJlbiBjb252ZXJzaW9uLlxuICpcbiAqIEByZXR1cm5zIFRoZSBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gaW5zZXJ0QXR0cmlidXRlc0FuZENoaWxkcmVuKCkge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnZlcnRBdHRyaWJ1dGVzKGRhdGEuaXRlbSk7XG4gICAgICAgIC8vIFN0YXJ0IGNvbnZlcnRpbmcgY2hpbGRyZW4gb2YgdGhlIGN1cnJlbnQgaXRlbS5cbiAgICAgICAgLy8gSW4gY2FzZSBvZiByZWNvbnZlcnNpb24gY2hpbGRyZW4gd2VyZSBhbHJlYWR5IHJlLWluc2VydGVkIG9yIGNvbnZlcnRlZCBzZXBhcmF0ZWx5LlxuICAgICAgICBpZiAoIWRhdGEucmVjb252ZXJzaW9uICYmIGRhdGEuaXRlbS5pcygnZWxlbWVudCcpICYmICFkYXRhLml0ZW0uaXNFbXB0eSkge1xuICAgICAgICAgICAgY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS5pdGVtKTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnkgdGhhdCBjcmVhdGVzIGEgZGVmYXVsdCBkb3duY2FzdCBjb252ZXJ0ZXIgZm9yIG5vZGUgcmVtb3ZlIGNoYW5nZXMuXG4gKlxuICogYGBgdHNcbiAqIG1vZGVsRGlzcGF0Y2hlci5vbiggJ3JlbW92ZScsIHJlbW92ZSgpICk7XG4gKiBgYGBcbiAqXG4gKiBAcmV0dXJucyBSZW1vdmUgZXZlbnQgY29udmVydGVyLlxuICovIGZ1bmN0aW9uIHJlbW92ZSgpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgLy8gRmluZCB0aGUgdmlldyByYW5nZSBzdGFydCBwb3NpdGlvbiBieSBtYXBwaW5nIHRoZSBtb2RlbCBwb3NpdGlvbiBhdCB3aGljaCB0aGUgcmVtb3ZlIGhhcHBlbmVkLlxuICAgICAgICBjb25zdCB2aWV3U3RhcnQgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdQb3NpdGlvbihkYXRhLnBvc2l0aW9uKTtcbiAgICAgICAgY29uc3QgbW9kZWxFbmQgPSBkYXRhLnBvc2l0aW9uLmdldFNoaWZ0ZWRCeShkYXRhLmxlbmd0aCk7XG4gICAgICAgIGNvbnN0IHZpZXdFbmQgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdQb3NpdGlvbihtb2RlbEVuZCwge1xuICAgICAgICAgICAgaXNQaGFudG9tOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB2aWV3UmFuZ2UgPSBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVSYW5nZSh2aWV3U3RhcnQsIHZpZXdFbmQpO1xuICAgICAgICAvLyBUcmltIHRoZSByYW5nZSB0byByZW1vdmUgaW4gY2FzZSBzb21lIFVJIGVsZW1lbnRzIGFyZSBvbiB0aGUgdmlldyByYW5nZSBib3VuZGFyaWVzLlxuICAgICAgICBjb25zdCByZW1vdmVkID0gY29udmVyc2lvbkFwaS53cml0ZXIucmVtb3ZlKHZpZXdSYW5nZS5nZXRUcmltbWVkKCkpO1xuICAgICAgICAvLyBBZnRlciB0aGUgcmFuZ2UgaXMgcmVtb3ZlZCwgdW5iaW5kIGFsbCB2aWV3IGVsZW1lbnRzIGZyb20gdGhlIG1vZGVsLlxuICAgICAgICAvLyBSYW5nZSBpbnNpZGUgdmlldyBkb2N1bWVudCBmcmFnbWVudCBpcyB1c2VkIHRvIHVuYmluZCBkZWVwbHkuXG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlUmFuZ2VJbihyZW1vdmVkKS5nZXRJdGVtcygpKXtcbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLnVuYmluZFZpZXdFbGVtZW50KGNoaWxkLCB7XG4gICAgICAgICAgICAgICAgZGVmZXI6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIGA8c3Bhbj5gIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IHZpZXcgYXR0cmlidXRlIGVsZW1lbnR9IGZyb20gdGhlIGluZm9ybWF0aW9uXG4gKiBwcm92aWRlZCBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+SGlnaGxpZ2h0RGVzY3JpcHRvciBoaWdobGlnaHQgZGVzY3JpcHRvcn0gb2JqZWN0LiBJZiB0aGUgcHJpb3JpdHlcbiAqIGlzIG5vdCBwcm92aWRlZCBpbiB0aGUgZGVzY3JpcHRvciwgdGhlIGRlZmF1bHQgcHJpb3JpdHkgd2lsbCBiZSB1c2VkLlxuICovIGZ1bmN0aW9uIGNyZWF0ZVZpZXdFbGVtZW50RnJvbUhpZ2hsaWdodERlc2NyaXB0b3Iod3JpdGVyLCBkZXNjcmlwdG9yKSB7XG4gICAgY29uc3Qgdmlld0VsZW1lbnQgPSB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCgnc3BhbicsIGRlc2NyaXB0b3IuYXR0cmlidXRlcyk7XG4gICAgaWYgKGRlc2NyaXB0b3IuY2xhc3Nlcykge1xuICAgICAgICB2aWV3RWxlbWVudC5fYWRkQ2xhc3MoZGVzY3JpcHRvci5jbGFzc2VzKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBkZXNjcmlwdG9yLnByaW9yaXR5ID09PSAnbnVtYmVyJykge1xuICAgICAgICB2aWV3RWxlbWVudC5fcHJpb3JpdHkgPSBkZXNjcmlwdG9yLnByaW9yaXR5O1xuICAgIH1cbiAgICB2aWV3RWxlbWVudC5faWQgPSBkZXNjcmlwdG9yLmlkO1xuICAgIHJldHVybiB2aWV3RWxlbWVudDtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBjb252ZXJ0ZXIgd2hpY2ggY29udmVydHMgYSBub24tY29sbGFwc2VkIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24gbW9kZWwgc2VsZWN0aW9ufVxuICogdG8gYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uIHZpZXcgc2VsZWN0aW9ufS4gVGhlIGNvbnZlcnRlciBjb25zdW1lcyBhcHByb3ByaWF0ZVxuICogdmFsdWUgZnJvbSB0aGUgYGNvbnN1bWFibGVgIG9iamVjdCBhbmQgbWFwcyBtb2RlbCBwb3NpdGlvbnMgZnJvbSB0aGUgc2VsZWN0aW9uIHRvIHZpZXcgcG9zaXRpb25zLlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbERpc3BhdGNoZXIub24oICdzZWxlY3Rpb24nLCBjb252ZXJ0UmFuZ2VTZWxlY3Rpb24oKSApO1xuICogYGBgXG4gKlxuICogQHJldHVybnMgU2VsZWN0aW9uIGNvbnZlcnRlci5cbiAqLyBmdW5jdGlvbiBjb252ZXJ0UmFuZ2VTZWxlY3Rpb24oKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRhdGEuc2VsZWN0aW9uO1xuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShzZWxlY3Rpb24sICdzZWxlY3Rpb24nKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdSYW5nZXMgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiBzZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAgICAgdmlld1Jhbmdlcy5wdXNoKGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1JhbmdlKHJhbmdlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuc2V0U2VsZWN0aW9uKHZpZXdSYW5nZXMsIHtcbiAgICAgICAgICAgIGJhY2t3YXJkOiBzZWxlY3Rpb24uaXNCYWNrd2FyZFxuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5IHRoYXQgY3JlYXRlcyBhIGNvbnZlcnRlciB3aGljaCBjb252ZXJ0cyBhIGNvbGxhcHNlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uIG1vZGVsIHNlbGVjdGlvbn0gdG9cbiAqIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiB2aWV3IHNlbGVjdGlvbn0uIFRoZSBjb252ZXJ0ZXIgY29uc3VtZXMgYXBwcm9wcmlhdGVcbiAqIHZhbHVlIGZyb20gdGhlIGBjb25zdW1hYmxlYCBvYmplY3QsIG1hcHMgdGhlIG1vZGVsIHNlbGVjdGlvbiBwb3NpdGlvbiB0byB0aGUgdmlldyBwb3NpdGlvbiBhbmQgYnJlYWtzXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9IGF0IHRoZSBzZWxlY3Rpb24gcG9zaXRpb24uXG4gKlxuICogYGBgdHNcbiAqIG1vZGVsRGlzcGF0Y2hlci5vbiggJ3NlbGVjdGlvbicsIGNvbnZlcnRDb2xsYXBzZWRTZWxlY3Rpb24oKSApO1xuICogYGBgXG4gKlxuICogQW4gZXhhbXBsZSBvZiB0aGUgdmlldyBzdGF0ZSBiZWZvcmUgYW5kIGFmdGVyIGNvbnZlcnRpbmcgdGhlIGNvbGxhcHNlZCBzZWxlY3Rpb246XG4gKlxuICogYGBgXG4gKiAgICA8cD48c3Ryb25nPmZeb288c3Ryb25nPmJhcjwvcD5cbiAqIC0+IDxwPjxzdHJvbmc+Zjwvc3Ryb25nPl48c3Ryb25nPm9vPC9zdHJvbmc+YmFyPC9wPlxuICogYGBgXG4gKlxuICogQnkgYnJlYWtpbmcgYXR0cmlidXRlIGVsZW1lbnRzIGxpa2UgYDxzdHJvbmc+YCwgdGhlIHNlbGVjdGlvbiBpcyBpbiBhIGNvcnJlY3QgZWxlbWVudC4gVGhlbiwgd2hlbiB0aGUgc2VsZWN0aW9uIGF0dHJpYnV0ZSBpc1xuICogY29udmVydGVkLCBicm9rZW4gYXR0cmlidXRlcyBtaWdodCBiZSBtZXJnZWQgYWdhaW4sIG9yIHRoZSBwb3NpdGlvbiB3aGVyZSB0aGUgc2VsZWN0aW9uIGlzIG1heSBiZSB3cmFwcGVkXG4gKiB3aXRoIGRpZmZlcmVudCwgYXBwcm9wcmlhdGUgYXR0cmlidXRlIGVsZW1lbnRzLlxuICpcbiAqIFNlZSBhbHNvIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfmNsZWFuU2VsZWN0aW9ufSB3aGljaCBkb2VzIGEgY2xlYW4tdXBcbiAqIGJ5IG1lcmdpbmcgYXR0cmlidXRlcy5cbiAqXG4gKiBAcmV0dXJucyBTZWxlY3Rpb24gY29udmVydGVyLlxuICovIGZ1bmN0aW9uIGNvbnZlcnRDb2xsYXBzZWRTZWxlY3Rpb24oKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGRhdGEuc2VsZWN0aW9uO1xuICAgICAgICBpZiAoIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoc2VsZWN0aW9uLCAnc2VsZWN0aW9uJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIGNvbnN0IG1vZGVsUG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICBjb25zdCB2aWV3UG9zaXRpb24gPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdQb3NpdGlvbihtb2RlbFBvc2l0aW9uKTtcbiAgICAgICAgY29uc3QgYnJva2VuUG9zaXRpb24gPSB2aWV3V3JpdGVyLmJyZWFrQXR0cmlidXRlcyh2aWV3UG9zaXRpb24pO1xuICAgICAgICB2aWV3V3JpdGVyLnNldFNlbGVjdGlvbihicm9rZW5Qb3NpdGlvbik7XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBjb252ZXJ0ZXIgd2hpY2ggY2xlYW5zIGFydGlmYWN0cyBhZnRlciB0aGUgcHJldmlvdXNcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24gbW9kZWwgc2VsZWN0aW9ufSBjb252ZXJzaW9uLiBJdCByZW1vdmVzIGFsbCBlbXB0eVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgdmlldyBhdHRyaWJ1dGUgZWxlbWVudHN9IGFuZCBtZXJnZXMgc2libGluZyBhdHRyaWJ1dGVzIGF0IGFsbCBzdGFydCBhbmQgZW5kXG4gKiBwb3NpdGlvbnMgb2YgYWxsIHJhbmdlcy5cbiAqXG4gKiBgYGBcbiAqICAgIDxwPjxzdHJvbmc+Xjwvc3Ryb25nPjwvcD5cbiAqIC0+IDxwPl48L3A+XG4gKlxuICogICAgPHA+PHN0cm9uZz5mb288L3N0cm9uZz5ePHN0cm9uZz5iYXI8L3N0cm9uZz5iYXI8L3A+XG4gKiAtPiA8cD48c3Ryb25nPmZvb15iYXI8c3Ryb25nPmJhcjwvcD5cbiAqXG4gKiAgICA8cD48c3Ryb25nPmZvbzwvc3Ryb25nPjxlbT5ePC9lbT48c3Ryb25nPmJhcjwvc3Ryb25nPmJhcjwvcD5cbiAqIC0+IDxwPjxzdHJvbmc+Zm9vXmJhcjxzdHJvbmc+YmFyPC9wPlxuICogYGBgXG4gKlxuICogVGhpcyBsaXN0ZW5lciBzaG91bGQgYmUgYXNzaWduZWQgYmVmb3JlIGFueSBjb252ZXJ0ZXIgZm9yIHRoZSBuZXcgc2VsZWN0aW9uOlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbERpc3BhdGNoZXIub24oICdjbGVhblNlbGVjdGlvbicsIGNsZWFuU2VsZWN0aW9uKCkgKTtcbiAqIGBgYFxuICpcbiAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35jb252ZXJ0Q29sbGFwc2VkU2VsZWN0aW9ufVxuICogd2hpY2ggZG9lcyB0aGUgb3Bwb3NpdGUgYnkgYnJlYWtpbmcgYXR0cmlidXRlcyBpbiB0aGUgc2VsZWN0aW9uIHBvc2l0aW9uLlxuICpcbiAqIEByZXR1cm5zIFNlbGVjdGlvbiBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gY2xlYW5TZWxlY3Rpb24oKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgY29uc3Qgdmlld1NlbGVjdGlvbiA9IHZpZXdXcml0ZXIuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHZpZXdTZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAgICAgLy8gTm90IGNvbGxhcHNlZCBzZWxlY3Rpb24gc2hvdWxkIG5vdCBoYXZlIGFydGlmYWN0cy5cbiAgICAgICAgICAgIGlmIChyYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uIG1pZ2h0IGJlIGluIHRoZSBub2RlIHJlbW92ZWQgYnkgdGhlIHZpZXcgd3JpdGVyLlxuICAgICAgICAgICAgICAgIGlmIChyYW5nZS5lbmQucGFyZW50LmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5tZXJnZUF0dHJpYnV0ZXMocmFuZ2Uuc3RhcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2aWV3V3JpdGVyLnNldFNlbGVjdGlvbihudWxsKTtcbiAgICB9O1xufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5IHRoYXQgY3JlYXRlcyBhIGNvbnZlcnRlciB3aGljaCBjb252ZXJ0cyB0aGUgc2V0L2NoYW5nZS9yZW1vdmUgYXR0cmlidXRlIGNoYW5nZXMgZnJvbSB0aGUgbW9kZWwgdG8gdGhlIHZpZXcuXG4gKiBJdCBjYW4gYWxzbyBiZSB1c2VkIHRvIGNvbnZlcnQgc2VsZWN0aW9uIGF0dHJpYnV0ZXMuIEluIHRoYXQgY2FzZSwgYW4gZW1wdHkgYXR0cmlidXRlIGVsZW1lbnQgd2lsbCBiZSBjcmVhdGVkIGFuZCB0aGVcbiAqIHNlbGVjdGlvbiB3aWxsIGJlIHB1dCBpbnNpZGUgaXQuXG4gKlxuICogQXR0cmlidXRlcyBmcm9tIHRoZSBtb2RlbCBhcmUgY29udmVydGVkIHRvIGEgdmlldyBlbGVtZW50IHRoYXQgd2lsbCBiZSB3cmFwcGluZyB0aGVzZSB2aWV3IG5vZGVzIHRoYXQgYXJlIGJvdW5kIHRvXG4gKiBtb2RlbCBlbGVtZW50cyBoYXZpbmcgdGhlIGdpdmVuIGF0dHJpYnV0ZS4gVGhpcyBpcyB1c2VmdWwgZm9yIGF0dHJpYnV0ZXMgbGlrZSBgYm9sZGAgdGhhdCBtYXkgYmUgc2V0IG9uIHRleHQgbm9kZXMgaW4gdGhlIG1vZGVsXG4gKiBidXQgYXJlIHJlcHJlc2VudGVkIGFzIGFuIGVsZW1lbnQgaW4gdGhlIHZpZXc6XG4gKlxuICogYGBgXG4gKiBbcGFyYWdyYXBoXSAgICAgICAgICAgICAgTU9ERUwgPT09PT4gVklFVyAgICAgICAgPHA+XG4gKiBcdHwtIGEge2JvbGQ6IHRydWV9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8LSA8Yj5cbiAqIFx0fC0gYiB7Ym9sZDogdHJ1ZX0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICB8LSBhYlxuICogXHR8LSBjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfC0gY1xuICogXHRgYGBcbiAqXG4gKiBQYXNzZWQgYEZ1bmN0aW9uYCB3aWxsIGJlIHByb3ZpZGVkIHdpdGggdGhlIGF0dHJpYnV0ZSB2YWx1ZSBhbmQgdGhlbiBhbGwgdGhlIHBhcmFtZXRlcnMgb2YgdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6YXR0cmlidXRlIGBhdHRyaWJ1dGVgIGV2ZW50fS5cbiAqIEl0IGlzIGV4cGVjdGVkIHRoYXQgdGhlIGZ1bmN0aW9uIHJldHVybnMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9LlxuICogVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24gd2lsbCBiZSB0aGUgd3JhcHBpbmcgZWxlbWVudC5cbiAqIFdoZW4gdGhlIHByb3ZpZGVkIGBGdW5jdGlvbmAgZG9lcyBub3QgcmV0dXJuIGFueSBlbGVtZW50LCBubyBjb252ZXJzaW9uIHdpbGwgdGFrZSBwbGFjZS5cbiAqXG4gKiBUaGUgY29udmVydGVyIGF1dG9tYXRpY2FsbHkgY29uc3VtZXMgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgZnJvbSB0aGUgY29uc3VtYWJsZXMgbGlzdCBhbmQgc3RvcHMgdGhlIGV2ZW50IChzZWVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlcn0pLlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbERpc3BhdGNoZXIub24oICdhdHRyaWJ1dGU6Ym9sZCcsIHdyYXAoICggbW9kZWxBdHRyaWJ1dGVWYWx1ZSwgeyB3cml0ZXIgfSApID0+IHtcbiAqIFx0cmV0dXJuIHdyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KCAnc3Ryb25nJyApO1xuICogfSApO1xuICogYGBgXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gZWxlbWVudENyZWF0b3IgRnVuY3Rpb24gcmV0dXJuaW5nIGEgdmlldyBlbGVtZW50IHRoYXQgd2lsbCBiZSB1c2VkIGZvciB3cmFwcGluZy5cbiAqIEByZXR1cm5zIFNldC9jaGFuZ2UgYXR0cmlidXRlIGNvbnZlcnRlci5cbiAqLyBmdW5jdGlvbiB3cmFwKGVsZW1lbnRDcmVhdG9yKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3QoZGF0YS5pdGVtLCBldnQubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZWNyZWF0ZSBjdXJyZW50IHdyYXBwaW5nIG5vZGUuIEl0IHdpbGwgYmUgdXNlZCB0byB1bndyYXAgdmlldyByYW5nZSBpZiB0aGUgYXR0cmlidXRlIHZhbHVlIGhhcyBjaGFuZ2VkXG4gICAgICAgIC8vIG9yIHRoZSBhdHRyaWJ1dGUgd2FzIHJlbW92ZWQuXG4gICAgICAgIGNvbnN0IG9sZFZpZXdFbGVtZW50ID0gZWxlbWVudENyZWF0b3IoZGF0YS5hdHRyaWJ1dGVPbGRWYWx1ZSwgY29udmVyc2lvbkFwaSwgZGF0YSk7XG4gICAgICAgIC8vIENyZWF0ZSBub2RlIHRvIHdyYXAgd2l0aC5cbiAgICAgICAgY29uc3QgbmV3Vmlld0VsZW1lbnQgPSBlbGVtZW50Q3JlYXRvcihkYXRhLmF0dHJpYnV0ZU5ld1ZhbHVlLCBjb252ZXJzaW9uQXBpLCBkYXRhKTtcbiAgICAgICAgaWYgKCFvbGRWaWV3RWxlbWVudCAmJiAhbmV3Vmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sIGV2dC5uYW1lKTtcbiAgICAgICAgY29uc3Qgdmlld1dyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICBjb25zdCB2aWV3U2VsZWN0aW9uID0gdmlld1dyaXRlci5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGlmIChkYXRhLml0ZW0gaW5zdGFuY2VvZiBTZWxlY3Rpb24gfHwgZGF0YS5pdGVtIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIC8vIFNlbGVjdGlvbiBhdHRyaWJ1dGUgY29udmVyc2lvbi5cbiAgICAgICAgICAgIHZpZXdXcml0ZXIud3JhcCh2aWV3U2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKSwgbmV3Vmlld0VsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTm9kZSBhdHRyaWJ1dGUgY29udmVyc2lvbi5cbiAgICAgICAgICAgIGxldCB2aWV3UmFuZ2UgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdSYW5nZShkYXRhLnJhbmdlKTtcbiAgICAgICAgICAgIC8vIEZpcnN0LCB1bndyYXAgdGhlIHJhbmdlIGZyb20gY3VycmVudCB3cmFwcGVyLlxuICAgICAgICAgICAgaWYgKGRhdGEuYXR0cmlidXRlT2xkVmFsdWUgIT09IG51bGwgJiYgb2xkVmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2aWV3UmFuZ2UgPSB2aWV3V3JpdGVyLnVud3JhcCh2aWV3UmFuZ2UsIG9sZFZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYXRhLmF0dHJpYnV0ZU5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdmlld1dyaXRlci53cmFwKHZpZXdSYW5nZSwgbmV3Vmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBjb252ZXJ0ZXIgd2hpY2ggY29udmVydHMgbm9kZSBpbnNlcnRpb24gY2hhbmdlcyBmcm9tIHRoZSBtb2RlbCB0byB0aGUgdmlldy5cbiAqIFRoZSBmdW5jdGlvbiBwYXNzZWQgd2lsbCBiZSBwcm92aWRlZCB3aXRoIGFsbCB0aGUgcGFyYW1ldGVycyBvZiB0aGUgZGlzcGF0Y2hlcidzXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6aW5zZXJ0IGBpbnNlcnRgIGV2ZW50fS5cbiAqIEl0IGlzIGV4cGVjdGVkIHRoYXQgdGhlIGZ1bmN0aW9uIHJldHVybnMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9LlxuICogVGhlIHJlc3VsdCBvZiB0aGUgZnVuY3Rpb24gd2lsbCBiZSBpbnNlcnRlZCBpbnRvIHRoZSB2aWV3LlxuICpcbiAqIFRoZSBjb252ZXJ0ZXIgYXV0b21hdGljYWxseSBjb25zdW1lcyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZSBmcm9tIHRoZSBjb25zdW1hYmxlcyBsaXN0IGFuZCBiaW5kcyB0aGUgbW9kZWwgYW5kIHZpZXcgZWxlbWVudHMuXG4gKlxuICogYGBgdHNcbiAqIGRvd25jYXN0RGlzcGF0Y2hlci5vbihcbiAqIFx0J2luc2VydDpteUVsZW0nLFxuICogXHRpbnNlcnRFbGVtZW50KCAoIG1vZGVsSXRlbSwgeyB3cml0ZXIgfSApID0+IHtcbiAqIFx0XHRjb25zdCB0ZXh0ID0gd3JpdGVyLmNyZWF0ZVRleHQoICdteVRleHQnICk7XG4gKiBcdFx0Y29uc3QgbXlFbGVtID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdteUVsZW0nLCB7IG15QXR0cjogJ215LScgKyBtb2RlbEl0ZW0uZ2V0QXR0cmlidXRlKCAnbXlBdHRyJyApIH0sIHRleHQgKTtcbiAqXG4gKiBcdFx0Ly8gRG8gc29tZXRoaW5nIGZhbmN5IHdpdGggYG15RWxlbWAgdXNpbmcgYG1vZGVsSXRlbWAgb3Igb3RoZXIgcGFyYW1ldGVycy5cbiAqXG4gKiBcdFx0cmV0dXJuIG15RWxlbTtcbiAqIFx0fVxuICogKSApO1xuICogYGBgXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gIGVsZW1lbnRDcmVhdG9yIEZ1bmN0aW9uIHJldHVybmluZyBhIHZpZXcgZWxlbWVudCwgd2hpY2ggd2lsbCBiZSBpbnNlcnRlZC5cbiAqIEBwYXJhbSBjb25zdW1lciBGdW5jdGlvbiBkZWZpbmluZyBlbGVtZW50IGNvbnN1bXB0aW9uIHByb2Nlc3MuXG4gKiBCeSBkZWZhdWx0IHRoaXMgZnVuY3Rpb24ganVzdCBjb25zdW1lIHBhc3NlZCBpdGVtIGluc2VydGlvbi5cbiAqIEByZXR1cm5zIEluc2VydCBlbGVtZW50IGV2ZW50IGNvbnZlcnRlci5cbiAqLyBmdW5jdGlvbiBpbnNlcnRFbGVtZW50KGVsZW1lbnRDcmVhdG9yLCBjb25zdW1lciA9IGRlZmF1bHRDb25zdW1lcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBpZiAoIWNvbnN1bWVyKGRhdGEuaXRlbSwgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLCB7XG4gICAgICAgICAgICBwcmVmbGlnaHQ6IHRydWVcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IGVsZW1lbnRDcmVhdG9yKGRhdGEuaXRlbSwgY29udmVyc2lvbkFwaSwgZGF0YSk7XG4gICAgICAgIGlmICghdmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDb25zdW1lIGFuIGVsZW1lbnQgaW5zZXJ0aW9uIGFuZCBhbGwgcHJlc2VudCBhdHRyaWJ1dGVzIHRoYXQgYXJlIHNwZWNpZmllZCBhcyBhIHJlY29udmVyc2lvbiB0cmlnZ2Vycy5cbiAgICAgICAgY29uc3VtZXIoZGF0YS5pdGVtLCBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUpO1xuICAgICAgICBjb25zdCB2aWV3UG9zaXRpb24gPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdQb3NpdGlvbihkYXRhLnJhbmdlLnN0YXJ0KTtcbiAgICAgICAgY29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRzKGRhdGEuaXRlbSwgdmlld0VsZW1lbnQpO1xuICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQodmlld1Bvc2l0aW9uLCB2aWV3RWxlbWVudCk7XG4gICAgICAgIC8vIENvbnZlcnQgYXR0cmlidXRlcyBiZWZvcmUgY29udmVydGluZyBjaGlsZHJlbi5cbiAgICAgICAgY29udmVyc2lvbkFwaS5jb252ZXJ0QXR0cmlidXRlcyhkYXRhLml0ZW0pO1xuICAgICAgICAvLyBDb252ZXJ0IGNoaWxkcmVuIG9yIHJlaW5zZXJ0IHByZXZpb3VzIHZpZXcgZWxlbWVudHMuXG4gICAgICAgIHJlaW5zZXJ0T3JDb252ZXJ0Tm9kZXModmlld0VsZW1lbnQsIGRhdGEuaXRlbS5nZXRDaGlsZHJlbigpLCBjb252ZXJzaW9uQXBpLCB7XG4gICAgICAgICAgICByZWNvbnZlcnNpb246IGRhdGEucmVjb252ZXJzaW9uXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnkgdGhhdCBjcmVhdGVzIGEgY29udmVydGVyIHdoaWNoIGNvbnZlcnRzIGEgc2luZ2xlIG1vZGVsIG5vZGUgaW5zZXJ0aW9uIHRvIGEgdmlldyBzdHJ1Y3R1cmUuXG4gKlxuICogSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGUgcGFzc2VkIGVsZW1lbnQgY3JlYXRvciBmdW5jdGlvbiByZXR1cm5zIGFuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSB3aXRoIGF0dGFjaGVkIHNsb3RzXG4gKiBjcmVhdGVkIHdpdGggYHdyaXRlci5jcmVhdGVTbG90KClgIHRvIGluZGljYXRlIHdoZXJlIGNoaWxkIG5vZGVzIHNob3VsZCBiZSBjb252ZXJ0ZWQuXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkRvd25jYXN0SGVscGVycyNlbGVtZW50VG9TdHJ1Y3R1cmVcbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBlbGVtZW50Q3JlYXRvciBGdW5jdGlvbiByZXR1cm5pbmcgYSB2aWV3IHN0cnVjdHVyZSwgd2hpY2ggd2lsbCBiZSBpbnNlcnRlZC5cbiAqIEBwYXJhbSBjb25zdW1lciBBIGNhbGxiYWNrIHRoYXQgaXMgZXhwZWN0ZWQgdG8gY29uc3VtZSBhbGwgdGhlIGNvbnN1bWFibGVzXG4gKiB0aGF0IHdlcmUgdXNlZCBieSB0aGUgZWxlbWVudCBjcmVhdG9yLlxuICogQHJldHVybnMgSW5zZXJ0IGVsZW1lbnQgZXZlbnQgY29udmVydGVyLlxuKi8gZnVuY3Rpb24gaW5zZXJ0U3RydWN0dXJlKGVsZW1lbnRDcmVhdG9yLCBjb25zdW1lcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBpZiAoIWNvbnN1bWVyKGRhdGEuaXRlbSwgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLCB7XG4gICAgICAgICAgICBwcmVmbGlnaHQ6IHRydWVcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzbG90c01hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuX3JlZ2lzdGVyU2xvdEZhY3RvcnkoY3JlYXRlU2xvdEZhY3RvcnkoZGF0YS5pdGVtLCBzbG90c01hcCwgY29udmVyc2lvbkFwaSkpO1xuICAgICAgICAvLyBWaWV3IGNyZWF0aW9uLlxuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IGVsZW1lbnRDcmVhdG9yKGRhdGEuaXRlbSwgY29udmVyc2lvbkFwaSwgZGF0YSk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLl9jbGVhclNsb3RGYWN0b3J5KCk7XG4gICAgICAgIGlmICghdmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiBhbGwgY2hpbGRyZW4gYXJlIGNvdmVyZWQgYnkgc2xvdHMgYW5kIHRoZXJlIGlzIG5vIGNoaWxkIHRoYXQgbGFuZGVkIGluIG11bHRpcGxlIHNsb3RzLlxuICAgICAgICB2YWxpZGF0ZVNsb3RzQ2hpbGRyZW4oZGF0YS5pdGVtLCBzbG90c01hcCwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIC8vIENvbnN1bWUgYW4gZWxlbWVudCBpbnNlcnRpb24gYW5kIGFsbCBwcmVzZW50IGF0dHJpYnV0ZXMgdGhhdCBhcmUgc3BlY2lmaWVkIGFzIGEgcmVjb252ZXJzaW9uIHRyaWdnZXJzLlxuICAgICAgICBjb25zdW1lcihkYXRhLml0ZW0sIGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZSk7XG4gICAgICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKGRhdGEucmFuZ2Uuc3RhcnQpO1xuICAgICAgICBjb252ZXJzaW9uQXBpLm1hcHBlci5iaW5kRWxlbWVudHMoZGF0YS5pdGVtLCB2aWV3RWxlbWVudCk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLmluc2VydCh2aWV3UG9zaXRpb24sIHZpZXdFbGVtZW50KTtcbiAgICAgICAgLy8gQ29udmVydCBhdHRyaWJ1dGVzIGJlZm9yZSBjb252ZXJ0aW5nIGNoaWxkcmVuLlxuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnZlcnRBdHRyaWJ1dGVzKGRhdGEuaXRlbSk7XG4gICAgICAgIC8vIEZpbGwgdmlldyBzbG90cyB3aXRoIHByZXZpb3VzIHZpZXcgZWxlbWVudHMgb3IgY3JlYXRlIG5ldyBvbmVzLlxuICAgICAgICBmaWxsU2xvdHModmlld0VsZW1lbnQsIHNsb3RzTWFwLCBjb252ZXJzaW9uQXBpLCB7XG4gICAgICAgICAgICByZWNvbnZlcnNpb246IGRhdGEucmVjb252ZXJzaW9uXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnkgdGhhdCBjcmVhdGVzIGEgY29udmVydGVyIHdoaWNoIGNvbnZlcnRzIG1hcmtlciBhZGRpbmcgY2hhbmdlIHRvIHRoZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IHZpZXcgVUkgZWxlbWVudH0uXG4gKlxuICogVGhlIHZpZXcgVUkgZWxlbWVudCB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIHZpZXcgZGVwZW5kcyBvbiB0aGUgcGFzc2VkIHBhcmFtZXRlci4gU2VlIHtAbGluayB+aW5zZXJ0RWxlbWVudH0uXG4gKiBJbiBjYXNlIG9mIGEgbm9uLWNvbGxhcHNlZCByYW5nZSwgdGhlIFVJIGVsZW1lbnQgd2lsbCBub3Qgd3JhcCBub2RlcyBidXQgc2VwYXJhdGUgZWxlbWVudHMgd2lsbCBiZSBwbGFjZWQgYXQgdGhlIGJlZ2lubmluZ1xuICogYW5kIGF0IHRoZSBlbmQgb2YgdGhlIHJhbmdlLlxuICpcbiAqIFRoaXMgY29udmVydGVyIGJpbmRzIGNyZWF0ZWQgVUkgZWxlbWVudHMgd2l0aCB0aGUgbWFya2VyIG5hbWUgdXNpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tYXBwZXJ+TWFwcGVyI2JpbmRFbGVtZW50VG9NYXJrZXJ9LlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGVsZW1lbnRDcmVhdG9yIEEgdmlldyBVSSBlbGVtZW50IG9yIGEgZnVuY3Rpb24gcmV0dXJuaW5nIHRoZSB2aWV3IGVsZW1lbnQgdGhhdCB3aWxsIGJlIGluc2VydGVkLlxuICogQHJldHVybnMgSW5zZXJ0IGVsZW1lbnQgZXZlbnQgY29udmVydGVyLlxuICovIGZ1bmN0aW9uIGluc2VydFVJRWxlbWVudChlbGVtZW50Q3JlYXRvcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICAvLyBDcmVhdGUgdHdvIHZpZXcgZWxlbWVudHMuIE9uZSB3aWxsIGJlIGluc2VydGVkIGF0IHRoZSBiZWdpbm5pbmcgb2YgbWFya2VyLCBvbmUgYXQgdGhlIGVuZC5cbiAgICAgICAgLy8gSWYgbWFya2VyIGlzIGNvbGxhcHNlZCwgb25seSBcIm9wZW5pbmdcIiBlbGVtZW50IHdpbGwgYmUgaW5zZXJ0ZWQuXG4gICAgICAgIGRhdGEuaXNPcGVuaW5nID0gdHJ1ZTtcbiAgICAgICAgY29uc3Qgdmlld1N0YXJ0RWxlbWVudCA9IGVsZW1lbnRDcmVhdG9yKGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBkYXRhLmlzT3BlbmluZyA9IGZhbHNlO1xuICAgICAgICBjb25zdCB2aWV3RW5kRWxlbWVudCA9IGVsZW1lbnRDcmVhdG9yKGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBpZiAoIXZpZXdTdGFydEVsZW1lbnQgfHwgIXZpZXdFbmRFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWFya2VyUmFuZ2UgPSBkYXRhLm1hcmtlclJhbmdlO1xuICAgICAgICAvLyBNYXJrZXIgdGhhdCBpcyBjb2xsYXBzZWQgaGFzIGNvbnN1bWFibGUgYnVpbGQgZGlmZmVyZW50bHkgdGhhdCBub24tY29sbGFwc2VkIG9uZS5cbiAgICAgICAgLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGBhZGRNYXJrZXJgIGV2ZW50IGRlc2NyaXB0aW9uLlxuICAgICAgICAvLyBJZiBtYXJrZXIncyByYW5nZSBpcyBjb2xsYXBzZWQgLSBjaGVjayBpZiBpdCBjYW4gYmUgY29uc3VtZWQuXG4gICAgICAgIGlmIChtYXJrZXJSYW5nZS5pc0NvbGxhcHNlZCAmJiAhY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUobWFya2VyUmFuZ2UsIGV2dC5uYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIG1hcmtlcidzIHJhbmdlIGlzIG5vdCBjb2xsYXBzZWQgLSBjb25zdW1lIGFsbCBpdGVtcyBpbnNpZGUuXG4gICAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgbWFya2VyUmFuZ2Upe1xuICAgICAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZSh2YWx1ZS5pdGVtLCBldnQubmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWFwcGVyID0gY29udmVyc2lvbkFwaS5tYXBwZXI7XG4gICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgLy8gQWRkIFwib3BlbmluZ1wiIGVsZW1lbnQuXG4gICAgICAgIHZpZXdXcml0ZXIuaW5zZXJ0KG1hcHBlci50b1ZpZXdQb3NpdGlvbihtYXJrZXJSYW5nZS5zdGFydCksIHZpZXdTdGFydEVsZW1lbnQpO1xuICAgICAgICBjb252ZXJzaW9uQXBpLm1hcHBlci5iaW5kRWxlbWVudFRvTWFya2VyKHZpZXdTdGFydEVsZW1lbnQsIGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgIC8vIEFkZCBcImNsb3NpbmdcIiBlbGVtZW50IG9ubHkgaWYgcmFuZ2UgaXMgbm90IGNvbGxhcHNlZC5cbiAgICAgICAgaWYgKCFtYXJrZXJSYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgdmlld1dyaXRlci5pbnNlcnQobWFwcGVyLnRvVmlld1Bvc2l0aW9uKG1hcmtlclJhbmdlLmVuZCksIHZpZXdFbmRFbGVtZW50KTtcbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLmJpbmRFbGVtZW50VG9NYXJrZXIodmlld0VuZEVsZW1lbnQsIGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICB9O1xufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5IHRoYXQgcmV0dXJucyBhIGRlZmF1bHQgZG93bmNhc3QgY29udmVydGVyIGZvciByZW1vdmluZyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBVSSBlbGVtZW50fVxuICogYmFzZWQgb24gbWFya2VyIHJlbW92ZSBjaGFuZ2UuXG4gKlxuICogVGhpcyBjb252ZXJ0ZXIgdW5iaW5kcyBlbGVtZW50cyBmcm9tIHRoZSBtYXJrZXIgbmFtZS5cbiAqXG4gKiBAcmV0dXJucyBSZW1vdmVkIFVJIGVsZW1lbnQgY29udmVydGVyLlxuICovIGZ1bmN0aW9uIHJlbW92ZVVJRWxlbWVudCgpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBjb252ZXJzaW9uQXBpLm1hcHBlci5tYXJrZXJOYW1lVG9FbGVtZW50cyhkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKXtcbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLnVuYmluZEVsZW1lbnRGcm9tTWFya2VyTmFtZShlbGVtZW50LCBkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuY2xlYXIoY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlUmFuZ2VPbihlbGVtZW50KSwgZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuY2xlYXJDbG9uZWRFbGVtZW50c0dyb3VwKGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgIGV2dC5zdG9wKCk7XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBkZWZhdWx0IGNvbnZlcnRlciBmb3IgbW9kZWwgbWFya2Vycy5cbiAqXG4gKiBTZWUge0BsaW5rIERvd25jYXN0SGVscGVycyNtYXJrZXJUb0RhdGF9IGZvciBtb3JlIGluZm9ybWF0aW9uIHdoYXQgdHlwZSBvZiB2aWV3IGlzIGdlbmVyYXRlZC5cbiAqXG4gKiBUaGlzIGNvbnZlcnRlciBiaW5kcyBjcmVhdGVkIFVJIGVsZW1lbnRzIGFuZCBhZmZlY3RlZCB2aWV3IGVsZW1lbnRzIHdpdGggdGhlIG1hcmtlciBuYW1lXG4gKiB1c2luZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXIjYmluZEVsZW1lbnRUb01hcmtlcn0uXG4gKlxuICogQHJldHVybnMgQWRkIG1hcmtlciBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gaW5zZXJ0TWFya2VyRGF0YSh2aWV3Q3JlYXRvcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCB2aWV3TWFya2VyRGF0YSA9IHZpZXdDcmVhdG9yKGRhdGEubWFya2VyTmFtZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGlmICghdmlld01hcmtlckRhdGEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXJrZXJSYW5nZSA9IGRhdGEubWFya2VyUmFuZ2U7XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUobWFya2VyUmFuZ2UsIGV2dC5uYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFkZGluZyBjbG9zaW5nIGRhdGEgZmlyc3QgdG8ga2VlcCB0aGUgcHJvcGVyIG9yZGVyIGluIHRoZSB2aWV3LlxuICAgICAgICBoYW5kbGVNYXJrZXJCb3VuZGFyeShtYXJrZXJSYW5nZSwgZmFsc2UsIGNvbnZlcnNpb25BcGksIGRhdGEsIHZpZXdNYXJrZXJEYXRhKTtcbiAgICAgICAgaGFuZGxlTWFya2VyQm91bmRhcnkobWFya2VyUmFuZ2UsIHRydWUsIGNvbnZlcnNpb25BcGksIGRhdGEsIHZpZXdNYXJrZXJEYXRhKTtcbiAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICB9O1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGBpbnNlcnRNYXJrZXJEYXRhKClgIHRoYXQgbWFya3MgYSBtYXJrZXIgYm91bmRhcnkgYXQgdGhlIGJlZ2lubmluZyBvciBlbmQgb2YgZ2l2ZW4gYHJhbmdlYC5cbiAqLyBmdW5jdGlvbiBoYW5kbGVNYXJrZXJCb3VuZGFyeShyYW5nZSwgaXNTdGFydCwgY29udmVyc2lvbkFwaSwgZGF0YSwgdmlld01hcmtlckRhdGEpIHtcbiAgICBjb25zdCBtb2RlbFBvc2l0aW9uID0gaXNTdGFydCA/IHJhbmdlLnN0YXJ0IDogcmFuZ2UuZW5kO1xuICAgIGNvbnN0IGVsZW1lbnRBZnRlciA9IG1vZGVsUG9zaXRpb24ubm9kZUFmdGVyICYmIG1vZGVsUG9zaXRpb24ubm9kZUFmdGVyLmlzKCdlbGVtZW50JykgPyBtb2RlbFBvc2l0aW9uLm5vZGVBZnRlciA6IG51bGw7XG4gICAgY29uc3QgZWxlbWVudEJlZm9yZSA9IG1vZGVsUG9zaXRpb24ubm9kZUJlZm9yZSAmJiBtb2RlbFBvc2l0aW9uLm5vZGVCZWZvcmUuaXMoJ2VsZW1lbnQnKSA/IG1vZGVsUG9zaXRpb24ubm9kZUJlZm9yZSA6IG51bGw7XG4gICAgaWYgKGVsZW1lbnRBZnRlciB8fCBlbGVtZW50QmVmb3JlKSB7XG4gICAgICAgIGxldCBtb2RlbEVsZW1lbnQ7XG4gICAgICAgIGxldCBpc0JlZm9yZTtcbiAgICAgICAgLy8gSWYgcG9zc2libGUsIHdlIHdhbnQgdG8gYWRkIGBkYXRhLWdyb3VwLXN0YXJ0LWJlZm9yZWAgYW5kIGBkYXRhLWdyb3VwLWVuZC1hZnRlcmAgYXR0cmlidXRlcy5cbiAgICAgICAgaWYgKGlzU3RhcnQgJiYgZWxlbWVudEFmdGVyIHx8ICFpc1N0YXJ0ICYmICFlbGVtZW50QmVmb3JlKSB7XG4gICAgICAgICAgICAvLyBbPGVsZW1lbnRBZnRlcj4uLi48L2VsZW1lbnRBZnRlcj4gLT4gPGVsZW1lbnRBZnRlciBkYXRhLWdyb3VwLXN0YXJ0LWJlZm9yZT1cIi4uLlwiPi4uLjwvZWxlbWVudEFmdGVyPlxuICAgICAgICAgICAgLy8gPHBhcmVudD5dPGVsZW1lbnRBZnRlcj4gLT4gPHBhcmVudD48ZWxlbWVudEFmdGVyIGRhdGEtZ3JvdXAtZW5kLWJlZm9yZT1cIi4uLlwiPlxuICAgICAgICAgICAgbW9kZWxFbGVtZW50ID0gZWxlbWVudEFmdGVyO1xuICAgICAgICAgICAgaXNCZWZvcmUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gPGVsZW1lbnRCZWZvcmU+Li4uPC9lbGVtZW50QmVmb3JlPl0gLT4gPGVsZW1lbnRCZWZvcmUgZGF0YS1ncm91cC1lbmQtYWZ0ZXI9XCIuLi5cIj4uLi48L2VsZW1lbnRCZWZvcmU+XG4gICAgICAgICAgICAvLyA8L2VsZW1lbnRCZWZvcmU+WzwvcGFyZW50PiAtPiA8L2VsZW1lbnRCZWZvcmUgZGF0YS1ncm91cC1zdGFydC1hZnRlcj1cIi4uLlwiPjwvcGFyZW50PlxuICAgICAgICAgICAgbW9kZWxFbGVtZW50ID0gZWxlbWVudEJlZm9yZTtcbiAgICAgICAgICAgIGlzQmVmb3JlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KG1vZGVsRWxlbWVudCk7XG4gICAgICAgIC8vIEluIHJhcmUgY2lyY3Vtc3RhbmNlcywgdGhlIG1vZGVsIGVsZW1lbnQgbWF5IGJlIG5vdCBtYXBwZWQgdG8gYW55IHZpZXcgZWxlbWVudCBhbmQgdGhhdCB3b3VsZCBjYXVzZSBhbiBlcnJvci5cbiAgICAgICAgLy8gT25lIG9mIHRob3NlIHNpdHVhdGlvbnMgaXMgYSBzb2Z0IGJyZWFrIGluc2lkZSBjb2RlIGJsb2NrLlxuICAgICAgICBpZiAodmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgIGluc2VydE1hcmtlckFzQXR0cmlidXRlKHZpZXdFbGVtZW50LCBpc1N0YXJ0LCBpc0JlZm9yZSwgY29udmVyc2lvbkFwaSwgZGF0YSwgdmlld01hcmtlckRhdGEpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKG1vZGVsUG9zaXRpb24pO1xuICAgIGluc2VydE1hcmtlckFzRWxlbWVudCh2aWV3UG9zaXRpb24sIGlzU3RhcnQsIGNvbnZlcnNpb25BcGksIGRhdGEsIHZpZXdNYXJrZXJEYXRhKTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBgaW5zZXJ0TWFya2VyRGF0YSgpYCB0aGF0IG1hcmtzIGEgbWFya2VyIGJvdW5kYXJ5IGluIHRoZSB2aWV3IGFzIGFuIGF0dHJpYnV0ZSBvbiBhIHZpZXcgZWxlbWVudC5cbiAqLyBmdW5jdGlvbiBpbnNlcnRNYXJrZXJBc0F0dHJpYnV0ZSh2aWV3RWxlbWVudCwgaXNTdGFydCwgaXNCZWZvcmUsIGNvbnZlcnNpb25BcGksIGRhdGEsIHZpZXdNYXJrZXJEYXRhKSB7XG4gICAgY29uc3QgYXR0cmlidXRlTmFtZSA9IGBkYXRhLSR7dmlld01hcmtlckRhdGEuZ3JvdXB9LSR7aXNTdGFydCA/ICdzdGFydCcgOiAnZW5kJ30tJHtpc0JlZm9yZSA/ICdiZWZvcmUnIDogJ2FmdGVyJ31gO1xuICAgIGNvbnN0IG1hcmtlck5hbWVzID0gdmlld0VsZW1lbnQuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpID8gdmlld0VsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpLnNwbGl0KCcsJykgOiBbXTtcbiAgICAvLyBBZGRpbmcgbWFya2VyIG5hbWUgYXQgdGhlIGJlZ2lubmluZyB0byBoYXZlIHRoZSBzYW1lIG9yZGVyIGluIHRoZSBhdHRyaWJ1dGUgYXMgdGhlcmUgaXMgd2l0aCBtYXJrZXIgZWxlbWVudHMuXG4gICAgbWFya2VyTmFtZXMudW5zaGlmdCh2aWV3TWFya2VyRGF0YS5uYW1lKTtcbiAgICBjb252ZXJzaW9uQXBpLndyaXRlci5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgbWFya2VyTmFtZXMuam9pbignLCcpLCB2aWV3RWxlbWVudCk7XG4gICAgY29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRUb01hcmtlcih2aWV3RWxlbWVudCwgZGF0YS5tYXJrZXJOYW1lKTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBgaW5zZXJ0TWFya2VyRGF0YSgpYCB0aGF0IG1hcmtzIGEgbWFya2VyIGJvdW5kYXJ5IGluIHRoZSB2aWV3IGFzIGEgc2VwYXJhdGUgdmlldyB1aSBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGluc2VydE1hcmtlckFzRWxlbWVudChwb3NpdGlvbiwgaXNTdGFydCwgY29udmVyc2lvbkFwaSwgZGF0YSwgdmlld01hcmtlckRhdGEpIHtcbiAgICBjb25zdCB2aWV3RWxlbWVudE5hbWUgPSBgJHt2aWV3TWFya2VyRGF0YS5ncm91cH0tJHtpc1N0YXJ0ID8gJ3N0YXJ0JyA6ICdlbmQnfWA7XG4gICAgY29uc3QgYXR0cnMgPSB2aWV3TWFya2VyRGF0YS5uYW1lID8ge1xuICAgICAgICAnbmFtZSc6IHZpZXdNYXJrZXJEYXRhLm5hbWVcbiAgICB9IDogbnVsbDtcbiAgICBjb25zdCB2aWV3RWxlbWVudCA9IGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZVVJRWxlbWVudCh2aWV3RWxlbWVudE5hbWUsIGF0dHJzKTtcbiAgICBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQocG9zaXRpb24sIHZpZXdFbGVtZW50KTtcbiAgICBjb252ZXJzaW9uQXBpLm1hcHBlci5iaW5kRWxlbWVudFRvTWFya2VyKHZpZXdFbGVtZW50LCBkYXRhLm1hcmtlck5hbWUpO1xufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5IHRoYXQgY3JlYXRlcyBhIGNvbnZlcnRlciBmb3IgcmVtb3ZpbmcgYSBtb2RlbCBtYXJrZXIgZGF0YSBhZGRlZCBieSB0aGUge0BsaW5rICNpbnNlcnRNYXJrZXJEYXRhfSBjb252ZXJ0ZXIuXG4gKlxuICogQHJldHVybnMgUmVtb3ZlIG1hcmtlciBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gcmVtb3ZlTWFya2VyRGF0YSh2aWV3Q3JlYXRvcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCB2aWV3RGF0YSA9IHZpZXdDcmVhdG9yKGRhdGEubWFya2VyTmFtZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGlmICghdmlld0RhdGEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlbGVtZW50cyA9IGNvbnZlcnNpb25BcGkubWFwcGVyLm1hcmtlck5hbWVUb0VsZW1lbnRzKGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgIGlmICghZWxlbWVudHMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpe1xuICAgICAgICAgICAgY29udmVyc2lvbkFwaS5tYXBwZXIudW5iaW5kRWxlbWVudEZyb21NYXJrZXJOYW1lKGVsZW1lbnQsIGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pcygnY29udGFpbmVyRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlTWFya2VyRnJvbUF0dHJpYnV0ZShgZGF0YS0ke3ZpZXdEYXRhLmdyb3VwfS1zdGFydC1iZWZvcmVgLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICByZW1vdmVNYXJrZXJGcm9tQXR0cmlidXRlKGBkYXRhLSR7dmlld0RhdGEuZ3JvdXB9LXN0YXJ0LWFmdGVyYCwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlTWFya2VyRnJvbUF0dHJpYnV0ZShgZGF0YS0ke3ZpZXdEYXRhLmdyb3VwfS1lbmQtYmVmb3JlYCwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlTWFya2VyRnJvbUF0dHJpYnV0ZShgZGF0YS0ke3ZpZXdEYXRhLmdyb3VwfS1lbmQtYWZ0ZXJgLCBlbGVtZW50KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuY2xlYXIoY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlUmFuZ2VPbihlbGVtZW50KSwgZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuY2xlYXJDbG9uZWRFbGVtZW50c0dyb3VwKGRhdGEubWFya2VyTmFtZSk7XG4gICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZU1hcmtlckZyb21BdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaGFzQXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFya2VyTmFtZXMgPSBuZXcgU2V0KGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpLnNwbGl0KCcsJykpO1xuICAgICAgICAgICAgICAgIG1hcmtlck5hbWVzLmRlbGV0ZSh2aWV3RGF0YS5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAobWFya2VyTmFtZXMuc2l6ZSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLnJlbW92ZUF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgQXJyYXkuZnJvbShtYXJrZXJOYW1lcykuam9pbignLCcpLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5IHRoYXQgY3JlYXRlcyBhIGNvbnZlcnRlciB3aGljaCBjb252ZXJ0cyB0aGUgc2V0L2NoYW5nZS9yZW1vdmUgYXR0cmlidXRlIGNoYW5nZXMgZnJvbSB0aGUgbW9kZWwgdG8gdGhlIHZpZXcuXG4gKlxuICogQXR0cmlidXRlcyBmcm9tIHRoZSBtb2RlbCBhcmUgY29udmVydGVkIHRvIHRoZSB2aWV3IGVsZW1lbnQgYXR0cmlidXRlcyBpbiB0aGUgdmlldy4gWW91IG1heSBwcm92aWRlIGEgY3VzdG9tIGZ1bmN0aW9uIHRvIGdlbmVyYXRlXG4gKiBhIGtleS12YWx1ZSBhdHRyaWJ1dGUgcGFpciB0byBhZGQvY2hhbmdlL3JlbW92ZS4gSWYgbm90IHByb3ZpZGVkLCBtb2RlbCBhdHRyaWJ1dGVzIHdpbGwgYmUgY29udmVydGVkIHRvIHZpZXcgZWxlbWVudFxuICogYXR0cmlidXRlcyBvbiBhIG9uZS10by1vbmUgYmFzaXMuXG4gKlxuICogKk5vdGU6KiogVGhlIHByb3ZpZGVkIGF0dHJpYnV0ZSBjcmVhdG9yIHNob3VsZCBhbHdheXMgcmV0dXJuIHRoZSBzYW1lIGBrZXlgIGZvciBhIGdpdmVuIGF0dHJpYnV0ZSBmcm9tIHRoZSBtb2RlbC5cbiAqXG4gKiBUaGUgY29udmVydGVyIGF1dG9tYXRpY2FsbHkgY29uc3VtZXMgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUgZnJvbSB0aGUgY29uc3VtYWJsZXMgbGlzdCBhbmQgc3RvcHMgdGhlIGV2ZW50IChzZWVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlcn0pLlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbERpc3BhdGNoZXIub24oICdhdHRyaWJ1dGU6Y3VzdG9tQXR0cjpteUVsZW0nLCBjaGFuZ2VBdHRyaWJ1dGUoICggdmFsdWUsIGRhdGEgKSA9PiB7XG4gKiBcdC8vIENoYW5nZSBhdHRyaWJ1dGUga2V5IGZyb20gYGN1c3RvbUF0dHJgIHRvIGBjbGFzc2AgaW4gdGhlIHZpZXcuXG4gKiBcdGNvbnN0IGtleSA9ICdjbGFzcyc7XG4gKiBcdGxldCB2YWx1ZSA9IGRhdGEuYXR0cmlidXRlTmV3VmFsdWU7XG4gKlxuICogXHQvLyBGb3JjZSBhdHRyaWJ1dGUgdmFsdWUgdG8gJ2VtcHR5JyBpZiB0aGUgbW9kZWwgZWxlbWVudCBpcyBlbXB0eS5cbiAqIFx0aWYgKCBkYXRhLml0ZW0uY2hpbGRDb3VudCA9PT0gMCApIHtcbiAqIFx0XHR2YWx1ZSA9ICdlbXB0eSc7XG4gKiBcdH1cbiAqXG4gKiBcdC8vIFJldHVybiB0aGUga2V5LXZhbHVlIHBhaXIuXG4gKiBcdHJldHVybiB7IGtleSwgdmFsdWUgfTtcbiAqIH0gKSApO1xuICogYGBgXG4gKlxuICogQHBhcmFtIGF0dHJpYnV0ZUNyZWF0b3IgRnVuY3Rpb24gcmV0dXJuaW5nIGFuIG9iamVjdCB3aXRoIHR3byBwcm9wZXJ0aWVzOiBga2V5YCBhbmQgYHZhbHVlYCwgd2hpY2hcbiAqIHJlcHJlc2VudCB0aGUgYXR0cmlidXRlIGtleSBhbmQgYXR0cmlidXRlIHZhbHVlIHRvIGJlIHNldCBvbiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0uXG4gKiBUaGUgZnVuY3Rpb24gaXMgcGFzc2VkIHRoZSBtb2RlbCBhdHRyaWJ1dGUgdmFsdWUgYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBhbmQgYWRkaXRpb25hbCBkYXRhIGFib3V0IHRoZSBjaGFuZ2UgYXMgdGhlIHNlY29uZCBwYXJhbWV0ZXIuXG4gKiBAcmV0dXJucyBTZXQvY2hhbmdlIGF0dHJpYnV0ZSBjb252ZXJ0ZXIuXG4gKi8gZnVuY3Rpb24gY2hhbmdlQXR0cmlidXRlKGF0dHJpYnV0ZUNyZWF0b3IpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdChkYXRhLml0ZW0sIGV2dC5uYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9sZEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUNyZWF0b3IoZGF0YS5hdHRyaWJ1dGVPbGRWYWx1ZSwgY29udmVyc2lvbkFwaSwgZGF0YSk7XG4gICAgICAgIGNvbnN0IG5ld0F0dHJpYnV0ZSA9IGF0dHJpYnV0ZUNyZWF0b3IoZGF0YS5hdHRyaWJ1dGVOZXdWYWx1ZSwgY29udmVyc2lvbkFwaSwgZGF0YSk7XG4gICAgICAgIGlmICghb2xkQXR0cmlidXRlICYmICFuZXdBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sIGV2dC5uYW1lKTtcbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KGRhdGEuaXRlbSk7XG4gICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgLy8gSWYgbW9kZWwgaXRlbSBjYW5ub3QgYmUgbWFwcGVkIHRvIGEgdmlldyBlbGVtZW50LCBpdCBtZWFucyBpdGVtIGlzIG5vdCBhbiBgRWxlbWVudGAgaW5zdGFuY2UgYnV0IGEgYFRleHRQcm94eWAgbm9kZS5cbiAgICAgICAgLy8gT25seSBlbGVtZW50cyBjYW4gaGF2ZSBhdHRyaWJ1dGVzIGluIGEgdmlldyBzbyBkbyBub3QgcHJvY2VlZCBmb3IgYW55dGhpbmcgZWxzZSAoIzE1ODcpLlxuICAgICAgICBpZiAoIXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoaXMgZXJyb3Igb2NjdXJzIHdoZW4gYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0cHJveHl+VGV4dFByb3h5IHRleHQgbm9kZSdzfSBhdHRyaWJ1dGUgaXMgdG8gYmUgZG93bmNhc3RlZFxuXHRcdFx0ICogYnkgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jYXR0cmlidXRlVG9BdHRyaWJ1dGUgYEF0dHJpYnV0ZSB0byBBdHRyaWJ1dGUgY29udmVydGVyYH0uXG5cdFx0XHQgKiBJbiBtb3N0IGNhc2VzIGl0IGlzIGNhdXNlZCBieSBjb252ZXJ0ZXJzIG1pc2NvbmZpZ3VyYXRpb24gd2hlbiBvbmx5IFwiZ2VuZXJpY1wiIGNvbnZlcnRlciBpcyBkZWZpbmVkOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHRcdFx0ICogXHRtb2RlbDogJ2F0dHJpYnV0ZS1uYW1lJyxcblx0XHRcdCAqIFx0dmlldzogJ2F0dHJpYnV0ZS1uYW1lJ1xuXHRcdFx0ICogfSApICk7XG5cdFx0XHQgKiBgYGBcblx0XHRcdCAqXG5cdFx0XHQgKiBhbmQgZ2l2ZW4gYXR0cmlidXRlIGlzIHVzZWQgb24gdGV4dCBub2RlLCBmb3IgZXhhbXBsZTpcblx0XHRcdCAqXG5cdFx0XHQgKiBgYGB0c1xuXHRcdFx0ICogbW9kZWwuY2hhbmdlKCB3cml0ZXIgPT4ge1xuXHRcdFx0ICogXHR3cml0ZXIuaW5zZXJ0VGV4dCggJ0ZvbycsIHsgJ2F0dHJpYnV0ZS1uYW1lJzogJ2JhcicgfSwgcGFyZW50LCAwICk7XG5cdFx0XHQgKiB9ICk7XG5cdFx0XHQgKiBgYGBcblx0XHRcdCAqXG5cdFx0XHQgKiBJbiBzdWNoIGNhc2VzLCB0byBjb252ZXJ0IHRoZSBzYW1lIGF0dHJpYnV0ZSBmb3IgYm90aCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnR9XG5cdFx0XHQgKiBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dHByb3h5flRleHRQcm94eSBgVGV4dGB9IG5vZGVzLCB0ZXh0IHNwZWNpZmljXG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNhdHRyaWJ1dGVUb0VsZW1lbnQgYEF0dHJpYnV0ZSB0byBFbGVtZW50IGNvbnZlcnRlcmB9XG5cdFx0XHQgKiB3aXRoIGhpZ2hlciB7QGxpbmsgbW9kdWxlOnV0aWxzL3ByaW9yaXRpZXN+UHJpb3JpdHlTdHJpbmcgcHJpb3JpdHl9IG11c3QgYWxzbyBiZSBkZWZpbmVkOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5hdHRyaWJ1dGVUb0VsZW1lbnQoIHtcblx0XHRcdCAqIFx0bW9kZWw6IHtcblx0XHRcdCAqIFx0XHRrZXk6ICdhdHRyaWJ1dGUtbmFtZScsXG5cdFx0XHQgKiBcdFx0bmFtZTogJyR0ZXh0J1xuXHRcdFx0ICogXHR9LFxuXHRcdFx0ICogXHR2aWV3OiAoIHZhbHVlLCB7IHdyaXRlciB9ICkgPT4ge1xuXHRcdFx0ICogXHRcdHJldHVybiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCggJ3NwYW4nLCB7ICdhdHRyaWJ1dGUtbmFtZSc6IHZhbHVlIH0gKTtcblx0XHRcdCAqIFx0fSxcblx0XHRcdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuXHRcdFx0ICogfSApICk7XG5cdFx0XHQgKiBgYGBcblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgY29udmVyc2lvbi1hdHRyaWJ1dGUtdG8tYXR0cmlidXRlLW9uLXRleHRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29udmVyc2lvbi1hdHRyaWJ1dGUtdG8tYXR0cmlidXRlLW9uLXRleHQnLCBjb252ZXJzaW9uQXBpLmRpc3BhdGNoZXIsIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpcnN0IHJlbW92ZSB0aGUgb2xkIGF0dHJpYnV0ZSBpZiB0aGVyZSB3YXMgb25lLlxuICAgICAgICBpZiAoZGF0YS5hdHRyaWJ1dGVPbGRWYWx1ZSAhPT0gbnVsbCAmJiBvbGRBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IG9sZEF0dHJpYnV0ZS52YWx1ZTtcbiAgICAgICAgICAgIGlmIChvbGRBdHRyaWJ1dGUua2V5ID09ICdzdHlsZScpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9sZEF0dHJpYnV0ZS52YWx1ZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBTdHlsZXNNYXAodmlld1dyaXRlci5kb2N1bWVudC5zdHlsZXNQcm9jZXNzb3IpLnNldFRvKG9sZEF0dHJpYnV0ZS52YWx1ZSkuZ2V0U3R5bGVzRW50cmllcygpLm1hcCgoW2tleV0pPT5rZXkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gT2JqZWN0LmtleXMob2xkQXR0cmlidXRlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2aWV3V3JpdGVyLnJlbW92ZUF0dHJpYnV0ZShvbGRBdHRyaWJ1dGUua2V5LCB2YWx1ZSwgdmlld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZW4gc2V0IHRoZSBuZXcgYXR0cmlidXRlLlxuICAgICAgICBpZiAoZGF0YS5hdHRyaWJ1dGVOZXdWYWx1ZSAhPT0gbnVsbCAmJiBuZXdBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IG5ld0F0dHJpYnV0ZS52YWx1ZTtcbiAgICAgICAgICAgIGlmIChuZXdBdHRyaWJ1dGUua2V5ID09ICdzdHlsZScgJiYgdHlwZW9mIG5ld0F0dHJpYnV0ZS52YWx1ZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gT2JqZWN0LmZyb21FbnRyaWVzKG5ldyBTdHlsZXNNYXAodmlld1dyaXRlci5kb2N1bWVudC5zdHlsZXNQcm9jZXNzb3IpLnNldFRvKG5ld0F0dHJpYnV0ZS52YWx1ZSkuZ2V0U3R5bGVzRW50cmllcygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZpZXdXcml0ZXIuc2V0QXR0cmlidXRlKG5ld0F0dHJpYnV0ZS5rZXksIHZhbHVlLCBmYWxzZSwgdmlld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSB0aGF0IGNyZWF0ZXMgYSBjb252ZXJ0ZXIgd2hpY2ggY29udmVydHMgdGhlIHRleHQgaW5zaWRlIG1hcmtlcidzIHJhbmdlLiBUaGUgY29udmVydGVyIHdyYXBzIHRoZSB0ZXh0IHdpdGhcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50fSBjcmVhdGVkIGZyb20gdGhlIHByb3ZpZGVkIGRlc2NyaXB0b3IuXG4gKiBTZWUge2xpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35jcmVhdGVWaWV3RWxlbWVudEZyb21IaWdobGlnaHREZXNjcmlwdG9yfS5cbiAqXG4gKiBJdCBjYW4gYWxzbyBiZSB1c2VkIHRvIGNvbnZlcnQgdGhlIHNlbGVjdGlvbiB0aGF0IGlzIGluc2lkZSBhIG1hcmtlci4gSW4gdGhhdCBjYXNlLCBhbiBlbXB0eSBhdHRyaWJ1dGUgZWxlbWVudCB3aWxsIGJlXG4gKiBjcmVhdGVkIGFuZCB0aGUgc2VsZWN0aW9uIHdpbGwgYmUgcHV0IGluc2lkZSBpdC5cbiAqXG4gKiBJZiB0aGUgaGlnaGxpZ2h0IGRlc2NyaXB0b3IgZG9lcyBub3QgcHJvdmlkZSB0aGUgYHByaW9yaXR5YCBwcm9wZXJ0eSwgYDEwYCB3aWxsIGJlIHVzZWQuXG4gKlxuICogSWYgdGhlIGhpZ2hsaWdodCBkZXNjcmlwdG9yIGRvZXMgbm90IHByb3ZpZGUgdGhlIGBpZGAgcHJvcGVydHksIHRoZSBuYW1lIG9mIHRoZSBtYXJrZXIgd2lsbCBiZSB1c2VkLlxuICpcbiAqIFRoaXMgY29udmVydGVyIGJpbmRzIHRoZSBjcmVhdGVkIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW5zfSB3aXRoIHRoZSBtYXJrZXIgbmFtZVxuICogdXNpbmcgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlciNiaW5kRWxlbWVudFRvTWFya2VyfSBtZXRob2QuXG4gKi8gZnVuY3Rpb24gaGlnaGxpZ2h0VGV4dChoaWdobGlnaHREZXNjcmlwdG9yKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGlmICghZGF0YS5pdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCEoZGF0YS5pdGVtIGluc3RhbmNlb2YgU2VsZWN0aW9uIHx8IGRhdGEuaXRlbSBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSAmJiAhZGF0YS5pdGVtLmlzKCckdGV4dFByb3h5JykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZXNjcmlwdG9yID0gcHJlcGFyZURlc2NyaXB0b3IoaGlnaGxpZ2h0RGVzY3JpcHRvciwgZGF0YSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGlmICghZGVzY3JpcHRvcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS5pdGVtLCBldnQubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gY3JlYXRlVmlld0VsZW1lbnRGcm9tSGlnaGxpZ2h0RGVzY3JpcHRvcih2aWV3V3JpdGVyLCBkZXNjcmlwdG9yKTtcbiAgICAgICAgY29uc3Qgdmlld1NlbGVjdGlvbiA9IHZpZXdXcml0ZXIuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBpZiAoZGF0YS5pdGVtIGluc3RhbmNlb2YgU2VsZWN0aW9uIHx8IGRhdGEuaXRlbSBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICB2aWV3V3JpdGVyLndyYXAodmlld1NlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCksIHZpZXdFbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdSYW5nZSA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1JhbmdlKGRhdGEucmFuZ2UpO1xuICAgICAgICAgICAgY29uc3QgcmFuZ2VBZnRlcldyYXAgPSB2aWV3V3JpdGVyLndyYXAodmlld1JhbmdlLCB2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgcmFuZ2VBZnRlcldyYXAuZ2V0SXRlbXMoKSl7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSAmJiBlbGVtZW50LmlzU2ltaWxhcih2aWV3RWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRUb01hcmtlcihlbGVtZW50LCBkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuLyoqXG4gKiBDb252ZXJ0ZXIgZnVuY3Rpb24gZmFjdG9yeS4gSXQgY3JlYXRlcyBhIGZ1bmN0aW9uIHdoaWNoIGFwcGxpZXMgdGhlIG1hcmtlcidzIGhpZ2hsaWdodCB0byBhbiBlbGVtZW50IGluc2lkZSB0aGUgbWFya2VyJ3MgcmFuZ2UuXG4gKlxuICogVGhlIGNvbnZlcnRlciBjaGVja3MgaWYgYW4gZWxlbWVudCBoYXMgdGhlIGBhZGRIaWdobGlnaHRgIGZ1bmN0aW9uIHN0b3JlZCBhcyBhXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfc2V0Q3VzdG9tUHJvcGVydHkgY3VzdG9tIHByb3BlcnR5fSBhbmQsIGlmIHNvLCB1c2VzIGl0IHRvIGFwcGx5IHRoZSBoaWdobGlnaHQuXG4gKiBJbiBzdWNoIGNhc2UgdGhlIGNvbnZlcnRlciB3aWxsIGNvbnN1bWUgYWxsIGVsZW1lbnQncyBjaGlsZHJlbiwgYXNzdW1pbmcgdGhhdCB0aGV5IHdlcmUgaGFuZGxlZCBieSB0aGUgZWxlbWVudCBpdHNlbGYuXG4gKlxuICogV2hlbiB0aGUgYGFkZEhpZ2hsaWdodGAgY3VzdG9tIHByb3BlcnR5IGlzIG5vdCBwcmVzZW50LCB0aGUgZWxlbWVudCBpcyBub3QgY29udmVydGVkIGluIGFueSBzcGVjaWFsIHdheS5cbiAqIFRoaXMgbWVhbnMgdGhhdCBjb252ZXJ0ZXJzIHdpbGwgcHJvY2VlZCB0byBjb252ZXJ0IHRoZSBlbGVtZW50J3MgY2hpbGQgbm9kZXMuXG4gKlxuICogSWYgdGhlIGhpZ2hsaWdodCBkZXNjcmlwdG9yIGRvZXMgbm90IHByb3ZpZGUgdGhlIGBwcmlvcml0eWAgcHJvcGVydHksIGAxMGAgd2lsbCBiZSB1c2VkLlxuICpcbiAqIElmIHRoZSBoaWdobGlnaHQgZGVzY3JpcHRvciBkb2VzIG5vdCBwcm92aWRlIHRoZSBgaWRgIHByb3BlcnR5LCB0aGUgbmFtZSBvZiB0aGUgbWFya2VyIHdpbGwgYmUgdXNlZC5cbiAqXG4gKiBUaGlzIGNvbnZlcnRlciBiaW5kcyBhbHRlcmVkIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50IGNvbnRhaW5lciBlbGVtZW50c30gd2l0aCB0aGUgbWFya2VyIG5hbWUgdXNpbmdcbiAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL21hcHBlcn5NYXBwZXIjYmluZEVsZW1lbnRUb01hcmtlcn0gbWV0aG9kLlxuICovIGZ1bmN0aW9uIGhpZ2hsaWdodEVsZW1lbnQoaGlnaGxpZ2h0RGVzY3JpcHRvcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBpZiAoIWRhdGEuaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKGRhdGEuaXRlbSBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IHByZXBhcmVEZXNjcmlwdG9yKGhpZ2hsaWdodERlc2NyaXB0b3IsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBpZiAoIWRlc2NyaXB0b3IpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGRhdGEuaXRlbSwgZXZ0Lm5hbWUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KGRhdGEuaXRlbSk7XG4gICAgICAgIGlmICh2aWV3RWxlbWVudCAmJiB2aWV3RWxlbWVudC5nZXRDdXN0b21Qcm9wZXJ0eSgnYWRkSGlnaGxpZ2h0JykpIHtcbiAgICAgICAgICAgIC8vIENvbnN1bWUgZWxlbWVudCBpdHNlbGYuXG4gICAgICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sIGV2dC5uYW1lKTtcbiAgICAgICAgICAgIC8vIENvbnN1bWUgYWxsIGNoaWxkcmVuIG5vZGVzLlxuICAgICAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiBSYW5nZS5fY3JlYXRlSW4oZGF0YS5pdGVtKSl7XG4gICAgICAgICAgICAgICAgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUodmFsdWUuaXRlbSwgZXZ0Lm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYWRkSGlnaGxpZ2h0Q2FsbGJhY2sgPSB2aWV3RWxlbWVudC5nZXRDdXN0b21Qcm9wZXJ0eSgnYWRkSGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICBhZGRIaWdobGlnaHRDYWxsYmFjayh2aWV3RWxlbWVudCwgZGVzY3JpcHRvciwgY29udmVyc2lvbkFwaS53cml0ZXIpO1xuICAgICAgICAgICAgY29udmVyc2lvbkFwaS5tYXBwZXIuYmluZEVsZW1lbnRUb01hcmtlcih2aWV3RWxlbWVudCwgZGF0YS5tYXJrZXJOYW1lKTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnkgdGhhdCBjcmVhdGVzIGEgY29udmVydGVyIHdoaWNoIGNvbnZlcnRzIHRoZSByZW1vdmluZyBtb2RlbCBtYXJrZXIgdG8gdGhlIHZpZXcuXG4gKlxuICogQm90aCB0ZXh0IG5vZGVzIGFuZCBlbGVtZW50cyBhcmUgaGFuZGxlZCBieSB0aGlzIGNvbnZlcnRlciBidXQgdGhleSBhcmUgaGFuZGxlZCBhIGJpdCBkaWZmZXJlbnRseS5cbiAqXG4gKiBUZXh0IG5vZGVzIGFyZSB1bndyYXBwZWQgdXNpbmcgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50fSBjcmVhdGVkIGZyb20gdGhlXG4gKiBwcm92aWRlZCBoaWdobGlnaHQgZGVzY3JpcHRvci4gU2VlIHtsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+SGlnaGxpZ2h0RGVzY3JpcHRvcn0uXG4gKlxuICogRm9yIGVsZW1lbnRzLCB0aGUgY29udmVydGVyIGNoZWNrcyBpZiBhbiBlbGVtZW50IGhhcyB0aGUgYHJlbW92ZUhpZ2hsaWdodGAgZnVuY3Rpb24gc3RvcmVkIGFzIGFcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19zZXRDdXN0b21Qcm9wZXJ0eSBjdXN0b20gcHJvcGVydHl9LiBJZiBzbywgaXQgdXNlcyBpdCB0byByZW1vdmUgdGhlIGhpZ2hsaWdodC5cbiAqIEluIHN1Y2ggY2FzZSwgdGhlIGNoaWxkcmVuIG9mIHRoYXQgZWxlbWVudCB3aWxsIG5vdCBiZSBjb252ZXJ0ZWQuXG4gKlxuICogV2hlbiBgcmVtb3ZlSGlnaGxpZ2h0YCBpcyBub3QgcHJlc2VudCwgdGhlIGVsZW1lbnQgaXMgbm90IGNvbnZlcnRlZCBpbiBhbnkgc3BlY2lhbCB3YXkuXG4gKiBUaGUgY29udmVydGVyIHdpbGwgcHJvY2VlZCB0byBjb252ZXJ0IHRoZSBlbGVtZW50J3MgY2hpbGQgbm9kZXMgaW5zdGVhZC5cbiAqXG4gKiBJZiB0aGUgaGlnaGxpZ2h0IGRlc2NyaXB0b3IgZG9lcyBub3QgcHJvdmlkZSB0aGUgYHByaW9yaXR5YCBwcm9wZXJ0eSwgYDEwYCB3aWxsIGJlIHVzZWQuXG4gKlxuICogSWYgdGhlIGhpZ2hsaWdodCBkZXNjcmlwdG9yIGRvZXMgbm90IHByb3ZpZGUgdGhlIGBpZGAgcHJvcGVydHksIHRoZSBuYW1lIG9mIHRoZSBtYXJrZXIgd2lsbCBiZSB1c2VkLlxuICpcbiAqIFRoaXMgY29udmVydGVyIHVuYmluZHMgZWxlbWVudHMgZnJvbSB0aGUgbWFya2VyIG5hbWUuXG4gKi8gZnVuY3Rpb24gcmVtb3ZlSGlnaGxpZ2h0KGhpZ2hsaWdodERlc2NyaXB0b3IpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgLy8gVGhpcyBjb252ZXJzaW9uIG1ha2VzIHNlbnNlIG9ubHkgZm9yIG5vbi1jb2xsYXBzZWQgcmFuZ2UuXG4gICAgICAgIGlmIChkYXRhLm1hcmtlclJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IHByZXBhcmVEZXNjcmlwdG9yKGhpZ2hsaWdodERlc2NyaXB0b3IsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBpZiAoIWRlc2NyaXB0b3IpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBWaWV3IGVsZW1lbnQgdGhhdCB3aWxsIGJlIHVzZWQgdG8gdW53cmFwIGBBdHRyaWJ1dGVFbGVtZW50YHMuXG4gICAgICAgIGNvbnN0IHZpZXdIaWdobGlnaHRFbGVtZW50ID0gY3JlYXRlVmlld0VsZW1lbnRGcm9tSGlnaGxpZ2h0RGVzY3JpcHRvcihjb252ZXJzaW9uQXBpLndyaXRlciwgZGVzY3JpcHRvcik7XG4gICAgICAgIC8vIEdldCBhbGwgZWxlbWVudHMgYm91bmQgd2l0aCBnaXZlbiBtYXJrZXIgbmFtZS5cbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBjb252ZXJzaW9uQXBpLm1hcHBlci5tYXJrZXJOYW1lVG9FbGVtZW50cyhkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICBpZiAoIWVsZW1lbnRzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKXtcbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLnVuYmluZEVsZW1lbnRGcm9tTWFya2VyTmFtZShlbGVtZW50LCBkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLnVud3JhcChjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVSYW5nZU9uKGVsZW1lbnQpLCB2aWV3SGlnaGxpZ2h0RWxlbWVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGlmIGVsZW1lbnQuaXMoICdjb250YWluZXJFbGVtZW50JyApLlxuICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZUhpZ2hsaWdodENhbGxiYWNrID0gZWxlbWVudC5nZXRDdXN0b21Qcm9wZXJ0eSgncmVtb3ZlSGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlSGlnaGxpZ2h0Q2FsbGJhY2soZWxlbWVudCwgZGVzY3JpcHRvci5pZCwgY29udmVyc2lvbkFwaS53cml0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLmNsZWFyQ2xvbmVkRWxlbWVudHNHcm91cChkYXRhLm1hcmtlck5hbWUpO1xuICAgICAgICBldnQuc3RvcCgpO1xuICAgIH07XG59XG4vKipcbiAqIE1vZGVsIGVsZW1lbnQgdG8gdmlldyBlbGVtZW50IGNvbnZlcnNpb24gaGVscGVyLlxuICpcbiAqIFNlZSB7QGxpbmsgfkRvd25jYXN0SGVscGVycyNlbGVtZW50VG9FbGVtZW50IGAuZWxlbWVudFRvRWxlbWVudCgpYCBkb3duY2FzdCBoZWxwZXJ9IGZvciBleGFtcGxlcyBhbmQgY29uZmlnIHBhcmFtcyBkZXNjcmlwdGlvbi5cbiAqXG4gKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSBjb25maWcubW9kZWwgVGhlIGRlc2NyaXB0aW9uIG9yIGEgbmFtZSBvZiB0aGUgbW9kZWwgZWxlbWVudCB0byBjb252ZXJ0LlxuICogQHBhcmFtIGNvbmZpZy5tb2RlbC5hdHRyaWJ1dGVzIExpc3Qgb2YgYXR0cmlidXRlcyB0cmlnZ2VyaW5nIGVsZW1lbnQgcmVjb252ZXJzaW9uLlxuICogQHBhcmFtIGNvbmZpZy5tb2RlbC5jaGlsZHJlbiBTaG91bGQgcmVjb252ZXJ0IGVsZW1lbnQgaWYgdGhlIGxpc3Qgb2YgbW9kZWwgY2hpbGQgbm9kZXMgY2hhbmdlZC5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIGRvd25jYXN0RWxlbWVudFRvRWxlbWVudChjb25maWcpIHtcbiAgICBjb25zdCBtb2RlbCA9IG5vcm1hbGl6ZU1vZGVsRWxlbWVudENvbmZpZyhjb25maWcubW9kZWwpO1xuICAgIGNvbnN0IHZpZXcgPSBub3JtYWxpemVUb0VsZW1lbnRDb25maWcoY29uZmlnLnZpZXcsICdjb250YWluZXInKTtcbiAgICAvLyBUcmlnZ2VyIHJlY29udmVyc2lvbiBvbiBjaGlsZHJlbiBsaXN0IGNoYW5nZSBpZiBlbGVtZW50IGlzIGEgc3ViamVjdCB0byBhbnkgcmVjb252ZXJzaW9uLlxuICAgIC8vIFRoaXMgaXMgcmVxdWlyZWQgdG8gYmUgYWJsZSB0byB0cmlnZ2VyIERpZmZlciNyZWZyZXNoSXRlbSgpIG9uIGEgZGlyZWN0IGNoaWxkIG9mIHRoZSByZWNvbnZlcnRlZCBlbGVtZW50LlxuICAgIGlmIChtb2RlbC5hdHRyaWJ1dGVzLmxlbmd0aCkge1xuICAgICAgICBtb2RlbC5jaGlsZHJlbiA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZGlzcGF0Y2hlci5vbihgaW5zZXJ0OiR7bW9kZWwubmFtZX1gLCBpbnNlcnRFbGVtZW50KHZpZXcsIGNyZWF0ZUNvbnN1bWVyKG1vZGVsKSksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiBjb25maWcuY29udmVydGVyUHJpb3JpdHkgfHwgJ25vcm1hbCdcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChtb2RlbC5jaGlsZHJlbiB8fCBtb2RlbC5hdHRyaWJ1dGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbigncmVkdWNlQ2hhbmdlcycsIGNyZWF0ZUNoYW5nZVJlZHVjZXIobW9kZWwpLCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIE1vZGVsIGVsZW1lbnQgdG8gdmlldyBzdHJ1Y3R1cmUgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+RG93bmNhc3RIZWxwZXJzI2VsZW1lbnRUb1N0cnVjdHVyZSBgLmVsZW1lbnRUb1N0cnVjdHVyZSgpYCBkb3duY2FzdCBoZWxwZXJ9IGZvciBleGFtcGxlcyBhbmQgY29uZmlnIHBhcmFtcyBkZXNjcmlwdGlvbi5cbiAqXG4gKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIGRvd25jYXN0RWxlbWVudFRvU3RydWN0dXJlKGNvbmZpZykge1xuICAgIGNvbnN0IG1vZGVsID0gbm9ybWFsaXplTW9kZWxFbGVtZW50Q29uZmlnKGNvbmZpZy5tb2RlbCk7XG4gICAgY29uc3QgdmlldyA9IG5vcm1hbGl6ZVRvRWxlbWVudENvbmZpZyhjb25maWcudmlldywgJ2NvbnRhaW5lcicpO1xuICAgIC8vIFRyaWdnZXIgcmVjb252ZXJzaW9uIG9uIGNoaWxkcmVuIGxpc3QgY2hhbmdlIGJlY2F1c2UgaXQgYWx3YXlzIG5lZWRzIHRvIHVzZSBzbG90cyB0byBwdXQgY2hpbGRyZW4gaW4gcHJvcGVyIHBsYWNlcy5cbiAgICAvLyBUaGlzIGlzIHJlcXVpcmVkIHRvIGJlIGFibGUgdG8gdHJpZ2dlciBEaWZmZXIjcmVmcmVzaEl0ZW0oKSBvbiBhIGRpcmVjdCBjaGlsZCBvZiB0aGUgcmVjb252ZXJ0ZWQgZWxlbWVudC5cbiAgICBtb2RlbC5jaGlsZHJlbiA9IHRydWU7XG4gICAgcmV0dXJuIChkaXNwYXRjaGVyKT0+e1xuICAgICAgICBpZiAoZGlzcGF0Y2hlci5fY29udmVyc2lvbkFwaS5zY2hlbWEuY2hlY2tDaGlsZChtb2RlbC5uYW1lLCAnJHRleHQnKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGlzIGVycm9yIG9jY3VycyB3aGVuIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IG1vZGVsIGVsZW1lbnR9IGlzIGRvd25jYXN0ZWRcblx0XHRcdCAqIHZpYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjZWxlbWVudFRvU3RydWN0dXJlfSBoZWxwZXIgYnV0IHRoZSBlbGVtZW50IHdhc1xuXHRcdFx0ICogYWxsb3dlZCB0byBob3N0IGAkdGV4dGAgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEgbW9kZWwgc2NoZW1hfS5cblx0XHRcdCAqXG5cdFx0XHQgKiBGb3IgaW5zdGFuY2UsIHRoaXMgbWF5IGJlIHRoZSByZXN1bHQgb2YgYG15RWxlbWVudGAgYWxsb3dpbmcgdGhlIGNvbnRlbnQgb2Zcblx0XHRcdCAqIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEjZ2VuZXJpYy1pdGVtcyBgJGJsb2NrYH0gaW4gaXRzIHNjaGVtYSBkZWZpbml0aW9uOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiAvLyBFbGVtZW50IGRlZmluaXRpb24gaW4gc2NoZW1hLlxuXHRcdFx0ICogc2NoZW1hLnJlZ2lzdGVyKCAnbXlFbGVtZW50Jywge1xuXHRcdFx0ICogXHRhbGxvd0NvbnRlbnRPZjogJyRibG9jaycsXG5cdFx0XHQgKlxuXHRcdFx0ICogXHQvLyAuLi5cblx0XHRcdCAqIH0gKTtcblx0XHRcdCAqXG5cdFx0XHQgKiAvLyAuLi5cblx0XHRcdCAqXG5cdFx0XHQgKiAvLyBDb252ZXJzaW9uIG9mIG15RWxlbWVudCB3aXRoIHRoZSB1c2Ugb2YgZWxlbWVudFRvU3RydWN0dXJlKCkuXG5cdFx0XHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9TdHJ1Y3R1cmUoIHtcblx0XHRcdCAqIFx0bW9kZWw6ICdteUVsZW1lbnQnLFxuXHRcdFx0ICogXHR2aWV3OiAoIG1vZGVsRWxlbWVudCwgeyB3cml0ZXIgfSApID0+IHtcblx0XHRcdCAqIFx0XHQvLyAuLi5cblx0XHRcdCAqIFx0fVxuXHRcdFx0ICogfSApO1xuXHRcdFx0ICogYGBgXG5cdFx0XHQgKlxuXHRcdFx0ICogSW4gc3VjaCBjYXNlLCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjZWxlbWVudFRvRWxlbWVudCBgZWxlbWVudFRvRWxlbWVudCgpYH0gaGVscGVyXG5cdFx0XHQgKiBjYW4gYmUgdXNlZCBpbnN0ZWFkIHRvIGdldCBhcm91bmQgdGhpcyBwcm9ibGVtOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdFx0XHQgKiBcdG1vZGVsOiAnbXlFbGVtZW50Jyxcblx0XHRcdCAqIFx0dmlldzogKCBtb2RlbEVsZW1lbnQsIHsgd3JpdGVyIH0gKSA9PiB7XG5cdFx0XHQgKiBcdFx0Ly8gLi4uXG5cdFx0XHQgKiBcdH1cblx0XHRcdCAqIH0gKTtcblx0XHRcdCAqIGBgYFxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBjb252ZXJzaW9uLWVsZW1lbnQtdG8tc3RydWN0dXJlLWRpc2FsbG93ZWQtdGV4dFxuXHRcdFx0ICogQHBhcmFtIHtTdHJpbmd9IGVsZW1lbnROYW1lIFRoZSBuYW1lIG9mIHRoZSBlbGVtZW50IHRoZSBzdHJ1Y3R1cmUgaXMgdG8gYmUgY3JlYXRlZCBmb3IuXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnZlcnNpb24tZWxlbWVudC10by1zdHJ1Y3R1cmUtZGlzYWxsb3dlZC10ZXh0JywgZGlzcGF0Y2hlciwge1xuICAgICAgICAgICAgICAgIGVsZW1lbnROYW1lOiBtb2RlbC5uYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBkaXNwYXRjaGVyLm9uKGBpbnNlcnQ6JHttb2RlbC5uYW1lfWAsIGluc2VydFN0cnVjdHVyZSh2aWV3LCBjcmVhdGVDb25zdW1lcihtb2RlbCkpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwYXRjaGVyLm9uKCdyZWR1Y2VDaGFuZ2VzJywgY3JlYXRlQ2hhbmdlUmVkdWNlcihtb2RlbCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBNb2RlbCBhdHRyaWJ1dGUgdG8gdmlldyBlbGVtZW50IGNvbnZlcnNpb24gaGVscGVyLlxuICpcbiAqIFNlZSB7QGxpbmsgfkRvd25jYXN0SGVscGVycyNhdHRyaWJ1dGVUb0VsZW1lbnQgYC5hdHRyaWJ1dGVUb0VsZW1lbnQoKWAgZG93bmNhc3QgaGVscGVyfSBmb3IgZXhhbXBsZXMuXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gY29uZmlnLm1vZGVsIFRoZSBrZXkgb2YgdGhlIGF0dHJpYnV0ZSB0byBjb252ZXJ0IGZyb20gb3IgYSBgeyBrZXksIHZhbHVlcyB9YCBvYmplY3QuIGB2YWx1ZXNgIGlzIGFuIGFycmF5XG4gKiBvZiBgU3RyaW5nYHMgd2l0aCBwb3NzaWJsZSB2YWx1ZXMgaWYgdGhlIG1vZGVsIGF0dHJpYnV0ZSBpcyBhbiBlbnVtZXJhYmxlLlxuICogQHBhcmFtIGNvbmZpZy52aWV3IEEgdmlldyBlbGVtZW50IGRlZmluaXRpb24gb3IgYSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBtb2RlbCBhdHRyaWJ1dGUgdmFsdWUgYW5kXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2Rvd25jYXN0d3JpdGVyfkRvd25jYXN0V3JpdGVyIHZpZXcgZG93bmNhc3Qgd3JpdGVyfSBhcyBwYXJhbWV0ZXJzIGFuZCByZXR1cm5zIGEgdmlldyBhdHRyaWJ1dGUgZWxlbWVudC5cbiAqIElmIGBjb25maWcubW9kZWwudmFsdWVzYCBpcyBnaXZlbiwgYGNvbmZpZy52aWV3YCBzaG91bGQgYmUgYW4gb2JqZWN0IGFzc2lnbmluZyB2YWx1ZXMgZnJvbSBgY29uZmlnLm1vZGVsLnZhbHVlc2AgdG8gdmlldyBlbGVtZW50XG4gKiBkZWZpbml0aW9ucyBvciBmdW5jdGlvbnMuXG4gKiBAcGFyYW0gY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IENvbnZlcnRlciBwcmlvcml0eS5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIGRvd25jYXN0QXR0cmlidXRlVG9FbGVtZW50KGNvbmZpZykge1xuICAgIGNvbmZpZyA9IGNsb25lRGVlcChjb25maWcpO1xuICAgIGxldCBtb2RlbCA9IGNvbmZpZy5tb2RlbDtcbiAgICBpZiAodHlwZW9mIG1vZGVsID09ICdzdHJpbmcnKSB7XG4gICAgICAgIG1vZGVsID0ge1xuICAgICAgICAgICAga2V5OiBtb2RlbFxuICAgICAgICB9O1xuICAgIH1cbiAgICBsZXQgZXZlbnROYW1lID0gYGF0dHJpYnV0ZToke21vZGVsLmtleX1gO1xuICAgIGlmIChtb2RlbC5uYW1lKSB7XG4gICAgICAgIGV2ZW50TmFtZSArPSAnOicgKyBtb2RlbC5uYW1lO1xuICAgIH1cbiAgICBpZiAobW9kZWwudmFsdWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgbW9kZWxWYWx1ZSBvZiBtb2RlbC52YWx1ZXMpe1xuICAgICAgICAgICAgY29uZmlnLnZpZXdbbW9kZWxWYWx1ZV0gPSBub3JtYWxpemVUb0VsZW1lbnRDb25maWcoY29uZmlnLnZpZXdbbW9kZWxWYWx1ZV0sICdhdHRyaWJ1dGUnKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmZpZy52aWV3ID0gbm9ybWFsaXplVG9FbGVtZW50Q29uZmlnKGNvbmZpZy52aWV3LCAnYXR0cmlidXRlJyk7XG4gICAgfVxuICAgIGNvbnN0IGVsZW1lbnRDcmVhdG9yID0gZ2V0RnJvbUF0dHJpYnV0ZUNyZWF0b3IoY29uZmlnKTtcbiAgICByZXR1cm4gKGRpc3BhdGNoZXIpPT57XG4gICAgICAgIGRpc3BhdGNoZXIub24oZXZlbnROYW1lLCB3cmFwKGVsZW1lbnRDcmVhdG9yKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6IGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSB8fCAnbm9ybWFsJ1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBNb2RlbCBhdHRyaWJ1dGUgdG8gdmlldyBhdHRyaWJ1dGUgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+RG93bmNhc3RIZWxwZXJzI2F0dHJpYnV0ZVRvQXR0cmlidXRlIGAuYXR0cmlidXRlVG9BdHRyaWJ1dGUoKWAgZG93bmNhc3QgaGVscGVyfSBmb3IgZXhhbXBsZXMuXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gY29uZmlnLm1vZGVsIFRoZSBrZXkgb2YgdGhlIGF0dHJpYnV0ZSB0byBjb252ZXJ0IGZyb20gb3IgYSBgeyBrZXksIHZhbHVlcywgWyBuYW1lIF0gfWAgb2JqZWN0IGRlc2NyaWJpbmdcbiAqIHRoZSBhdHRyaWJ1dGUga2V5LCBwb3NzaWJsZSB2YWx1ZXMgYW5kLCBvcHRpb25hbGx5LCBhbiBlbGVtZW50IG5hbWUgdG8gY29udmVydCBmcm9tLlxuICogQHBhcmFtIGNvbmZpZy52aWV3IEEgdmlldyBhdHRyaWJ1dGUga2V5LCBvciBhIGB7IGtleSwgdmFsdWUgfWAgb2JqZWN0IG9yIGEgZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgbW9kZWwgYXR0cmlidXRlIHZhbHVlIGFuZCByZXR1cm5zXG4gKiBhIGB7IGtleSwgdmFsdWUgfWAgb2JqZWN0LlxuICogSWYgYGtleWAgaXMgYCdjbGFzcydgLCBgdmFsdWVgIGNhbiBiZSBhIGBTdHJpbmdgIG9yIGFuIGFycmF5IG9mIGBTdHJpbmdgcy4gSWYgYGtleWAgaXMgYCdzdHlsZSdgLCBgdmFsdWVgIGlzIGFuIG9iamVjdCB3aXRoXG4gKiBrZXktdmFsdWUgcGFpcnMuIEluIG90aGVyIGNhc2VzLCBgdmFsdWVgIGlzIGEgYFN0cmluZ2AuXG4gKiBJZiBgY29uZmlnLm1vZGVsLnZhbHVlc2AgaXMgc2V0LCBgY29uZmlnLnZpZXdgIHNob3VsZCBiZSBhbiBvYmplY3QgYXNzaWduaW5nIHZhbHVlcyBmcm9tIGBjb25maWcubW9kZWwudmFsdWVzYCB0b1xuICogYHsga2V5LCB2YWx1ZSB9YCBvYmplY3RzIG9yIGEgZnVuY3Rpb25zLlxuICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG4gKiBAcmV0dXJucyBDb252ZXJzaW9uIGhlbHBlci5cbiAqLyBmdW5jdGlvbiBkb3duY2FzdEF0dHJpYnV0ZVRvQXR0cmlidXRlKGNvbmZpZykge1xuICAgIGNvbmZpZyA9IGNsb25lRGVlcChjb25maWcpO1xuICAgIGxldCBtb2RlbCA9IGNvbmZpZy5tb2RlbDtcbiAgICBpZiAodHlwZW9mIG1vZGVsID09ICdzdHJpbmcnKSB7XG4gICAgICAgIG1vZGVsID0ge1xuICAgICAgICAgICAga2V5OiBtb2RlbFxuICAgICAgICB9O1xuICAgIH1cbiAgICBsZXQgZXZlbnROYW1lID0gYGF0dHJpYnV0ZToke21vZGVsLmtleX1gO1xuICAgIGlmIChtb2RlbC5uYW1lKSB7XG4gICAgICAgIGV2ZW50TmFtZSArPSAnOicgKyBtb2RlbC5uYW1lO1xuICAgIH1cbiAgICBpZiAobW9kZWwudmFsdWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgbW9kZWxWYWx1ZSBvZiBtb2RlbC52YWx1ZXMpe1xuICAgICAgICAgICAgY29uZmlnLnZpZXdbbW9kZWxWYWx1ZV0gPSBub3JtYWxpemVUb0F0dHJpYnV0ZUNvbmZpZyhjb25maWcudmlld1ttb2RlbFZhbHVlXSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25maWcudmlldyA9IG5vcm1hbGl6ZVRvQXR0cmlidXRlQ29uZmlnKGNvbmZpZy52aWV3KTtcbiAgICB9XG4gICAgY29uc3QgZWxlbWVudENyZWF0b3IgPSBnZXRGcm9tQXR0cmlidXRlQ3JlYXRvcihjb25maWcpO1xuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZGlzcGF0Y2hlci5vbihldmVudE5hbWUsIGNoYW5nZUF0dHJpYnV0ZShlbGVtZW50Q3JlYXRvciksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiBjb25maWcuY29udmVydGVyUHJpb3JpdHkgfHwgJ25vcm1hbCdcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbi8qKlxuICogTW9kZWwgbWFya2VyIHRvIHZpZXcgZWxlbWVudCBjb252ZXJzaW9uIGhlbHBlci5cbiAqXG4gKiBTZWUge0BsaW5rIH5Eb3duY2FzdEhlbHBlcnMjbWFya2VyVG9FbGVtZW50IGAubWFya2VyVG9FbGVtZW50KClgIGRvd25jYXN0IGhlbHBlcn0gZm9yIGV4YW1wbGVzLlxuICpcbiAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIGNvbmZpZy5tb2RlbCBUaGUgbmFtZSBvZiB0aGUgbW9kZWwgbWFya2VyIChvciBtb2RlbCBtYXJrZXIgZ3JvdXApIHRvIGNvbnZlcnQuXG4gKiBAcGFyYW0gY29uZmlnLnZpZXcgQSB2aWV3IGVsZW1lbnQgZGVmaW5pdGlvbiBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgdGhlIG1vZGVsIG1hcmtlciBkYXRhIGFzIGEgcGFyYW1ldGVyIGFuZCByZXR1cm5zIGEgdmlldyBVSSBlbGVtZW50LlxuICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG4gKiBAcmV0dXJucyBDb252ZXJzaW9uIGhlbHBlci5cbiAqLyBmdW5jdGlvbiBkb3duY2FzdE1hcmtlclRvRWxlbWVudChjb25maWcpIHtcbiAgICBjb25zdCB2aWV3ID0gbm9ybWFsaXplVG9FbGVtZW50Q29uZmlnKGNvbmZpZy52aWV3LCAndWknKTtcbiAgICByZXR1cm4gKGRpc3BhdGNoZXIpPT57XG4gICAgICAgIGRpc3BhdGNoZXIub24oYGFkZE1hcmtlcjoke2NvbmZpZy5tb2RlbH1gLCBpbnNlcnRVSUVsZW1lbnQodmlldyksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiBjb25maWcuY29udmVydGVyUHJpb3JpdHkgfHwgJ25vcm1hbCdcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoZXIub24oYHJlbW92ZU1hcmtlcjoke2NvbmZpZy5tb2RlbH1gLCByZW1vdmVVSUVsZW1lbnQoKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6IGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSB8fCAnbm9ybWFsJ1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBNb2RlbCBtYXJrZXIgdG8gdmlldyBkYXRhIGNvbnZlcnNpb24gaGVscGVyLlxuICpcbiAqIFNlZSB7QGxpbmsgfkRvd25jYXN0SGVscGVycyNtYXJrZXJUb0RhdGEgYG1hcmtlclRvRGF0YSgpYCBkb3duY2FzdCBoZWxwZXJ9IHRvIGxlYXJuIG1vcmUuXG4gKlxuICogQHJldHVybnMgQ29udmVyc2lvbiBoZWxwZXIuXG4gKi8gZnVuY3Rpb24gZG93bmNhc3RNYXJrZXJUb0RhdGEoY29uZmlnKSB7XG4gICAgY29uZmlnID0gY2xvbmVEZWVwKGNvbmZpZyk7XG4gICAgY29uc3QgZ3JvdXAgPSBjb25maWcubW9kZWw7XG4gICAgbGV0IHZpZXcgPSBjb25maWcudmlldztcbiAgICAvLyBEZWZhdWx0IGNvbnZlcnNpb24uXG4gICAgaWYgKCF2aWV3KSB7XG4gICAgICAgIHZpZXcgPSAobWFya2VyTmFtZSk9Pih7XG4gICAgICAgICAgICAgICAgZ3JvdXAsXG4gICAgICAgICAgICAgICAgbmFtZTogbWFya2VyTmFtZS5zdWJzdHIoY29uZmlnLm1vZGVsLmxlbmd0aCArIDEpXG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIChkaXNwYXRjaGVyKT0+e1xuICAgICAgICBkaXNwYXRjaGVyLm9uKGBhZGRNYXJrZXI6JHtncm91cH1gLCBpbnNlcnRNYXJrZXJEYXRhKHZpZXcpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwYXRjaGVyLm9uKGByZW1vdmVNYXJrZXI6JHtncm91cH1gLCByZW1vdmVNYXJrZXJEYXRhKHZpZXcpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIE1vZGVsIG1hcmtlciB0byBoaWdobGlnaHQgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+RG93bmNhc3RIZWxwZXJzI21hcmtlclRvRWxlbWVudCBgLm1hcmtlclRvRWxlbWVudCgpYCBkb3duY2FzdCBoZWxwZXJ9IGZvciBleGFtcGxlcy5cbiAqXG4gKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSBjb25maWcubW9kZWwgVGhlIG5hbWUgb2YgdGhlIG1vZGVsIG1hcmtlciAob3IgbW9kZWwgbWFya2VyIGdyb3VwKSB0byBjb252ZXJ0LlxuICogQHBhcmFtIGNvbmZpZy52aWV3IEEgaGlnaGxpZ2h0IGRlc2NyaXB0b3IgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGhpZ2hsaWdodGluZyBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXNcbiAqIHRoZSBtb2RlbCBtYXJrZXIgZGF0YSBhcyBhIHBhcmFtZXRlciBhbmQgcmV0dXJucyBhIGhpZ2hsaWdodCBkZXNjcmlwdG9yLlxuICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG4gKiBAcmV0dXJucyBDb252ZXJzaW9uIGhlbHBlci5cbiAqLyBmdW5jdGlvbiBkb3duY2FzdE1hcmtlclRvSGlnaGxpZ2h0KGNvbmZpZykge1xuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZGlzcGF0Y2hlci5vbihgYWRkTWFya2VyOiR7Y29uZmlnLm1vZGVsfWAsIGhpZ2hsaWdodFRleHQoY29uZmlnLnZpZXcpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwYXRjaGVyLm9uKGBhZGRNYXJrZXI6JHtjb25maWcubW9kZWx9YCwgaGlnaGxpZ2h0RWxlbWVudChjb25maWcudmlldyksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiBjb25maWcuY29udmVydGVyUHJpb3JpdHkgfHwgJ25vcm1hbCdcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoZXIub24oYHJlbW92ZU1hcmtlcjoke2NvbmZpZy5tb2RlbH1gLCByZW1vdmVIaWdobGlnaHQoY29uZmlnLnZpZXcpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIFRha2VzIGBjb25maWcubW9kZWxgLCBhbmQgY29udmVydHMgaXQgdG8gYW4gb2JqZWN0IHdpdGggbm9ybWFsaXplZCBzdHJ1Y3R1cmUuXG4gKlxuICogQHBhcmFtIG1vZGVsIE1vZGVsIGNvbmZpZ3VyYXRpb24gb3IgZWxlbWVudCBuYW1lLlxuICovIGZ1bmN0aW9uIG5vcm1hbGl6ZU1vZGVsRWxlbWVudENvbmZpZyhtb2RlbCkge1xuICAgIGlmICh0eXBlb2YgbW9kZWwgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgbW9kZWwgPSB7XG4gICAgICAgICAgICBuYW1lOiBtb2RlbFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBtb2RlbC5uYW1lLFxuICAgICAgICBhdHRyaWJ1dGVzOiBtb2RlbC5hdHRyaWJ1dGVzID8gdG9BcnJheShtb2RlbC5hdHRyaWJ1dGVzKSA6IFtdLFxuICAgICAgICBjaGlsZHJlbjogISFtb2RlbC5jaGlsZHJlblxuICAgIH07XG59XG4vKipcbiAqIFRha2VzIGBjb25maWcudmlld2AsIGFuZCBpZiBpdCBpcyBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnRkZWZpbml0aW9ufkVsZW1lbnREZWZpbml0aW9ufSwgY29udmVydHMgaXRcbiAqIHRvIGEgZnVuY3Rpb24gKGJlY2F1c2UgbG93ZXIgbGV2ZWwgY29udmVydGVycyBhY2NlcHQgb25seSBlbGVtZW50IGNyZWF0b3IgZnVuY3Rpb25zKS5cbiAqXG4gKiBAcGFyYW0gdmlldyBWaWV3IGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gdmlld0VsZW1lbnRUeXBlIFZpZXcgZWxlbWVudCB0eXBlIHRvIGNyZWF0ZS5cbiAqIEByZXR1cm5zIEVsZW1lbnQgY3JlYXRvciBmdW5jdGlvbiB0byB1c2UgaW4gbG93ZXIgbGV2ZWwgY29udmVydGVycy5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVUb0VsZW1lbnRDb25maWcodmlldywgdmlld0VsZW1lbnRUeXBlKSB7XG4gICAgaWYgKHR5cGVvZiB2aWV3ID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgLy8gSWYgYHZpZXdgIGlzIGFscmVhZHkgYSBmdW5jdGlvbiwgZG9uJ3QgZG8gYW55dGhpbmcuXG4gICAgICAgIHJldHVybiB2aWV3O1xuICAgIH1cbiAgICByZXR1cm4gKG1vZGVsRGF0YSwgY29udmVyc2lvbkFwaSk9PmNyZWF0ZVZpZXdFbGVtZW50RnJvbURlZmluaXRpb24odmlldywgY29udmVyc2lvbkFwaSwgdmlld0VsZW1lbnRUeXBlKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIHZpZXcgZWxlbWVudCBpbnN0YW5jZSBmcm9tIHRoZSBwcm92aWRlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnRkZWZpbml0aW9ufkVsZW1lbnREZWZpbml0aW9ufSBhbmQgY2xhc3MuXG4gKi8gZnVuY3Rpb24gY3JlYXRlVmlld0VsZW1lbnRGcm9tRGVmaW5pdGlvbih2aWV3RWxlbWVudERlZmluaXRpb24sIGNvbnZlcnNpb25BcGksIHZpZXdFbGVtZW50VHlwZSkge1xuICAgIGlmICh0eXBlb2Ygdmlld0VsZW1lbnREZWZpbml0aW9uID09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIElmIGB2aWV3RWxlbWVudERlZmluaXRpb25gIGlzIGdpdmVuIGFzIGEgYFN0cmluZ2AsIG5vcm1hbGl6ZSBpdCB0byBhbiBvYmplY3Qgd2l0aCBgbmFtZWAgcHJvcGVydHkuXG4gICAgICAgIHZpZXdFbGVtZW50RGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgIG5hbWU6IHZpZXdFbGVtZW50RGVmaW5pdGlvblxuICAgICAgICB9O1xuICAgIH1cbiAgICBsZXQgZWxlbWVudDtcbiAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgY29uc3QgYXR0cmlidXRlcyA9IE9iamVjdC5hc3NpZ24oe30sIHZpZXdFbGVtZW50RGVmaW5pdGlvbi5hdHRyaWJ1dGVzKTtcbiAgICBpZiAodmlld0VsZW1lbnRUeXBlID09ICdjb250YWluZXInKSB7XG4gICAgICAgIGVsZW1lbnQgPSB2aWV3V3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQodmlld0VsZW1lbnREZWZpbml0aW9uLm5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgIH0gZWxzZSBpZiAodmlld0VsZW1lbnRUeXBlID09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBwcmlvcml0eTogdmlld0VsZW1lbnREZWZpbml0aW9uLnByaW9yaXR5IHx8IEF0dHJpYnV0ZUVsZW1lbnQuREVGQVVMVF9QUklPUklUWVxuICAgICAgICB9O1xuICAgICAgICBlbGVtZW50ID0gdmlld1dyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KHZpZXdFbGVtZW50RGVmaW5pdGlvbi5uYW1lLCBhdHRyaWJ1dGVzLCBvcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyAndWknLlxuICAgICAgICBlbGVtZW50ID0gdmlld1dyaXRlci5jcmVhdGVVSUVsZW1lbnQodmlld0VsZW1lbnREZWZpbml0aW9uLm5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgIH1cbiAgICBpZiAodmlld0VsZW1lbnREZWZpbml0aW9uLnN0eWxlcykge1xuICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModmlld0VsZW1lbnREZWZpbml0aW9uLnN0eWxlcyk7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpe1xuICAgICAgICAgICAgdmlld1dyaXRlci5zZXRTdHlsZShrZXksIHZpZXdFbGVtZW50RGVmaW5pdGlvbi5zdHlsZXNba2V5XSwgZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHZpZXdFbGVtZW50RGVmaW5pdGlvbi5jbGFzc2VzKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzZXMgPSB2aWV3RWxlbWVudERlZmluaXRpb24uY2xhc3NlcztcbiAgICAgICAgaWYgKHR5cGVvZiBjbGFzc2VzID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2aWV3V3JpdGVyLmFkZENsYXNzKGNsYXNzZXMsIGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChjb25zdCBjbGFzc05hbWUgb2YgY2xhc3Nlcyl7XG4gICAgICAgICAgICAgICAgdmlld1dyaXRlci5hZGRDbGFzcyhjbGFzc05hbWUsIGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50O1xufVxuZnVuY3Rpb24gZ2V0RnJvbUF0dHJpYnV0ZUNyZWF0b3IoY29uZmlnKSB7XG4gICAgaWYgKGNvbmZpZy5tb2RlbC52YWx1ZXMpIHtcbiAgICAgICAgcmV0dXJuIChtb2RlbEF0dHJpYnV0ZVZhbHVlLCBjb252ZXJzaW9uQXBpLCBkYXRhKT0+e1xuICAgICAgICAgICAgY29uc3QgdmlldyA9IGNvbmZpZy52aWV3W21vZGVsQXR0cmlidXRlVmFsdWVdO1xuICAgICAgICAgICAgaWYgKHZpZXcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmlldyhtb2RlbEF0dHJpYnV0ZVZhbHVlLCBjb252ZXJzaW9uQXBpLCBkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjb25maWcudmlldztcbiAgICB9XG59XG4vKipcbiAqIFRha2VzIHRoZSBjb25maWd1cmF0aW9uLCBhZGRzIGRlZmF1bHQgcGFyYW1ldGVycyBpZiB0aGV5IGRvIG5vdCBleGlzdCBhbmQgbm9ybWFsaXplcyBvdGhlciBwYXJhbWV0ZXJzIHRvIGJlIHVzZWQgaW4gZG93bmNhc3QgY29udmVydGVyc1xuICogZm9yIGdlbmVyYXRpbmcgYSB2aWV3IGF0dHJpYnV0ZS5cbiAqXG4gKiBAcGFyYW0gdmlldyBWaWV3IGNvbmZpZ3VyYXRpb24uXG4gKi8gZnVuY3Rpb24gbm9ybWFsaXplVG9BdHRyaWJ1dGVDb25maWcodmlldykge1xuICAgIGlmICh0eXBlb2YgdmlldyA9PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gKG1vZGVsQXR0cmlidXRlVmFsdWUpPT4oe1xuICAgICAgICAgICAgICAgIGtleTogdmlldyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogbW9kZWxBdHRyaWJ1dGVWYWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmlldyA9PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyB7IGtleSwgdmFsdWUsIC4uLiB9XG4gICAgICAgIGlmICh2aWV3LnZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PnZpZXc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gKG1vZGVsQXR0cmlidXRlVmFsdWUpPT4oe1xuICAgICAgICAgICAgICAgICAgICBrZXk6IHZpZXcua2V5LFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbW9kZWxBdHRyaWJ1dGVWYWx1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZnVuY3Rpb24uXG4gICAgICAgIHJldHVybiB2aWV3O1xuICAgIH1cbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBgaGlnaGxpZ2h0YC4gUHJlcGFyZXMgdGhlIGFjdHVhbCBkZXNjcmlwdG9yIG9iamVjdCB1c2luZyB2YWx1ZSBwYXNzZWQgdG8gdGhlIGNvbnZlcnRlci5cbiAqLyBmdW5jdGlvbiBwcmVwYXJlRGVzY3JpcHRvcihoaWdobGlnaHREZXNjcmlwdG9yLCBkYXRhLCBjb252ZXJzaW9uQXBpKSB7XG4gICAgLy8gSWYgcGFzc2VkIGRlc2NyaXB0b3IgaXMgYSBjcmVhdG9yIGZ1bmN0aW9uLCBjYWxsIGl0LiBJZiBub3QsIGp1c3QgdXNlIHBhc3NlZCB2YWx1ZS5cbiAgICBjb25zdCBkZXNjcmlwdG9yID0gdHlwZW9mIGhpZ2hsaWdodERlc2NyaXB0b3IgPT0gJ2Z1bmN0aW9uJyA/IGhpZ2hsaWdodERlc2NyaXB0b3IoZGF0YSwgY29udmVyc2lvbkFwaSkgOiBoaWdobGlnaHREZXNjcmlwdG9yO1xuICAgIGlmICghZGVzY3JpcHRvcikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gQXBwbHkgZGVmYXVsdCBkZXNjcmlwdG9yIHByaW9yaXR5LlxuICAgIGlmICghZGVzY3JpcHRvci5wcmlvcml0eSkge1xuICAgICAgICBkZXNjcmlwdG9yLnByaW9yaXR5ID0gMTA7XG4gICAgfVxuICAgIC8vIERlZmF1bHQgZGVzY3JpcHRvciBpZCBpcyBtYXJrZXIgbmFtZS5cbiAgICBpZiAoIWRlc2NyaXB0b3IuaWQpIHtcbiAgICAgICAgZGVzY3JpcHRvci5pZCA9IGRhdGEubWFya2VyTmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIGRlc2NyaXB0b3I7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGNoZWNrcyBhIHNpbmdsZSBkaWZmZXIgZGlmZiBpdGVtIHdoZXRoZXIgaXQgc2hvdWxkIHRyaWdnZXIgcmVjb252ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSBtb2RlbCBBIG5vcm1hbGl6ZWQgYGNvbmZpZy5tb2RlbGAgY29udmVydGVyIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gbW9kZWwubmFtZSBUaGUgbmFtZSBvZiBlbGVtZW50LlxuICogQHBhcmFtIG1vZGVsLmF0dHJpYnV0ZXMgVGhlIGxpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIHRyaWdnZXIgcmVjb252ZXJzaW9uLlxuICogQHBhcmFtIG1vZGVsLmNoaWxkcmVuIFdoZXRoZXIgdGhlIGNoaWxkIGxpc3QgY2hhbmdlIHNob3VsZCB0cmlnZ2VyIHJlY29udmVyc2lvbi5cbiAqLyBmdW5jdGlvbiBjcmVhdGVDaGFuZ2VSZWR1Y2VyQ2FsbGJhY2sobW9kZWwpIHtcbiAgICByZXR1cm4gKG5vZGUsIGNoYW5nZSk9PntcbiAgICAgICAgaWYgKCFub2RlLmlzKCdlbGVtZW50JywgbW9kZWwubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT0gJ2F0dHJpYnV0ZScpIHtcbiAgICAgICAgICAgIGlmIChtb2RlbC5hdHRyaWJ1dGVzLmluY2x1ZGVzKGNoYW5nZS5hdHRyaWJ1dGVLZXkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZTogVGhpcyBpcyBhbHdheXMgdHJ1ZSBiZWNhdXNlIG90aGVyd2lzZSBpdCB3b3VsZCBub3QgcmVnaXN0ZXIgYSByZWR1Y2VyIGNhbGxiYWNrLiAtLSBAcHJlc2VydmUgKi8gaWYgKG1vZGVsLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG59XG4vKipcbiAqIENyZWF0ZXMgYSBgcmVkdWNlQ2hhbmdlc2AgZXZlbnQgaGFuZGxlciBmb3IgcmVjb252ZXJzaW9uLlxuICpcbiAqIEBwYXJhbSBtb2RlbCBBIG5vcm1hbGl6ZWQgYGNvbmZpZy5tb2RlbGAgY29udmVydGVyIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gbW9kZWwubmFtZSBUaGUgbmFtZSBvZiBlbGVtZW50LlxuICogQHBhcmFtIG1vZGVsLmF0dHJpYnV0ZXMgVGhlIGxpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIHRyaWdnZXIgcmVjb252ZXJzaW9uLlxuICogQHBhcmFtIG1vZGVsLmNoaWxkcmVuIFdoZXRoZXIgdGhlIGNoaWxkIGxpc3QgY2hhbmdlIHNob3VsZCB0cmlnZ2VyIHJlY29udmVyc2lvbi5cbiAqLyBmdW5jdGlvbiBjcmVhdGVDaGFuZ2VSZWR1Y2VyKG1vZGVsKSB7XG4gICAgY29uc3Qgc2hvdWxkUmVwbGFjZSA9IGNyZWF0ZUNoYW5nZVJlZHVjZXJDYWxsYmFjayhtb2RlbCk7XG4gICAgcmV0dXJuIChldnQsIGRhdGEpPT57XG4gICAgICAgIGNvbnN0IHJlZHVjZWRDaGFuZ2VzID0gW107XG4gICAgICAgIGlmICghZGF0YS5yZWNvbnZlcnRlZEVsZW1lbnRzKSB7XG4gICAgICAgICAgICBkYXRhLnJlY29udmVydGVkRWxlbWVudHMgPSBuZXcgU2V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgZGF0YS5jaGFuZ2VzKXtcbiAgICAgICAgICAgIC8vIEZvciBhdHRyaWJ1dGUgdXNlIG5vZGUgYWZmZWN0ZWQgYnkgdGhlIGNoYW5nZS5cbiAgICAgICAgICAgIC8vIEZvciBpbnNlcnQgb3IgcmVtb3ZlIHVzZSBwYXJlbnQgZWxlbWVudCBiZWNhdXNlIHdlIG5lZWQgdG8gY2hlY2sgaWYgaXQncyBhZGRlZC9yZW1vdmVkIGNoaWxkLlxuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNoYW5nZS50eXBlID09ICdhdHRyaWJ1dGUnID8gY2hhbmdlLnJhbmdlLnN0YXJ0Lm5vZGVBZnRlciA6IGNoYW5nZS5wb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgICAgICBpZiAoIW5vZGUgfHwgIXNob3VsZFJlcGxhY2Uobm9kZSwgY2hhbmdlKSkge1xuICAgICAgICAgICAgICAgIHJlZHVjZWRDaGFuZ2VzLnB1c2goY2hhbmdlKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIGl0J3MgYWxyZWFkeSBtYXJrZWQgZm9yIHJlY29udmVyc2lvbiwgc28gc2tpcCB0aGlzIGNoYW5nZSwgb3RoZXJ3aXNlIGFkZCB0aGUgZGlmZiBpdGVtcy5cbiAgICAgICAgICAgIGlmICghZGF0YS5yZWNvbnZlcnRlZEVsZW1lbnRzLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgIGRhdGEucmVjb252ZXJ0ZWRFbGVtZW50cy5hZGQobm9kZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKG5vZGUpO1xuICAgICAgICAgICAgICAgIGxldCBjaGFuZ2VJbmRleCA9IHJlZHVjZWRDaGFuZ2VzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGluc2VydCByZW1vdmUrcmVpbnNlcnQgYmVmb3JlIGFueSBvdGhlciBjaGFuZ2Ugb24gYW5kIGluc2lkZSB0aGUgcmUtY29udmVydGVkIGVsZW1lbnQuXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQgYmVjYXVzZSBvdGhlcndpc2Ugd2Ugd291bGQgcmVtb3ZlIGVsZW1lbnQgdGhhdCBoYWQgYWxyZWFkeSBiZWVuIG1vZGlmaWVkIGJ5IHRoZSBwcmV2aW91cyBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZXJlIGNvdWxkIGJlIHNvbWUgZWxlbWVudCByZW1vdmVkIGJlZm9yZSB0aGUgcmUtY29udmVydGVkIGVsZW1lbnQsIHNvIHdlIG11c3Qgbm90IGJyZWFrIHRoaXMgYmVoYXZpb3IuXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gcmVkdWNlZENoYW5nZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pe1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2UgPSByZWR1Y2VkQ2hhbmdlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhbmdlUG9zaXRpb24gPSBjaGFuZ2UudHlwZSA9PSAnYXR0cmlidXRlJyA/IGNoYW5nZS5yYW5nZS5zdGFydCA6IGNoYW5nZS5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb25SZWxhdGlvbiA9IGNoYW5nZVBvc2l0aW9uLmNvbXBhcmVXaXRoKHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uUmVsYXRpb24gPT0gJ2JlZm9yZScgfHwgY2hhbmdlLnR5cGUgPT0gJ3JlbW92ZScgJiYgcG9zaXRpb25SZWxhdGlvbiA9PSAnc2FtZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVkdWNlZENoYW5nZXMuc3BsaWNlKGNoYW5nZUluZGV4LCAwLCB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZW1vdmUnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBub2RlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IDFcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZWluc2VydCcsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG5vZGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGxlbmd0aDogMVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRhdGEuY2hhbmdlcyA9IHJlZHVjZWRDaGFuZ2VzO1xuICAgIH07XG59XG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGNoZWNrcyBpZiBhbiBlbGVtZW50IGFuZCBpdHMgd2F0Y2hlZCBhdHRyaWJ1dGVzIGNhbiBiZSBjb25zdW1lZCBhbmQgY29uc3VtZXMgdGhlbS5cbiAqXG4gKiBAcGFyYW0gbW9kZWwgQSBub3JtYWxpemVkIGBjb25maWcubW9kZWxgIGNvbnZlcnRlciBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIG1vZGVsLm5hbWUgVGhlIG5hbWUgb2YgZWxlbWVudC5cbiAqIEBwYXJhbSBtb2RlbC5hdHRyaWJ1dGVzIFRoZSBsaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0aGF0IHNob3VsZCB0cmlnZ2VyIHJlY29udmVyc2lvbi5cbiAqIEBwYXJhbSBtb2RlbC5jaGlsZHJlbiBXaGV0aGVyIHRoZSBjaGlsZCBsaXN0IGNoYW5nZSBzaG91bGQgdHJpZ2dlciByZWNvbnZlcnNpb24uXG4gKi8gZnVuY3Rpb24gY3JlYXRlQ29uc3VtZXIobW9kZWwpIHtcbiAgICByZXR1cm4gKG5vZGUsIGNvbnN1bWFibGUsIG9wdGlvbnMgPSB7fSk9PntcbiAgICAgICAgY29uc3QgZXZlbnRzID0gW1xuICAgICAgICAgICAgJ2luc2VydCdcbiAgICAgICAgXTtcbiAgICAgICAgLy8gQ29sbGVjdCBhbGwgc2V0IGF0dHJpYnV0ZXMgdGhhdCBhcmUgdHJpZ2dlcmluZyBjb252ZXJzaW9uLlxuICAgICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZU5hbWUgb2YgbW9kZWwuYXR0cmlidXRlcyl7XG4gICAgICAgICAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBldmVudHMucHVzaChgYXR0cmlidXRlOiR7YXR0cmlidXRlTmFtZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWV2ZW50cy5ldmVyeSgoZXZlbnQpPT5jb25zdW1hYmxlLnRlc3Qobm9kZSwgZXZlbnQpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb3B0aW9ucy5wcmVmbGlnaHQpIHtcbiAgICAgICAgICAgIGV2ZW50cy5mb3JFYWNoKChldmVudCk9PmNvbnN1bWFibGUuY29uc3VtZShub2RlLCBldmVudCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG59XG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGNyZWF0ZSB2aWV3IHNsb3RzLlxuICpcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIGV4cG9zZWQgYnkgd3JpdGVyIGFzIGNyZWF0ZVNsb3QoKS5cbiAqLyBmdW5jdGlvbiBjcmVhdGVTbG90RmFjdG9yeShlbGVtZW50LCBzbG90c01hcCwgY29udmVyc2lvbkFwaSkge1xuICAgIHJldHVybiAod3JpdGVyLCBtb2RlT3JGaWx0ZXIpPT57XG4gICAgICAgIGNvbnN0IHNsb3QgPSB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCgnJHNsb3QnKTtcbiAgICAgICAgbGV0IGNoaWxkcmVuID0gbnVsbDtcbiAgICAgICAgaWYgKG1vZGVPckZpbHRlciA9PT0gJ2NoaWxkcmVuJykge1xuICAgICAgICAgICAgY2hpbGRyZW4gPSBBcnJheS5mcm9tKGVsZW1lbnQuZ2V0Q2hpbGRyZW4oKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vZGVPckZpbHRlciA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjaGlsZHJlbiA9IEFycmF5LmZyb20oZWxlbWVudC5nZXRDaGlsZHJlbigpKS5maWx0ZXIoKGVsZW1lbnQpPT5tb2RlT3JGaWx0ZXIoZWxlbWVudCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBVbmtub3duIHNsb3QgbW9kZSB3YXMgcHJvdmlkZWQgdG8gYHdyaXRlci5jcmVhdGVTbG90KClgIGluIGRvd25jYXN0IGNvbnZlcnRlci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgY29udmVyc2lvbi1zbG90LW1vZGUtdW5rbm93blxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdjb252ZXJzaW9uLXNsb3QtbW9kZS11bmtub3duJywgY29udmVyc2lvbkFwaS5kaXNwYXRjaGVyLCB7XG4gICAgICAgICAgICAgICAgbW9kZU9yRmlsdGVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBzbG90c01hcC5zZXQoc2xvdCwgY2hpbGRyZW4pO1xuICAgICAgICByZXR1cm4gc2xvdDtcbiAgICB9O1xufVxuLyoqXG4gKiBDaGVja3MgaWYgYWxsIGNoaWxkcmVuIGFyZSBjb3ZlcmVkIGJ5IHNsb3RzIGFuZCB0aGVyZSBpcyBubyBjaGlsZCB0aGF0IGxhbmRlZCBpbiBtdWx0aXBsZSBzbG90cy5cbiAqLyBmdW5jdGlvbiB2YWxpZGF0ZVNsb3RzQ2hpbGRyZW4oZWxlbWVudCwgc2xvdHNNYXAsIGNvbnZlcnNpb25BcGkpIHtcbiAgICBjb25zdCBjaGlsZHJlbkluU2xvdHMgPSBBcnJheS5mcm9tKHNsb3RzTWFwLnZhbHVlcygpKS5mbGF0KCk7XG4gICAgY29uc3QgdW5pcXVlQ2hpbGRyZW5JblNsb3RzID0gbmV3IFNldChjaGlsZHJlbkluU2xvdHMpO1xuICAgIGlmICh1bmlxdWVDaGlsZHJlbkluU2xvdHMuc2l6ZSAhPSBjaGlsZHJlbkluU2xvdHMubGVuZ3RoKSB7XG4gICAgICAgIC8qKlxuXHRcdCAqIEZpbHRlcnMgcHJvdmlkZWQgdG8gYHdyaXRlci5jcmVhdGVTbG90KClgIG92ZXJsYXAgKGF0IGxlYXN0IHR3byBmaWx0ZXJzIGFjY2VwdCB0aGUgc2FtZSBjaGlsZCBlbGVtZW50KS5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBjb252ZXJzaW9uLXNsb3QtZmlsdGVyLW92ZXJsYXBcblx0XHQgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50IFRoZSBlbGVtZW50IG9mIHdoaWNoIGNoaWxkcmVuIHdvdWxkIG5vdCBiZSBwcm9wZXJseVxuXHRcdCAqIGFsbG9jYXRlZCB0byBtdWx0aXBsZSBzbG90cy5cblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnZlcnNpb24tc2xvdC1maWx0ZXItb3ZlcmxhcCcsIGNvbnZlcnNpb25BcGkuZGlzcGF0Y2hlciwge1xuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHVuaXF1ZUNoaWxkcmVuSW5TbG90cy5zaXplICE9IGVsZW1lbnQuY2hpbGRDb3VudCkge1xuICAgICAgICAvKipcblx0XHQgKiBGaWx0ZXJzIHByb3ZpZGVkIHRvIGB3cml0ZXIuY3JlYXRlU2xvdCgpYCBhcmUgaW5jb21wbGV0ZSBhbmQgZXhjbHVkZSBhdCBsZWFzdCBvbmUgY2hpbGRyZW4gZWxlbWVudCAob25lIG9mXG5cdFx0ICogdGhlIGNoaWxkcmVuIGVsZW1lbnRzIHdvdWxkIG5vdCBiZSBhc3NpZ25lZCB0byBhbnkgb2YgdGhlIHNsb3RzKS5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBjb252ZXJzaW9uLXNsb3QtZmlsdGVyLWluY29tcGxldGVcblx0XHQgKiBAcGFyYW0ge21vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50fSBlbGVtZW50IFRoZSBlbGVtZW50IG9mIHdoaWNoIGNoaWxkcmVuIHdvdWxkIG5vdCBiZSBwcm9wZXJseVxuXHRcdCAqIGFsbG9jYXRlZCB0byBtdWx0aXBsZSBzbG90cy5cblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnZlcnNpb24tc2xvdC1maWx0ZXItaW5jb21wbGV0ZScsIGNvbnZlcnNpb25BcGkuZGlzcGF0Y2hlciwge1xuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICB9KTtcbiAgICB9XG59XG4vKipcbiAqIEZpbGwgc2xvdHMgd2l0aCBhcHByb3ByaWF0ZSB2aWV3IGVsZW1lbnRzLlxuICovIGZ1bmN0aW9uIGZpbGxTbG90cyh2aWV3RWxlbWVudCwgc2xvdHNNYXAsIGNvbnZlcnNpb25BcGksIG9wdGlvbnMpIHtcbiAgICAvLyBTZXQgdGVtcG9yYXJ5IHBvc2l0aW9uIG1hcHBpbmcgdG8gcmVkaXJlY3QgY2hpbGQgdmlldyBlbGVtZW50cyBpbnRvIGEgcHJvcGVyIHNsb3RzLlxuICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLm9uKCdtb2RlbFRvVmlld1Bvc2l0aW9uJywgdG9WaWV3UG9zaXRpb25NYXBwaW5nLCB7XG4gICAgICAgIHByaW9yaXR5OiAnaGlnaGVzdCdcbiAgICB9KTtcbiAgICBsZXQgY3VycmVudFNsb3QgPSBudWxsO1xuICAgIGxldCBjdXJyZW50U2xvdE5vZGVzID0gbnVsbDtcbiAgICAvLyBGaWxsIHNsb3RzIHdpdGggbmVzdGVkIHZpZXcgbm9kZXMuXG4gICAgZm9yIChbY3VycmVudFNsb3QsIGN1cnJlbnRTbG90Tm9kZXNdIG9mIHNsb3RzTWFwKXtcbiAgICAgICAgcmVpbnNlcnRPckNvbnZlcnROb2Rlcyh2aWV3RWxlbWVudCwgY3VycmVudFNsb3ROb2RlcywgY29udmVyc2lvbkFwaSwgb3B0aW9ucyk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLm1vdmUoY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlUmFuZ2VJbihjdXJyZW50U2xvdCksIGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKGN1cnJlbnRTbG90KSk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLnJlbW92ZShjdXJyZW50U2xvdCk7XG4gICAgfVxuICAgIGNvbnZlcnNpb25BcGkubWFwcGVyLm9mZignbW9kZWxUb1ZpZXdQb3NpdGlvbicsIHRvVmlld1Bvc2l0aW9uTWFwcGluZyk7XG4gICAgZnVuY3Rpb24gdG9WaWV3UG9zaXRpb25NYXBwaW5nKGV2dCwgZGF0YSkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gZGF0YS5tb2RlbFBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgLy8gRmluZCB0aGUgcHJvcGVyIG9mZnNldCB3aXRoaW4gdGhlIHNsb3QuXG4gICAgICAgIGNvbnN0IGluZGV4ID0gY3VycmVudFNsb3ROb2Rlcy5pbmRleE9mKGVsZW1lbnQpO1xuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGF0YS52aWV3UG9zaXRpb24gPSBkYXRhLm1hcHBlci5maW5kUG9zaXRpb25JbihjdXJyZW50U2xvdCwgaW5kZXgpO1xuICAgIH1cbn1cbi8qKlxuICogSW5zZXJ0cyB2aWV3IHJlcHJlc2VudGF0aW9uIG9mIGBub2Rlc2AgaW50byB0aGUgYHZpZXdFbGVtZW50YCBlaXRoZXIgYnkgYnJpbmdpbmcgYmFjayBqdXN0IHJlbW92ZWQgdmlldyBub2Rlc1xuICogb3IgYnkgdHJpZ2dlcmluZyBjb252ZXJzaW9uIGZvciB0aGVtLlxuICovIGZ1bmN0aW9uIHJlaW5zZXJ0T3JDb252ZXJ0Tm9kZXModmlld0VsZW1lbnQsIG1vZGVsTm9kZXMsIGNvbnZlcnNpb25BcGksIG9wdGlvbnMpIHtcbiAgICAvLyBGaWxsIHdpdGggbmVzdGVkIHZpZXcgbm9kZXMuXG4gICAgZm9yIChjb25zdCBtb2RlbENoaWxkTm9kZSBvZiBtb2RlbE5vZGVzKXtcbiAgICAgICAgLy8gVHJ5IHJlaW5zZXJ0aW5nIHRoZSB2aWV3IG5vZGUgZm9yIHRoZSBzcGVjaWZpZWQgbW9kZWwgbm9kZS4uLlxuICAgICAgICBpZiAoIXJlaW5zZXJ0Tm9kZSh2aWV3RWxlbWVudC5yb290LCBtb2RlbENoaWxkTm9kZSwgY29udmVyc2lvbkFwaSwgb3B0aW9ucykpIHtcbiAgICAgICAgICAgIC8vIC4uLm9yIGVsc2UgY29udmVydCB0aGUgbW9kZWwgZWxlbWVudCB0byB0aGUgdmlldy5cbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkuY29udmVydEl0ZW0obW9kZWxDaGlsZE5vZGUpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIHZpZXcgZm9yIHRoZSBnaXZlbiBtb2RlbCBlbGVtZW50IGNvdWxkIGJlIHJldXNlZCBhbmQgcmVpbnNlcnRzIGl0IHRvIHRoZSB2aWV3LlxuICpcbiAqIEByZXR1cm5zIGBmYWxzZWAgaWYgdmlldyBlbGVtZW50IGNhbid0IGJlIHJldXNlZC5cbiAqLyBmdW5jdGlvbiByZWluc2VydE5vZGUodmlld1Jvb3QsIG1vZGVsTm9kZSwgY29udmVyc2lvbkFwaSwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgd3JpdGVyLCBtYXBwZXIgfSA9IGNvbnZlcnNpb25BcGk7XG4gICAgLy8gRG9uJ3QgcmVpbnNlcnQgaWYgdGhpcyBpcyBub3QgYSByZWNvbnZlcnNpb24uLi5cbiAgICBpZiAoIW9wdGlvbnMucmVjb252ZXJzaW9uKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3Qgdmlld0NoaWxkTm9kZSA9IG1hcHBlci50b1ZpZXdFbGVtZW50KG1vZGVsTm9kZSk7XG4gICAgLy8gLi4ub3IgdGhlcmUgaXMgbm8gdmlldyB0byByZWluc2VydCBvciBpdCB3YXMgYWxyZWFkeSBpbnNlcnRlZCB0byB0aGUgdmlldyBzdHJ1Y3R1cmUuLi5cbiAgICBpZiAoIXZpZXdDaGlsZE5vZGUgfHwgdmlld0NoaWxkTm9kZS5yb290ID09IHZpZXdSb290KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gLi4ub3IgaXQgd2FzIHN0cmljdGx5IG1hcmtlZCBhcyBub3QgdG8gYmUgcmV1c2VkLlxuICAgIGlmICghY29udmVyc2lvbkFwaS5jYW5SZXVzZVZpZXcodmlld0NoaWxkTm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBPdGhlcndpc2UgcmVpbnNlcnQgdGhlIHZpZXcgbm9kZS5cbiAgICB3cml0ZXIubW92ZSh3cml0ZXIuY3JlYXRlUmFuZ2VPbih2aWV3Q2hpbGROb2RlKSwgbWFwcGVyLnRvVmlld1Bvc2l0aW9uKFBvc2l0aW9uLl9jcmVhdGVCZWZvcmUobW9kZWxOb2RlKSkpO1xuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBUaGUgZGVmYXVsdCBjb25zdW1lciBmb3IgaW5zZXJ0IGV2ZW50cy5cbiAqXG4gKiBAcGFyYW0gaXRlbSBNb2RlbCBpdGVtLlxuICogQHBhcmFtIGNvbnN1bWFibGUgVGhlIG1vZGVsIGNvbnN1bWFibGUuXG4gKiBAcGFyYW0gb3B0aW9ucy5wcmVmbGlnaHQgV2hldGhlciBzaG91bGQgY29uc3VtZSBvciBqdXN0IGNoZWNrIGlmIGNhbiBiZSBjb25zdW1lZC5cbiAqLyBmdW5jdGlvbiBkZWZhdWx0Q29uc3VtZXIoaXRlbSwgY29uc3VtYWJsZSwgeyBwcmVmbGlnaHQgfSA9IHt9KSB7XG4gICAgaWYgKHByZWZsaWdodCkge1xuICAgICAgICByZXR1cm4gY29uc3VtYWJsZS50ZXN0KGl0ZW0sICdpbnNlcnQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gY29uc3VtYWJsZS5jb25zdW1lKGl0ZW0sICdpbnNlcnQnKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgZW5naW5lL21vZGVsL3V0aWxzL2F1dG9wYXJhZ3JhcGhpbmdcbiAqLyAvKipcbiAqIEZpeGVzIGFsbCBlbXB0eSByb290cy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSB3cml0ZXIgVGhlIG1vZGVsIHdyaXRlci5cbiAqIEByZXR1cm5zIGB0cnVlYCBpZiBhbnkgY2hhbmdlIGhhcyBiZWVuIGFwcGxpZWQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIGF1dG9QYXJhZ3JhcGhFbXB0eVJvb3RzKHdyaXRlcikge1xuICAgIGNvbnN0IHsgc2NoZW1hLCBkb2N1bWVudCB9ID0gd3JpdGVyLm1vZGVsO1xuICAgIGZvciAoY29uc3Qgcm9vdCBvZiBkb2N1bWVudC5nZXRSb290cygpKXtcbiAgICAgICAgaWYgKHJvb3QuaXNFbXB0eSAmJiAhc2NoZW1hLmNoZWNrQ2hpbGQocm9vdCwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIC8vIElmIHBhcmFncmFwaCBlbGVtZW50IGlzIGFsbG93ZWQgaW4gdGhlIHJvb3QsIGNyZWF0ZSBwYXJhZ3JhcGggZWxlbWVudC5cbiAgICAgICAgICAgIGlmIChzY2hlbWEuY2hlY2tDaGlsZChyb290LCAncGFyYWdyYXBoJykpIHtcbiAgICAgICAgICAgICAgICB3cml0ZXIuaW5zZXJ0RWxlbWVudCgncGFyYWdyYXBoJywgcm9vdCk7XG4gICAgICAgICAgICAgICAgLy8gT3RoZXIgcm9vdHMgd2lsbCBnZXQgZml4ZWQgaW4gdGhlIG5leHQgcG9zdC1maXhlciByb3VuZC4gVGhvc2Ugd2lsbCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICAvLyBpbiB0aGUgc2FtZSBiYXRjaCBubyBtYXR0ZXIgaWYgdGhpcyBtZXRob2Qgd2FzIHRyaWdnZXJlZCBieSB0aGUgcG9zdC1maXhpbmcgb3Igbm90XG4gICAgICAgICAgICAgICAgLy8gKHRoZSBhYm92ZSBpbnNlcnRFbGVtZW50IGNhbGwgd2lsbCB0cmlnZ2VyIHRoZSBwb3N0LWZpeGVycykuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGdpdmVuIG5vZGUgd3JhcHBlZCB3aXRoIGEgcGFyYWdyYXBoIHdvdWxkIGJlIGFjY2VwdGVkIGJ5IHRoZSBzY2hlbWEgaW4gdGhlIGdpdmVuIHBvc2l0aW9uLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIHBvc2l0aW9uIFRoZSBwb3NpdGlvbiBhdCB3aGljaCB0byBjaGVjay5cbiAqIEBwYXJhbSBub2RlT3JUeXBlIFRoZSBjaGlsZCBub2RlIG9yIGNoaWxkIHR5cGUgdG8gY2hlY2suXG4gKiBAcGFyYW0gc2NoZW1hIEEgc2NoZW1hIGluc3RhbmNlIHVzZWQgZm9yIGVsZW1lbnQgdmFsaWRhdGlvbi5cbiAqLyBmdW5jdGlvbiBpc1BhcmFncmFwaGFibGUocG9zaXRpb24sIG5vZGVPclR5cGUsIHNjaGVtYSkge1xuICAgIGNvbnN0IGNvbnRleHQgPSBzY2hlbWEuY3JlYXRlQ29udGV4dChwb3NpdGlvbik7XG4gICAgLy8gV2hlbiBwYXJhZ3JhcGggaXMgYWxsb3dlZCBpbiB0aGlzIGNvbnRleHQuLi5cbiAgICBpZiAoIXNjaGVtYS5jaGVja0NoaWxkKGNvbnRleHQsICdwYXJhZ3JhcGgnKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIEFuZCBhIG5vZGUgd291bGQgYmUgYWxsb3dlZCBpbiB0aGlzIHBhcmFncmFwaC4uLlxuICAgIGlmICghc2NoZW1hLmNoZWNrQ2hpbGQoY29udGV4dC5wdXNoKCdwYXJhZ3JhcGgnKSwgbm9kZU9yVHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogSW5zZXJ0cyBhIG5ldyBwYXJhZ3JhcGggYXQgdGhlIGdpdmVuIHBvc2l0aW9uIGFuZCByZXR1cm5zIGEgcG9zaXRpb24gaW5zaWRlIHRoYXQgcGFyYWdyYXBoLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIHBvc2l0aW9uIFRoZSBwb3NpdGlvbiB3aGVyZSBhIHBhcmFncmFwaCBzaG91bGQgYmUgaW5zZXJ0ZWQuXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSBtb2RlbCB3cml0ZXIuXG4gKiBAcmV0dXJucyAgUG9zaXRpb24gaW5zaWRlIHRoZSBjcmVhdGVkIHBhcmFncmFwaC5cbiAqLyBmdW5jdGlvbiB3cmFwSW5QYXJhZ3JhcGgocG9zaXRpb24sIHdyaXRlcikge1xuICAgIGNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVFbGVtZW50KCdwYXJhZ3JhcGgnKTtcbiAgICB3cml0ZXIuaW5zZXJ0KHBhcmFncmFwaCwgcG9zaXRpb24pO1xuICAgIHJldHVybiB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChwYXJhZ3JhcGgsIDApO1xufVxuXG4vKipcbiAqIENvbnRhaW5zIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXcgdmlld30gdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWwgbW9kZWx9IGNvbnZlcnRlcnMgZm9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3VwY2FzdGRpc3BhdGNoZXJ+VXBjYXN0RGlzcGF0Y2hlcn0uXG4gKlxuICogQG1vZHVsZSBlbmdpbmUvY29udmVyc2lvbi91cGNhc3RoZWxwZXJzXG4gKi8gLyoqXG4gKiBVcGNhc3QgY29udmVyc2lvbiBoZWxwZXIgZnVuY3Rpb25zLlxuICpcbiAqIExlYXJuIG1vcmUgYWJvdXQge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL2NvbnZlcnNpb24vdXBjYXN0IHVwY2FzdCBoZWxwZXJzfS5cbiAqXG4gKiBAZXh0ZW5kcyBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbmhlbHBlcnN+Q29udmVyc2lvbkhlbHBlcnNcbiAqLyBjbGFzcyBVcGNhc3RIZWxwZXJzIGV4dGVuZHMgQ29udmVyc2lvbkhlbHBlcnMge1xuICAgIC8qKlxuXHQgKiBWaWV3IGVsZW1lbnQgdG8gbW9kZWwgZWxlbWVudCBjb252ZXJzaW9uIGhlbHBlci5cblx0ICpcblx0ICogVGhpcyBjb252ZXJzaW9uIHJlc3VsdHMgaW4gY3JlYXRpbmcgYSBtb2RlbCBlbGVtZW50LiBGb3IgZXhhbXBsZSxcblx0ICogdmlldyBgPHA+Rm9vPC9wPmAgYmVjb21lcyBgPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD5gIGluIHRoZSBtb2RlbC5cblx0ICpcblx0ICogS2VlcCBpbiBtaW5kIHRoYXQgdGhlIGVsZW1lbnQgd2lsbCBiZSBpbnNlcnRlZCBvbmx5IGlmIGl0IGlzIGFsbG93ZWRcblx0ICogYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSBzY2hlbWF9IGNvbmZpZ3VyYXRpb24uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0dmlldzogJ3AnLFxuXHQgKiBcdG1vZGVsOiAncGFyYWdyYXBoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0dmlldzogJ3AnLFxuXHQgKiBcdG1vZGVsOiAncGFyYWdyYXBoJyxcblx0ICogXHRjb252ZXJ0ZXJQcmlvcml0eTogJ2hpZ2gnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApLmVsZW1lbnRUb0VsZW1lbnQoIHtcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRuYW1lOiAncCcsXG5cdCAqIFx0XHRjbGFzc2VzOiAnZmFuY3knXG5cdCAqIFx0fSxcblx0ICogXHRtb2RlbDogJ2ZhbmN5UGFyYWdyYXBoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCB7XG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0bmFtZTogJ3AnLFxuXHQgKiBcdFx0Y2xhc3NlczogJ2hlYWRpbmcnXG5cdCAqIFx0fSxcblx0ICogXHRtb2RlbDogKCB2aWV3RWxlbWVudCwgY29udmVyc2lvbkFwaSApID0+IHtcblx0ICogXHRcdGNvbnN0IG1vZGVsV3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG5cdCAqXG5cdCAqIFx0XHRyZXR1cm4gbW9kZWxXcml0ZXIuY3JlYXRlRWxlbWVudCggJ2hlYWRpbmcnLCB7IGxldmVsOiB2aWV3RWxlbWVudC5nZXRBdHRyaWJ1dGUoICdkYXRhLWxldmVsJyApIH0gKTtcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNmb3IgYGNvbnZlcnNpb24uZm9yKClgfSB0byBsZWFybiBob3cgdG8gYWRkIGEgY29udmVydGVyXG5cdCAqIHRvIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gY29uZmlnLnZpZXcgUGF0dGVybiBtYXRjaGluZyBhbGwgdmlldyBlbGVtZW50cyB3aGljaCBzaG91bGQgYmUgY29udmVydGVkLiBJZiBub3Qgc2V0LCB0aGUgY29udmVydGVyXG5cdCAqIHdpbGwgZmlyZSBmb3IgZXZlcnkgdmlldyBlbGVtZW50LlxuXHQgKiBAcGFyYW0gY29uZmlnLm1vZGVsIE5hbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnQsIGEgbW9kZWwgZWxlbWVudCBpbnN0YW5jZSBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSB2aWV3IGVsZW1lbnRcblx0ICogYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3RDb252ZXJzaW9uQXBpIHVwY2FzdCBjb252ZXJzaW9uIEFQSX1cblx0ICogYW5kIHJldHVybnMgYSBtb2RlbCBlbGVtZW50LiBUaGUgbW9kZWwgZWxlbWVudCB3aWxsIGJlIGluc2VydGVkIGluIHRoZSBtb2RlbC5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBlbGVtZW50VG9FbGVtZW50KGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQodXBjYXN0RWxlbWVudFRvRWxlbWVudChjb25maWcpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFZpZXcgZWxlbWVudCB0byBtb2RlbCBhdHRyaWJ1dGUgY29udmVyc2lvbiBoZWxwZXIuXG5cdCAqXG5cdCAqIFRoaXMgY29udmVyc2lvbiByZXN1bHRzIGluIHNldHRpbmcgYW4gYXR0cmlidXRlIG9uIGEgbW9kZWwgbm9kZS4gRm9yIGV4YW1wbGUsIHZpZXcgYDxzdHJvbmc+Rm9vPC9zdHJvbmc+YCBiZWNvbWVzXG5cdCAqIGBGb29gIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCBtb2RlbCB0ZXh0IG5vZGV9IHdpdGggYGJvbGRgIGF0dHJpYnV0ZSBzZXQgdG8gYHRydWVgLlxuXHQgKlxuXHQgKiBUaGlzIGhlbHBlciBpcyBtZWFudCB0byBzZXQgYSBtb2RlbCBhdHRyaWJ1dGUgb24gYWxsIHRoZSBlbGVtZW50cyB0aGF0IGFyZSBpbnNpZGUgdGhlIGNvbnZlcnRlZCBlbGVtZW50OlxuXHQgKlxuXHQgKiBgYGBcblx0ICogPHN0cm9uZz5Gb288L3N0cm9uZz4gICAtLT4gICA8c3Ryb25nPjxwPkZvbzwvcD48L3N0cm9uZz4gICAtLT4gICA8cGFyYWdyYXBoPjwkdGV4dCBib2xkPVwidHJ1ZVwiPkZvbzwvJHRleHQ+PC9wYXJhZ3JhcGg+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBBYm92ZSBpcyBhIHNhbXBsZSBvZiBIVE1MIGNvZGUsIHRoYXQgZ29lcyB0aHJvdWdoIGF1dG9wYXJhZ3JhcGhpbmcgKGZpcnN0IHN0ZXApIGFuZCB0aGVuIGlzIGNvbnZlcnRlZCAoc2Vjb25kIHN0ZXApLlxuXHQgKiBFdmVuIHRob3VnaCBgPHN0cm9uZz5gIGlzIG92ZXIgYDxwPmAgZWxlbWVudCwgYGJvbGQ9XCJ0cnVlXCJgIHdhcyBhZGRlZCB0byB0aGUgdGV4dC4gU2VlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0aGVscGVyc35VcGNhc3RIZWxwZXJzI2F0dHJpYnV0ZVRvQXR0cmlidXRlfSBmb3IgY29tcGFyaXNvbi5cblx0ICpcblx0ICogS2VlcCBpbiBtaW5kIHRoYXQgdGhlIGF0dHJpYnV0ZSB3aWxsIGJlIHNldCBvbmx5IGlmIGl0IGlzIGFsbG93ZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSBzY2hlbWF9IGNvbmZpZ3VyYXRpb24uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiAnc3Ryb25nJyxcblx0ICogXHRtb2RlbDogJ2JvbGQnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApLmVsZW1lbnRUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdHZpZXc6ICdzdHJvbmcnLFxuXHQgKiBcdG1vZGVsOiAnYm9sZCcsXG5cdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRjbGFzc2VzOiAnYm9sZCdcblx0ICogXHR9LFxuXHQgKiBcdG1vZGVsOiAnYm9sZCdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuZWxlbWVudFRvQXR0cmlidXRlKCB7XG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0Y2xhc3NlczogWyAnc3R5bGVkJywgJ3N0eWxlZC1kYXJrJyBdXG5cdCAqIFx0fSxcblx0ICogXHRtb2RlbDoge1xuXHQgKiBcdFx0a2V5OiAnc3R5bGVkJyxcblx0ICogXHRcdHZhbHVlOiAnZGFyaydcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApLmVsZW1lbnRUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdG5hbWU6ICdzcGFuJyxcblx0ICogXHRcdHN0eWxlczoge1xuXHQgKiBcdFx0XHQnZm9udC1zaXplJzogL1tcXHNcXFNdKy9cblx0ICogXHRcdH1cblx0ICogXHR9LFxuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRrZXk6ICdmb250U2l6ZScsXG5cdCAqIFx0XHR2YWx1ZTogKCB2aWV3RWxlbWVudCwgY29udmVyc2lvbkFwaSApID0+IHtcblx0ICogXHRcdFx0Y29uc3QgZm9udFNpemUgPSB2aWV3RWxlbWVudC5nZXRTdHlsZSggJ2ZvbnQtc2l6ZScgKTtcblx0ICogXHRcdFx0Y29uc3QgdmFsdWUgPSBmb250U2l6ZS5zdWJzdHIoIDAsIGZvbnRTaXplLmxlbmd0aCAtIDIgKTtcblx0ICpcblx0ICogXHRcdFx0aWYgKCB2YWx1ZSA8PSAxMCApIHtcblx0ICogXHRcdFx0XHRyZXR1cm4gJ3NtYWxsJztcblx0ICogXHRcdFx0fSBlbHNlIGlmICggdmFsdWUgPiAxMiApIHtcblx0ICogXHRcdFx0XHRyZXR1cm4gJ2JpZyc7XG5cdCAqIFx0XHRcdH1cblx0ICpcblx0ICogXHRcdFx0cmV0dXJuIG51bGw7XG5cdCAqIFx0XHR9XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBjb252ZXJzaW9uLmZvcigpYH0gdG8gbGVhcm4gaG93IHRvIGFkZCBhIGNvbnZlcnRlclxuXHQgKiB0byB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cblx0ICogQHBhcmFtIGNvbmZpZy52aWV3IFBhdHRlcm4gbWF0Y2hpbmcgYWxsIHZpZXcgZWxlbWVudHMgd2hpY2ggc2hvdWxkIGJlIGNvbnZlcnRlZC5cblx0ICogQHBhcmFtIGNvbmZpZy5tb2RlbCBNb2RlbCBhdHRyaWJ1dGUga2V5IG9yIGFuIG9iamVjdCB3aXRoIGBrZXlgIGFuZCBgdmFsdWVgIHByb3BlcnRpZXMsIGRlc2NyaWJpbmdcblx0ICogdGhlIG1vZGVsIGF0dHJpYnV0ZS4gYHZhbHVlYCBwcm9wZXJ0eSBtYXkgYmUgc2V0IGFzIGEgZnVuY3Rpb24gdGhhdCB0YWtlcyBhIHZpZXcgZWxlbWVudCBhbmRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdENvbnZlcnNpb25BcGkgdXBjYXN0IGNvbnZlcnNpb24gQVBJfSBhbmQgcmV0dXJucyB0aGUgdmFsdWUuXG5cdCAqIElmIGBTdHJpbmdgIGlzIGdpdmVuLCB0aGUgbW9kZWwgYXR0cmlidXRlIHZhbHVlIHdpbGwgYmUgc2V0IHRvIGB0cnVlYC5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuIERlZmF1bHRzIHRvIGBsb3dgLlxuXHQgKi8gZWxlbWVudFRvQXR0cmlidXRlKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQodXBjYXN0RWxlbWVudFRvQXR0cmlidXRlKGNvbmZpZykpO1xuICAgIH1cbiAgICAvKipcblx0ICogVmlldyBhdHRyaWJ1dGUgdG8gbW9kZWwgYXR0cmlidXRlIGNvbnZlcnNpb24gaGVscGVyLlxuXHQgKlxuXHQgKiBUaGlzIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBzZXR0aW5nIGFuIGF0dHJpYnV0ZSBvbiBhIG1vZGVsIG5vZGUuIEZvciBleGFtcGxlLCB2aWV3IGA8aW1nIHNyYz1cImZvby5qcGdcIj48L2ltZz5gIGJlY29tZXNcblx0ICogYDxpbWFnZUJsb2NrIHNvdXJjZT1cImZvby5qcGdcIj48L2ltYWdlQmxvY2s+YCBpbiB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIFRoaXMgaGVscGVyIGlzIG1lYW50IHRvIGNvbnZlcnQgdmlldyBhdHRyaWJ1dGVzIGZyb20gdmlldyBlbGVtZW50cyB3aGljaCBnb3QgY29udmVydGVkIHRvIHRoZSBtb2RlbCwgc28gdGhlIHZpZXcgYXR0cmlidXRlXG5cdCAqIGlzIHNldCBvbmx5IG9uIHRoZSBjb3JyZXNwb25kaW5nIG1vZGVsIG5vZGU6XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiA8ZGl2IGNsYXNzPVwiZGFya1wiPjxkaXY+Zm9vPC9kaXY+PC9kaXY+ICAgIC0tPiAgICA8ZGl2IGRhcms9XCJ0cnVlXCI+PGRpdj5mb288L2Rpdj48L2Rpdj5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEFib3ZlLCBgY2xhc3M9XCJkYXJrXCJgIGF0dHJpYnV0ZSBpcyBhZGRlZCBvbmx5IHRvIHRoZSBgPGRpdj5gIGVsZW1lbnRzIHRoYXQgaGFzIGl0LiBUaGlzIGlzIGluIGNvbnRyYXN0IHRvXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0aGVscGVyc35VcGNhc3RIZWxwZXJzI2VsZW1lbnRUb0F0dHJpYnV0ZX0gd2hpY2ggc2V0cyBhdHRyaWJ1dGVzIGZvclxuXHQgKiBhbGwgdGhlIGNoaWxkcmVuIGluIHRoZSBtb2RlbDpcblx0ICpcblx0ICogYGBgXG5cdCAqIDxzdHJvbmc+Rm9vPC9zdHJvbmc+ICAgLS0+ICAgPHN0cm9uZz48cD5Gb288L3A+PC9zdHJvbmc+ICAgLS0+ICAgPHBhcmFncmFwaD48JHRleHQgYm9sZD1cInRydWVcIj5Gb288LyR0ZXh0PjwvcGFyYWdyYXBoPlxuXHQgKiBgYGBcblx0ICpcblx0ICogQWJvdmUgaXMgYSBzYW1wbGUgb2YgSFRNTCBjb2RlLCB0aGF0IGdvZXMgdGhyb3VnaCBhdXRvcGFyYWdyYXBoaW5nIChmaXJzdCBzdGVwKSBhbmQgdGhlbiBpcyBjb252ZXJ0ZWQgKHNlY29uZCBzdGVwKS5cblx0ICogRXZlbiB0aG91Z2ggYDxzdHJvbmc+YCBpcyBvdmVyIGA8cD5gIGVsZW1lbnQsIGBib2xkPVwidHJ1ZVwiYCB3YXMgYWRkZWQgdG8gdGhlIHRleHQuXG5cdCAqXG5cdCAqIEtlZXAgaW4gbWluZCB0aGF0IHRoZSBhdHRyaWJ1dGUgd2lsbCBiZSBzZXQgb25seSBpZiBpdCBpcyBhbGxvd2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEgc2NoZW1hfSBjb25maWd1cmF0aW9uLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiAnc3JjJyxcblx0ICogXHRtb2RlbDogJ3NvdXJjZSdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiB7IGtleTogJ3NyYycgfSxcblx0ICogXHRtb2RlbDogJ3NvdXJjZSdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiB7IGtleTogJ3NyYycgfSxcblx0ICogXHRtb2RlbDogJ3NvdXJjZScsXG5cdCAqIFx0Y29udmVydGVyUHJpb3JpdHk6ICdub3JtYWwnXG5cdCAqIH0gKTtcblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApLmF0dHJpYnV0ZVRvQXR0cmlidXRlKCB7XG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0a2V5OiAnZGF0YS1zdHlsZScsXG5cdCAqIFx0XHR2YWx1ZTogL1tcXHNcXFNdKy9cblx0ICogXHR9LFxuXHQgKiBcdG1vZGVsOiAnc3R5bGVkJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdG5hbWU6ICdpbWcnLFxuXHQgKiBcdFx0a2V5OiAnY2xhc3MnLFxuXHQgKiBcdFx0dmFsdWU6ICdzdHlsZWQtZGFyaydcblx0ICogXHR9LFxuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRrZXk6ICdzdHlsZWQnLFxuXHQgKiBcdFx0dmFsdWU6ICdkYXJrJ1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRrZXk6ICdjbGFzcycsXG5cdCAqIFx0XHR2YWx1ZTogL3N0eWxlZC1bXFxTXSsvXG5cdCAqIFx0fSxcblx0ICogXHRtb2RlbDoge1xuXHQgKiBcdFx0a2V5OiAnc3R5bGVkJ1xuXHQgKiBcdFx0dmFsdWU6ICggdmlld0VsZW1lbnQsIGNvbnZlcnNpb25BcGkgKSA9PiB7XG5cdCAqIFx0XHRcdGNvbnN0IHJlZ2V4cCA9IC9zdHlsZWQtKFtcXFNdKykvO1xuXHQgKiBcdFx0XHRjb25zdCBtYXRjaCA9IHZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZSggJ2NsYXNzJyApLm1hdGNoKCByZWdleHAgKTtcblx0ICpcblx0ICogXHRcdFx0cmV0dXJuIG1hdGNoWyAxIF07XG5cdCAqIFx0XHR9XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDb252ZXJ0aW5nIHN0eWxlcyB3b3JrcyBhIGJpdCBkaWZmZXJlbnRseSBhcyBpdCByZXF1aXJlcyBgdmlldy5zdHlsZXNgIHRvIGJlIGFuIG9iamVjdCBhbmQgYnkgZGVmYXVsdFxuXHQgKiBhIG1vZGVsIGF0dHJpYnV0ZSB3aWxsIGJlIHNldCB0byBgdHJ1ZWAgYnkgc3VjaCBhIGNvbnZlcnRlci4gWW91IGNhbiBzZXQgdGhlIG1vZGVsIGF0dHJpYnV0ZSB0byBhbnkgdmFsdWUgYnkgcHJvdmlkaW5nIHRoZSBgdmFsdWVgXG5cdCAqIGNhbGxiYWNrIHRoYXQgcmV0dXJucyB0aGUgZGVzaXJlZCB2YWx1ZS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gRGVmYXVsdCBjb252ZXJzaW9uIG9mIGZvbnQtd2VpZ2h0IHN0eWxlIHdpbGwgcmVzdWx0IGluIHNldHRpbmcgYm9sZCBhdHRyaWJ1dGUgdG8gdHJ1ZS5cblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApLmF0dHJpYnV0ZVRvQXR0cmlidXRlKCB7XG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0c3R5bGVzOiB7XG5cdCAqIFx0XHRcdCdmb250LXdlaWdodCc6ICdib2xkJ1xuXHQgKiBcdFx0fVxuXHQgKiBcdH0sXG5cdCAqIFx0bW9kZWw6ICdib2xkJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIC8vIFRoaXMgY29udmVydGVyIHdpbGwgcGFzcyBhbnkgc3R5bGUgdmFsdWUgdG8gdGhlIGBsaW5lSGVpZ2h0YCBtb2RlbCBhdHRyaWJ1dGUuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdHN0eWxlczoge1xuXHQgKiBcdFx0XHQnbGluZS1oZWlnaHQnOiAvW1xcc1xcU10rL1xuXHQgKiBcdFx0fVxuXHQgKiBcdH0sXG5cdCAqIFx0bW9kZWw6IHtcblx0ICogXHRcdGtleTogJ2xpbmVIZWlnaHQnLFxuXHQgKiBcdFx0dmFsdWU6ICggdmlld0VsZW1lbnQsIGNvbnZlcnNpb25BcGkgKSA9PiB2aWV3RWxlbWVudC5nZXRTdHlsZSggJ2xpbmUtaGVpZ2h0JyApXG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBjb252ZXJzaW9uLmZvcigpYH0gdG8gbGVhcm4gaG93IHRvIGFkZCBhIGNvbnZlcnRlclxuXHQgKiB0byB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cblx0ICogQHBhcmFtIGNvbmZpZy52aWV3IFNwZWNpZmllcyB3aGljaCB2aWV3IGF0dHJpYnV0ZSB3aWxsIGJlIGNvbnZlcnRlZC4gSWYgYSBgU3RyaW5nYCBpcyBwYXNzZWQsXG5cdCAqIGF0dHJpYnV0ZXMgd2l0aCBnaXZlbiBrZXkgd2lsbCBiZSBjb252ZXJ0ZWQuIElmIGFuIGBPYmplY3RgIGlzIHBhc3NlZCwgaXQgbXVzdCBoYXZlIGEgcmVxdWlyZWQgYGtleWAgcHJvcGVydHksXG5cdCAqIHNwZWNpZnlpbmcgdmlldyBhdHRyaWJ1dGUga2V5LCBhbmQgbWF5IGhhdmUgYW4gb3B0aW9uYWwgYHZhbHVlYCBwcm9wZXJ0eSwgc3BlY2lmeWluZyB2aWV3IGF0dHJpYnV0ZSB2YWx1ZSBhbmQgb3B0aW9uYWwgYG5hbWVgXG5cdCAqIHByb3BlcnR5IHNwZWNpZnlpbmcgYSB2aWV3IGVsZW1lbnQgbmFtZSBmcm9tL29uIHdoaWNoIHRoZSBhdHRyaWJ1dGUgc2hvdWxkIGJlIGNvbnZlcnRlZC4gYHZhbHVlYCBjYW4gYmUgZ2l2ZW4gYXMgYSBgU3RyaW5nYCxcblx0ICogYSBgUmVnRXhwYCBvciBhIGZ1bmN0aW9uIGNhbGxiYWNrLCB0aGF0IHRha2VzIHZpZXcgYXR0cmlidXRlIHZhbHVlIGFzIHRoZSBvbmx5IHBhcmFtZXRlciBhbmQgcmV0dXJucyBgQm9vbGVhbmAuXG5cdCAqIEBwYXJhbSBjb25maWcubW9kZWwgTW9kZWwgYXR0cmlidXRlIGtleSBvciBhbiBvYmplY3Qgd2l0aCBga2V5YCBhbmQgYHZhbHVlYCBwcm9wZXJ0aWVzLCBkZXNjcmliaW5nXG5cdCAqIHRoZSBtb2RlbCBhdHRyaWJ1dGUuIGB2YWx1ZWAgcHJvcGVydHkgbWF5IGJlIHNldCBhcyBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSB2aWV3IGVsZW1lbnQgYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3RDb252ZXJzaW9uQXBpIHVwY2FzdCBjb252ZXJzaW9uIEFQSX0gYW5kIHJldHVybnMgdGhlIHZhbHVlLlxuXHQgKiBJZiBgU3RyaW5nYCBpcyBnaXZlbiwgdGhlIG1vZGVsIGF0dHJpYnV0ZSB2YWx1ZSB3aWxsIGJlIHNhbWUgYXMgdmlldyBhdHRyaWJ1dGUgdmFsdWUuXG5cdCAqIEBwYXJhbSBjb25maWcuY29udmVydGVyUHJpb3JpdHkgQ29udmVydGVyIHByaW9yaXR5LiBEZWZhdWx0cyB0byBgbG93YC5cblx0ICovIGF0dHJpYnV0ZVRvQXR0cmlidXRlKGNvbmZpZykge1xuICAgICAgICByZXR1cm4gdGhpcy5hZGQodXBjYXN0QXR0cmlidXRlVG9BdHRyaWJ1dGUoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBWaWV3IGVsZW1lbnQgdG8gbW9kZWwgbWFya2VyIGNvbnZlcnNpb24gaGVscGVyLlxuXHQgKlxuXHQgKiBUaGlzIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBjcmVhdGluZyBhIG1vZGVsIG1hcmtlci4gRm9yIGV4YW1wbGUsIGlmIHRoZSBtYXJrZXIgd2FzIHN0b3JlZCBpbiBhIHZpZXcgYXMgYW4gZWxlbWVudDpcblx0ICogYDxwPkZvPHNwYW4gZGF0YS1tYXJrZXI9XCJjb21tZW50XCIgZGF0YS1jb21tZW50LWlkPVwiN1wiPjwvc3Bhbj5vPC9wPjxwPkI8c3BhbiBkYXRhLW1hcmtlcj1cImNvbW1lbnRcIiBkYXRhLWNvbW1lbnQtaWQ9XCI3XCI+PC9zcGFuPmFyPC9wPmAsXG5cdCAqIGFmdGVyIHRoZSBjb252ZXJzaW9uIGlzIGRvbmUsIHRoZSBtYXJrZXIgd2lsbCBiZSBhdmFpbGFibGUgaW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjbWFya2VycyBtb2RlbCBkb2N1bWVudCBtYXJrZXJzfS5cblx0ICpcblx0ICogKipOb3RlKio6IFdoZW4gdGhpcyBoZWxwZXIgaXMgdXNlZCBpbiB0aGUgZGF0YSB1cGNhc3QgaW4gY29tYmluYXRpb24gd2l0aFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjbWFya2VyVG9EYXRhIGAjbWFya2VyVG9EYXRhKClgfSBpbiB0aGUgZGF0YSBkb3duY2FzdCxcblx0ICogdGhlbiBpbnZhbGlkIEhUTUwgY29kZSAoZS5nLiBhIHNwYW4gYmV0d2VlbiB0YWJsZSBjZWxscykgbWF5IGJlIHByb2R1Y2VkIGJ5IHRoZSBsYXR0ZXIgY29udmVydGVyLlxuXHQgKlxuXHQgKiBJbiBtb3N0IG9mIHRoZSBjYXNlcywgdGhlIHtAbGluayAjZGF0YVRvTWFya2VyfSBzaG91bGQgYmUgdXNlZCBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuZWxlbWVudFRvTWFya2VyKCB7XG5cdCAqIFx0dmlldzogJ21hcmtlci1zZWFyY2gnLFxuXHQgKiBcdG1vZGVsOiAnc2VhcmNoJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9NYXJrZXIoIHtcblx0ICogXHR2aWV3OiAnbWFya2VyLXNlYXJjaCcsXG5cdCAqIFx0bW9kZWw6ICdzZWFyY2gnLFxuXHQgKiBcdGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCdcblx0ICogfSApO1xuXHQgKlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuZWxlbWVudFRvTWFya2VyKCB7XG5cdCAqIFx0dmlldzogJ21hcmtlci1zZWFyY2gnLFxuXHQgKiBcdG1vZGVsOiAoIHZpZXdFbGVtZW50LCBjb252ZXJzaW9uQXBpICkgPT4gJ2NvbW1lbnQ6JyArIHZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZSggJ2RhdGEtY29tbWVudC1pZCcgKVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5lbGVtZW50VG9NYXJrZXIoIHtcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRhdHRyaWJ1dGVzOiB7XG5cdCAqIFx0XHRcdCdkYXRhLW1hcmtlcic6ICdzZWFyY2gnXG5cdCAqIFx0XHR9XG5cdCAqIFx0fSxcblx0ICogXHRtb2RlbDogJ3NlYXJjaCdcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBgY29udmVyc2lvbi5mb3IoKWB9IHRvIGxlYXJuIGhvdyB0byBhZGQgYSBjb252ZXJ0ZXJcblx0ICogdG8gdGhlIGNvbnZlcnNpb24gcHJvY2Vzcy5cblx0ICpcblx0ICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG5cdCAqIEBwYXJhbSBjb25maWcudmlldyBQYXR0ZXJuIG1hdGNoaW5nIGFsbCB2aWV3IGVsZW1lbnRzIHdoaWNoIHNob3VsZCBiZSBjb252ZXJ0ZWQuXG5cdCAqIEBwYXJhbSBjb25maWcubW9kZWwgTmFtZSBvZiB0aGUgbW9kZWwgbWFya2VyLCBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSB2aWV3IGVsZW1lbnQgYW5kIHJldHVybnNcblx0ICogYSBtb2RlbCBtYXJrZXIgbmFtZS5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBlbGVtZW50VG9NYXJrZXIoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZCh1cGNhc3RFbGVtZW50VG9NYXJrZXIoY29uZmlnKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBWaWV3LXRvLW1vZGVsIG1hcmtlciBjb252ZXJzaW9uIGhlbHBlci5cblx0ICpcblx0ICogQ29udmVydHMgdmlldyBkYXRhIGNyZWF0ZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+RG93bmNhc3RIZWxwZXJzI21hcmtlclRvRGF0YSBgI21hcmtlclRvRGF0YSgpYH1cblx0ICogYmFjayB0byBhIG1vZGVsIG1hcmtlci5cblx0ICpcblx0ICogVGhpcyBjb252ZXJ0ZXIgbG9va3MgZm9yIHNwZWNpZmljIHZpZXcgZWxlbWVudHMgYW5kIHZpZXcgYXR0cmlidXRlcyB0aGF0IG1hcmsgbWFya2VyIGJvdW5kYXJpZXMuIFNlZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjbWFya2VyVG9EYXRhIGAjbWFya2VyVG9EYXRhKClgfSB0byBsZWFybiB3aGF0IHZpZXcgZGF0YVxuXHQgKiBpcyBleHBlY3RlZCBieSB0aGlzIGNvbnZlcnRlci5cblx0ICpcblx0ICogVGhlIGBjb25maWcudmlld2AgcHJvcGVydHkgaXMgZXF1YWwgdG8gdGhlIG1hcmtlciBncm91cCBuYW1lIHRvIGNvbnZlcnQuXG5cdCAqXG5cdCAqIEJ5IGRlZmF1bHQsIHRoaXMgY29udmVydGVyIGNyZWF0ZXMgbWFya2VycyB3aXRoIHRoZSBgZ3JvdXA6bmFtZWAgbmFtZSBjb252ZW50aW9uICh0byBtYXRjaCB0aGUgZGVmYXVsdCBgbWFya2VyVG9EYXRhYCBjb252ZXJzaW9uKS5cblx0ICpcblx0ICogVGhlIGNvbnZlcnNpb24gY29uZmlndXJhdGlvbiBjYW4gdGFrZSBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBnZW5lcmF0ZSBhIG1hcmtlciBuYW1lLlxuXHQgKiBJZiBzdWNoIGZ1bmN0aW9uIGlzIHNldCBhcyB0aGUgYGNvbmZpZy5tb2RlbGAgcGFyYW1ldGVyLCBpdCBpcyBwYXNzZWQgdGhlIGBuYW1lYCBwYXJ0IGZyb20gdGhlIHZpZXcgZWxlbWVudCBvciBhdHRyaWJ1dGUgYW5kIGl0IGlzXG5cdCAqIGV4cGVjdGVkIHRvIHJldHVybiBhIHN0cmluZyB3aXRoIHRoZSBtYXJrZXIgbmFtZS5cblx0ICpcblx0ICogQmFzaWMgdXNhZ2U6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIFVzaW5nIHRoZSBkZWZhdWx0IGNvbnZlcnNpb24uXG5cdCAqIC8vIEluIHRoaXMgY2FzZSwgYWxsIG1hcmtlcnMgZnJvbSB0aGUgYGNvbW1lbnRgIGdyb3VwIHdpbGwgYmUgY29udmVydGVkLlxuXHQgKiAvLyBUaGUgY29udmVyc2lvbiB3aWxsIGxvb2sgZm9yIGA8Y29tbWVudC1zdGFydD5gIGFuZCBgPGNvbW1lbnQtZW5kPmAgdGFncyBhbmRcblx0ICogLy8gYGRhdGEtY29tbWVudC1zdGFydC1iZWZvcmVgLCBgZGF0YS1jb21tZW50LXN0YXJ0LWFmdGVyYCxcblx0ICogLy8gYGRhdGEtY29tbWVudC1lbmQtYmVmb3JlYCBhbmQgYGRhdGEtY29tbWVudC1lbmQtYWZ0ZXJgIGF0dHJpYnV0ZXMuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ3VwY2FzdCcgKS5kYXRhVG9NYXJrZXIoIHtcblx0ICogXHR2aWV3OiAnY29tbWVudCdcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQW4gZXhhbXBsZSBvZiBhIG1vZGVsIHRoYXQgbWF5IGJlIGdlbmVyYXRlZCBieSB0aGlzIGNvbnZlcnNpb246XG5cdCAqXG5cdCAqIGBgYFxuXHQgKiAvLyBWaWV3OlxuXHQgKiA8cD5Gb288Y29tbWVudC1zdGFydCBuYW1lPVwiY29tbWVudElkOnVpZFwiPjwvY29tbWVudC1zdGFydD5iYXI8L3A+XG5cdCAqIDxmaWd1cmUgZGF0YS1jb21tZW50LWVuZC1hZnRlcj1cImNvbW1lbnRJZDp1aWRcIiBjbGFzcz1cImltYWdlXCI+PGltZyBzcmM9XCJhYmMuanBnXCIgLz48L2ZpZ3VyZT5cblx0ICpcblx0ICogLy8gTW9kZWw6XG5cdCAqIDxwYXJhZ3JhcGg+Rm9vW2JhcjwvcGFyYWdyYXBoPlxuXHQgKiA8aW1hZ2VCbG9jayBzcmM9XCJhYmMuanBnXCI+PC9pbWFnZUJsb2NrPl1cblx0ICogYGBgXG5cdCAqXG5cdCAqIFdoZXJlIGBbXWAgYXJlIGJvdW5kYXJpZXMgb2YgYSBtYXJrZXIgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGBjb21tZW50OmNvbW1lbnRJZDp1aWRgIG5hbWUuXG5cdCAqXG5cdCAqIE90aGVyIGV4YW1wbGVzIG9mIHVzYWdlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBVc2luZyBhIGN1c3RvbSBmdW5jdGlvbiB3aGljaCBpcyB0aGUgc2FtZSBhcyB0aGUgZGVmYXVsdCBjb252ZXJzaW9uOlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuZGF0YVRvTWFya2VyKCB7XG5cdCAqIFx0dmlldzogJ2NvbW1lbnQnLFxuXHQgKiBcdG1vZGVsOiAoIG5hbWUsIGNvbnZlcnNpb25BcGkgKSA9PiAnY29tbWVudDonICsgbmFtZSxcblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBVc2luZyB0aGUgY29udmVydGVyIHByaW9yaXR5OlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuZGF0YVRvTWFya2VyKCB7XG5cdCAqIFx0dmlldzogJ2NvbW1lbnQnLFxuXHQgKiBcdG1vZGVsOiAoIG5hbWUsIGNvbnZlcnNpb25BcGkgKSA9PiAnY29tbWVudDonICsgbmFtZSxcblx0ICogXHRjb252ZXJ0ZXJQcmlvcml0eTogJ2hpZ2gnXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNmb3IgYGNvbnZlcnNpb24uZm9yKClgfSB0byBsZWFybiBob3cgdG8gYWRkIGEgY29udmVydGVyXG5cdCAqIHRvIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gY29uZmlnLnZpZXcgVGhlIG1hcmtlciBncm91cCBuYW1lIHRvIGNvbnZlcnQuXG5cdCAqIEBwYXJhbSBjb25maWcubW9kZWwgQSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZSBgbmFtZWAgcGFydCBmcm9tIHRoZSB2aWV3IGVsZW1lbnQgb3IgYXR0cmlidXRlIGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3VwY2FzdGRpc3BhdGNoZXJ+VXBjYXN0Q29udmVyc2lvbkFwaSB1cGNhc3QgY29udmVyc2lvbiBBUEl9IGFuZCByZXR1cm5zIHRoZSBtYXJrZXIgbmFtZS5cblx0ICogQHBhcmFtIGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSBDb252ZXJ0ZXIgcHJpb3JpdHkuXG5cdCAqLyBkYXRhVG9NYXJrZXIoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZCh1cGNhc3REYXRhVG9NYXJrZXIoY29uZmlnKSk7XG4gICAgfVxufVxuLyoqXG4gKiBGdW5jdGlvbiBmYWN0b3J5LCBjcmVhdGVzIGEgY29udmVydGVyIHRoYXQgY29udmVydHMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgdmlldyBkb2N1bWVudCBmcmFnbWVudH1cbiAqIG9yIGFsbCBjaGlsZHJlbiBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudH0gaW50b1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IG1vZGVsIGRvY3VtZW50IGZyYWdtZW50fS5cbiAqIFRoaXMgaXMgdGhlIFwiZW50cnktcG9pbnRcIiBjb252ZXJ0ZXIgZm9yIHVwY2FzdCAodmlldyB0byBtb2RlbCBjb252ZXJzaW9uKS4gVGhpcyBjb252ZXJ0ZXIgc3RhcnRzIHRoZSBjb252ZXJzaW9uIG9mIGFsbCBjaGlsZHJlblxuICogb2YgcGFzc2VkIHZpZXcgZG9jdW1lbnQgZnJhZ21lbnQuIFRob3NlIGNoaWxkcmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbm9kZX5Ob2RlIHZpZXcgbm9kZXN9IGFyZSB0aGVuIGhhbmRsZWQgYnkgb3RoZXIgY29udmVydGVycy5cbiAqXG4gKiBUaGlzIGFsc28gYSBcImRlZmF1bHRcIiwgbGFzdCByZXNvcnQgY29udmVydGVyIGZvciBhbGwgdmlldyBlbGVtZW50cyB0aGF0IGhhcyBub3QgYmVlbiBjb252ZXJ0ZWQgYnkgb3RoZXIgY29udmVydGVycy5cbiAqIFdoZW4gYSB2aWV3IGVsZW1lbnQgaXMgYmVpbmcgY29udmVydGVkIHRvIHRoZSBtb2RlbCBidXQgaXQgZG9lcyBub3QgaGF2ZSBjb252ZXJ0ZXIgc3BlY2lmaWVkLCB0aGF0IHZpZXcgZWxlbWVudFxuICogd2lsbCBiZSBjb252ZXJ0ZWQgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IG1vZGVsIGRvY3VtZW50IGZyYWdtZW50fSBhbmQgcmV0dXJuZWQuXG4gKlxuICogQHJldHVybnMgVW5pdmVyc2FsIGNvbnZlcnRlciBmb3IgdmlldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBmcmFnbWVudHN9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudHN9IHRoYXQgcmV0dXJuc1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IG1vZGVsIGZyYWdtZW50fSB3aXRoIGNoaWxkcmVuIG9mIGNvbnZlcnRlZCB2aWV3IGl0ZW0uXG4gKi8gZnVuY3Rpb24gY29udmVydFRvTW9kZWxGcmFnbWVudCQxKCkge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICAvLyBTZWNvbmQgYXJndW1lbnQgaW4gYGNvbnN1bWFibGUuY29uc3VtZWAgaXMgZGlzY2FyZGVkIGZvciBWaWV3RG9jdW1lbnRGcmFnbWVudCBidXQgaXMgbmVlZGVkIGZvciBWaWV3RWxlbWVudC5cbiAgICAgICAgaWYgKCFkYXRhLm1vZGVsUmFuZ2UgJiYgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS52aWV3SXRlbSwge1xuICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICB9KSkge1xuICAgICAgICAgICAgY29uc3QgeyBtb2RlbFJhbmdlLCBtb2RlbEN1cnNvciB9ID0gY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS52aWV3SXRlbSwgZGF0YS5tb2RlbEN1cnNvcik7XG4gICAgICAgICAgICBkYXRhLm1vZGVsUmFuZ2UgPSBtb2RlbFJhbmdlO1xuICAgICAgICAgICAgZGF0YS5tb2RlbEN1cnNvciA9IG1vZGVsQ3Vyc29yO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSwgY3JlYXRlcyBhIGNvbnZlcnRlciB0aGF0IGNvbnZlcnRzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0fSB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0flRleHR9LlxuICpcbiAqIEByZXR1cm5zIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IFZpZXcgdGV4dH0gY29udmVydGVyLlxuICovIGZ1bmN0aW9uIGNvbnZlcnRUZXh0KCkge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCB7IHNjaGVtYSwgY29uc3VtYWJsZSwgd3JpdGVyIH0pPT57XG4gICAgICAgIGxldCBwb3NpdGlvbiA9IGRhdGEubW9kZWxDdXJzb3I7XG4gICAgICAgIC8vIFdoZW4gbm9kZSBpcyBhbHJlYWR5IGNvbnZlcnRlZCB0aGVuIGRvIG5vdGhpbmcuXG4gICAgICAgIGlmICghY29uc3VtYWJsZS50ZXN0KGRhdGEudmlld0l0ZW0pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzY2hlbWEuY2hlY2tDaGlsZChwb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIGlmICghaXNQYXJhZ3JhcGhhYmxlKHBvc2l0aW9uLCAnJHRleHQnLCBzY2hlbWEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRG8gbm90IGF1dG8tcGFyYWdyYXBoIHdoaXRlc3BhY2VzLlxuICAgICAgICAgICAgaWYgKGRhdGEudmlld0l0ZW0uZGF0YS50cmltKCkubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3NpdGlvbiA9IHdyYXBJblBhcmFncmFwaChwb3NpdGlvbiwgd3JpdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdW1hYmxlLmNvbnN1bWUoZGF0YS52aWV3SXRlbSk7XG4gICAgICAgIGNvbnN0IHRleHQgPSB3cml0ZXIuY3JlYXRlVGV4dChkYXRhLnZpZXdJdGVtLmRhdGEpO1xuICAgICAgICB3cml0ZXIuaW5zZXJ0KHRleHQsIHBvc2l0aW9uKTtcbiAgICAgICAgZGF0YS5tb2RlbFJhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlKHBvc2l0aW9uLCBwb3NpdGlvbi5nZXRTaGlmdGVkQnkodGV4dC5vZmZzZXRTaXplKSk7XG4gICAgICAgIGRhdGEubW9kZWxDdXJzb3IgPSBkYXRhLm1vZGVsUmFuZ2UuZW5kO1xuICAgIH07XG59XG4vKipcbiAqIEZ1bmN0aW9uIGZhY3RvcnksIGNyZWF0ZXMgYSBjYWxsYmFjayBmdW5jdGlvbiB3aGljaCBjb252ZXJ0cyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvblxuICogdmlldyBzZWxlY3Rpb259IHRha2VuIGZyb20gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6c2VsZWN0aW9uQ2hhbmdlfSBldmVudFxuICogYW5kIHNldHMgaW4gb24gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3NlbGVjdGlvbiBtb2RlbH0uXG4gKlxuICogKipOb3RlKio6IGJlY2F1c2UgdGhlcmUgaXMgbm8gdmlldyBzZWxlY3Rpb24gY2hhbmdlIGRpc3BhdGNoZXIgbm9yIGFueSBvdGhlciBhZHZhbmNlZCB2aWV3IHNlbGVjdGlvbiB0byBtb2RlbFxuICogY29udmVyc2lvbiBtZWNoYW5pc20sIHRoZSBjYWxsYmFjayBzaG91bGQgYmUgc2V0IGRpcmVjdGx5IG9uIHZpZXcgZG9jdW1lbnQuXG4gKlxuICogYGBgdHNcbiAqIHZpZXcuZG9jdW1lbnQub24oICdzZWxlY3Rpb25DaGFuZ2UnLCBjb252ZXJ0U2VsZWN0aW9uQ2hhbmdlKCBtb2RlbERvY3VtZW50LCBtYXBwZXIgKSApO1xuICogYGBgXG4gKlxuICogQHBhcmFtIG1vZGVsIERhdGEgbW9kZWwuXG4gKiBAcGFyYW0gbWFwcGVyIENvbnZlcnNpb24gbWFwcGVyLlxuICogQHJldHVybnMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpzZWxlY3Rpb25DaGFuZ2V9IGNhbGxiYWNrIGZ1bmN0aW9uLlxuICovIGZ1bmN0aW9uIGNvbnZlcnRTZWxlY3Rpb25DaGFuZ2UobW9kZWwsIG1hcHBlcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICBjb25zdCB2aWV3U2VsZWN0aW9uID0gZGF0YS5uZXdTZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHZpZXdSYW5nZSBvZiB2aWV3U2VsZWN0aW9uLmdldFJhbmdlcygpKXtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG1hcHBlci50b01vZGVsUmFuZ2Uodmlld1JhbmdlKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5jcmVhdGVTZWxlY3Rpb24ocmFuZ2VzLCB7XG4gICAgICAgICAgICBiYWNrd2FyZDogdmlld1NlbGVjdGlvbi5pc0JhY2t3YXJkXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIW1vZGVsU2VsZWN0aW9uLmlzRXF1YWwobW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihtb2RlbFNlbGVjdGlvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIFZpZXcgZWxlbWVudCB0byBtb2RlbCBlbGVtZW50IGNvbnZlcnNpb24gaGVscGVyLlxuICpcbiAqIFNlZSB7QGxpbmsgflVwY2FzdEhlbHBlcnMjZWxlbWVudFRvRWxlbWVudCBgLmVsZW1lbnRUb0VsZW1lbnQoKWAgdXBjYXN0IGhlbHBlcn0gZm9yIGV4YW1wbGVzLlxuICpcbiAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIGNvbmZpZy52aWV3IFBhdHRlcm4gbWF0Y2hpbmcgYWxsIHZpZXcgZWxlbWVudHMgd2hpY2ggc2hvdWxkIGJlIGNvbnZlcnRlZC4gSWYgbm90XG4gKiBzZXQsIHRoZSBjb252ZXJ0ZXIgd2lsbCBmaXJlIGZvciBldmVyeSB2aWV3IGVsZW1lbnQuXG4gKiBAcGFyYW0gY29uZmlnLm1vZGVsIE5hbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnQsIGEgbW9kZWwgZWxlbWVudFxuICogaW5zdGFuY2Ugb3IgYSBmdW5jdGlvbiB0aGF0IHRha2VzIGEgdmlldyBlbGVtZW50IGFuZCByZXR1cm5zIGEgbW9kZWwgZWxlbWVudC4gVGhlIG1vZGVsIGVsZW1lbnQgd2lsbCBiZSBpbnNlcnRlZCBpbiB0aGUgbW9kZWwuXG4gKiBAcGFyYW0gY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IENvbnZlcnRlciBwcmlvcml0eS5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIHVwY2FzdEVsZW1lbnRUb0VsZW1lbnQoY29uZmlnKSB7XG4gICAgY29uZmlnID0gY2xvbmVEZWVwKGNvbmZpZyk7XG4gICAgY29uc3QgY29udmVydGVyID0gcHJlcGFyZVRvRWxlbWVudENvbnZlcnRlcihjb25maWcpO1xuICAgIGNvbnN0IGVsZW1lbnROYW1lID0gZ2V0Vmlld0VsZW1lbnROYW1lRnJvbUNvbmZpZyhjb25maWcudmlldyk7XG4gICAgY29uc3QgZXZlbnROYW1lID0gZWxlbWVudE5hbWUgPyBgZWxlbWVudDoke2VsZW1lbnROYW1lfWAgOiAnZWxlbWVudCc7XG4gICAgcmV0dXJuIChkaXNwYXRjaGVyKT0+e1xuICAgICAgICBkaXNwYXRjaGVyLm9uKGV2ZW50TmFtZSwgY29udmVydGVyLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIFZpZXcgZWxlbWVudCB0byBtb2RlbCBhdHRyaWJ1dGUgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+VXBjYXN0SGVscGVycyNlbGVtZW50VG9BdHRyaWJ1dGUgYC5lbGVtZW50VG9BdHRyaWJ1dGUoKWAgdXBjYXN0IGhlbHBlcn0gZm9yIGV4YW1wbGVzLlxuICpcbiAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIGNvbmZpZy52aWV3IFBhdHRlcm4gbWF0Y2hpbmcgYWxsIHZpZXcgZWxlbWVudHMgd2hpY2ggc2hvdWxkIGJlIGNvbnZlcnRlZC5cbiAqIEBwYXJhbSBjb25maWcubW9kZWwgTW9kZWwgYXR0cmlidXRlIGtleSBvciBhbiBvYmplY3Qgd2l0aCBga2V5YCBhbmQgYHZhbHVlYCBwcm9wZXJ0aWVzLCBkZXNjcmliaW5nXG4gKiB0aGUgbW9kZWwgYXR0cmlidXRlLiBgdmFsdWVgIHByb3BlcnR5IG1heSBiZSBzZXQgYXMgYSBmdW5jdGlvbiB0aGF0IHRha2VzIGEgdmlldyBlbGVtZW50IGFuZCByZXR1cm5zIHRoZSB2YWx1ZS5cbiAqIElmIGBTdHJpbmdgIGlzIGdpdmVuLCB0aGUgbW9kZWwgYXR0cmlidXRlIHZhbHVlIHdpbGwgYmUgc2V0IHRvIGB0cnVlYC5cbiAqIEBwYXJhbSBjb25maWcuY29udmVydGVyUHJpb3JpdHkgQ29udmVydGVyIHByaW9yaXR5LiBEZWZhdWx0cyB0byBgbG93YC5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIHVwY2FzdEVsZW1lbnRUb0F0dHJpYnV0ZShjb25maWcpIHtcbiAgICBjb25maWcgPSBjbG9uZURlZXAoY29uZmlnKTtcbiAgICBub3JtYWxpemVNb2RlbEF0dHJpYnV0ZUNvbmZpZyhjb25maWcpO1xuICAgIGNvbnN0IGNvbnZlcnRlciA9IHByZXBhcmVUb0F0dHJpYnV0ZUNvbnZlcnRlcihjb25maWcsIGZhbHNlKTtcbiAgICBjb25zdCBlbGVtZW50TmFtZSA9IGdldFZpZXdFbGVtZW50TmFtZUZyb21Db25maWcoY29uZmlnLnZpZXcpO1xuICAgIGNvbnN0IGV2ZW50TmFtZSA9IGVsZW1lbnROYW1lID8gYGVsZW1lbnQ6JHtlbGVtZW50TmFtZX1gIDogJ2VsZW1lbnQnO1xuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZGlzcGF0Y2hlci5vbihldmVudE5hbWUsIGNvbnZlcnRlciwge1xuICAgICAgICAgICAgcHJpb3JpdHk6IGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSB8fCAnbG93J1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBWaWV3IGF0dHJpYnV0ZSB0byBtb2RlbCBhdHRyaWJ1dGUgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+VXBjYXN0SGVscGVycyNhdHRyaWJ1dGVUb0F0dHJpYnV0ZSBgLmF0dHJpYnV0ZVRvQXR0cmlidXRlKClgIHVwY2FzdCBoZWxwZXJ9IGZvciBleGFtcGxlcy5cbiAqXG4gKiBAcGFyYW0gY29uZmlnIENvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSBjb25maWcudmlldyBTcGVjaWZpZXMgd2hpY2ggdmlldyBhdHRyaWJ1dGUgd2lsbCBiZSBjb252ZXJ0ZWQuIElmIGEgYFN0cmluZ2AgaXMgcGFzc2VkLFxuICogYXR0cmlidXRlcyB3aXRoIGdpdmVuIGtleSB3aWxsIGJlIGNvbnZlcnRlZC4gSWYgYW4gYE9iamVjdGAgaXMgcGFzc2VkLCBpdCBtdXN0IGhhdmUgYSByZXF1aXJlZCBga2V5YCBwcm9wZXJ0eSxcbiAqIHNwZWNpZnlpbmcgdmlldyBhdHRyaWJ1dGUga2V5LCBhbmQgbWF5IGhhdmUgYW4gb3B0aW9uYWwgYHZhbHVlYCBwcm9wZXJ0eSwgc3BlY2lmeWluZyB2aWV3IGF0dHJpYnV0ZSB2YWx1ZSBhbmQgb3B0aW9uYWwgYG5hbWVgXG4gKiBwcm9wZXJ0eSBzcGVjaWZ5aW5nIGEgdmlldyBlbGVtZW50IG5hbWUgZnJvbS9vbiB3aGljaCB0aGUgYXR0cmlidXRlIHNob3VsZCBiZSBjb252ZXJ0ZWQuIGB2YWx1ZWAgY2FuIGJlIGdpdmVuIGFzIGEgYFN0cmluZ2AsXG4gKiBhIGBSZWdFeHBgIG9yIGEgZnVuY3Rpb24gY2FsbGJhY2ssIHRoYXQgdGFrZXMgdmlldyBhdHRyaWJ1dGUgdmFsdWUgYXMgdGhlIG9ubHkgcGFyYW1ldGVyIGFuZCByZXR1cm5zIGBCb29sZWFuYC5cbiAqIEBwYXJhbSBjb25maWcubW9kZWwgTW9kZWwgYXR0cmlidXRlIGtleSBvciBhbiBvYmplY3Qgd2l0aCBga2V5YCBhbmQgYHZhbHVlYCBwcm9wZXJ0aWVzLCBkZXNjcmliaW5nXG4gKiB0aGUgbW9kZWwgYXR0cmlidXRlLiBgdmFsdWVgIHByb3BlcnR5IG1heSBiZSBzZXQgYXMgYSBmdW5jdGlvbiB0aGF0IHRha2VzIGEgdmlldyBlbGVtZW50IGFuZCByZXR1cm5zIHRoZSB2YWx1ZS5cbiAqIElmIGBTdHJpbmdgIGlzIGdpdmVuLCB0aGUgbW9kZWwgYXR0cmlidXRlIHZhbHVlIHdpbGwgYmUgc2FtZSBhcyB2aWV3IGF0dHJpYnV0ZSB2YWx1ZS5cbiAqIEBwYXJhbSBjb25maWcuY29udmVydGVyUHJpb3JpdHkgQ29udmVydGVyIHByaW9yaXR5LiBEZWZhdWx0cyB0byBgbG93YC5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIHVwY2FzdEF0dHJpYnV0ZVRvQXR0cmlidXRlKGNvbmZpZykge1xuICAgIGNvbmZpZyA9IGNsb25lRGVlcChjb25maWcpO1xuICAgIGxldCB2aWV3S2V5ID0gbnVsbDtcbiAgICBpZiAodHlwZW9mIGNvbmZpZy52aWV3ID09ICdzdHJpbmcnIHx8IGNvbmZpZy52aWV3LmtleSkge1xuICAgICAgICB2aWV3S2V5ID0gbm9ybWFsaXplVmlld0F0dHJpYnV0ZUtleVZhbHVlQ29uZmlnKGNvbmZpZyk7XG4gICAgfVxuICAgIG5vcm1hbGl6ZU1vZGVsQXR0cmlidXRlQ29uZmlnKGNvbmZpZywgdmlld0tleSk7XG4gICAgY29uc3QgY29udmVydGVyID0gcHJlcGFyZVRvQXR0cmlidXRlQ29udmVydGVyKGNvbmZpZywgdHJ1ZSk7XG4gICAgcmV0dXJuIChkaXNwYXRjaGVyKT0+e1xuICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50JywgY29udmVydGVyLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdsb3cnXG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIFZpZXcgZWxlbWVudCB0byBtb2RlbCBtYXJrZXIgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+VXBjYXN0SGVscGVycyNlbGVtZW50VG9NYXJrZXIgYC5lbGVtZW50VG9NYXJrZXIoKWAgdXBjYXN0IGhlbHBlcn0gZm9yIGV4YW1wbGVzLlxuICpcbiAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIGNvbmZpZy52aWV3IFBhdHRlcm4gbWF0Y2hpbmcgYWxsIHZpZXcgZWxlbWVudHMgd2hpY2ggc2hvdWxkIGJlIGNvbnZlcnRlZC5cbiAqIEBwYXJhbSBjb25maWcubW9kZWwgTmFtZSBvZiB0aGUgbW9kZWwgbWFya2VyLCBvciBhIGZ1bmN0aW9uIHRoYXQgdGFrZXMgYSB2aWV3IGVsZW1lbnQgYW5kIHJldHVybnNcbiAqIGEgbW9kZWwgbWFya2VyIG5hbWUuXG4gKiBAcGFyYW0gY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IENvbnZlcnRlciBwcmlvcml0eS5cbiAqIEByZXR1cm5zIENvbnZlcnNpb24gaGVscGVyLlxuICovIGZ1bmN0aW9uIHVwY2FzdEVsZW1lbnRUb01hcmtlcihjb25maWcpIHtcbiAgICBjb25zdCBtb2RlbCA9IG5vcm1hbGl6ZUVsZW1lbnRUb01hcmtlck1vZGVsQ29uZmlnKGNvbmZpZy5tb2RlbCk7XG4gICAgcmV0dXJuIHVwY2FzdEVsZW1lbnRUb0VsZW1lbnQoe1xuICAgICAgICAuLi5jb25maWcsXG4gICAgICAgIG1vZGVsXG4gICAgfSk7XG59XG4vKipcbiAqIFZpZXcgZGF0YSB0byBtb2RlbCBtYXJrZXIgY29udmVyc2lvbiBoZWxwZXIuXG4gKlxuICogU2VlIHtAbGluayB+VXBjYXN0SGVscGVycyNkYXRhVG9NYXJrZXJ9IHRvIGxlYXJuIG1vcmUuXG4gKlxuICogQHJldHVybnMgQ29udmVyc2lvbiBoZWxwZXIuXG4gKi8gZnVuY3Rpb24gdXBjYXN0RGF0YVRvTWFya2VyKGNvbmZpZykge1xuICAgIGNvbmZpZyA9IGNsb25lRGVlcChjb25maWcpO1xuICAgIC8vIERlZmF1bHQgY29udmVyc2lvbi5cbiAgICBpZiAoIWNvbmZpZy5tb2RlbCkge1xuICAgICAgICBjb25maWcubW9kZWwgPSAobmFtZSk9PntcbiAgICAgICAgICAgIHJldHVybiBuYW1lID8gY29uZmlnLnZpZXcgKyAnOicgKyBuYW1lIDogY29uZmlnLnZpZXc7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRDb25maWcgPSB7XG4gICAgICAgIHZpZXc6IGNvbmZpZy52aWV3LFxuICAgICAgICBtb2RlbDogY29uZmlnLm1vZGVsXG4gICAgfTtcbiAgICBjb25zdCBjb252ZXJ0ZXJTdGFydCA9IHByZXBhcmVUb0VsZW1lbnRDb252ZXJ0ZXIobm9ybWFsaXplRGF0YVRvTWFya2VyQ29uZmlnKG5vcm1hbGl6ZWRDb25maWcsICdzdGFydCcpKTtcbiAgICBjb25zdCBjb252ZXJ0ZXJFbmQgPSBwcmVwYXJlVG9FbGVtZW50Q29udmVydGVyKG5vcm1hbGl6ZURhdGFUb01hcmtlckNvbmZpZyhub3JtYWxpemVkQ29uZmlnLCAnZW5kJykpO1xuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZGlzcGF0Y2hlci5vbihgZWxlbWVudDoke2NvbmZpZy52aWV3fS1zdGFydGAsIGNvbnZlcnRlclN0YXJ0LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogY29uZmlnLmNvbnZlcnRlclByaW9yaXR5IHx8ICdub3JtYWwnXG4gICAgICAgIH0pO1xuICAgICAgICBkaXNwYXRjaGVyLm9uKGBlbGVtZW50OiR7Y29uZmlnLnZpZXd9LWVuZGAsIGNvbnZlcnRlckVuZCwge1xuICAgICAgICAgICAgcHJpb3JpdHk6IGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSB8fCAnbm9ybWFsJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQmVsb3cgaXMgYSBoYWNrIHRoYXQgaXMgbmVlZGVkIHRvIHByb3Blcmx5IGhhbmRsZSBgY29udmVydGVyUHJpb3JpdHlgIGZvciBib3RoIGVsZW1lbnRzIGFuZCBhdHRyaWJ1dGVzLlxuICAgICAgICAvLyBBdHRyaWJ1dGUgY29udmVyc2lvbiBuZWVkcyB0byBiZSBwZXJmb3JtZWQgKmFmdGVyKiBlbGVtZW50IGNvbnZlcnNpb24uXG4gICAgICAgIC8vIFRoaXMgY29udmVydGVyIGhhbmRsZXMgYm90aCBlbGVtZW50IGNvbnZlcnNpb24gYW5kIGF0dHJpYnV0ZSBjb252ZXJzaW9uLCB3aGljaCBtZWFucyB0aGF0IGlmIGEgc2luZ2xlXG4gICAgICAgIC8vIGBjb25maWcuY29udmVydGVyUHJpb3JpdHlgIGlzIHVzZWQsIGl0IHdpbGwgbGVhZCB0byBwcm9ibGVtcy4gRm9yIGV4YW1wbGUsIGlmIHRoZSBgJ2hpZ2gnYCBwcmlvcml0eSBpcyB1c2VkLFxuICAgICAgICAvLyB0aGUgYXR0cmlidXRlIGNvbnZlcnNpb24gd2lsbCBiZSBwZXJmb3JtZWQgYmVmb3JlIGEgbG90IG9mIGVsZW1lbnQgdXBjYXN0IGNvbnZlcnRlcnMuXG4gICAgICAgIC8vIE9uIHRoZSBvdGhlciBoYW5kLCB3ZSB3YW50IHRvIHN1cHBvcnQgYGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eWAgYW5kIGNvbnZlcnRlciBvdmVyd3JpdGluZy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVG8gbWFrZSBpdCB3b3JrLCB3ZSBuZWVkIHRvIGRvIHNvbWUgZXh0cmEgcHJvY2Vzc2luZyBmb3IgcHJpb3JpdHkgZm9yIGF0dHJpYnV0ZSBjb252ZXJ0ZXIuXG4gICAgICAgIC8vIFByaW9yaXR5IGAnbG93J2AgdmFsdWUgc2hvdWxkIGJlIHRoZSBiYXNlIHZhbHVlIGFuZCB0aGVuIHdlIHdpbGwgY2hhbmdlIGl0IGRlcGVuZGluZyBvbiBgY29uZmlnLmNvbnZlcnRlclByaW9yaXR5YCB2YWx1ZS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhpcyBoYWNrIHByb2JhYmx5IHdvdWxkIG5vdCBiZSBuZWVkZWQgaWYgYXR0cmlidXRlcyBhcmUgdXBjYXN0ZWQgc2VwYXJhdGVseS5cbiAgICAgICAgLy9cbiAgICAgICAgY29uc3QgYmFzZVByaW9yaXR5ID0gcHJpb3JpdGllcy5sb3c7XG4gICAgICAgIGNvbnN0IG1heFByaW9yaXR5ID0gcHJpb3JpdGllcy5oaWdoZXN0O1xuICAgICAgICBjb25zdCBwcmlvcml0eUZhY3RvciA9IHByaW9yaXRpZXMuZ2V0KGNvbmZpZy5jb252ZXJ0ZXJQcmlvcml0eSkgLyBtYXhQcmlvcml0eTsgLy8gTnVtYmVyIGluIHJhbmdlIFsgLTEsIDEgXS5cbiAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudCcsIHVwY2FzdEF0dHJpYnV0ZVRvTWFya2VyKG5vcm1hbGl6ZWRDb25maWcpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogYmFzZVByaW9yaXR5ICsgcHJpb3JpdHlGYWN0b3JcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbi8qKlxuICogRnVuY3Rpb24gZmFjdG9yeSwgcmV0dXJucyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGNvbnZlcnRzIHZpZXcgYXR0cmlidXRlcyB0byBhIG1vZGVsIG1hcmtlci5cbiAqXG4gKiBUaGUgY29udmVydGVyIGxvb2tzIGZvciBlbGVtZW50cyB3aXRoIGBkYXRhLWdyb3VwLXN0YXJ0LWJlZm9yZWAsIGBkYXRhLWdyb3VwLXN0YXJ0LWFmdGVyYCwgYGRhdGEtZ3JvdXAtZW5kLWJlZm9yZWBcbiAqIGFuZCBgZGF0YS1ncm91cC1lbmQtYWZ0ZXJgIGF0dHJpYnV0ZXMgYW5kIGluc2VydHMgYCRtYXJrZXJgIG1vZGVsIGVsZW1lbnRzIGJlZm9yZS9hZnRlciB0aG9zZSBlbGVtZW50cy5cbiAqIGBncm91cGAgcGFydCBpcyBzcGVjaWZpZWQgaW4gYGNvbmZpZy52aWV3YC5cbiAqXG4gKiBAcmV0dXJucyBNYXJrZXIgY29udmVydGVyLlxuICovIGZ1bmN0aW9uIHVwY2FzdEF0dHJpYnV0ZVRvTWFya2VyKGNvbmZpZykge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCBhdHRyTmFtZSA9IGBkYXRhLSR7Y29uZmlnLnZpZXd9YDtcbiAgICAgICAgLy8gQ2hlY2sgaWYgYW55IGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIHZpZXcgaXRlbSBjYW4gYmUgY29uc3VtZWQgYmVmb3JlIGNoYW5naW5nIHRoZSBjb252ZXJzaW9uIGRhdGFcbiAgICAgICAgLy8gYW5kIGNvbnN1bWluZyB2aWV3IGl0ZW1zIHdpdGggdGhlc2UgYXR0cmlidXRlcy5cbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdChkYXRhLnZpZXdJdGVtLCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyTmFtZSArICctZW5kLWFmdGVyJ1xuICAgICAgICB9KSAmJiAhY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3QoZGF0YS52aWV3SXRlbSwge1xuICAgICAgICAgICAgYXR0cmlidXRlczogYXR0ck5hbWUgKyAnLXN0YXJ0LWFmdGVyJ1xuICAgICAgICB9KSAmJiAhY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3QoZGF0YS52aWV3SXRlbSwge1xuICAgICAgICAgICAgYXR0cmlidXRlczogYXR0ck5hbWUgKyAnLWVuZC1iZWZvcmUnXG4gICAgICAgIH0pICYmICFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdChkYXRhLnZpZXdJdGVtLCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyTmFtZSArICctc3RhcnQtYmVmb3JlJ1xuICAgICAgICB9KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoaXMgY29udmVydGVyIHdhbnRzIHRvIGFkZCBhIG1vZGVsIGVsZW1lbnQsIG1hcmtpbmcgYSBtYXJrZXIsIGJlZm9yZS9hZnRlciBhbiBlbGVtZW50IChvciBtYXliZSBldmVuIGdyb3VwIG9mIGVsZW1lbnRzKS5cbiAgICAgICAgLy8gVG8gZG8gdGhhdCwgd2UgY2FuIHVzZSBgZGF0YS5tb2RlbFJhbmdlYCB3aGljaCBpcyBzZXQgb24gYW4gZWxlbWVudCAob3IgYSBncm91cCBvZiBlbGVtZW50cykgdGhhdCBoYXMgYmVlbiB1cGNhc3RlZC5cbiAgICAgICAgLy8gQnV0LCBpZiB0aGUgcHJvY2Vzc2VkIHZpZXcgZWxlbWVudCBoYXMgbm90IGJlZW4gdXBjYXN0ZWQgeWV0IChpdCBkb2VzIG5vdCBoYXZlIGJlZW4gY29udmVydGVkKSwgd2UgbmVlZCB0b1xuICAgICAgICAvLyBmaXJlIGNvbnZlcnNpb24gZm9yIGl0cyBjaGlsZHJlbiBmaXJzdCwgdGhlbiB3ZSB3aWxsIGhhdmUgYGRhdGEubW9kZWxSYW5nZWAgYXZhaWxhYmxlLlxuICAgICAgICBpZiAoIWRhdGEubW9kZWxSYW5nZSkge1xuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihkYXRhLCBjb252ZXJzaW9uQXBpLmNvbnZlcnRDaGlsZHJlbihkYXRhLnZpZXdJdGVtLCBkYXRhLm1vZGVsQ3Vyc29yKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKGRhdGEudmlld0l0ZW0sIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJOYW1lICsgJy1lbmQtYWZ0ZXInXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgICBhZGRNYXJrZXJFbGVtZW50cyhkYXRhLm1vZGVsUmFuZ2UuZW5kLCBkYXRhLnZpZXdJdGVtLmdldEF0dHJpYnV0ZShhdHRyTmFtZSArICctZW5kLWFmdGVyJykuc3BsaXQoJywnKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKGRhdGEudmlld0l0ZW0sIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJOYW1lICsgJy1zdGFydC1hZnRlcidcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIGFkZE1hcmtlckVsZW1lbnRzKGRhdGEubW9kZWxSYW5nZS5lbmQsIGRhdGEudmlld0l0ZW0uZ2V0QXR0cmlidXRlKGF0dHJOYW1lICsgJy1zdGFydC1hZnRlcicpLnNwbGl0KCcsJykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLnZpZXdJdGVtLCB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyTmFtZSArICctZW5kLWJlZm9yZSdcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIGFkZE1hcmtlckVsZW1lbnRzKGRhdGEubW9kZWxSYW5nZS5zdGFydCwgZGF0YS52aWV3SXRlbS5nZXRBdHRyaWJ1dGUoYXR0ck5hbWUgKyAnLWVuZC1iZWZvcmUnKS5zcGxpdCgnLCcpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS52aWV3SXRlbSwge1xuICAgICAgICAgICAgYXR0cmlidXRlczogYXR0ck5hbWUgKyAnLXN0YXJ0LWJlZm9yZSdcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIGFkZE1hcmtlckVsZW1lbnRzKGRhdGEubW9kZWxSYW5nZS5zdGFydCwgZGF0YS52aWV3SXRlbS5nZXRBdHRyaWJ1dGUoYXR0ck5hbWUgKyAnLXN0YXJ0LWJlZm9yZScpLnNwbGl0KCcsJykpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGFkZE1hcmtlckVsZW1lbnRzKHBvc2l0aW9uLCBtYXJrZXJWaWV3TmFtZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbWFya2VyVmlld05hbWUgb2YgbWFya2VyVmlld05hbWVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXJOYW1lID0gY29uZmlnLm1vZGVsKG1hcmtlclZpZXdOYW1lLCBjb252ZXJzaW9uQXBpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlRWxlbWVudCgnJG1hcmtlcicsIHtcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGEtbmFtZSc6IG1hcmtlck5hbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQoZWxlbWVudCwgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLm1vZGVsQ3Vyc29yLmlzRXF1YWwocG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEubW9kZWxDdXJzb3IgPSBkYXRhLm1vZGVsQ3Vyc29yLmdldFNoaWZ0ZWRCeSgxKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLm1vZGVsQ3Vyc29yID0gZGF0YS5tb2RlbEN1cnNvci5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihwb3NpdGlvbiwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEubW9kZWxSYW5nZSA9IGRhdGEubW9kZWxSYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihwb3NpdGlvbiwgMSlbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGZyb20tdmlldy1lbGVtZW50IGNvbnZlcnNpb24uIENoZWNrcyBpZiBgY29uZmlnLnZpZXdgIGRpcmVjdGx5IHNwZWNpZmllcyBjb252ZXJ0ZWQgdmlldyBlbGVtZW50J3MgbmFtZVxuICogYW5kIGlmIHNvLCByZXR1cm5zIGl0LlxuICpcbiAqIEBwYXJhbSBjb25maWcgQ29udmVyc2lvbiB2aWV3IGNvbmZpZy5cbiAqIEByZXR1cm5zIFZpZXcgZWxlbWVudCBuYW1lIG9yIGBudWxsYCBpZiBuYW1lIGlzIG5vdCBkaXJlY3RseSBzZXQuXG4gKi8gZnVuY3Rpb24gZ2V0Vmlld0VsZW1lbnROYW1lRnJvbUNvbmZpZyh2aWV3Q29uZmlnKSB7XG4gICAgaWYgKHR5cGVvZiB2aWV3Q29uZmlnID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiB2aWV3Q29uZmlnO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZpZXdDb25maWcgPT0gJ29iamVjdCcgJiYgdHlwZW9mIHZpZXdDb25maWcubmFtZSA9PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gdmlld0NvbmZpZy5uYW1lO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogSGVscGVyIGZvciB0by1tb2RlbC1lbGVtZW50IGNvbnZlcnNpb24uIFRha2VzIGEgY29uZmlnIG9iamVjdCBhbmQgcmV0dXJucyBhIHByb3BlciBjb252ZXJ0ZXIgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uXG4gKiBAcmV0dXJucyBWaWV3IHRvIG1vZGVsIGNvbnZlcnRlci5cbiAqLyBmdW5jdGlvbiBwcmVwYXJlVG9FbGVtZW50Q29udmVydGVyKGNvbmZpZykge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBuZXcgTWF0Y2hlcihjb25maWcudmlldyk7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IG1hdGNoZXJSZXN1bHQgPSBtYXRjaGVyLm1hdGNoKGRhdGEudmlld0l0ZW0pO1xuICAgICAgICBpZiAoIW1hdGNoZXJSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXRjaCA9IG1hdGNoZXJSZXN1bHQubWF0Y2g7XG4gICAgICAgIC8vIEZvcmNlIGNvbnN1bWluZyBlbGVtZW50J3MgbmFtZS5cbiAgICAgICAgbWF0Y2gubmFtZSA9IHRydWU7XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3QoZGF0YS52aWV3SXRlbSwgbWF0Y2gpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZWxFbGVtZW50ID0gZ2V0TW9kZWxFbGVtZW50KGNvbmZpZy5tb2RlbCwgZGF0YS52aWV3SXRlbSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGlmICghbW9kZWxFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLnNhZmVJbnNlcnQobW9kZWxFbGVtZW50LCBkYXRhLm1vZGVsQ3Vyc29yKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKGRhdGEudmlld0l0ZW0sIG1hdGNoKTtcbiAgICAgICAgY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS52aWV3SXRlbSwgbW9kZWxFbGVtZW50KTtcbiAgICAgICAgY29udmVyc2lvbkFwaS51cGRhdGVDb252ZXJzaW9uUmVzdWx0KG1vZGVsRWxlbWVudCwgZGF0YSk7XG4gICAgfTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciB1cGNhc3RpbmctdG8tZWxlbWVudCBjb252ZXJ0ZXIuIFRha2VzIHRoZSBtb2RlbCBjb25maWd1cmF0aW9uLCB0aGUgY29udmVydGVkIHZpZXcgZWxlbWVudFxuICogYW5kIGEgd3JpdGVyIGluc3RhbmNlIGFuZCByZXR1cm5zIGEgbW9kZWwgZWxlbWVudCBpbnN0YW5jZSB0byBiZSBpbnNlcnRlZCBpbiB0aGUgbW9kZWwuXG4gKlxuICogQHBhcmFtIG1vZGVsIE1vZGVsIGNvbnZlcnNpb24gY29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSBpbnB1dCBUaGUgY29udmVydGVkIHZpZXcgbm9kZS5cbiAqIEBwYXJhbSBjb252ZXJzaW9uQXBpIFRoZSB1cGNhc3QgY29udmVyc2lvbiBBUEkuXG4gKi8gZnVuY3Rpb24gZ2V0TW9kZWxFbGVtZW50KG1vZGVsLCBpbnB1dCwgY29udmVyc2lvbkFwaSkge1xuICAgIGlmIChtb2RlbCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICAgIHJldHVybiBtb2RlbChpbnB1dCwgY29udmVyc2lvbkFwaSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZUVsZW1lbnQobW9kZWwpO1xuICAgIH1cbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHZpZXctYXR0cmlidXRlLXRvLW1vZGVsLWF0dHJpYnV0ZSBoZWxwZXIuIE5vcm1hbGl6ZXMgYGNvbmZpZy52aWV3YCB3aGljaCB3YXMgc2V0IGFzIGBTdHJpbmdgIG9yXG4gKiBhcyBhbiBgT2JqZWN0YCB3aXRoIGBrZXlgLCBgdmFsdWVgIGFuZCBgbmFtZWAgcHJvcGVydGllcy4gTm9ybWFsaXplZCBgY29uZmlnLnZpZXdgIGhhcyBpcyBjb21wYXRpYmxlIHdpdGhcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvbWF0Y2hlcn5NYXRjaGVyUGF0dGVybn0uXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZy5cbiAqIEByZXR1cm5zIEtleSBvZiB0aGUgY29udmVydGVkIHZpZXcgYXR0cmlidXRlLlxuICovIGZ1bmN0aW9uIG5vcm1hbGl6ZVZpZXdBdHRyaWJ1dGVLZXlWYWx1ZUNvbmZpZyhjb25maWcpIHtcbiAgICBpZiAodHlwZW9mIGNvbmZpZy52aWV3ID09ICdzdHJpbmcnKSB7XG4gICAgICAgIGNvbmZpZy52aWV3ID0ge1xuICAgICAgICAgICAga2V5OiBjb25maWcudmlld1xuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBrZXkgPSBjb25maWcudmlldy5rZXk7XG4gICAgY29uc3QgdmFsdWUgPSB0eXBlb2YgY29uZmlnLnZpZXcudmFsdWUgPT0gJ3VuZGVmaW5lZCcgPyAvW1xcc1xcU10qLyA6IGNvbmZpZy52aWV3LnZhbHVlO1xuICAgIGxldCBub3JtYWxpemVkO1xuICAgIGlmIChrZXkgPT0gJ2NsYXNzJyB8fCBrZXkgPT0gJ3N0eWxlJykge1xuICAgICAgICBjb25zdCBrZXlOYW1lID0ga2V5ID09ICdjbGFzcycgPyAnY2xhc3NlcycgOiAnc3R5bGVzJztcbiAgICAgICAgbm9ybWFsaXplZCA9IHtcbiAgICAgICAgICAgIFtrZXlOYW1lXTogdmFsdWVcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBub3JtYWxpemVkID0ge1xuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgIFtrZXldOiB2YWx1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBpZiAoY29uZmlnLnZpZXcubmFtZSkge1xuICAgICAgICBub3JtYWxpemVkLm5hbWUgPSBjb25maWcudmlldy5uYW1lO1xuICAgIH1cbiAgICBjb25maWcudmlldyA9IG5vcm1hbGl6ZWQ7XG4gICAgcmV0dXJuIGtleTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgbm9ybWFsaXplcyBgY29uZmlnLm1vZGVsYCBpbiBmcm9tLW1vZGVsLWF0dHJpYnV0ZSBjb252ZXJzaW9uLiBgY29uZmlnLm1vZGVsYCBjYW4gYmUgc2V0XG4gKiBhcyBhIGBTdHJpbmdgLCBhbiBgT2JqZWN0YCB3aXRoIG9ubHkgYGtleWAgcHJvcGVydHkgb3IgYW4gYE9iamVjdGAgd2l0aCBga2V5YCBhbmQgYHZhbHVlYCBwcm9wZXJ0aWVzLiBOb3JtYWxpemVkXG4gKiBgY29uZmlnLm1vZGVsYCBpcyBhbiBgT2JqZWN0YCB3aXRoIGBrZXlgIGFuZCBgdmFsdWVgIHByb3BlcnRpZXMuXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZy5cbiAqIEBwYXJhbSB2aWV3QXR0cmlidXRlS2V5VG9Db3B5IEtleSBvZiB0aGUgY29udmVydGVkIHZpZXcgYXR0cmlidXRlLiBJZiBpdCBpcyBzZXQsIG1vZGVsIGF0dHJpYnV0ZSB2YWx1ZVxuICogd2lsbCBiZSBlcXVhbCB0byB2aWV3IGF0dHJpYnV0ZSB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVNb2RlbEF0dHJpYnV0ZUNvbmZpZyhjb25maWcsIHZpZXdBdHRyaWJ1dGVLZXlUb0NvcHkgPSBudWxsKSB7XG4gICAgY29uc3QgZGVmYXVsdE1vZGVsVmFsdWUgPSB2aWV3QXR0cmlidXRlS2V5VG9Db3B5ID09PSBudWxsID8gdHJ1ZSA6ICh2aWV3RWxlbWVudCk9PnZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZSh2aWV3QXR0cmlidXRlS2V5VG9Db3B5KTtcbiAgICBjb25zdCBrZXkgPSB0eXBlb2YgY29uZmlnLm1vZGVsICE9ICdvYmplY3QnID8gY29uZmlnLm1vZGVsIDogY29uZmlnLm1vZGVsLmtleTtcbiAgICBjb25zdCB2YWx1ZSA9IHR5cGVvZiBjb25maWcubW9kZWwgIT0gJ29iamVjdCcgfHwgdHlwZW9mIGNvbmZpZy5tb2RlbC52YWx1ZSA9PSAndW5kZWZpbmVkJyA/IGRlZmF1bHRNb2RlbFZhbHVlIDogY29uZmlnLm1vZGVsLnZhbHVlO1xuICAgIGNvbmZpZy5tb2RlbCA9IHtcbiAgICAgICAga2V5LFxuICAgICAgICB2YWx1ZVxuICAgIH07XG59XG4vKipcbiAqIEhlbHBlciBmb3IgdG8tbW9kZWwtYXR0cmlidXRlIGNvbnZlcnNpb24uIFRha2VzIHRoZSBtb2RlbCBhdHRyaWJ1dGUgbmFtZSBhbmQgY29udmVyc2lvbiBjb25maWd1cmF0aW9uIGFuZCByZXR1cm5zXG4gKiBhIHByb3BlciBjb252ZXJ0ZXIgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIGNvbmZpZyBDb252ZXJzaW9uIGNvbmZpZ3VyYXRpb24uIEl0IGlzIHBvc3NpYmxlIHRvIHByb3ZpZGUgbXVsdGlwbGUgY29uZmlndXJhdGlvbnMgaW4gYW4gYXJyYXkuXG4gKiBAcGFyYW0gc2hhbGxvdyBJZiBzZXQgdG8gYHRydWVgIHRoZSBhdHRyaWJ1dGUgd2lsbCBiZSBzZXQgb25seSBvbiB0b3AtbGV2ZWwgbm9kZXMuIE90aGVyd2lzZSwgaXQgd2lsbCBiZSBzZXRcbiAqIG9uIGFsbCBlbGVtZW50cyBpbiB0aGUgcmFuZ2UuXG4gKi8gZnVuY3Rpb24gcHJlcGFyZVRvQXR0cmlidXRlQ29udmVydGVyKGNvbmZpZywgc2hhbGxvdykge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBuZXcgTWF0Y2hlcihjb25maWcudmlldyk7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIC8vIENvbnZlcnRpbmcgYW4gYXR0cmlidXRlIG9mIGFuIGVsZW1lbnQgdGhhdCBoYXMgbm90IGJlZW4gY29udmVydGVkIHRvIGFueXRoaW5nIGRvZXMgbm90IG1ha2Ugc2Vuc2VcbiAgICAgICAgLy8gYmVjYXVzZSB0aGVyZSB3aWxsIGJlIG5vd2hlcmUgdG8gc2V0IHRoYXQgYXR0cmlidXRlIG9uLiBBdCB0aGlzIHN0YWdlLCB0aGUgZWxlbWVudCBzaG91bGQndmUgYWxyZWFkeVxuICAgICAgICAvLyBiZWVuIGNvbnZlcnRlZCAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTEwMDApLlxuICAgICAgICBpZiAoIWRhdGEubW9kZWxSYW5nZSAmJiBzaGFsbG93KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWF0Y2ggPSBtYXRjaGVyLm1hdGNoKGRhdGEudmlld0l0ZW0pO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBtYXRjaCwgdGhpcyBjYWxsYmFjayBzaG91bGQgbm90IGRvIGFueXRoaW5nLlxuICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9ubHlWaWV3TmFtZUlzRGVmaW5lZChjb25maWcudmlldywgZGF0YS52aWV3SXRlbSkpIHtcbiAgICAgICAgICAgIG1hdGNoLm1hdGNoLm5hbWUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gRG8gbm90IHRlc3QgYG5hbWVgIGNvbnN1bWFibGUgYmVjYXVzZSBpdCBjb3VsZCBnZXQgY29uc3VtZWQgYWxyZWFkeSB3aGlsZSB1cGNhc3Rpbmcgc29tZSBvdGhlciBhdHRyaWJ1dGVcbiAgICAgICAgICAgIC8vIG9uIHRoZSBzYW1lIGVsZW1lbnQgKGZvciBleGFtcGxlIDxzcGFuIGNsYXNzPVwiYmlnXCIgc3R5bGU9XCJjb2xvcjogcmVkXCI+Zm9vPC9zcGFuPikuXG4gICAgICAgICAgICBkZWxldGUgbWF0Y2gubWF0Y2gubmFtZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUcnkgdG8gY29uc3VtZSBhcHByb3ByaWF0ZSB2YWx1ZXMgZnJvbSBjb25zdW1hYmxlIHZhbHVlcyBsaXN0LlxuICAgICAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGRhdGEudmlld0l0ZW0sIG1hdGNoLm1hdGNoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vZGVsS2V5ID0gY29uZmlnLm1vZGVsLmtleTtcbiAgICAgICAgY29uc3QgbW9kZWxWYWx1ZSA9IHR5cGVvZiBjb25maWcubW9kZWwudmFsdWUgPT0gJ2Z1bmN0aW9uJyA/IGNvbmZpZy5tb2RlbC52YWx1ZShkYXRhLnZpZXdJdGVtLCBjb252ZXJzaW9uQXBpKSA6IGNvbmZpZy5tb2RlbC52YWx1ZTtcbiAgICAgICAgLy8gRG8gbm90IGNvbnZlcnQgaWYgYXR0cmlidXRlIGJ1aWxkaW5nIGZ1bmN0aW9uIHJldHVybmVkIGZhbHN5IHZhbHVlLlxuICAgICAgICBpZiAobW9kZWxWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNpbmNlIHdlIGFyZSBjb252ZXJ0aW5nIHRvIGF0dHJpYnV0ZSB3ZSBuZWVkIGEgcmFuZ2Ugb24gd2hpY2ggd2Ugd2lsbCBzZXQgdGhlIGF0dHJpYnV0ZS5cbiAgICAgICAgLy8gSWYgdGhlIHJhbmdlIGlzIG5vdCBjcmVhdGVkIHlldCwgbGV0J3MgY3JlYXRlIGl0IGJ5IGNvbnZlcnRpbmcgY2hpbGRyZW4gb2YgdGhlIGN1cnJlbnQgbm9kZSBmaXJzdC5cbiAgICAgICAgaWYgKCFkYXRhLm1vZGVsUmFuZ2UpIHtcbiAgICAgICAgICAgIC8vIENvbnZlcnQgY2hpbGRyZW4gYW5kIHNldCBjb252ZXJzaW9uIHJlc3VsdCBhcyBhIGN1cnJlbnQgZGF0YS5cbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS52aWV3SXRlbSwgZGF0YS5tb2RlbEN1cnNvcikpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNldCBhdHRyaWJ1dGUgb24gY3VycmVudCBgb3V0cHV0YC4gYFNjaGVtYWAgaXMgY2hlY2tlZCBpbnNpZGUgdGhpcyBoZWxwZXIgZnVuY3Rpb24uXG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZVdhc1NldCA9IHNldEF0dHJpYnV0ZU9uKGRhdGEubW9kZWxSYW5nZSwge1xuICAgICAgICAgICAga2V5OiBtb2RlbEtleSxcbiAgICAgICAgICAgIHZhbHVlOiBtb2RlbFZhbHVlXG4gICAgICAgIH0sIHNoYWxsb3csIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAvLyBJdCBtYXkgaGFwcGVuIHRoYXQgYSBjb252ZXJ0ZXIgd2lsbCB0cnkgdG8gc2V0IGFuIGF0dHJpYnV0ZSB0aGF0IGlzIG5vdCBhbGxvd2VkIGluIHRoZSBnaXZlbiBjb250ZXh0LlxuICAgICAgICAvLyBJbiBzdWNoIGEgc2l0dWF0aW9uIHdlIGNhbm5vdCBjb25zdW1lIHRoZSBhdHRyaWJ1dGUuIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9wdWxsLzkyNDkjaXNzdWVjb21tZW50LTgxNTY1ODQ1OS5cbiAgICAgICAgaWYgKGF0dHJpYnV0ZVdhc1NldCkge1xuICAgICAgICAgICAgLy8gVmVyaWZ5IGlmIHRoZSBlbGVtZW50IGl0c2VsZiB3YXNuJ3QgY29uc3VtZWQgeWV0LiBJdCBjb3VsZCBiZSBjb25zdW1lZCBhbHJlYWR5IHdoaWxlIHVwY2FzdGluZyBzb21lIG90aGVyIGF0dHJpYnV0ZVxuICAgICAgICAgICAgLy8gb24gdGhlIHNhbWUgZWxlbWVudCAoZm9yIGV4YW1wbGUgPHNwYW4gY2xhc3M9XCJiaWdcIiBzdHlsZT1cImNvbG9yOiByZWRcIj5mb288L3NwYW4+KS5cbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY29uc3VtZSBpdCBzbyBvdGhlciBmZWF0dXJlcyAoZXNwZWNpYWxseSBHSFMpIHdvbid0IHRyeSB0byBjb252ZXJ0IGl0LlxuICAgICAgICAgICAgLy8gTm90ZSB0aGF0IGl0J3Mgbm90IHRlc3RlZCBieSB0aGUgb3RoZXIgZWxlbWVudC10by1hdHRyaWJ1dGUgY29udmVydGVycyB3aGV0aGVyIGFuIGVsZW1lbnQgd2FzIGNvbnN1bWVkIGJlZm9yZVxuICAgICAgICAgICAgLy8gKGluIGNhc2Ugb2YgY29udmVydGVycyB0aGF0IHRoZSBlbGVtZW50IGl0c2VsZiBpcyBqdXN0IGEgY29udGV4dCBhbmQgbm90IHRoZSBwcmltYXJ5IGluZm9ybWF0aW9uIHRvIGNvbnZlcnQpLlxuICAgICAgICAgICAgaWYgKGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGRhdGEudmlld0l0ZW0sIHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0cnVlXG4gICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgICAgIG1hdGNoLm1hdGNoLm5hbWUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS52aWV3SXRlbSwgbWF0Y2gubWF0Y2gpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmIGVsZW1lbnQgbmFtZSBzaG91bGQgYmUgY29uc3VtZWQgaW4gYXR0cmlidXRlIGNvbnZlcnRlcnMuXG4gKlxuICogQHBhcmFtIHZpZXdDb25maWcgQ29udmVyc2lvbiB2aWV3IGNvbmZpZy5cbiAqLyBmdW5jdGlvbiBvbmx5Vmlld05hbWVJc0RlZmluZWQodmlld0NvbmZpZywgdmlld0l0ZW0pIHtcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LWVuZ2luZS9pc3N1ZXMvMTc4NlxuICAgIGNvbnN0IGNvbmZpZ1RvVGVzdCA9IHR5cGVvZiB2aWV3Q29uZmlnID09ICdmdW5jdGlvbicgPyB2aWV3Q29uZmlnKHZpZXdJdGVtKSA6IHZpZXdDb25maWc7XG4gICAgaWYgKHR5cGVvZiBjb25maWdUb1Rlc3QgPT0gJ29iamVjdCcgJiYgIWdldFZpZXdFbGVtZW50TmFtZUZyb21Db25maWcoY29uZmlnVG9UZXN0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiAhY29uZmlnVG9UZXN0LmNsYXNzZXMgJiYgIWNvbmZpZ1RvVGVzdC5hdHRyaWJ1dGVzICYmICFjb25maWdUb1Rlc3Quc3R5bGVzO1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIHRvLW1vZGVsLWF0dHJpYnV0ZSBjb252ZXJ0ZXIuIFNldHMgbW9kZWwgYXR0cmlidXRlIG9uIGdpdmVuIHJhbmdlLiBDaGVja3Mge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYX1cbiAqIHRvIGVuc3VyZSBwcm9wZXIgbW9kZWwgc3RydWN0dXJlLlxuICpcbiAqIElmIGFueSBub2RlIG9uIHRoZSBnaXZlbiByYW5nZSBoYXMgYWxyZWFkeSBkZWZpbmVkIGFuIGF0dHJpYnV0ZSB3aXRoIHRoZSBzYW1lIG5hbWUsIGl0cyB2YWx1ZSB3aWxsIG5vdCBiZSB1cGRhdGVkLlxuICpcbiAqIEBwYXJhbSBtb2RlbFJhbmdlIE1vZGVsIHJhbmdlIG9uIHdoaWNoIGF0dHJpYnV0ZSBzaG91bGQgYmUgc2V0LlxuICogQHBhcmFtIG1vZGVsQXR0cmlidXRlIE1vZGVsIGF0dHJpYnV0ZSB0byBzZXQuXG4gKiBAcGFyYW0gY29udmVyc2lvbkFwaSBDb252ZXJzaW9uIEFQSS5cbiAqIEBwYXJhbSBzaGFsbG93IElmIHNldCB0byBgdHJ1ZWAgdGhlIGF0dHJpYnV0ZSB3aWxsIGJlIHNldCBvbmx5IG9uIHRvcC1sZXZlbCBub2Rlcy4gT3RoZXJ3aXNlLCBpdCB3aWxsIGJlIHNldFxuICogb24gYWxsIGVsZW1lbnRzIGluIHRoZSByYW5nZS5cbiAqIEByZXR1cm5zIGB0cnVlYCBpZiBhdHRyaWJ1dGUgd2FzIHNldCBvbiBhdCBsZWFzdCBvbmUgbm9kZSBmcm9tIGdpdmVuIGBtb2RlbFJhbmdlYC5cbiAqLyBmdW5jdGlvbiBzZXRBdHRyaWJ1dGVPbihtb2RlbFJhbmdlLCBtb2RlbEF0dHJpYnV0ZSwgc2hhbGxvdywgY29udmVyc2lvbkFwaSkge1xuICAgIGxldCByZXN1bHQgPSBmYWxzZTtcbiAgICAvLyBTZXQgYXR0cmlidXRlIG9uIGVhY2ggaXRlbSBpbiByYW5nZSBhY2NvcmRpbmcgdG8gU2NoZW1hLlxuICAgIGZvciAoY29uc3Qgbm9kZSBvZiBBcnJheS5mcm9tKG1vZGVsUmFuZ2UuZ2V0SXRlbXMoe1xuICAgICAgICBzaGFsbG93XG4gICAgfSkpKXtcbiAgICAgICAgLy8gU2tpcCBpZiBub3QgYWxsb3dlZC5cbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLnNjaGVtYS5jaGVja0F0dHJpYnV0ZShub2RlLCBtb2RlbEF0dHJpYnV0ZS5rZXkpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBNYXJrIHRoZSBub2RlIGFzIGNvbnN1bWVkIGV2ZW4gaWYgdGhlIGF0dHJpYnV0ZSB3aWxsIG5vdCBiZSB1cGRhdGVkIGJlY2F1c2UgaXQncyBpbiBhIHZhbGlkIGNvbnRleHQgKHNjaGVtYSlcbiAgICAgICAgLy8gYW5kIHdvdWxkIGJlIGNvbnZlcnRlZCBpZiB0aGUgYXR0cmlidXRlIHdvdWxkbid0IGJlIHByZXNlbnQuIFNlZSAjODkyMS5cbiAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgLy8gRG8gbm90IG92ZXJyaWRlIHRoZSBhdHRyaWJ1dGUgaWYgaXQncyBhbHJlYWR5IHByZXNlbnQuXG4gICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShtb2RlbEF0dHJpYnV0ZS5rZXkpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5zZXRBdHRyaWJ1dGUobW9kZWxBdHRyaWJ1dGUua2V5LCBtb2RlbEF0dHJpYnV0ZS52YWx1ZSwgbm9kZSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiBmb3IgdXBjYXN0aW5nLXRvLW1hcmtlciBjb252ZXJzaW9uLiBUYWtlcyB0aGUgY29uZmlnIGluIGEgZm9ybWF0IHJlcXVlc3RlZCBieSBgdXBjYXN0RWxlbWVudFRvTWFya2VyKClgXG4gKiBmdW5jdGlvbiBhbmQgY29udmVydHMgaXQgdG8gYSBmb3JtYXQgdGhhdCBpcyBzdXBwb3J0ZWQgYnkgYHVwY2FzdEVsZW1lbnRUb0VsZW1lbnQoKWAgZnVuY3Rpb24uXG4gKi8gZnVuY3Rpb24gbm9ybWFsaXplRWxlbWVudFRvTWFya2VyTW9kZWxDb25maWcobW9kZWwpIHtcbiAgICByZXR1cm4gKHZpZXdFbGVtZW50LCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCBtYXJrZXJOYW1lID0gdHlwZW9mIG1vZGVsID09ICdzdHJpbmcnID8gbW9kZWwgOiBtb2RlbCh2aWV3RWxlbWVudCwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIHJldHVybiBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVFbGVtZW50KCckbWFya2VyJywge1xuICAgICAgICAgICAgJ2RhdGEtbmFtZSc6IG1hcmtlck5hbWVcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciB1cGNhc3RpbmctdG8tbWFya2VyIGNvbnZlcnNpb24uIFRha2VzIHRoZSBjb25maWcgaW4gYSBmb3JtYXQgcmVxdWVzdGVkIGJ5IGB1cGNhc3REYXRhVG9NYXJrZXIoKWBcbiAqIGZ1bmN0aW9uIGFuZCBjb252ZXJ0cyBpdCB0byBhIGZvcm1hdCB0aGF0IGlzIHN1cHBvcnRlZCBieSBgdXBjYXN0RWxlbWVudFRvRWxlbWVudCgpYCBmdW5jdGlvbi5cbiAqLyBmdW5jdGlvbiBub3JtYWxpemVEYXRhVG9NYXJrZXJDb25maWcoY29uZmlnLCB0eXBlKSB7XG4gICAgY29uc3QgZWxlbWVudENyZWF0b3JGdW5jdGlvbiA9ICh2aWV3RWxlbWVudCwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3Qgdmlld05hbWUgPSB2aWV3RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKTtcbiAgICAgICAgY29uc3QgbWFya2VyTmFtZSA9IGNvbmZpZy5tb2RlbCh2aWV3TmFtZSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIHJldHVybiBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVFbGVtZW50KCckbWFya2VyJywge1xuICAgICAgICAgICAgJ2RhdGEtbmFtZSc6IG1hcmtlck5hbWVcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICAvLyBVcGNhc3QgPG1hcmtlckdyb3VwLXN0YXJ0PiBhbmQgPG1hcmtlckdyb3VwLWVuZD4gZWxlbWVudHMuXG4gICAgICAgIHZpZXc6IGAke2NvbmZpZy52aWV3fS0ke3R5cGV9YCxcbiAgICAgICAgbW9kZWw6IGVsZW1lbnRDcmVhdG9yRnVuY3Rpb25cbiAgICB9O1xufVxuXG4vKipcbiAqIEluamVjdHMgc2VsZWN0aW9uIHBvc3QtZml4ZXIgdG8gdGhlIG1vZGVsLlxuICpcbiAqIFRoZSByb2xlIG9mIHRoZSBzZWxlY3Rpb24gcG9zdC1maXhlciBpcyB0byBlbnN1cmUgdGhhdCB0aGUgc2VsZWN0aW9uIGlzIGluIGEgY29ycmVjdCBwbGFjZVxuICogYWZ0ZXIgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2UgYGNoYW5nZSgpYH0gYmxvY2sgd2FzIGV4ZWN1dGVkLlxuICpcbiAqIFRoZSBjb3JyZWN0IHBvc2l0aW9uIG1lYW5zIHRoYXQ6XG4gKlxuICogKiBBbGwgY29sbGFwc2VkIHNlbGVjdGlvbiByYW5nZXMgYXJlIGluIGEgcGxhY2Ugd2hlcmUgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9XG4gKiBhbGxvd3MgYSBgJHRleHRgLlxuICogKiBOb25lIG9mIHRoZSBzZWxlY3Rpb24ncyBub24tY29sbGFwc2VkIHJhbmdlcyBjcm9zc2VzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNpc0xpbWl0IGxpbWl0IGVsZW1lbnR9XG4gKiBib3VuZGFyeSAoYSByYW5nZSBtdXN0IGJlIHJvb3RlZCB3aXRoaW4gb25lIGxpbWl0IGVsZW1lbnQpLlxuICogKiBPbmx5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNTZWxlY3RhYmxlIHNlbGVjdGFibGUgZWxlbWVudHN9IGNhbiBiZSBzZWxlY3RlZCBmcm9tIHRoZSBvdXRzaWRlXG4gKiAoZS5nLiBgWzxwYXJhZ3JhcGg+Zm9vPC9wYXJhZ3JhcGg+XWAgaXMgaW52YWxpZCkuIFRoaXMgcnVsZSBhcHBsaWVzIGluZGVwZW5kZW50bHkgdG8gYm90aCBzZWxlY3Rpb24gZW5kcywgc28gdGhpc1xuICogc2VsZWN0aW9uIGlzIGNvcnJlY3Q6IGA8cGFyYWdyYXBoPmZbb288L3BhcmFncmFwaD48aW1hZ2VCbG9jaz48L2ltYWdlQmxvY2s+XWAuXG4gKlxuICogSWYgdGhlIHBvc2l0aW9uIGlzIG5vdCBjb3JyZWN0LCB0aGUgcG9zdC1maXhlciB3aWxsIGF1dG9tYXRpY2FsbHkgY29ycmVjdCBpdC5cbiAqXG4gKiAjIyBGaXhpbmcgYSBub24tY29sbGFwc2VkIHNlbGVjdGlvblxuICpcbiAqIFNlZSBhcyBhbiBleGFtcGxlIGEgc2VsZWN0aW9uIHRoYXQgc3RhcnRzIGluIGEgUDEgZWxlbWVudCBhbmQgZW5kcyBpbnNpZGUgdGhlIHRleHQgb2YgYSBURCBlbGVtZW50XG4gKiAoYFtgIGFuZCBgXWAgYXJlIHJhbmdlIGJvdW5kYXJpZXMgYW5kIGAobClgIGRlbm90ZXMgYW4gZWxlbWVudCBkZWZpbmVkIGFzIGBpc0xpbWl0PXRydWVgKTpcbiAqXG4gKiBgYGBcbiAqIHJvb3RcbiAqICB8LSBlbGVtZW50IFAxXG4gKiAgfCAgIHwtIFwiZm9vXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvb3RcbiAqICB8LSBlbGVtZW50IFRBQkxFIChsKSAgICAgICAgICAgICAgICAgICBQMSAgICAgICAgIFRBQkxFICAgICAgICAgICAgIFAyXG4gKiAgfCAgIHwtIGVsZW1lbnQgVFIgKGwpICAgICAgICAgICAgICAgICBmIG9bbyAgICAgVFIgICAgICBUUiAgICAgICAgIGIgYSByXG4gKiAgfCAgIHwgICB8LSBlbGVtZW50IFREIChsKSAgICAgICAgICAgICAgICAgICAgICAgVEQgICAgICBURFxuICogIHwgICB8ICAgICAgIHwtIFwiYWFhXCIgICAgICAgICAgICAgICAgICAgICAgICAgIGFdYSBhICAgIGIgYiBiXG4gKiAgfCAgIHwtIGVsZW1lbnQgVFIgKGwpXG4gKiAgfCAgIHwgICB8LSBlbGVtZW50IFREIChsKSAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8XG4gKiAgfCAgIHwgICAgICAgfC0gXCJiYmJcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHxcbiAqICB8LSBlbGVtZW50IFAyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVlZcbiAqICB8ICAgfC0gXCJiYXJcIlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vdFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAxICAgICAgICAgVEFCTEVdICAgICAgICAgICAgUDJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgb1tvICAgICBUUiAgICAgIFRSICAgICAgICAgYiBhIHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBURCAgICAgIFREXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgYSBhICAgIGIgYiBiXG4gKiBgYGBcbiAqXG4gKiBJbiB0aGUgZXhhbXBsZSBhYm92ZSwgdGhlIFRBQkxFLCBUUiBhbmQgVEQgYXJlIGRlZmluZWQgYXMgYGlzTGltaXQ9dHJ1ZWAgaW4gdGhlIHNjaGVtYS4gVGhlIHJhbmdlIHdoaWNoIGlzIG5vdCBjb250YWluZWQgd2l0aGluXG4gKiBhIHNpbmdsZSBsaW1pdCBlbGVtZW50IG11c3QgYmUgZXhwYW5kZWQgdG8gc2VsZWN0IHRoZSBvdXRlcm1vc3QgbGltaXQgZWxlbWVudC4gVGhlIHJhbmdlIGVuZCBpcyBpbnNpZGUgdGhlIHRleHQgbm9kZSBvZiB0aGUgVEQgZWxlbWVudC5cbiAqIEFzIHRoZSBURCBlbGVtZW50IGlzIGEgY2hpbGQgb2YgdGhlIFRSIGFuZCBUQUJMRSBlbGVtZW50cywgd2hlcmUgYm90aCBhcmUgZGVmaW5lZCBhcyBgaXNMaW1pdD10cnVlYCBpbiB0aGUgc2NoZW1hLCB0aGUgcmFuZ2UgbXVzdCBiZVxuICogZXhwYW5kZWQgdG8gc2VsZWN0IHRoZSB3aG9sZSBUQUJMRSBlbGVtZW50LlxuICpcbiAqICoqTm90ZSoqIElmIHRoZSBzZWxlY3Rpb24gY29udGFpbnMgbXVsdGlwbGUgcmFuZ2VzLCB0aGUgbWV0aG9kIHJldHVybnMgYSBtaW5pbWFsIHNldCBvZiByYW5nZXMgdGhhdCBhcmUgbm90IGludGVyc2VjdGluZyBhZnRlciBleHBhbmRpbmdcbiAqIHRoZW0gdG8gc2VsZWN0IGBpc0xpbWl0PXRydWVgIGVsZW1lbnRzLlxuICovIGZ1bmN0aW9uIGluamVjdFNlbGVjdGlvblBvc3RGaXhlcihtb2RlbCkge1xuICAgIG1vZGVsLmRvY3VtZW50LnJlZ2lzdGVyUG9zdEZpeGVyKCh3cml0ZXIpPT5zZWxlY3Rpb25Qb3N0Rml4ZXIod3JpdGVyLCBtb2RlbCkpO1xufVxuLyoqXG4gKiBUaGUgc2VsZWN0aW9uIHBvc3QtZml4ZXIuXG4gKi8gZnVuY3Rpb24gc2VsZWN0aW9uUG9zdEZpeGVyKHdyaXRlciwgbW9kZWwpIHtcbiAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgIGxldCB3YXNGaXhlZCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgbW9kZWxSYW5nZSBvZiBzZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAvLyBHbyB0aHJvdWdoIGFsbCByYW5nZXMgaW4gc2VsZWN0aW9uIGFuZCB0cnkgZml4aW5nIGVhY2ggb2YgdGhlbS5cbiAgICAgICAgLy8gVGhvc2UgcmFuZ2VzIG1pZ2h0IG92ZXJsYXAgYnV0IHdpbGwgYmUgY29ycmVjdGVkIGxhdGVyLlxuICAgICAgICBjb25zdCBjb3JyZWN0ZWRSYW5nZSA9IHRyeUZpeGluZ1JhbmdlKG1vZGVsUmFuZ2UsIHNjaGVtYSk7XG4gICAgICAgIC8vIFwiU2VsZWN0aW9uIGZpeGluZ1wiIGFsZ29yaXRobXMgc29tZXRpbWVzIGdldCBsb3N0LiBJbiBjb25zZXF1ZW5jZSwgaXQgbWF5IGhhcHBlblxuICAgICAgICAvLyB0aGF0IGEgbmV3IHJhbmdlIGlzIHJldHVybmVkIGJ1dCwgaW4gZmFjdCwgaXQgaGFzIHRoZSBzYW1lIHBvc2l0aW9ucyBhcyB0aGUgb3JpZ2luYWxcbiAgICAgICAgLy8gcmFuZ2UgYW55d2F5LiBJZiB0aGlzIHJhbmdlIGlzIG5vdCBkaXNjYXJkZWQsIGEgbmV3IHNlbGVjdGlvbiB3aWxsIGJlIHNldCBhbmQgdGhhdCxcbiAgICAgICAgLy8gZm9yIGluc3RhbmNlLCB3b3VsZCBkZXN0cm95IHRoZSBzZWxlY3Rpb24gYXR0cmlidXRlcy4gTGV0J3MgbWFrZSBzdXJlIHRoYXQgdGhlIHBvc3QtZml4ZXJcbiAgICAgICAgLy8gYWN0dWFsbHkgd29ya2VkIGZpcnN0IGJlZm9yZSBzZXR0aW5nIGEgbmV3IHNlbGVjdGlvbi5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvNjY5M1xuICAgICAgICBpZiAoY29ycmVjdGVkUmFuZ2UgJiYgIWNvcnJlY3RlZFJhbmdlLmlzRXF1YWwobW9kZWxSYW5nZSkpIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKGNvcnJlY3RlZFJhbmdlKTtcbiAgICAgICAgICAgIHdhc0ZpeGVkID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG1vZGVsUmFuZ2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIElmIGFueSBvZiByYW5nZXMgd2VyZSBjb3JyZWN0ZWQgdXBkYXRlIHRoZSBzZWxlY3Rpb24uXG4gICAgaWYgKHdhc0ZpeGVkKSB7XG4gICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24obWVyZ2VJbnRlcnNlY3RpbmdSYW5nZXMocmFuZ2VzKSwge1xuICAgICAgICAgICAgYmFja3dhcmQ6IHNlbGVjdGlvbi5pc0JhY2t3YXJkXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIFRyaWVzIGZpeGluZyBhIHJhbmdlIGlmIGl0J3MgaW5jb3JyZWN0LlxuICpcbiAqICoqTm90ZToqKiBUaGlzIGhlbHBlciBpcyB1c2VkIGJ5IHRoZSBzZWxlY3Rpb24gcG9zdC1maXhlciBhbmQgdG8gZml4IHRoZSBgYmVmb3JlaW5wdXRgIHRhcmdldCByYW5nZXMuXG4gKlxuICogQHJldHVybnMgUmV0dXJucyBmaXhlZCByYW5nZSBvciBudWxsIGlmIHJhbmdlIGlzIHZhbGlkLlxuICovIGZ1bmN0aW9uIHRyeUZpeGluZ1JhbmdlKHJhbmdlLCBzY2hlbWEpIHtcbiAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgcmV0dXJuIHRyeUZpeGluZ0NvbGxhcHNlZFJhbmdlKHJhbmdlLCBzY2hlbWEpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ5Rml4aW5nTm9uQ29sbGFwc2VkUmFnZShyYW5nZSwgc2NoZW1hKTtcbn1cbi8qKlxuICogVHJpZXMgdG8gZml4IGNvbGxhcHNlZCByYW5nZXMuXG4gKlxuICogKiBGaXhlcyBzaXR1YXRpb24gd2hlbiBhIHJhbmdlIGlzIGluIGEgcGxhY2Ugd2hlcmUgJHRleHQgaXMgbm90IGFsbG93ZWRcbiAqXG4gKiBAcGFyYW0gcmFuZ2UgQ29sbGFwc2VkIHJhbmdlIHRvIGZpeC5cbiAqIEByZXR1cm5zIFJldHVybnMgZml4ZWQgcmFuZ2Ugb3IgbnVsbCBpZiByYW5nZSBpcyB2YWxpZC5cbiAqLyBmdW5jdGlvbiB0cnlGaXhpbmdDb2xsYXBzZWRSYW5nZShyYW5nZSwgc2NoZW1hKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxQb3NpdGlvbiA9IHJhbmdlLnN0YXJ0O1xuICAgIGNvbnN0IG5lYXJlc3RTZWxlY3Rpb25SYW5nZSA9IHNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2Uob3JpZ2luYWxQb3NpdGlvbik7XG4gICAgLy8gVGhpcyBtaWdodCBiZSBudWxsLCBpLmUuIHdoZW4gdGhlIGVkaXRvciBkYXRhIGlzIGVtcHR5IG9yIHRoZSBzZWxlY3Rpb24gaXMgaW5zaWRlIGEgbGltaXQgZWxlbWVudFxuICAgIC8vIHRoYXQgZG9lc24ndCBhbGxvdyB0ZXh0IGluc2lkZS5cbiAgICAvLyBJbiB0aGUgZmlyc3QgY2FzZSwgdGhlcmUgaXMgbm8gbmVlZCB0byBmaXggdGhlIHNlbGVjdGlvbiByYW5nZS5cbiAgICAvLyBJbiB0aGUgc2Vjb25kLCBsZXQncyBnbyB1cCB0byB0aGUgb3V0ZXIgc2VsZWN0YWJsZSBlbGVtZW50XG4gICAgaWYgKCFuZWFyZXN0U2VsZWN0aW9uUmFuZ2UpIHtcbiAgICAgICAgY29uc3QgYW5jZXN0b3JPYmplY3QgPSBvcmlnaW5hbFBvc2l0aW9uLmdldEFuY2VzdG9ycygpLnJldmVyc2UoKS5maW5kKChpdGVtKT0+c2NoZW1hLmlzT2JqZWN0KGl0ZW0pKTtcbiAgICAgICAgaWYgKGFuY2VzdG9yT2JqZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuX2NyZWF0ZU9uKGFuY2VzdG9yT2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKCFuZWFyZXN0U2VsZWN0aW9uUmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgcmV0dXJuIG5lYXJlc3RTZWxlY3Rpb25SYW5nZTtcbiAgICB9XG4gICAgY29uc3QgZml4ZWRQb3NpdGlvbiA9IG5lYXJlc3RTZWxlY3Rpb25SYW5nZS5zdGFydDtcbiAgICAvLyBGaXhlZCBwb3NpdGlvbiBpcyB0aGUgc2FtZSBhcyBvcmlnaW5hbCAtIG5vIG5lZWQgdG8gcmV0dXJuIGNvcnJlY3RlZCByYW5nZS5cbiAgICBpZiAob3JpZ2luYWxQb3NpdGlvbi5pc0VxdWFsKGZpeGVkUG9zaXRpb24pKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFJhbmdlKGZpeGVkUG9zaXRpb24pO1xufVxuLyoqXG4gKiBUcmllcyB0byBmaXggYW4gZXhwYW5kZWQgcmFuZ2UuXG4gKlxuICogQHBhcmFtIHJhbmdlIEV4cGFuZGVkIHJhbmdlIHRvIGZpeC5cbiAqIEByZXR1cm5zIFJldHVybnMgZml4ZWQgcmFuZ2Ugb3IgbnVsbCBpZiByYW5nZSBpcyB2YWxpZC5cbiAqLyBmdW5jdGlvbiB0cnlGaXhpbmdOb25Db2xsYXBzZWRSYWdlKHJhbmdlLCBzY2hlbWEpIHtcbiAgICBjb25zdCB7IHN0YXJ0LCBlbmQgfSA9IHJhbmdlO1xuICAgIGNvbnN0IGlzVGV4dEFsbG93ZWRPblN0YXJ0ID0gc2NoZW1hLmNoZWNrQ2hpbGQoc3RhcnQsICckdGV4dCcpO1xuICAgIGNvbnN0IGlzVGV4dEFsbG93ZWRPbkVuZCA9IHNjaGVtYS5jaGVja0NoaWxkKGVuZCwgJyR0ZXh0Jyk7XG4gICAgY29uc3Qgc3RhcnRMaW1pdEVsZW1lbnQgPSBzY2hlbWEuZ2V0TGltaXRFbGVtZW50KHN0YXJ0KTtcbiAgICBjb25zdCBlbmRMaW1pdEVsZW1lbnQgPSBzY2hlbWEuZ2V0TGltaXRFbGVtZW50KGVuZCk7XG4gICAgLy8gUmFuZ2VzIHdoaWNoIGJvdGggZW5kIGFyZSBpbnNpZGUgdGhlIHNhbWUgbGltaXQgZWxlbWVudCAob3Igcm9vdCkgbWlnaHQgbmVlZHMgb25seSBtaW5vciBmaXguXG4gICAgaWYgKHN0YXJ0TGltaXRFbGVtZW50ID09PSBlbmRMaW1pdEVsZW1lbnQpIHtcbiAgICAgICAgLy8gUmFuZ2UgaXMgdmFsaWQgd2hlbiBib3RoIHBvc2l0aW9uIGFsbG93cyB0byBwbGFjZSBhIHRleHQ6XG4gICAgICAgIC8vIC0gPGJsb2NrPmZbb29iYXJiYV16PC9ibG9jaz5cbiAgICAgICAgLy8gVGhpcyB3b3VsZCBiZSBcImZpeGVkXCIgYnkgYSBuZXh0IGNoZWNrIGJ1dCBhcyBpdCB3aWxsIGJlIHRoZSBzYW1lIGl0J3MgYmV0dGVyIHRvIHJldHVybiBudWxsIHNvIHRoZSBzZWxlY3Rpb24gc3RheXMgdGhlIHNhbWUuXG4gICAgICAgIGlmIChpc1RleHRBbGxvd2VkT25TdGFydCAmJiBpc1RleHRBbGxvd2VkT25FbmQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJhbmdlIHRoYXQgaXMgb24gbm9uLWxpbWl0IGVsZW1lbnQgKG9yIGlzIHBhcnRpYWxseSkgbXVzdCBiZSBmaXhlZCBzbyBpdCBpcyBwbGFjZWQgaW5zaWRlIHRoZSBibG9jayBhcm91bmQgJHRleHQ6XG4gICAgICAgIC8vIC0gWzxibG9jaz5mb288L2Jsb2NrPl0gICAgLT4gICAgPGJsb2NrPltmb29dPC9ibG9jaz5cbiAgICAgICAgLy8gLSBbPGJsb2NrPmZvb108L2Jsb2NrPiAgICAtPiAgICA8YmxvY2s+W2Zvb108L2Jsb2NrPlxuICAgICAgICAvLyAtIDxibG9jaz5mW29vPC9ibG9jaz5dICAgIC0+ICAgIDxibG9jaz5mW29vXTwvYmxvY2s+XG4gICAgICAgIC8vIC0gWzxibG9jaz5mb288L2Jsb2NrPjxzZWxlY3RhYmxlPjwvc2VsZWN0YWJsZT5dICAgIC0+ICAgIDxibG9jaz5bZm9vPC9ibG9jaz48c2VsZWN0YWJsZT48L3NlbGVjdGFibGU+XVxuICAgICAgICBpZiAoY2hlY2tTZWxlY3Rpb25Pbk5vbkxpbWl0RWxlbWVudHMoc3RhcnQsIGVuZCwgc2NoZW1hKSkge1xuICAgICAgICAgICAgY29uc3QgaXNTdGFydEJlZm9yZVNlbGVjdGFibGUgPSBzdGFydC5ub2RlQWZ0ZXIgJiYgc2NoZW1hLmlzU2VsZWN0YWJsZShzdGFydC5ub2RlQWZ0ZXIpO1xuICAgICAgICAgICAgY29uc3QgZml4ZWRTdGFydCA9IGlzU3RhcnRCZWZvcmVTZWxlY3RhYmxlID8gbnVsbCA6IHNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2Uoc3RhcnQsICdmb3J3YXJkJyk7XG4gICAgICAgICAgICBjb25zdCBpc0VuZEFmdGVyU2VsZWN0YWJsZSA9IGVuZC5ub2RlQmVmb3JlICYmIHNjaGVtYS5pc1NlbGVjdGFibGUoZW5kLm5vZGVCZWZvcmUpO1xuICAgICAgICAgICAgY29uc3QgZml4ZWRFbmQgPSBpc0VuZEFmdGVyU2VsZWN0YWJsZSA/IG51bGwgOiBzY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKGVuZCwgJ2JhY2t3YXJkJyk7XG4gICAgICAgICAgICAvLyBUaGUgc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZSBtaWdodCByZXR1cm4gbnVsbCAtIGlmIHRoYXQgaGFwcGVucyB1c2Ugb3JpZ2luYWwgcG9zaXRpb24uXG4gICAgICAgICAgICBjb25zdCByYW5nZVN0YXJ0ID0gZml4ZWRTdGFydCA/IGZpeGVkU3RhcnQuc3RhcnQgOiBzdGFydDtcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlRW5kID0gZml4ZWRFbmQgPyBmaXhlZEVuZC5lbmQgOiBlbmQ7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHJhbmdlU3RhcnQsIHJhbmdlRW5kKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpc1N0YXJ0SW5MaW1pdCA9IHN0YXJ0TGltaXRFbGVtZW50ICYmICFzdGFydExpbWl0RWxlbWVudC5pcygncm9vdEVsZW1lbnQnKTtcbiAgICBjb25zdCBpc0VuZEluTGltaXQgPSBlbmRMaW1pdEVsZW1lbnQgJiYgIWVuZExpbWl0RWxlbWVudC5pcygncm9vdEVsZW1lbnQnKTtcbiAgICAvLyBBdCB0aGlzIHBvaW50IHdlIGVsaW1pbmF0ZWQgdmFsaWQgcG9zaXRpb25zIG9uIHRleHQgbm9kZXMgc28gaWYgb25lIG9mIHJhbmdlIHBvc2l0aW9ucyBpcyBwbGFjZWQgaW5zaWRlIGEgbGltaXQgZWxlbWVudFxuICAgIC8vIHRoZW4gdGhlIHJhbmdlIGNyb3NzZWQgbGltaXQgZWxlbWVudCBib3VuZGFyaWVzIGFuZCBuZWVkcyB0byBiZSBmaXhlZC5cbiAgICBpZiAoaXNTdGFydEluTGltaXQgfHwgaXNFbmRJbkxpbWl0KSB7XG4gICAgICAgIGNvbnN0IGJvdGhJblNhbWVQYXJlbnQgPSBzdGFydC5ub2RlQWZ0ZXIgJiYgZW5kLm5vZGVCZWZvcmUgJiYgc3RhcnQubm9kZUFmdGVyLnBhcmVudCA9PT0gZW5kLm5vZGVCZWZvcmUucGFyZW50O1xuICAgICAgICBjb25zdCBleHBhbmRTdGFydCA9IGlzU3RhcnRJbkxpbWl0ICYmICghYm90aEluU2FtZVBhcmVudCB8fCAhaXNTZWxlY3RhYmxlKHN0YXJ0Lm5vZGVBZnRlciwgc2NoZW1hKSk7XG4gICAgICAgIGNvbnN0IGV4cGFuZEVuZCA9IGlzRW5kSW5MaW1pdCAmJiAoIWJvdGhJblNhbWVQYXJlbnQgfHwgIWlzU2VsZWN0YWJsZShlbmQubm9kZUJlZm9yZSwgc2NoZW1hKSk7XG4gICAgICAgIC8vIEFsdGhvdWdoIHdlJ3ZlIGFscmVhZHkgZm91bmQgbGltaXQgZWxlbWVudCBvbiBzdGFydC9lbmQgcG9zaXRpb25zIHdlIG11c3QgZmluZCB0aGUgb3V0ZXItbW9zdCBsaW1pdCBlbGVtZW50LlxuICAgICAgICAvLyBhcyBsaW1pdCBlbGVtZW50cyBtaWdodCBiZSBuZXN0ZWQgZGlyZWN0bHkgaW5zaWRlIChpZSB0YWJsZSA+IHRhYmxlUm93ID4gdGFibGVDZWxsKS5cbiAgICAgICAgbGV0IGZpeGVkU3RhcnQgPSBzdGFydDtcbiAgICAgICAgbGV0IGZpeGVkRW5kID0gZW5kO1xuICAgICAgICBpZiAoZXhwYW5kU3RhcnQpIHtcbiAgICAgICAgICAgIGZpeGVkU3RhcnQgPSBQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKGZpbmRPdXRlcm1vc3RMaW1pdEFuY2VzdG9yKHN0YXJ0TGltaXRFbGVtZW50LCBzY2hlbWEpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXhwYW5kRW5kKSB7XG4gICAgICAgICAgICBmaXhlZEVuZCA9IFBvc2l0aW9uLl9jcmVhdGVBZnRlcihmaW5kT3V0ZXJtb3N0TGltaXRBbmNlc3RvcihlbmRMaW1pdEVsZW1lbnQsIHNjaGVtYSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UoZml4ZWRTdGFydCwgZml4ZWRFbmQpO1xuICAgIH1cbiAgICAvLyBSYW5nZSB3YXMgbm90IGZpeGVkIGF0IHRoaXMgcG9pbnQgc28gaXQgaXMgdmFsaWQgLSBpZSBpdCB3YXMgcGxhY2VkIGFyb3VuZCBsaW1pdCBlbGVtZW50IGFscmVhZHkuXG4gICAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIEZpbmRzIHRoZSBvdXRlci1tb3N0IGFuY2VzdG9yLlxuICovIGZ1bmN0aW9uIGZpbmRPdXRlcm1vc3RMaW1pdEFuY2VzdG9yKHN0YXJ0aW5nTm9kZSwgc2NoZW1hKSB7XG4gICAgbGV0IGlzTGltaXROb2RlID0gc3RhcnRpbmdOb2RlO1xuICAgIGxldCBwYXJlbnQgPSBpc0xpbWl0Tm9kZTtcbiAgICAvLyBGaW5kIG91dGVyIG1vc3QgaXNMaW1pdCBibG9jayBhcyBzdWNoIGJsb2NrcyBtaWdodCBiZSBuZXN0ZWQgKGllLiBpbiB0YWJsZXMpLlxuICAgIHdoaWxlKHNjaGVtYS5pc0xpbWl0KHBhcmVudCkgJiYgcGFyZW50LnBhcmVudCl7XG4gICAgICAgIGlzTGltaXROb2RlID0gcGFyZW50O1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgIH1cbiAgICByZXR1cm4gaXNMaW1pdE5vZGU7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIGFueSBvZiByYW5nZSBib3VuZGFyaWVzIGlzIHBsYWNlZCBhcm91bmQgbm9uLWxpbWl0IGVsZW1lbnRzLlxuICovIGZ1bmN0aW9uIGNoZWNrU2VsZWN0aW9uT25Ob25MaW1pdEVsZW1lbnRzKHN0YXJ0LCBlbmQsIHNjaGVtYSkge1xuICAgIGNvbnN0IHN0YXJ0SXNPbkJsb2NrID0gc3RhcnQubm9kZUFmdGVyICYmICFzY2hlbWEuaXNMaW1pdChzdGFydC5ub2RlQWZ0ZXIpIHx8IHNjaGVtYS5jaGVja0NoaWxkKHN0YXJ0LCAnJHRleHQnKTtcbiAgICBjb25zdCBlbmRJc09uQmxvY2sgPSBlbmQubm9kZUJlZm9yZSAmJiAhc2NoZW1hLmlzTGltaXQoZW5kLm5vZGVCZWZvcmUpIHx8IHNjaGVtYS5jaGVja0NoaWxkKGVuZCwgJyR0ZXh0Jyk7XG4gICAgLy8gV2Ugc2hvdWxkIGZpeCBzdWNoIHNlbGVjdGlvbiB3aGVuIG9uZSBvZiB0aG9zZSBub2RlcyBuZWVkcyBmaXhpbmcuXG4gICAgcmV0dXJuIHN0YXJ0SXNPbkJsb2NrIHx8IGVuZElzT25CbG9jaztcbn1cbi8qKlxuICogUmV0dXJucyBhIG1pbmltYWwgbm9uLWludGVyc2VjdGluZyBhcnJheSBvZiByYW5nZXMgd2l0aG91dCBkdXBsaWNhdGVzLlxuICpcbiAqIEBwYXJhbSByYW5nZXMgUmFuZ2VzIHRvIG1lcmdlLlxuICogQHJldHVybnMgQXJyYXkgb2YgdW5pcXVlIGFuZCBub24taW50ZXJzZWN0aW5nIHJhbmdlcy5cbiAqLyBmdW5jdGlvbiBtZXJnZUludGVyc2VjdGluZ1JhbmdlcyhyYW5nZXMpIHtcbiAgICBjb25zdCByYW5nZXNUb01lcmdlID0gW1xuICAgICAgICAuLi5yYW5nZXNcbiAgICBdO1xuICAgIGNvbnN0IHJhbmdlSW5kZXhlc1RvUmVtb3ZlID0gbmV3IFNldCgpO1xuICAgIGxldCBjdXJyZW50UmFuZ2VJbmRleCA9IDE7XG4gICAgd2hpbGUoY3VycmVudFJhbmdlSW5kZXggPCByYW5nZXNUb01lcmdlLmxlbmd0aCl7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRSYW5nZSA9IHJhbmdlc1RvTWVyZ2VbY3VycmVudFJhbmdlSW5kZXhdO1xuICAgICAgICBjb25zdCBwcmV2aW91c1JhbmdlcyA9IHJhbmdlc1RvTWVyZ2Uuc2xpY2UoMCwgY3VycmVudFJhbmdlSW5kZXgpO1xuICAgICAgICBmb3IgKGNvbnN0IFtwcmV2aW91c1JhbmdlSW5kZXgsIHByZXZpb3VzUmFuZ2VdIG9mIHByZXZpb3VzUmFuZ2VzLmVudHJpZXMoKSl7XG4gICAgICAgICAgICBpZiAocmFuZ2VJbmRleGVzVG9SZW1vdmUuaGFzKHByZXZpb3VzUmFuZ2VJbmRleCkpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50UmFuZ2UuaXNFcXVhbChwcmV2aW91c1JhbmdlKSkge1xuICAgICAgICAgICAgICAgIHJhbmdlSW5kZXhlc1RvUmVtb3ZlLmFkZChwcmV2aW91c1JhbmdlSW5kZXgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UmFuZ2UuaXNJbnRlcnNlY3RpbmcocHJldmlvdXNSYW5nZSkpIHtcbiAgICAgICAgICAgICAgICByYW5nZUluZGV4ZXNUb1JlbW92ZS5hZGQocHJldmlvdXNSYW5nZUluZGV4KTtcbiAgICAgICAgICAgICAgICByYW5nZUluZGV4ZXNUb1JlbW92ZS5hZGQoY3VycmVudFJhbmdlSW5kZXgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlZFJhbmdlID0gY3VycmVudFJhbmdlLmdldEpvaW5lZChwcmV2aW91c1JhbmdlKTtcbiAgICAgICAgICAgICAgICByYW5nZXNUb01lcmdlLnB1c2gobWVyZ2VkUmFuZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRSYW5nZUluZGV4Kys7XG4gICAgfVxuICAgIGNvbnN0IG5vbkludGVyc2VjdGluZ1JhbmdlcyA9IHJhbmdlc1RvTWVyZ2UuZmlsdGVyKChfLCBpbmRleCk9PiFyYW5nZUluZGV4ZXNUb1JlbW92ZS5oYXMoaW5kZXgpKTtcbiAgICByZXR1cm4gbm9uSW50ZXJzZWN0aW5nUmFuZ2VzO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgbm9kZSBleGlzdHMgYW5kIGlmIGl0J3MgYSBzZWxlY3RhYmxlLlxuICovIGZ1bmN0aW9uIGlzU2VsZWN0YWJsZShub2RlLCBzY2hlbWEpIHtcbiAgICByZXR1cm4gbm9kZSAmJiBzY2hlbWEuaXNTZWxlY3RhYmxlKG5vZGUpO1xufVxuXG4vLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGNvbnN0IHsgZHVtcFRyZWVzLCBpbml0RG9jdW1lbnREdW1waW5nIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLyoqXG4gKiBBIGNvbnRyb2xsZXIgZm9yIHRoZSBlZGl0aW5nIHBpcGVsaW5lLiBUaGUgZWRpdGluZyBwaXBlbGluZSBjb250cm9scyB0aGUge0BsaW5rIH5FZGl0aW5nQ29udHJvbGxlciNtb2RlbCBtb2RlbH0gcmVuZGVyaW5nLFxuICogaW5jbHVkaW5nIHNlbGVjdGlvbiBoYW5kbGluZy4gSXQgYWxzbyBjcmVhdGVzIHRoZSB7QGxpbmsgfkVkaXRpbmdDb250cm9sbGVyI3ZpZXcgdmlld30gd2hpY2ggYnVpbGRzIGFcbiAqIGJyb3dzZXItaW5kZXBlbmRlbnQgdmlydHVhbGl6YXRpb24gb3ZlciB0aGUgRE9NIGVsZW1lbnRzLiBUaGUgZWRpdGluZyBjb250cm9sbGVyIGFsc28gYXR0YWNoZXMgZGVmYXVsdCBjb252ZXJ0ZXJzLlxuICovIGNsYXNzIEVkaXRpbmdDb250cm9sbGVyIGV4dGVuZHMgLyogI19fUFVSRV9fICovIE9ic2VydmFibGVNaXhpbigpIHtcbiAgICAvKipcblx0ICogRWRpdG9yIG1vZGVsLlxuXHQgKi8gbW9kZWw7XG4gICAgLyoqXG5cdCAqIEVkaXRpbmcgdmlldyBjb250cm9sbGVyLlxuXHQgKi8gdmlldztcbiAgICAvKipcblx0ICogQSBtYXBwZXIgdGhhdCBkZXNjcmliZXMgdGhlIG1vZGVsLXZpZXcgYmluZGluZy5cblx0ICovIG1hcHBlcjtcbiAgICAvKipcblx0ICogRG93bmNhc3QgZGlzcGF0Y2hlciB0aGF0IGNvbnZlcnRzIGNoYW5nZXMgZnJvbSB0aGUgbW9kZWwgdG8gdGhlIHtAbGluayAjdmlldyBlZGl0aW5nIHZpZXd9LlxuXHQgKi8gZG93bmNhc3REaXNwYXRjaGVyO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGVkaXRpbmcgY29udHJvbGxlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG1vZGVsIEVkaXRpbmcgbW9kZWwuXG5cdCAqIEBwYXJhbSBzdHlsZXNQcm9jZXNzb3IgVGhlIHN0eWxlcyBwcm9jZXNzb3IgaW5zdGFuY2UuXG5cdCAqLyBjb25zdHJ1Y3Rvcihtb2RlbCwgc3R5bGVzUHJvY2Vzc29yKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgVmlldyhzdHlsZXNQcm9jZXNzb3IpO1xuICAgICAgICB0aGlzLm1hcHBlciA9IG5ldyBNYXBwZXIoKTtcbiAgICAgICAgdGhpcy5kb3duY2FzdERpc3BhdGNoZXIgPSBuZXcgRG93bmNhc3REaXNwYXRjaGVyKHtcbiAgICAgICAgICAgIG1hcHBlcjogdGhpcy5tYXBwZXIsXG4gICAgICAgICAgICBzY2hlbWE6IG1vZGVsLnNjaGVtYVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZG9jID0gdGhpcy5tb2RlbC5kb2N1bWVudDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jLnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgbWFya2VycyA9IHRoaXMubW9kZWwubWFya2VycztcbiAgICAgICAgLy8gV2hlbiBwbHVnaW5zIGxpc3RlbiBvbiBtb2RlbCBjaGFuZ2VzIChvbiBzZWxlY3Rpb24gY2hhbmdlLCBwb3N0IGZpeGVycywgZXRjLikgYW5kIGNoYW5nZSB0aGUgdmlldyBhcyBhIHJlc3VsdCBvZlxuICAgICAgICAvLyB0aGUgbW9kZWwncyBjaGFuZ2UsIHRoZXkgbWlnaHQgdHJpZ2dlciB2aWV3IHJlbmRlcmluZyBiZWZvcmUgdGhlIGNvbnZlcnNpb24gaXMgY29tcGxldGVkIChlLmcuIGJlZm9yZSB0aGUgc2VsZWN0aW9uXG4gICAgICAgIC8vIGlzIGNvbnZlcnRlZCkuIFdlIGRpc2FibGUgcmVuZGVyaW5nIGZvciB0aGUgbGVuZ3RoIG9mIHRoZSBvdXRlcm1vc3QgbW9kZWwgY2hhbmdlKCkgYmxvY2sgdG8gcHJldmVudCB0aGF0LlxuICAgICAgICAvL1xuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE1MjhcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnX2JlZm9yZUNoYW5nZXMnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy52aWV3Ll9kaXNhYmxlUmVuZGVyaW5nKHRydWUpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsICdfYWZ0ZXJDaGFuZ2VzJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMudmlldy5fZGlzYWJsZVJlbmRlcmluZyhmYWxzZSk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gV2hlbmV2ZXIgbW9kZWwgZG9jdW1lbnQgaXMgY2hhbmdlZCwgY29udmVydCB0aG9zZSBjaGFuZ2VzIHRvIHRoZSB2aWV3ICh1c2luZyBtb2RlbC5Eb2N1bWVudCNkaWZmZXIpLlxuICAgICAgICAvLyBEbyBpdCBvbiAnbG93JyBwcmlvcml0eSwgc28gY2hhbmdlcyBhcmUgY29udmVydGVkIGFmdGVyIG90aGVyIGxpc3RlbmVycyBkaWQgdGhlaXIgam9iLlxuICAgICAgICAvLyBBbHNvIGNvbnZlcnQgbW9kZWwgc2VsZWN0aW9uLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGRvYywgJ2NoYW5nZScsICgpPT57XG4gICAgICAgICAgICB0aGlzLnZpZXcuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgdGhpcy5kb3duY2FzdERpc3BhdGNoZXIuY29udmVydENoYW5nZXMoZG9jLmRpZmZlciwgbWFya2Vycywgd3JpdGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvd25jYXN0RGlzcGF0Y2hlci5jb252ZXJ0U2VsZWN0aW9uKHNlbGVjdGlvbiwgbWFya2Vycywgd3JpdGVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENvbnZlcnQgc2VsZWN0aW9uIGZyb20gdGhlIHZpZXcgdG8gdGhlIG1vZGVsIHdoZW4gaXQgY2hhbmdlcyBpbiB0aGUgdmlldy5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLnZpZXcuZG9jdW1lbnQsICdzZWxlY3Rpb25DaGFuZ2UnLCBjb252ZXJ0U2VsZWN0aW9uQ2hhbmdlKHRoaXMubW9kZWwsIHRoaXMubWFwcGVyKSk7XG4gICAgICAgIC8vIEZpeCBgYmVmb3JlaW5wdXRgIHRhcmdldCByYW5nZXMgc28gdGhhdCB0aGV5IG1hcCB0byB0aGUgdmFsaWQgbW9kZWwgcmFuZ2VzLlxuICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMudmlldy5kb2N1bWVudCwgJ2JlZm9yZWlucHV0JywgZml4VGFyZ2V0UmFuZ2VzKHRoaXMubWFwcGVyLCB0aGlzLm1vZGVsLnNjaGVtYSwgdGhpcy52aWV3KSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQXR0YWNoIGRlZmF1bHQgbW9kZWwgY29udmVydGVycy5cbiAgICAgICAgdGhpcy5kb3duY2FzdERpc3BhdGNoZXIub24oJ2luc2VydDokdGV4dCcsIGluc2VydFRleHQoKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3dlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRvd25jYXN0RGlzcGF0Y2hlci5vbignaW5zZXJ0JywgaW5zZXJ0QXR0cmlidXRlc0FuZENoaWxkcmVuKCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5kb3duY2FzdERpc3BhdGNoZXIub24oJ3JlbW92ZScsIHJlbW92ZSgpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEF0dGFjaCBkZWZhdWx0IG1vZGVsIHNlbGVjdGlvbiBjb252ZXJ0ZXJzLlxuICAgICAgICB0aGlzLmRvd25jYXN0RGlzcGF0Y2hlci5vbignY2xlYW5TZWxlY3Rpb24nLCBjbGVhblNlbGVjdGlvbigpKTtcbiAgICAgICAgdGhpcy5kb3duY2FzdERpc3BhdGNoZXIub24oJ3NlbGVjdGlvbicsIGNvbnZlcnRSYW5nZVNlbGVjdGlvbigpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZG93bmNhc3REaXNwYXRjaGVyLm9uKCdzZWxlY3Rpb24nLCBjb252ZXJ0Q29sbGFwc2VkU2VsZWN0aW9uKCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQmluZHMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNyb290cyB2aWV3IHJvb3RzIGNvbGxlY3Rpb259IHRvXG4gICAgICAgIC8vIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3Jvb3RzIG1vZGVsIHJvb3RzIGNvbGxlY3Rpb259IHNvIGNyZWF0aW5nXG4gICAgICAgIC8vIG1vZGVsIHJvb3QgYXV0b21hdGljYWxseSBjcmVhdGVzIGNvcnJlc3BvbmRpbmcgdmlldyByb290LlxuICAgICAgICB0aGlzLnZpZXcuZG9jdW1lbnQucm9vdHMuYmluZFRvKHRoaXMubW9kZWwuZG9jdW1lbnQucm9vdHMpLnVzaW5nKChyb290KT0+e1xuICAgICAgICAgICAgLy8gJGdyYXZleWFyZCBpcyBhIHNwZWNpYWwgcm9vdCB0aGF0IGhhcyBubyByZWZsZWN0aW9uIGluIHRoZSB2aWV3LlxuICAgICAgICAgICAgaWYgKHJvb3Qucm9vdE5hbWUgPT0gJyRncmF2ZXlhcmQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2aWV3Um9vdCA9IG5ldyBSb290RWRpdGFibGVFbGVtZW50KHRoaXMudmlldy5kb2N1bWVudCwgcm9vdC5uYW1lKTtcbiAgICAgICAgICAgIHZpZXdSb290LnJvb3ROYW1lID0gcm9vdC5yb290TmFtZTtcbiAgICAgICAgICAgIHRoaXMubWFwcGVyLmJpbmRFbGVtZW50cyhyb290LCB2aWV3Um9vdCk7XG4gICAgICAgICAgICByZXR1cm4gdmlld1Jvb3Q7XG4gICAgICAgIH0pO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gaW5pdERvY3VtZW50RHVtcGluZyggdGhpcy5tb2RlbC5kb2N1bWVudCApO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gaW5pdERvY3VtZW50RHVtcGluZyggdGhpcy52aWV3LmRvY3VtZW50ICk7XG4gICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBkdW1wVHJlZXMoIHRoaXMubW9kZWwuZG9jdW1lbnQsIHRoaXMubW9kZWwuZG9jdW1lbnQudmVyc2lvbiApO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gZHVtcFRyZWVzKCB0aGlzLnZpZXcuZG9jdW1lbnQsIHRoaXMubW9kZWwuZG9jdW1lbnQudmVyc2lvbiApO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gdGhpcy5tb2RlbC5kb2N1bWVudC5vbiggJ2NoYW5nZScsICgpID0+IHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vXHRkdW1wVHJlZXMoIHRoaXMudmlldy5kb2N1bWVudCwgdGhpcy5tb2RlbC5kb2N1bWVudC52ZXJzaW9uICk7XG4gICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyB9LCB7IHByaW9yaXR5OiAnbG93ZXN0JyB9ICk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFsbCBldmVudCBsaXN0ZW5lcnMgYXR0YWNoZWQgdG8gdGhlIGBFZGl0aW5nQ29udHJvbGxlcmAuIERlc3Ryb3lzIGFsbCBvYmplY3RzIGNyZWF0ZWRcblx0ICogYnkgYEVkaXRpbmdDb250cm9sbGVyYCB0aGF0IG5lZWQgdG8gYmUgZGVzdHJveWVkLlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy52aWV3LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDYWxsaW5nIHRoaXMgbWV0aG9kIHdpbGwgcmVmcmVzaCB0aGUgbWFya2VyIGJ5IHRyaWdnZXJpbmcgdGhlIGRvd25jYXN0IGNvbnZlcnNpb24gZm9yIGl0LlxuXHQgKlxuXHQgKiBSZWNvbnZlcnRpbmcgdGhlIG1hcmtlciBpcyB1c2VmdWwgd2hlbiB5b3Ugd2FudCB0byBjaGFuZ2UgaXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH1cblx0ICogd2l0aG91dCBjaGFuZ2luZyBhbnkgbWFya2VyIGRhdGEuIEZvciBpbnN0YW5jZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogbGV0IGlzQ29tbWVudEFjdGl2ZSA9IGZhbHNlO1xuXHQgKlxuXHQgKiBtb2RlbC5jb252ZXJzaW9uLm1hcmtlclRvSGlnaGxpZ2h0KCB7XG5cdCAqIFx0bW9kZWw6ICdjb21tZW50Jyxcblx0ICogXHR2aWV3OiBkYXRhID0+IHtcblx0ICogXHRcdGNvbnN0IGNsYXNzZXMgPSBbICdjb21tZW50LW1hcmtlcicgXTtcblx0ICpcblx0ICogXHRcdGlmICggaXNDb21tZW50QWN0aXZlICkge1xuXHQgKiBcdFx0XHRjbGFzc2VzLnB1c2goICdjb21tZW50LW1hcmtlci0tYWN0aXZlJyApO1xuXHQgKiBcdFx0fVxuXHQgKlxuXHQgKiBcdFx0cmV0dXJuIHsgY2xhc3NlcyB9O1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyAuLi5cblx0ICpcblx0ICogLy8gQ2hhbmdlIHRoZSBwcm9wZXJ0eSB0aGF0IGluZGljYXRlcyBpZiBtYXJrZXIgaXMgZGlzcGxheWVkIGFzIGFjdGl2ZSBvciBub3QuXG5cdCAqIGlzQ29tbWVudEFjdGl2ZSA9IHRydWU7XG5cdCAqXG5cdCAqIC8vIFJlY29udmVydGluZyB3aWxsIGRvd25jYXN0IGFuZCBzeW5jaHJvbml6ZSB0aGUgbWFya2VyIHdpdGggdGhlIG5ldyBpc0NvbW1lbnRBY3RpdmUgc3RhdGUgdmFsdWUuXG5cdCAqIGVkaXRvci5lZGl0aW5nLnJlY29udmVydE1hcmtlciggJ2NvbW1lbnQnICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqKk5vdGUqKjogSWYgeW91IHdhbnQgdG8gcmVjb252ZXJ0IGEgbW9kZWwgaXRlbSwgdXNlIHtAbGluayAjcmVjb252ZXJ0SXRlbX0gaW5zdGVhZC5cblx0ICpcblx0ICogQHBhcmFtIG1hcmtlck9yTmFtZSBOYW1lIG9mIGEgbWFya2VyIHRvIHVwZGF0ZSwgb3IgYSBtYXJrZXIgaW5zdGFuY2UuXG5cdCAqLyByZWNvbnZlcnRNYXJrZXIobWFya2VyT3JOYW1lKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlck5hbWUgPSB0eXBlb2YgbWFya2VyT3JOYW1lID09ICdzdHJpbmcnID8gbWFya2VyT3JOYW1lIDogbWFya2VyT3JOYW1lLm5hbWU7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRNYXJrZXIgPSB0aGlzLm1vZGVsLm1hcmtlcnMuZ2V0KG1hcmtlck5hbWUpO1xuICAgICAgICBpZiAoIWN1cnJlbnRNYXJrZXIpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhlIG1hcmtlciB3aXRoIHRoZSBwcm92aWRlZCBuYW1lIGRvZXMgbm90IGV4aXN0IGFuZCBjYW5ub3QgYmUgcmVjb252ZXJ0ZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGVkaXRpbmdjb250cm9sbGVyLXJlY29udmVydG1hcmtlci1tYXJrZXItbm90LWV4aXN0XG5cdFx0XHQgKiBAcGFyYW0ge1N0cmluZ30gbWFya2VyTmFtZSBUaGUgbmFtZSBvZiB0aGUgcmVjb252ZXJ0ZWQgbWFya2VyLlxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdlZGl0aW5nY29udHJvbGxlci1yZWNvbnZlcnRtYXJrZXItbWFya2VyLW5vdC1leGlzdCcsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICBtYXJrZXJOYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vZGVsLmNoYW5nZSgoKT0+e1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5tYXJrZXJzLl9yZWZyZXNoKGN1cnJlbnRNYXJrZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENhbGxpbmcgdGhpcyBtZXRob2Qgd2lsbCBkb3duY2FzdCBhIG1vZGVsIGl0ZW0gb24gZGVtYW5kIChieSByZXF1ZXN0aW5nIGEgcmVmcmVzaCBpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZGlmZmVyfkRpZmZlcn0pLlxuXHQgKlxuXHQgKiBZb3UgY2FuIHVzZSBpdCBpZiB5b3Ugd2FudCB0aGUgdmlldyByZXByZXNlbnRhdGlvbiBvZiBhIHNwZWNpZmljIGl0ZW0gdXBkYXRlZCBhcyBhIHJlc3BvbnNlIHRvIGV4dGVybmFsIG1vZGlmaWNhdGlvbnMuIEZvciBpbnN0YW5jZSxcblx0ICogd2hlbiB0aGUgdmlldyBzdHJ1Y3R1cmUgZGVwZW5kcyBub3Qgb25seSBvbiB0aGUgYXNzb2NpYXRlZCBtb2RlbCBkYXRhIGJ1dCBhbHNvIG9uIHNvbWUgZXh0ZXJuYWwgc3RhdGUuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBJZiB5b3Ugd2FudCB0byByZWNvbnZlcnQgYSBtb2RlbCBtYXJrZXIsIHVzZSB7QGxpbmsgI3JlY29udmVydE1hcmtlcn0gaW5zdGVhZC5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSB0byByZWZyZXNoLlxuXHQgKi8gcmVjb252ZXJ0SXRlbShpdGVtKSB7XG4gICAgICAgIHRoaXMubW9kZWwuY2hhbmdlKCgpPT57XG4gICAgICAgICAgICB0aGlzLm1vZGVsLmRvY3VtZW50LmRpZmZlci5fcmVmcmVzaEl0ZW0oaXRlbSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHRhcmdldCByYW5nZXMgcHJvdmlkZWQgYnkgdGhlIGBiZWZvcmVJbnB1dGAgZXZlbnQgY2FuIGJlIHByb3Blcmx5IG1hcHBlZCB0byBtb2RlbCByYW5nZXMgYW5kIGZpeGVzIHRoZW0gaWYgbmVlZGVkLlxuICpcbiAqIFRoaXMgaXMgdXNpbmcgdGhlIHNhbWUgbG9naWMgYXMgdGhlIHNlbGVjdGlvbiBwb3N0LWZpeGVyLlxuICovIGZ1bmN0aW9uIGZpeFRhcmdldFJhbmdlcyhtYXBwZXIsIHNjaGVtYSwgdmlldykge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAvLyBUaGUgUmVuZGVyZXIgaXMgZGlzYWJsZWQgd2hpbGUgY29tcG9zaW5nIG9uIG5vbi1hbmRyb2lkIGJyb3dzZXJzLCBzbyB3ZSBjYW4ndCBiZSBzdXJlIHRoYXQgdGFyZ2V0IHJhbmdlc1xuICAgICAgICAvLyBjb3VsZCBiZSBwcm9wZXJseSBtYXBwZWQgdG8gdmlldyBhbmQgbW9kZWwgYmVjYXVzZSB0aGUgRE9NIGFuZCB2aWV3IHRyZWUgZHJpZnRlZCBhcGFydC5cbiAgICAgICAgaWYgKHZpZXcuZG9jdW1lbnQuaXNDb21wb3NpbmcgJiYgIWVudi5pc0FuZHJvaWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgZGF0YS50YXJnZXRSYW5nZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgY29uc3Qgdmlld1JhbmdlID0gZGF0YS50YXJnZXRSYW5nZXNbaV07XG4gICAgICAgICAgICBjb25zdCBtb2RlbFJhbmdlID0gbWFwcGVyLnRvTW9kZWxSYW5nZSh2aWV3UmFuZ2UpO1xuICAgICAgICAgICAgY29uc3QgY29ycmVjdGVkUmFuZ2UgPSB0cnlGaXhpbmdSYW5nZShtb2RlbFJhbmdlLCBzY2hlbWEpO1xuICAgICAgICAgICAgaWYgKCFjb3JyZWN0ZWRSYW5nZSB8fCBjb3JyZWN0ZWRSYW5nZS5pc0VxdWFsKG1vZGVsUmFuZ2UpKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhLnRhcmdldFJhbmdlc1tpXSA9IG1hcHBlci50b1ZpZXdSYW5nZShjb3JyZWN0ZWRSYW5nZSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKipcbiAqIFRoZSBtb2RlbCdzIHNjaGVtYS4gSXQgZGVmaW5lcyB0aGUgYWxsb3dlZCBhbmQgZGlzYWxsb3dlZCBzdHJ1Y3R1cmVzIG9mIG5vZGVzIGFzIHdlbGwgYXMgbm9kZXMnIGF0dHJpYnV0ZXMuXG4gKiBUaGUgc2NoZW1hIGlzIHVzdWFsbHkgZGVmaW5lZCBieSB0aGUgZmVhdHVyZXMgYW5kIGJhc2VkIG9uIHRoZW0sIHRoZSBlZGl0aW5nIGZyYW1ld29yayBhbmQgZmVhdHVyZXNcbiAqIG1ha2UgZGVjaXNpb25zIG9uIGhvdyB0byBjaGFuZ2UgYW5kIHByb2Nlc3MgdGhlIG1vZGVsLlxuICpcbiAqIFRoZSBpbnN0YW5jZSBvZiBzY2hlbWEgaXMgYXZhaWxhYmxlIGluIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI3NjaGVtYSBgZWRpdG9yLm1vZGVsLnNjaGVtYWB9LlxuICpcbiAqIFJlYWQgbW9yZSBhYm91dCB0aGUgc2NoZW1hIGluOlxuICpcbiAqICogVGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2FyY2hpdGVjdHVyZS9lZGl0aW5nLWVuZ2luZSNzY2hlbWEgc2NoZW1hIHNlY3Rpb259IG9mIHRoZVxuICoge0BnbGluayBmcmFtZXdvcmsvYXJjaGl0ZWN0dXJlL2VkaXRpbmctZW5naW5lIEludHJvZHVjdGlvbiB0byB0aGUgRWRpdGluZyBlbmdpbmUgYXJjaGl0ZWN0dXJlfSBndWlkZS5cbiAqICogVGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUuXG4gKi8gY2xhc3MgU2NoZW1hIGV4dGVuZHMgLyogI19fUFVSRV9fICovIE9ic2VydmFibGVNaXhpbigpIHtcbiAgICBfc291cmNlRGVmaW5pdGlvbnMgPSB7fTtcbiAgICAvKipcblx0ICogQSBkaWN0aW9uYXJ5IGNvbnRhaW5pbmcgYXR0cmlidXRlIHByb3BlcnRpZXMuXG5cdCAqLyBfYXR0cmlidXRlUHJvcGVydGllcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgLyoqXG5cdCAqIFN0b3JlcyBhZGRpdGlvbmFsIGNhbGxiYWNrcyByZWdpc3RlcmVkIGZvciBzY2hlbWEgaXRlbXMsIHdoaWNoIGFyZSBldmFsdWF0ZWQgd2hlbiB7QGxpbmsgflNjaGVtYSNjaGVja0NoaWxkfSBpcyBjYWxsZWQuXG5cdCAqXG5cdCAqIEtleXMgYXJlIHNjaGVtYSBpdGVtIG5hbWVzIGZvciB3aGljaCB0aGUgY2FsbGJhY2tzIGFyZSByZWdpc3RlcmVkLiBWYWx1ZXMgYXJlIGFycmF5cyB3aXRoIHRoZSBjYWxsYmFja3MuXG5cdCAqXG5cdCAqIFNvbWUgY2hlY2tzIGFyZSBhZGRlZCB1bmRlciB7QGxpbmsgflNjaGVtYSNfZ2VuZXJpY0NoZWNrU3ltYm9sfSBrZXksIHRoZXNlIGFyZSBldmFsdWF0ZWQgZm9yIGV2ZXJ5IHtAbGluayB+U2NoZW1hI2NoZWNrQ2hpbGR9IGNhbGwuXG5cdCAqLyBfY3VzdG9tQ2hpbGRDaGVja3MgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIFN0b3JlcyBhZGRpdGlvbmFsIGNhbGxiYWNrcyByZWdpc3RlcmVkIGZvciBhdHRyaWJ1dGUgbmFtZXMsIHdoaWNoIGFyZSBldmFsdWF0ZWQgd2hlbiB7QGxpbmsgflNjaGVtYSNjaGVja0F0dHJpYnV0ZX0gaXMgY2FsbGVkLlxuXHQgKlxuXHQgKiBLZXlzIGFyZSBzY2hlbWEgYXR0cmlidXRlIG5hbWVzIGZvciB3aGljaCB0aGUgY2FsbGJhY2tzIGFyZSByZWdpc3RlcmVkLiBWYWx1ZXMgYXJlIGFycmF5cyB3aXRoIHRoZSBjYWxsYmFja3MuXG5cdCAqXG5cdCAqIFNvbWUgY2hlY2tzIGFyZSBhZGRlZCB1bmRlciB7QGxpbmsgflNjaGVtYSNfZ2VuZXJpY0NoZWNrU3ltYm9sfSBrZXksIHRoZXNlIGFyZSBldmFsdWF0ZWQgZm9yIGV2ZXJ5XG5cdCAqIHtAbGluayB+U2NoZW1hI2NoZWNrQXR0cmlidXRlfSBjYWxsLlxuXHQgKi8gX2N1c3RvbUF0dHJpYnV0ZUNoZWNrcyA9IG5ldyBNYXAoKTtcbiAgICBfZ2VuZXJpY0NoZWNrU3ltYm9sID0gU3ltYm9sKCckZ2VuZXJpYycpO1xuICAgIF9jb21waWxlZERlZmluaXRpb25zO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgc2NoZW1hIGluc3RhbmNlLlxuXHQgKi8gY29uc3RydWN0b3IoKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5kZWNvcmF0ZSgnY2hlY2tDaGlsZCcpO1xuICAgICAgICB0aGlzLmRlY29yYXRlKCdjaGVja0F0dHJpYnV0ZScpO1xuICAgICAgICB0aGlzLm9uKCdjaGVja0F0dHJpYnV0ZScsIChldnQsIGFyZ3MpPT57XG4gICAgICAgICAgICBhcmdzWzBdID0gbmV3IFNjaGVtYUNvbnRleHQoYXJnc1swXSk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaGVzdCdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ2NoZWNrQ2hpbGQnLCAoZXZ0LCBhcmdzKT0+e1xuICAgICAgICAgICAgYXJnc1swXSA9IG5ldyBTY2hlbWFDb250ZXh0KGFyZ3NbMF0pO1xuICAgICAgICAgICAgYXJnc1sxXSA9IHRoaXMuZ2V0RGVmaW5pdGlvbihhcmdzWzFdKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIHNjaGVtYSBpdGVtLiBDYW4gb25seSBiZSBjYWxsZWQgb25jZSBmb3IgZXZlcnkgaXRlbSBuYW1lLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzY2hlbWEucmVnaXN0ZXIoICdwYXJhZ3JhcGgnLCB7XG5cdCAqIFx0aW5oZXJpdEFsbEZyb206ICckYmxvY2snXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqLyByZWdpc3RlcihpdGVtTmFtZSwgZGVmaW5pdGlvbikge1xuICAgICAgICBpZiAodGhpcy5fc291cmNlRGVmaW5pdGlvbnNbaXRlbU5hbWVdKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEEgc2luZ2xlIGl0ZW0gY2Fubm90IGJlIHJlZ2lzdGVyZWQgdHdpY2UgaW4gdGhlIHNjaGVtYS5cblx0XHRcdCAqXG5cdFx0XHQgKiBUaGlzIHNpdHVhdGlvbiBtYXkgaGFwcGVuIHdoZW46XG5cdFx0XHQgKlxuXHRcdFx0ICogKiBUd28gb3IgbW9yZSBwbHVnaW5zIGNhbGxlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI3JlZ2lzdGVyIGByZWdpc3RlcigpYH0gd2l0aCB0aGUgc2FtZSBuYW1lLlxuXHRcdFx0ICogVGhpcyB3aWxsIHVzdWFsbHkgbWVhbiB0aGF0IHRoZXJlIGlzIGEgY29sbGlzaW9uIGJldHdlZW4gcGx1Z2lucyB3aGljaCB0cnkgdG8gdXNlIHRoZSBzYW1lIGVsZW1lbnQgaW4gdGhlIG1vZGVsLlxuXHRcdFx0ICogVW5mb3J0dW5hdGVseSwgdGhlIG9ubHkgd2F5IHRvIHNvbHZlIHRoaXMgaXMgYnkgbW9kaWZ5aW5nIG9uZSBvZiB0aGVzZSBwbHVnaW5zIHRvIHVzZSBhIHVuaXF1ZSBtb2RlbCBlbGVtZW50IG5hbWUuXG5cdFx0XHQgKiAqIEEgc2luZ2xlIHBsdWdpbiB3YXMgbG9hZGVkIHR3aWNlLiBUaGlzIGhhcHBlbnMgd2hlbiBpdCBpcyBpbnN0YWxsZWQgYnkgbnBtL3lhcm4gaW4gdHdvIHZlcnNpb25zXG5cdFx0XHQgKiBhbmQgdXN1YWxseSBtZWFucyBvbmUgb3IgbW9yZSBvZiB0aGUgZm9sbG93aW5nIGlzc3Vlczpcblx0XHRcdCAqICAgICAqIGEgdmVyc2lvbiBtaXNtYXRjaCAodHdvIG9mIHlvdXIgZGVwZW5kZW5jaWVzIHJlcXVpcmUgdHdvIGRpZmZlcmVudCB2ZXJzaW9ucyBvZiB0aGlzIHBsdWdpbiksXG5cdFx0XHQgKiAgICAgKiBpbmNvcnJlY3QgaW1wb3J0cyAodGhpcyBwbHVnaW4gaXMgc29tZWhvdyBpbXBvcnRlZCB0d2ljZSBpbiBhIHdheSB3aGljaCBjb25mdXNlcyB3ZWJwYWNrKSxcblx0XHRcdCAqICAgICAqIG1lc3MgaW4gYG5vZGVfbW9kdWxlcy9gIChgcm0gLXJmIG5vZGVfbW9kdWxlcy9gIG1heSBoZWxwKS5cblx0XHRcdCAqXG5cdFx0XHQgKiAqKk5vdGU6KiogQ2hlY2sgdGhlIGxvZ2dlZCBgaXRlbU5hbWVgIHRvIGJldHRlciB1bmRlcnN0YW5kIHdoaWNoIHBsdWdpbiB3YXMgZHVwbGljYXRlZC9jb25mbGljdGluZy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcGFyYW0gaXRlbU5hbWUgVGhlIG5hbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnQgdGhhdCBpcyBiZWluZyByZWdpc3RlcmVkIHR3aWNlLlxuXHRcdFx0ICogQGVycm9yIHNjaGVtYS1jYW5ub3QtcmVnaXN0ZXItaXRlbS10d2ljZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdzY2hlbWEtY2Fubm90LXJlZ2lzdGVyLWl0ZW0tdHdpY2UnLCB0aGlzLCB7XG4gICAgICAgICAgICAgICAgaXRlbU5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NvdXJjZURlZmluaXRpb25zW2l0ZW1OYW1lXSA9IFtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oe30sIGRlZmluaXRpb24pXG4gICAgICAgIF07XG4gICAgICAgIHRoaXMuX2NsZWFyQ2FjaGUoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4dGVuZHMgYSB7QGxpbmsgI3JlZ2lzdGVyIHJlZ2lzdGVyZWR9IGl0ZW0ncyBkZWZpbml0aW9uLlxuXHQgKlxuXHQgKiBFeHRlbmRpbmcgcHJvcGVydGllcyBzdWNoIGFzIGBhbGxvd0luYCB3aWxsIGFkZCBtb3JlIGl0ZW1zIHRvIHRoZSBleGlzdGluZyBwcm9wZXJ0aWVzLFxuXHQgKiB3aGlsZSByZWRlZmluaW5nIHByb3BlcnRpZXMgc3VjaCBhcyBgaXNCbG9ja2Agd2lsbCBvdmVycmlkZSB0aGUgcHJldmlvdXNseSBkZWZpbmVkIG9uZXMuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5yZWdpc3RlciggJ2ZvbycsIHtcblx0ICogXHRhbGxvd0luOiAnJHJvb3QnLFxuXHQgKiBcdGlzQmxvY2s6IHRydWU7XG5cdCAqIH0gKTtcblx0ICogc2NoZW1hLmV4dGVuZCggJ2ZvbycsIHtcblx0ICogXHRhbGxvd0luOiAnYmxvY2tRdW90ZScsXG5cdCAqIFx0aXNCbG9jazogZmFsc2Vcblx0ICogfSApO1xuXHQgKlxuXHQgKiBzY2hlbWEuZ2V0RGVmaW5pdGlvbiggJ2ZvbycgKTtcblx0ICogLy9cdHtcblx0ICogLy9cdFx0YWxsb3dJbjogWyAnJHJvb3QnLCAnYmxvY2tRdW90ZScgXSxcblx0ICogLy8gXHRcdGlzQmxvY2s6IGZhbHNlXG5cdCAqIC8vXHR9XG5cdCAqIGBgYFxuXHQgKi8gZXh0ZW5kKGl0ZW1OYW1lLCBkZWZpbml0aW9uKSB7XG4gICAgICAgIGlmICghdGhpcy5fc291cmNlRGVmaW5pdGlvbnNbaXRlbU5hbWVdKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBleHRlbmQgYW4gaXRlbSB3aGljaCB3YXMgbm90IHJlZ2lzdGVyZWQgeWV0LlxuXHRcdFx0ICpcblx0XHRcdCAqIFRoaXMgZXJyb3IgaGFwcGVucyB3aGVuIGEgcGx1Z2luIHRyaWVzIHRvIGV4dGVuZCB0aGUgc2NoZW1hIGRlZmluaXRpb24gb2YgYW4gaXRlbSB3aGljaCB3YXMgbm90XG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI3JlZ2lzdGVyIHJlZ2lzdGVyZWR9IHlldC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAcGFyYW0gaXRlbU5hbWUgVGhlIG5hbWUgb2YgdGhlIG1vZGVsIGVsZW1lbnQgd2hpY2ggaXMgYmVpbmcgZXh0ZW5kZWQuXG5cdFx0XHQgKiBAZXJyb3Igc2NoZW1hLWNhbm5vdC1leHRlbmQtbWlzc2luZy1pdGVtXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3NjaGVtYS1jYW5ub3QtZXh0ZW5kLW1pc3NpbmctaXRlbScsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICBpdGVtTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc291cmNlRGVmaW5pdGlvbnNbaXRlbU5hbWVdLnB1c2goT2JqZWN0LmFzc2lnbih7fSwgZGVmaW5pdGlvbikpO1xuICAgICAgICB0aGlzLl9jbGVhckNhY2hlKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGRhdGEgb2YgYWxsIHJlZ2lzdGVyZWQgaXRlbXMuXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIHNob3VsZCBub3JtYWxseSBiZSB1c2VkIGZvciByZWZsZWN0aW9uIHB1cnBvc2VzIChlLmcuIGRlZmluaW5nIGEgY2xvbmUgb2YgYSBjZXJ0YWluIGVsZW1lbnQsXG5cdCAqIGNoZWNraW5nIGEgbGlzdCBvZiBhbGwgYmxvY2sgZWxlbWVudHMsIGV0YykuXG5cdCAqIFVzZSBzcGVjaWZpYyBtZXRob2RzIChzdWNoIGFzIHtAbGluayAjY2hlY2tDaGlsZCBgY2hlY2tDaGlsZCgpYH0gb3Ige0BsaW5rICNpc0xpbWl0IGBpc0xpbWl0KClgfSlcblx0ICogaW4gb3RoZXIgY2FzZXMuXG5cdCAqLyBnZXREZWZpbml0aW9ucygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9jb21waWxlZERlZmluaXRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLl9jb21waWxlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBpbGVkRGVmaW5pdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgZGVmaW5pdGlvbiBvZiB0aGUgZ2l2ZW4gaXRlbSBvciBgdW5kZWZpbmVkYCBpZiBhbiBpdGVtIGlzIG5vdCByZWdpc3RlcmVkLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBzaG91bGQgbm9ybWFsbHkgYmUgdXNlZCBmb3IgcmVmbGVjdGlvbiBwdXJwb3NlcyAoZS5nLiBkZWZpbmluZyBhIGNsb25lIG9mIGEgY2VydGFpbiBlbGVtZW50LFxuXHQgKiBjaGVja2luZyBhIGxpc3Qgb2YgYWxsIGJsb2NrIGVsZW1lbnRzLCBldGMpLlxuXHQgKiBVc2Ugc3BlY2lmaWMgbWV0aG9kcyAoc3VjaCBhcyB7QGxpbmsgI2NoZWNrQ2hpbGQgYGNoZWNrQ2hpbGQoKWB9IG9yIHtAbGluayAjaXNMaW1pdCBgaXNMaW1pdCgpYH0pXG5cdCAqIGluIG90aGVyIGNhc2VzLlxuXHQgKi8gZ2V0RGVmaW5pdGlvbihpdGVtKSB7XG4gICAgICAgIGxldCBpdGVtTmFtZTtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBpdGVtTmFtZSA9IGl0ZW07XG4gICAgICAgIH0gZWxzZSBpZiAoJ2lzJyBpbiBpdGVtICYmIChpdGVtLmlzKCckdGV4dCcpIHx8IGl0ZW0uaXMoJyR0ZXh0UHJveHknKSkpIHtcbiAgICAgICAgICAgIGl0ZW1OYW1lID0gJyR0ZXh0JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW1OYW1lID0gaXRlbS5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldERlZmluaXRpb25zKClbaXRlbU5hbWVdO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGl0ZW0gaXMgcmVnaXN0ZXJlZCBpbiB0aGUgc2NoZW1hLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzY2hlbWEuaXNSZWdpc3RlcmVkKCAncGFyYWdyYXBoJyApOyAvLyAtPiB0cnVlXG5cdCAqIHNjaGVtYS5pc1JlZ2lzdGVyZWQoIGVkaXRvci5tb2RlbC5kb2N1bWVudC5nZXRSb290KCkgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBzY2hlbWEuaXNSZWdpc3RlcmVkKCAnZm9vJyApOyAvLyAtPiBmYWxzZVxuXHQgKiBgYGBcblx0ICovIGlzUmVnaXN0ZXJlZChpdGVtKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuZ2V0RGVmaW5pdGlvbihpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBpdGVtIGlzIGRlZmluZWQgdG8gYmVcblx0ICogYSBibG9jayBieSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYUl0ZW1EZWZpbml0aW9ufSdzIGBpc0Jsb2NrYCBwcm9wZXJ0eS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmlzQmxvY2soICdwYXJhZ3JhcGgnICk7IC8vIC0+IHRydWVcblx0ICogc2NoZW1hLmlzQmxvY2soICckcm9vdCcgKTsgLy8gLT4gZmFsc2Vcblx0ICpcblx0ICogY29uc3QgcGFyYWdyYXBoRWxlbWVudCA9IHdyaXRlci5jcmVhdGVFbGVtZW50KCAncGFyYWdyYXBoJyApO1xuXHQgKiBzY2hlbWEuaXNCbG9jayggcGFyYWdyYXBoRWxlbWVudCApOyAvLyAtPiB0cnVlXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBTZWUgdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEjYmxvY2stZWxlbWVudHMgQmxvY2sgZWxlbWVudHN9IHNlY3Rpb24gb2Zcblx0ICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUgZm9yIG1vcmUgZGV0YWlscy5cblx0ICovIGlzQmxvY2soaXRlbSkge1xuICAgICAgICBjb25zdCBkZWYgPSB0aGlzLmdldERlZmluaXRpb24oaXRlbSk7XG4gICAgICAgIHJldHVybiAhIShkZWYgJiYgZGVmLmlzQmxvY2spO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGl0ZW0gc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBsaW1pdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBJdCBjb25zaWRlcnMgYW4gaXRlbSB0byBiZSBhIGxpbWl0IGVsZW1lbnQgaWYgaXRzXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFJdGVtRGVmaW5pdGlvbn0nc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hSXRlbURlZmluaXRpb24jaXNMaW1pdCBgaXNMaW1pdGB9IG9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFJdGVtRGVmaW5pdGlvbiNpc09iamVjdCBgaXNPYmplY3RgfSBwcm9wZXJ0eVxuXHQgKiB3YXMgc2V0IHRvIGB0cnVlYC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmlzTGltaXQoICdwYXJhZ3JhcGgnICk7IC8vIC0+IGZhbHNlXG5cdCAqIHNjaGVtYS5pc0xpbWl0KCAnJHJvb3QnICk7IC8vIC0+IHRydWVcblx0ICogc2NoZW1hLmlzTGltaXQoIGVkaXRvci5tb2RlbC5kb2N1bWVudC5nZXRSb290KCkgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBzY2hlbWEuaXNMaW1pdCggJ2ltYWdlQmxvY2snICk7IC8vIC0+IHRydWVcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB0aGUge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSNsaW1pdC1lbGVtZW50cyBMaW1pdCBlbGVtZW50c30gc2VjdGlvbiBvZlxuXHQgKiB0aGUge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSBTY2hlbWEgZGVlcC1kaXZlfSBndWlkZSBmb3IgbW9yZSBkZXRhaWxzLlxuXHQgKi8gaXNMaW1pdChpdGVtKSB7XG4gICAgICAgIGNvbnN0IGRlZiA9IHRoaXMuZ2V0RGVmaW5pdGlvbihpdGVtKTtcbiAgICAgICAgaWYgKCFkZWYpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISEoZGVmLmlzTGltaXQgfHwgZGVmLmlzT2JqZWN0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBpdGVtIHNob3VsZCBiZSB0cmVhdGVkIGFzIGFuIG9iamVjdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBJdCBjb25zaWRlcnMgYW4gaXRlbSB0byBiZSBhbiBvYmplY3QgZWxlbWVudCBpZiBpdHNcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYUl0ZW1EZWZpbml0aW9ufSdzXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFJdGVtRGVmaW5pdGlvbiNpc09iamVjdCBgaXNPYmplY3RgfSBwcm9wZXJ0eVxuXHQgKiB3YXMgc2V0IHRvIGB0cnVlYC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmlzT2JqZWN0KCAncGFyYWdyYXBoJyApOyAvLyAtPiBmYWxzZVxuXHQgKiBzY2hlbWEuaXNPYmplY3QoICdpbWFnZUJsb2NrJyApOyAvLyAtPiB0cnVlXG5cdCAqXG5cdCAqIGNvbnN0IGltYWdlRWxlbWVudCA9IHdyaXRlci5jcmVhdGVFbGVtZW50KCAnaW1hZ2VCbG9jaycgKTtcblx0ICogc2NoZW1hLmlzT2JqZWN0KCBpbWFnZUVsZW1lbnQgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBgYGBcblx0ICpcblx0ICogU2VlIHRoZSB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvc2NoZW1hI29iamVjdC1lbGVtZW50cyBPYmplY3QgZWxlbWVudHN9IHNlY3Rpb24gb2Zcblx0ICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUgZm9yIG1vcmUgZGV0YWlscy5cblx0ICovIGlzT2JqZWN0KGl0ZW0pIHtcbiAgICAgICAgY29uc3QgZGVmID0gdGhpcy5nZXREZWZpbml0aW9uKGl0ZW0pO1xuICAgICAgICBpZiAoIWRlZikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vdGU6IENoZWNrIG91dCB0aGUgaW1wbGVtZW50YXRpb24gb2YgI2lzTGltaXQoKSwgI2lzU2VsZWN0YWJsZSgpLCBhbmQgI2lzQ29udGVudCgpXG4gICAgICAgIC8vIHRvIHVuZGVyc3RhbmQgd2h5IHRoZXNlIHRocmVlIGNvbnN0aXR1dGUgYW4gb2JqZWN0LlxuICAgICAgICByZXR1cm4gISEoZGVmLmlzT2JqZWN0IHx8IGRlZi5pc0xpbWl0ICYmIGRlZi5pc1NlbGVjdGFibGUgJiYgZGVmLmlzQ29udGVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gaXRlbSBpcyBkZWZpbmVkIHRvIGJlXG5cdCAqIGFuIGlubGluZSBlbGVtZW50IGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hSXRlbURlZmluaXRpb259J3MgYGlzSW5saW5lYCBwcm9wZXJ0eS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmlzSW5saW5lKCAncGFyYWdyYXBoJyApOyAvLyAtPiBmYWxzZVxuXHQgKiBzY2hlbWEuaXNJbmxpbmUoICdzb2Z0QnJlYWsnICk7IC8vIC0+IHRydWVcblx0ICpcblx0ICogY29uc3QgdGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApO1xuXHQgKiBzY2hlbWEuaXNJbmxpbmUoIHRleHQgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBgYGBcblx0ICpcblx0ICogU2VlIHRoZSB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvc2NoZW1hI2lubGluZS1lbGVtZW50cyBJbmxpbmUgZWxlbWVudHN9IHNlY3Rpb24gb2Zcblx0ICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUgZm9yIG1vcmUgZGV0YWlscy5cblx0ICovIGlzSW5saW5lKGl0ZW0pIHtcbiAgICAgICAgY29uc3QgZGVmID0gdGhpcy5nZXREZWZpbml0aW9uKGl0ZW0pO1xuICAgICAgICByZXR1cm4gISEoZGVmICYmIGRlZi5pc0lubGluZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gaXRlbSBpcyBkZWZpbmVkIHRvIGJlXG5cdCAqIGEgc2VsZWN0YWJsZSBlbGVtZW50IGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hSXRlbURlZmluaXRpb259J3MgYGlzU2VsZWN0YWJsZWAgcHJvcGVydHkuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5pc1NlbGVjdGFibGUoICdwYXJhZ3JhcGgnICk7IC8vIC0+IGZhbHNlXG5cdCAqIHNjaGVtYS5pc1NlbGVjdGFibGUoICdoZWFkaW5nMScgKTsgLy8gLT4gZmFsc2Vcblx0ICogc2NoZW1hLmlzU2VsZWN0YWJsZSggJ2ltYWdlQmxvY2snICk7IC8vIC0+IHRydWVcblx0ICogc2NoZW1hLmlzU2VsZWN0YWJsZSggJ3RhYmxlQ2VsbCcgKTsgLy8gLT4gdHJ1ZVxuXHQgKlxuXHQgKiBjb25zdCB0ZXh0ID0gd3JpdGVyLmNyZWF0ZVRleHQoICdmb28nICk7XG5cdCAqIHNjaGVtYS5pc1NlbGVjdGFibGUoIHRleHQgKTsgLy8gLT4gZmFsc2Vcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB0aGUge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSNzZWxlY3RhYmxlLWVsZW1lbnRzIFNlbGVjdGFibGUgZWxlbWVudHMgc2VjdGlvbn0gb2Zcblx0ICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUgZm9yIG1vcmUgZGV0YWlscy5cblx0ICovIGlzU2VsZWN0YWJsZShpdGVtKSB7XG4gICAgICAgIGNvbnN0IGRlZiA9IHRoaXMuZ2V0RGVmaW5pdGlvbihpdGVtKTtcbiAgICAgICAgaWYgKCFkZWYpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISEoZGVmLmlzU2VsZWN0YWJsZSB8fCBkZWYuaXNPYmplY3QpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGl0ZW0gaXMgZGVmaW5lZCB0byBiZVxuXHQgKiBhIGNvbnRlbnQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFJdGVtRGVmaW5pdGlvbn0ncyBgaXNDb250ZW50YCBwcm9wZXJ0eS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmlzQ29udGVudCggJ3BhcmFncmFwaCcgKTsgLy8gLT4gZmFsc2Vcblx0ICogc2NoZW1hLmlzQ29udGVudCggJ2hlYWRpbmcxJyApOyAvLyAtPiBmYWxzZVxuXHQgKiBzY2hlbWEuaXNDb250ZW50KCAnaW1hZ2VCbG9jaycgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBzY2hlbWEuaXNDb250ZW50KCAnaG9yaXpvbnRhbExpbmUnICk7IC8vIC0+IHRydWVcblx0ICpcblx0ICogY29uc3QgdGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApO1xuXHQgKiBzY2hlbWEuaXNDb250ZW50KCB0ZXh0ICk7IC8vIC0+IHRydWVcblx0ICogYGBgXG5cdCAqXG5cdCAqIFNlZSB0aGUge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSNjb250ZW50LWVsZW1lbnRzIENvbnRlbnQgZWxlbWVudHMgc2VjdGlvbn0gb2Zcblx0ICogdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2RlZXAtZGl2ZS9zY2hlbWEgU2NoZW1hIGRlZXAtZGl2ZX0gZ3VpZGUgZm9yIG1vcmUgZGV0YWlscy5cblx0ICovIGlzQ29udGVudChpdGVtKSB7XG4gICAgICAgIGNvbnN0IGRlZiA9IHRoaXMuZ2V0RGVmaW5pdGlvbihpdGVtKTtcbiAgICAgICAgaWYgKCFkZWYpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gISEoZGVmLmlzQ29udGVudCB8fCBkZWYuaXNPYmplY3QpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGdpdmVuIG5vZGUgY2FuIGJlIGEgY2hpbGQgb2YgdGhlIGdpdmVuIGNvbnRleHQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5jaGVja0NoaWxkKCBtb2RlbC5kb2N1bWVudC5nZXRSb290KCksIHBhcmFncmFwaCApOyAvLyAtPiBmYWxzZVxuXHQgKlxuXHQgKiBzY2hlbWEucmVnaXN0ZXIoICdwYXJhZ3JhcGgnLCB7XG5cdCAqIFx0YWxsb3dJbjogJyRyb290J1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIHNjaGVtYS5jaGVja0NoaWxkKCBtb2RlbC5kb2N1bWVudC5nZXRSb290KCksIHBhcmFncmFwaCApOyAvLyAtPiB0cnVlXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBCb3RoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjYWRkQ2hpbGRDaGVjayBjYWxsYmFjayBjaGVja3N9IGFuZCBkZWNsYXJhdGl2ZSBydWxlcyAoYWRkZWQgd2hlblxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI3JlZ2lzdGVyIHJlZ2lzdGVyaW5nfSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNleHRlbmQgZXh0ZW5kaW5nfSBpdGVtcylcblx0ICogYXJlIGV2YWx1YXRlZCB3aGVuIHRoaXMgbWV0aG9kIGlzIGNhbGxlZC5cblx0ICpcblx0ICogTm90ZSB0aGF0IGNhbGxiYWNrIGNoZWNrcyBoYXZlIGJpZ2dlciBwcmlvcml0eSB0aGFuIGRlY2xhcmF0aXZlIHJ1bGVzIGNoZWNrcyBhbmQgbWF5IG92ZXJ3cml0ZSB0aGVtLlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgd2hlbiB2ZXJpZnlpbmcgd2hldGhlciB0aGUgZ2l2ZW4gbm9kZSBjYW4gYmUgYSBjaGlsZCBvZiB0aGUgZ2l2ZW4gY29udGV4dCwgdGhlIHNjaGVtYSBhbHNvIHZlcmlmaWVzIHRoZSBlbnRpcmVcblx0ICogY29udGV4dCAmbmRhc2g7IGZyb20gaXRzIHJvb3QgdG8gaXRzIGxhc3QgZWxlbWVudC4gVGhlcmVmb3JlLCBpdCBpcyBwb3NzaWJsZSBmb3IgYGNoZWNrQ2hpbGQoKWAgdG8gcmV0dXJuIGBmYWxzZWAgZXZlbiB0aG91Z2hcblx0ICogdGhlIGBjb250ZXh0YCBsYXN0IGVsZW1lbnQgY2FuIGNvbnRhaW4gdGhlIGNoZWNrZWQgY2hpbGQuIEl0IGhhcHBlbnMgaWYgb25lIG9mIHRoZSBgY29udGV4dGAgZWxlbWVudHMgZG9lcyBub3QgYWxsb3cgaXRzIGNoaWxkLlxuXHQgKiBXaGVuIGBjb250ZXh0YCBpcyB2ZXJpZmllZCwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNhZGRDaGlsZENoZWNrIGN1c3RvbSBjaGVja3N9IGFyZSBjb25zaWRlcmVkIGFzIHdlbGwuXG5cdCAqXG5cdCAqIEBmaXJlcyBjaGVja0NoaWxkXG5cdCAqIEBwYXJhbSBjb250ZXh0IFRoZSBjb250ZXh0IGluIHdoaWNoIHRoZSBjaGlsZCB3aWxsIGJlIGNoZWNrZWQuXG5cdCAqIEBwYXJhbSBkZWYgVGhlIGNoaWxkIHRvIGNoZWNrLlxuXHQgKi8gY2hlY2tDaGlsZChjb250ZXh0LCBkZWYpIHtcbiAgICAgICAgLy8gTm90ZTogYGNvbnRleHRgIGFuZCBgZGVmYCBhcmUgYWxyZWFkeSBub3JtYWxpemVkIGhlcmUgdG8gYFNjaGVtYUNvbnRleHRgIGFuZCBgU2NoZW1hQ29tcGlsZWRJdGVtRGVmaW5pdGlvbmAuXG4gICAgICAgIGlmICghZGVmKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrQ29udGV4dE1hdGNoKGNvbnRleHQsIGRlZik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gYXR0cmlidXRlIGNhbiBiZSBhcHBsaWVkIGluIHRoZSBnaXZlbiBjb250ZXh0IChvbiB0aGUgbGFzdCBpdGVtIG9mIHRoZSBjb250ZXh0KS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogc2NoZW1hLmNoZWNrQXR0cmlidXRlKCB0ZXh0Tm9kZSwgJ2JvbGQnICk7IC8vIC0+IGZhbHNlXG5cdCAqXG5cdCAqIHNjaGVtYS5leHRlbmQoICckdGV4dCcsIHtcblx0ICogXHRhbGxvd0F0dHJpYnV0ZXM6ICdib2xkJ1xuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIHNjaGVtYS5jaGVja0F0dHJpYnV0ZSggdGV4dE5vZGUsICdib2xkJyApOyAvLyAtPiB0cnVlXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBCb3RoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjYWRkQXR0cmlidXRlQ2hlY2sgY2FsbGJhY2sgY2hlY2tzfSBhbmQgZGVjbGFyYXRpdmUgcnVsZXMgKGFkZGVkIHdoZW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNyZWdpc3RlciByZWdpc3RlcmluZ30gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjZXh0ZW5kIGV4dGVuZGluZ30gaXRlbXMpXG5cdCAqIGFyZSBldmFsdWF0ZWQgd2hlbiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBjYWxsYmFjayBjaGVja3MgaGF2ZSBiaWdnZXIgcHJpb3JpdHkgdGhhbiBkZWNsYXJhdGl2ZSBydWxlcyBjaGVja3MgYW5kIG1heSBvdmVyd3JpdGUgdGhlbS5cblx0ICpcblx0ICogQGZpcmVzIGNoZWNrQXR0cmlidXRlXG5cdCAqIEBwYXJhbSBjb250ZXh0IFRoZSBjb250ZXh0IGluIHdoaWNoIHRoZSBhdHRyaWJ1dGUgd2lsbCBiZSBjaGVja2VkLlxuXHQgKiBAcGFyYW0gYXR0cmlidXRlTmFtZSBOYW1lIG9mIGF0dHJpYnV0ZSB0byBjaGVjayBpbiB0aGUgZ2l2ZW4gY29udGV4dC5cblx0ICovIGNoZWNrQXR0cmlidXRlKGNvbnRleHQsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgLy8gTm90ZTogYGNvbnRleHRgIGlzIGFscmVhZHkgbm9ybWFsaXplZCBoZXJlIHRvIGBTY2hlbWFDb250ZXh0YC5cbiAgICAgICAgY29uc3QgZGVmID0gdGhpcy5nZXREZWZpbml0aW9uKGNvbnRleHQubGFzdCk7XG4gICAgICAgIGlmICghZGVmKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRmlyc3QsIGNoZWNrIGFsbCBhdHRyaWJ1dGUgY2hlY2tzIGRlY2xhcmVkIGFzIGNhbGxiYWNrcy5cbiAgICAgICAgLy8gTm90ZSB0aGF0IGBfZXZhbHVhdGVBdHRyaWJ1dGVDaGVja3MoKWAgd2lsbCByZXR1cm4gYHVuZGVmaW5lZGAgaWYgbmVpdGhlciBjaGlsZCBjaGVjayB3YXMgYXBwbGljYWJsZSAobm8gZGVjaXNpb24gd2FzIG1hZGUpLlxuICAgICAgICBjb25zdCBpc0FsbG93ZWQgPSB0aGlzLl9ldmFsdWF0ZUF0dHJpYnV0ZUNoZWNrcyhjb250ZXh0LCBhdHRyaWJ1dGVOYW1lKTtcbiAgICAgICAgLy8gSWYgdGhlIGRlY2lzaW9uIHdhcyBub3QgbWFkZSBpbnNpZGUgYXR0cmlidXRlIGNoZWNrIGNhbGxiYWNrcywgdGhlbiB1c2UgZGVjbGFyYXRpdmUgcnVsZXMuXG4gICAgICAgIHJldHVybiBpc0FsbG93ZWQgIT09IHVuZGVmaW5lZCA/IGlzQWxsb3dlZCA6IGRlZi5hbGxvd0F0dHJpYnV0ZXMuaW5jbHVkZXMoYXR0cmlidXRlTmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gZWxlbWVudCAoYGVsZW1lbnRUb01lcmdlYCkgY2FuIGJlIG1lcmdlZCB3aXRoIHRoZSBzcGVjaWZpZWQgYmFzZSBlbGVtZW50IChgcG9zaXRpb25PckJhc2VFbGVtZW50YCkuXG5cdCAqXG5cdCAqIEluIG90aGVyIHdvcmRzICZuZGFzaDsgYm90aCBlbGVtZW50cyBhcmUgbm90IGEgbGltaXQgZWxlbWVudHMgYW5kIHdoZXRoZXIgYGVsZW1lbnRUb01lcmdlYCdzIGNoaWxkcmVuXG5cdCAqIHtAbGluayAjY2hlY2tDaGlsZCBhcmUgYWxsb3dlZH0gaW4gdGhlIGBwb3NpdGlvbk9yQmFzZUVsZW1lbnRgLlxuXHQgKlxuXHQgKiBUaGlzIGNoZWNrIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBtZXJnZWQgd2l0aCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI21lcmdlIGBXcml0ZXIjbWVyZ2UoKWB9XG5cdCAqIHdpbGwgYmUgdmFsaWQuXG5cdCAqXG5cdCAqIEluc3RlYWQgb2YgZWxlbWVudHMsIHlvdSBjYW4gcGFzcyB0aGUgaW5zdGFuY2Ugb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBjbGFzcyBhcyB0aGVcblx0ICogYHBvc2l0aW9uT3JCYXNlRWxlbWVudGAuIEl0IG1lYW5zIHRoYXQgdGhlIGVsZW1lbnRzIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIHBvc2l0aW9uIHdpbGwgYmUgY2hlY2tlZCB3aGV0aGVyIHRoZXkgY2FuIGJlIG1lcmdlZC5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uT3JCYXNlRWxlbWVudCBUaGUgcG9zaXRpb24gb3IgYmFzZSBlbGVtZW50IHRvIHdoaWNoIHRoZSBgZWxlbWVudFRvTWVyZ2VgIHdpbGwgYmUgbWVyZ2VkLlxuXHQgKiBAcGFyYW0gZWxlbWVudFRvTWVyZ2UgVGhlIGVsZW1lbnQgdG8gbWVyZ2UuIFJlcXVpcmVkIGlmIGBwb3NpdGlvbk9yQmFzZUVsZW1lbnRgIGlzIGFuIGVsZW1lbnQuXG5cdCAqLyBjaGVja01lcmdlKHBvc2l0aW9uT3JCYXNlRWxlbWVudCwgZWxlbWVudFRvTWVyZ2UpIHtcbiAgICAgICAgaWYgKHBvc2l0aW9uT3JCYXNlRWxlbWVudCBpbnN0YW5jZW9mIFBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gcG9zaXRpb25PckJhc2VFbGVtZW50Lm5vZGVCZWZvcmU7XG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXIgPSBwb3NpdGlvbk9yQmFzZUVsZW1lbnQubm9kZUFmdGVyO1xuICAgICAgICAgICAgaWYgKCEobm9kZUJlZm9yZSBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFRoZSBub2RlIGJlZm9yZSB0aGUgbWVyZ2UgcG9zaXRpb24gbXVzdCBiZSBhbiBlbGVtZW50LlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3Igc2NoZW1hLWNoZWNrLW1lcmdlLW5vLWVsZW1lbnQtYmVmb3JlXG5cdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignc2NoZW1hLWNoZWNrLW1lcmdlLW5vLWVsZW1lbnQtYmVmb3JlJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIShub2RlQWZ0ZXIgaW5zdGFuY2VvZiBFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUaGUgbm9kZSBhZnRlciB0aGUgbWVyZ2UgcG9zaXRpb24gbXVzdCBiZSBhbiBlbGVtZW50LlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3Igc2NoZW1hLWNoZWNrLW1lcmdlLW5vLWVsZW1lbnQtYWZ0ZXJcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdzY2hlbWEtY2hlY2stbWVyZ2Utbm8tZWxlbWVudC1hZnRlcicsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tNZXJnZShub2RlQmVmb3JlLCBub2RlQWZ0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzTGltaXQocG9zaXRpb25PckJhc2VFbGVtZW50KSB8fCB0aGlzLmlzTGltaXQoZWxlbWVudFRvTWVyZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBlbGVtZW50VG9NZXJnZS5nZXRDaGlsZHJlbigpKXtcbiAgICAgICAgICAgIGlmICghdGhpcy5jaGVja0NoaWxkKHBvc2l0aW9uT3JCYXNlRWxlbWVudCwgY2hpbGQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQWxsb3dzIHJlZ2lzdGVyaW5nIGEgY2FsbGJhY2sgdG8gdGhlIHtAbGluayAjY2hlY2tDaGlsZH0gbWV0aG9kIGNhbGxzLlxuXHQgKlxuXHQgKiBDYWxsYmFja3MgYWxsb3cgeW91IHRvIGltcGxlbWVudCBydWxlcyB3aGljaCBhcmUgbm90IG90aGVyd2lzZSBwb3NzaWJsZSB0byBhY2hpZXZlXG5cdCAqIGJ5IHVzaW5nIHRoZSBkZWNsYXJhdGl2ZSBBUEkgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYUl0ZW1EZWZpbml0aW9ufS5cblx0ICpcblx0ICogTm90ZSB0aGF0IGNhbGxiYWNrIGNoZWNrcyBoYXZlIGJpZ2dlciBwcmlvcml0eSB0aGFuIGRlY2xhcmF0aXZlIHJ1bGVzIGNoZWNrcyBhbmQgbWF5IG92ZXJ3cml0ZSB0aGVtLlxuXHQgKlxuXHQgKiBGb3IgZXhhbXBsZSwgYnkgdXNpbmcgdGhpcyBtZXRob2QgeW91IGNhbiBkaXNhbGxvdyBlbGVtZW50cyBpbiBzcGVjaWZpYyBjb250ZXh0czpcblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gRGlzYWxsb3cgYGhlYWRpbmcxYCBpbnNpZGUgYSBgYmxvY2tRdW90ZWAgdGhhdCBpcyBpbnNpZGUgYSB0YWJsZS5cblx0ICogc2NoZW1hLmFkZENoaWxkQ2hlY2soICggY29udGV4dCwgY2hpbGREZWZpbml0aW9uICkgPT4ge1xuXHQgKiBcdGlmICggY29udGV4dC5lbmRzV2l0aCggJ3RhYmxlQ2VsbCBibG9ja1F1b3RlJyApICkge1xuXHQgKiBcdFx0cmV0dXJuIGZhbHNlO1xuXHQgKiBcdH1cblx0ICogfSwgJ2hlYWRpbmcxJyApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogWW91IGNhbiBza2lwIHRoZSBvcHRpb25hbCBgaXRlbU5hbWVgIHBhcmFtZXRlciB0byBldmFsdWF0ZSB0aGUgY2FsbGJhY2sgZm9yIGV2ZXJ5IGBjaGVja0NoaWxkKClgIGNhbGwuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEluc2lkZSBzcGVjaWZpYyBjdXN0b20gZWxlbWVudCwgYWxsb3cgb25seSBjaGlsZHJlbiwgd2hpY2ggYWxsb3dzIGZvciBhIHNwZWNpZmljIGF0dHJpYnV0ZS5cblx0ICogc2NoZW1hLmFkZENoaWxkQ2hlY2soICggY29udGV4dCwgY2hpbGREZWZpbml0aW9uICkgPT4ge1xuXHQgKiBcdGlmICggY29udGV4dC5lbmRzV2l0aCggJ215RWxlbWVudCcgKSApIHtcblx0ICogXHRcdHJldHVybiBjaGlsZERlZmluaXRpb24uYWxsb3dBdHRyaWJ1dGVzLmluY2x1ZGVzKCAnbXlBdHRyaWJ1dGUnICk7XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoZSBnZW5lcmljIGNhbGxiYWNrcyBtYXkgYWZmZWN0IHRoZSBlZGl0b3IgcGVyZm9ybWFuY2UgYW5kIHNob3VsZCBiZSBhdm9pZGVkIGlmIHBvc3NpYmxlLlxuXHQgKlxuXHQgKiBXaGVuIG9uZSBvZiB0aGUgY2FsbGJhY2tzIG1ha2VzIGEgZGVjaXNpb24gKHJldHVybnMgYHRydWVgIG9yIGBmYWxzZWApIHRoZSBwcm9jZXNzaW5nIGlzIGZpbmlzaGVkIGFuZCBvdGhlciBjYWxsYmFja3MgYXJlIG5vdCBmaXJlZC5cblx0ICogQ2FsbGJhY2tzIGFyZSBmaXJlZCBpbiB0aGUgb3JkZXIgdGhleSB3ZXJlIGFkZGVkLCBob3dldmVyIGdlbmVyaWMgY2FsbGJhY2tzIGFyZSBmaXJlZCBiZWZvcmUgY2FsbGJhY2tzIGFkZGVkIGZvciBhIHNwZWNpZmllZCBpdGVtLlxuXHQgKlxuXHQgKiBZb3UgY2FuIGFsc28gdXNlIGBjaGVja0NoaWxkYCBldmVudCwgaWYgeW91IG5lZWQgZXZlbiBiZXR0ZXIgY29udHJvbC4gVGhlIHJlc3VsdCBmcm9tIHRoZSBleGFtcGxlIGFib3ZlIGNvdWxkIGFsc28gYmVcblx0ICogYWNoaWV2ZWQgd2l0aCBmb2xsb3dpbmcgZXZlbnQgY2FsbGJhY2s6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5vbiggJ2NoZWNrQ2hpbGQnLCAoIGV2dCwgYXJncyApID0+IHtcblx0ICogXHRjb25zdCBjb250ZXh0ID0gYXJnc1sgMCBdO1xuXHQgKiBcdGNvbnN0IGNoaWxkRGVmaW5pdGlvbiA9IGFyZ3NbIDEgXTtcblx0ICpcblx0ICogXHRpZiAoIGNvbnRleHQuZW5kc1dpdGgoICdteUVsZW1lbnQnICkgKSB7XG5cdCAqIFx0XHQvLyBQcmV2ZW50IG5leHQgbGlzdGVuZXJzIGZyb20gYmVpbmcgY2FsbGVkLlxuXHQgKiBcdFx0ZXZ0LnN0b3AoKTtcblx0ICogXHRcdC8vIFNldCB0aGUgYGNoZWNrQ2hpbGQoKWAgcmV0dXJuIHZhbHVlLlxuXHQgKiBcdFx0ZXZ0LnJldHVybiA9IGNoaWxkRGVmaW5pdGlvbi5hbGxvd0F0dHJpYnV0ZXMuaW5jbHVkZXMoICdteUF0dHJpYnV0ZScgKTtcblx0ICogXHR9XG5cdCAqIH0sIHsgcHJpb3JpdHk6ICdoaWdoJyB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgdGhlIGNhbGxiYWNrIGNoZWNrcyBhbmQgZGVjbGFyYXRpdmUgcnVsZXMgY2hlY2tzIGFyZSBwcm9jZXNzZWQgb24gYG5vcm1hbGAgcHJpb3JpdHkuXG5cdCAqXG5cdCAqIEFkZGluZyBjYWxsYmFja3MgdGhpcyB3YXkgY2FuIGFsc28gbmVnYXRpdmVseSBpbXBhY3QgZWRpdG9yIHBlcmZvcm1hbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGJlIGNhbGxlZC4gSXQgaXMgY2FsbGVkIHdpdGggdHdvIHBhcmFtZXRlcnM6XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFDb250ZXh0fSAoY29udGV4dCkgaW5zdGFuY2UgYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFDb21waWxlZEl0ZW1EZWZpbml0aW9ufSAoZGVmaW5pdGlvbikuIFRoZSBjYWxsYmFjayBtYXkgcmV0dXJuIGB0cnVlL2ZhbHNlYCB0byBvdmVycmlkZVxuXHQgKiBgY2hlY2tDaGlsZCgpYCdzIHJldHVybiB2YWx1ZS4gSWYgaXQgZG9lcyBub3QgcmV0dXJuIGEgYm9vbGVhbiB2YWx1ZSwgdGhlIGRlZmF1bHQgYWxnb3JpdGhtIChvciBvdGhlciBjYWxsYmFja3MpIHdpbGwgZGVmaW5lXG5cdCAqIGBjaGVja0NoaWxkKClgJ3MgcmV0dXJuIHZhbHVlLlxuXHQgKiBAcGFyYW0gaXRlbU5hbWUgTmFtZSBvZiB0aGUgc2NoZW1hIGl0ZW0gZm9yIHdoaWNoIHRoZSBjYWxsYmFjayBpcyByZWdpc3RlcmVkLiBJZiBzcGVjaWZpZWQsIHRoZSBjYWxsYmFjayB3aWxsIGJlIHJ1biBvbmx5IGZvclxuXHQgKiBgY2hlY2tDaGlsZCgpYCBjYWxscyB3aGljaCBgZGVmYCBwYXJhbWV0ZXIgbWF0Y2hlcyB0aGUgYGl0ZW1OYW1lYC4gT3RoZXJ3aXNlLCB0aGUgY2FsbGJhY2sgd2lsbCBydW4gZm9yIGV2ZXJ5IGBjaGVja0NoaWxkYCBjYWxsLlxuXHQgKi8gYWRkQ2hpbGRDaGVjayhjYWxsYmFjaywgaXRlbU5hbWUpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gaXRlbU5hbWUgIT09IHVuZGVmaW5lZCA/IGl0ZW1OYW1lIDogdGhpcy5fZ2VuZXJpY0NoZWNrU3ltYm9sO1xuICAgICAgICBjb25zdCBjaGVja3MgPSB0aGlzLl9jdXN0b21DaGlsZENoZWNrcy5nZXQoa2V5KSB8fCBbXTtcbiAgICAgICAgY2hlY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICB0aGlzLl9jdXN0b21DaGlsZENoZWNrcy5zZXQoa2V5LCBjaGVja3MpO1xuICAgIH1cbiAgICAvKipcblx0ICogQWxsb3dzIHJlZ2lzdGVyaW5nIGEgY2FsbGJhY2sgdG8gdGhlIHtAbGluayAjY2hlY2tBdHRyaWJ1dGV9IG1ldGhvZCBjYWxscy5cblx0ICpcblx0ICogQ2FsbGJhY2tzIGFsbG93IHlvdSB0byBpbXBsZW1lbnQgcnVsZXMgd2hpY2ggYXJlIG5vdCBvdGhlcndpc2UgcG9zc2libGUgdG8gYWNoaWV2ZVxuXHQgKiBieSB1c2luZyB0aGUgZGVjbGFyYXRpdmUgQVBJIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFJdGVtRGVmaW5pdGlvbn0uXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBjYWxsYmFjayBjaGVja3MgaGF2ZSBiaWdnZXIgcHJpb3JpdHkgdGhhbiBkZWNsYXJhdGl2ZSBydWxlcyBjaGVja3MgYW5kIG1heSBvdmVyd3JpdGUgdGhlbS5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUsIGJ5IHVzaW5nIHRoaXMgbWV0aG9kIHlvdSBjYW4gZGlzYWxsb3cgc2V0dGluZyBhdHRyaWJ1dGVzIG9uIG5vZGVzIGluIHNwZWNpZmljIGNvbnRleHRzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBEaXNhbGxvdyBzZXR0aW5nIGBib2xkYCBvbiB0ZXh0IGluc2lkZSBgaGVhZGluZzFgIGVsZW1lbnQ6XG5cdCAqIHNjaGVtYS5hZGRBdHRyaWJ1dGVDaGVjayggY29udGV4dCA9PiB7XG5cdCAqIFx0aWYgKCBjb250ZXh0LmVuZHNXaXRoKCAnaGVhZGluZzEgJHRleHQnICkgKSB7XG5cdCAqIFx0XHRyZXR1cm4gZmFsc2U7XG5cdCAqIFx0fVxuXHQgKiB9LCAnYm9sZCcgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFlvdSBjYW4gc2tpcCB0aGUgb3B0aW9uYWwgYGF0dHJpYnV0ZU5hbWVgIHBhcmFtZXRlciB0byBldmFsdWF0ZSB0aGUgY2FsbGJhY2sgZm9yIGV2ZXJ5IGBjaGVja0F0dHJpYnV0ZSgpYCBjYWxsLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBEaXNhbGxvdyBmb3JtYXR0aW5nIGF0dHJpYnV0ZXMgb24gdGV4dCBpbnNpZGUgY3VzdG9tIGBteVRpdGxlYCBlbGVtZW50OlxuXHQgKiBzY2hlbWEuYWRkQXR0cmlidXRlQ2hlY2soICggY29udGV4dCwgYXR0cmlidXRlTmFtZSApID0+IHtcblx0ICogXHRpZiAoIGNvbnRleHQuZW5kc1dpdGgoICdteVRpdGxlICR0ZXh0JyApICYmIHNjaGVtYS5nZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKCBhdHRyaWJ1dGVOYW1lICkuaXNGb3JtYXR0aW5nICkge1xuXHQgKiBcdFx0cmV0dXJuIGZhbHNlO1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogUGxlYXNlIG5vdGUgdGhhdCB0aGUgZ2VuZXJpYyBjYWxsYmFja3MgbWF5IGFmZmVjdCB0aGUgZWRpdG9yIHBlcmZvcm1hbmNlIGFuZCBzaG91bGQgYmUgYXZvaWRlZCBpZiBwb3NzaWJsZS5cblx0ICpcblx0ICogV2hlbiBvbmUgb2YgdGhlIGNhbGxiYWNrcyBtYWtlcyBhIGRlY2lzaW9uIChyZXR1cm5zIGB0cnVlYCBvciBgZmFsc2VgKSB0aGUgcHJvY2Vzc2luZyBpcyBmaW5pc2hlZCBhbmQgb3RoZXIgY2FsbGJhY2tzIGFyZSBub3QgZmlyZWQuXG5cdCAqIENhbGxiYWNrcyBhcmUgZmlyZWQgaW4gdGhlIG9yZGVyIHRoZXkgd2VyZSBhZGRlZCwgaG93ZXZlciBnZW5lcmljIGNhbGxiYWNrcyBhcmUgZmlyZWQgYmVmb3JlIGNhbGxiYWNrcyBhZGRlZCBmb3IgYSBzcGVjaWZpZWQgaXRlbS5cblx0ICpcblx0ICogWW91IGNhbiBhbHNvIHVzZSB7QGxpbmsgI2V2ZW50OmNoZWNrQXR0cmlidXRlfSBldmVudCwgaWYgeW91IG5lZWQgZXZlbiBiZXR0ZXIgY29udHJvbC4gVGhlIHJlc3VsdCBmcm9tIHRoZSBleGFtcGxlIGFib3ZlIGNvdWxkIGFsc29cblx0ICogYmUgYWNoaWV2ZWQgd2l0aCBmb2xsb3dpbmcgZXZlbnQgY2FsbGJhY2s6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5vbiggJ2NoZWNrQXR0cmlidXRlJywgKCBldnQsIGFyZ3MgKSA9PiB7XG5cdCAqIFx0Y29uc3QgY29udGV4dCA9IGFyZ3NbIDAgXTtcblx0ICogXHRjb25zdCBhdHRyaWJ1dGVOYW1lID0gYXJnc1sgMSBdO1xuXHQgKlxuXHQgKiBcdGlmICggY29udGV4dC5lbmRzV2l0aCggJ215VGl0bGUgJHRleHQnICkgJiYgc2NoZW1hLmdldEF0dHJpYnV0ZVByb3BlcnRpZXMoIGF0dHJpYnV0ZU5hbWUgKS5pc0Zvcm1hdHRpbmcgKSB7XG5cdCAqIFx0XHQvLyBQcmV2ZW50IG5leHQgbGlzdGVuZXJzIGZyb20gYmVpbmcgY2FsbGVkLlxuXHQgKiBcdFx0ZXZ0LnN0b3AoKTtcblx0ICogXHRcdC8vIFNldCB0aGUgYGNoZWNrQXR0cmlidXRlKClgIHJldHVybiB2YWx1ZS5cblx0ICogXHRcdGV2dC5yZXR1cm4gPSBmYWxzZTtcblx0ICogXHR9XG5cdCAqIH0sIHsgcHJpb3JpdHk6ICdoaWdoJyB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgdGhlIGNhbGxiYWNrIGNoZWNrcyBhbmQgZGVjbGFyYXRpdmUgcnVsZXMgY2hlY2tzIGFyZSBwcm9jZXNzZWQgb24gYG5vcm1hbGAgcHJpb3JpdHkuXG5cdCAqXG5cdCAqIEFkZGluZyBjYWxsYmFja3MgdGhpcyB3YXkgY2FuIGFsc28gbmVnYXRpdmVseSBpbXBhY3QgZWRpdG9yIHBlcmZvcm1hbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIHRvIGJlIGNhbGxlZC4gSXQgaXMgY2FsbGVkIHdpdGggdHdvIHBhcmFtZXRlcnM6XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWFDb250ZXh0IGBjb250ZXh0YH0gYW5kIGF0dHJpYnV0ZSBuYW1lLiBUaGUgY2FsbGJhY2sgbWF5IHJldHVybiBgdHJ1ZWAgb3IgYGZhbHNlYCwgdG9cblx0ICogb3ZlcnJpZGUgYGNoZWNrQXR0cmlidXRlKClgJ3MgcmV0dXJuIHZhbHVlLiBJZiBpdCBkb2VzIG5vdCByZXR1cm4gYSBib29sZWFuIHZhbHVlLCB0aGUgZGVmYXVsdCBhbGdvcml0aG0gKG9yIG90aGVyIGNhbGxiYWNrcylcblx0ICogd2lsbCBkZWZpbmUgYGNoZWNrQXR0cmlidXRlKClgJ3MgcmV0dXJuIHZhbHVlLlxuXHQgKiBAcGFyYW0gYXR0cmlidXRlTmFtZSBOYW1lIG9mIHRoZSBhdHRyaWJ1dGUgZm9yIHdoaWNoIHRoZSBjYWxsYmFjayBpcyByZWdpc3RlcmVkLiBJZiBzcGVjaWZpZWQsIHRoZSBjYWxsYmFjayB3aWxsIGJlIHJ1biBvbmx5IGZvclxuXHQgKiBgY2hlY2tBdHRyaWJ1dGUoKWAgY2FsbHMgd2l0aCBtYXRjaGluZyBgYXR0cmlidXRlTmFtZWAuIE90aGVyd2lzZSwgdGhlIGNhbGxiYWNrIHdpbGwgcnVuIGZvciBldmVyeSBgY2hlY2tBdHRyaWJ1dGUoKWAgY2FsbC5cblx0ICovIGFkZEF0dHJpYnV0ZUNoZWNrKGNhbGxiYWNrLCBhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGF0dHJpYnV0ZU5hbWUgIT09IHVuZGVmaW5lZCA/IGF0dHJpYnV0ZU5hbWUgOiB0aGlzLl9nZW5lcmljQ2hlY2tTeW1ib2w7XG4gICAgICAgIGNvbnN0IGNoZWNrcyA9IHRoaXMuX2N1c3RvbUF0dHJpYnV0ZUNoZWNrcy5nZXQoa2V5KSB8fCBbXTtcbiAgICAgICAgY2hlY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICB0aGlzLl9jdXN0b21BdHRyaWJ1dGVDaGVja3Muc2V0KGtleSwgY2hlY2tzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoaXMgbWV0aG9kIGFsbG93cyBhc3NpZ25pbmcgYWRkaXRpb25hbCBtZXRhZGF0YSB0byB0aGUgbW9kZWwgYXR0cmlidXRlcy4gRm9yIGV4YW1wbGUsXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5BdHRyaWJ1dGVQcm9wZXJ0aWVzIGBBdHRyaWJ1dGVQcm9wZXJ0aWVzI2lzRm9ybWF0dGluZ2AgcHJvcGVydHl9IGlzXG5cdCAqIHVzZWQgdG8gbWFyayBmb3JtYXR0aW5nIGF0dHJpYnV0ZXMgKGxpa2UgYGJvbGRgIG9yIGBpdGFsaWNgKS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gTWFyayBib2xkIGFzIGEgZm9ybWF0dGluZyBhdHRyaWJ1dGUuXG5cdCAqIHNjaGVtYS5zZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKCAnYm9sZCcsIHtcblx0ICogXHRpc0Zvcm1hdHRpbmc6IHRydWVcblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBPdmVycmlkZSBjb2RlIG5vdCB0byBiZSBjb25zaWRlcmVkIGEgZm9ybWF0dGluZyBtYXJrdXAuXG5cdCAqIHNjaGVtYS5zZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKCAnY29kZScsIHtcblx0ICogXHRpc0Zvcm1hdHRpbmc6IGZhbHNlXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFByb3BlcnRpZXMgYXJlIG5vdCBsaW1pdGVkIHRvIG1lbWJlcnMgZGVmaW5lZCBpbiB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hfkF0dHJpYnV0ZVByb3BlcnRpZXMgYEF0dHJpYnV0ZVByb3BlcnRpZXNgIHR5cGV9IGFuZCB5b3UgY2FuIGFsc28gdXNlIGN1c3RvbSBwcm9wZXJ0aWVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBzY2hlbWEuc2V0QXR0cmlidXRlUHJvcGVydGllcyggJ2Jsb2NrUXVvdGUnLCB7XG5cdCAqIFx0Y3VzdG9tUHJvcGVydHk6ICd2YWx1ZSdcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogU3Vic2VxdWVudCBjYWxscyB3aXRoIHRoZSBzYW1lIGF0dHJpYnV0ZSB3aWxsIGV4dGVuZCBpdHMgY3VzdG9tIHByb3BlcnRpZXM6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHNjaGVtYS5zZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKCAnYmxvY2tRdW90ZScsIHtcblx0ICogXHRvbmU6IDFcblx0ICogfSApO1xuXHQgKlxuXHQgKiBzY2hlbWEuc2V0QXR0cmlidXRlUHJvcGVydGllcyggJ2Jsb2NrUXVvdGUnLCB7XG5cdCAqIFx0dHdvOiAyXG5cdCAqIH0gKTtcblx0ICpcblx0ICogY29uc29sZS5sb2coIHNjaGVtYS5nZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKCAnYmxvY2tRdW90ZScgKSApO1xuXHQgKiAvLyBMb2dzOiB7IG9uZTogMSwgdHdvOiAyIH1cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVOYW1lIEEgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIHJlY2VpdmUgdGhlIHByb3BlcnRpZXMuXG5cdCAqIEBwYXJhbSBwcm9wZXJ0aWVzIEEgZGljdGlvbmFyeSBvZiBwcm9wZXJ0aWVzLlxuXHQgKi8gc2V0QXR0cmlidXRlUHJvcGVydGllcyhhdHRyaWJ1dGVOYW1lLCBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIHRoaXMuX2F0dHJpYnV0ZVByb3BlcnRpZXNbYXR0cmlidXRlTmFtZV0gPSBPYmplY3QuYXNzaWduKHRoaXMuZ2V0QXR0cmlidXRlUHJvcGVydGllcyhhdHRyaWJ1dGVOYW1lKSwgcHJvcGVydGllcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHByb3BlcnRpZXMgYXNzb2NpYXRlZCB3aXRoIGEgZ2l2ZW4gbW9kZWwgYXR0cmlidXRlLiBTZWUge0BsaW5rICNzZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzIGBzZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKClgfS5cblx0ICpcblx0ICogQHBhcmFtIGF0dHJpYnV0ZU5hbWUgQSBuYW1lIG9mIHRoZSBhdHRyaWJ1dGUuXG5cdCAqLyBnZXRBdHRyaWJ1dGVQcm9wZXJ0aWVzKGF0dHJpYnV0ZU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZVByb3BlcnRpZXNbYXR0cmlidXRlTmFtZV0gfHwgT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGxvd2VzdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI2lzTGltaXQgbGltaXQgZWxlbWVudH0gY29udGFpbmluZyB0aGUgZW50aXJlXG5cdCAqIHNlbGVjdGlvbi9yYW5nZS9wb3NpdGlvbiBvciB0aGUgcm9vdCBvdGhlcndpc2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBzZWxlY3Rpb25PclJhbmdlT3JQb3NpdGlvbiBUaGUgc2VsZWN0aW9uL3JhbmdlL3Bvc2l0aW9uIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBUaGUgbG93ZXN0IGxpbWl0IGVsZW1lbnQgY29udGFpbmluZyB0aGUgZW50aXJlIGBzZWxlY3Rpb25PclJhbmdlT3JQb3NpdGlvbmAuXG5cdCAqLyBnZXRMaW1pdEVsZW1lbnQoc2VsZWN0aW9uT3JSYW5nZU9yUG9zaXRpb24pIHtcbiAgICAgICAgbGV0IGVsZW1lbnQ7XG4gICAgICAgIGlmIChzZWxlY3Rpb25PclJhbmdlT3JQb3NpdGlvbiBpbnN0YW5jZW9mIFBvc2l0aW9uKSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gc2VsZWN0aW9uT3JSYW5nZU9yUG9zaXRpb24ucGFyZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcmFuZ2VzID0gc2VsZWN0aW9uT3JSYW5nZU9yUG9zaXRpb24gaW5zdGFuY2VvZiBSYW5nZSA/IFtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb25PclJhbmdlT3JQb3NpdGlvblxuICAgICAgICAgICAgXSA6IEFycmF5LmZyb20oc2VsZWN0aW9uT3JSYW5nZU9yUG9zaXRpb24uZ2V0UmFuZ2VzKCkpO1xuICAgICAgICAgICAgLy8gRmluZCB0aGUgY29tbW9uIGFuY2VzdG9yIGZvciBhbGwgc2VsZWN0aW9uJ3MgcmFuZ2VzLlxuICAgICAgICAgICAgZWxlbWVudCA9IHJhbmdlcy5yZWR1Y2UoKGVsZW1lbnQsIHJhbmdlKT0+e1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlQ29tbW9uQW5jZXN0b3IgPSByYW5nZS5nZXRDb21tb25BbmNlc3RvcigpO1xuICAgICAgICAgICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VDb21tb25BbmNlc3RvcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuZ2V0Q29tbW9uQW5jZXN0b3IocmFuZ2VDb21tb25BbmNlc3Rvciwge1xuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlU2VsZjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUoIXRoaXMuaXNMaW1pdChlbGVtZW50KSl7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGF0dHJpYnV0ZSBpcyBhbGxvd2VkIGluIHNlbGVjdGlvbjpcblx0ICpcblx0ICogKiBpZiB0aGUgc2VsZWN0aW9uIGlzIG5vdCBjb2xsYXBzZWQsIHRoZW4gY2hlY2tzIGlmIHRoZSBhdHRyaWJ1dGUgaXMgYWxsb3dlZCBvbiBhbnkgb2Ygbm9kZXMgaW4gdGhhdCByYW5nZSxcblx0ICogKiBpZiB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZCwgdGhlbiBjaGVja3MgaWYgb24gdGhlIHNlbGVjdGlvbiBwb3NpdGlvbiB0aGVyZSdzIGEgdGV4dCB3aXRoIHRoZVxuXHQgKiBzcGVjaWZpZWQgYXR0cmlidXRlIGFsbG93ZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBzZWxlY3Rpb24gU2VsZWN0aW9uIHdoaWNoIHdpbGwgYmUgY2hlY2tlZC5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZSBUaGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIGNoZWNrLlxuXHQgKi8gY2hlY2tBdHRyaWJ1dGVJblNlbGVjdGlvbihzZWxlY3Rpb24sIGF0dHJpYnV0ZSkge1xuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICBjb25zdCBmaXJzdFBvc2l0aW9uID0gc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBbXG4gICAgICAgICAgICAgICAgLi4uZmlyc3RQb3NpdGlvbi5nZXRBbmNlc3RvcnMoKSxcbiAgICAgICAgICAgICAgICBuZXcgVGV4dCgnJywgc2VsZWN0aW9uLmdldEF0dHJpYnV0ZXMoKSlcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHNjaGVtYSBhbGxvd3MgZm9yIGEgdGV4dCB3aXRoIHRoZSBhdHRyaWJ1dGUgaW4gdGhlIHNlbGVjdGlvbi5cbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrQXR0cmlidXRlKGNvbnRleHQsIGF0dHJpYnV0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCByYW5nZXMgPSBzZWxlY3Rpb24uZ2V0UmFuZ2VzKCk7XG4gICAgICAgICAgICAvLyBGb3IgYWxsIHJhbmdlcywgY2hlY2sgbm9kZXMgaW4gdGhlbSB1bnRpbCB5b3UgZmluZCBhIG5vZGUgdGhhdCBpcyBhbGxvd2VkIHRvIGhhdmUgdGhlIGF0dHJpYnV0ZS5cbiAgICAgICAgICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgcmFuZ2VzKXtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tBdHRyaWJ1dGUodmFsdWUuaXRlbSwgYXR0cmlidXRlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBub2RlIHRoYXQgaXMgYWxsb3dlZCB0byBoYXZlIHRoZSBhdHRyaWJ1dGUsIHJldHVybiB0cnVlLlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgd2UgaGF2ZW4ndCBmb3VuZCBzdWNoIG5vZGUsIHJldHVybiBmYWxzZS5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcblx0ICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gc2V0IG9mIHJhbmdlcyBpbnRvIGEgc2V0IG9mIHJhbmdlcyB3aGVyZSB0aGUgZ2l2ZW4gYXR0cmlidXRlIGlzIGFsbG93ZWQgKGFuZCBjYW4gYmUgYXBwbGllZCkuXG5cdCAqXG5cdCAqIEBwYXJhbSByYW5nZXMgUmFuZ2VzIHRvIGJlIHZhbGlkYXRlZC5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZSBUaGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBSYW5nZXMgaW4gd2hpY2ggdGhlIGF0dHJpYnV0ZSBpcyBhbGxvd2VkLlxuXHQgKi8gKmdldFZhbGlkUmFuZ2VzKHJhbmdlcywgYXR0cmlidXRlKSB7XG4gICAgICAgIHJhbmdlcyA9IGNvbnZlcnRUb01pbmltYWxGbGF0UmFuZ2VzKHJhbmdlcyk7XG4gICAgICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgcmFuZ2VzKXtcbiAgICAgICAgICAgIHlpZWxkKiB0aGlzLl9nZXRWYWxpZFJhbmdlc0ZvclJhbmdlKHJhbmdlLCBhdHRyaWJ1dGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBCYXNpbmcgb24gZ2l2ZW4gYHBvc2l0aW9uYCwgZmluZHMgYW5kIHJldHVybnMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSByYW5nZX0gd2hpY2ggaXNcblx0ICogbmVhcmVzdCB0byB0aGF0IGBwb3NpdGlvbmAgYW5kIGlzIGEgY29ycmVjdCByYW5nZSBmb3Igc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBUaGUgY29ycmVjdCBzZWxlY3Rpb24gcmFuZ2UgbWlnaHQgYmUgY29sbGFwc2VkIHdoZW4gaXQgaXMgbG9jYXRlZCBpbiBhIHBvc2l0aW9uIHdoZXJlIHRoZSB0ZXh0IG5vZGUgY2FuIGJlIHBsYWNlZC5cblx0ICogTm9uLWNvbGxhcHNlZCByYW5nZSBpcyByZXR1cm5lZCB3aGVuIHNlbGVjdGlvbiBjYW4gYmUgcGxhY2VkIGFyb3VuZCBlbGVtZW50IG1hcmtlZCBhcyBhbiBcIm9iamVjdFwiIGluXG5cdCAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hIHNjaGVtYX0uXG5cdCAqXG5cdCAqIERpcmVjdGlvbiBvZiBzZWFyY2hpbmcgZm9yIHRoZSBuZWFyZXN0IGNvcnJlY3Qgc2VsZWN0aW9uIHJhbmdlIGNhbiBiZSBzcGVjaWZpZWQgYXM6XG5cdCAqXG5cdCAqICogYGJvdGhgIC0gc2VhcmNoaW5nIHdpbGwgYmUgcGVyZm9ybWVkIGluIGJvdGggd2F5cyxcblx0ICogKiBgZm9yd2FyZGAgLSBzZWFyY2hpbmcgd2lsbCBiZSBwZXJmb3JtZWQgb25seSBmb3J3YXJkLFxuXHQgKiAqIGBiYWNrd2FyZGAgLSBzZWFyY2hpbmcgd2lsbCBiZSBwZXJmb3JtZWQgb25seSBiYWNrd2FyZC5cblx0ICpcblx0ICogV2hlbiB2YWxpZCBzZWxlY3Rpb24gcmFuZ2UgY2Fubm90IGJlIGZvdW5kLCBgbnVsbGAgaXMgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBSZWZlcmVuY2UgcG9zaXRpb24gd2hlcmUgbmV3IHNlbGVjdGlvbiByYW5nZSBzaG91bGQgYmUgbG9va2VkIGZvci5cblx0ICogQHBhcmFtIGRpcmVjdGlvbiBTZWFyY2ggZGlyZWN0aW9uLlxuXHQgKiBAcmV0dXJucyBOZWFyZXN0IHNlbGVjdGlvbiByYW5nZSBvciBgbnVsbGAgaWYgb25lIGNhbm5vdCBiZSBmb3VuZC5cblx0ICovIGdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShwb3NpdGlvbiwgZGlyZWN0aW9uID0gJ2JvdGgnKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbi5yb290LnJvb3ROYW1lID09ICckZ3JhdmV5YXJkJykge1xuICAgICAgICAgICAgLy8gTm8gdmFsaWQgc2VsZWN0aW9uIHJhbmdlIGluIHRoZSBncmF2ZXlhcmQuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGltcG9ydGFudCB3aGVuIGdldHRpbmcgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiBkZWZhdWx0IHJhbmdlLlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIGNvbGxhcHNlZCByYW5nZSBpZiBwcm92aWRlZCBwb3NpdGlvbiBpcyB2YWxpZC5cbiAgICAgICAgaWYgKHRoaXMuY2hlY2tDaGlsZChwb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UocG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIGxldCBiYWNrd2FyZFdhbGtlciwgZm9yd2FyZFdhbGtlcjtcbiAgICAgICAgLy8gTmV2ZXIgbGVhdmUgYSBsaW1pdCBlbGVtZW50LlxuICAgICAgICBjb25zdCBsaW1pdEVsZW1lbnQgPSBwb3NpdGlvbi5nZXRBbmNlc3RvcnMoKS5yZXZlcnNlKCkuZmluZCgoaXRlbSk9PnRoaXMuaXNMaW1pdChpdGVtKSkgfHwgcG9zaXRpb24ucm9vdDtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAnYm90aCcgfHwgZGlyZWN0aW9uID09ICdiYWNrd2FyZCcpIHtcbiAgICAgICAgICAgIGJhY2t3YXJkV2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIoe1xuICAgICAgICAgICAgICAgIGJvdW5kYXJpZXM6IFJhbmdlLl9jcmVhdGVJbihsaW1pdEVsZW1lbnQpLFxuICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb246IHBvc2l0aW9uLFxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2JhY2t3YXJkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAnYm90aCcgfHwgZGlyZWN0aW9uID09ICdmb3J3YXJkJykge1xuICAgICAgICAgICAgZm9yd2FyZFdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKHtcbiAgICAgICAgICAgICAgICBib3VuZGFyaWVzOiBSYW5nZS5fY3JlYXRlSW4obGltaXRFbGVtZW50KSxcbiAgICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uOiBwb3NpdGlvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBkYXRhIG9mIGNvbWJpbmVXYWxrZXJzKGJhY2t3YXJkV2Fsa2VyLCBmb3J3YXJkV2Fsa2VyKSl7XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gZGF0YS53YWxrZXIgPT0gYmFja3dhcmRXYWxrZXIgPyAnZWxlbWVudEVuZCcgOiAnZWxlbWVudFN0YXJ0JztcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YS52YWx1ZTtcbiAgICAgICAgICAgIGlmICh2YWx1ZS50eXBlID09IHR5cGUgJiYgdGhpcy5pc09iamVjdCh2YWx1ZS5pdGVtKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBSYW5nZS5fY3JlYXRlT24odmFsdWUuaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja0NoaWxkKHZhbHVlLm5leHRQb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHZhbHVlLm5leHRQb3NpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUcmllcyB0byBmaW5kIHBvc2l0aW9uIGFuY2VzdG9ycyB0aGF0IGFsbG93IHRvIGluc2VydCBhIGdpdmVuIG5vZGUuXG5cdCAqIEl0IHN0YXJ0cyBzZWFyY2hpbmcgZnJvbSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIGdvZXMgbm9kZSBieSBub2RlIHRvIHRoZSB0b3Agb2YgdGhlIG1vZGVsIHRyZWVcblx0ICogYXMgbG9uZyBhcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNMaW1pdCBsaW1pdCBlbGVtZW50fSwgYW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNpc09iamVjdCBvYmplY3QgZWxlbWVudH0gb3IgYSB0b3Btb3N0IGFuY2VzdG9yIGlzIG5vdCByZWFjaGVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIHRoYXQgdGhlIHNlYXJjaCB3aWxsIHN0YXJ0IGZyb20uXG5cdCAqIEBwYXJhbSBub2RlIFRoZSBub2RlIGZvciB3aGljaCBhbiBhbGxvd2VkIHBhcmVudCBzaG91bGQgYmUgZm91bmQgb3IgaXRzIG5hbWUuXG5cdCAqIEByZXR1cm5zIEFsbG93ZWQgcGFyZW50IG9yIG51bGwgaWYgbm90aGluZyB3YXMgZm91bmQuXG5cdCAqLyBmaW5kQWxsb3dlZFBhcmVudChwb3NpdGlvbiwgbm9kZSkge1xuICAgICAgICBsZXQgcGFyZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgICAgICB3aGlsZShwYXJlbnQpe1xuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tDaGlsZChwYXJlbnQsIG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIERvIG5vdCBzcGxpdCBsaW1pdCBlbGVtZW50cy5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzTGltaXQocGFyZW50KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldHMgYXR0cmlidXRlcyBhbGxvd2VkIGJ5IHRoZSBzY2hlbWEgb24gYSBnaXZlbiBub2RlLlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBBIG5vZGUgdG8gc2V0IGF0dHJpYnV0ZXMgb24uXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVzIEF0dHJpYnV0ZXMga2V5cyBhbmQgdmFsdWVzLlxuXHQgKiBAcGFyYW0gd3JpdGVyIEFuIGluc3RhbmNlIG9mIHRoZSBtb2RlbCB3cml0ZXIuXG5cdCAqLyBzZXRBbGxvd2VkQXR0cmlidXRlcyhub2RlLCBhdHRyaWJ1dGVzLCB3cml0ZXIpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB3cml0ZXIubW9kZWw7XG4gICAgICAgIGZvciAoY29uc3QgW2F0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhhdHRyaWJ1dGVzKSl7XG4gICAgICAgICAgICBpZiAobW9kZWwuc2NoZW1hLmNoZWNrQXR0cmlidXRlKG5vZGUsIGF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVWYWx1ZSwgbm9kZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYXR0cmlidXRlcyBkaXNhbGxvd2VkIGJ5IHRoZSBzY2hlbWEuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlcyBOb2RlcyB0aGF0IHdpbGwgYmUgZmlsdGVyZWQuXG5cdCAqLyByZW1vdmVEaXNhbGxvd2VkQXR0cmlidXRlcyhub2Rlcywgd3JpdGVyKSB7XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICAvLyBXaGVuIG5vZGUgaXMgYSBgVGV4dGAgaXQgaGFzIG5vIGNoaWxkcmVuLCBzbyBqdXN0IGZpbHRlciBpdCBvdXQuXG4gICAgICAgICAgICBpZiAobm9kZS5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgICAgIHJlbW92ZURpc2FsbG93ZWRBdHRyaWJ1dGVGcm9tTm9kZSh0aGlzLCBub2RlLCB3cml0ZXIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYW5nZUluTm9kZSA9IFJhbmdlLl9jcmVhdGVJbihub2RlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbnNJblJhbmdlID0gcmFuZ2VJbk5vZGUuZ2V0UG9zaXRpb25zKCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBwb3NpdGlvbiBvZiBwb3NpdGlvbnNJblJhbmdlKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IHBvc2l0aW9uLm5vZGVCZWZvcmUgfHwgcG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVEaXNhbGxvd2VkQXR0cmlidXRlRnJvbU5vZGUodGhpcywgaXRlbSwgd3JpdGVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgYXR0cmlidXRlcyBvZiBhIG5vZGUgdGhhdCBoYXZlIGEgZ2l2ZW4gcHJvcGVydHkuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIE5vZGUgdG8gZ2V0IGF0dHJpYnV0ZXMgZnJvbS5cblx0ICogQHBhcmFtIHByb3BlcnR5TmFtZSBOYW1lIG9mIHRoZSBwcm9wZXJ0eSB0aGF0IGF0dHJpYnV0ZSBtdXN0IGhhdmUgdG8gcmV0dXJuIGl0LlxuXHQgKiBAcGFyYW0gcHJvcGVydHlWYWx1ZSBEZXNpcmVkIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eSB0aGF0IHdlIHdhbnQgdG8gY2hlY2suXG5cdCAqIFdoZW4gYHVuZGVmaW5lZGAgYXR0cmlidXRlcyB3aWxsIGJlIHJldHVybmVkIGlmIHRoZXkgaGF2ZSBzZXQgYSBnaXZlbiBwcm9wZXJ0eSBubyBtYXR0ZXIgd2hhdCB0aGUgdmFsdWUgaXMuIElmIHNwZWNpZmllZCBpdCB3aWxsXG5cdCAqIHJldHVybiBhdHRyaWJ1dGVzIHdoaWNoIGdpdmVuIHByb3BlcnR5J3MgdmFsdWUgaXMgZXF1YWwgdG8gdGhpcyBwYXJhbWV0ZXIuXG5cdCAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGF0dHJpYnV0ZXMnIG5hbWVzIGFzIGtleSBhbmQgYXR0cmlidXRlcycgdmFsdWVzIGFzIHZhbHVlLlxuXHQgKi8gZ2V0QXR0cmlidXRlc1dpdGhQcm9wZXJ0eShub2RlLCBwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUpIHtcbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IFthdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVWYWx1ZV0gb2Ygbm9kZS5nZXRBdHRyaWJ1dGVzKCkpe1xuICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlUHJvcGVydGllcyA9IHRoaXMuZ2V0QXR0cmlidXRlUHJvcGVydGllcyhhdHRyaWJ1dGVOYW1lKTtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBwcm9wZXJ0eVZhbHVlID09PSBhdHRyaWJ1dGVQcm9wZXJ0aWVzW3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdID0gYXR0cmlidXRlVmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBzY2hlbWEgY29udGV4dC5cblx0ICovIGNyZWF0ZUNvbnRleHQoY29udGV4dCkge1xuICAgICAgICByZXR1cm4gbmV3IFNjaGVtYUNvbnRleHQoY29udGV4dCk7XG4gICAgfVxuICAgIF9jbGVhckNhY2hlKCkge1xuICAgICAgICB0aGlzLl9jb21waWxlZERlZmluaXRpb25zID0gbnVsbDtcbiAgICB9XG4gICAgX2NvbXBpbGUoKSB7XG4gICAgICAgIGNvbnN0IGRlZmluaXRpb25zID0ge307XG4gICAgICAgIGNvbnN0IHNvdXJjZVJ1bGVzID0gdGhpcy5fc291cmNlRGVmaW5pdGlvbnM7XG4gICAgICAgIGNvbnN0IGl0ZW1OYW1lcyA9IE9iamVjdC5rZXlzKHNvdXJjZVJ1bGVzKTtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtTmFtZSBvZiBpdGVtTmFtZXMpe1xuICAgICAgICAgICAgZGVmaW5pdGlvbnNbaXRlbU5hbWVdID0gY29tcGlsZUJhc2VJdGVtUnVsZShzb3VyY2VSdWxlc1tpdGVtTmFtZV0sIGl0ZW1OYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpdGVtcyA9IE9iamVjdC52YWx1ZXMoZGVmaW5pdGlvbnMpO1xuICAgICAgICAvLyBTb21ldGltZXMgZmVhdHVyZXMgYWRkIHJ1bGVzIChhbGxvd3MsIGRpc2FsbG93cykgZm9yIGl0ZW1zIHRoYXQgaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQgeWV0LiBXZSBhbGxvdyB0aGF0LCB0byBtYWtlIGl0IGVhc2llclxuICAgICAgICAvLyB0byBwdXQgdGhlIHNjaGVtYSB0b2dldGhlci4gSG93ZXZlciwgc29tZXRpbWVzIHRoZXNlIGl0ZW1zIGFyZSBuZXZlciByZWdpc3RlcmVkLiBUbyBwcmV2ZW50IG9wZXJhdGluZ1xuICAgICAgICAvLyByZW1vdmVVbnJlZ2lzdGVyZWRFbnRyaWVzKCBkZWZpbml0aW9ucywgaXRlbXMgKTtcbiAgICAgICAgLy8gMS4gUHJvcGFnYXRlIGBjaGlsZEl0ZW0uYWxsb3dJbmAgdG8gYHBhcmVudEl0ZW0uYWxsb3dDaGlsZHJlbmAgYW5kIHZpY2UgdmVyc2EsIHNvIHRoYXQgdGhlc2UgcHJvcGVydGllcyBhcmUgY29tcGxldGVseSBtaXJyb3JlZFxuICAgICAgICAvLyBmb3IgYWxsIGNoaWxkcmVuIGFuZCBwYXJlbnRzLiBEbyB0aGUgc2FtZSBmb3IgYGRpc2FsbG93SW5gIGFuZCBgZGlzYWxsb3dDaGlsZHJlbmAuXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcyl7XG4gICAgICAgICAgICBwcm9wYWdhdGVBbGxvd0luKGRlZmluaXRpb25zLCBpdGVtKTtcbiAgICAgICAgICAgIHByb3BhZ2F0ZUFsbG93Q2hpbGRyZW4oZGVmaW5pdGlvbnMsIGl0ZW0pO1xuICAgICAgICAgICAgcHJvcGFnYXRlRGlzYWxsb3dJbihkZWZpbml0aW9ucywgaXRlbSk7XG4gICAgICAgICAgICBwcm9wYWdhdGVEaXNhbGxvd0NoaWxkcmVuKGRlZmluaXRpb25zLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAyLiBSZW1vdmUgZnJvbSBgYWxsb3dJbmAgYW5kIGBhbGxvd0NoaWxkcmVuYCB0aGVzZSBpdGVtcyB3aGljaCB3aGVyZSBkaXNhbGxvd2VkIGJ5IGBkaXNhbGxvd0luYCBhbmQgYGRpc2FsbG93Q2hpbGRyZW5gLlxuICAgICAgICAvLyBEbyB0aGUgc2FtZSBmb3IgYXR0cmlidXRlcy4gTm93IHdlIGhhdmUgYSBjbGVhciBzaXR1YXRpb24gd2hlcmUgd2hpY2ggaXRlbS9hdHRyaWJ1dGUgaXMgYWxsb3dlZC4gSW5oZXJpdGFuY2UgaXMgaW4gbmV4dCBzdGVwcy5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIHJlc29sdmVEaXNhbGxvd3MoZGVmaW5pdGlvbnMsIGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIDMuIENvbXBpbGUgYGl0ZW0uYWxsb3dDb250ZW50T2ZgIHByb3BlcnR5LiBGb3IgZWFjaCBlbnRyeSBpbiBgYWxsb3dDb250ZW50T2ZgLCB3ZSB3YW50IHRvIHRha2UgYGFsbG93Q2hpbGRyZW5gIGFuZCByZXdyaXRlXG4gICAgICAgIC8vIHRoZW0gaW50byBgaXRlbS5hbGxvd0NoaWxkcmVuYC4gYGl0ZW0uZGlzYWxsb3dDaGlsZHJlbmAgaXMgdXNlZCB0byBmaWx0ZXIgb3V0IHNvbWUgZW50cmllcy4gVGhpcyB3YXkgXCJvd24gcnVsZXNcIiBoYXZlIGhpZ2hlclxuICAgICAgICAvLyBwcmlvcml0eSB0aGFuIFwiaW5oZXJpdGVkIHJ1bGVzXCIuIE1pcnJvcmluZyBmcm9tIHN0ZXAgMS4gaXMgbWFpbnRhaW5lZC5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIGNvbXBpbGVBbGxvd0NvbnRlbnRPZihkZWZpbml0aW9ucywgaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gNC4gQ29tcGlsZSBgaXRlbS5hbGxvd1doZXJlYCBwcm9wZXJ0eS4gRm9yIGVhY2ggZW50cnkgaW4gYGFsbG93V2hlcmVgLCB3ZSB3YW50IHRvIHRha2UgYGFsbG93SW5gIGFuZCByZXdyaXRlIHRoZW0gaW50b1xuICAgICAgICAvLyBgaXRlbS5hbGxvd0luYC4gYGl0ZW0uZGlzYWxsb3dJbmAgaXMgdXNlZCB0byBmaWx0ZXIgb3V0IHNvbWUgZW50cmllcy4gVGhpcyB3YXkgXCJvd24gcnVsZXNcIiBoYXZlIGhpZ2hlciBwcmlvcml0eSB0aGFuXG4gICAgICAgIC8vIFwiaW5oZXJpdGVkIHJ1bGVzXCIuIE1pcnJvcmluZyBmcm9tIHN0ZXAgMS4gaXMgbWFpbnRhaW5lZC5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIGNvbXBpbGVBbGxvd1doZXJlKGRlZmluaXRpb25zLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICAvLyA1LiBDb21waWxlIGBpdGVtLmFsbG93QXR0cmlidXRlc09mYC4gRm9yIGVhY2ggZW50cnkgaW4gYGFsbG93QXR0cmlidXRlc09mYCwgd2Ugd2FudCB0byB0YWtlIGBhbGxvd0F0dHJpYnV0ZXNgIGFuZCByZXdyaXRlIHRoZW1cbiAgICAgICAgLy8gaW50byBgaXRlbS5hbGxvd0F0dHJpYnV0ZXNgLiBgaXRlbS5kaXNhbGxvd0F0dHJpYnV0ZXNgIGlzIHVzZWQgdG8gZmlsdGVyIG91dCBzb21lIGVudHJpZXMuIFRoaXMgd2F5IFwib3duIHJ1bGVzXCIgaGF2ZSBoaWdoZXJcbiAgICAgICAgLy8gcHJpb3JpdHkgdGhhbiBcImluaGVyaXRlZCBydWxlc1wiLlxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpe1xuICAgICAgICAgICAgY29tcGlsZUFsbG93QXR0cmlidXRlc09mKGRlZmluaXRpb25zLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICAvLyA2LiBDb21waWxlIGBpdGVtLmluaGVyaXRUeXBlc0Zyb21gIHByb3BlcnR5LiBGb3IgZWFjaCBlbnRyeSBpbiBgaW5oZXJpdFR5cGVzRnJvbWAsIHdlIHdhbnQgdG8gdGFrZSBgaXMqYCBwcm9wZXJ0aWVzIGFuZFxuICAgICAgICAvLyBzZXQgdGhlbSBvbiBgaXRlbWAgKGlmIHRoZXkgYXJlIG5vdCBzZXQgeWV0KS5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIGNvbXBpbGVJbmhlcml0UHJvcGVydGllc0Zyb20oZGVmaW5pdGlvbnMsIGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIENvbXBpbGUgZmluYWwgZGVmaW5pdGlvbnMuIFVubmVjZXNzYXJ5IHByb3BlcnRpZXMgYXJlIHJlbW92ZWQgYW5kIHNvbWUgYWRkaXRpb25hbCBjbGVhbmluZyBpcyBhcHBsaWVkLlxuICAgICAgICB0aGlzLl9jb21waWxlZERlZmluaXRpb25zID0gY29tcGlsZURlZmluaXRpb25zKGRlZmluaXRpb25zKTtcbiAgICB9XG4gICAgX2NoZWNrQ29udGV4dE1hdGNoKGNvbnRleHQsIGRlZikge1xuICAgICAgICBjb25zdCBwYXJlbnRJdGVtID0gY29udGV4dC5sYXN0O1xuICAgICAgICAvLyBGaXJzdCwgY2hlY2sgYWxsIGNoaWxkIGNoZWNrcyBkZWNsYXJlZCBhcyBjYWxsYmFja3MuXG4gICAgICAgIC8vIE5vdGUgdGhhdCBgX2V2YWx1YXRlQ2hpbGRDaGVja3MoKWAgd2lsbCByZXR1cm4gYHVuZGVmaW5lZGAgaWYgbmVpdGhlciBjaGlsZCBjaGVjayB3YXMgYXBwbGljYWJsZSAobm8gZGVjaXNpb24gd2FzIG1hZGUpLlxuICAgICAgICBsZXQgaXNBbGxvd2VkID0gdGhpcy5fZXZhbHVhdGVDaGlsZENoZWNrcyhjb250ZXh0LCBkZWYpO1xuICAgICAgICAvLyBJZiB0aGUgZGVjaXNpb24gd2FzIG5vdCBtYWRlIGluc2lkZSBjaGlsZCBjaGVjayBjYWxsYmFja3MsIHRoZW4gdXNlIGRlY2xhcmF0aXZlIHJ1bGVzLlxuICAgICAgICBpc0FsbG93ZWQgPSBpc0FsbG93ZWQgIT09IHVuZGVmaW5lZCA/IGlzQWxsb3dlZCA6IGRlZi5hbGxvd0luLmluY2x1ZGVzKHBhcmVudEl0ZW0ubmFtZSk7XG4gICAgICAgIC8vIElmIHRoZSBpdGVtIGlzIG5vdCBhbGxvd2VkIGluIHRoZSBgY29udGV4dGAsIHJldHVybiBgZmFsc2VgLlxuICAgICAgICBpZiAoIWlzQWxsb3dlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBpdGVtIGlzIGFsbG93ZWQsIHJlY3Vyc2l2ZWx5IHZlcmlmeSB0aGUgcmVzdCBvZiB0aGUgYGNvbnRleHRgLlxuICAgICAgICBjb25zdCBwYXJlbnRJdGVtRGVmaW5pdGlvbiA9IHRoaXMuZ2V0RGVmaW5pdGlvbihwYXJlbnRJdGVtKTtcbiAgICAgICAgY29uc3QgcGFyZW50Q29udGV4dCA9IGNvbnRleHQudHJpbUxhc3QoKTtcbiAgICAgICAgLy8gT25lIG9mIHRoZSBpdGVtcyBpbiB0aGUgb3JpZ2luYWwgYGNvbnRleHRgIGRpZCBub3QgaGF2ZSBhIGRlZmluaXRpb24gc3BlY2lmaWVkLiBJbiB0aGlzIGNhc2UsIHRoZSB3aG9sZSBjb250ZXh0IGlzIGRpc2FsbG93ZWQuXG4gICAgICAgIGlmICghcGFyZW50SXRlbURlZmluaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXaG9sZSBgY29udGV4dGAgd2FzIHZlcmlmaWVkIGFuZCBwYXNzZWQgY2hlY2tzLlxuICAgICAgICBpZiAocGFyZW50Q29udGV4dC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVmVyaWZ5IFwidHJ1bmNhdGVkXCIgcGFyZW50IGNvbnRleHQuIFRoZSBsYXN0IGl0ZW0gb2YgdGhlIG9yaWdpbmFsIGNvbnRleHQgaXMgbm93IHRoZSBkZWZpbml0aW9uIHRvIGNoZWNrLlxuICAgICAgICByZXR1cm4gdGhpcy5fY2hlY2tDb250ZXh0TWF0Y2gocGFyZW50Q29udGV4dCwgcGFyZW50SXRlbURlZmluaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2FsbHMgY2hpbGQgY2hlY2sgY2FsbGJhY2tzIHRvIGRlY2lkZSB3aGV0aGVyIGBkZWZgIGlzIGFsbG93ZWQgaW4gYGNvbnRleHRgLiBJdCB1c2VzIGJvdGggZ2VuZXJpYyBhbmQgc3BlY2lmaWMgKGRlZmluZWQgZm9yIGBkZWZgXG5cdCAqIGl0ZW0pIGNhbGxiYWNrcy4gSWYgbmVpdGhlciBjYWxsYmFjayBtYWtlcyBhIGRlY2lzaW9uLCBgdW5kZWZpbmVkYCBpcyByZXR1cm5lZC5cblx0ICpcblx0ICogTm90ZSB0aGF0IHRoZSBmaXJzdCBjYWxsYmFjayB0aGF0IG1ha2VzIGEgZGVjaXNpb24gXCJ3aW5zXCIsIGkuZS4sIGlmIGFueSBjYWxsYmFjayByZXR1cm5zIGB0cnVlYCBvciBgZmFsc2VgLCB0aGVuIHRoZSBwcm9jZXNzaW5nXG5cdCAqIGlzIG92ZXIgYW5kIHRoYXQgcmVzdWx0IGlzIHJldHVybmVkLlxuXHQgKi8gX2V2YWx1YXRlQ2hpbGRDaGVja3MoY29udGV4dCwgZGVmKSB7XG4gICAgICAgIGNvbnN0IGdlbmVyaWNDaGVja3MgPSB0aGlzLl9jdXN0b21DaGlsZENoZWNrcy5nZXQodGhpcy5fZ2VuZXJpY0NoZWNrU3ltYm9sKSB8fCBbXTtcbiAgICAgICAgY29uc3QgY2hpbGRDaGVja3MgPSB0aGlzLl9jdXN0b21DaGlsZENoZWNrcy5nZXQoZGVmLm5hbWUpIHx8IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGNoZWNrIG9mIFtcbiAgICAgICAgICAgIC4uLmdlbmVyaWNDaGVja3MsXG4gICAgICAgICAgICAuLi5jaGlsZENoZWNrc1xuICAgICAgICBdKXtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrKGNvbnRleHQsIGRlZik7XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDYWxscyBhdHRyaWJ1dGUgY2hlY2sgY2FsbGJhY2tzIHRvIGRlY2lkZSB3aGV0aGVyIGBhdHRyaWJ1dGVOYW1lYCBjYW4gYmUgc2V0IG9uIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGNvbnRleHRgLiBJdCB1c2VzIGJvdGhcblx0ICogZ2VuZXJpYyBhbmQgc3BlY2lmaWMgKGRlZmluZWQgZm9yIGBhdHRyaWJ1dGVOYW1lYCkgY2FsbGJhY2tzLiBJZiBuZWl0aGVyIGNhbGxiYWNrIG1ha2VzIGEgZGVjaXNpb24sIGB1bmRlZmluZWRgIGlzIHJldHVybmVkLlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgdGhlIGZpcnN0IGNhbGxiYWNrIHRoYXQgbWFrZXMgYSBkZWNpc2lvbiBcIndpbnNcIiwgaS5lLiwgaWYgYW55IGNhbGxiYWNrIHJldHVybnMgYHRydWVgIG9yIGBmYWxzZWAsIHRoZW4gdGhlIHByb2Nlc3Npbmdcblx0ICogaXMgb3ZlciBhbmQgdGhhdCByZXN1bHQgaXMgcmV0dXJuZWQuXG5cdCAqLyBfZXZhbHVhdGVBdHRyaWJ1dGVDaGVja3MoY29udGV4dCwgYXR0cmlidXRlTmFtZSkge1xuICAgICAgICBjb25zdCBnZW5lcmljQ2hlY2tzID0gdGhpcy5fY3VzdG9tQXR0cmlidXRlQ2hlY2tzLmdldCh0aGlzLl9nZW5lcmljQ2hlY2tTeW1ib2wpIHx8IFtdO1xuICAgICAgICBjb25zdCBjaGlsZENoZWNrcyA9IHRoaXMuX2N1c3RvbUF0dHJpYnV0ZUNoZWNrcy5nZXQoYXR0cmlidXRlTmFtZSkgfHwgW107XG4gICAgICAgIGZvciAoY29uc3QgY2hlY2sgb2YgW1xuICAgICAgICAgICAgLi4uZ2VuZXJpY0NoZWNrcyxcbiAgICAgICAgICAgIC4uLmNoaWxkQ2hlY2tzXG4gICAgICAgIF0pe1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2hlY2soY29udGV4dCwgYXR0cmlidXRlTmFtZSk7XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUYWtlcyBhIGZsYXQgcmFuZ2UgYW5kIGFuIGF0dHJpYnV0ZSBuYW1lLiBUcmF2ZXJzZXMgdGhlIHJhbmdlIHJlY3Vyc2l2ZWx5IGFuZCBkZWVwbHkgdG8gZmluZCBhbmQgcmV0dXJuIGFsbCByYW5nZXNcblx0ICogaW5zaWRlIHRoZSBnaXZlbiByYW5nZSBvbiB3aGljaCB0aGUgYXR0cmlidXRlIGNhbiBiZSBhcHBsaWVkLlxuXHQgKlxuXHQgKiBUaGlzIGlzIGEgaGVscGVyIGZ1bmN0aW9uIGZvciB7QGxpbmsgflNjaGVtYSNnZXRWYWxpZFJhbmdlc30uXG5cdCAqXG5cdCAqIEBwYXJhbSByYW5nZSBUaGUgcmFuZ2UgdG8gcHJvY2Vzcy5cblx0ICogQHBhcmFtIGF0dHJpYnV0ZSBUaGUgbmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBSYW5nZXMgaW4gd2hpY2ggdGhlIGF0dHJpYnV0ZSBpcyBhbGxvd2VkLlxuXHQgKi8gKl9nZXRWYWxpZFJhbmdlc0ZvclJhbmdlKHJhbmdlLCBhdHRyaWJ1dGUpIHtcbiAgICAgICAgbGV0IHN0YXJ0ID0gcmFuZ2Uuc3RhcnQ7XG4gICAgICAgIGxldCBlbmQgPSByYW5nZS5zdGFydDtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIHlpZWxkKiB0aGlzLl9nZXRWYWxpZFJhbmdlc0ZvclJhbmdlKFJhbmdlLl9jcmVhdGVJbihpdGVtKSwgYXR0cmlidXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5jaGVja0F0dHJpYnV0ZShpdGVtLCBhdHRyaWJ1dGUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzdGFydC5pc0VxdWFsKGVuZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdGFydCA9IFBvc2l0aW9uLl9jcmVhdGVBZnRlcihpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVuZCA9IFBvc2l0aW9uLl9jcmVhdGVBZnRlcihpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN0YXJ0LmlzRXF1YWwoZW5kKSkge1xuICAgICAgICAgICAgeWllbGQgbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgbW9kZWwgcmFuZ2Ugd2hpY2ggaXMgb3B0aW1hbCAoaW4gdGVybXMgb2YgVVgpIGZvciBpbnNlcnRpbmcgYSB3aWRnZXQgYmxvY2suXG5cdCAqXG5cdCAqIEZvciBpbnN0YW5jZSwgaWYgYSBzZWxlY3Rpb24gaXMgaW4gdGhlIG1pZGRsZSBvZiBhIHBhcmFncmFwaCwgdGhlIGNvbGxhcHNlZCByYW5nZSBiZWZvcmUgdGhpcyBwYXJhZ3JhcGhcblx0ICogd2lsbCBiZSByZXR1cm5lZCBzbyB0aGF0IGl0IGlzIG5vdCBzcGxpdC4gSWYgdGhlIHNlbGVjdGlvbiBpcyBhdCB0aGUgZW5kIG9mIGEgcGFyYWdyYXBoLFxuXHQgKiB0aGUgY29sbGFwc2VkIHJhbmdlIGFmdGVyIHRoaXMgcGFyYWdyYXBoIHdpbGwgYmUgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIE5vdGU6IElmIHRoZSBzZWxlY3Rpb24gaXMgcGxhY2VkIGluIGFuIGVtcHR5IGJsb2NrLCB0aGUgcmFuZ2UgaW4gdGhhdCBibG9jayB3aWxsIGJlIHJldHVybmVkLiBJZiB0aGF0IHJhbmdlXG5cdCAqIGlzIHRoZW4gcGFzc2VkIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2luc2VydENvbnRlbnR9LCB0aGUgYmxvY2sgd2lsbCBiZSBmdWxseSByZXBsYWNlZFxuXHQgKiBieSB0aGUgaW5zZXJ0ZWQgd2lkZ2V0IGJsb2NrLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIGJhc2VkIG9uIHdoaWNoIHRoZSBpbnNlcnRpb24gcG9zaXRpb24gc2hvdWxkIGJlIGNhbGN1bGF0ZWQuXG5cdCAqIEBwYXJhbSBwbGFjZSBUaGUgcGxhY2Ugd2hlcmUgdG8gbG9vayBmb3Igb3B0aW1hbCBpbnNlcnRpb24gcmFuZ2UuXG5cdCAqIFRoZSBgYXV0b2AgdmFsdWUgd2lsbCBkZXRlcm1pbmUgaXRzZWxmIHRoZSBiZXN0IHBvc2l0aW9uIGZvciBpbnNlcnRpb24uXG5cdCAqIFRoZSBgYmVmb3JlYCB2YWx1ZSB3aWxsIHRyeSB0byBmaW5kIGEgcG9zaXRpb24gYmVmb3JlIHNlbGVjdGlvbi5cblx0ICogVGhlIGBhZnRlcmAgdmFsdWUgd2lsbCB0cnkgdG8gZmluZCBhIHBvc2l0aW9uIGFmdGVyIHNlbGVjdGlvbi5cblx0ICogQHJldHVybnMgVGhlIG9wdGltYWwgcmFuZ2UuXG5cdCAqLyBmaW5kT3B0aW1hbEluc2VydGlvblJhbmdlKHNlbGVjdGlvbiwgcGxhY2UpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICBpZiAoc2VsZWN0ZWRFbGVtZW50ICYmIHRoaXMuaXNPYmplY3Qoc2VsZWN0ZWRFbGVtZW50KSAmJiAhdGhpcy5pc0lubGluZShzZWxlY3RlZEVsZW1lbnQpKSB7XG4gICAgICAgICAgICBpZiAocGxhY2UgPT0gJ2JlZm9yZScgfHwgcGxhY2UgPT0gJ2FmdGVyJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UoUG9zaXRpb24uX2NyZWF0ZUF0KHNlbGVjdGVkRWxlbWVudCwgcGxhY2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5fY3JlYXRlT24oc2VsZWN0ZWRFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaXJzdEJsb2NrID0gZmlyc3Qoc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgICAgICAvLyBUaGVyZSBhcmUgbm8gYmxvY2sgZWxlbWVudHMgd2l0aGluIGFuY2VzdG9ycyAoaW4gdGhlIGN1cnJlbnQgbGltaXQgZWxlbWVudCkuXG4gICAgICAgIGlmICghZmlyc3RCbG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShzZWxlY3Rpb24uZm9jdXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIGluc2VydGluZyBpbnRvIGFuIGVtcHR5IGJsb2NrIOKAkyByZXR1cm4gcG9zaXRpb24gaW4gdGhhdCBibG9jay4gSXQgd2lsbCBnZXRcbiAgICAgICAgLy8gcmVwbGFjZWQgd2l0aCB0aGUgaW1hZ2UgYnkgaW5zZXJ0Q29udGVudCgpLiAjNDIuXG4gICAgICAgIGlmIChmaXJzdEJsb2NrLmlzRW1wdHkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UoUG9zaXRpb24uX2NyZWF0ZUF0KGZpcnN0QmxvY2ssIDApKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb3NpdGlvbkFmdGVyID0gUG9zaXRpb24uX2NyZWF0ZUFmdGVyKGZpcnN0QmxvY2spO1xuICAgICAgICAvLyBJZiBzZWxlY3Rpb24gaXMgYXQgdGhlIGVuZCBvZiB0aGUgYmxvY2sgLSByZXR1cm4gcG9zaXRpb24gYWZ0ZXIgdGhlIGJsb2NrLlxuICAgICAgICBpZiAoc2VsZWN0aW9uLmZvY3VzLmlzVG91Y2hpbmcocG9zaXRpb25BZnRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UocG9zaXRpb25BZnRlcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gcG9zaXRpb24gYmVmb3JlIHRoZSBibG9jay5cbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKGZpcnN0QmxvY2spKTtcbiAgICB9XG59XG4vKipcbiAqIEEgc2NoZW1hIGNvbnRleHQgJm5kYXNoOyBhIGxpc3Qgb2YgYW5jZXN0b3JzIG9mIGEgZ2l2ZW4gcG9zaXRpb24gaW4gdGhlIGRvY3VtZW50LlxuICpcbiAqIENvbnNpZGVyaW5nIHN1Y2ggcG9zaXRpb246XG4gKlxuICogYGBgeG1sXG4gKiA8JHJvb3Q+XG4gKiBcdDxibG9ja1F1b3RlPlxuICogXHRcdDxwYXJhZ3JhcGg+XG4gKiBcdFx0XHReXG4gKiBcdFx0PC9wYXJhZ3JhcGg+XG4gKiBcdDwvYmxvY2tRdW90ZT5cbiAqIDwvJHJvb3Q+XG4gKiBgYGBcbiAqXG4gKiBUaGUgY29udGV4dCBvZiB0aGlzIHBvc2l0aW9uIGlzIGl0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNnZXRBbmNlc3RvcnMgbGlzdHMgb2YgYW5jZXN0b3JzfTpcbiAqXG4gKlx0XHRbIHJvb3RFbGVtZW50LCBibG9ja1F1b3RlRWxlbWVudCwgcGFyYWdyYXBoRWxlbWVudCBdXG4gKlxuICogQ29udGV4dHMgYXJlIHVzZWQgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjZXZlbnQ6Y2hlY2tDaGlsZCBgU2NoZW1hI2NoZWNrQ2hpbGRgfSBhbmRcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjZXZlbnQ6Y2hlY2tBdHRyaWJ1dGUgYFNjaGVtYSNjaGVja0F0dHJpYnV0ZWB9IGV2ZW50cyBhcyBhIGRlZmluaXRpb25cbiAqIG9mIGEgcGxhY2UgaW4gdGhlIGRvY3VtZW50IHdoZXJlIHRoZSBjaGVjayBvY2N1cnMuIFRoZSBjb250ZXh0IGluc3RhbmNlcyBhcmUgY3JlYXRlZCBiYXNlZCBvbiB0aGUgZmlyc3QgYXJndW1lbnRzXG4gKiBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNjaGVja0NoaWxkIGBTY2hlbWEjY2hlY2tDaGlsZCgpYH0gYW5kXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI2NoZWNrQXR0cmlidXRlIGBTY2hlbWEjY2hlY2tBdHRyaWJ1dGUoKWB9IG1ldGhvZHMgc28gd2hlblxuICogdXNpbmcgdGhlc2UgbWV0aG9kcyB5b3UgbmVlZCB0byB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYUNvbnRleHREZWZpbml0aW9ufXMuXG4gKi8gY2xhc3MgU2NoZW1hQ29udGV4dCB7XG4gICAgX2l0ZW1zO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBjb250ZXh0LlxuXHQgKi8gY29uc3RydWN0b3IoY29udGV4dCl7XG4gICAgICAgIGlmIChjb250ZXh0IGluc3RhbmNlb2YgU2NoZW1hQ29udGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGl0ZW1zO1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRleHQgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGl0ZW1zID0gW1xuICAgICAgICAgICAgICAgIGNvbnRleHRcbiAgICAgICAgICAgIF07XG4gICAgICAgIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoY29udGV4dCkpIHtcbiAgICAgICAgICAgIC8vIGBjb250ZXh0YCBpcyBpdGVtIG9yIHBvc2l0aW9uLlxuICAgICAgICAgICAgLy8gUG9zaXRpb24jZ2V0QW5jZXN0b3JzKCkgZG9lc24ndCBhY2NlcHQgYW55IHBhcmFtZXRlcnMgYnV0IGl0IHdvcmtzIGp1c3QgZmluZSBoZXJlLlxuICAgICAgICAgICAgaXRlbXMgPSBjb250ZXh0LmdldEFuY2VzdG9ycyh7XG4gICAgICAgICAgICAgICAgaW5jbHVkZVNlbGY6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbXMgPSBjb250ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXMubWFwKG1hcENvbnRleHRJdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBudW1iZXIgb2YgaXRlbXMuXG5cdCAqLyBnZXQgbGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIGxhc3QgaXRlbSAodGhlIGxvd2VzdCBub2RlKS5cblx0ICovIGdldCBsYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXNbdGhpcy5faXRlbXMubGVuZ3RoIC0gMV07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgYWxsIGNvbnRleHQgaXRlbXMuXG5cdCAqLyBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBuZXcgc2NoZW1hIGNvbnRleHQgaW5zdGFuY2Ugd2l0aCBhbiBhZGRpdGlvbmFsIGl0ZW0uXG5cdCAqXG5cdCAqIEl0ZW0gY2FuIGJlIGFkZGVkIGFzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBjb250ZXh0ID0gbmV3IFNjaGVtYUNvbnRleHQoIFsgJyRyb290JyBdICk7XG5cdCAqXG5cdCAqIC8vIEFuIGVsZW1lbnQuXG5cdCAqIGNvbnN0IGZvb0VsZW1lbnQgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCggJ2Zvb0VsZW1lbnQnICk7XG5cdCAqIGNvbnN0IG5ld0NvbnRleHQgPSBjb250ZXh0LnB1c2goIGZvb0VsZW1lbnQgKTsgLy8gWyAnJHJvb3QnLCAnZm9vRWxlbWVudCcgXVxuXHQgKlxuXHQgKiAvLyBBIHRleHQgbm9kZS5cblx0ICogY29uc3QgdGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vYmFyJyApO1xuXHQgKiBjb25zdCBuZXdDb250ZXh0ID0gY29udGV4dC5wdXNoKCB0ZXh0ICk7IC8vIFsgJyRyb290JywgJyR0ZXh0JyBdXG5cdCAqXG5cdCAqIC8vIEEgc3RyaW5nIChlbGVtZW50IG5hbWUpLlxuXHQgKiBjb25zdCBuZXdDb250ZXh0ID0gY29udGV4dC5wdXNoKCAnYmFyRWxlbWVudCcgKTsgLy8gWyAnJHJvb3QnLCAnYmFyRWxlbWVudCcgXVxuXHQgKiBgYGBcblx0ICpcblx0ICogKipOb3RlKioge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlfSB0aGF0IGlzIGFscmVhZHkgaW4gdGhlIG1vZGVsIHRyZWUgd2lsbCBiZSBhZGRlZCBhcyB0aGUgb25seSBpdGVtXG5cdCAqICh3aXRob3V0IGFuY2VzdG9ycykuXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIEFuIGl0ZW0gdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBjdXJyZW50IGNvbnRleHQuXG5cdCAqIEByZXR1cm5zIEEgbmV3IHNjaGVtYSBjb250ZXh0IGluc3RhbmNlIHdpdGggYW4gYWRkaXRpb25hbCBpdGVtLlxuXHQgKi8gcHVzaChpdGVtKSB7XG4gICAgICAgIGNvbnN0IGN0eCA9IG5ldyBTY2hlbWFDb250ZXh0KFtcbiAgICAgICAgICAgIGl0ZW1cbiAgICAgICAgXSk7XG4gICAgICAgIGN0eC5faXRlbXMgPSBbXG4gICAgICAgICAgICAuLi50aGlzLl9pdGVtcyxcbiAgICAgICAgICAgIC4uLmN0eC5faXRlbXNcbiAgICAgICAgXTtcbiAgICAgICAgcmV0dXJuIGN0eDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBuZXcgc2NoZW1hIGNvbnRleHQgdGhhdCBpcyBiYXNlZCBvbiB0aGlzIGNvbnRleHQgYnV0IGhhcyB0aGUgbGFzdCBpdGVtIHJlbW92ZWQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IGN0eFBhcmFncmFwaCA9IG5ldyBTY2hlbWFDb250ZXh0KCBbICckcm9vdCcsICdibG9ja1F1b3RlJywgJ3BhcmFncmFwaCcgXSApO1xuXHQgKiBjb25zdCBjdHhCbG9ja1F1b3RlID0gY3R4UGFyYWdyYXBoLnRyaW1MYXN0KCk7IC8vIEl0ZW1zIGluIGBjdHhCbG9ja1F1b3RlYCBhcmU6IGAkcm9vdGAgYW4gYGJsb2NrUXVvdGVgLlxuXHQgKiBjb25zdCBjdHhSb290ID0gY3R4QmxvY2tRdW90ZS50cmltTGFzdCgpOyAvLyBJdGVtcyBpbiBgY3R4Um9vdGAgYXJlOiBgJHJvb3RgLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHJldHVybnMgQSBuZXcgcmVkdWNlZCBzY2hlbWEgY29udGV4dCBpbnN0YW5jZS5cblx0ICovIHRyaW1MYXN0KCkge1xuICAgICAgICBjb25zdCBjdHggPSBuZXcgU2NoZW1hQ29udGV4dChbXSk7XG4gICAgICAgIGN0eC5faXRlbXMgPSB0aGlzLl9pdGVtcy5zbGljZSgwLCAtMSk7XG4gICAgICAgIHJldHVybiBjdHg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGFuIGl0ZW0gb24gdGhlIGdpdmVuIGluZGV4LlxuXHQgKi8gZ2V0SXRlbShpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXNbaW5kZXhdO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgbmFtZXMgb2YgaXRlbXMuXG5cdCAqLyAqZ2V0TmFtZXMoKSB7XG4gICAgICAgIHlpZWxkKiB0aGlzLl9pdGVtcy5tYXAoKGl0ZW0pPT5pdGVtLm5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGNvbnRleHQgZW5kcyB3aXRoIHRoZSBnaXZlbiBub2Rlcy5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgY3R4ID0gbmV3IFNjaGVtYUNvbnRleHQoIFsgcm9vdEVsZW1lbnQsIHBhcmFncmFwaEVsZW1lbnQsIHRleHROb2RlIF0gKTtcblx0ICpcblx0ICogY3R4LmVuZHNXaXRoKCAnJHRleHQnICk7IC8vIC0+IHRydWVcblx0ICogY3R4LmVuZHNXaXRoKCAncGFyYWdyYXBoICR0ZXh0JyApOyAvLyAtPiB0cnVlXG5cdCAqIGN0eC5lbmRzV2l0aCggJyRyb290JyApOyAvLyAtPiBmYWxzZVxuXHQgKiBjdHguZW5kc1dpdGgoICdwYXJhZ3JhcGgnICk7IC8vIC0+IGZhbHNlXG5cdCAqIGBgYFxuXHQgKi8gZW5kc1dpdGgocXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5nZXROYW1lcygpKS5qb2luKCcgJykuZW5kc1dpdGgocXVlcnkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGNvbnRleHQgc3RhcnRzIHdpdGggdGhlIGdpdmVuIG5vZGVzLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBjdHggPSBuZXcgU2NoZW1hQ29udGV4dCggWyByb290RWxlbWVudCwgcGFyYWdyYXBoRWxlbWVudCwgdGV4dE5vZGUgXSApO1xuXHQgKlxuXHQgKiBjdHguZW5kc1dpdGgoICckcm9vdCcgKTsgLy8gLT4gdHJ1ZVxuXHQgKiBjdHguZW5kc1dpdGgoICckcm9vdCBwYXJhZ3JhcGgnICk7IC8vIC0+IHRydWVcblx0ICogY3R4LmVuZHNXaXRoKCAnJHRleHQnICk7IC8vIC0+IGZhbHNlXG5cdCAqIGN0eC5lbmRzV2l0aCggJ3BhcmFncmFwaCcgKTsgLy8gLT4gZmFsc2Vcblx0ICogYGBgXG5cdCAqLyBzdGFydHNXaXRoKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZ2V0TmFtZXMoKSkuam9pbignICcpLnN0YXJ0c1dpdGgocXVlcnkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNvbXBpbGVCYXNlSXRlbVJ1bGUoc291cmNlSXRlbVJ1bGVzLCBpdGVtTmFtZSkge1xuICAgIGNvbnN0IGl0ZW1SdWxlID0ge1xuICAgICAgICBuYW1lOiBpdGVtTmFtZSxcbiAgICAgICAgYWxsb3dJbjogbmV3IFNldCgpLFxuICAgICAgICBhbGxvd0NoaWxkcmVuOiBuZXcgU2V0KCksXG4gICAgICAgIGRpc2FsbG93SW46IG5ldyBTZXQoKSxcbiAgICAgICAgZGlzYWxsb3dDaGlsZHJlbjogbmV3IFNldCgpLFxuICAgICAgICBhbGxvd0NvbnRlbnRPZjogbmV3IFNldCgpLFxuICAgICAgICBhbGxvd1doZXJlOiBuZXcgU2V0KCksXG4gICAgICAgIGFsbG93QXR0cmlidXRlczogbmV3IFNldCgpLFxuICAgICAgICBkaXNhbGxvd0F0dHJpYnV0ZXM6IG5ldyBTZXQoKSxcbiAgICAgICAgYWxsb3dBdHRyaWJ1dGVzT2Y6IG5ldyBTZXQoKSxcbiAgICAgICAgaW5oZXJpdFR5cGVzRnJvbTogbmV3IFNldCgpXG4gICAgfTtcbiAgICBjb3B5VHlwZXMoc291cmNlSXRlbVJ1bGVzLCBpdGVtUnVsZSk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdhbGxvd0luJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdhbGxvd0NoaWxkcmVuJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdkaXNhbGxvd0luJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdkaXNhbGxvd0NoaWxkcmVuJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdhbGxvd0NvbnRlbnRPZicpO1xuICAgIGNvcHlQcm9wZXJ0eShzb3VyY2VJdGVtUnVsZXMsIGl0ZW1SdWxlLCAnYWxsb3dXaGVyZScpO1xuICAgIGNvcHlQcm9wZXJ0eShzb3VyY2VJdGVtUnVsZXMsIGl0ZW1SdWxlLCAnYWxsb3dBdHRyaWJ1dGVzJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdkaXNhbGxvd0F0dHJpYnV0ZXMnKTtcbiAgICBjb3B5UHJvcGVydHkoc291cmNlSXRlbVJ1bGVzLCBpdGVtUnVsZSwgJ2FsbG93QXR0cmlidXRlc09mJyk7XG4gICAgY29weVByb3BlcnR5KHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUsICdpbmhlcml0VHlwZXNGcm9tJyk7XG4gICAgcmVzb2x2ZUluaGVyaXRBbGwoc291cmNlSXRlbVJ1bGVzLCBpdGVtUnVsZSk7XG4gICAgcmV0dXJuIGl0ZW1SdWxlO1xufVxuZnVuY3Rpb24gcHJvcGFnYXRlQWxsb3dJbihkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgcGFyZW50TmFtZSBvZiBpdGVtLmFsbG93SW4pe1xuICAgICAgICBjb25zdCBwYXJlbnRJdGVtID0gZGVmaW5pdGlvbnNbcGFyZW50TmFtZV07XG4gICAgICAgIGlmIChwYXJlbnRJdGVtKSB7XG4gICAgICAgICAgICBwYXJlbnRJdGVtLmFsbG93Q2hpbGRyZW4uYWRkKGl0ZW0ubmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtLmFsbG93SW4uZGVsZXRlKHBhcmVudE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcHJvcGFnYXRlQWxsb3dDaGlsZHJlbihkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgY2hpbGROYW1lIG9mIGl0ZW0uYWxsb3dDaGlsZHJlbil7XG4gICAgICAgIGNvbnN0IGNoaWxkSXRlbSA9IGRlZmluaXRpb25zW2NoaWxkTmFtZV07XG4gICAgICAgIGlmIChjaGlsZEl0ZW0pIHtcbiAgICAgICAgICAgIGNoaWxkSXRlbS5hbGxvd0luLmFkZChpdGVtLm5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbS5hbGxvd0NoaWxkcmVuLmRlbGV0ZShjaGlsZE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcHJvcGFnYXRlRGlzYWxsb3dJbihkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgcGFyZW50TmFtZSBvZiBpdGVtLmRpc2FsbG93SW4pe1xuICAgICAgICBjb25zdCBwYXJlbnRJdGVtID0gZGVmaW5pdGlvbnNbcGFyZW50TmFtZV07XG4gICAgICAgIGlmIChwYXJlbnRJdGVtKSB7XG4gICAgICAgICAgICBwYXJlbnRJdGVtLmRpc2FsbG93Q2hpbGRyZW4uYWRkKGl0ZW0ubmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpdGVtLmRpc2FsbG93SW4uZGVsZXRlKHBhcmVudE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcHJvcGFnYXRlRGlzYWxsb3dDaGlsZHJlbihkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgY2hpbGROYW1lIG9mIGl0ZW0uZGlzYWxsb3dDaGlsZHJlbil7XG4gICAgICAgIGNvbnN0IGNoaWxkSXRlbSA9IGRlZmluaXRpb25zW2NoaWxkTmFtZV07XG4gICAgICAgIGlmIChjaGlsZEl0ZW0pIHtcbiAgICAgICAgICAgIGNoaWxkSXRlbS5kaXNhbGxvd0luLmFkZChpdGVtLm5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbS5kaXNhbGxvd0NoaWxkcmVuLmRlbGV0ZShjaGlsZE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcmVzb2x2ZURpc2FsbG93cyhkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgY2hpbGROYW1lIG9mIGl0ZW0uZGlzYWxsb3dDaGlsZHJlbil7XG4gICAgICAgIGl0ZW0uYWxsb3dDaGlsZHJlbi5kZWxldGUoY2hpbGROYW1lKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwYXJlbnROYW1lIG9mIGl0ZW0uZGlzYWxsb3dJbil7XG4gICAgICAgIGl0ZW0uYWxsb3dJbi5kZWxldGUocGFyZW50TmFtZSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgYXR0cmlidXRlTmFtZSBvZiBpdGVtLmRpc2FsbG93QXR0cmlidXRlcyl7XG4gICAgICAgIGl0ZW0uYWxsb3dBdHRyaWJ1dGVzLmRlbGV0ZShhdHRyaWJ1dGVOYW1lKTtcbiAgICB9XG59XG5mdW5jdGlvbiBjb21waWxlQWxsb3dDb250ZW50T2YoZGVmaW5pdGlvbnMsIGl0ZW0pIHtcbiAgICBmb3IgKGNvbnN0IGFsbG93Q29udGVudE9mSXRlbU5hbWUgb2YgaXRlbS5hbGxvd0NvbnRlbnRPZil7XG4gICAgICAgIGNvbnN0IGJhc2VJdGVtID0gZGVmaW5pdGlvbnNbYWxsb3dDb250ZW50T2ZJdGVtTmFtZV07XG4gICAgICAgIGlmICghYmFzZUl0ZW0pIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENvcHkgYGRpc2FsbG93Q2hpbGRyZW5gIHRvIHByb3BhZ2F0ZSB0aGlzIFwia25vd2xlZGdlXCIgZG93biB0aGUgaW5oZXJpdGFuY2UgY2hhaW4uIFRoZSBpbmhlcml0YW5jZSBtYXkgaW52b2x2ZSBtdWx0aXBsZSBpdGVtcyBhbmRcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBub3QgcHJvcGFnYXRlZCwgdGhlbiBpdGVtcyBkb3duIHRoZSBjaGFpbiBtYXkgc3RhcnQgdG8gYWxsb3cgZm9yIGl0ZW1zIHRoYXQgd2VyZSBkaXNhbGxvd2VkIGJ5IHByZXZpb3VzIGJhc2UgaXRlbXMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoZSBzY2VuYXJpb3Mgd2VyZSBpdCBpcyBpbXBvcnRhbnQgaW52b2x2ZXMgbXVsdGlwbGUgaW5oZXJpdHMgYm90aCBvbiBwYXJlbnQgaXRlbXMgc2lkZSBhbmQgb24gdGhlIGNoaWxkIGl0ZW1zIHNpZGUuXG4gICAgICAgIGJhc2VJdGVtLmRpc2FsbG93Q2hpbGRyZW4uZm9yRWFjaCgoY2hpbGROYW1lKT0+e1xuICAgICAgICAgICAgLy8gT3duIGl0ZW0ncyBydWxlcyB0YWtlcyBwcmVjZWRlbmNlIGJlZm9yZSBpbmhlcml0ZWQuXG4gICAgICAgICAgICAvLyBJZiB0aGUgaXRlbSBkaXJlY3RseSBhbGxvd3MgZm9yIGdpdmVuIGNoaWxkLCBpZ25vcmUgdGhhdCBiYXNlIGl0ZW0gZGlzYWxsb3dlZCB0aGF0IGNoaWxkLlxuICAgICAgICAgICAgaWYgKGl0ZW0uYWxsb3dDaGlsZHJlbi5oYXMoY2hpbGROYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGl0ZW0uZGlzYWxsb3dDaGlsZHJlbi5hZGQoY2hpbGROYW1lKTtcbiAgICAgICAgICAgIGRlZmluaXRpb25zW2NoaWxkTmFtZV0uZGlzYWxsb3dJbi5hZGQoaXRlbS5uYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENvcHkgYGFsbG93Q2hpbGRyZW5gIGZyb20gdGhlIGJhc2UgaXRlbSB0byBhbGxvdyBmb3IgdGhlIHNhbWUgaXRlbXMuXG4gICAgICAgIGJhc2VJdGVtLmFsbG93Q2hpbGRyZW4uZm9yRWFjaCgoY2hpbGROYW1lKT0+e1xuICAgICAgICAgICAgLy8gT3duIGl0ZW0ncyBydWxlcyB0YWtlcyBwcmVjZWRlbmNlIGJlZm9yZSBpbmhlcml0ZWQuXG4gICAgICAgICAgICAvLyBBbHNvLCBgaXRlbS5kaXNhbGxvd0NoaWxkcmVuYCBtaWdodCBnZXQgc29tZSBuZXcgaXRlbXMgZHVyaW5nIGluaGVyaXRhbmNlIHByb2Nlc3MuXG4gICAgICAgICAgICBpZiAoaXRlbS5kaXNhbGxvd0NoaWxkcmVuLmhhcyhjaGlsZE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5hbGxvd0NoaWxkcmVuLmFkZChjaGlsZE5hbWUpO1xuICAgICAgICAgICAgZGVmaW5pdGlvbnNbY2hpbGROYW1lXS5hbGxvd0luLmFkZChpdGVtLm5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBjb21waWxlQWxsb3dXaGVyZShkZWZpbml0aW9ucywgaXRlbSkge1xuICAgIGZvciAoY29uc3QgYWxsb3dXaGVyZUl0ZW1OYW1lIG9mIGl0ZW0uYWxsb3dXaGVyZSl7XG4gICAgICAgIGNvbnN0IGJhc2VJdGVtID0gZGVmaW5pdGlvbnNbYWxsb3dXaGVyZUl0ZW1OYW1lXTtcbiAgICAgICAgaWYgKCFiYXNlSXRlbSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ29weSBgZGlzYWxsb3dJbmAgdG8gcHJvcGFnYXRlIHRoaXMgXCJrbm93bGVkZ2VcIiBkb3duIHRoZSBpbmhlcml0YW5jZSBjaGFpbi4gVGhlIGluaGVyaXRhbmNlIG1heSBpbnZvbHZlIG11bHRpcGxlIGl0ZW1zIGFuZFxuICAgICAgICAvLyBpZiB0aGlzIGlzIG5vdCBwcm9wYWdhdGVkLCB0aGVuIGl0ZW1zIGRvd24gdGhlIGNoYWluIG1heSBzdGFydCB0byBiZSBhbGxvd2VkIGluIGl0ZW1zIGluIHdoaWNoIHRoZXkgd2VyZSBkaXNhbGxvd2VkIHByZXZpb3VzbHkuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoZSBzY2VuYXJpb3Mgd2VyZSBpdCBpcyBpbXBvcnRhbnQgaW52b2x2ZXMgbXVsdGlwbGUgaW5oZXJpdHMgYm90aCBvbiBwYXJlbnQgaXRlbXMgc2lkZSBhbmQgb24gdGhlIGNoaWxkIGl0ZW1zIHNpZGUuXG4gICAgICAgIGJhc2VJdGVtLmRpc2FsbG93SW4uZm9yRWFjaCgocGFyZW50TmFtZSk9PntcbiAgICAgICAgICAgIC8vIE93biBpdGVtJ3MgcnVsZXMgdGFrZXMgcHJlY2VkZW5jZSBiZWZvcmUgaW5oZXJpdGVkLlxuICAgICAgICAgICAgLy8gSWYgdGhlIGl0ZW0gaXMgZGlyZWN0bHkgYWxsb3dlZCBpbiBnaXZlbiBwYXJlbnQsIGlnbm9yZSB0aGF0IGJhc2UgaXRlbSB3YXMgZGlzYWxsb3dlZCBpbiBpdC5cbiAgICAgICAgICAgIGlmIChpdGVtLmFsbG93SW4uaGFzKHBhcmVudE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5kaXNhbGxvd0luLmFkZChwYXJlbnROYW1lKTtcbiAgICAgICAgICAgIGRlZmluaXRpb25zW3BhcmVudE5hbWVdLmRpc2FsbG93Q2hpbGRyZW4uYWRkKGl0ZW0ubmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBDb3B5IGBhbGxvd0luYCBmcm9tIHRoZSBiYXNlIGl0ZW0gdG8gYWxsb3cgaXRlbSBpbiBzYW1lIHBhcmVudHMuXG4gICAgICAgIGJhc2VJdGVtLmFsbG93SW4uZm9yRWFjaCgocGFyZW50TmFtZSk9PntcbiAgICAgICAgICAgIC8vIE93biBpdGVtJ3MgcnVsZXMgdGFrZXMgcHJlY2VkZW5jZSBiZWZvcmUgaW5oZXJpdGVkLlxuICAgICAgICAgICAgLy8gQWxzbywgYGl0ZW0uZGlzYWxsb3dJbmAgbWlnaHQgZ2V0IHNvbWUgbmV3IGl0ZW1zIGR1cmluZyBpbmhlcml0YW5jZSBwcm9jZXNzLlxuICAgICAgICAgICAgaWYgKGl0ZW0uZGlzYWxsb3dJbi5oYXMocGFyZW50TmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtLmFsbG93SW4uYWRkKHBhcmVudE5hbWUpO1xuICAgICAgICAgICAgZGVmaW5pdGlvbnNbcGFyZW50TmFtZV0uYWxsb3dDaGlsZHJlbi5hZGQoaXRlbS5uYW1lKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gY29tcGlsZURlZmluaXRpb25zKGRlZmluaXRpb25zKSB7XG4gICAgY29uc3QgZmluYWxEZWZpbml0aW9ucyA9IHt9O1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBPYmplY3QudmFsdWVzKGRlZmluaXRpb25zKSl7XG4gICAgICAgIGZpbmFsRGVmaW5pdGlvbnNbaXRlbS5uYW1lXSA9IHtcbiAgICAgICAgICAgIG5hbWU6IGl0ZW0ubmFtZSxcbiAgICAgICAgICAgIC8vIGBpcypgIHByb3BlcnRpZXMgbWF5IG5vdCBiZSBzZXQgLSBjb252ZXJ0IGB1bmRlZmluZWRgIHRvIGBmYWxzZWAuXG4gICAgICAgICAgICBpc0Jsb2NrOiAhIWl0ZW0uaXNCbG9jayxcbiAgICAgICAgICAgIGlzQ29udGVudDogISFpdGVtLmlzQ29udGVudCxcbiAgICAgICAgICAgIGlzSW5saW5lOiAhIWl0ZW0uaXNJbmxpbmUsXG4gICAgICAgICAgICBpc0xpbWl0OiAhIWl0ZW0uaXNMaW1pdCxcbiAgICAgICAgICAgIGlzT2JqZWN0OiAhIWl0ZW0uaXNPYmplY3QsXG4gICAgICAgICAgICBpc1NlbGVjdGFibGU6ICEhaXRlbS5pc1NlbGVjdGFibGUsXG4gICAgICAgICAgICAvLyBGaWx0ZXIgb3V0IG5vbi1leGlzdGluZyBpdGVtcy5cbiAgICAgICAgICAgIGFsbG93SW46IEFycmF5LmZyb20oaXRlbS5hbGxvd0luKS5maWx0ZXIoKG5hbWUpPT4hIWRlZmluaXRpb25zW25hbWVdKSxcbiAgICAgICAgICAgIGFsbG93Q2hpbGRyZW46IEFycmF5LmZyb20oaXRlbS5hbGxvd0NoaWxkcmVuKS5maWx0ZXIoKG5hbWUpPT4hIWRlZmluaXRpb25zW25hbWVdKSxcbiAgICAgICAgICAgIGFsbG93QXR0cmlidXRlczogQXJyYXkuZnJvbShpdGVtLmFsbG93QXR0cmlidXRlcylcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbmFsRGVmaW5pdGlvbnM7XG59XG5mdW5jdGlvbiBjb21waWxlQWxsb3dBdHRyaWJ1dGVzT2YoZGVmaW5pdGlvbnMsIGl0ZW0pIHtcbiAgICBmb3IgKGNvbnN0IGFsbG93QXR0cmlidXRlT2ZJdGVtTmFtZSBvZiBpdGVtLmFsbG93QXR0cmlidXRlc09mKXtcbiAgICAgICAgY29uc3QgYmFzZUl0ZW0gPSBkZWZpbml0aW9uc1thbGxvd0F0dHJpYnV0ZU9mSXRlbU5hbWVdO1xuICAgICAgICBpZiAoIWJhc2VJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYmFzZUl0ZW0uYWxsb3dBdHRyaWJ1dGVzLmZvckVhY2goKGF0dHJpYnV0ZU5hbWUpPT57XG4gICAgICAgICAgICBpZiAoaXRlbS5kaXNhbGxvd0F0dHJpYnV0ZXMuaGFzKGF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbS5hbGxvd0F0dHJpYnV0ZXMuYWRkKGF0dHJpYnV0ZU5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBjb21waWxlSW5oZXJpdFByb3BlcnRpZXNGcm9tKGRlZmluaXRpb25zLCBpdGVtKSB7XG4gICAgZm9yIChjb25zdCBpbmhlcml0UHJvcGVydGllc09mSXRlbU5hbWUgb2YgaXRlbS5pbmhlcml0VHlwZXNGcm9tKXtcbiAgICAgICAgY29uc3QgaW5oZXJpdEZyb20gPSBkZWZpbml0aW9uc1tpbmhlcml0UHJvcGVydGllc09mSXRlbU5hbWVdO1xuICAgICAgICBpZiAoaW5oZXJpdEZyb20pIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGVOYW1lcyA9IE9iamVjdC5rZXlzKGluaGVyaXRGcm9tKS5maWx0ZXIoKG5hbWUpPT5uYW1lLnN0YXJ0c1dpdGgoJ2lzJykpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHR5cGVOYW1lcyl7XG4gICAgICAgICAgICAgICAgaWYgKCEobmFtZSBpbiBpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtW25hbWVdID0gaW5oZXJpdEZyb21bbmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gY29weVR5cGVzKHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUpIHtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZUl0ZW1SdWxlIG9mIHNvdXJjZUl0ZW1SdWxlcyl7XG4gICAgICAgIGNvbnN0IHR5cGVOYW1lcyA9IE9iamVjdC5rZXlzKHNvdXJjZUl0ZW1SdWxlKS5maWx0ZXIoKG5hbWUpPT5uYW1lLnN0YXJ0c1dpdGgoJ2lzJykpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdHlwZU5hbWVzKXtcbiAgICAgICAgICAgIGl0ZW1SdWxlW25hbWVdID0gISFzb3VyY2VJdGVtUnVsZVtuYW1lXTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNvcHlQcm9wZXJ0eShzb3VyY2VJdGVtUnVsZXMsIGl0ZW1SdWxlLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZUl0ZW1SdWxlIG9mIHNvdXJjZUl0ZW1SdWxlcyl7XG4gICAgICAgIGxldCB2YWx1ZSA9IHNvdXJjZUl0ZW1SdWxlW3Byb3BlcnR5TmFtZV07XG4gICAgICAgIC8vIGB2YWx1ZWAgY2FuIGJlIGEgc3RyaW5nLCBhbiBhcnJheSBvciB1bmRlZmluZWQuXG4gICAgICAgIC8vIENvbnZlcnQgYSBzdHJpbmcgdG8gYW4gYXJyYXkgd2l0aCBvbmUgaXRlbSwgdGhlbiBoYW5kbGUgYW4gYXJyYXkuIFNraXAgdW5kZWZpbmVkIHRoaXMgd2F5LlxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFtcbiAgICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHZhbHVlLmZvckVhY2goKHNpbmdsZVZhbHVlKT0+aXRlbVJ1bGVbcHJvcGVydHlOYW1lXS5hZGQoc2luZ2xlVmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIHJlc29sdmVJbmhlcml0QWxsKHNvdXJjZUl0ZW1SdWxlcywgaXRlbVJ1bGUpIHtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZUl0ZW1SdWxlIG9mIHNvdXJjZUl0ZW1SdWxlcyl7XG4gICAgICAgIGNvbnN0IGluaGVyaXRGcm9tID0gc291cmNlSXRlbVJ1bGUuaW5oZXJpdEFsbEZyb207XG4gICAgICAgIGlmIChpbmhlcml0RnJvbSkge1xuICAgICAgICAgICAgaXRlbVJ1bGUuYWxsb3dDb250ZW50T2YuYWRkKGluaGVyaXRGcm9tKTtcbiAgICAgICAgICAgIGl0ZW1SdWxlLmFsbG93V2hlcmUuYWRkKGluaGVyaXRGcm9tKTtcbiAgICAgICAgICAgIGl0ZW1SdWxlLmFsbG93QXR0cmlidXRlc09mLmFkZChpbmhlcml0RnJvbSk7XG4gICAgICAgICAgICBpdGVtUnVsZS5pbmhlcml0VHlwZXNGcm9tLmFkZChpbmhlcml0RnJvbSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBtYXBDb250ZXh0SXRlbShjdHhJdGVtKSB7XG4gICAgaWYgKHR5cGVvZiBjdHhJdGVtID09ICdzdHJpbmcnIHx8IGN0eEl0ZW0uaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogdHlwZW9mIGN0eEl0ZW0gPT0gJ3N0cmluZycgPyBjdHhJdGVtIDogJyRkb2N1bWVudEZyYWdtZW50JyxcbiAgICAgICAgICAgICpnZXRBdHRyaWJ1dGVLZXlzICgpIHt9LFxuICAgICAgICAgICAgZ2V0QXR0cmlidXRlICgpIHt9XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC8vICckdGV4dCcgbWVhbnMgdGV4dCBub2RlcyBhbmQgdGV4dCBwcm94aWVzLlxuICAgICAgICAgICAgbmFtZTogY3R4SXRlbS5pcygnZWxlbWVudCcpID8gY3R4SXRlbS5uYW1lIDogJyR0ZXh0JyxcbiAgICAgICAgICAgICpnZXRBdHRyaWJ1dGVLZXlzICgpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCogY3R4SXRlbS5nZXRBdHRyaWJ1dGVLZXlzKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QXR0cmlidXRlIChrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3R4SXRlbS5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG59XG4vKipcbiAqIEdlbmVyYXRvciBmdW5jdGlvbiByZXR1cm5pbmcgdmFsdWVzIGZyb20gcHJvdmlkZWQgd2Fsa2Vycywgc3dpdGNoaW5nIGJldHdlZW4gdGhlbSBhdCBlYWNoIGl0ZXJhdGlvbi4gSWYgb25seSBvbmUgd2Fsa2VyXG4gKiBpcyBwcm92aWRlZCBpdCB3aWxsIHJldHVybiBkYXRhIG9ubHkgZnJvbSB0aGF0IHdhbGtlci5cbiAqXG4gKiBAcGFyYW0gYmFja3dhcmQgV2Fsa2VyIGl0ZXJhdGluZyBpbiBiYWNrd2FyZCBkaXJlY3Rpb24uXG4gKiBAcGFyYW0gZm9yd2FyZCBXYWxrZXIgaXRlcmF0aW5nIGluIGZvcndhcmQgZGlyZWN0aW9uLlxuICogQHJldHVybnMgT2JqZWN0IHJldHVybmVkIGF0IGVhY2ggaXRlcmF0aW9uIGNvbnRhaW5zIGB2YWx1ZWAgYW5kIGB3YWxrZXJgIChpbmZvcm1pbmcgd2hpY2ggd2Fsa2VyIHJldHVybmVkXG4gKiBnaXZlbiB2YWx1ZSkgZmllbGRzLlxuICovIGZ1bmN0aW9uKiBjb21iaW5lV2Fsa2VycyhiYWNrd2FyZCwgZm9yd2FyZCkge1xuICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgd2hpbGUoIWRvbmUpe1xuICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgaWYgKGJhY2t3YXJkKSB7XG4gICAgICAgICAgICBjb25zdCBzdGVwID0gYmFja3dhcmQubmV4dCgpO1xuICAgICAgICAgICAgaWYgKCFzdGVwLmRvbmUpIHtcbiAgICAgICAgICAgICAgICBkb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgeWllbGQge1xuICAgICAgICAgICAgICAgICAgICB3YWxrZXI6IGJhY2t3YXJkLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3RlcC52YWx1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvcndhcmQpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSBmb3J3YXJkLm5leHQoKTtcbiAgICAgICAgICAgIGlmICghc3RlcC5kb25lKSB7XG4gICAgICAgICAgICAgICAgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgICAgICAgd2Fsa2VyOiBmb3J3YXJkLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3RlcC52YWx1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIFRha2VzIGFuIGFycmF5IG9mIG5vbi1pbnRlcnNlY3RpbmcgcmFuZ2VzLiBGb3IgZWFjaCBvZiB0aGVtIGdldHMgbWluaW1hbCBmbGF0IHJhbmdlcyBjb3ZlcmluZyB0aGF0IHJhbmdlIGFuZCByZXR1cm5zXG4gKiBhbGwgdGhvc2UgbWluaW1hbCBmbGF0IHJhbmdlcy5cbiAqXG4gKiBAcGFyYW0gcmFuZ2VzIFJhbmdlcyB0byBwcm9jZXNzLlxuICogQHJldHVybnMgTWluaW1hbCBmbGF0IHJhbmdlcyBvZiBnaXZlbiBgcmFuZ2VzYC5cbiAqLyBmdW5jdGlvbiogY29udmVydFRvTWluaW1hbEZsYXRSYW5nZXMocmFuZ2VzKSB7XG4gICAgZm9yIChjb25zdCByYW5nZSBvZiByYW5nZXMpe1xuICAgICAgICB5aWVsZCogcmFuZ2UuZ2V0TWluaW1hbEZsYXRSYW5nZXMoKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZW1vdmVEaXNhbGxvd2VkQXR0cmlidXRlRnJvbU5vZGUoc2NoZW1hLCBub2RlLCB3cml0ZXIpIHtcbiAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiBub2RlLmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgIGlmICghc2NoZW1hLmNoZWNrQXR0cmlidXRlKG5vZGUsIGF0dHJpYnV0ZSkpIHtcbiAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlLCBub2RlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBVcGNhc3QgZGlzcGF0Y2hlciBpcyBhIGNlbnRyYWwgcG9pbnQgb2YgdGhlIHZpZXctdG8tbW9kZWwgY29udmVyc2lvbiwgd2hpY2ggaXMgYSBwcm9jZXNzIG9mXG4gKiBjb252ZXJ0aW5nIGEgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgdmlldyBkb2N1bWVudCBmcmFnbWVudH0gb3JcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgZWxlbWVudH0gaW50byBhIGNvcnJlY3QgbW9kZWwgc3RydWN0dXJlLlxuICpcbiAqIER1cmluZyB0aGUgY29udmVyc2lvbiBwcm9jZXNzLCB0aGUgZGlzcGF0Y2hlciBmaXJlcyBldmVudHMgZm9yIGFsbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSB2aWV3IG5vZGVzfVxuICogZnJvbSB0aGUgY29udmVydGVkIHZpZXcgZG9jdW1lbnQgZnJhZ21lbnQuXG4gKiBTcGVjaWFsIGNhbGxiYWNrcyBjYWxsZWQgXCJjb252ZXJ0ZXJzXCIgc2hvdWxkIGxpc3RlbiB0byB0aGVzZSBldmVudHMgaW4gb3JkZXIgdG8gY29udmVydCB0aGUgdmlldyBub2Rlcy5cbiAqXG4gKiBUaGUgc2Vjb25kIHBhcmFtZXRlciBvZiB0aGUgY2FsbGJhY2sgaXMgdGhlIGBkYXRhYCBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6XG4gKlxuICogKiBgZGF0YS52aWV3SXRlbWAgY29udGFpbnMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZSB2aWV3IG5vZGV9IG9yIGFcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IHZpZXcgZG9jdW1lbnQgZnJhZ21lbnR9XG4gKiB0aGF0IGlzIGNvbnZlcnRlZCBhdCB0aGUgbW9tZW50IGFuZCBtaWdodCBiZSBoYW5kbGVkIGJ5IHRoZSBjYWxsYmFjay5cbiAqICogYGRhdGEubW9kZWxSYW5nZWAgaXMgdXNlZCB0byBwb2ludCB0byB0aGUgcmVzdWx0XG4gKiBvZiB0aGUgY3VycmVudCBjb252ZXJzaW9uIChlLmcuIHRoZSBlbGVtZW50IHRoYXQgaXMgYmVpbmcgaW5zZXJ0ZWQpXG4gKiBhbmQgaXMgYWx3YXlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2V9IHdoZW4gdGhlIGNvbnZlcnNpb24gc3VjY2VlZHMuXG4gKiAqIGBkYXRhLm1vZGVsQ3Vyc29yYCBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSBvbiB3aGljaCB0aGUgY29udmVydGVyIHNob3VsZCBpbnNlcnRcbiAqIHRoZSBuZXdseSBjcmVhdGVkIGl0ZW1zLlxuICpcbiAqIFRoZSB0aGlyZCBwYXJhbWV0ZXIgb2YgdGhlIGNhbGxiYWNrIGlzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3RDb252ZXJzaW9uQXBpfVxuICogd2hpY2ggcHJvdmlkZXMgYWRkaXRpb25hbCB0b29scyBmb3IgY29udmVydGVycy5cbiAqXG4gKiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCBjb252ZXJzaW9uIGluIHRoZSB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvY29udmVyc2lvbi91cGNhc3QgVXBjYXN0IGNvbnZlcnNpb259IGd1aWRlLlxuICpcbiAqIEV4YW1wbGVzIG9mIGV2ZW50LWJhc2VkIGNvbnZlcnRlcnM6XG4gKlxuICogYGBgdHNcbiAqIC8vIEEgY29udmVydGVyIGZvciBsaW5rcyAoPGE+KS5cbiAqIGVkaXRvci5kYXRhLnVwY2FzdERpc3BhdGNoZXIub24oICdlbGVtZW50OmEnLCAoIGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSApID0+IHtcbiAqIFx0aWYgKCBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZSggZGF0YS52aWV3SXRlbSwgeyBuYW1lOiB0cnVlLCBhdHRyaWJ1dGVzOiBbICdocmVmJyBdIH0gKSApIHtcbiAqIFx0XHQvLyBUaGUgPGE+IGVsZW1lbnQgaXMgaW5saW5lIGFuZCBpcyByZXByZXNlbnRlZCBieSBhbiBhdHRyaWJ1dGUgaW4gdGhlIG1vZGVsLlxuICogXHRcdC8vIFRoaXMgaXMgd2h5IHlvdSBuZWVkIHRvIGNvbnZlcnQgb25seSBjaGlsZHJlbi5cbiAqIFx0XHRjb25zdCB7IG1vZGVsUmFuZ2UgfSA9IGNvbnZlcnNpb25BcGkuY29udmVydENoaWxkcmVuKCBkYXRhLnZpZXdJdGVtLCBkYXRhLm1vZGVsQ3Vyc29yICk7XG4gKlxuICogXHRcdGZvciAoIGxldCBpdGVtIG9mIG1vZGVsUmFuZ2UuZ2V0SXRlbXMoKSApIHtcbiAqIFx0XHRcdGlmICggY29udmVyc2lvbkFwaS5zY2hlbWEuY2hlY2tBdHRyaWJ1dGUoIGl0ZW0sICdsaW5rSHJlZicgKSApIHtcbiAqIFx0XHRcdFx0Y29udmVyc2lvbkFwaS53cml0ZXIuc2V0QXR0cmlidXRlKCAnbGlua0hyZWYnLCBkYXRhLnZpZXdJdGVtLmdldEF0dHJpYnV0ZSggJ2hyZWYnICksIGl0ZW0gKTtcbiAqIFx0XHRcdH1cbiAqIFx0XHR9XG4gKiBcdH1cbiAqIH0gKTtcbiAqXG4gKiAvLyBDb252ZXJ0IDxwPiBlbGVtZW50J3MgZm9udC1zaXplIHN0eWxlLlxuICogLy8gTm90ZTogWW91IHNob3VsZCB1c2UgYSBsb3ctcHJpb3JpdHkgb2JzZXJ2ZXIgaW4gb3JkZXIgdG8gZW5zdXJlIHRoYXRcbiAqIC8vIGl0IGlzIGV4ZWN1dGVkIGFmdGVyIHRoZSBlbGVtZW50LXRvLWVsZW1lbnQgY29udmVydGVyLlxuICogZWRpdG9yLmRhdGEudXBjYXN0RGlzcGF0Y2hlci5vbiggJ2VsZW1lbnQ6cCcsICggZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuICogXHRjb25zdCB7IGNvbnN1bWFibGUsIHNjaGVtYSwgd3JpdGVyIH0gPSBjb252ZXJzaW9uQXBpO1xuICpcbiAqIFx0aWYgKCAhY29uc3VtYWJsZS5jb25zdW1lKCBkYXRhLnZpZXdJdGVtLCB7IHN0eWxlOiAnZm9udC1zaXplJyB9ICkgKSB7XG4gKiBcdFx0cmV0dXJuO1xuICogXHR9XG4gKlxuICogXHRjb25zdCBmb250U2l6ZSA9IGRhdGEudmlld0l0ZW0uZ2V0U3R5bGUoICdmb250LXNpemUnICk7XG4gKlxuICogXHQvLyBEbyBub3QgZ28gZm9yIHRoZSBtb2RlbCBlbGVtZW50IGFmdGVyIGRhdGEubW9kZWxDdXJzb3IgYmVjYXVzZSBpdCBtaWdodCBoYXBwZW5cbiAqIFx0Ly8gdGhhdCBhIHNpbmdsZSB2aWV3IGVsZW1lbnQgd2FzIGNvbnZlcnRlZCB0byBtdWx0aXBsZSBtb2RlbCBlbGVtZW50cy4gR2V0IGFsbCBvZiB0aGVtLlxuICogXHRmb3IgKCBjb25zdCBpdGVtIG9mIGRhdGEubW9kZWxSYW5nZS5nZXRJdGVtcyggeyBzaGFsbG93OiB0cnVlIH0gKSApIHtcbiAqIFx0XHRpZiAoIHNjaGVtYS5jaGVja0F0dHJpYnV0ZSggaXRlbSwgJ2ZvbnRTaXplJyApICkge1xuICogXHRcdFx0d3JpdGVyLnNldEF0dHJpYnV0ZSggJ2ZvbnRTaXplJywgZm9udFNpemUsIGl0ZW0gKTtcbiAqIFx0XHR9XG4gKiBcdH1cbiAqIH0sIHsgcHJpb3JpdHk6ICdsb3cnIH0gKTtcbiAqXG4gKiAvLyBDb252ZXJ0IGFsbCBlbGVtZW50cyB3aGljaCBoYXZlIG5vIGN1c3RvbSBjb252ZXJ0ZXIgaW50byBhIHBhcmFncmFwaCAoYXV0b3BhcmFncmFwaGluZykuXG4gKiBlZGl0b3IuZGF0YS51cGNhc3REaXNwYXRjaGVyLm9uKCAnZWxlbWVudCcsICggZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuICogXHQvLyBDaGVjayBpZiBhbiBlbGVtZW50IGNhbiBiZSBjb252ZXJ0ZWQuXG4gKiBcdGlmICggIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KCBkYXRhLnZpZXdJdGVtLCB7IG5hbWU6IGRhdGEudmlld0l0ZW0ubmFtZSB9ICkgKSB7XG4gKiBcdFx0Ly8gV2hlbiBhbiBlbGVtZW50IGlzIGFscmVhZHkgY29uc3VtZWQgYnkgaGlnaGVyIHByaW9yaXR5IGNvbnZlcnRlcnMsIGRvIG5vdGhpbmcuXG4gKiBcdFx0cmV0dXJuO1xuICogXHR9XG4gKlxuICogXHRjb25zdCBwYXJhZ3JhcGggPSBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVFbGVtZW50KCAncGFyYWdyYXBoJyApO1xuICpcbiAqIFx0Ly8gVHJ5IHRvIHNhZmVseSBpbnNlcnQgYSBwYXJhZ3JhcGggYXQgdGhlIG1vZGVsIGN1cnNvciAtIGl0IHdpbGwgZmluZCBhbiBhbGxvd2VkIHBhcmVudCBmb3IgdGhlIGN1cnJlbnQgZWxlbWVudC5cbiAqIFx0aWYgKCAhY29udmVyc2lvbkFwaS5zYWZlSW5zZXJ0KCBwYXJhZ3JhcGgsIGRhdGEubW9kZWxDdXJzb3IgKSApIHtcbiAqIFx0XHQvLyBXaGVuIGFuIGVsZW1lbnQgd2FzIG5vdCBpbnNlcnRlZCwgaXQgbWVhbnMgdGhhdCB5b3UgY2Fubm90IGluc2VydCBhIHBhcmFncmFwaCBhdCB0aGlzIHBvc2l0aW9uLlxuICogXHRcdHJldHVybjtcbiAqIFx0fVxuICpcbiAqIFx0Ly8gQ29uc3VtZSB0aGUgaW5zZXJ0ZWQgZWxlbWVudC5cbiAqIFx0Y29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoIGRhdGEudmlld0l0ZW0sIHsgbmFtZTogZGF0YS52aWV3SXRlbS5uYW1lIH0gKSApO1xuICpcbiAqIFx0Ly8gQ29udmVydCB0aGUgY2hpbGRyZW4gdG8gYSBwYXJhZ3JhcGguXG4gKiBcdGNvbnN0IHsgbW9kZWxSYW5nZSB9ID0gY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oIGRhdGEudmlld0l0ZW0sICBwYXJhZ3JhcGggKSApO1xuICpcbiAqIFx0Ly8gVXBkYXRlIGBtb2RlbFJhbmdlYCBhbmQgYG1vZGVsQ3Vyc29yYCBpbiB0aGUgYGRhdGFgIGFzIGEgY29udmVyc2lvbiByZXN1bHQuXG4gKiBcdGNvbnZlcnNpb25BcGkudXBkYXRlQ29udmVyc2lvblJlc3VsdCggcGFyYWdyYXBoLCBkYXRhICk7XG4gKiB9LCB7IHByaW9yaXR5OiAnbG93JyB9ICk7XG4gKiBgYGBcbiAqXG4gKiBAZmlyZXMgdmlld0NsZWFudXBcbiAqIEBmaXJlcyBlbGVtZW50XG4gKiBAZmlyZXMgdGV4dFxuICogQGZpcmVzIGRvY3VtZW50RnJhZ21lbnRcbiAqLyBjbGFzcyBVcGNhc3REaXNwYXRjaGVyIGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbigpIHtcbiAgICAvKipcblx0ICogQW4gaW50ZXJmYWNlIHBhc3NlZCBieSB0aGUgZGlzcGF0Y2hlciB0byB0aGUgZXZlbnQgY2FsbGJhY2tzLlxuXHQgKi8gY29udmVyc2lvbkFwaTtcbiAgICAvKipcblx0ICogVGhlIGxpc3Qgb2YgZWxlbWVudHMgdGhhdCB3ZXJlIGNyZWF0ZWQgZHVyaW5nIHNwbGl0dGluZy5cblx0ICpcblx0ICogQWZ0ZXIgdGhlIGNvbnZlcnNpb24gcHJvY2VzcywgdGhlIGxpc3QgaXMgY2xlYXJlZC5cblx0ICovIF9zcGxpdFBhcnRzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBUaGUgbGlzdCBvZiBjdXJzb3IgcGFyZW50IGVsZW1lbnRzIHRoYXQgd2VyZSBjcmVhdGVkIGR1cmluZyBzcGxpdHRpbmcuXG5cdCAqXG5cdCAqIEFmdGVyIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MgdGhlIGxpc3QgaXMgY2xlYXJlZC5cblx0ICovIF9jdXJzb3JQYXJlbnRzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBUaGUgcG9zaXRpb24gaW4gdGhlIHRlbXBvcmFyeSBzdHJ1Y3R1cmUgd2hlcmUgdGhlIGNvbnZlcnRlZCBjb250ZW50IGlzIGluc2VydGVkLiBUaGUgc3RydWN0dXJlIHJlZmxlY3RzIHRoZSBjb250ZXh0IG9mXG5cdCAqIHRoZSB0YXJnZXQgcG9zaXRpb24gd2hlcmUgdGhlIGNvbnRlbnQgd2lsbCBiZSBpbnNlcnRlZC4gVGhpcyBwcm9wZXJ0eSBpcyBidWlsdCBiYXNlZCBvbiB0aGUgY29udGV4dCBwYXJhbWV0ZXIgb2YgdGhlXG5cdCAqIGNvbnZlcnQgbWV0aG9kLlxuXHQgKi8gX21vZGVsQ3Vyc29yID0gbnVsbDtcbiAgICAvKipcblx0ICogVGhlIGxpc3Qgb2YgZWxlbWVudHMgdGhhdCB3ZXJlIGNyZWF0ZWQgZHVyaW5nIHRoZSBzcGxpdHRpbmcgYnV0IHNob3VsZCBub3QgZ2V0IHJlbW92ZWQgb24gY29udmVyc2lvbiBlbmQgZXZlbiBpZiB0aGV5IGFyZSBlbXB0eS5cblx0ICpcblx0ICogVGhlIGxpc3QgaXMgY2xlYXJlZCBhZnRlciB0aGUgY29udmVyc2lvbiBwcm9jZXNzLlxuXHQgKi8gX2VtcHR5RWxlbWVudHNUb0tlZXAgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gdXBjYXN0IGRpc3BhdGNoZXIgdGhhdCBvcGVyYXRlcyB1c2luZyB0aGUgcGFzc2VkIEFQSS5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3RDb252ZXJzaW9uQXBpXG5cdCAqIEBwYXJhbSBjb252ZXJzaW9uQXBpIEFkZGl0aW9uYWwgcHJvcGVydGllcyBmb3IgYW4gaW50ZXJmYWNlIHRoYXQgd2lsbCBiZSBwYXNzZWQgdG8gZXZlbnRzIGZpcmVkXG5cdCAqIGJ5IHRoZSB1cGNhc3QgZGlzcGF0Y2hlci5cblx0ICovIGNvbnN0cnVjdG9yKGNvbnZlcnNpb25BcGkpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmNvbnZlcnNpb25BcGkgPSB7XG4gICAgICAgICAgICAuLi5jb252ZXJzaW9uQXBpLFxuICAgICAgICAgICAgY29uc3VtYWJsZTogbnVsbCxcbiAgICAgICAgICAgIHdyaXRlcjogbnVsbCxcbiAgICAgICAgICAgIHN0b3JlOiBudWxsLFxuICAgICAgICAgICAgY29udmVydEl0ZW06ICh2aWV3SXRlbSwgbW9kZWxDdXJzb3IpPT50aGlzLl9jb252ZXJ0SXRlbSh2aWV3SXRlbSwgbW9kZWxDdXJzb3IpLFxuICAgICAgICAgICAgY29udmVydENoaWxkcmVuOiAodmlld0VsZW1lbnQsIHBvc2l0aW9uT3JFbGVtZW50KT0+dGhpcy5fY29udmVydENoaWxkcmVuKHZpZXdFbGVtZW50LCBwb3NpdGlvbk9yRWxlbWVudCksXG4gICAgICAgICAgICBzYWZlSW5zZXJ0OiAobW9kZWxOb2RlLCBwb3NpdGlvbik9PnRoaXMuX3NhZmVJbnNlcnQobW9kZWxOb2RlLCBwb3NpdGlvbiksXG4gICAgICAgICAgICB1cGRhdGVDb252ZXJzaW9uUmVzdWx0OiAobW9kZWxFbGVtZW50LCBkYXRhKT0+dGhpcy5fdXBkYXRlQ29udmVyc2lvblJlc3VsdChtb2RlbEVsZW1lbnQsIGRhdGEpLFxuICAgICAgICAgICAgLy8gQWR2YW5jZWQgQVBJIC0gdXNlIG9ubHkgaWYgY3VzdG9tIHBvc2l0aW9uIGhhbmRsaW5nIGlzIG5lZWRlZC5cbiAgICAgICAgICAgIHNwbGl0VG9BbGxvd2VkUGFyZW50OiAobW9kZWxOb2RlLCBtb2RlbEN1cnNvcik9PnRoaXMuX3NwbGl0VG9BbGxvd2VkUGFyZW50KG1vZGVsTm9kZSwgbW9kZWxDdXJzb3IpLFxuICAgICAgICAgICAgZ2V0U3BsaXRQYXJ0czogKG1vZGVsRWxlbWVudCk9PnRoaXMuX2dldFNwbGl0UGFydHMobW9kZWxFbGVtZW50KSxcbiAgICAgICAgICAgIGtlZXBFbXB0eUVsZW1lbnQ6IChtb2RlbEVsZW1lbnQpPT50aGlzLl9rZWVwRW1wdHlFbGVtZW50KG1vZGVsRWxlbWVudClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyB0aGUgY29udmVyc2lvbiBwcm9jZXNzLiBUaGUgZW50cnkgcG9pbnQgZm9yIHRoZSBjb252ZXJzaW9uLlxuXHQgKlxuXHQgKiBAZmlyZXMgZWxlbWVudFxuXHQgKiBAZmlyZXMgdGV4dFxuXHQgKiBAZmlyZXMgZG9jdW1lbnRGcmFnbWVudFxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnQgVGhlIHBhcnQgb2YgdGhlIHZpZXcgdG8gYmUgY29udmVydGVkLlxuXHQgKiBAcGFyYW0gd3JpdGVyIEFuIGluc3RhbmNlIG9mIHRoZSBtb2RlbCB3cml0ZXIuXG5cdCAqIEBwYXJhbSBjb250ZXh0IEVsZW1lbnRzIHdpbGwgYmUgY29udmVydGVkIGFjY29yZGluZyB0byB0aGlzIGNvbnRleHQuXG5cdCAqIEByZXR1cm5zIE1vZGVsIGRhdGEgdGhhdCBpcyB0aGUgcmVzdWx0IG9mIHRoZSBjb252ZXJzaW9uIHByb2Nlc3Ncblx0ICogd3JhcHBlZCBpbiBgRG9jdW1lbnRGcmFnbWVudGAuIENvbnZlcnRlZCBtYXJrZXIgZWxlbWVudHMgd2lsbCBiZSBzZXQgYXMgdGhlIGRvY3VtZW50IGZyYWdtZW50J3Ncblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50I21hcmtlcnMgc3RhdGljIG1hcmtlcnMgbWFwfS5cblx0ICovIGNvbnZlcnQodmlld0VsZW1lbnQsIHdyaXRlciwgY29udGV4dCA9IFtcbiAgICAgICAgJyRyb290J1xuICAgIF0pIHtcbiAgICAgICAgdGhpcy5maXJlKCd2aWV3Q2xlYW51cCcsIHZpZXdFbGVtZW50KTtcbiAgICAgICAgLy8gQ3JlYXRlIGNvbnRleHQgdHJlZSBhbmQgc2V0IHBvc2l0aW9uIGluIHRoZSB0b3AgZWxlbWVudC5cbiAgICAgICAgLy8gSXRlbXMgd2lsbCBiZSBjb252ZXJ0ZWQgYWNjb3JkaW5nIHRvIHRoaXMgcG9zaXRpb24uXG4gICAgICAgIHRoaXMuX21vZGVsQ3Vyc29yID0gY3JlYXRlQ29udGV4dFRyZWUoY29udGV4dCwgd3JpdGVyKTtcbiAgICAgICAgLy8gU3RvcmUgd3JpdGVyIGluIGNvbnZlcnNpb24gYXMgYSBjb252ZXJzaW9uIEFQSVxuICAgICAgICAvLyB0byBiZSBzdXJlIHRoYXQgY29udmVyc2lvbiBwcm9jZXNzIHdpbGwgdXNlIHRoZSBzYW1lIGJhdGNoLlxuICAgICAgICB0aGlzLmNvbnZlcnNpb25BcGkud3JpdGVyID0gd3JpdGVyO1xuICAgICAgICAvLyBDcmVhdGUgY29uc3VtYWJsZSB2YWx1ZXMgbGlzdCBmb3IgY29udmVyc2lvbiBwcm9jZXNzLlxuICAgICAgICB0aGlzLmNvbnZlcnNpb25BcGkuY29uc3VtYWJsZSA9IFZpZXdDb25zdW1hYmxlLmNyZWF0ZUZyb20odmlld0VsZW1lbnQpO1xuICAgICAgICAvLyBDdXN0b20gZGF0YSBzdG9yZWQgYnkgY29udmVydGVyIGZvciBjb252ZXJzaW9uIHByb2Nlc3MuXG4gICAgICAgIHRoaXMuY29udmVyc2lvbkFwaS5zdG9yZSA9IHt9O1xuICAgICAgICAvLyBEbyB0aGUgY29udmVyc2lvbi5cbiAgICAgICAgY29uc3QgeyBtb2RlbFJhbmdlIH0gPSB0aGlzLl9jb252ZXJ0SXRlbSh2aWV3RWxlbWVudCwgdGhpcy5fbW9kZWxDdXJzb3IpO1xuICAgICAgICAvLyBDb252ZXJzaW9uIHJlc3VsdCBpcyBhbHdheXMgYSBkb2N1bWVudCBmcmFnbWVudCBzbyBsZXQncyBjcmVhdGUgaXQuXG4gICAgICAgIGNvbnN0IGRvY3VtZW50RnJhZ21lbnQgPSB3cml0ZXIuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICAvLyBXaGVuIHRoZXJlIGlzIGEgY29udmVyc2lvbiByZXN1bHQuXG4gICAgICAgIGlmIChtb2RlbFJhbmdlKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgYWxsIGVtcHR5IGVsZW1lbnRzIHRoYXQgd2VyZSBjcmVhdGVkIHdoaWxlIHNwbGl0dGluZy5cbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZUVtcHR5RWxlbWVudHMoKTtcbiAgICAgICAgICAgIC8vIE1vdmUgYWxsIGl0ZW1zIHRoYXQgd2VyZSBjb252ZXJ0ZWQgaW4gY29udGV4dCB0cmVlIHRvIHRoZSBkb2N1bWVudCBmcmFnbWVudC5cbiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuX21vZGVsQ3Vyc29yLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gcGFyZW50Ll9yZW1vdmVDaGlsZHJlbigwLCBwYXJlbnQuY2hpbGRDb3VudCk7XG4gICAgICAgICAgICBkb2N1bWVudEZyYWdtZW50Ll9pbnNlcnRDaGlsZCgwLCBjaGlsZHJlbik7XG4gICAgICAgICAgICAvLyBFeHRyYWN0IHRlbXBvcmFyeSBtYXJrZXJzIGVsZW1lbnRzIGZyb20gbW9kZWwgYW5kIHNldCBhcyBzdGF0aWMgbWFya2VycyBjb2xsZWN0aW9uLlxuICAgICAgICAgICAgZG9jdW1lbnRGcmFnbWVudC5tYXJrZXJzID0gZXh0cmFjdE1hcmtlcnNGcm9tTW9kZWxGcmFnbWVudChkb2N1bWVudEZyYWdtZW50LCB3cml0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENsZWFyIGNvbnRleHQgcG9zaXRpb24uXG4gICAgICAgIHRoaXMuX21vZGVsQ3Vyc29yID0gbnVsbDtcbiAgICAgICAgLy8gQ2xlYXIgc3BsaXQgZWxlbWVudHMgJiBwYXJlbnRzIGxpc3RzLlxuICAgICAgICB0aGlzLl9zcGxpdFBhcnRzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX2N1cnNvclBhcmVudHMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fZW1wdHlFbGVtZW50c1RvS2VlcC5jbGVhcigpO1xuICAgICAgICAvLyBDbGVhciBjb252ZXJzaW9uIEFQSS5cbiAgICAgICAgdGhpcy5jb252ZXJzaW9uQXBpLndyaXRlciA9IG51bGw7XG4gICAgICAgIHRoaXMuY29udmVyc2lvbkFwaS5zdG9yZSA9IG51bGw7XG4gICAgICAgIC8vIFJldHVybiBmcmFnbWVudCBhcyBjb252ZXJzaW9uIHJlc3VsdC5cbiAgICAgICAgcmV0dXJuIGRvY3VtZW50RnJhZ21lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdENvbnZlcnNpb25BcGkjY29udmVydEl0ZW1cblx0ICovIF9jb252ZXJ0SXRlbSh2aWV3SXRlbSwgbW9kZWxDdXJzb3IpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgIHZpZXdJdGVtLFxuICAgICAgICAgICAgbW9kZWxDdXJzb3IsXG4gICAgICAgICAgICBtb2RlbFJhbmdlOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIGlmICh2aWV3SXRlbS5pcygnZWxlbWVudCcpKSB7XG4gICAgICAgICAgICB0aGlzLmZpcmUoYGVsZW1lbnQ6JHt2aWV3SXRlbS5uYW1lfWAsIGRhdGEsIHRoaXMuY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH0gZWxzZSBpZiAodmlld0l0ZW0uaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgndGV4dCcsIGRhdGEsIHRoaXMuY29udmVyc2lvbkFwaSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ2RvY3VtZW50RnJhZ21lbnQnLCBkYXRhLCB0aGlzLmNvbnZlcnNpb25BcGkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhhbmRsZSBpbmNvcnJlY3QgY29udmVyc2lvbiByZXN1bHQuXG4gICAgICAgIGlmIChkYXRhLm1vZGVsUmFuZ2UgJiYgIShkYXRhLm1vZGVsUmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogSW5jb3JyZWN0IGNvbnZlcnNpb24gcmVzdWx0IHdhcyBkcm9wcGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIE1vZGVsIHJhbmdlfSBzaG91bGQgYmUgYSBjb252ZXJzaW9uIHJlc3VsdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igdmlldy1jb252ZXJzaW9uLWRpc3BhdGNoZXItaW5jb3JyZWN0LXJlc3VsdFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd2aWV3LWNvbnZlcnNpb24tZGlzcGF0Y2hlci1pbmNvcnJlY3QtcmVzdWx0JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vZGVsUmFuZ2U6IGRhdGEubW9kZWxSYW5nZSxcbiAgICAgICAgICAgIG1vZGVsQ3Vyc29yOiBkYXRhLm1vZGVsQ3Vyc29yXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdENvbnZlcnNpb25BcGkjY29udmVydENoaWxkcmVuXG5cdCAqLyBfY29udmVydENoaWxkcmVuKHZpZXdJdGVtLCBlbGVtZW50T3JNb2RlbEN1cnNvcikge1xuICAgICAgICBsZXQgbmV4dE1vZGVsQ3Vyc29yID0gZWxlbWVudE9yTW9kZWxDdXJzb3IuaXMoJ3Bvc2l0aW9uJykgPyBlbGVtZW50T3JNb2RlbEN1cnNvciA6IFBvc2l0aW9uLl9jcmVhdGVBdChlbGVtZW50T3JNb2RlbEN1cnNvciwgMCk7XG4gICAgICAgIGNvbnN0IG1vZGVsUmFuZ2UgPSBuZXcgUmFuZ2UobmV4dE1vZGVsQ3Vyc29yKTtcbiAgICAgICAgZm9yIChjb25zdCB2aWV3Q2hpbGQgb2YgQXJyYXkuZnJvbSh2aWV3SXRlbS5nZXRDaGlsZHJlbigpKSl7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl9jb252ZXJ0SXRlbSh2aWV3Q2hpbGQsIG5leHRNb2RlbEN1cnNvcik7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lm1vZGVsUmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsUmFuZ2UuZW5kID0gcmVzdWx0Lm1vZGVsUmFuZ2UuZW5kO1xuICAgICAgICAgICAgICAgIG5leHRNb2RlbEN1cnNvciA9IHJlc3VsdC5tb2RlbEN1cnNvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbW9kZWxSYW5nZSxcbiAgICAgICAgICAgIG1vZGVsQ3Vyc29yOiBuZXh0TW9kZWxDdXJzb3JcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3VwY2FzdGRpc3BhdGNoZXJ+VXBjYXN0Q29udmVyc2lvbkFwaSNzYWZlSW5zZXJ0XG5cdCAqLyBfc2FmZUluc2VydChtb2RlbE5vZGUsIHBvc2l0aW9uKSB7XG4gICAgICAgIC8vIEZpbmQgYWxsb3dlZCBwYXJlbnQgZm9yIGVsZW1lbnQgdGhhdCB3ZSBhcmUgZ29pbmcgdG8gaW5zZXJ0LlxuICAgICAgICAvLyBJZiBjdXJyZW50IHBhcmVudCBkb2VzIG5vdCBhbGxvdyB0byBpbnNlcnQgZWxlbWVudCBidXQgb25lIG9mIHRoZSBhbmNlc3RvcnMgZG9lc1xuICAgICAgICAvLyB0aGVuIHNwbGl0IG5vZGVzIHRvIGFsbG93ZWQgcGFyZW50LlxuICAgICAgICBjb25zdCBzcGxpdFJlc3VsdCA9IHRoaXMuX3NwbGl0VG9BbGxvd2VkUGFyZW50KG1vZGVsTm9kZSwgcG9zaXRpb24pO1xuICAgICAgICAvLyBXaGVuIHRoZXJlIGlzIG5vIHNwbGl0IHJlc3VsdCBpdCBtZWFucyB0aGF0IHdlIGNhbid0IGluc2VydCBlbGVtZW50IHRvIG1vZGVsIHRyZWUsIHNvIGxldCdzIHNraXAgaXQuXG4gICAgICAgIGlmICghc3BsaXRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbnNlcnQgZWxlbWVudCBvbiBhbGxvd2VkIHBvc2l0aW9uLlxuICAgICAgICB0aGlzLmNvbnZlcnNpb25BcGkud3JpdGVyLmluc2VydChtb2RlbE5vZGUsIHNwbGl0UmVzdWx0LnBvc2l0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdENvbnZlcnNpb25BcGkjdXBkYXRlQ29udmVyc2lvblJlc3VsdFxuXHQgKi8gX3VwZGF0ZUNvbnZlcnNpb25SZXN1bHQobW9kZWxFbGVtZW50LCBkYXRhKSB7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gdGhpcy5fZ2V0U3BsaXRQYXJ0cyhtb2RlbEVsZW1lbnQpO1xuICAgICAgICBjb25zdCB3cml0ZXIgPSB0aGlzLmNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICAvLyBTZXQgY29udmVyc2lvbiByZXN1bHQgcmFuZ2UgLSBvbmx5IGlmIG5vdCBzZXQgYWxyZWFkeS5cbiAgICAgICAgaWYgKCFkYXRhLm1vZGVsUmFuZ2UpIHtcbiAgICAgICAgICAgIGRhdGEubW9kZWxSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSh3cml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUobW9kZWxFbGVtZW50KSwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIocGFydHNbcGFydHMubGVuZ3RoIC0gMV0pKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzYXZlZEN1cnNvclBhcmVudCA9IHRoaXMuX2N1cnNvclBhcmVudHMuZ2V0KG1vZGVsRWxlbWVudCk7XG4gICAgICAgIC8vIE5vdyB3ZSBuZWVkIHRvIGNoZWNrIHdoZXJlIHRoZSBgbW9kZWxDdXJzb3JgIHNob3VsZCBiZS5cbiAgICAgICAgaWYgKHNhdmVkQ3Vyc29yUGFyZW50KSB7XG4gICAgICAgICAgICAvLyBJZiB3ZSBzcGxpdCBwYXJlbnQgdG8gaW5zZXJ0IG91ciBlbGVtZW50IHRoZW4gd2Ugd2FudCB0byBjb250aW51ZSBjb252ZXJzaW9uIGluIHRoZSBuZXcgcGFydCBvZiB0aGUgc3BsaXQgcGFyZW50LlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIGJlZm9yZTogPGFsbG93ZWQ+PG5vdEFsbG93ZWQ+Zm9vW108L25vdEFsbG93ZWQ+PC9hbGxvd2VkPlxuICAgICAgICAgICAgLy8gYWZ0ZXI6ICA8YWxsb3dlZD48bm90QWxsb3dlZD5mb288L25vdEFsbG93ZWQ+IDxjb252ZXJ0ZWQ+PC9jb252ZXJ0ZWQ+IDxub3RBbGxvd2VkPltdPC9ub3RBbGxvd2VkPjwvYWxsb3dlZD5cbiAgICAgICAgICAgIGRhdGEubW9kZWxDdXJzb3IgPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChzYXZlZEN1cnNvclBhcmVudCwgMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UganVzdCBjb250aW51ZSBhZnRlciBpbnNlcnRlZCBlbGVtZW50LlxuICAgICAgICAgICAgZGF0YS5tb2RlbEN1cnNvciA9IGRhdGEubW9kZWxSYW5nZS5lbmQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL3VwY2FzdGRpc3BhdGNoZXJ+VXBjYXN0Q29udmVyc2lvbkFwaSNzcGxpdFRvQWxsb3dlZFBhcmVudFxuXHQgKi8gX3NwbGl0VG9BbGxvd2VkUGFyZW50KG5vZGUsIG1vZGVsQ3Vyc29yKSB7XG4gICAgICAgIGNvbnN0IHsgc2NoZW1hLCB3cml0ZXIgfSA9IHRoaXMuY29udmVyc2lvbkFwaTtcbiAgICAgICAgLy8gVHJ5IHRvIGZpbmQgYWxsb3dlZCBwYXJlbnQuXG4gICAgICAgIGxldCBhbGxvd2VkUGFyZW50ID0gc2NoZW1hLmZpbmRBbGxvd2VkUGFyZW50KG1vZGVsQ3Vyc29yLCBub2RlKTtcbiAgICAgICAgaWYgKGFsbG93ZWRQYXJlbnQpIHtcbiAgICAgICAgICAgIC8vIFdoZW4gY3VycmVudCBwb3NpdGlvbiBwYXJlbnQgYWxsb3dzIHRvIGluc2VydCBub2RlIHRoZW4gcmV0dXJuIHRoaXMgcG9zaXRpb24uXG4gICAgICAgICAgICBpZiAoYWxsb3dlZFBhcmVudCA9PT0gbW9kZWxDdXJzb3IucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG1vZGVsQ3Vyc29yXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFdoZW4gYWxsb3dlZCBwYXJlbnQgaXMgaW4gY29udGV4dCB0cmVlIChpdCdzIG91dHNpZGUgdGhlIGNvbnZlcnRlZCB0cmVlKS5cbiAgICAgICAgICAgIGlmICh0aGlzLl9tb2RlbEN1cnNvci5wYXJlbnQuZ2V0QW5jZXN0b3JzKCkuaW5jbHVkZXMoYWxsb3dlZFBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICBhbGxvd2VkUGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWFsbG93ZWRQYXJlbnQpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBub2RlIHdyYXBwZWQgd2l0aCBhIHBhcmFncmFwaCB3b3VsZCBiZSBhY2NlcHRlZCBieSB0aGUgc2NoZW1hLlxuICAgICAgICAgICAgaWYgKCFpc1BhcmFncmFwaGFibGUobW9kZWxDdXJzb3IsIG5vZGUsIHNjaGVtYSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHdyYXBJblBhcmFncmFwaChtb2RlbEN1cnNvciwgd3JpdGVyKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTcGxpdCBlbGVtZW50IHRvIGFsbG93ZWQgcGFyZW50LlxuICAgICAgICBjb25zdCBzcGxpdFJlc3VsdCA9IHRoaXMuY29udmVyc2lvbkFwaS53cml0ZXIuc3BsaXQobW9kZWxDdXJzb3IsIGFsbG93ZWRQYXJlbnQpO1xuICAgICAgICAvLyBVc2luZyB0aGUgcmFuZ2UgcmV0dXJuZWQgYnkgYG1vZGVsLldyaXRlciNzcGxpdGAsIHdlIHdpbGwgcGFpciBvcmlnaW5hbCBlbGVtZW50cyB3aXRoIHRoZWlyIHNwbGl0IHBhcnRzLlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGUgcmFuZ2UgcmV0dXJuZWQgZnJvbSB0aGUgd3JpdGVyIHNwYW5zIFwib3ZlciB0aGUgc3BsaXRcIiBvciwgcHJlY2lzZWx5IHNheWluZywgZnJvbSB0aGUgZW5kIG9mIHRoZSBvcmlnaW5hbCBlbGVtZW50ICh0aGUgb25lXG4gICAgICAgIC8vIHRoYXQgZ290IHNwbGl0KSB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBvdGhlciBwYXJ0IG9mIHRoYXQgZWxlbWVudDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPGxpbWl0PjxhPjxiPjxjPlhbXVk8L2M+PC9iPjxhPjwvbGltaXQ+IC0+XG4gICAgICAgIC8vIDxsaW1pdD48YT48Yj48Yz5YWzwvYz48L2I+PC9hPjxhPjxiPjxjPl1ZPC9jPjwvYj48L2E+XG4gICAgICAgIC8vXG4gICAgICAgIC8vIEFmdGVyIHRoZSBzcGxpdCB0aGVyZSBjYW5ub3QgYmUgYW55IGZ1bGwgbm9kZSBiZXR3ZWVuIHRoZSBwb3NpdGlvbnMgaW4gYHNwbGl0UmFuZ2VgLiBUaGUgcG9zaXRpb25zIGFyZSB0b3VjaGluZy5cbiAgICAgICAgLy8gQWxzbywgYmVjYXVzZSBvZiBob3cgc3BsaXR0aW5nIHdvcmtzLCBpdCBpcyBlYXN5IHRvIG5vdGljZSwgdGhhdCBcImNsb3NpbmcgdGFnc1wiIGFyZSBpbiB0aGUgcmV2ZXJzZSBvcmRlciB0aGFuIFwib3BlbmluZyB0YWdzXCIuXG4gICAgICAgIC8vIEFsc28sIHNpbmNlIHdlIHNwbGl0IGFsbCB0aG9zZSBlbGVtZW50cywgZWFjaCBvZiB0aGVtIGhhcyB0byBoYXZlIHRoZSBvdGhlciBwYXJ0LlxuICAgICAgICAvL1xuICAgICAgICAvLyBXaXRoIHRob3NlIG9ic2VydmF0aW9ucyBpbiBtaW5kLCB3ZSB3aWxsIHBhaXIgdGhlIG9yaWdpbmFsIGVsZW1lbnRzIHdpdGggdGhlaXIgc3BsaXQgcGFydHMgYnkgc2F2aW5nIFwiY2xvc2luZyB0YWdzXCIgYW5kIG1hdGNoaW5nXG4gICAgICAgIC8vIHRoZW0gd2l0aCBcIm9wZW5pbmcgdGFnc1wiIGluIHRoZSByZXZlcnNlIG9yZGVyLiBGb3IgdGhhdCB3ZSBjYW4gdXNlIGEgc3RhY2suXG4gICAgICAgIGNvbnN0IHN0YWNrID0gW107XG4gICAgICAgIGZvciAoY29uc3QgdHJlZVdhbGtlclZhbHVlIG9mIHNwbGl0UmVzdWx0LnJhbmdlLmdldFdhbGtlcigpKXtcbiAgICAgICAgICAgIGlmICh0cmVlV2Fsa2VyVmFsdWUudHlwZSA9PSAnZWxlbWVudEVuZCcpIHtcbiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHRyZWVXYWxrZXJWYWx1ZS5pdGVtKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG5vdCBiZSBhbnkgdGV4dCBub2RlcyBhZnRlciB0aGUgZWxlbWVudCBpcyBzcGxpdCwgc28gdGhlIG9ubHkgb3RoZXIgdmFsdWUgaXMgYGVsZW1lbnRTdGFydGAuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxQYXJ0ID0gc3RhY2sucG9wKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRQYXJ0ID0gdHJlZVdhbGtlclZhbHVlLml0ZW07XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJTcGxpdFBhaXIob3JpZ2luYWxQYXJ0LCBzcGxpdFBhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnNvclBhcmVudCA9IHNwbGl0UmVzdWx0LnJhbmdlLmVuZC5wYXJlbnQ7XG4gICAgICAgIHRoaXMuX2N1cnNvclBhcmVudHMuc2V0KG5vZGUsIGN1cnNvclBhcmVudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwb3NpdGlvbjogc3BsaXRSZXN1bHQucG9zaXRpb24sXG4gICAgICAgICAgICBjdXJzb3JQYXJlbnRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyB0aGF0IGEgYHNwbGl0UGFydGAgZWxlbWVudCBpcyBhIHNwbGl0IHBhcnQgb2YgdGhlIGBvcmlnaW5hbFBhcnRgIGVsZW1lbnQuXG5cdCAqXG5cdCAqIFRoZSBkYXRhIHNldCBieSB0aGlzIG1ldGhvZCBpcyB1c2VkIGJ5IHtAbGluayAjX2dldFNwbGl0UGFydHN9IGFuZCB7QGxpbmsgI19yZW1vdmVFbXB0eUVsZW1lbnRzfS5cblx0ICovIF9yZWdpc3RlclNwbGl0UGFpcihvcmlnaW5hbFBhcnQsIHNwbGl0UGFydCkge1xuICAgICAgICBpZiAoIXRoaXMuX3NwbGl0UGFydHMuaGFzKG9yaWdpbmFsUGFydCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3NwbGl0UGFydHMuc2V0KG9yaWdpbmFsUGFydCwgW1xuICAgICAgICAgICAgICAgIG9yaWdpbmFsUGFydFxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGlzdCA9IHRoaXMuX3NwbGl0UGFydHMuZ2V0KG9yaWdpbmFsUGFydCk7XG4gICAgICAgIHRoaXMuX3NwbGl0UGFydHMuc2V0KHNwbGl0UGFydCwgbGlzdCk7XG4gICAgICAgIGxpc3QucHVzaChzcGxpdFBhcnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3RDb252ZXJzaW9uQXBpI2dldFNwbGl0UGFydHNcblx0ICovIF9nZXRTcGxpdFBhcnRzKGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IHBhcnRzO1xuICAgICAgICBpZiAoIXRoaXMuX3NwbGl0UGFydHMuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICBwYXJ0cyA9IFtcbiAgICAgICAgICAgICAgICBlbGVtZW50XG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFydHMgPSB0aGlzLl9zcGxpdFBhcnRzLmdldChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFydHM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYXJrIGFuIGVsZW1lbnQgdGhhdCB3ZXJlIGNyZWF0ZWQgZHVyaW5nIHRoZSBzcGxpdHRpbmcgdG8gbm90IGdldCByZW1vdmVkIG9uIGNvbnZlcnNpb24gZW5kIGV2ZW4gaWYgaXQgaXMgZW1wdHkuXG5cdCAqLyBfa2VlcEVtcHR5RWxlbWVudChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2VtcHR5RWxlbWVudHNUb0tlZXAuYWRkKGVsZW1lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIHRoZXJlIGFyZSBhbnkgZW1wdHkgZWxlbWVudHMgY3JlYXRlZCB3aGlsZSBzcGxpdHRpbmcgYW5kIHJlbW92ZXMgdGhlbS5cblx0ICpcblx0ICogVGhpcyBtZXRob2Qgd29ya3MgcmVjdXJzaXZlbHkgdG8gcmUtY2hlY2sgZW1wdHkgZWxlbWVudHMgYWdhaW4gYWZ0ZXIgYXQgbGVhc3Qgb25lIGVsZW1lbnQgd2FzIHJlbW92ZWQgaW4gdGhlIGluaXRpYWwgY2FsbCxcblx0ICogYXMgc29tZSBlbGVtZW50cyBtaWdodCBoYXZlIGJlY29tZSBlbXB0eSBhZnRlciBvdGhlciBlbXB0eSBlbGVtZW50cyB3ZXJlIHJlbW92ZWQgZnJvbSB0aGVtLlxuXHQgKi8gX3JlbW92ZUVtcHR5RWxlbWVudHMoKSB7XG4gICAgICAgIC8vIEZvciBldmVyeSBwYXJlbnQsIHByZXBhcmUgYW4gYXJyYXkgb2YgY2hpbGRyZW4gKGVtcHR5IGVsZW1lbnRzKSB0byByZW1vdmUgZnJvbSBpdC5cbiAgICAgICAgLy8gVGhlbiwgaW4gbmV4dCBzdGVwLCB3ZSB3aWxsIHJlbW92ZSBhbGwgY2hpbGRyZW4gdG9nZXRoZXIsIHdoaWNoIGlzIGZhc3RlciB0aGFuIHJlbW92aW5nIHRoZW0gb25lIGJ5IG9uZS5cbiAgICAgICAgY29uc3QgdG9SZW1vdmUgPSBuZXcgTWFwKCk7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLl9zcGxpdFBhcnRzLmtleXMoKSl7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5pc0VtcHR5ICYmICF0aGlzLl9lbXB0eUVsZW1lbnRzVG9LZWVwLmhhcyhlbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdG9SZW1vdmUuZ2V0KGVsZW1lbnQucGFyZW50KSB8fCBbXTtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX3NwbGl0UGFydHMuZGVsZXRlKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRvUmVtb3ZlLnNldChlbGVtZW50LnBhcmVudCwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgW3BhcmVudCwgY2hpbGRyZW5dIG9mIHRvUmVtb3ZlKXtcbiAgICAgICAgICAgIHBhcmVudC5fcmVtb3ZlQ2hpbGRyZW5BcnJheShjaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvUmVtb3ZlLnNpemUpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbW92ZUVtcHR5RWxlbWVudHMoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogVHJhdmVyc2VzIGdpdmVuIG1vZGVsIGl0ZW0gYW5kIHNlYXJjaGVzIGVsZW1lbnRzIHdoaWNoIG1hcmtzIG1hcmtlciByYW5nZS4gRm91bmQgZWxlbWVudCBpcyByZW1vdmVkIGZyb21cbiAqIERvY3VtZW50RnJhZ21lbnQgYnV0IHBhdGggb2YgdGhpcyBlbGVtZW50IGlzIHN0b3JlZCBpbiBhIE1hcCB3aGljaCBpcyB0aGVuIHJldHVybmVkLlxuICpcbiAqIEBwYXJhbSBtb2RlbEl0ZW0gRnJhZ21lbnQgb2YgbW9kZWwuXG4gKiBAcmV0dXJucyBMaXN0IG9mIHN0YXRpYyBtYXJrZXJzLlxuICovIGZ1bmN0aW9uIGV4dHJhY3RNYXJrZXJzRnJvbU1vZGVsRnJhZ21lbnQobW9kZWxJdGVtLCB3cml0ZXIpIHtcbiAgICBjb25zdCBtYXJrZXJFbGVtZW50cyA9IG5ldyBTZXQoKTtcbiAgICBjb25zdCBtYXJrZXJzID0gbmV3IE1hcCgpO1xuICAgIC8vIENyZWF0ZSBNb2RlbFRyZWVXYWxrZXIuXG4gICAgY29uc3QgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlSW4obW9kZWxJdGVtKS5nZXRJdGVtcygpO1xuICAgIC8vIFdhbGsgdGhyb3VnaCBEb2N1bWVudEZyYWdtZW50IGFuZCBjb2xsZWN0IG1hcmtlciBlbGVtZW50cy5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmFuZ2Upe1xuICAgICAgICAvLyBDaGVjayBpZiBjdXJyZW50IGVsZW1lbnQgaXMgYSBtYXJrZXIuXG4gICAgICAgIGlmIChpdGVtLmlzKCdlbGVtZW50JywgJyRtYXJrZXInKSkge1xuICAgICAgICAgICAgbWFya2VyRWxlbWVudHMuYWRkKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFdhbGsgdGhyb3VnaCBjb2xsZWN0ZWQgbWFya2VyIGVsZW1lbnRzIHN0b3JlIGl0cyBwYXRoIGFuZCByZW1vdmUgaXRzIGZyb20gdGhlIERvY3VtZW50RnJhZ21lbnQuXG4gICAgZm9yIChjb25zdCBtYXJrZXJFbGVtZW50IG9mIG1hcmtlckVsZW1lbnRzKXtcbiAgICAgICAgY29uc3QgbWFya2VyTmFtZSA9IG1hcmtlckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnKTtcbiAgICAgICAgY29uc3QgY3VycmVudFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKG1hcmtlckVsZW1lbnQpO1xuICAgICAgICAvLyBXaGVuIG1hcmtlciBvZiBnaXZlbiBuYW1lIGlzIG5vdCBzdG9yZWQgaXQgbWVhbnMgdGhhdCB3ZSBoYXZlIGZvdW5kIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJhbmdlLlxuICAgICAgICBpZiAoIW1hcmtlcnMuaGFzKG1hcmtlck5hbWUpKSB7XG4gICAgICAgICAgICBtYXJrZXJzLnNldChtYXJrZXJOYW1lLCBuZXcgUmFuZ2UoY3VycmVudFBvc2l0aW9uLmNsb25lKCkpKTtcbiAgICAgICAgLy8gT3RoZXJ3aXNlIGlzIG1lYW5zIHRoYXQgd2UgaGF2ZSBmb3VuZCBlbmQgb2YgdGhlIG1hcmtlciByYW5nZS5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1hcmtlcnMuZ2V0KG1hcmtlck5hbWUpLmVuZCA9IGN1cnJlbnRQb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBtYXJrZXIgZWxlbWVudCBmcm9tIERvY3VtZW50RnJhZ21lbnQuXG4gICAgICAgIHdyaXRlci5yZW1vdmUobWFya2VyRWxlbWVudCk7XG4gICAgfVxuICAgIHJldHVybiBtYXJrZXJzO1xufVxuLyoqXG4gKiBDcmVhdGVzIG1vZGVsIGZyYWdtZW50IGFjY29yZGluZyB0byBnaXZlbiBjb250ZXh0IGFuZCByZXR1cm5zIHBvc2l0aW9uIGluIHRoZSBib3R0b20gKHRoZSBkZWVwZXN0KSBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGNyZWF0ZUNvbnRleHRUcmVlKGNvbnRleHREZWZpbml0aW9uLCB3cml0ZXIpIHtcbiAgICBsZXQgcG9zaXRpb247XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIG5ldyBTY2hlbWFDb250ZXh0KGNvbnRleHREZWZpbml0aW9uKSl7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgaXRlbS5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICAgICAgYXR0cmlidXRlc1trZXldID0gaXRlbS5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoaXRlbS5uYW1lLCBhdHRyaWJ1dGVzKTtcbiAgICAgICAgaWYgKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICB3cml0ZXIuaW5zZXJ0KGN1cnJlbnQsIHBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChjdXJyZW50LCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG4vKipcbiAqIEJhc2ljIEhUTUwgd3JpdGVyLiBJdCB1c2VzIHRoZSBuYXRpdmUgYGlubmVySFRNTGAgcHJvcGVydHkgZm9yIGJhc2ljIGNvbnZlcnNpb25cbiAqIGZyb20gYSBkb2N1bWVudCBmcmFnbWVudCB0byBhbiBIVE1MIHN0cmluZy5cbiAqLyBjbGFzcyBCYXNpY0h0bWxXcml0ZXIge1xuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFuIEhUTUwgc3RyaW5nIGNyZWF0ZWQgZnJvbSB0aGUgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqLyBnZXRIdG1sKGZyYWdtZW50KSB7XG4gICAgICAgIGNvbnN0IGRvYyA9IGdsb2JhbC5kb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoJycpO1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgICAgIHJldHVybiBjb250YWluZXIuaW5uZXJIVE1MO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgSFRNTCBkYXRhIHByb2Nlc3NvciBjbGFzcy5cbiAqIFRoaXMgZGF0YSBwcm9jZXNzb3IgaW1wbGVtZW50YXRpb24gdXNlcyBIVE1MIGFzIGlucHV0IGFuZCBvdXRwdXQgZGF0YS5cbiAqLyBjbGFzcyBIdG1sRGF0YVByb2Nlc3NvciB7XG4gICAgLyoqXG5cdCAqIEEgRE9NIHBhcnNlciBpbnN0YW5jZSB1c2VkIHRvIHBhcnNlIGFuIEhUTUwgc3RyaW5nIHRvIGFuIEhUTUwgZG9jdW1lbnQuXG5cdCAqLyBkb21QYXJzZXI7XG4gICAgLyoqXG5cdCAqIEEgRE9NIGNvbnZlcnRlciB1c2VkIHRvIGNvbnZlcnQgRE9NIGVsZW1lbnRzIHRvIHZpZXcgZWxlbWVudHMuXG5cdCAqLyBkb21Db252ZXJ0ZXI7XG4gICAgLyoqXG5cdCAqIEEgYmFzaWMgSFRNTCB3cml0ZXIgaW5zdGFuY2UgdXNlZCB0byBjb252ZXJ0IERPTSBlbGVtZW50cyB0byBhbiBIVE1MIHN0cmluZy5cblx0ICovIGh0bWxXcml0ZXI7XG4gICAgc2tpcENvbW1lbnRzID0gdHJ1ZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgSFRNTCBkYXRhIHByb2Nlc3NvciBjbGFzcy5cblx0ICpcblx0ICogQHBhcmFtIGRvY3VtZW50IFRoZSB2aWV3IGRvY3VtZW50IGluc3RhbmNlLlxuXHQgKi8gY29uc3RydWN0b3IoZG9jdW1lbnQpe1xuICAgICAgICB0aGlzLmRvbVBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIgPSBuZXcgRG9tQ29udmVydGVyKGRvY3VtZW50LCB7XG4gICAgICAgICAgICByZW5kZXJpbmdNb2RlOiAnZGF0YSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaHRtbFdyaXRlciA9IG5ldyBCYXNpY0h0bWxXcml0ZXIoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIGEgcHJvdmlkZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgZG9jdW1lbnQgZnJhZ21lbnR9XG5cdCAqIHRvIGRhdGEgZm9ybWF0ICZuZGFzaDsgaW4gdGhpcyBjYXNlIHRvIGFuIEhUTUwgc3RyaW5nLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBIVE1MIHN0cmluZy5cblx0ICovIHRvRGF0YSh2aWV3RnJhZ21lbnQpIHtcbiAgICAgICAgLy8gQ29udmVydCB2aWV3IERvY3VtZW50RnJhZ21lbnQgdG8gRE9NIERvY3VtZW50RnJhZ21lbnQuXG4gICAgICAgIGNvbnN0IGRvbUZyYWdtZW50ID0gdGhpcy5kb21Db252ZXJ0ZXIudmlld1RvRG9tKHZpZXdGcmFnbWVudCk7XG4gICAgICAgIC8vIENvbnZlcnQgRE9NIERvY3VtZW50RnJhZ21lbnQgdG8gSFRNTCBvdXRwdXQuXG4gICAgICAgIHJldHVybiB0aGlzLmh0bWxXcml0ZXIuZ2V0SHRtbChkb21GcmFnbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyB0aGUgcHJvdmlkZWQgSFRNTCBzdHJpbmcgdG8gYSB2aWV3IHRyZWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRhIEFuIEhUTUwgc3RyaW5nLlxuXHQgKiBAcmV0dXJucyBBIGNvbnZlcnRlZCB2aWV3IGVsZW1lbnQuXG5cdCAqLyB0b1ZpZXcoZGF0YSkge1xuICAgICAgICAvLyBDb252ZXJ0IGlucHV0IEhUTUwgZGF0YSB0byBET00gRG9jdW1lbnRGcmFnbWVudC5cbiAgICAgICAgY29uc3QgZG9tRnJhZ21lbnQgPSB0aGlzLl90b0RvbShkYXRhKTtcbiAgICAgICAgLy8gQ29udmVydCBET00gRG9jdW1lbnRGcmFnbWVudCB0byB2aWV3IERvY3VtZW50RnJhZ21lbnQuXG4gICAgICAgIHJldHVybiB0aGlzLmRvbUNvbnZlcnRlci5kb21Ub1ZpZXcoZG9tRnJhZ21lbnQsIHtcbiAgICAgICAgICAgIHNraXBDb21tZW50czogdGhpcy5za2lwQ29tbWVudHNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlclBhdHRlcm59IGZvciB2aWV3IGVsZW1lbnRzIHdob3NlIGNvbnRlbnQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgcmF3IGRhdGFcblx0ICogYW5kIG5vdCBwcm9jZXNzZWQgZHVyaW5nIHRoZSBjb252ZXJzaW9uIGZyb20gdGhlIERPTSB0byB0aGUgdmlldyBlbGVtZW50cy5cblx0ICpcblx0ICogVGhlIHJhdyBkYXRhIGNhbiBiZSBsYXRlciBhY2Nlc3NlZCBieSBhXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I2dldEN1c3RvbVByb3BlcnR5IGN1c3RvbSBwcm9wZXJ0eSBvZiBhIHZpZXcgZWxlbWVudH0gY2FsbGVkIGBcIiRyYXdDb250ZW50XCJgLlxuXHQgKlxuXHQgKiBAcGFyYW0gcGF0dGVybiBQYXR0ZXJuIG1hdGNoaW5nIGFsbCB2aWV3IGVsZW1lbnRzIHdob3NlIGNvbnRlbnQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgcmF3IGRhdGEuXG5cdCAqLyByZWdpc3RlclJhd0NvbnRlbnRNYXRjaGVyKHBhdHRlcm4pIHtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIucmVnaXN0ZXJSYXdDb250ZW50TWF0Y2hlcihwYXR0ZXJuKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIElmIHRoZSBwcm9jZXNzb3IgaXMgc2V0IHRvIHVzZSBtYXJrZWQgZmlsbGVycywgaXQgd2lsbCBpbnNlcnQgYCZuYnNwO2AgZmlsbGVycyB3cmFwcGVkIGluIGA8c3Bhbj5gIGVsZW1lbnRzXG5cdCAqIChgPHNwYW4gZGF0YS1ja2UtZmlsbGVyPVwidHJ1ZVwiPiZuYnNwOzwvc3Bhbj5gKSBpbnN0ZWFkIG9mIHJlZ3VsYXIgYCZuYnNwO2AgY2hhcmFjdGVycy5cblx0ICpcblx0ICogVGhpcyBtb2RlIGFsbG93cyBmb3IgYSBtb3JlIHByZWNpc2UgaGFuZGxpbmcgb2YgdGhlIGJsb2NrIGZpbGxlcnMgKHNvIHRoZXkgZG8gbm90IGxlYWsgaW50byB0aGUgZWRpdG9yIGNvbnRlbnQpIGJ1dFxuXHQgKiBibG9hdHMgdGhlIGVkaXRvciBkYXRhIHdpdGggYWRkaXRpb25hbCBtYXJrdXAuXG5cdCAqXG5cdCAqIFRoaXMgbW9kZSBtYXkgYmUgcmVxdWlyZWQgYnkgc29tZSBmZWF0dXJlcyBhbmQgd2lsbCBiZSB0dXJuZWQgb24gYnkgdGhlbSBhdXRvbWF0aWNhbGx5LlxuXHQgKlxuXHQgKiBAcGFyYW0gdHlwZSBXaGV0aGVyIHRvIHVzZSB0aGUgZGVmYXVsdCBvciB0aGUgbWFya2VkIGAmbmJzcDtgIGJsb2NrIGZpbGxlcnMuXG5cdCAqLyB1c2VGaWxsZXJUeXBlKHR5cGUpIHtcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIuYmxvY2tGaWxsZXJNb2RlID0gdHlwZSA9PSAnbWFya2VkJyA/ICdtYXJrZWROYnNwJyA6ICduYnNwJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIGFuIEhUTUwgc3RyaW5nIHRvIGl0cyBET00gcmVwcmVzZW50YXRpb24uIFJldHVybnMgYSBkb2N1bWVudCBmcmFnbWVudCBjb250YWluaW5nIG5vZGVzIHBhcnNlZCBmcm9tXG5cdCAqIHRoZSBwcm92aWRlZCBkYXRhLlxuXHQgKi8gX3RvRG9tKGRhdGEpIHtcbiAgICAgICAgLy8gV3JhcCBkYXRhIHdpdGggYSA8Ym9keT4gdGFnIHNvIGxlYWRpbmcgbm9uLWxheW91dCBub2RlcyAobGlrZSA8c2NyaXB0PiwgPHN0eWxlPiwgSFRNTCBjb21tZW50KVxuICAgICAgICAvLyB3aWxsIGJlIHByZXNlcnZlZCBpbiB0aGUgYm9keSBjb2xsZWN0aW9uLlxuICAgICAgICAvLyBEbyBpdCBvbmx5IGZvciBkYXRhIHRoYXQgaXMgbm90IGEgZnVsbCBIVE1MIGRvY3VtZW50LlxuICAgICAgICBpZiAoIS88KD86aHRtbHxib2R5fGhlYWR8bWV0YSkoPzpcXHNbXj5dKik/Pi9pLnRlc3QoZGF0YS50cmltKCkuc2xpY2UoMCwgMTBfMDAwKSkpIHtcbiAgICAgICAgICAgIGRhdGEgPSBgPGJvZHk+JHtkYXRhfTwvYm9keT5gO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gdGhpcy5kb21QYXJzZXIucGFyc2VGcm9tU3RyaW5nKGRhdGEsICd0ZXh0L2h0bWwnKTtcbiAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIGNvbnN0IGJvZHlDaGlsZE5vZGVzID0gZG9jdW1lbnQuYm9keS5jaGlsZE5vZGVzO1xuICAgICAgICB3aGlsZShib2R5Q2hpbGROb2Rlcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGJvZHlDaGlsZE5vZGVzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbnRyb2xsZXIgZm9yIHRoZSBkYXRhIHBpcGVsaW5lLiBUaGUgZGF0YSBwaXBlbGluZSBjb250cm9scyBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbSB0aGUgZG9jdW1lbnRcbiAqIGFuZCBzZXQgaW5zaWRlIGl0LiBIZW5jZSwgdGhlIGNvbnRyb2xsZXIgZmVhdHVyZXMgdHdvIG1ldGhvZHMgd2hpY2ggYWxsb3cgdG8ge0BsaW5rIH5EYXRhQ29udHJvbGxlciNnZXQgZ2V0fVxuICogYW5kIHtAbGluayB+RGF0YUNvbnRyb2xsZXIjc2V0IHNldH0gZGF0YSBvZiB0aGUge0BsaW5rIH5EYXRhQ29udHJvbGxlciNtb2RlbCBtb2RlbH1cbiAqIHVzaW5nIHRoZSBnaXZlbjpcbiAqXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2RhdGFwcm9jZXNzb3IvZGF0YXByb2Nlc3Nvcn5EYXRhUHJvY2Vzc29yIGRhdGEgcHJvY2Vzc29yfSxcbiAqICogZG93bmNhc3QgY29udmVydGVycyxcbiAqICogdXBjYXN0IGNvbnZlcnRlcnMuXG4gKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIGRhdGEgY29udHJvbGxlciBpcyBhbHdheXMgYXZhaWxhYmxlIGluIHRoZSB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3IjZGF0YSBgZWRpdG9yLmRhdGFgfVxuICogcHJvcGVydHk6XG4gKlxuICogYGBgdHNcbiAqIGVkaXRvci5kYXRhLmdldCggeyByb290TmFtZTogJ2N1c3RvbVJvb3QnIH0gKTsgLy8gLT4gJzxwPkhlbGxvITwvcD4nXG4gKiBgYGBcbiAqLyBjbGFzcyBEYXRhQ29udHJvbGxlciBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSB7XG4gICAgLyoqXG5cdCAqIERhdGEgbW9kZWwuXG5cdCAqLyBtb2RlbDtcbiAgICAvKipcblx0ICogTWFwcGVyIHVzZWQgZm9yIHRoZSBjb252ZXJzaW9uLiBJdCBoYXMgbm8gcGVybWFuZW50IGJpbmRpbmdzLCBiZWNhdXNlIHRoZXNlIGFyZSBjcmVhdGVkIHdoaWxlIGdldHRpbmcgZGF0YSBhbmRcblx0ICogYXJlIGNsZWFyZWQgZGlyZWN0bHkgYWZ0ZXIgdGhlIGRhdGEgYXJlIGNvbnZlcnRlZC4gSG93ZXZlciwgdGhlIG1hcHBlciBpcyBkZWZpbmVkIGFzIGEgY2xhc3MgcHJvcGVydHksIGJlY2F1c2Vcblx0ICogaXQgbmVlZHMgdG8gYmUgcGFzc2VkIHRvIHRoZSBgRG93bmNhc3REaXNwYXRjaGVyYCBhcyBhIGNvbnZlcnNpb24gQVBJLlxuXHQgKi8gbWFwcGVyO1xuICAgIC8qKlxuXHQgKiBEb3duY2FzdCBkaXNwYXRjaGVyIHVzZWQgYnkgdGhlIHtAbGluayAjZ2V0IGdldCBtZXRob2R9LiBEb3duY2FzdCBjb252ZXJ0ZXJzIHNob3VsZCBiZSBhdHRhY2hlZCB0byBpdC5cblx0ICovIGRvd25jYXN0RGlzcGF0Y2hlcjtcbiAgICAvKipcblx0ICogVXBjYXN0IGRpc3BhdGNoZXIgdXNlZCBieSB0aGUge0BsaW5rICNzZXQgc2V0IG1ldGhvZH0uIFVwY2FzdCBjb252ZXJ0ZXJzIHNob3VsZCBiZSBhdHRhY2hlZCB0byBpdC5cblx0ICovIHVwY2FzdERpc3BhdGNoZXI7XG4gICAgLyoqXG5cdCAqIFRoZSB2aWV3IGRvY3VtZW50IHVzZWQgYnkgdGhlIGRhdGEgY29udHJvbGxlci5cblx0ICovIHZpZXdEb2N1bWVudDtcbiAgICAvKipcblx0ICogU3R5bGVzIHByb2Nlc3NvciB1c2VkIGR1cmluZyB0aGUgY29udmVyc2lvbi5cblx0ICovIHN0eWxlc1Byb2Nlc3NvcjtcbiAgICAvKipcblx0ICogRGF0YSBwcm9jZXNzb3IgdXNlZCBzcGVjaWZpY2FsbHkgZm9yIEhUTUwgY29udmVyc2lvbi5cblx0ICovIGh0bWxQcm9jZXNzb3I7XG4gICAgLyoqXG5cdCAqIERhdGEgcHJvY2Vzc29yIHVzZWQgZHVyaW5nIHRoZSBjb252ZXJzaW9uLlxuXHQgKiBTYW1lIGluc3RhbmNlIGFzIHtAbGluayAjaHRtbFByb2Nlc3Nvcn0gYnkgZGVmYXVsdC4gQ2FuIGJlIHJlcGxhY2VkIGF0IHJ1biB0aW1lIHRvIGhhbmRsZSBkaWZmZXJlbnQgZm9ybWF0LCBlLmcuIFhNTCBvciBNYXJrZG93bi5cblx0ICovIHByb2Nlc3NvcjtcbiAgICAvKipcblx0ICogVGhlIHZpZXcgZG93bmNhc3Qgd3JpdGVyIGp1c3QgZm9yIGRhdGEgY29udmVyc2lvbiBwdXJwb3NlcywgaS5lLiB0byBtb2RpZnlcblx0ICogdGhlIHtAbGluayAjdmlld0RvY3VtZW50fS5cblx0ICovIF92aWV3V3JpdGVyO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgZGF0YSBjb250cm9sbGVyIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gbW9kZWwgRGF0YSBtb2RlbC5cblx0ICogQHBhcmFtIHN0eWxlc1Byb2Nlc3NvciBUaGUgc3R5bGVzIHByb2Nlc3NvciBpbnN0YW5jZS5cblx0ICovIGNvbnN0cnVjdG9yKG1vZGVsLCBzdHlsZXNQcm9jZXNzb3Ipe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLm1vZGVsID0gbW9kZWw7XG4gICAgICAgIHRoaXMubWFwcGVyID0gbmV3IE1hcHBlcigpO1xuICAgICAgICB0aGlzLmRvd25jYXN0RGlzcGF0Y2hlciA9IG5ldyBEb3duY2FzdERpc3BhdGNoZXIoe1xuICAgICAgICAgICAgbWFwcGVyOiB0aGlzLm1hcHBlcixcbiAgICAgICAgICAgIHNjaGVtYTogbW9kZWwuc2NoZW1hXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRvd25jYXN0RGlzcGF0Y2hlci5vbignaW5zZXJ0OiR0ZXh0JywgaW5zZXJ0VGV4dCgpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvd2VzdCdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZG93bmNhc3REaXNwYXRjaGVyLm9uKCdpbnNlcnQnLCBpbnNlcnRBdHRyaWJ1dGVzQW5kQ2hpbGRyZW4oKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3dlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnVwY2FzdERpc3BhdGNoZXIgPSBuZXcgVXBjYXN0RGlzcGF0Y2hlcih7XG4gICAgICAgICAgICBzY2hlbWE6IG1vZGVsLnNjaGVtYVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52aWV3RG9jdW1lbnQgPSBuZXcgRG9jdW1lbnQkMShzdHlsZXNQcm9jZXNzb3IpO1xuICAgICAgICB0aGlzLnN0eWxlc1Byb2Nlc3NvciA9IHN0eWxlc1Byb2Nlc3NvcjtcbiAgICAgICAgdGhpcy5odG1sUHJvY2Vzc29yID0gbmV3IEh0bWxEYXRhUHJvY2Vzc29yKHRoaXMudmlld0RvY3VtZW50KTtcbiAgICAgICAgdGhpcy5wcm9jZXNzb3IgPSB0aGlzLmh0bWxQcm9jZXNzb3I7XG4gICAgICAgIHRoaXMuX3ZpZXdXcml0ZXIgPSBuZXcgRG93bmNhc3RXcml0ZXIodGhpcy52aWV3RG9jdW1lbnQpO1xuICAgICAgICAvLyBEZWZpbmUgZGVmYXVsdCBjb252ZXJ0ZXJzIGZvciB0ZXh0IGFuZCBlbGVtZW50cy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTm90ZSB0aGF0IGlmIHRoZXJlIGlzIG5vIGRlZmF1bHQgY29udmVydGVyIGZvciB0aGUgZWxlbWVudCBpdCB3aWxsIGJlIHNraXBwZWQsIGZvciBpbnN0YW5jZSBgPGI+Zm9vPC9iPmAgd2lsbCBiZVxuICAgICAgICAvLyBjb252ZXJ0ZWQgdG8gbm90aGluZy4gV2UgdGhlcmVmb3JlIGFkZCBgY29udmVydFRvTW9kZWxGcmFnbWVudGAgYXMgYSBsYXN0IGNvbnZlcnRlciBzbyBpdCBjb252ZXJ0cyBjaGlsZHJlbiBvZiB0aGF0XG4gICAgICAgIC8vIGVsZW1lbnQgdG8gdGhlIGRvY3VtZW50IGZyYWdtZW50IHNvIGA8Yj5mb288L2I+YCB3aWxsIHN0aWxsIGJlIGNvbnZlcnRlZCB0byBgZm9vYCBldmVuIGlmIHRoZXJlIGlzIG5vIGNvbnZlcnRlciBmb3IgYDxiPmAuXG4gICAgICAgIHRoaXMudXBjYXN0RGlzcGF0Y2hlci5vbigndGV4dCcsIGNvbnZlcnRUZXh0KCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGNhc3REaXNwYXRjaGVyLm9uKCdlbGVtZW50JywgY29udmVydFRvTW9kZWxGcmFnbWVudCQxKCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGNhc3REaXNwYXRjaGVyLm9uKCdkb2N1bWVudEZyYWdtZW50JywgY29udmVydFRvTW9kZWxGcmFnbWVudCQxKCksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgT2JzZXJ2YWJsZU1peGluKCkucHJvdG90eXBlLmRlY29yYXRlLmNhbGwodGhpcywgJ2luaXQnKTtcbiAgICAgICAgT2JzZXJ2YWJsZU1peGluKCkucHJvdG90eXBlLmRlY29yYXRlLmNhbGwodGhpcywgJ3NldCcpO1xuICAgICAgICBPYnNlcnZhYmxlTWl4aW4oKS5wcm90b3R5cGUuZGVjb3JhdGUuY2FsbCh0aGlzLCAnZ2V0Jyk7XG4gICAgICAgIE9ic2VydmFibGVNaXhpbigpLnByb3RvdHlwZS5kZWNvcmF0ZS5jYWxsKHRoaXMsICd0b1ZpZXcnKTtcbiAgICAgICAgT2JzZXJ2YWJsZU1peGluKCkucHJvdG90eXBlLmRlY29yYXRlLmNhbGwodGhpcywgJ3RvTW9kZWwnKTtcbiAgICAgICAgLy8gRmlyZSB0aGUgYHJlYWR5YCBldmVudCB3aGVuIHRoZSBpbml0aWFsaXphdGlvbiBoYXMgY29tcGxldGVkLiBTdWNoIGxvdy1sZXZlbCBsaXN0ZW5lciBvZmZlcnMgdGhlIHBvc3NpYmlsaXR5XG4gICAgICAgIC8vIHRvIHBsdWcgaW50byB0aGUgaW5pdGlhbGl6YXRpb24gcGlwZWxpbmUgd2l0aG91dCBpbnRlcnJ1cHRpbmcgdGhlIGluaXRpYWxpemF0aW9uIGZsb3cuXG4gICAgICAgIHRoaXMub24oJ2luaXQnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5maXJlKCdyZWFkeScpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvd2VzdCdcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEZpeCBlbXB0eSByb290cyBhZnRlciBEYXRhQ29udHJvbGxlciBpcyAncmVhZHknIChub3RlIHRoYXQgdGhlIGluaXQgbWV0aG9kIGNvdWxkIGJlIGRlY29yYXRlZCBhbmQgc3RvcHBlZCkuXG4gICAgICAgIC8vIFdlIG5lZWQgdG8gaGFuZGxlIHRoaXMgZXZlbnQgYmVjYXVzZSBpbml0aWFsIGRhdGEgY291bGQgYmUgZW1wdHkgYW5kIHRoZSBwb3N0LWZpeGVyIHdvdWxkIG5vdCBnZXQgdHJpZ2dlcmVkLlxuICAgICAgICB0aGlzLm9uKCdyZWFkeScsICgpPT57XG4gICAgICAgICAgICB0aGlzLm1vZGVsLmVucXVldWVDaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIGlzVW5kb2FibGU6IGZhbHNlXG4gICAgICAgICAgICB9LCBhdXRvUGFyYWdyYXBoRW1wdHlSb290cyk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIG1vZGVsJ3MgZGF0YSBjb252ZXJ0ZWQgYnkgZG93bmNhc3QgZGlzcGF0Y2hlcnMgYXR0YWNoZWQgdG8ge0BsaW5rICNkb3duY2FzdERpc3BhdGNoZXJ9IGFuZFxuXHQgKiBmb3JtYXR0ZWQgYnkgdGhlIHtAbGluayAjcHJvY2Vzc29yIGRhdGEgcHJvY2Vzc29yfS5cblx0ICpcblx0ICogQSB3YXJuaW5nIGlzIGxvZ2dlZCB3aGVuIHlvdSB0cnkgdG8gcmV0cmlldmUgZGF0YSBmb3IgYSBkZXRhY2hlZCByb290LCBhcyBtb3N0IHByb2JhYmx5IHRoaXMgaXMgYSBtaXN0YWtlLiBBIGRldGFjaGVkIHJvb3Qgc2hvdWxkXG5cdCAqIGJlIHRyZWF0ZWQgbGlrZSBpdCBpcyByZW1vdmVkLCBhbmQgeW91IHNob3VsZCBub3Qgc2F2ZSBpdHMgZGF0YS4gTm90ZSwgdGhhdCB0aGUgZGV0YWNoZWQgcm9vdCBkYXRhIGlzIGFsd2F5cyBhbiBlbXB0eSBzdHJpbmcuXG5cdCAqXG5cdCAqIEBmaXJlcyBnZXRcblx0ICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBjb25maWd1cmF0aW9uIGZvciB0aGUgcmV0cmlldmVkIGRhdGEuIGBEYXRhQ29udHJvbGxlcmAgcHJvdmlkZXMgdHdvIG9wdGlvbmFsXG5cdCAqIHByb3BlcnRpZXM6IGByb290TmFtZWAgYW5kIGB0cmltYC4gT3RoZXIgcHJvcGVydGllcyBvZiB0aGlzIG9iamVjdCBhcmUgc3BlY2lmaWVkIGJ5IHZhcmlvdXMgZWRpdG9yIGZlYXR1cmVzLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5yb290TmFtZSBSb290IG5hbWUuIERlZmF1bHQgJ21haW4nLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy50cmltIFdoZXRoZXIgcmV0dXJuZWQgZGF0YSBzaG91bGQgYmUgdHJpbW1lZC4gVGhpcyBvcHRpb24gaXMgc2V0IHRvIGBlbXB0eWAgYnkgZGVmYXVsdCxcblx0ICogd2hpY2ggbWVhbnMgd2hlbmV2ZXIgZWRpdG9yIGNvbnRlbnQgaXMgY29uc2lkZXJlZCBlbXB0eSwgYW4gZW1wdHkgc3RyaW5nIHdpbGwgYmUgcmV0dXJuZWQuIFRvIHR1cm4gb2ZmIHRyaW1taW5nIGNvbXBsZXRlbHlcblx0ICogdXNlIGAnbm9uZSdgLiBJbiBzdWNoIGNhc2VzIHRoZSBleGFjdCBjb250ZW50IHdpbGwgYmUgcmV0dXJuZWQgKGZvciBleGFtcGxlIGEgYDxwPiZuYnNwOzwvcD5gIGZvciBhbiBlbXB0eSBlZGl0b3IpLlxuXHQgKiBAcmV0dXJucyBPdXRwdXQgZGF0YS5cblx0ICovIGdldChvcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgeyByb290TmFtZSA9ICdtYWluJywgdHJpbSA9ICdlbXB0eScgfSA9IG9wdGlvbnM7XG4gICAgICAgIGlmICghdGhpcy5fY2hlY2tJZlJvb3RzRXhpc3RzKFtcbiAgICAgICAgICAgIHJvb3ROYW1lXG4gICAgICAgIF0pKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBnZXQgZGF0YSBmcm9tIGEgbm9uLWV4aXN0aW5nIHJvb3QuIFRoaXMgZXJyb3IgaXMgdGhyb3duIHdoZW5cblx0XHRcdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjZ2V0IGBEYXRhQ29udHJvbGxlciNnZXQoKWAgbWV0aG9kfVxuXHRcdFx0ICogaXMgY2FsbGVkIHdpdGggYSBub24tZXhpc3RlbnQgcm9vdCBuYW1lLiBGb3IgZXhhbXBsZSwgaWYgdGhlcmUgaXMgYW4gZWRpdG9yIGluc3RhbmNlIHdpdGggb25seSBgbWFpbmAgcm9vdCxcblx0XHRcdCAqIGNhbGxpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNnZXR9IGxpa2U6XG5cdFx0XHQgKlxuXHRcdFx0ICogYGBgdHNcblx0XHRcdCAqIGRhdGEuZ2V0KCB7IHJvb3ROYW1lOiAncm9vdDInIH0gKTtcblx0XHRcdCAqIGBgYFxuXHRcdFx0ICpcblx0XHRcdCAqIHdpbGwgdGhyb3cgdGhpcyBlcnJvci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgZGF0YWNvbnRyb2xsZXItZ2V0LW5vbi1leGlzdGVudC1yb290XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2RhdGFjb250cm9sbGVyLWdldC1ub24tZXhpc3RlbnQtcm9vdCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLm1vZGVsLmRvY3VtZW50LmdldFJvb3Qocm9vdE5hbWUpO1xuICAgICAgICBpZiAoIXJvb3QuaXNBdHRhY2hlZCgpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFJldHJpZXZpbmcgZG9jdW1lbnQgZGF0YSBmb3IgYSBkZXRhY2hlZCByb290LlxuXHRcdFx0ICpcblx0XHRcdCAqIFRoaXMgdXN1YWxseSBpbmRpY2F0ZXMgYW4gZXJyb3IgYXMgYSBkZXRhY2hlZCByb290IHNob3VsZCBiZSBjb25zaWRlcmVkIFwicmVtb3ZlZFwiIGFuZCBzaG91bGQgbm90IGJlIGluY2x1ZGVkIGluIHRoZVxuXHRcdFx0ICogZG9jdW1lbnQgZGF0YS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgZGF0YWNvbnRyb2xsZXItZ2V0LWRldGFjaGVkLXJvb3Rcblx0XHRcdCAqLyBsb2dXYXJuaW5nKCdkYXRhY29udHJvbGxlci1nZXQtZGV0YWNoZWQtcm9vdCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0cmltID09PSAnZW1wdHknICYmICF0aGlzLm1vZGVsLmhhc0NvbnRlbnQocm9vdCwge1xuICAgICAgICAgICAgaWdub3JlV2hpdGVzcGFjZXM6IHRydWVcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdpZnkocm9vdCwgb3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBjb250ZW50IG9mIHRoZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgbW9kZWwncyBlbGVtZW50fSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgbW9kZWwgZG9jdW1lbnQgZnJhZ21lbnR9IGNvbnZlcnRlZCBieSB0aGUgZG93bmNhc3QgY29udmVydGVyc1xuXHQgKiBhdHRhY2hlZCB0byB0aGUge0BsaW5rICNkb3duY2FzdERpc3BhdGNoZXJ9IGFuZCBmb3JtYXR0ZWQgYnkgdGhlIHtAbGluayAjcHJvY2Vzc29yIGRhdGEgcHJvY2Vzc29yfS5cblx0ICpcblx0ICogQHBhcmFtIG1vZGVsRWxlbWVudE9yRnJhZ21lbnQgVGhlIGVsZW1lbnQgd2hvc2UgY29udGVudCB3aWxsIGJlIHN0cmluZ2lmaWVkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24gcGFzc2VkIHRvIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqIEByZXR1cm5zIE91dHB1dCBkYXRhLlxuXHQgKi8gc3RyaW5naWZ5KG1vZGVsRWxlbWVudE9yRnJhZ21lbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICAvLyBNb2RlbCAtPiB2aWV3LlxuICAgICAgICBjb25zdCB2aWV3RG9jdW1lbnRGcmFnbWVudCA9IHRoaXMudG9WaWV3KG1vZGVsRWxlbWVudE9yRnJhZ21lbnQsIG9wdGlvbnMpO1xuICAgICAgICAvLyBWaWV3IC0+IGRhdGEuXG4gICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3Nvci50b0RhdGEodmlld0RvY3VtZW50RnJhZ21lbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgY29udGVudCBvZiB0aGUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IG1vZGVsIGVsZW1lbnR9IG9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBtb2RlbCBkb2N1bWVudCBmcmFnbWVudH0gY29udmVydGVkIGJ5IHRoZSBkb3duY2FzdFxuXHQgKiBjb252ZXJ0ZXJzIGF0dGFjaGVkIHRvIHtAbGluayAjZG93bmNhc3REaXNwYXRjaGVyfSBpbnRvIGFcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgdmlldyBkb2N1bWVudCBmcmFnbWVudH0uXG5cdCAqXG5cdCAqIEBmaXJlcyB0b1ZpZXdcblx0ICogQHBhcmFtIG1vZGVsRWxlbWVudE9yRnJhZ21lbnQgRWxlbWVudCBvciBkb2N1bWVudCBmcmFnbWVudCB3aG9zZSBjb250ZW50IHdpbGwgYmUgY29udmVydGVkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24gdGhhdCB3aWxsIGJlIGF2YWlsYWJsZSB0aHJvdWdoIHRoZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdENvbnZlcnNpb25BcGkjb3B0aW9uc30gZHVyaW5nIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MuXG5cdCAqIEByZXR1cm5zIE91dHB1dCB2aWV3IERvY3VtZW50RnJhZ21lbnQuXG5cdCAqLyB0b1ZpZXcobW9kZWxFbGVtZW50T3JGcmFnbWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHZpZXdEb2N1bWVudCA9IHRoaXMudmlld0RvY3VtZW50O1xuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gdGhpcy5fdmlld1dyaXRlcjtcbiAgICAgICAgLy8gQ2xlYXIgYmluZGluZ3Mgc28gdGhlIGNhbGwgdG8gdGhpcyBtZXRob2QgcmV0dXJucyBjb3JyZWN0IHJlc3VsdHMuXG4gICAgICAgIHRoaXMubWFwcGVyLmNsZWFyQmluZGluZ3MoKTtcbiAgICAgICAgLy8gRmlyc3QsIGNvbnZlcnQgZWxlbWVudHMuXG4gICAgICAgIGNvbnN0IG1vZGVsUmFuZ2UgPSBSYW5nZS5fY3JlYXRlSW4obW9kZWxFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgIGNvbnN0IHZpZXdEb2N1bWVudEZyYWdtZW50ID0gbmV3IERvY3VtZW50RnJhZ21lbnQkMSh2aWV3RG9jdW1lbnQpO1xuICAgICAgICB0aGlzLm1hcHBlci5iaW5kRWxlbWVudHMobW9kZWxFbGVtZW50T3JGcmFnbWVudCwgdmlld0RvY3VtZW50RnJhZ21lbnQpO1xuICAgICAgICAvLyBQcmVwYXJlIGxpc3Qgb2YgbWFya2Vycy5cbiAgICAgICAgLy8gRm9yIGRvY3VtZW50IGZyYWdtZW50LCBzaW1wbHkgdGFrZSB0aGUgbWFya2VycyBhc3NpZ25lZCB0byB0aGlzIGRvY3VtZW50IGZyYWdtZW50LlxuICAgICAgICAvLyBGb3IgbW9kZWwgcm9vdCwgYWxsIG1hcmtlcnMgaW4gdGhhdCByb290IHdpbGwgYmUgdGFrZW4uXG4gICAgICAgIC8vIEZvciBtb2RlbCBlbGVtZW50LCB3ZSBuZWVkIHRvIGNoZWNrIHdoaWNoIG1hcmtlcnMgYXJlIGludGVyc2VjdGluZyB3aXRoIHRoaXMgZWxlbWVudCBhbmQgcmVsYXRpdmVseSBtb2RpZnkgdGhlIG1hcmtlcnMnIHJhbmdlcy5cbiAgICAgICAgLy8gQ29sbGFwc2VkIG1hcmtlcnMgYXQgZWxlbWVudCBib3VuZGFyeSwgYWx0aG91Z2ggY29uc2lkZXJlZCBhcyBub3QgaW50ZXJzZWN0aW5nIHdpdGggdGhlIGVsZW1lbnQsIHdpbGwgYWxzbyBiZSByZXR1cm5lZC5cbiAgICAgICAgY29uc3QgbWFya2VycyA9IG1vZGVsRWxlbWVudE9yRnJhZ21lbnQuaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSA/IG1vZGVsRWxlbWVudE9yRnJhZ21lbnQubWFya2VycyA6IF9nZXRNYXJrZXJzUmVsYXRpdmVUb0VsZW1lbnQobW9kZWxFbGVtZW50T3JGcmFnbWVudCk7XG4gICAgICAgIHRoaXMuZG93bmNhc3REaXNwYXRjaGVyLmNvbnZlcnQobW9kZWxSYW5nZSwgbWFya2Vycywgdmlld1dyaXRlciwgb3B0aW9ucyk7XG4gICAgICAgIHJldHVybiB2aWV3RG9jdW1lbnRGcmFnbWVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldHMgdGhlIGluaXRpYWwgaW5wdXQgZGF0YSBwYXJzZWQgYnkgdGhlIHtAbGluayAjcHJvY2Vzc29yIGRhdGEgcHJvY2Vzc29yfSBhbmRcblx0ICogY29udmVydGVkIGJ5IHRoZSB7QGxpbmsgI3VwY2FzdERpc3BhdGNoZXIgdmlldy10by1tb2RlbCBjb252ZXJ0ZXJzfS5cblx0ICogSW5pdGlhbCBkYXRhIGNhbiBiZSBvbmx5IHNldCB0byBhIGRvY3VtZW50IHdob3NlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb259IGlzIGVxdWFsIDAuXG5cdCAqXG5cdCAqICoqTm90ZSoqIFRoaXMgbWV0aG9kIGlzIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUjZGVjb3JhdGUgZGVjb3JhdGVkfSB3aGljaCBpc1xuXHQgKiB1c2VkIGJ5IGUuZy4gY29sbGFib3JhdGl2ZSBlZGl0aW5nIHBsdWdpbiB0aGF0IHN5bmNzIHJlbW90ZSBkYXRhIG9uIGluaXQuXG5cdCAqXG5cdCAqIFdoZW4gZGF0YSBpcyBwYXNzZWQgYXMgYSBzdHJpbmcsIGl0IGlzIGluaXRpYWxpemVkIG9uIHRoZSBkZWZhdWx0IGBtYWluYCByb290OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBkYXRhQ29udHJvbGxlci5pbml0KCAnPHA+Rm9vPC9wPicgKTsgLy8gSW5pdGlhbGl6ZXMgZGF0YSBvbiB0aGUgYG1haW5gIHJvb3Qgb25seSwgYXMgbm8gb3RoZXIgaXMgc3BlY2lmaWVkLlxuXHQgKiBgYGBcblx0ICpcblx0ICogVG8gaW5pdGlhbGl6ZSBkYXRhIG9uIGEgZGlmZmVyZW50IHJvb3Qgb3IgbXVsdGlwbGUgcm9vdHMgYXQgb25jZSwgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYHJvb3ROYW1lYCAtIGBkYXRhYCBwYWlycyBzaG91bGQgYmUgcGFzc2VkOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBkYXRhQ29udHJvbGxlci5pbml0KCB7IG1haW46ICc8cD5Gb288L3A+JywgdGl0bGU6ICc8aDE+QmFyPC9oMT4nIH0gKTsgLy8gSW5pdGlhbGl6ZXMgZGF0YSBvbiBib3RoIHRoZSBgbWFpbmAgYW5kIGB0aXRsZWAgcm9vdHMuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAZmlyZXMgaW5pdFxuXHQgKiBAcGFyYW0gZGF0YSBJbnB1dCBkYXRhIGFzIGEgc3RyaW5nIG9yIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgcm9vdE5hbWVgIC0gYGRhdGFgXG5cdCAqIHBhaXJzIHRvIGluaXRpYWxpemUgZGF0YSBvbiBtdWx0aXBsZSByb290cyBhdCBvbmNlLlxuXHQgKiBAcmV0dXJucyBQcm9taXNlIHRoYXQgaXMgcmVzb2x2ZWQgYWZ0ZXIgdGhlIGRhdGEgaXMgc2V0IG9uIHRoZSBlZGl0b3IuXG5cdCAqLyBpbml0KGRhdGEpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuZG9jdW1lbnQudmVyc2lvbikge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3Qgc2V0IGluaXRpYWwgZGF0YSB0byBhIG5vbi1lbXB0eSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudH0uXG5cdFx0XHQgKiBJbml0aWFsIGRhdGEgc2hvdWxkIGJlIHNldCBvbmNlLCBkdXJpbmcgdGhlIHtAbGluayBtb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9yfkVkaXRvcn0gaW5pdGlhbGl6YXRpb24sXG5cdFx0XHQgKiB3aGVuIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCN2ZXJzaW9ufSBpcyBlcXVhbCAwLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBkYXRhY29udHJvbGxlci1pbml0LWRvY3VtZW50LW5vdC1lbXB0eVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdkYXRhY29udHJvbGxlci1pbml0LWRvY3VtZW50LW5vdC1lbXB0eScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBpbml0aWFsRGF0YSA9IHt9O1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBpbml0aWFsRGF0YS5tYWluID0gZGF0YTsgLy8gRGVmYXVsdCByb290IGlzICdtYWluJy4gVG8gaW5pdGlhdGUgZGF0YSBvbiBhIGRpZmZlcmVudCByb290LCBvYmplY3Qgc2hvdWxkIGJlIHBhc3NlZC5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGluaXRpYWxEYXRhID0gZGF0YTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2NoZWNrSWZSb290c0V4aXN0cyhPYmplY3Qua2V5cyhpbml0aWFsRGF0YSkpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBpbml0IGRhdGEgb24gYSBub24tZXhpc3RlbnQgcm9vdC4gVGhpcyBlcnJvciBpcyB0aHJvd24gd2hlblxuXHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNpbml0IERhdGFDb250cm9sbGVyI2luaXQoKSBtZXRob2R9XG5cdFx0XHQgKiBpcyBjYWxsZWQgd2l0aCBub24tZXhpc3RlbnQgcm9vdCBuYW1lLiBGb3IgZXhhbXBsZSwgaWYgdGhlcmUgaXMgYW4gZWRpdG9yIGluc3RhbmNlIHdpdGggb25seSBgbWFpbmAgcm9vdCxcblx0XHRcdCAqIGNhbGxpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNpbml0fSBsaWtlOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBkYXRhLmluaXQoIHsgbWFpbjogJzxwPkZvbzwvcD4nLCByb290MjogJzxwPkJhcjwvcD4nIH0gKTtcblx0XHRcdCAqIGBgYFxuXHRcdFx0ICpcblx0XHRcdCAqIHdpbGwgdGhyb3cgdGhpcyBlcnJvci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgZGF0YWNvbnRyb2xsZXItaW5pdC1ub24tZXhpc3RlbnQtcm9vdFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdkYXRhY29udHJvbGxlci1pbml0LW5vbi1leGlzdGVudC1yb290JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2RlbC5lbnF1ZXVlQ2hhbmdlKHtcbiAgICAgICAgICAgIGlzVW5kb2FibGU6IGZhbHNlXG4gICAgICAgIH0sICh3cml0ZXIpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJvb3ROYW1lIG9mIE9iamVjdC5rZXlzKGluaXRpYWxEYXRhKSl7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kZWxSb290ID0gdGhpcy5tb2RlbC5kb2N1bWVudC5nZXRSb290KHJvb3ROYW1lKTtcbiAgICAgICAgICAgICAgICB3cml0ZXIuaW5zZXJ0KHRoaXMucGFyc2UoaW5pdGlhbERhdGFbcm9vdE5hbWVdLCBtb2RlbFJvb3QpLCBtb2RlbFJvb3QsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB0aGUgaW5wdXQgZGF0YSBwYXJzZWQgYnkgdGhlIHtAbGluayAjcHJvY2Vzc29yIGRhdGEgcHJvY2Vzc29yfSBhbmRcblx0ICogY29udmVydGVkIGJ5IHRoZSB7QGxpbmsgI3VwY2FzdERpc3BhdGNoZXIgdmlldy10by1tb2RlbCBjb252ZXJ0ZXJzfS5cblx0ICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYW55IHRpbWUgdG8gcmVwbGFjZSBleGlzdGluZyBlZGl0b3IgZGF0YSB3aXRoIHRoZSBuZXcgb25lIHdpdGhvdXQgY2xlYXJpbmcgdGhlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I2hpc3RvcnkgZG9jdW1lbnQgaGlzdG9yeX0uXG5cdCAqXG5cdCAqIFRoaXMgbWV0aG9kIGFsc28gY3JlYXRlcyBhIGJhdGNoIHdpdGggYWxsIHRoZSBjaGFuZ2VzIGFwcGxpZWQuIElmIGFsbCB5b3UgbmVlZCBpcyB0byBwYXJzZSBkYXRhLCB1c2Vcblx0ICogdGhlIHtAbGluayAjcGFyc2V9IG1ldGhvZC5cblx0ICpcblx0ICogV2hlbiBkYXRhIGlzIHBhc3NlZCBhcyBhIHN0cmluZyBpdCBpcyBzZXQgb24gdGhlIGRlZmF1bHQgYG1haW5gIHJvb3Q6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGRhdGFDb250cm9sbGVyLnNldCggJzxwPkZvbzwvcD4nICk7IC8vIFNldHMgZGF0YSBvbiB0aGUgYG1haW5gIHJvb3QsIGFzIG5vIG90aGVyIGlzIHNwZWNpZmllZC5cblx0ICogYGBgXG5cdCAqXG5cdCAqIFRvIHNldCBkYXRhIG9uIGEgZGlmZmVyZW50IHJvb3Qgb3IgbXVsdGlwbGUgcm9vdHMgYXQgb25jZSwgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYHJvb3ROYW1lYCAtIGBkYXRhYCBwYWlycyBzaG91bGQgYmUgcGFzc2VkOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBkYXRhQ29udHJvbGxlci5zZXQoIHsgbWFpbjogJzxwPkZvbzwvcD4nLCB0aXRsZTogJzxoMT5CYXI8L2gxPicgfSApOyAvLyBTZXRzIGRhdGEgb24gdGhlIGBtYWluYCBhbmQgYHRpdGxlYCByb290cyBhcyBzcGVjaWZpZWQuXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUbyBzZXQgdGhlIGRhdGEgd2l0aCBhIHByZXNlcnZlZCB1bmRvIHN0YWNrIGFuZCBhZGQgdGhlIGNoYW5nZSB0byB0aGUgdW5kbyBzdGFjaywgc2V0IGB7IGlzVW5kb2FibGU6IHRydWUgfWAgYXMgYSBgYmF0Y2hUeXBlYCBvcHRpb24uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGRhdGFDb250cm9sbGVyLnNldCggJzxwPkZvbzwvcD4nLCB7IGJhdGNoVHlwZTogeyBpc1VuZG9hYmxlOiB0cnVlIH0gfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQGZpcmVzIHNldFxuXHQgKiBAcGFyYW0gZGF0YSBJbnB1dCBkYXRhIGFzIGEgc3RyaW5nIG9yIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgcm9vdE5hbWVgIC0gYGRhdGFgXG5cdCAqIHBhaXJzIHRvIHNldCBkYXRhIG9uIG11bHRpcGxlIHJvb3RzIGF0IG9uY2UuXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIHNldHRpbmcgZGF0YS5cblx0ICogQHBhcmFtIG9wdGlvbnMuYmF0Y2hUeXBlIFRoZSBiYXRjaCB0eXBlIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGNyZWF0ZSBhIGJhdGNoIGZvciB0aGUgY2hhbmdlcyBhcHBsaWVkIGJ5IHRoaXMgbWV0aG9kLlxuXHQgKiBCeSBkZWZhdWx0LCB0aGUgYmF0Y2ggd2lsbCBiZSBzZXQgYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2gjaXNVbmRvYWJsZSBub3QgdW5kb2FibGV9IGFuZCB0aGUgdW5kbyBzdGFjayB3aWxsIGJlXG5cdCAqIGNsZWFyZWQgYWZ0ZXIgdGhlIG5ldyBkYXRhIGlzIGFwcGxpZWQgKGFsbCB1bmRvIHN0ZXBzIHdpbGwgYmUgcmVtb3ZlZCkuIElmIHRoZSBiYXRjaCB0eXBlIGBpc1VuZG9hYmxlYCBmbGFnIGlzIGJlIHNldCB0byBgdHJ1ZWAsXG5cdCAqIHRoZSB1bmRvIHN0YWNrIHdpbGwgYmUgcHJlc2VydmVkIGluc3RlYWQgYW5kIG5vdCBjbGVhcmVkIHdoZW4gbmV3IGRhdGEgaXMgYXBwbGllZC5cblx0ICovIHNldChkYXRhLCBvcHRpb25zID0ge30pIHtcbiAgICAgICAgbGV0IG5ld0RhdGEgPSB7fTtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgbmV3RGF0YS5tYWluID0gZGF0YTsgLy8gVGhlIGRlZmF1bHQgcm9vdCBpcyAnbWFpbicuIFRvIHNldCBkYXRhIG9uIGEgZGlmZmVyZW50IHJvb3QsIGFuIG9iamVjdCBzaG91bGQgYmUgcGFzc2VkLlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3RGF0YSA9IGRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9jaGVja0lmUm9vdHNFeGlzdHMoT2JqZWN0LmtleXMobmV3RGF0YSkpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIENhbm5vdCBzZXQgZGF0YSBvbiBhIG5vbi1leGlzdGVudCByb290LiBUaGlzIGVycm9yIGlzIHRocm93biB3aGVuIHRoZVxuXHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNzZXQgRGF0YUNvbnRyb2xsZXIjc2V0KCkgbWV0aG9kfVxuXHRcdFx0ICogaXMgY2FsbGVkIHdpdGggbm9uLWV4aXN0ZW50IHJvb3QgbmFtZS4gRm9yIGV4YW1wbGUsIGlmIHRoZXJlIGlzIGFuIGVkaXRvciBpbnN0YW5jZSB3aXRoIG9ubHkgdGhlIGRlZmF1bHQgYG1haW5gIHJvb3QsXG5cdFx0XHQgKiBjYWxsaW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXIjc2V0fSBsaWtlOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBkYXRhLnNldCggeyBtYWluOiAnPHA+Rm9vPC9wPicsIHJvb3QyOiAnPHA+QmFyPC9wPicgfSApO1xuXHRcdFx0ICogYGBgXG5cdFx0XHQgKlxuXHRcdFx0ICogd2lsbCB0aHJvdyB0aGlzIGVycm9yLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBkYXRhY29udHJvbGxlci1zZXQtbm9uLWV4aXN0ZW50LXJvb3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZGF0YWNvbnRyb2xsZXItc2V0LW5vbi1leGlzdGVudC1yb290JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2RlbC5lbnF1ZXVlQ2hhbmdlKG9wdGlvbnMuYmF0Y2hUeXBlIHx8IHt9LCAod3JpdGVyKT0+e1xuICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihudWxsKTtcbiAgICAgICAgICAgIHdyaXRlci5yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUodGhpcy5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0QXR0cmlidXRlS2V5cygpKTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgcm9vdE5hbWUgb2YgT2JqZWN0LmtleXMobmV3RGF0YSkpe1xuICAgICAgICAgICAgICAgIC8vIFNhdmUgdG8gbW9kZWwuXG4gICAgICAgICAgICAgICAgY29uc3QgbW9kZWxSb290ID0gdGhpcy5tb2RlbC5kb2N1bWVudC5nZXRSb290KHJvb3ROYW1lKTtcbiAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlKHdyaXRlci5jcmVhdGVSYW5nZUluKG1vZGVsUm9vdCkpO1xuICAgICAgICAgICAgICAgIHdyaXRlci5pbnNlcnQodGhpcy5wYXJzZShuZXdEYXRhW3Jvb3ROYW1lXSwgbW9kZWxSb290KSwgbW9kZWxSb290LCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBkYXRhIHBhcnNlZCBieSB0aGUge0BsaW5rICNwcm9jZXNzb3IgZGF0YSBwcm9jZXNzb3J9IGFuZCB0aGVuIGNvbnZlcnRlZCBieSB1cGNhc3QgY29udmVydGVyc1xuXHQgKiBhdHRhY2hlZCB0byB0aGUge0BsaW5rICN1cGNhc3REaXNwYXRjaGVyfS5cblx0ICpcblx0ICogQHNlZSAjc2V0XG5cdCAqIEBwYXJhbSBkYXRhIERhdGEgdG8gcGFyc2UuXG5cdCAqIEBwYXJhbSBjb250ZXh0IEJhc2UgY29udGV4dCBpbiB3aGljaCB0aGUgdmlldyB3aWxsIGJlIGNvbnZlcnRlZCB0byB0aGUgbW9kZWwuXG5cdCAqIFNlZToge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdERpc3BhdGNoZXIjY29udmVydH0uXG5cdCAqIEByZXR1cm5zIFBhcnNlZCBkYXRhLlxuXHQgKi8gcGFyc2UoZGF0YSwgY29udGV4dCA9ICckcm9vdCcpIHtcbiAgICAgICAgLy8gZGF0YSAtPiB2aWV3XG4gICAgICAgIGNvbnN0IHZpZXdEb2N1bWVudEZyYWdtZW50ID0gdGhpcy5wcm9jZXNzb3IudG9WaWV3KGRhdGEpO1xuICAgICAgICAvLyB2aWV3IC0+IG1vZGVsXG4gICAgICAgIHJldHVybiB0aGlzLnRvTW9kZWwodmlld0RvY3VtZW50RnJhZ21lbnQsIGNvbnRleHQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgcmVzdWx0IG9mIHRoZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IG9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IHZpZXcgZG9jdW1lbnQgZnJhZ21lbnR9IGNvbnZlcnRlZCBieSB0aGVcblx0ICoge0BsaW5rICN1cGNhc3REaXNwYXRjaGVyIHZpZXctdG8tbW9kZWwgY29udmVydGVyc30sIHdyYXBwZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50fS5cblx0ICpcblx0ICogV2hlbiBtYXJrZXIgZWxlbWVudHMgd2VyZSBjb252ZXJ0ZWQgZHVyaW5nIHRoZSBjb252ZXJzaW9uIHByb2Nlc3MsIGl0IHdpbGwgYmUgc2V0IGFzIGEgZG9jdW1lbnQgZnJhZ21lbnQnc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQjbWFya2VycyBzdGF0aWMgbWFya2VycyBtYXB9LlxuXHQgKlxuXHQgKiBAZmlyZXMgdG9Nb2RlbFxuXHQgKiBAcGFyYW0gdmlld0VsZW1lbnRPckZyYWdtZW50IFRoZSBlbGVtZW50IG9yIGRvY3VtZW50IGZyYWdtZW50IHdob3NlIGNvbnRlbnQgd2lsbCBiZSBjb252ZXJ0ZWQuXG5cdCAqIEBwYXJhbSBjb250ZXh0IEJhc2UgY29udGV4dCBpbiB3aGljaCB0aGUgdmlldyB3aWxsIGJlIGNvbnZlcnRlZCB0byB0aGUgbW9kZWwuXG5cdCAqIFNlZToge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdERpc3BhdGNoZXIjY29udmVydH0uXG5cdCAqIEByZXR1cm5zIE91dHB1dCBkb2N1bWVudCBmcmFnbWVudC5cblx0ICovIHRvTW9kZWwodmlld0VsZW1lbnRPckZyYWdtZW50LCBjb250ZXh0ID0gJyRyb290Jykge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwY2FzdERpc3BhdGNoZXIuY29udmVydCh2aWV3RWxlbWVudE9yRnJhZ21lbnQsIHdyaXRlciwgY29udGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyB0aGUgc3R5bGUgcHJvY2Vzc29yIG5vcm1hbGl6YXRpb24gcnVsZXMuXG5cdCAqXG5cdCAqIFlvdSBjYW4gaW1wbGVtZW50IHlvdXIgb3duIHJ1bGVzIGFzIHdlbGwgYXMgdXNlIG9uZSBvZiB0aGUgYXZhaWxhYmxlIHByb2Nlc3NvciBydWxlczpcblx0ICpcblx0ICogKiBiYWNrZ3JvdW5kOiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlcy9iYWNrZ3JvdW5kfmFkZEJhY2tncm91bmRSdWxlc31cblx0ICogKiBib3JkZXI6IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc3R5bGVzL2JvcmRlcn5hZGRCb3JkZXJSdWxlc31cblx0ICogKiBtYXJnaW46IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc3R5bGVzL21hcmdpbn5hZGRNYXJnaW5SdWxlc31cblx0ICogKiBwYWRkaW5nOiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3N0eWxlcy9wYWRkaW5nfmFkZFBhZGRpbmdSdWxlc31cblx0ICovIGFkZFN0eWxlUHJvY2Vzc29yUnVsZXMoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sodGhpcy5zdHlsZXNQcm9jZXNzb3IpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVnaXN0ZXJzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXJQYXR0ZXJufSBvbiBhbiB7QGxpbmsgI2h0bWxQcm9jZXNzb3IgaHRtbFByb2Nlc3Nvcn1cblx0ICogYW5kIGEge0BsaW5rICNwcm9jZXNzb3IgcHJvY2Vzc29yfSBmb3IgdmlldyBlbGVtZW50cyB3aG9zZSBjb250ZW50IHNob3VsZCBiZSB0cmVhdGVkIGFzIHJhdyBkYXRhXG5cdCAqIGFuZCBub3QgcHJvY2Vzc2VkIGR1cmluZyB0aGUgY29udmVyc2lvbiBmcm9tIERPTSB0byB2aWV3IGVsZW1lbnRzLlxuXHQgKlxuXHQgKiBUaGUgcmF3IGRhdGEgY2FuIGJlIGxhdGVyIGFjY2Vzc2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNnZXRDdXN0b21Qcm9wZXJ0eSB2aWV3IGVsZW1lbnQgY3VzdG9tIHByb3BlcnR5fVxuXHQgKiBgXCIkcmF3Q29udGVudFwiYC5cblx0ICpcblx0ICogQHBhcmFtIHBhdHRlcm4gUGF0dGVybiBtYXRjaGluZyBhbGwgdmlldyBlbGVtZW50cyB3aG9zZSBjb250ZW50IHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgcmF3IGRhdGEuXG5cdCAqLyByZWdpc3RlclJhd0NvbnRlbnRNYXRjaGVyKHBhdHRlcm4pIHtcbiAgICAgICAgLy8gTm8gbmVlZCB0byByZWdpc3RlciB0aGUgcGF0dGVybiBpZiBib3RoIHRoZSBgaHRtbFByb2Nlc3NvcmAgYW5kIGBwcm9jZXNzb3JgIGFyZSB0aGUgc2FtZSBpbnN0YW5jZXMuXG4gICAgICAgIGlmICh0aGlzLnByb2Nlc3NvciAmJiB0aGlzLnByb2Nlc3NvciAhPT0gdGhpcy5odG1sUHJvY2Vzc29yKSB7XG4gICAgICAgICAgICB0aGlzLnByb2Nlc3Nvci5yZWdpc3RlclJhd0NvbnRlbnRNYXRjaGVyKHBhdHRlcm4pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaHRtbFByb2Nlc3Nvci5yZWdpc3RlclJhd0NvbnRlbnRNYXRjaGVyKHBhdHRlcm4pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhbGwgZXZlbnQgbGlzdGVuZXJzIHNldCBieSB0aGUgRGF0YUNvbnRyb2xsZXIuXG5cdCAqLyBkZXN0cm95KCkge1xuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIGFsbCBwcm92aWRlZCByb290IG5hbWVzIGFyZSBhY3R1YWxseSBleGlzdGluZyBlZGl0b3Igcm9vdHMuXG5cdCAqXG5cdCAqIEBwYXJhbSByb290TmFtZXMgUm9vdCBuYW1lcyB0byBjaGVjay5cblx0ICogQHJldHVybnMgV2hldGhlciBhbGwgcHJvdmlkZWQgcm9vdCBuYW1lcyBhcmUgZXhpc3RpbmcgZWRpdG9yIHJvb3RzLlxuXHQgKi8gX2NoZWNrSWZSb290c0V4aXN0cyhyb290TmFtZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCByb290TmFtZSBvZiByb290TmFtZXMpe1xuICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmRvY3VtZW50LmdldFJvb3Qocm9vdE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBkb3duY2FzdCBjb252ZXJzaW9uLlxuICpcbiAqIFRha2VzIGEgZG9jdW1lbnQgZWxlbWVudCAoZWxlbWVudCB0aGF0IGlzIGFkZGVkIHRvIGEgbW9kZWwgZG9jdW1lbnQpIGFuZCBjaGVja3Mgd2hpY2ggbWFya2VycyBhcmUgaW5zaWRlIGl0LiBJZiB0aGUgbWFya2VyIGlzIGNvbGxhcHNlZFxuICogYXQgZWxlbWVudCBib3VuZGFyeSwgaXQgaXMgY29uc2lkZXJlZCBhcyBjb250YWluZWQgaW5zaWRlIHRoZSBlbGVtZW50IGFuZCBtYXJrZXIgcmFuZ2UgaXMgcmV0dXJuZWQuIE90aGVyd2lzZSwgaWYgdGhlIG1hcmtlciBpc1xuICogaW50ZXJzZWN0aW5nIHdpdGggdGhlIGVsZW1lbnQsIHRoZSBpbnRlcnNlY3Rpb24gaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gX2dldE1hcmtlcnNSZWxhdGl2ZVRvRWxlbWVudChlbGVtZW50KSB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgY29uc3QgZG9jID0gZWxlbWVudC5yb290LmRvY3VtZW50O1xuICAgIGlmICghZG9jKSB7XG4gICAgICAgIHJldHVybiBuZXcgTWFwKCk7XG4gICAgfVxuICAgIGNvbnN0IGVsZW1lbnRSYW5nZSA9IFJhbmdlLl9jcmVhdGVJbihlbGVtZW50KTtcbiAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiBkb2MubW9kZWwubWFya2Vycyl7XG4gICAgICAgIGNvbnN0IG1hcmtlclJhbmdlID0gbWFya2VyLmdldFJhbmdlKCk7XG4gICAgICAgIGNvbnN0IGlzTWFya2VyQ29sbGFwc2VkID0gbWFya2VyUmFuZ2UuaXNDb2xsYXBzZWQ7XG4gICAgICAgIGNvbnN0IGlzTWFya2VyQXRFbGVtZW50Qm91bmRhcnkgPSBtYXJrZXJSYW5nZS5zdGFydC5pc0VxdWFsKGVsZW1lbnRSYW5nZS5zdGFydCkgfHwgbWFya2VyUmFuZ2UuZW5kLmlzRXF1YWwoZWxlbWVudFJhbmdlLmVuZCk7XG4gICAgICAgIGlmIChpc01hcmtlckNvbGxhcHNlZCAmJiBpc01hcmtlckF0RWxlbWVudEJvdW5kYXJ5KSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChbXG4gICAgICAgICAgICAgICAgbWFya2VyLm5hbWUsXG4gICAgICAgICAgICAgICAgbWFya2VyUmFuZ2VcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZE1hcmtlclJhbmdlID0gZWxlbWVudFJhbmdlLmdldEludGVyc2VjdGlvbihtYXJrZXJSYW5nZSk7XG4gICAgICAgICAgICBpZiAodXBkYXRlZE1hcmtlclJhbmdlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goW1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZE1hcmtlclJhbmdlXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gU29ydCB0aGUgbWFya2VycyBpbiBhIHN0YWJsZSBmYXNoaW9uIHRvIGVuc3VyZSB0aGF0IHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IGFyZVxuICAgIC8vIGFkZGVkIHRvIHRoZSBtb2RlbCdzIG1hcmtlciBjb2xsZWN0aW9uIGRvZXMgbm90IGFmZmVjdCBob3cgdGhleSBhcmVcbiAgICAvLyBkb3duY2FzdC4gT25lIHBhcnRpY3VsYXIgdXNlIGNhc2UgdGhhdCB3ZSBhcmUgdGFyZ2V0aW5nIGhlcmUsIGlzIG9uZSB3aGVyZVxuICAgIC8vIHR3byBtYXJrZXJzIGFyZSBhZGphY2VudCBidXQgbm90IG92ZXJsYXBwaW5nLCBzdWNoIGFzIGFuIGluc2VydGlvbi9kZWxldGlvblxuICAgIC8vIHN1Z2dlc3Rpb24gcGFpciByZXByZXNlbnRpbmcgdGhlIHJlcGxhY2VtZW50IG9mIGEgcmFuZ2Ugb2YgdGV4dC4gSW4gdGhpc1xuICAgIC8vIGNhc2UsIHB1dHRpbmcgdGhlIG1hcmtlcnMgaW4gRE9NIG9yZGVyIGNhdXNlcyB0aGUgZmlyc3QgbWFya2VyJ3MgZW5kIHRvIGJlXG4gICAgLy8gc2VyaWFsaXplZCByaWdodCBhZnRlciB0aGUgc2Vjb25kIG1hcmtlcidzIHN0YXJ0LCB3aGlsZSBwdXR0aW5nIHRoZSBtYXJrZXJzXG4gICAgLy8gaW4gcmV2ZXJzZSBET00gb3JkZXIgY2F1c2VzIGl0IHRvIGJlIHJpZ2h0IGJlZm9yZSB0aGUgc2Vjb25kIG1hcmtlcidzXG4gICAgLy8gc3RhcnQuIFNvLCB3ZSBzb3J0IHRoZXNlIGluIGEgd2F5IHRoYXQgZW5zdXJlcyBub24taW50ZXJzZWN0aW5nIHJhbmdlcyBhcmUgaW5cbiAgICAvLyByZXZlcnNlIERPTSBvcmRlciwgYW5kIGludGVyc2VjdGluZyByYW5nZXMgYXJlIGluIHNvbWV0aGluZyBhcHByb3hpbWF0aW5nXG4gICAgLy8gcmV2ZXJzZSBET00gb3JkZXIgKHNpbmNlIHJldmVyc2UgRE9NIG9yZGVyIGRvZXNuJ3QgaGF2ZSBhIHByZWNpc2UgbWVhbmluZ1xuICAgIC8vIHdoZW4gd29ya2luZyB3aXRoIGludGVyc2VjdGluZyByYW5nZXMpLlxuICAgIHJlc3VsdC5zb3J0KChbbjEsIHIxXSwgW24yLCByMl0pPT57XG4gICAgICAgIGlmIChyMS5lbmQuY29tcGFyZVdpdGgocjIuc3RhcnQpICE9PSAnYWZ0ZXInKSB7XG4gICAgICAgICAgICAvLyBtMS5lbmQgPD0gbTIuc3RhcnQgLS0gbTEgaXMgZW50aXJlbHkgPD0gbTJcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2UgaWYgKHIxLnN0YXJ0LmNvbXBhcmVXaXRoKHIyLmVuZCkgIT09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICAvLyBtMS5zdGFydCA+PSBtMi5lbmQgLS0gbTEgaXMgZW50aXJlbHkgPj0gbTJcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHRoZXkgb3ZlcmxhcCwgc28gdXNlIHRoZWlyIHN0YXJ0IHBvc2l0aW9ucyBhcyB0aGUgcHJpbWFyeSBzb3J0IGtleSBhbmRcbiAgICAgICAgICAgIC8vIGVuZCBwb3NpdGlvbnMgYXMgdGhlIHNlY29uZGFyeSBzb3J0IGtleVxuICAgICAgICAgICAgc3dpdGNoKHIxLnN0YXJ0LmNvbXBhcmVXaXRoKHIyLnN0YXJ0KSl7XG4gICAgICAgICAgICAgICAgY2FzZSAnYmVmb3JlJzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgY2FzZSAnYWZ0ZXInOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoKHIxLmVuZC5jb21wYXJlV2l0aChyMi5lbmQpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JlZm9yZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhZnRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbjIubG9jYWxlQ29tcGFyZShuMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBuZXcgTWFwKHJlc3VsdCk7XG59XG5cbi8qKlxuICogQSB1dGlsaXR5IGNsYXNzIHRoYXQgaGVscHMgYWRkIGNvbnZlcnRlcnMgdG8gdXBjYXN0IGFuZCBkb3duY2FzdCBkaXNwYXRjaGVycy5cbiAqXG4gKiBXZSByZWNvbW1lbmQgcmVhZGluZyB0aGUge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL2NvbnZlcnNpb24vaW50cm8gZWRpdG9yIGNvbnZlcnNpb259IGd1aWRlIGZpcnN0IHRvXG4gKiB1bmRlcnN0YW5kIHRoZSBjb3JlIGNvbmNlcHRzIG9mIHRoZSBjb252ZXJzaW9uIG1lY2hhbmlzbXMuXG4gKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIGNvbnZlcnNpb24gbWFuYWdlciBpcyBhdmFpbGFibGUgaW4gdGhlXG4gKiB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3IjY29udmVyc2lvbiBgZWRpdG9yLmNvbnZlcnNpb25gfSBwcm9wZXJ0eVxuICogYW5kIGJ5IGRlZmF1bHQgaGFzIHRoZSBmb2xsb3dpbmcgZ3JvdXBzIG9mIGRpc3BhdGNoZXJzIChpLmUuIGRpcmVjdGlvbnMgb2YgY29udmVyc2lvbik6XG4gKlxuICogKiBgZG93bmNhc3RgIChlZGl0aW5nIGFuZCBkYXRhIGRvd25jYXN0cylcbiAqICogYGVkaXRpbmdEb3duY2FzdGBcbiAqICogYGRhdGFEb3duY2FzdGBcbiAqICogYHVwY2FzdGBcbiAqXG4gKiAjIE9uZS13YXkgY29udmVydGVyc1xuICpcbiAqIFRvIGFkZCBhIGNvbnZlcnRlciB0byBhIHNwZWNpZmljIGdyb3VwLCB1c2UgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2ZvciBgZm9yKClgfVxuICogbWV0aG9kOlxuICpcbiAqIGBgYHRzXG4gKiAvLyBBZGQgYSBjb252ZXJ0ZXIgdG8gZWRpdGluZyBkb3duY2FzdCBhbmQgZGF0YSBkb3duY2FzdC5cbiAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2Rvd25jYXN0JyApLmVsZW1lbnRUb0VsZW1lbnQoIGNvbmZpZyApICk7XG4gKlxuICogLy8gQWRkIGEgY29udmVydGVyIHRvIHRoZSBkYXRhIHBpcGVwbGluZSBvbmx5OlxuICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZGF0YURvd25jYXN0JyApLmVsZW1lbnRUb0VsZW1lbnQoIGRhdGFDb252ZXJzaW9uQ29uZmlnICkgKTtcbiAqXG4gKiAvLyBBbmQgYSBzbGlnaHRseSBkaWZmZXJlbnQgb25lIGZvciB0aGUgZWRpdGluZyBwaXBlbGluZTpcbiAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2VkaXRpbmdEb3duY2FzdCcgKS5lbGVtZW50VG9FbGVtZW50KCBlZGl0aW5nQ29udmVyc2lvbkNvbmZpZyApICk7XG4gKiBgYGBcbiAqXG4gKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jZm9yIGBmb3IoKWB9IG1ldGhvZCBkb2N1bWVudGF0aW9uIHRvIGxlYXJuIG1vcmUgYWJvdXRcbiAqIGF2YWlsYWJsZSBjb252ZXJzaW9uIGhlbHBlcnMgYW5kIGhvdyB0byB1c2UgeW91ciBjdXN0b20gb25lcy5cbiAqXG4gKiAjIFR3by13YXkgY29udmVydGVyc1xuICpcbiAqIEJlc2lkZXMgdXNpbmcgb25lLXdheSBjb252ZXJ0ZXJzIHZpYSB0aGUgYGZvcigpYCBtZXRob2QsIHlvdSBjYW4gYWxzbyB1c2Ugb3RoZXIgbWV0aG9kcyBhdmFpbGFibGUgaW4gdGhpc1xuICogY2xhc3MgdG8gYWRkIHR3by13YXkgY29udmVydGVycyAodXBjYXN0IGFuZCBkb3duY2FzdCk6XG4gKlxuICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNlbGVtZW50VG9FbGVtZW50IGBlbGVtZW50VG9FbGVtZW50KClgfSAmbmRhc2g7XG4gKiBNb2RlbCBlbGVtZW50IHRvIHZpZXcgZWxlbWVudCBhbmQgdmljZSB2ZXJzYS5cbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9jb252ZXJzaW9ufkNvbnZlcnNpb24jYXR0cmlidXRlVG9FbGVtZW50IGBhdHRyaWJ1dGVUb0VsZW1lbnQoKWB9ICZuZGFzaDtcbiAqIE1vZGVsIGF0dHJpYnV0ZSB0byB2aWV3IGVsZW1lbnQgYW5kIHZpY2UgdmVyc2EuXG4gKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbn5Db252ZXJzaW9uI2F0dHJpYnV0ZVRvQXR0cmlidXRlIGBhdHRyaWJ1dGVUb0F0dHJpYnV0ZSgpYH0gJm5kYXNoO1xuICogTW9kZWwgYXR0cmlidXRlIHRvIHZpZXcgYXR0cmlidXRlIGFuZCB2aWNlIHZlcnNhLlxuICovIGNsYXNzIENvbnZlcnNpb24ge1xuICAgIC8qKlxuXHQgKiBNYXBzIGRpc3BhdGNoZXJzIGdyb3VwIG5hbWUgdG8gQ29udmVyc2lvbkhlbHBlcnMgaW5zdGFuY2VzLlxuXHQgKi8gX2hlbHBlcnMgPSBuZXcgTWFwKCk7XG4gICAgX2Rvd25jYXN0O1xuICAgIF91cGNhc3Q7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgY29udmVyc2lvbiBpbnN0YW5jZS5cblx0ICovIGNvbnN0cnVjdG9yKGRvd25jYXN0RGlzcGF0Y2hlcnMsIHVwY2FzdERpc3BhdGNoZXJzKXtcbiAgICAgICAgLy8gRGVmaW5lIGRlZmF1bHQgJ2Rvd25jYXN0JyAmICd1cGNhc3QnIGRpc3BhdGNoZXJzIGdyb3Vwcy4gVGhvc2UgZ3JvdXBzIGFyZSBhbHdheXMgYXZhaWxhYmxlIGFzIHR3by13YXkgY29udmVydGVycyBuZWVkcyB0aGVtLlxuICAgICAgICB0aGlzLl9kb3duY2FzdCA9IHRvQXJyYXkoZG93bmNhc3REaXNwYXRjaGVycyk7XG4gICAgICAgIHRoaXMuX2NyZWF0ZUNvbnZlcnNpb25IZWxwZXJzKHtcbiAgICAgICAgICAgIG5hbWU6ICdkb3duY2FzdCcsXG4gICAgICAgICAgICBkaXNwYXRjaGVyczogdGhpcy5fZG93bmNhc3QsXG4gICAgICAgICAgICBpc0Rvd25jYXN0OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl91cGNhc3QgPSB0b0FycmF5KHVwY2FzdERpc3BhdGNoZXJzKTtcbiAgICAgICAgdGhpcy5fY3JlYXRlQ29udmVyc2lvbkhlbHBlcnMoe1xuICAgICAgICAgICAgbmFtZTogJ3VwY2FzdCcsXG4gICAgICAgICAgICBkaXNwYXRjaGVyczogdGhpcy5fdXBjYXN0LFxuICAgICAgICAgICAgaXNEb3duY2FzdDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZWZpbmUgYW4gYWxpYXMgZm9yIHJlZ2lzdGVyZWQgZGlzcGF0Y2hlci5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgY29udmVyc2lvbiA9IG5ldyBDb252ZXJzaW9uKFxuXHQgKiBcdFsgZGF0YURvd25jYXN0RGlzcGF0Y2hlciwgZWRpdGluZ0Rvd25jYXN0RGlzcGF0Y2hlciBdLFxuXHQgKiBcdHVwY2FzdERpc3BhdGNoZXJcblx0ICogKTtcblx0ICpcblx0ICogY29udmVyc2lvbi5hZGRBbGlhcyggJ2RhdGFEb3duY2FzdCcsIGRhdGFEb3duY2FzdERpc3BhdGNoZXIgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBhbGlhcyBBbiBhbGlhcyBvZiBhIGRpc3BhdGNoZXIuXG5cdCAqIEBwYXJhbSBkaXNwYXRjaGVyIERpc3BhdGNoZXIgd2hpY2ggc2hvdWxkIGhhdmUgYW4gYWxpYXMuXG5cdCAqLyBhZGRBbGlhcyhhbGlhcywgZGlzcGF0Y2hlcikge1xuICAgICAgICBjb25zdCBpc0Rvd25jYXN0ID0gdGhpcy5fZG93bmNhc3QuaW5jbHVkZXMoZGlzcGF0Y2hlcik7XG4gICAgICAgIGNvbnN0IGlzVXBjYXN0ID0gdGhpcy5fdXBjYXN0LmluY2x1ZGVzKGRpc3BhdGNoZXIpO1xuICAgICAgICBpZiAoIWlzVXBjYXN0ICYmICFpc0Rvd25jYXN0KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRyeWluZyB0byByZWdpc3RlciBhbiBhbGlhcyBmb3IgYSBkaXNwYXRjaGVyIHRoYXQgbmFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGNvbnZlcnNpb24tYWRkLWFsaWFzLWRpc3BhdGNoZXItbm90LXJlZ2lzdGVyZWRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29udmVyc2lvbi1hZGQtYWxpYXMtZGlzcGF0Y2hlci1ub3QtcmVnaXN0ZXJlZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NyZWF0ZUNvbnZlcnNpb25IZWxwZXJzKHtcbiAgICAgICAgICAgIG5hbWU6IGFsaWFzLFxuICAgICAgICAgICAgZGlzcGF0Y2hlcnM6IFtcbiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgaXNEb3duY2FzdFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFByb3ZpZGVzIGEgY2hhaW5hYmxlIEFQSSB0byBhc3NpZ24gY29udmVydGVycyB0byBhIGNvbnZlcnNpb24gZGlzcGF0Y2hlcnMgZ3JvdXAuXG5cdCAqXG5cdCAqIElmIHRoZSBnaXZlbiBncm91cCBuYW1lIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLCB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgYGNvbnZlcnNpb24tZm9yLXVua25vd24tZ3JvdXBgIGVycm9yfSBpcyB0aHJvd24uXG5cdCAqXG5cdCAqIFlvdSBjYW4gdXNlIGNvbnZlcnNpb24gaGVscGVycyBhdmFpbGFibGUgZGlyZWN0bHkgaW4gdGhlIGBmb3IoKWAgY2hhaW4gb3IgeW91ciBjdXN0b20gb25lcyB2aWFcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vY29udmVyc2lvbmhlbHBlcnN+Q29udmVyc2lvbkhlbHBlcnMjYWRkIGBhZGQoKWB9IG1ldGhvZC5cblx0ICpcblx0ICogIyBVc2luZyBidWlsdC1pbiBjb252ZXJzaW9uIGhlbHBlcnNcblx0ICpcblx0ICogVGhlIGBmb3IoKWAgY2hhaW4gY29tZXMgd2l0aCBhIHNldCBvZiBjb252ZXJzaW9uIGhlbHBlcnMgd2hpY2ggeW91IGNhbiB1c2UgbGlrZSB0aGlzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdkb3duY2FzdCcgKVxuXHQgKiBcdC5lbGVtZW50VG9FbGVtZW50KCBjb25maWcxICkgICAgICAgIC8vIEFkZHMgYW4gZWxlbWVudC10by1lbGVtZW50IGRvd25jYXN0IGNvbnZlcnRlci5cblx0ICogXHQuYXR0cmlidXRlVG9FbGVtZW50KCBjb25maWcyICk7ICAgICAvLyBBZGRzIGFuIGF0dHJpYnV0ZS10by1lbGVtZW50IGRvd25jYXN0IGNvbnZlcnRlci5cblx0ICpcblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAndXBjYXN0JyApXG5cdCAqIFx0LmVsZW1lbnRUb0F0dHJpYnV0ZSggY29uZmlnMyApOyAgICAgLy8gQWRkcyBhbiBlbGVtZW50LXRvLWF0dHJpYnV0ZSB1cGNhc3QgY29udmVydGVyLlxuXHQgKiBgYGBcblx0ICpcblx0ICogUmVmZXIgdG8gdGhlIGRvY3VtZW50YXRpb24gb2YgYnVpbHQtaW4gY29udmVyc2lvbiBoZWxwZXJzIHRvIGxlYXJuIGFib3V0IHRoZWlyIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cblx0ICpcblx0ICogKiBkb3duY2FzdCAobW9kZWwtdG8tdmlldykgY29udmVyc2lvbiBoZWxwZXJzOlxuXHQgKlxuXHQgKlx0KiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjZWxlbWVudFRvRWxlbWVudCBgZWxlbWVudFRvRWxlbWVudCgpYH0sXG5cdCAqXHQqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkRvd25jYXN0SGVscGVycyNhdHRyaWJ1dGVUb0VsZW1lbnQgYGF0dHJpYnV0ZVRvRWxlbWVudCgpYH0sXG5cdCAqXHQqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkRvd25jYXN0SGVscGVycyNhdHRyaWJ1dGVUb0F0dHJpYnV0ZSBgYXR0cmlidXRlVG9BdHRyaWJ1dGUoKWB9LlxuXHQgKlx0KiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjbWFya2VyVG9FbGVtZW50IGBtYXJrZXJUb0VsZW1lbnQoKWB9LlxuXHQgKlx0KiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjbWFya2VyVG9IaWdobGlnaHQgYG1hcmtlclRvSGlnaGxpZ2h0KClgfS5cblx0ICpcblx0ICogKiB1cGNhc3QgKHZpZXctdG8tbW9kZWwpIGNvbnZlcnNpb24gaGVscGVyczpcblx0ICpcblx0ICpcdCoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RoZWxwZXJzflVwY2FzdEhlbHBlcnMjZWxlbWVudFRvRWxlbWVudCBgZWxlbWVudFRvRWxlbWVudCgpYH0sXG5cdCAqXHQqIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0aGVscGVyc35VcGNhc3RIZWxwZXJzI2VsZW1lbnRUb0F0dHJpYnV0ZSBgZWxlbWVudFRvQXR0cmlidXRlKClgfSxcblx0ICpcdCoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RoZWxwZXJzflVwY2FzdEhlbHBlcnMjYXR0cmlidXRlVG9BdHRyaWJ1dGUgYGF0dHJpYnV0ZVRvQXR0cmlidXRlKClgfS5cblx0ICpcdCoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RoZWxwZXJzflVwY2FzdEhlbHBlcnMjZWxlbWVudFRvTWFya2VyIGBlbGVtZW50VG9NYXJrZXIoKWB9LlxuXHQgKlxuXHQgKiAjIFVzaW5nIGN1c3RvbSBjb252ZXJzaW9uIGhlbHBlcnNcblx0ICpcblx0ICogSWYgeW91IG5lZWQgdG8gaW1wbGVtZW50IGFuIGF0eXBpY2FsIGNvbnZlcnRlciwgeW91IGNhbiBkbyBzbyBieSBjYWxsaW5nOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoIGRpcmVjdGlvbiApLmFkZCggY3VzdG9tSGVscGVyICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGUgYC5hZGQoKWAgbWV0aG9kIHRha2VzIGV4YWN0bHkgb25lIHBhcmFtZXRlciwgd2hpY2ggaXMgYSBmdW5jdGlvbi4gVGhpcyBmdW5jdGlvbiBzaG91bGQgYWNjZXB0IG9uZSBwYXJhbWV0ZXIgdGhhdFxuXHQgKiBpcyBhIGRpc3BhdGNoZXIgaW5zdGFuY2UuIFRoZSBmdW5jdGlvbiBzaG91bGQgYWRkIGFuIGFjdHVhbCBjb252ZXJ0ZXIgdG8gdGhlIHBhc3NlZCBkaXNwYXRjaGVyIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBFeGFtcGxlOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICd1cGNhc3QnICkuYWRkKCBkaXNwYXRjaGVyID0+IHtcblx0ICogXHRkaXNwYXRjaGVyLm9uKCAnZWxlbWVudDphJywgICggZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpICkgPT4ge1xuXHQgKiBcdFx0Ly8gRG8gc29tZXRoaW5nIHdpdGggYSB2aWV3IDxhPiBlbGVtZW50LlxuXHQgKiBcdH0gKTtcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogUmVmZXIgdG8gdGhlIGRvY3VtZW50YXRpb24gb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdERpc3BhdGNoZXJ9XG5cdCAqIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXJ9IHRvIGxlYXJuIGhvdyB0byB3cml0ZVxuXHQgKiBjdXN0b20gY29udmVydGVycy5cblx0ICpcblx0ICogQHBhcmFtIGdyb3VwTmFtZSBUaGUgbmFtZSBvZiBkaXNwYXRjaGVycyBncm91cCB0byBhZGQgdGhlIGNvbnZlcnRlcnMgdG8uXG5cdCAqLyBmb3IoZ3JvdXBOYW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5faGVscGVycy5oYXMoZ3JvdXBOYW1lKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUcnlpbmcgdG8gYWRkIGEgY29udmVydGVyIHRvIGFuIHVua25vd24gZGlzcGF0Y2hlcnMgZ3JvdXAuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGNvbnZlcnNpb24tZm9yLXVua25vd24tZ3JvdXBcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignY29udmVyc2lvbi1mb3ItdW5rbm93bi1ncm91cCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9oZWxwZXJzLmdldChncm91cE5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB1cCBjb252ZXJ0ZXJzIGJldHdlZW4gdGhlIG1vZGVsIGFuZCB0aGUgdmlldyB0aGF0IGNvbnZlcnQgYSBtb2RlbCBlbGVtZW50IHRvIGEgdmlldyBlbGVtZW50IChhbmQgdmljZSB2ZXJzYSkuXG5cdCAqIEZvciBleGFtcGxlLCB0aGUgbW9kZWwgYDxwYXJhZ3JhcGg+Rm9vPC9wYXJhZ3JhcGg+YCBpcyB0dXJuZWQgaW50byBgPHA+Rm9vPC9wPmAgaW4gdGhlIHZpZXcuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEEgc2ltcGxlIGNvbnZlcnNpb24gZnJvbSB0aGUgYHBhcmFncmFwaGAgbW9kZWwgZWxlbWVudCB0byB0aGUgYDxwPmAgdmlldyBlbGVtZW50IChhbmQgdmljZSB2ZXJzYSkuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmVsZW1lbnRUb0VsZW1lbnQoIHsgbW9kZWw6ICdwYXJhZ3JhcGgnLCB2aWV3OiAncCcgfSApO1xuXHQgKlxuXHQgKiAvLyBPdmVycmlkZSBvdGhlciBjb252ZXJ0ZXJzIGJ5IHNwZWNpZnlpbmcgYSBjb252ZXJ0ZXIgZGVmaW5pdGlvbiB3aXRoIGEgaGlnaGVyIHByaW9yaXR5LlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5lbGVtZW50VG9FbGVtZW50KCB7IG1vZGVsOiAncGFyYWdyYXBoJywgdmlldzogJ2RpdicsIGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCcgfSApO1xuXHQgKlxuXHQgKiAvLyBWaWV3IHNwZWNpZmllZCBhcyBhbiBvYmplY3QgaW5zdGVhZCBvZiBhIHN0cmluZy5cblx0ICogZWRpdG9yLmNvbnZlcnNpb24uZWxlbWVudFRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAnZmFuY3lQYXJhZ3JhcGgnLFxuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdG5hbWU6ICdwJyxcblx0ICogXHRcdGNsYXNzZXM6ICdmYW5jeSdcblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICpcblx0ICogLy8gVXNlIGB1cGNhc3RBbHNvYCB0byBkZWZpbmUgb3RoZXIgdmlldyBlbGVtZW50cyB0aGF0IHNob3VsZCBhbHNvIGJlIGNvbnZlcnRlZCB0byBhIGBwYXJhZ3JhcGhgIGVsZW1lbnQuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmVsZW1lbnRUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDogJ3BhcmFncmFwaCcsXG5cdCAqIFx0dmlldzogJ3AnLFxuXHQgKiBcdHVwY2FzdEFsc286IFtcblx0ICogXHRcdCdkaXYnLFxuXHQgKiBcdFx0e1xuXHQgKiBcdFx0XHQvLyBBbnkgZWxlbWVudCB3aXRoIHRoZSBgZGlzcGxheTogYmxvY2tgIHN0eWxlLlxuXHQgKiBcdFx0XHRzdHlsZXM6IHtcblx0ICogXHRcdFx0XHRkaXNwbGF5OiAnYmxvY2snXG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH1cblx0ICogXHRdXG5cdCAqIH0gKTtcblx0ICpcblx0ICogLy8gYHVwY2FzdEFsc29gIHNldCBhcyBjYWxsYmFjayBlbmFibGVzIGEgY29udmVyc2lvbiBvZiBhIHdpZGUgcmFuZ2Ugb2YgZGlmZmVyZW50IHZpZXcgZWxlbWVudHMuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmVsZW1lbnRUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDogJ2hlYWRpbmcnLFxuXHQgKiBcdHZpZXc6ICdoMicsXG5cdCAqIFx0Ly8gQ29udmVydCBcImhlYWRpbmctbGlrZVwiIHBhcmFncmFwaHMgdG8gaGVhZGluZ3MuXG5cdCAqIFx0dXBjYXN0QWxzbzogdmlld0VsZW1lbnQgPT4ge1xuXHQgKiBcdFx0Y29uc3QgZm9udFNpemUgPSB2aWV3RWxlbWVudC5nZXRTdHlsZSggJ2ZvbnQtc2l6ZScgKTtcblx0ICpcblx0ICogXHRcdGlmICggIWZvbnRTaXplICkge1xuXHQgKiBcdFx0XHRyZXR1cm4gbnVsbDtcblx0ICogXHRcdH1cblx0ICpcblx0ICogXHRcdGNvbnN0IG1hdGNoID0gZm9udFNpemUubWF0Y2goIC8oXFxkKylcXHMqcHgvICk7XG5cdCAqXG5cdCAqIFx0XHRpZiAoICFtYXRjaCApIHtcblx0ICogXHRcdFx0cmV0dXJuIG51bGw7XG5cdCAqIFx0XHR9XG5cdCAqXG5cdCAqIFx0XHRjb25zdCBzaXplID0gTnVtYmVyKCBtYXRjaFsgMSBdICk7XG5cdCAqXG5cdCAqIFx0XHRpZiAoIHNpemUgPiAyNiApIHtcblx0ICogXHRcdFx0Ly8gUmV0dXJuZWQgdmFsdWUgY2FuIGJlIGFuIG9iamVjdCB3aXRoIHRoZSBtYXRjaGVkIHByb3BlcnRpZXMuXG5cdCAqIFx0XHRcdC8vIFRoZXNlIHByb3BlcnRpZXMgd2lsbCBiZSBcImNvbnN1bWVkXCIgZHVyaW5nIHRoZSBjb252ZXJzaW9uLlxuXHQgKiBcdFx0XHQvLyBTZWUgYGVuZ2luZS52aWV3Lk1hdGNoZXJ+TWF0Y2hlclBhdHRlcm5gIGFuZCBgZW5naW5lLnZpZXcuTWF0Y2hlciNtYXRjaGAgZm9yIG1vcmUgZGV0YWlscy5cblx0ICpcblx0ICogXHRcdFx0cmV0dXJuIHsgbmFtZTogdHJ1ZSwgc3R5bGVzOiBbICdmb250LXNpemUnIF0gfTtcblx0ICogXHRcdH1cblx0ICpcblx0ICogXHRcdHJldHVybiBudWxsO1xuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogYGRlZmluaXRpb24ubW9kZWxgIGlzIGEgYFN0cmluZ2Agd2l0aCBhIG1vZGVsIGVsZW1lbnQgbmFtZSB0byBjb252ZXJ0IGZyb20gb3IgdG8uXG5cdCAqXG5cdCAqIEBwYXJhbSBkZWZpbml0aW9uIFRoZSBjb252ZXJ0ZXIgZGVmaW5pdGlvbi5cblx0ICovIGVsZW1lbnRUb0VsZW1lbnQoZGVmaW5pdGlvbikge1xuICAgICAgICAvLyBTZXQgdXAgZG93bmNhc3QgY29udmVydGVyLlxuICAgICAgICB0aGlzLmZvcignZG93bmNhc3QnKS5lbGVtZW50VG9FbGVtZW50KGRlZmluaXRpb24pO1xuICAgICAgICAvLyBTZXQgdXAgdXBjYXN0IGNvbnZlcnRlci5cbiAgICAgICAgZm9yIChjb25zdCB7IG1vZGVsLCB2aWV3IH0gb2YgX2dldEFsbFVwY2FzdERlZmluaXRpb25zKGRlZmluaXRpb24pKXtcbiAgICAgICAgICAgIHRoaXMuZm9yKCd1cGNhc3QnKS5lbGVtZW50VG9FbGVtZW50KHtcbiAgICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgICAgIGNvbnZlcnRlclByaW9yaXR5OiBkZWZpbml0aW9uLmNvbnZlcnRlclByaW9yaXR5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB1cCBjb252ZXJ0ZXJzIGJldHdlZW4gdGhlIG1vZGVsIGFuZCB0aGUgdmlldyB0aGF0IGNvbnZlcnQgYSBtb2RlbCBhdHRyaWJ1dGUgdG8gYSB2aWV3IGVsZW1lbnQgKGFuZCB2aWNlIHZlcnNhKS5cblx0ICogRm9yIGV4YW1wbGUsIGEgbW9kZWwgdGV4dCBub2RlIHdpdGggYFwiRm9vXCJgIGFzIGRhdGEgYW5kIHRoZSBgYm9sZGAgYXR0cmlidXRlIHdpbGwgYmUgdHVybmVkIHRvIGA8c3Ryb25nPkZvbzwvc3Ryb25nPmAgaW4gdGhlIHZpZXcuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEEgc2ltcGxlIGNvbnZlcnNpb24gZnJvbSB0aGUgYGJvbGQ9dHJ1ZWAgYXR0cmlidXRlIHRvIHRoZSBgPHN0cm9uZz5gIHZpZXcgZWxlbWVudCAoYW5kIHZpY2UgdmVyc2EpLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0VsZW1lbnQoIHsgbW9kZWw6ICdib2xkJywgdmlldzogJ3N0cm9uZycgfSApO1xuXHQgKlxuXHQgKiAvLyBPdmVycmlkZSBvdGhlciBjb252ZXJ0ZXJzIGJ5IHNwZWNpZnlpbmcgYSBjb252ZXJ0ZXIgZGVmaW5pdGlvbiB3aXRoIGEgaGlnaGVyIHByaW9yaXR5LlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0VsZW1lbnQoIHsgbW9kZWw6ICdib2xkJywgdmlldzogJ2InLCBjb252ZXJ0ZXJQcmlvcml0eTogJ2hpZ2gnIH0gKTtcblx0ICpcblx0ICogLy8gVmlldyBzcGVjaWZpZWQgYXMgYW4gb2JqZWN0IGluc3RlYWQgb2YgYSBzdHJpbmcuXG5cdCAqIGVkaXRvci5jb252ZXJzaW9uLmF0dHJpYnV0ZVRvRWxlbWVudCgge1xuXHQgKiBcdG1vZGVsOiAnYm9sZCcsXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0Y2xhc3NlczogJ2JvbGQnXG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqXG5cdCAqIC8vIFVzZSBgY29uZmlnLm1vZGVsLm5hbWVgIHRvIGRlZmluZSB0aGUgY29udmVyc2lvbiBvbmx5IGZyb20gYSBnaXZlbiBub2RlIHR5cGUsIGAkdGV4dGAgaW4gdGhpcyBjYXNlLlxuXHQgKiAvLyBUaGUgc2FtZSBhdHRyaWJ1dGUgb24gZGlmZmVyZW50IGVsZW1lbnRzIG1heSB0aGVuIGJlIGhhbmRsZWQgYnkgYSBkaWZmZXJlbnQgY29udmVydGVyLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDoge1xuXHQgKiBcdFx0a2V5OiAndGV4dERlY29yYXRpb24nLFxuXHQgKiBcdFx0dmFsdWVzOiBbICd1bmRlcmxpbmUnLCAnbGluZVRocm91Z2gnIF0sXG5cdCAqIFx0XHRuYW1lOiAnJHRleHQnXG5cdCAqIFx0fSxcblx0ICogXHR2aWV3OiB7XG5cdCAqIFx0XHR1bmRlcmxpbmU6IHtcblx0ICogXHRcdFx0bmFtZTogJ3NwYW4nLFxuXHQgKiBcdFx0XHRzdHlsZXM6IHtcblx0ICogXHRcdFx0XHQndGV4dC1kZWNvcmF0aW9uJzogJ3VuZGVybGluZSdcblx0ICogXHRcdFx0fVxuXHQgKiBcdFx0fSxcblx0ICogXHRcdGxpbmVUaHJvdWdoOiB7XG5cdCAqIFx0XHRcdG5hbWU6ICdzcGFuJyxcblx0ICogXHRcdFx0c3R5bGVzOiB7XG5cdCAqIFx0XHRcdFx0J3RleHQtZGVjb3JhdGlvbic6ICdsaW5lLXRocm91Z2gnXG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH1cblx0ICogXHR9XG5cdCAqIH0gKTtcblx0ICpcblx0ICogLy8gVXNlIGB1cGNhc3RBbHNvYCB0byBkZWZpbmUgb3RoZXIgdmlldyBlbGVtZW50cyB0aGF0IHNob3VsZCBhbHNvIGJlIGNvbnZlcnRlZCB0byB0aGUgYGJvbGRgIGF0dHJpYnV0ZS5cblx0ICogZWRpdG9yLmNvbnZlcnNpb24uYXR0cmlidXRlVG9FbGVtZW50KCB7XG5cdCAqIFx0bW9kZWw6ICdib2xkJyxcblx0ICogXHR2aWV3OiAnc3Ryb25nJyxcblx0ICogXHR1cGNhc3RBbHNvOiBbXG5cdCAqIFx0XHQnYicsXG5cdCAqIFx0XHR7XG5cdCAqIFx0XHRcdG5hbWU6ICdzcGFuJyxcblx0ICogXHRcdFx0Y2xhc3NlczogJ2JvbGQnXG5cdCAqIFx0XHR9LFxuXHQgKiBcdFx0e1xuXHQgKiBcdFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRcdHN0eWxlczoge1xuXHQgKiBcdFx0XHRcdCdmb250LXdlaWdodCc6ICdib2xkJ1xuXHQgKiBcdFx0XHR9XG5cdCAqIFx0XHR9LFxuXHQgKiBcdFx0dmlld0VsZW1lbnQgPT4ge1xuXHQgKiBcdFx0XHRjb25zdCBmb250V2VpZ2h0ID0gdmlld0VsZW1lbnQuZ2V0U3R5bGUoICdmb250LXdlaWdodCcgKTtcblx0ICpcblx0ICogXHRcdFx0aWYgKCB2aWV3RWxlbWVudC5pcyggJ2VsZW1lbnQnLCAnc3BhbicgKSAmJiBmb250V2VpZ2h0ICYmIC9cXGQrLy50ZXN0KCkgJiYgTnVtYmVyKCBmb250V2VpZ2h0ICkgPiA1MDAgKSB7XG5cdCAqIFx0XHRcdFx0Ly8gUmV0dXJuZWQgdmFsdWUgY2FuIGJlIGFuIG9iamVjdCB3aXRoIHRoZSBtYXRjaGVkIHByb3BlcnRpZXMuXG5cdCAqIFx0XHRcdFx0Ly8gVGhlc2UgcHJvcGVydGllcyB3aWxsIGJlIFwiY29uc3VtZWRcIiBkdXJpbmcgdGhlIGNvbnZlcnNpb24uXG5cdCAqIFx0XHRcdFx0Ly8gU2VlIGBlbmdpbmUudmlldy5NYXRjaGVyfk1hdGNoZXJQYXR0ZXJuYCBhbmQgYGVuZ2luZS52aWV3Lk1hdGNoZXIjbWF0Y2hgIGZvciBtb3JlIGRldGFpbHMuXG5cdCAqXG5cdCAqIFx0XHRcdFx0cmV0dXJuIHtcblx0ICogXHRcdFx0XHRcdG5hbWU6IHRydWUsXG5cdCAqIFx0XHRcdFx0XHRzdHlsZXM6IFsgJ2ZvbnQtd2VpZ2h0JyBdXG5cdCAqIFx0XHRcdFx0fTtcblx0ICogXHRcdFx0fVxuXHQgKiBcdFx0fVxuXHQgKiBcdF1cblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBDb252ZXJzaW9uIGZyb20gYW5kIHRvIGEgbW9kZWwgYXR0cmlidXRlIGtleSB3aG9zZSB2YWx1ZSBpcyBhbiBlbnVtIChgZm9udFNpemU9YmlnfHNtYWxsYCkuXG5cdCAqIC8vIGB1cGNhc3RBbHNvYCBzZXQgYXMgY2FsbGJhY2sgZW5hYmxlcyBhIGNvbnZlcnNpb24gb2YgYSB3aWRlIHJhbmdlIG9mIGRpZmZlcmVudCB2aWV3IGVsZW1lbnRzLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0VsZW1lbnQoIHtcblx0ICogXHRtb2RlbDoge1xuXHQgKiBcdFx0a2V5OiAnZm9udFNpemUnLFxuXHQgKiBcdFx0dmFsdWVzOiBbICdiaWcnLCAnc21hbGwnIF1cblx0ICogXHR9LFxuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdGJpZzoge1xuXHQgKiBcdFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRcdHN0eWxlczoge1xuXHQgKiBcdFx0XHRcdCdmb250LXNpemUnOiAnMS4yZW0nXG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH0sXG5cdCAqIFx0XHRzbWFsbDoge1xuXHQgKiBcdFx0XHRuYW1lOiAnc3BhbicsXG5cdCAqIFx0XHRcdHN0eWxlczoge1xuXHQgKiBcdFx0XHRcdCdmb250LXNpemUnOiAnMC44ZW0nXG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH1cblx0ICogXHR9LFxuXHQgKiBcdHVwY2FzdEFsc286IHtcblx0ICogXHRcdGJpZzogdmlld0VsZW1lbnQgPT4ge1xuXHQgKiBcdFx0XHRjb25zdCBmb250U2l6ZSA9IHZpZXdFbGVtZW50LmdldFN0eWxlKCAnZm9udC1zaXplJyApO1xuXHQgKlxuXHQgKiBcdFx0XHRpZiAoICFmb250U2l6ZSApIHtcblx0ICogXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0ICogXHRcdFx0fVxuXHQgKlxuXHQgKiBcdFx0XHRjb25zdCBtYXRjaCA9IGZvbnRTaXplLm1hdGNoKCAvKFxcZCspXFxzKnB4LyApO1xuXHQgKlxuXHQgKiBcdFx0XHRpZiAoICFtYXRjaCApIHtcblx0ICogXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0ICogXHRcdFx0fVxuXHQgKlxuXHQgKiBcdFx0XHRjb25zdCBzaXplID0gTnVtYmVyKCBtYXRjaFsgMSBdICk7XG5cdCAqXG5cdCAqIFx0XHRcdGlmICggdmlld0VsZW1lbnQuaXMoICdlbGVtZW50JywgJ3NwYW4nICkgJiYgc2l6ZSA+IDEwICkge1xuXHQgKiBcdFx0XHRcdC8vIFJldHVybmVkIHZhbHVlIGNhbiBiZSBhbiBvYmplY3Qgd2l0aCB0aGUgbWF0Y2hlZCBwcm9wZXJ0aWVzLlxuXHQgKiBcdFx0XHRcdC8vIFRoZXNlIHByb3BlcnRpZXMgd2lsbCBiZSBcImNvbnN1bWVkXCIgZHVyaW5nIHRoZSBjb252ZXJzaW9uLlxuXHQgKiBcdFx0XHRcdC8vIFNlZSBgZW5naW5lLnZpZXcuTWF0Y2hlcn5NYXRjaGVyUGF0dGVybmAgYW5kIGBlbmdpbmUudmlldy5NYXRjaGVyI21hdGNoYCBmb3IgbW9yZSBkZXRhaWxzLlxuXHQgKlxuXHQgKiBcdFx0XHRcdHJldHVybiB7IG5hbWU6IHRydWUsIHN0eWxlczogWyAnZm9udC1zaXplJyBdIH07XG5cdCAqIFx0XHRcdH1cblx0ICpcblx0ICogXHRcdFx0cmV0dXJuIG51bGw7XG5cdCAqIFx0XHR9LFxuXHQgKiBcdFx0c21hbGw6IHZpZXdFbGVtZW50ID0+IHtcblx0ICogXHRcdFx0Y29uc3QgZm9udFNpemUgPSB2aWV3RWxlbWVudC5nZXRTdHlsZSggJ2ZvbnQtc2l6ZScgKTtcblx0ICpcblx0ICogXHRcdFx0aWYgKCAhZm9udFNpemUgKSB7XG5cdCAqIFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdCAqIFx0XHRcdH1cblx0ICpcblx0ICogXHRcdFx0Y29uc3QgbWF0Y2ggPSBmb250U2l6ZS5tYXRjaCggLyhcXGQrKVxccypweC8gKTtcblx0ICpcblx0ICogXHRcdFx0aWYgKCAhbWF0Y2ggKSB7XG5cdCAqIFx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdCAqIFx0XHRcdH1cblx0ICpcblx0ICogXHRcdFx0Y29uc3Qgc2l6ZSA9IE51bWJlciggbWF0Y2hbIDEgXSApO1xuXHQgKlxuXHQgKiBcdFx0XHRpZiAoIHZpZXdFbGVtZW50LmlzKCAnZWxlbWVudCcsICdzcGFuJyApICYmIHNpemUgPCAxMCApIHtcblx0ICogXHRcdFx0XHQvLyBSZXR1cm5lZCB2YWx1ZSBjYW4gYmUgYW4gb2JqZWN0IHdpdGggdGhlIG1hdGNoZWQgcHJvcGVydGllcy5cblx0ICogXHRcdFx0XHQvLyBUaGVzZSBwcm9wZXJ0aWVzIHdpbGwgYmUgXCJjb25zdW1lZFwiIGR1cmluZyB0aGUgY29udmVyc2lvbi5cblx0ICogXHRcdFx0XHQvLyBTZWUgYGVuZ2luZS52aWV3Lk1hdGNoZXJ+TWF0Y2hlclBhdHRlcm5gIGFuZCBgZW5naW5lLnZpZXcuTWF0Y2hlciNtYXRjaGAgZm9yIG1vcmUgZGV0YWlscy5cblx0ICpcblx0ICogXHRcdFx0XHRyZXR1cm4geyBuYW1lOiB0cnVlLCBzdHlsZXM6IFsgJ2ZvbnQtc2l6ZScgXSB9O1xuXHQgKiBcdFx0XHR9XG5cdCAqXG5cdCAqIFx0XHRcdHJldHVybiBudWxsO1xuXHQgKiBcdFx0fVxuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogVGhlIGBkZWZpbml0aW9uLm1vZGVsYCBwYXJhbWV0ZXIgc3BlY2lmaWVzIHdoaWNoIG1vZGVsIGF0dHJpYnV0ZSBzaG91bGQgYmUgY29udmVydGVkIGZyb20gb3IgdG8uIEl0IGNhbiBiZSBhIGB7IGtleSwgdmFsdWUgfWAgb2JqZWN0XG5cdCAqIGRlc2NyaWJpbmcgdGhlIGF0dHJpYnV0ZSBrZXkgYW5kIHZhbHVlIHRvIGNvbnZlcnQgb3IgYSBgU3RyaW5nYCBzcGVjaWZ5aW5nIGp1c3QgdGhlIGF0dHJpYnV0ZSBrZXkgKGluIHN1Y2ggYSBjYXNlXG5cdCAqIGB2YWx1ZWAgaXMgc2V0IHRvIGB0cnVlYCkuXG5cdCAqXG5cdCAqIEBwYXJhbSBkZWZpbml0aW9uIFRoZSBjb252ZXJ0ZXIgZGVmaW5pdGlvbi5cblx0ICovIGF0dHJpYnV0ZVRvRWxlbWVudChkZWZpbml0aW9uKSB7XG4gICAgICAgIC8vIFNldCB1cCBkb3duY2FzdCBjb252ZXJ0ZXIuXG4gICAgICAgIHRoaXMuZm9yKCdkb3duY2FzdCcpLmF0dHJpYnV0ZVRvRWxlbWVudChkZWZpbml0aW9uKTtcbiAgICAgICAgLy8gU2V0IHVwIHVwY2FzdCBjb252ZXJ0ZXIuXG4gICAgICAgIGZvciAoY29uc3QgeyBtb2RlbCwgdmlldyB9IG9mIF9nZXRBbGxVcGNhc3REZWZpbml0aW9ucyhkZWZpbml0aW9uKSl7XG4gICAgICAgICAgICB0aGlzLmZvcigndXBjYXN0JykuZWxlbWVudFRvQXR0cmlidXRlKHtcbiAgICAgICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgICAgIGNvbnZlcnRlclByaW9yaXR5OiBkZWZpbml0aW9uLmNvbnZlcnRlclByaW9yaXR5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB1cCBjb252ZXJ0ZXJzIGJldHdlZW4gdGhlIG1vZGVsIGFuZCB0aGUgdmlldyB0aGF0IGNvbnZlcnQgYSBtb2RlbCBhdHRyaWJ1dGUgdG8gYSB2aWV3IGF0dHJpYnV0ZSAoYW5kIHZpY2UgdmVyc2EpLiBGb3IgZXhhbXBsZSxcblx0ICogYDxpbWFnZUJsb2NrIHNyYz0nZm9vLmpwZyc+PC9pbWFnZUJsb2NrPmAgaXMgY29udmVydGVkIHRvIGA8aW1nIHNyYz0nZm9vLmpwZyc+PC9pbWc+YCAodGhlIHNhbWUgYXR0cmlidXRlIGtleSBhbmQgdmFsdWUpLlxuXHQgKiBUaGlzIHR5cGUgb2YgY29udmVydGVycyBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIHdpdGgge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IG1vZGVsIGVsZW1lbnR9IG5vZGVzLlxuXHQgKiBUbyBjb252ZXJ0IHRoZSB0ZXh0IGF0dHJpYnV0ZXMsXG5cdCAqIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2NvbnZlcnNpb25+Q29udmVyc2lvbiNhdHRyaWJ1dGVUb0VsZW1lbnQgYGF0dHJpYnV0ZVRvRWxlbWVudCBjb252ZXJ0ZXJgfXNob3VsZCBiZSBzZXQgdXAuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEEgc2ltcGxlIGNvbnZlcnNpb24gZnJvbSB0aGUgYHNvdXJjZWAgbW9kZWwgYXR0cmlidXRlIHRvIHRoZSBgc3JjYCB2aWV3IGF0dHJpYnV0ZSAoYW5kIHZpY2UgdmVyc2EpLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSggeyBtb2RlbDogJ3NvdXJjZScsIHZpZXc6ICdzcmMnIH0gKTtcblx0ICpcblx0ICogLy8gQXR0cmlidXRlIHZhbHVlcyBhcmUgc3RyaWN0bHkgc3BlY2lmaWVkLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRuYW1lOiAnaW1hZ2VJbmxpbmUnLFxuXHQgKiBcdFx0a2V5OiAnYXNpZGUnLFxuXHQgKiBcdFx0dmFsdWVzOiBbICdhc2lkZScgXVxuXHQgKiBcdH0sXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0YXNpZGU6IHtcblx0ICogXHRcdFx0bmFtZTogJ2ltZycsXG5cdCAqIFx0XHRcdGtleTogJ2NsYXNzJyxcblx0ICogXHRcdFx0dmFsdWU6IFsgJ2FzaWRlJywgJ2hhbGYtc2l6ZScgXVxuXHQgKiBcdFx0fVxuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBTZXQgdGhlIHN0eWxlIGF0dHJpYnV0ZS5cblx0ICogZWRpdG9yLmNvbnZlcnNpb24uYXR0cmlidXRlVG9BdHRyaWJ1dGUoIHtcblx0ICogXHRtb2RlbDoge1xuXHQgKiBcdFx0bmFtZTogJ2ltYWdlSW5saW5lJyxcblx0ICogXHRcdGtleTogJ2FzaWRlJyxcblx0ICogXHRcdHZhbHVlczogWyAnYXNpZGUnIF1cblx0ICogXHR9LFxuXHQgKiBcdHZpZXc6IHtcblx0ICogXHRcdGFzaWRlOiB7XG5cdCAqIFx0XHRcdG5hbWU6ICdpbWcnLFxuXHQgKiBcdFx0XHRrZXk6ICdzdHlsZScsXG5cdCAqIFx0XHRcdHZhbHVlOiB7XG5cdCAqIFx0XHRcdFx0ZmxvYXQ6ICdyaWdodCcsXG5cdCAqIFx0XHRcdFx0d2lkdGg6ICc1MCUnLFxuXHQgKiBcdFx0XHRcdG1hcmdpbjogJzVweCdcblx0ICogXHRcdFx0fVxuXHQgKiBcdFx0fVxuXHQgKiBcdH1cblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBDb252ZXJzaW9uIGZyb20gYW5kIHRvIGEgbW9kZWwgYXR0cmlidXRlIGtleSB3aG9zZSB2YWx1ZSBpcyBhbiBlbnVtIChgYWxpZ249cmlnaHR8Y2VudGVyYCkuXG5cdCAqIC8vIFVzZSBgdXBjYXN0QWxzb2AgdG8gZGVmaW5lIG90aGVyIHZpZXcgZWxlbWVudHMgdGhhdCBzaG91bGQgYWxzbyBiZSBjb252ZXJ0ZWQgdG8gdGhlIGBhbGlnbj1yaWdodGAgYXR0cmlidXRlLlxuXHQgKiBlZGl0b3IuY29udmVyc2lvbi5hdHRyaWJ1dGVUb0F0dHJpYnV0ZSgge1xuXHQgKiBcdG1vZGVsOiB7XG5cdCAqIFx0XHRrZXk6ICdhbGlnbicsXG5cdCAqIFx0XHR2YWx1ZXM6IFsgJ3JpZ2h0JywgJ2NlbnRlcicgXVxuXHQgKiBcdH0sXG5cdCAqIFx0dmlldzoge1xuXHQgKiBcdFx0cmlnaHQ6IHtcblx0ICogXHRcdFx0a2V5OiAnY2xhc3MnLFxuXHQgKiBcdFx0XHR2YWx1ZTogJ2FsaWduLXJpZ2h0J1xuXHQgKiBcdFx0fSxcblx0ICogXHRcdGNlbnRlcjoge1xuXHQgKiBcdFx0XHRrZXk6ICdjbGFzcycsXG5cdCAqIFx0XHRcdHZhbHVlOiAnYWxpZ24tY2VudGVyJ1xuXHQgKiBcdFx0fVxuXHQgKiBcdH0sXG5cdCAqIFx0dXBjYXN0QWxzbzoge1xuXHQgKiBcdFx0cmlnaHQ6IHtcblx0ICogXHRcdFx0c3R5bGVzOiB7XG5cdCAqIFx0XHRcdFx0J3RleHQtYWxpZ24nOiAncmlnaHQnXG5cdCAqIFx0XHRcdH1cblx0ICogXHRcdH0sXG5cdCAqIFx0XHRjZW50ZXI6IHtcblx0ICogXHRcdFx0c3R5bGVzOiB7XG5cdCAqIFx0XHRcdFx0J3RleHQtYWxpZ24nOiAnY2VudGVyJ1xuXHQgKiBcdFx0XHR9XG5cdCAqIFx0XHR9XG5cdCAqIFx0fVxuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGUgYGRlZmluaXRpb24ubW9kZWxgIHBhcmFtZXRlciBzcGVjaWZpZXMgd2hpY2ggbW9kZWwgYXR0cmlidXRlIHNob3VsZCBiZSBjb252ZXJ0ZWQgZnJvbSBhbmQgdG8uXG5cdCAqIEl0IGNhbiBiZSBhIGB7IGtleSwgWyB2YWx1ZXMgXSwgWyBuYW1lIF0gfWAgb2JqZWN0IG9yIGEgYFN0cmluZ2AsIHdoaWNoIHdpbGwgYmUgdHJlYXRlZCBsaWtlIGB7IGtleTogZGVmaW5pdGlvbi5tb2RlbCB9YC5cblx0ICogVGhlIGBrZXlgIHByb3BlcnR5IGlzIHRoZSBtb2RlbCBhdHRyaWJ1dGUga2V5IHRvIGNvbnZlcnQgZnJvbSBhbmQgdG8uXG5cdCAqIFRoZSBgdmFsdWVzYCBhcmUgdGhlIHBvc3NpYmxlIG1vZGVsIGF0dHJpYnV0ZSB2YWx1ZXMuIElmIHRoZSBgdmFsdWVzYCBwYXJhbWV0ZXIgaXMgbm90IHNldCwgdGhlIG1vZGVsIGF0dHJpYnV0ZSB2YWx1ZVxuXHQgKiB3aWxsIGJlIHRoZSBzYW1lIGFzIHRoZSB2aWV3IGF0dHJpYnV0ZSB2YWx1ZS5cblx0ICogSWYgYG5hbWVgIGlzIHNldCwgdGhlIGNvbnZlcnNpb24gd2lsbCBiZSBzZXQgdXAgb25seSBmb3IgbW9kZWwgZWxlbWVudHMgd2l0aCB0aGUgZ2l2ZW4gbmFtZS5cblx0ICpcblx0ICogVGhlIGBkZWZpbml0aW9uLnZpZXdgIHBhcmFtZXRlciBzcGVjaWZpZXMgd2hpY2ggdmlldyBhdHRyaWJ1dGUgc2hvdWxkIGJlIGNvbnZlcnRlZCBmcm9tIGFuZCB0by5cblx0ICogSXQgY2FuIGJlIGEgYHsga2V5LCB2YWx1ZSwgWyBuYW1lIF0gfWAgb2JqZWN0IG9yIGEgYFN0cmluZ2AsIHdoaWNoIHdpbGwgYmUgdHJlYXRlZCBsaWtlIGB7IGtleTogZGVmaW5pdGlvbi52aWV3IH1gLlxuXHQgKiBUaGUgYGtleWAgcHJvcGVydHkgaXMgdGhlIHZpZXcgYXR0cmlidXRlIGtleSB0byBjb252ZXJ0IGZyb20gYW5kIHRvLlxuXHQgKiBUaGUgYHZhbHVlYCBpcyB0aGUgdmlldyBhdHRyaWJ1dGUgdmFsdWUgdG8gY29udmVydCBmcm9tIGFuZCB0by4gSWYgYGRlZmluaXRpb24udmFsdWVgIGlzIG5vdCBzZXQsIHRoZSB2aWV3IGF0dHJpYnV0ZSB2YWx1ZSB3aWxsIGJlXG5cdCAqIHRoZSBzYW1lIGFzIHRoZSBtb2RlbCBhdHRyaWJ1dGUgdmFsdWUuXG5cdCAqIElmIGBrZXlgIGlzIGAnY2xhc3MnYCwgYHZhbHVlYCBjYW4gYmUgYSBgU3RyaW5nYCBvciBhbiBhcnJheSBvZiBgU3RyaW5nYHMuXG5cdCAqIElmIGBrZXlgIGlzIGAnc3R5bGUnYCwgYHZhbHVlYCBpcyBhbiBvYmplY3Qgd2l0aCBrZXktdmFsdWUgcGFpcnMuXG5cdCAqIEluIG90aGVyIGNhc2VzLCBgdmFsdWVgIGlzIGEgYFN0cmluZ2AuXG5cdCAqIElmIGBuYW1lYCBpcyBzZXQsIHRoZSBjb252ZXJzaW9uIHdpbGwgYmUgc2V0IHVwIG9ubHkgZm9yIG1vZGVsIGVsZW1lbnRzIHdpdGggdGhlIGdpdmVuIG5hbWUuXG5cdCAqIElmIGBkZWZpbml0aW9uLm1vZGVsLnZhbHVlc2AgaXMgc2V0LCBgZGVmaW5pdGlvbi52aWV3YCBpcyBhbiBvYmplY3QgdGhhdCBhc3NpZ25zIHZhbHVlcyBmcm9tIGBkZWZpbml0aW9uLm1vZGVsLnZhbHVlc2Bcblx0ICogdG8gYHsga2V5LCB2YWx1ZSwgWyBuYW1lIF0gfWAgb2JqZWN0cy5cblx0ICpcblx0ICogYGRlZmluaXRpb24udXBjYXN0QWxzb2Agc3BlY2lmaWVzIHdoaWNoIG90aGVyIG1hdGNoaW5nIHZpZXcgZWxlbWVudHMgc2hvdWxkIGFsc28gYmUgdXBjYXN0IHRvIHRoZSBnaXZlbiBtb2RlbCBjb25maWd1cmF0aW9uLlxuXHQgKiBJZiBgZGVmaW5pdGlvbi5tb2RlbC52YWx1ZXNgIGlzIHNldCwgYGRlZmluaXRpb24udXBjYXN0QWxzb2Agc2hvdWxkIGJlIGFuIG9iamVjdCBhc3NpZ25pbmcgdmFsdWVzIGZyb20gYGRlZmluaXRpb24ubW9kZWwudmFsdWVzYFxuXHQgKiB0byB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlclBhdHRlcm59cyBvciBhcnJheXMgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9tYXRjaGVyfk1hdGNoZXJQYXR0ZXJufXMuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBgZGVmaW5pdGlvbi5tb2RlbGAgYW5kIGBkZWZpbml0aW9uLnZpZXdgIGZvcm0gc2hvdWxkIGJlIG1pcnJvcmVkLCBzbyB0aGUgc2FtZSB0eXBlcyBvZiBwYXJhbWV0ZXJzIHNob3VsZFxuXHQgKiBiZSBnaXZlbiBpbiBib3RoIHBhcmFtZXRlcnMuXG5cdCAqXG5cdCAqIEBwYXJhbSBkZWZpbml0aW9uIFRoZSBjb252ZXJ0ZXIgZGVmaW5pdGlvbi5cblx0ICogQHBhcmFtIGRlZmluaXRpb24ubW9kZWwgVGhlIG1vZGVsIGF0dHJpYnV0ZSB0byBjb252ZXJ0IGZyb20gYW5kIHRvLlxuXHQgKiBAcGFyYW0gZGVmaW5pdGlvbi52aWV3IFRoZSB2aWV3IGF0dHJpYnV0ZSB0byBjb252ZXJ0IGZyb20gYW5kIHRvLlxuXHQgKiBAcGFyYW0gZGVmaW5pdGlvbi51cGNhc3RBbHNvIEFueSB2aWV3IGVsZW1lbnQgbWF0Y2hpbmcgYGRlZmluaXRpb24udXBjYXN0QWxzb2Agd2lsbCBhbHNvIGJlIGNvbnZlcnRlZCB0byB0aGUgZ2l2ZW4gbW9kZWwgYXR0cmlidXRlLlxuXHQgKiBgZGVmaW5pdGlvbi51cGNhc3RBbHNvYCBpcyB1c2VkIG9ubHkgaWYgYGNvbmZpZy5tb2RlbC52YWx1ZXNgIGlzIHNwZWNpZmllZC5cblx0ICovIGF0dHJpYnV0ZVRvQXR0cmlidXRlKGRlZmluaXRpb24pIHtcbiAgICAgICAgLy8gU2V0IHVwIGRvd25jYXN0IGNvbnZlcnRlci5cbiAgICAgICAgdGhpcy5mb3IoJ2Rvd25jYXN0JykuYXR0cmlidXRlVG9BdHRyaWJ1dGUoZGVmaW5pdGlvbik7XG4gICAgICAgIC8vIFNldCB1cCB1cGNhc3QgY29udmVydGVyLlxuICAgICAgICBmb3IgKGNvbnN0IHsgbW9kZWwsIHZpZXcgfSBvZiBfZ2V0QWxsVXBjYXN0RGVmaW5pdGlvbnMoZGVmaW5pdGlvbikpe1xuICAgICAgICAgICAgdGhpcy5mb3IoJ3VwY2FzdCcpLmF0dHJpYnV0ZVRvQXR0cmlidXRlKHtcbiAgICAgICAgICAgICAgICB2aWV3LFxuICAgICAgICAgICAgICAgIG1vZGVsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbmQgY2FjaGVzIGNvbnZlcnNpb24gaGVscGVycyBmb3IgZ2l2ZW4gZGlzcGF0Y2hlcnMgZ3JvdXAuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zLm5hbWUgR3JvdXAgbmFtZS5cblx0ICovIF9jcmVhdGVDb252ZXJzaW9uSGVscGVycyh7IG5hbWUsIGRpc3BhdGNoZXJzLCBpc0Rvd25jYXN0IH0pIHtcbiAgICAgICAgaWYgKHRoaXMuX2hlbHBlcnMuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRyeWluZyB0byByZWdpc3RlciBhIGdyb3VwIG5hbWUgdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHJlZ2lzdGVyZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGNvbnZlcnNpb24tZ3JvdXAtZXhpc3RzXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2NvbnZlcnNpb24tZ3JvdXAtZXhpc3RzJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGVscGVycyA9IGlzRG93bmNhc3QgPyBuZXcgRG93bmNhc3RIZWxwZXJzKGRpc3BhdGNoZXJzKSA6IG5ldyBVcGNhc3RIZWxwZXJzKGRpc3BhdGNoZXJzKTtcbiAgICAgICAgdGhpcy5faGVscGVycy5zZXQobmFtZSwgaGVscGVycyk7XG4gICAgfVxufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgam9pbnQgYXJyYXkgb3V0IG9mIGFuIGl0ZW0gcGFzc2VkIGluIGBkZWZpbml0aW9uLnZpZXdgIGFuZCBpdGVtcyBwYXNzZWQgaW5cbiAqIGBkZWZpbml0aW9uLnVwY2FzdEFsc29gLlxuICovIGZ1bmN0aW9uKiBfZ2V0QWxsVXBjYXN0RGVmaW5pdGlvbnMoZGVmaW5pdGlvbikge1xuICAgIGlmIChkZWZpbml0aW9uLm1vZGVsLnZhbHVlcykge1xuICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGRlZmluaXRpb24ubW9kZWwudmFsdWVzKXtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsID0ge1xuICAgICAgICAgICAgICAgIGtleTogZGVmaW5pdGlvbi5tb2RlbC5rZXksXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCB2aWV3ID0gZGVmaW5pdGlvbi52aWV3W3ZhbHVlXTtcbiAgICAgICAgICAgIGNvbnN0IHVwY2FzdEFsc28gPSBkZWZpbml0aW9uLnVwY2FzdEFsc28gPyBkZWZpbml0aW9uLnVwY2FzdEFsc29bdmFsdWVdIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgeWllbGQqIF9nZXRVcGNhc3REZWZpbml0aW9uKG1vZGVsLCB2aWV3LCB1cGNhc3RBbHNvKTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHlpZWxkKiBfZ2V0VXBjYXN0RGVmaW5pdGlvbihkZWZpbml0aW9uLm1vZGVsLCBkZWZpbml0aW9uLnZpZXcsIGRlZmluaXRpb24udXBjYXN0QWxzbyk7XG4gICAgfVxufVxuZnVuY3Rpb24qIF9nZXRVcGNhc3REZWZpbml0aW9uKG1vZGVsLCB2aWV3LCB1cGNhc3RBbHNvKSB7XG4gICAgeWllbGQge1xuICAgICAgICBtb2RlbCxcbiAgICAgICAgdmlld1xuICAgIH07XG4gICAgaWYgKHVwY2FzdEFsc28pIHtcbiAgICAgICAgZm9yIChjb25zdCB1cGNhc3RBbHNvSXRlbSBvZiB0b0FycmF5KHVwY2FzdEFsc28pKXtcbiAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgICAgICB2aWV3OiB1cGNhc3RBbHNvSXRlbVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgWE1MIGRhdGEgcHJvY2Vzc29yIGNsYXNzLlxuICogVGhpcyBkYXRhIHByb2Nlc3NvciBpbXBsZW1lbnRhdGlvbiB1c2VzIFhNTCBhcyBpbnB1dCBhbmQgb3V0cHV0IGRhdGEuXG4gKiBUaGlzIGNsYXNzIGlzIG5lZWRlZCBiZWNhdXNlIHVubGlrZSBIVE1MLCBYTUwgYWxsb3dzIHRvIHVzZSBhbnkgdGFnIHdpdGggYW55IHZhbHVlLlxuICogRm9yIGV4YW1wbGUsIGA8bGluaz5UZXh0PC9saW5rPmAgaXMgYSB2YWxpZCBYTUwgYnV0IGludmFsaWQgSFRNTC5cbiAqLyBjbGFzcyBYbWxEYXRhUHJvY2Vzc29yIHtcbiAgICAvKipcblx0ICogQSBsaXN0IG9mIG5hbWVzcGFjZXMgYWxsb3dlZCB0byB1c2UgaW4gdGhlIFhNTCBpbnB1dC5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUsIHJlZ2lzdGVyaW5nIG5hbWVzcGFjZXMgWyAnYXR0cmlidXRlJywgJ2NvbnRhaW5lcicgXSBhbGxvd3MgdG8gdXNlIGA8YXR0aXJidXRlOnRhZ05hbWU+PC9hdHRyaWJ1dGU6dGFnTmFtZT5gXG5cdCAqIGFuZCBgPGNvbnRhaW5lcjp0YWdOYW1lPjwvY29udGFpbmVyOnRhZ05hbWU+YCBpbnB1dC4gSXQgaXMgbWFpbmx5IGZvciBkZWJ1Z2dpbmcuXG5cdCAqLyBuYW1lc3BhY2VzO1xuICAgIC8qKlxuXHQgKiBET00gcGFyc2VyIGluc3RhbmNlIHVzZWQgdG8gcGFyc2UgYW4gWE1MIHN0cmluZyB0byBhbiBYTUwgZG9jdW1lbnQuXG5cdCAqLyBkb21QYXJzZXI7XG4gICAgLyoqXG5cdCAqIERPTSBjb252ZXJ0ZXIgdXNlZCB0byBjb252ZXJ0IERPTSBlbGVtZW50cyB0byB2aWV3IGVsZW1lbnRzLlxuXHQgKi8gZG9tQ29udmVydGVyO1xuICAgIC8qKlxuXHQgKiBBIGJhc2ljIEhUTUwgd3JpdGVyIGluc3RhbmNlIHVzZWQgdG8gY29udmVydCBET00gZWxlbWVudHMgdG8gYW4gWE1MIHN0cmluZy5cblx0ICogVGhlcmUgaXMgbm8gbmVlZCB0byB1c2UgYSBkZWRpY2F0ZWQgWE1MIHdyaXRlciBiZWNhdXNlIHRoZSBiYXNpYyBIVE1MIHdyaXRlciB3b3JrcyB3ZWxsIGluIHRoaXMgY2FzZS5cblx0ICovIGh0bWxXcml0ZXI7XG4gICAgc2tpcENvbW1lbnRzID0gdHJ1ZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgWE1MIGRhdGEgcHJvY2Vzc29yIGNsYXNzLlxuXHQgKlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgVGhlIHZpZXcgZG9jdW1lbnQgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBvcHRpb25zIENvbmZpZ3VyYXRpb24gb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMubmFtZXNwYWNlcyBBIGxpc3Qgb2YgbmFtZXNwYWNlcyBhbGxvd2VkIHRvIHVzZSBpbiB0aGUgWE1MIGlucHV0LlxuXHQgKi8gY29uc3RydWN0b3IoZG9jdW1lbnQsIG9wdGlvbnMgPSB7fSl7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlcyA9IG9wdGlvbnMubmFtZXNwYWNlcyB8fCBbXTtcbiAgICAgICAgdGhpcy5kb21QYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyID0gbmV3IERvbUNvbnZlcnRlcihkb2N1bWVudCwge1xuICAgICAgICAgICAgcmVuZGVyaW5nTW9kZTogJ2RhdGEnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmh0bWxXcml0ZXIgPSBuZXcgQmFzaWNIdG1sV3JpdGVyKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyB0aGUgcHJvdmlkZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgZG9jdW1lbnQgZnJhZ21lbnR9XG5cdCAqIHRvIGRhdGEgZm9ybWF0ICZuZGFzaDsgaW4gdGhpcyBjYXNlIGFuIFhNTCBzdHJpbmcuXG5cdCAqXG5cdCAqIEByZXR1cm5zIEFuIFhNTCBzdHJpbmcuXG5cdCAqLyB0b0RhdGEodmlld0ZyYWdtZW50KSB7XG4gICAgICAgIC8vIENvbnZlcnQgdmlldyBEb2N1bWVudEZyYWdtZW50IHRvIERPTSBEb2N1bWVudEZyYWdtZW50LlxuICAgICAgICBjb25zdCBkb21GcmFnbWVudCA9IHRoaXMuZG9tQ29udmVydGVyLnZpZXdUb0RvbSh2aWV3RnJhZ21lbnQpO1xuICAgICAgICAvLyBDb252ZXJ0IERPTSBEb2N1bWVudEZyYWdtZW50IHRvIFhNTCBvdXRwdXQuXG4gICAgICAgIC8vIFRoZXJlIGlzIG5vIG5lZWQgdG8gdXNlIGRlZGljYXRlZCBmb3IgWE1MIHNlcmlhbGl6aW5nIG1ldGhvZCBiZWNhdXNlIEJhc2ljSHRtbFdyaXRlciB3b3JrcyB3ZWxsIGluIHRoaXMgY2FzZS5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHRtbFdyaXRlci5nZXRIdG1sKGRvbUZyYWdtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHRoZSBwcm92aWRlZCBYTUwgc3RyaW5nIHRvIGEgdmlldyB0cmVlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBBbiBYTUwgc3RyaW5nLlxuXHQgKiBAcmV0dXJucyBBIGNvbnZlcnRlZCB2aWV3IGVsZW1lbnQuXG5cdCAqLyB0b1ZpZXcoZGF0YSkge1xuICAgICAgICAvLyBDb252ZXJ0IGlucHV0IFhNTCBkYXRhIHRvIERPTSBEb2N1bWVudEZyYWdtZW50LlxuICAgICAgICBjb25zdCBkb21GcmFnbWVudCA9IHRoaXMuX3RvRG9tKGRhdGEpO1xuICAgICAgICAvLyBDb252ZXJ0IERPTSBEb2N1bWVudEZyYWdtZW50IHRvIHZpZXcgRG9jdW1lbnRGcmFnbWVudC5cbiAgICAgICAgcmV0dXJuIHRoaXMuZG9tQ29udmVydGVyLmRvbVRvVmlldyhkb21GcmFnbWVudCwge1xuICAgICAgICAgICAga2VlcE9yaWdpbmFsQ2FzZTogdHJ1ZSxcbiAgICAgICAgICAgIHNraXBDb21tZW50czogdGhpcy5za2lwQ29tbWVudHNcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L21hdGNoZXJ+TWF0Y2hlclBhdHRlcm59IGZvciB2aWV3IGVsZW1lbnRzIHdob3NlIGNvbnRlbnQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMgcmF3IGRhdGFcblx0ICogYW5kIG5vdCBwcm9jZXNzZWQgZHVyaW5nIHRoZSBjb252ZXJzaW9uIGZyb20gWE1MIHRvIHZpZXcgZWxlbWVudHMuXG5cdCAqXG5cdCAqIFRoZSByYXcgZGF0YSBjYW4gYmUgbGF0ZXIgYWNjZXNzZWQgYnkgYVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNnZXRDdXN0b21Qcm9wZXJ0eSBjdXN0b20gcHJvcGVydHkgb2YgYSB2aWV3IGVsZW1lbnR9IGNhbGxlZCBgXCIkcmF3Q29udGVudFwiYC5cblx0ICpcblx0ICogQHBhcmFtIHBhdHRlcm4gUGF0dGVybiBtYXRjaGluZyBhbGwgdmlldyBlbGVtZW50cyB3aG9zZSBjb250ZW50IHNob3VsZCBiZSB0cmVhdGVkIGFzIHJhdyBkYXRhLlxuXHQgKi8gcmVnaXN0ZXJSYXdDb250ZW50TWF0Y2hlcihwYXR0ZXJuKSB7XG4gICAgICAgIHRoaXMuZG9tQ29udmVydGVyLnJlZ2lzdGVyUmF3Q29udGVudE1hdGNoZXIocGF0dGVybik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJZiB0aGUgcHJvY2Vzc29yIGlzIHNldCB0byB1c2UgbWFya2VkIGZpbGxlcnMsIGl0IHdpbGwgaW5zZXJ0IGAmbmJzcDtgIGZpbGxlcnMgd3JhcHBlZCBpbiBgPHNwYW4+YCBlbGVtZW50c1xuXHQgKiAoYDxzcGFuIGRhdGEtY2tlLWZpbGxlcj1cInRydWVcIj4mbmJzcDs8L3NwYW4+YCkgaW5zdGVhZCBvZiByZWd1bGFyIGAmbmJzcDtgIGNoYXJhY3RlcnMuXG5cdCAqXG5cdCAqIFRoaXMgbW9kZSBhbGxvd3MgZm9yIGEgbW9yZSBwcmVjaXNlIGhhbmRsaW5nIG9mIGJsb2NrIGZpbGxlcnMgKHNvIHRoZXkgZG8gbm90IGxlYWsgaW50byBlZGl0b3IgY29udGVudCkgYnV0XG5cdCAqIGJsb2F0cyB0aGUgZWRpdG9yIGRhdGEgd2l0aCBhZGRpdGlvbmFsIG1hcmt1cC5cblx0ICpcblx0ICogVGhpcyBtb2RlIG1heSBiZSByZXF1aXJlZCBieSBzb21lIGZlYXR1cmVzIGFuZCB3aWxsIGJlIHR1cm5lZCBvbiBieSB0aGVtIGF1dG9tYXRpY2FsbHkuXG5cdCAqXG5cdCAqIEBwYXJhbSB0eXBlIFdoZXRoZXIgdG8gdXNlIHRoZSBkZWZhdWx0IG9yIHRoZSBtYXJrZWQgYCZuYnNwO2AgYmxvY2sgZmlsbGVycy5cblx0ICovIHVzZUZpbGxlclR5cGUodHlwZSkge1xuICAgICAgICB0aGlzLmRvbUNvbnZlcnRlci5ibG9ja0ZpbGxlck1vZGUgPSB0eXBlID09ICdtYXJrZWQnID8gJ21hcmtlZE5ic3AnIDogJ25ic3AnO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgYW4gWE1MIHN0cmluZyB0byBpdHMgRE9NIHJlcHJlc2VudGF0aW9uLiBSZXR1cm5zIGEgZG9jdW1lbnQgZnJhZ21lbnQgY29udGFpbmluZyBub2RlcyBwYXJzZWQgZnJvbVxuXHQgKiB0aGUgcHJvdmlkZWQgZGF0YS5cblx0ICovIF90b0RvbShkYXRhKSB7XG4gICAgICAgIC8vIFN0cmluZ2lmeSBuYW1lc3BhY2VzLlxuICAgICAgICBjb25zdCBuYW1lc3BhY2VzID0gdGhpcy5uYW1lc3BhY2VzLm1hcCgobnNwKT0+YHhtbG5zOiR7bnNwfT1cIm5zcFwiYCkuam9pbignICcpO1xuICAgICAgICAvLyBXcmFwIGRhdGEgaW50byByb290IGVsZW1lbnQgd2l0aCBvcHRpb25hbCBuYW1lc3BhY2UgZGVmaW5pdGlvbnMuXG4gICAgICAgIGRhdGEgPSBgPHhtbCAke25hbWVzcGFjZXN9PiR7ZGF0YX08L3htbD5gO1xuICAgICAgICBjb25zdCBwYXJzZWREb2N1bWVudCA9IHRoaXMuZG9tUGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhLCAndGV4dC94bWwnKTtcbiAgICAgICAgLy8gUGFyc2UgdmFsaWRhdGlvbi5cbiAgICAgICAgY29uc3QgcGFyc2VyRXJyb3IgPSBwYXJzZWREb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwYXJzZXJlcnJvcicpO1xuICAgICAgICBpZiAocGFyc2VyRXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGFyc2UgZXJyb3IgLSAnICsgcGFyc2VyRXJyb3IudGV4dENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZyYWdtZW50ID0gcGFyc2VkRG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICBjb25zdCBub2RlcyA9IHBhcnNlZERvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzO1xuICAgICAgICB3aGlsZShub2Rlcy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGVzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnJhZ21lbnQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzICovIC8qKlxuICogQG1vZHVsZSBlbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvblxuICovIC8qKlxuICogQWJzdHJhY3QgYmFzZSBvcGVyYXRpb24gY2xhc3MuXG4gKi8gY2xhc3MgT3BlcmF0aW9uIHtcbiAgICAvKipcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uIGNhbiBiZSBhcHBsaWVkLiBJZiB5b3UgdHJ5IHRvXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2FwcGx5T3BlcmF0aW9uIGFwcGx5fSBvcGVyYXRpb24gd2l0aCBkaWZmZXJlbnQgYmFzZSB2ZXJzaW9uIHRoYW4gdGhlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb24gZG9jdW1lbnQgdmVyc2lvbn0gdGhlXG5cdCAqIHtAbGluayBtb2R1bGU6dXRpbHMvY2tlZGl0b3JlcnJvcn5DS0VkaXRvckVycm9yIG1vZGVsLWRvY3VtZW50LWFwcGx5T3BlcmF0aW9uLXdyb25nLXZlcnNpb259IGVycm9yIGlzIHRocm93bi5cblx0ICovIGJhc2VWZXJzaW9uO1xuICAgIC8qKlxuXHQgKiBEZWZpbmVzIHdoZXRoZXIgb3BlcmF0aW9uIGlzIGV4ZWN1dGVkIG9uIGF0dGFjaGVkIG9yIGRldGFjaGVkIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBpdGVtc30uXG5cdCAqLyBpc0RvY3VtZW50T3BlcmF0aW9uO1xuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9iYXRjaH5CYXRjaCBCYXRjaH0gdG8gd2hpY2ggdGhlIG9wZXJhdGlvbiBpcyBhZGRlZCBvciBgbnVsbGAgaWYgdGhlIG9wZXJhdGlvbiBpcyBub3Rcblx0ICogYWRkZWQgdG8gYW55IGJhdGNoIHlldC5cblx0ICpcblx0ICogTm90ZSwgdGhhdCBhIHtAbGluayAjaXNEb2N1bWVudE9wZXJhdGlvbiBub24tZG9jdW1lbnQgb3BlcmF0aW9ufSBoYXMgdGhpcyBwcm9wZXJ0eSBhbHdheXMgc2V0IHRvIGBudWxsYCwgYW5kIGlzIG5ldmVyIGFkZGVkXG5cdCAqIHRvIGFueSBiYXRjaC5cblx0ICovIGJhdGNoO1xuICAgIC8qKlxuXHQgKiBCYXNlIG9wZXJhdGlvbiBjb25zdHJ1Y3Rvci5cblx0ICpcblx0ICogQHBhcmFtIGJhc2VWZXJzaW9uIERvY3VtZW50IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb259IG9uIHdoaWNoIG9wZXJhdGlvblxuXHQgKiBjYW4gYmUgYXBwbGllZCBvciBgbnVsbGAgaWYgdGhlIG9wZXJhdGlvbiBvcGVyYXRlcyBvbiBkZXRhY2hlZCAobm9uLWRvY3VtZW50KSB0cmVlLlxuXHQgKi8gY29uc3RydWN0b3IoYmFzZVZlcnNpb24pe1xuICAgICAgICB0aGlzLmJhc2VWZXJzaW9uID0gYmFzZVZlcnNpb247XG4gICAgICAgIHRoaXMuaXNEb2N1bWVudE9wZXJhdGlvbiA9IHRoaXMuYmFzZVZlcnNpb24gIT09IG51bGw7XG4gICAgICAgIHRoaXMuYmF0Y2ggPSBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIG9wZXJhdGlvbidzIHBhcmFtZXRlcnMgYXJlIGNvcnJlY3QgYW5kIHRoZSBvcGVyYXRpb24gY2FuIGJlIGNvcnJlY3RseSBleGVjdXRlZC4gVGhyb3dzXG5cdCAqIGFuIGVycm9yIGlmIG9wZXJhdGlvbiBpcyBub3QgdmFsaWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3ZhbGlkYXRlKCkge31cbiAgICAvKipcblx0ICogQ3VzdG9tIHRvSlNPTiBtZXRob2QgdG8gc29sdmUgY2hpbGQtcGFyZW50IGNpcmN1bGFyIGRlcGVuZGVuY2llcy5cblx0ICpcblx0ICogQHJldHVybnMgQ2xvbmUgb2YgdGhpcyBvYmplY3Qgd2l0aCB0aGUgb3BlcmF0aW9uIHByb3BlcnR5IHJlcGxhY2VkIHdpdGggc3RyaW5nLlxuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICAvLyBUaGlzIG1ldGhvZCBjcmVhdGVzIG9ubHkgYSBzaGFsbG93IGNvcHksIGFsbCBuZXN0ZWQgb2JqZWN0cyBzaG91bGQgYmUgZGVmaW5lZCBzZXBhcmF0ZWx5LlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE0NzcuXG4gICAgICAgIGNvbnN0IGpzb24gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzKTtcbiAgICAgICAganNvbi5fX2NsYXNzTmFtZSA9IHRoaXMuY29uc3RydWN0b3IuY2xhc3NOYW1lO1xuICAgICAgICAvLyBSZW1vdmUgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgYEJhdGNoYCB0byBhdm9pZCBjaXJjdWxhciBkZXBlbmRlbmNpZXMuXG4gICAgICAgIGRlbGV0ZSBqc29uLmJhdGNoO1xuICAgICAgICAvLyBUaGlzIGNhbiBiZSBkZXJpdmVkIGZyb20gYGJhc2VWZXJzaW9uYCBzbyB3ZSBjYW4gcmVtb3ZlIGl0LlxuICAgICAgICBkZWxldGUganNvbi5pc0RvY3VtZW50T3BlcmF0aW9uO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE5hbWUgb2YgdGhlIG9wZXJhdGlvbiBjbGFzcyB1c2VkIGZvciBzZXJpYWxpemF0aW9uLlxuXHQgKi8gc3RhdGljIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiAnT3BlcmF0aW9uJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYE9wZXJhdGlvbmAgb2JqZWN0IGZyb20gZGVzZXJpYWxpemVkIG9iamVjdCwgaS5lLiBmcm9tIHBhcnNlZCBKU09OIHN0cmluZy5cblx0ICpcblx0ICogQHBhcmFtIGpzb24gRGVzZXJpYWxpemVkIEpTT04gb2JqZWN0LlxuXHQgKiBAcGFyYW0gZG9jIERvY3VtZW50IG9uIHdoaWNoIHRoaXMgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMoanNvbi5iYXNlVmVyc2lvbik7XG4gICAgfVxufVxuXG4vKipcbiAqIEluc2VydHMgZ2l2ZW4gbm9kZXMgYXQgZ2l2ZW4gcG9zaXRpb24uXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gYXQgd2hpY2ggbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkLlxuICogQHBhcmFtIG5vcm1hbGl6ZWROb2RlcyBOb2RlcyB0byBpbnNlcnQuXG4gKiBAcmV0dXJucyBSYW5nZSBzcGFubmluZyBvdmVyIGluc2VydGVkIGVsZW1lbnRzLlxuICovIGZ1bmN0aW9uIF9pbnNlcnQocG9zaXRpb24sIG5vZGVzKSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZE5vZGVzID0gX25vcm1hbGl6ZU5vZGVzKG5vZGVzKTtcbiAgICAvLyBXZSBoYXZlIHRvIGNvdW50IG9mZnNldCBiZWZvcmUgaW5zZXJ0aW5nIG5vZGVzIGJlY2F1c2UgdGhleSBjYW4gZ2V0IG1lcmdlZCBhbmQgd2Ugd291bGQgZ2V0IHdyb25nIG9mZnNldHMuXG4gICAgY29uc3Qgb2Zmc2V0ID0gbm9ybWFsaXplZE5vZGVzLnJlZHVjZSgoc3VtLCBub2RlKT0+c3VtICsgbm9kZS5vZmZzZXRTaXplLCAwKTtcbiAgICBjb25zdCBwYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgLy8gSW5zZXJ0aW9uIG1pZ2h0IGJlIGluIGEgdGV4dCBub2RlLCB3ZSBzaG91bGQgc3BsaXQgaXQgaWYgdGhhdCdzIHRoZSBjYXNlLlxuICAgIF9zcGxpdE5vZGVBdFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICBjb25zdCBpbmRleCA9IHBvc2l0aW9uLmluZGV4O1xuICAgIC8vIEluc2VydCBub2RlcyBhdCBnaXZlbiBpbmRleC4gQWZ0ZXIgc3BsaXR0aW5nIHdlIGhhdmUgYSBwcm9wZXIgaW5kZXggYW5kIGluc2VydGlvbiBpcyBiZXR3ZWVuIG5vZGVzLFxuICAgIC8vIHVzaW5nIGJhc2ljIGBFbGVtZW50YCBBUEkuXG4gICAgcGFyZW50Ll9pbnNlcnRDaGlsZChpbmRleCwgbm9ybWFsaXplZE5vZGVzKTtcbiAgICAvLyBNZXJnZSB0ZXh0IG5vZGVzLCBpZiBwb3NzaWJsZS4gTWVyZ2luZyBpcyBuZWVkZWQgb25seSBhdCBwb2ludHMgd2hlcmUgaW5zZXJ0ZWQgbm9kZXMgXCJ0b3VjaFwiIFwib2xkXCIgbm9kZXMuXG4gICAgX21lcmdlTm9kZXNBdEluZGV4KHBhcmVudCwgaW5kZXggKyBub3JtYWxpemVkTm9kZXMubGVuZ3RoKTtcbiAgICBfbWVyZ2VOb2Rlc0F0SW5kZXgocGFyZW50LCBpbmRleCk7XG4gICAgcmV0dXJuIG5ldyBSYW5nZShwb3NpdGlvbiwgcG9zaXRpb24uZ2V0U2hpZnRlZEJ5KG9mZnNldCkpO1xufVxuLyoqXG4gKiBSZW1vdmVkIG5vZGVzIGluIGdpdmVuIHJhbmdlLiBPbmx5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlI2lzRmxhdCBmbGF0fSByYW5nZXMgYXJlIGFjY2VwdGVkLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIHJhbmdlIFJhbmdlIGNvbnRhaW5pbmcgbm9kZXMgdG8gcmVtb3ZlLlxuICovIGZ1bmN0aW9uIF9yZW1vdmUocmFuZ2UpIHtcbiAgICBpZiAoIXJhbmdlLmlzRmxhdCkge1xuICAgICAgICAvKipcblx0XHQgKiBUcnlpbmcgdG8gcmVtb3ZlIGEgcmFuZ2Ugd2hpY2ggc3RhcnRzIGFuZCBlbmRzIGluIGRpZmZlcmVudCBlbGVtZW50LlxuXHRcdCAqXG5cdFx0ICogQGVycm9yIG9wZXJhdGlvbi11dGlscy1yZW1vdmUtcmFuZ2Utbm90LWZsYXRcblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29wZXJhdGlvbi11dGlscy1yZW1vdmUtcmFuZ2Utbm90LWZsYXQnLCB0aGlzKTtcbiAgICB9XG4gICAgY29uc3QgcGFyZW50ID0gcmFuZ2Uuc3RhcnQucGFyZW50O1xuICAgIC8vIFJhbmdlIG1heSBiZSBpbnNpZGUgdGV4dCBub2Rlcywgd2UgaGF2ZSB0byBzcGxpdCB0aGVtIGlmIHRoYXQncyB0aGUgY2FzZS5cbiAgICBfc3BsaXROb2RlQXRQb3NpdGlvbihyYW5nZS5zdGFydCk7XG4gICAgX3NwbGl0Tm9kZUF0UG9zaXRpb24ocmFuZ2UuZW5kKTtcbiAgICAvLyBSZW1vdmUgdGhlIHRleHQgbm9kZXMgdXNpbmcgYmFzaWMgYEVsZW1lbnRgIEFQSS5cbiAgICBjb25zdCByZW1vdmVkID0gcGFyZW50Ll9yZW1vdmVDaGlsZHJlbihyYW5nZS5zdGFydC5pbmRleCwgcmFuZ2UuZW5kLmluZGV4IC0gcmFuZ2Uuc3RhcnQuaW5kZXgpO1xuICAgIC8vIE1lcmdlIHRleHQgbm9kZXMsIGlmIHBvc3NpYmxlLiBBZnRlciBzb21lIG5vZGVzIHdlcmUgcmVtb3ZlZCwgbm9kZSBiZWZvcmUgYW5kIGFmdGVyIHJlbW92ZWQgcmFuZ2Ugd2lsbCBiZVxuICAgIC8vIHRvdWNoaW5nIGF0IHRoZSBwb3NpdGlvbiBlcXVhbCB0byB0aGUgcmVtb3ZlZCByYW5nZSBiZWdpbm5pbmcuIFdlIGNoZWNrIG1lcmdpbmcgcG9zc2liaWxpdHkgdGhlcmUuXG4gICAgX21lcmdlTm9kZXNBdEluZGV4KHBhcmVudCwgcmFuZ2Uuc3RhcnQuaW5kZXgpO1xuICAgIHJldHVybiByZW1vdmVkO1xufVxuLyoqXG4gKiBNb3ZlcyBub2RlcyBpbiBnaXZlbiByYW5nZSB0byBnaXZlbiB0YXJnZXQgcG9zaXRpb24uIE9ubHkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UjaXNGbGF0IGZsYXR9IHJhbmdlcyBhcmUgYWNjZXB0ZWQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gc291cmNlUmFuZ2UgUmFuZ2UgY29udGFpbmluZyBub2RlcyB0byBtb3ZlLlxuICogQHBhcmFtIHRhcmdldFBvc2l0aW9uIFBvc2l0aW9uIHRvIHdoaWNoIG5vZGVzIHNob3VsZCBiZSBtb3ZlZC5cbiAqIEByZXR1cm5zIFJhbmdlIGNvbnRhaW5pbmcgbW92ZWQgbm9kZXMuXG4gKi8gZnVuY3Rpb24gX21vdmUoc291cmNlUmFuZ2UsIHRhcmdldFBvc2l0aW9uKSB7XG4gICAgaWYgKCFzb3VyY2VSYW5nZS5pc0ZsYXQpIHtcbiAgICAgICAgLyoqXG5cdFx0ICogVHJ5aW5nIHRvIG1vdmUgYSByYW5nZSB3aGljaCBzdGFydHMgYW5kIGVuZHMgaW4gZGlmZmVyZW50IGVsZW1lbnQuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3Igb3BlcmF0aW9uLXV0aWxzLW1vdmUtcmFuZ2Utbm90LWZsYXRcblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ29wZXJhdGlvbi11dGlscy1tb3ZlLXJhbmdlLW5vdC1mbGF0JywgdGhpcyk7XG4gICAgfVxuICAgIGNvbnN0IG5vZGVzID0gX3JlbW92ZShzb3VyY2VSYW5nZSk7XG4gICAgLy8gV2UgaGF2ZSB0byBmaXggYHRhcmdldFBvc2l0aW9uYCBiZWNhdXNlIG1vZGVsIGNoYW5nZWQgYWZ0ZXIgbm9kZXMgZnJvbSBgc291cmNlUmFuZ2VgIGdvdCByZW1vdmVkIGFuZFxuICAgIC8vIHRoYXQgY2hhbmdlIG1pZ2h0IGhhdmUgYW4gaW1wYWN0IG9uIGB0YXJnZXRQb3NpdGlvbmAuXG4gICAgdGFyZ2V0UG9zaXRpb24gPSB0YXJnZXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKHNvdXJjZVJhbmdlLnN0YXJ0LCBzb3VyY2VSYW5nZS5lbmQub2Zmc2V0IC0gc291cmNlUmFuZ2Uuc3RhcnQub2Zmc2V0KTtcbiAgICByZXR1cm4gX2luc2VydCh0YXJnZXRQb3NpdGlvbiwgbm9kZXMpO1xufVxuLyoqXG4gKiBTZXRzIGdpdmVuIGF0dHJpYnV0ZSBvbiBub2RlcyBpbiBnaXZlbiByYW5nZS4gVGhlIGF0dHJpYnV0ZXMgYXJlIG9ubHkgc2V0IG9uIHRvcC1sZXZlbCBub2RlcyBvZiB0aGUgcmFuZ2UsIG5vdCBvbiBpdHMgY2hpbGRyZW4uXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gcmFuZ2UgUmFuZ2UgY29udGFpbmluZyBub2RlcyB0aGF0IHNob3VsZCBoYXZlIHRoZSBhdHRyaWJ1dGUgc2V0LiBNdXN0IGJlIGEgZmxhdCByYW5nZS5cbiAqIEBwYXJhbSBrZXkgS2V5IG9mIGF0dHJpYnV0ZSB0byBzZXQuXG4gKiBAcGFyYW0gdmFsdWUgQXR0cmlidXRlIHZhbHVlLlxuICovIGZ1bmN0aW9uIF9zZXRBdHRyaWJ1dGUocmFuZ2UsIGtleSwgdmFsdWUpIHtcbiAgICAvLyBSYW5nZSBtaWdodCBzdGFydCBvciBlbmQgaW4gdGV4dCBub2Rlcywgc28gd2UgaGF2ZSB0byBzcGxpdCB0aGVtLlxuICAgIF9zcGxpdE5vZGVBdFBvc2l0aW9uKHJhbmdlLnN0YXJ0KTtcbiAgICBfc3BsaXROb2RlQXRQb3NpdGlvbihyYW5nZS5lbmQpO1xuICAgIC8vIEl0ZXJhdGUgb3ZlciBhbGwgaXRlbXMgaW4gdGhlIHJhbmdlLlxuICAgIGZvciAoY29uc3QgaXRlbSBvZiByYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICB9KSl7XG4gICAgICAgIC8vIEl0ZXJhdG9yIHdpbGwgcmV0dXJuIGBUZXh0UHJveHlgIGluc3RhbmNlcyBidXQgd2Uga25vdyB0aGF0IHRob3NlIHRleHQgcHJveGllcyB3aWxsXG4gICAgICAgIC8vIGFsd2F5cyByZXByZXNlbnQgZnVsbCB0ZXh0IG5vZGVzICh0aGlzIGlzIGd1YXJhbnRlZWQgdGhhbmtzIHRvIHNwbGl0dGluZyB3ZSBkaWQgYmVmb3JlKS5cbiAgICAgICAgLy8gU28sIHdlIGNhbiBvcGVyYXRlIG9uIHRob3NlIHRleHQgcHJveGllcycgdGV4dCBub2Rlcy5cbiAgICAgICAgY29uc3Qgbm9kZSA9IGl0ZW0uaXMoJyR0ZXh0UHJveHknKSA/IGl0ZW0udGV4dE5vZGUgOiBpdGVtO1xuICAgICAgICBpZiAodmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIG5vZGUuX3NldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUuX3JlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFmdGVyIGF0dHJpYnV0ZXMgY2hhbmdpbmcgaXQgbWF5IGhhcHBlbiB0aGF0IHNvbWUgdGV4dCBub2RlcyBjYW4gYmUgbWVyZ2VkLiBUcnkgdG8gbWVyZ2Ugd2l0aCBwcmV2aW91cyBub2RlLlxuICAgICAgICBfbWVyZ2VOb2Rlc0F0SW5kZXgobm9kZS5wYXJlbnQsIG5vZGUuaW5kZXgpO1xuICAgIH1cbiAgICAvLyBUcnkgdG8gbWVyZ2UgbGFzdCBjaGFuZ2VkIG5vZGUgd2l0aCBpdCdzIHByZXZpb3VzIHNpYmxpbmcgKG5vdCBjb3ZlcmVkIGJ5IHRoZSBsb29wIGFib3ZlKS5cbiAgICBfbWVyZ2VOb2Rlc0F0SW5kZXgocmFuZ2UuZW5kLnBhcmVudCwgcmFuZ2UuZW5kLmluZGV4KTtcbn1cbi8qKlxuICogTm9ybWFsaXplcyBnaXZlbiBvYmplY3Qgb3IgYW4gYXJyYXkgb2Ygb2JqZWN0cyB0byBhbiBhcnJheSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUgbm9kZXN9LiBTZWVcbiAqIHtAbGluayB+Tm9kZVNldCBOb2RlU2V0fSBmb3IgZGV0YWlscyBvbiBob3cgbm9ybWFsaXphdGlvbiBpcyBwZXJmb3JtZWQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbm9kZXMgT2JqZWN0cyB0byBub3JtYWxpemUuXG4gKiBAcmV0dXJucyBOb3JtYWxpemVkIG5vZGVzLlxuICovIGZ1bmN0aW9uIF9ub3JtYWxpemVOb2Rlcyhub2Rlcykge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBbXTtcbiAgICBmdW5jdGlvbiBjb252ZXJ0KG5vZGVzKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZWQucHVzaChuZXcgVGV4dChub2RlcykpO1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGVzIGluc3RhbmNlb2YgVGV4dFByb3h5KSB7XG4gICAgICAgICAgICBub3JtYWxpemVkLnB1c2gobmV3IFRleHQobm9kZXMuZGF0YSwgbm9kZXMuZ2V0QXR0cmlidXRlcygpKSk7XG4gICAgICAgIH0gZWxzZSBpZiAobm9kZXMgaW5zdGFuY2VvZiBOb2RlJDEpIHtcbiAgICAgICAgICAgIG5vcm1hbGl6ZWQucHVzaChub2Rlcyk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNJdGVyYWJsZShub2RlcykpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICAgICAgY29udmVydChub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIDtcbiAgICB9XG4gICAgY29udmVydChub2Rlcyk7XG4gICAgLy8gTWVyZ2UgdGV4dCBub2Rlcy5cbiAgICBmb3IobGV0IGkgPSAxOyBpIDwgbm9ybWFsaXplZC5sZW5ndGg7IGkrKyl7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBub3JtYWxpemVkW2ldO1xuICAgICAgICBjb25zdCBwcmV2ID0gbm9ybWFsaXplZFtpIC0gMV07XG4gICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgVGV4dCAmJiBwcmV2IGluc3RhbmNlb2YgVGV4dCAmJiBfaGF2ZVNhbWVBdHRyaWJ1dGVzKG5vZGUsIHByZXYpKSB7XG4gICAgICAgICAgICAvLyBEb2luZyB0aGlzIGluc3RlYWQgY2hhbmdpbmcgYHByZXYuZGF0YWAgYmVjYXVzZSBgZGF0YWAgaXMgcmVhZG9ubHkuXG4gICAgICAgICAgICBub3JtYWxpemVkLnNwbGljZShpIC0gMSwgMiwgbmV3IFRleHQocHJldi5kYXRhICsgbm9kZS5kYXRhLCBwcmV2LmdldEF0dHJpYnV0ZXMoKSkpO1xuICAgICAgICAgICAgaS0tO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVkO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgbm9kZXMgYmVmb3JlIGFuZCBhZnRlciBnaXZlbiBpbmRleCBpbiBnaXZlbiBlbGVtZW50IGFyZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0flRleHQgdGV4dCBub2Rlc30gYW5kXG4gKiBtZXJnZXMgdGhlbSBpbnRvIG9uZSBub2RlIGlmIHRoZXkgaGF2ZSBzYW1lIGF0dHJpYnV0ZXMuXG4gKlxuICogTWVyZ2luZyBpcyBkb25lIGJ5IHJlbW92aW5nIHR3byB0ZXh0IG5vZGVzIGFuZCBpbnNlcnRpbmcgYSBuZXcgdGV4dCBub2RlIGNvbnRhaW5pbmcgZGF0YSBmcm9tIGJvdGggbWVyZ2VkIHRleHQgbm9kZXMuXG4gKlxuICogQHBhcmFtIGVsZW1lbnQgUGFyZW50IGVsZW1lbnQgb2Ygbm9kZXMgdG8gbWVyZ2UuXG4gKiBAcGFyYW0gaW5kZXggSW5kZXggYmV0d2VlbiBub2RlcyB0byBtZXJnZS5cbiAqLyBmdW5jdGlvbiBfbWVyZ2VOb2Rlc0F0SW5kZXgoZWxlbWVudCwgaW5kZXgpIHtcbiAgICBjb25zdCBub2RlQmVmb3JlID0gZWxlbWVudC5nZXRDaGlsZChpbmRleCAtIDEpO1xuICAgIGNvbnN0IG5vZGVBZnRlciA9IGVsZW1lbnQuZ2V0Q2hpbGQoaW5kZXgpO1xuICAgIC8vIENoZWNrIGlmIGJvdGggb2YgdGhvc2Ugbm9kZXMgYXJlIHRleHQgb2JqZWN0cyB3aXRoIHNhbWUgYXR0cmlidXRlcy5cbiAgICBpZiAobm9kZUJlZm9yZSAmJiBub2RlQWZ0ZXIgJiYgbm9kZUJlZm9yZS5pcygnJHRleHQnKSAmJiBub2RlQWZ0ZXIuaXMoJyR0ZXh0JykgJiYgX2hhdmVTYW1lQXR0cmlidXRlcyhub2RlQmVmb3JlLCBub2RlQWZ0ZXIpKSB7XG4gICAgICAgIC8vIEFwcGVuZCB0ZXh0IG9mIHRleHQgbm9kZSBhZnRlciBpbmRleCB0byB0aGUgYmVmb3JlIG9uZS5cbiAgICAgICAgY29uc3QgbWVyZ2VkTm9kZSA9IG5ldyBUZXh0KG5vZGVCZWZvcmUuZGF0YSArIG5vZGVBZnRlci5kYXRhLCBub2RlQmVmb3JlLmdldEF0dHJpYnV0ZXMoKSk7XG4gICAgICAgIC8vIFJlbW92ZSBzZXBhcmF0ZSB0ZXh0IG5vZGVzLlxuICAgICAgICBlbGVtZW50Ll9yZW1vdmVDaGlsZHJlbihpbmRleCAtIDEsIDIpO1xuICAgICAgICAvLyBJbnNlcnQgbWVyZ2VkIHRleHQgbm9kZS5cbiAgICAgICAgZWxlbWVudC5faW5zZXJ0Q2hpbGQoaW5kZXggLSAxLCBtZXJnZWROb2RlKTtcbiAgICB9XG59XG4vKipcbiAqIENoZWNrcyBpZiBnaXZlbiBwb3NpdGlvbiBpcyBpbiBhIHRleHQgbm9kZSwgYW5kIGlmIHNvLCBzcGxpdHMgdGhlIHRleHQgbm9kZSBpbiB0d28gdGV4dCBub2RlcywgZWFjaCBvZiB0aGVtXG4gKiBjb250YWluaW5nIGEgcGFydCBvZiBvcmlnaW5hbCB0ZXh0IG5vZGUuXG4gKlxuICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIGF0IHdoaWNoIG5vZGUgc2hvdWxkIGJlIHNwbGl0LlxuICovIGZ1bmN0aW9uIF9zcGxpdE5vZGVBdFBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgY29uc3QgdGV4dE5vZGUgPSBwb3NpdGlvbi50ZXh0Tm9kZTtcbiAgICBjb25zdCBlbGVtZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgIGlmICh0ZXh0Tm9kZSkge1xuICAgICAgICBjb25zdCBvZmZzZXREaWZmID0gcG9zaXRpb24ub2Zmc2V0IC0gdGV4dE5vZGUuc3RhcnRPZmZzZXQ7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGV4dE5vZGUuaW5kZXg7XG4gICAgICAgIGVsZW1lbnQuX3JlbW92ZUNoaWxkcmVuKGluZGV4LCAxKTtcbiAgICAgICAgY29uc3QgZmlyc3RQYXJ0ID0gbmV3IFRleHQodGV4dE5vZGUuZGF0YS5zdWJzdHIoMCwgb2Zmc2V0RGlmZiksIHRleHROb2RlLmdldEF0dHJpYnV0ZXMoKSk7XG4gICAgICAgIGNvbnN0IHNlY29uZFBhcnQgPSBuZXcgVGV4dCh0ZXh0Tm9kZS5kYXRhLnN1YnN0cihvZmZzZXREaWZmKSwgdGV4dE5vZGUuZ2V0QXR0cmlidXRlcygpKTtcbiAgICAgICAgZWxlbWVudC5faW5zZXJ0Q2hpbGQoaW5kZXgsIFtcbiAgICAgICAgICAgIGZpcnN0UGFydCxcbiAgICAgICAgICAgIHNlY29uZFBhcnRcbiAgICAgICAgXSk7XG4gICAgfVxufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0d28gZ2l2ZW4gbm9kZXMgaGF2ZSBzYW1lIGF0dHJpYnV0ZXMuXG4gKlxuICogQHBhcmFtIG5vZGVBIE5vZGUgdG8gY2hlY2suXG4gKiBAcGFyYW0gbm9kZUIgTm9kZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIGB0cnVlYCBpZiBub2RlcyBoYXZlIHNhbWUgYXR0cmlidXRlcywgYGZhbHNlYCBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gX2hhdmVTYW1lQXR0cmlidXRlcyhub2RlQSwgbm9kZUIpIHtcbiAgICBjb25zdCBpdGVyYXRvckEgPSBub2RlQS5nZXRBdHRyaWJ1dGVzKCk7XG4gICAgY29uc3QgaXRlcmF0b3JCID0gbm9kZUIuZ2V0QXR0cmlidXRlcygpO1xuICAgIGZvciAoY29uc3QgYXR0ciBvZiBpdGVyYXRvckEpe1xuICAgICAgICBpZiAoYXR0clsxXSAhPT0gbm9kZUIuZ2V0QXR0cmlidXRlKGF0dHJbMF0pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaXRlcmF0b3JCLm5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGl0ZXJhdG9yQi5uZXh0KCkuZG9uZTtcbn1cblxuLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zdCBNb2RlbFJhbmdlID0gcmVxdWlyZSggJy4uL3JhbmdlJyApLmRlZmF1bHQ7XG4vKipcbiAqIE9wZXJhdGlvbiB0byBtb3ZlIGEgcmFuZ2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW1zfVxuICogdG8gZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24gdGFyZ2V0IHBvc2l0aW9ufS5cbiAqLyBjbGFzcyBNb3ZlT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcbiAgICAvKipcblx0ICogUG9zaXRpb24gYmVmb3JlIHRoZSBmaXJzdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbX0gdG8gbW92ZS5cblx0ICovIHNvdXJjZVBvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBPZmZzZXQgc2l6ZSBvZiBtb3ZlZCByYW5nZS5cblx0ICovIGhvd01hbnk7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGF0IHdoaWNoIG1vdmVkIG5vZGVzIHdpbGwgYmUgaW5zZXJ0ZWQuXG5cdCAqLyB0YXJnZXRQb3NpdGlvbjtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1vdmUgb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gc291cmNlUG9zaXRpb24gUG9zaXRpb24gYmVmb3JlIHRoZSBmaXJzdCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbX0gdG8gbW92ZS5cblx0ICogQHBhcmFtIGhvd01hbnkgT2Zmc2V0IHNpemUgb2YgbW92ZWQgcmFuZ2UuIE1vdmVkIHJhbmdlIHdpbGwgc3RhcnQgZnJvbSBgc291cmNlUG9zaXRpb25gIGFuZCBlbmQgYXRcblx0ICogYHNvdXJjZVBvc2l0aW9uYCB3aXRoIG9mZnNldCBzaGlmdGVkIGJ5IGBob3dNYW55YC5cblx0ICogQHBhcmFtIHRhcmdldFBvc2l0aW9uIFBvc2l0aW9uIGF0IHdoaWNoIG1vdmVkIG5vZGVzIHdpbGwgYmUgaW5zZXJ0ZWQuXG5cdCAqIEBwYXJhbSBiYXNlVmVyc2lvbiBEb2N1bWVudCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCN2ZXJzaW9ufSBvbiB3aGljaCBvcGVyYXRpb25cblx0ICogY2FuIGJlIGFwcGxpZWQgb3IgYG51bGxgIGlmIHRoZSBvcGVyYXRpb24gb3BlcmF0ZXMgb24gZGV0YWNoZWQgKG5vbi1kb2N1bWVudCkgdHJlZS5cblx0ICovIGNvbnN0cnVjdG9yKHNvdXJjZVBvc2l0aW9uLCBob3dNYW55LCB0YXJnZXRQb3NpdGlvbiwgYmFzZVZlcnNpb24pe1xuICAgICAgICBzdXBlcihiYXNlVmVyc2lvbik7XG4gICAgICAgIHRoaXMuc291cmNlUG9zaXRpb24gPSBzb3VyY2VQb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICAvLyBgJ3RvTmV4dCdgIGJlY2F1c2UgYHNvdXJjZVBvc2l0aW9uYCBpcyBhIGJpdCBsaWtlIGEgc3RhcnQgb2YgdGhlIG1vdmVkIHJhbmdlLlxuICAgICAgICB0aGlzLnNvdXJjZVBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9OZXh0JztcbiAgICAgICAgdGhpcy5ob3dNYW55ID0gaG93TWFueTtcbiAgICAgICAgdGhpcy50YXJnZXRQb3NpdGlvbiA9IHRhcmdldFBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIHRoaXMudGFyZ2V0UG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b05vbmUnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCB0eXBlKCkge1xuICAgICAgICBpZiAodGhpcy50YXJnZXRQb3NpdGlvbi5yb290LnJvb3ROYW1lID09ICckZ3JhdmV5YXJkJykge1xuICAgICAgICAgICAgcmV0dXJuICdyZW1vdmUnO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc291cmNlUG9zaXRpb24ucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHtcbiAgICAgICAgICAgIHJldHVybiAncmVpbnNlcnQnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnbW92ZSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IGFmZmVjdGVkU2VsZWN0YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdCh0aGlzLnNvdXJjZVBvc2l0aW9uLCB0aGlzLmhvd01hbnkpLFxuICAgICAgICAgICAgUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHRoaXMudGFyZ2V0UG9zaXRpb24sIDApXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGFuIG9wZXJhdGlvbiB0aGF0IGhhcyB0aGUgc2FtZSBwYXJhbWV0ZXJzIGFzIHRoaXMgb3BlcmF0aW9uLlxuXHQgKi8gY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTW92ZU9wZXJhdGlvbih0aGlzLnNvdXJjZVBvc2l0aW9uLCB0aGlzLmhvd01hbnksIHRoaXMudGFyZ2V0UG9zaXRpb24sIHRoaXMuYmFzZVZlcnNpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgc3RhcnQgcG9zaXRpb24gb2YgdGhlIG1vdmVkIHJhbmdlIGFmdGVyIGl0IGdvdCBtb3ZlZC4gVGhpcyBtYXkgYmUgZGlmZmVyZW50IHRoYW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL21vdmVvcGVyYXRpb25+TW92ZU9wZXJhdGlvbiN0YXJnZXRQb3NpdGlvbn0gaW4gc29tZSBjYXNlcywgaS5lLiB3aGVuIGEgcmFuZ2UgaXMgbW92ZWRcblx0ICogaW5zaWRlIHRoZSBzYW1lIHBhcmVudCBidXQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL21vdmVvcGVyYXRpb25+TW92ZU9wZXJhdGlvbiN0YXJnZXRQb3NpdGlvbiB0YXJnZXRQb3NpdGlvbn1cblx0ICogaXMgYWZ0ZXIge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL21vdmVvcGVyYXRpb25+TW92ZU9wZXJhdGlvbiNzb3VyY2VQb3NpdGlvbiBzb3VyY2VQb3NpdGlvbn0uXG5cdCAqXG5cdCAqIGBgYFxuXHQgKiAgdnYgICAgICAgICAgICAgIHZ2XG5cdCAqIGFiY2RlZmcgPT09PiBhZGVmYmNnXG5cdCAqICAgICAgXiAgICAgICAgICBeXG5cdCAqICAgICAgdGFyZ2V0UG9zICBtb3ZlZFJhbmdlU3RhcnRcblx0ICogICAgICBvZmZzZXQgNiAgIG9mZnNldCA0XG5cdCAqYGBgXG5cdCAqLyBnZXRNb3ZlZFJhbmdlU3RhcnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24odGhpcy5zb3VyY2VQb3NpdGlvbiwgdGhpcy5ob3dNYW55KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiNnZXRSZXZlcnNlZCBgT3BlcmF0aW9uI2dldFJldmVyc2VkKClgfS5cblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICBjb25zdCBuZXdUYXJnZXRQb3NpdGlvbiA9IHRoaXMuc291cmNlUG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24odGhpcy50YXJnZXRQb3NpdGlvbiwgdGhpcy5ob3dNYW55KTtcbiAgICAgICAgcmV0dXJuIG5ldyBNb3ZlT3BlcmF0aW9uKHRoaXMuZ2V0TW92ZWRSYW5nZVN0YXJ0KCksIHRoaXMuaG93TWFueSwgbmV3VGFyZ2V0UG9zaXRpb24sIHRoaXMuYmFzZVZlcnNpb24gKyAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3ZhbGlkYXRlKCkge1xuICAgICAgICBjb25zdCBzb3VyY2VFbGVtZW50ID0gdGhpcy5zb3VyY2VQb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSB0aGlzLnRhcmdldFBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgY29uc3Qgc291cmNlT2Zmc2V0ID0gdGhpcy5zb3VyY2VQb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgIGNvbnN0IHRhcmdldE9mZnNldCA9IHRoaXMudGFyZ2V0UG9zaXRpb24ub2Zmc2V0O1xuICAgICAgICAvLyBWYWxpZGF0ZSB3aGV0aGVyIG1vdmUgb3BlcmF0aW9uIGhhcyBjb3JyZWN0IHBhcmFtZXRlcnMuXG4gICAgICAgIC8vIFZhbGlkYXRpb24gaXMgcHJldHR5IGNvbXBsZXggYnV0IG1vdmUgb3BlcmF0aW9uIGlzIG9uZSBvZiB0aGUgY29yZSB3YXlzIHRvIG1hbmlwdWxhdGUgdGhlIGRvY3VtZW50IHN0YXRlLlxuICAgICAgICAvLyBXZSBleHBlY3QgdGhhdCBtYW55IGVycm9ycyBtaWdodCBiZSBjb25uZWN0ZWQgd2l0aCBvbmUgb2Ygc2NlbmFyaW9zIGRlc2NyaWJlZCBiZWxvdy5cbiAgICAgICAgaWYgKHNvdXJjZU9mZnNldCArIHRoaXMuaG93TWFueSA+IHNvdXJjZUVsZW1lbnQubWF4T2Zmc2V0KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBub2RlcyB3aGljaCBzaG91bGQgYmUgbW92ZWQgZG8gbm90IGV4aXN0LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb3ZlLW9wZXJhdGlvbi1ub2Rlcy1kby1ub3QtZXhpc3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW92ZS1vcGVyYXRpb24tbm9kZXMtZG8tbm90LWV4aXN0JywgdGhpcyk7XG4gICAgICAgIH0gZWxzZSBpZiAoc291cmNlRWxlbWVudCA9PT0gdGFyZ2V0RWxlbWVudCAmJiBzb3VyY2VPZmZzZXQgPCB0YXJnZXRPZmZzZXQgJiYgdGFyZ2V0T2Zmc2V0IDwgc291cmNlT2Zmc2V0ICsgdGhpcy5ob3dNYW55KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRyeWluZyB0byBtb3ZlIGEgcmFuZ2Ugb2Ygbm9kZXMgaW50byB0aGUgbWlkZGxlIG9mIHRoYXQgcmFuZ2UuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1vdmUtb3BlcmF0aW9uLXJhbmdlLWludG8taXRzZWxmXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vdmUtb3BlcmF0aW9uLXJhbmdlLWludG8taXRzZWxmJywgdGhpcyk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zb3VyY2VQb3NpdGlvbi5yb290ID09IHRoaXMudGFyZ2V0UG9zaXRpb24ucm9vdCkge1xuICAgICAgICAgICAgaWYgKGNvbXBhcmVBcnJheXModGhpcy5zb3VyY2VQb3NpdGlvbi5nZXRQYXJlbnRQYXRoKCksIHRoaXMudGFyZ2V0UG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpKSA9PSAncHJlZml4Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLnNvdXJjZVBvc2l0aW9uLnBhdGgubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50YXJnZXRQb3NpdGlvbi5wYXRoW2ldID49IHNvdXJjZU9mZnNldCAmJiB0aGlzLnRhcmdldFBvc2l0aW9uLnBhdGhbaV0gPCBzb3VyY2VPZmZzZXQgKyB0aGlzLmhvd01hbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdFx0ICogVHJ5aW5nIHRvIG1vdmUgYSByYW5nZSBvZiBub2RlcyBpbnRvIG9uZSBvZiBub2RlcyBmcm9tIHRoYXQgcmFuZ2UuXG5cdFx0XHRcdFx0ICpcblx0XHRcdFx0XHQgKiBAZXJyb3IgbW92ZS1vcGVyYXRpb24tbm9kZS1pbnRvLWl0c2VsZlxuXHRcdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW92ZS1vcGVyYXRpb24tbm9kZS1pbnRvLWl0c2VsZicsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfZXhlY3V0ZSgpIHtcbiAgICAgICAgX21vdmUoUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHRoaXMuc291cmNlUG9zaXRpb24sIHRoaXMuaG93TWFueSksIHRoaXMudGFyZ2V0UG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBqc29uLnNvdXJjZVBvc2l0aW9uID0gdGhpcy5zb3VyY2VQb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAganNvbi50YXJnZXRQb3NpdGlvbiA9IHRoaXMudGFyZ2V0UG9zaXRpb24udG9KU09OKCk7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01vdmVPcGVyYXRpb24nO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBgTW92ZU9wZXJhdGlvbmAgb2JqZWN0IGZyb20gZGVzZXJpYWxpemVkIG9iamVjdCwgaS5lLiBmcm9tIHBhcnNlZCBKU09OIHN0cmluZy5cblx0ICpcblx0ICogQHBhcmFtIGpzb24gRGVzZXJpYWxpemVkIEpTT04gb2JqZWN0LlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgRG9jdW1lbnQgb24gd2hpY2ggdGhpcyBvcGVyYXRpb24gd2lsbCBiZSBhcHBsaWVkLlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24sIGRvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZVBvc2l0aW9uID0gUG9zaXRpb24uZnJvbUpTT04oanNvbi5zb3VyY2VQb3NpdGlvbiwgZG9jdW1lbnQpO1xuICAgICAgICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21KU09OKGpzb24udGFyZ2V0UG9zaXRpb24sIGRvY3VtZW50KTtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzKHNvdXJjZVBvc2l0aW9uLCBqc29uLmhvd01hbnksIHRhcmdldFBvc2l0aW9uLCBqc29uLmJhc2VWZXJzaW9uKTtcbiAgICB9XG59XG5cbi8qKlxuICogT3BlcmF0aW9uIHRvIGluc2VydCBvbmUgb3IgbW9yZSBub2RlcyBhdCBnaXZlbiBwb3NpdGlvbiBpbiB0aGUgbW9kZWwuXG4gKi8gY2xhc3MgSW5zZXJ0T3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcbiAgICAvKipcblx0ICogUG9zaXRpb24gb2YgaW5zZXJ0aW9uLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIHBvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBMaXN0IG9mIG5vZGVzIHRvIGluc2VydC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBub2RlcztcbiAgICAvKipcblx0ICogRmxhZyBkZWNpZGluZyBob3cgdGhlIG9wZXJhdGlvbiBzaG91bGQgYmUgdHJhbnNmb3JtZWQuIElmIHNldCB0byBgdHJ1ZWAsIG5vZGVzIG1pZ2h0IGdldCBhZGRpdGlvbmFsIGF0dHJpYnV0ZXNcblx0ICogZHVyaW5nIG9wZXJhdGlvbmFsIHRyYW5zZm9ybWF0aW9uLiBUaGlzIGhhcHBlbnMgd2hlbiB0aGUgb3BlcmF0aW9uIGluc2VydGlvbiBwb3NpdGlvbiBpcyBpbnNpZGUgb2YgYSByYW5nZVxuXHQgKiB3aGVyZSBhdHRyaWJ1dGVzIGhhdmUgY2hhbmdlZC5cblx0ICovIHNob3VsZFJlY2VpdmVBdHRyaWJ1dGVzO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc2VydCBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiBvZiBpbnNlcnRpb24uXG5cdCAqIEBwYXJhbSBub2RlcyBUaGUgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZC5cblx0ICogQHBhcmFtIGJhc2VWZXJzaW9uIERvY3VtZW50IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb259IG9uIHdoaWNoIG9wZXJhdGlvblxuXHQgKiBjYW4gYmUgYXBwbGllZCBvciBgbnVsbGAgaWYgdGhlIG9wZXJhdGlvbiBvcGVyYXRlcyBvbiBkZXRhY2hlZCAobm9uLWRvY3VtZW50KSB0cmVlLlxuXHQgKi8gY29uc3RydWN0b3IocG9zaXRpb24sIG5vZGVzLCBiYXNlVmVyc2lvbil7XG4gICAgICAgIHN1cGVyKGJhc2VWZXJzaW9uKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIHRoaXMucG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b05vbmUnO1xuICAgICAgICB0aGlzLm5vZGVzID0gbmV3IE5vZGVMaXN0KF9ub3JtYWxpemVOb2Rlcyhub2RlcykpO1xuICAgICAgICB0aGlzLnNob3VsZFJlY2VpdmVBdHRyaWJ1dGVzID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIHJldHVybiAnaW5zZXJ0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRvdGFsIG9mZnNldCBzaXplIG9mIGluc2VydGVkIG5vZGVzLlxuXHQgKi8gZ2V0IGhvd01hbnkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vZGVzLm1heE9mZnNldDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBnZXQgYWZmZWN0ZWRTZWxlY3RhYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbi5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhbiBvcGVyYXRpb24gdGhhdCBoYXMgdGhlIHNhbWUgcGFyYW1ldGVycyBhcyB0aGlzIG9wZXJhdGlvbi5cblx0ICovIGNsb25lKCkge1xuICAgICAgICBjb25zdCBub2RlcyA9IG5ldyBOb2RlTGlzdChbXG4gICAgICAgICAgICAuLi50aGlzLm5vZGVzXG4gICAgICAgIF0ubWFwKChub2RlKT0+bm9kZS5fY2xvbmUodHJ1ZSkpKTtcbiAgICAgICAgY29uc3QgaW5zZXJ0ID0gbmV3IEluc2VydE9wZXJhdGlvbih0aGlzLnBvc2l0aW9uLCBub2RlcywgdGhpcy5iYXNlVmVyc2lvbik7XG4gICAgICAgIGluc2VydC5zaG91bGRSZWNlaXZlQXR0cmlidXRlcyA9IHRoaXMuc2hvdWxkUmVjZWl2ZUF0dHJpYnV0ZXM7XG4gICAgICAgIHJldHVybiBpbnNlcnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvbn5PcGVyYXRpb24jZ2V0UmV2ZXJzZWQgYE9wZXJhdGlvbiNnZXRSZXZlcnNlZCgpYH0uXG5cdCAqLyBnZXRSZXZlcnNlZCgpIHtcbiAgICAgICAgY29uc3QgZ3JhdmV5YXJkID0gdGhpcy5wb3NpdGlvbi5yb290LmRvY3VtZW50LmdyYXZleWFyZDtcbiAgICAgICAgY29uc3QgZ3lQb3NpdGlvbiA9IG5ldyBQb3NpdGlvbihncmF2ZXlhcmQsIFtcbiAgICAgICAgICAgIDBcbiAgICAgICAgXSk7XG4gICAgICAgIHJldHVybiBuZXcgTW92ZU9wZXJhdGlvbih0aGlzLnBvc2l0aW9uLCB0aGlzLm5vZGVzLm1heE9mZnNldCwgZ3lQb3NpdGlvbiwgdGhpcy5iYXNlVmVyc2lvbiArIDEpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfdmFsaWRhdGUoKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldEVsZW1lbnQgPSB0aGlzLnBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgaWYgKCF0YXJnZXRFbGVtZW50IHx8IHRhcmdldEVsZW1lbnQubWF4T2Zmc2V0IDwgdGhpcy5wb3NpdGlvbi5vZmZzZXQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogSW5zZXJ0aW9uIHBvc2l0aW9uIGlzIGludmFsaWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGluc2VydC1vcGVyYXRpb24tcG9zaXRpb24taW52YWxpZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdpbnNlcnQtb3BlcmF0aW9uLXBvc2l0aW9uLWludmFsaWQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfZXhlY3V0ZSgpIHtcbiAgICAgICAgLy8gV2hhdCBoYXBwZW5zIGhlcmUgaXMgdGhhdCB3ZSB3YW50IG9yaWdpbmFsIG5vZGVzIGJlIHBhc3NlZCB0byB3cml0ZXIgYmVjYXVzZSB3ZSB3YW50IG9yaWdpbmFsIG5vZGVzXG4gICAgICAgIC8vIHRvIGJlIGluc2VydGVkIHRvIHRoZSBtb2RlbC4gQnV0IGluIEluc2VydE9wZXJhdGlvbiwgd2Ugd2FudCB0byBrZWVwIHRob3NlIG5vZGVzIGFzIHRoZXkgd2VyZSBhZGRlZFxuICAgICAgICAvLyB0byB0aGUgb3BlcmF0aW9uLCBub3QgbW9kaWZpZWQuIEZvciBleGFtcGxlLCB0ZXh0IG5vZGVzIGNhbiBnZXQgbWVyZ2VkIG9yIGNyb3BwZWQgd2hpbGUgRWxlbWVudHMgY2FuXG4gICAgICAgIC8vIGdldCBjaGlsZHJlbi4gSXQgaXMgaW1wb3J0YW50IHRoYXQgSW5zZXJ0T3BlcmF0aW9uIGhhcyB0aGUgY29weSBvZiBvcmlnaW5hbCBub2RlcyBpbiBpbnRhY3Qgc3RhdGUuXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsTm9kZXMgPSB0aGlzLm5vZGVzO1xuICAgICAgICB0aGlzLm5vZGVzID0gbmV3IE5vZGVMaXN0KFtcbiAgICAgICAgICAgIC4uLm9yaWdpbmFsTm9kZXNcbiAgICAgICAgXS5tYXAoKG5vZGUpPT5ub2RlLl9jbG9uZSh0cnVlKSkpO1xuICAgICAgICBfaW5zZXJ0KHRoaXMucG9zaXRpb24sIG9yaWdpbmFsTm9kZXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBqc29uLnBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAganNvbi5ub2RlcyA9IHRoaXMubm9kZXMudG9KU09OKCk7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0luc2VydE9wZXJhdGlvbic7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGBJbnNlcnRPcGVyYXRpb25gIG9iamVjdCBmcm9tIGRlc2VyaWFsaXplZCBvYmplY3QsIGkuZS4gZnJvbSBwYXJzZWQgSlNPTiBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIERlc2VyaWFsaXplZCBKU09OIG9iamVjdC5cblx0ICogQHBhcmFtIGRvY3VtZW50IERvY3VtZW50IG9uIHdoaWNoIHRoaXMgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2N1bWVudCkge1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGpzb24ubm9kZXMpe1xuICAgICAgICAgICAgaWYgKGNoaWxkLm5hbWUpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBjaGlsZCBoYXMgbmFtZSBwcm9wZXJ0eSwgaXQgaXMgYW4gRWxlbWVudC5cbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKEVsZW1lbnQuZnJvbUpTT04oY2hpbGQpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpdCBpcyBhIFRleHQgbm9kZS5cbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKFRleHQuZnJvbUpTT04oY2hpbGQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpbnNlcnQgPSBuZXcgSW5zZXJ0T3BlcmF0aW9uKFBvc2l0aW9uLmZyb21KU09OKGpzb24ucG9zaXRpb24sIGRvY3VtZW50KSwgY2hpbGRyZW4sIGpzb24uYmFzZVZlcnNpb24pO1xuICAgICAgICBpbnNlcnQuc2hvdWxkUmVjZWl2ZUF0dHJpYnV0ZXMgPSBqc29uLnNob3VsZFJlY2VpdmVBdHRyaWJ1dGVzO1xuICAgICAgICByZXR1cm4gaW5zZXJ0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBPcGVyYXRpb24gdG8gc3BsaXQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZWxlbWVudH5FbGVtZW50IGFuIGVsZW1lbnR9IGF0IGdpdmVuXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vc3BsaXRvcGVyYXRpb25+U3BsaXRPcGVyYXRpb24jc3BsaXRQb3NpdGlvbiBzcGxpdCBwb3NpdGlvbn0gaW50byB0d28gZWxlbWVudHMsXG4gKiBib3RoIGNvbnRhaW5pbmcgYSBwYXJ0IG9mIHRoZSBlbGVtZW50J3Mgb3JpZ2luYWwgY29udGVudC5cbiAqLyBjbGFzcyBTcGxpdE9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGF0IHdoaWNoIGFuIGVsZW1lbnQgc2hvdWxkIGJlIHNwbGl0LlxuXHQgKi8gc3BsaXRQb3NpdGlvbjtcbiAgICAvKipcblx0ICogVG90YWwgb2Zmc2V0IHNpemUgb2YgZWxlbWVudHMgdGhhdCBhcmUgaW4gdGhlIHNwbGl0IGVsZW1lbnQgYWZ0ZXIgYHBvc2l0aW9uYC5cblx0ICovIGhvd01hbnk7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGF0IHdoaWNoIHRoZSBjbG9uZSBvZiBzcGxpdCBlbGVtZW50IChvciBlbGVtZW50IGZyb20gZ3JhdmV5YXJkKSB3aWxsIGJlIGluc2VydGVkLlxuXHQgKi8gaW5zZXJ0aW9uUG9zaXRpb247XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGluIHRoZSBncmF2ZXlhcmQgcm9vdCBiZWZvcmUgdGhlIGVsZW1lbnQgd2hpY2ggc2hvdWxkIGJlIHVzZWQgYXMgYSBwYXJlbnQgb2YgdGhlIG5vZGVzIGFmdGVyIGBwb3NpdGlvbmAuXG5cdCAqIElmIGl0IGlzIG5vdCBzZXQsIGEgY29weSBvZiB0aGUgdGhlIGBwb3NpdGlvbmAgcGFyZW50IHdpbGwgYmUgdXNlZC5cblx0ICpcblx0ICogVGhlIGRlZmF1bHQgYmVoYXZpb3IgaXMgdG8gY2xvbmUgdGhlIHNwbGl0IGVsZW1lbnQuIEVsZW1lbnQgZnJvbSBncmF2ZXlhcmQgaXMgdXNlZCBkdXJpbmcgdW5kby5cblx0ICovIGdyYXZleWFyZFBvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgc3BsaXQgb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gc3BsaXRQb3NpdGlvbiBQb3NpdGlvbiBhdCB3aGljaCBhbiBlbGVtZW50IHNob3VsZCBiZSBzcGxpdC5cblx0ICogQHBhcmFtIGhvd01hbnkgVG90YWwgb2Zmc2V0IHNpemUgb2YgZWxlbWVudHMgdGhhdCBhcmUgaW4gdGhlIHNwbGl0IGVsZW1lbnQgYWZ0ZXIgYHBvc2l0aW9uYC5cblx0ICogQHBhcmFtIGluc2VydGlvblBvc2l0aW9uIFBvc2l0aW9uIGF0IHdoaWNoIHRoZSBjbG9uZSBvZiBzcGxpdCBlbGVtZW50IChvciBlbGVtZW50IGZyb20gZ3JhdmV5YXJkKSB3aWxsIGJlIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gZ3JhdmV5YXJkUG9zaXRpb24gUG9zaXRpb24gaW4gdGhlIGdyYXZleWFyZCByb290IGJlZm9yZSB0aGUgZWxlbWVudCB3aGljaFxuXHQgKiBzaG91bGQgYmUgdXNlZCBhcyBhIHBhcmVudCBvZiB0aGUgbm9kZXMgYWZ0ZXIgYHBvc2l0aW9uYC4gSWYgaXQgaXMgbm90IHNldCwgYSBjb3B5IG9mIHRoZSB0aGUgYHBvc2l0aW9uYCBwYXJlbnQgd2lsbCBiZSB1c2VkLlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gRG9jdW1lbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uXG5cdCAqIGNhbiBiZSBhcHBsaWVkIG9yIGBudWxsYCBpZiB0aGUgb3BlcmF0aW9uIG9wZXJhdGVzIG9uIGRldGFjaGVkIChub24tZG9jdW1lbnQpIHRyZWUuXG5cdCAqLyBjb25zdHJ1Y3RvcihzcGxpdFBvc2l0aW9uLCBob3dNYW55LCBpbnNlcnRpb25Qb3NpdGlvbiwgZ3JhdmV5YXJkUG9zaXRpb24sIGJhc2VWZXJzaW9uKXtcbiAgICAgICAgc3VwZXIoYmFzZVZlcnNpb24pO1xuICAgICAgICB0aGlzLnNwbGl0UG9zaXRpb24gPSBzcGxpdFBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIC8vIEtlZXAgcG9zaXRpb24gc3RpY2tpbmcgdG8gdGhlIG5leHQgbm9kZS4gVGhpcyB3YXkgYW55IG5ldyBjb250ZW50IGFkZGVkIGF0IHRoZSBwbGFjZSB3aGVyZSB0aGUgZWxlbWVudCBpcyBzcGxpdFxuICAgICAgICAvLyB3aWxsIGJlIGxlZnQgaW4gdGhlIG9yaWdpbmFsIGVsZW1lbnQuXG4gICAgICAgIHRoaXMuc3BsaXRQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgICAgIHRoaXMuaG93TWFueSA9IGhvd01hbnk7XG4gICAgICAgIHRoaXMuaW5zZXJ0aW9uUG9zaXRpb24gPSBpbnNlcnRpb25Qb3NpdGlvbjtcbiAgICAgICAgdGhpcy5ncmF2ZXlhcmRQb3NpdGlvbiA9IGdyYXZleWFyZFBvc2l0aW9uID8gZ3JhdmV5YXJkUG9zaXRpb24uY2xvbmUoKSA6IG51bGw7XG4gICAgICAgIGlmICh0aGlzLmdyYXZleWFyZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmdyYXZleWFyZFBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9OZXh0JztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCB0eXBlKCkge1xuICAgICAgICByZXR1cm4gJ3NwbGl0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGluc2lkZSB0aGUgbmV3IGNsb25lIG9mIGEgc3BsaXQgZWxlbWVudC5cblx0ICpcblx0ICogVGhpcyBpcyBhIHBvc2l0aW9uIHdoZXJlIG5vZGVzIHRoYXQgYXJlIGFmdGVyIHRoZSBzcGxpdCBwb3NpdGlvbiB3aWxsIGJlIG1vdmVkIHRvLlxuXHQgKi8gZ2V0IG1vdmVUYXJnZXRQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuaW5zZXJ0aW9uUG9zaXRpb24ucGF0aC5zbGljZSgpO1xuICAgICAgICBwYXRoLnB1c2goMCk7XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24odGhpcy5pbnNlcnRpb25Qb3NpdGlvbi5yb290LCBwYXRoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgcmFuZ2UgdGhhdCBjb250YWlucyBhbGwgdGhlIG5vZGVzIGZyb20gdGhlIHNwbGl0IGVsZW1lbnQgdGhhdCB3aWxsIGJlIG1vdmVkIHRvIHRoZSBuZXcgZWxlbWVudC5cblx0ICogVGhlIHJhbmdlIHN0YXJ0cyBhdCB7QGxpbmsgI3NwbGl0UG9zaXRpb259IGFuZCBlbmRzIGluIHRoZSBzYW1lIHBhcmVudCwgYXQgYFBPU0lUSVZFX0lORklOSVRZYCBvZmZzZXQuXG5cdCAqLyBnZXQgbW92ZWRSYW5nZSgpIHtcbiAgICAgICAgY29uc3QgZW5kID0gdGhpcy5zcGxpdFBvc2l0aW9uLmdldFNoaWZ0ZWRCeShOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHRoaXMuc3BsaXRQb3NpdGlvbiwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBnZXQgYWZmZWN0ZWRTZWxlY3RhYmxlKCkge1xuICAgICAgICAvLyBUaGVzZSBjb3VsZCBiZSBwb3NpdGlvbnMgYnV0IGBTZWxlY3RhYmxlYCB0eXBlIG9ubHkgc3VwcG9ydHMgYEl0ZXJhYmxlPFJhbmdlPmAuXG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtcbiAgICAgICAgICAgIFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdCh0aGlzLnNwbGl0UG9zaXRpb24sIDApLFxuICAgICAgICAgICAgUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHRoaXMuaW5zZXJ0aW9uUG9zaXRpb24sIDApXG4gICAgICAgIF07XG4gICAgICAgIGlmICh0aGlzLmdyYXZleWFyZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICByYW5nZXMucHVzaChSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQodGhpcy5ncmF2ZXlhcmRQb3NpdGlvbiwgMCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGFuIG9wZXJhdGlvbiB0aGF0IGhhcyB0aGUgc2FtZSBwYXJhbWV0ZXJzIGFzIHRoaXMgb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBDbG9uZSBvZiB0aGlzIG9wZXJhdGlvbi5cblx0ICovIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNwbGl0T3BlcmF0aW9uKHRoaXMuc3BsaXRQb3NpdGlvbiwgdGhpcy5ob3dNYW55LCB0aGlzLmluc2VydGlvblBvc2l0aW9uLCB0aGlzLmdyYXZleWFyZFBvc2l0aW9uLCB0aGlzLmJhc2VWZXJzaW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiNnZXRSZXZlcnNlZCBgT3BlcmF0aW9uI2dldFJldmVyc2VkKClgfS5cblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICBjb25zdCBncmF2ZXlhcmQgPSB0aGlzLnNwbGl0UG9zaXRpb24ucm9vdC5kb2N1bWVudC5ncmF2ZXlhcmQ7XG4gICAgICAgIGNvbnN0IGdyYXZleWFyZFBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKGdyYXZleWFyZCwgW1xuICAgICAgICAgICAgMFxuICAgICAgICBdKTtcbiAgICAgICAgcmV0dXJuIG5ldyBNZXJnZU9wZXJhdGlvbih0aGlzLm1vdmVUYXJnZXRQb3NpdGlvbiwgdGhpcy5ob3dNYW55LCB0aGlzLnNwbGl0UG9zaXRpb24sIGdyYXZleWFyZFBvc2l0aW9uLCB0aGlzLmJhc2VWZXJzaW9uICsgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKiBAaW50ZXJuYWxcblx0ICovIF92YWxpZGF0ZSgpIHtcbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuc3BsaXRQb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuc3BsaXRQb3NpdGlvbi5vZmZzZXQ7XG4gICAgICAgIC8vIFZhbGlkYXRlIHdoZXRoZXIgc3BsaXQgb3BlcmF0aW9uIGhhcyBjb3JyZWN0IHBhcmFtZXRlcnMuXG4gICAgICAgIGlmICghZWxlbWVudCB8fCBlbGVtZW50Lm1heE9mZnNldCA8IG9mZnNldCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBTcGxpdCBwb3NpdGlvbiBpcyBpbnZhbGlkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBzcGxpdC1vcGVyYXRpb24tcG9zaXRpb24taW52YWxpZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdzcGxpdC1vcGVyYXRpb24tcG9zaXRpb24taW52YWxpZCcsIHRoaXMpO1xuICAgICAgICB9IGVsc2UgaWYgKCFlbGVtZW50LnBhcmVudCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3Qgc3BsaXQgcm9vdCBlbGVtZW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBzcGxpdC1vcGVyYXRpb24tc3BsaXQtaW4tcm9vdFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdzcGxpdC1vcGVyYXRpb24tc3BsaXQtaW4tcm9vdCcsIHRoaXMpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaG93TWFueSAhPSBlbGVtZW50Lm1heE9mZnNldCAtIHRoaXMuc3BsaXRQb3NpdGlvbi5vZmZzZXQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogU3BsaXQgb3BlcmF0aW9uIHNwZWNpZmllcyB3cm9uZyBudW1iZXIgb2Ygbm9kZXMgdG8gbW92ZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igc3BsaXQtb3BlcmF0aW9uLWhvdy1tYW55LWludmFsaWRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignc3BsaXQtb3BlcmF0aW9uLWhvdy1tYW55LWludmFsaWQnLCB0aGlzKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmdyYXZleWFyZFBvc2l0aW9uICYmICF0aGlzLmdyYXZleWFyZFBvc2l0aW9uLm5vZGVBZnRlcikge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHcmF2ZXlhcmQgcG9zaXRpb24gaW52YWxpZC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igc3BsaXQtb3BlcmF0aW9uLWdyYXZleWFyZC1wb3NpdGlvbi1pbnZhbGlkXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3NwbGl0LW9wZXJhdGlvbi1ncmF2ZXlhcmQtcG9zaXRpb24taW52YWxpZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9leGVjdXRlKCkge1xuICAgICAgICBjb25zdCBzcGxpdEVsZW1lbnQgPSB0aGlzLnNwbGl0UG9zaXRpb24ucGFyZW50O1xuICAgICAgICBpZiAodGhpcy5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgX21vdmUoUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHRoaXMuZ3JhdmV5YXJkUG9zaXRpb24sIDEpLCB0aGlzLmluc2VydGlvblBvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0VsZW1lbnQgPSBzcGxpdEVsZW1lbnQuX2Nsb25lKCk7XG4gICAgICAgICAgICBfaW5zZXJ0KHRoaXMuaW5zZXJ0aW9uUG9zaXRpb24sIG5ld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNvdXJjZVJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVBdChzcGxpdEVsZW1lbnQsIHRoaXMuc3BsaXRQb3NpdGlvbi5vZmZzZXQpLCBQb3NpdGlvbi5fY3JlYXRlQXQoc3BsaXRFbGVtZW50LCBzcGxpdEVsZW1lbnQubWF4T2Zmc2V0KSk7XG4gICAgICAgIF9tb3ZlKHNvdXJjZVJhbmdlLCB0aGlzLm1vdmVUYXJnZXRQb3NpdGlvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICBjb25zdCBqc29uID0gc3VwZXIudG9KU09OKCk7XG4gICAgICAgIGpzb24uc3BsaXRQb3NpdGlvbiA9IHRoaXMuc3BsaXRQb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAganNvbi5pbnNlcnRpb25Qb3NpdGlvbiA9IHRoaXMuaW5zZXJ0aW9uUG9zaXRpb24udG9KU09OKCk7XG4gICAgICAgIGlmICh0aGlzLmdyYXZleWFyZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICBqc29uLmdyYXZleWFyZFBvc2l0aW9uID0gdGhpcy5ncmF2ZXlhcmRQb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdTcGxpdE9wZXJhdGlvbic7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIZWxwZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgZGVmYXVsdCBpbnNlcnRpb24gcG9zaXRpb24gYmFzaW5nIG9uIGdpdmVuIGBzcGxpdFBvc2l0aW9uYC4gVGhlIGRlZmF1bHQgaW5zZXJ0aW9uXG5cdCAqIHBvc2l0aW9uIGlzIGFmdGVyIHRoZSBzcGxpdCBlbGVtZW50LlxuXHQgKi8gc3RhdGljIGdldEluc2VydGlvblBvc2l0aW9uKHNwbGl0UG9zaXRpb24pIHtcbiAgICAgICAgY29uc3QgcGF0aCA9IHNwbGl0UG9zaXRpb24ucGF0aC5zbGljZSgwLCAtMSk7XG4gICAgICAgIHBhdGhbcGF0aC5sZW5ndGggLSAxXSsrO1xuICAgICAgICByZXR1cm4gbmV3IFBvc2l0aW9uKHNwbGl0UG9zaXRpb24ucm9vdCwgcGF0aCwgJ3RvUHJldmlvdXMnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYFNwbGl0T3BlcmF0aW9uYCBvYmplY3QgZnJvbSBkZXNlcmlhbGl6ZWQgb2JqZWN0LCBpLmUuIGZyb20gcGFyc2VkIEpTT04gc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBEZXNlcmlhbGl6ZWQgSlNPTiBvYmplY3QuXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBEb2N1bWVudCBvbiB3aGljaCB0aGlzIG9wZXJhdGlvbiB3aWxsIGJlIGFwcGxpZWQuXG5cdCAqLyBzdGF0aWMgZnJvbUpTT04oanNvbiwgZG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc3BsaXRQb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21KU09OKGpzb24uc3BsaXRQb3NpdGlvbiwgZG9jdW1lbnQpO1xuICAgICAgICBjb25zdCBpbnNlcnRpb25Qb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21KU09OKGpzb24uaW5zZXJ0aW9uUG9zaXRpb24sIGRvY3VtZW50KTtcbiAgICAgICAgY29uc3QgZ3JhdmV5YXJkUG9zaXRpb24gPSBqc29uLmdyYXZleWFyZFBvc2l0aW9uID8gUG9zaXRpb24uZnJvbUpTT04oanNvbi5ncmF2ZXlhcmRQb3NpdGlvbiwgZG9jdW1lbnQpIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzKHNwbGl0UG9zaXRpb24sIGpzb24uaG93TWFueSwgaW5zZXJ0aW9uUG9zaXRpb24sIGdyYXZleWFyZFBvc2l0aW9uLCBqc29uLmJhc2VWZXJzaW9uKTtcbiAgICB9XG59XG5cbi8qKlxuICogT3BlcmF0aW9uIHRvIG1lcmdlIHR3byB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudHN9LlxuICpcbiAqIFRoZSBtZXJnZWQgZWxlbWVudCBpcyB0aGUgcGFyZW50IG9mIHtAbGluayB+TWVyZ2VPcGVyYXRpb24jc291cmNlUG9zaXRpb259IGFuZCBpdCBpcyBtZXJnZWQgaW50byB0aGUgcGFyZW50IG9mXG4gKiB7QGxpbmsgfk1lcmdlT3BlcmF0aW9uI3RhcmdldFBvc2l0aW9ufS4gQWxsIG5vZGVzIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50IGFyZSBtb3ZlZCB0byB7QGxpbmsgfk1lcmdlT3BlcmF0aW9uI3RhcmdldFBvc2l0aW9ufS5cbiAqXG4gKiBUaGUgbWVyZ2VkIGVsZW1lbnQgaXMgbW92ZWQgdG8gdGhlIGdyYXZleWFyZCBhdCB7QGxpbmsgfk1lcmdlT3BlcmF0aW9uI2dyYXZleWFyZFBvc2l0aW9ufS5cbiAqLyBjbGFzcyBNZXJnZU9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGluc2lkZSB0aGUgbWVyZ2VkIGVsZW1lbnQuIEFsbCBub2RlcyBmcm9tIHRoYXQgZWxlbWVudCBhZnRlciB0aGF0IHBvc2l0aW9uIHdpbGwgYmUgbW92ZWQgdG8ge0BsaW5rICN0YXJnZXRQb3NpdGlvbn0uXG5cdCAqLyBzb3VyY2VQb3NpdGlvbjtcbiAgICAvKipcblx0ICogU3VtbWFyeSBvZmZzZXQgc2l6ZSBvZiBub2RlcyB3aGljaCB3aWxsIGJlIG1vdmVkIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50IHRvIHRoZSBuZXcgcGFyZW50LlxuXHQgKi8gaG93TWFueTtcbiAgICAvKipcblx0ICogUG9zaXRpb24gd2hpY2ggdGhlIG5vZGVzIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50cyB3aWxsIGJlIG1vdmVkIHRvLlxuXHQgKi8gdGFyZ2V0UG9zaXRpb247XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGluIGdyYXZleWFyZCB0byB3aGljaCB0aGUgbWVyZ2VkIGVsZW1lbnQgd2lsbCBiZSBtb3ZlZC5cblx0ICovIGdyYXZleWFyZFBvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbWVyZ2Ugb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gc291cmNlUG9zaXRpb24gUG9zaXRpb24gaW5zaWRlIHRoZSBtZXJnZWQgZWxlbWVudC4gQWxsIG5vZGVzIGZyb20gdGhhdFxuXHQgKiBlbGVtZW50IGFmdGVyIHRoYXQgcG9zaXRpb24gd2lsbCBiZSBtb3ZlZCB0byB7QGxpbmsgI3RhcmdldFBvc2l0aW9ufS5cblx0ICogQHBhcmFtIGhvd01hbnkgU3VtbWFyeSBvZmZzZXQgc2l6ZSBvZiBub2RlcyB3aGljaCB3aWxsIGJlIG1vdmVkIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50IHRvIHRoZSBuZXcgcGFyZW50LlxuXHQgKiBAcGFyYW0gdGFyZ2V0UG9zaXRpb24gUG9zaXRpb24gd2hpY2ggdGhlIG5vZGVzIGZyb20gdGhlIG1lcmdlZCBlbGVtZW50cyB3aWxsIGJlIG1vdmVkIHRvLlxuXHQgKiBAcGFyYW0gZ3JhdmV5YXJkUG9zaXRpb24gUG9zaXRpb24gaW4gZ3JhdmV5YXJkIHRvIHdoaWNoIHRoZSBtZXJnZWQgZWxlbWVudCB3aWxsIGJlIG1vdmVkLlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gRG9jdW1lbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uXG5cdCAqIGNhbiBiZSBhcHBsaWVkIG9yIGBudWxsYCBpZiB0aGUgb3BlcmF0aW9uIG9wZXJhdGVzIG9uIGRldGFjaGVkIChub24tZG9jdW1lbnQpIHRyZWUuXG5cdCAqLyBjb25zdHJ1Y3Rvcihzb3VyY2VQb3NpdGlvbiwgaG93TWFueSwgdGFyZ2V0UG9zaXRpb24sIGdyYXZleWFyZFBvc2l0aW9uLCBiYXNlVmVyc2lvbil7XG4gICAgICAgIHN1cGVyKGJhc2VWZXJzaW9uKTtcbiAgICAgICAgdGhpcy5zb3VyY2VQb3NpdGlvbiA9IHNvdXJjZVBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIC8vIFRoaXMgaXMsIGFuZCBzaG91bGQgYWx3YXlzIHJlbWFpbiwgdGhlIGZpcnN0IHBvc2l0aW9uIGluIGl0cyBwYXJlbnQuXG4gICAgICAgIHRoaXMuc291cmNlUG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b1ByZXZpb3VzJztcbiAgICAgICAgdGhpcy5ob3dNYW55ID0gaG93TWFueTtcbiAgICAgICAgdGhpcy50YXJnZXRQb3NpdGlvbiA9IHRhcmdldFBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIC8vIEV4Y2VwdCBvZiBhIHJhcmUgc2NlbmFyaW8gaW4gYE1lcmdlT3BlcmF0aW9uYCB4IGBNZXJnZU9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24sXG4gICAgICAgIC8vIHRoaXMgaXMsIGFuZCBzaG91bGQgYWx3YXlzIHJlbWFpbiwgdGhlIGxhc3QgcG9zaXRpb24gaW4gaXRzIHBhcmVudC5cbiAgICAgICAgdGhpcy50YXJnZXRQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgICAgIHRoaXMuZ3JhdmV5YXJkUG9zaXRpb24gPSBncmF2ZXlhcmRQb3NpdGlvbi5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCB0eXBlKCkge1xuICAgICAgICByZXR1cm4gJ21lcmdlJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBvc2l0aW9uIGJlZm9yZSB0aGUgbWVyZ2VkIGVsZW1lbnQgKHdoaWNoIHdpbGwgYmUgZGVsZXRlZCkuXG5cdCAqLyBnZXQgZGVsZXRpb25Qb3NpdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbih0aGlzLnNvdXJjZVBvc2l0aW9uLnJvb3QsIHRoaXMuc291cmNlUG9zaXRpb24ucGF0aC5zbGljZSgwLCAtMSkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQXJ0aWZpY2lhbCByYW5nZSB0aGF0IGNvbnRhaW5zIGFsbCB0aGUgbm9kZXMgZnJvbSB0aGUgbWVyZ2VkIGVsZW1lbnQgdGhhdCB3aWxsIGJlIG1vdmVkIHRvIHtAbGluayB+TWVyZ2VPcGVyYXRpb24jc291cmNlUG9zaXRpb259LlxuXHQgKiBUaGUgcmFuZ2Ugc3RhcnRzIGF0IHtAbGluayB+TWVyZ2VPcGVyYXRpb24jc291cmNlUG9zaXRpb259IGFuZCBlbmRzIGluIHRoZSBzYW1lIHBhcmVudCwgYXQgYFBPU0lUSVZFX0lORklOSVRZYCBvZmZzZXQuXG5cdCAqLyBnZXQgbW92ZWRSYW5nZSgpIHtcbiAgICAgICAgY29uc3QgZW5kID0gdGhpcy5zb3VyY2VQb3NpdGlvbi5nZXRTaGlmdGVkQnkoTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSh0aGlzLnNvdXJjZVBvc2l0aW9uLCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCBhZmZlY3RlZFNlbGVjdGFibGUoKSB7XG4gICAgICAgIGNvbnN0IG1lcmdlZEVsZW1lbnQgPSB0aGlzLnNvdXJjZVBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIFJhbmdlLl9jcmVhdGVPbihtZXJnZWRFbGVtZW50KSxcbiAgICAgICAgICAgIC8vIFRoZXNlIGNvdWxkIGJlIHBvc2l0aW9ucyBidXQgYFNlbGVjdGFibGVgIHR5cGUgb25seSBzdXBwb3J0cyBgSXRlcmFibGU8UmFuZ2U+YC5cbiAgICAgICAgICAgIFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdCh0aGlzLnRhcmdldFBvc2l0aW9uLCAwKSxcbiAgICAgICAgICAgIFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdCh0aGlzLmdyYXZleWFyZFBvc2l0aW9uLCAwKVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhbiBvcGVyYXRpb24gdGhhdCBoYXMgdGhlIHNhbWUgcGFyYW1ldGVycyBhcyB0aGlzIG9wZXJhdGlvbi5cblx0ICovIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IE1lcmdlT3BlcmF0aW9uKHRoaXMuc291cmNlUG9zaXRpb24sIHRoaXMuaG93TWFueSwgdGhpcy50YXJnZXRQb3NpdGlvbiwgdGhpcy5ncmF2ZXlhcmRQb3NpdGlvbiwgdGhpcy5iYXNlVmVyc2lvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvbn5PcGVyYXRpb24jZ2V0UmV2ZXJzZWQgYE9wZXJhdGlvbiNnZXRSZXZlcnNlZCgpYH0uXG5cdCAqLyBnZXRSZXZlcnNlZCgpIHtcbiAgICAgICAgLy8gUG9zaXRpb25zIGluIHRoaXMgbWV0aG9kIGFyZSB0cmFuc2Zvcm1lZCBieSB0aGlzIG1lcmdlIG9wZXJhdGlvbiBiZWNhdXNlIHRoZSBzcGxpdCBvcGVyYXRpb24gYmFzZXMgb25cbiAgICAgICAgLy8gdGhlIGNvbnRleHQgYWZ0ZXIgdGhpcyBtZXJnZSBvcGVyYXRpb24gaGFwcGVuZWQgKGJlY2F1c2Ugc3BsaXQgb3BlcmF0aW9uIHJldmVyc2VzIGl0KS5cbiAgICAgICAgLy8gU28gd2UgbmVlZCB0byBhY2tub3dsZWRnZSB0aGF0IHRoZSBtZXJnZSBvcGVyYXRpb24gaGFwcGVuZWQgYW5kIHRob3NlIHBvc2l0aW9ucyBjaGFuZ2VkIGEgbGl0dGxlLlxuICAgICAgICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IHRoaXMudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbih0aGlzKTtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuc291cmNlUG9zaXRpb24ucGF0aC5zbGljZSgwLCAtMSk7XG4gICAgICAgIGNvbnN0IGluc2VydGlvblBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKHRoaXMuc291cmNlUG9zaXRpb24ucm9vdCwgcGF0aCkuX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbih0aGlzKTtcbiAgICAgICAgcmV0dXJuIG5ldyBTcGxpdE9wZXJhdGlvbih0YXJnZXRQb3NpdGlvbiwgdGhpcy5ob3dNYW55LCBpbnNlcnRpb25Qb3NpdGlvbiwgdGhpcy5ncmF2ZXlhcmRQb3NpdGlvbiwgdGhpcy5iYXNlVmVyc2lvbiArIDEpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfdmFsaWRhdGUoKSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZUVsZW1lbnQgPSB0aGlzLnNvdXJjZVBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IHRoaXMudGFyZ2V0UG9zaXRpb24ucGFyZW50O1xuICAgICAgICAvLyBWYWxpZGF0ZSB3aGV0aGVyIG1lcmdlIG9wZXJhdGlvbiBoYXMgY29ycmVjdCBwYXJhbWV0ZXJzLlxuICAgICAgICBpZiAoIXNvdXJjZUVsZW1lbnQucGFyZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIE1lcmdlIHNvdXJjZSBwb3NpdGlvbiBpcyBpbnZhbGlkLiBUaGUgZWxlbWVudCB0byBiZSBtZXJnZWQgbXVzdCBoYXZlIGEgcGFyZW50IG5vZGUuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1lcmdlLW9wZXJhdGlvbi1zb3VyY2UtcG9zaXRpb24taW52YWxpZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtZXJnZS1vcGVyYXRpb24tc291cmNlLXBvc2l0aW9uLWludmFsaWQnLCB0aGlzKTtcbiAgICAgICAgfSBlbHNlIGlmICghdGFyZ2V0RWxlbWVudC5wYXJlbnQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogTWVyZ2UgdGFyZ2V0IHBvc2l0aW9uIGlzIGludmFsaWQuIFRoZSBlbGVtZW50IHRvIGJlIG1lcmdlZCBtdXN0IGhhdmUgYSBwYXJlbnQgbm9kZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbWVyZ2Utb3BlcmF0aW9uLXRhcmdldC1wb3NpdGlvbi1pbnZhbGlkXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21lcmdlLW9wZXJhdGlvbi10YXJnZXQtcG9zaXRpb24taW52YWxpZCcsIHRoaXMpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaG93TWFueSAhPSBzb3VyY2VFbGVtZW50Lm1heE9mZnNldCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBNZXJnZSBvcGVyYXRpb24gc3BlY2lmaWVzIHdyb25nIG51bWJlciBvZiBub2RlcyB0byBtb3ZlLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtZXJnZS1vcGVyYXRpb24taG93LW1hbnktaW52YWxpZFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtZXJnZS1vcGVyYXRpb24taG93LW1hbnktaW52YWxpZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9leGVjdXRlKCkge1xuICAgICAgICBjb25zdCBtZXJnZWRFbGVtZW50ID0gdGhpcy5zb3VyY2VQb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHNvdXJjZVJhbmdlID0gUmFuZ2UuX2NyZWF0ZUluKG1lcmdlZEVsZW1lbnQpO1xuICAgICAgICBfbW92ZShzb3VyY2VSYW5nZSwgdGhpcy50YXJnZXRQb3NpdGlvbik7XG4gICAgICAgIF9tb3ZlKFJhbmdlLl9jcmVhdGVPbihtZXJnZWRFbGVtZW50KSwgdGhpcy5ncmF2ZXlhcmRQb3NpdGlvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICBjb25zdCBqc29uID0gc3VwZXIudG9KU09OKCk7XG4gICAgICAgIGpzb24uc291cmNlUG9zaXRpb24gPSBqc29uLnNvdXJjZVBvc2l0aW9uLnRvSlNPTigpO1xuICAgICAgICBqc29uLnRhcmdldFBvc2l0aW9uID0ganNvbi50YXJnZXRQb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAganNvbi5ncmF2ZXlhcmRQb3NpdGlvbiA9IGpzb24uZ3JhdmV5YXJkUG9zaXRpb24udG9KU09OKCk7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01lcmdlT3BlcmF0aW9uJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYE1lcmdlT3BlcmF0aW9uYCBvYmplY3QgZnJvbSBkZXNlcmlhbGl6ZWQgb2JqZWN0LCBpLmUuIGZyb20gcGFyc2VkIEpTT04gc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBEZXNlcmlhbGl6ZWQgSlNPTiBvYmplY3QuXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBEb2N1bWVudCBvbiB3aGljaCB0aGlzIG9wZXJhdGlvbiB3aWxsIGJlIGFwcGxpZWQuXG5cdCAqLyBzdGF0aWMgZnJvbUpTT04oanNvbiwgZG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc291cmNlUG9zaXRpb24gPSBQb3NpdGlvbi5mcm9tSlNPTihqc29uLnNvdXJjZVBvc2l0aW9uLCBkb2N1bWVudCk7XG4gICAgICAgIGNvbnN0IHRhcmdldFBvc2l0aW9uID0gUG9zaXRpb24uZnJvbUpTT04oanNvbi50YXJnZXRQb3NpdGlvbiwgZG9jdW1lbnQpO1xuICAgICAgICBjb25zdCBncmF2ZXlhcmRQb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21KU09OKGpzb24uZ3JhdmV5YXJkUG9zaXRpb24sIGRvY3VtZW50KTtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzKHNvdXJjZVBvc2l0aW9uLCBqc29uLmhvd01hbnksIHRhcmdldFBvc2l0aW9uLCBncmF2ZXlhcmRQb3NpdGlvbiwganNvbi5iYXNlVmVyc2lvbik7XG4gICAgfVxufVxuXG5jbGFzcyBNYXJrZXJPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xuICAgIC8qKlxuXHQgKiBNYXJrZXIgbmFtZS5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBuYW1lO1xuICAgIC8qKlxuXHQgKiBNYXJrZXIgcmFuZ2UgYmVmb3JlIHRoZSBjaGFuZ2UuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gb2xkUmFuZ2U7XG4gICAgLyoqXG5cdCAqIE1hcmtlciByYW5nZSBhZnRlciB0aGUgY2hhbmdlLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIG5ld1JhbmdlO1xuICAgIC8qKlxuXHQgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUgbWFya2VyIG9wZXJhdGlvbiBhZmZlY3RzIHRoZSBkYXRhIHByb2R1Y2VkIGJ5IHRoZSBkYXRhIHBpcGVsaW5lXG5cdCAqIChpcyBwZXJzaXN0ZWQgaW4gdGhlIGVkaXRvcidzIGRhdGEpLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIGFmZmVjdHNEYXRhO1xuICAgIC8qKlxuXHQgKiBNYXJrZXIgY29sbGVjdGlvbiBvbiB3aGljaCBjaGFuZ2Ugc2hvdWxkIGJlIGV4ZWN1dGVkLlxuXHQgKi8gX21hcmtlcnM7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBuYW1lIE1hcmtlciBuYW1lLlxuXHQgKiBAcGFyYW0gb2xkUmFuZ2UgTWFya2VyIHJhbmdlIGJlZm9yZSB0aGUgY2hhbmdlLlxuXHQgKiBAcGFyYW0gbmV3UmFuZ2UgTWFya2VyIHJhbmdlIGFmdGVyIHRoZSBjaGFuZ2UuXG5cdCAqIEBwYXJhbSBtYXJrZXJzIE1hcmtlciBjb2xsZWN0aW9uIG9uIHdoaWNoIGNoYW5nZSBzaG91bGQgYmUgZXhlY3V0ZWQuXG5cdCAqIEBwYXJhbSBhZmZlY3RzRGF0YSBTcGVjaWZpZXMgd2hldGhlciB0aGUgbWFya2VyIG9wZXJhdGlvbiBhZmZlY3RzIHRoZSBkYXRhIHByb2R1Y2VkIGJ5IHRoZSBkYXRhIHBpcGVsaW5lXG5cdCAqIChpcyBwZXJzaXN0ZWQgaW4gdGhlIGVkaXRvcidzIGRhdGEpLlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gRG9jdW1lbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uXG5cdCAqIGNhbiBiZSBhcHBsaWVkIG9yIGBudWxsYCBpZiB0aGUgb3BlcmF0aW9uIG9wZXJhdGVzIG9uIGRldGFjaGVkIChub24tZG9jdW1lbnQpIHRyZWUuXG5cdCAqLyBjb25zdHJ1Y3RvcihuYW1lLCBvbGRSYW5nZSwgbmV3UmFuZ2UsIG1hcmtlcnMsIGFmZmVjdHNEYXRhLCBiYXNlVmVyc2lvbil7XG4gICAgICAgIHN1cGVyKGJhc2VWZXJzaW9uKTtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5vbGRSYW5nZSA9IG9sZFJhbmdlID8gb2xkUmFuZ2UuY2xvbmUoKSA6IG51bGw7XG4gICAgICAgIHRoaXMubmV3UmFuZ2UgPSBuZXdSYW5nZSA/IG5ld1JhbmdlLmNsb25lKCkgOiBudWxsO1xuICAgICAgICB0aGlzLmFmZmVjdHNEYXRhID0gYWZmZWN0c0RhdGE7XG4gICAgICAgIHRoaXMuX21hcmtlcnMgPSBtYXJrZXJzO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCB0eXBlKCkge1xuICAgICAgICByZXR1cm4gJ21hcmtlcic7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IGFmZmVjdGVkU2VsZWN0YWJsZSgpIHtcbiAgICAgICAgY29uc3QgcmFuZ2VzID0gW107XG4gICAgICAgIGlmICh0aGlzLm9sZFJhbmdlKSB7XG4gICAgICAgICAgICByYW5nZXMucHVzaCh0aGlzLm9sZFJhbmdlLmNsb25lKCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5ld1JhbmdlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vbGRSYW5nZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKC4uLnRoaXMubmV3UmFuZ2UuZ2V0RGlmZmVyZW5jZSh0aGlzLm9sZFJhbmdlKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKHRoaXMubmV3UmFuZ2UuY2xvbmUoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJhbmdlcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMgdGhpcyBvcGVyYXRpb24uXG5cdCAqLyBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXJrZXJPcGVyYXRpb24odGhpcy5uYW1lLCB0aGlzLm9sZFJhbmdlLCB0aGlzLm5ld1JhbmdlLCB0aGlzLl9tYXJrZXJzLCB0aGlzLmFmZmVjdHNEYXRhLCB0aGlzLmJhc2VWZXJzaW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiNnZXRSZXZlcnNlZCBgT3BlcmF0aW9uI2dldFJldmVyc2VkKClgfS5cblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICByZXR1cm4gbmV3IE1hcmtlck9wZXJhdGlvbih0aGlzLm5hbWUsIHRoaXMubmV3UmFuZ2UsIHRoaXMub2xkUmFuZ2UsIHRoaXMuX21hcmtlcnMsIHRoaXMuYWZmZWN0c0RhdGEsIHRoaXMuYmFzZVZlcnNpb24gKyAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2V4ZWN1dGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm5ld1JhbmdlKSB7XG4gICAgICAgICAgICB0aGlzLl9tYXJrZXJzLl9zZXQodGhpcy5uYW1lLCB0aGlzLm5ld1JhbmdlLCB0cnVlLCB0aGlzLmFmZmVjdHNEYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX21hcmtlcnMuX3JlbW92ZSh0aGlzLm5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKiBAaW50ZXJuYWxcblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBpZiAodGhpcy5vbGRSYW5nZSkge1xuICAgICAgICAgICAganNvbi5vbGRSYW5nZSA9IHRoaXMub2xkUmFuZ2UudG9KU09OKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubmV3UmFuZ2UpIHtcbiAgICAgICAgICAgIGpzb24ubmV3UmFuZ2UgPSB0aGlzLm5ld1JhbmdlLnRvSlNPTigpO1xuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBqc29uLl9tYXJrZXJzO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdNYXJrZXJPcGVyYXRpb24nO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBgTWFya2VyT3BlcmF0aW9uYCBvYmplY3QgZnJvbSBkZXNlcmlhbGl6ZWQgb2JqZWN0LCBpLmUuIGZyb20gcGFyc2VkIEpTT04gc3RyaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0ganNvbiBEZXNlcmlhbGl6ZWQgSlNPTiBvYmplY3QuXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBEb2N1bWVudCBvbiB3aGljaCB0aGlzIG9wZXJhdGlvbiB3aWxsIGJlIGFwcGxpZWQuXG5cdCAqLyBzdGF0aWMgZnJvbUpTT04oanNvbiwgZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXJrZXJPcGVyYXRpb24oanNvbi5uYW1lLCBqc29uLm9sZFJhbmdlID8gUmFuZ2UuZnJvbUpTT04oanNvbi5vbGRSYW5nZSwgZG9jdW1lbnQpIDogbnVsbCwganNvbi5uZXdSYW5nZSA/IFJhbmdlLmZyb21KU09OKGpzb24ubmV3UmFuZ2UsIGRvY3VtZW50KSA6IG51bGwsIGRvY3VtZW50Lm1vZGVsLm1hcmtlcnMsIGpzb24uYWZmZWN0c0RhdGEsIGpzb24uYmFzZVZlcnNpb24pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBPcGVyYXRpb24gdG8gY2hhbmdlIG5vZGVzJyBhdHRyaWJ1dGUuXG4gKlxuICogVXNpbmcgdGhpcyBjbGFzcyB5b3UgY2FuIGFkZCwgcmVtb3ZlIG9yIGNoYW5nZSB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlLlxuICovIGNsYXNzIEF0dHJpYnV0ZU9wZXJhdGlvbiBleHRlbmRzIE9wZXJhdGlvbiB7XG4gICAgLyoqXG5cdCAqIFJhbmdlIG9uIHdoaWNoIG9wZXJhdGlvbiBzaG91bGQgYmUgYXBwbGllZC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyByYW5nZTtcbiAgICAvKipcblx0ICogS2V5IG9mIGFuIGF0dHJpYnV0ZSB0byBjaGFuZ2Ugb3IgcmVtb3ZlLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIGtleTtcbiAgICAvKipcblx0ICogT2xkIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgb3IgYG51bGxgLCBpZiBhdHRyaWJ1dGUgd2FzIG5vdCBzZXQgYmVmb3JlLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIG9sZFZhbHVlO1xuICAgIC8qKlxuXHQgKiBOZXcgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBvciBgbnVsbGAsIGlmIG9wZXJhdGlvbiBzaG91bGQgcmVtb3ZlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBuZXdWYWx1ZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBvcGVyYXRpb24gdGhhdCBjaGFuZ2VzLCByZW1vdmVzIG9yIGFkZHMgYXR0cmlidXRlcy5cblx0ICpcblx0ICogSWYgb25seSBgbmV3VmFsdWVgIGlzIHNldCwgYXR0cmlidXRlIHdpbGwgYmUgYWRkZWQgb24gYSBub2RlLiBOb3RlIHRoYXQgYWxsIG5vZGVzIGluIG9wZXJhdGlvbidzIHJhbmdlIG11c3Qgbm90XG5cdCAqIGhhdmUgYW4gYXR0cmlidXRlIHdpdGggdGhlIHNhbWUga2V5IGFzIHRoZSBhZGRlZCBhdHRyaWJ1dGUuXG5cdCAqXG5cdCAqIElmIG9ubHkgYG9sZFZhbHVlYCBpcyBzZXQsIHRoZW4gYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IHdpbGwgYmUgcmVtb3ZlZC4gTm90ZSB0aGF0IGFsbCBub2RlcyBpbiBvcGVyYXRpb24ncyByYW5nZVxuXHQgKiBtdXN0IGhhdmUgYW4gYXR0cmlidXRlIHdpdGggdGhhdCBrZXkgYWRkZWQuXG5cdCAqXG5cdCAqIElmIGJvdGggYG5ld1ZhbHVlYCBhbmQgYG9sZFZhbHVlYCBhcmUgc2V0LCB0aGVuIHRoZSBvcGVyYXRpb24gd2lsbCBjaGFuZ2UgdGhlIGF0dHJpYnV0ZSB2YWx1ZS4gTm90ZSB0aGF0IGFsbCBub2RlcyBpblxuXHQgKiBvcGVyYXRpb24ncyByYW5nZXMgbXVzdCBhbHJlYWR5IGhhdmUgYW4gYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IGFuZCBgb2xkVmFsdWVgIGFzIHZhbHVlXG5cdCAqXG5cdCAqIEBwYXJhbSByYW5nZSBSYW5nZSBvbiB3aGljaCB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBhcHBsaWVkLiBNdXN0IGJlIGEgZmxhdCByYW5nZS5cblx0ICogQHBhcmFtIGtleSBLZXkgb2YgYW4gYXR0cmlidXRlIHRvIGNoYW5nZSBvciByZW1vdmUuXG5cdCAqIEBwYXJhbSBvbGRWYWx1ZSBPbGQgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBvciBgbnVsbGAsIGlmIGF0dHJpYnV0ZSB3YXMgbm90IHNldCBiZWZvcmUuXG5cdCAqIEBwYXJhbSBuZXdWYWx1ZSBOZXcgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBvciBgbnVsbGAsIGlmIG9wZXJhdGlvbiBzaG91bGQgcmVtb3ZlIGF0dHJpYnV0ZS5cblx0ICogQHBhcmFtIGJhc2VWZXJzaW9uIERvY3VtZW50IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb259IG9uIHdoaWNoIG9wZXJhdGlvblxuXHQgKiBjYW4gYmUgYXBwbGllZCBvciBgbnVsbGAgaWYgdGhlIG9wZXJhdGlvbiBvcGVyYXRlcyBvbiBkZXRhY2hlZCAobm9uLWRvY3VtZW50KSB0cmVlLlxuXHQgKi8gY29uc3RydWN0b3IocmFuZ2UsIGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlLCBiYXNlVmVyc2lvbil7XG4gICAgICAgIHN1cGVyKGJhc2VWZXJzaW9uKTtcbiAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlLmNsb25lKCk7XG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgICAgICB0aGlzLm9sZFZhbHVlID0gb2xkVmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBvbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5uZXdWYWx1ZSA9IG5ld1ZhbHVlID09PSB1bmRlZmluZWQgPyBudWxsIDogbmV3VmFsdWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm9sZFZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2FkZEF0dHJpYnV0ZSc7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5uZXdWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuICdyZW1vdmVBdHRyaWJ1dGUnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICdjaGFuZ2VBdHRyaWJ1dGUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IGFmZmVjdGVkU2VsZWN0YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2UuY2xvbmUoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMgdGhpcyBvcGVyYXRpb24uXG5cdCAqLyBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdHRyaWJ1dGVPcGVyYXRpb24odGhpcy5yYW5nZSwgdGhpcy5rZXksIHRoaXMub2xkVmFsdWUsIHRoaXMubmV3VmFsdWUsIHRoaXMuYmFzZVZlcnNpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uI2dldFJldmVyc2VkIGBPcGVyYXRpb24jZ2V0UmV2ZXJzZWQoKWB9LlxuXHQgKi8gZ2V0UmV2ZXJzZWQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlT3BlcmF0aW9uKHRoaXMucmFuZ2UsIHRoaXMua2V5LCB0aGlzLm5ld1ZhbHVlLCB0aGlzLm9sZFZhbHVlLCB0aGlzLmJhc2VWZXJzaW9uICsgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gdG9KU09OKCkge1xuICAgICAgICBjb25zdCBqc29uID0gc3VwZXIudG9KU09OKCk7XG4gICAgICAgIGpzb24ucmFuZ2UgPSB0aGlzLnJhbmdlLnRvSlNPTigpO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3ZhbGlkYXRlKCkge1xuICAgICAgICBpZiAoIXRoaXMucmFuZ2UuaXNGbGF0KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSByYW5nZSB0byBjaGFuZ2UgaXMgbm90IGZsYXQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGF0dHJpYnV0ZS1vcGVyYXRpb24tcmFuZ2Utbm90LWZsYXRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignYXR0cmlidXRlLW9wZXJhdGlvbi1yYW5nZS1ub3QtZmxhdCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKHRoaXMub2xkVmFsdWUgIT09IG51bGwgJiYgIWlzRXF1YWwoaXRlbS5nZXRBdHRyaWJ1dGUodGhpcy5rZXkpLCB0aGlzLm9sZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBDaGFuZ2VkIG5vZGUgaGFzIGRpZmZlcmVudCBhdHRyaWJ1dGUgdmFsdWUgdGhhbiBvcGVyYXRpb24ncyBvbGQgYXR0cmlidXRlIHZhbHVlLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgYXR0cmlidXRlLW9wZXJhdGlvbi13cm9uZy1vbGQtdmFsdWVcblx0XHRcdFx0ICogQHBhcmFtIGl0ZW1cblx0XHRcdFx0ICogQHBhcmFtIGtleVxuXHRcdFx0XHQgKiBAcGFyYW0gdmFsdWVcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdhdHRyaWJ1dGUtb3BlcmF0aW9uLXdyb25nLW9sZC12YWx1ZScsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLmtleSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMub2xkVmFsdWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm9sZFZhbHVlID09PSBudWxsICYmIHRoaXMubmV3VmFsdWUgIT09IG51bGwgJiYgaXRlbS5oYXNBdHRyaWJ1dGUodGhpcy5rZXkpKSB7XG4gICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdCAqIFRoZSBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgYWxyZWFkeSBleGlzdHMgZm9yIHRoZSBnaXZlbiBub2RlLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBAZXJyb3IgYXR0cmlidXRlLW9wZXJhdGlvbi1hdHRyaWJ1dGUtZXhpc3RzXG5cdFx0XHRcdCAqIEBwYXJhbSBub2RlXG5cdFx0XHRcdCAqIEBwYXJhbSBrZXlcblx0XHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdhdHRyaWJ1dGUtb3BlcmF0aW9uLWF0dHJpYnV0ZS1leGlzdHMnLCB0aGlzLCB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGU6IGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIGtleTogdGhpcy5rZXlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfZXhlY3V0ZSgpIHtcbiAgICAgICAgLy8gSWYgdmFsdWUgdG8gc2V0IGlzIHNhbWUgYXMgb2xkIHZhbHVlLCBkb24ndCBkbyBhbnl0aGluZy5cbiAgICAgICAgaWYgKCFpc0VxdWFsKHRoaXMub2xkVmFsdWUsIHRoaXMubmV3VmFsdWUpKSB7XG4gICAgICAgICAgICAvLyBFeGVjdXRpb24uXG4gICAgICAgICAgICBfc2V0QXR0cmlidXRlKHRoaXMucmFuZ2UsIHRoaXMua2V5LCB0aGlzLm5ld1ZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0F0dHJpYnV0ZU9wZXJhdGlvbic7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGBBdHRyaWJ1dGVPcGVyYXRpb25gIG9iamVjdCBmcm9tIGRlc2VyaWFsaXplZCBvYmplY3QsIGkuZS4gZnJvbSBwYXJzZWQgSlNPTiBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIERlc2VyaWFsaXplZCBKU09OIG9iamVjdC5cblx0ICogQHBhcmFtIGRvY3VtZW50IERvY3VtZW50IG9uIHdoaWNoIHRoaXMgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZU9wZXJhdGlvbihSYW5nZS5mcm9tSlNPTihqc29uLnJhbmdlLCBkb2N1bWVudCksIGpzb24ua2V5LCBqc29uLm9sZFZhbHVlLCBqc29uLm5ld1ZhbHVlLCBqc29uLmJhc2VWZXJzaW9uKTtcbiAgICB9XG59XG5cbi8qKlxuICogT3BlcmF0aW9uIHdoaWNoIGlzIGRvaW5nIG5vdGhpbmcgKFwiZW1wdHkgb3BlcmF0aW9uXCIsIFwiZG8tbm90aGluZyBvcGVyYXRpb25cIiwgXCJub29wXCIpLiBUaGlzIGlzIGFuIG9wZXJhdGlvbixcbiAqIHdoaWNoIHdoZW4gZXhlY3V0ZWQgZG9lcyBub3QgY2hhbmdlIHRoZSB0cmVlIG1vZGVsLiBJdCBzdGlsbCBoYXMgc29tZSBwYXJhbWV0ZXJzIGRlZmluZWQgZm9yIHRyYW5zZm9ybWF0aW9uIHB1cnBvc2VzLlxuICpcbiAqIEluIG1vc3QgY2FzZXMgdGhpcyBvcGVyYXRpb24gaXMgYSByZXN1bHQgb2YgdHJhbnNmb3JtaW5nIG9wZXJhdGlvbnMuIFdoZW4gdHJhbnNmb3JtYXRpb24gcmV0dXJuc1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL25vb3BlcmF0aW9ufk5vT3BlcmF0aW9ufSBpdCBtZWFucyB0aGF0IGNoYW5nZXMgZG9uZSBieSB0aGUgdHJhbnNmb3JtZWQgb3BlcmF0aW9uXG4gKiBoYXZlIGFscmVhZHkgYmVlbiBhcHBsaWVkLlxuICovIGNsYXNzIE5vT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcbiAgICBnZXQgdHlwZSgpIHtcbiAgICAgICAgcmV0dXJuICdub29wJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBnZXQgYWZmZWN0ZWRTZWxlY3RhYmxlKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMgdGhpcyBvcGVyYXRpb24uXG5cdCAqLyBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBOb09wZXJhdGlvbih0aGlzLmJhc2VWZXJzaW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiNnZXRSZXZlcnNlZCBgT3BlcmF0aW9uI2dldFJldmVyc2VkKClgfS5cblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICByZXR1cm4gbmV3IE5vT3BlcmF0aW9uKHRoaXMuYmFzZVZlcnNpb24gKyAxKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqLyBfZXhlY3V0ZSgpIHt9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdOb09wZXJhdGlvbic7XG4gICAgfVxufVxuXG4vKipcbiAqIE9wZXJhdGlvbiB0byBjaGFuZ2UgZWxlbWVudCdzIG5hbWUuXG4gKlxuICogVXNpbmcgdGhpcyBjbGFzcyB5b3UgY2FuIGNoYW5nZSBlbGVtZW50J3MgbmFtZS5cbiAqLyBjbGFzcyBSZW5hbWVPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xuICAgIC8qKlxuXHQgKiBQb3NpdGlvbiBiZWZvcmUgYW4gZWxlbWVudCB0byBjaGFuZ2UuXG5cdCAqLyBwb3NpdGlvbjtcbiAgICAvKipcblx0ICogQ3VycmVudCBuYW1lIG9mIHRoZSBlbGVtZW50LlxuXHQgKi8gb2xkTmFtZTtcbiAgICAvKipcblx0ICogTmV3IG5hbWUgZm9yIHRoZSBlbGVtZW50LlxuXHQgKi8gbmV3TmFtZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBvcGVyYXRpb24gdGhhdCBjaGFuZ2VzIGVsZW1lbnQncyBuYW1lLlxuXHQgKlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gYmVmb3JlIGFuIGVsZW1lbnQgdG8gY2hhbmdlLlxuXHQgKiBAcGFyYW0gb2xkTmFtZSBDdXJyZW50IG5hbWUgb2YgdGhlIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBuZXdOYW1lIE5ldyBuYW1lIGZvciB0aGUgZWxlbWVudC5cblx0ICogQHBhcmFtIGJhc2VWZXJzaW9uIERvY3VtZW50IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3ZlcnNpb259IG9uIHdoaWNoIG9wZXJhdGlvblxuXHQgKiBjYW4gYmUgYXBwbGllZCBvciBgbnVsbGAgaWYgdGhlIG9wZXJhdGlvbiBvcGVyYXRlcyBvbiBkZXRhY2hlZCAobm9uLWRvY3VtZW50KSB0cmVlLlxuXHQgKi8gY29uc3RydWN0b3IocG9zaXRpb24sIG9sZE5hbWUsIG5ld05hbWUsIGJhc2VWZXJzaW9uKXtcbiAgICAgICAgc3VwZXIoYmFzZVZlcnNpb24pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIC8vIFRoaXMgcG9zaXRpb24gc3RpY2tzIHRvIHRoZSBuZXh0IG5vZGUgYmVjYXVzZSBpdCBpcyBhIHBvc2l0aW9uIGJlZm9yZSB0aGUgbm9kZSB0aGF0IHdlIHdhbnQgdG8gY2hhbmdlLlxuICAgICAgICB0aGlzLnBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9OZXh0JztcbiAgICAgICAgdGhpcy5vbGROYW1lID0gb2xkTmFtZTtcbiAgICAgICAgdGhpcy5uZXdOYW1lID0gbmV3TmFtZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBnZXQgdHlwZSgpIHtcbiAgICAgICAgcmV0dXJuICdyZW5hbWUnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCBhZmZlY3RlZFNlbGVjdGFibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMgdGhpcyBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEByZXR1cm5zIENsb25lIG9mIHRoaXMgb3BlcmF0aW9uLlxuXHQgKi8gY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVuYW1lT3BlcmF0aW9uKHRoaXMucG9zaXRpb24uY2xvbmUoKSwgdGhpcy5vbGROYW1lLCB0aGlzLm5ld05hbWUsIHRoaXMuYmFzZVZlcnNpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uI2dldFJldmVyc2VkIGBPcGVyYXRpb24jZ2V0UmV2ZXJzZWQoKWB9LlxuXHQgKi8gZ2V0UmV2ZXJzZWQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVuYW1lT3BlcmF0aW9uKHRoaXMucG9zaXRpb24uY2xvbmUoKSwgdGhpcy5uZXdOYW1lLCB0aGlzLm9sZE5hbWUsIHRoaXMuYmFzZVZlcnNpb24gKyAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3ZhbGlkYXRlKCkge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5wb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgICAgIGlmICghKGVsZW1lbnQgaW5zdGFuY2VvZiBFbGVtZW50KSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBHaXZlbiBwb3NpdGlvbiBpcyBpbnZhbGlkIG9yIG5vZGUgYWZ0ZXIgaXQgaXMgbm90IGluc3RhbmNlIG9mIEVsZW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHJlbmFtZS1vcGVyYXRpb24td3JvbmctcG9zaXRpb25cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigncmVuYW1lLW9wZXJhdGlvbi13cm9uZy1wb3NpdGlvbicsIHRoaXMpO1xuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQubmFtZSAhPT0gdGhpcy5vbGROYW1lKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEVsZW1lbnQgdG8gY2hhbmdlIGhhcyBkaWZmZXJlbnQgbmFtZSB0aGFuIG9wZXJhdGlvbidzIG9sZCBuYW1lLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciByZW5hbWUtb3BlcmF0aW9uLXdyb25nLW5hbWVcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigncmVuYW1lLW9wZXJhdGlvbi13cm9uZy1uYW1lJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2V4ZWN1dGUoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLnBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgZWxlbWVudC5uYW1lID0gdGhpcy5uZXdOYW1lO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBqc29uLnBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbi50b0pTT04oKTtcbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBjbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiAnUmVuYW1lT3BlcmF0aW9uJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYFJlbmFtZU9wZXJhdGlvbmAgb2JqZWN0IGZyb20gZGVzZXJpYWxpemVkIG9iamVjdCwgaS5lLiBmcm9tIHBhcnNlZCBKU09OIHN0cmluZy5cblx0ICpcblx0ICogQHBhcmFtIGpzb24gRGVzZXJpYWxpemVkIEpTT04gb2JqZWN0LlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgRG9jdW1lbnQgb24gd2hpY2ggdGhpcyBvcGVyYXRpb24gd2lsbCBiZSBhcHBsaWVkLlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24sIGRvY3VtZW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVuYW1lT3BlcmF0aW9uKFBvc2l0aW9uLmZyb21KU09OKGpzb24ucG9zaXRpb24sIGRvY3VtZW50KSwganNvbi5vbGROYW1lLCBqc29uLm5ld05hbWUsIGpzb24uYmFzZVZlcnNpb24pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBPcGVyYXRpb24gdG8gY2hhbmdlIHJvb3QgZWxlbWVudCdzIGF0dHJpYnV0ZS4gVXNpbmcgdGhpcyBjbGFzcyB5b3UgY2FuIGFkZCwgcmVtb3ZlIG9yIGNoYW5nZSB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlLlxuICpcbiAqIFRoaXMgb3BlcmF0aW9uIGlzIG5lZWRlZCwgYmVjYXVzZSByb290IGVsZW1lbnRzIGNhbid0IGJlIGNoYW5nZWQgdGhyb3VnaFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL2F0dHJpYnV0ZW9wZXJhdGlvbn5BdHRyaWJ1dGVPcGVyYXRpb259LlxuICogSXQgaXMgYmVjYXVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vYXR0cmlidXRlb3BlcmF0aW9ufkF0dHJpYnV0ZU9wZXJhdGlvbn1cbiAqIHJlcXVpcmVzIGEgcmFuZ2UgdG8gY2hhbmdlIGFuZCByb290IGVsZW1lbnQgY2FuJ3RcbiAqIGJlIGEgcGFydCBvZiByYW5nZSBiZWNhdXNlIGV2ZXJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBoYXMgdG8gYmUgaW5zaWRlIGEgcm9vdC5cbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9ufSBjYW4ndCBiZSBjcmVhdGVkIGJlZm9yZSBhIHJvb3QgZWxlbWVudC5cbiAqLyBjbGFzcyBSb290QXR0cmlidXRlT3BlcmF0aW9uIGV4dGVuZHMgT3BlcmF0aW9uIHtcbiAgICAvKipcblx0ICogUm9vdCBlbGVtZW50IHRvIGNoYW5nZS5cblx0ICovIHJvb3Q7XG4gICAgLyoqXG5cdCAqIEtleSBvZiBhbiBhdHRyaWJ1dGUgdG8gY2hhbmdlIG9yIHJlbW92ZS5cblx0ICovIGtleTtcbiAgICAvKipcblx0ICogT2xkIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgb3IgYG51bGxgLCBpZiBhdHRyaWJ1dGUgd2FzIG5vdCBzZXQgYmVmb3JlLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIG9sZFZhbHVlO1xuICAgIC8qKlxuXHQgKiBOZXcgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBvciBgbnVsbGAsIGlmIG9wZXJhdGlvbiBzaG91bGQgcmVtb3ZlIGF0dHJpYnV0ZS5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBuZXdWYWx1ZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBvcGVyYXRpb24gdGhhdCBjaGFuZ2VzLCByZW1vdmVzIG9yIGFkZHMgYXR0cmlidXRlcyBvbiByb290IGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vYXR0cmlidXRlb3BlcmF0aW9ufkF0dHJpYnV0ZU9wZXJhdGlvblxuXHQgKiBAcGFyYW0gcm9vdCBSb290IGVsZW1lbnQgdG8gY2hhbmdlLlxuXHQgKiBAcGFyYW0ga2V5IEtleSBvZiBhbiBhdHRyaWJ1dGUgdG8gY2hhbmdlIG9yIHJlbW92ZS5cblx0ICogQHBhcmFtIG9sZFZhbHVlIE9sZCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IG9yIGBudWxsYCwgaWYgYXR0cmlidXRlIHdhcyBub3Qgc2V0IGJlZm9yZS5cblx0ICogQHBhcmFtIG5ld1ZhbHVlIE5ldyB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IG9yIGBudWxsYCwgaWYgb3BlcmF0aW9uIHNob3VsZCByZW1vdmUgYXR0cmlidXRlLlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gRG9jdW1lbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uXG5cdCAqIGNhbiBiZSBhcHBsaWVkIG9yIGBudWxsYCBpZiB0aGUgb3BlcmF0aW9uIG9wZXJhdGVzIG9uIGRldGFjaGVkIChub24tZG9jdW1lbnQpIHRyZWUuXG5cdCAqLyBjb25zdHJ1Y3Rvcihyb290LCBrZXksIG9sZFZhbHVlLCBuZXdWYWx1ZSwgYmFzZVZlcnNpb24pe1xuICAgICAgICBzdXBlcihiYXNlVmVyc2lvbik7XG4gICAgICAgIHRoaXMucm9vdCA9IHJvb3Q7XG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgICAgICB0aGlzLm9sZFZhbHVlID0gb2xkVmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBvbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5uZXdWYWx1ZSA9IG5ld1ZhbHVlID09PSB1bmRlZmluZWQgPyBudWxsIDogbmV3VmFsdWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm9sZFZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2FkZFJvb3RBdHRyaWJ1dGUnO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubmV3VmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiAncmVtb3ZlUm9vdEF0dHJpYnV0ZSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ2NoYW5nZVJvb3RBdHRyaWJ1dGUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IGFmZmVjdGVkU2VsZWN0YWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW5kIHJldHVybnMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIHRoZSBzYW1lIHBhcmFtZXRlcnMgYXMgdGhpcyBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEByZXR1cm5zIENsb25lIG9mIHRoaXMgb3BlcmF0aW9uLlxuXHQgKi8gY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUm9vdEF0dHJpYnV0ZU9wZXJhdGlvbih0aGlzLnJvb3QsIHRoaXMua2V5LCB0aGlzLm9sZFZhbHVlLCB0aGlzLm5ld1ZhbHVlLCB0aGlzLmJhc2VWZXJzaW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiNnZXRSZXZlcnNlZCBgT3BlcmF0aW9uI2dldFJldmVyc2VkKClgfS5cblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJvb3RBdHRyaWJ1dGVPcGVyYXRpb24odGhpcy5yb290LCB0aGlzLmtleSwgdGhpcy5uZXdWYWx1ZSwgdGhpcy5vbGRWYWx1ZSwgdGhpcy5iYXNlVmVyc2lvbiArIDEpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfdmFsaWRhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnJvb3QgIT0gdGhpcy5yb290LnJvb3QgfHwgdGhpcy5yb290LmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhlIGVsZW1lbnQgdG8gY2hhbmdlIGlzIG5vdCBhIHJvb3QgZWxlbWVudC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igcm9vdGF0dHJpYnV0ZS1vcGVyYXRpb24tbm90LWEtcm9vdFxuXHRcdFx0ICogQHBhcmFtIHJvb3Rcblx0XHRcdCAqIEBwYXJhbSBrZXlcblx0XHRcdCAqIEBwYXJhbSB2YWx1ZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdyb290YXR0cmlidXRlLW9wZXJhdGlvbi1ub3QtYS1yb290JywgdGhpcywge1xuICAgICAgICAgICAgICAgIHJvb3Q6IHRoaXMucm9vdCxcbiAgICAgICAgICAgICAgICBrZXk6IHRoaXMua2V5XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vbGRWYWx1ZSAhPT0gbnVsbCAmJiB0aGlzLnJvb3QuZ2V0QXR0cmlidXRlKHRoaXMua2V5KSAhPT0gdGhpcy5vbGRWYWx1ZSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgYXR0cmlidXRlIHdoaWNoIHNob3VsZCBiZSByZW1vdmVkIGRvZXMgbm90IGV4aXN0IGZvciB0aGUgZ2l2ZW4gbm9kZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igcm9vdGF0dHJpYnV0ZS1vcGVyYXRpb24td3Jvbmctb2xkLXZhbHVlXG5cdFx0XHQgKiBAcGFyYW0gcm9vdFxuXHRcdFx0ICogQHBhcmFtIGtleVxuXHRcdFx0ICogQHBhcmFtIHZhbHVlXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3Jvb3RhdHRyaWJ1dGUtb3BlcmF0aW9uLXdyb25nLW9sZC12YWx1ZScsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICByb290OiB0aGlzLnJvb3QsXG4gICAgICAgICAgICAgICAga2V5OiB0aGlzLmtleVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub2xkVmFsdWUgPT09IG51bGwgJiYgdGhpcy5uZXdWYWx1ZSAhPT0gbnVsbCAmJiB0aGlzLnJvb3QuaGFzQXR0cmlidXRlKHRoaXMua2V5KSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgYXR0cmlidXRlIHdpdGggZ2l2ZW4ga2V5IGFscmVhZHkgZXhpc3RzIGZvciB0aGUgZ2l2ZW4gbm9kZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igcm9vdGF0dHJpYnV0ZS1vcGVyYXRpb24tYXR0cmlidXRlLWV4aXN0c1xuXHRcdFx0ICogQHBhcmFtIHJvb3Rcblx0XHRcdCAqIEBwYXJhbSBrZXlcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcigncm9vdGF0dHJpYnV0ZS1vcGVyYXRpb24tYXR0cmlidXRlLWV4aXN0cycsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICByb290OiB0aGlzLnJvb3QsXG4gICAgICAgICAgICAgICAga2V5OiB0aGlzLmtleVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2V4ZWN1dGUoKSB7XG4gICAgICAgIGlmICh0aGlzLm5ld1ZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnJvb3QuX3NldEF0dHJpYnV0ZSh0aGlzLmtleSwgdGhpcy5uZXdWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJvb3QuX3JlbW92ZUF0dHJpYnV0ZSh0aGlzLmtleSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pTT04oKTtcbiAgICAgICAganNvbi5yb290ID0gdGhpcy5yb290LnRvSlNPTigpO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGNsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdSb290QXR0cmlidXRlT3BlcmF0aW9uJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYFJvb3RBdHRyaWJ1dGVPcGVyYXRpb25gIG9iamVjdCBmcm9tIGRlc2VyaWFsaXplZCBvYmplY3QsIGkuZS4gZnJvbSBwYXJzZWQgSlNPTiBzdHJpbmcuXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIERlc2VyaWFsaXplZCBKU09OIG9iamVjdC5cblx0ICogQHBhcmFtIGRvY3VtZW50IERvY3VtZW50IG9uIHdoaWNoIHRoaXMgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2N1bWVudCkge1xuICAgICAgICBpZiAoIWRvY3VtZW50LmdldFJvb3QoanNvbi5yb290KSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBDYW5ub3QgY3JlYXRlIFJvb3RBdHRyaWJ1dGVPcGVyYXRpb24gZm9yIGRvY3VtZW50LiBSb290IHdpdGggc3BlY2lmaWVkIG5hbWUgZG9lcyBub3QgZXhpc3QuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHJvb3RhdHRyaWJ1dGUtb3BlcmF0aW9uLWZyb21qc29uLW5vLXJvb3Rcblx0XHRcdCAqIEBwYXJhbSByb290TmFtZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdyb290YXR0cmlidXRlLW9wZXJhdGlvbi1mcm9tanNvbi1uby1yb290JywgdGhpcywge1xuICAgICAgICAgICAgICAgIHJvb3ROYW1lOiBqc29uLnJvb3RcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUm9vdEF0dHJpYnV0ZU9wZXJhdGlvbihkb2N1bWVudC5nZXRSb290KGpzb24ucm9vdCksIGpzb24ua2V5LCBqc29uLm9sZFZhbHVlLCBqc29uLm5ld1ZhbHVlLCBqc29uLmJhc2VWZXJzaW9uKTtcbiAgICB9XG59XG5cbi8qKlxuICogT3BlcmF0aW9uIHRoYXQgY3JlYXRlcyAob3IgYXR0YWNoZXMpIG9yIGRldGFjaGVzIGEgcm9vdCBlbGVtZW50LlxuICovIGNsYXNzIFJvb3RPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xuICAgIC8qKlxuXHQgKiBSb290IG5hbWUgdG8gY3JlYXRlIG9yIGRldGFjaC5cblx0ICovIHJvb3ROYW1lO1xuICAgIC8qKlxuXHQgKiBSb290IGVsZW1lbnQgbmFtZS5cblx0ICovIGVsZW1lbnROYW1lO1xuICAgIC8qKlxuXHQgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUgb3BlcmF0aW9uIGFkZHMgKGB0cnVlYCkgb3IgZGV0YWNoZXMgdGhlIHJvb3QgKGBmYWxzZWApLlxuXHQgKi8gaXNBZGQ7XG4gICAgLyoqXG5cdCAqIERvY3VtZW50IHdoaWNoIG93bnMgdGhlIHJvb3QuXG5cdCAqLyBfZG9jdW1lbnQ7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gb3BlcmF0aW9uIHRoYXQgY3JlYXRlcyBvciByZW1vdmVzIGEgcm9vdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gcm9vdE5hbWUgUm9vdCBuYW1lIHRvIGNyZWF0ZSBvciBkZXRhY2guXG5cdCAqIEBwYXJhbSBlbGVtZW50TmFtZSBSb290IGVsZW1lbnQgbmFtZS5cblx0ICogQHBhcmFtIGlzQWRkIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBvcGVyYXRpb24gYWRkcyAoYHRydWVgKSBvciBkZXRhY2hlcyB0aGUgcm9vdCAoYGZhbHNlYCkuXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBEb2N1bWVudCB3aGljaCBvd25zIHRoZSByb290LlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gRG9jdW1lbnQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjdmVyc2lvbn0gb24gd2hpY2ggb3BlcmF0aW9uIGNhbiBiZSBhcHBsaWVkLlxuXHQgKi8gY29uc3RydWN0b3Iocm9vdE5hbWUsIGVsZW1lbnROYW1lLCBpc0FkZCwgZG9jdW1lbnQsIGJhc2VWZXJzaW9uKXtcbiAgICAgICAgc3VwZXIoYmFzZVZlcnNpb24pO1xuICAgICAgICB0aGlzLnJvb3ROYW1lID0gcm9vdE5hbWU7XG4gICAgICAgIHRoaXMuZWxlbWVudE5hbWUgPSBlbGVtZW50TmFtZTtcbiAgICAgICAgdGhpcy5pc0FkZCA9IGlzQWRkO1xuICAgICAgICB0aGlzLl9kb2N1bWVudCA9IGRvY3VtZW50O1xuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0aGUgcm9vdCBleGlzdHMgQVNBUCwgdGhpcyBpcyBpbXBvcnRhbnQgZm9yIFJUQy5cbiAgICAgICAgLy8gSWYgdGhlIHJvb3Qgd2FzIGR5bmFtaWNhbGx5IGFkZGVkLCB0aGVyZSB3aWxsIGJlIG1vcmUgb3BlcmF0aW9ucyB0aGF0IG9wZXJhdGUgb24vaW4gdGhpcyByb290LlxuICAgICAgICAvLyBUaGVzZSBvcGVyYXRpb25zIHdpbGwgcmVxdWlyZSByb290IGVsZW1lbnQgaW5zdGFuY2UgKGluIG9wZXJhdGlvbiBwcm9wZXJ0eSBvciBpbiBwb3NpdGlvbiBpbnN0YW5jZSkuXG4gICAgICAgIC8vIElmIHRoZSByb290IGlzIG5vdCBjcmVhdGVkIGFoZWFkIG9mIHRpbWUsIGluc3RhbnRpYXRpbmcgc3VjaCBvcGVyYXRpb25zIG1heSBmYWlsLlxuICAgICAgICBpZiAoIXRoaXMuX2RvY3VtZW50LmdldFJvb3QodGhpcy5yb290TmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVSb290KHRoaXMuZWxlbWVudE5hbWUsIHRoaXMucm9vdE5hbWUpO1xuICAgICAgICAgICAgcm9vdC5faXNBdHRhY2hlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQWRkID8gJ2FkZFJvb3QnIDogJ2RldGFjaFJvb3QnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldCBhZmZlY3RlZFNlbGVjdGFibGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kb2N1bWVudC5nZXRSb290KHRoaXMucm9vdE5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJvb3RPcGVyYXRpb24odGhpcy5yb290TmFtZSwgdGhpcy5lbGVtZW50TmFtZSwgdGhpcy5pc0FkZCwgdGhpcy5fZG9jdW1lbnQsIHRoaXMuYmFzZVZlcnNpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGdldFJldmVyc2VkKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJvb3RPcGVyYXRpb24odGhpcy5yb290TmFtZSwgdGhpcy5lbGVtZW50TmFtZSwgIXRoaXMuaXNBZGQsIHRoaXMuX2RvY3VtZW50LCB0aGlzLmJhc2VWZXJzaW9uICsgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gX2V4ZWN1dGUoKSB7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50LmdldFJvb3QodGhpcy5yb290TmFtZSkuX2lzQXR0YWNoZWQgPSB0aGlzLmlzQWRkO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IHN1cGVyLnRvSlNPTigpO1xuICAgICAgICBkZWxldGUganNvbi5fZG9jdW1lbnQ7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ1Jvb3RPcGVyYXRpb24nO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBgUm9vdE9wZXJhdGlvbmAgb2JqZWN0IGZyb20gZGVzZXJpYWxpemVkIG9iamVjdCwgaS5lLiBmcm9tIHBhcnNlZCBKU09OIHN0cmluZy5cblx0ICpcblx0ICogQHBhcmFtIGpzb24gRGVzZXJpYWxpemVkIEpTT04gb2JqZWN0LlxuXHQgKiBAcGFyYW0gZG9jdW1lbnQgRG9jdW1lbnQgb24gd2hpY2ggdGhpcyBvcGVyYXRpb24gd2lsbCBiZSBhcHBsaWVkLlxuXHQgKi8gc3RhdGljIGZyb21KU09OKGpzb24sIGRvY3VtZW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgUm9vdE9wZXJhdGlvbihqc29uLnJvb3ROYW1lLCBqc29uLmVsZW1lbnROYW1lLCBqc29uLmlzQWRkLCBkb2N1bWVudCwganNvbi5iYXNlVmVyc2lvbik7XG4gICAgfVxufVxuXG5jb25zdCBvcGVyYXRpb25zID0ge307XG5vcGVyYXRpb25zW0F0dHJpYnV0ZU9wZXJhdGlvbi5jbGFzc05hbWVdID0gQXR0cmlidXRlT3BlcmF0aW9uO1xub3BlcmF0aW9uc1tJbnNlcnRPcGVyYXRpb24uY2xhc3NOYW1lXSA9IEluc2VydE9wZXJhdGlvbjtcbm9wZXJhdGlvbnNbTWFya2VyT3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBNYXJrZXJPcGVyYXRpb247XG5vcGVyYXRpb25zW01vdmVPcGVyYXRpb24uY2xhc3NOYW1lXSA9IE1vdmVPcGVyYXRpb247XG5vcGVyYXRpb25zW05vT3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBOb09wZXJhdGlvbjtcbm9wZXJhdGlvbnNbT3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBPcGVyYXRpb247XG5vcGVyYXRpb25zW1JlbmFtZU9wZXJhdGlvbi5jbGFzc05hbWVdID0gUmVuYW1lT3BlcmF0aW9uO1xub3BlcmF0aW9uc1tSb290QXR0cmlidXRlT3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBSb290QXR0cmlidXRlT3BlcmF0aW9uO1xub3BlcmF0aW9uc1tSb290T3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBSb290T3BlcmF0aW9uO1xub3BlcmF0aW9uc1tTcGxpdE9wZXJhdGlvbi5jbGFzc05hbWVdID0gU3BsaXRPcGVyYXRpb247XG5vcGVyYXRpb25zW01lcmdlT3BlcmF0aW9uLmNsYXNzTmFtZV0gPSBNZXJnZU9wZXJhdGlvbjtcbi8qKlxuICogQSBmYWN0b3J5IGNsYXNzIGZvciBjcmVhdGluZyBvcGVyYXRpb25zLlxuICovIGNsYXNzIE9wZXJhdGlvbkZhY3Rvcnkge1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIG9wZXJhdGlvbiBpbnN0YW5jZSBmcm9tIGEgSlNPTiBvYmplY3QgKHBhcnNlZCBKU09OIHN0cmluZykuXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIERlc2VyaWFsaXplZCBKU09OIG9iamVjdC5cblx0ICogQHBhcmFtIGRvY3VtZW50IERvY3VtZW50IG9uIHdoaWNoIHRoaXMgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uLCBkb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gb3BlcmF0aW9uc1tqc29uLl9fY2xhc3NOYW1lXS5mcm9tSlNPTihqc29uLCBkb2N1bWVudCk7XG4gICAgfVxufVxuXG5jb25zdCB0cmFuc2Zvcm1hdGlvbnMgPSBuZXcgTWFwKCk7XG4vKipcbiAqIFNldHMgYSB0cmFuc2Zvcm1hdGlvbiBmdW5jdGlvbiB0byBiZSBiZSB1c2VkIHRvIHRyYW5zZm9ybSBpbnN0YW5jZXMgb2YgY2xhc3MgYE9wZXJhdGlvbkFgIGJ5IGluc3RhbmNlcyBvZiBjbGFzcyBgT3BlcmF0aW9uQmAuXG4gKlxuICogVGhlIGB0cmFuc2Zvcm1hdGlvbkZ1bmN0aW9uYCBpcyBwYXNzZWQgdGhyZWUgcGFyYW1ldGVyczpcbiAqXG4gKiAqIGBhYCAtIG9wZXJhdGlvbiB0byBiZSB0cmFuc2Zvcm1lZCwgYW4gaW5zdGFuY2Ugb2YgYE9wZXJhdGlvbkFgLFxuICogKiBgYmAgLSBvcGVyYXRpb24gdG8gYmUgdHJhbnNmb3JtZWQgYnksIGFuIGluc3RhbmNlIG9mIGBPcGVyYXRpb25CYCxcbiAqICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL3RyYW5zZm9ybX5UcmFuc2Zvcm1hdGlvbkNvbnRleHQgYGNvbnRleHRgfSAtIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYWJvdXRcbiAqIHRyYW5zZm9ybWF0aW9uIGNvbnRleHQuXG4gKlxuICogVGhlIGB0cmFuc2Zvcm1hdGlvbkZ1bmN0aW9uYCBzaG91bGQgcmV0dXJuIHRyYW5zZm9ybWF0aW9uIHJlc3VsdCwgd2hpY2ggaXMgYW4gYXJyYXkgd2l0aCBvbmUgb3IgbXVsdGlwbGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uIG9wZXJhdGlvbn0gaW5zdGFuY2VzLlxuICpcbiAqIEBwYXJhbSB0cmFuc2Zvcm1hdGlvbkZ1bmN0aW9uIEZ1bmN0aW9uIHRvIHVzZSBmb3IgdHJhbnNmb3JtaW5nLlxuICovIGZ1bmN0aW9uIHNldFRyYW5zZm9ybWF0aW9uKE9wZXJhdGlvbkEsIE9wZXJhdGlvbkIsIHRyYW5zZm9ybWF0aW9uRnVuY3Rpb24pIHtcbiAgICBsZXQgYUdyb3VwID0gdHJhbnNmb3JtYXRpb25zLmdldChPcGVyYXRpb25BKTtcbiAgICBpZiAoIWFHcm91cCkge1xuICAgICAgICBhR3JvdXAgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRyYW5zZm9ybWF0aW9ucy5zZXQoT3BlcmF0aW9uQSwgYUdyb3VwKTtcbiAgICB9XG4gICAgYUdyb3VwLnNldChPcGVyYXRpb25CLCB0cmFuc2Zvcm1hdGlvbkZ1bmN0aW9uKTtcbn1cbi8qKlxuICogUmV0dXJucyBhIHByZXZpb3VzbHkgc2V0IHRyYW5zZm9ybWF0aW9uIGZ1bmN0aW9uIGZvciB0cmFuc2Zvcm1pbmcgYW4gaW5zdGFuY2Ugb2YgYE9wZXJhdGlvbkFgIGJ5IGFuIGluc3RhbmNlIG9mIGBPcGVyYXRpb25CYC5cbiAqXG4gKiBJZiBubyB0cmFuc2Zvcm1hdGlvbiB3YXMgc2V0IGZvciBnaXZlbiBwYWlyIG9mIG9wZXJhdGlvbnMsIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi90cmFuc2Zvcm1+bm9VcGRhdGVUcmFuc2Zvcm1hdGlvbn1cbiAqIGlzIHJldHVybmVkLiBUaGlzIG1lYW5zIHRoYXQgaWYgbm8gdHJhbnNmb3JtYXRpb24gd2FzIHNldCwgdGhlIGBPcGVyYXRpb25BYCBpbnN0YW5jZSB3aWxsIG5vdCBjaGFuZ2Ugd2hlbiB0cmFuc2Zvcm1lZFxuICogYnkgdGhlIGBPcGVyYXRpb25CYCBpbnN0YW5jZS5cbiAqXG4gKiBAcmV0dXJucyBGdW5jdGlvbiBzZXQgdG8gdHJhbnNmb3JtIGFuIGluc3RhbmNlIG9mIGBPcGVyYXRpb25BYCBieSBhbiBpbnN0YW5jZSBvZiBgT3BlcmF0aW9uQmAuXG4gKi8gZnVuY3Rpb24gZ2V0VHJhbnNmb3JtYXRpb24oT3BlcmF0aW9uQSwgT3BlcmF0aW9uQikge1xuICAgIGNvbnN0IGFHcm91cCA9IHRyYW5zZm9ybWF0aW9ucy5nZXQoT3BlcmF0aW9uQSk7XG4gICAgaWYgKGFHcm91cCAmJiBhR3JvdXAuaGFzKE9wZXJhdGlvbkIpKSB7XG4gICAgICAgIHJldHVybiBhR3JvdXAuZ2V0KE9wZXJhdGlvbkIpO1xuICAgIH1cbiAgICByZXR1cm4gbm9VcGRhdGVUcmFuc2Zvcm1hdGlvbjtcbn1cbi8qKlxuICogQSB0cmFuc2Zvcm1hdGlvbiBmdW5jdGlvbiB0aGF0IG9ubHkgY2xvbmVzIG9wZXJhdGlvbiB0byB0cmFuc2Zvcm0sIHdpdGhvdXQgY2hhbmdpbmcgaXQuXG4gKi8gZnVuY3Rpb24gbm9VcGRhdGVUcmFuc2Zvcm1hdGlvbihhKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59XG4vKipcbiAqIFRyYW5zZm9ybXMgb3BlcmF0aW9uIGBhYCBieSBvcGVyYXRpb24gYGJgLlxuICpcbiAqIEBwYXJhbSBhIE9wZXJhdGlvbiB0byBiZSB0cmFuc2Zvcm1lZC5cbiAqIEBwYXJhbSBiIE9wZXJhdGlvbiB0byB0cmFuc2Zvcm0gYnkuXG4gKiBAcGFyYW0gY29udGV4dCBUcmFuc2Zvcm1hdGlvbiBjb250ZXh0IGZvciB0aGlzIHRyYW5zZm9ybWF0aW9uLlxuICogQHJldHVybnMgVHJhbnNmb3JtYXRpb24gcmVzdWx0LlxuICovIGZ1bmN0aW9uIHRyYW5zZm9ybSQxKGEsIGIsIGNvbnRleHQgPSB7fSkge1xuICAgIGNvbnN0IHRyYW5zZm9ybWF0aW9uRnVuY3Rpb24gPSBnZXRUcmFuc2Zvcm1hdGlvbihhLmNvbnN0cnVjdG9yLCBiLmNvbnN0cnVjdG9yKTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWNhdGNoICovIHRyeSB7XG4gICAgICAgIGEgPSBhLmNsb25lKCk7XG4gICAgICAgIHJldHVybiB0cmFuc2Zvcm1hdGlvbkZ1bmN0aW9uKGEsIGIsIGNvbnRleHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIGNvbnNvbGUud2FybiggJ0Vycm9yIGR1cmluZyBvcGVyYXRpb24gdHJhbnNmb3JtYXRpb24hJywgZS5tZXNzYWdlICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdUcmFuc2Zvcm1lZCBvcGVyYXRpb24nLCBhICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdPcGVyYXRpb24gdHJhbnNmb3JtZWQgYnknLCBiICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdjb250ZXh0LmFJc1N0cm9uZycsIGNvbnRleHQuYUlzU3Ryb25nICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdjb250ZXh0LmFXYXNVbmRvbmUnLCBjb250ZXh0LmFXYXNVbmRvbmUgKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIGNvbnNvbGUud2FybiggJ2NvbnRleHQuYldhc1VuZG9uZScsIGNvbnRleHQuYldhc1VuZG9uZSApO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUcgLy8gY29uc29sZS53YXJuKCAnY29udGV4dC5hYlJlbGF0aW9uJywgY29udGV4dC5hYlJlbGF0aW9uICk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyBjb25zb2xlLndhcm4oICdjb250ZXh0LmJhUmVsYXRpb24nLCBjb250ZXh0LmJhUmVsYXRpb24gKTtcbiAgICAgICAgdGhyb3cgZTtcbiAgICB9XG4vKiBlc2xpbnQtZW5hYmxlIG5vLXVzZWxlc3MtY2F0Y2ggKi8gfVxuLyoqXG4gKiBQZXJmb3JtcyBhIHRyYW5zZm9ybWF0aW9uIG9mIHR3byBzZXRzIG9mIG9wZXJhdGlvbnMgLSBgb3BlcmF0aW9uc0FgIGFuZCBgb3BlcmF0aW9uc0JgLiBUaGUgdHJhbnNmb3JtYXRpb24gaXMgdHdvLXdheSAtXG4gKiBib3RoIHRyYW5zZm9ybWVkIGBvcGVyYXRpb25zQWAgYW5kIHRyYW5zZm9ybWVkIGBvcGVyYXRpb25zQmAgYXJlIHJldHVybmVkLlxuICpcbiAqIE5vdGUsIHRoYXQgdGhlIGZpcnN0IG9wZXJhdGlvbiBpbiBlYWNoIHNldCBzaG91bGQgYmFzZSBvbiB0aGUgc2FtZSBkb2N1bWVudCBzdGF0ZSAoXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCN2ZXJzaW9uIGRvY3VtZW50IHZlcnNpb259KS5cbiAqXG4gKiBJdCBpcyBhc3N1bWVkIHRoYXQgYG9wZXJhdGlvbnNBYCBhcmUgXCJtb3JlIGltcG9ydGFudFwiIGR1cmluZyBjb25mbGljdCByZXNvbHV0aW9uIGJldHdlZW4gdHdvIG9wZXJhdGlvbnMuXG4gKlxuICogTmV3IGNvcGllcyBvZiBib3RoIHBhc3NlZCBhcnJheXMgYW5kIG9wZXJhdGlvbnMgaW5zaWRlIHRoZW0gYXJlIHJldHVybmVkLiBQYXNzZWQgYXJndW1lbnRzIGFyZSBub3QgYWx0ZXJlZC5cbiAqXG4gKiBCYXNlIHZlcnNpb25zIG9mIHRoZSB0cmFuc2Zvcm1lZCBvcGVyYXRpb25zIHNldHMgYXJlIHVwZGF0ZWQgYWNjb3JkaW5nbHkuIEZvciBleGFtcGxlLCBhc3N1bWUgdGhhdCBiYXNlIHZlcnNpb25zIGFyZSBgNGBcbiAqIGFuZCB0aGVyZSBhcmUgYDNgIG9wZXJhdGlvbnMgaW4gYG9wZXJhdGlvbnNBYCBhbmQgYDVgIG9wZXJhdGlvbnMgaW4gYG9wZXJhdGlvbnNCYC4gVGhlbjpcbiAqXG4gKiAqIHRyYW5zZm9ybWVkIGBvcGVyYXRpb25zQWAgd2lsbCBzdGFydCBmcm9tIGJhc2UgdmVyc2lvbiBgOWAgKGA0YCBiYXNlIHZlcnNpb24gKyBgNWAgb3BlcmF0aW9ucyBCKSxcbiAqICogdHJhbnNmb3JtZWQgYG9wZXJhdGlvbnNCYCB3aWxsIHN0YXJ0IGZyb20gYmFzZSB2ZXJzaW9uIGA3YCAoYDRgIGJhc2UgdmVyc2lvbiArIGAzYCBvcGVyYXRpb25zIEEpLlxuICpcbiAqIElmIG5vIG9wZXJhdGlvbiB3YXMgYnJva2VuIGludG8gdHdvIGR1cmluZyB0cmFuc2Zvcm1hdGlvbiwgdGhlbiBib3RoIHNldHMgd2lsbCBlbmQgdXAgd2l0aCBhbiBvcGVyYXRpb24gdGhhdCBiYXNlcyBvbiB2ZXJzaW9uIGAxMWA6XG4gKlxuICogKiB0cmFuc2Zvcm1lZCBgb3BlcmF0aW9uc0FgIHN0YXJ0IGZyb20gYDlgIGFuZCB0aGVyZSBhcmUgYDNgIG9mIHRoZW0sIHNvIHRoZSBsYXN0IHdpbGwgaGF2ZSBgYmFzZVZlcnNpb25gIGVxdWFsIHRvIGAxMWAsXG4gKiAqIHRyYW5zZm9ybWVkIGBvcGVyYXRpb25zQmAgc3RhcnQgZnJvbSBgN2AgYW5kIHRoZXJlIGFyZSBgNWAgb2YgdGhlbSwgc28gdGhlIGxhc3Qgd2lsbCBoYXZlIGBiYXNlVmVyc2lvbmAgZXF1YWwgdG8gYDExYC5cbiAqXG4gKiBAcGFyYW0gb3BlcmF0aW9uc0FcbiAqIEBwYXJhbSBvcGVyYXRpb25zQlxuICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBvcHRpb25zLlxuICogQHBhcmFtIG9wdGlvbnMuZG9jdW1lbnQgRG9jdW1lbnQgd2hpY2ggdGhlIG9wZXJhdGlvbnMgY2hhbmdlLlxuICogQHBhcmFtIG9wdGlvbnMudXNlUmVsYXRpb25zIFdoZXRoZXIgZHVyaW5nIHRyYW5zZm9ybWF0aW9uIHJlbGF0aW9ucyBzaG91bGQgYmUgdXNlZCAodXNlZCBkdXJpbmcgdW5kbyBmb3IgYmV0dGVyIGNvbmZsaWN0IHJlc29sdXRpb24pLlxuICogQHBhcmFtIG9wdGlvbnMucGFkV2l0aE5vT3BzIFdoZXRoZXIgYWRkaXRpb25hbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vbm9vcGVyYXRpb25+Tm9PcGVyYXRpb259c1xuICogc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSB0cmFuc2Zvcm1hdGlvbiByZXN1bHRzIHRvIGZvcmNlIHRoZSBzYW1lIGxhc3QgYmFzZSB2ZXJzaW9uIGZvciBib3RoIHRyYW5zZm9ybWVkIHNldHMgKGluIGNhc2VcbiAqIGlmIHNvbWUgb3BlcmF0aW9ucyBnb3QgYnJva2VuIGludG8gbXVsdGlwbGUgb3BlcmF0aW9ucyBkdXJpbmcgdHJhbnNmb3JtYXRpb24pLlxuICogQHBhcmFtIG9wdGlvbnMuZm9yY2VXZWFrUmVtb3ZlIElmIHNldCB0byBgZmFsc2VgLCByZW1vdmUgb3BlcmF0aW9uIHdpbGwgYmUgYWx3YXlzIHN0cm9uZ2VyIHRoYW4gbW92ZSBvcGVyYXRpb24sXG4gKiBzbyB0aGUgcmVtb3ZlZCBub2RlcyB3b24ndCBlbmQgdXAgYmFjayBpbiB0aGUgZG9jdW1lbnQgcm9vdC4gV2hlbiBzZXQgdG8gYHRydWVgLCBjb250ZXh0IGRhdGEgd2lsbCBiZSB1c2VkLlxuICogQHJldHVybnMgVHJhbnNmb3JtYXRpb24gcmVzdWx0LlxuICovIGZ1bmN0aW9uIHRyYW5zZm9ybVNldHMob3BlcmF0aW9uc0EsIG9wZXJhdGlvbnNCLCBvcHRpb25zKSB7XG4gICAgLy8gQ3JlYXRlIG5ldyBhcnJheXMgc28gdGhlIG9yaWdpbmFsbHkgcGFzc2VkIGFyZ3VtZW50cyBhcmUgbm90IGNoYW5nZWQuXG4gICAgLy8gTm8gbmVlZCB0byBjbG9uZSBvcGVyYXRpb25zLCB0aGV5IGFyZSBjbG9uZWQgYXMgdGhleSBhcmUgdHJhbnNmb3JtZWQuXG4gICAgb3BlcmF0aW9uc0EgPSBvcGVyYXRpb25zQS5zbGljZSgpO1xuICAgIG9wZXJhdGlvbnNCID0gb3BlcmF0aW9uc0Iuc2xpY2UoKTtcbiAgICBjb25zdCBjb250ZXh0RmFjdG9yeSA9IG5ldyBDb250ZXh0RmFjdG9yeShvcHRpb25zLmRvY3VtZW50LCBvcHRpb25zLnVzZVJlbGF0aW9ucywgb3B0aW9ucy5mb3JjZVdlYWtSZW1vdmUpO1xuICAgIGNvbnRleHRGYWN0b3J5LnNldE9yaWdpbmFsT3BlcmF0aW9ucyhvcGVyYXRpb25zQSk7XG4gICAgY29udGV4dEZhY3Rvcnkuc2V0T3JpZ2luYWxPcGVyYXRpb25zKG9wZXJhdGlvbnNCKTtcbiAgICBjb25zdCBvcmlnaW5hbE9wZXJhdGlvbnMgPSBjb250ZXh0RmFjdG9yeS5vcmlnaW5hbE9wZXJhdGlvbnM7XG4gICAgLy8gSWYgb25lIG9mIHNldHMgaXMgZW1wdHkgdGhlcmUgaXMgc2ltcGx5IG5vdGhpbmcgdG8gdHJhbnNmb3JtLCBzbyByZXR1cm4gc2V0cyBhcyB0aGV5IGFyZS5cbiAgICBpZiAob3BlcmF0aW9uc0EubGVuZ3RoID09IDAgfHwgb3BlcmF0aW9uc0IubGVuZ3RoID09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbnNBLFxuICAgICAgICAgICAgb3BlcmF0aW9uc0IsXG4gICAgICAgICAgICBvcmlnaW5hbE9wZXJhdGlvbnNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLy9cbiAgICAvLyBGb2xsb3dpbmcgaXMgYSBkZXNjcmlwdGlvbiBvZiB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzOlxuICAgIC8vXG4gICAgLy8gVGhlcmUgYXJlIGBvcGVyYXRpb25zQWAgYW5kIGBvcGVyYXRpb25zQmAgdG8gYmUgdHJhbnNmb3JtZWQsIGJvdGggYnkgYm90aC5cbiAgICAvL1xuICAgIC8vIFNvLCBzdXBwb3NlIHdlIGhhdmUgc2V0cyBvZiB0d28gb3BlcmF0aW9ucyBlYWNoOiBgb3BlcmF0aW9uc0FgID0gYFsgYTEsIGEyIF1gLCBgb3BlcmF0aW9uc0JgID0gYFsgYjEsIGIyIF1gLlxuICAgIC8vXG4gICAgLy8gUmVtZW1iZXIsIHRoYXQgd2UgY2FuIG9ubHkgdHJhbnNmb3JtIG9wZXJhdGlvbnMgdGhhdCBiYXNlIG9uIHRoZSBzYW1lIGNvbnRleHQuIFdlIGFzc2VydCB0aGF0IGBhMWAgYW5kIGBiMWAgYmFzZSBvblxuICAgIC8vIHRoZSBzYW1lIGNvbnRleHQgYW5kIHdlIHRyYW5zZm9ybSB0aGVtLiBUaGVuLCB3ZSBnZXQgYGExJ2AgYW5kIGBiMSdgLiBgYTJgIGJhc2VzIG9uIGEgY29udGV4dCB3aXRoIGBhMWAgLS0gYGEyYFxuICAgIC8vIGlzIGFuIG9wZXJhdGlvbiB0aGF0IGZvbGxvd2VkIGBhMWAuIFNpbWlsYXJseSwgYGIyYCBiYXNlcyBvbiBhIGNvbnRleHQgd2l0aCBgYjFgLlxuICAgIC8vXG4gICAgLy8gSG93ZXZlciwgc2luY2UgYGExJ2AgaXMgYSByZXN1bHQgb2YgdHJhbnNmb3JtYXRpb24gYnkgYGIxYCwgYGExJ2Agbm93IGFsc28gaGFzIGEgY29udGV4dCB3aXRoIGBiMWAuIFRoaXMgbWVhbnMgdGhhdFxuICAgIC8vIHdlIGNhbiBzYWZlbHkgdHJhbnNmb3JtIGBhMSdgIGJ5IGBiMmAuIEFzIHdlIGZpbmlzaCB0cmFuc2Zvcm1pbmcgYGExYCwgd2UgYWxzbyB0cmFuc2Zvcm1lZCBhbGwgYG9wZXJhdGlvbnNCYC5cbiAgICAvLyBBbGwgYG9wZXJhdGlvbnNCYCBhbHNvIGhhdmUgY29udGV4dCBpbmNsdWRpbmcgYGExYC4gTm93LCB3ZSBjYW4gcHJvcGVybHkgdHJhbnNmb3JtIGBhMmAgYnkgdGhvc2Ugb3BlcmF0aW9ucy5cbiAgICAvL1xuICAgIC8vIFRoZSB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzIGNhbiBiZSB2aXN1YWxpemVkIG9uIGEgdHJhbnNmb3JtYXRpb24gZGlhZ3JhbSAoXCJkaWFtb25kIGRpYWdyYW1cIik6XG4gICAgLy9cbiAgICAvLyAgICAgICAgICBbdGhlIGluaXRpYWwgc3RhdGVdXG4gICAgLy8gICAgICAgICBbY29tbW9uIGZvciBhMSBhbmQgYjFdXG4gICAgLy9cbiAgICAvLyAgICAgICAgICAgICAgICAgICAqXG4gICAgLy8gICAgICAgICAgICAgICAgICAvIFxcXG4gICAgLy8gICAgICAgICAgICAgICAgIC8gICBcXFxuICAgIC8vICAgICAgICAgICAgICAgYjEgICAgIGExXG4gICAgLy8gICAgICAgICAgICAgICAvICAgICAgIFxcXG4gICAgLy8gICAgICAgICAgICAgIC8gICAgICAgICBcXFxuICAgIC8vICAgICAgICAgICAgICogICAgICAgICAgICpcbiAgICAvLyAgICAgICAgICAgIC8gXFwgICAgICAgICAvIFxcXG4gICAgLy8gICAgICAgICAgIC8gICBcXCAgICAgICAvICAgXFxcbiAgICAvLyAgICAgICAgIGIyICAgIGExJyAgIGIxJyAgICBhMlxuICAgIC8vICAgICAgICAgLyAgICAgICBcXCAgIC8gICAgICAgXFxcbiAgICAvLyAgICAgICAgLyAgICAgICAgIFxcIC8gICAgICAgICBcXFxuICAgIC8vICAgICAgICogICAgICAgICAgICogICAgICAgICAgICpcbiAgICAvLyAgICAgICAgXFwgICAgICAgICAvIFxcICAgICAgICAgL1xuICAgIC8vICAgICAgICAgXFwgICAgICAgLyAgIFxcICAgICAgIC9cbiAgICAvLyAgICAgICAgYTEnJyAgIGIyJyAgIGEyJyAgIGIxJydcbiAgICAvLyAgICAgICAgICAgXFwgICAvICAgICAgIFxcICAgL1xuICAgIC8vICAgICAgICAgICAgXFwgLyAgICAgICAgIFxcIC9cbiAgICAvLyAgICAgICAgICAgICAqICAgICAgICAgICAqXG4gICAgLy8gICAgICAgICAgICAgIFxcICAgICAgICAgL1xuICAgIC8vICAgICAgICAgICAgICAgXFwgICAgICAgL1xuICAgIC8vICAgICAgICAgICAgICBhMicnICAgYjInJ1xuICAgIC8vICAgICAgICAgICAgICAgICBcXCAgIC9cbiAgICAvLyAgICAgICAgICAgICAgICAgIFxcIC9cbiAgICAvLyAgICAgICAgICAgICAgICAgICAqXG4gICAgLy9cbiAgICAvLyAgICAgICAgICAgW3RoZSBmaW5hbCBzdGF0ZV1cbiAgICAvL1xuICAgIC8vIFRoZSBmaW5hbCBzdGF0ZSBjYW4gYmUgcmVhY2hlZCBmcm9tIHRoZSBpbml0aWFsIHN0YXRlIGJ5IGFwcGx5aW5nIGBhMWAsIGBhMmAsIGBiMScnYCBhbmQgYGIyJydgLCBhcyB3ZWxsIGFzIGJ5XG4gICAgLy8gYXBwbHlpbmcgYGIxYCwgYGIyYCwgYGExJydgLCBgYTInJ2AuIE5vdGUgaG93IHRoZSBvcGVyYXRpb25zIGdldCB0byBhIHByb3BlciBjb21tb24gc3RhdGUgYmVmb3JlIGVhY2ggcGFpciBpc1xuICAgIC8vIHRyYW5zZm9ybWVkLlxuICAgIC8vXG4gICAgLy8gQW5vdGhlciB0aGluZyB0byBjb25zaWRlciBpcyB0aGF0IGFuIG9wZXJhdGlvbiBkdXJpbmcgdHJhbnNmb3JtYXRpb24gY2FuIGJlIGJyb2tlbiBpbnRvIG11bHRpcGxlIG9wZXJhdGlvbnMuXG4gICAgLy8gU3VwcG9zZSB0aGF0IGBhMWAgKiBgYjFgID0gYFsgYTExJywgYTEyJyBdYCAoaW5zdGVhZCBvZiBgYTEnYCB0aGF0IHdlIGNvbnNpZGVyZWQgcHJldmlvdXNseSkuXG4gICAgLy9cbiAgICAvLyBJbiB0aGF0IGNhc2UsIHdlIGxlYXZlIGBhMTInYCBmb3IgbGF0ZXIgYW5kIHdlIGNvbnRpbnVlIHRyYW5zZm9ybWluZyBgYTExJ2AgdW50aWwgaXQgaXMgdHJhbnNmb3JtZWQgYnkgYWxsIGBvcGVyYXRpb25zQmBcbiAgICAvLyAoaW4gb3VyIGNhc2UgaXQgaXMganVzdCBgYjJgKS4gQXQgdGhpcyBwb2ludCwgYGIxYCBpcyB0cmFuc2Zvcm1lZCBieSBcIndob2xlXCIgYGExYCwgd2hpbGUgYGIyYCBpcyBvbmx5IHRyYW5zZm9ybWVkXG4gICAgLy8gYnkgYGExMSdgLiBTaW1pbGFybHksIGBhMTInYCBpcyBvbmx5IHRyYW5zZm9ybWVkIGJ5IGBiMWAuIFRoaXMgbGVhZHMgdG8gYSBjb25jbHVzaW9uIHRoYXQgd2UgbmVlZCB0byBzdGFydCB0cmFuc2Zvcm1pbmcgYGExMidgXG4gICAgLy8gZnJvbSB0aGUgbW9tZW50IGp1c3QgYWZ0ZXIgaXQgd2FzIGJyb2tlbi4gU28sIGBhMTInYCBpcyB0cmFuc2Zvcm1lZCBieSBgYjJgLiBOb3csIFwidGhlIHdob2xlXCIgYGExYCBpcyB0cmFuc2Zvcm1lZFxuICAgIC8vIGJ5IGBvcGVyYXRpb25zQmAsIHdoaWxlIGFsbCBgb3BlcmF0aW9uc0JgIGFyZSB0cmFuc2Zvcm1lZCBieSBcInRoZSB3aG9sZVwiIGBhMWAuIFRoaXMgbWVhbnMgdGhhdCB3ZSBjYW4gY29udGludWUgd2l0aFxuICAgIC8vIGZvbGxvd2luZyBgb3BlcmF0aW9uc0FgIChpbiBvdXIgY2FzZSBpdCBpcyBqdXN0IGBhMmApLlxuICAgIC8vXG4gICAgLy8gT2YgY291cnNlLCBhbHNvIGBvcGVyYXRpb25zQmAgY2FuIGJlIGJyb2tlbi4gSG93ZXZlciwgc2luY2Ugd2UgZm9jdXMgb24gdHJhbnNmb3JtaW5nIG9wZXJhdGlvbiBgYWAgdG8gdGhlIGVuZCxcbiAgICAvLyB0aGUgb25seSB0aGluZyB0byBkbyBpcyB0byBzdG9yZSBib3RoIHBpZWNlcyBvZiBvcGVyYXRpb24gYGJgLCBzbyB0aGF0IHRoZSBuZXh0IHRyYW5zZm9ybWVkIG9wZXJhdGlvbiBgYWAgd2lsbFxuICAgIC8vIGJlIHRyYW5zZm9ybWVkIGJ5IGJvdGggb2YgdGhlbS5cbiAgICAvL1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAqXG4gICAgLy8gICAgICAgICAgICAgICAgICAgICAgLyBcXFxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgLyAgIFxcXG4gICAgLy8gICAgICAgICAgICAgICAgICAgIC8gICAgIFxcXG4gICAgLy8gICAgICAgICAgICAgICAgICBiMSAgICAgICBhMVxuICAgIC8vICAgICAgICAgICAgICAgICAgLyAgICAgICAgIFxcXG4gICAgLy8gICAgICAgICAgICAgICAgIC8gICAgICAgICAgIFxcXG4gICAgLy8gICAgICAgICAgICAgICAgLyAgICAgICAgICAgICBcXFxuICAgIC8vICAgICAgICAgICAgICAgKiAgICAgICAgICAgICAgICpcbiAgICAvLyAgICAgICAgICAgICAgLyBcXCAgICAgICAgICAgICAvIFxcXG4gICAgLy8gICAgICAgICAgICAgLyAgYTExJyAgICAgICAgIC8gICBcXFxuICAgIC8vICAgICAgICAgICAgLyAgICAgXFwgICAgICAgICAvICAgICBcXFxuICAgIC8vICAgICAgICAgIGIyICAgICAgICogICAgICBiMScgICAgICBhMlxuICAgIC8vICAgICAgICAgIC8gICAgICAgLyBcXCAgICAgLyAgICAgICAgIFxcXG4gICAgLy8gICAgICAgICAvICAgICAgIC8gIGExMicgLyAgICAgICAgICAgXFxcbiAgICAvLyAgICAgICAgLyAgICAgICAvICAgICBcXCAvICAgICAgICAgICAgIFxcXG4gICAgLy8gICAgICAgKiAgICAgICBiMicgICAgICogICAgICAgICAgICAgICAqXG4gICAgLy8gICAgICAgIFxcICAgICAvICAgICAgIC8gXFwgICAgICAgICAgICAgL1xuICAgIC8vICAgICAgIGExMScnIC8gICAgIGIyMScnIFxcICAgICAgICAgICAvXG4gICAgLy8gICAgICAgICAgXFwgLyAgICAgICAvICAgICBcXCAgICAgICAgIC9cbiAgICAvLyAgICAgICAgICAgKiAgICAgICAqICAgICAgYTInICAgICBiMScnXG4gICAgLy8gICAgICAgICAgICBcXCAgICAgLyBcXCAgICAgICBcXCAgICAgL1xuICAgIC8vICAgICAgICAgIGExMicnIGIyMicnXFwgICAgICAgXFwgICAvXG4gICAgLy8gICAgICAgICAgICAgIFxcIC8gICAgIFxcICAgICAgIFxcIC9cbiAgICAvLyAgICAgICAgICAgICAgICogICAgICBhMicnICAgICAqXG4gICAgLy8gICAgICAgICAgICAgICAgXFwgICAgICAgXFwgICAgIC9cbiAgICAvLyAgICAgICAgICAgICAgICAgXFwgICAgICAgXFwgIGIyMScnJ1xuICAgIC8vICAgICAgICAgICAgICAgICAgXFwgICAgICAgXFwgL1xuICAgIC8vICAgICAgICAgICAgICAgIGEyJycnICAgICAgKlxuICAgIC8vICAgICAgICAgICAgICAgICAgICBcXCAgICAgL1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgXFwgIGIyMicnJ1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFxcIC9cbiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgKlxuICAgIC8vXG4gICAgLy8gTm90ZSwgaG93IGBhMWAgaXMgYnJva2VuIGFuZCB0cmFuc2Zvcm1lZCBpbnRvIGBhMTEnYCBhbmQgYGExMidgLCB3aGlsZSBgYjInYCBnb3QgYnJva2VuIGFuZCB0cmFuc2Zvcm1lZCBpbnRvIGBiMjEnJ2AgYW5kIGBiMjInJ2AuXG4gICAgLy9cbiAgICAvLyBIYXZpbmcgYWxsIHRoYXQgb24gbWluZCwgaGVyZSBpcyBhbiBvdXRsaW5lIGZvciB0aGUgdHJhbnNmb3JtYXRpb24gcHJvY2VzcyBhbGdvcml0aG06XG4gICAgLy9cbiAgICAvLyAxLiBXZSBoYXZlIGBvcGVyYXRpb25zQWAgYW5kIGBvcGVyYXRpb25zQmAgYXJyYXksIHdoaWNoIHdlIGR5bmFtaWNhbGx5IHVwZGF0ZSBhcyB0aGUgdHJhbnNmb3JtYXRpb24gcHJvY2VzcyBnb2VzLlxuICAgIC8vXG4gICAgLy8gMi4gV2UgdGFrZSBuZXh0IChvciBmaXJzdCkgb3BlcmF0aW9uIGZyb20gYG9wZXJhdGlvbnNBYCBhbmQgY2hlY2sgZnJvbSB3aGljaCBvcGVyYXRpb24gYGJgIHdlIG5lZWQgdG8gc3RhcnQgdHJhbnNmb3JtaW5nIGl0LlxuICAgIC8vIEFsbCBvcmlnaW5hbCBgb3BlcmF0aW9uc0FgIGFyZSBzZXQgdG8gYmUgdHJhbnNmb3JtZWQgc3RhcnRpbmcgZnJvbSB0aGUgZmlyc3Qgb3BlcmF0aW9uIGBiYC5cbiAgICAvL1xuICAgIC8vIDMuIFdlIHRha2Ugb3BlcmF0aW9ucyBmcm9tIGBvcGVyYXRpb25zQmAsIG9uZSBieSBvbmUsIHN0YXJ0aW5nIGZyb20gdGhlIGNvcnJlY3Qgb25lLCBhbmQgdHJhbnNmb3JtIG9wZXJhdGlvbiBgYWBcbiAgICAvLyBieSBvcGVyYXRpb24gYGJgIChhbmQgdmljZSB2ZXJzYSkuIFdlIHVwZGF0ZSBgb3BlcmF0aW9uc0FgIGFuZCBgb3BlcmF0aW9uc0JgIGJ5IHJlcGxhY2luZyB0aGUgb3JpZ2luYWwgb3BlcmF0aW9uc1xuICAgIC8vIHdpdGggdGhlIHRyYW5zZm9ybWF0aW9uIHJlc3VsdHMuXG4gICAgLy9cbiAgICAvLyA0LiBJZiBvcGVyYXRpb24gaXMgYnJva2VuIGludG8gbXVsdGlwbGUgb3BlcmF0aW9ucywgd2Ugc2F2ZSBhbGwgdGhlIG5ldyBvcGVyYXRpb25zIGluIHRoZSBwbGFjZSBvZiB0aGVcbiAgICAvLyBvcmlnaW5hbCBvcGVyYXRpb24uXG4gICAgLy9cbiAgICAvLyA1LiBBZGRpdGlvbmFsbHksIGlmIG9wZXJhdGlvbiBgYWAgd2FzIGJyb2tlbiwgZm9yIHRoZSBcIm5ld1wiIG9wZXJhdGlvbiwgd2UgcmVtZW1iZXIgZnJvbSB3aGljaCBvcGVyYXRpb24gYGJgIGl0IHNob3VsZFxuICAgIC8vIGJlIHRyYW5zZm9ybWVkIGJ5LlxuICAgIC8vXG4gICAgLy8gNi4gV2UgY29udGludWUgdHJhbnNmb3JtaW5nIFwiY3VycmVudFwiIG9wZXJhdGlvbiBgYWAgdW50aWwgaXQgaXMgdHJhbnNmb3JtZWQgYnkgYWxsIGBvcGVyYXRpb25zQmAuIFRoZW4sIGdvIHRvIDIuXG4gICAgLy8gdW5sZXNzIHRoZSBsYXN0IG9wZXJhdGlvbiBgYWAgd2FzIHRyYW5zZm9ybWVkLlxuICAgIC8vXG4gICAgLy8gVGhlIGFjdHVhbCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgYWJvdmUgYWxnb3JpdGhtIGlzIHNsaWdodGx5IGRpZmZlcmVudCwgYXMgb25seSBvbmUgbG9vcCAod2hpbGUpIGlzIHVzZWQuXG4gICAgLy8gVGhlIGRpZmZlcmVuY2UgaXMgdGhhdCB3ZSBoYXZlIFwiY3VycmVudFwiIGBhYCBvcGVyYXRpb24gdG8gdHJhbnNmb3JtIGFuZCB3ZSBzdG9yZSB0aGUgaW5kZXggb2YgdGhlIG5leHQgYGJgIG9wZXJhdGlvblxuICAgIC8vIHRvIHRyYW5zZm9ybSBieS4gRWFjaCBsb29wIG9wZXJhdGVzIG9uIHR3byBpbmRleGVzIHRoZW46IGluZGV4IHBvaW50aW5nIHRvIGN1cnJlbnRseSBwcm9jZXNzZWQgYGFgIG9wZXJhdGlvbiBhbmRcbiAgICAvLyBpbmRleCBwb2ludGluZyB0byBuZXh0IGBiYCBvcGVyYXRpb24uIEVhY2ggbG9vcCBpcyBqdXN0IG9uZSBgYSAqIGJgICsgYGIgKiBhYCB0cmFuc2Zvcm1hdGlvbi4gQWZ0ZXIgZWFjaCBsb29wXG4gICAgLy8gb3BlcmF0aW9uIGBiYCBpbmRleCBpcyB1cGRhdGVkLiBJZiBhbGwgYGJgIG9wZXJhdGlvbnMgd2VyZSB2aXNpdGVkIGZvciB0aGUgY3VycmVudCBgYWAgb3BlcmF0aW9uLCB3ZSBjaGFuZ2VcbiAgICAvLyBjdXJyZW50IGBhYCBvcGVyYXRpb24gaW5kZXggdG8gdGhlIG5leHQgb25lLlxuICAgIC8vXG4gICAgLy8gRm9yIGVhY2ggb3BlcmF0aW9uIGBhYCwga2VlcHMgaW5mb3JtYXRpb24gd2hhdCBpcyB0aGUgaW5kZXggaW4gYG9wZXJhdGlvbnNCYCBmcm9tIHdoaWNoIHRoZSB0cmFuc2Zvcm1hdGlvbiBzaG91bGQgc3RhcnQuXG4gICAgY29uc3QgbmV4dFRyYW5zZm9ybUluZGV4ID0gbmV3IFdlYWtNYXAoKTtcbiAgICAvLyBGb3IgYWxsIHRoZSBvcmlnaW5hbCBgb3BlcmF0aW9uc0FgLCBzZXQgdGhhdCB0aGV5IHNob3VsZCBiZSB0cmFuc2Zvcm1lZCBzdGFydGluZyBmcm9tIHRoZSBmaXJzdCBvZiBgb3BlcmF0aW9uc0JgLlxuICAgIGZvciAoY29uc3Qgb3Agb2Ygb3BlcmF0aW9uc0Epe1xuICAgICAgICBuZXh0VHJhbnNmb3JtSW5kZXguc2V0KG9wLCAwKTtcbiAgICB9XG4gICAgLy8gQWRkaXRpb25hbCBkYXRhIHRoYXQgaXMgdXNlZCBmb3Igc29tZSBwb3N0cHJvY2Vzc2luZyBhZnRlciB0aGUgbWFpbiB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzIGlzIGRvbmUuXG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgbmV4dEJhc2VWZXJzaW9uQTogb3BlcmF0aW9uc0Fbb3BlcmF0aW9uc0EubGVuZ3RoIC0gMV0uYmFzZVZlcnNpb24gKyAxLFxuICAgICAgICBuZXh0QmFzZVZlcnNpb25COiBvcGVyYXRpb25zQltvcGVyYXRpb25zQi5sZW5ndGggLSAxXS5iYXNlVmVyc2lvbiArIDEsXG4gICAgICAgIG9yaWdpbmFsT3BlcmF0aW9uc0FDb3VudDogb3BlcmF0aW9uc0EubGVuZ3RoLFxuICAgICAgICBvcmlnaW5hbE9wZXJhdGlvbnNCQ291bnQ6IG9wZXJhdGlvbnNCLmxlbmd0aFxuICAgIH07XG4gICAgLy8gSW5kZXggb2YgY3VycmVudGx5IHRyYW5zZm9ybWVkIG9wZXJhdGlvbiBgYWAuXG4gICAgbGV0IGkgPSAwO1xuICAgIC8vIFdoaWxlIG5vdCBhbGwgYG9wZXJhdGlvbnNBYCBhcmUgdHJhbnNmb3JtZWQuLi5cbiAgICB3aGlsZShpIDwgb3BlcmF0aW9uc0EubGVuZ3RoKXtcbiAgICAgICAgLy8gR2V0IFwiY3VycmVudFwiIG9wZXJhdGlvbiBgYWAuXG4gICAgICAgIGNvbnN0IG9wQSA9IG9wZXJhdGlvbnNBW2ldO1xuICAgICAgICAvLyBGb3IgdGhlIFwiY3VycmVudFwiIG9wZXJhdGlvbiBgYWAsIGdldCB0aGUgaW5kZXggb2YgdGhlIG5leHQgb3BlcmF0aW9uIGBiYCB0byB0cmFuc2Zvcm0gYnkuXG4gICAgICAgIGNvbnN0IGluZGV4QiA9IG5leHRUcmFuc2Zvcm1JbmRleC5nZXQob3BBKTtcbiAgICAgICAgLy8gSWYgb3BlcmF0aW9uIGBhYCB3YXMgYWxyZWFkeSB0cmFuc2Zvcm1lZCBieSBldmVyeSBvcGVyYXRpb24gYGJgLCBjaGFuZ2UgXCJjdXJyZW50XCIgb3BlcmF0aW9uIGBhYCB0byB0aGUgbmV4dCBvbmUuXG4gICAgICAgIGlmIChpbmRleEIgPT0gb3BlcmF0aW9uc0IubGVuZ3RoKSB7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcEIgPSBvcGVyYXRpb25zQltpbmRleEJdO1xuICAgICAgICAvLyBUcmFuc2Zvcm0gYGFgIGJ5IGBiYCBhbmQgYGJgIGJ5IGBhYC5cbiAgICAgICAgY29uc3QgbmV3T3BzQSA9IHRyYW5zZm9ybSQxKG9wQSwgb3BCLCBjb250ZXh0RmFjdG9yeS5nZXRDb250ZXh0KG9wQSwgb3BCLCB0cnVlKSk7XG4gICAgICAgIGNvbnN0IG5ld09wc0IgPSB0cmFuc2Zvcm0kMShvcEIsIG9wQSwgY29udGV4dEZhY3RvcnkuZ2V0Q29udGV4dChvcEIsIG9wQSwgZmFsc2UpKTtcbiAgICAgICAgLy8gQXMgYSByZXN1bHQgd2UgZ2V0IG9uZSBvciBtb3JlIGBuZXdPcHNBYCBhbmQgb25lIG9yIG1vcmUgYG5ld09wc0JgIG9wZXJhdGlvbnMuXG4gICAgICAgIC8vIFVwZGF0ZSBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGFib3V0IG9wZXJhdGlvbnMuXG4gICAgICAgIGNvbnRleHRGYWN0b3J5LnVwZGF0ZVJlbGF0aW9uKG9wQSwgb3BCKTtcbiAgICAgICAgY29udGV4dEZhY3Rvcnkuc2V0T3JpZ2luYWxPcGVyYXRpb25zKG5ld09wc0EsIG9wQSk7XG4gICAgICAgIGNvbnRleHRGYWN0b3J5LnNldE9yaWdpbmFsT3BlcmF0aW9ucyhuZXdPcHNCLCBvcEIpO1xuICAgICAgICAvLyBGb3IgbmV3IGBhYCBvcGVyYXRpb25zLCB1cGRhdGUgdGhlaXIgaW5kZXggb2YgdGhlIG5leHQgb3BlcmF0aW9uIGBiYCB0byB0cmFuc2Zvcm0gdGhlbSBieS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZXZlbiBpZiB0aGVyZSB3YXMgb25seSBvbmUgcmVzdWx0IChgYWAgd2FzIG5vdCBicm9rZW4pIGJlY2F1c2UgdGhhdCBpbmZvcm1hdGlvbiBpcyB1c2VkXG4gICAgICAgIC8vIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBsb29wIGV2ZXJ5IHRpbWUuXG4gICAgICAgIGZvciAoY29uc3QgbmV3T3BBIG9mIG5ld09wc0Epe1xuICAgICAgICAgICAgLy8gQWNrbm93bGVkZ2UsIHRoYXQgb3BlcmF0aW9uIGBiYCBhbHNvIG1pZ2h0IGJlIGJyb2tlbiBpbnRvIG11bHRpcGxlIG9wZXJhdGlvbnMuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gVGhpcyBpcyB3aHkgd2UgcmFpc2UgYGluZGV4QmAgbm90IGp1c3QgYnkgMS4gSWYgYG5ld09wc0JgIGFyZSBtdWx0aXBsZSBvcGVyYXRpb25zLCB0aGV5IHdpbGwgYmVcbiAgICAgICAgICAgIC8vIHNwbGljZWQgaW4gdGhlIHBsYWNlIG9mIGBvcEJgLiBTbyB3ZSBuZWVkIHRvIGNoYW5nZSBgdHJhbnNmb3JtQnlgIGFjY29yZGluZ2x5LCBzbyB0aGF0IGFuIG9wZXJhdGlvbiB3b24ndFxuICAgICAgICAgICAgLy8gYmUgdHJhbnNmb3JtZWQgYnkgdGhlIHNhbWUgb3BlcmF0aW9uIChwYXJ0IG9mIGl0KSBhZ2Fpbi5cbiAgICAgICAgICAgIG5leHRUcmFuc2Zvcm1JbmRleC5zZXQobmV3T3BBLCBpbmRleEIgKyBuZXdPcHNCLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIGBvcGVyYXRpb25zQWAgYW5kIGBvcGVyYXRpb25zQmAgd2l0aCB0aGUgdHJhbnNmb3JtZWQgdmVyc2lvbnMuXG4gICAgICAgIG9wZXJhdGlvbnNBLnNwbGljZShpLCAxLCAuLi5uZXdPcHNBKTtcbiAgICAgICAgb3BlcmF0aW9uc0Iuc3BsaWNlKGluZGV4QiwgMSwgLi4ubmV3T3BzQik7XG4gICAgfVxuICAgIGhhbmRsZVBhcnRpYWxNYXJrZXJPcGVyYXRpb25zKG9wZXJhdGlvbnNBKTtcbiAgICBoYW5kbGVQYXJ0aWFsTWFya2VyT3BlcmF0aW9ucyhvcGVyYXRpb25zQik7XG4gICAgaWYgKG9wdGlvbnMucGFkV2l0aE5vT3BzKSB7XG4gICAgICAgIC8vIElmIG5vLW9wZXJhdGlvbnMgcGFkZGluZyBpcyBlbmFibGVkLCBjb3VudCBob3cgbWFueSBleHRyYSBgYWAgYW5kIGBiYCBvcGVyYXRpb25zIHdlcmUgZ2VuZXJhdGVkLlxuICAgICAgICBjb25zdCBicm9rZW5PcGVyYXRpb25zQUNvdW50ID0gb3BlcmF0aW9uc0EubGVuZ3RoIC0gZGF0YS5vcmlnaW5hbE9wZXJhdGlvbnNBQ291bnQ7XG4gICAgICAgIGNvbnN0IGJyb2tlbk9wZXJhdGlvbnNCQ291bnQgPSBvcGVyYXRpb25zQi5sZW5ndGggLSBkYXRhLm9yaWdpbmFsT3BlcmF0aW9uc0JDb3VudDtcbiAgICAgICAgLy8gVGhlbiwgaWYgdGhhdCBudW1iZXIgaXMgbm90IHRoZSBzYW1lLCBwYWQgYG9wZXJhdGlvbnNBYCBvciBgb3BlcmF0aW9uc0JgIHdpdGggY29ycmVjdCBudW1iZXIgb2Ygbm8tb3BzIHNvXG4gICAgICAgIC8vIHRoYXQgdGhlIGJhc2UgdmVyc2lvbnMgYXJlIGVxdWFsbGVkLlxuICAgICAgICAvL1xuICAgICAgICAvLyBOb3RlIHRoYXQgb25seSBvbmUgYXJyYXkgd2lsbCBiZSB1cGRhdGVkLCBhcyBvbmx5IG9uZSBvZiB0aG9zZSBzdWJ0cmFjdGlvbnMgY2FuIGJlIGdyZWF0ZXIgdGhhbiB6ZXJvLlxuICAgICAgICBwYWRXaXRoTm9PcHMob3BlcmF0aW9uc0EsIGJyb2tlbk9wZXJhdGlvbnNCQ291bnQgLSBicm9rZW5PcGVyYXRpb25zQUNvdW50KTtcbiAgICAgICAgcGFkV2l0aE5vT3BzKG9wZXJhdGlvbnNCLCBicm9rZW5PcGVyYXRpb25zQUNvdW50IC0gYnJva2VuT3BlcmF0aW9uc0JDb3VudCk7XG4gICAgfVxuICAgIC8vIEZpbmFsbHksIHVwZGF0ZSBiYXNlIHZlcnNpb25zIG9mIHRyYW5zZm9ybWVkIG9wZXJhdGlvbnMuXG4gICAgdXBkYXRlQmFzZVZlcnNpb25zKG9wZXJhdGlvbnNBLCBkYXRhLm5leHRCYXNlVmVyc2lvbkIpO1xuICAgIHVwZGF0ZUJhc2VWZXJzaW9ucyhvcGVyYXRpb25zQiwgZGF0YS5uZXh0QmFzZVZlcnNpb25BKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBvcGVyYXRpb25zQSxcbiAgICAgICAgb3BlcmF0aW9uc0IsXG4gICAgICAgIG9yaWdpbmFsT3BlcmF0aW9uc1xuICAgIH07XG59XG4vKipcbiAqIEdhdGhlcnMgYWRkaXRpb25hbCBkYXRhIGFib3V0IG9wZXJhdGlvbnMgcHJvY2Vzc2VkIGR1cmluZyB0cmFuc2Zvcm1hdGlvbi4gQ2FuIGJlIHVzZWQgdG8gb2J0YWluIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAqIGFib3V0IHR3byBvcGVyYXRpb25zIHRoYXQgYXJlIGFib3V0IHRvIGJlIHRyYW5zZm9ybWVkLiBUaGlzIGNvbnRleHR1YWwgaW5mb3JtYXRpb24gY2FuIGJlIHVzZWQgZm9yIGJldHRlciBjb25mbGljdCByZXNvbHV0aW9uLlxuICovIGNsYXNzIENvbnRleHRGYWN0b3J5IHtcbiAgICBvcmlnaW5hbE9wZXJhdGlvbnM7XG4gICAgX2hpc3Rvcnk7XG4gICAgX3VzZVJlbGF0aW9ucztcbiAgICBfZm9yY2VXZWFrUmVtb3ZlO1xuICAgIF9yZWxhdGlvbnM7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYENvbnRleHRGYWN0b3J5YCBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIGRvY3VtZW50IERvY3VtZW50IHdoaWNoIHRoZSBvcGVyYXRpb25zIGNoYW5nZS5cblx0ICogQHBhcmFtIHVzZVJlbGF0aW9ucyBXaGV0aGVyIGR1cmluZyB0cmFuc2Zvcm1hdGlvbiByZWxhdGlvbnMgc2hvdWxkIGJlIHVzZWQgKHVzZWQgZHVyaW5nIHVuZG8gZm9yXG5cdCAqIGJldHRlciBjb25mbGljdCByZXNvbHV0aW9uKS5cblx0ICogQHBhcmFtIGZvcmNlV2Vha1JlbW92ZSBJZiBzZXQgdG8gYGZhbHNlYCwgcmVtb3ZlIG9wZXJhdGlvbiB3aWxsIGJlIGFsd2F5cyBzdHJvbmdlciB0aGFuIG1vdmUgb3BlcmF0aW9uLFxuXHQgKiBzbyB0aGUgcmVtb3ZlZCBub2RlcyB3b24ndCBlbmQgdXAgYmFjayBpbiB0aGUgZG9jdW1lbnQgcm9vdC4gV2hlbiBzZXQgdG8gYHRydWVgLCBjb250ZXh0IGRhdGEgd2lsbCBiZSB1c2VkLlxuXHQgKi8gY29uc3RydWN0b3IoZG9jdW1lbnQsIHVzZVJlbGF0aW9ucywgZm9yY2VXZWFrUmVtb3ZlID0gZmFsc2Upe1xuICAgICAgICAvLyBGb3IgZWFjaCBvcGVyYXRpb24gdGhhdCBpcyBjcmVhdGVkIGR1cmluZyB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzLCB3ZSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZSBvcmlnaW5hbCBvcGVyYXRpb25cbiAgICAgICAgLy8gd2hpY2ggaXQgY29tZXMgZnJvbS4gVGhlIG9yaWdpbmFsIG9wZXJhdGlvbiB3b3JrcyBhcyBhIGtpbmQgb2YgXCJpZGVudGlmaWVyXCIuIEV2ZXJ5IGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICAgICAgLy8gZ2F0aGVyZWQgZHVyaW5nIHRyYW5zZm9ybWF0aW9uIHRoYXQgd2Ugd2FudCB0byBzYXZlIGZvciBnaXZlbiBvcGVyYXRpb24sIGlzIGFjdHVhbGx5IHNhdmVkIGZvciB0aGUgb3JpZ2luYWwgb3BlcmF0aW9uLlxuICAgICAgICAvLyBUaGlzIHdheSBubyBtYXR0ZXIgaWYgb3BlcmF0aW9uIGBhYCBpcyBjbG9uZWQsIHRoZW4gdHJhbnNmb3JtZWQsIGV2ZW4gYnJlYWtzLCB3ZSBzdGlsbCBoYXZlIGFjY2VzcyB0byB0aGUgcHJldmlvdXNseVxuICAgICAgICAvLyBnYXRoZXJlZCBkYXRhIHRocm91Z2ggb3JpZ2luYWwgb3BlcmF0aW9uIHJlZmVyZW5jZS5cbiAgICAgICAgdGhpcy5vcmlnaW5hbE9wZXJhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIC8vIGBtb2RlbC5IaXN0b3J5YCBpbnN0YW5jZSB3aGljaCBpbmZvcm1hdGlvbiBhYm91dCB1bmRvbmUgb3BlcmF0aW9ucyB3aWxsIGJlIHRha2VuIGZyb20uXG4gICAgICAgIHRoaXMuX2hpc3RvcnkgPSBkb2N1bWVudC5oaXN0b3J5O1xuICAgICAgICAvLyBXaGV0aGVyIGFkZGl0aW9uYWwgY29udGV4dCBzaG91bGQgYmUgdXNlZC5cbiAgICAgICAgdGhpcy5fdXNlUmVsYXRpb25zID0gdXNlUmVsYXRpb25zO1xuICAgICAgICB0aGlzLl9mb3JjZVdlYWtSZW1vdmUgPSAhIWZvcmNlV2Vha1JlbW92ZTtcbiAgICAgICAgLy8gUmVsYXRpb25zIGlzIGEgZG91YmxlLW1hcCBzdHJ1Y3R1cmUgKG1hcHMgaW4gbWFwKSB3aGVyZSBmb3IgdHdvIG9wZXJhdGlvbnMgd2Ugc3RvcmUgaG93IHRob3NlIG9wZXJhdGlvbnMgd2VyZSByZWxhdGVkXG4gICAgICAgIC8vIHRvIGVhY2ggb3RoZXIuIFRob3NlIHJlbGF0aW9ucyBhcmUgZXZhbHVhdGVkIGR1cmluZyB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzLiBGb3IgZXZlcnkgdHJhbnNmb3JtYXRlZCBwYWlyIG9mIG9wZXJhdGlvbnNcbiAgICAgICAgLy8gd2Uga2VlcCByZWxhdGlvbnMgYmV0d2VlbiB0aGVtLlxuICAgICAgICB0aGlzLl9yZWxhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIFwib3JpZ2luYWwgb3BlcmF0aW9uXCIgZm9yIGdpdmVuIG9wZXJhdGlvbnMuXG5cdCAqXG5cdCAqIER1cmluZyB0cmFuc2Zvcm1hdGlvbiBwcm9jZXNzLCBvcGVyYXRpb25zIGFyZSBjbG9uZWQsIHRoZW4gY2hhbmdlZCwgdGhlbiBwcm9jZXNzZWQgYWdhaW4sIHNvbWV0aW1lcyBicm9rZW4gaW50byB0d29cblx0ICogb3IgbXVsdGlwbGUgb3BlcmF0aW9ucy4gV2hlbiBnYXRoZXJpbmcgYWRkaXRpb25hbCBkYXRhIGl0IGlzIGltcG9ydGFudCB0aGF0IGFsbCBvcGVyYXRpb25zIGNhbiBiZSBzb21laG93IGxpbmtlZFxuXHQgKiBzbyBhIGNsb25lZCBhbmQgdHJhbnNmb3JtZWQgXCJ2ZXJzaW9uXCIgc3RpbGwga2VwdCB0cmFjayBvZiB0aGUgZGF0YSBhc3NpZ25lZCBlYXJsaWVyIHRvIGl0LlxuXHQgKlxuXHQgKiBUaGUgb3JpZ2luYWwgb3BlcmF0aW9uIG9iamVjdCB3aWxsIGJlIHVzZWQgYXMgc3VjaCBhbiB1bml2ZXJzYWwgbGlua2luZyBpZC4gVGhyb3VnaG91dCB0aGUgdHJhbnNmb3JtYXRpb24gcHJvY2Vzc1xuXHQgKiBhbGwgY2xvbmVkIG9wZXJhdGlvbnMgd2lsbCByZWZlciB0byBcInRoZSBvcmlnaW5hbCBvcGVyYXRpb25cIiB3aGVuIHN0b3JpbmcgYW5kIHJlYWRpbmcgYWRkaXRpb25hbCBkYXRhLlxuXHQgKlxuXHQgKiBJZiBgdGFrZUZyb21gIGlzIG5vdCBzZXQsIGVhY2ggb3BlcmF0aW9uIGZyb20gYG9wZXJhdGlvbnNgIGFycmF5IHdpbGwgYmUgYXNzaWduZWQgaXRzZWxmIGFzIFwidGhlIG9yaWdpbmFsIG9wZXJhdGlvblwiLlxuXHQgKiBUaGlzIHNob3VsZCBiZSB1c2VkIGFzIGFuIGluaXRpYWxpemF0aW9uIHN0ZXAuXG5cdCAqXG5cdCAqIElmIGB0YWtlRnJvbWAgaXMgc2V0LCBlYWNoIG9wZXJhdGlvbiBmcm9tIGBvcGVyYXRpb25zYCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBzYW1lIG9yaWdpbmFsIG9wZXJhdGlvbiBhcyBhc3NpZ25lZFxuXHQgKiBmb3IgYHRha2VGcm9tYCBvcGVyYXRpb24uIFRoaXMgc2hvdWxkIGJlIHVzZWQgdG8gdXBkYXRlIG9yaWdpbmFsIG9wZXJhdGlvbnMuIEl0IHNob3VsZCBiZSB1c2VkIGluIGEgd2F5IHRoYXRcblx0ICogYG9wZXJhdGlvbnNgIGFyZSB0aGUgcmVzdWx0IG9mIGB0YWtlRnJvbWAgdHJhbnNmb3JtYXRpb24gdG8gZW5zdXJlIHByb3BlciBcIm9yaWdpbmFsIG9wZXJhdGlvbiBwcm9wYWdhdGlvblwiLlxuXHQgKi8gc2V0T3JpZ2luYWxPcGVyYXRpb25zKG9wZXJhdGlvbnMsIHRha2VGcm9tID0gbnVsbCkge1xuICAgICAgICBjb25zdCBvcmlnaW5hbE9wZXJhdGlvbiA9IHRha2VGcm9tID8gdGhpcy5vcmlnaW5hbE9wZXJhdGlvbnMuZ2V0KHRha2VGcm9tKSA6IG51bGw7XG4gICAgICAgIGZvciAoY29uc3Qgb3BlcmF0aW9uIG9mIG9wZXJhdGlvbnMpe1xuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbE9wZXJhdGlvbnMuc2V0KG9wZXJhdGlvbiwgb3JpZ2luYWxPcGVyYXRpb24gfHwgb3BlcmF0aW9uKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2F2ZXMgYSByZWxhdGlvbiBiZXR3ZWVuIG9wZXJhdGlvbnMgYG9wQWAgYW5kIGBvcEJgLlxuXHQgKlxuXHQgKiBSZWxhdGlvbnMgYXJlIHRoZW4gbGF0ZXIgdXNlZCB0byBoZWxwIHNvbHZlIGNvbmZsaWN0cyB3aGVuIG9wZXJhdGlvbnMgYXJlIHRyYW5zZm9ybWVkLlxuXHQgKi8gdXBkYXRlUmVsYXRpb24ob3BBLCBvcEIpIHtcbiAgICAgICAgLy8gVGhlIHVzZSBvZiByZWxhdGlvbnMgaXMgZGVzY3JpYmVkIGluIGEgYmlnZ2VyIGRldGFpbCBpbiB0cmFuc2Zvcm1hdGlvbiBmdW5jdGlvbnMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEluIGJyaWVmLCB0aGlzIGZ1bmN0aW9uLCBmb3Igc3BlY2lmaWVkIHBhaXJzIG9mIG9wZXJhdGlvbiB0eXBlcywgY2hlY2tzIGhvdyBwb3NpdGlvbnMgZGVmaW5lZCBpbiB0aG9zZSBvcGVyYXRpb25zIHJlbGF0ZS5cbiAgICAgICAgLy8gVGhlbiB0aG9zZSByZWxhdGlvbnMgYXJlIHNhdmVkLiBGb3IgZXhhbXBsZSwgZm9yIHR3byBtb3ZlIG9wZXJhdGlvbnMsIGl0IGlzIHNhdmVkIGlmIG9uZSBvZiB0aG9zZSBvcGVyYXRpb25zIHRhcmdldFxuICAgICAgICAvLyBwb3NpdGlvbiBpcyBiZWZvcmUgdGhlIG90aGVyIG9wZXJhdGlvbiBzb3VyY2UgcG9zaXRpb24uIFRoaXMga2luZCBvZiBpbmZvcm1hdGlvbiBnaXZlcyBjb250ZXh0dWFsIGluZm9ybWF0aW9uIHdoZW5cbiAgICAgICAgLy8gdHJhbnNmb3JtYXRpb24gaXMgdXNlZCBkdXJpbmcgdW5kby4gU2ltaWxhciBjaGVja3MgYXJlIGRvbmUgZm9yIG90aGVyIHBhaXJzIG9mIG9wZXJhdGlvbnMuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChvcEEgaW5zdGFuY2VvZiBNb3ZlT3BlcmF0aW9uKSB7XG4gICAgICAgICAgICBpZiAob3BCIGluc3RhbmNlb2YgTWVyZ2VPcGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAob3BBLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwob3BCLnNvdXJjZVBvc2l0aW9uKSB8fCBvcEIubW92ZWRSYW5nZS5jb250YWluc1Bvc2l0aW9uKG9wQS50YXJnZXRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UmVsYXRpb24ob3BBLCBvcEIsICdpbnNlcnRBdFNvdXJjZScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3BBLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwob3BCLmRlbGV0aW9uUG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlbGF0aW9uKG9wQSwgb3BCLCAnaW5zZXJ0QmV0d2VlbicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3BBLnRhcmdldFBvc2l0aW9uLmlzQWZ0ZXIob3BCLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRSZWxhdGlvbihvcEEsIG9wQiwgJ21vdmVUYXJnZXRBZnRlcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BCIGluc3RhbmNlb2YgTW92ZU9wZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChvcEEudGFyZ2V0UG9zaXRpb24uaXNFcXVhbChvcEIuc291cmNlUG9zaXRpb24pIHx8IG9wQS50YXJnZXRQb3NpdGlvbi5pc0JlZm9yZShvcEIuc291cmNlUG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlbGF0aW9uKG9wQSwgb3BCLCAnaW5zZXJ0QmVmb3JlJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UmVsYXRpb24ob3BBLCBvcEIsICdpbnNlcnRBZnRlcicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChvcEEgaW5zdGFuY2VvZiBTcGxpdE9wZXJhdGlvbikge1xuICAgICAgICAgICAgaWYgKG9wQiBpbnN0YW5jZW9mIE1lcmdlT3BlcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wQS5zcGxpdFBvc2l0aW9uLmlzQmVmb3JlKG9wQi5zb3VyY2VQb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UmVsYXRpb24ob3BBLCBvcEIsICdzcGxpdEJlZm9yZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BCIGluc3RhbmNlb2YgTW92ZU9wZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChvcEEuc3BsaXRQb3NpdGlvbi5pc0VxdWFsKG9wQi5zb3VyY2VQb3NpdGlvbikgfHwgb3BBLnNwbGl0UG9zaXRpb24uaXNCZWZvcmUob3BCLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRSZWxhdGlvbihvcEEsIG9wQiwgJ3NwbGl0QmVmb3JlJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQob3BCLnNvdXJjZVBvc2l0aW9uLCBvcEIuaG93TWFueSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcEEuc3BsaXRQb3NpdGlvbi5oYXNTYW1lUGFyZW50QXMob3BCLnNvdXJjZVBvc2l0aW9uKSAmJiByYW5nZS5jb250YWluc1Bvc2l0aW9uKG9wQS5zcGxpdFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogUG90ZW50aWFsIGJ1ZyAtLSB3ZSBhcmUgc2F2aW5nIG9mZnNldCB2YWx1ZSBkaXJlY3RseSBhbmQgaXQgaXMgbm90IGxhdGVyIHVwZGF0ZWQgZHVyaW5nIE9ULlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBtYXkgY2F1c2UgYSBidWcgaXQgaGVyZSB3YXMgYW4gbm9uLXVuZG9uZSBvcGVyYXRpb24gdGhhdCBtYXkgaGF2ZSBpbXBhY3RlZCB0aGlzIG9mZnNldC5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFNpbWlsYXIgZXJyb3Igd2FzIHdpdGggTWFya2VyT3BlcmF0aW9uIHJlbGF0aW9ucywgd2hlcmUgZnVsbCBwYXRoIHdhcyBzYXZlZCBhbmQgbmV2ZXIgdXBkYXRlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvd01hbnkgPSByYW5nZS5lbmQub2Zmc2V0IC0gb3BBLnNwbGl0UG9zaXRpb24ub2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gb3BBLnNwbGl0UG9zaXRpb24ub2Zmc2V0IC0gcmFuZ2Uuc3RhcnQub2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UmVsYXRpb24ob3BBLCBvcEIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3dNYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob3BBIGluc3RhbmNlb2YgTWVyZ2VPcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGlmIChvcEIgaW5zdGFuY2VvZiBNZXJnZU9wZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmICghb3BBLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwob3BCLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRSZWxhdGlvbihvcEEsIG9wQiwgJ21lcmdlVGFyZ2V0Tm90TW92ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9wQS5zb3VyY2VQb3NpdGlvbi5pc0VxdWFsKG9wQi50YXJnZXRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UmVsYXRpb24ob3BBLCBvcEIsICdtZXJnZVNvdXJjZU5vdE1vdmVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvcEEuc291cmNlUG9zaXRpb24uaXNFcXVhbChvcEIuc291cmNlUG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlbGF0aW9uKG9wQSwgb3BCLCAnbWVyZ2VTYW1lRWxlbWVudCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BCIGluc3RhbmNlb2YgU3BsaXRPcGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAob3BBLnNvdXJjZVBvc2l0aW9uLmlzRXF1YWwob3BCLnNwbGl0UG9zaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlbGF0aW9uKG9wQSwgb3BCLCAnc3BsaXRBdFNvdXJjZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BCIGluc3RhbmNlb2YgTW92ZU9wZXJhdGlvbiAmJiBvcEIuaG93TWFueSA+IDApIHtcbiAgICAgICAgICAgICAgICBpZiAob3BBLnNvdXJjZVBvc2l0aW9uLmlzRXF1YWwob3BCLnNvdXJjZVBvc2l0aW9uLmdldFNoaWZ0ZWRCeShvcEIuaG93TWFueSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlbGF0aW9uKG9wQSwgb3BCLCAnbWVyZ2VTb3VyY2VBZmZlY3RlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3BBLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwob3BCLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRSZWxhdGlvbihvcEEsIG9wQiwgJ21lcmdlVGFyZ2V0V2FzQmVmb3JlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG9wQSBpbnN0YW5jZW9mIE1hcmtlck9wZXJhdGlvbikge1xuICAgICAgICAgICAgY29uc3QgbWFya2VyUmFuZ2UgPSBvcEEubmV3UmFuZ2U7XG4gICAgICAgICAgICBpZiAoIW1hcmtlclJhbmdlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wQiBpbnN0YW5jZW9mIE1lcmdlT3BlcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2FzSW5MZWZ0RWxlbWVudCA9IG1hcmtlclJhbmdlLnN0YXJ0LmlzRXF1YWwob3BCLnRhcmdldFBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXNTdGFydEJlZm9yZU1lcmdlZEVsZW1lbnQgPSBtYXJrZXJSYW5nZS5zdGFydC5pc0VxdWFsKG9wQi5kZWxldGlvblBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3YXNFbmRCZWZvcmVNZXJnZWRFbGVtZW50ID0gbWFya2VyUmFuZ2UuZW5kLmlzRXF1YWwob3BCLmRlbGV0aW9uUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdhc0luUmlnaHRFbGVtZW50ID0gbWFya2VyUmFuZ2UuZW5kLmlzRXF1YWwob3BCLnNvdXJjZVBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBpZiAod2FzSW5MZWZ0RWxlbWVudCB8fCB3YXNTdGFydEJlZm9yZU1lcmdlZEVsZW1lbnQgfHwgd2FzRW5kQmVmb3JlTWVyZ2VkRWxlbWVudCB8fCB3YXNJblJpZ2h0RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRSZWxhdGlvbihvcEEsIG9wQiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FzSW5MZWZ0RWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhc1N0YXJ0QmVmb3JlTWVyZ2VkRWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhc0VuZEJlZm9yZU1lcmdlZEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB3YXNJblJpZ2h0RWxlbWVudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEV2YWx1YXRlcyBhbmQgcmV0dXJucyBjb250ZXh0dWFsIGluZm9ybWF0aW9uIGFib3V0IHR3byBnaXZlbiBvcGVyYXRpb25zIGBvcEFgIGFuZCBgb3BCYCB3aGljaCBhcmUgYWJvdXQgdG8gYmUgdHJhbnNmb3JtZWQuXG5cdCAqLyBnZXRDb250ZXh0KG9wQSwgb3BCLCBhSXNTdHJvbmcpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFJc1N0cm9uZyxcbiAgICAgICAgICAgIGFXYXNVbmRvbmU6IHRoaXMuX3dhc1VuZG9uZShvcEEpLFxuICAgICAgICAgICAgYldhc1VuZG9uZTogdGhpcy5fd2FzVW5kb25lKG9wQiksXG4gICAgICAgICAgICBhYlJlbGF0aW9uOiB0aGlzLl91c2VSZWxhdGlvbnMgPyB0aGlzLl9nZXRSZWxhdGlvbihvcEEsIG9wQikgOiBudWxsLFxuICAgICAgICAgICAgYmFSZWxhdGlvbjogdGhpcy5fdXNlUmVsYXRpb25zID8gdGhpcy5fZ2V0UmVsYXRpb24ob3BCLCBvcEEpIDogbnVsbCxcbiAgICAgICAgICAgIGZvcmNlV2Vha1JlbW92ZTogdGhpcy5fZm9yY2VXZWFrUmVtb3ZlXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHdoZXRoZXIgZ2l2ZW4gb3BlcmF0aW9uIGBvcGAgaGFzIGFscmVhZHkgYmVlbiB1bmRvbmUuXG5cdCAqXG5cdCAqIEluZm9ybWF0aW9uIHdoZXRoZXIgYW4gb3BlcmF0aW9uIHdhcyB1bmRvbmUgZ2l2ZXMgbW9yZSBjb250ZXh0IHdoZW4gbWFraW5nIGEgZGVjaXNpb24gd2hlbiB0d28gb3BlcmF0aW9ucyBhcmUgaW4gY29uZmxpY3QuXG5cdCAqLyBfd2FzVW5kb25lKG9wKSB7XG4gICAgICAgIC8vIEZvciBgb3BgLCBnZXQgaXRzIG9yaWdpbmFsIG9wZXJhdGlvbi4gQWZ0ZXIgYWxsLCBpZiBgb3BgIGlzIGEgY2xvbmUgKG9yIGV2ZW4gdHJhbnNmb3JtZWQgY2xvbmUpIG9mIGFub3RoZXJcbiAgICAgICAgLy8gb3BlcmF0aW9uLCBsaXRlcmFsbHkgYG9wYCBjb3VsZG4ndCBiZSB1bmRvbmUuIEl0IHdhcyBqdXN0IGdlbmVyYXRlZC4gSWYgYW55dGhpbmcsIGl0IHdhcyB0aGUgb3BlcmF0aW9uIGl0IG9yaWdpbnNcbiAgICAgICAgLy8gZnJvbSB3aGljaCB3YXMgdW5kb25lLiBTbyBnZXQgdGhhdCBvcmlnaW5hbCBvcGVyYXRpb24uXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsT3AgPSB0aGlzLm9yaWdpbmFsT3BlcmF0aW9ucy5nZXQob3ApO1xuICAgICAgICAvLyBBbmQgY2hlY2sgd2l0aCB0aGUgZG9jdW1lbnQgaWYgdGhlIG9yaWdpbmFsIG9wZXJhdGlvbiB3YXMgdW5kb25lLlxuICAgICAgICByZXR1cm4gb3JpZ2luYWxPcC53YXNVbmRvbmUgfHwgdGhpcy5faGlzdG9yeS5pc1VuZG9uZU9wZXJhdGlvbihvcmlnaW5hbE9wKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByZWxhdGlvbiBiZXR3ZWVuIGBvcEFgIGFuZCBhbiBvcGVyYXRpb24gd2hpY2ggaXMgdW5kb25lIGJ5IGBvcEJgLiBUaGlzIGNhbiBiZSBgU3RyaW5nYCB2YWx1ZSBpZiBhIHJlbGF0aW9uXG5cdCAqIHdhcyBzZXQgZWFybGllciBvciBgbnVsbGAgaWYgdGhlcmUgd2FzIG5vIHJlbGF0aW9uIGJldHdlZW4gdGhvc2Ugb3BlcmF0aW9ucy5cblx0ICpcblx0ICogVGhpcyBpcyBhIGxpdHRsZSB0cmlja3kgdG8gdW5kZXJzdGFuZCwgc28gbGV0J3MgY29tcGFyZSBpdCB0byBgQ29udGV4dEZhY3RvcnkjX3dhc1VuZG9uZWAuXG5cdCAqXG5cdCAqIFdoZW4gYHdhc1VuZG9uZSggb3BCIClgIGlzIHVzZWQsIHdlIGNoZWNrIGlmIHRoZSBgb3BCYCBoYXMgYWxyZWFkeSBiZWVuIHVuZG9uZS4gSXQgaXMgb2J2aW91cywgdGhhdCB0aGVcblx0ICogdW5kb2luZyBvcGVyYXRpb24gbXVzdCBoYXBwZW4gYWZ0ZXIgdGhlIHVuZG9uZSBvcGVyYXRpb24uIFNvLCBlc3NlbnRpYWxseSwgd2UgaGF2ZSBgb3BCYCwgd2UgdGFrZSBkb2N1bWVudCBoaXN0b3J5LFxuXHQgKiB3ZSBsb29rIGZvcndhcmQgaW4gdGhlIGZ1dHVyZSBhbmQgYXNrIGlmIGluIHRoYXQgZnV0dXJlIGBvcEJgIHdhcyB1bmRvbmUuXG5cdCAqXG5cdCAqIFJlbGF0aW9ucyBpcyBhIGJhY2t3YXJkIHByb2Nlc3MgdG8gYHdhc1VuZG9uZSgpYC5cblx0ICpcblx0ICogTG9uZyBzdG9yeSBzaG9ydCAtIHVzaW5nIHJlbGF0aW9ucyBpcyBhc2tpbmcgd2hhdCBoYXBwZW5lZCBpbiB0aGUgcGFzdC4gTG9va2luZyBiYWNrLiBUaGlzIHRpbWUgd2UgaGF2ZSBhbiB1bmRvaW5nXG5cdCAqIG9wZXJhdGlvbiBgb3BCYCB3aGljaCBoYXMgdW5kb25lIHNvbWUgb3RoZXIgb3BlcmF0aW9uLiBXaGVuIHRoZXJlIGlzIGEgdHJhbnNmb3JtYXRpb24gYG9wQWAgeCBgb3BCYCBhbmQgdGhlcmUgaXNcblx0ICogYSBjb25mbGljdCB0byBzb2x2ZSBhbmQgYG9wQmAgaXMgYW4gdW5kb2luZyBvcGVyYXRpb24sIHdlIGNhbiBsb29rIGJhY2sgaW4gdGhlIGhpc3RvcnkgYW5kIHNlZSB3aGF0IHdhcyBhIHJlbGF0aW9uXG5cdCAqIGJldHdlZW4gYG9wQWAgYW5kIHRoZSBvcGVyYXRpb24gd2hpY2ggYG9wQmAgdW5kb25lLiBCYXNpbmcgb24gdGhhdCByZWxhdGlvbiBmcm9tIHRoZSBwYXN0LCB3ZSBjYW4gbm93IG1ha2Vcblx0ICogYSBiZXR0ZXIgZGVjaXNpb24gd2hlbiByZXNvbHZpbmcgYSBjb25mbGljdCBiZXR3ZWVuIHR3byBvcGVyYXRpb25zLCBiZWNhdXNlIHdlIGtub3cgbW9yZSBhYm91dCB0aGUgY29udGV4dCBvZlxuXHQgKiB0aG9zZSB0d28gb3BlcmF0aW9ucy5cblx0ICpcblx0ICogVGhpcyBpcyB3aHkgdGhpcyBmdW5jdGlvbiBkb2VzIG5vdCByZXR1cm4gYSByZWxhdGlvbiBkaXJlY3RseSBiZXR3ZWVuIGBvcEFgIGFuZCBgb3BCYCBiZWNhdXNlIHdlIG5lZWQgdG8gbG9va1xuXHQgKiBiYWNrIHRvIHNlYXJjaCBmb3IgYSBtZWFuaW5nZnVsIGNvbnRleHR1YWwgaW5mb3JtYXRpb24uXG5cdCAqLyBfZ2V0UmVsYXRpb24ob3BBLCBvcEIpIHtcbiAgICAgICAgLy8gR2V0IHRoZSBvcmlnaW5hbCBvcGVyYXRpb24uIFNpbWlsYXJseSBhcyBpbiBgd2FzVW5kb25lKClgIGl0IGlzIHVzZWQgYXMgYW4gdW5pdmVyc2FsIGlkZW50aWZpZXIgZm9yIHN0b3JlZCBkYXRhLlxuICAgICAgICBjb25zdCBvcmlnQiA9IHRoaXMub3JpZ2luYWxPcGVyYXRpb25zLmdldChvcEIpO1xuICAgICAgICBjb25zdCB1bmRvbmVCID0gdGhpcy5faGlzdG9yeS5nZXRVbmRvbmVPcGVyYXRpb24ob3JpZ0IpO1xuICAgICAgICAvLyBJZiBgb3BCYCBpcyBub3QgdW5kb2luZyBhbnkgb3BlcmF0aW9uLCB0aGVyZSBpcyBubyByZWxhdGlvbi5cbiAgICAgICAgaWYgKCF1bmRvbmVCKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcmlnQSA9IHRoaXMub3JpZ2luYWxPcGVyYXRpb25zLmdldChvcEEpO1xuICAgICAgICBjb25zdCByZWxhdGlvbnNBID0gdGhpcy5fcmVsYXRpb25zLmdldChvcmlnQSk7XG4gICAgICAgIC8vIEdldCBhbGwgcmVsYXRpb25zIGZvciBgb3BBYCwgYW5kIGNoZWNrIGlmIHRoZXJlIGlzIGEgcmVsYXRpb24gd2l0aCBgb3BCYC11bmRvbmUtY291bnRlcnBhcnQuIElmIHNvLCByZXR1cm4gaXQuXG4gICAgICAgIGlmIChyZWxhdGlvbnNBKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVsYXRpb25zQS5nZXQodW5kb25lQikgfHwgbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhlbHBlciBmdW5jdGlvbiBmb3IgYENvbnRleHRGYWN0b3J5I3VwZGF0ZVJlbGF0aW9uc2AuXG5cdCAqLyBfc2V0UmVsYXRpb24ob3BBLCBvcEIsIHJlbGF0aW9uKSB7XG4gICAgICAgIC8vIEFzIGFsd2F5cywgc2V0dGluZyBpcyBmb3Igb3JpZ2luYWwgb3BlcmF0aW9ucywgbm90IHRoZSBjbG9uZXMvdHJhbnNmb3JtZWQgb3BlcmF0aW9ucy5cbiAgICAgICAgY29uc3Qgb3JpZ0EgPSB0aGlzLm9yaWdpbmFsT3BlcmF0aW9ucy5nZXQob3BBKTtcbiAgICAgICAgY29uc3Qgb3JpZ0IgPSB0aGlzLm9yaWdpbmFsT3BlcmF0aW9ucy5nZXQob3BCKTtcbiAgICAgICAgbGV0IHJlbGF0aW9uc0EgPSB0aGlzLl9yZWxhdGlvbnMuZ2V0KG9yaWdBKTtcbiAgICAgICAgaWYgKCFyZWxhdGlvbnNBKSB7XG4gICAgICAgICAgICByZWxhdGlvbnNBID0gbmV3IE1hcCgpO1xuICAgICAgICAgICAgdGhpcy5fcmVsYXRpb25zLnNldChvcmlnQSwgcmVsYXRpb25zQSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVsYXRpb25zQS5zZXQob3JpZ0IsIHJlbGF0aW9uKTtcbiAgICB9XG59XG4vKipcbiAqIEFuIHV0aWxpdHkgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uI2Jhc2VWZXJzaW9uIGJhc2UgdmVyc2lvbnN9XG4gKiBvZiBwYXNzZWQgb3BlcmF0aW9ucy5cbiAqXG4gKiBUaGUgZnVuY3Rpb24gc2ltcGx5IHNldHMgYGJhc2VWZXJzaW9uYCBhcyBhIGJhc2UgdmVyc2lvbiBvZiB0aGUgZmlyc3QgcGFzc2VkIG9wZXJhdGlvbiBhbmQgdGhlbiBpbmNyZW1lbnRzIGl0IGZvclxuICogZWFjaCBmb2xsb3dpbmcgb3BlcmF0aW9uIGluIGBvcGVyYXRpb25zYC5cbiAqXG4gKiBAcGFyYW0gb3BlcmF0aW9ucyBPcGVyYXRpb25zIHRvIHVwZGF0ZS5cbiAqIEBwYXJhbSBiYXNlVmVyc2lvbiBCYXNlIHZlcnNpb24gdG8gc2V0IGZvciB0aGUgZmlyc3Qgb3BlcmF0aW9uIGluIGBvcGVyYXRpb25zYC5cbiAqLyBmdW5jdGlvbiB1cGRhdGVCYXNlVmVyc2lvbnMob3BlcmF0aW9ucywgYmFzZVZlcnNpb24pIHtcbiAgICBmb3IgKGNvbnN0IG9wZXJhdGlvbiBvZiBvcGVyYXRpb25zKXtcbiAgICAgICAgb3BlcmF0aW9uLmJhc2VWZXJzaW9uID0gYmFzZVZlcnNpb24rKztcbiAgICB9XG59XG4vKipcbiAqIEFkZHMgYGhvd01hbnlgIGluc3RhbmNlcyBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vbm9vcGVyYXRpb25+Tm9PcGVyYXRpb259IHRvIGBvcGVyYXRpb25zYCBzZXQuXG4gKi8gZnVuY3Rpb24gcGFkV2l0aE5vT3BzKG9wZXJhdGlvbnMsIGhvd01hbnkpIHtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgaG93TWFueTsgaSsrKXtcbiAgICAgICAgb3BlcmF0aW9ucy5wdXNoKG5ldyBOb09wZXJhdGlvbigwKSk7XG4gICAgfVxufVxuLyoqXG4gKiBUcmFuc2Zvcm1lZCBvcGVyYXRpb25zIHNldCBtYXkgaW5jbHVkZSBtYXJrZXIgb3BlcmF0aW9ucyB3aGljaCB3ZXJlIGJyb2tlbiBpbnRvIG11bHRpcGxlIG1hcmtlciBvcGVyYXRpb25zIGR1cmluZyB0cmFuc2Zvcm1hdGlvbi5cbiAqIEl0IHJlcHJlc2VudHMgbWFya2VyIHJhbmdlIGJlaW5nIGJyb2tlbiBpbnRvIG11bHRpcGxlIHBpZWNlcyBhcyB0aGUgdHJhbnNmb3JtYXRpb24gd2FzIHByb2Nlc3NlZC4gRWFjaCBwYXJ0aWFsIG1hcmtlciBvcGVyYXRpb24gaXNcbiAqIGEgcGllY2Ugb2YgdGhlIG9yaWdpbmFsIG1hcmtlciByYW5nZS5cbiAqXG4gKiBUaGVzZSBwYXJ0aWFsIG1hcmtlciBvcGVyYXRpb25zIChcIm1hcmtlciByYW5nZSBwaWVjZXNcIikgc2hvdWxkIGJlIFwiZ2x1ZWRcIiB0b2dldGhlciBpZiwgYWZ0ZXIgdHJhbnNmb3JtYXRpb25zLCB0aGUgcmFuZ2VzIGVuZGVkIHVwXG4gKiBuZXh0IHRvIGVhY2ggb3RoZXIuXG4gKlxuICogSWYgdGhlIHJhbmdlcyBkaWQgbm90IGVuZCB1cCBuZXh0IHRvIGVhY2ggb3RoZXIsIHRoZW4gcGFydGlhbCBtYXJrZXIgb3BlcmF0aW9ucyBzaG91bGQgYmUgZGlzY2FyZGVkLCBhcyB0aGUgbWFya2VyIHJhbmdlIGNhbm5vdFxuICogYmUgYnJva2VuIGludG8gdHdvIHBpZWNlcy5cbiAqXG4gKiBUaGVyZSBpcyBhbHdheXMgb25lIFwicmVmZXJlbmNlXCIgbWFya2VyIG9wZXJhdGlvbiAodGhlIG9yaWdpbmFsIG9wZXJhdGlvbikgYW5kIHRoZXJlIG1heSBiZSBzb21lIHBhcnRpYWwgbWFya2VyIG9wZXJhdGlvbnMuIFBhcnRpYWxcbiAqIG1hcmtlciBvcGVyYXRpb25zIGhhdmUgYmFzZSB2ZXJzaW9uIHNldCB0byBgLTFgLiBJZiB0aGUgYG9wZXJhdGlvbnNgIHNldCBpbmNsdWRlcyBwYXJ0aWFsIG1hcmtlciBvcGVyYXRpb25zLCB0aGVuIHRoZXkgYXJlIGFsd2F5c1xuICogYWZ0ZXIgdGhlIG9yaWdpbmFsIG1hcmtlciBvcGVyYXRpb24uXG4gKlxuICogU2VlIGFsc28gYE1hcmtlck9wZXJhdGlvbmAgeCBgTW92ZU9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24uXG4gKiBTZWUgYWxzbyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L3B1bGwvMTcwNzEuXG4gKi8gZnVuY3Rpb24gaGFuZGxlUGFydGlhbE1hcmtlck9wZXJhdGlvbnMob3BlcmF0aW9ucykge1xuICAgIGNvbnN0IG1hcmtlck9wcyA9IG5ldyBNYXAoKTtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgb3BlcmF0aW9ucy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIGNvbnN0IG9wID0gb3BlcmF0aW9uc1tpXTtcbiAgICAgICAgaWYgKCEob3AgaW5zdGFuY2VvZiBNYXJrZXJPcGVyYXRpb24pKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3AuYmFzZVZlcnNpb24gIT09IC0xKSB7XG4gICAgICAgICAgICBtYXJrZXJPcHMuc2V0KG9wLm5hbWUsIHtcbiAgICAgICAgICAgICAgICBvcCxcbiAgICAgICAgICAgICAgICByYW5nZXM6IG9wLm5ld1JhbmdlID8gW1xuICAgICAgICAgICAgICAgICAgICBvcC5uZXdSYW5nZVxuICAgICAgICAgICAgICAgIF0gOiBbXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob3AubmV3UmFuZ2UpIHtcbiAgICAgICAgICAgICAgICAvLyBgbWFya2VyT3BzLmdldCggb3AubmFtZSApYCBtdXN0IGV4aXN0IGJlY2F1c2Ugb3JpZ2luYWwgbWFya2VyIG9wZXJhdGlvbiBpcyBhbHdheXMgYmVmb3JlIHBhcnRpYWwgbWFya2VyIG9wZXJhdGlvbnMuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIG9yaWdpbmFsIG1hcmtlciBvcGVyYXRpb24gd2FzIGNoYW5nZWQgdG8gYE5vT3BlcmF0aW9uYCwgdGhlbiB0aGUgcGFydGlhbCBtYXJrZXIgb3BlcmF0aW9ucyB3b3VsZCBiZSBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgLy8gdG8gYE5vT3BlcmF0aW9uYCBhcyB3ZWxsLCBzbyB0aGlzIGlzIG5vdCBhIGNhc2UuXG4gICAgICAgICAgICAgICAgbWFya2VyT3BzLmdldChvcC5uYW1lKS5yYW5nZXMucHVzaChvcC5uZXdSYW5nZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcGVyYXRpb25zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGktLTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IHsgb3AsIHJhbmdlcyB9IG9mIG1hcmtlck9wcy52YWx1ZXMoKSl7XG4gICAgICAgIGlmIChyYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBvcC5uZXdSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUmFuZ2VzKHJhbmdlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvcC5uZXdSYW5nZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuc2V0VHJhbnNmb3JtYXRpb24oQXR0cmlidXRlT3BlcmF0aW9uLCBBdHRyaWJ1dGVPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIC8vIElmIG9wZXJhdGlvbnMgaW4gY29uZmxpY3QsIGNoZWNrIGlmIHRoZWlyIHJhbmdlcyBpbnRlcnNlY3QgYW5kIG1hbmFnZSB0aGVtIHByb3Blcmx5LlxuICAgIC8vXG4gICAgLy8gT3BlcmF0aW9ucyBjYW4gYmUgaW4gY29uZmxpY3Qgb25seSBpZjpcbiAgICAvL1xuICAgIC8vICogdGhlaXIga2V5IGlzIHRoZSBzYW1lICh0aGV5IGNoYW5nZSB0aGUgc2FtZSBhdHRyaWJ1dGUpLCBhbmRcbiAgICAvLyAqIHRoZXkgYXJlIGluIHRoZSBzYW1lIHBhcmVudCAob3BlcmF0aW9ucyBmb3IgcmFuZ2VzIFsgMSBdIC0gWyAzIF0gYW5kIFsgMiwgMCBdIC0gWyAyLCA1IF0gY2hhbmdlIGRpZmZlcmVudFxuICAgIC8vIGVsZW1lbnRzIGFuZCBjYW4ndCBiZSBpbiBjb25mbGljdCkuXG4gICAgaWYgKGEua2V5ID09PSBiLmtleSAmJiBhLnJhbmdlLnN0YXJ0Lmhhc1NhbWVQYXJlbnRBcyhiLnJhbmdlLnN0YXJ0KSkge1xuICAgICAgICAvLyBGaXJzdCwgd2Ugd2FudCB0byBhcHBseSBjaGFuZ2UgdG8gdGhlIHBhcnQgb2YgYSByYW5nZSB0aGF0IGhhcyBub3QgYmVlbiBjaGFuZ2VkIGJ5IHRoZSBvdGhlciBvcGVyYXRpb24uXG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbnMgPSBhLnJhbmdlLmdldERpZmZlcmVuY2UoYi5yYW5nZSkubWFwKChyYW5nZSk9PntcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlT3BlcmF0aW9uKHJhbmdlLCBhLmtleSwgYS5vbGRWYWx1ZSwgYS5uZXdWYWx1ZSwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUaGVuIHdlIHRha2UgY2FyZSBvZiB0aGUgY29tbW9uIHBhcnQgb2YgcmFuZ2VzLlxuICAgICAgICBjb25zdCBjb21tb24gPSBhLnJhbmdlLmdldEludGVyc2VjdGlvbihiLnJhbmdlKTtcbiAgICAgICAgaWYgKGNvbW1vbikge1xuICAgICAgICAgICAgLy8gSWYgdGhpcyBvcGVyYXRpb24gaXMgbW9yZSBpbXBvcnRhbnQsIHdlIGFsc28gd2FudCB0byBhcHBseSBjaGFuZ2UgdG8gdGhlIHBhcnQgb2YgdGhlXG4gICAgICAgICAgICAvLyBvcmlnaW5hbCByYW5nZSB0aGF0IGhhcyBhbHJlYWR5IGJlZW4gY2hhbmdlZCBieSB0aGUgb3RoZXIgb3BlcmF0aW9uLiBTaW5jZSB0aGF0IHJhbmdlXG4gICAgICAgICAgICAvLyBnb3QgY2hhbmdlZCB3ZSBhbHNvIGhhdmUgdG8gdXBkYXRlIGBvbGRWYWx1ZWAuXG4gICAgICAgICAgICBpZiAoY29udGV4dC5hSXNTdHJvbmcpIHtcbiAgICAgICAgICAgICAgICBvcGVyYXRpb25zLnB1c2gobmV3IEF0dHJpYnV0ZU9wZXJhdGlvbihjb21tb24sIGIua2V5LCBiLm5ld1ZhbHVlLCBhLm5ld1ZhbHVlLCAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wZXJhdGlvbnMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IE5vT3BlcmF0aW9uKDApXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcGVyYXRpb25zO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIG9wZXJhdGlvbnMgZG9uJ3QgY29uZmxpY3QsIHNpbXBseSByZXR1cm4gYW4gYXJyYXkgY29udGFpbmluZyBqdXN0IGEgY2xvbmUgb2YgdGhpcyBvcGVyYXRpb24uXG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBhXG4gICAgICAgIF07XG4gICAgfVxufSk7XG5zZXRUcmFuc2Zvcm1hdGlvbihBdHRyaWJ1dGVPcGVyYXRpb24sIEluc2VydE9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgLy8gQ2FzZSAxOlxuICAgIC8vXG4gICAgLy8gVGhlIGF0dHJpYnV0ZSBvcGVyYXRpb24gcmFuZ2UgaW5jbHVkZXMgdGhlIHBvc2l0aW9uIHdoZXJlIG5vZGVzIHdlcmUgaW5zZXJ0ZWQuXG4gICAgLy8gVGhlcmUgYXJlIHR3byBwb3NzaWJsZSBzY2VuYXJpb3M6IHRoZSBpbnNlcnRlZCBub2RlcyB3ZXJlIHRleHQgYW5kIHRoZXkgc2hvdWxkIHJlY2VpdmUgYXR0cmlidXRlcyBvclxuICAgIC8vIHRoZSBpbnNlcnRlZCBub2RlcyB3ZXJlIGVsZW1lbnRzIGFuZCB0aGV5IHNob3VsZCBub3QgcmVjZWl2ZSBhdHRyaWJ1dGVzLlxuICAgIC8vXG4gICAgaWYgKGEucmFuZ2Uuc3RhcnQuaGFzU2FtZVBhcmVudEFzKGIucG9zaXRpb24pICYmIGEucmFuZ2UuY29udGFpbnNQb3NpdGlvbihiLnBvc2l0aW9uKSkge1xuICAgICAgICAvLyBJZiBuZXcgbm9kZXMgc2hvdWxkIG5vdCByZWNlaXZlIGF0dHJpYnV0ZXMsIHR3byBzZXBhcmF0ZWQgcmFuZ2VzIHdpbGwgYmUgcmV0dXJuZWQuXG4gICAgICAgIC8vIE90aGVyd2lzZSwgb25lIGV4cGFuZGVkIHJhbmdlIHdpbGwgYmUgcmV0dXJuZWQuXG4gICAgICAgIGNvbnN0IHJhbmdlID0gYS5yYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihiLnBvc2l0aW9uLCBiLmhvd01hbnksICFiLnNob3VsZFJlY2VpdmVBdHRyaWJ1dGVzKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcmFuZ2UubWFwKChyKT0+e1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBBdHRyaWJ1dGVPcGVyYXRpb24ociwgYS5rZXksIGEub2xkVmFsdWUsIGEubmV3VmFsdWUsIGEuYmFzZVZlcnNpb24pO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGIuc2hvdWxkUmVjZWl2ZUF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIC8vIGBBdHRyaWJ1dGVPcGVyYXRpb24jcmFuZ2VgIGluY2x1ZGVzIHNvbWUgbmV3bHkgaW5zZXJ0ZWQgdGV4dC5cbiAgICAgICAgICAgIC8vIFRoZSBvcGVyYXRpb24gc2hvdWxkIGFsc28gY2hhbmdlIHRoZSBhdHRyaWJ1dGUgb2YgdGhhdCB0ZXh0LiBBbiBleGFtcGxlOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJvbGQgc2hvdWxkIGJlIGFwcGxpZWQgb24gdGhlIGZvbGxvd2luZyByYW5nZTpcbiAgICAgICAgICAgIC8vIDxwPkZvW3piXWFyPC9wPlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEluIG1lYW50aW1lLCBuZXcgdGV4dCBpcyB0eXBlZDpcbiAgICAgICAgICAgIC8vIDxwPkZvenh4YmFyPC9wPlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJvbGQgc2hvdWxkIGJlIGFwcGxpZWQgYWxzbyBvbiB0aGUgbmV3IHRleHQ6XG4gICAgICAgICAgICAvLyA8cD5Gb1t6eHhiXWFyPC9wPlxuICAgICAgICAgICAgLy8gPHA+Rm88JHRleHQgYm9sZD1cInRydWVcIj56eHhiPC8kdGV4dD5hcjwvcD5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBUaGVyZSBpcyBhIHNwZWNpYWwgY2FzZSB0byBjb25zaWRlciBoZXJlIHRvIGNvbnNpZGVyLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIENvbnNpZGVyIHNldHRpbmcgYW4gYXR0cmlidXRlIHdpdGggbXVsdGlwbGUgcG9zc2libGUgdmFsdWVzLCBmb3IgZXhhbXBsZSBgaGlnaGxpZ2h0YC4gVGhlIGluc2VydGVkIHRleHQgbWlnaHRcbiAgICAgICAgICAgIC8vIGhhdmUgYWxyZWFkeSBhbiBhdHRyaWJ1dGUgdmFsdWUgYXBwbGllZCBhbmQgdGhlIGBvbGRWYWx1ZWAgcHJvcGVydHkgb2YgdGhlIGF0dHJpYnV0ZSBvcGVyYXRpb24gbWlnaHQgYmUgd3Jvbmc6XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gQXR0cmlidXRlIGBoaWdobGlnaHQ9XCJ5ZWxsb3dcImAgc2hvdWxkIGJlIGFwcGxpZWQgb24gdGhlIGZvbGxvd2luZyByYW5nZTpcbiAgICAgICAgICAgIC8vIDxwPkZvW3piXWFyPHA+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gSW4gbWVhbnRpbWUsIGNoYXJhY3RlciBgeGAgd2l0aCBgaGlnaGxpZ2h0PVwicmVkXCJgIGlzIHR5cGVkOlxuICAgICAgICAgICAgLy8gPHA+Rm9bejwkdGV4dCBoaWdobGlnaHQ9XCJyZWRcIj54PC8kdGV4dD5iXWFyPC9wPlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSB3ZSBjYW5ub3Qgc2ltcGx5IGFwcGx5IG9wZXJhdGlvbiBjaGFuZ2luZyB0aGUgYXR0cmlidXRlIHZhbHVlIGZyb20gYG51bGxgIHRvIGBcInllbGxvd1wiYCBmb3IgdGhlIHdob2xlIHJhbmdlXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoYXQgd291bGQgbGVhZCB0byBhbiBleGNlcHRpb24gKGBvbGRWYWx1ZWAgaXMgaW5jb3JyZWN0IGZvciBgeGApLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFdlIGFsc28gY2Fubm90IGJyZWFrIHRoZSBvcmlnaW5hbCByYW5nZSBhcyB0aGlzIHdvdWxkIG1lc3MgdXAgYSBzY2VuYXJpbyB3aGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBmb2xsb3dpbmdcbiAgICAgICAgICAgIC8vIGluc2VydCBvcGVyYXRpb25zLCBiZWNhdXNlIHRoZW4gb25seSB0aGUgZmlyc3QgaW5zZXJ0ZWQgY2hhcmFjdGVyIGlzIGluY2x1ZGVkIGluIHRob3NlIHJhbmdlczpcbiAgICAgICAgICAgIC8vIDxwPkZvW3pdW3hdW2JdYXI8L3A+ICAgLS0+ICAgPHA+Rm9bel1beF14W2JdYXI8L3A+ICAgLS0+ICAgPHA+Rm9bel1beF14eFtiXWFyPC9wPlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFNvLCB0aGUgYXR0cmlidXRlIHJhbmdlIG5lZWRzIGJlIGV4cGFuZGVkLCBubyBtYXR0ZXIgd2hhdCBhdHRyaWJ1dGVzIGFyZSBzZXQgb24gdGhlIGluc2VydGVkIG5vZGVzOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIDxwPkZvW3o8JHRleHQgaGlnaGxpZ2h0PVwicmVkXCI+eDwvJHRleHQ+Yl1hcjwvcD4gICAgICA8LS0tIENoYW5nZSBmcm9tIGBudWxsYCB0byBgeWVsbG93YCwgdGhyb3dpbmcgYW4gZXhjZXB0aW9uLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEJ1dCBiZWZvcmUgdGhhdCBvcGVyYXRpb24gd291bGQgYmUgYXBwbGllZCwgd2Ugd2lsbCBhZGQgYW4gYWRkaXRpb25hbCBhdHRyaWJ1dGUgb3BlcmF0aW9uIHRoYXQgd2lsbCBjaGFuZ2VcbiAgICAgICAgICAgIC8vIGF0dHJpYnV0ZXMgb24gdGhlIGluc2VydGVkIG5vZGVzIGluIGEgd2F5IHdoaWNoIHdvdWxkIG1ha2UgdGhlIG9yaWdpbmFsIG9wZXJhdGlvbiBjb3JyZWN0OlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIDxwPkZvW3p7PCR0ZXh0IGhpZ2hsaWdodD1cInJlZFwiPn14PC8kdGV4dD5iXWFyPC9wPiAgICA8LS0tIENoYW5nZSByYW5nZSBge31gIGZyb20gYHJlZGAgdG8gYG51bGxgLlxuICAgICAgICAgICAgLy8gPHA+Rm9benhiXWFyPC9wPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8LS0tIE5vdyBjaGFuZ2UgZnJvbSBgbnVsbGAgdG8gYHllbGxvd2AgaXMgY29tcGxldGVseSBmaW5lLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGNvbXBsZW1lbnRhcnkgYXR0cmlidXRlIG9wZXJhdGlvbi4gQmUgc3VyZSB0byBhZGQgaXQgYmVmb3JlIHRoZSBvcmlnaW5hbCBvcGVyYXRpb24uXG4gICAgICAgICAgICBjb25zdCBvcCA9IF9nZXRDb21wbGVtZW50YXJ5QXR0cmlidXRlT3BlcmF0aW9ucyhiLCBhLmtleSwgYS5vbGRWYWx1ZSk7XG4gICAgICAgICAgICBpZiAob3ApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQudW5zaGlmdChvcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgbm9kZXMgc2hvdWxkIG5vdCByZWNlaXZlIG5ldyBhdHRyaWJ1dGUsIHdlIGFyZSBkb25lIGhlcmUuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8vIElmIGluc2VydCBvcGVyYXRpb24gaXMgbm90IGV4cGFuZGluZyB0aGUgYXR0cmlidXRlIG9wZXJhdGlvbiByYW5nZSwgc2ltcGx5IHRyYW5zZm9ybSB0aGUgcmFuZ2UuXG4gICAgYS5yYW5nZSA9IGEucmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRpb24oYi5wb3NpdGlvbiwgYi5ob3dNYW55LCBmYWxzZSlbMF07XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBgQXR0cmlidXRlT3BlcmF0aW9uYCB4IGBJbnNlcnRPcGVyYXRpb25gIChhbmQgcmV2ZXJzZSkgdHJhbnNmb3JtYXRpb24uXG4gKlxuICogRm9yIGdpdmVuIGBpbnNlcnRPcGVyYXRpb25gIGl0IGNoZWNrcyB0aGUgaW5zZXJ0ZWQgbm9kZSBpZiBpdCBoYXMgYW4gYXR0cmlidXRlIGBrZXlgIHNldCB0byBhIHZhbHVlIGRpZmZlcmVudFxuICogdGhhbiBgbmV3VmFsdWVgLiBJZiBzbywgaXQgZ2VuZXJhdGVzIGFuIGBBdHRyaWJ1dGVPcGVyYXRpb25gIHdoaWNoIGNoYW5nZXMgdGhlIHZhbHVlIG9mIGBrZXlgIGF0dHJpYnV0ZSB0byBgbmV3VmFsdWVgLlxuICovIGZ1bmN0aW9uIF9nZXRDb21wbGVtZW50YXJ5QXR0cmlidXRlT3BlcmF0aW9ucyhpbnNlcnRPcGVyYXRpb24sIGtleSwgbmV3VmFsdWUpIHtcbiAgICBjb25zdCBub2RlcyA9IGluc2VydE9wZXJhdGlvbi5ub2RlcztcbiAgICAvLyBBdCB0aGUgYmVnaW5uaW5nIHdlIHN0b3JlIHRoZSBhdHRyaWJ1dGUgdmFsdWUgZnJvbSB0aGUgZmlyc3Qgbm9kZS5cbiAgICBjb25zdCBpbnNlcnRWYWx1ZSA9IG5vZGVzLmdldE5vZGUoMCkuZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgaWYgKGluc2VydFZhbHVlID09IG5ld1ZhbHVlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCByYW5nZSA9IG5ldyBSYW5nZShpbnNlcnRPcGVyYXRpb24ucG9zaXRpb24sIGluc2VydE9wZXJhdGlvbi5wb3NpdGlvbi5nZXRTaGlmdGVkQnkoaW5zZXJ0T3BlcmF0aW9uLmhvd01hbnkpKTtcbiAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZU9wZXJhdGlvbihyYW5nZSwga2V5LCBpbnNlcnRWYWx1ZSwgbmV3VmFsdWUsIDApO1xufVxuc2V0VHJhbnNmb3JtYXRpb24oQXR0cmlidXRlT3BlcmF0aW9uLCBNZXJnZU9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgY29uc3QgcmFuZ2VzID0gW107XG4gICAgLy8gQ2FzZSAxOlxuICAgIC8vXG4gICAgLy8gQXR0cmlidXRlIGNoYW5nZSBvbiB0aGUgbWVyZ2VkIGVsZW1lbnQuIEluIHRoaXMgY2FzZSwgdGhlIG1lcmdlZCBlbGVtZW50IHdhcyBtb3ZlZCB0byB0aGUgZ3JhdmV5YXJkLlxuICAgIC8vIEFuIGFkZGl0aW9uYWwgYXR0cmlidXRlIG9wZXJhdGlvbiB0aGF0IHdpbGwgY2hhbmdlIHRoZSAocmUpbW92ZWQgZWxlbWVudCBuZWVkcyB0byBiZSBnZW5lcmF0ZWQuXG4gICAgLy9cbiAgICBpZiAoYS5yYW5nZS5zdGFydC5oYXNTYW1lUGFyZW50QXMoYi5kZWxldGlvblBvc2l0aW9uKSkge1xuICAgICAgICBpZiAoYS5yYW5nZS5jb250YWluc1Bvc2l0aW9uKGIuZGVsZXRpb25Qb3NpdGlvbikgfHwgYS5yYW5nZS5zdGFydC5pc0VxdWFsKGIuZGVsZXRpb25Qb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChiLmdyYXZleWFyZFBvc2l0aW9uLCAxKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcmFuZ2UgPSBhLnJhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgLy8gRG8gbm90IGFkZCBlbXB0eSAoY29sbGFwc2VkKSByYW5nZXMgdG8gdGhlIHJlc3VsdC4gYHJhbmdlYCBtYXkgYmUgY29sbGFwc2VkIGlmIGl0IGNvbnRhaW5lZCBvbmx5IHRoZSBtZXJnZWQgZWxlbWVudC5cbiAgICBpZiAoIXJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgIHJhbmdlcy5wdXNoKHJhbmdlKTtcbiAgICB9XG4gICAgLy8gQ3JlYXRlIGBBdHRyaWJ1dGVPcGVyYXRpb25gcyBvdXQgb2YgdGhlIHJhbmdlcy5cbiAgICByZXR1cm4gcmFuZ2VzLm1hcCgocmFuZ2UpPT57XG4gICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlT3BlcmF0aW9uKHJhbmdlLCBhLmtleSwgYS5vbGRWYWx1ZSwgYS5uZXdWYWx1ZSwgYS5iYXNlVmVyc2lvbik7XG4gICAgfSk7XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKEF0dHJpYnV0ZU9wZXJhdGlvbiwgTW92ZU9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgY29uc3QgcmFuZ2VzID0gX2JyZWFrUmFuZ2VCeU1vdmVPcGVyYXRpb24oYS5yYW5nZSwgYik7XG4gICAgLy8gQ3JlYXRlIGBBdHRyaWJ1dGVPcGVyYXRpb25gcyBvdXQgb2YgdGhlIHJhbmdlcy5cbiAgICByZXR1cm4gcmFuZ2VzLm1hcCgocmFuZ2UpPT5uZXcgQXR0cmlidXRlT3BlcmF0aW9uKHJhbmdlLCBhLmtleSwgYS5vbGRWYWx1ZSwgYS5uZXdWYWx1ZSwgYS5iYXNlVmVyc2lvbikpO1xufSk7XG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiBmb3IgYEF0dHJpYnV0ZU9wZXJhdGlvbmAgeCBgTW92ZU9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24uXG4gKlxuICogVGFrZXMgdGhlIHBhc3NlZCBgcmFuZ2VgIGFuZCB0cmFuc2Zvcm1zIGl0IGJ5IG1vdmUgb3BlcmF0aW9uIGBtb3ZlT3BgIGluIGEgc3BlY2lmaWMgd2F5LiBPbmx5IHRvcC1sZXZlbCBub2RlcyBvZiBgcmFuZ2VgXG4gKiBhcmUgY29uc2lkZXJlZCB0byBiZSBpbiB0aGUgcmFuZ2UuIElmIG1vdmUgb3BlcmF0aW9uIG1vdmVzIG5vZGVzIGRlZXAgZnJvbSBpbnNpZGUgb2YgdGhlIHJhbmdlLCB0aG9zZSBub2RlcyB3b24ndFxuICogYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdC4gSW4gb3RoZXIgd29yZHMsIHRvcC1sZXZlbCBub2RlcyBvZiB0aGUgcmFuZ2VzIGZyb20gdGhlIHJlc3VsdCBhcmUgZXhhY3RseSB0aGUgc2FtZSBhc1xuICogdG9wLWxldmVsIG5vZGVzIG9mIHRoZSBvcmlnaW5hbCBgcmFuZ2VgLlxuICpcbiAqIFRoaXMgaXMgaW1wb3J0YW50IGZvciBgQXR0cmlidXRlT3BlcmF0aW9uYCBiZWNhdXNlLCBmb3IgaXRzIHJhbmdlLCBpdCBjaGFuZ2VzIG9ubHkgdGhlIHRvcC1sZXZlbCBub2Rlcy4gU28gd2UgbmVlZCB0b1xuICogdHJhY2sgb25seSBob3cgdGhvc2Ugbm9kZXMgaGF2ZSBiZWVuIGFmZmVjdGVkIGJ5IGBNb3ZlT3BlcmF0aW9uYC5cbiAqLyBmdW5jdGlvbiBfYnJlYWtSYW5nZUJ5TW92ZU9wZXJhdGlvbihyYW5nZSwgbW92ZU9wKSB7XG4gICAgY29uc3QgbW92ZVJhbmdlID0gUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KG1vdmVPcC5zb3VyY2VQb3NpdGlvbiwgbW92ZU9wLmhvd01hbnkpO1xuICAgIC8vIFdlIGFyZSB0cmFuc2Zvcm1pbmcgYHJhbmdlYCAob3JpZ2luYWwgcmFuZ2UpIGJ5IGBtb3ZlUmFuZ2VgIChyYW5nZSBtb3ZlZCBieSBtb3ZlIG9wZXJhdGlvbikuIEFzIHVzdWFsIHdoZW4gaXQgY29tZXMgdG9cbiAgICAvLyB0cmFuc2Zvcm1pbmcgYSByYW5nZXMsIHdlIG1heSBoYXZlIGEgY29tbW9uIHBhcnQgb2YgdGhlIHJhbmdlcyBhbmQgd2UgbWF5IGhhdmUgYSBkaWZmZXJlbmNlIHBhcnQgKHplcm8gdG8gdHdvIHJhbmdlcykuXG4gICAgbGV0IGNvbW1vbiA9IG51bGw7XG4gICAgbGV0IGRpZmZlcmVuY2UgPSBbXTtcbiAgICAvLyBMZXQncyBjb21wYXJlIHRoZSByYW5nZXMuXG4gICAgaWYgKG1vdmVSYW5nZS5jb250YWluc1JhbmdlKHJhbmdlLCB0cnVlKSkge1xuICAgICAgICAvLyBJZiB0aGUgd2hvbGUgb3JpZ2luYWwgcmFuZ2UgaXMgbW92ZWQsIHRyZWF0IGl0IHdob2xlIGFzIGEgY29tbW9uIHBhcnQuIFRoZXJlJ3MgYWxzbyBubyBkaWZmZXJlbmNlIHBhcnQuXG4gICAgICAgIGNvbW1vbiA9IHJhbmdlO1xuICAgIH0gZWxzZSBpZiAocmFuZ2Uuc3RhcnQuaGFzU2FtZVBhcmVudEFzKG1vdmVSYW5nZS5zdGFydCkpIHtcbiAgICAgICAgLy8gSWYgdGhlIHJhbmdlcyBhcmUgXCJvbiB0aGUgc2FtZSBsZXZlbFwiIChpbiB0aGUgc2FtZSBwYXJlbnQpIHRoZW4gbW92ZSBvcGVyYXRpb24gbWF5IG1vdmUgZXhhY3RseSB0aG9zZSBub2Rlc1xuICAgICAgICAvLyB0aGF0IGFyZSBjaGFuZ2VkIGJ5IHRoZSBhdHRyaWJ1dGUgb3BlcmF0aW9uLiBJbiB0aGlzIGNhc2Ugd2UgZ2V0IGNvbW1vbiBwYXJ0IGFuZCBkaWZmZXJlbmNlIHBhcnQgaW4gdGhlIHVzdWFsIHdheS5cbiAgICAgICAgZGlmZmVyZW5jZSA9IHJhbmdlLmdldERpZmZlcmVuY2UobW92ZVJhbmdlKTtcbiAgICAgICAgY29tbW9uID0gcmFuZ2UuZ2V0SW50ZXJzZWN0aW9uKG1vdmVSYW5nZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSW4gYW55IG90aGVyIHNpdHVhdGlvbiB3ZSBhc3N1bWUgdGhhdCBvcmlnaW5hbCByYW5nZSBpcyBkaWZmZXJlbnQgdGhhbiBtb3ZlIHJhbmdlLCB0aGF0IGlzIHRoYXQgbW92ZSBvcGVyYXRpb25cbiAgICAgICAgLy8gbW92ZXMgb3RoZXIgbm9kZXMgdGhhdCBhdHRyaWJ1dGUgb3BlcmF0aW9uIGNoYW5nZS4gRXZlbiBpZiB0aGUgbW92ZWQgcmFuZ2UgaXMgZGVlcCBpbnNpZGUgaW4gdGhlIG9yaWdpbmFsIHJhbmdlLlxuICAgICAgICAvL1xuICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBpcyBkaWZmZXJlbnQgdGhhbiBpbiBgLmdldEludGVyc2VjdGlvbmAgKHdlIHdvdWxkIGdldCBhIGNvbW1vbiBwYXJ0IGluIHRoYXQgY2FzZSkgYW5kIGRpZmZlcmVudFxuICAgICAgICAvLyB0aGFuIGAuZ2V0RGlmZmVyZW5jZWAgKHdlIHdvdWxkIGdldCB0d28gcmFuZ2VzKS5cbiAgICAgICAgZGlmZmVyZW5jZSA9IFtcbiAgICAgICAgICAgIHJhbmdlXG4gICAgICAgIF07XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIC8vIFRoZSBkZWZhdWx0IGJlaGF2aW91ciBvZiBgX2dldFRyYW5zZm9ybWVkQnlNb3ZlYCBtaWdodCBnZXQgd3JvbmcgcmVzdWx0cyBmb3IgZGlmZmVyZW5jZSBwYXJ0LCB0aG91Z2gsIHNvXG4gICAgLy8gd2UgZG8gaXQgYnkgaGFuZC5cbiAgICBmb3IgKGxldCBkaWZmIG9mIGRpZmZlcmVuY2Upe1xuICAgICAgICAvLyBGaXJzdCwgdHJhbnNmb3JtIHRoZSByYW5nZSBieSByZW1vdmluZyBtb3ZlZCBub2Rlcy4gU2luY2UgdGhpcyBpcyBhIGRpZmZlcmVuY2UsIHRoaXMgaXMgc2FmZSwgYG51bGxgIHdvbid0IGJlIHJldHVybmVkXG4gICAgICAgIC8vIGFzIHRoZSByYW5nZSBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgbW92ZWQgcmFuZ2UuXG4gICAgICAgIGRpZmYgPSBkaWZmLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24obW92ZU9wLnNvdXJjZVBvc2l0aW9uLCBtb3ZlT3AuaG93TWFueSk7XG4gICAgICAgIC8vIFRyYW5zZm9ybSBhbHNvIGB0YXJnZXRQb3NpdGlvbmAuXG4gICAgICAgIGNvbnN0IHRhcmdldFBvc2l0aW9uID0gbW92ZU9wLmdldE1vdmVkUmFuZ2VTdGFydCgpO1xuICAgICAgICAvLyBTcHJlYWQgdGhlIHJhbmdlIG9ubHkgaWYgbW92ZWQgbm9kZXMgYXJlIGluc2VydGVkIG9ubHkgYmV0d2VlbiB0aGUgdG9wLWxldmVsIG5vZGVzIG9mIHRoZSBgZGlmZmAgcmFuZ2UuXG4gICAgICAgIGNvbnN0IHNwcmVhZCA9IGRpZmYuc3RhcnQuaGFzU2FtZVBhcmVudEFzKHRhcmdldFBvc2l0aW9uKTtcbiAgICAgICAgLy8gVHJhbnNmb3JtIGJ5IGluc2VydGlvbiBvZiBtb3ZlZCBub2Rlcy5cbiAgICAgICAgY29uc3QgZGlmZnMgPSBkaWZmLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0aW9uKHRhcmdldFBvc2l0aW9uLCBtb3ZlT3AuaG93TWFueSwgc3ByZWFkKTtcbiAgICAgICAgcmVzdWx0LnB1c2goLi4uZGlmZnMpO1xuICAgIH1cbiAgICAvLyBDb21tb24gcGFydCBjYW4gYmUgc2ltcGx5IHRyYW5zZm9ybWVkIGJ5IHRoZSBtb3ZlIG9wZXJhdGlvbi4gVGhpcyBpcyBiZWNhdXNlIG1vdmUgb3BlcmF0aW9uIHdpbGwgbm90IHRhcmdldCB0b1xuICAgIC8vIHRoYXQgY29tbW9uIHBhcnQgKHRoZSBvcGVyYXRpb24gd291bGQgaGF2ZSB0byB0YXJnZXQgaW5zaWRlIGl0cyBvd24gbW92ZWQgcmFuZ2UpLlxuICAgIGlmIChjb21tb24pIHtcbiAgICAgICAgcmVzdWx0LnB1c2goY29tbW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShtb3ZlT3Auc291cmNlUG9zaXRpb24sIG1vdmVPcC50YXJnZXRQb3NpdGlvbiwgbW92ZU9wLmhvd01hbnksIGZhbHNlKVswXSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5zZXRUcmFuc2Zvcm1hdGlvbihBdHRyaWJ1dGVPcGVyYXRpb24sIFNwbGl0T3BlcmF0aW9uLCAoYSwgYik9PntcbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBTcGxpdCBub2RlIGlzIHRoZSBsYXN0IG5vZGUgaW4gYEF0dHJpYnV0ZU9wZXJhdGlvbiNyYW5nZWAuXG4gICAgLy8gYEF0dHJpYnV0ZU9wZXJhdGlvbiNyYW5nZWAgbmVlZHMgdG8gYmUgZXhwYW5kZWQgdG8gaW5jbHVkZSB0aGUgbmV3IChzcGxpdCkgbm9kZS5cbiAgICAvL1xuICAgIC8vIEF0dHJpYnV0ZSBgdHlwZWAgdG8gYmUgY2hhbmdlZCB0byBgbnVtYmVyZWRgIGJ1dCB0aGUgYGxpc3RJdGVtYCBpcyBzcGxpdC5cbiAgICAvLyA8bGlzdEl0ZW0gdHlwZT1cImJ1bGxldGVkXCI+Zm9vYmFyPC9saXN0SXRlbT5cbiAgICAvL1xuICAgIC8vIEFmdGVyIHNwbGl0OlxuICAgIC8vIDxsaXN0SXRlbSB0eXBlPVwiYnVsbGV0ZWRcIj5mb288L2xpc3RJdGVtPjxsaXN0SXRlbSB0eXBlPVwiYnVsbGV0ZWRcIj5iYXI8L2xpc3RJdGVtPlxuICAgIC8vXG4gICAgLy8gQWZ0ZXIgYXR0cmlidXRlIGNoYW5nZTpcbiAgICAvLyA8bGlzdEl0ZW0gdHlwZT1cIm51bWJlcmVkXCI+Zm9vPC9saXN0SXRlbT48bGlzdEl0ZW0gdHlwZT1cIm51bWJlcmVkXCI+Zm9vPC9saXN0SXRlbT5cbiAgICAvL1xuICAgIGlmIChhLnJhbmdlLmVuZC5pc0VxdWFsKGIuaW5zZXJ0aW9uUG9zaXRpb24pKSB7XG4gICAgICAgIGlmICghYi5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgYS5yYW5nZS5lbmQub2Zmc2V0Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGFcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gQ2FzZSAyOlxuICAgIC8vXG4gICAgLy8gU3BsaXQgcG9zaXRpb24gaXMgaW5zaWRlIGBBdHRyaWJ1dGVPcGVyYXRpb24jcmFuZ2VgLCBhdCB0aGUgc2FtZSBsZXZlbCwgc28gdGhlIG5vZGVzIHRvIGNoYW5nZSBhcmVcbiAgICAvLyBub3QgZ29pbmcgdG8gbWFrZSBhIGZsYXQgcmFuZ2UuXG4gICAgLy9cbiAgICAvLyBDb250ZW50IHdpdGggcmFuZ2UtdG8tY2hhbmdlIGFuZCBzcGxpdCBwb3NpdGlvbjpcbiAgICAvLyA8cD5Gb1t6Yl5hXXI8L3A+XG4gICAgLy9cbiAgICAvLyBBZnRlciBzcGxpdDpcbiAgICAvLyA8cD5Gb3piPC9wPjxwPmFyPC9wPlxuICAgIC8vXG4gICAgLy8gTWFrZSB0d28gc2VwYXJhdGUgcmFuZ2VzIGNvbnRhaW5pbmcgYWxsIG5vZGVzIHRvIGNoYW5nZTpcbiAgICAvLyA8cD5Gb1t6Yl08L3A+PHA+W2FdcjwvcD5cbiAgICAvL1xuICAgIGlmIChhLnJhbmdlLnN0YXJ0Lmhhc1NhbWVQYXJlbnRBcyhiLnNwbGl0UG9zaXRpb24pICYmIGEucmFuZ2UuY29udGFpbnNQb3NpdGlvbihiLnNwbGl0UG9zaXRpb24pKSB7XG4gICAgICAgIGNvbnN0IHNlY29uZFBhcnQgPSBhLmNsb25lKCk7XG4gICAgICAgIHNlY29uZFBhcnQucmFuZ2UgPSBuZXcgUmFuZ2UoYi5tb3ZlVGFyZ2V0UG9zaXRpb24uY2xvbmUoKSwgYS5yYW5nZS5lbmQuX2dldENvbWJpbmVkKGIuc3BsaXRQb3NpdGlvbiwgYi5tb3ZlVGFyZ2V0UG9zaXRpb24pKTtcbiAgICAgICAgYS5yYW5nZS5lbmQgPSBiLnNwbGl0UG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgYS5yYW5nZS5lbmQuc3RpY2tpbmVzcyA9ICd0b1ByZXZpb3VzJztcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGEsXG4gICAgICAgICAgICBzZWNvbmRQYXJ0XG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIFRoZSBkZWZhdWx0IGNhc2UuXG4gICAgLy9cbiAgICBhLnJhbmdlID0gYS5yYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKGIpO1xuICAgIHJldHVybiBbXG4gICAgICAgIGFcbiAgICBdO1xufSk7XG5zZXRUcmFuc2Zvcm1hdGlvbihJbnNlcnRPcGVyYXRpb24sIEF0dHJpYnV0ZU9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgY29uc3QgcmVzdWx0ID0gW1xuICAgICAgICBhXG4gICAgXTtcbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBUaGUgYXR0cmlidXRlIG9wZXJhdGlvbiByYW5nZSBpbmNsdWRlcyB0aGUgcG9zaXRpb24gd2hlcmUgbm9kZXMgd2VyZSBpbnNlcnRlZC5cbiAgICAvLyBUaGVyZSBhcmUgdHdvIHBvc3NpYmxlIHNjZW5hcmlvczogdGhlIGluc2VydGVkIG5vZGVzIHdlcmUgdGV4dCBhbmQgdGhleSBzaG91bGQgcmVjZWl2ZSBhdHRyaWJ1dGVzIG9yXG4gICAgLy8gdGhlIGluc2VydGVkIG5vZGVzIHdlcmUgZWxlbWVudHMgYW5kIHRoZXkgc2hvdWxkIG5vdCByZWNlaXZlIGF0dHJpYnV0ZXMuXG4gICAgLy9cbiAgICAvLyBUaGlzIGlzIGEgbWlycm9yIHNjZW5hcmlvIHRvIHRoZSBvbmUgZGVzY3JpYmVkIGluIGBBdHRyaWJ1dGVPcGVyYXRpb25gIHggYEluc2VydE9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24sXG4gICAgLy8gYWx0aG91Z2ggdGhpcyBjYXNlIGlzIGEgbGl0dGxlIGxlc3MgY29tcGxpY2F0ZWQuIEluIHRoaXMgY2FzZSB3ZSBzaW1wbHkgbmVlZCB0byBjaGFuZ2UgYXR0cmlidXRlcyBvZiB0aGVcbiAgICAvLyBpbnNlcnRlZCBub2RlcyBhbmQgdGhhdCdzIGl0LlxuICAgIC8vXG4gICAgaWYgKGEuc2hvdWxkUmVjZWl2ZUF0dHJpYnV0ZXMgJiYgYS5wb3NpdGlvbi5oYXNTYW1lUGFyZW50QXMoYi5yYW5nZS5zdGFydCkgJiYgYi5yYW5nZS5jb250YWluc1Bvc2l0aW9uKGEucG9zaXRpb24pKSB7XG4gICAgICAgIGNvbnN0IG9wID0gX2dldENvbXBsZW1lbnRhcnlBdHRyaWJ1dGVPcGVyYXRpb25zKGEsIGIua2V5LCBiLm5ld1ZhbHVlKTtcbiAgICAgICAgaWYgKG9wKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChvcCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZSBpczogZG8gbm90aGluZy5cbiAgICAvLyBgQXR0cmlidXRlT3BlcmF0aW9uYCBkb2VzIG5vdCBjaGFuZ2UgdGhlIG1vZGVsIHRyZWUgc3RydWN0dXJlIHNvIGBJbnNlcnRPcGVyYXRpb25gIGRvZXMgbm90IG5lZWQgdG8gYmUgY2hhbmdlZC5cbiAgICAvL1xuICAgIHJldHVybiByZXN1bHQ7XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKEluc2VydE9wZXJhdGlvbiwgSW5zZXJ0T3BlcmF0aW9uLCAoYSwgYiwgY29udGV4dCk9PntcbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBUd28gaW5zZXJ0IG9wZXJhdGlvbnMgaW5zZXJ0IG5vZGVzIGF0IHRoZSBzYW1lIHBvc2l0aW9uLiBTaW5jZSB0aGV5IGFyZSB0aGUgc2FtZSwgaXQgbmVlZHMgdG8gYmUgZGVjaWRlZFxuICAgIC8vIHdoYXQgd2lsbCBiZSB0aGUgb3JkZXIgb2YgaW5zZXJ0ZWQgbm9kZXMuIEhvd2V2ZXIsIHRoZXJlIGlzIG5vIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gdG8gaGVscCBpbiB0aGF0XG4gICAgLy8gZGVjaXNpb24uIEFsc28sIHdoZW4gYGJgIHdpbGwgYmUgdHJhbnNmb3JtZWQgYnkgYGFgLCB0aGUgc2FtZSBvcmRlciBtdXN0IGJlIG1haW50YWluZWQuXG4gICAgLy9cbiAgICAvLyBUbyBhY2hpZXZlIHRoYXQsIHdlIHdpbGwgY2hlY2sgaWYgdGhlIG9wZXJhdGlvbiBpcyBzdHJvbmcuXG4gICAgLy8gSWYgaXQgaXMsIGl0IHdvbid0IGdldCB0cmFuc2Zvcm1lZC4gSWYgaXQgaXMgbm90LCBpdCB3aWxsIGJlIG1vdmVkLlxuICAgIC8vXG4gICAgaWYgKGEucG9zaXRpb24uaXNFcXVhbChiLnBvc2l0aW9uKSAmJiBjb250ZXh0LmFJc1N0cm9uZykge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLyBUaGUgZGVmYXVsdCBjYXNlLlxuICAgIC8vXG4gICAgYS5wb3NpdGlvbiA9IGEucG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRPcGVyYXRpb24oYik7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKEluc2VydE9wZXJhdGlvbiwgTW92ZU9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZS5cbiAgICAvL1xuICAgIGEucG9zaXRpb24gPSBhLnBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oSW5zZXJ0T3BlcmF0aW9uLCBTcGxpdE9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZS5cbiAgICAvL1xuICAgIGEucG9zaXRpb24gPSBhLnBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24oYik7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKEluc2VydE9wZXJhdGlvbiwgTWVyZ2VPcGVyYXRpb24sIChhLCBiKT0+e1xuICAgIGEucG9zaXRpb24gPSBhLnBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5zZXRUcmFuc2Zvcm1hdGlvbihNYXJrZXJPcGVyYXRpb24sIEluc2VydE9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgaWYgKGEub2xkUmFuZ2UpIHtcbiAgICAgICAgYS5vbGRSYW5nZSA9IGEub2xkUmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRPcGVyYXRpb24oYilbMF07XG4gICAgfVxuICAgIGlmIChhLm5ld1JhbmdlKSB7XG4gICAgICAgIGEubmV3UmFuZ2UgPSBhLm5ld1JhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0T3BlcmF0aW9uKGIpWzBdO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oTWFya2VyT3BlcmF0aW9uLCBNYXJrZXJPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIGlmIChhLm5hbWUgPT0gYi5uYW1lKSB7XG4gICAgICAgIGlmIChjb250ZXh0LmFJc1N0cm9uZykge1xuICAgICAgICAgICAgYS5vbGRSYW5nZSA9IGIubmV3UmFuZ2UgPyBiLm5ld1JhbmdlLmNsb25lKCkgOiBudWxsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKE1hcmtlck9wZXJhdGlvbiwgTWVyZ2VPcGVyYXRpb24sIChhLCBiKT0+e1xuICAgIGlmIChhLm9sZFJhbmdlKSB7XG4gICAgICAgIGEub2xkUmFuZ2UgPSBhLm9sZFJhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgfVxuICAgIGlmIChhLm5ld1JhbmdlKSB7XG4gICAgICAgIGEubmV3UmFuZ2UgPSBhLm5ld1JhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICAgIGFcbiAgICBdO1xufSk7XG5zZXRUcmFuc2Zvcm1hdGlvbihNYXJrZXJPcGVyYXRpb24sIE1vdmVPcGVyYXRpb24sIChhLCBiKT0+e1xuICAgIGNvbnN0IHJlc3VsdCA9IFtcbiAgICAgICAgYVxuICAgIF07XG4gICAgaWYgKGEub2xkUmFuZ2UpIHtcbiAgICAgICAgYS5vbGRSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUmFuZ2VzKGEub2xkUmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKGIpKTtcbiAgICB9XG4gICAgaWYgKGEubmV3UmFuZ2UpIHtcbiAgICAgICAgLy8gSW4gbWFueSBzaW1wbGUgY2FzZXMgdGhlIG1hcmtlciByYW5nZSB3aWxsIGJlIGtlcHQgaW50ZWdyYWwgYWZ0ZXIgdGhlIHRyYW5zZm9ybWF0aW9uLiBGb3IgZXhhbXBsZSwgaWYgc29tZSBub2Rlc1xuICAgICAgICAvLyB3ZXJlIGluc2VydGVkIGJlZm9yZSB0aGUgcmFuZ2UsIG9yIGludG8gdGhlIHJhbmdlLCB0aGVuIHRoZSBtYXJrZXIgcmFuZ2UgaXMgbm90IGJyb2tlbiBpbnRvIHR3by5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSG93ZXZlciwgaWYgc29tZSBub2RlcyBhcmUgdGFrZW4gb3V0IG9mIHRoZSByYW5nZSBhbmQgbW92ZWQgc29tZXdoZXJlIGVsc2UsIG9yIGFyZSBtb3ZlZCBpbnRvIHRoZSByYW5nZSwgdGhlbiB0aGUgbWFya2VyXG4gICAgICAgIC8vIHJhbmdlIGlzIFwiYnJva2VuXCIgaW50byB0d28gb3IgdGhyZWUgcGllY2VzLCBhbmQgdGhlc2UgcGllY2VzIG11c3QgYmUgdHJhbnNmb3JtZWQgYW5kIHVwZGF0ZWQgc2VwYXJhdGVseS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gV2hlbiB0aGUgbWFya2VyIHJhbmdlIGlzIHRyYW5zZm9ybWVkIGJ5IG1vdmUgb3BlcmF0aW9uLCBhcyBhIHJlc3VsdCB3ZSBnZXQgYW4gYXJyYXkgd2l0aCBvbmUgKHNpbXBsZSBjYXNlKSBvciBtdWx0aXBsZVxuICAgICAgICAvLyAoXCJicm9rZW4gcmFuZ2VcIiBjYXNlKSByYW5nZXMuXG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IGEubmV3UmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKGIpO1xuICAgICAgICBhLm5ld1JhbmdlID0gcmFuZ2VzWzBdO1xuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgcmFuZ2VzLCB3ZSB3aWxsIGNyZWF0ZSBzZXBhcmF0ZSBtYXJrZXIgb3BlcmF0aW9ucyBmb3IgZWFjaCBwaWVjZSBvZiB0aGUgb3JpZ2luYWwgbWFya2VyIHJhbmdlLlxuICAgICAgICAvLyBTaW5jZSB0aGV5IHdpbGwgYmUgbWFya2VyIG9wZXJhdGlvbnMsIHRoZXkgd2lsbCBiZSBwcm9jZXNzZWQgdGhyb3VnaCB0aGUgdHJhbnNmb3JtYXRpb24gcHJvY2Vzcy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSG93ZXZlciwgd2UgY2Fubm90IGNyZWF0ZSBtdWx0aXBsZSByYW5nZXMgZm9yIHRoZSBzYW1lIG1hcmtlciAoZm9yIHRoZSBzYW1lIG1hcmtlciBuYW1lKS4gQSBtYXJrZXIgaGFzIG9ubHkgb25lIHJhbmdlLlxuICAgICAgICAvLyBTbywgd2UgY2Fubm90IHJlYWxseSBoYXZlIG11bHRpcGxlIG1hcmtlciBvcGVyYXRpb25zIGZvciB0aGUgc2FtZSBtYXJrZXIuIFdlIHdpbGwga2VlcCB0aGUgdHJhY2sgb2YgdGhlIHNlcGFyYXRlIG1hcmtlclxuICAgICAgICAvLyBvcGVyYXRpb25zIHRvIHNlZSwgaWYgYWZ0ZXIgYWxsIHRyYW5zZm9ybWF0aW9ucywgdGhlIG1hcmtlciBwaWVjZXMgYXJlIG5leHQgdG8gZWFjaCBvdGhlciBvciBub3QuIElmIHNvLCB3ZSB3aWxsIGdsdWVcbiAgICAgICAgLy8gdGhlbSB0b2dldGhlciB0byB0aGUgb3JpZ2luYWwgbWFya2VyIG9wZXJhdGlvbiAoYGFgKS4gSWYgbm90LCB3ZSB3aWxsIGRpc2NhcmQgdGhlbS4gVGhlc2UgZXh0cmEgb3BlcmF0aW9ucyB3aWxsIG5ldmVyXG4gICAgICAgIC8vIGJlIGV4ZWN1dGVkLCBhcyB0aGV5IHdpbGwgb25seSBleGlzdCB0ZW1wb3JhcmlseSBkdXJpbmcgdGhlIHRyYW5zZm9ybWF0aW9uIHByb2Nlc3MuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFdlIHdpbGwgY2FsbCB0aGVzZSBhZGRpdGlvbmFsIG1hcmtlciBvcGVyYXRpb25zIFwicGFydGlhbCBtYXJrZXIgb3BlcmF0aW9uc1wiIGFuZCB3ZSB3aWxsIG1hcmsgdGhlbSB3aXRoIG5lZ2F0aXZlIGJhc2UgdmVyc2lvbi5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gU2VlIGFsc28gYGhhbmRsZVBhcnRpYWxNYXJrZXJPcGVyYXRpb25zKClgLlxuICAgICAgICAvLyBTZWUgYWxzbyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L3B1bGwvMTcwNzEuXG4gICAgICAgIC8vXG4gICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgY29uc3Qgb3AgPSBhLmNsb25lKCk7XG4gICAgICAgICAgICBvcC5vbGRSYW5nZSA9IG51bGw7XG4gICAgICAgICAgICBvcC5uZXdSYW5nZSA9IHJhbmdlc1tpXTtcbiAgICAgICAgICAgIG9wLmJhc2VWZXJzaW9uID0gLTE7XG4gICAgICAgICAgICByZXN1bHQucHVzaChvcCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oTWFya2VyT3BlcmF0aW9uLCBTcGxpdE9wZXJhdGlvbiwgKGEsIGIsIGNvbnRleHQpPT57XG4gICAgaWYgKGEub2xkUmFuZ2UpIHtcbiAgICAgICAgYS5vbGRSYW5nZSA9IGEub2xkUmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICB9XG4gICAgaWYgKGEubmV3UmFuZ2UpIHtcbiAgICAgICAgaWYgKGNvbnRleHQuYWJSZWxhdGlvbikge1xuICAgICAgICAgICAgY29uc3QgYU5ld1JhbmdlID0gYS5uZXdSYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKGIpO1xuICAgICAgICAgICAgaWYgKGEubmV3UmFuZ2Uuc3RhcnQuaXNFcXVhbChiLnNwbGl0UG9zaXRpb24pICYmIGNvbnRleHQuYWJSZWxhdGlvbi53YXNTdGFydEJlZm9yZU1lcmdlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBhLm5ld1JhbmdlLnN0YXJ0ID0gUG9zaXRpb24uX2NyZWF0ZUF0KGIuaW5zZXJ0aW9uUG9zaXRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhLm5ld1JhbmdlLnN0YXJ0LmlzRXF1YWwoYi5zcGxpdFBvc2l0aW9uKSAmJiAhY29udGV4dC5hYlJlbGF0aW9uLndhc0luTGVmdEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBhLm5ld1JhbmdlLnN0YXJ0ID0gUG9zaXRpb24uX2NyZWF0ZUF0KGIubW92ZVRhcmdldFBvc2l0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYS5uZXdSYW5nZS5zdGFydCA9IGFOZXdSYW5nZS5zdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhLm5ld1JhbmdlLmVuZC5pc0VxdWFsKGIuc3BsaXRQb3NpdGlvbikgJiYgY29udGV4dC5hYlJlbGF0aW9uLndhc0luUmlnaHRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgYS5uZXdSYW5nZS5lbmQgPSBQb3NpdGlvbi5fY3JlYXRlQXQoYi5tb3ZlVGFyZ2V0UG9zaXRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChhLm5ld1JhbmdlLmVuZC5pc0VxdWFsKGIuc3BsaXRQb3NpdGlvbikgJiYgY29udGV4dC5hYlJlbGF0aW9uLndhc0VuZEJlZm9yZU1lcmdlZEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBhLm5ld1JhbmdlLmVuZCA9IFBvc2l0aW9uLl9jcmVhdGVBdChiLmluc2VydGlvblBvc2l0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYS5uZXdSYW5nZS5lbmQgPSBhTmV3UmFuZ2UuZW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBhXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGEubmV3UmFuZ2UgPSBhLm5ld1JhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24oYik7XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICAgIGFcbiAgICBdO1xufSk7XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuc2V0VHJhbnNmb3JtYXRpb24oTWVyZ2VPcGVyYXRpb24sIEluc2VydE9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgaWYgKGEuc291cmNlUG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGIucG9zaXRpb24pKSB7XG4gICAgICAgIGEuaG93TWFueSArPSBiLmhvd01hbnk7XG4gICAgfVxuICAgIGEuc291cmNlUG9zaXRpb24gPSBhLnNvdXJjZVBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0T3BlcmF0aW9uKGIpO1xuICAgIGEudGFyZ2V0UG9zaXRpb24gPSBhLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0T3BlcmF0aW9uKGIpO1xuICAgIHJldHVybiBbXG4gICAgICAgIGFcbiAgICBdO1xufSk7XG5zZXRUcmFuc2Zvcm1hdGlvbihNZXJnZU9wZXJhdGlvbiwgTWVyZ2VPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIC8vIENhc2UgMTpcbiAgICAvL1xuICAgIC8vIFNhbWUgbWVyZ2Ugb3BlcmF0aW9ucy5cbiAgICAvL1xuICAgIC8vIEJvdGggb3BlcmF0aW9ucyBoYXZlIHNhbWUgc291cmNlIGFuZCB0YXJnZXQgcG9zaXRpb25zLiBTbyB0aGUgZWxlbWVudCBhbHJlYWR5IGdvdCBtZXJnZWQgYW5kIHRoZXJlIGlzXG4gICAgLy8gdGhlb3JldGljYWxseSBub3RoaW5nIHRvIGRvLlxuICAgIC8vXG4gICAgaWYgKGEuc291cmNlUG9zaXRpb24uaXNFcXVhbChiLnNvdXJjZVBvc2l0aW9uKSAmJiBhLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwoYi50YXJnZXRQb3NpdGlvbikpIHtcbiAgICAgICAgLy8gVGhlcmUgYXJlIHR3byB3YXlzIHRoYXQgd2UgY2FuIHByb3ZpZGUgYSBkby1ub3RoaW5nIG9wZXJhdGlvbi5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gRmlyc3QgaXMgc2ltcGx5IGEgTm9PcGVyYXRpb24gaW5zdGFuY2UuIFdlIHdpbGwgdXNlIGl0IGlmIGBiYCBvcGVyYXRpb24gd2FzIG5vdCB1bmRvbmUuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNlY29uZCBpcyBhIG1lcmdlIG9wZXJhdGlvbiB0aGF0IGhhcyB0aGUgc291cmNlIG9wZXJhdGlvbiBpbiB0aGUgbWVyZ2VkIGVsZW1lbnQgLSBpbiB0aGUgZ3JhdmV5YXJkIC1cbiAgICAgICAgLy8gc2FtZSB0YXJnZXQgcG9zaXRpb24gYW5kIGBob3dNYW55YCBlcXVhbCB0byBgMGAuIFNvIGl0IGlzIGJhc2ljYWxseSBtZXJnaW5nIGFuIGVtcHR5IGVsZW1lbnQgZnJvbSBncmF2ZXlhcmRcbiAgICAgICAgLy8gd2hpY2ggaXMgYWxtb3N0IHRoZSBzYW1lIGFzIE5vT3BlcmF0aW9uLlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGlzIHdheSB0aGUgbWVyZ2Ugb3BlcmF0aW9uIGNhbiBiZSBsYXRlciB0cmFuc2Zvcm1lZCBieSBzcGxpdCBvcGVyYXRpb25cbiAgICAgICAgLy8gdG8gcHJvdmlkZSBjb3JyZWN0IHVuZG8uIFRoaXMgd2lsbCBiZSB1c2VkIGlmIGBiYCBvcGVyYXRpb24gd2FzIHVuZG9uZSAob25seSB0aGVuIGl0IGlzIGNvcnJlY3QpLlxuICAgICAgICAvL1xuICAgICAgICBpZiAoIWNvbnRleHQuYldhc1VuZG9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gYi5ncmF2ZXlhcmRQb3NpdGlvbi5wYXRoLnNsaWNlKCk7XG4gICAgICAgICAgICBwYXRoLnB1c2goMCk7XG4gICAgICAgICAgICBhLnNvdXJjZVBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKGIuZ3JhdmV5YXJkUG9zaXRpb24ucm9vdCwgcGF0aCk7XG4gICAgICAgICAgICBhLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBhXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIENhc2UgMjpcbiAgICAvL1xuICAgIC8vIFNhbWUgbWVyZ2Ugc291cmNlIHBvc2l0aW9uIGJ1dCBkaWZmZXJlbnQgdGFyZ2V0IHBvc2l0aW9uLlxuICAgIC8vXG4gICAgLy8gVGhpcyBjYW4gaGFwcGVuIGR1cmluZyBjb2xsYWJvcmF0aW9uLiBGb3IgZXhhbXBsZSwgaWYgb25lIGNsaWVudCBtZXJnZWQgYSBwYXJhZ3JhcGggdG8gdGhlIHByZXZpb3VzIHBhcmFncmFwaFxuICAgIC8vIGFuZCB0aGUgb3RoZXIgcGVyc29uIHJlbW92ZWQgdGhhdCBwYXJhZ3JhcGggYW5kIG1lcmdlZCB0aGUgc2FtZSBwYXJhZ3JhcGggdG8gc29tZXRoaW5nIGJlZm9yZTpcbiAgICAvL1xuICAgIC8vIENsaWVudCBBOlxuICAgIC8vIDxwPkZvbzwvcD48cD5CYXI8L3A+PHA+W11YeXo8L3A+XG4gICAgLy8gPHA+Rm9vPC9wPjxwPkJhclh5ejwvcD5cbiAgICAvL1xuICAgIC8vIENsaWVudCBCOlxuICAgIC8vIDxwPkZvbzwvcD5bPHA+QmFyPC9wPl08cD5YeXo8L3A+XG4gICAgLy8gPHA+Rm9vPC9wPjxwPltdWHl6PC9wPlxuICAgIC8vIDxwPkZvb1h5ejwvcD5cbiAgICAvL1xuICAgIC8vIEluIHRoaXMgY2FzZSB3ZSBuZWVkIHRvIGRlY2lkZSB3aGVyZSBmaW5hbGx5IFwiWHl6XCIgd2lsbCBsYW5kOlxuICAgIC8vXG4gICAgLy8gPHA+Rm9vWHl6PC9wPiAgICAgICAgICAgICAgIGdyYXZleWFyZDogPHA+QmFyPC9wPlxuICAgIC8vIDxwPkZvbzwvcD4gICAgICAgICAgICAgICAgICBncmF2ZXlhcmQ6IDxwPkJhclh5ejwvcD5cbiAgICAvL1xuICAgIC8vIExldCdzIG1vdmUgaXQgaW4gYSB3YXkgc28gdGhhdCBhIG1lcmdlIG9wZXJhdGlvbiB0aGF0IGRvZXMgbm90IHRhcmdldCB0byBncmF2ZXlhcmQgaXMgbW9yZSBpbXBvcnRhbnQgc28gdGhhdFxuICAgIC8vIG5vZGVzIGRvZXMgbm90IGVuZCB1cCBpbiB0aGUgZ3JhdmV5YXJkLiBJdCBtYWtlcyBzZW5zZS4gQm90aCBmb3IgQ2xpZW50IEEgYW5kIGZvciBDbGllbnQgQiBcIlh5elwiIGZpbmFsbHkgZGlkIG5vdFxuICAgIC8vIGVuZCB1cCBpbiB0aGUgZ3JhdmV5YXJkIChzZWUgYWJvdmUpLlxuICAgIC8vXG4gICAgLy8gSWYgbmVpdGhlciBvciBib3RoIG9wZXJhdGlvbnMgcG9pbnQgdG8gZ3JhdmV5YXJkLCB0aGVuIGxldCBgYUlzU3Ryb25nYCBkZWNpZGUuXG4gICAgLy9cbiAgICBpZiAoYS5zb3VyY2VQb3NpdGlvbi5pc0VxdWFsKGIuc291cmNlUG9zaXRpb24pICYmICFhLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwoYi50YXJnZXRQb3NpdGlvbikgJiYgIWNvbnRleHQuYldhc1VuZG9uZSAmJiBjb250ZXh0LmFiUmVsYXRpb24gIT0gJ3NwbGl0QXRTb3VyY2UnKSB7XG4gICAgICAgIGNvbnN0IGFUb0dyYXZleWFyZCA9IGEudGFyZ2V0UG9zaXRpb24ucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCc7XG4gICAgICAgIGNvbnN0IGJUb0dyYXZleWFyZCA9IGIudGFyZ2V0UG9zaXRpb24ucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCc7XG4gICAgICAgIC8vIElmIGBhSXNXZWFrYCBpdCBtZWFucyB0aGF0IGBhYCBwb2ludHMgdG8gZ3JhdmV5YXJkIHdoaWxlIGBiYCBkb2Vzbid0LiBEb24ndCBtb3ZlIG5vZGVzIHRoZW4uXG4gICAgICAgIGNvbnN0IGFJc1dlYWsgPSBhVG9HcmF2ZXlhcmQgJiYgIWJUb0dyYXZleWFyZDtcbiAgICAgICAgLy8gSWYgYGJJc1dlYWtgIGl0IG1lYW5zIHRoYXQgYGJgIHBvaW50cyB0byBncmF2ZXlhcmQgd2hpbGUgYGFgIGRvZXNuJ3QuIEZvcmNlIG1vdmluZyBub2RlcyB0aGVuLlxuICAgICAgICBjb25zdCBiSXNXZWFrID0gYlRvR3JhdmV5YXJkICYmICFhVG9HcmF2ZXlhcmQ7XG4gICAgICAgIC8vIEZvcmNlIG1vdmUgaWYgYGJgIGlzIHdlYWsgb3IgbmVpdGhlciBvcGVyYXRpb24gaXMgd2VhayBidXQgYGFgIGlzIHN0cm9uZ2VyIHRocm91Z2ggYGNvbnRleHQuYUlzU3Ryb25nYC5cbiAgICAgICAgY29uc3QgZm9yY2VNb3ZlID0gYklzV2VhayB8fCAhYUlzV2VhayAmJiBjb250ZXh0LmFJc1N0cm9uZztcbiAgICAgICAgaWYgKGZvcmNlTW92ZSkge1xuICAgICAgICAgICAgY29uc3Qgc291cmNlUG9zaXRpb24gPSBiLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IE1vdmVPcGVyYXRpb24oc291cmNlUG9zaXRpb24sIGEuaG93TWFueSwgdGFyZ2V0UG9zaXRpb24sIDApXG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZS5cbiAgICAvLyBUT0RPOiBQb3NzaWJseSwgdGhlcmUncyBhIG1pc3NpbmcgY2FzZSBmb3Igc2FtZSBgdGFyZ2V0UG9zaXRpb25gIGJ1dCBkaWZmZXJlbnQgYHNvdXJjZVBvc2l0aW9uYC5cbiAgICAvL1xuICAgIGlmIChhLnNvdXJjZVBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnRhcmdldFBvc2l0aW9uKSkge1xuICAgICAgICBhLmhvd01hbnkgKz0gYi5ob3dNYW55O1xuICAgIH1cbiAgICBhLnNvdXJjZVBvc2l0aW9uID0gYS5zb3VyY2VQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKGIpO1xuICAgIGEudGFyZ2V0UG9zaXRpb24gPSBhLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgLy8gSGFuZGxlIHBvc2l0aW9ucyBpbiBncmF2ZXlhcmQuXG4gICAgLy8gSWYgZ3JhdmV5YXJkIHBvc2l0aW9ucyBhcmUgc2FtZSBhbmQgYGFgIG9wZXJhdGlvbiBpcyBzdHJvbmcgLSBkbyBub3QgdHJhbnNmb3JtLlxuICAgIGlmICghYS5ncmF2ZXlhcmRQb3NpdGlvbi5pc0VxdWFsKGIuZ3JhdmV5YXJkUG9zaXRpb24pIHx8ICFjb250ZXh0LmFJc1N0cm9uZykge1xuICAgICAgICBhLmdyYXZleWFyZFBvc2l0aW9uID0gYS5ncmF2ZXlhcmRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKGIpO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oTWVyZ2VPcGVyYXRpb24sIE1vdmVPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIC8vIENhc2UgMTpcbiAgICAvL1xuICAgIC8vIFRoZSBlbGVtZW50IHRvIG1lcmdlIGdvdCByZW1vdmVkLlxuICAgIC8vXG4gICAgLy8gTWVyZ2Ugb3BlcmF0aW9uIGRvZXMgc3VwcG9ydCBtZXJnaW5nIGVsZW1lbnRzIHdoaWNoIGFyZSBub3Qgc2libGluZ3MuIFNvIGl0IHdvdWxkIG5vdCBiZSBhIHByb2JsZW1cbiAgICAvLyBmcm9tIHRlY2huaWNhbCBwb2ludCBvZiB2aWV3LiBIb3dldmVyLCBpZiB0aGUgZWxlbWVudCB3YXMgcmVtb3ZlZCwgdGhlIGludGVudGlvbiBvZiB0aGUgdXNlciBkZWxldGluZyBpdFxuICAgIC8vIHdhcyB0byBoYXZlIGl0IGFsbCBkZWxldGVkLCB0b2dldGhlciB3aXRoIGl0cyBjaGlsZHJlbi4gRnJvbSB1c2VyIGV4cGVyaWVuY2UgcG9pbnQgb2YgdmlldywgbW92aW5nIGJhY2sgdGhlXG4gICAgLy8gcmVtb3ZlZCBub2RlcyBtaWdodCBiZSB1bmV4cGVjdGVkLiBUaGlzIG1lYW5zIHRoYXQgaW4gdGhpcyBzY2VuYXJpbyB3ZSB3aWxsIGJsb2NrIHRoZSBtZXJnaW5nLlxuICAgIC8vXG4gICAgLy8gVGhlIGV4Y2VwdGlvbiB0byB0aGlzIHJ1bGUgd291bGQgYmUgaWYgdGhlIHJlbW92ZSBvcGVyYXRpb24gd2FzIGxhdGVyIHVuZG9uZS5cbiAgICAvL1xuICAgIGNvbnN0IHJlbW92ZWRSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChiLnNvdXJjZVBvc2l0aW9uLCBiLmhvd01hbnkpO1xuICAgIGlmIChiLnR5cGUgPT0gJ3JlbW92ZScgJiYgIWNvbnRleHQuYldhc1VuZG9uZSkge1xuICAgICAgICBpZiAoYS5kZWxldGlvblBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnNvdXJjZVBvc2l0aW9uKSAmJiByZW1vdmVkUmFuZ2UuY29udGFpbnNQb3NpdGlvbihhLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gSW4gbW9zdCBjYXNlcyB3ZSB3YW50IGBzb3VyY2VQb3NpdGlvbmAgdG8gc3RpY2sgdG8gcHJldmlvdXMgYW5kIGB0YXJnZXRQb3NpdGlvbmAgdG8gc3RpY2sgdG8gbmV4dC5cbiAgICAvLyBVc3VhbGx5LCBgc291cmNlUG9zaXRpb25gIGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIG1lcmdlZCBlbGVtZW50IGFuZCBgdGFyZ2V0UG9zaXRpb25gIGlzIGF0IHRoZSBlbmQgb2YgdGhlIG1lcmdlLXRhcmdldCBlbGVtZW50LlxuICAgIC8vXG4gICAgLy8gSG93ZXZlciwgYHNvdXJjZVBvc2l0aW9uYCBhbmQgYHRhcmdldFBvc2l0aW9uYCBtYXkgZW5kIHVwIGluIHRoZSBtaWRkbGUgb2YgYW4gZWxlbWVudCBkdWUgdG8gc29tZSBPVCBtYWdpYyB0aGF0IGhhcHBlbnMgZHVyaW5nIHVuZG8uXG4gICAgLy8gSXQgaXMgZXhwZWN0ZWQgYW5kIHVzZWQgaW4gYE1lcmdlT3BlcmF0aW9uYCB4IGBTcGxpdE9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24uXG4gICAgLy9cbiAgICAvLyBCdXQgd2hlbiB0aGVzZSBwb3NpdGlvbnMgYXJlIGluIHRoZSBtaWRkbGUsIGl0IG1lc3NlcyB1cCB0aGUgcmVndWxhciBgTWVyZ2VPcGVyYXRpb25gIHggYE1vdmVPcGVyYXRpb25gIHRyYW5zZm9ybWF0aW9uIGJlY2F1c2VcbiAgICAvLyB0aGVzZSBwb3NpdGlvbnMgbWF5IFwiZm9sbG93XCIgc29tZSBtb3ZlZCBlbGVtZW50cy4gQW5kIHdlIHdhbnQgdGhlbSBzdGljayBpbiB0aGUgb3JpZ2luYWwgZWxlbWVudHMuXG4gICAgLy9cbiAgICAvLyBUaGlzIGlzIHdoeSB3ZSBhZGQgdHdvIGV4dHJhIGNhc2VzOiAoMSkgYW5kICgyKS5cbiAgICAvL1xuICAgIC8vIEJ1dCBhZnRlciB0aGlzIGBNZXJnZU9wZXJhdGlvbmAgaXMgdHJhbnNmb3JtZWQgYnkgXCJ0aGlzXCIgbW92ZSAod2hpY2ggaXMgdW5kb25lKSwgd2UgYWxzbyBuZWVkIHRvIGRlZmluZSBleHRyYSBjYXNlcyBmb3JcbiAgICAvLyB0aGUgb3BlcmF0aW9uIHVuZG9pbmcgcHJldmlvdXMgbW92ZS4gVGhlc2UgYXJlICgzKSBhbmQgKDQpLlxuICAgIC8vXG4gICAgLy8gKDEpLiBOb3RlIHRoYXQgdGhpcyBjYXNlIGlzIGFsc28gYWRkZWQgdG8gYHVwZGF0ZVJlbGF0aW9ucygpYCBhbmQgc2V0cyBgbWVyZ2VTb3VyY2VBZmZlY3RlZGAgcmVsYXRpb24uXG4gICAgLy9cbiAgICAvLyBbXSBpcyBtb3ZlIG9wZXJhdGlvbiwgfSBpcyBtZXJnZSBzb3VyY2UgcG9zaXRpb24gKHN0aWNrcyB0byBwcmV2aW91cyBieSBkZWZhdWx0KTpcbiAgICAvLyA8cD5BW2JdfWM8L3A+ICAtPiAgPHA+QX1jPC9wPlxuICAgIC8vXG4gICAgaWYgKGIuc291cmNlUG9zaXRpb24uZ2V0U2hpZnRlZEJ5KGIuaG93TWFueSkuaXNFcXVhbChhLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICBhLnNvdXJjZVBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9Ob25lJztcbiAgICB9IGVsc2UgaWYgKGIudGFyZ2V0UG9zaXRpb24uaXNFcXVhbChhLnNvdXJjZVBvc2l0aW9uKSAmJiBjb250ZXh0LmFiUmVsYXRpb24gPT0gJ21lcmdlU291cmNlQWZmZWN0ZWQnKSB7XG4gICAgICAgIGEuc291cmNlUG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b05leHQnO1xuICAgIH0gZWxzZSBpZiAoYi5zb3VyY2VQb3NpdGlvbi5pc0VxdWFsKGEudGFyZ2V0UG9zaXRpb24pKSB7XG4gICAgICAgIGEudGFyZ2V0UG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b05vbmUnO1xuICAgICAgICBhLmhvd01hbnkgLT0gYi5ob3dNYW55O1xuICAgIH0gZWxzZSBpZiAoYi50YXJnZXRQb3NpdGlvbi5pc0VxdWFsKGEudGFyZ2V0UG9zaXRpb24pICYmIGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnbWVyZ2VUYXJnZXRXYXNCZWZvcmUnKSB7XG4gICAgICAgIGEudGFyZ2V0UG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b1ByZXZpb3VzJztcbiAgICAgICAgYS5ob3dNYW55ICs9IGIuaG93TWFueTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYS5zb3VyY2VQb3NpdGlvbi5oYXNTYW1lUGFyZW50QXMoYi50YXJnZXRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIGEuaG93TWFueSArPSBiLmhvd01hbnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGEuc291cmNlUG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGIuc291cmNlUG9zaXRpb24pKSB7XG4gICAgICAgICAgICBhLmhvd01hbnkgLT0gYi5ob3dNYW55O1xuICAgICAgICB9XG4gICAgfVxuICAgIGEuc291cmNlUG9zaXRpb24gPSBhLnNvdXJjZVBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihiKTtcbiAgICBhLnRhcmdldFBvc2l0aW9uID0gYS50YXJnZXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1vdmVPcGVyYXRpb24oYik7XG4gICAgLy8gQWZ0ZXIgdHJhbnNmb3JtYXRpb25zIGFyZSBkb25lLCBtYWtlIHN1cmUgdG8gcmV2ZXJ0IHN0aWNraW5lc3MgaW4gY2FzZSBpZiAoMSkgLSAoNCkgc2NlbmFyaW8gaGFwcGVuZWQuXG4gICAgYS5zb3VyY2VQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvUHJldmlvdXMnO1xuICAgIGEudGFyZ2V0UG9zaXRpb24uc3RpY2tpbmVzcyA9ICd0b05leHQnO1xuICAgIC8vIGBNZXJnZU9wZXJhdGlvbmAgZ3JhdmV5YXJkIHBvc2l0aW9uIGlzIGxpa2UgYE1vdmVPcGVyYXRpb25gIHRhcmdldCBwb3NpdGlvbi4gSXQgaXMgYSBwb3NpdGlvbiB3aGVyZSBlbGVtZW50KHMpIHdpbGxcbiAgICAvLyBiZSBtb3ZlZC4gTGlrZSBpbiBvdGhlciBzaW1pbGFyIGNhc2VzLCB3ZSBuZWVkIHRvIGNvbnNpZGVyIHRoZSBzY2VuYXJpbyB3aGVuIHRob3NlIHBvc2l0aW9ucyBhcmUgc2FtZS5cbiAgICAvLyBIZXJlLCB3ZSB3aWxsIHRyZWF0IGBNZXJnZU9wZXJhdGlvbmAgbGlrZSBpdCBpcyBhbHdheXMgc3Ryb25nIChzZWUgYEluc2VydE9wZXJhdGlvbmAgeCBgSW5zZXJ0T3BlcmF0aW9uYCBmb3IgY29tcGFyaXNvbikuXG4gICAgLy8gVGhpcyBtZWFucyB0aGF0IHdlIHdvbid0IHRyYW5zZm9ybSBncmF2ZXlhcmQgcG9zaXRpb24gaWYgaXQgaXMgZXF1YWwgdG8gbW92ZSBvcGVyYXRpb24gdGFyZ2V0IHBvc2l0aW9uLlxuICAgIGlmICghYS5ncmF2ZXlhcmRQb3NpdGlvbi5pc0VxdWFsKGIudGFyZ2V0UG9zaXRpb24pKSB7XG4gICAgICAgIGEuZ3JhdmV5YXJkUG9zaXRpb24gPSBhLmdyYXZleWFyZFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihiKTtcbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKE1lcmdlT3BlcmF0aW9uLCBTcGxpdE9wZXJhdGlvbiwgKGEsIGIsIGNvbnRleHQpPT57XG4gICAgaWYgKGIuZ3JhdmV5YXJkUG9zaXRpb24pIHtcbiAgICAgICAgLy8gSWYgYGJgIG9wZXJhdGlvbiBkZWZpbmVzIGdyYXZleWFyZCBwb3NpdGlvbiwgYSBub2RlIGZyb20gZ3JhdmV5YXJkIHdpbGwgYmUgbW92ZWQuIFRoaXMgbWVhbnMgdGhhdCB3ZSBuZWVkIHRvXG4gICAgICAgIC8vIHRyYW5zZm9ybSBgYS5ncmF2ZXlhcmRQb3NpdGlvbmAgYWNjb3JkaW5nbHkuXG4gICAgICAgIGEuZ3JhdmV5YXJkUG9zaXRpb24gPSBhLmdyYXZleWFyZFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oYi5ncmF2ZXlhcmRQb3NpdGlvbiwgMSk7XG4gICAgICAgIC8vIFRoaXMgaXMgYSBzY2VuYXJpbyBmb3Jlc2VlbiBpbiBgTWVyZ2VPcGVyYXRpb25gIHggYE1lcmdlT3BlcmF0aW9uYCwgd2l0aCB0d28gaWRlbnRpY2FsIG1lcmdlIG9wZXJhdGlvbnMuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNvLCB0aGVyZSB3YXMgYE1lcmdlT3BlcmF0aW9uYCB4IGBNZXJnZU9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24gZWFybGllci4gTm93LCBgYWAgaXMgYSBtZXJnZSBvcGVyYXRpb24gd2hpY2hcbiAgICAgICAgLy8gc291cmNlIHBvc2l0aW9uIGlzIGluIGdyYXZleWFyZC4gSW50ZXJlc3RpbmdseSwgc3BsaXQgb3BlcmF0aW9uIHdhbnRzIHRvIHVzZSB0aGUgbm9kZSB0byBiZSBtZXJnZWQgYnkgYGFgLiBUaGlzXG4gICAgICAgIC8vIG1lYW5zIHRoYXQgYGJgIGlzIHVuZG9pbmcgdGhhdCBtZXJnZSBvcGVyYXRpb24gZnJvbSBlYXJsaWVyLCB3aGljaCBjYXVzZWQgYGFgIHRvIGJlIGluIGdyYXZleWFyZC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSWYgdGhhdCdzIHRoZSBjYXNlLCBhdCB0aGlzIHBvaW50LCB3ZSB3aWxsIG9ubHkgXCJmaXhcIiBgYS5ob3dNYW55YC4gSXQgd2FzIGVhcmxpZXIgc2V0IHRvIGAwYCBpblxuICAgICAgICAvLyBgTWVyZ2VPcGVyYXRpb25gIHggYE1lcmdlT3BlcmF0aW9uYCB0cmFuc2Zvcm1hdGlvbi4gTGF0ZXIgdHJhbnNmb3JtYXRpb25zIGluIHRoaXMgZnVuY3Rpb24gd2lsbCBjaGFuZ2Ugb3RoZXJcbiAgICAgICAgLy8gcHJvcGVydGllcy5cbiAgICAgICAgLy9cbiAgICAgICAgaWYgKGEuZGVsZXRpb25Qb3NpdGlvbi5pc0VxdWFsKGIuZ3JhdmV5YXJkUG9zaXRpb24pKSB7XG4gICAgICAgICAgICBhLmhvd01hbnkgPSBiLmhvd01hbnk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2FzZSAxOlxuICAgIC8vXG4gICAgLy8gTWVyZ2Ugb3BlcmF0aW9uIG1vdmVzIG5vZGVzIHRvIHRoZSBwbGFjZSB3aGVyZSBzcGxpdCBoYXBwZW5zLlxuICAgIC8vXG4gICAgLy8gVGhpcyBpcyBhIGNsYXNzaWMgc2l0dWF0aW9uIHdoZW4gdGhlcmUgYXJlIHR3byBwYXJhZ3JhcGhzLCBhbmQgdGhlcmUgaXMgYSBzcGxpdCAoZW50ZXIpIGF0IHRoZSBlbmQgb2YgdGhlIGZpcnN0XG4gICAgLy8gcGFyYWdyYXBoIGFuZCB0aGVyZSBpcyBhIG1lcmdlIChkZWxldGUpIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHNlY29uZCBwYXJhZ3JhcGg6XG4gICAgLy9cbiAgICAvLyA8cD5Gb297fTwvcD48cD5bXUJhcjwvcD4uXG4gICAgLy9cbiAgICAvLyBVc2VyIEEgcHJlc3NlcyBlbnRlciBhZnRlciBgRm9vYCwgd2hpbGUgVXNlciBCIHByZXNzZXMgYmFja3NwYWNlIGJlZm9yZSBgQmFyYC4gSXQgaXMgaW50dWl0aXZlIHRoYXQgYWZ0ZXIgYm90aCBvcGVyYXRpb25zLCB0aGVcbiAgICAvLyBlZGl0b3Igc3RhdGUgc2hvdWxkIHN0YXkgdGhlIHNhbWUuXG4gICAgLy9cbiAgICAvLyBTdGF0ZSBhZnRlciBzcGxpdDpcbiAgICAvLyA8cD5Gb288L3A+PHA+PC9wPjxwPltdQmFyPC9wPlxuICAgIC8vXG4gICAgLy8gV2hlbiB0aGlzIGhhcHBlbnMsIGBCYXJgIHNob3VsZCBiZSBtZXJnZWQgdG8gdGhlIG5ld2x5IGNyZWF0ZWQgcGFyYWdyYXBoLCB0byBtYWludGFpbiB0aGUgZWRpdG9yIHN0YXRlOlxuICAgIC8vIDxwPkZvbzwvcD48cD5CYXI8L3A+XG4gICAgLy9cbiAgICAvLyBBbm90aGVyIG9wdGlvbiBpcyB0byBtZXJnZSBpbnRvIHRoZSBvcmlnaW5hbCBwYXJhZ3JhcGggYEZvb2AsIGFjY29yZGluZyB0byB0aGUgYHRhcmdldFBvc2l0aW9uYC4gVGhpcyByZXN1bHRzIGluIGFuIGluY29ycmVjdCBzdGF0ZTpcbiAgICAvLyA8cD5Gb29CYXI8L3A+PHA+PC9wPlxuICAgIC8vXG4gICAgLy8gQWxzbywgY29uc2lkZXIgYW4gZXhhbXBsZSB3aGVyZSBVc2VyIEEgYWxzbyB3cml0ZXMgc29tZXRoaW5nIGluIHRoZSBuZXcgcGFyYWdyYXBoOlxuICAgIC8vIDxwPkZvbzwvcD48cD5YeXo8L3A+PHA+W11CYXI8L3A+XG4gICAgLy9cbiAgICAvLyBJbiB0aGlzIGNhc2UgaXQgaXMgY2xlYXIgdGhhdCBtZXJnZSBzaG91bGQgaGFwcGVuIGludG8gYFsgMSwgMyBdYCBub3QgaW50byBgWyAwLCAzIF1gLiBJdCBmaXJzdCBoYXMgdG8gYmUgdHJhbnNmb3JtZWQgdG8gYFsgMSwgMCBdYCxcbiAgICAvLyBhbmQgdGhlbiB0cmFuc2Zvcm1lZCBiZSBpbnNlcnRpb24gaW50byBgWyAxLCAzIF1gLlxuICAgIC8vXG4gICAgLy8gU28sIHVzdWFsbHkgd2Ugd2FudCB0byBtb3ZlIGB0YXJnZXRQb3NpdGlvbmAgdG8gdGhlIG5ldyBwYXJhZ3JhcGggd2hlbiBpdCBpcyBzYW1lIGFzIHNwbGl0IHBvc2l0aW9uLiBUaGlzIGlzIGhvdyBpdCBpcyBoYW5kbGVkXG4gICAgLy8gaW4gdGhlIGRlZmF1bHQgdHJhbnNmb3JtYXRpb24gKGBfZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKClgKS4gV2UgZG9uJ3QgbmVlZCBhIHNwZWNpYWwgY2FzZSBmb3IgdGhpcy5cbiAgICAvL1xuICAgIC8vIEhvd2V2ZXIsIHRoZXJlIGFyZSB0d28gZXhjZXB0aW9ucywgd2hlbiB3ZSAqKmRvIG5vdCoqIHdhbnQgdG8gdHJhbnNmb3JtIGB0YXJnZXRQb3NpdGlvbmAsIGFuZCB3ZSBuZWVkIGEgc3BlY2lhbCBjYXNlIHRoZW4uXG4gICAgLy9cbiAgICAvLyBUaGVzZSBleGNlcHRpb25zIGhhcHBlbiBvbmx5IGlmIHVuZG8gaXMgaW52b2x2ZWQuIER1cmluZyBPVCwgYWJvdmUgcHJlc2VudGVkIGNhc2UgKGA8cD5Gb297fTwvcD48cD5bXUJhcjwvcD5gKSBpcyB0aGUgb25seSB3YXlcbiAgICAvLyBob3cgYFNwbGl0T3BlcmF0aW9uI3NwbGl0UG9zaXRpb25gIGFuZCBgTWVyZ2VPcGVyYXRpb24jdGFyZ2V0UG9zaXRpb25gIGNhbiBiZSB0aGUgc2FtZS5cbiAgICAvL1xuICAgIC8vIEZpcnN0IGV4Y2VwdGlvbiBpcyB3aGVuIHRoZSBlbGVtZW50IHRvIG1lcmdlIGlzIGluIHRoZSBncmF2ZXlhcmQgYW5kIHNwbGl0IG9wZXJhdGlvbiB1c2VzIGl0LiBJbiB0aGF0IGNhc2VcbiAgICAvLyBpZiB0YXJnZXQgcG9zaXRpb24gd291bGQgYmUgdHJhbnNmb3JtZWQsIHRoZSBtZXJnZSBvcGVyYXRpb24gd291bGQgdGFyZ2V0IGF0IHRoZSBzb3VyY2UgcG9zaXRpb246XG4gICAgLy9cbiAgICAvLyByb290OiA8cD5Gb29bXTwvcD5cdFx0XHRcdGdyYXZleWFyZDogPHA+PC9wPlxuICAgIC8vXG4gICAgLy8gU3BsaXRPcGVyYXRpb246IHJvb3QgWyAwLCAzIF0gdXNpbmcgZ3JhdmV5YXJkIFsgMCBdIChob3dNYW55ID0gMClcbiAgICAvLyBNZXJnZU9wZXJhdGlvbjogZ3JhdmV5YXJkIFsgMCwgMCBdIC0+IHJvb3QgWyAwLCAzIF0gKGhvd01hbnkgPSAwKVxuICAgIC8vXG4gICAgLy8gU2luY2Ugc3BsaXQgb3BlcmF0aW9uIG1vdmVzIHRoZSBncmF2ZXlhcmQgZWxlbWVudCBiYWNrIHRvIHRoZSByb290ICh0byBwYXRoIGBbIDEgXWApLCB0aGUgbWVyZ2Ugb3BlcmF0aW9uIGBzb3VyY2VQb3NpdGlvbmAgY2hhbmdlcy5cbiAgICAvLyBBZnRlciBzcGxpdCB3ZSBoYXZlOiBgPHA+Rm9vPC9wPjxwPjwvcD5gLCBzbyBgc291cmNlUG9zaXRpb25gIGlzIGBbIDEsIDAgXWAuIEJ1dCBpZiBgdGFyZ2V0UG9zaXRpb25gIGlzIHRyYW5zZm9ybWVkLCB0aGVuIGl0XG4gICAgLy8gYWxzbyBiZWNvbWVzIGBbIDEsIDAgXWAuIEluIHRoaXMgY2FzZSwgd2Ugd2FudCB0byBrZWVwIHRoZSBgdGFyZ2V0UG9zaXRpb25gIGFzIGl0IHdhcy5cbiAgICAvL1xuICAgIC8vIFNlY29uZCBleGNlcHRpb24gaXMgY29ubmVjdGVkIHN0cmljdGx5IHdpdGggdW5kbyByZWxhdGlvbnMuIElmIHRoaXMgYE1lcmdlT3BlcmF0aW9uYCB3YXMgZWFybGllciB0cmFuc2Zvcm1lZCBieVxuICAgIC8vIGBNZXJnZU9wZXJhdGlvbmAgYW5kIHdlIHN0b3JlZCBhbiBpbmZvcm1hdGlvbiB0aGF0IGVhcmxpZXIgdGhlIHRhcmdldCBwb3NpdGlvbiB3YXMgbm90IGFmZmVjdGVkLCB0aGVuIGhlcmUsIHdoZW4gdHJhbnNmb3JtaW5nIGJ5XG4gICAgLy8gYFNwbGl0T3BlcmF0aW9uYCB3ZSBhcmUgbm90IGdvaW5nIHRvIGNoYW5nZSBpdCBhcyB3ZWxsLlxuICAgIC8vXG4gICAgLy8gRm9yIHRoZXNlIHR3byBjYXNlcyB3ZSB3aWxsIG9ubHkgdHJhbnNmb3JtIGBzb3VyY2VQb3NpdGlvbmAgYW5kIHJldHVybiBlYXJseS5cbiAgICAvL1xuICAgIC8vIE5vdGUsIHRoYXQgZWFybGllciB0aGVyZSB3YXMgYWxzbyB0aGlyZCBzcGVjaWFsIGNhc2UgaGVyZS4gYHRhcmdldFBvc2l0aW9uYCB3YXMgbm90IHRyYW5zZm9ybWVkLCBpZiBpdCBwb2ludGVkIGludG8gdGhlIG1pZGRsZSBvZlxuICAgIC8vIHRhcmdldCBlbGVtZW50LCBub3QgaW50byBpdHMgZW5kIChhcyB1c3VhbCkuIFRoaXMgY2FuIGFsc28gaGFwcGVuIG9ubHkgd2l0aCB1bmRvIGludm9sdmVkLiBIb3dldmVyLCBpdCB3YXNuJ3QgYWx3YXlzIGEgY29ycmVjdFxuICAgIC8vIHNvbHV0aW9uLCBhcyBpbiBzb21lIGNhc2VzIHdlIGFjdHVhbGx5IHdhbnRlZCB0byB0cmFuc2Zvcm0gYHRhcmdldFBvc2l0aW9uYC4gQWxzbywgdGhpcyBjYXNlIHVzdWFsbHkgaGFwcGVucyB0b2dldGhlciB3aXRoIHRoZSBzZWNvbmRcbiAgICAvLyBjYXNlIGRlc2NyaWJlZCBhYm92ZS4gVGhlcmUgaXMgb25seSBvbmUgc2NlbmFyaW8gdGhhdCB3ZSBoYXZlIGluIG91ciB1bml0IHRlc3RzLCB3aGVyZSB0aGlzIHRoaXJkIGNhc2UgaGFwcGVuZWQgd2l0aG91dCBzZWNvbmQgY2FzZS5cbiAgICAvLyBIb3dldmVyLCB0aGlzIHNjZW5hcmlvIHdlbnQgZmluZSBubyBtYXR0ZXIgaWYgd2UgdHJhbnNmb3JtZWQgYHRhcmdldFBvc2l0aW9uYCBvciBub3QuIFRoYXQncyBiZWNhdXNlIHRoaXMgaGFwcGVuZWQgaW4gdGhlIG1pZGRsZVxuICAgIC8vIG9mIHRyYW5zZm9ybWF0aW9uIHByb2Nlc3MgYW5kIHRoZSBvcGVyYXRpb24gd2FzIGNvcnJlY3RseSB0cmFuc2Zvcm1lZCBsYXRlciBvbi5cbiAgICAvL1xuICAgIGlmIChhLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwoYi5zcGxpdFBvc2l0aW9uKSkge1xuICAgICAgICBjb25zdCBtZXJnZVNwbGl0dGluZ0VsZW1lbnQgPSBiLmdyYXZleWFyZFBvc2l0aW9uICYmIGEuZGVsZXRpb25Qb3NpdGlvbi5pc0VxdWFsKGIuZ3JhdmV5YXJkUG9zaXRpb24pO1xuICAgICAgICBpZiAobWVyZ2VTcGxpdHRpbmdFbGVtZW50IHx8IGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnbWVyZ2VUYXJnZXROb3RNb3ZlZCcpIHtcbiAgICAgICAgICAgIGEuc291cmNlUG9zaXRpb24gPSBhLnNvdXJjZVBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24oYik7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGFcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2FzZSAyOlxuICAgIC8vXG4gICAgLy8gTWVyZ2Ugc291cmNlIGlzIGF0IHRoZSBzYW1lIHBvc2l0aW9uIGFzIHNwbGl0IHBvc2l0aW9uLiBUaGlzIHNvbWV0aW1lcyBoYXBwZW4sIG1vc3RseSBkdXJpbmcgdW5kby5cbiAgICAvLyBUaGUgZGVjaXNpb24gaGVyZSBpcyBtb3N0bHkgdG8gY2hvb3NlIHdoZXRoZXIgbWVyZ2Ugc291cmNlIHBvc2l0aW9uIHNob3VsZCBzdGF5IHdoZXJlIGl0IGlzIChzbyBpdCB3aWxsIGJlIGF0IHRoZSBlbmQgb2YgdGhlXG4gICAgLy8gc3BsaXQgZWxlbWVudCkgb3Igc2hvdWxkIGJlIG1vdmUgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbmV3IGVsZW1lbnQuXG4gICAgLy9cbiAgICBpZiAoYS5zb3VyY2VQb3NpdGlvbi5pc0VxdWFsKGIuc3BsaXRQb3NpdGlvbikpIHtcbiAgICAgICAgLy8gVXNlIGNvbnRleHQgdG8gY2hlY2sgaWYgYFNwbGl0T3BlcmF0aW9uYCBpcyBub3QgdW5kb2luZyBhIG1lcmdlIG9wZXJhdGlvbiwgdGhhdCBkaWRuJ3QgY2hhbmdlIHRoZSBgYWAgb3BlcmF0aW9uLlxuICAgICAgICAvLyBUaGlzIHNjZW5hcmlvIGhhcHBlbnMgdGhlIHVuZG9uZSBtZXJnZSBvcGVyYXRpb24gbW92ZWQgbm9kZXMgYXQgdGhlIHNvdXJjZSBwb3NpdGlvbiBvZiBgYWAgb3BlcmF0aW9uLlxuICAgICAgICAvLyBJbiB0aGF0IGNhc2UgYGFgIG9wZXJhdGlvbiBzb3VyY2UgcG9zaXRpb24gc2hvdWxkIHN0YXkgd2hlcmUgaXQgaXMuXG4gICAgICAgIGlmIChjb250ZXh0LmFiUmVsYXRpb24gPT0gJ21lcmdlU291cmNlTm90TW92ZWQnKSB7XG4gICAgICAgICAgICBhLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgYS50YXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgYVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGlzIG1lcmdlIG9wZXJhdGlvbiBtaWdodCBoYXZlIGJlZW4gZWFybGllciB0cmFuc2Zvcm1lZCBieSBhIG1lcmdlIG9wZXJhdGlvbiB3aGljaCBib3RoIG1lcmdlZCB0aGUgc2FtZSBlbGVtZW50LlxuICAgICAgICAvLyBTZWUgdGhhdCBjYXNlIGluIGBNZXJnZU9wZXJhdGlvbmAgeCBgTWVyZ2VPcGVyYXRpb25gIHRyYW5zZm9ybWF0aW9uLiBJbiB0aGF0IHNjZW5hcmlvLCBpZiB0aGUgbWVyZ2Ugb3BlcmF0aW9uIGhhcyBiZWVuIHVuZG9uZSxcbiAgICAgICAgLy8gdGhlIHNwZWNpYWwgY2FzZSBpcyBub3QgYXBwbGllZC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTm93LCB0aGUgbWVyZ2Ugb3BlcmF0aW9uIGlzIHRyYW5zZm9ybWVkIGJ5IHRoZSBzcGxpdCB3aGljaCBoYXMgdW5kb25lIHRoYXQgcHJldmlvdXMgbWVyZ2Ugb3BlcmF0aW9uLlxuICAgICAgICAvLyBTbyBub3cgd2UgYXJlIGZpeGluZyBzaXR1YXRpb24gd2hpY2ggd2FzIHNraXBwZWQgaW4gYE1lcmdlT3BlcmF0aW9uYCB4IGBNZXJnZU9wZXJhdGlvbmAgY2FzZS5cbiAgICAgICAgLy9cbiAgICAgICAgaWYgKGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnbWVyZ2VTYW1lRWxlbWVudCcgfHwgYS5zb3VyY2VQb3NpdGlvbi5vZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICBhLnNvdXJjZVBvc2l0aW9uID0gYi5tb3ZlVGFyZ2V0UG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgICAgIGEudGFyZ2V0UG9zaXRpb24gPSBhLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24oYik7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGFcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZS5cbiAgICAvL1xuICAgIGlmIChhLnNvdXJjZVBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnNwbGl0UG9zaXRpb24pKSB7XG4gICAgICAgIGEuaG93TWFueSA9IGIuc3BsaXRQb3NpdGlvbi5vZmZzZXQ7XG4gICAgfVxuICAgIGEuc291cmNlUG9zaXRpb24gPSBhLnNvdXJjZVBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5U3BsaXRPcGVyYXRpb24oYik7XG4gICAgYS50YXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbnNldFRyYW5zZm9ybWF0aW9uKE1vdmVPcGVyYXRpb24sIEluc2VydE9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgY29uc3QgbW92ZVJhbmdlID0gUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KGEuc291cmNlUG9zaXRpb24sIGEuaG93TWFueSk7XG4gICAgY29uc3QgdHJhbnNmb3JtZWQgPSBtb3ZlUmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlJbnNlcnRPcGVyYXRpb24oYiwgZmFsc2UpWzBdO1xuICAgIGEuc291cmNlUG9zaXRpb24gPSB0cmFuc2Zvcm1lZC5zdGFydDtcbiAgICBhLmhvd01hbnkgPSB0cmFuc2Zvcm1lZC5lbmQub2Zmc2V0IC0gdHJhbnNmb3JtZWQuc3RhcnQub2Zmc2V0O1xuICAgIC8vIFNlZSBgSW5zZXJ0T3BlcmF0aW9uYCB4IGBNb3ZlT3BlcmF0aW9uYCB0cmFuc2Zvcm1hdGlvbiBmb3IgZGV0YWlscyBvbiB0aGlzIGNhc2UuXG4gICAgLy9cbiAgICAvLyBJbiBzdW1tYXJ5LCBib3RoIG9wZXJhdGlvbnMgcG9pbnQgdG8gdGhlIHNhbWUgcGxhY2UsIHNvIHRoZSBvcmRlciBvZiBub2RlcyBuZWVkcyB0byBiZSBkZWNpZGVkLlxuICAgIC8vIGBNb3ZlT3BlcmF0aW9uYCBpcyBjb25zaWRlcmVkIHdlYWtlciwgc28gaXQgaXMgYWx3YXlzIHRyYW5zZm9ybWVkLCB1bmxlc3MgdGhlcmUgd2FzIGEgY2VydGFpbiByZWxhdGlvblxuICAgIC8vIGJldHdlZW4gb3BlcmF0aW9ucy5cbiAgICAvL1xuICAgIGlmICghYS50YXJnZXRQb3NpdGlvbi5pc0VxdWFsKGIucG9zaXRpb24pKSB7XG4gICAgICAgIGEudGFyZ2V0UG9zaXRpb24gPSBhLnRhcmdldFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5SW5zZXJ0T3BlcmF0aW9uKGIpO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oTW92ZU9wZXJhdGlvbiwgTW92ZU9wZXJhdGlvbiwgKGEsIGIsIGNvbnRleHQpPT57XG4gICAgLy9cbiAgICAvLyBTZXR0aW5nIGFuZCBldmFsdWF0aW5nIHNvbWUgdmFyaWFibGVzIHRoYXQgd2lsbCBiZSB1c2VkIGluIHNwZWNpYWwgY2FzZXMgYW5kIGRlZmF1bHQgYWxnb3JpdGhtLlxuICAgIC8vXG4gICAgLy8gQ3JlYXRlIHJhbmdlcyBmcm9tIGBNb3ZlT3BlcmF0aW9uc2AgcHJvcGVydGllcy5cbiAgICBjb25zdCByYW5nZUEgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQoYS5zb3VyY2VQb3NpdGlvbiwgYS5ob3dNYW55KTtcbiAgICBjb25zdCByYW5nZUIgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQoYi5zb3VyY2VQb3NpdGlvbiwgYi5ob3dNYW55KTtcbiAgICAvLyBBc3NpZ24gYGNvbnRleHQuYUlzU3Ryb25nYCB0byBhIGRpZmZlcmVudCB2YXJpYWJsZSwgYmVjYXVzZSB0aGUgdmFsdWUgbWF5IGNoYW5nZSBkdXJpbmcgZXhlY3V0aW9uIG9mXG4gICAgLy8gdGhpcyBhbGdvcml0aG0gYW5kIHdlIGRvIG5vdCB3YW50IHRvIG92ZXJyaWRlIG9yaWdpbmFsIGBjb250ZXh0LmFJc1N0cm9uZ2AgdGhhdCB3aWxsIGJlIHVzZWQgaW4gbGF0ZXIgdHJhbnNmb3JtYXRpb25zLlxuICAgIGxldCBhSXNTdHJvbmcgPSBjb250ZXh0LmFJc1N0cm9uZztcbiAgICAvLyBUaGlzIHdpbGwgYmUgdXNlZCB0byBkZWNpZGUgdGhlIG9yZGVyIG9mIG5vZGVzIGlmIGJvdGggb3BlcmF0aW9ucyB0YXJnZXQgYXQgdGhlIHNhbWUgcG9zaXRpb24uXG4gICAgLy8gQnkgZGVmYXVsdCwgdXNlIHN0cm9uZy93ZWFrIG9wZXJhdGlvbiBtZWNoYW5pc20uXG4gICAgbGV0IGluc2VydEJlZm9yZSA9ICFjb250ZXh0LmFJc1N0cm9uZztcbiAgICAvLyBJZiB0aGUgcmVsYXRpb24gaXMgc2V0LCB0aGVuIHVzZSBpdCB0byBkZWNpZGUgbm9kZXMgb3JkZXIuXG4gICAgaWYgKGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnaW5zZXJ0QmVmb3JlJyB8fCBjb250ZXh0LmJhUmVsYXRpb24gPT0gJ2luc2VydEFmdGVyJykge1xuICAgICAgICBpbnNlcnRCZWZvcmUgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoY29udGV4dC5hYlJlbGF0aW9uID09ICdpbnNlcnRBZnRlcicgfHwgY29udGV4dC5iYVJlbGF0aW9uID09ICdpbnNlcnRCZWZvcmUnKSB7XG4gICAgICAgIGluc2VydEJlZm9yZSA9IGZhbHNlO1xuICAgIH1cbiAgICAvLyBgYS50YXJnZXRQb3NpdGlvbmAgY291bGQgYmUgYWZmZWN0ZWQgYnkgdGhlIGBiYCBvcGVyYXRpb24uIFdlIHdpbGwgdHJhbnNmb3JtIGl0LlxuICAgIGxldCBuZXdUYXJnZXRQb3NpdGlvbjtcbiAgICBpZiAoYS50YXJnZXRQb3NpdGlvbi5pc0VxdWFsKGIudGFyZ2V0UG9zaXRpb24pICYmIGluc2VydEJlZm9yZSkge1xuICAgICAgICBuZXdUYXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlEZWxldGlvbihiLnNvdXJjZVBvc2l0aW9uLCBiLmhvd01hbnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1RhcmdldFBvc2l0aW9uID0gYS50YXJnZXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUoYi5zb3VyY2VQb3NpdGlvbiwgYi50YXJnZXRQb3NpdGlvbiwgYi5ob3dNYW55KTtcbiAgICB9XG4gICAgLy9cbiAgICAvLyBTcGVjaWFsIGNhc2UgIzEgKyBtaXJyb3IuXG4gICAgLy9cbiAgICAvLyBTcGVjaWFsIGNhc2Ugd2hlbiBib3RoIG1vdmUgb3BlcmF0aW9ucycgdGFyZ2V0IHBvc2l0aW9ucyBhcmUgaW5zaWRlIG5vZGVzIHRoYXQgYXJlXG4gICAgLy8gYmVpbmcgbW92ZWQgYnkgdGhlIG90aGVyIG1vdmUgb3BlcmF0aW9uLiBTbyBpbiBvdGhlciB3b3Jkcywgd2UgbW92ZSByYW5nZXMgaW50byBpbnNpZGUgb2YgZWFjaCBvdGhlci5cbiAgICAvLyBUaGlzIGNhc2UgY2FuJ3QgYmUgc29sdmVkIHJlYXNvbmFibHkgKG9uIHRoZSBvdGhlciBoYW5kLCBpdCBzaG91bGQgbm90IGhhcHBlbiBvZnRlbikuXG4gICAgaWYgKF9tb3ZlVGFyZ2V0SW50b01vdmVkUmFuZ2UoYSwgYikgJiYgX21vdmVUYXJnZXRJbnRvTW92ZWRSYW5nZShiLCBhKSkge1xuICAgICAgICAvLyBJbnN0ZWFkIG9mIHRyYW5zZm9ybWluZyBvcGVyYXRpb24sIHdlIHJldHVybiBhIHJldmVyc2Ugb2YgdGhlIG9wZXJhdGlvbiB0aGF0IHdlIHRyYW5zZm9ybSBieS5cbiAgICAgICAgLy8gU28gd2hlbiB0aGUgcmVzdWx0cyBvZiB0aGlzIFwidHJhbnNmb3JtYXRpb25cIiB3aWxsIGJlIGFwcGxpZWQsIGBiYCBNb3ZlT3BlcmF0aW9uIHdpbGwgZ2V0IHJldmVyc2VkLlxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYi5nZXRSZXZlcnNlZCgpXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vXG4gICAgLy8gRW5kIG9mIHNwZWNpYWwgY2FzZSAjMS5cbiAgICAvL1xuICAgIC8vXG4gICAgLy8gU3BlY2lhbCBjYXNlICMyLlxuICAgIC8vXG4gICAgLy8gQ2hlY2sgaWYgYGJgIG9wZXJhdGlvbiB0YXJnZXRzIGluc2lkZSBgcmFuZ2VBYC5cbiAgICBjb25zdCBiVGFyZ2V0c1RvQSA9IHJhbmdlQS5jb250YWluc1Bvc2l0aW9uKGIudGFyZ2V0UG9zaXRpb24pO1xuICAgIC8vIElmIGBiYCB0YXJnZXRzIHRvIGByYW5nZUFgIGFuZCBgcmFuZ2VBYCBjb250YWlucyBgcmFuZ2VCYCwgYGJgIG9wZXJhdGlvbiBoYXMgbm8gaW5mbHVlbmNlIG9uIGBhYCBvcGVyYXRpb24uXG4gICAgLy8gWW91IG1pZ2h0IHNheSB0aGF0IG9wZXJhdGlvbiBgYmAgaXMgY2FwdHVyZWQgaW5zaWRlIG9wZXJhdGlvbiBgYWAuXG4gICAgaWYgKGJUYXJnZXRzVG9BICYmIHJhbmdlQS5jb250YWluc1JhbmdlKHJhbmdlQiwgdHJ1ZSkpIHtcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBtaW5pLXNwZWNpYWwgY2FzZSBoZXJlLCB3aGVyZSBgcmFuZ2VCYCBpcyBvbiBvdGhlciBsZXZlbCB0aGFuIGByYW5nZUFgLiBUaGF0J3Mgd2h5XG4gICAgICAgIC8vIHdlIG5lZWQgdG8gdHJhbnNmb3JtIGBhYCBvcGVyYXRpb24gYW55d2F5LlxuICAgICAgICByYW5nZUEuc3RhcnQgPSByYW5nZUEuc3RhcnQuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKGIuc291cmNlUG9zaXRpb24sIGIudGFyZ2V0UG9zaXRpb24sIGIuaG93TWFueSk7XG4gICAgICAgIHJhbmdlQS5lbmQgPSByYW5nZUEuZW5kLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShiLnNvdXJjZVBvc2l0aW9uLCBiLnRhcmdldFBvc2l0aW9uLCBiLmhvd01hbnkpO1xuICAgICAgICByZXR1cm4gX21ha2VNb3ZlT3BlcmF0aW9uc0Zyb21SYW5nZXMoW1xuICAgICAgICAgICAgcmFuZ2VBXG4gICAgICAgIF0sIG5ld1RhcmdldFBvc2l0aW9uKTtcbiAgICB9XG4gICAgLy9cbiAgICAvLyBTcGVjaWFsIGNhc2UgIzIgbWlycm9yLlxuICAgIC8vXG4gICAgY29uc3QgYVRhcmdldHNUb0IgPSByYW5nZUIuY29udGFpbnNQb3NpdGlvbihhLnRhcmdldFBvc2l0aW9uKTtcbiAgICBpZiAoYVRhcmdldHNUb0IgJiYgcmFuZ2VCLmNvbnRhaW5zUmFuZ2UocmFuZ2VBLCB0cnVlKSkge1xuICAgICAgICAvLyBgYWAgb3BlcmF0aW9uIGlzIFwibW92ZWQgdG9nZXRoZXJcIiB3aXRoIGBiYCBvcGVyYXRpb24uXG4gICAgICAgIC8vIEhlcmUsIGp1c3QgbW92ZSBgcmFuZ2VBYCBcImluc2lkZVwiIGByYW5nZUJgLlxuICAgICAgICByYW5nZUEuc3RhcnQgPSByYW5nZUEuc3RhcnQuX2dldENvbWJpbmVkKGIuc291cmNlUG9zaXRpb24sIGIuZ2V0TW92ZWRSYW5nZVN0YXJ0KCkpO1xuICAgICAgICByYW5nZUEuZW5kID0gcmFuZ2VBLmVuZC5fZ2V0Q29tYmluZWQoYi5zb3VyY2VQb3NpdGlvbiwgYi5nZXRNb3ZlZFJhbmdlU3RhcnQoKSk7XG4gICAgICAgIHJldHVybiBfbWFrZU1vdmVPcGVyYXRpb25zRnJvbVJhbmdlcyhbXG4gICAgICAgICAgICByYW5nZUFcbiAgICAgICAgXSwgbmV3VGFyZ2V0UG9zaXRpb24pO1xuICAgIH1cbiAgICAvL1xuICAgIC8vIEVuZCBvZiBzcGVjaWFsIGNhc2UgIzIuXG4gICAgLy9cbiAgICAvL1xuICAgIC8vIFNwZWNpYWwgY2FzZSAjMyArIG1pcnJvci5cbiAgICAvL1xuICAgIC8vIGByYW5nZUFgIGhhcyBhIG5vZGUgd2hpY2ggaXMgYW4gYW5jZXN0b3Igb2YgYHJhbmdlQmAuIEluIG90aGVyIHdvcmRzLCBgcmFuZ2VCYCBpcyBpbnNpZGUgYHJhbmdlQWBcbiAgICAvLyBidXQgbm90IG9uIHRoZSBzYW1lIHRyZWUgbGV2ZWwuIEluIHN1Y2ggY2FzZSByYW5nZXMgaGF2ZSBjb21tb24gcGFydCBidXQgd2UgaGF2ZSB0byB0cmVhdCBpdFxuICAgIC8vIGRpZmZlcmVudGx5LCBiZWNhdXNlIGluIHN1Y2ggY2FzZSB0aG9zZSByYW5nZXMgYXJlIG5vdCByZWFsbHkgY29uZmxpY3RpbmcgYW5kIHNob3VsZCBiZSB0cmVhdGVkIGxpa2VcbiAgICAvLyB0d28gc2VwYXJhdGUgcmFuZ2VzLiBBbHNvIHdlIGhhdmUgdG8gZGlzY2FyZCB0d28gZGlmZmVyZW5jZSBwYXJ0cy5cbiAgICBjb25zdCBhQ29tcEIgPSBjb21wYXJlQXJyYXlzKGEuc291cmNlUG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpLCBiLnNvdXJjZVBvc2l0aW9uLmdldFBhcmVudFBhdGgoKSk7XG4gICAgaWYgKGFDb21wQiA9PSAncHJlZml4JyB8fCBhQ29tcEIgPT0gJ2V4dGVuc2lvbicpIHtcbiAgICAgICAgLy8gVHJhbnNmb3JtIGByYW5nZUFgIGJ5IGBiYCBvcGVyYXRpb24gYW5kIG1ha2Ugb3BlcmF0aW9uIG91dCBvZiBpdCwgYW5kIHRoYXQncyBhbGwuXG4gICAgICAgIC8vIE5vdGUgdGhhdCB0aGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uIG9mIGRlZmF1bHQgY2FzZSwgYnV0IGhlcmUgd2UgdHJlYXQgdGhlIGNvbW1vbiBwYXJ0ICh3aG9sZSBgcmFuZ2VBYClcbiAgICAgICAgLy8gbGlrZSBhIG9uZSBkaWZmZXJlbmNlIHBhcnQuXG4gICAgICAgIHJhbmdlQS5zdGFydCA9IHJhbmdlQS5zdGFydC5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUoYi5zb3VyY2VQb3NpdGlvbiwgYi50YXJnZXRQb3NpdGlvbiwgYi5ob3dNYW55KTtcbiAgICAgICAgcmFuZ2VBLmVuZCA9IHJhbmdlQS5lbmQuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKGIuc291cmNlUG9zaXRpb24sIGIudGFyZ2V0UG9zaXRpb24sIGIuaG93TWFueSk7XG4gICAgICAgIHJldHVybiBfbWFrZU1vdmVPcGVyYXRpb25zRnJvbVJhbmdlcyhbXG4gICAgICAgICAgICByYW5nZUFcbiAgICAgICAgXSwgbmV3VGFyZ2V0UG9zaXRpb24pO1xuICAgIH1cbiAgICAvL1xuICAgIC8vIEVuZCBvZiBzcGVjaWFsIGNhc2UgIzMuXG4gICAgLy9cbiAgICAvL1xuICAgIC8vIERlZmF1bHQgY2FzZSAtIHJhbmdlcyBhcmUgb24gdGhlIHNhbWUgbGV2ZWwgb3IgYXJlIG5vdCBjb25uZWN0ZWQgd2l0aCBlYWNoIG90aGVyLlxuICAgIC8vXG4gICAgLy8gTW9kaWZpZXIgZm9yIGRlZmF1bHQgY2FzZS5cbiAgICAvLyBNb2RpZmllcyBgYUlzU3Ryb25nYCBmbGFnIGluIGNlcnRhaW4gY29uZGl0aW9ucy5cbiAgICAvL1xuICAgIC8vIElmIG9ubHkgb25lIG9mIG9wZXJhdGlvbnMgaXMgYSByZW1vdmUgb3BlcmF0aW9uLCB3ZSBmb3JjZSByZW1vdmUgb3BlcmF0aW9uIHRvIGJlIHRoZSBcInN0cm9uZ2VyXCIgb25lXG4gICAgLy8gdG8gcHJvdmlkZSBtb3JlIGV4cGVjdGVkIHJlc3VsdHMuXG4gICAgaWYgKGEudHlwZSA9PSAncmVtb3ZlJyAmJiBiLnR5cGUgIT0gJ3JlbW92ZScgJiYgIWNvbnRleHQuYVdhc1VuZG9uZSAmJiAhY29udGV4dC5mb3JjZVdlYWtSZW1vdmUpIHtcbiAgICAgICAgYUlzU3Ryb25nID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGEudHlwZSAhPSAncmVtb3ZlJyAmJiBiLnR5cGUgPT0gJ3JlbW92ZScgJiYgIWNvbnRleHQuYldhc1VuZG9uZSAmJiAhY29udGV4dC5mb3JjZVdlYWtSZW1vdmUpIHtcbiAgICAgICAgYUlzU3Ryb25nID0gZmFsc2U7XG4gICAgfVxuICAgIC8vIEhhbmRsZSBvcGVyYXRpb24ncyBzb3VyY2UgcmFuZ2VzIC0gY2hlY2sgaG93IGByYW5nZUFgIGlzIGFmZmVjdGVkIGJ5IGBiYCBvcGVyYXRpb24uXG4gICAgLy8gVGhpcyB3aWxsIGFnZ3JlZ2F0ZSB0cmFuc2Zvcm1lZCByYW5nZXMuXG4gICAgY29uc3QgcmFuZ2VzID0gW107XG4gICAgLy8gR2V0IHRoZSBcImRpZmZlcmVuY2UgcGFydFwiIG9mIGBhYCBvcGVyYXRpb24gc291cmNlIHJhbmdlLlxuICAgIC8vIFRoaXMgaXMgYW4gYXJyYXkgd2l0aCBvbmUgb3IgdHdvIHJhbmdlcy4gVHdvIHJhbmdlcyBpZiBgcmFuZ2VCYCBpcyBpbnNpZGUgYHJhbmdlQWAuXG4gICAgY29uc3QgZGlmZmVyZW5jZSA9IHJhbmdlQS5nZXREaWZmZXJlbmNlKHJhbmdlQik7XG4gICAgZm9yIChjb25zdCByYW5nZSBvZiBkaWZmZXJlbmNlKXtcbiAgICAgICAgLy8gVHJhbnNmb3JtIHRob3NlIHJhbmdlcyBieSBgYmAgb3BlcmF0aW9uLiBGb3IgZXhhbXBsZSBpZiBgYmAgbW92ZWQgcmFuZ2UgZnJvbSBiZWZvcmUgdGhvc2UgcmFuZ2VzLCBmaXggdGhvc2UgcmFuZ2VzLlxuICAgICAgICByYW5nZS5zdGFydCA9IHJhbmdlLnN0YXJ0Ll9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oYi5zb3VyY2VQb3NpdGlvbiwgYi5ob3dNYW55KTtcbiAgICAgICAgcmFuZ2UuZW5kID0gcmFuZ2UuZW5kLl9nZXRUcmFuc2Zvcm1lZEJ5RGVsZXRpb24oYi5zb3VyY2VQb3NpdGlvbiwgYi5ob3dNYW55KTtcbiAgICAgICAgLy8gSWYgYGJgIG9wZXJhdGlvbiB0YXJnZXRzIGludG8gYHJhbmdlQWAgb24gdGhlIHNhbWUgbGV2ZWwsIHNwcmVhZCBgcmFuZ2VBYCBpbnRvIHR3byByYW5nZXMuXG4gICAgICAgIGNvbnN0IHNob3VsZFNwcmVhZCA9IGNvbXBhcmVBcnJheXMocmFuZ2Uuc3RhcnQuZ2V0UGFyZW50UGF0aCgpLCBiLmdldE1vdmVkUmFuZ2VTdGFydCgpLmdldFBhcmVudFBhdGgoKSkgPT0gJ3NhbWUnO1xuICAgICAgICBjb25zdCBuZXdSYW5nZXMgPSByYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydGlvbihiLmdldE1vdmVkUmFuZ2VTdGFydCgpLCBiLmhvd01hbnksIHNob3VsZFNwcmVhZCk7XG4gICAgICAgIHJhbmdlcy5wdXNoKC4uLm5ld1Jhbmdlcyk7XG4gICAgfVxuICAgIC8vIFRoZW4sIHdlIGhhdmUgdG8gbWFuYWdlIHRoZSBcImNvbW1vbiBwYXJ0XCIgb2YgYm90aCBtb3ZlIHJhbmdlcy5cbiAgICBjb25zdCBjb21tb24gPSByYW5nZUEuZ2V0SW50ZXJzZWN0aW9uKHJhbmdlQik7XG4gICAgaWYgKGNvbW1vbiAhPT0gbnVsbCAmJiBhSXNTdHJvbmcpIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBuZXcgcG9zaXRpb24gb2YgdGhhdCBwYXJ0IG9mIG9yaWdpbmFsIHJhbmdlLlxuICAgICAgICBjb21tb24uc3RhcnQgPSBjb21tb24uc3RhcnQuX2dldENvbWJpbmVkKGIuc291cmNlUG9zaXRpb24sIGIuZ2V0TW92ZWRSYW5nZVN0YXJ0KCkpO1xuICAgICAgICBjb21tb24uZW5kID0gY29tbW9uLmVuZC5fZ2V0Q29tYmluZWQoYi5zb3VyY2VQb3NpdGlvbiwgYi5nZXRNb3ZlZFJhbmdlU3RhcnQoKSk7XG4gICAgICAgIC8vIFRha2UgY2FyZSBvZiBwcm9wZXIgcmFuZ2Ugb3JkZXIuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFB1dCBgY29tbW9uYCBhdCBhcHByb3ByaWF0ZSBwbGFjZS4gS2VlcCBpbiBtaW5kIHRoYXQgd2UgYXJlIGludGVyZXN0ZWQgaW4gb3JpZ2luYWwgb3JkZXIuXG4gICAgICAgIC8vIEJhc2ljYWxseSB0aGVyZSBhcmUgb25seSB0aHJlZSBjYXNlczogdGhlcmUgaXMgemVybywgb25lIG9yIHR3byBkaWZmZXJlbmNlIHJhbmdlcy5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgemVybyBkaWZmZXJlbmNlIHJhbmdlcywganVzdCBwdXNoIGBjb21tb25gIGluIHRoZSBhcnJheS5cbiAgICAgICAgaWYgKHJhbmdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKGNvbW1vbik7XG4gICAgICAgIH0gZWxzZSBpZiAocmFuZ2VzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICBpZiAocmFuZ2VCLnN0YXJ0LmlzQmVmb3JlKHJhbmdlQS5zdGFydCkgfHwgcmFuZ2VCLnN0YXJ0LmlzRXF1YWwocmFuZ2VBLnN0YXJ0KSkge1xuICAgICAgICAgICAgICAgIHJhbmdlcy51bnNoaWZ0KGNvbW1vbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKGNvbW1vbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByYW5nZXMuc3BsaWNlKDEsIDAsIGNvbW1vbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJhbmdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIG5vIFwic291cmNlIHJhbmdlc1wiLCBub3RoaW5nIHNob3VsZCBiZSBjaGFuZ2VkLlxuICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBjYW4gaGFwcGVuIG9ubHkgaWYgYGFJc1N0cm9uZyA9PSBmYWxzZWAgYW5kIGByYW5nZUEuaXNFcXVhbCggcmFuZ2VCIClgLlxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgbmV3IE5vT3BlcmF0aW9uKGEuYmFzZVZlcnNpb24pXG4gICAgICAgIF07XG4gICAgfVxuICAgIHJldHVybiBfbWFrZU1vdmVPcGVyYXRpb25zRnJvbVJhbmdlcyhyYW5nZXMsIG5ld1RhcmdldFBvc2l0aW9uKTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oTW92ZU9wZXJhdGlvbiwgU3BsaXRPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIGxldCBuZXdUYXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uY2xvbmUoKTtcbiAgICAvLyBEbyBub3QgdHJhbnNmb3JtIGlmIHRhcmdldCBwb3NpdGlvbiBpcyBzYW1lIGFzIHNwbGl0IGluc2VydGlvbiBwb3NpdGlvbiBhbmQgdGhpcyBzcGxpdCBjb21lcyBmcm9tIHVuZG8uXG4gICAgLy8gVGhpcyBzaG91bGQgYmUgZG9uZSBvbiByZWxhdGlvbnMgYnV0IGl0IGlzIHRvbyBtdWNoIHdvcmsgZm9yIG5vdyBhcyBpdCB3b3VsZCByZXF1aXJlIHJlbGF0aW9ucyB3b3JraW5nIGluIGNvbGxhYm9yYXRpb24uXG4gICAgLy8gV2UgbmVlZCB0byBtYWtlIGEgZGVjaXNpb24gaG93IHdlIHdpbGwgcmVzb2x2ZSBzdWNoIGNvbmZsaWN0IGFuZCB0aGlzIGlzIGxlc3MgaGFybWZ1bCB3YXkuXG4gICAgaWYgKCFhLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwoYi5pbnNlcnRpb25Qb3NpdGlvbikgfHwgIWIuZ3JhdmV5YXJkUG9zaXRpb24gfHwgY29udGV4dC5hYlJlbGF0aW9uID09ICdtb3ZlVGFyZ2V0QWZ0ZXInKSB7XG4gICAgICAgIG5ld1RhcmdldFBvc2l0aW9uID0gYS50YXJnZXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKGIpO1xuICAgIH1cbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBMYXN0IGVsZW1lbnQgaW4gdGhlIG1vdmVkIHJhbmdlIGdvdCBzcGxpdC5cbiAgICAvL1xuICAgIC8vIEluIHRoaXMgY2FzZSB0aGUgZGVmYXVsdCByYW5nZSB0cmFuc2Zvcm1hdGlvbiB3aWxsIG5vdCB3b3JrIGNvcnJlY3RseSBhcyB0aGUgZWxlbWVudCBjcmVhdGVkIGJ5XG4gICAgLy8gc3BsaXQgb3BlcmF0aW9uIHdvdWxkIGJlIG91dHNpZGUgdGhlIHJhbmdlLiBUaGUgcmFuZ2UgdG8gbW92ZSBuZWVkcyB0byBiZSBmaXhlZCBtYW51YWxseS5cbiAgICAvL1xuICAgIGNvbnN0IG1vdmVSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChhLnNvdXJjZVBvc2l0aW9uLCBhLmhvd01hbnkpO1xuICAgIGlmIChtb3ZlUmFuZ2UuZW5kLmlzRXF1YWwoYi5pbnNlcnRpb25Qb3NpdGlvbikpIHtcbiAgICAgICAgLy8gRG8gaXQgb25seSBpZiB0aGlzIGlzIGEgXCJuYXR1cmFsXCIgc3BsaXQsIG5vdCBhIG9uZSB0aGF0IGNvbWVzIGZyb20gdW5kby5cbiAgICAgICAgLy8gSWYgdGhpcyBpcyB1bmRvIHNwbGl0LCBvbmx5IGB0YXJnZXRQb3NpdGlvbmAgbmVlZHMgdG8gYmUgY2hhbmdlZCAoaWYgdGhlIG1vdmUgaXMgYSByZW1vdmUpLlxuICAgICAgICBpZiAoIWIuZ3JhdmV5YXJkUG9zaXRpb24pIHtcbiAgICAgICAgICAgIGEuaG93TWFueSsrO1xuICAgICAgICB9XG4gICAgICAgIGEudGFyZ2V0UG9zaXRpb24gPSBuZXdUYXJnZXRQb3NpdGlvbjtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGFcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gQ2FzZSAyOlxuICAgIC8vXG4gICAgLy8gU3BsaXQgaGFwcGVuZWQgYmV0d2VlbiB0aGUgbW92ZWQgbm9kZXMuIEluIHRoaXMgY2FzZSB0d28gcmFuZ2VzIHRvIG1vdmUgbmVlZCB0byBiZSBnZW5lcmF0ZWQuXG4gICAgLy9cbiAgICAvLyBDaGFyYWN0ZXJzIGBvemJhYCBhcmUgbW92ZWQgdG8gdGhlIGVuZCBvZiBwYXJhZ3JhcGggYFh5emAgYnV0IHNwbGl0IGhhcHBlbmVkLlxuICAgIC8vIDxwPkZbb3p8YmFdcjwvcD48cD5YeXo8L3A+XG4gICAgLy9cbiAgICAvLyBBZnRlciBzcGxpdDpcbiAgICAvLyA8cD5GW296PC9wPjxwPmJhXXI8L3A+PHA+WHl6PC9wPlxuICAgIC8vXG4gICAgLy8gQ29ycmVjdCByYW5nZXM6XG4gICAgLy8gPHA+Rltvel08L3A+PHA+W2JhXXI8L3A+PHA+WHl6PC9wPlxuICAgIC8vXG4gICAgLy8gQWZ0ZXIgbW92ZTpcbiAgICAvLyA8cD5GPC9wPjxwPnI8L3A+PHA+WHl6b3piYTwvcD5cbiAgICAvL1xuICAgIGlmIChtb3ZlUmFuZ2Uuc3RhcnQuaGFzU2FtZVBhcmVudEFzKGIuc3BsaXRQb3NpdGlvbikgJiYgbW92ZVJhbmdlLmNvbnRhaW5zUG9zaXRpb24oYi5zcGxpdFBvc2l0aW9uKSkge1xuICAgICAgICBsZXQgcmlnaHRSYW5nZSA9IG5ldyBSYW5nZShiLnNwbGl0UG9zaXRpb24sIG1vdmVSYW5nZS5lbmQpO1xuICAgICAgICByaWdodFJhbmdlID0gcmlnaHRSYW5nZS5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKGIpO1xuICAgICAgICBjb25zdCByYW5nZXMgPSBbXG4gICAgICAgICAgICBuZXcgUmFuZ2UobW92ZVJhbmdlLnN0YXJ0LCBiLnNwbGl0UG9zaXRpb24pLFxuICAgICAgICAgICAgcmlnaHRSYW5nZVxuICAgICAgICBdO1xuICAgICAgICByZXR1cm4gX21ha2VNb3ZlT3BlcmF0aW9uc0Zyb21SYW5nZXMocmFuZ2VzLCBuZXdUYXJnZXRQb3NpdGlvbik7XG4gICAgfVxuICAgIC8vIENhc2UgMzpcbiAgICAvL1xuICAgIC8vIE1vdmUgb3BlcmF0aW9uIHRhcmdldHMgYXQgdGhlIHNwbGl0IHBvc2l0aW9uLiBXZSBuZWVkIHRvIGRlY2lkZSBpZiB0aGUgbm9kZXMgc2hvdWxkIGJlIGluc2VydGVkXG4gICAgLy8gYXQgdGhlIGVuZCBvZiB0aGUgc3BsaXQgZWxlbWVudCBvciBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBuZXcgZWxlbWVudC5cbiAgICAvL1xuICAgIGlmIChhLnRhcmdldFBvc2l0aW9uLmlzRXF1YWwoYi5zcGxpdFBvc2l0aW9uKSAmJiBjb250ZXh0LmFiUmVsYXRpb24gPT0gJ2luc2VydEF0U291cmNlJykge1xuICAgICAgICBuZXdUYXJnZXRQb3NpdGlvbiA9IGIubW92ZVRhcmdldFBvc2l0aW9uO1xuICAgIH1cbiAgICAvLyBDYXNlIDQ6XG4gICAgLy9cbiAgICAvLyBNb3ZlIG9wZXJhdGlvbiB0YXJnZXRzIGp1c3QgYWZ0ZXIgdGhlIHNwbGl0IGVsZW1lbnQuIFdlIG5lZWQgdG8gZGVjaWRlIGlmIHRoZSBub2RlcyBzaG91bGQgYmUgaW5zZXJ0ZWRcbiAgICAvLyBiZXR3ZWVuIHR3byBwYXJ0cyBvZiBzcGxpdCBlbGVtZW50LCBvciBhZnRlciB0aGUgbmV3IGVsZW1lbnQuXG4gICAgLy9cbiAgICAvLyBTcGxpdCBhdCBgfGAsIHdoaWxlIG1vdmUgb3BlcmF0aW9uIG1vdmVzIGA8cD5YeXo8L3A+YCBhbmQgdGFyZ2V0cyBhdCBgXmA6XG4gICAgLy8gPHA+Rm9vfGJhcjwvcD5ePHA+YmF6PC9wPlxuICAgIC8vIDxwPkZvbzwvcD5ePHA+YmFyPC9wPjxwPmJhejwvcD4gb3IgPHA+Rm9vPC9wPjxwPmJhcjwvcD5ePHA+YmF6PC9wPj9cbiAgICAvL1xuICAgIC8vIElmIHRoZXJlIGlzIG5vIGNvbnRleHR1YWwgaW5mb3JtYXRpb24gYmV0d2VlbiBvcGVyYXRpb25zIChmb3IgZXhhbXBsZSwgdGhleSBjb21lIGZyb20gY29sbGFib3JhdGl2ZVxuICAgIC8vIGVkaXRpbmcpLCB3ZSBkb24ndCB3YW50IHRvIHB1dCBzb21lIHVucmVsYXRlZCBjb250ZW50IChtb3ZlKSBiZXR3ZWVuIHBhcnRzIG9mIHJlbGF0ZWQgY29udGVudCAoc3BsaXQgcGFydHMpLlxuICAgIC8vIEhvd2V2ZXIsIGlmIHRoZSBzcGxpdCBpcyBmcm9tIHVuZG8sIGluIHRoZSBwYXN0LCB0aGUgbW92ZWQgY29udGVudCBtaWdodCBiZSB0YXJnZXRpbmcgYmV0d2VlbiB0aGVcbiAgICAvLyBzcGxpdCBwYXJ0cywgbWVhbmluZyB0aGF0IHdhcyBleGFjdGx5IHVzZXIncyBpbnRlbnRpb246XG4gICAgLy9cbiAgICAvLyA8cD5Gb288L3A+XjxwPmJhcjwvcD5cdFx0PC0tLSBvcmlnaW5hbCBzaXR1YXRpb24sIGluIFwicGFzdFwiLlxuICAgIC8vIDxwPkZvb2JhcjwvcD5eXHRcdFx0XHQ8LS0tIGFmdGVyIG1lcmdlIHRhcmdldCBwb3NpdGlvbiBpcyB0cmFuc2Zvcm1lZC5cbiAgICAvLyA8cD5Gb298YmFyPC9wPl5cdFx0XHRcdDwtLS0gdGhlbiB0aGUgbWVyZ2UgaXMgdW5kb25lLCBhbmQgc3BsaXQgaGFwcGVucywgd2hpY2ggbGVhZHMgdXMgdG8gY3VycmVudCBzaXR1YXRpb24uXG4gICAgLy9cbiAgICAvLyBJbiB0aGlzIGNhc2UgaXQgaXMgcHJldHR5IGNsZWFyIHRoYXQgdGhlIGludGVudGlvbiB3YXMgdG8gcHV0IG5ldyBwYXJhZ3JhcGggYmV0d2VlbiB0aG9zZSBub2RlcyxcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRyYW5zZm9ybSBhY2NvcmRpbmdseS4gV2UgY2FuIGRldGVjdCB0aGlzIHNjZW5hcmlvIHRoYW5rcyB0byByZWxhdGlvbnMuXG4gICAgLy9cbiAgICBpZiAoYS50YXJnZXRQb3NpdGlvbi5pc0VxdWFsKGIuaW5zZXJ0aW9uUG9zaXRpb24pICYmIGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnaW5zZXJ0QmV0d2VlbicpIHtcbiAgICAgICAgbmV3VGFyZ2V0UG9zaXRpb24gPSBhLnRhcmdldFBvc2l0aW9uO1xuICAgIH1cbiAgICAvLyBUaGUgZGVmYXVsdCBjYXNlLlxuICAgIC8vXG4gICAgY29uc3QgdHJhbnNmb3JtZWQgPSBtb3ZlUmFuZ2UuX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICBjb25zdCByYW5nZXMgPSBbXG4gICAgICAgIHRyYW5zZm9ybWVkXG4gICAgXTtcbiAgICAvLyBDYXNlIDU6XG4gICAgLy9cbiAgICAvLyBNb3ZlZCByYW5nZSBjb250YWlucyBncmF2ZXlhcmQgZWxlbWVudCB1c2VkIGJ5IHNwbGl0IG9wZXJhdGlvbi4gQWRkIGV4dHJhIG1vdmUgb3BlcmF0aW9uIHRvIHRoZSByZXN1bHQuXG4gICAgLy9cbiAgICBpZiAoYi5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICBjb25zdCBtb3Zlc0dyYXZleWFyZEVsZW1lbnQgPSBtb3ZlUmFuZ2Uuc3RhcnQuaXNFcXVhbChiLmdyYXZleWFyZFBvc2l0aW9uKSB8fCBtb3ZlUmFuZ2UuY29udGFpbnNQb3NpdGlvbihiLmdyYXZleWFyZFBvc2l0aW9uKTtcbiAgICAgICAgaWYgKGEuaG93TWFueSA+IDEgJiYgbW92ZXNHcmF2ZXlhcmRFbGVtZW50ICYmICFjb250ZXh0LmFXYXNVbmRvbmUpIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChiLmluc2VydGlvblBvc2l0aW9uLCAxKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9tYWtlTW92ZU9wZXJhdGlvbnNGcm9tUmFuZ2VzKHJhbmdlcywgbmV3VGFyZ2V0UG9zaXRpb24pO1xufSk7XG5zZXRUcmFuc2Zvcm1hdGlvbihNb3ZlT3BlcmF0aW9uLCBNZXJnZU9wZXJhdGlvbiwgKGEsIGIsIGNvbnRleHQpPT57XG4gICAgY29uc3QgbW92ZWRSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChhLnNvdXJjZVBvc2l0aW9uLCBhLmhvd01hbnkpO1xuICAgIGlmIChiLmRlbGV0aW9uUG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGEuc291cmNlUG9zaXRpb24pICYmIG1vdmVkUmFuZ2UuY29udGFpbnNQb3NpdGlvbihiLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICBpZiAoYS50eXBlID09ICdyZW1vdmUnICYmICFjb250ZXh0LmZvcmNlV2Vha1JlbW92ZSkge1xuICAgICAgICAgICAgLy8gQ2FzZSAxOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHRvIHJlbW92ZSBnb3QgbWVyZ2VkLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIE1lcmdlIG9wZXJhdGlvbiBkb2VzIHN1cHBvcnQgbWVyZ2luZyBlbGVtZW50cyB3aGljaCBhcmUgbm90IHNpYmxpbmdzLiBTbyBpdCB3b3VsZCBub3QgYmUgYSBwcm9ibGVtXG4gICAgICAgICAgICAvLyBmcm9tIHRlY2huaWNhbCBwb2ludCBvZiB2aWV3LiBIb3dldmVyLCBpZiB0aGUgZWxlbWVudCB3YXMgcmVtb3ZlZCwgdGhlIGludGVudGlvbiBvZiB0aGUgdXNlclxuICAgICAgICAgICAgLy8gZGVsZXRpbmcgaXQgd2FzIHRvIGhhdmUgaXQgYWxsIGRlbGV0ZWQuIEZyb20gdXNlciBleHBlcmllbmNlIHBvaW50IG9mIHZpZXcsIG1vdmluZyBiYWNrIHRoZVxuICAgICAgICAgICAgLy8gcmVtb3ZlZCBub2RlcyBtaWdodCBiZSB1bmV4cGVjdGVkLiBUaGlzIG1lYW5zIHRoYXQgaW4gdGhpcyBzY2VuYXJpbyB3ZSB3aWxsIHJldmVyc2UgbWVyZ2luZyBhbmQgcmVtb3ZlIHRoZSBlbGVtZW50LlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGlmICghY29udGV4dC5hV2FzVW5kb25lKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgIGxldCBneU1vdmVTb3VyY2UgPSBiLmdyYXZleWFyZFBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgbGV0IHNwbGl0Tm9kZXNNb3ZlU291cmNlID0gYi50YXJnZXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKGIpO1xuICAgICAgICAgICAgICAgIC8vIGBhLnRhcmdldFBvc2l0aW9uYCBwb2ludHMgdG8gZ3JhdmV5YXJkLCBzbyBpdCB3YXMgcHJvYmFibHkgYWZmZWN0ZWQgYnkgYGJgICh3aGljaCBtb3ZlZCBtZXJnZWQgZWxlbWVudCB0byB0aGUgZ3JhdmV5YXJkKS5cbiAgICAgICAgICAgICAgICBjb25zdCBhVGFyZ2V0ID0gYS50YXJnZXRQb3NpdGlvbi5nZXRUcmFuc2Zvcm1lZEJ5T3BlcmF0aW9uKGIpO1xuICAgICAgICAgICAgICAgIGlmIChhLmhvd01hbnkgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChuZXcgTW92ZU9wZXJhdGlvbihhLnNvdXJjZVBvc2l0aW9uLCBhLmhvd01hbnkgLSAxLCBhVGFyZ2V0LCAwKSk7XG4gICAgICAgICAgICAgICAgICAgIGd5TW92ZVNvdXJjZSA9IGd5TW92ZVNvdXJjZS5fZ2V0VHJhbnNmb3JtZWRCeU1vdmUoYS5zb3VyY2VQb3NpdGlvbiwgYVRhcmdldCwgYS5ob3dNYW55IC0gMSk7XG4gICAgICAgICAgICAgICAgICAgIHNwbGl0Tm9kZXNNb3ZlU291cmNlID0gc3BsaXROb2Rlc01vdmVTb3VyY2UuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKGEuc291cmNlUG9zaXRpb24sIGFUYXJnZXQsIGEuaG93TWFueSAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBneU1vdmVUYXJnZXQgPSBiLmRlbGV0aW9uUG9zaXRpb24uX2dldENvbWJpbmVkKGEuc291cmNlUG9zaXRpb24sIGFUYXJnZXQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGd5TW92ZSA9IG5ldyBNb3ZlT3BlcmF0aW9uKGd5TW92ZVNvdXJjZSwgMSwgZ3lNb3ZlVGFyZ2V0LCAwKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdE5vZGVzTW92ZVRhcmdldFBhdGggPSBneU1vdmUuZ2V0TW92ZWRSYW5nZVN0YXJ0KCkucGF0aC5zbGljZSgpO1xuICAgICAgICAgICAgICAgIHNwbGl0Tm9kZXNNb3ZlVGFyZ2V0UGF0aC5wdXNoKDApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0Tm9kZXNNb3ZlVGFyZ2V0ID0gbmV3IFBvc2l0aW9uKGd5TW92ZS50YXJnZXRQb3NpdGlvbi5yb290LCBzcGxpdE5vZGVzTW92ZVRhcmdldFBhdGgpO1xuICAgICAgICAgICAgICAgIHNwbGl0Tm9kZXNNb3ZlU291cmNlID0gc3BsaXROb2Rlc01vdmVTb3VyY2UuX2dldFRyYW5zZm9ybWVkQnlNb3ZlKGd5TW92ZVNvdXJjZSwgZ3lNb3ZlVGFyZ2V0LCAxKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzcGxpdE5vZGVzTW92ZSA9IG5ldyBNb3ZlT3BlcmF0aW9uKHNwbGl0Tm9kZXNNb3ZlU291cmNlLCBiLmhvd01hbnksIHNwbGl0Tm9kZXNNb3ZlVGFyZ2V0LCAwKTtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZ3lNb3ZlKTtcbiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goc3BsaXROb2Rlc01vdmUpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ2FzZSAyOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHRvIG1vdmUgZ290IG1lcmdlZCBhbmQgaXQgd2FzIHRoZSBvbmx5IGVsZW1lbnQgdG8gbW92ZS5cbiAgICAgICAgICAgIC8vIEluIHRoaXMgY2FzZSBqdXN0IGRvbid0IGRvIGFueXRoaW5nLCBsZWF2ZSB0aGUgbm9kZSBpbiB0aGUgZ3JhdmV5YXJkLiBXaXRob3V0IHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgLy8gaXQgd291bGQgYmUgYSBtb3ZlIG9wZXJhdGlvbiB0aGF0IG1vdmVzIDAgbm9kZXMsIHNvIG1heWJlIGl0IGlzIGJldHRlciBqdXN0IHRvIHJldHVybiBuby1vcC5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBpZiAoYS5ob3dNYW55ID09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbnRleHQuYldhc1VuZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vT3BlcmF0aW9uKDApXG4gICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYS5zb3VyY2VQb3NpdGlvbiA9IGIuZ3JhdmV5YXJkUG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgYS50YXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFcbiAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gVGhlIGRlZmF1bHQgY2FzZS5cbiAgICAvL1xuICAgIGNvbnN0IG1vdmVSYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChhLnNvdXJjZVBvc2l0aW9uLCBhLmhvd01hbnkpO1xuICAgIGNvbnN0IHRyYW5zZm9ybWVkID0gbW92ZVJhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5TWVyZ2VPcGVyYXRpb24oYik7XG4gICAgYS5zb3VyY2VQb3NpdGlvbiA9IHRyYW5zZm9ybWVkLnN0YXJ0O1xuICAgIGEuaG93TWFueSA9IHRyYW5zZm9ybWVkLmVuZC5vZmZzZXQgLSB0cmFuc2Zvcm1lZC5zdGFydC5vZmZzZXQ7XG4gICAgYS50YXJnZXRQb3NpdGlvbiA9IGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbnNldFRyYW5zZm9ybWF0aW9uKFJlbmFtZU9wZXJhdGlvbiwgSW5zZXJ0T3BlcmF0aW9uLCAoYSwgYik9PntcbiAgICBhLnBvc2l0aW9uID0gYS5wb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oUmVuYW1lT3BlcmF0aW9uLCBNZXJnZU9wZXJhdGlvbiwgKGEsIGIpPT57XG4gICAgLy8gQ2FzZSAxOlxuICAgIC8vXG4gICAgLy8gRWxlbWVudCB0byByZW5hbWUgZ290IG1lcmdlZCwgc28gaXQgd2FzIG1vdmVkIHRvIGBiLmdyYXZleWFyZFBvc2l0aW9uYC5cbiAgICAvL1xuICAgIGlmIChhLnBvc2l0aW9uLmlzRXF1YWwoYi5kZWxldGlvblBvc2l0aW9uKSkge1xuICAgICAgICBhLnBvc2l0aW9uID0gYi5ncmF2ZXlhcmRQb3NpdGlvbi5jbG9uZSgpO1xuICAgICAgICBhLnBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9OZXh0JztcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGFcbiAgICAgICAgXTtcbiAgICB9XG4gICAgYS5wb3NpdGlvbiA9IGEucG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oUmVuYW1lT3BlcmF0aW9uLCBNb3ZlT3BlcmF0aW9uLCAoYSwgYik9PntcbiAgICBhLnBvc2l0aW9uID0gYS5wb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1vdmVPcGVyYXRpb24oYik7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKFJlbmFtZU9wZXJhdGlvbiwgUmVuYW1lT3BlcmF0aW9uLCAoYSwgYiwgY29udGV4dCk9PntcbiAgICBpZiAoYS5wb3NpdGlvbi5pc0VxdWFsKGIucG9zaXRpb24pKSB7XG4gICAgICAgIGlmIChjb250ZXh0LmFJc1N0cm9uZykge1xuICAgICAgICAgICAgYS5vbGROYW1lID0gYi5uZXdOYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbnNldFRyYW5zZm9ybWF0aW9uKFJlbmFtZU9wZXJhdGlvbiwgU3BsaXRPcGVyYXRpb24sIChhLCBiKT0+e1xuICAgIC8vIENhc2UgMTpcbiAgICAvL1xuICAgIC8vIFRoZSBlbGVtZW50IHRvIHJlbmFtZSBoYXMgYmVlbiBzcGxpdC4gSW4gdGhpcyBjYXNlLCB0aGUgbmV3IGVsZW1lbnQgc2hvdWxkIGJlIGFsc28gcmVuYW1lZC5cbiAgICAvL1xuICAgIC8vIFVzZXIgZGVjaWRlcyB0byBjaGFuZ2UgdGhlIHBhcmFncmFwaCB0byBhIGxpc3QgaXRlbTpcbiAgICAvLyA8cGFyYWdyYXBoPkZvb2JhcjwvcGFyYWdyYXBoPlxuICAgIC8vXG4gICAgLy8gSG93ZXZlciwgaW4gbWVhbnRpbWUsIHNwbGl0IGhhcHBlbnM6XG4gICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPmJhcjwvcGFyYWdyYXBoPlxuICAgIC8vXG4gICAgLy8gQXMgYSByZXN1bHQsIHJlbmFtZSBib3RoIGVsZW1lbnRzOlxuICAgIC8vIDxsaXN0SXRlbT5Gb288L2xpc3RJdGVtPjxsaXN0SXRlbT5iYXI8L2xpc3RJdGVtPlxuICAgIC8vXG4gICAgY29uc3QgcmVuYW1lUGF0aCA9IGEucG9zaXRpb24ucGF0aDtcbiAgICBjb25zdCBzcGxpdFBhdGggPSBiLnNwbGl0UG9zaXRpb24uZ2V0UGFyZW50UGF0aCgpO1xuICAgIGlmIChjb21wYXJlQXJyYXlzKHJlbmFtZVBhdGgsIHNwbGl0UGF0aCkgPT0gJ3NhbWUnICYmICFiLmdyYXZleWFyZFBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGV4dHJhUmVuYW1lID0gbmV3IFJlbmFtZU9wZXJhdGlvbihhLnBvc2l0aW9uLmdldFNoaWZ0ZWRCeSgxKSwgYS5vbGROYW1lLCBhLm5ld05hbWUsIDApO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYSxcbiAgICAgICAgICAgIGV4dHJhUmVuYW1lXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIFRoZSBkZWZhdWx0IGNhc2UuXG4gICAgLy9cbiAgICBhLnBvc2l0aW9uID0gYS5wb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeVNwbGl0T3BlcmF0aW9uKGIpO1xuICAgIHJldHVybiBbXG4gICAgICAgIGFcbiAgICBdO1xufSk7XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuc2V0VHJhbnNmb3JtYXRpb24oUm9vdEF0dHJpYnV0ZU9wZXJhdGlvbiwgUm9vdEF0dHJpYnV0ZU9wZXJhdGlvbiwgKGEsIGIsIGNvbnRleHQpPT57XG4gICAgaWYgKGEucm9vdCA9PT0gYi5yb290ICYmIGEua2V5ID09PSBiLmtleSkge1xuICAgICAgICBpZiAoIWNvbnRleHQuYUlzU3Ryb25nIHx8IGEubmV3VmFsdWUgPT09IGIubmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IE5vT3BlcmF0aW9uKDApXG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYS5vbGRWYWx1ZSA9IGIubmV3VmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5zZXRUcmFuc2Zvcm1hdGlvbihSb290T3BlcmF0aW9uLCBSb290T3BlcmF0aW9uLCAoYSwgYik9PntcbiAgICBpZiAoYS5yb290TmFtZSA9PT0gYi5yb290TmFtZSAmJiBhLmlzQWRkID09PSBiLmlzQWRkKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgXTtcbiAgICB9XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYVxuICAgIF07XG59KTtcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5zZXRUcmFuc2Zvcm1hdGlvbihTcGxpdE9wZXJhdGlvbiwgSW5zZXJ0T3BlcmF0aW9uLCAoYSwgYik9PntcbiAgICAvLyBUaGUgZGVmYXVsdCBjYXNlLlxuICAgIC8vXG4gICAgaWYgKGEuc3BsaXRQb3NpdGlvbi5oYXNTYW1lUGFyZW50QXMoYi5wb3NpdGlvbikgJiYgYS5zcGxpdFBvc2l0aW9uLm9mZnNldCA8IGIucG9zaXRpb24ub2Zmc2V0KSB7XG4gICAgICAgIGEuaG93TWFueSArPSBiLmhvd01hbnk7XG4gICAgfVxuICAgIGEuc3BsaXRQb3NpdGlvbiA9IGEuc3BsaXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihiKTtcbiAgICBhLmluc2VydGlvblBvc2l0aW9uID0gYS5pbnNlcnRpb25Qb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeUluc2VydE9wZXJhdGlvbihiKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oU3BsaXRPcGVyYXRpb24sIE1lcmdlT3BlcmF0aW9uLCAoYSwgYiwgY29udGV4dCk9PntcbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBTcGxpdCBlbGVtZW50IGdvdCBtZXJnZWQuIElmIHR3byBkaWZmZXJlbnQgZWxlbWVudHMgd2VyZSBtZXJnZWQsIGNsaWVudHMgd2lsbCBoYXZlIGRpZmZlcmVudCBjb250ZW50LlxuICAgIC8vXG4gICAgLy8gRXhhbXBsZS4gTWVyZ2UgYXQgYHt9YCwgc3BsaXQgYXQgYFtdYDpcbiAgICAvLyA8aGVhZGluZz5Gb288L2hlYWRpbmc+e308cGFyYWdyYXBoPkJbXWFyPC9wYXJhZ3JhcGg+XG4gICAgLy9cbiAgICAvLyBPbiBtZXJnZSBzaWRlIGl0IHdpbGwgbG9vayBsaWtlIHRoaXM6XG4gICAgLy8gPGhlYWRpbmc+Rm9vQltdYXI8L2hlYWRpbmc+XG4gICAgLy8gPGhlYWRpbmc+Rm9vQjwvaGVhZGluZz48aGVhZGluZz5hcjwvaGVhZGluZz5cbiAgICAvL1xuICAgIC8vIE9uIHNwbGl0IHNpZGUgaXQgd2lsbCBsb29rIGxpa2UgdGhpczpcbiAgICAvLyA8aGVhZGluZz5Gb288L2hlYWRpbmc+e308cGFyYWdyYXBoPkI8L3BhcmFncmFwaD48cGFyYWdyYXBoPmFyPC9wYXJhZ3JhcGg+XG4gICAgLy8gPGhlYWRpbmc+Rm9vQjwvaGVhZGluZz48cGFyYWdyYXBoPmFyPC9wYXJhZ3JhcGg+XG4gICAgLy9cbiAgICAvLyBDbGVhcmx5LCB0aGUgc2Vjb25kIGVsZW1lbnQgaXMgZGlmZmVyZW50IGZvciBib3RoIGNsaWVudHMuXG4gICAgLy9cbiAgICAvLyBXZSBjb3VsZCB1c2UgdGhlIHJlbW92ZWQgbWVyZ2UgZWxlbWVudCBmcm9tIGdyYXZleWFyZCBhcyBhIHNwbGl0IGVsZW1lbnQgYnV0IHRoZW4gY2xpZW50cyB3b3VsZCBoYXZlIGEgZGlmZmVyZW50XG4gICAgLy8gbW9kZWwgc3RhdGUgKGluIGdyYXZleWFyZCksIGJlY2F1c2UgdGhlIHNwbGl0IHNpZGUgY2xpZW50IHdvdWxkIHN0aWxsIGhhdmUgYW4gZWxlbWVudCBpbiBncmF2ZXlhcmQgKHJlbW92ZWQgYnkgbWVyZ2UpLlxuICAgIC8vXG4gICAgLy8gVG8gb3ZlcmNvbWUgdGhpcywgaW4gYFNwbGl0T3BlcmF0aW9uYCB4IGBNZXJnZU9wZXJhdGlvbmAgdHJhbnNmb3JtYXRpb24gd2Ugd2lsbCBhZGQgYWRkaXRpb25hbCBgU3BsaXRPcGVyYXRpb25gXG4gICAgLy8gaW4gdGhlIGdyYXZleWFyZCwgd2hpY2ggd2lsbCBhY3R1YWxseSBjbG9uZSB0aGUgbWVyZ2VkLWFuZC1kZWxldGVkIGVsZW1lbnQuIFRoZW4sIHRoYXQgY2xvbmVkIGVsZW1lbnQgd2lsbCBiZVxuICAgIC8vIHVzZWQgZm9yIHNwbGl0dGluZy4gRXhhbXBsZSBiZWxvdy5cbiAgICAvL1xuICAgIC8vIE9yaWdpbmFsIHN0YXRlOlxuICAgIC8vIDxoZWFkaW5nPkZvbzwvaGVhZGluZz57fTxwYXJhZ3JhcGg+QltdYXI8L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIC8vIE1lcmdlIHNpZGUgY2xpZW50OlxuICAgIC8vXG4gICAgLy8gQWZ0ZXIgbWVyZ2U6XG4gICAgLy8gPGhlYWRpbmc+Rm9vQltdYXI8L2hlYWRpbmc+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhdmV5YXJkOiA8cGFyYWdyYXBoPjwvcGFyYWdyYXBoPlxuICAgIC8vXG4gICAgLy8gRXh0cmEgc3BsaXQ6XG4gICAgLy8gPGhlYWRpbmc+Rm9vQltdYXI8L2hlYWRpbmc+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JhdmV5YXJkOiA8cGFyYWdyYXBoPjwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+PC9wYXJhZ3JhcGg+XG4gICAgLy9cbiAgICAvLyBVc2UgdGhlIFwiY2xvbmVkXCIgZWxlbWVudCBmcm9tIGdyYXZleWFyZDpcbiAgICAvLyA8aGVhZGluZz5Gb29CPC9oZWFkaW5nPjxwYXJhZ3JhcGg+YXI8L3BhcmFncmFwaD4gICAgICAgICAgICBncmF2ZXlhcmQ6IDxwYXJhZ3JhcGg+PC9wYXJhZ3JhcGg+XG4gICAgLy9cbiAgICAvLyBTcGxpdCBzaWRlIGNsaWVudDpcbiAgICAvL1xuICAgIC8vIEFmdGVyIHNwbGl0OlxuICAgIC8vIDxoZWFkaW5nPkZvbzwvaGVhZGluZz57fTxwYXJhZ3JhcGg+QjwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+YXI8L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIC8vIEFmdGVyIG1lcmdlOlxuICAgIC8vIDxoZWFkaW5nPkZvb0I8L2hlYWRpbmc+PHBhcmFncmFwaD5hcjwvcGFyYWdyYXBoPiAgICAgICAgICAgIGdyYXZleWFyZDogPHBhcmFncmFwaD48L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIC8vIFRoaXMgc3BlY2lhbCBjYXNlIHNjZW5hcmlvIG9ubHkgYXBwbGllcyBpZiB0aGUgb3JpZ2luYWwgc3BsaXQgb3BlcmF0aW9uIGNsb25lcyB0aGUgc3BsaXQgZWxlbWVudC5cbiAgICAvLyBJZiB0aGUgb3JpZ2luYWwgc3BsaXQgb3BlcmF0aW9uIGhhcyBgZ3JhdmV5YXJkUG9zaXRpb25gIHNldCwgaXQgYWxsIGRvZXNuJ3QgaGF2ZSBzZW5zZSBiZWNhdXNlIHNwbGl0IG9wZXJhdGlvblxuICAgIC8vIGtub3dzIGV4YWN0bHkgd2hpY2ggZWxlbWVudCBpdCBzaG91bGQgdXNlLiBTbyB0aGVyZSB3b3VsZCBiZSBubyBvcmlnaW5hbCBwcm9ibGVtIHdpdGggZGlmZmVyZW50IGNvbnRlbnRzLlxuICAgIC8vXG4gICAgLy8gQWRkaXRpb25hbGx5LCB0aGUgc3BlY2lhbCBjYXNlIGFwcGxpZXMgb25seSBpZiB0aGUgbWVyZ2Ugd2Fzbid0IGFscmVhZHkgdW5kb25lLlxuICAgIC8vXG4gICAgaWYgKCFhLmdyYXZleWFyZFBvc2l0aW9uICYmICFjb250ZXh0LmJXYXNVbmRvbmUgJiYgYS5zcGxpdFBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnNvdXJjZVBvc2l0aW9uKSkge1xuICAgICAgICBjb25zdCBzcGxpdFBhdGggPSBiLmdyYXZleWFyZFBvc2l0aW9uLnBhdGguc2xpY2UoKTtcbiAgICAgICAgc3BsaXRQYXRoLnB1c2goMCk7XG4gICAgICAgIGNvbnN0IHNwbGl0UG9zaXRpb24gPSBuZXcgUG9zaXRpb24oYi5ncmF2ZXlhcmRQb3NpdGlvbi5yb290LCBzcGxpdFBhdGgpO1xuICAgICAgICBjb25zdCBpbnNlcnRpb25Qb3NpdGlvbiA9IFNwbGl0T3BlcmF0aW9uLmdldEluc2VydGlvblBvc2l0aW9uKG5ldyBQb3NpdGlvbihiLmdyYXZleWFyZFBvc2l0aW9uLnJvb3QsIHNwbGl0UGF0aCkpO1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsU3BsaXQgPSBuZXcgU3BsaXRPcGVyYXRpb24oc3BsaXRQb3NpdGlvbiwgMCwgaW5zZXJ0aW9uUG9zaXRpb24sIG51bGwsIDApO1xuICAgICAgICBhLnNwbGl0UG9zaXRpb24gPSBhLnNwbGl0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICAgICAgYS5pbnNlcnRpb25Qb3NpdGlvbiA9IFNwbGl0T3BlcmF0aW9uLmdldEluc2VydGlvblBvc2l0aW9uKGEuc3BsaXRQb3NpdGlvbik7XG4gICAgICAgIGEuZ3JhdmV5YXJkUG9zaXRpb24gPSBhZGRpdGlvbmFsU3BsaXQuaW5zZXJ0aW9uUG9zaXRpb24uY2xvbmUoKTtcbiAgICAgICAgYS5ncmF2ZXlhcmRQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBhZGRpdGlvbmFsU3BsaXQsXG4gICAgICAgICAgICBhXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIFRoZSBkZWZhdWx0IGNhc2UuXG4gICAgLy9cbiAgICBpZiAoYS5zcGxpdFBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLmRlbGV0aW9uUG9zaXRpb24pICYmICFhLnNwbGl0UG9zaXRpb24uaXNBZnRlcihiLmRlbGV0aW9uUG9zaXRpb24pKSB7XG4gICAgICAgIGEuaG93TWFueS0tO1xuICAgIH1cbiAgICBpZiAoYS5zcGxpdFBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnRhcmdldFBvc2l0aW9uKSkge1xuICAgICAgICBhLmhvd01hbnkgKz0gYi5ob3dNYW55O1xuICAgIH1cbiAgICBhLnNwbGl0UG9zaXRpb24gPSBhLnNwbGl0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNZXJnZU9wZXJhdGlvbihiKTtcbiAgICBhLmluc2VydGlvblBvc2l0aW9uID0gU3BsaXRPcGVyYXRpb24uZ2V0SW5zZXJ0aW9uUG9zaXRpb24oYS5zcGxpdFBvc2l0aW9uKTtcbiAgICBpZiAoYS5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICBhLmdyYXZleWFyZFBvc2l0aW9uID0gYS5ncmF2ZXlhcmRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeU1lcmdlT3BlcmF0aW9uKGIpO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oU3BsaXRPcGVyYXRpb24sIE1vdmVPcGVyYXRpb24sIChhLCBiLCBjb250ZXh0KT0+e1xuICAgIGNvbnN0IHJhbmdlVG9Nb3ZlID0gUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KGIuc291cmNlUG9zaXRpb24sIGIuaG93TWFueSk7XG4gICAgaWYgKGEuZ3JhdmV5YXJkUG9zaXRpb24pIHtcbiAgICAgICAgLy8gQ2FzZSAxOlxuICAgICAgICAvL1xuICAgICAgICAvLyBTcGxpdCBvcGVyYXRpb24gZ3JhdmV5YXJkIG5vZGUgd2FzIG1vdmVkLiBJbiB0aGlzIGNhc2UgbW92ZSBvcGVyYXRpb24gaXMgc3Ryb25nZXIuIFNpbmNlIGdyYXZleWFyZCBlbGVtZW50XG4gICAgICAgIC8vIGlzIGFscmVhZHkgbW92ZWQgdG8gdGhlIGNvcnJlY3QgcG9zaXRpb24sIHdlIG5lZWQgdG8gb25seSBtb3ZlIHRoZSBub2RlcyBhZnRlciB0aGUgc3BsaXQgcG9zaXRpb24uXG4gICAgICAgIC8vIFRoaXMgd2lsbCBiZSBkb25lIGJ5IGBNb3ZlT3BlcmF0aW9uYCBpbnN0ZWFkIG9mIGBTcGxpdE9wZXJhdGlvbmAuXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IGd5RWxlbWVudE1vdmVkID0gcmFuZ2VUb01vdmUuc3RhcnQuaXNFcXVhbChhLmdyYXZleWFyZFBvc2l0aW9uKSB8fCByYW5nZVRvTW92ZS5jb250YWluc1Bvc2l0aW9uKGEuZ3JhdmV5YXJkUG9zaXRpb24pO1xuICAgICAgICBpZiAoIWNvbnRleHQuYldhc1VuZG9uZSAmJiBneUVsZW1lbnRNb3ZlZCkge1xuICAgICAgICAgICAgY29uc3Qgc291cmNlUG9zaXRpb24gPSBhLnNwbGl0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKGIpO1xuICAgICAgICAgICAgY29uc3QgbmV3UGFyZW50UG9zaXRpb24gPSBhLmdyYXZleWFyZFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihiKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1RhcmdldFBhdGggPSBuZXdQYXJlbnRQb3NpdGlvbi5wYXRoLnNsaWNlKCk7XG4gICAgICAgICAgICBuZXdUYXJnZXRQYXRoLnB1c2goMCk7XG4gICAgICAgICAgICBjb25zdCBuZXdUYXJnZXRQb3NpdGlvbiA9IG5ldyBQb3NpdGlvbihuZXdQYXJlbnRQb3NpdGlvbi5yb290LCBuZXdUYXJnZXRQYXRoKTtcbiAgICAgICAgICAgIGNvbnN0IG1vdmVPcCA9IG5ldyBNb3ZlT3BlcmF0aW9uKHNvdXJjZVBvc2l0aW9uLCBhLmhvd01hbnksIG5ld1RhcmdldFBvc2l0aW9uLCAwKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbW92ZU9wXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIGEuZ3JhdmV5YXJkUG9zaXRpb24gPSBhLmdyYXZleWFyZFBvc2l0aW9uLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZU9wZXJhdGlvbihiKTtcbiAgICB9XG4gICAgLy8gQ2FzZSAyOlxuICAgIC8vXG4gICAgLy8gU3BsaXQgaXMgYXQgYSBwb3NpdGlvbiB3aGVyZSBub2RlcyB3ZXJlIG1vdmVkLlxuICAgIC8vXG4gICAgLy8gVGhpcyBpcyBhIHNjZW5hcmlvIGRlc2NyaWJlZCBpbiBgTW92ZU9wZXJhdGlvbmAgeCBgU3BsaXRPcGVyYXRpb25gIHRyYW5zZm9ybWF0aW9uIGJ1dCBmcm9tIHRoZVxuICAgIC8vIFwic3BsaXQgb3BlcmF0aW9uIHBvaW50IG9mIHZpZXdcIi5cbiAgICAvL1xuICAgIGNvbnN0IHNwbGl0QXRUYXJnZXQgPSBhLnNwbGl0UG9zaXRpb24uaXNFcXVhbChiLnRhcmdldFBvc2l0aW9uKTtcbiAgICBpZiAoc3BsaXRBdFRhcmdldCAmJiAoY29udGV4dC5iYVJlbGF0aW9uID09ICdpbnNlcnRBdFNvdXJjZScgfHwgY29udGV4dC5hYlJlbGF0aW9uID09ICdzcGxpdEJlZm9yZScpKSB7XG4gICAgICAgIGEuaG93TWFueSArPSBiLmhvd01hbnk7XG4gICAgICAgIGEuc3BsaXRQb3NpdGlvbiA9IGEuc3BsaXRQb3NpdGlvbi5fZ2V0VHJhbnNmb3JtZWRCeURlbGV0aW9uKGIuc291cmNlUG9zaXRpb24sIGIuaG93TWFueSk7XG4gICAgICAgIGEuaW5zZXJ0aW9uUG9zaXRpb24gPSBTcGxpdE9wZXJhdGlvbi5nZXRJbnNlcnRpb25Qb3NpdGlvbihhLnNwbGl0UG9zaXRpb24pO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYVxuICAgICAgICBdO1xuICAgIH1cbiAgICBpZiAoc3BsaXRBdFRhcmdldCAmJiBjb250ZXh0LmFiUmVsYXRpb24gJiYgY29udGV4dC5hYlJlbGF0aW9uLmhvd01hbnkpIHtcbiAgICAgICAgY29uc3QgeyBob3dNYW55LCBvZmZzZXQgfSA9IGNvbnRleHQuYWJSZWxhdGlvbjtcbiAgICAgICAgYS5ob3dNYW55ICs9IGhvd01hbnk7XG4gICAgICAgIGEuc3BsaXRQb3NpdGlvbiA9IGEuc3BsaXRQb3NpdGlvbi5nZXRTaGlmdGVkQnkob2Zmc2V0KTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGFcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gQ2FzZSAzOlxuICAgIC8vXG4gICAgLy8gSWYgdGhlIHNwbGl0IHBvc2l0aW9uIGlzIGluc2lkZSB0aGUgbW92ZWQgcmFuZ2UsIHdlIG5lZWQgdG8gc2hpZnQgdGhlIHNwbGl0IHBvc2l0aW9uIHRvIGEgcHJvcGVyIHBsYWNlLlxuICAgIC8vIFRoZSBwb3NpdGlvbiBjYW5ub3QgYmUgbW92ZWQgdG9nZXRoZXIgd2l0aCBtb3ZlZCByYW5nZSBiZWNhdXNlIHRoYXQgd291bGQgcmVzdWx0IGluIHNwbGl0dGluZyBvZiBhbiBpbmNvcnJlY3QgZWxlbWVudC5cbiAgICAvL1xuICAgIC8vIENoYXJhY3RlcnMgYGJjYCBzaG91bGQgYmUgbW92ZWQgdG8gdGhlIHNlY29uZCBwYXJhZ3JhcGggd2hpbGUgc3BsaXQgcG9zaXRpb24gaXMgYmV0d2VlbiB0aGVtOlxuICAgIC8vIDxwYXJhZ3JhcGg+QVtifGNdZDwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+XG4gICAgLy9cbiAgICAvLyBBZnRlciBtb3ZlLCBuZXcgc3BsaXQgcG9zaXRpb24gaXMgaW5jb3JyZWN0OlxuICAgIC8vIDxwYXJhZ3JhcGg+QWQ8L3BhcmFncmFwaD48cGFyYWdyYXBoPlhifGN5ejwvcGFyYWdyYXBoPlxuICAgIC8vXG4gICAgLy8gQ29ycmVjdCBzcGxpdCBwb3NpdGlvbjpcbiAgICAvLyA8cGFyYWdyYXBoPkF8ZDwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WGJjeXo8L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIC8vIEFmdGVyIHNwbGl0OlxuICAgIC8vIDxwYXJhZ3JhcGg+QTwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+ZDwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WGJjeXo8L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIGlmIChhLnNwbGl0UG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGIuc291cmNlUG9zaXRpb24pICYmIHJhbmdlVG9Nb3ZlLmNvbnRhaW5zUG9zaXRpb24oYS5zcGxpdFBvc2l0aW9uKSkge1xuICAgICAgICBjb25zdCBob3dNYW55UmVtb3ZlZCA9IGIuaG93TWFueSAtIChhLnNwbGl0UG9zaXRpb24ub2Zmc2V0IC0gYi5zb3VyY2VQb3NpdGlvbi5vZmZzZXQpO1xuICAgICAgICBhLmhvd01hbnkgLT0gaG93TWFueVJlbW92ZWQ7XG4gICAgICAgIGlmIChhLnNwbGl0UG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGIudGFyZ2V0UG9zaXRpb24pICYmIGEuc3BsaXRQb3NpdGlvbi5vZmZzZXQgPCBiLnRhcmdldFBvc2l0aW9uLm9mZnNldCkge1xuICAgICAgICAgICAgYS5ob3dNYW55ICs9IGIuaG93TWFueTtcbiAgICAgICAgfVxuICAgICAgICBhLnNwbGl0UG9zaXRpb24gPSBiLnNvdXJjZVBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIGEuaW5zZXJ0aW9uUG9zaXRpb24gPSBTcGxpdE9wZXJhdGlvbi5nZXRJbnNlcnRpb25Qb3NpdGlvbihhLnNwbGl0UG9zaXRpb24pO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLyBUaGUgZGVmYXVsdCBjYXNlLlxuICAgIC8vIERvbid0IGNoYW5nZSBgaG93TWFueWAgaWYgbW92ZSBvcGVyYXRpb24gZG9lcyBub3QgcmVhbGx5IG1vdmUgYW55dGhpbmcuXG4gICAgLy9cbiAgICBpZiAoIWIuc291cmNlUG9zaXRpb24uaXNFcXVhbChiLnRhcmdldFBvc2l0aW9uKSkge1xuICAgICAgICBpZiAoYS5zcGxpdFBvc2l0aW9uLmhhc1NhbWVQYXJlbnRBcyhiLnNvdXJjZVBvc2l0aW9uKSAmJiBhLnNwbGl0UG9zaXRpb24ub2Zmc2V0IDw9IGIuc291cmNlUG9zaXRpb24ub2Zmc2V0KSB7XG4gICAgICAgICAgICBhLmhvd01hbnkgLT0gYi5ob3dNYW55O1xuICAgICAgICB9XG4gICAgICAgIGlmIChhLnNwbGl0UG9zaXRpb24uaGFzU2FtZVBhcmVudEFzKGIudGFyZ2V0UG9zaXRpb24pICYmIGEuc3BsaXRQb3NpdGlvbi5vZmZzZXQgPCBiLnRhcmdldFBvc2l0aW9uLm9mZnNldCkge1xuICAgICAgICAgICAgYS5ob3dNYW55ICs9IGIuaG93TWFueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBDaGFuZ2UgcG9zaXRpb24gc3RpY2tpbmVzcyB0byBmb3JjZSBhIGNvcnJlY3QgdHJhbnNmb3JtYXRpb24uXG4gICAgYS5zcGxpdFBvc2l0aW9uLnN0aWNraW5lc3MgPSAndG9Ob25lJztcbiAgICBhLnNwbGl0UG9zaXRpb24gPSBhLnNwbGl0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKGIpO1xuICAgIGEuc3BsaXRQb3NpdGlvbi5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgaWYgKGEuZ3JhdmV5YXJkUG9zaXRpb24pIHtcbiAgICAgICAgYS5pbnNlcnRpb25Qb3NpdGlvbiA9IGEuaW5zZXJ0aW9uUG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNb3ZlT3BlcmF0aW9uKGIpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGEuaW5zZXJ0aW9uUG9zaXRpb24gPSBTcGxpdE9wZXJhdGlvbi5nZXRJbnNlcnRpb25Qb3NpdGlvbihhLnNwbGl0UG9zaXRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuc2V0VHJhbnNmb3JtYXRpb24oU3BsaXRPcGVyYXRpb24sIFNwbGl0T3BlcmF0aW9uLCAoYSwgYiwgY29udGV4dCk9PntcbiAgICAvLyBDYXNlIDE6XG4gICAgLy9cbiAgICAvLyBTcGxpdCBhdCB0aGUgc2FtZSBwb3NpdGlvbi5cbiAgICAvL1xuICAgIC8vIElmIHRoZXJlIGFscmVhZHkgd2FzIGEgc3BsaXQgYXQgdGhlIHNhbWUgcG9zaXRpb24gYXMgaW4gYGFgIG9wZXJhdGlvbiwgaXQgbWVhbnMgdGhhdCB0aGUgaW50ZW50aW9uXG4gICAgLy8gY29udmV5ZWQgYnkgYGFgIG9wZXJhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGZ1bGZpbGxlZCBhbmQgYGFgIHNob3VsZCBub3QgZG8gYW55dGhpbmcgKHRvIGF2b2lkIGRvdWJsZSBzcGxpdCkuXG4gICAgLy9cbiAgICAvLyBIb3dldmVyLCB0aGVyZSBpcyBhIGRpZmZlcmVuY2UgaWYgdGhlc2UgYXJlIG5ldyBzcGxpdHMgb3Igc3BsaXRzIGNyZWF0ZWQgYnkgdW5kby4gVGhlc2UgaGF2ZSBkaWZmZXJlbnRcbiAgICAvLyBpbnRlbnRpb25zLiBBbHNvIHNwbGl0cyBtb3ZpbmcgYmFjayBkaWZmZXJlbnQgZWxlbWVudHMgZnJvbSBncmF2ZXlhcmQgaGF2ZSBkaWZmZXJlbnQgaW50ZW50aW9ucy4gVGhleVxuICAgIC8vIGFyZSBqdXN0IGRpZmZlcmVudCBvcGVyYXRpb25zLlxuICAgIC8vXG4gICAgLy8gU28gd2UgY2FuY2VsIHNwbGl0IG9wZXJhdGlvbiBvbmx5IGlmIGl0IHdhcyByZWFsbHkgaWRlbnRpY2FsLlxuICAgIC8vXG4gICAgLy8gQWxzbywgdGhlcmUgaXMgYWRkaXRpb25hbCBjYXNlLCB3aGVyZSBzcGxpdCBvcGVyYXRpb25zIGFyZW4ndCBpZGVudGljYWwgYW5kIHNob3VsZCBub3QgYmUgY2FuY2VsbGVkLCBob3dldmVyIHRoZVxuICAgIC8vIGRlZmF1bHQgdHJhbnNmb3JtYXRpb24gaXMgaW5jb3JyZWN0IHRvby5cbiAgICAvL1xuICAgIGlmIChhLnNwbGl0UG9zaXRpb24uaXNFcXVhbChiLnNwbGl0UG9zaXRpb24pKSB7XG4gICAgICAgIGlmICghYS5ncmF2ZXlhcmRQb3NpdGlvbiAmJiAhYi5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGEuZ3JhdmV5YXJkUG9zaXRpb24gJiYgYi5ncmF2ZXlhcmRQb3NpdGlvbiAmJiBhLmdyYXZleWFyZFBvc2l0aW9uLmlzRXF1YWwoYi5ncmF2ZXlhcmRQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgbmV3IE5vT3BlcmF0aW9uKDApXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzZSBjb250ZXh0IHRvIGtub3cgdGhhdCB0aGUgYGEuc3BsaXRQb3NpdGlvbmAgc2hvdWxkIHN0YXkgd2hlcmUgaXQgaXMuXG4gICAgICAgIC8vIFRoaXMgaGFwcGVucyBkdXJpbmcgdW5kbyB3aGVuIGZpcnN0IGEgbWVyZ2Ugb3BlcmF0aW9uIG1vdmVkIG5vZGVzIHRvIGBhLnNwbGl0UG9zaXRpb25gIGFuZCBub3cgYGJgIG9wZXJhdGlvbiB1bmRvZXMgdGhhdCBtZXJnZS5cbiAgICAgICAgaWYgKGNvbnRleHQuYWJSZWxhdGlvbiA9PSAnc3BsaXRCZWZvcmUnKSB7XG4gICAgICAgICAgICAvLyBTaW5jZSBzcGxpdCBpcyBhdCB0aGUgc2FtZSBwb3NpdGlvbiwgdGhlcmUgYXJlIG5vIG5vZGVzIGxlZnQgdG8gc3BsaXQuXG4gICAgICAgICAgICBhLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgLy8gTm90ZTogdGhlcmUgd2FzIGBpZiAoIGEuZ3JhdmV5YXJkUG9zaXRpb24gKWAgaGVyZSBidXQgaXQgd2FzIHVuY292ZXJlZCBpbiB0ZXN0cyBhbmQgSSBjb3VsZG4ndCBmaW5kIGFueSBzY2VuYXJpb3MgZm9yIG5vdy5cbiAgICAgICAgICAgIC8vIFRoYXQgd291bGQgaGF2ZSB0byBiZSBhIGBTcGxpdE9wZXJhdGlvbmAgdGhhdCBkaWRuJ3QgY29tZSBmcm9tIHVuZG8gYnV0IGlzIHRyYW5zZm9ybWVkIGJ5IG9wZXJhdGlvbnMgdGhhdCB3ZXJlIHVuZG9uZS5cbiAgICAgICAgICAgIC8vIEl0IGNvdWxkIGhhcHBlbiBpZiBgY29udGV4dGAgaXMgZW5hYmxlZCBpbiBjb2xsYWJvcmF0aW9uLlxuICAgICAgICAgICAgYS5ncmF2ZXlhcmRQb3NpdGlvbiA9IGEuZ3JhdmV5YXJkUG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgYVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBDYXNlIDI6XG4gICAgLy9cbiAgICAvLyBTYW1lIG5vZGUgaXMgdXNpbmcgdG8gc3BsaXQgZGlmZmVyZW50IGVsZW1lbnRzLiBUaGlzIGhhcHBlbnMgaW4gdW5kbyB3aGVuIHByZXZpb3VzbHkgc2FtZSBlbGVtZW50IHdhcyBtZXJnZWQgdG9cbiAgICAvLyB0d28gZGlmZmVyZW50IGVsZW1lbnRzLiBUaGlzIGlzIGRlc2NyaWJlZCBpbiBgTWVyZ2VPcGVyYXRpb25gIHggYE1lcmdlT3BlcmF0aW9uYCB0cmFuc2Zvcm1hdGlvbi5cbiAgICAvL1xuICAgIC8vIEluIHRoaXMgY2FzZSB3ZSB3aWxsIGZvbGxvdyB0aGUgc2FtZSBsb2dpYy4gV2Ugd2lsbCBhc3N1bWUgdGhhdCBgaW5zZXJ0aW9uUG9zaXRpb25gIGlzIHNhbWUgZm9yIGJvdGhcbiAgICAvLyBzcGxpdCBvcGVyYXRpb25zLiBUaGlzIG1pZ2h0IG5vdCBhbHdheXMgYmUgdHJ1ZSBidXQgaW4gdGhlIHJlYWwgY2FzZXMgdGhhdCB3ZXJlIGV4cGVyaWVuY2VkIGl0IHdhcy4gQWZ0ZXIgYWxsLFxuICAgIC8vIGlmIHRoZXNlIHNwbGl0cyBhcmUgcmV2ZXJzZXMgb2YgbWVyZ2Ugb3BlcmF0aW9ucyB0aGF0IHdlcmUgbWVyZ2luZyB0aGUgc2FtZSBlbGVtZW50LCB0aGVuIHRoZSBgaW5zZXJ0aW9uUG9zaXRpb25gXG4gICAgLy8gc2hvdWxkIGJlIHNhbWUgZm9yIGJvdGggb2YgdGhvc2Ugc3BsaXRzLlxuICAgIC8vXG4gICAgLy8gQWdhaW4sIHdlIHdpbGwgZGVjaWRlIHdoaWNoIG9wZXJhdGlvbiBpcyBzdHJvbmdlciBieSBjaGVja2luZyBpZiBzcGxpdCBoYXBwZW5zIGluIGdyYXZleWFyZCBvciBpbiBub24tZ3JhdmV5YXJkIHJvb3QuXG4gICAgLy9cbiAgICBpZiAoYS5ncmF2ZXlhcmRQb3NpdGlvbiAmJiBiLmdyYXZleWFyZFBvc2l0aW9uICYmIGEuZ3JhdmV5YXJkUG9zaXRpb24uaXNFcXVhbChiLmdyYXZleWFyZFBvc2l0aW9uKSkge1xuICAgICAgICBjb25zdCBhSW5HcmF2ZXlhcmQgPSBhLnNwbGl0UG9zaXRpb24ucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCc7XG4gICAgICAgIGNvbnN0IGJJbkdyYXZleWFyZCA9IGIuc3BsaXRQb3NpdGlvbi5yb290LnJvb3ROYW1lID09ICckZ3JhdmV5YXJkJztcbiAgICAgICAgLy8gSWYgYGFJc1dlYWtgIGl0IG1lYW5zIHRoYXQgYGFgIHBvaW50cyB0byBncmF2ZXlhcmQgd2hpbGUgYGJgIGRvZXNuJ3QuIERvbid0IG1vdmUgbm9kZXMgdGhlbi5cbiAgICAgICAgY29uc3QgYUlzV2VhayA9IGFJbkdyYXZleWFyZCAmJiAhYkluR3JhdmV5YXJkO1xuICAgICAgICAvLyBJZiBgYklzV2Vha2AgaXQgbWVhbnMgdGhhdCBgYmAgcG9pbnRzIHRvIGdyYXZleWFyZCB3aGlsZSBgYWAgZG9lc24ndC4gRm9yY2UgbW92aW5nIG5vZGVzIHRoZW4uXG4gICAgICAgIGNvbnN0IGJJc1dlYWsgPSBiSW5HcmF2ZXlhcmQgJiYgIWFJbkdyYXZleWFyZDtcbiAgICAgICAgLy8gRm9yY2UgbW92ZSBpZiBgYmAgaXMgd2VhayBvciBuZWl0aGVyIG9wZXJhdGlvbiBpcyB3ZWFrIGJ1dCBgYWAgaXMgc3Ryb25nZXIgdGhyb3VnaCBgY29udGV4dC5hSXNTdHJvbmdgLlxuICAgICAgICBjb25zdCBmb3JjZU1vdmUgPSBiSXNXZWFrIHx8ICFhSXNXZWFrICYmIGNvbnRleHQuYUlzU3Ryb25nO1xuICAgICAgICBpZiAoZm9yY2VNb3ZlKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIC8vIEZpcnN0IHdlIG5lZWQgdG8gbW92ZSBhbnkgbm9kZXMgc3BsaXQgYnkgYGJgIGJhY2sgdG8gd2hlcmUgdGhleSB3ZXJlLlxuICAgICAgICAgICAgLy8gRG8gaXQgb25seSBpZiBgYmAgYWN0dWFsbHkgbW92ZWQgc29tZXRoaW5nLlxuICAgICAgICAgICAgaWYgKGIuaG93TWFueSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ldyBNb3ZlT3BlcmF0aW9uKGIubW92ZVRhcmdldFBvc2l0aW9uLCBiLmhvd01hbnksIGIuc3BsaXRQb3NpdGlvbiwgMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlbiB3ZSBuZWVkIHRvIG1vdmUgbm9kZXMgZnJvbSBgYWAgc3BsaXQgcG9zaXRpb24gdG8gdGhlaXIgbmV3IGVsZW1lbnQuXG4gICAgICAgICAgICAvLyBEbyBpdCBvbmx5IGlmIGBhYCBhY3R1YWxseSBzaG91bGQgbW92ZSBzb21ldGhpbmcuXG4gICAgICAgICAgICBpZiAoYS5ob3dNYW55KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IE1vdmVPcGVyYXRpb24oYS5zcGxpdFBvc2l0aW9uLCBhLmhvd01hbnksIGEubW92ZVRhcmdldFBvc2l0aW9uLCAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgTm9PcGVyYXRpb24oMClcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGEuZ3JhdmV5YXJkUG9zaXRpb24pIHtcbiAgICAgICAgYS5ncmF2ZXlhcmRQb3NpdGlvbiA9IGEuZ3JhdmV5YXJkUG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICB9XG4gICAgLy8gQ2FzZSAzOlxuICAgIC8vXG4gICAgLy8gUG9zaXRpb24gd2hlcmUgb3BlcmF0aW9uIGBiYCBpbnNlcnRlZCBhIG5ldyBub2RlIGFmdGVyIHNwbGl0IGlzIHRoZSBzYW1lIGFzIHRoZSBvcGVyYXRpb24gYGFgIHNwbGl0IHBvc2l0aW9uLlxuICAgIC8vIEFzIGluIHNpbWlsYXIgY2FzZXMsIHRoZXJlIGlzIGFtYmlndWl0eSBpZiB0aGUgc3BsaXQgc2hvdWxkIGJlIGJlZm9yZSB0aGUgbmV3IG5vZGUgKGNyZWF0ZWQgYnkgYGJgKSBvciBhZnRlci5cbiAgICAvL1xuICAgIGlmIChhLnNwbGl0UG9zaXRpb24uaXNFcXVhbChiLmluc2VydGlvblBvc2l0aW9uKSAmJiBjb250ZXh0LmFiUmVsYXRpb24gPT0gJ3NwbGl0QmVmb3JlJykge1xuICAgICAgICBhLmhvd01hbnkrKztcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGFcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gQ2FzZSA0OlxuICAgIC8vXG4gICAgLy8gVGhpcyBpcyBhIG1pcnJvciB0byB0aGUgY2FzZSAyLiBhYm92ZS5cbiAgICAvL1xuICAgIGlmIChiLnNwbGl0UG9zaXRpb24uaXNFcXVhbChhLmluc2VydGlvblBvc2l0aW9uKSAmJiBjb250ZXh0LmJhUmVsYXRpb24gPT0gJ3NwbGl0QmVmb3JlJykge1xuICAgICAgICBjb25zdCBuZXdQb3NpdGlvblBhdGggPSBiLmluc2VydGlvblBvc2l0aW9uLnBhdGguc2xpY2UoKTtcbiAgICAgICAgbmV3UG9zaXRpb25QYXRoLnB1c2goMCk7XG4gICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gbmV3IFBvc2l0aW9uKGIuaW5zZXJ0aW9uUG9zaXRpb24ucm9vdCwgbmV3UG9zaXRpb25QYXRoKTtcbiAgICAgICAgY29uc3QgbW92ZU9wID0gbmV3IE1vdmVPcGVyYXRpb24oYS5pbnNlcnRpb25Qb3NpdGlvbiwgMSwgbmV3UG9zaXRpb24sIDApO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYSxcbiAgICAgICAgICAgIG1vdmVPcFxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLyBUaGUgZGVmYXVsdCBjYXNlLlxuICAgIC8vXG4gICAgaWYgKGEuc3BsaXRQb3NpdGlvbi5oYXNTYW1lUGFyZW50QXMoYi5zcGxpdFBvc2l0aW9uKSAmJiBhLnNwbGl0UG9zaXRpb24ub2Zmc2V0IDwgYi5zcGxpdFBvc2l0aW9uLm9mZnNldCkge1xuICAgICAgICBhLmhvd01hbnkgLT0gYi5ob3dNYW55O1xuICAgIH1cbiAgICBhLnNwbGl0UG9zaXRpb24gPSBhLnNwbGl0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlTcGxpdE9wZXJhdGlvbihiKTtcbiAgICBhLmluc2VydGlvblBvc2l0aW9uID0gU3BsaXRPcGVyYXRpb24uZ2V0SW5zZXJ0aW9uUG9zaXRpb24oYS5zcGxpdFBvc2l0aW9uKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBhXG4gICAgXTtcbn0pO1xuLyoqXG4gKiBDaGVja3Mgd2hldGhlciBgTW92ZU9wZXJhdGlvbmAgYHRhcmdldFBvc2l0aW9uYCBpcyBpbnNpZGUgYSBub2RlIGZyb20gdGhlIG1vdmVkIHJhbmdlIG9mIHRoZSBvdGhlciBgTW92ZU9wZXJhdGlvbmAuXG4gKi8gZnVuY3Rpb24gX21vdmVUYXJnZXRJbnRvTW92ZWRSYW5nZShhLCBiKSB7XG4gICAgcmV0dXJuIGEudGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlEZWxldGlvbihiLnNvdXJjZVBvc2l0aW9uLCBiLmhvd01hbnkpID09PSBudWxsO1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gZm9yIGBNb3ZlT3BlcmF0aW9uYCB4IGBNb3ZlT3BlcmF0aW9uYCB0cmFuc2Zvcm1hdGlvbi4gQ29udmVydHMgZ2l2ZW4gcmFuZ2VzIGFuZCB0YXJnZXQgcG9zaXRpb24gdG9cbiAqIG1vdmUgb3BlcmF0aW9ucyBhbmQgcmV0dXJucyB0aGVtLlxuICpcbiAqIFJhbmdlcyBhbmQgdGFyZ2V0IHBvc2l0aW9uIHdpbGwgYmUgdHJhbnNmb3JtZWQgb24tdGhlLWZseSB3aGVuIGdlbmVyYXRpbmcgb3BlcmF0aW9ucy5cbiAqXG4gKiBHaXZlbiBgcmFuZ2VzYCBzaG91bGQgYmUgaW4gdGhlIG9yZGVyIG9mIGhvdyB0aGV5IHdlcmUgaW4gdGhlIG9yaWdpbmFsIHRyYW5zZm9ybWVkIG9wZXJhdGlvbi5cbiAqXG4gKiBHaXZlbiBgdGFyZ2V0UG9zaXRpb25gIGlzIHRoZSB0YXJnZXQgcG9zaXRpb24gb2YgdGhlIGZpcnN0IHJhbmdlIGZyb20gYHJhbmdlc2AuXG4gKi8gZnVuY3Rpb24gX21ha2VNb3ZlT3BlcmF0aW9uc0Zyb21SYW5nZXMocmFuZ2VzLCB0YXJnZXRQb3NpdGlvbikge1xuICAgIC8vIEF0IHRoaXMgbW9tZW50IHdlIGhhdmUgc29tZSByYW5nZXMgYW5kIGEgdGFyZ2V0IHBvc2l0aW9uLCB0byB3aGljaCB0aG9zZSByYW5nZXMgc2hvdWxkIGJlIG1vdmVkLlxuICAgIC8vIE9yZGVyIGluIGByYW5nZXNgIGFycmF5IGlzIHRoZSBnby10byBvcmRlciBvZiBhZnRlciB0cmFuc2Zvcm1hdGlvbi5cbiAgICAvL1xuICAgIC8vIFdlIGFyZSBhbG1vc3QgZG9uZS4gV2UgaGF2ZSBgcmFuZ2VzYCBhbmQgYHRhcmdldFBvc2l0aW9uYCB0byBtYWtlIG9wZXJhdGlvbnMgZnJvbS5cbiAgICAvLyBVbmZvcnR1bmF0ZWx5LCB0aG9zZSBvcGVyYXRpb25zIG1heSBhZmZlY3QgZWFjaCBvdGhlci4gUHJlY2lzZWx5LCBmaXJzdCBvcGVyYXRpb24gYWZ0ZXIgbW92ZVxuICAgIC8vIG1heSBhZmZlY3Qgc291cmNlIHJhbmdlIGFuZCB0YXJnZXQgcG9zaXRpb24gb2Ygc2Vjb25kIGFuZCB0aGlyZCBvcGVyYXRpb24uIFNhbWUgd2l0aCBzZWNvbmRcbiAgICAvLyBvcGVyYXRpb24gYWZmZWN0aW5nIHRoaXJkLlxuICAgIC8vXG4gICAgLy8gV2UgbmVlZCB0byBmaXggdGhvc2Ugc291cmNlIHJhbmdlcyBhbmQgdGFyZ2V0IHBvc2l0aW9ucyBvbmNlIGFnYWluLCBiZWZvcmUgY29udmVydGluZyBgcmFuZ2VzYCB0byBvcGVyYXRpb25zLlxuICAgIGNvbnN0IG9wZXJhdGlvbnMgPSBbXTtcbiAgICAvLyBLZWVwIGluIG1pbmQgdGhhdCBub3RoaW5nIHdpbGwgYmUgdHJhbnNmb3JtZWQgaWYgdGhlcmUgaXMganVzdCBvbmUgcmFuZ2UgaW4gYHJhbmdlc2AuXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIC8vIENyZWF0ZSBuZXcgb3BlcmF0aW9uIG91dCBvZiBhIHJhbmdlIGFuZCB0YXJnZXQgcG9zaXRpb24uXG4gICAgICAgIGNvbnN0IHJhbmdlID0gcmFuZ2VzW2ldO1xuICAgICAgICBjb25zdCBvcCA9IG5ldyBNb3ZlT3BlcmF0aW9uKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQub2Zmc2V0IC0gcmFuZ2Uuc3RhcnQub2Zmc2V0LCB0YXJnZXRQb3NpdGlvbiwgMCk7XG4gICAgICAgIG9wZXJhdGlvbnMucHVzaChvcCk7XG4gICAgICAgIC8vIFRyYW5zZm9ybSBvdGhlciByYW5nZXMgYnkgdGhlIGdlbmVyYXRlZCBvcGVyYXRpb24uXG4gICAgICAgIGZvcihsZXQgaiA9IGkgKyAxOyBqIDwgcmFuZ2VzLmxlbmd0aDsgaisrKXtcbiAgICAgICAgICAgIC8vIEFsbCByYW5nZXMgaW4gYHJhbmdlc2AgYXJyYXkgc2hvdWxkIGJlOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICogbm9uLWludGVyc2VjdGluZyAodGhlc2UgYXJlIHBhcnQgb2Ygb3JpZ2luYWwgb3BlcmF0aW9uIHNvdXJjZSByYW5nZSksIGFuZFxuICAgICAgICAgICAgLy8gKiBgdGFyZ2V0UG9zaXRpb25gIGRvZXMgbm90IHRhcmdldCBpbnRvIHRoZW0gKG9wcG9zaXRlIHdvdWxkIG1lYW4gdGhhdCB0cmFuc2Zvcm1lZCBvcGVyYXRpb24gdGFyZ2V0cyBcImluc2lkZSBpdHNlbGZcIikuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGF0IHRoZSB0cmFuc2Zvcm1hdGlvbiB3aWxsIGJlIFwiY2xlYW5cIiBhbmQgYWx3YXlzIHJldHVybiBvbmUgcmVzdWx0LlxuICAgICAgICAgICAgcmFuZ2VzW2pdID0gcmFuZ2VzW2pdLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShvcC5zb3VyY2VQb3NpdGlvbiwgb3AudGFyZ2V0UG9zaXRpb24sIG9wLmhvd01hbnkpWzBdO1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldFBvc2l0aW9uID0gdGFyZ2V0UG9zaXRpb24uX2dldFRyYW5zZm9ybWVkQnlNb3ZlKG9wLnNvdXJjZVBvc2l0aW9uLCBvcC50YXJnZXRQb3NpdGlvbiwgb3AuaG93TWFueSk7XG4gICAgfVxuICAgIHJldHVybiBvcGVyYXRpb25zO1xufVxuXG4vKipcbiAqIGBMaXZlUG9zaXRpb25gIGlzIGEgdHlwZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBQb3NpdGlvbn1cbiAqIHRoYXQgdXBkYXRlcyBpdHNlbGYgYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQgZG9jdW1lbnR9XG4gKiBpcyBjaGFuZ2VkIHRocm91Z2ggb3BlcmF0aW9ucy4gSXQgbWF5IGJlIHVzZWQgYXMgYSBib29rbWFyay5cbiAqXG4gKiAqKk5vdGU6KiogQ29udHJhcnkgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb259LCBgTGl2ZVBvc2l0aW9uYCB3b3JrcyBvbmx5IGluIHJvb3RzIHRoYXQgYXJlXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yb290ZWxlbWVudH5Sb290RWxlbWVudH0uXG4gKiBJZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9IGlzIHBhc3NlZCwgZXJyb3Igd2lsbCBiZSB0aHJvd24uXG4gKlxuICogKipOb3RlOioqIEJlIHZlcnkgY2FyZWZ1bCB3aGVuIGRlYWxpbmcgd2l0aCBgTGl2ZVBvc2l0aW9uYC4gRWFjaCBgTGl2ZVBvc2l0aW9uYCBpbnN0YW5jZSBiaW5kIGV2ZW50cyB0aGF0IG1pZ2h0XG4gKiBoYXZlIHRvIGJlIHVuYm91bmQuXG4gKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbGl2ZXBvc2l0aW9ufkxpdmVQb3NpdGlvbiNkZXRhY2h9IHdoZW5ldmVyIHlvdSBkb24ndCBuZWVkIGBMaXZlUG9zaXRpb25gIGFueW1vcmUuXG4gKi8gY2xhc3MgTGl2ZVBvc2l0aW9uIGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbihQb3NpdGlvbikge1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbGl2ZSBwb3NpdGlvbi5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uXG5cdCAqLyBjb25zdHJ1Y3Rvcihyb290LCBwYXRoLCBzdGlja2luZXNzID0gJ3RvTm9uZScpe1xuICAgICAgICBzdXBlcihyb290LCBwYXRoLCBzdGlja2luZXNzKTtcbiAgICAgICAgaWYgKCF0aGlzLnJvb3QuaXMoJ3Jvb3RFbGVtZW50JykpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogTGl2ZVBvc2l0aW9uJ3Mgcm9vdCBoYXMgdG8gYmUgYW4gaW5zdGFuY2Ugb2YgUm9vdEVsZW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1vZGVsLWxpdmVwb3NpdGlvbi1yb290LW5vdC1yb290ZWxlbWVudFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1saXZlcG9zaXRpb24tcm9vdC1ub3Qtcm9vdGVsZW1lbnQnLCByb290KTtcbiAgICAgICAgfVxuICAgICAgICBiaW5kV2l0aERvY3VtZW50LmNhbGwodGhpcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbmJpbmRzIGFsbCBldmVudHMgcHJldmlvdXNseSBib3VuZCBieSBgTGl2ZVBvc2l0aW9uYC4gVXNlIGl0IHdoZW5ldmVyIHlvdSBkb24ndCBuZWVkIGBMaXZlUG9zaXRpb25gIGluc3RhbmNlXG5cdCAqIGFueW1vcmUgKGkuZS4gd2hlbiBsZWF2aW5nIHNjb3BlIGluIHdoaWNoIGl0IHdhcyBkZWNsYXJlZCBvciBiZWZvcmUgcmUtYXNzaWduaW5nIHZhcmlhYmxlIHRoYXQgd2FzXG5cdCAqIHJlZmVycmluZyB0byBpdCkuXG5cdCAqLyBkZXRhY2goKSB7XG4gICAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9uIGluc3RhbmNlfSwgd2hpY2ggaXMgZXF1YWwgdG8gdGhpcyBsaXZlIHBvc2l0aW9uLlxuXHQgKi8gdG9Qb3NpdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbih0aGlzLnJvb3QsIHRoaXMucGF0aC5zbGljZSgpLCB0aGlzLnN0aWNraW5lc3MpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIGBMaXZlUG9zaXRpb25gIGluc3RhbmNlIHRoYXQgaXMgZXF1YWwgdG8gcG9zaXRpb24uXG5cdCAqLyBzdGF0aWMgZnJvbVBvc2l0aW9uKHBvc2l0aW9uLCBzdGlja2luZXNzKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcyhwb3NpdGlvbi5yb290LCBwb3NpdGlvbi5wYXRoLnNsaWNlKCksIHN0aWNraW5lc3MgPyBzdGlja2luZXNzIDogcG9zaXRpb24uc3RpY2tpbmVzcyk7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuTGl2ZVBvc2l0aW9uLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ2xpdmVQb3NpdGlvbicgfHwgdHlwZSA9PT0gJ21vZGVsOmxpdmVQb3NpdGlvbicgfHwgLy8gRnJvbSBzdXBlci5pcygpLiBUaGlzIGlzIGhpZ2hseSB1dGlsaXNlZCBtZXRob2QgYW5kIGNhbm5vdCBjYWxsIHN1cGVyLiBTZWUgY2tlZGl0b3IvY2tlZGl0b3I1IzY1MjkuXG4gICAgdHlwZSA9PSAncG9zaXRpb24nIHx8IHR5cGUgPT09ICdtb2RlbDpwb3NpdGlvbic7XG59O1xuLyoqXG4gKiBCaW5kcyB0aGlzIGBMaXZlUG9zaXRpb25gIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH0gdGhhdCBvd25zXG4gKiB0aGlzIHBvc2l0aW9uJ3Mge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcG9zaXRpb25+UG9zaXRpb24jcm9vdCByb290fS5cbiAqLyBmdW5jdGlvbiBiaW5kV2l0aERvY3VtZW50KCkge1xuICAgIHRoaXMubGlzdGVuVG8odGhpcy5yb290LmRvY3VtZW50Lm1vZGVsLCAnYXBwbHlPcGVyYXRpb24nLCAoZXZlbnQsIGFyZ3MpPT57XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGFyZ3NbMF07XG4gICAgICAgIGlmICghb3BlcmF0aW9uLmlzRG9jdW1lbnRPcGVyYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cmFuc2Zvcm0uY2FsbCh0aGlzLCBvcGVyYXRpb24pO1xuICAgIH0sIHtcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgfSk7XG59XG4vKipcbiAqIFVwZGF0ZXMgdGhpcyBwb3NpdGlvbiBhY2NvcmRpbmdseSB0byB0aGUgdXBkYXRlcyBhcHBsaWVkIHRvIHRoZSBtb2RlbC4gQmFzZXMgb24gY2hhbmdlIGV2ZW50cy5cbiAqLyBmdW5jdGlvbiB0cmFuc2Zvcm0ob3BlcmF0aW9uKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5nZXRUcmFuc2Zvcm1lZEJ5T3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgaWYgKCF0aGlzLmlzRXF1YWwocmVzdWx0KSkge1xuICAgICAgICBjb25zdCBvbGRQb3NpdGlvbiA9IHRoaXMudG9Qb3NpdGlvbigpO1xuICAgICAgICB0aGlzLnBhdGggPSByZXN1bHQucGF0aDtcbiAgICAgICAgdGhpcy5yb290ID0gcmVzdWx0LnJvb3Q7XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJywgb2xkUG9zaXRpb24pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGJhdGNoIGluc3RhbmNlIGdyb3VwcyBtb2RlbCBjaGFuZ2VzICh7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9vcGVyYXRpb24vb3BlcmF0aW9ufk9wZXJhdGlvbiBvcGVyYXRpb25zfSkuIEFsbCBvcGVyYXRpb25zXG4gKiBncm91cGVkIGluIGEgc2luZ2xlIGJhdGNoIGNhbiBiZSByZXZlcnRlZCB0b2dldGhlciwgc28geW91IGNhbiBhbHNvIHRoaW5rIGFib3V0IGEgYmF0Y2ggYXMgb2YgYSBzaW5nbGUgdW5kbyBzdGVwLiBJZiB5b3Ugd2FudFxuICogdG8gZXh0ZW5kIGEgZ2l2ZW4gdW5kbyBzdGVwLCB5b3UgY2FuIGFkZCBtb3JlIGNoYW5nZXMgdG8gdGhlIGJhdGNoIHVzaW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2VucXVldWVDaGFuZ2V9OlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbC5lbnF1ZXVlQ2hhbmdlKCBiYXRjaCwgd3JpdGVyID0+IHtcbiAqIFx0d3JpdGVyLmluc2VydFRleHQoICdmb28nLCBwYXJhZ3JhcGgsICdlbmQnICk7XG4gKiB9ICk7XG4gKiBgYGBcbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZW5xdWV1ZUNoYW5nZVxuICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2NoYW5nZVxuICovIGNsYXNzIEJhdGNoIHtcbiAgICAvKipcblx0ICogQW4gYXJyYXkgb2Ygb3BlcmF0aW9ucyB0aGF0IGNvbXBvc2UgdGhpcyBiYXRjaC5cblx0ICovIG9wZXJhdGlvbnM7XG4gICAgLyoqXG5cdCAqIFdoZXRoZXIgdGhlIGJhdGNoIGNhbiBiZSB1bmRvbmUgdGhyb3VnaCB0aGUgdW5kbyBmZWF0dXJlLlxuXHQgKi8gaXNVbmRvYWJsZTtcbiAgICAvKipcblx0ICogV2hldGhlciB0aGUgYmF0Y2ggaW5jbHVkZXMgb3BlcmF0aW9ucyBjcmVhdGVkIGxvY2FsbHkgKGB0cnVlYCkgb3Igb3BlcmF0aW9ucyBjcmVhdGVkIG9uIG90aGVyLCByZW1vdGUgZWRpdG9ycyAoYGZhbHNlYCkuXG5cdCAqLyBpc0xvY2FsO1xuICAgIC8qKlxuXHQgKiBXaGV0aGVyIHRoZSBiYXRjaCB3YXMgY3JlYXRlZCBieSB0aGUgdW5kbyBmZWF0dXJlIGFuZCB1bmRvZXMgb3RoZXIgb3BlcmF0aW9ucy5cblx0ICovIGlzVW5kbztcbiAgICAvKipcblx0ICogV2hldGhlciB0aGUgYmF0Y2ggaW5jbHVkZXMgb3BlcmF0aW9ucyBjb25uZWN0ZWQgd2l0aCB0eXBpbmcuXG5cdCAqLyBpc1R5cGluZztcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIGJhdGNoIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZW5xdWV1ZUNoYW5nZVxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlXG5cdCAqIEBwYXJhbSB0eXBlIEEgc2V0IG9mIGZsYWdzIHRoYXQgc3BlY2lmeSB0aGUgdHlwZSBvZiB0aGUgYmF0Y2guIEJhdGNoIHR5cGUgY2FuIGFsdGVyIGhvdyBzb21lIG9mIHRoZSBmZWF0dXJlcyB3b3JrXG5cdCAqIHdoZW4gZW5jb3VudGVyaW5nIGEgZ2l2ZW4gYEJhdGNoYCBpbnN0YW5jZSAoZm9yIGV4YW1wbGUsIHdoZW4gYSBmZWF0dXJlIGxpc3RlbnMgdG8gYXBwbGllZCBvcGVyYXRpb25zKS5cblx0ICovIGNvbnN0cnVjdG9yKHR5cGUgPSB7fSl7XG4gICAgICAgIGlmICh0eXBlb2YgdHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHR5cGUgPSB0eXBlID09PSAndHJhbnNwYXJlbnQnID8ge1xuICAgICAgICAgICAgICAgIGlzVW5kb2FibGU6IGZhbHNlXG4gICAgICAgICAgICB9IDoge307XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBzdHJpbmcgdmFsdWUgZm9yIGEgYHR5cGVgIHByb3BlcnR5IG9mIHRoZSBgQmF0Y2hgIGNvbnN0cnVjdG9yIGhhcyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmVhciBmdXR1cmUuXG5cdFx0XHQgKiBQbGVhc2UgcmVmZXIgdG8gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNoI2NvbnN0cnVjdG9yIGBCYXRjaGAgY29uc3RydWN0b3IgQVBJIGRvY3VtZW50YXRpb259IGZvciBtb3JlXG5cdFx0XHQgKiBpbmZvcm1hdGlvbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgYmF0Y2gtY29uc3RydWN0b3ItZGVwcmVjYXRlZC1zdHJpbmctdHlwZVxuXHRcdFx0ICovIGxvZ1dhcm5pbmcoJ2JhdGNoLWNvbnN0cnVjdG9yLWRlcHJlY2F0ZWQtc3RyaW5nLXR5cGUnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGlzVW5kb2FibGUgPSB0cnVlLCBpc0xvY2FsID0gdHJ1ZSwgaXNVbmRvID0gZmFsc2UsIGlzVHlwaW5nID0gZmFsc2UgfSA9IHR5cGU7XG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFtdO1xuICAgICAgICB0aGlzLmlzVW5kb2FibGUgPSBpc1VuZG9hYmxlO1xuICAgICAgICB0aGlzLmlzTG9jYWwgPSBpc0xvY2FsO1xuICAgICAgICB0aGlzLmlzVW5kbyA9IGlzVW5kbztcbiAgICAgICAgdGhpcy5pc1R5cGluZyA9IGlzVHlwaW5nO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIHR5cGUgb2YgdGhlIGJhdGNoLlxuXHQgKlxuXHQgKiAqKlRoaXMgcHJvcGVydHkgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgaXMgYWx3YXlzIHNldCB0byB0aGUgYCdkZWZhdWx0J2AgdmFsdWUuKipcblx0ICpcblx0ICogSXQgY2FuIGJlIG9uZSBvZiB0aGUgZm9sbG93aW5nIHZhbHVlczpcblx0ICogKiBgJ2RlZmF1bHQnYCAmbmRhc2g7IEFsbCBcIm5vcm1hbFwiIGJhdGNoZXMuIFRoaXMgaXMgdGhlIG1vc3QgY29tbW9ubHkgdXNlZCB0eXBlLlxuXHQgKiAqIGAndHJhbnNwYXJlbnQnYCAmbmRhc2g7IEEgYmF0Y2ggdGhhdCBzaG91bGQgYmUgaWdub3JlZCBieSBvdGhlciBmZWF0dXJlcywgaS5lLiBhbiBpbml0aWFsIGJhdGNoIG9yIGNvbGxhYm9yYXRpdmUgZWRpdGluZ1xuXHQgKiBjaGFuZ2VzLlxuXHQgKlxuXHQgKiBAZGVwcmVjYXRlZFxuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIC8qKlxuXHRcdCAqIFRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9iYXRjaH5CYXRjaCN0eXBlIGBCYXRjaCN0eXBlYCB9IHByb3BlcnR5IGhhcyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgbmVhclxuXHRcdCAqIGZ1dHVyZS4gVXNlIGBCYXRjaCNpc0xvY2FsYCwgYEJhdGNoI2lzVW5kb2FibGVgLCBgQmF0Y2gjaXNVbmRvYCBhbmQgYEJhdGNoI2lzVHlwaW5nYCBpbnN0ZWFkLlxuXHRcdCAqXG5cdFx0ICogQGVycm9yIGJhdGNoLXR5cGUtZGVwcmVjYXRlZFxuXHRcdCAqLyBsb2dXYXJuaW5nKCdiYXRjaC10eXBlLWRlcHJlY2F0ZWQnKTtcbiAgICAgICAgcmV0dXJuICdkZWZhdWx0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIGJhc2UgdmVyc2lvbiBvZiB0aGlzIGJhdGNoLCB3aGljaCBpcyBlcXVhbCB0byB0aGUgYmFzZSB2ZXJzaW9uIG9mIHRoZSBmaXJzdCBvcGVyYXRpb24gaW4gdGhlIGJhdGNoLlxuXHQgKiBJZiB0aGVyZSBhcmUgbm8gb3BlcmF0aW9ucyBpbiB0aGUgYmF0Y2ggb3IgbmVpdGhlciBvcGVyYXRpb24gaGFzIHRoZSBiYXNlIHZlcnNpb24gc2V0LCBpdCByZXR1cm5zIGBudWxsYC5cblx0ICovIGdldCBiYXNlVmVyc2lvbigpIHtcbiAgICAgICAgZm9yIChjb25zdCBvcCBvZiB0aGlzLm9wZXJhdGlvbnMpe1xuICAgICAgICAgICAgaWYgKG9wLmJhc2VWZXJzaW9uICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9wLmJhc2VWZXJzaW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBhbiBvcGVyYXRpb24gdG8gdGhlIGJhdGNoIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3BlcmF0aW9uIEFuIG9wZXJhdGlvbiB0byBhZGQuXG5cdCAqIEByZXR1cm5zIFRoZSBhZGRlZCBvcGVyYXRpb24uXG5cdCAqLyBhZGRPcGVyYXRpb24ob3BlcmF0aW9uKSB7XG4gICAgICAgIGlmIChvcGVyYXRpb24uaXNEb2N1bWVudE9wZXJhdGlvbikge1xuICAgICAgICAgICAgLy8gU3RvcmUgb25seSBkb2N1bWVudCBvcGVyYXRpb25zIGluIHRoZSBiYXRjaC5cbiAgICAgICAgICAgIC8vIE5vbi1kb2N1bWVudCBvcGVyYXRpb25zIGFyZSB0ZW1wb3JhcnkgYW5kIHNob3VsZCBiZSBkaXNjYXJkZWQgYWZ0ZXIgdGhleSBhcmUgYXBwbGllZC5cbiAgICAgICAgICAgIG9wZXJhdGlvbi5iYXRjaCA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLm9wZXJhdGlvbnMucHVzaChvcGVyYXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcGVyYXRpb247XG4gICAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0d28gbW9kZWwgc3RhdGVzLlxuICpcbiAqIFJlY2VpdmVzIG9wZXJhdGlvbnMgdGhhdCBhcmUgdG8gYmUgYXBwbGllZCBvbiB0aGUgbW9kZWwgZG9jdW1lbnQuIE1hcmtzIHBhcnRzIG9mIHRoZSBtb2RlbCBkb2N1bWVudCB0cmVlIHdoaWNoXG4gKiBhcmUgY2hhbmdlZCBhbmQgc2F2ZXMgdGhlIHN0YXRlIG9mIHRoZXNlIGVsZW1lbnRzIGJlZm9yZSB0aGUgY2hhbmdlLiBUaGVuLCBpdCBjb21wYXJlcyBzYXZlZCBlbGVtZW50cyB3aXRoIHRoZVxuICogY2hhbmdlZCBlbGVtZW50cywgYWZ0ZXIgYWxsIGNoYW5nZXMgYXJlIGFwcGxpZWQgb24gdGhlIG1vZGVsIGRvY3VtZW50LiBDYWxjdWxhdGVzIHRoZSBkaWZmIGJldHdlZW4gc2F2ZWRcbiAqIGVsZW1lbnRzIGFuZCBuZXcgb25lcyBhbmQgcmV0dXJucyBhIGNoYW5nZSBzZXQuXG4gKi8gY2xhc3MgRGlmZmVyIHtcbiAgICAvKipcblx0ICogUHJpb3JpdHkgb2YgdGhlIHtAbGluayB+RGlmZmVyI19lbGVtZW50U3RhdGUgZWxlbWVudCBzdGF0ZXN9LiBTdGF0ZXMgb24gaGlnaGVyIGluZGV4ZXMgb2YgdGhlIGFycmF5IGNhbiBvdmVyd3JpdGUgc3RhdGVzIG9uIHRoZSBsb3dlclxuXHQgKiBpbmRleGVzLlxuXHQgKi8gc3RhdGljIF9zdGF0ZXNQcmlvcml0eSA9IFtcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAncmVmcmVzaCcsXG4gICAgICAgICdyZW5hbWUnLFxuICAgICAgICAnbW92ZSdcbiAgICBdO1xuICAgIC8qKlxuXHQgKiBSZWZlcmVuY2UgdG8gdGhlIG1vZGVsJ3MgbWFya2VyIGNvbGxlY3Rpb24uXG5cdCAqLyBfbWFya2VyQ29sbGVjdGlvbjtcbiAgICAvKipcblx0ICogQSBtYXAgdGhhdCBzdG9yZXMgY2hhbmdlcyB0aGF0IGhhcHBlbmVkIGluIGEgZ2l2ZW4gZWxlbWVudC5cblx0ICpcblx0ICogVGhlIGtleXMgb2YgdGhlIG1hcCBhcmUgcmVmZXJlbmNlcyB0byB0aGUgbW9kZWwgZWxlbWVudHMuXG5cdCAqIFRoZSB2YWx1ZXMgb2YgdGhlIG1hcCBhcmUgYXJyYXlzIHdpdGggY2hhbmdlcyB0aGF0IHdlcmUgZG9uZSBvbiB0aGlzIGVsZW1lbnQuXG5cdCAqLyBfY2hhbmdlc0luRWxlbWVudCA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogU3RvcmVzIGEgc25hcHNob3QgZm9yIHRoZXNlIG1vZGVsIG5vZGVzIHRoYXQgbWlnaHQgaGF2ZSBjaGFuZ2VkLlxuXHQgKlxuXHQgKiBUaGlzIGNvbXBsZW1lbnRzIHtAbGluayB+RGlmZmVyI19lbGVtZW50Q2hpbGRyZW5TbmFwc2hvdHMgYF9lbGVtZW50Q2hpbGRyZW5TbmFwc2hvdHNgfS5cblx0ICpcblx0ICogU2VlIGFsc28ge0BsaW5rIH5EaWZmZXJTbmFwc2hvdH0uXG5cdCAqLyBfZWxlbWVudHNTbmFwc2hvdHMgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIEZvciBlYWNoIGVsZW1lbnQgb3IgZG9jdW1lbnQgZnJhZ21lbnQgaW5zaWRlIHdoaWNoIHRoZXJlIHdhcyBhIGNoYW5nZSwgaXQgc3RvcmVzIGEgc25hcHNob3Qgb2YgdGhlIGNoaWxkIG5vZGVzIGxpc3QgKGFuIGFycmF5XG5cdCAqIG9mIGNoaWxkcmVuIHNuYXBzaG90cyB0aGF0IHJlcHJlc2VudCB0aGUgc3RhdGUgaW4gdGhlIGVsZW1lbnQgLyBmcmFnbWVudCBiZWZvcmUgYW55IGNoYW5nZSBoYXMgaGFwcGVuZWQpLlxuXHQgKlxuXHQgKiBUaGlzIGNvbXBsZW1lbnRzIHtAbGluayB+RGlmZmVyI19lbGVtZW50c1NuYXBzaG90cyBgX2VsZW1lbnRzU25hcHNob3RzYH0uXG5cdCAqXG5cdCAqIFNlZSBhbHNvIHtAbGluayB+RGlmZmVyU25hcHNob3R9LlxuXHQgKi8gX2VsZW1lbnRDaGlsZHJlblNuYXBzaG90cyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogS2VlcHMgdGhlIHN0YXRlIGZvciBhIGdpdmVuIGVsZW1lbnQsIGRlc2NyaWJpbmcgaG93IHRoZSBlbGVtZW50IHdhcyBjaGFuZ2VkIHNvIGZhci4gSXQgaXMgdXNlZCB0byBldmFsdWF0ZSB0aGUgYGFjdGlvbmAgcHJvcGVydHlcblx0ICogb2YgZGlmZiBpdGVtcyByZXR1cm5lZCBieSB7QGxpbmsgfkRpZmZlciNnZXRDaGFuZ2VzfS5cblx0ICpcblx0ICogUG9zc2libGUgdmFsdWVzLCBpbiB0aGUgb3JkZXIgZnJvbSB0aGUgbG93ZXN0IHByaW9yaXR5IHRvIHRoZSBoaWdoZXN0IHByaW9yaXR5OlxuXHQgKlxuXHQgKiAqIGAncmVmcmVzaCdgIC0gZWxlbWVudCB3YXMgcmVmcmVzaGVkLFxuXHQgKiAqIGAncmVuYW1lJ2AgLSBlbGVtZW50IHdhcyByZW5hbWVkLFxuXHQgKiAqIGAnbW92ZSdgIC0gZWxlbWVudCB3YXMgbW92ZWQgKG9yLCB1c3VhbGx5LCByZW1vdmVkLCB0aGF0IGlzIG1vdmVkIHRvIHRoZSBncmF2ZXlhcmQpLlxuXHQgKlxuXHQgKiBFbGVtZW50IHRoYXQgd2FzIHJlZnJlc2hlZCwgbWF5IGNoYW5nZSBpdHMgc3RhdGUgdG8gYCdyZW5hbWUnYCBpZiBpdCB3YXMgbGF0ZXIgcmVuYW1lZCwgb3IgdG8gYCdtb3ZlJ2AgaWYgaXQgd2FzIHJlbW92ZWQuXG5cdCAqIEJ1dCB0aGUgZWxlbWVudCBjYW5ub3QgY2hhbmdlIGl0cyBzdGF0ZSBmcm9tIGAnbW92ZSdgIHRvIGAncmVuYW1lJ2AsIG9yIGZyb20gYCdyZW5hbWUnYCB0byBgJ3JlZnJlc2gnYC5cblx0ICpcblx0ICogT25seSBhbHJlYWR5IGV4aXN0aW5nIGVsZW1lbnRzIGFyZSByZWdpc3RlcmVkIGluIGBfZWxlbWVudFN0YXRlYC4gSWYgYSBuZXcgZWxlbWVudCB3YXMgaW5zZXJ0ZWQgYXMgYSByZXN1bHQgb2YgYSBidWZmZXJlZCBvcGVyYXRpb24sXG5cdCAqIGl0IGlzIG5vdCBiZSByZWdpc3RlcmVkIGluIGBfZWxlbWVudFN0YXRlYC5cblx0ICovIF9lbGVtZW50U3RhdGUgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIEEgbWFwIHRoYXQgc3RvcmVzIGFsbCBjaGFuZ2VkIG1hcmtlcnMuXG5cdCAqXG5cdCAqIFRoZSBrZXlzIG9mIHRoZSBtYXAgYXJlIG1hcmtlciBuYW1lcy5cblx0ICpcblx0ICogVGhlIHZhbHVlcyBvZiB0aGUgbWFwIGFyZSBvYmplY3RzIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOlxuXHQgKlxuXHQgKiAqIGBvbGRNYXJrZXJEYXRhYCxcblx0ICogKiBgbmV3TWFya2VyRGF0YWAuXG5cdCAqLyBfY2hhbmdlZE1hcmtlcnMgPSBuZXcgTWFwKCk7XG4gICAgLyoqXG5cdCAqIEEgbWFwIHRoYXQgc3RvcmVzIGFsbCByb290cyB0aGF0IGhhdmUgYmVlbiBjaGFuZ2VkLlxuXHQgKlxuXHQgKiBUaGUga2V5cyBhcmUgdGhlIG5hbWVzIG9mIHRoZSByb290cyB3aGlsZSB2YWx1ZSByZXByZXNlbnRzIHRoZSBjaGFuZ2VzLlxuXHQgKi8gX2NoYW5nZWRSb290cyA9IG5ldyBNYXAoKTtcbiAgICAvKipcblx0ICogU3RvcmVzIHRoZSBudW1iZXIgb2YgY2hhbmdlcyB0aGF0IHdlcmUgcHJvY2Vzc2VkLiBVc2VkIHRvIG9yZGVyIHRoZSBjaGFuZ2VzIGNocm9ub2xvZ2ljYWxseS4gSXQgaXMgaW1wb3J0YW50XG5cdCAqIHdoZW4gY2hhbmdlcyBhcmUgc29ydGVkLlxuXHQgKi8gX2NoYW5nZUNvdW50ID0gMDtcbiAgICAvKipcblx0ICogRm9yIGVmZmljaWVuY3kgcHVycG9zZXMsIGBEaWZmZXJgIHN0b3JlcyB0aGUgY2hhbmdlIHNldCByZXR1cm5lZCBieSB0aGUgZGlmZmVyIGFmdGVyIHtAbGluayAjZ2V0Q2hhbmdlc30gY2FsbC5cblx0ICogQ2FjaGUgaXMgcmVzZXQgZWFjaCB0aW1lIGEgbmV3IG9wZXJhdGlvbiBpcyBidWZmZXJlZC4gSWYgdGhlIGNhY2hlIGhhcyBub3QgYmVlbiByZXNldCwge0BsaW5rICNnZXRDaGFuZ2VzfSB3aWxsXG5cdCAqIHJldHVybiB0aGUgY2FjaGVkIHZhbHVlIGluc3RlYWQgb2YgY2FsY3VsYXRpbmcgaXQgYWdhaW4uXG5cdCAqXG5cdCAqIFRoaXMgcHJvcGVydHkgc3RvcmVzIHRob3NlIGNoYW5nZXMgdGhhdCBkaWQgbm90IHRha2UgcGxhY2UgaW4gZ3JhdmV5YXJkIHJvb3QuXG5cdCAqLyBfY2FjaGVkQ2hhbmdlcyA9IG51bGw7XG4gICAgLyoqXG5cdCAqIEZvciBlZmZpY2llbmN5IHB1cnBvc2VzLCBgRGlmZmVyYCBzdG9yZXMgdGhlIGNoYW5nZSBzZXQgcmV0dXJuZWQgYnkgdGhlIGRpZmZlciBhZnRlciB0aGUge0BsaW5rICNnZXRDaGFuZ2VzfSBjYWxsLlxuXHQgKiBUaGUgY2FjaGUgaXMgcmVzZXQgZWFjaCB0aW1lIGEgbmV3IG9wZXJhdGlvbiBpcyBidWZmZXJlZC4gSWYgdGhlIGNhY2hlIGhhcyBub3QgYmVlbiByZXNldCwge0BsaW5rICNnZXRDaGFuZ2VzfSB3aWxsXG5cdCAqIHJldHVybiB0aGUgY2FjaGVkIHZhbHVlIGluc3RlYWQgb2YgY2FsY3VsYXRpbmcgaXQgYWdhaW4uXG5cdCAqXG5cdCAqIFRoaXMgcHJvcGVydHkgc3RvcmVzIGFsbCBjaGFuZ2VzIGV2YWx1YXRlZCBieSBgRGlmZmVyYCwgaW5jbHVkaW5nIHRob3NlIHRoYXQgdG9vayBwbGFjZSBpbiB0aGUgZ3JhdmV5YXJkLlxuXHQgKi8gX2NhY2hlZENoYW5nZXNXaXRoR3JhdmV5YXJkID0gbnVsbDtcbiAgICAvKipcblx0ICogU2V0IG9mIG1vZGVsIGl0ZW1zIHRoYXQgd2VyZSBtYXJrZWQgdG8gZ2V0IHJlZnJlc2hlZCBpbiB7QGxpbmsgI19yZWZyZXNoSXRlbX0uXG5cdCAqLyBfcmVmcmVzaGVkSXRlbXMgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBgRGlmZmVyYCBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG1hcmtlckNvbGxlY3Rpb24gTW9kZWwncyBtYXJrZXIgY29sbGVjdGlvbi5cblx0ICovIGNvbnN0cnVjdG9yKG1hcmtlckNvbGxlY3Rpb24pe1xuICAgICAgICB0aGlzLl9tYXJrZXJDb2xsZWN0aW9uID0gbWFya2VyQ29sbGVjdGlvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluZm9ybXMgd2hldGhlciB0aGVyZSBhcmUgYW55IGNoYW5nZXMgYnVmZmVyZWQgaW4gYERpZmZlcmAuXG5cdCAqLyBnZXQgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoYW5nZXNJbkVsZW1lbnQuc2l6ZSA9PSAwICYmIHRoaXMuX2NoYW5nZWRNYXJrZXJzLnNpemUgPT0gMCAmJiB0aGlzLl9jaGFuZ2VkUm9vdHMuc2l6ZSA9PSAwO1xuICAgIH1cbiAgICAvKipcblx0ICogQnVmZmVycyB0aGUgZ2l2ZW4gb3BlcmF0aW9uLiAqKkFuIG9wZXJhdGlvbiBoYXMgdG8gYmUgYnVmZmVyZWQgYmVmb3JlIGl0IGlzIGV4ZWN1dGVkLioqXG5cdCAqXG5cdCAqIEBwYXJhbSBvcGVyYXRpb25Ub0J1ZmZlciBBbiBvcGVyYXRpb24gdG8gYnVmZmVyLlxuXHQgKi8gYnVmZmVyT3BlcmF0aW9uKG9wZXJhdGlvblRvQnVmZmVyKSB7XG4gICAgICAgIC8vIEJlbG93IHdlIHRha2UgYW4gb3BlcmF0aW9uLCBjaGVjayBpdHMgdHlwZSwgdGhlbiB1c2UgaXRzIHBhcmFtZXRlcnMgaW4gbWFya2luZyAocHJpdmF0ZSkgbWV0aG9kcy5cbiAgICAgICAgLy8gVGhlIGdlbmVyYWwgcnVsZSBpcyB0byBub3QgbWFyayBlbGVtZW50cyBpbnNpZGUgaW5zZXJ0ZWQgZWxlbWVudC4gQWxsIGluc2VydGVkIGVsZW1lbnRzIGFyZSByZS1yZW5kZXJlZC5cbiAgICAgICAgLy8gTWFya2luZyBjaGFuZ2VzIGluIHRoZW0gd291bGQgY2F1c2UgYSBcImRvdWJsZVwiIGNoYW5naW5nIHRoZW4uXG4gICAgICAgIC8vXG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG9wZXJhdGlvblRvQnVmZmVyO1xuICAgICAgICAvLyBOb3RlOiBhbiBvcGVyYXRpb24gdGhhdCBoYXBwZW5zIGluc2lkZSBhIG5vbi1sb2FkZWQgcm9vdCB3aWxsIGJlIGlnbm9yZWQuIElmIHRoZSBvcGVyYXRpb24gaGFwcGVucyBwYXJ0aWFsbHkgaW5zaWRlXG4gICAgICAgIC8vIGEgbm9uLWxvYWRlZCByb290LCB0aGF0IHBhcnQgd2lsbCBiZSBpZ25vcmVkICh0aGlzIG1heSBoYXBwZW4gZm9yIG1vdmUgb3IgbWFya2VyIG9wZXJhdGlvbnMpLlxuICAgICAgICAvL1xuICAgICAgICBzd2l0Y2gob3BlcmF0aW9uLnR5cGUpe1xuICAgICAgICAgICAgY2FzZSAnaW5zZXJ0JzpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0luSW5zZXJ0ZWRFbGVtZW50KG9wZXJhdGlvbi5wb3NpdGlvbi5wYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFya0luc2VydChvcGVyYXRpb24ucG9zaXRpb24ucGFyZW50LCBvcGVyYXRpb24ucG9zaXRpb24ub2Zmc2V0LCBvcGVyYXRpb24ubm9kZXMubWF4T2Zmc2V0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAnYWRkQXR0cmlidXRlJzpcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZUF0dHJpYnV0ZSc6XG4gICAgICAgICAgICBjYXNlICdjaGFuZ2VBdHRyaWJ1dGUnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIG9wZXJhdGlvbi5yYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGFsbG93OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0luSW5zZXJ0ZWRFbGVtZW50KGl0ZW0ucGFyZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFya0F0dHJpYnV0ZShpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxuICAgICAgICAgICAgY2FzZSAnbW92ZSc6XG4gICAgICAgICAgICBjYXNlICdyZWluc2VydCc6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHJhbmdlIGlzIG1vdmVkIHRvIHRoZSBzYW1lIHBvc2l0aW9uIHRoZW4gbm90IG1hcmsgaXQgYXMgYSBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE2NjQuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24uc291cmNlUG9zaXRpb24uaXNFcXVhbChvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24pIHx8IG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbi5nZXRTaGlmdGVkQnkob3BlcmF0aW9uLmhvd01hbnkpLmlzRXF1YWwob3BlcmF0aW9uLnRhcmdldFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZVBhcmVudEluc2VydGVkID0gdGhpcy5faXNJbkluc2VydGVkRWxlbWVudChvcGVyYXRpb24uc291cmNlUG9zaXRpb24ucGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UGFyZW50SW5zZXJ0ZWQgPSB0aGlzLl9pc0luSW5zZXJ0ZWRFbGVtZW50KG9wZXJhdGlvbi50YXJnZXRQb3NpdGlvbi5wYXJlbnQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZVBhcmVudEluc2VydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrUmVtb3ZlKG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbi5wYXJlbnQsIG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbi5vZmZzZXQsIG9wZXJhdGlvbi5ob3dNYW55KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhcmdldFBhcmVudEluc2VydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrSW5zZXJ0KG9wZXJhdGlvbi50YXJnZXRQb3NpdGlvbi5wYXJlbnQsIG9wZXJhdGlvbi5nZXRNb3ZlZFJhbmdlU3RhcnQoKS5vZmZzZXQsIG9wZXJhdGlvbi5ob3dNYW55KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciAtLSBvcGVyYXRpb24gaXMgYnVmZmVyZWQgYmVmb3JlIGl0IGlzIGV4ZWN1dGVkLiBTbywgaXQgd2FzIG5vdCBleGVjdXRlZCB5ZXQuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KG9wZXJhdGlvbi5zb3VyY2VQb3NpdGlvbiwgb3BlcmF0aW9uLmhvd01hbnkpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgcmFuZ2UuZ2V0SXRlbXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hhbGxvdzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRFbGVtZW50U3RhdGUobm9kZSwgJ21vdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdyZW5hbWUnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzSW5JbnNlcnRlZEVsZW1lbnQob3BlcmF0aW9uLnBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrUmVtb3ZlKG9wZXJhdGlvbi5wb3NpdGlvbi5wYXJlbnQsIG9wZXJhdGlvbi5wb3NpdGlvbi5vZmZzZXQsIDEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrSW5zZXJ0KG9wZXJhdGlvbi5wb3NpdGlvbi5wYXJlbnQsIG9wZXJhdGlvbi5wb3NpdGlvbi5vZmZzZXQsIDEpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChvcGVyYXRpb24ucG9zaXRpb24sIDEpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLl9tYXJrZXJDb2xsZWN0aW9uLmdldE1hcmtlcnNJbnRlcnNlY3RpbmdSYW5nZShyYW5nZSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFya2VyRGF0YSA9IG1hcmtlci5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlck1hcmtlckNoYW5nZShtYXJrZXIubmFtZSwgbWFya2VyRGF0YSwgbWFya2VyRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0RWxlbWVudFN0YXRlKG9wZXJhdGlvbi5wb3NpdGlvbi5ub2RlQWZ0ZXIsICdyZW5hbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSAnc3BsaXQnOlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRFbGVtZW50ID0gb3BlcmF0aW9uLnNwbGl0UG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIHRoYXQgY2hpbGRyZW4gb2YgdGhlIHNwbGl0IGVsZW1lbnQgd2VyZSByZW1vdmVkLlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzSW5JbnNlcnRlZEVsZW1lbnQoc3BsaXRFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFya1JlbW92ZShzcGxpdEVsZW1lbnQsIG9wZXJhdGlvbi5zcGxpdFBvc2l0aW9uLm9mZnNldCwgb3BlcmF0aW9uLmhvd01hbnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgLS0gb3BlcmF0aW9uIGlzIGJ1ZmZlcmVkIGJlZm9yZSBpdCBpcyBleGVjdXRlZC4gU28sIGl0IHdhcyBub3QgZXhlY3V0ZWQgeWV0LlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQob3BlcmF0aW9uLnNwbGl0UG9zaXRpb24sIG9wZXJhdGlvbi5ob3dNYW55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiByYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhbGxvdzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRTdGF0ZShub2RlLCAnbW92ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIE1hcmsgdGhhdCB0aGUgbmV3IGVsZW1lbnQgKHNwbGl0IGNvcHkpIHdhcyBpbnNlcnRlZC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0luSW5zZXJ0ZWRFbGVtZW50KG9wZXJhdGlvbi5pbnNlcnRpb25Qb3NpdGlvbi5wYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrSW5zZXJ0KG9wZXJhdGlvbi5pbnNlcnRpb25Qb3NpdGlvbi5wYXJlbnQsIG9wZXJhdGlvbi5pbnNlcnRpb25Qb3NpdGlvbi5vZmZzZXQsIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzcGxpdCB0b29rIHRoZSBlbGVtZW50IGZyb20gdGhlIGdyYXZleWFyZCwgbWFyayB0aGF0IHRoZSBlbGVtZW50IGZyb20gdGhlIGdyYXZleWFyZCB3YXMgcmVtb3ZlZC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi5ncmF2ZXlhcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFya1JlbW92ZShvcGVyYXRpb24uZ3JhdmV5YXJkUG9zaXRpb24ucGFyZW50LCBvcGVyYXRpb24uZ3JhdmV5YXJkUG9zaXRpb24ub2Zmc2V0LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRTdGF0ZShvcGVyYXRpb24uZ3JhdmV5YXJkUG9zaXRpb24ubm9kZUFmdGVyLCAnbW92ZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ21lcmdlJzpcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE1hcmsgdGhhdCB0aGUgbWVyZ2VkIGVsZW1lbnQgd2FzIHJlbW92ZWQuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlZEVsZW1lbnQgPSBvcGVyYXRpb24uc291cmNlUG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzSW5JbnNlcnRlZEVsZW1lbnQobWVyZ2VkRWxlbWVudC5wYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrUmVtb3ZlKG1lcmdlZEVsZW1lbnQucGFyZW50LCBtZXJnZWRFbGVtZW50LnN0YXJ0T2Zmc2V0LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIHRoYXQgdGhlIG1lcmdlZCBlbGVtZW50IHdhcyBpbnNlcnRlZCBpbnRvIGdyYXZleWFyZC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JhdmV5YXJkUGFyZW50ID0gb3BlcmF0aW9uLmdyYXZleWFyZFBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFya0luc2VydChncmF2ZXlhcmRQYXJlbnQsIG9wZXJhdGlvbi5ncmF2ZXlhcmRQb3NpdGlvbi5vZmZzZXQsIDEpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRFbGVtZW50U3RhdGUobWVyZ2VkRWxlbWVudCwgJ21vdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayB0aGF0IGNoaWxkcmVuIG9mIG1lcmdlZCBlbGVtZW50IHdlcmUgaW5zZXJ0ZWQgYXQgbmV3IHBhcmVudC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVyZ2VkSW50b0VsZW1lbnQgPSBvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzSW5JbnNlcnRlZEVsZW1lbnQobWVyZ2VkSW50b0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXJrSW5zZXJ0KG1lcmdlZEludG9FbGVtZW50LCBvcGVyYXRpb24udGFyZ2V0UG9zaXRpb24ub2Zmc2V0LCBtZXJnZWRFbGVtZW50Lm1heE9mZnNldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciAtLSBvcGVyYXRpb24gaXMgYnVmZmVyZWQgYmVmb3JlIGl0IGlzIGV4ZWN1dGVkLiBTbywgaXQgd2FzIG5vdCBleGVjdXRlZCB5ZXQuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IFJhbmdlLl9jcmVhdGVGcm9tUG9zaXRpb25BbmRTaGlmdChvcGVyYXRpb24uc291cmNlUG9zaXRpb24sIG9wZXJhdGlvbi5ob3dNYW55KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiByYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhbGxvdzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRTdGF0ZShub2RlLCAnbW92ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ2RldGFjaFJvb3QnOlxuICAgICAgICAgICAgY2FzZSAnYWRkUm9vdCc6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByb290ID0gb3BlcmF0aW9uLmFmZmVjdGVkU2VsZWN0YWJsZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyb290Ll9pc0xvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGJ1ZmZlciBpZiB0aGUgcm9vdCBzdGF0ZSBkb2VzIG5vdCBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb290LmlzQXR0YWNoZWQoKSA9PSBvcGVyYXRpb24uaXNBZGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9idWZmZXJSb290U3RhdGVDaGFuZ2Uob3BlcmF0aW9uLnJvb3ROYW1lLCBvcGVyYXRpb24uaXNBZGQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdhZGRSb290QXR0cmlidXRlJzpcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZVJvb3RBdHRyaWJ1dGUnOlxuICAgICAgICAgICAgY2FzZSAnY2hhbmdlUm9vdEF0dHJpYnV0ZSc6XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW9wZXJhdGlvbi5yb290Ll9pc0xvYWRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvb3ROYW1lID0gb3BlcmF0aW9uLnJvb3Qucm9vdE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1ZmZlclJvb3RBdHRyaWJ1dGVDaGFuZ2Uocm9vdE5hbWUsIG9wZXJhdGlvbi5rZXksIG9wZXJhdGlvbi5vbGRWYWx1ZSwgb3BlcmF0aW9uLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIENsZWFyIGNhY2hlIGFmdGVyIGVhY2ggYnVmZmVyZWQgb3BlcmF0aW9uIGFzIGl0IGlzIG5vIGxvbmdlciB2YWxpZC5cbiAgICAgICAgdGhpcy5fY2FjaGVkQ2hhbmdlcyA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBCdWZmZXJzIGEgbWFya2VyIGNoYW5nZS5cblx0ICpcblx0ICogQHBhcmFtIG1hcmtlck5hbWUgVGhlIG5hbWUgb2YgdGhlIG1hcmtlciB0aGF0IGNoYW5nZWQuXG5cdCAqIEBwYXJhbSBvbGRNYXJrZXJEYXRhIE1hcmtlciBkYXRhIGJlZm9yZSB0aGUgY2hhbmdlLlxuXHQgKiBAcGFyYW0gbmV3TWFya2VyRGF0YSBNYXJrZXIgZGF0YSBhZnRlciB0aGUgY2hhbmdlLlxuXHQgKi8gYnVmZmVyTWFya2VyQ2hhbmdlKG1hcmtlck5hbWUsIG9sZE1hcmtlckRhdGEsIG5ld01hcmtlckRhdGEpIHtcbiAgICAgICAgaWYgKG9sZE1hcmtlckRhdGEucmFuZ2UgJiYgb2xkTWFya2VyRGF0YS5yYW5nZS5yb290LmlzKCdyb290RWxlbWVudCcpICYmICFvbGRNYXJrZXJEYXRhLnJhbmdlLnJvb3QuX2lzTG9hZGVkKSB7XG4gICAgICAgICAgICBvbGRNYXJrZXJEYXRhLnJhbmdlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFya2VyRGF0YS5yYW5nZSAmJiBuZXdNYXJrZXJEYXRhLnJhbmdlLnJvb3QuaXMoJ3Jvb3RFbGVtZW50JykgJiYgIW5ld01hcmtlckRhdGEucmFuZ2Uucm9vdC5faXNMb2FkZWQpIHtcbiAgICAgICAgICAgIG5ld01hcmtlckRhdGEucmFuZ2UgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBidWZmZXJlZCA9IHRoaXMuX2NoYW5nZWRNYXJrZXJzLmdldChtYXJrZXJOYW1lKTtcbiAgICAgICAgaWYgKCFidWZmZXJlZCkge1xuICAgICAgICAgICAgYnVmZmVyZWQgPSB7XG4gICAgICAgICAgICAgICAgbmV3TWFya2VyRGF0YSxcbiAgICAgICAgICAgICAgICBvbGRNYXJrZXJEYXRhXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5fY2hhbmdlZE1hcmtlcnMuc2V0KG1hcmtlck5hbWUsIGJ1ZmZlcmVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJ1ZmZlcmVkLm5ld01hcmtlckRhdGEgPSBuZXdNYXJrZXJEYXRhO1xuICAgICAgICB9XG4gICAgICAgIGlmIChidWZmZXJlZC5vbGRNYXJrZXJEYXRhLnJhbmdlID09IG51bGwgJiYgbmV3TWFya2VyRGF0YS5yYW5nZSA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBUaGUgbWFya2VyIGlzIGdvaW5nIHRvIGJlIHJlbW92ZWQgKGBuZXdNYXJrZXJEYXRhLnJhbmdlID09IG51bGxgKSBidXQgaXQgZGlkIG5vdCBleGlzdCBiZWZvcmUgdGhlIGZpcnN0IGJ1ZmZlcmVkIGNoYW5nZVxuICAgICAgICAgICAgLy8gKGBidWZmZXJlZC5vbGRNYXJrZXJEYXRhLnJhbmdlID09IG51bGxgKS4gSW4gdGhpcyBjYXNlLCBkbyBub3Qga2VlcCB0aGUgbWFya2VyIGluIGJ1ZmZlciBhdCBhbGwuXG4gICAgICAgICAgICB0aGlzLl9jaGFuZ2VkTWFya2Vycy5kZWxldGUobWFya2VyTmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYWxsIG1hcmtlcnMgdGhhdCBzaG91bGQgYmUgcmVtb3ZlZCBhcyBhIHJlc3VsdCBvZiBidWZmZXJlZCBjaGFuZ2VzLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBNYXJrZXJzIHRvIHJlbW92ZS4gRWFjaCBhcnJheSBpdGVtIGlzIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgbmFtZWAgYW5kIGByYW5nZWAgcHJvcGVydGllcy5cblx0ICovIGdldE1hcmtlcnNUb1JlbW92ZSgpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgW25hbWUsIGNoYW5nZV0gb2YgdGhpcy5fY2hhbmdlZE1hcmtlcnMpe1xuICAgICAgICAgICAgaWYgKGNoYW5nZS5vbGRNYXJrZXJEYXRhLnJhbmdlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiBjaGFuZ2Uub2xkTWFya2VyRGF0YS5yYW5nZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFsbCBtYXJrZXJzIHdoaWNoIHNob3VsZCBiZSBhZGRlZCBhcyBhIHJlc3VsdCBvZiBidWZmZXJlZCBjaGFuZ2VzLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBNYXJrZXJzIHRvIGFkZC4gRWFjaCBhcnJheSBpdGVtIGlzIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBgbmFtZWAgYW5kIGByYW5nZWAgcHJvcGVydGllcy5cblx0ICovIGdldE1hcmtlcnNUb0FkZCgpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgW25hbWUsIGNoYW5nZV0gb2YgdGhpcy5fY2hhbmdlZE1hcmtlcnMpe1xuICAgICAgICAgICAgaWYgKGNoYW5nZS5uZXdNYXJrZXJEYXRhLnJhbmdlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiBjaGFuZ2UubmV3TWFya2VyRGF0YS5yYW5nZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFsbCBtYXJrZXJzIHdoaWNoIGNoYW5nZWQuXG5cdCAqLyBnZXRDaGFuZ2VkTWFya2VycygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5fY2hhbmdlZE1hcmtlcnMpLm1hcCgoW25hbWUsIGNoYW5nZV0pPT4oe1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBvbGRSYW5nZTogY2hhbmdlLm9sZE1hcmtlckRhdGEucmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgIG5ld1JhbmdlOiBjaGFuZ2UubmV3TWFya2VyRGF0YS5yYW5nZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHNvbWUgb2YgdGhlIGJ1ZmZlcmVkIGNoYW5nZXMgYWZmZWN0IHRoZSBlZGl0b3IgZGF0YS5cblx0ICpcblx0ICogVHlwZXMgb2YgY2hhbmdlcyB3aGljaCBhZmZlY3QgdGhlIGVkaXRvciBkYXRhOlxuXHQgKlxuXHQgKiAqIG1vZGVsIHN0cnVjdHVyZSBjaGFuZ2VzLFxuXHQgKiAqIGF0dHJpYnV0ZSBjaGFuZ2VzLFxuXHQgKiAqIGEgcm9vdCBpcyBhZGRlZCBvciBkZXRhY2hlZCxcblx0ICogKiBjaGFuZ2VzIG9mIG1hcmtlcnMgd2hpY2ggd2VyZSBkZWZpbmVkIGFzIGBhZmZlY3RzRGF0YWAsXG5cdCAqICogY2hhbmdlcyBvZiBtYXJrZXJzJyBgYWZmZWN0c0RhdGFgIHByb3BlcnR5LlxuXHQgKi8gaGFzRGF0YUNoYW5nZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmdldENoYW5nZXMoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9jaGFuZ2VkUm9vdHMuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgeyBuZXdNYXJrZXJEYXRhLCBvbGRNYXJrZXJEYXRhIH0gb2YgdGhpcy5fY2hhbmdlZE1hcmtlcnMudmFsdWVzKCkpe1xuICAgICAgICAgICAgaWYgKG5ld01hcmtlckRhdGEuYWZmZWN0c0RhdGEgIT09IG9sZE1hcmtlckRhdGEuYWZmZWN0c0RhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChuZXdNYXJrZXJEYXRhLmFmZmVjdHNEYXRhKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFya2VyQWRkZWQgPSBuZXdNYXJrZXJEYXRhLnJhbmdlICYmICFvbGRNYXJrZXJEYXRhLnJhbmdlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcmtlclJlbW92ZWQgPSAhbmV3TWFya2VyRGF0YS5yYW5nZSAmJiBvbGRNYXJrZXJEYXRhLnJhbmdlO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcmtlckNoYW5nZWQgPSBuZXdNYXJrZXJEYXRhLnJhbmdlICYmIG9sZE1hcmtlckRhdGEucmFuZ2UgJiYgIW5ld01hcmtlckRhdGEucmFuZ2UuaXNFcXVhbChvbGRNYXJrZXJEYXRhLnJhbmdlKTtcbiAgICAgICAgICAgICAgICBpZiAobWFya2VyQWRkZWQgfHwgbWFya2VyUmVtb3ZlZCB8fCBtYXJrZXJDaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDYWxjdWxhdGVzIHRoZSBkaWZmIGJldHdlZW4gdGhlIG9sZCBtb2RlbCB0cmVlIHN0YXRlICh0aGUgc3RhdGUgYmVmb3JlIHRoZSBmaXJzdCBidWZmZXJlZCBvcGVyYXRpb25zIHNpbmNlIHRoZSBsYXN0IHtAbGluayAjcmVzZXR9XG5cdCAqIGNhbGwpIGFuZCB0aGUgbmV3IG1vZGVsIHRyZWUgc3RhdGUgKGFjdHVhbCBvbmUpLiBJdCBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGFsbCBidWZmZXJlZCBvcGVyYXRpb25zIGFyZSBleGVjdXRlZC5cblx0ICpcblx0ICogVGhlIGRpZmYgc2V0IGlzIHJldHVybmVkIGFzIGFuIGFycmF5IG9mIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RpZmZlcn5EaWZmSXRlbSBkaWZmIGl0ZW1zfSwgZWFjaCBkZXNjcmliaW5nIGEgY2hhbmdlIGRvbmVcblx0ICogb24gdGhlIG1vZGVsLiBUaGUgaXRlbXMgYXJlIHNvcnRlZCBieSB0aGUgcG9zaXRpb24gb24gd2hpY2ggdGhlIGNoYW5nZSBoYXBwZW5lZC4gSWYgYSBwb3NpdGlvblxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNpc0JlZm9yZSBpcyBiZWZvcmV9IGFub3RoZXIgb25lLCBpdCB3aWxsIGJlIG9uIGFuIGVhcmxpZXIgaW5kZXggaW4gdGhlIGRpZmYgc2V0LlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogRWxlbWVudHMgaW5zaWRlIGluc2VydGVkIGVsZW1lbnQgd2lsbCBub3QgaGF2ZSBhIHNlcGFyYXRlIGRpZmYgaXRlbSwgb25seSB0aGUgdG9wIG1vc3QgZWxlbWVudCBjaGFuZ2Ugd2lsbCBiZSByZXBvcnRlZC5cblx0ICpcblx0ICogQmVjYXVzZSBjYWxjdWxhdGluZyB0aGUgZGlmZiBpcyBhIGNvc3RseSBvcGVyYXRpb24sIHRoZSByZXN1bHQgaXMgY2FjaGVkLiBJZiBubyBuZXcgb3BlcmF0aW9uIHdhcyBidWZmZXJlZCBzaW5jZSB0aGVcblx0ICogcHJldmlvdXMge0BsaW5rICNnZXRDaGFuZ2VzfSBjYWxsLCB0aGUgbmV4dCBjYWxsIHdpbGwgcmV0dXJuIHRoZSBjYWNoZWQgdmFsdWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuaW5jbHVkZUNoYW5nZXNJbkdyYXZleWFyZCBJZiBzZXQgdG8gYHRydWVgLCBhbHNvIGNoYW5nZXMgdGhhdCBoYXBwZW5lZFxuXHQgKiBpbiB0aGUgZ3JhdmV5YXJkIHJvb3Qgd2lsbCBiZSByZXR1cm5lZC4gQnkgZGVmYXVsdCwgY2hhbmdlcyBpbiB0aGUgZ3JhdmV5YXJkIHJvb3QgYXJlIG5vdCByZXR1cm5lZC5cblx0ICogQHJldHVybnMgRGlmZiBiZXR3ZWVuIHRoZSBvbGQgYW5kIHRoZSBuZXcgbW9kZWwgdHJlZSBzdGF0ZS5cblx0ICovIGdldENoYW5nZXMob3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSBjYWNoZWQgY2hhbmdlcywganVzdCByZXR1cm4gdGhlbSBpbnN0ZWFkIG9mIGNhbGN1bGF0aW5nIGNoYW5nZXMgYWdhaW4uXG4gICAgICAgIGlmICh0aGlzLl9jYWNoZWRDaGFuZ2VzKSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5pbmNsdWRlQ2hhbmdlc0luR3JhdmV5YXJkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXNXaXRoR3JhdmV5YXJkLnNsaWNlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRDaGFuZ2VzLnNsaWNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2lsbCBjb250YWluIHJldHVybmVkIHJlc3VsdHMuXG4gICAgICAgIGxldCBkaWZmU2V0ID0gW107XG4gICAgICAgIC8vIENoZWNrIGFsbCBjaGFuZ2VkIGVsZW1lbnRzL3Jvb3RzLlxuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgdGhpcy5fY2hhbmdlc0luRWxlbWVudC5rZXlzKCkpe1xuICAgICAgICAgICAgLy8gR2V0IGNoYW5nZXMgaW5zaWRlIHRoaXMgZWxlbWVudC9yb290IGFuZCBzb3J0IHRoZW0uXG4gICAgICAgICAgICBjb25zdCBjaGFuZ2VzID0gdGhpcy5fY2hhbmdlc0luRWxlbWVudC5nZXQoZWxlbWVudCkuc29ydCgoYSwgYik9PntcbiAgICAgICAgICAgICAgICBpZiAoYS5vZmZzZXQgPT09IGIub2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhLnR5cGUgIT0gYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbXVsdGlwbGUgY2hhbmdlcyBhdCB0aGUgc2FtZSBwb3NpdGlvbiwgXCJyZW1vdmVcIiBjaGFuZ2Ugc2hvdWxkIGJlIGZpcnN0LlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG9yZGVyIGlzIGRpZmZlcmVudCwgZm9yIGV4YW1wbGUsIHdlIHdvdWxkIGZpcnN0IGFkZCBzb21lIG5vZGVzIGFuZCB0aGVuIHJlbW92ZWQgdGhlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gKGluc3RlYWQgb2YgdGhlIG5vZGVzIHRoYXQgd2Ugc2hvdWxkIHJlbW92ZSkuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS50eXBlID09ICdyZW1vdmUnID8gLTEgOiAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYS5vZmZzZXQgPCBiLm9mZnNldCA/IC0xIDogMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gR2V0IGNoaWxkcmVuIG9mIHRoaXMgZWxlbWVudCBiZWZvcmUgYW55IGNoYW5nZSB3YXMgYXBwbGllZCBvbiBpdC5cbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuQmVmb3JlID0gdGhpcy5fZWxlbWVudENoaWxkcmVuU25hcHNob3RzLmdldChlbGVtZW50KTtcbiAgICAgICAgICAgIC8vIEdldCBzbmFwc2hvdCBvZiBjdXJyZW50IGVsZW1lbnQncyBjaGlsZHJlbi5cbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuQWZ0ZXIgPSBfZ2V0Q2hpbGRyZW5TbmFwc2hvdHMoZWxlbWVudC5nZXRDaGlsZHJlbigpKTtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGRpZmYgaW5zdHJ1Y3Rpb25zIGJhc2VkIG9uIGNoYW5nZXMgZG9uZSBpbiB0aGUgZWxlbWVudC9yb290LlxuICAgICAgICAgICAgY29uc3QgZGlmZkluc3RydWN0aW9ucyA9IF9nZW5lcmF0ZURpZmZJbnN0cnVjdGlvbnNGcm9tQ2hhbmdlcyhjaGlsZHJlbkJlZm9yZS5sZW5ndGgsIGNoYW5nZXMpO1xuICAgICAgICAgICAgbGV0IGkgPSAwOyAvLyBJdGVyYXRvciBpbiBgY2hpbGRyZW5BZnRlcmAgYXJyYXkgLS0gaXRlcmF0ZXMgdGhyb3VnaCBjdXJyZW50IGNoaWxkcmVuIG9mIGVsZW1lbnQuXG4gICAgICAgICAgICBsZXQgaiA9IDA7IC8vIEl0ZXJhdG9yIGluIGBjaGlsZHJlbkJlZm9yZWAgYXJyYXkgLS0gaXRlcmF0ZXMgdGhyb3VnaCBvbGQgY2hpbGRyZW4gb2YgZWxlbWVudC5cbiAgICAgICAgICAgIC8vIFByb2Nlc3MgZXZlcnkgYWN0aW9uLlxuICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0cnVjdGlvbiBvZiBkaWZmSW5zdHJ1Y3Rpb25zKXtcbiAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24gPT09ICdpJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLl9nZXREaWZmQWN0aW9uRm9yTm9kZShjaGlsZHJlbkFmdGVyW2ldLm5vZGUsICdpbnNlcnQnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRTbmFwc2hvdEJlZm9yZSA9IHRoaXMuX2VsZW1lbnRzU25hcHNob3RzLmdldChjaGlsZHJlbkFmdGVyW2ldLm5vZGUpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkaWZmSXRlbSA9IHRoaXMuX2dldEluc2VydERpZmYoZWxlbWVudCwgaSwgYWN0aW9uLCBjaGlsZHJlbkFmdGVyW2ldLCBjaGlsZFNuYXBzaG90QmVmb3JlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZlNldC5wdXNoKGRpZmZJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5zdHJ1Y3Rpb24gPT09ICdyJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb24gPSB0aGlzLl9nZXREaWZmQWN0aW9uRm9yTm9kZShjaGlsZHJlbkJlZm9yZVtqXS5ub2RlLCAncmVtb3ZlJyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmZJdGVtID0gdGhpcy5fZ2V0UmVtb3ZlRGlmZihlbGVtZW50LCBpLCBhY3Rpb24sIGNoaWxkcmVuQmVmb3JlW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZlNldC5wdXNoKGRpZmZJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5zdHJ1Y3Rpb24gPT09ICdhJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBUYWtlIGF0dHJpYnV0ZXMgZnJvbSBzYXZlZCBhbmQgY3VycmVudCBjaGlsZHJlbi5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVmb3JlQXR0cmlidXRlcyA9IGNoaWxkcmVuQmVmb3JlW2pdLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFmdGVyQXR0cmlidXRlcyA9IGNoaWxkcmVuQWZ0ZXJbaV0uYXR0cmlidXRlcztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJhbmdlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW5BZnRlcltpXS5uYW1lID09ICckdGV4dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVBdChlbGVtZW50LCBpKSwgUG9zaXRpb24uX2NyZWF0ZUF0KGVsZW1lbnQsIGkgKyAxKSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGVsZW1lbnQub2Zmc2V0VG9JbmRleChpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVBdChlbGVtZW50LCBpKSwgUG9zaXRpb24uX2NyZWF0ZUF0KGVsZW1lbnQuZ2V0Q2hpbGQoaW5kZXgpLCAwKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgZGlmZiBpdGVtcyBmb3IgdGhpcyBjaGFuZ2UgKHRoZXJlIG1pZ2h0IGJlIG11bHRpcGxlIGF0dHJpYnV0ZXMgY2hhbmdlZCBhbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlcmUgaXMgYSBzaW5nbGUgZGlmZiBmb3IgZWFjaCBvZiB0aGVtKSBhbmQgaW5zZXJ0IHRoZW0gaW50byB0aGUgZGlmZiBzZXQuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmZJdGVtcyA9IHRoaXMuX2dldEF0dHJpYnV0ZXNEaWZmKHJhbmdlLCBiZWZvcmVBdHRyaWJ1dGVzLCBhZnRlckF0dHJpYnV0ZXMpO1xuICAgICAgICAgICAgICAgICAgICBkaWZmU2V0LnB1c2goLi4uZGlmZkl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYGFjdGlvbmAgaXMgJ2VxdWFsJy4gQ2hpbGQgbm90IGNoYW5nZWQuXG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBUaGVuLCBzb3J0IHRoZSBjaGFuZ2VzIGJ5IHRoZSBwb3NpdGlvbiAoY2hhbmdlIGF0IHBvc2l0aW9uIGJlZm9yZSBvdGhlciBjaGFuZ2VzIGlzIGZpcnN0KS5cbiAgICAgICAgZGlmZlNldC5zb3J0KChhLCBiKT0+e1xuICAgICAgICAgICAgLy8gSWYgdGhlIGNoYW5nZSBpcyBpbiBkaWZmZXJlbnQgcm9vdCwgd2UgZG9uJ3QgY2FyZSBtdWNoLCBidXQgd2UnZCBsaWtlIHRvIGhhdmUgYWxsIGNoYW5nZXMgaW4gZ2l2ZW5cbiAgICAgICAgICAgIC8vIHJvb3QgXCJ0b2dldGhlclwiIGluIHRoZSBhcnJheS4gU28gbGV0J3MganVzdCBzb3J0IHRoZW0gYnkgdGhlIHJvb3QgbmFtZS4gSXQgZG9lcyBub3QgbWF0dGVyIHdoaWNoIHJvb3RcbiAgICAgICAgICAgIC8vIHdpbGwgYmUgcHJvY2Vzc2VkIGZpcnN0LlxuICAgICAgICAgICAgaWYgKGEucG9zaXRpb24ucm9vdCAhPSBiLnBvc2l0aW9uLnJvb3QpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5wb3NpdGlvbi5yb290LnJvb3ROYW1lIDwgYi5wb3NpdGlvbi5yb290LnJvb3ROYW1lID8gLTEgOiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgY2hhbmdlIGhhcHBlbnMgYXQgdGhlIHNhbWUgcG9zaXRpb24uLi5cbiAgICAgICAgICAgIGlmIChhLnBvc2l0aW9uLmlzRXF1YWwoYi5wb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICAvLyBLZWVwIGNocm9ub2xvZ2ljYWwgb3JkZXIgb2Ygb3BlcmF0aW9ucy5cbiAgICAgICAgICAgICAgICByZXR1cm4gYS5jaGFuZ2VDb3VudCAtIGIuY2hhbmdlQ291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiBwb3NpdGlvbnMgZGlmZmVyLCBwb3NpdGlvbiBcIm9uIHRoZSBsZWZ0XCIgc2hvdWxkIGJlIGVhcmxpZXIgaW4gdGhlIHJlc3VsdC5cbiAgICAgICAgICAgIHJldHVybiBhLnBvc2l0aW9uLmlzQmVmb3JlKGIucG9zaXRpb24pID8gLTEgOiAxO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gR2x1ZSB0b2dldGhlciBtdWx0aXBsZSBjaGFuZ2VzIChtb3N0bHkgb24gdGV4dCBub2RlcykuXG4gICAgICAgIGZvcihsZXQgaSA9IDEsIHByZXZJbmRleCA9IDA7IGkgPCBkaWZmU2V0Lmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgIGNvbnN0IHByZXZEaWZmID0gZGlmZlNldFtwcmV2SW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgdGhpc0RpZmYgPSBkaWZmU2V0W2ldO1xuICAgICAgICAgICAgLy8gR2x1ZSByZW1vdmUgY2hhbmdlcyBpZiB0aGV5IGhhcHBlbiBvbiB0ZXh0IG9uIHNhbWUgcG9zaXRpb24uXG4gICAgICAgICAgICBjb25zdCBpc0NvbnNlY3V0aXZlVGV4dFJlbW92ZSA9IHByZXZEaWZmLnR5cGUgPT0gJ3JlbW92ZScgJiYgdGhpc0RpZmYudHlwZSA9PSAncmVtb3ZlJyAmJiBwcmV2RGlmZi5uYW1lID09ICckdGV4dCcgJiYgdGhpc0RpZmYubmFtZSA9PSAnJHRleHQnICYmIHByZXZEaWZmLnBvc2l0aW9uLmlzRXF1YWwodGhpc0RpZmYucG9zaXRpb24pO1xuICAgICAgICAgICAgLy8gR2x1ZSBpbnNlcnQgY2hhbmdlcyBpZiB0aGV5IGhhcHBlbiBvbiB0ZXh0IG9uIGNvbnNlY3V0aXZlIGZyYWdtZW50cy5cbiAgICAgICAgICAgIGNvbnN0IGlzQ29uc2VjdXRpdmVUZXh0QWRkID0gcHJldkRpZmYudHlwZSA9PSAnaW5zZXJ0JyAmJiB0aGlzRGlmZi50eXBlID09ICdpbnNlcnQnICYmIHByZXZEaWZmLm5hbWUgPT0gJyR0ZXh0JyAmJiB0aGlzRGlmZi5uYW1lID09ICckdGV4dCcgJiYgcHJldkRpZmYucG9zaXRpb24ucGFyZW50ID09IHRoaXNEaWZmLnBvc2l0aW9uLnBhcmVudCAmJiBwcmV2RGlmZi5wb3NpdGlvbi5vZmZzZXQgKyBwcmV2RGlmZi5sZW5ndGggPT0gdGhpc0RpZmYucG9zaXRpb24ub2Zmc2V0O1xuICAgICAgICAgICAgLy8gR2x1ZSBhdHRyaWJ1dGUgY2hhbmdlcyBpZiB0aGV5IGhhcHBlbiBvbiBjb25zZWN1dGl2ZSBmcmFnbWVudHMgYW5kIGhhdmUgc2FtZSBrZXksIG9sZCB2YWx1ZSBhbmQgbmV3IHZhbHVlLlxuICAgICAgICAgICAgY29uc3QgaXNDb25zZWN1dGl2ZUF0dHJpYnV0ZUNoYW5nZSA9IHByZXZEaWZmLnR5cGUgPT0gJ2F0dHJpYnV0ZScgJiYgdGhpc0RpZmYudHlwZSA9PSAnYXR0cmlidXRlJyAmJiBwcmV2RGlmZi5wb3NpdGlvbi5wYXJlbnQgPT0gdGhpc0RpZmYucG9zaXRpb24ucGFyZW50ICYmIHByZXZEaWZmLnJhbmdlLmlzRmxhdCAmJiB0aGlzRGlmZi5yYW5nZS5pc0ZsYXQgJiYgcHJldkRpZmYucG9zaXRpb24ub2Zmc2V0ICsgcHJldkRpZmYubGVuZ3RoID09IHRoaXNEaWZmLnBvc2l0aW9uLm9mZnNldCAmJiBwcmV2RGlmZi5hdHRyaWJ1dGVLZXkgPT0gdGhpc0RpZmYuYXR0cmlidXRlS2V5ICYmIHByZXZEaWZmLmF0dHJpYnV0ZU9sZFZhbHVlID09IHRoaXNEaWZmLmF0dHJpYnV0ZU9sZFZhbHVlICYmIHByZXZEaWZmLmF0dHJpYnV0ZU5ld1ZhbHVlID09IHRoaXNEaWZmLmF0dHJpYnV0ZU5ld1ZhbHVlO1xuICAgICAgICAgICAgaWYgKGlzQ29uc2VjdXRpdmVUZXh0UmVtb3ZlIHx8IGlzQ29uc2VjdXRpdmVUZXh0QWRkIHx8IGlzQ29uc2VjdXRpdmVBdHRyaWJ1dGVDaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICBwcmV2RGlmZi5sZW5ndGgrKztcbiAgICAgICAgICAgICAgICBpZiAoaXNDb25zZWN1dGl2ZUF0dHJpYnV0ZUNoYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICBwcmV2RGlmZi5yYW5nZS5lbmQgPSBwcmV2RGlmZi5yYW5nZS5lbmQuZ2V0U2hpZnRlZEJ5KDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkaWZmU2V0W2ldID0gbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcHJldkluZGV4ID0gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkaWZmU2V0ID0gZGlmZlNldC5maWx0ZXIoKHYpPT52KTtcbiAgICAgICAgLy8gUmVtb3ZlIGBjaGFuZ2VDb3VudGAgcHJvcGVydHkgZnJvbSBkaWZmIGl0ZW1zLiBJdCBpcyB1c2VkIG9ubHkgZm9yIHNvcnRpbmcgYW5kIGlzIGludGVybmFsIHRoaW5nLlxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZGlmZlNldCl7XG4gICAgICAgICAgICBkZWxldGUgaXRlbS5jaGFuZ2VDb3VudDtcbiAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgPT0gJ2F0dHJpYnV0ZScpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2hhbmdlQ291bnQgPSAwO1xuICAgICAgICAvLyBDYWNoZSBjaGFuZ2VzLlxuICAgICAgICB0aGlzLl9jYWNoZWRDaGFuZ2VzV2l0aEdyYXZleWFyZCA9IGRpZmZTZXQ7XG4gICAgICAgIHRoaXMuX2NhY2hlZENoYW5nZXMgPSBkaWZmU2V0LmZpbHRlcihfY2hhbmdlc0luR3JhdmV5YXJkRmlsdGVyKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5jbHVkZUNoYW5nZXNJbkdyYXZleWFyZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXNXaXRoR3JhdmV5YXJkLnNsaWNlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVkQ2hhbmdlcy5zbGljZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGFsbCByb290cyB0aGF0IGhhdmUgY2hhbmdlZCAoZWl0aGVyIHdlcmUgYXR0YWNoZWQsIG9yIGRldGFjaGVkLCBvciB0aGVpciBhdHRyaWJ1dGVzIGNoYW5nZWQpLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBEaWZmIGJldHdlZW4gdGhlIG9sZCBhbmQgdGhlIG5ldyByb290cyBzdGF0ZS5cblx0ICovIGdldENoYW5nZWRSb290cygpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5fY2hhbmdlZFJvb3RzLnZhbHVlcygpKS5tYXAoKGRpZmZJdGVtKT0+e1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSB7XG4gICAgICAgICAgICAgICAgLi4uZGlmZkl0ZW1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoZW50cnkuc3RhdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIFRoZSByb290IHdhcyBhdHRhY2hlZCBvciBkZXRhY2hlZCAtLSBkbyBub3QgcmV0dXJuIGl0cyBhdHRyaWJ1dGVzIGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJvb3Qgd2FzIGF0dGFjaGVkLCBpdCBzaG91bGQgYmUgaGFuZGxlZCBhcyBhIHdob2xlLCB0b2dldGhlciB3aXRoIGl0cyBhdHRyaWJ1dGVzLCB0aGUgc2FtZSB3YXkgYXMgbW9kZWwgbm9kZXMuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJvb3Qgd2FzIGRldGFjaGVkLCBpdHMgYXR0cmlidXRlcyBzaG91bGQgYmUgZGlzY2FyZGVkIGFueXdheS5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIEtlZXAgaW4gbWluZCB0aGF0IGZpbHRlcmluZyBtdXN0IGhhcHBlbiBvbiB0aGlzIHN0YWdlICh3aGVuIHJldHJpZXZpbmcgY2hhbmdlcykuIElmIGZpbHRlcmluZyBoYXBwZW5zIG9uLXRoZS1mbHkgYXNcbiAgICAgICAgICAgICAgICAvLyB0aGUgYXR0cmlidXRlcyBjaGFuZ2UsIGl0IG1heSBsZWFkIHRvIGluY29ycmVjdCBzaXR1YXRpb24sIGUuZy46IGRldGFjaCByb290LCBjaGFuZ2UgYXR0cmlidXRlLCByZS1hdHRhY2ggcm9vdC5cbiAgICAgICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UsIGF0dHJpYnV0ZSBjaGFuZ2UgY2Fubm90IGJlIGZpbHRlcmVkLiBBZnRlciB0aGUgcm9vdCBpcyByZS1hdHRhY2hlZCwgdGhlIGF0dHJpYnV0ZSBjaGFuZ2UgbXVzdCBiZSBrZXB0LlxuICAgICAgICAgICAgICAgIGRlbGV0ZSBlbnRyeS5hdHRyaWJ1dGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVudHJ5O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSBzZXQgb2YgbW9kZWwgaXRlbXMgdGhhdCB3ZXJlIG1hcmtlZCB0byBnZXQgcmVmcmVzaGVkLlxuXHQgKi8gZ2V0UmVmcmVzaGVkSXRlbXMoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU2V0KHRoaXMuX3JlZnJlc2hlZEl0ZW1zKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlc2V0cyBgRGlmZmVyYC4gUmVtb3ZlcyBhbGwgYnVmZmVyZWQgY2hhbmdlcy5cblx0ICovIHJlc2V0KCkge1xuICAgICAgICB0aGlzLl9jaGFuZ2VzSW5FbGVtZW50LmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX2VsZW1lbnRDaGlsZHJlblNuYXBzaG90cy5jbGVhcigpO1xuICAgICAgICB0aGlzLl9lbGVtZW50c1NuYXBzaG90cy5jbGVhcigpO1xuICAgICAgICB0aGlzLl9lbGVtZW50U3RhdGUuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fY2hhbmdlZE1hcmtlcnMuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fY2hhbmdlZFJvb3RzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hlZEl0ZW1zLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX2NhY2hlZENoYW5nZXMgPSBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogTWFya3MgdGhlIGdpdmVuIGBpdGVtYCBpbiBkaWZmZXIgdG8gYmUgXCJyZWZyZXNoZWRcIi4gSXQgbWVhbnMgdGhhdCB0aGUgaXRlbSB3aWxsIGJlIG1hcmtlZCBhcyByZW1vdmVkIGFuZCBpbnNlcnRlZFxuXHQgKiBpbiB0aGUgZGlmZmVyIGNoYW5nZXMgc2V0LCBzbyBpdCB3aWxsIGJlIGVmZmVjdGl2ZWx5IHJlLWNvbnZlcnRlZCB3aGVuIHRoZSBkaWZmZXIgY2hhbmdlcyBhcmUgaGFuZGxlZCBieSBhIGRpc3BhdGNoZXIuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaXRlbSBJdGVtIHRvIHJlZnJlc2guXG5cdCAqLyBfcmVmcmVzaEl0ZW0oaXRlbSkge1xuICAgICAgICBpZiAodGhpcy5faXNJbkluc2VydGVkRWxlbWVudChpdGVtLnBhcmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tYXJrUmVtb3ZlKGl0ZW0ucGFyZW50LCBpdGVtLnN0YXJ0T2Zmc2V0LCBpdGVtLm9mZnNldFNpemUpO1xuICAgICAgICB0aGlzLl9tYXJrSW5zZXJ0KGl0ZW0ucGFyZW50LCBpdGVtLnN0YXJ0T2Zmc2V0LCBpdGVtLm9mZnNldFNpemUpO1xuICAgICAgICB0aGlzLl9yZWZyZXNoZWRJdGVtcy5hZGQoaXRlbSk7XG4gICAgICAgIHRoaXMuX3NldEVsZW1lbnRTdGF0ZShpdGVtLCAncmVmcmVzaCcpO1xuICAgICAgICBjb25zdCByYW5nZSA9IFJhbmdlLl9jcmVhdGVPbihpdGVtKTtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5fbWFya2VyQ29sbGVjdGlvbi5nZXRNYXJrZXJzSW50ZXJzZWN0aW5nUmFuZ2UocmFuZ2UpKXtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtlckRhdGEgPSBtYXJrZXIuZ2V0RGF0YSgpO1xuICAgICAgICAgICAgdGhpcy5idWZmZXJNYXJrZXJDaGFuZ2UobWFya2VyLm5hbWUsIG1hcmtlckRhdGEsIG1hcmtlckRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENsZWFyIGNhY2hlIGFmdGVyIGVhY2ggYnVmZmVyZWQgb3BlcmF0aW9uIGFzIGl0IGlzIG5vIGxvbmdlciB2YWxpZC5cbiAgICAgICAgdGhpcy5fY2FjaGVkQ2hhbmdlcyA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBCdWZmZXJzIGFsbCB0aGUgZGF0YSByZWxhdGVkIHRvIGdpdmVuIHJvb3QgbGlrZSBpdCB3YXMgYWxsIGp1c3QgYWRkZWQgdG8gdGhlIGVkaXRvci5cblx0ICpcblx0ICogRm9sbG93aW5nIGNoYW5nZXMgYXJlIGJ1ZmZlcmVkOlxuXHQgKlxuXHQgKiAqIHJvb3QgaXMgYXR0YWNoZWQsXG5cdCAqICogYWxsIHJvb3QgY29udGVudCBpcyBpbnNlcnRlZCxcblx0ICogKiBhbGwgcm9vdCBhdHRyaWJ1dGVzIGFyZSBhZGRlZCxcblx0ICogKiBhbGwgbWFya2VycyBpbnNpZGUgdGhlIHJvb3QgYXJlIGFkZGVkLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9idWZmZXJSb290TG9hZChyb290KSB7XG4gICAgICAgIGlmICghcm9vdC5pc0F0dGFjaGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9idWZmZXJSb290U3RhdGVDaGFuZ2Uocm9vdC5yb290TmFtZSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuX21hcmtJbnNlcnQocm9vdCwgMCwgcm9vdC5tYXhPZmZzZXQpO1xuICAgICAgICAvLyBCdWZmZXJpbmcgcm9vdCBhdHRyaWJ1dGUgY2hhbmdlcyBtYWtlcyBzZW5zZSBhbmQgaXMgYWN0dWFsbHkgbmVlZGVkLCBldmVuIHRob3VnaCB3ZSBidWZmZXIgcm9vdCBzdGF0ZSBjaGFuZ2UgYWJvdmUuXG4gICAgICAgIC8vIEJlY2F1c2UgdGhlIHJvb3Qgc3RhdGUgY2hhbmdlIGlzIGJ1ZmZlcmVkLCB0aGUgcm9vdCBhdHRyaWJ1dGVzIGNoYW5nZXMgYXJlIG5vdCByZXR1cm5lZCBieSB0aGUgZGlmZmVyLlxuICAgICAgICAvLyBCdXQsIGlmIHRoZSByb290IGF0dHJpYnV0ZSBpcyByZW1vdmVkIGluIHRoZSBzYW1lIGNoYW5nZSBibG9jaywgb3IgdGhlIHJvb3QgaXMgZGV0YWNoZWQsIHRoZW4gdGhlIGRpZmZlciByZXN1bHRzIHdvdWxkIGJlIHdyb25nLlxuICAgICAgICAvL1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiByb290LmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICB0aGlzLl9idWZmZXJSb290QXR0cmlidXRlQ2hhbmdlKHJvb3Qucm9vdE5hbWUsIGtleSwgbnVsbCwgcm9vdC5nZXRBdHRyaWJ1dGUoa2V5KSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5fbWFya2VyQ29sbGVjdGlvbil7XG4gICAgICAgICAgICBpZiAobWFya2VyLmdldFJhbmdlKCkucm9vdCA9PSByb290KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFya2VyRGF0YSA9IG1hcmtlci5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXJNYXJrZXJDaGFuZ2UobWFya2VyLm5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgLi4ubWFya2VyRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IG51bGxcbiAgICAgICAgICAgICAgICB9LCBtYXJrZXJEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQnVmZmVycyB0aGUgcm9vdCBzdGF0ZSBjaGFuZ2UgYWZ0ZXIgdGhlIHJvb3Qgd2FzIGF0dGFjaGVkIG9yIGRldGFjaGVkXG5cdCAqLyBfYnVmZmVyUm9vdFN0YXRlQ2hhbmdlKHJvb3ROYW1lLCBpc0F0dGFjaGVkKSB7XG4gICAgICAgIGlmICghdGhpcy5fY2hhbmdlZFJvb3RzLmhhcyhyb290TmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZWRSb290cy5zZXQocm9vdE5hbWUsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiByb290TmFtZSxcbiAgICAgICAgICAgICAgICBzdGF0ZTogaXNBdHRhY2hlZCA/ICdhdHRhY2hlZCcgOiAnZGV0YWNoZWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkaWZmSXRlbSA9IHRoaXMuX2NoYW5nZWRSb290cy5nZXQocm9vdE5hbWUpO1xuICAgICAgICBpZiAoZGlmZkl0ZW0uc3RhdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gUm9vdCBgc3RhdGVgIGNhbiBvbmx5IHRvZ2dsZSBiZXR3ZWVuIG9uZSBvZiB0aGUgdmFsdWVzIGFuZCBubyB2YWx1ZS4gSXQgY2Fubm90IGJlIGFueSBvdGhlciB3YXksXG4gICAgICAgICAgICAvLyBiZWNhdXNlIGlmIHRoZSByb290IHdhcyBvcmlnaW5hbGx5IGF0dGFjaGVkIGl0IGNhbiBvbmx5IGJlY29tZSBkZXRhY2hlZC4gVGhlbiwgaWYgaXQgaXMgcmUtYXR0YWNoZWQgaW4gdGhlIHNhbWUgYmF0Y2ggb2ZcbiAgICAgICAgICAgIC8vIGNoYW5nZXMsIGl0IGdldHMgYmFjayB0byBcIm5vIGNoYW5nZVwiICh3aGljaCBtZWFucyBubyB2YWx1ZSkuIFNhbWUgaWYgdGhlIHJvb3Qgd2FzIG9yaWdpbmFsbHkgZGV0YWNoZWQuXG4gICAgICAgICAgICBkZWxldGUgZGlmZkl0ZW0uc3RhdGU7XG4gICAgICAgICAgICBpZiAoZGlmZkl0ZW0uYXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gYHN0YXRlYCBjaGFuZ2UgYW5kIG5vIGBhdHRyaWJ1dGVzYCBjaGFuZ2UsIHJlbW92ZSB0aGUgZW50cnkuXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlZFJvb3RzLmRlbGV0ZShyb290TmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWZmSXRlbS5zdGF0ZSA9IGlzQXR0YWNoZWQgPyAnYXR0YWNoZWQnIDogJ2RldGFjaGVkJztcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQnVmZmVycyBhIHJvb3QgYXR0cmlidXRlIGNoYW5nZS5cblx0ICovIF9idWZmZXJSb290QXR0cmlidXRlQ2hhbmdlKHJvb3ROYW1lLCBrZXksIG9sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICBjb25zdCBkaWZmSXRlbSA9IHRoaXMuX2NoYW5nZWRSb290cy5nZXQocm9vdE5hbWUpIHx8IHtcbiAgICAgICAgICAgIG5hbWU6IHJvb3ROYW1lXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGF0dHJzID0gZGlmZkl0ZW0uYXR0cmlidXRlcyB8fCB7fTtcbiAgICAgICAgaWYgKGF0dHJzW2tleV0pIHtcbiAgICAgICAgICAgIC8vIElmIHRoaXMgYXR0cmlidXRlIG9yIG1ldGFkYXRhIHdhcyBhbHJlYWR5IGNoYW5nZWQgZWFybGllciBhbmQgaXMgY2hhbmdlZCBhZ2FpbiwgY2hlY2sgdG8gd2hhdCB2YWx1ZSBpdCBpcyBjaGFuZ2VkLlxuICAgICAgICAgICAgY29uc3QgYXR0ckVudHJ5ID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gYXR0ckVudHJ5Lm9sZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgaXQgd2FzIGNoYW5nZWQgYmFjayB0byB0aGUgb2xkIHZhbHVlLCByZW1vdmUgdGhlIGVudHJ5LlxuICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRyc1trZXldO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBpdCB3YXMgY2hhbmdlZCB0byBhIGRpZmZlcmVudCB2YWx1ZSwgdXBkYXRlIHRoZSBlbnRyeS5cbiAgICAgICAgICAgICAgICBhdHRyRW50cnkubmV3VmFsdWUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIElmIHRoaXMgYXR0cmlidXRlIG9yIG1ldGFkYXRhIHdhcyBub3Qgc2V0IGVhcmxpZXIsIGFkZCBhbiBlbnRyeS5cbiAgICAgICAgICAgIGF0dHJzW2tleV0gPSB7XG4gICAgICAgICAgICAgICAgb2xkVmFsdWUsXG4gICAgICAgICAgICAgICAgbmV3VmFsdWVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKE9iamVjdC5lbnRyaWVzKGF0dHJzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIC8vIElmIGF0dHJpYnV0ZXMgb3IgbWV0YWRhdGEgY2hhbmdlcyBzZXQgYmVjYW1lIGVtcHR5LCByZW1vdmUgaXQgZnJvbSB0aGUgZGlmZiBpdGVtLlxuICAgICAgICAgICAgZGVsZXRlIGRpZmZJdGVtLmF0dHJpYnV0ZXM7XG4gICAgICAgICAgICBpZiAoZGlmZkl0ZW0uc3RhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGBzdGF0ZWAgY2hhbmdlIGFuZCBubyBgYXR0cmlidXRlc2AgY2hhbmdlLCByZW1vdmUgdGhlIGVudHJ5LlxuICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZWRSb290cy5kZWxldGUocm9vdE5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQsIGlmIGEgbmV3IG9iamVjdCBpbiB0aGUgc3RydWN0dXJlIHdhcyBjcmVhdGVkLCBpdCBnZXRzIHNldC5cbiAgICAgICAgICAgIGRpZmZJdGVtLmF0dHJpYnV0ZXMgPSBhdHRycztcbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZWRSb290cy5zZXQocm9vdE5hbWUsIGRpZmZJdGVtKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2F2ZXMgYW5kIGhhbmRsZXMgYW4gaW5zZXJ0IGNoYW5nZS5cblx0ICovIF9tYXJrSW5zZXJ0KHBhcmVudCwgb2Zmc2V0LCBob3dNYW55KSB7XG4gICAgICAgIGlmIChwYXJlbnQucm9vdC5pcygncm9vdEVsZW1lbnQnKSAmJiAhcGFyZW50LnJvb3QuX2lzTG9hZGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlSXRlbSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdpbnNlcnQnLFxuICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgaG93TWFueSxcbiAgICAgICAgICAgIGNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX21hcmtDaGFuZ2UocGFyZW50LCBjaGFuZ2VJdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNhdmVzIGFuZCBoYW5kbGVzIGEgcmVtb3ZlIGNoYW5nZS5cblx0ICovIF9tYXJrUmVtb3ZlKHBhcmVudCwgb2Zmc2V0LCBob3dNYW55KSB7XG4gICAgICAgIGlmIChwYXJlbnQucm9vdC5pcygncm9vdEVsZW1lbnQnKSAmJiAhcGFyZW50LnJvb3QuX2lzTG9hZGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlSXRlbSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdyZW1vdmUnLFxuICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgaG93TWFueSxcbiAgICAgICAgICAgIGNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX21hcmtDaGFuZ2UocGFyZW50LCBjaGFuZ2VJdGVtKTtcbiAgICAgICAgdGhpcy5fcmVtb3ZlQWxsTmVzdGVkQ2hhbmdlcyhwYXJlbnQsIG9mZnNldCwgaG93TWFueSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTYXZlcyBhbmQgaGFuZGxlcyBhbiBhdHRyaWJ1dGUgY2hhbmdlLlxuXHQgKi8gX21hcmtBdHRyaWJ1dGUoaXRlbSkge1xuICAgICAgICBpZiAoaXRlbS5yb290LmlzKCdyb290RWxlbWVudCcpICYmICFpdGVtLnJvb3QuX2lzTG9hZGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlSXRlbSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdhdHRyaWJ1dGUnLFxuICAgICAgICAgICAgb2Zmc2V0OiBpdGVtLnN0YXJ0T2Zmc2V0LFxuICAgICAgICAgICAgaG93TWFueTogaXRlbS5vZmZzZXRTaXplLFxuICAgICAgICAgICAgY291bnQ6IHRoaXMuX2NoYW5nZUNvdW50KytcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fbWFya0NoYW5nZShpdGVtLnBhcmVudCwgY2hhbmdlSXRlbSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTYXZlcyBhbmQgaGFuZGxlcyBhIG1vZGVsIGNoYW5nZS5cblx0ICovIF9tYXJrQ2hhbmdlKHBhcmVudCwgY2hhbmdlSXRlbSkge1xuICAgICAgICAvLyBGaXJzdCwgbWFrZSBhIHNuYXBzaG90IG9mIHRoZSBwYXJlbnQgYW5kIGl0cyBjaGlsZHJlbiAoaXQgd2lsbCBiZSBtYWRlIG9ubHkgaWYgaXQgd2FzIG5vdCBtYWRlIGJlZm9yZSkuXG4gICAgICAgIHRoaXMuX21ha2VTbmFwc2hvdHMocGFyZW50KTtcbiAgICAgICAgLy8gVGhlbiwgZ2V0IGFsbCBjaGFuZ2VzIHRoYXQgYWxyZWFkeSB3ZXJlIGRvbmUgb24gdGhlIGVsZW1lbnQgKGVtcHR5IGFycmF5IGlmIHRoaXMgaXMgdGhlIGZpcnN0IGNoYW5nZSkuXG4gICAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLl9nZXRDaGFuZ2VzRm9yRWxlbWVudChwYXJlbnQpO1xuICAgICAgICAvLyBUaGVuLCBsb29rIHRocm91Z2ggYWxsIHRoZSBjaGFuZ2VzLCBhbmQgdHJhbnNmb3JtIHRoZW0gb3IgdGhlIG5ldyBjaGFuZ2UuXG4gICAgICAgIHRoaXMuX2hhbmRsZUNoYW5nZShjaGFuZ2VJdGVtLCBjaGFuZ2VzKTtcbiAgICAgICAgLy8gQWRkIHRoZSBuZXcgY2hhbmdlLlxuICAgICAgICBjaGFuZ2VzLnB1c2goY2hhbmdlSXRlbSk7XG4gICAgICAgIC8vIFJlbW92ZSBpbmNvcnJlY3QgY2hhbmdlcy4gRHVyaW5nIHRyYW5zZm9ybWF0aW9uIHNvbWUgY2hhbmdlIG1pZ2h0IGJlLCBmb3IgZXhhbXBsZSwgaW5jbHVkZWQgaW4gYW5vdGhlci5cbiAgICAgICAgLy8gSW4gdGhhdCBjYXNlLCB0aGUgY2hhbmdlIHdpbGwgaGF2ZSBgaG93TWFueWAgcHJvcGVydHkgc2V0IHRvIGAwYCBvciBsZXNzLiBXZSBuZWVkIHRvIHJlbW92ZSB0aG9zZSBjaGFuZ2VzLlxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2hhbmdlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBpZiAoY2hhbmdlc1tpXS5ob3dNYW55IDwgMSkge1xuICAgICAgICAgICAgICAgIGNoYW5nZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogVHJpZXMgdG8gc2V0IGdpdmVuIHN0YXRlIGZvciBnaXZlbiBpdGVtLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBkb2VzIHNpbXBsZSB2YWxpZGF0aW9uIChpdCBzZXRzIHRoZSBzdGF0ZSBvbmx5IGZvciBtb2RlbCBlbGVtZW50cywgbm90IGZvciB0ZXh0IHByb3h5IG5vZGVzKS4gSXQgYWxzbyBmb2xsb3dzIHN0YXRlXG5cdCAqIHNldHRpbmcgcnVsZXMsIHRoYXQgaXMsIGAncmVmcmVzaCdgIGNhbm5vdCBvdmVyd3JpdGUgYCdyZW5hbWUnYCwgYW5kIGAncmVuYW1lJ2AgY2Fubm90IG92ZXJ3cml0ZSBgJ21vdmUnYC5cblx0ICovIF9zZXRFbGVtZW50U3RhdGUobm9kZSwgc3RhdGUpIHtcbiAgICAgICAgaWYgKCFub2RlLmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50U3RhdGVQcmlvcml0eSA9IERpZmZlci5fc3RhdGVzUHJpb3JpdHkuaW5kZXhPZih0aGlzLl9lbGVtZW50U3RhdGUuZ2V0KG5vZGUpKTtcbiAgICAgICAgY29uc3QgbmV3U3RhdGVQcmlvcml0eSA9IERpZmZlci5fc3RhdGVzUHJpb3JpdHkuaW5kZXhPZihzdGF0ZSk7XG4gICAgICAgIGlmIChuZXdTdGF0ZVByaW9yaXR5ID4gY3VycmVudFN0YXRlUHJpb3JpdHkpIHtcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnRTdGF0ZS5zZXQobm9kZSwgc3RhdGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgdmFsdWUgZm9yIHtAbGluayB+RGlmZmVySXRlbUFjdGlvbiBgYWN0aW9uYH0gcHJvcGVydHkgZm9yIGRpZmYgaXRlbXMgcmV0dXJuZWQgYnkge0BsaW5rIH5EaWZmZXIjZ2V0Q2hhbmdlc30uXG5cdCAqIFRoaXMgbWV0aG9kIGFpbXMgdG8gcmV0dXJuIGAncmVuYW1lJ2Agb3IgYCdyZWZyZXNoJ2Agd2hlbiBpdCBzaG91bGQsIGFuZCBgZGlmZkl0ZW1UeXBlYCAoXCJkZWZhdWx0IGFjdGlvblwiKSBpbiBhbGwgb3RoZXIgY2FzZXMuXG5cdCAqXG5cdCAqIEl0IGJhc2VzIG9uIGEgZmV3IGZhY3RvcnM6XG5cdCAqXG5cdCAqICogZm9yIHRleHQgbm9kZXMsIHRoZSBtZXRob2QgYWx3YXlzIHJldHVybnMgYGRpZmZJdGVtVHlwZWAsXG5cdCAqICogZm9yIG5ld2x5IGluc2VydGVkIGVsZW1lbnQsIHRoZSBtZXRob2QgcmV0dXJucyBgZGlmZkl0ZW1UeXBlYCxcblx0ICogKiBpZiB7QGxpbmsgfkRpZmZlciNfZWxlbWVudFN0YXRlIGVsZW1lbnQgc3RhdGV9IHdhcyBub3QgcmVjb3JkZWQsIHRoZSBtZXRob2QgcmV0dXJucyBgZGlmZkl0ZW1UeXBlYCxcblx0ICogKiBpZiBzdGF0ZSB3YXMgcmVjb3JkZWQsIGFuZCBpdCB3YXMgYCdtb3ZlJ2AgKGRlZmF1bHQgYWN0aW9uKSwgdGhlIG1ldGhvZCByZXR1cm5zIGBkaWZmSXRlbVR5cGVgLFxuXHQgKiAqIGZpbmFsbHksIGlmIHN0YXRlIHdhcyBgJ3JlZnJlc2gnYCBvciBgJ3JlbmFtZSdgLCB0aGUgbWV0aG9kIHJldHVybnMgdGhlIHN0YXRlIHZhbHVlLlxuXHQgKi8gX2dldERpZmZBY3Rpb25Gb3JOb2RlKG5vZGUsIGRpZmZJdGVtVHlwZSkge1xuICAgICAgICBpZiAoIW5vZGUuaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgLy8gVGV4dCBub2RlLlxuICAgICAgICAgICAgcmV0dXJuIGRpZmZJdGVtVHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2VsZW1lbnRzU25hcHNob3RzLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgLy8gTmV3bHkgaW5zZXJ0ZWQgZWxlbWVudC5cbiAgICAgICAgICAgIHJldHVybiBkaWZmSXRlbVR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLl9lbGVtZW50U3RhdGUuZ2V0KG5vZGUpO1xuICAgICAgICBpZiAoIXN0YXRlIHx8IHN0YXRlID09ICdtb3ZlJykge1xuICAgICAgICAgICAgcmV0dXJuIGRpZmZJdGVtVHlwZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGFuIGFycmF5IG9mIGNoYW5nZXMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiBzYXZlZCBmb3IgYSBnaXZlbiBlbGVtZW50LlxuXHQgKi8gX2dldENoYW5nZXNGb3JFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGNoYW5nZXM7XG4gICAgICAgIGlmICh0aGlzLl9jaGFuZ2VzSW5FbGVtZW50LmhhcyhlbGVtZW50KSkge1xuICAgICAgICAgICAgY2hhbmdlcyA9IHRoaXMuX2NoYW5nZXNJbkVsZW1lbnQuZ2V0KGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2hhbmdlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fY2hhbmdlc0luRWxlbWVudC5zZXQoZWxlbWVudCwgY2hhbmdlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuZCBzYXZlcyBhIHNuYXBzaG90IGZvciBhbGwgY2hpbGRyZW4gb2YgdGhlIGdpdmVuIGVsZW1lbnQuXG5cdCAqLyBfbWFrZVNuYXBzaG90cyhlbGVtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9lbGVtZW50Q2hpbGRyZW5TbmFwc2hvdHMuaGFzKGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGRyZW5TbmFwc2hvdHMgPSBfZ2V0Q2hpbGRyZW5TbmFwc2hvdHMoZWxlbWVudC5nZXRDaGlsZHJlbigpKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudENoaWxkcmVuU25hcHNob3RzLnNldChlbGVtZW50LCBjaGlsZHJlblNuYXBzaG90cyk7XG4gICAgICAgIGZvciAoY29uc3Qgc25hcHNob3Qgb2YgY2hpbGRyZW5TbmFwc2hvdHMpe1xuICAgICAgICAgICAgdGhpcy5fZWxlbWVudHNTbmFwc2hvdHMuc2V0KHNuYXBzaG90Lm5vZGUsIHNuYXBzaG90KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogRm9yIGEgZ2l2ZW4gbmV3bHkgc2F2ZWQgY2hhbmdlLCBjb21wYXJlcyBpdCB3aXRoIGEgY2hhbmdlIGFscmVhZHkgZG9uZSBvbiB0aGUgZWxlbWVudCBhbmQgbW9kaWZpZXMgdGhlIGluY29taW5nXG5cdCAqIGNoYW5nZSBhbmQvb3IgdGhlIG9sZCBjaGFuZ2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBpbmMgSW5jb21pbmcgKG5ldykgY2hhbmdlLlxuXHQgKiBAcGFyYW0gY2hhbmdlcyBBbiBhcnJheSBjb250YWluaW5nIGFsbCB0aGUgY2hhbmdlcyBkb25lIG9uIHRoYXQgZWxlbWVudC5cblx0ICovIF9oYW5kbGVDaGFuZ2UoaW5jLCBjaGFuZ2VzKSB7XG4gICAgICAgIC8vIFdlIG5lZWQgYSBoZWxwZXIgdmFyaWFibGUgdGhhdCB3aWxsIHN0b3JlIGhvdyBtYW55IG5vZGVzIGFyZSB0byBiZSBzdGlsbCBoYW5kbGVkIGZvciB0aGlzIGNoYW5nZSBpdGVtLlxuICAgICAgICAvLyBgbm9kZXNUb0hhbmRsZWAgKGhvdyBtYW55IG5vZGVzIHN0aWxsIG5lZWQgdG8gYmUgaGFuZGxlZCkgYW5kIGBob3dNYW55YCAoaG93IG1hbnkgbm9kZXMgd2VyZSBhZmZlY3RlZClcbiAgICAgICAgLy8gbmVlZHMgdG8gYmUgZGlmZmVyZW50aWF0ZWQuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoaXMgY29tZXMgdXAgd2hlbiB0aGVyZSBhcmUgbXVsdGlwbGUgY2hhbmdlcyB0aGF0IGFyZSBhZmZlY3RlZCBieSBgaW5jYCBjaGFuZ2UgaXRlbS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gRm9yIGV4YW1wbGU6IGFzc3VtZSB0d28gaW5zZXJ0IGNoYW5nZXM6IGB7IG9mZnNldDogMiwgaG93TWFueTogMSB9YCBhbmQgYHsgb2Zmc2V0OiA1LCBob3dNYW55OiAxIH1gLlxuICAgICAgICAvLyBBc3N1bWUgdGhhdCBgaW5jYCBjaGFuZ2UgaXMgcmVtb3ZlIGB7IG9mZnNldDogMiwgaG93TWFueTogMiwgbm9kZXNUb0hhbmRsZTogMiB9YC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhlbiwgd2U6XG4gICAgICAgIC8vIC0gXCJmb3JnZXRcIiBhYm91dCBmaXJzdCBpbnNlcnQgY2hhbmdlIChpdCBpcyBcImVhdGVuXCIgYnkgcmVtb3ZlKSxcbiAgICAgICAgLy8gLSBiZWNhdXNlIG9mIHRoYXQsIGF0IHRoZSBlbmQgd2Ugd2lsbCB3YW50IHRvIHJlbW92ZSBvbmx5IG9uZSBub2RlIChgbm9kZXNUb0hhbmRsZSA9IDFgKSxcbiAgICAgICAgLy8gLSBidXQgc3RpbGwgd2UgaGF2ZSB0byBjaGFuZ2Ugb2Zmc2V0IG9mIHRoZSBzZWNvbmQgaW5zZXJ0IGNoYW5nZSBmcm9tIGA1YCB0byBgM2AhXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNvLCBgaG93TWFueWAgZG9lcyBub3QgY2hhbmdlIHRocm91Z2hvdXQgaXRlbXMgdHJhbnNmb3JtYXRpb24gYW5kIGtlZXBzIGluZm9ybWF0aW9uIGFib3V0IGhvdyBtYW55IG5vZGVzIHdlcmUgYWZmZWN0ZWQsXG4gICAgICAgIC8vIHdoaWxlIGBub2Rlc1RvSGFuZGxlYCBtZWFucyBob3cgbWFueSBub2RlcyBuZWVkIHRvIGJlIGhhbmRsZWQgYWZ0ZXIgdGhlIGNoYW5nZSBpdGVtIGlzIHRyYW5zZm9ybWVkIGJ5IG90aGVyIGNoYW5nZXMuXG4gICAgICAgIGluYy5ub2Rlc1RvSGFuZGxlID0gaW5jLmhvd01hbnk7XG4gICAgICAgIGZvciAoY29uc3Qgb2xkIG9mIGNoYW5nZXMpe1xuICAgICAgICAgICAgY29uc3QgaW5jRW5kID0gaW5jLm9mZnNldCArIGluYy5ob3dNYW55O1xuICAgICAgICAgICAgY29uc3Qgb2xkRW5kID0gb2xkLm9mZnNldCArIG9sZC5ob3dNYW55O1xuICAgICAgICAgICAgaWYgKGluYy50eXBlID09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9sZC50eXBlID09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmMub2Zmc2V0IDw9IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZC5vZmZzZXQgKz0gaW5jLmhvd01hbnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5jLm9mZnNldCA8IG9sZEVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLmhvd01hbnkgKz0gaW5jLm5vZGVzVG9IYW5kbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmMubm9kZXNUb0hhbmRsZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9sZC50eXBlID09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmMub2Zmc2V0IDwgb2xkLm9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLm9mZnNldCArPSBpbmMuaG93TWFueTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob2xkLnR5cGUgPT0gJ2F0dHJpYnV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYy5vZmZzZXQgPD0gb2xkLm9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLm9mZnNldCArPSBpbmMuaG93TWFueTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmMub2Zmc2V0IDwgb2xkRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGNhc2UgaXMgbW9yZSBjb21wbGljYXRlZCwgYmVjYXVzZSBhdHRyaWJ1dGUgY2hhbmdlIGhhcyB0byBiZSBzcGxpdCBpbnRvIHR3by5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4YW1wbGUgKGFzc3VtZSB0aGF0IHVwcGVyY2FzZSBhbmQgbG93ZXJjYXNlIGxldHRlcnMgbWVhbiBkaWZmZXJlbnQgYXR0cmlidXRlcyk6XG4gICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5pdGlhbCBzdGF0ZTpcdFx0YWJjeHl6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhdHRyaWJ1dGUgY2hhbmdlOlx0YUJDWFl6XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbmNvbWluZyBpbnNlcnQ6XHRcdGFCQ2Zvb1hZelxuICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoYW5nZSByYW5nZXMgY2Fubm90IGludGVyc2VjdCBiZWNhdXNlIGVhY2ggaXRlbSBoYXMgdG8gYmUgZGVzY3JpYmVkIGV4YWN0bHkgKGl0IHdhcyBlaXRoZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vdCBjaGFuZ2VkLCBpbnNlcnRlZCwgcmVtb3ZlZCwgb3IgaXRzIGF0dHJpYnV0ZSB3YXMgY2hhbmdlZCkuIFRoYXQncyB3aHkgb2xkIGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIGhhcyB0byBiZSBzcGxpdCBhbmQgYm90aCBwYXJ0cyBoYXMgdG8gYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGZyb20gbm93IG9uLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaG93TWFueSA9IG9sZC5ob3dNYW55O1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLmhvd01hbnkgPSBpbmMub2Zmc2V0IC0gb2xkLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgc2Vjb25kIHBhcnQgb2YgYXR0cmlidXRlIGNoYW5nZSB0byB0aGUgYmVnaW5uaW5nIG9mIHByb2Nlc3NlZCBhcnJheSBzbyBpdCB3b24ndFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmUgcHJvY2Vzc2VkIGFnYWluIGluIHRoaXMgbG9vcC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZXMudW5zaGlmdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2F0dHJpYnV0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBpbmNFbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG93TWFueTogaG93TWFueSAtIG9sZC5ob3dNYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbmMudHlwZSA9PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgICAgIGlmIChvbGQudHlwZSA9PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5jRW5kIDw9IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZC5vZmZzZXQgLT0gaW5jLmhvd01hbnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5jRW5kIDw9IG9sZEVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluYy5vZmZzZXQgPCBvbGQub2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uTGVuZ3RoID0gaW5jRW5kIC0gb2xkLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQub2Zmc2V0ID0gaW5jLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQuaG93TWFueSAtPSBpbnRlcnNlY3Rpb25MZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jLm5vZGVzVG9IYW5kbGUgLT0gaW50ZXJzZWN0aW9uTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQuaG93TWFueSAtPSBpbmMubm9kZXNUb0hhbmRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmMubm9kZXNUb0hhbmRsZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5jLm9mZnNldCA8PSBvbGQub2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jLm5vZGVzVG9IYW5kbGUgLT0gb2xkLmhvd01hbnk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2xkLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmMub2Zmc2V0IDwgb2xkRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW50ZXJzZWN0aW9uTGVuZ3RoID0gb2xkRW5kIC0gaW5jLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQuaG93TWFueSAtPSBpbnRlcnNlY3Rpb25MZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jLm5vZGVzVG9IYW5kbGUgLT0gaW50ZXJzZWN0aW9uTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvbGQudHlwZSA9PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5jRW5kIDw9IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZC5vZmZzZXQgLT0gaW5jLmhvd01hbnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5jLm9mZnNldCA8IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5ub2Rlc1RvSGFuZGxlICs9IG9sZC5ob3dNYW55O1xuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvbGQudHlwZSA9PSAnYXR0cmlidXRlJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5jRW5kIDw9IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZC5vZmZzZXQgLT0gaW5jLmhvd01hbnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5jLm9mZnNldCA8IG9sZC5vZmZzZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGludGVyc2VjdGlvbkxlbmd0aCA9IGluY0VuZCAtIG9sZC5vZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbGQub2Zmc2V0ID0gaW5jLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZC5ob3dNYW55IC09IGludGVyc2VjdGlvbkxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmMub2Zmc2V0IDwgb2xkRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5jRW5kIDw9IG9sZEVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9uIGZpcnN0IHNpZ2h0IGluIHRoaXMgY2FzZSB3ZSBkb24ndCBuZWVkIHRvIHNwbGl0IGF0dHJpYnV0ZSBvcGVyYXRpb24gaW50byB0d28uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93ZXZlciB0aGUgY2hhbmdlcyBzZXQgaXMgbGF0ZXIgY29udmVydGVkIHRvIGFjdGlvbnMgKHNlZSBgX2dlbmVyYXRlQWN0aW9uc0Zyb21DaGFuZ2VzYCkuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIHRoYXQgcmVhc29uLCBubyB0d28gY2hhbmdlcyBtYXkgaW50ZXJzZWN0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvIHdlIGNhbm5vdCBoYXZlIGFuIGF0dHJpYnV0ZSBjaGFuZ2UgdGhhdCBcImNvbnRhaW5zXCIgcmVtb3ZlIGNoYW5nZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBdHRyaWJ1dGUgY2hhbmdlIG5lZWRzIHRvIGJlIHNwbGl0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvd01hbnkgPSBvbGQuaG93TWFueTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQuaG93TWFueSA9IGluYy5vZmZzZXQgLSBvbGQub2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhvd01hbnlBZnRlciA9IGhvd01hbnkgLSBvbGQuaG93TWFueSAtIGluYy5ub2Rlc1RvSGFuZGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgc2Vjb25kIHBhcnQgb2YgYXR0cmlidXRlIGNoYW5nZSB0byB0aGUgYmVnaW5uaW5nIG9mIHByb2Nlc3NlZCBhcnJheSBzbyBpdCB3b24ndFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlIHByb2Nlc3NlZCBhZ2FpbiBpbiB0aGlzIGxvb3AuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlcy51bnNoaWZ0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2F0dHJpYnV0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogaW5jLm9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG93TWFueTogaG93TWFueUFmdGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5fY2hhbmdlQ291bnQrK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGQuaG93TWFueSAtPSBvbGRFbmQgLSBpbmMub2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGluYy50eXBlID09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgICAgICAgICAgLy8gSW4gY2FzZSBvZiBhdHRyaWJ1dGUgY2hhbmdlLCBgaG93TWFueWAgc2hvdWxkIGJlIGtlcHQgc2FtZSBhcyBgbm9kZXNUb0hhbmRsZWAuIEl0J3Mgbm90IGFuIGVycm9yLlxuICAgICAgICAgICAgICAgIGlmIChvbGQudHlwZSA9PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5jLm9mZnNldCA8IG9sZC5vZmZzZXQgJiYgaW5jRW5kID4gb2xkLm9mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluY0VuZCA+IG9sZEVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FzZSBpcyBzaW1pbGFyIHRvIGEgY2FzZSBkZXNjcmliZWQgd2hlbiBpbmNvbWluZyBjaGFuZ2Ugd2FzIGluc2VydCBhbmQgb2xkIGNoYW5nZSB3YXMgYXR0cmlidXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlZSBjb21tZW50IGFib3ZlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB0aW1lIGluY29taW5nIGNoYW5nZSBpcyBhdHRyaWJ1dGUuIFdlIG5lZWQgdG8gc3BsaXQgaW5jb21pbmcgY2hhbmdlIGluIHRoaXMgY2FzZSB0b28uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93ZXZlciB0aGlzIHRpbWUsIHRoZSBzZWNvbmQgcGFydCBvZiB0aGUgYXR0cmlidXRlIGNoYW5nZSBuZWVkcyB0byBiZSBwcm9jZXNzZWQgZnVydGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgdGhlcmUgbWlnaHQgYmUgb3RoZXIgY2hhbmdlcyB0aGF0IGl0IGNvbGxpZGVzIHdpdGguXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlUGFydCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2F0dHJpYnV0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogb2xkRW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3dNYW55OiBpbmNFbmQgLSBvbGRFbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVDaGFuZ2UoYXR0cmlidXRlUGFydCwgY2hhbmdlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlcy5wdXNoKGF0dHJpYnV0ZVBhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaW5jLm5vZGVzVG9IYW5kbGUgPSBvbGQub2Zmc2V0IC0gaW5jLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5ob3dNYW55ID0gaW5jLm5vZGVzVG9IYW5kbGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5jLm9mZnNldCA+PSBvbGQub2Zmc2V0ICYmIGluYy5vZmZzZXQgPCBvbGRFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmNFbmQgPiBvbGRFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmMubm9kZXNUb0hhbmRsZSA9IGluY0VuZCAtIG9sZEVuZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmMub2Zmc2V0ID0gb2xkRW5kO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmMubm9kZXNUb0hhbmRsZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9sZC50eXBlID09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBjYXNlIHdoZW4gYXR0cmlidXRlIGNoYW5nZSBcImNvbnRhaW5zXCIgcmVtb3ZlIGNoYW5nZS5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGF0dHJpYnV0ZSBjaGFuZ2UgbmVlZHMgdG8gYmUgc3BsaXQgaW50byB0d28gYmVjYXVzZSBjaGFuZ2VzIGNhbm5vdCBpbnRlcnNlY3QuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmMub2Zmc2V0IDwgb2xkLm9mZnNldCAmJiBpbmNFbmQgPiBvbGQub2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVQYXJ0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhdHRyaWJ1dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogb2xkLm9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3dNYW55OiBpbmNFbmQgLSBvbGQub2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hhbmdlKGF0dHJpYnV0ZVBhcnQsIGNoYW5nZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlcy5wdXNoKGF0dHJpYnV0ZVBhcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5jLm5vZGVzVG9IYW5kbGUgPSBvbGQub2Zmc2V0IC0gaW5jLm9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5ob3dNYW55ID0gaW5jLm5vZGVzVG9IYW5kbGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG9sZC50eXBlID09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBvbmx5IHR3byBjb25mbGljdGluZyBzY2VuYXJpb3MgcG9zc2libGUgaGVyZTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYy5vZmZzZXQgPj0gb2xkLm9mZnNldCAmJiBpbmNFbmQgPD0gb2xkRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBgb2xkYCBjaGFuZ2UgaW5jbHVkZXMgYGluY2AgY2hhbmdlLCBvciB0aGV5IGFyZSB0aGUgc2FtZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5ub2Rlc1RvSGFuZGxlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5ob3dNYW55ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYy5vZmZzZXQgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluYy5vZmZzZXQgPD0gb2xkLm9mZnNldCAmJiBpbmNFbmQgPj0gb2xkRW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBgaW5jYCBjaGFuZ2UgaW5jbHVkZXMgYG9sZGAgY2hhbmdlLlxuICAgICAgICAgICAgICAgICAgICAgICAgb2xkLmhvd01hbnkgPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGluYy5ob3dNYW55ID0gaW5jLm5vZGVzVG9IYW5kbGU7XG4gICAgICAgIGRlbGV0ZSBpbmMubm9kZXNUb0hhbmRsZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggYSBzaW5nbGUgaW5zZXJ0IGNoYW5nZSBkZXNjcmlwdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHBhcmVudCBUaGUgZWxlbWVudCBpbiB3aGljaCB0aGUgY2hhbmdlIGhhcHBlbmVkLlxuXHQgKiBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgYXQgd2hpY2ggY2hhbmdlIGhhcHBlbmVkLlxuXHQgKiBAcGFyYW0gYWN0aW9uIEZ1cnRoZXIgc3BlY2lmaWVzIHdoYXQga2luZCBvZiBhY3Rpb24gbGVkIHRvIGdlbmVyYXRpbmcgdGhpcyBjaGFuZ2UuXG5cdCAqIEBwYXJhbSBlbGVtZW50U25hcHNob3QgU25hcHNob3Qgb2YgdGhlIGluc2VydGVkIG5vZGUgYWZ0ZXIgY2hhbmdlcy5cblx0ICogQHBhcmFtIGVsZW1lbnRTbmFwc2hvdEJlZm9yZSBTbmFwc2hvdCBvZiB0aGUgaW5zZXJ0ZWQgbm9kZSBiZWZvcmUgY2hhbmdlcy5cblx0ICogQHJldHVybnMgVGhlIGRpZmYgaXRlbS5cblx0ICovIF9nZXRJbnNlcnREaWZmKHBhcmVudCwgb2Zmc2V0LCBhY3Rpb24sIGVsZW1lbnRTbmFwc2hvdCwgZWxlbWVudFNuYXBzaG90QmVmb3JlKSB7XG4gICAgICAgIGNvbnN0IGRpZmZJdGVtID0ge1xuICAgICAgICAgICAgdHlwZTogJ2luc2VydCcsXG4gICAgICAgICAgICBwb3NpdGlvbjogUG9zaXRpb24uX2NyZWF0ZUF0KHBhcmVudCwgb2Zmc2V0KSxcbiAgICAgICAgICAgIG5hbWU6IGVsZW1lbnRTbmFwc2hvdC5uYW1lLFxuICAgICAgICAgICAgYXR0cmlidXRlczogbmV3IE1hcChlbGVtZW50U25hcHNob3QuYXR0cmlidXRlcyksXG4gICAgICAgICAgICBsZW5ndGg6IDEsXG4gICAgICAgICAgICBjaGFuZ2VDb3VudDogdGhpcy5fY2hhbmdlQ291bnQrKyxcbiAgICAgICAgICAgIGFjdGlvblxuICAgICAgICB9O1xuICAgICAgICBpZiAoYWN0aW9uICE9ICdpbnNlcnQnICYmIGVsZW1lbnRTbmFwc2hvdEJlZm9yZSkge1xuICAgICAgICAgICAgZGlmZkl0ZW0uYmVmb3JlID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IGVsZW1lbnRTbmFwc2hvdEJlZm9yZS5uYW1lLFxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IG5ldyBNYXAoZWxlbWVudFNuYXBzaG90QmVmb3JlLmF0dHJpYnV0ZXMpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkaWZmSXRlbTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gb2JqZWN0IHdpdGggYSBzaW5nbGUgcmVtb3ZlIGNoYW5nZSBkZXNjcmlwdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIHBhcmVudCBUaGUgZWxlbWVudCBpbiB3aGljaCBjaGFuZ2UgaGFwcGVuZWQuXG5cdCAqIEBwYXJhbSBvZmZzZXQgVGhlIG9mZnNldCBhdCB3aGljaCBjaGFuZ2UgaGFwcGVuZWQuXG5cdCAqIEBwYXJhbSBhY3Rpb24gRnVydGhlciBzcGVjaWZpZXMgd2hhdCBraW5kIG9mIGFjdGlvbiBsZWQgdG8gZ2VuZXJhdGluZyB0aGlzIGNoYW5nZS5cblx0ICogQHBhcmFtIGVsZW1lbnRTbmFwc2hvdCBUaGUgc25hcHNob3Qgb2YgdGhlIHJlbW92ZWQgbm9kZSBiZWZvcmUgY2hhbmdlcy5cblx0ICogQHJldHVybnMgVGhlIGRpZmYgaXRlbS5cblx0ICovIF9nZXRSZW1vdmVEaWZmKHBhcmVudCwgb2Zmc2V0LCBhY3Rpb24sIGVsZW1lbnRTbmFwc2hvdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogJ3JlbW92ZScsXG4gICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICBwb3NpdGlvbjogUG9zaXRpb24uX2NyZWF0ZUF0KHBhcmVudCwgb2Zmc2V0KSxcbiAgICAgICAgICAgIG5hbWU6IGVsZW1lbnRTbmFwc2hvdC5uYW1lLFxuICAgICAgICAgICAgYXR0cmlidXRlczogbmV3IE1hcChlbGVtZW50U25hcHNob3QuYXR0cmlidXRlcyksXG4gICAgICAgICAgICBsZW5ndGg6IDEsXG4gICAgICAgICAgICBjaGFuZ2VDb3VudDogdGhpcy5fY2hhbmdlQ291bnQrK1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSBvZiBvYmplY3RzIHdoZXJlIGVhY2ggb25lIGlzIGEgc2luZ2xlIGF0dHJpYnV0ZSBjaGFuZ2UgZGVzY3JpcHRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSByYW5nZSBUaGUgcmFuZ2Ugd2hlcmUgdGhlIGNoYW5nZSBoYXBwZW5lZC5cblx0ICogQHBhcmFtIG9sZEF0dHJpYnV0ZXMgQSBtYXAsIG1hcCBpdGVyYXRvciBvciBjb21wYXRpYmxlIG9iamVjdCB0aGF0IGNvbnRhaW5zIGF0dHJpYnV0ZXMgYmVmb3JlIHRoZSBjaGFuZ2UuXG5cdCAqIEBwYXJhbSBuZXdBdHRyaWJ1dGVzIEEgbWFwLCBtYXAgaXRlcmF0b3Igb3IgY29tcGF0aWJsZSBvYmplY3QgdGhhdCBjb250YWlucyBhdHRyaWJ1dGVzIGFmdGVyIHRoZSBjaGFuZ2UuXG5cdCAqIEByZXR1cm5zIEFuIGFycmF5IGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgZGlmZiBpdGVtcy5cblx0ICovIF9nZXRBdHRyaWJ1dGVzRGlmZihyYW5nZSwgb2xkQXR0cmlidXRlcywgbmV3QXR0cmlidXRlcykge1xuICAgICAgICAvLyBSZXN1bHRzIGhvbGRlci5cbiAgICAgICAgY29uc3QgZGlmZnMgPSBbXTtcbiAgICAgICAgLy8gQ2xvbmUgbmV3IGF0dHJpYnV0ZXMgYXMgd2Ugd2lsbCBiZSBwZXJmb3JtaW5nIGNoYW5nZXMgb24gdGhpcyBvYmplY3QuXG4gICAgICAgIG5ld0F0dHJpYnV0ZXMgPSBuZXcgTWFwKG5ld0F0dHJpYnV0ZXMpO1xuICAgICAgICAvLyBMb29rIHRocm91Z2ggb2xkIGF0dHJpYnV0ZXMuXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgb2xkVmFsdWVdIG9mIG9sZEF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgLy8gQ2hlY2sgd2hhdCBpcyB0aGUgbmV3IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUgKG9yIGlmIGl0IHdhcyByZW1vdmVkKS5cbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gbmV3QXR0cmlidXRlcy5oYXMoa2V5KSA/IG5ld0F0dHJpYnV0ZXMuZ2V0KGtleSkgOiBudWxsO1xuICAgICAgICAgICAgLy8gSWYgdmFsdWVzIGFyZSBkaWZmZXJlbnQgKG9yIGF0dHJpYnV0ZSB3YXMgcmVtb3ZlZCkuLi5cbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGQgZGlmZiBpdGVtLlxuICAgICAgICAgICAgICAgIGRpZmZzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYXR0cmlidXRlJyxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJhbmdlLnN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICByYW5nZTogcmFuZ2UuY2xvbmUoKSxcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVLZXk6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IG9sZFZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOZXdWYWx1ZTogbmV3VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBQcmV2ZW50IHJldHVybmluZyB0d28gZGlmZiBpdGVtcyBmb3IgdGhlIHNhbWUgY2hhbmdlLlxuICAgICAgICAgICAgbmV3QXR0cmlidXRlcy5kZWxldGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBMb29rIHRocm91Z2ggbmV3IGF0dHJpYnV0ZXMgdGhhdCB3ZXJlbid0IGhhbmRsZWQgYWJvdmUuXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgbmV3VmFsdWVdIG9mIG5ld0F0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgLy8gRWFjaCBvZiB0aGVtIGlzIGEgbmV3IGF0dHJpYnV0ZS4gQWRkIGRpZmYgaXRlbS5cbiAgICAgICAgICAgIGRpZmZzLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdhdHRyaWJ1dGUnLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiByYW5nZS5zdGFydCxcbiAgICAgICAgICAgICAgICByYW5nZTogcmFuZ2UuY2xvbmUoKSxcbiAgICAgICAgICAgICAgICBsZW5ndGg6IDEsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IG51bGwsXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmV3VmFsdWU6IG5ld1ZhbHVlLFxuICAgICAgICAgICAgICAgIGNoYW5nZUNvdW50OiB0aGlzLl9jaGFuZ2VDb3VudCsrXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlmZnM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBnaXZlbiBlbGVtZW50IG9yIGFueSBvZiBpdHMgcGFyZW50cyBpcyBhbiBlbGVtZW50IHRoYXQgaXMgYnVmZmVyZWQgYXMgYW4gaW5zZXJ0ZWQgZWxlbWVudC5cblx0ICovIF9pc0luSW5zZXJ0ZWRFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgcGFyZW50ID0gZWxlbWVudC5wYXJlbnQ7XG4gICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlcyA9IHRoaXMuX2NoYW5nZXNJbkVsZW1lbnQuZ2V0KHBhcmVudCk7XG4gICAgICAgIGNvbnN0IG9mZnNldCA9IGVsZW1lbnQuc3RhcnRPZmZzZXQ7XG4gICAgICAgIGlmIChjaGFuZ2VzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoYW5nZSBvZiBjaGFuZ2VzKXtcbiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT0gJ2luc2VydCcgJiYgb2Zmc2V0ID49IGNoYW5nZS5vZmZzZXQgJiYgb2Zmc2V0IDwgY2hhbmdlLm9mZnNldCArIGNoYW5nZS5ob3dNYW55KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5faXNJbkluc2VydGVkRWxlbWVudChwYXJlbnQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBkZWVwbHkgYWxsIGJ1ZmZlcmVkIGNoYW5nZXMgdGhhdCBhcmUgcmVnaXN0ZXJlZCBpbiBlbGVtZW50cyBmcm9tIHJhbmdlIHNwZWNpZmllZCBieSBgcGFyZW50YCwgYG9mZnNldGBcblx0ICogYW5kIGBob3dNYW55YC5cblx0ICovIF9yZW1vdmVBbGxOZXN0ZWRDaGFuZ2VzKHBhcmVudCwgb2Zmc2V0LCBob3dNYW55KSB7XG4gICAgICAgIGNvbnN0IHJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVBdChwYXJlbnQsIG9mZnNldCksIFBvc2l0aW9uLl9jcmVhdGVBdChwYXJlbnQsIG9mZnNldCArIGhvd01hbnkpKTtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZXNJbkVsZW1lbnQuZGVsZXRlKGl0ZW0pO1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUFsbE5lc3RlZENoYW5nZXMoaXRlbSwgMCwgaXRlbS5tYXhPZmZzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGEgc25hcHNob3QgZm9yIHRoZSBzcGVjaWZpZWQgY2hpbGQgbm9kZS4gVGV4dCBub2RlIHNuYXBzaG90cyBoYXZlIHRoZSBgbmFtZWAgcHJvcGVydHkgc2V0IHRvIGAkdGV4dGAuXG4gKi8gZnVuY3Rpb24gX2dldFNpbmdsZU5vZGVTbmFwc2hvdChub2RlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZSxcbiAgICAgICAgbmFtZTogbm9kZS5pcygnJHRleHQnKSA/ICckdGV4dCcgOiBub2RlLm5hbWUsXG4gICAgICAgIGF0dHJpYnV0ZXM6IG5ldyBNYXAobm9kZS5nZXRBdHRyaWJ1dGVzKCkpXG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyBhbiBhcnJheSB0aGF0IGlzIGEgY29weSBvZiBwYXNzZWQgY2hpbGQgbGlzdCB3aXRoIHRoZSBleGNlcHRpb24gdGhhdCB0ZXh0IG5vZGVzIGFyZSBzcGxpdCB0byBvbmUgb3IgbW9yZVxuICogb2JqZWN0cywgZWFjaCByZXByZXNlbnRpbmcgb25lIGNoYXJhY3RlciBhbmQgYXR0cmlidXRlcyBzZXQgb24gdGhhdCBjaGFyYWN0ZXIuXG4gKi8gZnVuY3Rpb24gX2dldENoaWxkcmVuU25hcHNob3RzKGNoaWxkcmVuKSB7XG4gICAgY29uc3Qgc25hcHNob3RzID0gW107XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbil7XG4gICAgICAgIGlmIChjaGlsZC5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGNoaWxkLmRhdGEubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgICAgIHNuYXBzaG90cy5wdXNoKF9nZXRTaW5nbGVOb2RlU25hcHNob3QoY2hpbGQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNuYXBzaG90cy5wdXNoKF9nZXRTaW5nbGVOb2RlU25hcHNob3QoY2hpbGQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc25hcHNob3RzO1xufVxuLyoqXG4gKiBHZW5lcmF0ZXMgYXJyYXkgb2YgZGlmZiBpbnN0cnVjdGlvbnMgZm9yIGdpdmVuIGNoYW5nZXMgc2V0LlxuICpcbiAqIEdlbmVyYXRlZCBhY3Rpb25zIGFyZTpcbiAqXG4gKiAtICdlJyBmb3IgJ2VxdWFsJyAtIHdoZW4gaXRlbSBhdCB0aGF0IHBvc2l0aW9uIGRpZCBub3QgY2hhbmdlLFxuICogLSAnaScgZm9yICdpbnNlcnQnIC0gd2hlbiBpdGVtIGF0IHRoYXQgcG9zaXRpb24gd2FzIGluc2VydGVkLFxuICogLSAncicgZm9yICdyZW1vdmUnIC0gd2hlbiBpdGVtIGF0IHRoYXQgcG9zaXRpb24gd2FzIHJlbW92ZWQsXG4gKiAtICdhJyBmb3IgJ2F0dHJpYnV0ZScgLSB3aGVuIGl0ZW0gYXQgdGhhdCBwb3NpdGlvbiBoYXMgaXQgYXR0cmlidXRlcyBjaGFuZ2VkLlxuICpcbiAqIEV4YW1wbGUgKGFzc3VtZSB0aGF0IHVwcGVyY2FzZSBsZXR0ZXJzIGhhdmUgYm9sZCBhdHRyaWJ1dGUsIGNvbXBhcmUgd2l0aCBmdW5jdGlvbiBjb2RlKTpcbiAqXG4gKiBjaGlsZHJlbiBiZWZvcmU6XHRmb29CQVJcbiAqIGNoaWxkcmVuIGFmdGVyOlx0Zm94eWJBUlxuICpcbiAqIGNoYW5nZXM6IHR5cGU6IHJlbW92ZSwgb2Zmc2V0OiAxLCBob3dNYW55OiAxXG4gKlx0XHRcdHR5cGU6IGluc2VydCwgb2Zmc2V0OiAyLCBob3dNYW55OiAyXG4gKlx0XHRcdHR5cGU6IGF0dHJpYnV0ZSwgb2Zmc2V0OiA0LCBob3dNYW55OiAxXG4gKlxuICogRXhwZWN0ZWQgYWN0aW9uczogZXF1YWwgKGYpLCByZW1vdmUgKG8pLCBlcXVhbCAobyksIGluc2VydCAoeCksIGluc2VydCAoeSksIGF0dHJpYnV0ZSAoYiksIGVxdWFsIChBKSwgZXF1YWwgKFIpXG4gKlxuICogU3RlcHMgdGFrZW4gYnkgdGhlIHNjcmlwdDpcbiAqXG4gKiAxLiBjaGFuZ2UgPSBcInR5cGU6IHJlbW92ZSwgb2Zmc2V0OiAxLCBob3dNYW55OiAxXCI7IG9mZnNldCA9IDA7IG9sZENoaWxkcmVuSGFuZGxlZCA9IDBcbiAqICAgIDEuMSBiZXR3ZWVuIHRoaXMgY2hhbmdlIGFuZCB0aGUgYmVnaW5uaW5nIGlzIG9uZSBub3QtY2hhbmdlZCBub2RlLCBmaWxsIHdpdGggb25lIGVxdWFsIGFjdGlvbiwgb25lIG9sZCBjaGlsZCBoYXMgYmVlbiBoYW5kbGVkXG4gKiAgICAxLjIgdGhpcyBjaGFuZ2UgcmVtb3ZlcyBvbmUgbm9kZSwgYWRkIG9uZSByZW1vdmUgYWN0aW9uXG4gKiAgICAxLjMgY2hhbmdlIGxhc3QgdmlzaXRlZCBgb2Zmc2V0YCB0byAxXG4gKiAgICAxLjQgc2luY2UgYW4gb2xkIGNoaWxkIGhhcyBiZWVuIHJlbW92ZWQsIG9uZSBtb3JlIG9sZCBjaGlsZCBoYXMgYmVlbiBoYW5kbGVkXG4gKiAgICAxLjUgYWN0aW9ucyBhdCB0aGlzIHBvaW50IGFyZTogZXF1YWwsIHJlbW92ZVxuICpcbiAqIDIuIGNoYW5nZSA9IFwidHlwZTogaW5zZXJ0LCBvZmZzZXQ6IDIsIGhvd01hbnk6IDJcIjsgb2Zmc2V0ID0gMTsgb2xkQ2hpbGRyZW5IYW5kbGVkID0gMlxuICogICAgMi4xIGJldHdlZW4gdGhpcyBjaGFuZ2UgYW5kIHByZXZpb3VzIGNoYW5nZSBpcyBvbmUgbm90LWNoYW5nZWQgbm9kZSwgYWRkIGVxdWFsIGFjdGlvbiwgYW5vdGhlciBvbmUgb2xkIGNoaWxkcmVuIGhhcyBiZWVuIGhhbmRsZWRcbiAqICAgIDIuMiB0aGlzIGNoYW5nZSBpbnNlcnRzIHR3byBub2RlcywgYWRkIHR3byBpbnNlcnQgYWN0aW9uc1xuICogICAgMi4zIGNoYW5nZSBsYXN0IHZpc2l0ZWQgb2Zmc2V0IHRvIHRoZSBlbmQgb2YgdGhlIGluc2VydGVkIHJhbmdlLCB0aGF0IGlzIDRcbiAqICAgIDIuNCBhY3Rpb25zIGF0IHRoaXMgcG9pbnQgYXJlOiBlcXVhbCwgcmVtb3ZlLCBlcXVhbCwgaW5zZXJ0LCBpbnNlcnRcbiAqXG4gKiAzLiBjaGFuZ2UgPSBcInR5cGU6IGF0dHJpYnV0ZSwgb2Zmc2V0OiA0LCBob3dNYW55OiAxXCI7IG9mZnNldCA9IDQsIG9sZENoaWxkcmVuSGFuZGxlZCA9IDNcbiAqICAgIDMuMSBiZXR3ZWVuIHRoaXMgY2hhbmdlIGFuZCBwcmV2aW91cyBjaGFuZ2UgYXJlIG5vIG5vdC1jaGFuZ2VkIG5vZGVzXG4gKiAgICAzLjIgdGhpcyBjaGFuZ2UgY2hhbmdlcyBvbmUgbm9kZSwgYWRkIG9uZSBhdHRyaWJ1dGUgYWN0aW9uXG4gKiAgICAzLjMgY2hhbmdlIGxhc3QgdmlzaXRlZCBgb2Zmc2V0YCB0byB0aGUgZW5kIG9mIGNoYW5nZSByYW5nZSwgdGhhdCBpcyA1XG4gKiAgICAzLjQgc2luY2UgYW4gb2xkIGNoaWxkIGhhcyBiZWVuIGNoYW5nZWQsIG9uZSBtb3JlIG9sZCBjaGlsZCBoYXMgYmVlbiBoYW5kbGVkXG4gKiAgICAzLjUgYWN0aW9ucyBhdCB0aGlzIHBvaW50IGFyZTogZXF1YWwsIHJlbW92ZSwgZXF1YWwsIGluc2VydCwgaW5zZXJ0LCBhdHRyaWJ1dGVcbiAqXG4gKiA0LiBhZnRlciBsb29wIG9sZENoaWxkcmVuSGFuZGxlZCA9IDQsIG9sZENoaWxkcmVuTGVuZ3RoID0gNiAoZm9vQkFSIGlzIDYgY2hhcmFjdGVycylcbiAqICAgIDQuMSBmaWxsIHVwIHdpdGggdHdvIGVxdWFsIGFjdGlvbnNcbiAqXG4gKiBUaGUgcmVzdWx0IGFjdGlvbnMgYXJlOiBlcXVhbCwgcmVtb3ZlLCBlcXVhbCwgaW5zZXJ0LCBpbnNlcnQsIGF0dHJpYnV0ZSwgZXF1YWwsIGVxdWFsLlxuICovIGZ1bmN0aW9uIF9nZW5lcmF0ZURpZmZJbnN0cnVjdGlvbnNGcm9tQ2hhbmdlcyhvbGRDaGlsZHJlbkxlbmd0aCwgY2hhbmdlcykge1xuICAgIGNvbnN0IGRpZmYgPSBbXTtcbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBsZXQgb2xkQ2hpbGRyZW5IYW5kbGVkID0gMDtcbiAgICAvLyBHbyB0aHJvdWdoIGFsbCBidWZmZXJlZCBjaGFuZ2VzLlxuICAgIGZvciAoY29uc3QgY2hhbmdlIG9mIGNoYW5nZXMpe1xuICAgICAgICAvLyBGaXJzdCwgZmlsbCBcImhvbGVzXCIgYmV0d2VlbiBjaGFuZ2VzIHdpdGggXCJlcXVhbFwiIGFjdGlvbnMuXG4gICAgICAgIGlmIChjaGFuZ2Uub2Zmc2V0ID4gb2Zmc2V0KSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2hhbmdlLm9mZnNldCAtIG9mZnNldDsgaSsrKXtcbiAgICAgICAgICAgICAgICBkaWZmLnB1c2goJ2UnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9sZENoaWxkcmVuSGFuZGxlZCArPSBjaGFuZ2Uub2Zmc2V0IC0gb2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZW4sIGZpbGwgdXAgYWN0aW9ucyBhY2NvcmRpbmdseSB0byBjaGFuZ2UgdHlwZS5cbiAgICAgICAgaWYgKGNoYW5nZS50eXBlID09ICdpbnNlcnQnKSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2hhbmdlLmhvd01hbnk7IGkrKyl7XG4gICAgICAgICAgICAgICAgZGlmZi5wdXNoKCdpJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUaGUgbGFzdCBoYW5kbGVkIG9mZnNldCBpcyBhZnRlciBpbnNlcnRlZCByYW5nZS5cbiAgICAgICAgICAgIG9mZnNldCA9IGNoYW5nZS5vZmZzZXQgKyBjaGFuZ2UuaG93TWFueTtcbiAgICAgICAgfSBlbHNlIGlmIChjaGFuZ2UudHlwZSA9PSAncmVtb3ZlJykge1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGNoYW5nZS5ob3dNYW55OyBpKyspe1xuICAgICAgICAgICAgICAgIGRpZmYucHVzaCgncicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlIGxhc3QgaGFuZGxlZCBvZmZzZXQgaXMgYXQgdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBub2RlcyB3ZXJlIHJlbW92ZWQuXG4gICAgICAgICAgICBvZmZzZXQgPSBjaGFuZ2Uub2Zmc2V0O1xuICAgICAgICAgICAgLy8gV2UgcmVtb3ZlZCBgaG93TWFueWAgb2xkIG5vZGVzLCB1cGRhdGUgYG9sZENoaWxkcmVuSGFuZGxlZGAuXG4gICAgICAgICAgICBvbGRDaGlsZHJlbkhhbmRsZWQgKz0gY2hhbmdlLmhvd01hbnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUb3RhbCBtYXhpbXVtIGFtb3VudCBvZiBhcmd1bWVudHMgdGhhdCBjYW4gYmUgcGFzc2VkIHRvIGBBcnJheS5wcm90b3R5cGUucHVzaGAgbWF5IGJlIGxpbWl0ZWQgc28gd2UgbmVlZCB0b1xuICAgICAgICAgICAgLy8gYWRkIHRoZW0gbWFudWFsbHkgb25lIGJ5IG9uZSB0byBhdm9pZCB0aGlzIGxpbWl0LiBIb3dldmVyIGxvb3AgbWlnaHQgYmUgYSBiaXQgc2xvd2VyIHRoYW4gYHB1c2hgIG1ldGhvZCBvblxuICAgICAgICAgICAgLy8gc21hbGxlciBjaGFuZ2VzZXRzIHNvIHdlIG5lZWQgdG8gZGVjaWRlIHdoaWNoIG1ldGhvZCB0byB1c2UgYmFzZWQgb24gdGhlIHNpemUgb2YgdGhlIGNoYW5nZS5cbiAgICAgICAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTY4MTlcbiAgICAgICAgICAgIGlmIChjaGFuZ2UuaG93TWFueSA+IDE1MDApIHtcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2hhbmdlLmhvd01hbnk7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIGRpZmYucHVzaCgnYScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGlmZi5wdXNoKC4uLidhJy5yZXBlYXQoY2hhbmdlLmhvd01hbnkpLnNwbGl0KCcnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUaGUgbGFzdCBoYW5kbGVkIG9mZnNldCBpcyBhdCB0aGUgcG9zaXRpb24gYWZ0ZXIgdGhlIGNoYW5nZWQgcmFuZ2UuXG4gICAgICAgICAgICBvZmZzZXQgPSBjaGFuZ2Uub2Zmc2V0ICsgY2hhbmdlLmhvd01hbnk7XG4gICAgICAgICAgICAvLyBXZSBjaGFuZ2VkIGBob3dNYW55YCBvbGQgbm9kZXMsIHVwZGF0ZSBgb2xkQ2hpbGRyZW5IYW5kbGVkYC5cbiAgICAgICAgICAgIG9sZENoaWxkcmVuSGFuZGxlZCArPSBjaGFuZ2UuaG93TWFueTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBGaWxsIFwiZXF1YWxcIiBhY3Rpb25zIGF0IHRoZSBlbmQgb2YgYWN0aW9ucyBzZXQuIFVzZSBgb2xkQ2hpbGRyZW5IYW5kbGVkYCB0byBzZWUgaG93IG1hbnkgY2hpbGRyZW5cbiAgICAvLyBoYXMgbm90IGJlZW4gY2hhbmdlZCAvIHJlbW92ZWQgYXQgdGhlIGVuZCBvZiB0aGVpciBwYXJlbnQuXG4gICAgaWYgKG9sZENoaWxkcmVuSGFuZGxlZCA8IG9sZENoaWxkcmVuTGVuZ3RoKSB7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBvbGRDaGlsZHJlbkxlbmd0aCAtIG9sZENoaWxkcmVuSGFuZGxlZCAtIG9mZnNldDsgaSsrKXtcbiAgICAgICAgICAgIGRpZmYucHVzaCgnZScpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaWZmO1xufVxuLyoqXG4gKiBGaWx0ZXIgY2FsbGJhY2sgZm9yIGBBcnJheS5maWx0ZXJgIHRoYXQgZmlsdGVycyBvdXQgY2hhbmdlIGVudHJpZXMgdGhhdCBhcmUgaW4gZ3JhdmV5YXJkLlxuICovIGZ1bmN0aW9uIF9jaGFuZ2VzSW5HcmF2ZXlhcmRGaWx0ZXIoZW50cnkpIHtcbiAgICBjb25zdCBwb3NJbkd5ID0gJ3Bvc2l0aW9uJyBpbiBlbnRyeSAmJiBlbnRyeS5wb3NpdGlvbi5yb290LnJvb3ROYW1lID09ICckZ3JhdmV5YXJkJztcbiAgICBjb25zdCByYW5nZUluR3kgPSAncmFuZ2UnIGluIGVudHJ5ICYmIGVudHJ5LnJhbmdlLnJvb3Qucm9vdE5hbWUgPT0gJyRncmF2ZXlhcmQnO1xuICAgIHJldHVybiAhcG9zSW5HeSAmJiAhcmFuZ2VJbkd5O1xufVxuXG4vKipcbiAqIEBtb2R1bGUgZW5naW5lL21vZGVsL2hpc3RvcnlcbiAqLyAvKipcbiAqIGBIaXN0b3J5YCBrZWVwcyB0aGUgdHJhY2sgb2YgYWxsIHRoZSBvcGVyYXRpb25zIGFwcGxpZWQgdG8gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50IGRvY3VtZW50fS5cbiAqLyBjbGFzcyBIaXN0b3J5IHtcbiAgICAvKipcblx0ICogT3BlcmF0aW9ucyBhZGRlZCB0byB0aGUgaGlzdG9yeS5cblx0ICovIF9vcGVyYXRpb25zID0gW107XG4gICAgLyoqXG5cdCAqIEhvbGRzIGFuIGluZm9ybWF0aW9uIHdoaWNoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uIG9wZXJhdGlvbn0gdW5kb2VzIHdoaWNoXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uIG9wZXJhdGlvbn0uXG5cdCAqXG5cdCAqIEtleXMgb2YgdGhlIG1hcCBhcmUgXCJ1bmRvaW5nIG9wZXJhdGlvbnNcIiwgdGhhdCBpcyBvcGVyYXRpb25zIHRoYXQgdW5kb25lIHNvbWUgb3RoZXIgb3BlcmF0aW9ucy4gRm9yIGVhY2gga2V5LCB0aGVcblx0ICogdmFsdWUgaXMgYW4gb3BlcmF0aW9uIHRoYXQgaGFzIGJlZW4gdW5kb25lIGJ5IHRoZSBcInVuZG9pbmcgb3BlcmF0aW9uXCIuXG5cdCAqLyBfdW5kb1BhaXJzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBIb2xkcyBhbGwgdW5kb25lIG9wZXJhdGlvbnMuXG5cdCAqLyBfdW5kb25lT3BlcmF0aW9ucyA9IG5ldyBTZXQoKTtcbiAgICAvKipcblx0ICogQSBtYXAgdGhhdCBhbGxvd3MgcmV0cmlldmluZyB0aGUgb3BlcmF0aW9ucyBmYXN0IGJhc2VkIG9uIHRoZSBnaXZlbiBiYXNlIHZlcnNpb24uXG5cdCAqLyBfYmFzZVZlcnNpb25Ub09wZXJhdGlvbkluZGV4ID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBUaGUgaGlzdG9yeSB2ZXJzaW9uLlxuXHQgKi8gX3ZlcnNpb24gPSAwO1xuICAgIC8qKlxuXHQgKiBUaGUgZ2FwIHBhaXJzIGtlcHQgaW4gdGhlIDxmcm9tLHRvPiBmb3JtYXQuXG5cdCAqXG5cdCAqIEFueXRpbWUgdGhlIGBoaXN0b3J5LnZlcnNpb25gIGlzIHNldCB0byBhIHZlcnNpb24gbGFyZ2VyIHRoYW4gYGhpc3RvcnkudmVyc2lvbiArIDFgLFxuXHQgKiBhIG5ldyA8bGFzdEhpc3RvcnlWZXJzaW9uLCBuZXdIaXN0b3J5VmVyc2lvbj4gZW50cnkgaXMgYWRkZWQgdG8gdGhlIG1hcC5cblx0ICovIF9nYXBzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBUaGUgdmVyc2lvbiBvZiB0aGUgbGFzdCBvcGVyYXRpb24gaW4gdGhlIGhpc3RvcnkuXG5cdCAqXG5cdCAqIFRoZSBoaXN0b3J5IHZlcnNpb24gaXMgaW5jcmVtZW50ZWQgYXV0b21hdGljYWxseSB3aGVuIGEgbmV3IG9wZXJhdGlvbiBpcyBhZGRlZCB0byB0aGUgaGlzdG9yeS5cblx0ICogU2V0dGluZyB0aGUgdmVyc2lvbiBtYW51YWxseSBzaG91bGQgYmUgZG9uZSBvbmx5IGluIHJhcmUgY2lyY3Vtc3RhbmNlcyB3aGVuIGEgZ2FwIGlzIHBsYW5uZWRcblx0ICogYmV0d2VlbiBoaXN0b3J5IHZlcnNpb25zLiBXaGVuIGRvaW5nIHNvLCBhIGdhcCB3aWxsIGJlIGNyZWF0ZWQgYW5kIHRoZSBoaXN0b3J5IHdpbGwgYWNjZXB0IGFkZGluZ1xuXHQgKiBhbiBvcGVyYXRpb24gd2l0aCBiYXNlIHZlcnNpb24gZXF1YWwgdG8gdGhlIG5ldyBoaXN0b3J5IHZlcnNpb24uXG5cdCAqLyBnZXQgdmVyc2lvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb247XG4gICAgfVxuICAgIHNldCB2ZXJzaW9uKHZlcnNpb24pIHtcbiAgICAgICAgLy8gU3RvcmUgYSBnYXAgaWYgdGhlcmUgYXJlIHNvbWUgb3BlcmF0aW9ucyBhbHJlYWR5IGluIHRoZSBoaXN0b3J5IGFuZCB0aGVcbiAgICAgICAgLy8gbmV3IHZlcnNpb24gZG9lcyBub3QgaW5jcmVtZW50IHRoZSBsYXRlc3Qgb25lLlxuICAgICAgICBpZiAodGhpcy5fb3BlcmF0aW9ucy5sZW5ndGggJiYgdmVyc2lvbiA+IHRoaXMuX3ZlcnNpb24gKyAxKSB7XG4gICAgICAgICAgICB0aGlzLl9nYXBzLnNldCh0aGlzLl92ZXJzaW9uLCB2ZXJzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl92ZXJzaW9uID0gdmVyc2lvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBsYXN0IGhpc3Rvcnkgb3BlcmF0aW9uLlxuXHQgKi8gZ2V0IGxhc3RPcGVyYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcGVyYXRpb25zW3RoaXMuX29wZXJhdGlvbnMubGVuZ3RoIC0gMV07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBZGRzIGFuIG9wZXJhdGlvbiB0byB0aGUgaGlzdG9yeSBhbmQgaW5jcmVtZW50cyB0aGUgaGlzdG9yeSB2ZXJzaW9uLlxuXHQgKlxuXHQgKiBUaGUgb3BlcmF0aW9uJ3MgYmFzZSB2ZXJzaW9uIHNob3VsZCBiZSBlcXVhbCB0byB0aGUgaGlzdG9yeSB2ZXJzaW9uLiBPdGhlcndpc2UgYW4gZXJyb3IgaXMgdGhyb3duLlxuXHQgKi8gYWRkT3BlcmF0aW9uKG9wZXJhdGlvbikge1xuICAgICAgICBpZiAob3BlcmF0aW9uLmJhc2VWZXJzaW9uICE9PSB0aGlzLnZlcnNpb24pIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogT25seSBvcGVyYXRpb25zIHdpdGggbWF0Y2hpbmcgdmVyc2lvbnMgY2FuIGJlIGFkZGVkIHRvIHRoZSBoaXN0b3J5LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtb2RlbC1kb2N1bWVudC1oaXN0b3J5LWFkZG9wZXJhdGlvbi1pbmNvcnJlY3QtdmVyc2lvblxuXHRcdFx0ICogQHBhcmFtIGVycm9yRGF0YSBUaGUgb3BlcmF0aW9uIGFuZCB0aGUgY3VycmVudCBkb2N1bWVudCBoaXN0b3J5IHZlcnNpb24uXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21vZGVsLWRvY3VtZW50LWhpc3RvcnktYWRkb3BlcmF0aW9uLWluY29ycmVjdC12ZXJzaW9uJywgdGhpcywge1xuICAgICAgICAgICAgICAgIG9wZXJhdGlvbixcbiAgICAgICAgICAgICAgICBoaXN0b3J5VmVyc2lvbjogdGhpcy52ZXJzaW9uXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9vcGVyYXRpb25zLnB1c2gob3BlcmF0aW9uKTtcbiAgICAgICAgdGhpcy5fdmVyc2lvbisrO1xuICAgICAgICB0aGlzLl9iYXNlVmVyc2lvblRvT3BlcmF0aW9uSW5kZXguc2V0KG9wZXJhdGlvbi5iYXNlVmVyc2lvbiwgdGhpcy5fb3BlcmF0aW9ucy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgb3BlcmF0aW9ucyBmcm9tIHRoZSBnaXZlbiByYW5nZSBvZiBvcGVyYXRpb24gYmFzZSB2ZXJzaW9ucyB0aGF0IHdlcmUgYWRkZWQgdG8gdGhlIGhpc3RvcnkuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGVyZSBtYXkgYmUgZ2FwcyBpbiBvcGVyYXRpb25zIGJhc2UgdmVyc2lvbnMuXG5cdCAqXG5cdCAqIEBwYXJhbSBmcm9tQmFzZVZlcnNpb24gQmFzZSB2ZXJzaW9uIGZyb20gd2hpY2ggb3BlcmF0aW9ucyBzaG91bGQgYmUgcmV0dXJuZWQgKGluY2x1c2l2ZSkuXG5cdCAqIEBwYXJhbSB0b0Jhc2VWZXJzaW9uIEJhc2UgdmVyc2lvbiB1cCB0byB3aGljaCBvcGVyYXRpb25zIHNob3VsZCBiZSByZXR1cm5lZCAoZXhjbHVzaXZlKS5cbiAgICAgKiBAcmV0dXJucyBIaXN0b3J5IG9wZXJhdGlvbnMgZm9yIHRoZSBnaXZlbiByYW5nZSwgaW4gY2hyb25vbG9naWNhbCBvcmRlci5cblx0ICovIGdldE9wZXJhdGlvbnMoZnJvbUJhc2VWZXJzaW9uLCB0b0Jhc2VWZXJzaW9uID0gdGhpcy52ZXJzaW9uKSB7XG4gICAgICAgIC8vIFdoZW4gdGhlcmUgaXMgbm8gb3BlcmF0aW9uIGluIHRoZSBoaXN0b3J5LCByZXR1cm4gYW4gZW1wdHkgYXJyYXkuXG4gICAgICAgIC8vIEFmdGVyIHRoYXQgd2UgY2FuIGJlIHN1cmUgdGhhdCBgZmlyc3RPcGVyYXRpb25gLCBgbGFzdE9wZXJhdGlvbmAgYXJlIG5vdCBudWxsaXNoLlxuICAgICAgICBpZiAoIXRoaXMuX29wZXJhdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlyc3RPcGVyYXRpb24gPSB0aGlzLl9vcGVyYXRpb25zWzBdO1xuICAgICAgICBpZiAoZnJvbUJhc2VWZXJzaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGZyb21CYXNlVmVyc2lvbiA9IGZpcnN0T3BlcmF0aW9uLmJhc2VWZXJzaW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoYW5nZSBleGNsdXNpdmUgYHRvQmFzZVZlcnNpb25gIHRvIGluY2x1c2l2ZSwgc28gaXQgd2lsbCByZWZlciB0byB0aGUgYWN0dWFsIGluZGV4LlxuICAgICAgICAvLyBUaGFua3MgdG8gdGhhdCBtYXBwaW5nIGZyb20gYmFzZSB2ZXJzaW9ucyB0byBvcGVyYXRpb24gaW5kZXhlcyBhcmUgcG9zc2libGUuXG4gICAgICAgIGxldCBpbmNsdXNpdmVUbyA9IHRvQmFzZVZlcnNpb24gLSAxO1xuICAgICAgICAvLyBDaGVjayBpZiBcImZyb21cIiBvciBcInRvXCIgcG9pbnQgdG8gYSBnYXAgYmV0d2VlbiB2ZXJzaW9ucy5cbiAgICAgICAgLy8gSWYgeWVzLCB0aGVuIGNoYW5nZSB0aGUgaW5jb3JyZWN0IHBvc2l0aW9uIHRvIHRoZSBwcm9wZXIgc2lkZSBvZiB0aGUgZ2FwLlxuICAgICAgICAvLyBUaGFua3MgdG8gaXQsIGl0IHdpbGwgYmUgcG9zc2libGUgdG8gZ2V0IGluZGV4IG9mIHRoZSBvcGVyYXRpb24uXG4gICAgICAgIGZvciAoY29uc3QgW2dhcEZyb20sIGdhcFRvXSBvZiB0aGlzLl9nYXBzKXtcbiAgICAgICAgICAgIGlmIChmcm9tQmFzZVZlcnNpb24gPiBnYXBGcm9tICYmIGZyb21CYXNlVmVyc2lvbiA8IGdhcFRvKSB7XG4gICAgICAgICAgICAgICAgZnJvbUJhc2VWZXJzaW9uID0gZ2FwVG87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaW5jbHVzaXZlVG8gPiBnYXBGcm9tICYmIGluY2x1c2l2ZVRvIDwgZ2FwVG8pIHtcbiAgICAgICAgICAgICAgICBpbmNsdXNpdmVUbyA9IGdhcEZyb20gLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSB3aG9sZSByYW5nZSBpcyBvdXRzaWRlIG9mIHRoZSBvcGVyYXRpb24gdmVyc2lvbnMsIHRoZW4gcmV0dXJuIGFuIGVtcHR5IGFycmF5LlxuICAgICAgICBpZiAoaW5jbHVzaXZlVG8gPCBmaXJzdE9wZXJhdGlvbi5iYXNlVmVyc2lvbiB8fCBmcm9tQmFzZVZlcnNpb24gPiB0aGlzLmxhc3RPcGVyYXRpb24uYmFzZVZlcnNpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZnJvbUluZGV4ID0gdGhpcy5fYmFzZVZlcnNpb25Ub09wZXJhdGlvbkluZGV4LmdldChmcm9tQmFzZVZlcnNpb24pO1xuICAgICAgICAvLyBJZiB0aGUgcmFuZ2Ugc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3Qgb3BlcmF0aW9uLCB0aGVuIHVzZSB0aGUgZmlyc3Qgb3BlcmF0aW9uIGFzIHRoZSByYW5nZSdzIHN0YXJ0LlxuICAgICAgICBpZiAoZnJvbUluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGZyb21JbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRvSW5kZXggPSB0aGlzLl9iYXNlVmVyc2lvblRvT3BlcmF0aW9uSW5kZXguZ2V0KGluY2x1c2l2ZVRvKTtcbiAgICAgICAgLy8gSWYgdGhlIHJhbmdlIGVuZHMgYWZ0ZXIgdGhlIGxhc3Qgb3BlcmF0aW9uLCB0aGVuIHVzZSB0aGUgbGFzdCBvcGVyYXRpb24gYXMgdGhlIHJhbmdlJ3MgZW5kLlxuICAgICAgICBpZiAodG9JbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0b0luZGV4ID0gdGhpcy5fb3BlcmF0aW9ucy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJldHVybiB0aGUgcGFydCBvZiB0aGUgaGlzdG9yeSBvcGVyYXRpb25zIGJhc2VkIG9uIHRoZSBjYWxjdWxhdGVkIHN0YXJ0IGluZGV4IGFuZCBlbmQgaW5kZXguXG4gICAgICAgIHJldHVybiB0aGlzLl9vcGVyYXRpb25zLnNsaWNlKGZyb21JbmRleCwgLy8gVGhlIGB0b0luZGV4YCBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHJldHVybmVkIG9wZXJhdGlvbnMsIHNvIGFkZCBgMWAuXG4gICAgICAgIHRvSW5kZXggKyAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgb3BlcmF0aW9uIGZyb20gdGhlIGhpc3RvcnkgdGhhdCBiYXNlcyBvbiBnaXZlbiBgYmFzZVZlcnNpb25gLlxuXHQgKlxuXHQgKiBAcGFyYW0gYmFzZVZlcnNpb24gQmFzZSB2ZXJzaW9uIG9mIHRoZSBvcGVyYXRpb24gdG8gZ2V0LlxuXHQgKiBAcmV0dXJucyBPcGVyYXRpb24gd2l0aCBnaXZlbiBiYXNlIHZlcnNpb24gb3IgYHVuZGVmaW5lZGAgaWYgdGhlcmUgaXMgbm8gc3VjaCBvcGVyYXRpb24gaW4gaGlzdG9yeS5cblx0ICovIGdldE9wZXJhdGlvbihiYXNlVmVyc2lvbikge1xuICAgICAgICBjb25zdCBvcGVyYXRpb25JbmRleCA9IHRoaXMuX2Jhc2VWZXJzaW9uVG9PcGVyYXRpb25JbmRleC5nZXQoYmFzZVZlcnNpb24pO1xuICAgICAgICBpZiAob3BlcmF0aW9uSW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9vcGVyYXRpb25zW29wZXJhdGlvbkluZGV4XTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1hcmtzIGluIGhpc3RvcnkgdGhhdCBvbmUgb3BlcmF0aW9uIGlzIGFuIG9wZXJhdGlvbiB0aGF0IGlzIHVuZG9pbmcgdGhlIG90aGVyIG9wZXJhdGlvbi4gQnkgbWFya2luZyBvcGVyYXRpb24gdGhpcyB3YXksXG5cdCAqIGhpc3RvcnkgaXMga2VlcGluZyBtb3JlIGNvbnRleHQgaW5mb3JtYXRpb24gYWJvdXQgb3BlcmF0aW9ucywgd2hpY2ggaGVscHMgaW4gb3BlcmF0aW9uYWwgdHJhbnNmb3JtYXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSB1bmRvbmVPcGVyYXRpb24gT3BlcmF0aW9uIHdoaWNoIGlzIHVuZG9uZSBieSBgdW5kb2luZ09wZXJhdGlvbmAuXG5cdCAqIEBwYXJhbSB1bmRvaW5nT3BlcmF0aW9uIE9wZXJhdGlvbiB3aGljaCB1bmRvZXMgYHVuZG9uZU9wZXJhdGlvbmAuXG5cdCAqLyBzZXRPcGVyYXRpb25Bc1VuZG9uZSh1bmRvbmVPcGVyYXRpb24sIHVuZG9pbmdPcGVyYXRpb24pIHtcbiAgICAgICAgdGhpcy5fdW5kb1BhaXJzLnNldCh1bmRvaW5nT3BlcmF0aW9uLCB1bmRvbmVPcGVyYXRpb24pO1xuICAgICAgICB0aGlzLl91bmRvbmVPcGVyYXRpb25zLmFkZCh1bmRvbmVPcGVyYXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gYG9wZXJhdGlvbmAgaXMgdW5kb2luZyBhbnkgb3RoZXIgb3BlcmF0aW9uLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3BlcmF0aW9uIE9wZXJhdGlvbiB0byBjaGVjay5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIGdpdmVuIGBvcGVyYXRpb25gIGlzIHVuZG9pbmcgYW55IG90aGVyIG9wZXJhdGlvbiwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBpc1VuZG9pbmdPcGVyYXRpb24ob3BlcmF0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl91bmRvUGFpcnMuaGFzKG9wZXJhdGlvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBnaXZlbiBgb3BlcmF0aW9uYCBoYXMgYmVlbiB1bmRvbmUgYnkgYW55IG90aGVyIG9wZXJhdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIG9wZXJhdGlvbiBPcGVyYXRpb24gdG8gY2hlY2suXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBnaXZlbiBgb3BlcmF0aW9uYCBoYXMgYmVlbiB1bmRvbmUgYW55IG90aGVyIG9wZXJhdGlvbiwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBpc1VuZG9uZU9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VuZG9uZU9wZXJhdGlvbnMuaGFzKG9wZXJhdGlvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb3IgZ2l2ZW4gYHVuZG9pbmdPcGVyYXRpb25gLCByZXR1cm5zIHRoZSBvcGVyYXRpb24gd2hpY2ggaGFzIGJlZW4gdW5kb25lIGJ5IGl0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBPcGVyYXRpb24gdGhhdCBoYXMgYmVlbiB1bmRvbmUgYnkgZ2l2ZW4gYHVuZG9pbmdPcGVyYXRpb25gIG9yIGB1bmRlZmluZWRgXG5cdCAqIGlmIGdpdmVuIGB1bmRvaW5nT3BlcmF0aW9uYCBpcyBub3QgdW5kb2luZyBhbnkgb3RoZXIgb3BlcmF0aW9uLlxuXHQgKi8gZ2V0VW5kb25lT3BlcmF0aW9uKHVuZG9pbmdPcGVyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3VuZG9QYWlycy5nZXQodW5kb2luZ09wZXJhdGlvbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXNldHMgdGhlIGhpc3Rvcnkgb2Ygb3BlcmF0aW9ucy5cblx0ICovIHJlc2V0KCkge1xuICAgICAgICB0aGlzLl92ZXJzaW9uID0gMDtcbiAgICAgICAgdGhpcy5fdW5kb1BhaXJzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLl9vcGVyYXRpb25zID0gW107XG4gICAgICAgIHRoaXMuX3VuZG9uZU9wZXJhdGlvbnMgPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMuX2dhcHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuX2Jhc2VWZXJzaW9uVG9PcGVyYXRpb25JbmRleCA9IG5ldyBNYXAoKTtcbiAgICB9XG59XG5cbi8qKlxuICogVHlwZSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnR9IHRoYXQgaXMgYSByb290IG9mIGEgbW9kZWwgdHJlZS5cbiAqLyBjbGFzcyBSb290RWxlbWVudCBleHRlbmRzIEVsZW1lbnQge1xuICAgIC8qKlxuXHQgKiBVbmlxdWUgcm9vdCBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhpcyByb290IGVsZW1lbnQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnR9LlxuXHQgKi8gcm9vdE5hbWU7XG4gICAgLyoqXG5cdCAqIERvY3VtZW50IHRoYXQgaXMgYW4gb3duZXIgb2YgdGhpcyByb290LlxuXHQgKi8gX2RvY3VtZW50O1xuICAgIC8qKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9pc0F0dGFjaGVkID0gdHJ1ZTtcbiAgICAvKipcblx0ICogSW5mb3JtcyBpZiB0aGUgcm9vdCBlbGVtZW50IGlzIGxvYWRlZCAoZGVmYXVsdCkuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2lzTG9hZGVkID0gdHJ1ZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyByb290IGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBEb2N1bWVudCB0aGF0IGlzIGFuIG93bmVyIG9mIHRoaXMgcm9vdC5cblx0ICogQHBhcmFtIG5hbWUgTm9kZSBuYW1lLlxuXHQgKiBAcGFyYW0gcm9vdE5hbWUgVW5pcXVlIHJvb3QgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoaXMgcm9vdCBlbGVtZW50IGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50fS5cblx0ICovIGNvbnN0cnVjdG9yKGRvY3VtZW50LCBuYW1lLCByb290TmFtZSA9ICdtYWluJyl7XG4gICAgICAgIHN1cGVyKG5hbWUpO1xuICAgICAgICB0aGlzLl9kb2N1bWVudCA9IGRvY3VtZW50O1xuICAgICAgICB0aGlzLnJvb3ROYW1lID0gcm9vdE5hbWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBEb2N1bWVudH0gdGhhdCBvd25zIHRoaXMgcm9vdCBlbGVtZW50LlxuXHQgKi8gZ2V0IGRvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbmZvcm1zIGlmIHRoZSByb290IGVsZW1lbnQgaXMgY3VycmVudGx5IGF0dGFjaGVkIHRvIHRoZSBkb2N1bWVudCwgb3Igbm90LlxuXHQgKlxuXHQgKiBBIGRldGFjaGVkIHJvb3QgaXMgZXF1aXZhbGVudCB0byBiZWluZyByZW1vdmVkIGFuZCBjYW5ub3QgY29udGFpbiBhbnkgY2hpbGRyZW4gb3IgbWFya2Vycy5cblx0ICpcblx0ICogQnkgZGVmYXVsdCwgYSBuZXdseSBhZGRlZCByb290IGlzIGF0dGFjaGVkLiBJdCBjYW4gYmUgZGV0YWNoZWQgdXNpbmdcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNkZXRhY2hSb290IGBXcml0ZXIjZGV0YWNoUm9vdGB9LiBBIGRldGFjaGVkIHJvb3QgY2FuIGJlIHJlLWF0dGFjaGVkIGFnYWluIHVzaW5nXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjYWRkUm9vdCBgV3JpdGVyI2FkZFJvb3RgfS5cblx0ICovIGlzQXR0YWNoZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pc0F0dGFjaGVkO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgYFJvb3RFbGVtZW50YCBpbnN0YW5jZSB0byBgc3RyaW5nYCBjb250YWluaW5nIGl0cyBuYW1lLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBgUm9vdEVsZW1lbnRgIGluc3RhbmNlIGNvbnZlcnRlZCB0byBgc3RyaW5nYC5cblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdE5hbWU7XG4gICAgfVxufVxuLy8gVGhlIG1hZ2ljIG9mIHR5cGUgaW5mZXJlbmNlIHVzaW5nIGBpc2AgbWV0aG9kIGlzIGNlbnRyYWxpemVkIGluIGBUeXBlQ2hlY2thYmxlYCBjbGFzcy5cbi8vIFByb3BlciBvdmVybG9hZCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGF0LlxuUm9vdEVsZW1lbnQucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSwgbmFtZSkge1xuICAgIGlmICghbmFtZSkge1xuICAgICAgICByZXR1cm4gdHlwZSA9PT0gJ3Jvb3RFbGVtZW50JyB8fCB0eXBlID09PSAnbW9kZWw6cm9vdEVsZW1lbnQnIHx8IC8vIEZyb20gc3VwZXIuaXMoKS4gVGhpcyBpcyBoaWdobHkgdXRpbGlzZWQgbWV0aG9kIGFuZCBjYW5ub3QgY2FsbCBzdXBlci4gU2VlIGNrZWRpdG9yL2NrZWRpdG9yNSM2NTI5LlxuICAgICAgICB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ21vZGVsOmVsZW1lbnQnIHx8IHR5cGUgPT09ICdub2RlJyB8fCB0eXBlID09PSAnbW9kZWw6bm9kZSc7XG4gICAgfVxuICAgIHJldHVybiBuYW1lID09PSB0aGlzLm5hbWUgJiYgKHR5cGUgPT09ICdyb290RWxlbWVudCcgfHwgdHlwZSA9PT0gJ21vZGVsOnJvb3RFbGVtZW50JyB8fCAvLyBGcm9tIHN1cGVyLmlzKCkuIFRoaXMgaXMgaGlnaGx5IHV0aWxpc2VkIG1ldGhvZCBhbmQgY2Fubm90IGNhbGwgc3VwZXIuIFNlZSBja2VkaXRvci9ja2VkaXRvcjUjNjUyOS5cbiAgICB0eXBlID09PSAnZWxlbWVudCcgfHwgdHlwZSA9PT0gJ21vZGVsOmVsZW1lbnQnKTtcbn07XG5cbi8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gY29uc3QgeyBsb2dEb2N1bWVudCB9ID0gcmVxdWlyZSggJy4uL2Rldi11dGlscy91dGlscycgKTtcbmNvbnN0IGdyYXZleWFyZE5hbWUgPSAnJGdyYXZleWFyZCc7XG4vKipcbiAqIERhdGEgbW9kZWwncyBkb2N1bWVudC4gSXQgY29udGFpbnMgdGhlIG1vZGVsJ3Mgc3RydWN0dXJlLCBpdHMgc2VsZWN0aW9uIGFuZCB0aGUgaGlzdG9yeSBvZiBjaGFuZ2VzLlxuICpcbiAqIFJlYWQgbW9yZSBhYm91dCB3b3JraW5nIHdpdGggdGhlIG1vZGVsIGluXG4gKiB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjbW9kZWwgaW50cm9kdWN0aW9uIHRvIHRoZSB0aGUgZWRpdGluZyBlbmdpbmUncyBhcmNoaXRlY3R1cmV9LlxuICpcbiAqIFVzdWFsbHksIHRoZSBkb2N1bWVudCBjb250YWlucyBqdXN0IG9uZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCNyb290cyByb290IGVsZW1lbnR9LCBzb1xuICogeW91IGNhbiByZXRyaWV2ZSBpdCBieSBqdXN0IGNhbGxpbmcge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZ2V0Um9vdH0gd2l0aG91dCBzcGVjaWZ5aW5nIGl0cyBuYW1lOlxuICpcbiAqIGBgYHRzXG4gKiBtb2RlbC5kb2N1bWVudC5nZXRSb290KCk7IC8vIC0+IHJldHVybnMgdGhlIG1haW4gcm9vdFxuICogYGBgXG4gKlxuICogSG93ZXZlciwgdGhlIGRvY3VtZW50IG1heSBjb250YWluIG11bHRpcGxlIHJvb3RzIOKAkyBlLmcuIHdoZW4gdGhlIGVkaXRvciBoYXMgbXVsdGlwbGUgZWRpdGFibGUgYXJlYXNcbiAqIChlLmcuIGEgdGl0bGUgYW5kIGEgYm9keSBvZiBhIG1lc3NhZ2UpLlxuICovIGNsYXNzIERvY3VtZW50IGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbigpIHtcbiAgICAvKipcblx0ICogVGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsIG1vZGVsfSB0aGF0IHRoZSBkb2N1bWVudCBpcyBhIHBhcnQgb2YuXG5cdCAqLyBtb2RlbDtcbiAgICAvKipcblx0ICogVGhlIGRvY3VtZW50J3MgaGlzdG9yeS5cblx0ICovIGhpc3Rvcnk7XG4gICAgLyoqXG5cdCAqIFRoZSBzZWxlY3Rpb24gaW4gdGhpcyBkb2N1bWVudC5cblx0ICovIHNlbGVjdGlvbjtcbiAgICAvKipcblx0ICogQSBsaXN0IG9mIHJvb3RzIHRoYXQgYXJlIG93bmVkIGFuZCBtYW5hZ2VkIGJ5IHRoaXMgZG9jdW1lbnQuIFVzZSB7QGxpbmsgI2NyZWF0ZVJvb3R9LCB7QGxpbmsgI2dldFJvb3R9IGFuZFxuXHQgKiB7QGxpbmsgI2dldFJvb3ROYW1lc30gdG8gbWFuaXB1bGF0ZSBpdC5cblx0ICovIHJvb3RzO1xuICAgIC8qKlxuXHQgKiBUaGUgbW9kZWwgZGlmZmVyIG9iamVjdC4gSXRzIHJvbGUgaXMgdG8gYnVmZmVyIGNoYW5nZXMgZG9uZSBvbiB0aGUgbW9kZWwgZG9jdW1lbnQgYW5kIHRoZW4gY2FsY3VsYXRlIGEgZGlmZiBvZiB0aG9zZSBjaGFuZ2VzLlxuXHQgKi8gZGlmZmVyO1xuICAgIC8qKlxuXHQgKiBEZWZpbmVzIHdoZXRoZXIgdGhlIGRvY3VtZW50IGlzIGluIGEgcmVhZC1vbmx5IG1vZGUuXG5cdCAqXG5cdCAqIFRoZSB1c2VyIHNob3VsZCBub3QgYmUgYWJsZSB0byBjaGFuZ2UgdGhlIGRhdGEgb2YgYSBkb2N1bWVudCB0aGF0IGlzIHJlYWQtb25seS5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBpc1JlYWRPbmx5O1xuICAgIC8qKlxuXHQgKiBQb3N0LWZpeGVyIGNhbGxiYWNrcyByZWdpc3RlcmVkIHRvIHRoZSBtb2RlbCBkb2N1bWVudC5cblx0ICovIF9wb3N0Rml4ZXJzO1xuICAgIC8qKlxuXHQgKiBBIGZsYWcgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB0aGUgc2VsZWN0aW9uIGhhcyBjaGFuZ2VkIHNpbmNlIGxhc3QgY2hhbmdlIGJsb2NrLlxuXHQgKi8gX2hhc1NlbGVjdGlvbkNoYW5nZWRGcm9tVGhlTGFzdENoYW5nZUJsb2NrO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGVtcHR5IGRvY3VtZW50IGluc3RhbmNlIHdpdGggbm8ge0BsaW5rICNyb290c30gKG90aGVyIHRoYW5cblx0ICogdGhlIHtAbGluayAjZ3JhdmV5YXJkIGdyYXZleWFyZCByb290fSkuXG5cdCAqLyBjb25zdHJ1Y3Rvcihtb2RlbCl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkoKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBuZXcgRG9jdW1lbnRTZWxlY3Rpb24odGhpcyk7XG4gICAgICAgIHRoaXMucm9vdHMgPSBuZXcgQ29sbGVjdGlvbih7XG4gICAgICAgICAgICBpZFByb3BlcnR5OiAncm9vdE5hbWUnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRpZmZlciA9IG5ldyBEaWZmZXIobW9kZWwubWFya2Vycyk7XG4gICAgICAgIHRoaXMuaXNSZWFkT25seSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9wb3N0Rml4ZXJzID0gbmV3IFNldCgpO1xuICAgICAgICB0aGlzLl9oYXNTZWxlY3Rpb25DaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jayA9IGZhbHNlO1xuICAgICAgICAvLyBHcmF2ZXlhcmQgdHJlZSByb290LiBEb2N1bWVudCBhbHdheXMgaGF2ZSBhIGdyYXZleWFyZCByb290LCB3aGljaCBzdG9yZXMgcmVtb3ZlZCBub2Rlcy5cbiAgICAgICAgdGhpcy5jcmVhdGVSb290KCckcm9vdCcsIGdyYXZleWFyZE5hbWUpO1xuICAgICAgICAvLyBUaGVuLCBzdGlsbCBiZWZvcmUgYW4gb3BlcmF0aW9uIGlzIGFwcGxpZWQgb24gbW9kZWwsIGJ1ZmZlciB0aGUgY2hhbmdlIGluIGRpZmZlci5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2FwcGx5T3BlcmF0aW9uJywgKGV2dCwgYXJncyk9PntcbiAgICAgICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IGFyZ3NbMF07XG4gICAgICAgICAgICBpZiAob3BlcmF0aW9uLmlzRG9jdW1lbnRPcGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpZmZlci5idWZmZXJPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQWZ0ZXIgdGhlIG9wZXJhdGlvbiBpcyBhcHBsaWVkLCBidW1wIGRvY3VtZW50J3MgdmVyc2lvbiBhbmQgYWRkIHRoZSBvcGVyYXRpb24gdG8gdGhlIGhpc3RvcnkuXG4gICAgICAgIHRoaXMubGlzdGVuVG8obW9kZWwsICdhcHBseU9wZXJhdGlvbicsIChldnQsIGFyZ3MpPT57XG4gICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBhcmdzWzBdO1xuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi5pc0RvY3VtZW50T3BlcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5LmFkZE9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIExpc3RlbiB0byBzZWxlY3Rpb24gY2hhbmdlcy4gSWYgc2VsZWN0aW9uIGNoYW5nZWQsIG1hcmsgaXQuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5zZWxlY3Rpb24sICdjaGFuZ2UnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5faGFzU2VsZWN0aW9uQ2hhbmdlZEZyb21UaGVMYXN0Q2hhbmdlQmxvY2sgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQnVmZmVyIG1hcmtlciBjaGFuZ2VzLlxuICAgICAgICAvLyBUaGlzIGlzIG5vdCBjb3ZlcmVkIGluIGJ1ZmZlcmluZyBvcGVyYXRpb25zIGJlY2F1c2UgbWFya2VycyBtYXkgY2hhbmdlIG91dHNpZGUgb2YgdGhlbSAod2hlbiB0aGV5XG4gICAgICAgIC8vIGFyZSBtb2RpZmllZCB1c2luZyBgbW9kZWwubWFya2Vyc2AgY29sbGVjdGlvbiwgbm90IHRocm91Z2ggYE1hcmtlck9wZXJhdGlvbmApLlxuICAgICAgICB0aGlzLmxpc3RlblRvKG1vZGVsLm1hcmtlcnMsICd1cGRhdGUnLCAoZXZ0LCBtYXJrZXIsIG9sZFJhbmdlLCBuZXdSYW5nZSwgb2xkTWFya2VyRGF0YSk9PntcbiAgICAgICAgICAgIC8vIENvcHkgdGhlIGBuZXdSYW5nZWAgdG8gdGhlIG5ldyBtYXJrZXIgZGF0YSBhcyBkdXJpbmcgdGhlIG1hcmtlciByZW1vdmFsIHRoZSByYW5nZSBpcyBub3QgdXBkYXRlZC5cbiAgICAgICAgICAgIGNvbnN0IG5ld01hcmtlckRhdGEgPSB7XG4gICAgICAgICAgICAgICAgLi4ubWFya2VyLmdldERhdGEoKSxcbiAgICAgICAgICAgICAgICByYW5nZTogbmV3UmFuZ2VcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBXaGVuZXZlciBtYXJrZXIgaXMgdXBkYXRlZCwgYnVmZmVyIHRoYXQgY2hhbmdlLlxuICAgICAgICAgICAgdGhpcy5kaWZmZXIuYnVmZmVyTWFya2VyQ2hhbmdlKG1hcmtlci5uYW1lLCBvbGRNYXJrZXJEYXRhLCBuZXdNYXJrZXJEYXRhKTtcbiAgICAgICAgICAgIGlmIChvbGRSYW5nZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBuZXcgbWFya2VyLCBhZGQgYSBsaXN0ZW5lciB0aGF0IHdpbGwgYnVmZmVyIGNoYW5nZSB3aGVuZXZlciBtYXJrZXIgY2hhbmdlcy5cbiAgICAgICAgICAgICAgICBtYXJrZXIub24oJ2NoYW5nZScsIChldnQsIG9sZFJhbmdlKT0+e1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXJEYXRhID0gbWFya2VyLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWZmZXIuYnVmZmVyTWFya2VyQ2hhbmdlKG1hcmtlci5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5tYXJrZXJEYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IG9sZFJhbmdlXG4gICAgICAgICAgICAgICAgICAgIH0sIG1hcmtlckRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhpcyBpcyBhIHNvbHV0aW9uIGZvciBhIHByb2JsZW0gdGhhdCBtYXkgb2NjdXIgZHVyaW5nIHJlYWwtdGltZSBlZGl0aW5nLiBJZiBvbmUgY2xpZW50IGRldGFjaGVkIGEgcm9vdCBhbmQgYW5vdGhlciBhZGRlZFxuICAgICAgICAvLyBzb21ldGhpbmcgdGhlcmUgYXQgdGhlIHNhbWUgbW9tZW50LCB0aGUgT1QgZG9lcyBub3Qgc29sdmUgdGhpcyBwcm9ibGVtIGN1cnJlbnRseS4gSW4gc3VjaCBzaXR1YXRpb24sIHRoZSBhZGRlZCBlbGVtZW50cyB3b3VsZFxuICAgICAgICAvLyBzdGF5IGluIHRoZSBkZXRhY2hlZCByb290LlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGlzIGlzIGluY29ycmVjdCwgYSBkZXRhY2hlZCByb290IHNob3VsZCBiZSBlbXB0eSBhbmQgYWxsIGVsZW1lbnRzIGZyb20gaXQgc2hvdWxkIGJlIHJlbW92ZWQuIFRvIHNvbHZlIHRoaXMsIHRoZSBwb3N0LWZpeGVyIHdpbGxcbiAgICAgICAgLy8gcmVtb3ZlIGFueSBlbGVtZW50IHRoYXQgaXMgbGVmdCBpbiBhIGRldGFjaGVkIHJvb3QuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNpbWlsYXJseSwgbWFya2VycyB0aGF0IGFyZSBjcmVhdGVkIGF0IHRoZSBiZWdpbm5pbmcgb3IgYXQgdGhlIGVuZCBvZiB0aGUgZGV0YWNoZWQgcm9vdCB3aWxsIG5vdCBiZSByZW1vdmVkIGFzIHdlbGwuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoZSBkcmF3YmFjayBvZiB0aGlzIHNvbHV0aW9uIG92ZXIgdGhlIE9UIHNvbHV0aW9uIGlzIHRoYXQgdGhlIGVsZW1lbnRzIHJlbW92ZWQgYnkgdGhlIHBvc3QtZml4ZXIgd2lsbCBuZXZlciBiZSBicm91Z2h0IGJhY2suXG4gICAgICAgIC8vIElmIHRoZSByb290IGRldGFjaG1lbnQgZ2V0cyB1bmRvbmUgKGFuZCB0aGUgcm9vdCBpcyBicm91Z2h0IGJhY2spLCB0aGUgcmVtb3ZlZCBlbGVtZW50cyB3aWxsIG5vdCBiZSB0aGVyZS5cbiAgICAgICAgdGhpcy5yZWdpc3RlclBvc3RGaXhlcigod3JpdGVyKT0+e1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCByb290IG9mIHRoaXMucm9vdHMpe1xuICAgICAgICAgICAgICAgIGlmICghcm9vdC5pc0F0dGFjaGVkKCkgJiYgIXJvb3QuaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlKHdyaXRlci5jcmVhdGVSYW5nZUluKHJvb3QpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLm1vZGVsLm1hcmtlcnMpe1xuICAgICAgICAgICAgICAgIGlmICghbWFya2VyLmdldFJhbmdlKCkucm9vdC5pc0F0dGFjaGVkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZU1hcmtlcihtYXJrZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIGRvY3VtZW50IHZlcnNpb24uIEV2ZXJ5IGFwcGxpZWQgb3BlcmF0aW9uIGluY3JlYXNlcyB0aGUgdmVyc2lvbiBudW1iZXIuIEl0IGlzIHVzZWQgdG9cblx0ICogZW5zdXJlIHRoYXQgb3BlcmF0aW9ucyBhcmUgYXBwbGllZCBvbiBhIHByb3BlciBkb2N1bWVudCB2ZXJzaW9uLlxuXHQgKlxuXHQgKiBUaGlzIHByb3BlcnR5IGlzIGVxdWFsIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2hpc3Rvcnl+SGlzdG9yeSN2ZXJzaW9uIGBtb2RlbC5Eb2N1bWVudCNoaXN0b3J5I3ZlcnNpb25gfS5cblx0ICpcblx0ICogSWYgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uI2Jhc2VWZXJzaW9uIGJhc2UgdmVyc2lvbn0gZG9lcyBub3QgbWF0Y2ggdGhlIGRvY3VtZW50IHZlcnNpb24sXG5cdCAqIGEge0BsaW5rIG1vZHVsZTp1dGlscy9ja2VkaXRvcmVycm9yfkNLRWRpdG9yRXJyb3IgbW9kZWwtZG9jdW1lbnQtYXBwbHlvcGVyYXRpb24td3JvbmctdmVyc2lvbn0gZXJyb3IgaXMgdGhyb3duLlxuXHQgKi8gZ2V0IHZlcnNpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkudmVyc2lvbjtcbiAgICB9XG4gICAgc2V0IHZlcnNpb24odmVyc2lvbikge1xuICAgICAgICB0aGlzLmhpc3RvcnkudmVyc2lvbiA9IHZlcnNpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgZ3JhdmV5YXJkIHRyZWUgcm9vdC4gQSBkb2N1bWVudCBhbHdheXMgaGFzIGEgZ3JhdmV5YXJkIHJvb3QgdGhhdCBzdG9yZXMgcmVtb3ZlZCBub2Rlcy5cblx0ICovIGdldCBncmF2ZXlhcmQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFJvb3QoZ3JhdmV5YXJkTmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHJvb3QuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBkbyBub3QgdXNlIHRoaXMgbWV0aG9kIGFmdGVyIHRoZSBlZGl0b3IgaGFzIGJlZW4gaW5pdGlhbGl6ZWQhIElmIHlvdSB3YW50IHRvIGR5bmFtaWNhbGx5IGFkZCBhIHJvb3QsIHVzZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2FkZFJvb3QgYG1vZGVsLldyaXRlciNhZGRSb290YH0gaW5zdGVhZC5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnROYW1lIFRoZSBlbGVtZW50IG5hbWUuIERlZmF1bHRzIHRvIGAnJHJvb3QnYCB3aGljaCBhbHNvIGhhcyBzb21lIGJhc2ljIHNjaGVtYSBkZWZpbmVkXG5cdCAqIChlLmcuIGAkYmxvY2tgIGVsZW1lbnRzIGFyZSBhbGxvd2VkIGluc2lkZSB0aGUgYCRyb290YCkuIE1ha2Ugc3VyZSB0byBkZWZpbmUgYSBwcm9wZXIgc2NoZW1hIGlmIHlvdSB1c2UgYSBkaWZmZXJlbnQgbmFtZS5cblx0ICogQHBhcmFtIHJvb3ROYW1lIEEgdW5pcXVlIHJvb3QgbmFtZS5cblx0ICogQHJldHVybnMgVGhlIGNyZWF0ZWQgcm9vdC5cblx0ICovIGNyZWF0ZVJvb3QoZWxlbWVudE5hbWUgPSAnJHJvb3QnLCByb290TmFtZSA9ICdtYWluJykge1xuICAgICAgICBpZiAodGhpcy5yb290cy5nZXQocm9vdE5hbWUpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEEgcm9vdCB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSBhbHJlYWR5IGV4aXN0cy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbW9kZWwtZG9jdW1lbnQtY3JlYXRlcm9vdC1uYW1lLWV4aXN0c1xuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtb2RlbC1kb2N1bWVudC1jcmVhdGVyb290LW5hbWUtZXhpc3RzJywgdGhpcywge1xuICAgICAgICAgICAgICAgIG5hbWU6IHJvb3ROYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb290ID0gbmV3IFJvb3RFbGVtZW50KHRoaXMsIGVsZW1lbnROYW1lLCByb290TmFtZSk7XG4gICAgICAgIHRoaXMucm9vdHMuYWRkKHJvb3QpO1xuICAgICAgICByZXR1cm4gcm9vdDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYWxsIGV2ZW50IGxpc3RlbmVycyBzZXQgYnkgdGhlIGRvY3VtZW50IGluc3RhbmNlLlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24uZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByb290IGJ5IGl0cyBuYW1lLlxuXHQgKlxuXHQgKiBEZXRhY2hlZCByb290cyBhcmUgcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QuIFRoaXMgaXMgdG8gYmUgYWJsZSB0byBvcGVyYXRlIG9uIHRoZSBkZXRhY2hlZCByb290IChmb3IgZXhhbXBsZSwgdG8gYmUgYWJsZSB0byBjcmVhdGVcblx0ICogYSBwb3NpdGlvbiBpbnNpZGUgc3VjaCBhIHJvb3QgZm9yIHVuZG8gZmVhdHVyZSBwdXJwb3NlcykuXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIFRoZSByb290IG5hbWUgb2YgdGhlIHJvb3QgdG8gcmV0dXJuLlxuXHQgKiBAcmV0dXJucyBUaGUgcm9vdCByZWdpc3RlcmVkIHVuZGVyIGEgZ2l2ZW4gbmFtZSBvciBgbnVsbGAgd2hlbiB0aGVyZSBpcyBubyByb290IHdpdGggdGhlIGdpdmVuIG5hbWUuXG5cdCAqLyBnZXRSb290KG5hbWUgPSAnbWFpbicpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdHMuZ2V0KG5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSB3aXRoIG5hbWVzIG9mIGFsbCByb290cyBhZGRlZCB0byB0aGUgZG9jdW1lbnQgKGV4Y2VwdCB0aGUge0BsaW5rICNncmF2ZXlhcmQgZ3JhdmV5YXJkIHJvb3R9KS5cblx0ICpcblx0ICogRGV0YWNoZWQgcm9vdHMgKiphcmUgbm90KiogcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QgYnkgZGVmYXVsdC4gVGhpcyBpcyB0byBtYWtlIHN1cmUgdGhhdCBhbGwgZmVhdHVyZXMgb3IgYWxnb3JpdGhtcyB0aGF0IG9wZXJhdGVcblx0ICogb24gdGhlIGRvY3VtZW50IGRhdGEga25vdyB3aGljaCByb290cyBhcmUgc3RpbGwgYSBwYXJ0IG9mIHRoZSBkb2N1bWVudCBhbmQgc2hvdWxkIGJlIHByb2Nlc3NlZC5cblx0ICpcblx0ICogQHBhcmFtIGluY2x1ZGVEZXRhY2hlZCBTcGVjaWZpZWQgd2hldGhlciBkZXRhY2hlZCByb290cyBzaG91bGQgYmUgcmV0dXJuZWQgYXMgd2VsbC5cblx0ICovIGdldFJvb3ROYW1lcyhpbmNsdWRlRGV0YWNoZWQgPSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSb290cyhpbmNsdWRlRGV0YWNoZWQpLm1hcCgocm9vdCk9PnJvb3Qucm9vdE5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSB3aXRoIGFsbCByb290cyBhZGRlZCB0byB0aGUgZG9jdW1lbnQgKGV4Y2VwdCB0aGUge0BsaW5rICNncmF2ZXlhcmQgZ3JhdmV5YXJkIHJvb3R9KS5cblx0ICpcblx0ICogRGV0YWNoZWQgcm9vdHMgKiphcmUgbm90KiogcmV0dXJuZWQgYnkgdGhpcyBtZXRob2QgYnkgZGVmYXVsdC4gVGhpcyBpcyB0byBtYWtlIHN1cmUgdGhhdCBhbGwgZmVhdHVyZXMgb3IgYWxnb3JpdGhtcyB0aGF0IG9wZXJhdGVcblx0ICogb24gdGhlIGRvY3VtZW50IGRhdGEga25vdyB3aGljaCByb290cyBhcmUgc3RpbGwgYSBwYXJ0IG9mIHRoZSBkb2N1bWVudCBhbmQgc2hvdWxkIGJlIHByb2Nlc3NlZC5cblx0ICpcblx0ICogQHBhcmFtIGluY2x1ZGVEZXRhY2hlZCBTcGVjaWZpZWQgd2hldGhlciBkZXRhY2hlZCByb290cyBzaG91bGQgYmUgcmV0dXJuZWQgYXMgd2VsbC5cblx0ICovIGdldFJvb3RzKGluY2x1ZGVEZXRhY2hlZCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RzLmZpbHRlcigocm9vdCk9PnJvb3QgIT0gdGhpcy5ncmF2ZXlhcmQgJiYgKGluY2x1ZGVEZXRhY2hlZCB8fCByb290LmlzQXR0YWNoZWQoKSkgJiYgcm9vdC5faXNMb2FkZWQpO1xuICAgIH1cbiAgICAvKipcblx0ICogVXNlZCB0byByZWdpc3RlciBhIHBvc3QtZml4ZXIgY2FsbGJhY2suIEEgcG9zdC1maXhlciBtZWNoYW5pc20gZ3VhcmFudGVlcyB0aGF0IHRoZSBmZWF0dXJlc1xuXHQgKiB3aWxsIG9wZXJhdGUgb24gYSBjb3JyZWN0IG1vZGVsIHN0YXRlLlxuXHQgKlxuXHQgKiBBbiBleGVjdXRpb24gb2YgYSBmZWF0dXJlIG1heSBsZWFkIHRvIGFuIGluY29ycmVjdCBkb2N1bWVudCB0cmVlIHN0YXRlLiBUaGUgY2FsbGJhY2tzIGFyZSB1c2VkIHRvIGZpeCB0aGUgZG9jdW1lbnQgdHJlZSBhZnRlclxuXHQgKiBpdCBoYXMgY2hhbmdlZC4gUG9zdC1maXhlcnMgYXJlIGZpcmVkIGp1c3QgYWZ0ZXIgYWxsIGNoYW5nZXMgZnJvbSB0aGUgb3V0ZXJtb3N0IGNoYW5nZSBibG9jayB3ZXJlIGFwcGxpZWQgYnV0XG5cdCAqIGJlZm9yZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y2hhbmdlIGNoYW5nZSBldmVudH0gaXMgZmlyZWQuIElmIGEgcG9zdC1maXhlciBjYWxsYmFjayBtYWRlXG5cdCAqIGEgY2hhbmdlLCBpdCBzaG91bGQgcmV0dXJuIGB0cnVlYC4gV2hlbiB0aGlzIGhhcHBlbnMsIGFsbCBwb3N0LWZpeGVycyBhcmUgZmlyZWQgYWdhaW4gdG8gY2hlY2sgaWYgc29tZXRoaW5nIGVsc2Ugc2hvdWxkXG5cdCAqIG5vdCBiZSBmaXhlZCBpbiB0aGUgbmV3IGRvY3VtZW50IHRyZWUgc3RhdGUuXG5cdCAqXG5cdCAqIEFzIGEgcGFyYW1ldGVyLCBhIHBvc3QtZml4ZXIgY2FsbGJhY2sgcmVjZWl2ZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyIHdyaXRlcn0gaW5zdGFuY2UgY29ubmVjdGVkIHdpdGggdGhlXG5cdCAqIGV4ZWN1dGVkIGNoYW5nZXMgYmxvY2suIFRoYW5rcyB0byB0aGF0LCBhbGwgY2hhbmdlcyBkb25lIGJ5IHRoZSBjYWxsYmFjayB3aWxsIGJlIGFkZGVkIHRvIHRoZSBzYW1lXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNoIGJhdGNofSAoYW5kIHVuZG8gc3RlcCkgYXMgdGhlIG9yaWdpbmFsIGNoYW5nZXMuIFRoaXMgbWFrZXMgcG9zdC1maXhlciBjaGFuZ2VzIHRyYW5zcGFyZW50XG5cdCAqIGZvciB0aGUgdXNlci5cblx0ICpcblx0ICogQW4gZXhhbXBsZSBvZiBhIHBvc3QtZml4ZXIgaXMgYSBjYWxsYmFjayB0aGF0IGNoZWNrcyBpZiBhbGwgdGhlIGRhdGEgd2VyZSByZW1vdmVkIGZyb20gdGhlIGVkaXRvci4gSWYgc28sIHRoZVxuXHQgKiBjYWxsYmFjayBzaG91bGQgYWRkIGFuIGVtcHR5IHBhcmFncmFwaCBzbyB0aGF0IHRoZSBlZGl0b3IgaXMgbmV2ZXIgZW1wdHk6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGRvY3VtZW50LnJlZ2lzdGVyUG9zdEZpeGVyKCB3cml0ZXIgPT4ge1xuXHQgKiBcdGNvbnN0IGNoYW5nZXMgPSBkb2N1bWVudC5kaWZmZXIuZ2V0Q2hhbmdlcygpO1xuXHQgKlxuXHQgKiBcdC8vIENoZWNrIGlmIHRoZSBjaGFuZ2VzIGxlYWQgdG8gYW4gZW1wdHkgcm9vdCBpbiB0aGUgZWRpdG9yLlxuXHQgKiBcdGZvciAoIGNvbnN0IGVudHJ5IG9mIGNoYW5nZXMgKSB7XG5cdCAqIFx0XHRpZiAoIGVudHJ5LnR5cGUgPT0gJ3JlbW92ZScgJiYgZW50cnkucG9zaXRpb24ucm9vdC5pc0VtcHR5ICkge1xuXHQgKiBcdFx0XHR3cml0ZXIuaW5zZXJ0RWxlbWVudCggJ3BhcmFncmFwaCcsIGVudHJ5LnBvc2l0aW9uLnJvb3QsIDAgKTtcblx0ICpcblx0ICogXHRcdFx0Ly8gSXQgaXMgZmluZSB0byByZXR1cm4gZWFybHksIGV2ZW4gaWYgbXVsdGlwbGUgcm9vdHMgd291bGQgbmVlZCB0byBiZSBmaXhlZC5cblx0ICogXHRcdFx0Ly8gQWxsIHBvc3QtZml4ZXJzIHdpbGwgYmUgZmlyZWQgYWdhaW4sIHNvIGlmIHRoZXJlIGFyZSBtb3JlIGVtcHR5IHJvb3RzLCB0aG9zZSB3aWxsIGJlIGZpeGVkLCB0b28uXG5cdCAqIFx0XHRcdHJldHVybiB0cnVlO1xuXHQgKiBcdFx0fVxuXHQgKiBcdH1cblx0ICpcblx0ICogXHRyZXR1cm4gZmFsc2U7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqLyByZWdpc3RlclBvc3RGaXhlcihwb3N0Rml4ZXIpIHtcbiAgICAgICAgdGhpcy5fcG9zdEZpeGVycy5hZGQocG9zdEZpeGVyKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgY3VzdG9tIGB0b0pTT04oKWAgbWV0aG9kIHRvIHNvbHZlIGNoaWxkLXBhcmVudCBjaXJjdWxhciBkZXBlbmRlbmNpZXMuXG5cdCAqXG5cdCAqIEByZXR1cm5zIEEgY2xvbmUgb2YgdGhpcyBvYmplY3Qgd2l0aCB0aGUgZG9jdW1lbnQgcHJvcGVydHkgY2hhbmdlZCB0byBhIHN0cmluZy5cblx0ICovIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3QganNvbiA9IGNsb25lKHRoaXMpO1xuICAgICAgICAvLyBEdWUgdG8gY2lyY3VsYXIgcmVmZXJlbmNlcyB3ZSBuZWVkIHRvIHJlbW92ZSBwYXJlbnQgcmVmZXJlbmNlLlxuICAgICAgICBqc29uLnNlbGVjdGlvbiA9ICdbZW5naW5lLm1vZGVsLkRvY3VtZW50U2VsZWN0aW9uXSc7XG4gICAgICAgIGpzb24ubW9kZWwgPSAnW2VuZ2luZS5tb2RlbC5Nb2RlbF0nO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrIGlmIHRoZXJlIHdlcmUgYW55IGNoYW5nZXMgZG9uZSBvbiBkb2N1bWVudCwgYW5kIGlmIHNvLCBjYWxsIHBvc3QtZml4ZXJzLFxuXHQgKiBmaXJlIGBjaGFuZ2VgIGV2ZW50IGZvciBmZWF0dXJlcyBhbmQgY29udmVyc2lvbiBhbmQgdGhlbiByZXNldCB0aGUgZGlmZmVyLlxuXHQgKiBGaXJlIGBjaGFuZ2U6ZGF0YWAgZXZlbnQgd2hlbiBhdCBsZWFzdCBvbmUgb3BlcmF0aW9uIG9yIGJ1ZmZlcmVkIG1hcmtlciBjaGFuZ2VzIHRoZSBkYXRhLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQGZpcmVzIGNoYW5nZVxuXHQgKiBAZmlyZXMgY2hhbmdlOmRhdGFcblx0ICogQHBhcmFtIHdyaXRlciBUaGUgd3JpdGVyIG9uIHdoaWNoIHBvc3QtZml4ZXJzIHdpbGwgYmUgY2FsbGVkLlxuXHQgKi8gX2hhbmRsZUNoYW5nZUJsb2NrKHdyaXRlcikge1xuICAgICAgICBpZiAodGhpcy5faGFzRG9jdW1lbnRDaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jaygpKSB7XG4gICAgICAgICAgICB0aGlzLl9jYWxsUG9zdEZpeGVycyh3cml0ZXIpO1xuICAgICAgICAgICAgLy8gUmVmcmVzaCBzZWxlY3Rpb24gYXR0cmlidXRlcyBhY2NvcmRpbmcgdG8gdGhlIGZpbmFsIHBvc2l0aW9uIGluIHRoZSBtb2RlbCBhZnRlciB0aGUgY2hhbmdlLlxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24ucmVmcmVzaCgpO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlmZmVyLmhhc0RhdGFDaGFuZ2VzKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZTpkYXRhJywgd3JpdGVyLmJhdGNoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2UnLCB3cml0ZXIuYmF0Y2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gVGhlb3JldGljYWxseSwgaXQgaXMgbm90IG5lY2Vzc2FyeSB0byByZWZyZXNoIHNlbGVjdGlvbiBhZnRlciBjaGFuZ2UgZXZlbnQgYmVjYXVzZVxuICAgICAgICAgICAgLy8gcG9zdC1maXhlcnMgYXJlIHRoZSBsYXN0IHdobyBzaG91bGQgY2hhbmdlIHRoZSBtb2RlbCwgYnV0IGp1c3QgaW4gY2FzZS4uLlxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24ucmVmcmVzaCgpO1xuICAgICAgICAgICAgdGhpcy5kaWZmZXIucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9oYXNTZWxlY3Rpb25DaGFuZ2VkRnJvbVRoZUxhc3RDaGFuZ2VCbG9jayA9IGZhbHNlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB3aGV0aGVyIHRoZXJlIGlzIGEgYnVmZmVyZWQgY2hhbmdlIG9yIGlmIHRoZSBzZWxlY3Rpb24gaGFzIGNoYW5nZWQgZnJvbSB0aGUgbGFzdFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNlbnF1ZXVlQ2hhbmdlIGBlbnF1ZXVlQ2hhbmdlKClgIGJsb2NrfVxuXHQgKiBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2UgYGNoYW5nZSgpYCBibG9ja30uXG5cdCAqXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIGlmIGRvY3VtZW50IGhhcyBjaGFuZ2VkIGZyb20gdGhlIGxhc3QgYGNoYW5nZSgpYCBvciBgZW5xdWV1ZUNoYW5nZSgpYCBibG9jay5cblx0ICovIF9oYXNEb2N1bWVudENoYW5nZWRGcm9tVGhlTGFzdENoYW5nZUJsb2NrKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuZGlmZmVyLmlzRW1wdHkgfHwgdGhpcy5faGFzU2VsZWN0aW9uQ2hhbmdlZEZyb21UaGVMYXN0Q2hhbmdlQmxvY2s7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBkZWZhdWx0IHJvb3QgZm9yIHRoaXMgZG9jdW1lbnQgd2hpY2ggaXMgZWl0aGVyIHRoZSBmaXJzdCByb290IHRoYXQgd2FzIGFkZGVkIHRvIHRoZSBkb2N1bWVudCB1c2luZ1xuXHQgKiB7QGxpbmsgI2NyZWF0ZVJvb3R9IG9yIHRoZSB7QGxpbmsgI2dyYXZleWFyZCBncmF2ZXlhcmQgcm9vdH0gaWYgbm8gb3RoZXIgcm9vdHMgd2VyZSBjcmVhdGVkLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBUaGUgZGVmYXVsdCByb290IGZvciB0aGlzIGRvY3VtZW50LlxuXHQgKi8gX2dldERlZmF1bHRSb290KCkge1xuICAgICAgICBjb25zdCByb290cyA9IHRoaXMuZ2V0Um9vdHMoKTtcbiAgICAgICAgcmV0dXJuIHJvb3RzLmxlbmd0aCA/IHJvb3RzWzBdIDogdGhpcy5ncmF2ZXlhcmQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBkZWZhdWx0IHJhbmdlIGZvciB0aGlzIHNlbGVjdGlvbi4gVGhlIGRlZmF1bHQgcmFuZ2UgaXMgYSBjb2xsYXBzZWQgcmFuZ2UgdGhhdCBzdGFydHMgYW5kIGVuZHNcblx0ICogYXQgdGhlIGJlZ2lubmluZyBvZiB0aGlzIHNlbGVjdGlvbidzIGRvY3VtZW50IHtAbGluayAjX2dldERlZmF1bHRSb290IGRlZmF1bHQgcm9vdH0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2dldERlZmF1bHRSYW5nZSgpIHtcbiAgICAgICAgY29uc3QgZGVmYXVsdFJvb3QgPSB0aGlzLl9nZXREZWZhdWx0Um9vdCgpO1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMubW9kZWw7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgLy8gRmluZCB0aGUgZmlyc3QgcG9zaXRpb24gd2hlcmUgdGhlIHNlbGVjdGlvbiBjYW4gYmUgcHV0LlxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uRnJvbVBhdGgoZGVmYXVsdFJvb3QsIFtcbiAgICAgICAgICAgIDBcbiAgICAgICAgXSk7XG4gICAgICAgIGNvbnN0IG5lYXJlc3RSYW5nZSA9IHNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2UocG9zaXRpb24pO1xuICAgICAgICAvLyBJZiB2YWxpZCBzZWxlY3Rpb24gcmFuZ2UgaXMgbm90IGZvdW5kIC0gcmV0dXJuIHJhbmdlIGNvbGxhcHNlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSByb290LlxuICAgICAgICByZXR1cm4gbmVhcmVzdFJhbmdlIHx8IG1vZGVsLmNyZWF0ZVJhbmdlKHBvc2l0aW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIGEgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2V9IGlzIGEgdmFsaWQgcmFuZ2UgZm9yXG5cdCAqIHRoZSB7QGxpbmsgI3NlbGVjdGlvbiBkb2N1bWVudCdzIHNlbGVjdGlvbn0uXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gcmFuZ2UgQSByYW5nZSB0byBjaGVjay5cblx0ICogQHJldHVybnMgYHRydWVgIGlmIGByYW5nZWAgaXMgdmFsaWQsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX3ZhbGlkYXRlU2VsZWN0aW9uUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIHJhbmdlLnN0YXJ0LmlzVmFsaWQoKSAmJiByYW5nZS5lbmQuaXNWYWxpZCgpICYmIHZhbGlkYXRlVGV4dE5vZGVQb3NpdGlvbihyYW5nZS5zdGFydCkgJiYgdmFsaWRhdGVUZXh0Tm9kZVBvc2l0aW9uKHJhbmdlLmVuZCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQZXJmb3JtcyBwb3N0LWZpeGVyIGxvb3BzLiBFeGVjdXRlcyBwb3N0LWZpeGVyIGNhbGxiYWNrcyBhcyBsb25nIGFzIG5vbmUgb2YgdGhlbSBoYXMgZG9uZSBhbnkgY2hhbmdlcyB0byB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIEBwYXJhbSB3cml0ZXIgVGhlIHdyaXRlciBvbiB3aGljaCBwb3N0LWZpeGVyIGNhbGxiYWNrcyB3aWxsIGJlIGNhbGxlZC5cblx0ICovIF9jYWxsUG9zdEZpeGVycyh3cml0ZXIpIHtcbiAgICAgICAgbGV0IHdhc0ZpeGVkID0gZmFsc2U7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgdGhpcy5fcG9zdEZpeGVycyl7XG4gICAgICAgICAgICAgICAgLy8gRW5zdXJlIHNlbGVjdGlvbiBhdHRyaWJ1dGVzIGFyZSB1cCB0byBkYXRlIGJlZm9yZSBlYWNoIHBvc3QtZml4ZXIuXG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE2NzMuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBJdCBtaWdodCBiZSBnb29kIHRvIHJlZnJlc2ggdGhlIHNlbGVjdGlvbiBhZnRlciBlYWNoIG9wZXJhdGlvbiBidXQgYXQgdGhlIG1vbWVudCBpdCBsZWFkc1xuICAgICAgICAgICAgICAgIC8vIHRvIGxvc2luZyBhdHRyaWJ1dGVzIGZvciBjb21wb3NpdGlvbiBvciBhbmQgc3BlbGwgY2hlY2tpbmdcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1LXR5cGluZy9pc3N1ZXMvMTg4XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24ucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgIHdhc0ZpeGVkID0gY2FsbGJhY2sod3JpdGVyKTtcbiAgICAgICAgICAgICAgICBpZiAod2FzRml4ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9d2hpbGUgKHdhc0ZpeGVkKVxuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgZ2l2ZW4gcmFuZ2UgYm91bmRhcnkgcG9zaXRpb24gaXMgdmFsaWQgZm9yIGRvY3VtZW50IHNlbGVjdGlvbiwgbWVhbmluZyB0aGF0IGlzIG5vdCBiZXR3ZWVuXG4gKiB1bmljb2RlIHN1cnJvZ2F0ZSBwYWlycyBvciBiYXNlIGNoYXJhY3RlciBhbmQgY29tYmluaW5nIG1hcmtzLlxuICovIGZ1bmN0aW9uIHZhbGlkYXRlVGV4dE5vZGVQb3NpdGlvbihyYW5nZUJvdW5kYXJ5KSB7XG4gICAgY29uc3QgdGV4dE5vZGUgPSByYW5nZUJvdW5kYXJ5LnRleHROb2RlO1xuICAgIGlmICh0ZXh0Tm9kZSkge1xuICAgICAgICBjb25zdCBkYXRhID0gdGV4dE5vZGUuZGF0YTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gcmFuZ2VCb3VuZGFyeS5vZmZzZXQgLSB0ZXh0Tm9kZS5zdGFydE9mZnNldDtcbiAgICAgICAgcmV0dXJuICFpc0luc2lkZVN1cnJvZ2F0ZVBhaXIoZGF0YSwgb2Zmc2V0KSAmJiAhaXNJbnNpZGVDb21iaW5lZFN5bWJvbChkYXRhLCBvZmZzZXQpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBUaGUgY29sbGVjdGlvbiBvZiBhbGwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIgbWFya2Vyc30gYXR0YWNoZWQgdG8gdGhlIGRvY3VtZW50LlxuICogSXQgbGV0cyB5b3Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uI2dldCBnZXR9IG1hcmtlcnMgb3IgdHJhY2sgdGhlbSB1c2luZ1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uI2V2ZW50OnVwZGF0ZX0gZXZlbnQuXG4gKlxuICogVG8gY3JlYXRlLCBjaGFuZ2Ugb3IgcmVtb3ZlIG1ha2VycyB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciBtb2RlbCB3cml0ZXJzJ30gbWV0aG9kczpcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjYWRkTWFya2VyfSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI3JlbW92ZU1hcmtlcn0uIFNpbmNlXG4gKiB0aGUgd3JpdGVyIGlzIHRoZSBvbmx5IHByb3BlciB3YXkgdG8gY2hhbmdlIHRoZSBkYXRhIG1vZGVsIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBjaGFuZ2UgbWFya2VycyBkaXJlY3RseSB1c2luZyB0aGlzXG4gKiBjb2xsZWN0aW9uLiBBbGwgbWFya2VycyBjcmVhdGVkIGJ5IHRoZSB3cml0ZXIgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGFkZGVkIHRvIHRoaXMgY29sbGVjdGlvbi5cbiAqXG4gKiBCeSBkZWZhdWx0IHRoZXJlIGlzIG9uZSBtYXJrZXIgY29sbGVjdGlvbiBhdmFpbGFibGUgYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjbWFya2VycyBtb2RlbCBwcm9wZXJ0eX0uXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyXG4gKi8gY2xhc3MgTWFya2VyQ29sbGVjdGlvbiBleHRlbmRzIC8qICNfX1BVUkVfXyAqLyBFbWl0dGVyTWl4aW4oKSB7XG4gICAgLyoqXG5cdCAqIFN0b3JlcyB7QGxpbmsgfk1hcmtlciBtYXJrZXJzfSBhZGRlZCB0byB0aGUgY29sbGVjdGlvbi5cblx0ICovIF9tYXJrZXJzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgYWxsIHtAbGluayB+TWFya2VyIG1hcmtlcnN9IGFkZGVkIHRvIHRoZSBjb2xsZWN0aW9uLlxuXHQgKi8gW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tYXJrZXJzLnZhbHVlcygpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIGlmIGdpdmVuIHtAbGluayB+TWFya2VyIG1hcmtlcn0gb3IgbWFya2VyIG5hbWUgaXMgaW4gdGhlIGNvbGxlY3Rpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBtYXJrZXJPck5hbWUgTmFtZSBvZiBtYXJrZXIgb3IgbWFya2VyIGluc3RhbmNlIHRvIGNoZWNrLlxuXHQgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgbWFya2VyIGlzIGluIHRoZSBjb2xsZWN0aW9uLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIGhhcyhtYXJrZXJPck5hbWUpIHtcbiAgICAgICAgY29uc3QgbWFya2VyTmFtZSA9IG1hcmtlck9yTmFtZSBpbnN0YW5jZW9mIE1hcmtlciA/IG1hcmtlck9yTmFtZS5uYW1lIDogbWFya2VyT3JOYW1lO1xuICAgICAgICByZXR1cm4gdGhpcy5fbWFya2Vycy5oYXMobWFya2VyTmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHtAbGluayB+TWFya2VyIG1hcmtlcn0gd2l0aCBnaXZlbiBgbWFya2VyTmFtZWAuXG5cdCAqXG5cdCAqIEBwYXJhbSBtYXJrZXJOYW1lIE5hbWUgb2YgbWFya2VyIHRvIGdldC5cblx0ICogQHJldHVybnMgTWFya2VyIHdpdGggZ2l2ZW4gbmFtZSBvciBgbnVsbGAgaWYgc3VjaCBtYXJrZXIgd2FzXG5cdCAqIG5vdCBhZGRlZCB0byB0aGUgY29sbGVjdGlvbi5cblx0ICovIGdldChtYXJrZXJOYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tYXJrZXJzLmdldChtYXJrZXJOYW1lKSB8fCBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbmQgYWRkcyBhIHtAbGluayB+TWFya2VyIG1hcmtlcn0gdG8gdGhlIGBNYXJrZXJDb2xsZWN0aW9uYCB3aXRoIGdpdmVuIG5hbWUgb24gZ2l2ZW5cblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2V9LlxuXHQgKlxuXHQgKiBJZiBgTWFya2VyQ29sbGVjdGlvbmAgYWxyZWFkeSBoYWQgYSBtYXJrZXIgd2l0aCBnaXZlbiBuYW1lIChvciB7QGxpbmsgfk1hcmtlciBtYXJrZXJ9IHdhcyBwYXNzZWQpLCB0aGUgbWFya2VyIGluXG5cdCAqIGNvbGxlY3Rpb24gaXMgdXBkYXRlZCBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uI2V2ZW50OnVwZGF0ZX0gZXZlbnQgaXMgZmlyZWRcblx0ICogYnV0IG9ubHkgaWYgdGhlcmUgd2FzIGEgY2hhbmdlIChtYXJrZXIgcmFuZ2Ugb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIjbWFuYWdlZFVzaW5nT3BlcmF0aW9uc31cblx0ICogZmxhZyBoYXMgY2hhbmdlZC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyB1cGRhdGVcblx0ICogQHBhcmFtIG1hcmtlck9yTmFtZSBOYW1lIG9mIG1hcmtlciB0byBzZXQgb3IgbWFya2VyIGluc3RhbmNlIHRvIHVwZGF0ZS5cblx0ICogQHBhcmFtIHJhbmdlIE1hcmtlciByYW5nZS5cblx0ICogQHBhcmFtIG1hbmFnZWRVc2luZ09wZXJhdGlvbnMgU3BlY2lmaWVzIHdoZXRoZXIgdGhlIG1hcmtlciBpcyBtYW5hZ2VkIHVzaW5nIG9wZXJhdGlvbnMuXG5cdCAqIEBwYXJhbSBhZmZlY3RzRGF0YSBTcGVjaWZpZXMgd2hldGhlciB0aGUgbWFya2VyIGFmZmVjdHMgdGhlIGRhdGEgcHJvZHVjZWQgYnkgdGhlIGRhdGEgcGlwZWxpbmVcblx0ICogKGlzIHBlcnNpc3RlZCBpbiB0aGUgZWRpdG9yJ3MgZGF0YSkuXG5cdCAqIEByZXR1cm5zIGBNYXJrZXJgIGluc3RhbmNlIHdoaWNoIHdhcyBhZGRlZCBvciB1cGRhdGVkLlxuXHQgKi8gX3NldChtYXJrZXJPck5hbWUsIHJhbmdlLCBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zID0gZmFsc2UsIGFmZmVjdHNEYXRhID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgbWFya2VyTmFtZSA9IG1hcmtlck9yTmFtZSBpbnN0YW5jZW9mIE1hcmtlciA/IG1hcmtlck9yTmFtZS5uYW1lIDogbWFya2VyT3JOYW1lO1xuICAgICAgICBpZiAobWFya2VyTmFtZS5pbmNsdWRlcygnLCcpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIE1hcmtlciBuYW1lIGNhbm5vdCBjb250YWluIHRoZSBcIixcIiBjaGFyYWN0ZXIuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIG1hcmtlcmNvbGxlY3Rpb24taW5jb3JyZWN0LW1hcmtlci1uYW1lXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21hcmtlcmNvbGxlY3Rpb24taW5jb3JyZWN0LW1hcmtlci1uYW1lJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkTWFya2VyID0gdGhpcy5fbWFya2Vycy5nZXQobWFya2VyTmFtZSk7XG4gICAgICAgIGlmIChvbGRNYXJrZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZE1hcmtlckRhdGEgPSBvbGRNYXJrZXIuZ2V0RGF0YSgpO1xuICAgICAgICAgICAgY29uc3Qgb2xkUmFuZ2UgPSBvbGRNYXJrZXIuZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgIGxldCBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoIW9sZFJhbmdlLmlzRXF1YWwocmFuZ2UpKSB7XG4gICAgICAgICAgICAgICAgb2xkTWFya2VyLl9hdHRhY2hMaXZlUmFuZ2UoTGl2ZVJhbmdlLmZyb21SYW5nZShyYW5nZSkpO1xuICAgICAgICAgICAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1hbmFnZWRVc2luZ09wZXJhdGlvbnMgIT0gb2xkTWFya2VyLm1hbmFnZWRVc2luZ09wZXJhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBvbGRNYXJrZXIuX21hbmFnZWRVc2luZ09wZXJhdGlvbnMgPSBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zO1xuICAgICAgICAgICAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBhZmZlY3RzRGF0YSA9PT0gJ2Jvb2xlYW4nICYmIGFmZmVjdHNEYXRhICE9IG9sZE1hcmtlci5hZmZlY3RzRGF0YSkge1xuICAgICAgICAgICAgICAgIG9sZE1hcmtlci5fYWZmZWN0c0RhdGEgPSBhZmZlY3RzRGF0YTtcbiAgICAgICAgICAgICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNDaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maXJlKGB1cGRhdGU6JHttYXJrZXJOYW1lfWAsIG9sZE1hcmtlciwgb2xkUmFuZ2UsIHJhbmdlLCBvbGRNYXJrZXJEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvbGRNYXJrZXI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGl2ZVJhbmdlID0gTGl2ZVJhbmdlLmZyb21SYW5nZShyYW5nZSk7XG4gICAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBNYXJrZXIobWFya2VyTmFtZSwgbGl2ZVJhbmdlLCBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zLCBhZmZlY3RzRGF0YSk7XG4gICAgICAgIHRoaXMuX21hcmtlcnMuc2V0KG1hcmtlck5hbWUsIG1hcmtlcik7XG4gICAgICAgIHRoaXMuZmlyZShgdXBkYXRlOiR7bWFya2VyTmFtZX1gLCBtYXJrZXIsIG51bGwsIHJhbmdlLCB7XG4gICAgICAgICAgICAuLi5tYXJrZXIuZ2V0RGF0YSgpLFxuICAgICAgICAgICAgcmFuZ2U6IG51bGxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBtYXJrZXI7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGdpdmVuIHtAbGluayB+TWFya2VyIG1hcmtlcn0gb3IgYSBtYXJrZXIgd2l0aCBnaXZlbiBuYW1lIGZyb20gdGhlIGBNYXJrZXJDb2xsZWN0aW9uYC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyB1cGRhdGVcblx0ICogQHBhcmFtIG1hcmtlck9yTmFtZSBNYXJrZXIgb3IgbmFtZSBvZiBhIG1hcmtlciB0byByZW1vdmUuXG5cdCAqIEByZXR1cm5zIGB0cnVlYCBpZiBtYXJrZXIgd2FzIGZvdW5kIGFuZCByZW1vdmVkLCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIF9yZW1vdmUobWFya2VyT3JOYW1lKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlck5hbWUgPSBtYXJrZXJPck5hbWUgaW5zdGFuY2VvZiBNYXJrZXIgPyBtYXJrZXJPck5hbWUubmFtZSA6IG1hcmtlck9yTmFtZTtcbiAgICAgICAgY29uc3Qgb2xkTWFya2VyID0gdGhpcy5fbWFya2Vycy5nZXQobWFya2VyTmFtZSk7XG4gICAgICAgIGlmIChvbGRNYXJrZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX21hcmtlcnMuZGVsZXRlKG1hcmtlck5hbWUpO1xuICAgICAgICAgICAgdGhpcy5maXJlKGB1cGRhdGU6JHttYXJrZXJOYW1lfWAsIG9sZE1hcmtlciwgb2xkTWFya2VyLmdldFJhbmdlKCksIG51bGwsIG9sZE1hcmtlci5nZXREYXRhKCkpO1xuICAgICAgICAgICAgdGhpcy5fZGVzdHJveU1hcmtlcihvbGRNYXJrZXIpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcblx0ICogRmlyZXMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uI2V2ZW50OnVwZGF0ZX0gZXZlbnQgZm9yIHRoZSBnaXZlbiB7QGxpbmsgfk1hcmtlciBtYXJrZXJ9XG5cdCAqIGJ1dCBkb2VzIG5vdCBjaGFuZ2UgdGhlIG1hcmtlci4gVXNlZnVsIHRvIGZvcmNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciBkb3duY2FzdFxuXHQgKiBjb252ZXJzaW9ufSBmb3IgdGhlIG1hcmtlci5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBmaXJlcyB1cGRhdGVcblx0ICogQHBhcmFtIG1hcmtlck9yTmFtZSBNYXJrZXIgb3IgbmFtZSBvZiBhIG1hcmtlciB0byByZWZyZXNoLlxuXHQgKi8gX3JlZnJlc2gobWFya2VyT3JOYW1lKSB7XG4gICAgICAgIGNvbnN0IG1hcmtlck5hbWUgPSBtYXJrZXJPck5hbWUgaW5zdGFuY2VvZiBNYXJrZXIgPyBtYXJrZXJPck5hbWUubmFtZSA6IG1hcmtlck9yTmFtZTtcbiAgICAgICAgY29uc3QgbWFya2VyID0gdGhpcy5fbWFya2Vycy5nZXQobWFya2VyTmFtZSk7XG4gICAgICAgIGlmICghbWFya2VyKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIE1hcmtlciB3aXRoIHByb3ZpZGVkIG5hbWUgZG9lcyBub3QgZXhpc3RzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBtYXJrZXJjb2xsZWN0aW9uLXJlZnJlc2gtbWFya2VyLW5vdC1leGlzdHNcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbWFya2VyY29sbGVjdGlvbi1yZWZyZXNoLW1hcmtlci1ub3QtZXhpc3RzJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZ2UgPSBtYXJrZXIuZ2V0UmFuZ2UoKTtcbiAgICAgICAgdGhpcy5maXJlKGB1cGRhdGU6JHttYXJrZXJOYW1lfWAsIG1hcmtlciwgcmFuZ2UsIHJhbmdlLCBtYXJrZXIuZ2V0RGF0YSgpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCBtYXJrZXJzLCB3aGljaCByYW5nZXMgY29udGFpbiBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiBwb3NpdGlvbn0uXG5cdCAqLyAqZ2V0TWFya2Vyc0F0UG9zaXRpb24ocG9zaXRpb24pIHtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcyl7XG4gICAgICAgICAgICBpZiAobWFya2VyLmdldFJhbmdlKCkuY29udGFpbnNQb3NpdGlvbihwb3NpdGlvbikpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCBtYXJrZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCBtYXJrZXJzLCB3aGljaCBpbnRlcnNlY3RzIHdpdGggZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2V9LlxuXHQgKi8gKmdldE1hcmtlcnNJbnRlcnNlY3RpbmdSYW5nZShyYW5nZSkge1xuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzKXtcbiAgICAgICAgICAgIGlmIChtYXJrZXIuZ2V0UmFuZ2UoKS5nZXRJbnRlcnNlY3Rpb24ocmFuZ2UpICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgbWFya2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXN0cm95cyBtYXJrZXIgY29sbGVjdGlvbiBhbmQgYWxsIG1hcmtlcnMgaW5zaWRlIGl0LlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5fbWFya2Vycy52YWx1ZXMoKSl7XG4gICAgICAgICAgICB0aGlzLl9kZXN0cm95TWFya2VyKG1hcmtlcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbWFya2VycyA9IG51bGw7XG4gICAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpO1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmF0ZXMgb3ZlciBhbGwgbWFya2VycyB0aGF0IHN0YXJ0cyB3aXRoIGdpdmVuIGBwcmVmaXhgLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBtYXJrZXJGb29BID0gbWFya2Vyc0NvbGxlY3Rpb24uX3NldCggJ2ZvbzphJywgcmFuZ2VGb29BICk7XG5cdCAqIGNvbnN0IG1hcmtlckZvb0IgPSBtYXJrZXJzQ29sbGVjdGlvbi5fc2V0KCAnZm9vOmInLCByYW5nZUZvb0IgKTtcblx0ICogY29uc3QgbWFya2VyQmFyQSA9IG1hcmtlcnNDb2xsZWN0aW9uLl9zZXQoICdiYXI6YScsIHJhbmdlQmFyQSApO1xuXHQgKiBjb25zdCBtYXJrZXJGb29CYXJBID0gbWFya2Vyc0NvbGxlY3Rpb24uX3NldCggJ2Zvb2JhcjphJywgcmFuZ2VGb29CYXJBICk7XG5cdCAqIEFycmF5LmZyb20oIG1hcmtlcnNDb2xsZWN0aW9uLmdldE1hcmtlcnNHcm91cCggJ2ZvbycgKSApOyAvLyBbIG1hcmtlckZvb0EsIG1hcmtlckZvb0IgXVxuXHQgKiBBcnJheS5mcm9tKCBtYXJrZXJzQ29sbGVjdGlvbi5nZXRNYXJrZXJzR3JvdXAoICdhJyApICk7IC8vIFtdXG5cdCAqIGBgYFxuXHQgKi8gKmdldE1hcmtlcnNHcm91cChwcmVmaXgpIHtcbiAgICAgICAgZm9yIChjb25zdCBtYXJrZXIgb2YgdGhpcy5fbWFya2Vycy52YWx1ZXMoKSl7XG4gICAgICAgICAgICBpZiAobWFya2VyLm5hbWUuc3RhcnRzV2l0aChwcmVmaXggKyAnOicpKSB7XG4gICAgICAgICAgICAgICAgeWllbGQgbWFya2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZXN0cm95cyB0aGUgbWFya2VyLlxuXHQgKi8gX2Rlc3Ryb3lNYXJrZXIobWFya2VyKSB7XG4gICAgICAgIG1hcmtlci5zdG9wTGlzdGVuaW5nKCk7XG4gICAgICAgIG1hcmtlci5fZGV0YWNoTGl2ZVJhbmdlKCk7XG4gICAgfVxufVxuLyoqXG4gKiBgTWFya2VyYCBpcyBhIGNvbnRpbnVvdXMgcGFydCBvZiB0aGUgbW9kZWwgKGxpa2UgYSByYW5nZSksIGlzIG5hbWVkIGFuZCByZXByZXNlbnRzIHNvbWUga2luZCBvZiBpbmZvcm1hdGlvbiBhYm91dCB0aGVcbiAqIG1hcmtlZCBwYXJ0IG9mIHRoZSBtb2RlbCBkb2N1bWVudC4gSW4gY29udHJhcnkgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlIG5vZGVzfSwgd2hpY2ggYXJlIGJ1aWxkaW5nIGJsb2NrcyBvZlxuICogdGhlIG1vZGVsIGRvY3VtZW50IHRyZWUsIG1hcmtlcnMgYXJlIG5vdCBzdG9yZWQgZGlyZWN0bHkgaW4gdGhlIGRvY3VtZW50IHRyZWUgYnV0IGluIHRoZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjbWFya2VycyBtb2RlbCBtYXJrZXJzJyBjb2xsZWN0aW9ufS4gU3RpbGwsIHRoZXkgYXJlIGRvY3VtZW50IGRhdGEsIGJ5IGdpdmluZ1xuICogYWRkaXRpb25hbCBtZWFuaW5nIHRvIHRoZSBwYXJ0IG9mIGEgbW9kZWwgZG9jdW1lbnQgYmV0d2VlbiBtYXJrZXIgc3RhcnQgYW5kIG1hcmtlciBlbmQuXG4gKlxuICogSW4gdGhpcyBzZW5zZSwgbWFya2VycyBhcmUgc2ltaWxhciB0byBhZGRpbmcgYW5kIGNvbnZlcnRpbmcgYXR0cmlidXRlcyBvbiBub2Rlcy4gVGhlIGRpZmZlcmVuY2UgaXMgdGhhdCBhdHRyaWJ1dGUgaXNcbiAqIGNvbm5lY3RlZCB3aXRoIGEgZ2l2ZW4gbm9kZSAoZS5nLiBhIGNoYXJhY3RlciBpcyBib2xkIG5vIG1hdHRlciBpZiBpdCBnZXRzIG1vdmVkIG9yIGNvbnRlbnQgYXJvdW5kIGl0IGNoYW5nZXMpLlxuICogTWFya2VycyBvbiB0aGUgb3RoZXIgaGFuZCBhcmUgY29udGludW91cyByYW5nZXMgYW5kIGFyZSBjaGFyYWN0ZXJpemVkIGJ5IHRoZWlyIHN0YXJ0IGFuZCBlbmQgcG9zaXRpb24uIFRoaXMgbWVhbnMgdGhhdFxuICogYW55IGNoYXJhY3RlciBpbiB0aGUgbWFya2VyIGlzIG1hcmtlZCBieSB0aGUgbWFya2VyLiBGb3IgZXhhbXBsZSwgaWYgYSBjaGFyYWN0ZXIgaXMgbW92ZWQgb3V0c2lkZSBvZiBtYXJrZXIgaXQgc3RvcHMgYmVpbmdcbiAqIFwic3BlY2lhbFwiIGFuZCB0aGUgbWFya2VyIGlzIHNocnVuay4gU2ltaWxhcmx5LCB3aGVuIGEgY2hhcmFjdGVyIGlzIG1vdmVkIGludG8gdGhlIG1hcmtlciBmcm9tIG90aGVyIHBsYWNlIGluIGRvY3VtZW50XG4gKiBtb2RlbCwgaXQgc3RhcnRzIGJlaW5nIFwic3BlY2lhbFwiIGFuZCB0aGUgbWFya2VyIGlzIGVubGFyZ2VkLlxuICpcbiAqIEFub3RoZXIgdXBzaWRlIG9mIG1hcmtlcnMgaXMgdGhhdCBmaW5kaW5nIG1hcmtlZCBwYXJ0IG9mIGRvY3VtZW50IGlzIGZhc3QgYW5kIGVhc3kuIFVzaW5nIGF0dHJpYnV0ZXMgdG8gbWFyayBzb21lIG5vZGVzXG4gKiBhbmQgdGhlbiB0cnlpbmcgdG8gZmluZCB0aGF0IHBhcnQgb2YgZG9jdW1lbnQgd291bGQgcmVxdWlyZSB0cmF2ZXJzaW5nIHdob2xlIGRvY3VtZW50IHRyZWUuIE1hcmtlciBnaXZlcyBpbnN0YW50IGFjY2Vzc1xuICogdG8gdGhlIHJhbmdlIHdoaWNoIGl0IGlzIG1hcmtpbmcgYXQgdGhlIG1vbWVudC5cbiAqXG4gKiBNYXJrZXJzIGFyZSBidWlsdCBmcm9tIGEgbmFtZSBhbmQgYSByYW5nZS5cbiAqXG4gKiBSYW5nZSBvZiB0aGUgbWFya2VyIGlzIHVwZGF0ZWQgYXV0b21hdGljYWxseSB3aGVuIGRvY3VtZW50IGNoYW5nZXMsIHVzaW5nXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcmFuZ2V+TGl2ZVJhbmdlIGxpdmUgcmFuZ2V9IG1lY2hhbmlzbS5cbiAqXG4gKiBOYW1lIGlzIHVzZWQgdG8gZ3JvdXAgYW5kIGlkZW50aWZ5IG1hcmtlcnMuIE5hbWVzIGhhdmUgdG8gYmUgdW5pcXVlLCBidXQgbWFya2VycyBjYW4gYmUgZ3JvdXBlZCBieVxuICogdXNpbmcgY29tbW9uIHByZWZpeGVzLCBzZXBhcmF0ZWQgd2l0aCBgOmAsIGZvciBleGFtcGxlOiBgdXNlcjpqb2huYCBvciBgc2VhcmNoOjNgLiBUaGF0J3MgdXNlZnVsIGluIHRlcm0gb2YgY3JlYXRpbmdcbiAqIG5hbWVzcGFjZXMgZm9yIGN1c3RvbSBlbGVtZW50cyAoZS5nLiBjb21tZW50cywgaGlnaGxpZ2h0cykuIFlvdSBjYW4gdXNlIHRoaXMgcHJlZml4ZXMgaW5cbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyQ29sbGVjdGlvbiNldmVudDp1cGRhdGV9IGxpc3RlbmVycyB0byBsaXN0ZW4gb24gY2hhbmdlcyBpbiBhIGdyb3VwIG9mIG1hcmtlcnMuXG4gKiBGb3IgaW5zdGFuY2U6IGBtb2RlbC5tYXJrZXJzLm9uKCAndXBkYXRlOnVzZXInLCBjYWxsYmFjayApO2Agd2lsbCBiZSBjYWxsZWQgd2hlbmV2ZXIgYW55IGB1c2VyOipgIG1hcmtlcnMgY2hhbmdlcy5cbiAqXG4gKiBUaGVyZSBhcmUgdHdvIHR5cGVzIG9mIG1hcmtlcnMuXG4gKlxuICogMS4gTWFya2VycyBtYW5hZ2VkIGRpcmVjdGx5LCB3aXRob3V0IHVzaW5nIG9wZXJhdGlvbnMuIFRoZXkgYXJlIGFkZGVkIGRpcmVjdGx5IGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXJ9XG4gKiB0byB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9ufSB3aXRob3V0IGFueSBhZGRpdGlvbmFsIG1lY2hhbmlzbS4gVGhleSBjYW4gYmUgdXNlZFxuICogYXMgYm9va21hcmtzIG9yIHZpc3VhbCBtYXJrZXJzLiBUaGV5IGFyZSBncmVhdCBmb3Igc2hvd2luZyByZXN1bHRzIG9mIHRoZSBmaW5kLCBvciBzZWxlY3QgbGluayB3aGVuIHRoZSBmb2N1cyBpcyBpbiB0aGUgaW5wdXQuXG4gKlxuICogMS4gTWFya2VycyBtYW5hZ2VkIHVzaW5nIG9wZXJhdGlvbnMuIFRoZXNlIG1hcmtlcnMgYXJlIGFsc28gc3RvcmVkIGluIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyQ29sbGVjdGlvbn1cbiAqIGJ1dCBjaGFuZ2VzIGluIHRoZXNlIG1hcmtlcnMgaXMgbWFuYWdlZCB0aGUgc2FtZSB3YXkgYWxsIG90aGVyIGNoYW5nZXMgaW4gdGhlIG1vZGVsIHN0cnVjdHVyZSAtIHVzaW5nIG9wZXJhdGlvbnMuXG4gKiBUaGVyZWZvcmUsIHRoZXkgYXJlIGhhbmRsZWQgaW4gdGhlIHVuZG8gc3RhY2sgYW5kIHN5bmNocm9uaXplZCBiZXR3ZWVuIGNsaWVudHMgaWYgdGhlIGNvbGxhYm9yYXRpb24gcGx1Z2luIGlzIGVuYWJsZWQuXG4gKiBUaGlzIHR5cGUgb2YgbWFya2VycyBpcyB1c2VmdWwgZm9yIHNvbHV0aW9ucyBsaWtlIHNwZWxsIGNoZWNraW5nIG9yIGNvbW1lbnRzLlxuICpcbiAqIEJvdGggdHlwZSBvZiB0aGVtIHNob3VsZCBiZSBhZGRlZCAvIHVwZGF0ZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNhZGRNYXJrZXJ9XG4gKiBhbmQgcmVtb3ZlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI3JlbW92ZU1hcmtlcn0gbWV0aG9kcy5cbiAqXG4gKiBgYGB0c1xuICogbW9kZWwuY2hhbmdlKCAoIHdyaXRlciApID0+IHtcbiAqIFx0Y29uc3QgbWFya2VyID0gd3JpdGVyLmFkZE1hcmtlciggbmFtZSwgeyByYW5nZSwgdXNpbmdPcGVyYXRpb246IHRydWUgfSApO1xuICpcbiAqIFx0Ly8gLi4uXG4gKlxuICogXHR3cml0ZXIucmVtb3ZlTWFya2VyKCBtYXJrZXIgKTtcbiAqIH0gKTtcbiAqIGBgYFxuICpcbiAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyfSB0byBmaW5kIG1vcmUgZXhhbXBsZXMuXG4gKlxuICogU2luY2UgbWFya2VycyBuZWVkIHRvIHRyYWNrIGNoYW5nZSBpbiB0aGUgZG9jdW1lbnQsIGZvciBlZmZpY2llbmN5IHJlYXNvbnMsIGl0IGlzIGJlc3QgdG8gY3JlYXRlIGFuZCBrZWVwIGFzIGxpdHRsZVxuICogbWFya2VycyBhcyBwb3NzaWJsZSBhbmQgcmVtb3ZlIHRoZW0gYXMgc29vbiBhcyB0aGV5IGFyZSBub3QgbmVlZGVkIGFueW1vcmUuXG4gKlxuICogTWFya2VycyBjYW4gYmUgZG93bmNhc3RlZCBhbmQgdXBjYXN0ZWQuXG4gKlxuICogTWFya2VycyBkb3duY2FzdCBoYXBwZW5zIG9uIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDphZGRNYXJrZXJ9IGFuZFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OnJlbW92ZU1hcmtlcn0gZXZlbnRzLlxuICogVXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzIGRvd25jYXN0IGNvbnZlcnRlcnN9IG9yIGF0dGFjaCBhIGN1c3RvbSBjb252ZXJ0ZXIgdG8gbWVudGlvbmVkIGV2ZW50cy5cbiAqIEZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2RhdGFjb250cm9sbGVyfkRhdGFDb250cm9sbGVyIGRhdGEgcGlwZWxpbmV9LCBtYXJrZXIgc2hvdWxkIGJlIGRvd25jYXN0ZWQgdG8gYW4gZWxlbWVudC5cbiAqIFRoZW4sIGl0IGNhbiBiZSB1cGNhc3RlZCBiYWNrIHRvIGEgbWFya2VyLiBBZ2FpbiwgdXNlIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0aGVscGVycyB1cGNhc3QgY29udmVydGVyc30gb3JcbiAqIGF0dGFjaCBhIGN1c3RvbSBjb252ZXJ0ZXIgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdERpc3BhdGNoZXIjZXZlbnQ6ZWxlbWVudH0uXG4gKlxuICogYE1hcmtlcmAgaW5zdGFuY2VzIGFyZSBjcmVhdGVkIGFuZCBkZXN0cm95ZWQgb25seSBieSB7QGxpbmsgfk1hcmtlckNvbGxlY3Rpb24gTWFya2VyQ29sbGVjdGlvbn0uXG4gKi8gY2xhc3MgTWFya2VyIGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbihUeXBlQ2hlY2thYmxlKSB7XG4gICAgLyoqXG5cdCAqIE1hcmtlcidzIG5hbWUuXG5cdCAqLyBuYW1lO1xuICAgIC8qKlxuXHQgKiBGbGFnIGluZGljYXRlcyBpZiB0aGUgbWFya2VyIGlzIG1hbmFnZWQgdXNpbmcgb3BlcmF0aW9ucyBvciBub3QuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX21hbmFnZWRVc2luZ09wZXJhdGlvbnM7XG4gICAgLyoqXG5cdCAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBtYXJrZXIgYWZmZWN0cyB0aGUgZGF0YSBwcm9kdWNlZCBieSB0aGUgZGF0YSBwaXBlbGluZVxuXHQgKiAoaXMgcGVyc2lzdGVkIGluIHRoZSBlZGl0b3IncyBkYXRhKS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfYWZmZWN0c0RhdGE7XG4gICAgLyoqXG5cdCAqIFJhbmdlIG1hcmtlZCBieSB0aGUgbWFya2VyLlxuXHQgKi8gX2xpdmVSYW5nZTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG1hcmtlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgTWFya2VyIG5hbWUuXG5cdCAqIEBwYXJhbSBsaXZlUmFuZ2UgUmFuZ2UgbWFya2VkIGJ5IHRoZSBtYXJrZXIuXG5cdCAqIEBwYXJhbSBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBtYXJrZXIgaXMgbWFuYWdlZCB1c2luZyBvcGVyYXRpb25zLlxuXHQgKiBAcGFyYW0gYWZmZWN0c0RhdGEgU3BlY2lmaWVzIHdoZXRoZXIgdGhlIG1hcmtlciBhZmZlY3RzIHRoZSBkYXRhIHByb2R1Y2VkIGJ5IHRoZSBkYXRhIHBpcGVsaW5lIChpcyBwZXJzaXN0ZWQgaW4gdGhlIGVkaXRvcidzIGRhdGEpLlxuXHQgKi8gY29uc3RydWN0b3IobmFtZSwgbGl2ZVJhbmdlLCBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zLCBhZmZlY3RzRGF0YSl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuX2xpdmVSYW5nZSA9IHRoaXMuX2F0dGFjaExpdmVSYW5nZShsaXZlUmFuZ2UpO1xuICAgICAgICB0aGlzLl9tYW5hZ2VkVXNpbmdPcGVyYXRpb25zID0gbWFuYWdlZFVzaW5nT3BlcmF0aW9ucztcbiAgICAgICAgdGhpcy5fYWZmZWN0c0RhdGEgPSBhZmZlY3RzRGF0YTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgdmFsdWUgaW5kaWNhdGluZyBpZiB0aGUgbWFya2VyIGlzIG1hbmFnZWQgdXNpbmcgb3BlcmF0aW9ucy5cblx0ICogU2VlIHtAbGluayB+TWFya2VyIG1hcmtlciBjbGFzcyBkZXNjcmlwdGlvbn0gdG8gbGVhcm4gbW9yZSBhYm91dCBtYXJrZXIgdHlwZXMuXG5cdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2FkZE1hcmtlcn0uXG5cdCAqLyBnZXQgbWFuYWdlZFVzaW5nT3BlcmF0aW9ucygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9saXZlUmFuZ2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtYXJrZXItZGVzdHJveWVkJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX21hbmFnZWRVc2luZ09wZXJhdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBIHZhbHVlIGluZGljYXRpbmcgaWYgdGhlIG1hcmtlciBjaGFuZ2VzIHRoZSBkYXRhLlxuXHQgKi8gZ2V0IGFmZmVjdHNEYXRhKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2xpdmVSYW5nZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21hcmtlci1kZXN0cm95ZWQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fYWZmZWN0c0RhdGE7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBtYXJrZXIgZGF0YSAocHJvcGVydGllcyBkZWZpbmluZyB0aGUgbWFya2VyKS5cblx0ICovIGdldERhdGEoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByYW5nZTogdGhpcy5nZXRSYW5nZSgpLFxuICAgICAgICAgICAgYWZmZWN0c0RhdGE6IHRoaXMuYWZmZWN0c0RhdGEsXG4gICAgICAgICAgICBtYW5hZ2VkVXNpbmdPcGVyYXRpb25zOiB0aGlzLm1hbmFnZWRVc2luZ09wZXJhdGlvbnNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgY3VycmVudCBtYXJrZXIgc3RhcnQgcG9zaXRpb24uXG5cdCAqLyBnZXRTdGFydCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9saXZlUmFuZ2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdtYXJrZXItZGVzdHJveWVkJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpdmVSYW5nZS5zdGFydC5jbG9uZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBjdXJyZW50IG1hcmtlciBlbmQgcG9zaXRpb24uXG5cdCAqLyBnZXRFbmQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fbGl2ZVJhbmdlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbWFya2VyLWRlc3Ryb3llZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9saXZlUmFuZ2UuZW5kLmNsb25lKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgcmFuZ2UgdGhhdCByZXByZXNlbnRzIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBtYXJrZXIuXG5cdCAqXG5cdCAqIEtlZXAgaW4gbWluZCB0aGF0IHJldHVybmVkIHZhbHVlIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgUmFuZ2V9LCBub3QgYVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9saXZlcmFuZ2V+TGl2ZVJhbmdlIExpdmVSYW5nZX0uIFRoaXMgbWVhbnMgdGhhdCBpdCBpcyB1cC10by1kYXRlIGFuZCByZWxldmFudCBvbmx5XG5cdCAqIHVudGlsIG5leHQgbW9kZWwgZG9jdW1lbnQgY2hhbmdlLiBEbyBub3Qgc3RvcmUgdmFsdWVzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kLiBJbnN0ZWFkLCBzdG9yZSB7QGxpbmsgfk1hcmtlciNuYW1lfVxuXHQgKiBhbmQgZ2V0IGBNYXJrZXJgIGluc3RhbmNlIGZyb20ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uIE1hcmtlckNvbGxlY3Rpb259IGV2ZXJ5XG5cdCAqIHRpbWUgdGhlcmUgaXMgYSBuZWVkIHRvIHJlYWQgbWFya2VyIHByb3BlcnRpZXMuIFRoaXMgd2lsbCBndWFyYW50ZWUgdGhhdCB0aGUgbWFya2VyIGhhcyBub3QgYmVlbiByZW1vdmVkIGFuZFxuXHQgKiB0aGF0IGl0J3MgZGF0YSBpcyB1cC10by1kYXRlLlxuXHQgKi8gZ2V0UmFuZ2UoKSB7XG4gICAgICAgIGlmICghdGhpcy5fbGl2ZVJhbmdlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbWFya2VyLWRlc3Ryb3llZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9saXZlUmFuZ2UudG9SYW5nZSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQmluZHMgbmV3IGxpdmUgcmFuZ2UgdG8gdGhlIG1hcmtlciBhbmQgZGV0YWNoIHRoZSBvbGQgb25lIGlmIGlzIGF0dGFjaGVkLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGxpdmVSYW5nZSBMaXZlIHJhbmdlIHRvIGF0dGFjaFxuXHQgKiBAcmV0dXJucyBBdHRhY2hlZCBsaXZlIHJhbmdlLlxuXHQgKi8gX2F0dGFjaExpdmVSYW5nZShsaXZlUmFuZ2UpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpdmVSYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5fZGV0YWNoTGl2ZVJhbmdlKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRGVsZWdhdGluZyBkb2VzIG5vdCB3b3JrIHdpdGggbmFtZXNwYWNlcy4gQWx0ZXJuYXRpdmVseSwgd2UgY291bGQgZGVsZWdhdGUgYWxsIGV2ZW50cyAodXNpbmcgYCpgKS5cbiAgICAgICAgbGl2ZVJhbmdlLmRlbGVnYXRlKCdjaGFuZ2U6cmFuZ2UnKS50byh0aGlzKTtcbiAgICAgICAgbGl2ZVJhbmdlLmRlbGVnYXRlKCdjaGFuZ2U6Y29udGVudCcpLnRvKHRoaXMpO1xuICAgICAgICB0aGlzLl9saXZlUmFuZ2UgPSBsaXZlUmFuZ2U7XG4gICAgICAgIHJldHVybiBsaXZlUmFuZ2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVbmJpbmRzIGFuZCBkZXN0cm95cyBjdXJyZW50bHkgYXR0YWNoZWQgbGl2ZSByYW5nZS5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfZGV0YWNoTGl2ZVJhbmdlKCkge1xuICAgICAgICB0aGlzLl9saXZlUmFuZ2Uuc3RvcERlbGVnYXRpbmcoJ2NoYW5nZTpyYW5nZScsIHRoaXMpO1xuICAgICAgICB0aGlzLl9saXZlUmFuZ2Uuc3RvcERlbGVnYXRpbmcoJ2NoYW5nZTpjb250ZW50JywgdGhpcyk7XG4gICAgICAgIHRoaXMuX2xpdmVSYW5nZS5kZXRhY2goKTtcbiAgICAgICAgdGhpcy5fbGl2ZVJhbmdlID0gbnVsbDtcbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5NYXJrZXIucHJvdG90eXBlLmlzID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0eXBlID09PSAnbWFya2VyJyB8fCB0eXBlID09PSAnbW9kZWw6bWFya2VyJztcbn07XG4gLyoqXG4gKiBDYW5ub3QgdXNlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJDb2xsZWN0aW9uI2Rlc3Ryb3kgZGVzdHJveWVkIG1hcmtlcn0gaW5zdGFuY2UuXG4gKlxuICogQGVycm9yIG1hcmtlci1kZXN0cm95ZWRcbiAqL1xuXG4vLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGNvbnN0IE1vZGVsUmFuZ2UgPSByZXF1aXJlKCAnLi4vcmFuZ2UnICkuZGVmYXVsdDtcbi8qKlxuICogT3BlcmF0aW9uIHRvIHBlcm1hbmVudGx5IHJlbW92ZSBub2RlIGZyb20gZGV0YWNoZWQgcm9vdC5cbiAqIE5vdGUgdGhpcyBvcGVyYXRpb24gaXMgb25seSBhIGxvY2FsIG9wZXJhdGlvbiBhbmQgd29uJ3QgYmUgc2VuZCB0byB0aGUgb3RoZXIgY2xpZW50cy5cbiAqLyBjbGFzcyBEZXRhY2hPcGVyYXRpb24gZXh0ZW5kcyBPcGVyYXRpb24ge1xuICAgIC8qKlxuXHQgKiBQb3NpdGlvbiBiZWZvcmUgdGhlIGZpcnN0IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfSB0byBkZXRhY2guXG5cdCAqLyBzb3VyY2VQb3NpdGlvbjtcbiAgICAvKipcblx0ICogT2Zmc2V0IHNpemUgb2YgbW92ZWQgcmFuZ2UuXG5cdCAqLyBob3dNYW55O1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc2VydCBvcGVyYXRpb24uXG5cdCAqXG5cdCAqIEBwYXJhbSBzb3VyY2VQb3NpdGlvbiBQb3NpdGlvbiBiZWZvcmUgdGhlIGZpcnN0IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfSB0byBtb3ZlLlxuXHQgKiBAcGFyYW0gaG93TWFueSBPZmZzZXQgc2l6ZSBvZiBtb3ZlZCByYW5nZS4gTW92ZWQgcmFuZ2Ugd2lsbCBzdGFydCBmcm9tIGBzb3VyY2VQb3NpdGlvbmAgYW5kIGVuZCBhdFxuXHQgKiBgc291cmNlUG9zaXRpb25gIHdpdGggb2Zmc2V0IHNoaWZ0ZWQgYnkgYGhvd01hbnlgLlxuXHQgKi8gY29uc3RydWN0b3Ioc291cmNlUG9zaXRpb24sIGhvd01hbnkpe1xuICAgICAgICBzdXBlcihudWxsKTtcbiAgICAgICAgdGhpcy5zb3VyY2VQb3NpdGlvbiA9IHNvdXJjZVBvc2l0aW9uLmNsb25lKCk7XG4gICAgICAgIHRoaXMuaG93TWFueSA9IGhvd01hbnk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZ2V0IHR5cGUoKSB7XG4gICAgICAgIHJldHVybiAnZGV0YWNoJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBnZXQgYWZmZWN0ZWRTZWxlY3RhYmxlKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGpzb24gPSBzdXBlci50b0pTT04oKTtcbiAgICAgICAganNvbi5zb3VyY2VQb3NpdGlvbiA9IHRoaXMuc291cmNlUG9zaXRpb24udG9KU09OKCk7XG4gICAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICogQGludGVybmFsXG5cdCAqLyBfdmFsaWRhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnNvdXJjZVBvc2l0aW9uLnJvb3QuZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogQ2Fubm90IGRldGFjaCBkb2N1bWVudCBub2RlLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBkZXRhY2gtb3BlcmF0aW9uLW9uLWRvY3VtZW50LW5vZGVcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignZGV0YWNoLW9wZXJhdGlvbi1vbi1kb2N1bWVudC1ub2RlJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX2V4ZWN1dGUoKSB7XG4gICAgICAgIF9yZW1vdmUoUmFuZ2UuX2NyZWF0ZUZyb21Qb3NpdGlvbkFuZFNoaWZ0KHRoaXMuc291cmNlUG9zaXRpb24sIHRoaXMuaG93TWFueSkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgY2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0RldGFjaE9wZXJhdGlvbic7XG4gICAgfVxufVxuXG4vLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGNvbnN0IHsgc3RyaW5naWZ5TWFwIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLyoqXG4gKiBEb2N1bWVudEZyYWdtZW50IHJlcHJlc2VudHMgYSBwYXJ0IG9mIG1vZGVsIHdoaWNoIGRvZXMgbm90IGhhdmUgYSBjb21tb24gcm9vdCBidXQgaXRzIHRvcC1sZXZlbCBub2Rlc1xuICogY2FuIGJlIHNlZW4gYXMgc2libGluZ3MuIEluIG90aGVyIHdvcmRzLCBpdCBpcyBhIGRldGFjaGVkIHBhcnQgb2YgbW9kZWwgdHJlZSwgd2l0aG91dCBhIHJvb3QuXG4gKlxuICogRG9jdW1lbnRGcmFnbWVudCBoYXMgb3duIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyQ29sbGVjdGlvbn0uIE1hcmtlcnMgZnJvbSB0aGlzIGNvbGxlY3Rpb25cbiAqIHdpbGwgYmUgc2V0IHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNtYXJrZXJzIG1vZGVsIG1hcmtlcnN9IGJ5IGFcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjaW5zZXJ0fSBmdW5jdGlvbi5cbiAqLyBjbGFzcyBEb2N1bWVudEZyYWdtZW50IGV4dGVuZHMgVHlwZUNoZWNrYWJsZSB7XG4gICAgLyoqXG5cdCAqIERvY3VtZW50RnJhZ21lbnQgc3RhdGljIG1hcmtlcnMgbWFwLiBUaGlzIGlzIGEgbGlzdCBvZiBuYW1lcyBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2VzfVxuXHQgKiB3aGljaCB3aWxsIGJlIHNldCBhcyBNYXJrZXJzIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI21hcmtlcnMgbW9kZWwgbWFya2VycyBjb2xsZWN0aW9ufVxuXHQgKiB3aGVuIERvY3VtZW50RnJhZ21lbnQgd2lsbCBiZSBpbnNlcnRlZCB0byB0aGUgZG9jdW1lbnQuXG5cdCAqLyBtYXJrZXJzID0gbmV3IE1hcCgpO1xuICAgIC8qKlxuXHQgKiBMaXN0IG9mIG5vZGVzIGNvbnRhaW5lZCBpbnNpZGUgdGhlIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKi8gX2NoaWxkcmVuID0gbmV3IE5vZGVMaXN0KCk7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gZW1wdHkgYERvY3VtZW50RnJhZ21lbnRgLlxuXHQgKlxuXHQgKiAqKk5vdGU6KiogQ29uc3RydWN0b3Igb2YgdGhpcyBjbGFzcyBzaG91bGRuJ3QgYmUgdXNlZCBkaXJlY3RseSBpbiB0aGUgY29kZS5cblx0ICogVXNlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZURvY3VtZW50RnJhZ21lbnR9IG1ldGhvZCBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGNoaWxkcmVuIE5vZGVzIHRvIGJlIGNvbnRhaW5lZCBpbnNpZGUgdGhlIGBEb2N1bWVudEZyYWdtZW50YC5cblx0ICovIGNvbnN0cnVjdG9yKGNoaWxkcmVuKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgaWYgKGNoaWxkcmVuKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRDaGlsZCgwLCBjaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYW4gaXRlcmF0b3IgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCBub2RlcyBjb250YWluZWQgaW5zaWRlIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqLyBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2hpbGRyZW4oKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE51bWJlciBvZiB0aGlzIGRvY3VtZW50IGZyYWdtZW50J3MgY2hpbGRyZW4uXG5cdCAqLyBnZXQgY2hpbGRDb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN1bSBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjb2Zmc2V0U2l6ZSBvZmZzZXQgc2l6ZXN9IG9mIGFsbCBvZiB0aGlzIGRvY3VtZW50IGZyYWdtZW50J3MgY2hpbGRyZW4uXG5cdCAqLyBnZXQgbWF4T2Zmc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4ubWF4T2Zmc2V0O1xuICAgIH1cbiAgICAvKipcblx0ICogSXMgYHRydWVgIGlmIHRoZXJlIGFyZSBubyBub2RlcyBpbnNpZGUgdGhpcyBkb2N1bWVudCBmcmFnbWVudCwgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBnZXQgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRDb3VudCA9PT0gMDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgbmV4dCBzaWJsaW5nLiBSZXR1cm5zIGBudWxsYC4gQWRkZWQgZm9yIGNvbXBhdGliaWxpdHkgcmVhc29ucy5cblx0ICovIGdldCBuZXh0U2libGluZygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBcnRpZmljaWFsIHByZXZpb3VzIHNpYmxpbmcuIFJldHVybnMgYG51bGxgLiBBZGRlZCBmb3IgY29tcGF0aWJpbGl0eSByZWFzb25zLlxuXHQgKi8gZ2V0IHByZXZpb3VzU2libGluZygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBcnRpZmljaWFsIHJvb3Qgb2YgYERvY3VtZW50RnJhZ21lbnRgLiBSZXR1cm5zIGl0c2VsZi4gQWRkZWQgZm9yIGNvbXBhdGliaWxpdHkgcmVhc29ucy5cblx0ICovIGdldCByb290KCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgcGFyZW50IG9mIGBEb2N1bWVudEZyYWdtZW50YC4gUmV0dXJucyBgbnVsbGAuIEFkZGVkIGZvciBjb21wYXRpYmlsaXR5IHJlYXNvbnMuXG5cdCAqLyBnZXQgcGFyZW50KCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFydGlmaWNpYWwgb3duZXIgb2YgYERvY3VtZW50RnJhZ21lbnRgLiBSZXR1cm5zIGBudWxsYC4gQWRkZWQgZm9yIGNvbXBhdGliaWxpdHkgcmVhc29ucy5cblx0ICovIGdldCBkb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGBmYWxzZWAgYXMgYERvY3VtZW50RnJhZ21lbnRgIGJ5IGRlZmluaXRpb24gaXMgbm90IGF0dGFjaGVkIHRvIGEgZG9jdW1lbnQuIEFkZGVkIGZvciBjb21wYXRpYmlsaXR5IHJlYXNvbnMuXG5cdCAqLyBpc0F0dGFjaGVkKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGVtcHR5IGFycmF5LiBBZGRlZCBmb3IgY29tcGF0aWJpbGl0eSByZWFzb25zLlxuXHQgKi8gZ2V0QW5jZXN0b3JzKCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBjaGlsZCBhdCB0aGUgZ2l2ZW4gaW5kZXguIFJldHVybnMgYG51bGxgIGlmIGluY29ycmVjdCBpbmRleCB3YXMgcGFzc2VkLlxuXHQgKlxuXHQgKiBAcGFyYW0gaW5kZXggSW5kZXggaW4gdGhpcyBkb2N1bWVudCBmcmFnbWVudC5cblx0ICogQHJldHVybnMgQ2hpbGQgbm9kZS5cblx0ICovIGdldENoaWxkKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5nZXROb2RlKGluZGV4KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgdGhlIGNoaWxkIGF0IHRoZSBnaXZlbiBvZmZzZXQuIFJldHVybnMgYG51bGxgIGlmIGluY29ycmVjdCBpbmRleCB3YXMgcGFzc2VkLlxuXHQgKlxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBpbiB0aGlzIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlLlxuXHQgKi8gZ2V0Q2hpbGRBdE9mZnNldChvZmZzZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmdldE5vZGVBdE9mZnNldChvZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpdGVyYXRvciB0aGF0IGl0ZXJhdGVzIG92ZXIgYWxsIG9mIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQncyBjaGlsZHJlbi5cblx0ICovIGdldENoaWxkcmVuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW5bU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBpbmRleCBvZiB0aGUgZ2l2ZW4gY2hpbGQgbm9kZS4gUmV0dXJucyBgbnVsbGAgaWYgZ2l2ZW4gbm9kZSBpcyBub3QgYSBjaGlsZCBvZiB0aGlzIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBDaGlsZCBub2RlIHRvIGxvb2sgZm9yLlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlJ3MgaW5kZXguXG5cdCAqLyBnZXRDaGlsZEluZGV4KG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLmdldE5vZGVJbmRleChub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIHN0YXJ0aW5nIG9mZnNldCBvZiBnaXZlbiBjaGlsZC4gU3RhcnRpbmcgb2Zmc2V0IGlzIGVxdWFsIHRvIHRoZSBzdW0gb2Zcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI29mZnNldFNpemUgb2Zmc2V0IHNpemVzfSBvZiBhbGwgbm9kZSdzIHNpYmxpbmdzIHRoYXQgYXJlIGJlZm9yZSBpdC4gUmV0dXJucyBgbnVsbGAgaWZcblx0ICogZ2l2ZW4gbm9kZSBpcyBub3QgYSBjaGlsZCBvZiB0aGlzIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBDaGlsZCBub2RlIHRvIGxvb2sgZm9yLlxuXHQgKiBAcmV0dXJucyBDaGlsZCBub2RlJ3Mgc3RhcnRpbmcgb2Zmc2V0LlxuXHQgKi8gZ2V0Q2hpbGRTdGFydE9mZnNldChub2RlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5nZXROb2RlU3RhcnRPZmZzZXQobm9kZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHBhdGggdG8gYSBgRG9jdW1lbnRGcmFnbWVudGAsIHdoaWNoIGlzIGFuIGVtcHR5IGFycmF5LiBBZGRlZCBmb3IgY29tcGF0aWJpbGl0eSByZWFzb25zLlxuXHQgKi8gZ2V0UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIGRlc2NlbmRhbnQgbm9kZSBieSBpdHMgcGF0aCByZWxhdGl2ZSB0byB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIDx0aGlzPmE8Yj5jPC9iPjwvdGhpcz5cblx0ICogdGhpcy5nZXROb2RlQnlQYXRoKCBbIDAgXSApOyAgICAgLy8gLT4gXCJhXCJcblx0ICogdGhpcy5nZXROb2RlQnlQYXRoKCBbIDEgXSApOyAgICAgLy8gLT4gPGI+XG5cdCAqIHRoaXMuZ2V0Tm9kZUJ5UGF0aCggWyAxLCAwIF0gKTsgIC8vIC0+IFwiY1wiXG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIFBhdGggb2YgdGhlIG5vZGUgdG8gZmluZCwgcmVsYXRpdmUgdG8gdGhpcyBlbGVtZW50LlxuXHQgKi8gZ2V0Tm9kZUJ5UGF0aChyZWxhdGl2ZVBhdGgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzLCBjb25zaXN0ZW50LXRoaXNcbiAgICAgICAgbGV0IG5vZGUgPSB0aGlzO1xuICAgICAgICBmb3IgKGNvbnN0IG9mZnNldCBvZiByZWxhdGl2ZVBhdGgpe1xuICAgICAgICAgICAgbm9kZSA9IG5vZGUuZ2V0Q2hpbGRBdE9mZnNldChvZmZzZXQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgb2Zmc2V0IFwicG9zaXRpb25cIiB0byBpbmRleCBcInBvc2l0aW9uXCIuXG5cdCAqXG5cdCAqIFJldHVybnMgaW5kZXggb2YgYSBub2RlIHRoYXQgb2NjdXBpZXMgZ2l2ZW4gb2Zmc2V0LiBJZiBnaXZlbiBvZmZzZXQgaXMgdG9vIGxvdywgcmV0dXJucyBgMGAuIElmIGdpdmVuIG9mZnNldCBpc1xuXHQgKiB0b28gaGlnaCwgcmV0dXJucyBpbmRleCBhZnRlciBsYXN0IGNoaWxkLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCB0ZXh0Tm9kZSA9IG5ldyBUZXh0KCAnZm9vJyApO1xuXHQgKiBjb25zdCBwRWxlbWVudCA9IG5ldyBFbGVtZW50KCAncCcgKTtcblx0ICogY29uc3QgZG9jRnJhZyA9IG5ldyBEb2N1bWVudEZyYWdtZW50KCBbIHRleHROb2RlLCBwRWxlbWVudCBdICk7XG5cdCAqIGRvY0ZyYWcub2Zmc2V0VG9JbmRleCggLTEgKTsgLy8gUmV0dXJucyAwLCBiZWNhdXNlIG9mZnNldCBpcyB0b28gbG93LlxuXHQgKiBkb2NGcmFnLm9mZnNldFRvSW5kZXgoIDAgKTsgLy8gUmV0dXJucyAwLCBiZWNhdXNlIG9mZnNldCAwIGlzIHRha2VuIGJ5IGB0ZXh0Tm9kZWAgd2hpY2ggaXMgYXQgaW5kZXggMC5cblx0ICogZG9jRnJhZy5vZmZzZXRUb0luZGV4KCAxICk7IC8vIFJldHVybnMgMCwgYmVjYXVzZSBgdGV4dE5vZGVgIGhhcyBgb2Zmc2V0U2l6ZWAgZXF1YWwgdG8gMywgc28gaXQgb2NjdXBpZXMgb2Zmc2V0IDEgdG9vLlxuXHQgKiBkb2NGcmFnLm9mZnNldFRvSW5kZXgoIDIgKTsgLy8gUmV0dXJucyAwLlxuXHQgKiBkb2NGcmFnLm9mZnNldFRvSW5kZXgoIDMgKTsgLy8gUmV0dXJucyAxLlxuXHQgKiBkb2NGcmFnLm9mZnNldFRvSW5kZXgoIDQgKTsgLy8gUmV0dXJucyAyLiBUaGVyZSBhcmUgbm8gbm9kZXMgYXQgb2Zmc2V0IDQsIHNvIGxhc3QgYXZhaWxhYmxlIGluZGV4IGlzIHJldHVybmVkLlxuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgdG8gbG9vayBmb3IuXG5cdCAqIEByZXR1cm5zIEluZGV4IG9mIGEgbm9kZSB0aGF0IG9jY3VwaWVzIGdpdmVuIG9mZnNldC5cblx0ICovIG9mZnNldFRvSW5kZXgob2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5vZmZzZXRUb0luZGV4KG9mZnNldCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDb252ZXJ0cyBgRG9jdW1lbnRGcmFnbWVudGAgaW5zdGFuY2UgdG8gcGxhaW4gb2JqZWN0IGFuZCByZXR1cm5zIGl0LlxuXHQgKiBUYWtlcyBjYXJlIG9mIGNvbnZlcnRpbmcgYWxsIG9mIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQncyBjaGlsZHJlbi5cblx0ICpcblx0ICogQHJldHVybnMgYERvY3VtZW50RnJhZ21lbnRgIGluc3RhbmNlIGNvbnZlcnRlZCB0byBwbGFpbiBvYmplY3QuXG5cdCAqLyB0b0pTT04oKSB7XG4gICAgICAgIGNvbnN0IGpzb24gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXMuX2NoaWxkcmVuKXtcbiAgICAgICAgICAgIGpzb24ucHVzaChub2RlLnRvSlNPTigpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ganNvbjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBgRG9jdW1lbnRGcmFnbWVudGAgaW5zdGFuY2UgZnJvbSBnaXZlbiBwbGFpbiBvYmplY3QgKGkuZS4gcGFyc2VkIEpTT04gc3RyaW5nKS5cblx0ICogQ29udmVydHMgYERvY3VtZW50RnJhZ21lbnRgIGNoaWxkcmVuIHRvIHByb3BlciBub2Rlcy5cblx0ICpcblx0ICogQHBhcmFtIGpzb24gUGxhaW4gb2JqZWN0IHRvIGJlIGNvbnZlcnRlZCB0byBgRG9jdW1lbnRGcmFnbWVudGAuXG5cdCAqIEByZXR1cm5zIGBEb2N1bWVudEZyYWdtZW50YCBpbnN0YW5jZSBjcmVhdGVkIHVzaW5nIGdpdmVuIHBsYWluIG9iamVjdC5cblx0ICovIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YganNvbil7XG4gICAgICAgICAgICBpZiAoY2hpbGQubmFtZSkge1xuICAgICAgICAgICAgICAgIC8vIElmIGNoaWxkIGhhcyBuYW1lIHByb3BlcnR5LCBpdCBpcyBhbiBFbGVtZW50LlxuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goRWxlbWVudC5mcm9tSlNPTihjaGlsZCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGl0IGlzIGEgVGV4dCBub2RlLlxuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goVGV4dC5mcm9tSlNPTihjaGlsZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRGcmFnbWVudChjaGlsZHJlbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiB7QGxpbmsgI19pbnNlcnRDaGlsZCBJbnNlcnRzfSBvbmUgb3IgbW9yZSBub2RlcyBhdCB0aGUgZW5kIG9mIHRoaXMgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqLyBfYXBwZW5kQ2hpbGQoaXRlbXMpIHtcbiAgICAgICAgdGhpcy5faW5zZXJ0Q2hpbGQodGhpcy5jaGlsZENvdW50LCBpdGVtcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnNlcnRzIG9uZSBvciBtb3JlIG5vZGVzIGF0IHRoZSBnaXZlbiBpbmRleCBhbmQgc2V0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjcGFyZW50IHBhcmVudH0gb2YgdGhlc2Ugbm9kZXNcblx0ICogdG8gdGhpcyBkb2N1bWVudCBmcmFnbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBpbmRleCBJbmRleCBhdCB3aGljaCBub2RlcyBzaG91bGQgYmUgaW5zZXJ0ZWQuXG5cdCAqIEBwYXJhbSBpdGVtcyBJdGVtcyB0byBiZSBpbnNlcnRlZC5cblx0ICovIF9pbnNlcnRDaGlsZChpbmRleCwgaXRlbXMpIHtcbiAgICAgICAgY29uc3Qgbm9kZXMgPSBub3JtYWxpemUoaXRlbXMpO1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygbm9kZXMpe1xuICAgICAgICAgICAgLy8gSWYgbm9kZSB0aGF0IGlzIGJlaW5nIGFkZGVkIHRvIHRoaXMgZWxlbWVudCBpcyBhbHJlYWR5IGluc2lkZSBhbm90aGVyIGVsZW1lbnQsIGZpcnN0IHJlbW92ZSBpdCBmcm9tIHRoZSBvbGQgcGFyZW50LlxuICAgICAgICAgICAgaWYgKG5vZGUucGFyZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgbm9kZS5fcmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2hpbGRyZW4uX2luc2VydE5vZGVzKGluZGV4LCBub2Rlcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIG9uZSBvciBtb3JlIG5vZGVzIHN0YXJ0aW5nIGF0IHRoZSBnaXZlbiBpbmRleFxuXHQgKiBhbmQgc2V0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9ub2Rlfk5vZGUjcGFyZW50IHBhcmVudH0gb2YgdGhlc2Ugbm9kZXMgdG8gYG51bGxgLlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICogQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBmaXJzdCBub2RlIHRvIHJlbW92ZS5cblx0ICogQHBhcmFtIGhvd01hbnkgTnVtYmVyIG9mIG5vZGVzIHRvIHJlbW92ZS5cblx0ICogQHJldHVybnMgQXJyYXkgY29udGFpbmluZyByZW1vdmVkIG5vZGVzLlxuXHQgKi8gX3JlbW92ZUNoaWxkcmVuKGluZGV4LCBob3dNYW55ID0gMSkge1xuICAgICAgICBjb25zdCBub2RlcyA9IHRoaXMuX2NoaWxkcmVuLl9yZW1vdmVOb2RlcyhpbmRleCwgaG93TWFueSk7XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGVzO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBjaGlsZHJlbiBub2RlcyBwcm92aWRlZCBhcyBhbiBhcnJheSBhbmQgc2V0c1xuXHQgKiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbm9kZX5Ob2RlI3BhcmVudCBwYXJlbnR9IG9mIHRoZXNlIG5vZGVzIHRvIGBudWxsYC5cblx0ICpcblx0ICogVGhlc2Ugbm9kZXMgZG8gbm90IG5lZWQgdG8gYmUgZGlyZWN0IHNpYmxpbmdzLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyBmYXN0ZXIgdGhhbiByZW1vdmluZyBub2RlcyBvbmUgYnkgb25lLCBhcyBpdCByZWNhbGN1bGF0ZXMgb2Zmc2V0cyBvbmx5IG9uY2UuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gbm9kZXMgQXJyYXkgb2Ygbm9kZXMuXG5cdCAqLyBfcmVtb3ZlQ2hpbGRyZW5BcnJheShub2Rlcykge1xuICAgICAgICB0aGlzLl9jaGlsZHJlbi5fcmVtb3ZlTm9kZXNBcnJheShub2Rlcyk7XG4gICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlcyl7XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4vLyBUaGUgbWFnaWMgb2YgdHlwZSBpbmZlcmVuY2UgdXNpbmcgYGlzYCBtZXRob2QgaXMgY2VudHJhbGl6ZWQgaW4gYFR5cGVDaGVja2FibGVgIGNsYXNzLlxuLy8gUHJvcGVyIG92ZXJsb2FkIHdvdWxkIGludGVyZmVyZSB3aXRoIHRoYXQuXG5Eb2N1bWVudEZyYWdtZW50LnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ2RvY3VtZW50RnJhZ21lbnQnIHx8IHR5cGUgPT09ICdtb2RlbDpkb2N1bWVudEZyYWdtZW50Jztcbn07XG4vKipcbiAqIENvbnZlcnRzIHN0cmluZ3MgdG8gVGV4dCBhbmQgbm9uLWl0ZXJhYmxlcyB0byBhcnJheXMuXG4gKi8gZnVuY3Rpb24gbm9ybWFsaXplKG5vZGVzKSB7XG4gICAgLy8gU2VwYXJhdGUgY29uZGl0aW9uIGJlY2F1c2Ugc3RyaW5nIGlzIGl0ZXJhYmxlLlxuICAgIGlmICh0eXBlb2Ygbm9kZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIG5ldyBUZXh0KG5vZGVzKVxuICAgICAgICBdO1xuICAgIH1cbiAgICBpZiAoIWlzSXRlcmFibGUobm9kZXMpKSB7XG4gICAgICAgIG5vZGVzID0gW1xuICAgICAgICAgICAgbm9kZXNcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gQXJyYXkuZnJvbSB0byBlbmFibGUgLm1hcCgpIG9uIG5vbi1hcnJheXMuXG4gICAgcmV0dXJuIEFycmF5LmZyb20obm9kZXMpLm1hcCgobm9kZSk9PntcbiAgICAgICAgaWYgKHR5cGVvZiBub2RlID09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFRleHQobm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBUZXh0UHJveHkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGV4dChub2RlLmRhdGEsIG5vZGUuZ2V0QXR0cmlidXRlcygpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9kZTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBUaGUgbW9kZWwgY2FuIG9ubHkgYmUgbW9kaWZpZWQgYnkgdXNpbmcgdGhlIHdyaXRlci4gSXQgc2hvdWxkIGJlIHVzZWQgd2hlbmV2ZXIgeW91IHdhbnQgdG8gY3JlYXRlIGEgbm9kZSwgbW9kaWZ5XG4gKiBjaGlsZCBub2RlcywgYXR0cmlidXRlcyBvciB0ZXh0LCBzZXQgdGhlIHNlbGVjdGlvbidzIHBvc2l0aW9uIGFuZCBpdHMgYXR0cmlidXRlcy5cbiAqXG4gKiBUaGUgaW5zdGFuY2Ugb2YgdGhlIHdyaXRlciBpcyBvbmx5IGF2YWlsYWJsZSBpbiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlIGBjaGFuZ2UoKWB9IG9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNlbnF1ZXVlQ2hhbmdlIGBlbnF1ZXVlQ2hhbmdlKClgfS5cbiAqXG4gKiBgYGB0c1xuICogbW9kZWwuY2hhbmdlKCB3cml0ZXIgPT4ge1xuICogXHR3cml0ZXIuaW5zZXJ0VGV4dCggJ2ZvbycsIHBhcmFncmFwaCwgJ2VuZCcgKTtcbiAqIH0gKTtcbiAqIGBgYFxuICpcbiAqIE5vdGUgdGhhdCB0aGUgd3JpdGVyIHNob3VsZCBuZXZlciBiZSBzdG9yZWQgYW5kIHVzZWQgb3V0c2lkZSBvZiB0aGUgYGNoYW5nZSgpYCBhbmRcbiAqIGBlbnF1ZXVlQ2hhbmdlKClgIGJsb2Nrcy5cbiAqXG4gKiBOb3RlIHRoYXQgd3JpdGVyJ3MgbWV0aG9kcyBkbyBub3QgY2hlY2sgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWF9LiBJdCBpcyBwb3NzaWJsZVxuICogdG8gY3JlYXRlIGluY29ycmVjdCBtb2RlbCBzdHJ1Y3R1cmVzIGJ5IHVzaW5nIHRoZSB3cml0ZXIuIFJlYWQgbW9yZSBhYm91dCBpblxuICoge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSN3aG8tY2hlY2tzLXRoZS1zY2hlbWEgXCJXaG8gY2hlY2tzIHRoZSBzY2hlbWE/XCJ9LlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2VcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNlbnF1ZXVlQ2hhbmdlXG4gKi8gY2xhc3MgV3JpdGVyIHtcbiAgICAvKipcblx0ICogSW5zdGFuY2Ugb2YgdGhlIG1vZGVsIG9uIHdoaWNoIHRoaXMgd3JpdGVyIG9wZXJhdGVzLlxuXHQgKi8gbW9kZWw7XG4gICAgLyoqXG5cdCAqIFRoZSBiYXRjaCB0byB3aGljaCB0aGlzIHdyaXRlciB3aWxsIGFkZCBjaGFuZ2VzLlxuXHQgKi8gYmF0Y2g7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB3cml0ZXIgaW5zdGFuY2UuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gdXNlIGl0IGRpcmVjdGx5LiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlIGBNb2RlbCNjaGFuZ2UoKWB9IG9yXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2VucXVldWVDaGFuZ2UgYE1vZGVsI2VucXVldWVDaGFuZ2UoKWB9IGluc3RlYWQuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gY29uc3RydWN0b3IobW9kZWwsIGJhdGNoKXtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLmJhdGNoID0gYmF0Y2g7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCB0ZXh0IG5vZGV9LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIuY3JlYXRlVGV4dCggJ2ZvbycgKTtcblx0ICogd3JpdGVyLmNyZWF0ZVRleHQoICdmb28nLCB7IGJvbGQ6IHRydWUgfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGRhdGEgVGV4dCBkYXRhLlxuXHQgKiBAcGFyYW0gYXR0cmlidXRlcyBUZXh0IGF0dHJpYnV0ZXMuXG5cdCAqIEByZXR1cm5zIHttb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dH0gQ3JlYXRlZCB0ZXh0IG5vZGUuXG5cdCAqLyBjcmVhdGVUZXh0KGRhdGEsIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUZXh0KGRhdGEsIGF0dHJpYnV0ZXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0uXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5jcmVhdGVFbGVtZW50KCAncGFyYWdyYXBoJyApO1xuXHQgKiB3cml0ZXIuY3JlYXRlRWxlbWVudCggJ3BhcmFncmFwaCcsIHsgYWxpZ25tZW50OiAnY2VudGVyJyB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBlbGVtZW50LlxuXHQgKiBAcGFyYW0gYXR0cmlidXRlcyBFbGVtZW50cyBhdHRyaWJ1dGVzLlxuXHQgKiBAcmV0dXJucyBDcmVhdGVkIGVsZW1lbnQuXG5cdCAqLyBjcmVhdGVFbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgZG9jdW1lbnQgZnJhZ21lbnR9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBDcmVhdGVkIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKi8gY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgY29weSBvZiB0aGUgZWxlbWVudCBhbmQgcmV0dXJucyBpdC4gQ3JlYXRlZCBlbGVtZW50IGhhcyB0aGUgc2FtZSBuYW1lIGFuZCBhdHRyaWJ1dGVzIGFzIHRoZSBvcmlnaW5hbCBlbGVtZW50LlxuXHQgKiBJZiBjbG9uZSBpcyBkZWVwLCB0aGUgb3JpZ2luYWwgZWxlbWVudCdzIGNoaWxkcmVuIGFyZSBhbHNvIGNsb25lZC4gSWYgbm90LCB0aGVuIGVtcHR5IGVsZW1lbnQgaXMgcmV0dXJuZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbGVtZW50IFRoZSBlbGVtZW50IHRvIGNsb25lLlxuXHQgKiBAcGFyYW0gZGVlcCBJZiBzZXQgdG8gYHRydWVgIGNsb25lcyBlbGVtZW50IGFuZCBhbGwgaXRzIGNoaWxkcmVuIHJlY3Vyc2l2ZWx5LiBXaGVuIHNldCB0byBgZmFsc2VgLFxuXHQgKiBlbGVtZW50IHdpbGwgYmUgY2xvbmVkIHdpdGhvdXQgYW55IGNoaWxkLlxuXHQgKi8gY2xvbmVFbGVtZW50KGVsZW1lbnQsIGRlZXAgPSB0cnVlKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50Ll9jbG9uZShkZWVwKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgaXRlbSBvbiBnaXZlbiBwb3NpdGlvbi5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgcGFyYWdyYXBoID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYXJhZ3JhcGgnICk7XG5cdCAqIHdyaXRlci5pbnNlcnQoIHBhcmFncmFwaCwgcG9zaXRpb24gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEluc3RlYWQgb2YgdXNpbmcgcG9zaXRpb24geW91IGNhbiB1c2UgcGFyZW50IGFuZCBvZmZzZXQ6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGNvbnN0IHRleHQgPSB3cml0ZXIuY3JlYXRlVGV4dCggJ2ZvbycgKTtcblx0ICogd3JpdGVyLmluc2VydCggdGV4dCwgcGFyYWdyYXBoLCA1ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBZb3UgY2FuIGFsc28gdXNlIGBlbmRgIGluc3RlYWQgb2YgdGhlIG9mZnNldCB0byBpbnNlcnQgYXQgdGhlIGVuZDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vJyApO1xuXHQgKiB3cml0ZXIuaW5zZXJ0KCB0ZXh0LCBwYXJhZ3JhcGgsICdlbmQnICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBPciBpbnNlcnQgYmVmb3JlIG9yIGFmdGVyIGFub3RoZXIgZWxlbWVudDpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgcGFyYWdyYXBoID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYXJhZ3JhcGgnICk7XG5cdCAqIHdyaXRlci5pbnNlcnQoIHBhcmFncmFwaCwgYW5vdGhlclBhcmFncmFwaCwgJ2FmdGVyJyApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogVGhlc2UgcGFyYW1ldGVycyB3b3JrcyB0aGUgc2FtZSB3YXkgYXMge0BsaW5rICNjcmVhdGVQb3NpdGlvbkF0IGB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCgpYH0uXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBpZiB0aGUgaXRlbSBhbHJlYWR5IGhhcyBwYXJlbnQgaXQgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIHByZXZpb3VzIHBhcmVudC5cblx0ICpcblx0ICogTm90ZSB0aGF0IHlvdSBjYW5ub3QgcmUtaW5zZXJ0IGEgbm9kZSBmcm9tIGEgZG9jdW1lbnQgdG8gYSBkaWZmZXJlbnQgZG9jdW1lbnQgb3IgYSBkb2N1bWVudCBmcmFnbWVudC4gSW4gdGhpcyBjYXNlLFxuXHQgKiBgbW9kZWwtd3JpdGVyLWluc2VydC1mb3JiaWRkZW4tbW92ZWAgaXMgdGhyb3duLlxuXHQgKlxuXHQgKiBJZiB5b3Ugd2FudCB0byBtb3ZlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfSBpbnN0ZWFkIG9mIGFuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBpdGVtfSB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNtb3ZlIGBXcml0ZXIjbW92ZSgpYH0uXG5cdCAqXG5cdCAqICoqTm90ZToqKiBGb3IgYSBwYXN0ZS1saWtlIGNvbnRlbnQgaW5zZXJ0aW9uIG1lY2hhbmlzbSBzZWVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudCBgbW9kZWwuaW5zZXJ0Q29udGVudCgpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIEl0ZW0gb3IgZG9jdW1lbnQgZnJhZ21lbnQgdG8gaW5zZXJ0LlxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBvciBvbmUgb2YgdGhlIGZsYWdzLiBVc2VkIG9ubHkgd2hlbiBzZWNvbmQgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gaW5zZXJ0KGl0ZW0sIGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQgPSAwKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBUZXh0ICYmIGl0ZW0uZGF0YSA9PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gUG9zaXRpb24uX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgICAgICAvLyBJZiBpdGVtIGhhcyBhIHBhcmVudCBhbHJlYWR5LlxuICAgICAgICBpZiAoaXRlbS5wYXJlbnQpIHtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY2hlY2sgaWYgaXRlbSBpcyBnb2luZyB0byBiZSBpbnNlcnRlZCB3aXRoaW4gdGhlIHNhbWUgZG9jdW1lbnQuXG4gICAgICAgICAgICBpZiAoaXNTYW1lVHJlZShpdGVtLnJvb3QsIHBvc2l0aW9uLnJvb3QpKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgaXQncyB3ZSBqdXN0IG5lZWQgdG8gbW92ZSBpdC5cbiAgICAgICAgICAgICAgICB0aGlzLm1vdmUoUmFuZ2UuX2NyZWF0ZU9uKGl0ZW0pLCBwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5yb290LmRvY3VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHRcdCAqIENhbm5vdCBtb3ZlIGEgbm9kZSBmcm9tIGEgZG9jdW1lbnQgdG8gYSBkaWZmZXJlbnQgdHJlZS5cblx0XHRcdFx0XHQgKiBJdCBpcyBmb3JiaWRkZW4gdG8gbW92ZSBhIG5vZGUgdGhhdCB3YXMgYWxyZWFkeSBpbiBhIGRvY3VtZW50IG91dHNpZGUgb2YgaXQuXG5cdFx0XHRcdFx0ICpcblx0XHRcdFx0XHQgKiBAZXJyb3IgbW9kZWwtd3JpdGVyLWluc2VydC1mb3JiaWRkZW4tbW92ZVxuXHRcdFx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignbW9kZWwtd3JpdGVyLWluc2VydC1mb3JiaWRkZW4tbW92ZScsIHRoaXMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgYmV0d2VlbiB0d28gZGlmZmVyZW50IGRvY3VtZW50IGZyYWdtZW50cyBvciBmcm9tIGRvY3VtZW50IGZyYWdtZW50IHRvIGEgZG9jdW1lbnQgaXMgcG9zc2libGUuXG4gICAgICAgICAgICAgICAgICAgIC8vIEluIHRoYXQgY2FzZSwgcmVtb3ZlIHRoZSBpdGVtIGZyb20gaXQncyBvcmlnaW5hbCBwYXJlbnQuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2ZXJzaW9uID0gcG9zaXRpb24ucm9vdC5kb2N1bWVudCA/IHBvc2l0aW9uLnJvb3QuZG9jdW1lbnQudmVyc2lvbiA6IG51bGw7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gaXRlbSBpbnN0YW5jZW9mIERvY3VtZW50RnJhZ21lbnQgPyBpdGVtLl9yZW1vdmVDaGlsZHJlbigwLCBpdGVtLmNoaWxkQ291bnQpIDogaXRlbTtcbiAgICAgICAgY29uc3QgaW5zZXJ0ID0gbmV3IEluc2VydE9wZXJhdGlvbihwb3NpdGlvbiwgY2hpbGRyZW4sIHZlcnNpb24pO1xuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFRleHQpIHtcbiAgICAgICAgICAgIGluc2VydC5zaG91bGRSZWNlaXZlQXR0cmlidXRlcyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYXRjaC5hZGRPcGVyYXRpb24oaW5zZXJ0KTtcbiAgICAgICAgdGhpcy5tb2RlbC5hcHBseU9wZXJhdGlvbihpbnNlcnQpO1xuICAgICAgICAvLyBXaGVuIGVsZW1lbnQgaXMgYSBEb2N1bWVudEZyYWdtZW50IHdlIG5lZWQgdG8gbW92ZSBpdHMgbWFya2VycyB0byBEb2N1bWVudCNtYXJrZXJzLlxuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIERvY3VtZW50RnJhZ21lbnQpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW21hcmtlck5hbWUsIG1hcmtlclJhbmdlXSBvZiBpdGVtLm1hcmtlcnMpe1xuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWlncmF0ZSBtYXJrZXIgcmFuZ2UgZnJvbSBEb2N1bWVudEZyYWdtZW50IHRvIERvY3VtZW50LlxuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlUm9vdFBvc2l0aW9uID0gUG9zaXRpb24uX2NyZWF0ZUF0KG1hcmtlclJhbmdlLnJvb3QsIDApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gbmV3IFJhbmdlKG1hcmtlclJhbmdlLnN0YXJ0Ll9nZXRDb21iaW5lZChyYW5nZVJvb3RQb3NpdGlvbiwgcG9zaXRpb24pLCBtYXJrZXJSYW5nZS5lbmQuX2dldENvbWJpbmVkKHJhbmdlUm9vdFBvc2l0aW9uLCBwb3NpdGlvbikpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlLFxuICAgICAgICAgICAgICAgICAgICB1c2luZ09wZXJhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYWZmZWN0c0RhdGE6IHRydWVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLm1hcmtlcnMuaGFzKG1hcmtlck5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTWFya2VyKG1hcmtlck5hbWUsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkTWFya2VyKG1hcmtlck5hbWUsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpbnNlcnRUZXh0KHRleHQsIGF0dHJpYnV0ZXMsIGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQvLyBUb28gY29tcGxpY2F0ZWQgd2hlbiBub3QgdXNpbmcgYGFueWAuXG4gICAgKSB7XG4gICAgICAgIGlmIChhdHRyaWJ1dGVzIGluc3RhbmNlb2YgRG9jdW1lbnRGcmFnbWVudCB8fCBhdHRyaWJ1dGVzIGluc3RhbmNlb2YgRWxlbWVudCB8fCBhdHRyaWJ1dGVzIGluc3RhbmNlb2YgUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHRoaXMuY3JlYXRlVGV4dCh0ZXh0KSwgYXR0cmlidXRlcywgaXRlbU9yUG9zaXRpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQodGhpcy5jcmVhdGVUZXh0KHRleHQsIGF0dHJpYnV0ZXMpLCBpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbnNlcnRFbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIGl0ZW1PclBvc2l0aW9uT3JPZmZzZXQsIG9mZnNldC8vIFRvbyBjb21wbGljYXRlZCB3aGVuIG5vdCB1c2luZyBgYW55YC5cbiAgICApIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50IHx8IGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBFbGVtZW50IHx8IGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBQb3NpdGlvbikge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnQodGhpcy5jcmVhdGVFbGVtZW50KG5hbWUpLCBhdHRyaWJ1dGVzLCBpdGVtT3JQb3NpdGlvbk9yT2Zmc2V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHRoaXMuY3JlYXRlRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzKSwgaXRlbU9yUG9zaXRpb25Pck9mZnNldCwgb2Zmc2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyBpdGVtIGF0IHRoZSBlbmQgb2YgdGhlIGdpdmVuIHBhcmVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgcGFyYWdyYXBoID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYXJhZ3JhcGgnICk7XG5cdCAqIHdyaXRlci5hcHBlbmQoIHBhcmFncmFwaCwgcm9vdCApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogTm90ZSB0aGF0IGlmIHRoZSBpdGVtIGFscmVhZHkgaGFzIHBhcmVudCBpdCB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgcHJldmlvdXMgcGFyZW50LlxuXHQgKlxuXHQgKiBJZiB5b3Ugd2FudCB0byBtb3ZlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfSBpbnN0ZWFkIG9mIGFuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBpdGVtfSB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNtb3ZlIGBXcml0ZXIjbW92ZSgpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIEl0ZW0gb3IgZG9jdW1lbnQgZnJhZ21lbnQgdG8gaW5zZXJ0LlxuXHQgKi8gYXBwZW5kKGl0ZW0sIHBhcmVudCkge1xuICAgICAgICB0aGlzLmluc2VydChpdGVtLCBwYXJlbnQsICdlbmQnKTtcbiAgICB9XG4gICAgYXBwZW5kVGV4dCh0ZXh0LCBhdHRyaWJ1dGVzLCBwYXJlbnQpIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50IHx8IGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydCh0aGlzLmNyZWF0ZVRleHQodGV4dCksIGF0dHJpYnV0ZXMsICdlbmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHRoaXMuY3JlYXRlVGV4dCh0ZXh0LCBhdHRyaWJ1dGVzKSwgcGFyZW50LCAnZW5kJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXBwZW5kRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzLCBwYXJlbnQpIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50IHx8IGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmluc2VydCh0aGlzLmNyZWF0ZUVsZW1lbnQobmFtZSksIGF0dHJpYnV0ZXMsICdlbmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0KHRoaXMuY3JlYXRlRWxlbWVudChuYW1lLCBhdHRyaWJ1dGVzKSwgcGFyZW50LCAnZW5kJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNldHMgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZSB3aXRoIGdpdmVuIGtleSBvbiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfVxuXHQgKiBvciBvbiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfS5cblx0ICpcblx0ICogQHBhcmFtIGtleSBBdHRyaWJ1dGUga2V5LlxuXHQgKiBAcGFyYW0gdmFsdWUgQXR0cmlidXRlIG5ldyB2YWx1ZS5cblx0ICogQHBhcmFtIGl0ZW1PclJhbmdlIE1vZGVsIGl0ZW0gb3IgcmFuZ2Ugb24gd2hpY2ggdGhlIGF0dHJpYnV0ZSB3aWxsIGJlIHNldC5cblx0ICovIHNldEF0dHJpYnV0ZShrZXksIHZhbHVlLCBpdGVtT3JSYW5nZSkge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGlmIChpdGVtT3JSYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSB7XG4gICAgICAgICAgICBjb25zdCByYW5nZXMgPSBpdGVtT3JSYW5nZS5nZXRNaW5pbWFsRmxhdFJhbmdlcygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiByYW5nZXMpe1xuICAgICAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uUmFuZ2UodGhpcywga2V5LCB2YWx1ZSwgcmFuZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0QXR0cmlidXRlT25JdGVtKHRoaXMsIGtleSwgdmFsdWUsIGl0ZW1PclJhbmdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyB2YWx1ZXMgb2YgYXR0cmlidXRlcyBvbiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfVxuXHQgKiBvciBvbiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLnNldEF0dHJpYnV0ZXMoIHtcblx0ICogXHRib2xkOiB0cnVlLFxuXHQgKiBcdGl0YWxpYzogdHJ1ZVxuXHQgKiB9LCByYW5nZSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGF0dHJpYnV0ZXMgQXR0cmlidXRlcyBrZXlzIGFuZCB2YWx1ZXMuXG5cdCAqIEBwYXJhbSBpdGVtT3JSYW5nZSBNb2RlbCBpdGVtIG9yIHJhbmdlIG9uIHdoaWNoIHRoZSBhdHRyaWJ1dGVzIHdpbGwgYmUgc2V0LlxuXHQgKi8gc2V0QXR0cmlidXRlcyhhdHRyaWJ1dGVzLCBpdGVtT3JSYW5nZSkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgdG9NYXAoYXR0cmlidXRlcykpe1xuICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoa2V5LCB2YWwsIGl0ZW1PclJhbmdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhbiBhdHRyaWJ1dGUgd2l0aCBnaXZlbiBrZXkgZnJvbSBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfVxuXHQgKiBvciBmcm9tIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvcmFuZ2V+UmFuZ2UgcmFuZ2V9LlxuXHQgKlxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBrZXkuXG5cdCAqIEBwYXJhbSBpdGVtT3JSYW5nZSBNb2RlbCBpdGVtIG9yIHJhbmdlIGZyb20gd2hpY2ggdGhlIGF0dHJpYnV0ZSB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqLyByZW1vdmVBdHRyaWJ1dGUoa2V5LCBpdGVtT3JSYW5nZSkge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGlmIChpdGVtT3JSYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSB7XG4gICAgICAgICAgICBjb25zdCByYW5nZXMgPSBpdGVtT3JSYW5nZS5nZXRNaW5pbWFsRmxhdFJhbmdlcygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiByYW5nZXMpe1xuICAgICAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uUmFuZ2UodGhpcywga2V5LCBudWxsLCByYW5nZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRBdHRyaWJ1dGVPbkl0ZW0odGhpcywga2V5LCBudWxsLCBpdGVtT3JSYW5nZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYWxsIGF0dHJpYnV0ZXMgZnJvbSBhbGwgZWxlbWVudHMgaW4gdGhlIHJhbmdlIG9yIGZyb20gdGhlIGdpdmVuIGl0ZW0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtT3JSYW5nZSBNb2RlbCBpdGVtIG9yIHJhbmdlIGZyb20gd2hpY2ggYWxsIGF0dHJpYnV0ZXMgd2lsbCBiZSByZW1vdmVkLlxuXHQgKi8gY2xlYXJBdHRyaWJ1dGVzKGl0ZW1PclJhbmdlKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgY29uc3QgcmVtb3ZlQXR0cmlidXRlc0Zyb21JdGVtID0gKGl0ZW0pPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiBpdGVtLmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlLCBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCEoaXRlbU9yUmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkpIHtcbiAgICAgICAgICAgIHJlbW92ZUF0dHJpYnV0ZXNGcm9tSXRlbShpdGVtT3JSYW5nZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbU9yUmFuZ2UuZ2V0SXRlbXMoKSl7XG4gICAgICAgICAgICAgICAgcmVtb3ZlQXR0cmlidXRlc0Zyb21JdGVtKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyBhbGwgaXRlbXMgaW4gdGhlIHNvdXJjZSByYW5nZSB0byB0aGUgdGFyZ2V0IHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIubW92ZSggc291cmNlUmFuZ2UsIHRhcmdldFBvc2l0aW9uICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBJbnN0ZWFkIG9mIHRoZSB0YXJnZXQgcG9zaXRpb24geW91IGNhbiB1c2UgcGFyZW50IGFuZCBvZmZzZXQgb3IgZGVmaW5lIHRoYXQgcmFuZ2Ugc2hvdWxkIGJlIG1vdmVkIHRvIHRoZSBlbmRcblx0ICogb3IgYmVmb3JlIG9yIGFmdGVyIGNob3NlbiBpdGVtOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiAvLyBNb3ZlcyBhbGwgaXRlbXMgaW4gdGhlIHJhbmdlIHRvIHRoZSBwYXJhZ3JhcGggYXQgb2Zmc2V0IDU6XG5cdCAqIHdyaXRlci5tb3ZlKCBzb3VyY2VSYW5nZSwgcGFyYWdyYXBoLCA1ICk7XG5cdCAqIC8vIE1vdmVzIGFsbCBpdGVtcyBpbiB0aGUgcmFuZ2UgdG8gdGhlIGVuZCBvZiBhIGJsb2NrcXVvdGU6XG5cdCAqIHdyaXRlci5tb3ZlKCBzb3VyY2VSYW5nZSwgYmxvY2txdW90ZSwgJ2VuZCcgKTtcblx0ICogLy8gTW92ZXMgYWxsIGl0ZW1zIGluIHRoZSByYW5nZSB0byBhIHBvc2l0aW9uIGFmdGVyIGFuIGltYWdlOlxuXHQgKiB3cml0ZXIubW92ZSggc291cmNlUmFuZ2UsIGltYWdlLCAnYWZ0ZXInICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBUaGVzZSBwYXJhbWV0ZXJzIHdvcmsgdGhlIHNhbWUgd2F5IGFzIHtAbGluayAjY3JlYXRlUG9zaXRpb25BdCBgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoKWB9LlxuXHQgKlxuXHQgKiBOb3RlIHRoYXQgaXRlbXMgY2FuIGJlIG1vdmVkIG9ubHkgd2l0aGluIHRoZSBzYW1lIHRyZWUuIEl0IG1lYW5zIHRoYXQgeW91IGNhbiBtb3ZlIGl0ZW1zIHdpdGhpbiB0aGUgc2FtZSByb290XG5cdCAqIChlbGVtZW50IG9yIGRvY3VtZW50IGZyYWdtZW50KSBvciBiZXR3ZWVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3Jvb3RzIGRvY3VtZW50cyByb290c30sXG5cdCAqIGJ1dCB5b3UgY2FuIG5vdCBtb3ZlIGl0ZW1zIGZyb20gZG9jdW1lbnQgZnJhZ21lbnQgdG8gdGhlIGRvY3VtZW50IG9yIGZyb20gb25lIGRldGFjaGVkIGVsZW1lbnQgdG8gYW5vdGhlci4gVXNlXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIjaW5zZXJ0fSBpbiBzdWNoIGNhc2VzLlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2UgU291cmNlIHJhbmdlLlxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBvciBvbmUgb2YgdGhlIGZsYWdzLiBVc2VkIG9ubHkgd2hlbiBzZWNvbmQgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gbW92ZShyYW5nZSwgaXRlbU9yUG9zaXRpb24sIG9mZnNldCkge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGlmICghKHJhbmdlIGluc3RhbmNlb2YgUmFuZ2UpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEludmFsaWQgcmFuZ2UgdG8gbW92ZS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLW1vdmUtaW52YWxpZC1yYW5nZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItbW92ZS1pbnZhbGlkLXJhbmdlJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyYW5nZS5pc0ZsYXQpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogUmFuZ2UgdG8gbW92ZSBpcyBub3QgZmxhdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLW1vdmUtcmFuZ2Utbm90LWZsYXRcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd3JpdGVyLW1vdmUtcmFuZ2Utbm90LWZsYXQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICAgICAgLy8gRG8gbm90IG1vdmUgYW55dGhpbmcgaWYgdGhlIG1vdmUgdGFyZ2V0IGlzIHNhbWUgYXMgbW92ZWQgcmFuZ2Ugc3RhcnQuXG4gICAgICAgIGlmIChwb3NpdGlvbi5pc0VxdWFsKHJhbmdlLnN0YXJ0KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHBhcnQgb2YgdGhlIG1hcmtlciBpcyByZW1vdmVkLCBjcmVhdGUgYWRkaXRpb25hbCBtYXJrZXIgb3BlcmF0aW9uIGZvciB1bmRvIHB1cnBvc2VzLlxuICAgICAgICB0aGlzLl9hZGRPcGVyYXRpb25Gb3JBZmZlY3RlZE1hcmtlcnMoJ21vdmUnLCByYW5nZSk7XG4gICAgICAgIGlmICghaXNTYW1lVHJlZShyYW5nZS5yb290LCBwb3NpdGlvbi5yb290KSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBSYW5nZSBpcyBnb2luZyB0byBiZSBtb3ZlZCB3aXRoaW4gbm90IHRoZSBzYW1lIGRvY3VtZW50LiBQbGVhc2UgdXNlXG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2luc2VydCBpbnNlcnR9IGluc3RlYWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci1tb3ZlLWRpZmZlcmVudC1kb2N1bWVudFxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItbW92ZS1kaWZmZXJlbnQtZG9jdW1lbnQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2ZXJzaW9uID0gcmFuZ2Uucm9vdC5kb2N1bWVudCA/IHJhbmdlLnJvb3QuZG9jdW1lbnQudmVyc2lvbiA6IG51bGw7XG4gICAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IG5ldyBNb3ZlT3BlcmF0aW9uKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQub2Zmc2V0IC0gcmFuZ2Uuc3RhcnQub2Zmc2V0LCBwb3NpdGlvbiwgdmVyc2lvbik7XG4gICAgICAgIHRoaXMuYmF0Y2guYWRkT3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIHRoaXMubW9kZWwuYXBwbHlPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgZ2l2ZW4gbW9kZWwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIGl0ZW19IG9yIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW1PclJhbmdlIE1vZGVsIGl0ZW0gb3IgcmFuZ2UgdG8gcmVtb3ZlLlxuXHQgKi8gcmVtb3ZlKGl0ZW1PclJhbmdlKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgY29uc3QgcmFuZ2VUb1JlbW92ZSA9IGl0ZW1PclJhbmdlIGluc3RhbmNlb2YgUmFuZ2UgPyBpdGVtT3JSYW5nZSA6IFJhbmdlLl9jcmVhdGVPbihpdGVtT3JSYW5nZSk7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IHJhbmdlVG9SZW1vdmUuZ2V0TWluaW1hbEZsYXRSYW5nZXMoKS5yZXZlcnNlKCk7XG4gICAgICAgIGZvciAoY29uc3QgZmxhdCBvZiByYW5nZXMpe1xuICAgICAgICAgICAgLy8gSWYgcGFydCBvZiB0aGUgbWFya2VyIGlzIHJlbW92ZWQsIGNyZWF0ZSBhZGRpdGlvbmFsIG1hcmtlciBvcGVyYXRpb24gZm9yIHVuZG8gcHVycG9zZXMuXG4gICAgICAgICAgICB0aGlzLl9hZGRPcGVyYXRpb25Gb3JBZmZlY3RlZE1hcmtlcnMoJ21vdmUnLCBmbGF0KTtcbiAgICAgICAgICAgIGFwcGx5UmVtb3ZlT3BlcmF0aW9uKGZsYXQuc3RhcnQsIGZsYXQuZW5kLm9mZnNldCAtIGZsYXQuc3RhcnQub2Zmc2V0LCB0aGlzLmJhdGNoLCB0aGlzLm1vZGVsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogTWVyZ2VzIHR3byBzaWJsaW5ncyBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24uXG5cdCAqXG5cdCAqIE5vZGUgYmVmb3JlIGFuZCBhZnRlciB0aGUgcG9zaXRpb24gaGF2ZSB0byBiZSBhbiBlbGVtZW50LiBPdGhlcndpc2UgYHdyaXRlci1tZXJnZS1uby1lbGVtZW50LWJlZm9yZWAgb3Jcblx0ICogYHdyaXRlci1tZXJnZS1uby1lbGVtZW50LWFmdGVyYCBlcnJvciB3aWxsIGJlIHRocm93bi5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFBvc2l0aW9uIGJldHdlZW4gbWVyZ2VkIGVsZW1lbnRzLlxuXHQgKi8gbWVyZ2UocG9zaXRpb24pIHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0V3JpdGVyVXNlZENvcnJlY3RseSgpO1xuICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gcG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgY29uc3Qgbm9kZUFmdGVyID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICAvLyBJZiBwYXJ0IG9mIHRoZSBtYXJrZXIgaXMgcmVtb3ZlZCwgY3JlYXRlIGFkZGl0aW9uYWwgbWFya2VyIG9wZXJhdGlvbiBmb3IgdW5kbyBwdXJwb3Nlcy5cbiAgICAgICAgdGhpcy5fYWRkT3BlcmF0aW9uRm9yQWZmZWN0ZWRNYXJrZXJzKCdtZXJnZScsIHBvc2l0aW9uKTtcbiAgICAgICAgaWYgKCEobm9kZUJlZm9yZSBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIE5vZGUgYmVmb3JlIG1lcmdlIHBvc2l0aW9uIG11c3QgYmUgYW4gZWxlbWVudC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLW1lcmdlLW5vLWVsZW1lbnQtYmVmb3JlXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci1tZXJnZS1uby1lbGVtZW50LWJlZm9yZScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghKG5vZGVBZnRlciBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIE5vZGUgYWZ0ZXIgbWVyZ2UgcG9zaXRpb24gbXVzdCBiZSBhbiBlbGVtZW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB3cml0ZXItbWVyZ2Utbm8tZWxlbWVudC1hZnRlclxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItbWVyZ2Utbm8tZWxlbWVudC1hZnRlcicsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcG9zaXRpb24ucm9vdC5kb2N1bWVudCkge1xuICAgICAgICAgICAgdGhpcy5fbWVyZ2VEZXRhY2hlZChwb3NpdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9tZXJnZShwb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0Y3V0IGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVQb3NpdGlvbkZyb21QYXRoIGBNb2RlbCNjcmVhdGVQb3NpdGlvbkZyb21QYXRoKClgfS5cblx0ICpcblx0ICogQHBhcmFtIHJvb3QgUm9vdCBvZiB0aGUgcG9zaXRpb24uXG5cdCAqIEBwYXJhbSBwYXRoIFBvc2l0aW9uIHBhdGguIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXRofS5cblx0ICogQHBhcmFtIHN0aWNraW5lc3MgUG9zaXRpb24gc3RpY2tpbmVzcy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uU3RpY2tpbmVzc30uXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkZyb21QYXRoKHJvb3QsIHBhdGgsIHN0aWNraW5lc3MpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwuY3JlYXRlUG9zaXRpb25Gcm9tUGF0aChyb290LCBwYXRoLCBzdGlja2luZXNzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0Y3V0IGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVQb3NpdGlvbkF0IGBNb2RlbCNjcmVhdGVQb3NpdGlvbkF0KClgfS5cblx0ICpcblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gY3JlYXRlUG9zaXRpb25BdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTaG9ydGN1dCBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY3JlYXRlUG9zaXRpb25BZnRlciBgTW9kZWwjY3JlYXRlUG9zaXRpb25BZnRlcigpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBpdGVtIEl0ZW0gYWZ0ZXIgd2hpY2ggdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBwbGFjZWQuXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkFmdGVyKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwuY3JlYXRlUG9zaXRpb25BZnRlcihpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0Y3V0IGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVQb3NpdGlvbkJlZm9yZSBgTW9kZWwjY3JlYXRlUG9zaXRpb25CZWZvcmUoKWB9LlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbSBJdGVtIGFmdGVyIHdoaWNoIHRoZSBwb3NpdGlvbiBzaG91bGQgYmUgcGxhY2VkLlxuXHQgKi8gY3JlYXRlUG9zaXRpb25CZWZvcmUoaXRlbSkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0Y3V0IGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVSYW5nZSBgTW9kZWwjY3JlYXRlUmFuZ2UoKWB9LlxuXHQgKlxuXHQgKiBAcGFyYW0gc3RhcnQgU3RhcnQgcG9zaXRpb24uXG5cdCAqIEBwYXJhbSBlbmQgRW5kIHBvc2l0aW9uLiBJZiBub3Qgc2V0LCByYW5nZSB3aWxsIGJlIGNvbGxhcHNlZCBhdCBgc3RhcnRgIHBvc2l0aW9uLlxuXHQgKi8gY3JlYXRlUmFuZ2Uoc3RhcnQsIGVuZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5jcmVhdGVSYW5nZShzdGFydCwgZW5kKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3J0Y3V0IGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVSYW5nZUluIGBNb2RlbCNjcmVhdGVSYW5nZUluKClgfS5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBpcyBhIHBhcmVudCBmb3IgdGhlIHJhbmdlLlxuXHQgKi8gY3JlYXRlUmFuZ2VJbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLmNyZWF0ZVJhbmdlSW4oZWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTaG9ydGN1dCBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY3JlYXRlUmFuZ2VPbiBgTW9kZWwjY3JlYXRlUmFuZ2VPbigpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgd2hpY2ggaXMgYSBwYXJlbnQgZm9yIHRoZSByYW5nZS5cblx0ICovIGNyZWF0ZVJhbmdlT24oZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5jcmVhdGVSYW5nZU9uKGVsZW1lbnQpO1xuICAgIH1cbiAgICBjcmVhdGVTZWxlY3Rpb24oLi4uYXJncykge1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5jcmVhdGVTZWxlY3Rpb24oLi4uYXJncyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQZXJmb3JtcyBtZXJnZSBhY3Rpb24gaW4gYSBkZXRhY2hlZCB0cmVlLlxuXHQgKlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gYmV0d2VlbiBtZXJnZWQgZWxlbWVudHMuXG5cdCAqLyBfbWVyZ2VEZXRhY2hlZChwb3NpdGlvbikge1xuICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gcG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgY29uc3Qgbm9kZUFmdGVyID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICB0aGlzLm1vdmUoUmFuZ2UuX2NyZWF0ZUluKG5vZGVBZnRlciksIFBvc2l0aW9uLl9jcmVhdGVBdChub2RlQmVmb3JlLCAnZW5kJykpO1xuICAgICAgICB0aGlzLnJlbW92ZShub2RlQWZ0ZXIpO1xuICAgIH1cbiAgICAvKipcblx0ICogUGVyZm9ybXMgbWVyZ2UgYWN0aW9uIGluIGEgbm9uLWRldGFjaGVkIHRyZWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiBiZXR3ZWVuIG1lcmdlZCBlbGVtZW50cy5cblx0ICovIF9tZXJnZShwb3NpdGlvbikge1xuICAgICAgICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IFBvc2l0aW9uLl9jcmVhdGVBdChwb3NpdGlvbi5ub2RlQmVmb3JlLCAnZW5kJyk7XG4gICAgICAgIGNvbnN0IHNvdXJjZVBvc2l0aW9uID0gUG9zaXRpb24uX2NyZWF0ZUF0KHBvc2l0aW9uLm5vZGVBZnRlciwgMCk7XG4gICAgICAgIGNvbnN0IGdyYXZleWFyZCA9IHBvc2l0aW9uLnJvb3QuZG9jdW1lbnQuZ3JhdmV5YXJkO1xuICAgICAgICBjb25zdCBncmF2ZXlhcmRQb3NpdGlvbiA9IG5ldyBQb3NpdGlvbihncmF2ZXlhcmQsIFtcbiAgICAgICAgICAgIDBcbiAgICAgICAgXSk7XG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSBwb3NpdGlvbi5yb290LmRvY3VtZW50LnZlcnNpb247XG4gICAgICAgIGNvbnN0IG1lcmdlID0gbmV3IE1lcmdlT3BlcmF0aW9uKHNvdXJjZVBvc2l0aW9uLCBwb3NpdGlvbi5ub2RlQWZ0ZXIubWF4T2Zmc2V0LCB0YXJnZXRQb3NpdGlvbiwgZ3JhdmV5YXJkUG9zaXRpb24sIHZlcnNpb24pO1xuICAgICAgICB0aGlzLmJhdGNoLmFkZE9wZXJhdGlvbihtZXJnZSk7XG4gICAgICAgIHRoaXMubW9kZWwuYXBwbHlPcGVyYXRpb24obWVyZ2UpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVuYW1lcyB0aGUgZ2l2ZW4gZWxlbWVudC5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gcmVuYW1lLlxuXHQgKiBAcGFyYW0gbmV3TmFtZSBOZXcgZWxlbWVudCBuYW1lLlxuXHQgKi8gcmVuYW1lKGVsZW1lbnQsIG5ld05hbWUpIHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0V3JpdGVyVXNlZENvcnJlY3RseSgpO1xuICAgICAgICBpZiAoIShlbGVtZW50IGluc3RhbmNlb2YgRWxlbWVudCkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVHJ5aW5nIHRvIHJlbmFtZSBhbiBvYmplY3Qgd2hpY2ggaXMgbm90IGFuIGluc3RhbmNlIG9mIEVsZW1lbnQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci1yZW5hbWUtbm90LWVsZW1lbnQtaW5zdGFuY2Vcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd3JpdGVyLXJlbmFtZS1ub3QtZWxlbWVudC1pbnN0YW5jZScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSBlbGVtZW50LnJvb3QuZG9jdW1lbnQgPyBlbGVtZW50LnJvb3QuZG9jdW1lbnQudmVyc2lvbiA6IG51bGw7XG4gICAgICAgIGNvbnN0IHJlbmFtZU9wZXJhdGlvbiA9IG5ldyBSZW5hbWVPcGVyYXRpb24oUG9zaXRpb24uX2NyZWF0ZUJlZm9yZShlbGVtZW50KSwgZWxlbWVudC5uYW1lLCBuZXdOYW1lLCB2ZXJzaW9uKTtcbiAgICAgICAgdGhpcy5iYXRjaC5hZGRPcGVyYXRpb24ocmVuYW1lT3BlcmF0aW9uKTtcbiAgICAgICAgdGhpcy5tb2RlbC5hcHBseU9wZXJhdGlvbihyZW5hbWVPcGVyYXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogU3BsaXRzIGVsZW1lbnRzIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVuIHBvc2l0aW9uIGFuZCBnb2luZyB0byB0aGUgdG9wIG9mIHRoZSBtb2RlbCB0cmVlIGFzIGxvbmcgYXMgZ2l2ZW5cblx0ICogYGxpbWl0RWxlbWVudGAgaXMgcmVhY2hlZC4gV2hlbiBgbGltaXRFbGVtZW50YCBpcyBub3QgZGVmaW5lZCB0aGVuIG9ubHkgdGhlIHBhcmVudCBvZiB0aGUgZ2l2ZW4gcG9zaXRpb24gd2lsbCBiZSBzcGxpdC5cblx0ICpcblx0ICogVGhlIGVsZW1lbnQgbmVlZHMgdG8gaGF2ZSBhIHBhcmVudC4gSXQgY2Fubm90IGJlIGEgcm9vdCBlbGVtZW50IG5vciBhIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKiBUaGUgYHdyaXRlci1zcGxpdC1lbGVtZW50LW5vLXBhcmVudGAgZXJyb3Igd2lsbCBiZSB0aHJvd24gaWYgeW91IHRyeSB0byBzcGxpdCBhbiBlbGVtZW50IHdpdGggbm8gcGFyZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gb2Ygc3BsaXQuXG5cdCAqIEBwYXJhbSBsaW1pdEVsZW1lbnQgU3RvcCBzcGxpdHRpbmcgd2hlbiB0aGlzIGVsZW1lbnQgd2lsbCBiZSByZWFjaGVkLlxuXHQgKiBAcmV0dXJucyBTcGxpdCByZXN1bHQgd2l0aCBwcm9wZXJ0aWVzOlxuXHQgKiAqIGBwb3NpdGlvbmAgLSBQb3NpdGlvbiBiZXR3ZWVuIHNwbGl0IGVsZW1lbnRzLlxuXHQgKiAqIGByYW5nZWAgLSBSYW5nZSB0aGF0IHN0YXJzIGZyb20gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgc3BsaXQgZWxlbWVudCBhbmQgZW5kcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBmaXJzdCBjb3B5IGVsZW1lbnQuXG5cdCAqLyBzcGxpdChwb3NpdGlvbiwgbGltaXRFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgbGV0IHNwbGl0RWxlbWVudCA9IHBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgaWYgKCFzcGxpdEVsZW1lbnQucGFyZW50KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEVsZW1lbnQgd2l0aCBubyBwYXJlbnQgY2FuIG5vdCBiZSBzcGxpdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLXNwbGl0LWVsZW1lbnQtbm8tcGFyZW50XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci1zcGxpdC1lbGVtZW50LW5vLXBhcmVudCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdoZW4gbGltaXQgZWxlbWVudCBpcyBub3QgZGVmaW5lZCBsZXRzIHNldCBzcGxpdEVsZW1lbnQgcGFyZW50IGFzIGxpbWl0LlxuICAgICAgICBpZiAoIWxpbWl0RWxlbWVudCkge1xuICAgICAgICAgICAgbGltaXRFbGVtZW50ID0gc3BsaXRFbGVtZW50LnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXBvc2l0aW9uLnBhcmVudC5nZXRBbmNlc3RvcnMoe1xuICAgICAgICAgICAgaW5jbHVkZVNlbGY6IHRydWVcbiAgICAgICAgfSkuaW5jbHVkZXMobGltaXRFbGVtZW50KSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBMaW1pdCBlbGVtZW50IGlzIG5vdCBhIHBvc2l0aW9uIGFuY2VzdG9yLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB3cml0ZXItc3BsaXQtaW52YWxpZC1saW1pdC1lbGVtZW50XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci1zcGxpdC1pbnZhbGlkLWxpbWl0LWVsZW1lbnQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBuZWVkIHRvIGNhY2hlIGVsZW1lbnRzIHRoYXQgd2lsbCBiZSBjcmVhdGVkIGFzIGEgcmVzdWx0IG9mIHRoZSBmaXJzdCBzcGxpdCBiZWNhdXNlXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gY3JlYXRlIGEgcmFuZ2UgZnJvbSB0aGUgZW5kIG9mIHRoZSBmaXJzdCBzcGxpdCBlbGVtZW50IHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlXG4gICAgICAgIC8vIGZpcnN0IGNvcHkgZWxlbWVudC4gVGhpcyBzaG91bGQgYmUgaGFuZGxlZCBieSBMaXZlUmFuZ2UgYnV0IGl0IGRvZXNuJ3Qgd29yayBvbiBkZXRhY2hlZCBub2Rlcy5cbiAgICAgICAgbGV0IGZpcnN0U3BsaXRFbGVtZW50O1xuICAgICAgICBsZXQgZmlyc3RDb3B5RWxlbWVudDtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgY29uc3QgdmVyc2lvbiA9IHNwbGl0RWxlbWVudC5yb290LmRvY3VtZW50ID8gc3BsaXRFbGVtZW50LnJvb3QuZG9jdW1lbnQudmVyc2lvbiA6IG51bGw7XG4gICAgICAgICAgICBjb25zdCBob3dNYW55ID0gc3BsaXRFbGVtZW50Lm1heE9mZnNldCAtIHBvc2l0aW9uLm9mZnNldDtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydGlvblBvc2l0aW9uID0gU3BsaXRPcGVyYXRpb24uZ2V0SW5zZXJ0aW9uUG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICAgICAgY29uc3Qgc3BsaXQgPSBuZXcgU3BsaXRPcGVyYXRpb24ocG9zaXRpb24sIGhvd01hbnksIGluc2VydGlvblBvc2l0aW9uLCBudWxsLCB2ZXJzaW9uKTtcbiAgICAgICAgICAgIHRoaXMuYmF0Y2guYWRkT3BlcmF0aW9uKHNwbGl0KTtcbiAgICAgICAgICAgIHRoaXMubW9kZWwuYXBwbHlPcGVyYXRpb24oc3BsaXQpO1xuICAgICAgICAgICAgLy8gQ2FjaGUgcmVzdWx0IG9mIHRoZSBmaXJzdCBzcGxpdC5cbiAgICAgICAgICAgIGlmICghZmlyc3RTcGxpdEVsZW1lbnQgJiYgIWZpcnN0Q29weUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBmaXJzdFNwbGl0RWxlbWVudCA9IHNwbGl0RWxlbWVudDtcbiAgICAgICAgICAgICAgICBmaXJzdENvcHlFbGVtZW50ID0gcG9zaXRpb24ucGFyZW50Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zaXRpb24gPSB0aGlzLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIocG9zaXRpb24ucGFyZW50KTtcbiAgICAgICAgICAgIHNwbGl0RWxlbWVudCA9IHBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgfXdoaWxlIChzcGxpdEVsZW1lbnQgIT09IGxpbWl0RWxlbWVudClcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBvc2l0aW9uLFxuICAgICAgICAgICAgcmFuZ2U6IG5ldyBSYW5nZShQb3NpdGlvbi5fY3JlYXRlQXQoZmlyc3RTcGxpdEVsZW1lbnQsICdlbmQnKSwgUG9zaXRpb24uX2NyZWF0ZUF0KGZpcnN0Q29weUVsZW1lbnQsIDApKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcblx0ICogV3JhcHMgdGhlIGdpdmVuIHJhbmdlIHdpdGggdGhlIGdpdmVuIGVsZW1lbnQgb3Igd2l0aCBhIG5ldyBlbGVtZW50IChpZiBhIHN0cmluZyB3YXMgcGFzc2VkKS5cblx0ICpcblx0ICogKipOb3RlOioqIHJhbmdlIHRvIHdyYXAgc2hvdWxkIGJlIGEgXCJmbGF0IHJhbmdlXCIgKHNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9yYW5nZX5SYW5nZSNpc0ZsYXQgYFJhbmdlI2lzRmxhdGB9KS5cblx0ICogSWYgbm90LCBhbiBlcnJvciB3aWxsIGJlIHRocm93bi5cblx0ICpcblx0ICogQHBhcmFtIHJhbmdlIFJhbmdlIHRvIHdyYXAuXG5cdCAqIEBwYXJhbSBlbGVtZW50T3JTdHJpbmcgRWxlbWVudCBvciBuYW1lIG9mIGVsZW1lbnQgdG8gd3JhcCB0aGUgcmFuZ2Ugd2l0aC5cblx0ICovIHdyYXAocmFuZ2UsIGVsZW1lbnRPclN0cmluZykge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGlmICghcmFuZ2UuaXNGbGF0KSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFJhbmdlIHRvIHdyYXAgaXMgbm90IGZsYXQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci13cmFwLXJhbmdlLW5vdC1mbGF0XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci13cmFwLXJhbmdlLW5vdC1mbGF0JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRPclN0cmluZyBpbnN0YW5jZW9mIEVsZW1lbnQgPyBlbGVtZW50T3JTdHJpbmcgOiBuZXcgRWxlbWVudChlbGVtZW50T3JTdHJpbmcpO1xuICAgICAgICBpZiAoZWxlbWVudC5jaGlsZENvdW50ID4gMCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBFbGVtZW50IHRvIHdyYXAgd2l0aCBpcyBub3QgZW1wdHkuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci13cmFwLWVsZW1lbnQtbm90LWVtcHR5XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci13cmFwLWVsZW1lbnQtbm90LWVtcHR5JywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEVsZW1lbnQgdG8gd3JhcCB3aXRoIGlzIGFscmVhZHkgYXR0YWNoZWQgdG8gYSB0cmVlIG1vZGVsLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB3cml0ZXItd3JhcC1lbGVtZW50LWF0dGFjaGVkXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci13cmFwLWVsZW1lbnQtYXR0YWNoZWQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc2VydChlbGVtZW50LCByYW5nZS5zdGFydCk7XG4gICAgICAgIC8vIFNoaWZ0IHRoZSByYW5nZS10by13cmFwIGJlY2F1c2Ugd2UganVzdCBpbnNlcnRlZCBhbiBlbGVtZW50IGJlZm9yZSB0aGF0IHJhbmdlLlxuICAgICAgICBjb25zdCBzaGlmdGVkUmFuZ2UgPSBuZXcgUmFuZ2UocmFuZ2Uuc3RhcnQuZ2V0U2hpZnRlZEJ5KDEpLCByYW5nZS5lbmQuZ2V0U2hpZnRlZEJ5KDEpKTtcbiAgICAgICAgdGhpcy5tb3ZlKHNoaWZ0ZWRSYW5nZSwgUG9zaXRpb24uX2NyZWF0ZUF0KGVsZW1lbnQsIDApKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVud3JhcHMgY2hpbGRyZW4gb2YgdGhlIGdpdmVuIGVsZW1lbnQg4oCTIGFsbCBpdHMgY2hpbGRyZW4gYXJlIG1vdmVkIGJlZm9yZSBpdCBhbmQgdGhlbiB0aGUgZWxlbWVudCBpcyByZW1vdmVkLlxuXHQgKiBUaHJvd3MgZXJyb3IgaWYgeW91IHRyeSB0byB1bndyYXAgYW4gZWxlbWVudCB3aGljaCBkb2VzIG5vdCBoYXZlIGEgcGFyZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIHVud3JhcC5cblx0ICovIHVud3JhcChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgaWYgKGVsZW1lbnQucGFyZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRyeWluZyB0byB1bndyYXAgYW4gZWxlbWVudCB3aGljaCBoYXMgbm8gcGFyZW50LlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB3cml0ZXItdW53cmFwLWVsZW1lbnQtbm8tcGFyZW50XG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci11bndyYXAtZWxlbWVudC1uby1wYXJlbnQnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1vdmUoUmFuZ2UuX2NyZWF0ZUluKGVsZW1lbnQpLCB0aGlzLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIoZWxlbWVudCkpO1xuICAgICAgICB0aGlzLnJlbW92ZShlbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXJ9LiBNYXJrZXIgaXMgYSBuYW1lZCByYW5nZSwgd2hpY2ggdHJhY2tzXG5cdCAqIGNoYW5nZXMgaW4gdGhlIGRvY3VtZW50IGFuZCB1cGRhdGVzIGl0cyByYW5nZSBhdXRvbWF0aWNhbGx5LCB3aGVuIG1vZGVsIHRyZWUgY2hhbmdlcy5cblx0ICpcblx0ICogQXMgdGhlIGZpcnN0IHBhcmFtZXRlciB5b3UgY2FuIHNldCBtYXJrZXIgbmFtZS5cblx0ICpcblx0ICogVGhlIHJlcXVpcmVkIGBvcHRpb25zLnVzaW5nT3BlcmF0aW9uYCBwYXJhbWV0ZXIgbGV0cyB5b3UgZGVjaWRlIGlmIHRoZSBtYXJrZXIgc2hvdWxkIGJlIG1hbmFnZWQgYnkgb3BlcmF0aW9ucyBvciBub3QuIFNlZVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXIgY2xhc3MgZGVzY3JpcHRpb259IHRvIGxlYXJuIGFib3V0IHRoZSBkaWZmZXJlbmNlIGJldHdlZW5cblx0ICogbWFya2VycyBtYW5hZ2VkIGJ5IG9wZXJhdGlvbnMgYW5kIG5vdC1tYW5hZ2VkIGJ5IG9wZXJhdGlvbnMuXG5cdCAqXG5cdCAqIFRoZSBgb3B0aW9ucy5hZmZlY3RzRGF0YWAgcGFyYW1ldGVyLCB3aGljaCBkZWZhdWx0cyB0byBgZmFsc2VgLCBhbGxvd3MgeW91IHRvIGRlZmluZSBpZiBhIG1hcmtlciBhZmZlY3RzIHRoZSBkYXRhLiBJdCBzaG91bGQgYmVcblx0ICogYHRydWVgIHdoZW4gdGhlIG1hcmtlciBjaGFuZ2UgY2hhbmdlcyB0aGUgZGF0YSByZXR1cm5lZCBieSB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yI2dldERhdGEgYGVkaXRvci5nZXREYXRhKClgfSBtZXRob2QuXG5cdCAqIFdoZW4gc2V0IHRvIGB0cnVlYCBpdCBmaXJlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y2hhbmdlOmRhdGEgYGNoYW5nZTpkYXRhYH0gZXZlbnQuXG5cdCAqIFdoZW4gc2V0IHRvIGBmYWxzZWAgaXQgZmlyZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmNoYW5nZSBgY2hhbmdlYH0gZXZlbnQuXG5cdCAqXG5cdCAqIENyZWF0ZSBtYXJrZXIgZGlyZWN0bHkgYmFzZSBvbiBtYXJrZXIncyBuYW1lOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBhZGRNYXJrZXIoIG1hcmtlck5hbWUsIHsgcmFuZ2UsIHVzaW5nT3BlcmF0aW9uOiBmYWxzZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDcmVhdGUgbWFya2VyIHVzaW5nIG9wZXJhdGlvbjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogYWRkTWFya2VyKCBtYXJrZXJOYW1lLCB7IHJhbmdlLCB1c2luZ09wZXJhdGlvbjogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDcmVhdGUgbWFya2VyIHRoYXQgYWZmZWN0cyB0aGUgZWRpdG9yIGRhdGE6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIGFkZE1hcmtlciggbWFya2VyTmFtZSwgeyByYW5nZSwgdXNpbmdPcGVyYXRpb246IGZhbHNlLCBhZmZlY3RzRGF0YTogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBOb3RlOiBGb3IgZWZmaWNpZW5jeSByZWFzb25zLCBpdCdzIGJlc3QgdG8gY3JlYXRlIGFuZCBrZWVwIGFzIGxpdHRsZSBtYXJrZXJzIGFzIHBvc3NpYmxlLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXJcblx0ICogQHBhcmFtIG5hbWUgTmFtZSBvZiBhIG1hcmtlciB0byBjcmVhdGUgLSBtdXN0IGJlIHVuaXF1ZS5cblx0ICogQHBhcmFtIG9wdGlvbnMudXNpbmdPcGVyYXRpb24gRmxhZyBpbmRpY2F0aW5nIHRoYXQgdGhlIG1hcmtlciBzaG91bGQgYmUgYWRkZWQgYnkgTWFya2VyT3BlcmF0aW9uLlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIjbWFuYWdlZFVzaW5nT3BlcmF0aW9uc30uXG5cdCAqIEBwYXJhbSBvcHRpb25zLnJhbmdlIE1hcmtlciByYW5nZS5cblx0ICogQHBhcmFtIG9wdGlvbnMuYWZmZWN0c0RhdGEgRmxhZyBpbmRpY2F0aW5nIHRoYXQgdGhlIG1hcmtlciBjaGFuZ2VzIHRoZSBlZGl0b3IgZGF0YS5cblx0ICogQHJldHVybnMgTWFya2VyIHRoYXQgd2FzIHNldC5cblx0ICovIGFkZE1hcmtlcihuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgaWYgKCFvcHRpb25zIHx8IHR5cGVvZiBvcHRpb25zLnVzaW5nT3BlcmF0aW9uICE9ICdib29sZWFuJykge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgYG9wdGlvbnMudXNpbmdPcGVyYXRpb25gIHBhcmFtZXRlciBpcyByZXF1aXJlZCB3aGVuIGFkZGluZyBhIG5ldyBtYXJrZXIuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci1hZGRtYXJrZXItbm8tdXNpbmdvcGVyYXRpb25cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd3JpdGVyLWFkZG1hcmtlci1uby11c2luZ29wZXJhdGlvbicsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVzaW5nT3BlcmF0aW9uID0gb3B0aW9ucy51c2luZ09wZXJhdGlvbjtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSBvcHRpb25zLnJhbmdlO1xuICAgICAgICBjb25zdCBhZmZlY3RzRGF0YSA9IG9wdGlvbnMuYWZmZWN0c0RhdGEgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogb3B0aW9ucy5hZmZlY3RzRGF0YTtcbiAgICAgICAgaWYgKHRoaXMubW9kZWwubWFya2Vycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogTWFya2VyIHdpdGggcHJvdmlkZWQgbmFtZSBhbHJlYWR5IGV4aXN0cy5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLWFkZG1hcmtlci1tYXJrZXItZXhpc3RzXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci1hZGRtYXJrZXItbWFya2VyLWV4aXN0cycsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcmFuZ2UpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogUmFuZ2UgcGFyYW1ldGVyIGlzIHJlcXVpcmVkIHdoZW4gYWRkaW5nIGEgbmV3IG1hcmtlci5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLWFkZG1hcmtlci1uby1yYW5nZVxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItYWRkbWFya2VyLW5vLXJhbmdlJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF1c2luZ09wZXJhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwubWFya2Vycy5fc2V0KG5hbWUsIHJhbmdlLCB1c2luZ09wZXJhdGlvbiwgYWZmZWN0c0RhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGFwcGx5TWFya2VyT3BlcmF0aW9uKHRoaXMsIG5hbWUsIG51bGwsIHJhbmdlLCBhZmZlY3RzRGF0YSk7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLm1hcmtlcnMuZ2V0KG5hbWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcywgdXBkYXRlcyBvciByZWZyZXNoZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXJ9LiBNYXJrZXIgaXMgYSBuYW1lZCByYW5nZSwgd2hpY2ggdHJhY2tzXG5cdCAqIGNoYW5nZXMgaW4gdGhlIGRvY3VtZW50IGFuZCB1cGRhdGVzIGl0cyByYW5nZSBhdXRvbWF0aWNhbGx5LCB3aGVuIG1vZGVsIHRyZWUgY2hhbmdlcy4gU3RpbGwsIGl0IGlzIHBvc3NpYmxlIHRvIGNoYW5nZSB0aGVcblx0ICogbWFya2VyJ3MgcmFuZ2UgZGlyZWN0bHkgdXNpbmcgdGhpcyBtZXRob2QuXG5cdCAqXG5cdCAqIEFzIHRoZSBmaXJzdCBwYXJhbWV0ZXIgeW91IGNhbiBzZXQgbWFya2VyIG5hbWUgb3IgaW5zdGFuY2UuIElmIG5vbmUgb2YgdGhlbSBpcyBwcm92aWRlZCwgbmV3IG1hcmtlciwgd2l0aCBhIHVuaXF1ZVxuXHQgKiBuYW1lIGlzIGNyZWF0ZWQgYW5kIHJldHVybmVkLlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogSWYgeW91IHdhbnQgdG8gY2hhbmdlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCB2aWV3IGVsZW1lbnR9IG9mIHRoZSBtYXJrZXIgd2hpbGUgaXRzIGRhdGEgaW4gdGhlIG1vZGVsXG5cdCAqIHJlbWFpbnMgdGhlIHNhbWUsIHVzZSB0aGUgZGVkaWNhdGVkIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZWRpdGluZ2NvbnRyb2xsZXJ+RWRpdGluZ0NvbnRyb2xsZXIjcmVjb252ZXJ0TWFya2VyfSBtZXRob2QuXG5cdCAqXG5cdCAqIFRoZSBgb3B0aW9ucy51c2luZ09wZXJhdGlvbmAgcGFyYW1ldGVyIGxldHMgeW91IGNoYW5nZSBpZiB0aGUgbWFya2VyIHNob3VsZCBiZSBtYW5hZ2VkIGJ5IG9wZXJhdGlvbnMgb3Igbm90LiBTZWVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIgbWFya2VyIGNsYXNzIGRlc2NyaXB0aW9ufSB0byBsZWFybiBhYm91dCB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuXG5cdCAqIG1hcmtlcnMgbWFuYWdlZCBieSBvcGVyYXRpb25zIGFuZCBub3QtbWFuYWdlZCBieSBvcGVyYXRpb25zLiBJdCBpcyBwb3NzaWJsZSB0byBjaGFuZ2UgdGhpcyBvcHRpb24gZm9yIGFuIGV4aXN0aW5nIG1hcmtlci5cblx0ICpcblx0ICogVGhlIGBvcHRpb25zLmFmZmVjdHNEYXRhYCBwYXJhbWV0ZXIsIHdoaWNoIGRlZmF1bHRzIHRvIGBmYWxzZWAsIGFsbG93cyB5b3UgdG8gZGVmaW5lIGlmIGEgbWFya2VyIGFmZmVjdHMgdGhlIGRhdGEuIEl0IHNob3VsZCBiZVxuXHQgKiBgdHJ1ZWAgd2hlbiB0aGUgbWFya2VyIGNoYW5nZSBjaGFuZ2VzIHRoZSBkYXRhIHJldHVybmVkIGJ5XG5cdCAqIHRoZSB7QGxpbmsgbW9kdWxlOmNvcmUvZWRpdG9yL2VkaXRvcn5FZGl0b3IjZ2V0RGF0YSBgZWRpdG9yLmdldERhdGEoKWB9IG1ldGhvZC5cblx0ICogV2hlbiBzZXQgdG8gYHRydWVgIGl0IGZpcmVzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCNldmVudDpjaGFuZ2U6ZGF0YSBgY2hhbmdlOmRhdGFgfSBldmVudC5cblx0ICogV2hlbiBzZXQgdG8gYGZhbHNlYCBpdCBmaXJlcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y2hhbmdlIGBjaGFuZ2VgfSBldmVudC5cblx0ICpcblx0ICogVXBkYXRlIG1hcmtlciBkaXJlY3RseSBiYXNlIG9uIG1hcmtlcidzIG5hbWU6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHVwZGF0ZU1hcmtlciggbWFya2VyTmFtZSwgeyByYW5nZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBVcGRhdGUgbWFya2VyIHVzaW5nIG9wZXJhdGlvbjpcblx0ICpcblx0ICogYGBgdHNcblx0ICogdXBkYXRlTWFya2VyKCBtYXJrZXIsIHsgcmFuZ2UsIHVzaW5nT3BlcmF0aW9uOiB0cnVlIH0gKTtcblx0ICogdXBkYXRlTWFya2VyKCBtYXJrZXJOYW1lLCB7IHJhbmdlLCB1c2luZ09wZXJhdGlvbjogdHJ1ZSB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBDaGFuZ2UgbWFya2VyJ3Mgb3B0aW9uIChzdGFydCB1c2luZyBvcGVyYXRpb25zIHRvIG1hbmFnZSBpdCk6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHVwZGF0ZU1hcmtlciggbWFya2VyLCB7IHVzaW5nT3BlcmF0aW9uOiB0cnVlIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIENoYW5nZSBtYXJrZXIncyBvcHRpb24gKGluZm9ybSB0aGUgZW5naW5lLCB0aGF0IHRoZSBtYXJrZXIgZG9lcyBub3QgYWZmZWN0IHRoZSBkYXRhIGFueW1vcmUpOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB1cGRhdGVNYXJrZXIoIG1hcmtlck5hbWUsIHsgYWZmZWN0c0RhdGE6IGZhbHNlIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlclxuXHQgKiBAcGFyYW0gbWFya2VyT3JOYW1lIE5hbWUgb2YgYSBtYXJrZXIgdG8gdXBkYXRlLCBvciBhIG1hcmtlciBpbnN0YW5jZS5cblx0ICogQHBhcmFtIG9wdGlvbnMgSWYgb3B0aW9ucyBvYmplY3QgaXMgbm90IGRlZmluZWQgdGhlbiBtYXJrZXIgd2lsbCBiZSByZWZyZXNoZWQgYnkgdHJpZ2dlcmluZ1xuXHQgKiBkb3duY2FzdCBjb252ZXJzaW9uIGZvciB0aGlzIG1hcmtlciB3aXRoIHRoZSBzYW1lIGRhdGEuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnJhbmdlIE1hcmtlciByYW5nZSB0byB1cGRhdGUuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnVzaW5nT3BlcmF0aW9uIEZsYWcgaW5kaWNhdGVkIHdoZXRoZXIgdGhlIG1hcmtlciBzaG91bGQgYmUgYWRkZWQgYnkgTWFya2VyT3BlcmF0aW9uLlxuXHQgKiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbWFya2VyY29sbGVjdGlvbn5NYXJrZXIjbWFuYWdlZFVzaW5nT3BlcmF0aW9uc30uXG5cdCAqIEBwYXJhbSBvcHRpb25zLmFmZmVjdHNEYXRhIEZsYWcgaW5kaWNhdGluZyB0aGF0IHRoZSBtYXJrZXIgY2hhbmdlcyB0aGUgZWRpdG9yIGRhdGEuXG5cdCAqLyB1cGRhdGVNYXJrZXIobWFya2VyT3JOYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgY29uc3QgbWFya2VyTmFtZSA9IHR5cGVvZiBtYXJrZXJPck5hbWUgPT0gJ3N0cmluZycgPyBtYXJrZXJPck5hbWUgOiBtYXJrZXJPck5hbWUubmFtZTtcbiAgICAgICAgY29uc3QgY3VycmVudE1hcmtlciA9IHRoaXMubW9kZWwubWFya2Vycy5nZXQobWFya2VyTmFtZSk7XG4gICAgICAgIGlmICghY3VycmVudE1hcmtlcikge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBNYXJrZXIgd2l0aCBwcm92aWRlZCBuYW1lIGRvZXMgbm90IGV4aXN0IGFuZCB3aWxsIG5vdCBiZSB1cGRhdGVkLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciB3cml0ZXItdXBkYXRlbWFya2VyLW1hcmtlci1ub3QtZXhpc3RzXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci11cGRhdGVtYXJrZXItbWFya2VyLW5vdC1leGlzdHMnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgICAgICAgIC8qKlxuXHRcdFx0ICogVGhlIHVzYWdlIG9mIGB3cml0ZXIudXBkYXRlTWFya2VyKClgIG9ubHkgdG8gcmVjb252ZXJ0IChyZWZyZXNoKSBhXG5cdFx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtb2RlbCBtYXJrZXJ9IHdhcyBkZXByZWNhdGVkIGFuZCBtYXkgbm90IHdvcmsgaW4gdGhlIGZ1dHVyZS5cblx0XHRcdCAqIFBsZWFzZSB1cGRhdGUgeW91ciBjb2RlIHRvIHVzZVxuXHRcdFx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9lZGl0aW5nY29udHJvbGxlcn5FZGl0aW5nQ29udHJvbGxlciNyZWNvbnZlcnRNYXJrZXIgYGVkaXRvci5lZGl0aW5nLnJlY29udmVydE1hcmtlcigpYH1cblx0XHRcdCAqIGluc3RlYWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci11cGRhdGVtYXJrZXItcmVjb252ZXJ0LXVzaW5nLWVkaXRpbmdjb250cm9sbGVyXG5cdFx0XHQgKiBAcGFyYW0gbWFya2VyTmFtZSBUaGUgbmFtZSBvZiB0aGUgdXBkYXRlZCBtYXJrZXIuXG5cdFx0XHQgKi8gbG9nV2FybmluZygnd3JpdGVyLXVwZGF0ZW1hcmtlci1yZWNvbnZlcnQtdXNpbmctZWRpdGluZ2NvbnRyb2xsZXInLCB7XG4gICAgICAgICAgICAgICAgbWFya2VyTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLm1hcmtlcnMuX3JlZnJlc2goY3VycmVudE1hcmtlcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGFzVXNpbmdPcGVyYXRpb25EZWZpbmVkID0gdHlwZW9mIG9wdGlvbnMudXNpbmdPcGVyYXRpb24gPT0gJ2Jvb2xlYW4nO1xuICAgICAgICBjb25zdCBhZmZlY3RzRGF0YURlZmluZWQgPSB0eXBlb2Ygb3B0aW9ucy5hZmZlY3RzRGF0YSA9PSAnYm9vbGVhbic7XG4gICAgICAgIC8vIFVzZSBwcmV2aW91c2x5IGRlZmluZWQgbWFya2VyJ3MgYWZmZWN0c0RhdGEgaWYgdGhlIHByb3BlcnR5IGlzIG5vdCBwcm92aWRlZC5cbiAgICAgICAgY29uc3QgYWZmZWN0c0RhdGEgPSBhZmZlY3RzRGF0YURlZmluZWQgPyBvcHRpb25zLmFmZmVjdHNEYXRhIDogY3VycmVudE1hcmtlci5hZmZlY3RzRGF0YTtcbiAgICAgICAgaWYgKCFoYXNVc2luZ09wZXJhdGlvbkRlZmluZWQgJiYgIW9wdGlvbnMucmFuZ2UgJiYgIWFmZmVjdHNEYXRhRGVmaW5lZCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBPbmUgb2YgdGhlIG9wdGlvbnMgaXMgcmVxdWlyZWQgLSBwcm92aWRlIHJhbmdlLCB1c2luZ09wZXJhdGlvbnMgb3IgYWZmZWN0c0RhdGEuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci11cGRhdGVtYXJrZXItd3Jvbmctb3B0aW9uc1xuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItdXBkYXRlbWFya2VyLXdyb25nLW9wdGlvbnMnLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjdXJyZW50UmFuZ2UgPSBjdXJyZW50TWFya2VyLmdldFJhbmdlKCk7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRSYW5nZSA9IG9wdGlvbnMucmFuZ2UgPyBvcHRpb25zLnJhbmdlIDogY3VycmVudFJhbmdlO1xuICAgICAgICBpZiAoaGFzVXNpbmdPcGVyYXRpb25EZWZpbmVkICYmIG9wdGlvbnMudXNpbmdPcGVyYXRpb24gIT09IGN1cnJlbnRNYXJrZXIubWFuYWdlZFVzaW5nT3BlcmF0aW9ucykge1xuICAgICAgICAgICAgLy8gVGhlIG1hcmtlciB0eXBlIGlzIGNoYW5nZWQgc28gaXQncyBuZWNlc3NhcnkgdG8gY3JlYXRlIHByb3BlciBvcGVyYXRpb25zLlxuICAgICAgICAgICAgaWYgKG9wdGlvbnMudXNpbmdPcGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBtYXJrZXIgY2hhbmdlcyB0byBhIG1hbmFnZWQgb25lIHRyZWF0IHRoaXMgYXMgc3luY2hyb25pemluZyBleGlzdGluZyBtYXJrZXIuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGBNYXJrZXJPcGVyYXRpb25gIHdpdGggYG9sZFJhbmdlYCBzZXQgdG8gYG51bGxgLCBzbyByZXZlcnNlIG9wZXJhdGlvbiB3aWxsIHJlbW92ZSB0aGUgbWFya2VyLlxuICAgICAgICAgICAgICAgIGFwcGx5TWFya2VyT3BlcmF0aW9uKHRoaXMsIG1hcmtlck5hbWUsIG51bGwsIHVwZGF0ZWRSYW5nZSwgYWZmZWN0c0RhdGEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBtYXJrZXIgY2hhbmdlcyB0byBhIG1hcmtlciB0aGF0IGRvIG5vdCB1c2Ugb3BlcmF0aW9ucyB0aGVuIHdlIG5lZWQgdG8gY3JlYXRlIGFkZGl0aW9uYWwgb3BlcmF0aW9uXG4gICAgICAgICAgICAgICAgLy8gdGhhdCByZW1vdmVzIHRoYXQgbWFya2VyIGZpcnN0LlxuICAgICAgICAgICAgICAgIGFwcGx5TWFya2VyT3BlcmF0aW9uKHRoaXMsIG1hcmtlck5hbWUsIGN1cnJlbnRSYW5nZSwgbnVsbCwgYWZmZWN0c0RhdGEpO1xuICAgICAgICAgICAgICAgIC8vIEFsdGhvdWdoIG5vdCBtYW5hZ2VkIHRoZSBtYXJrZXIgaXRzZWxmIHNob3VsZCBzdGF5IGluIG1vZGVsIGFuZCBpdHMgcmFuZ2Ugc2hvdWxkIGJlIHByZXNlcnZlciBvciBjaGFuZ2VkIHRvIHBhc3NlZCByYW5nZS5cbiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1hcmtlcnMuX3NldChtYXJrZXJOYW1lLCB1cGRhdGVkUmFuZ2UsIHVuZGVmaW5lZCwgYWZmZWN0c0RhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIE1hcmtlcidzIHR5cGUgZG9lc24ndCBjaGFuZ2Ugc28gdXBkYXRlIGl0IGFjY29yZGluZ2x5LlxuICAgICAgICBpZiAoY3VycmVudE1hcmtlci5tYW5hZ2VkVXNpbmdPcGVyYXRpb25zKSB7XG4gICAgICAgICAgICBhcHBseU1hcmtlck9wZXJhdGlvbih0aGlzLCBtYXJrZXJOYW1lLCBjdXJyZW50UmFuZ2UsIHVwZGF0ZWRSYW5nZSwgYWZmZWN0c0RhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5tYXJrZXJzLl9zZXQobWFya2VyTmFtZSwgdXBkYXRlZFJhbmdlLCB1bmRlZmluZWQsIGFmZmVjdHNEYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXJ9IG9yIG1hcmtlciB3aXRoIGdpdmVuIG5hbWUuXG5cdCAqIFRoZSBtYXJrZXIgaXMgcmVtb3ZlZCBhY2NvcmRpbmdseSB0byBob3cgaXQgaGFzIGJlZW4gY3JlYXRlZCwgc28gaWYgdGhlIG1hcmtlciB3YXMgY3JlYXRlZCB1c2luZyBvcGVyYXRpb24sXG5cdCAqIGl0IHdpbGwgYmUgZGVzdHJveWVkIHVzaW5nIG9wZXJhdGlvbi5cblx0ICpcblx0ICogQHBhcmFtIG1hcmtlck9yTmFtZSBNYXJrZXIgb3IgbWFya2VyIG5hbWUgdG8gcmVtb3ZlLlxuXHQgKi8gcmVtb3ZlTWFya2VyKG1hcmtlck9yTmFtZSkge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0eXBlb2YgbWFya2VyT3JOYW1lID09ICdzdHJpbmcnID8gbWFya2VyT3JOYW1lIDogbWFya2VyT3JOYW1lLm5hbWU7XG4gICAgICAgIGlmICghdGhpcy5tb2RlbC5tYXJrZXJzLmhhcyhuYW1lKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUcnlpbmcgdG8gcmVtb3ZlIG1hcmtlciB3aGljaCBkb2VzIG5vdCBleGlzdC5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd3JpdGVyLXJlbW92ZW1hcmtlci1uby1tYXJrZXJcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd3JpdGVyLXJlbW92ZW1hcmtlci1uby1tYXJrZXInLCB0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXJrZXIgPSB0aGlzLm1vZGVsLm1hcmtlcnMuZ2V0KG5hbWUpO1xuICAgICAgICBpZiAoIW1hcmtlci5tYW5hZ2VkVXNpbmdPcGVyYXRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLm1hcmtlcnMuX3JlbW92ZShuYW1lKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvbGRSYW5nZSA9IG1hcmtlci5nZXRSYW5nZSgpO1xuICAgICAgICBhcHBseU1hcmtlck9wZXJhdGlvbih0aGlzLCBuYW1lLCBvbGRSYW5nZSwgbnVsbCwgbWFya2VyLmFmZmVjdHNEYXRhKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgYSBuZXcgcm9vdCB0byB0aGUgZG9jdW1lbnQgKG9yIHJlLWF0dGFjaGVzIGEge0BsaW5rICNkZXRhY2hSb290IGRldGFjaGVkIHJvb3R9KS5cblx0ICpcblx0ICogVGhyb3dzIGFuIGVycm9yLCBpZiB0cnlpbmcgdG8gYWRkIGEgcm9vdCB0aGF0IGlzIGFscmVhZHkgYWRkZWQgYW5kIGF0dGFjaGVkLlxuXHQgKlxuXHQgKiBAcGFyYW0gcm9vdE5hbWUgTmFtZSBvZiB0aGUgYWRkZWQgcm9vdC5cblx0ICogQHBhcmFtIGVsZW1lbnROYW1lIFRoZSBlbGVtZW50IG5hbWUuIERlZmF1bHRzIHRvIGAnJHJvb3QnYCB3aGljaCBhbHNvIGhhcyBzb21lIGJhc2ljIHNjaGVtYSBkZWZpbmVkXG5cdCAqIChlLmcuIGAkYmxvY2tgIGVsZW1lbnRzIGFyZSBhbGxvd2VkIGluc2lkZSB0aGUgYCRyb290YCkuIE1ha2Ugc3VyZSB0byBkZWZpbmUgYSBwcm9wZXIgc2NoZW1hIGlmIHlvdSB1c2UgYSBkaWZmZXJlbnQgbmFtZS5cblx0ICogQHJldHVybnMgVGhlIGFkZGVkIHJvb3QgZWxlbWVudC5cblx0ICovIGFkZFJvb3Qocm9vdE5hbWUsIGVsZW1lbnROYW1lID0gJyRyb290Jykge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLm1vZGVsLmRvY3VtZW50LmdldFJvb3Qocm9vdE5hbWUpO1xuICAgICAgICBpZiAocm9vdCAmJiByb290LmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBSb290IHdpdGggcHJvdmlkZWQgbmFtZSBhbHJlYWR5IGV4aXN0cyBhbmQgaXMgYXR0YWNoZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci1hZGRyb290LXJvb3QtZXhpc3RzXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dyaXRlci1hZGRyb290LXJvb3QtZXhpc3RzJywgdGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSB0aGlzLm1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgUm9vdE9wZXJhdGlvbihyb290TmFtZSwgZWxlbWVudE5hbWUsIHRydWUsIGRvY3VtZW50LCBkb2N1bWVudC52ZXJzaW9uKTtcbiAgICAgICAgdGhpcy5iYXRjaC5hZGRPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICAgICAgdGhpcy5tb2RlbC5hcHBseU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5kb2N1bWVudC5nZXRSb290KHJvb3ROYW1lKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERldGFjaGVzIHRoZSByb290IGZyb20gdGhlIGRvY3VtZW50LlxuXHQgKlxuXHQgKiBBbGwgY29udGVudCBhbmQgbWFya2VycyBhcmUgcmVtb3ZlZCBmcm9tIHRoZSByb290IHVwb24gZGV0YWNoaW5nLiBOZXcgY29udGVudCBhbmQgbmV3IG1hcmtlcnMgY2Fubm90IGJlIGFkZGVkIHRvIHRoZSByb290LCBhcyBsb25nXG5cdCAqIGFzIGl0IGlzIGRldGFjaGVkLlxuXHQgKlxuXHQgKiBBIHJvb3QgY2Fubm90IGJlIGZ1bGx5IHJlbW92ZWQgZnJvbSB0aGUgZG9jdW1lbnQsIGl0IGNhbiBiZSBvbmx5IGRldGFjaGVkLiBBIHJvb3QgaXMgcGVybWFuZW50bHkgcmVtb3ZlZCBvbmx5IGFmdGVyIHlvdVxuXHQgKiByZS1pbml0aWFsaXplIHRoZSBlZGl0b3IgYW5kIGRvIG5vdCBzcGVjaWZ5IHRoZSByb290IGluIHRoZSBpbml0aWFsIGRhdGEuXG5cdCAqXG5cdCAqIEEgZGV0YWNoZWQgcm9vdCBjYW4gYmUgcmUtYXR0YWNoZWQgdXNpbmcge0BsaW5rICNhZGRSb290fS5cblx0ICpcblx0ICogVGhyb3dzIGFuIGVycm9yIGlmIHRoZSByb290IGRvZXMgbm90IGV4aXN0IG9yIHRoZSByb290IGlzIGFscmVhZHkgZGV0YWNoZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSByb290T3JOYW1lIE5hbWUgb2YgdGhlIGRldGFjaGVkIHJvb3QuXG5cdCAqLyBkZXRhY2hSb290KHJvb3RPck5hbWUpIHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0V3JpdGVyVXNlZENvcnJlY3RseSgpO1xuICAgICAgICBjb25zdCByb290ID0gdHlwZW9mIHJvb3RPck5hbWUgPT0gJ3N0cmluZycgPyB0aGlzLm1vZGVsLmRvY3VtZW50LmdldFJvb3Qocm9vdE9yTmFtZSkgOiByb290T3JOYW1lO1xuICAgICAgICBpZiAoIXJvb3QgfHwgIXJvb3QuaXNBdHRhY2hlZCgpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFJvb3Qgd2l0aCBwcm92aWRlZCBuYW1lIGRvZXMgbm90IGV4aXN0IG9yIGlzIGFscmVhZHkgZGV0YWNoZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdyaXRlci1kZXRhY2hyb290LW5vLXJvb3Rcblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd3JpdGVyLWRldGFjaHJvb3Qtbm8tcm9vdCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpcnN0LCByZW1vdmUgYWxsIG1hcmtlcnMgZnJvbSB0aGUgcm9vdC4gSXQgaXMgYmV0dGVyIHRvIGRvIGl0IGJlZm9yZSByZW1vdmluZyBzdHVmZiBmb3IgdW5kbyBwdXJwb3Nlcy5cbiAgICAgICAgLy8gSG93ZXZlciwgbG9va2luZyB0aHJvdWdoIGFsbCB0aGUgbWFya2VycyBtYXkgbm90IGJlIHRoZSBiZXN0IHBlcmZvcm1hbmNlIHdpc2UuIEJ1dCB0aGVyZSdzIG5vIGJldHRlciBzb2x1dGlvbiBmb3Igbm93LlxuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLm1vZGVsLm1hcmtlcnMpe1xuICAgICAgICAgICAgaWYgKG1hcmtlci5nZXRSYW5nZSgpLnJvb3QgPT09IHJvb3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU1hcmtlcihtYXJrZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBhbGwgYXR0cmlidXRlcyBmcm9tIHRoZSByb290LlxuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiByb290LmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZShrZXksIHJvb3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBhbGwgY29udGVudHMgb2YgdGhlIHJvb3QuXG4gICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuY3JlYXRlUmFuZ2VJbihyb290KSk7XG4gICAgICAgIC8vIEZpbmFsbHksIGRldGFjaCB0aGUgcm9vdC5cbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSB0aGlzLm1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgUm9vdE9wZXJhdGlvbihyb290LnJvb3ROYW1lLCByb290Lm5hbWUsIGZhbHNlLCBkb2N1bWVudCwgZG9jdW1lbnQudmVyc2lvbik7XG4gICAgICAgIHRoaXMuYmF0Y2guYWRkT3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgICAgIHRoaXMubW9kZWwuYXBwbHlPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICB9XG4gICAgc2V0U2VsZWN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0V3JpdGVyVXNlZENvcnJlY3RseSgpO1xuICAgICAgICB0aGlzLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5fc2V0VG8oLi4uYXJncyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiNmb2N1c30gdG8gdGhlIHNwZWNpZmllZCBsb2NhdGlvbi5cblx0ICpcblx0ICogVGhlIGxvY2F0aW9uIGNhbiBiZSBzcGVjaWZpZWQgaW4gdGhlIHNhbWUgZm9ybSBhc1xuXHQgKiB7QGxpbmsgI2NyZWF0ZVBvc2l0aW9uQXQgYHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KClgfSBwYXJhbWV0ZXJzLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbU9yUG9zaXRpb25cblx0ICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb3Igb25lIG9mIHRoZSBmbGFncy4gVXNlZCBvbmx5IHdoZW4gZmlyc3QgcGFyYW1ldGVyIGlzIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKi8gc2V0U2VsZWN0aW9uRm9jdXMoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkge1xuICAgICAgICB0aGlzLl9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCk7XG4gICAgICAgIHRoaXMubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLl9zZXRGb2N1cyhpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICB9XG4gICAgc2V0U2VsZWN0aW9uQXR0cmlidXRlKGtleU9yT2JqZWN0T3JJdGVyYWJsZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0V3JpdGVyVXNlZENvcnJlY3RseSgpO1xuICAgICAgICBpZiAodHlwZW9mIGtleU9yT2JqZWN0T3JJdGVyYWJsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldFNlbGVjdGlvbkF0dHJpYnV0ZShrZXlPck9iamVjdE9ySXRlcmFibGUsIHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRvTWFwKGtleU9yT2JqZWN0T3JJdGVyYWJsZSkpe1xuICAgICAgICAgICAgICAgIHRoaXMuX3NldFNlbGVjdGlvbkF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBhdHRyaWJ1dGUocykgd2l0aCBnaXZlbiBrZXkocykgZnJvbSB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBSZW1vdmUgb25lIGF0dHJpYnV0ZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLnJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSggJ2l0YWxpYycgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFJlbW92ZSBtdWx0aXBsZSBhdHRyaWJ1dGVzOlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIucmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKCBbICdpdGFsaWMnLCAnYm9sZCcgXSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGtleU9ySXRlcmFibGVPZktleXMgS2V5IG9mIHRoZSBhdHRyaWJ1dGUgdG8gcmVtb3ZlIG9yIGFuIGl0ZXJhYmxlIG9mIGF0dHJpYnV0ZSBrZXlzIHRvIHJlbW92ZS5cblx0ICovIHJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZShrZXlPckl0ZXJhYmxlT2ZLZXlzKSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydFdyaXRlclVzZWRDb3JyZWN0bHkoKTtcbiAgICAgICAgaWYgKHR5cGVvZiBrZXlPckl0ZXJhYmxlT2ZLZXlzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKGtleU9ySXRlcmFibGVPZktleXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5T3JJdGVyYWJsZU9mS2V5cyl7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU2VsZWN0aW9uQXR0cmlidXRlKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFRlbXBvcmFyaWx5IGNoYW5nZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uI2lzR3Jhdml0eU92ZXJyaWRkZW4gZ3Jhdml0eX1cblx0ICogb2YgdGhlIHNlbGVjdGlvbiBmcm9tIGxlZnQgdG8gcmlnaHQuXG5cdCAqXG5cdCAqIFRoZSBncmF2aXR5IGRlZmluZXMgZnJvbSB3aGljaCBkaXJlY3Rpb24gdGhlIHNlbGVjdGlvbiBpbmhlcml0cyBpdHMgYXR0cmlidXRlcy4gSWYgaXQncyB0aGUgZGVmYXVsdCBsZWZ0IGdyYXZpdHksXG5cdCAqIHRoZW4gdGhlIHNlbGVjdGlvbiAoYWZ0ZXIgYmVpbmcgbW92ZWQgYnkgdGhlIHVzZXIpIGluaGVyaXRzIGF0dHJpYnV0ZXMgZnJvbSBpdHMgbGVmdC1oYW5kIHNpZGUuXG5cdCAqIFRoaXMgbWV0aG9kIGFsbG93cyB0byB0ZW1wb3JhcmlseSBvdmVycmlkZSB0aGlzIGJlaGF2aW9yIGJ5IGZvcmNpbmcgdGhlIGdyYXZpdHkgdG8gdGhlIHJpZ2h0LlxuXHQgKlxuXHQgKiBGb3IgdGhlIGZvbGxvd2luZyBtb2RlbCBmcmFnbWVudDpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDwkdGV4dCBib2xkPVwidHJ1ZVwiIGxpbmtIcmVmPVwidXJsXCI+YmFyW108LyR0ZXh0PjwkdGV4dCBib2xkPVwidHJ1ZVwiPmJpejwvJHRleHQ+XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiAqIERlZmF1bHQgZ3Jhdml0eTogc2VsZWN0aW9uIHdpbGwgaGF2ZSB0aGUgYGJvbGRgIGFuZCBgbGlua0hyZWZgIGF0dHJpYnV0ZXMuXG5cdCAqICogT3ZlcnJpZGRlbiBncmF2aXR5OiBzZWxlY3Rpb24gd2lsbCBoYXZlIGBib2xkYCBhdHRyaWJ1dGUuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBJdCByZXR1cm5zIGFuIHVuaXF1ZSBpZGVudGlmaWVyIHdoaWNoIGlzIHJlcXVpcmVkIHRvIHJlc3RvcmUgdGhlIGdyYXZpdHkuIEl0IGd1YXJhbnRlZXMgdGhlIHN5bW1ldHJ5XG5cdCAqIG9mIHRoZSBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAcmV0dXJucyBUaGUgdW5pcXVlIGlkIHdoaWNoIGFsbG93cyByZXN0b3JpbmcgdGhlIGdyYXZpdHkuXG5cdCAqLyBvdmVycmlkZVNlbGVjdGlvbkdyYXZpdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5fb3ZlcnJpZGVHcmF2aXR5KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXN0b3JlcyB7QGxpbmsgfldyaXRlciNvdmVycmlkZVNlbGVjdGlvbkdyYXZpdHl9IGdyYXZpdHkgdG8gZGVmYXVsdC5cblx0ICpcblx0ICogUmVzdG9yaW5nIHRoZSBncmF2aXR5IGlzIG9ubHkgcG9zc2libGUgdXNpbmcgdGhlIHVuaXF1ZSBpZGVudGlmaWVyIHJldHVybmVkIGJ5XG5cdCAqIHtAbGluayB+V3JpdGVyI292ZXJyaWRlU2VsZWN0aW9uR3Jhdml0eX0uIE5vdGUgdGhhdCB0aGUgZ3Jhdml0eSByZW1haW5zIG92ZXJyaWRkZW4gYXMgbG9uZyBhcyB3b24ndCBiZSByZXN0b3JlZFxuXHQgKiB0aGUgc2FtZSBudW1iZXIgb2YgdGltZXMgaXQgd2FzIG92ZXJyaWRkZW4uXG5cdCAqXG5cdCAqIEBwYXJhbSB1aWQgVGhlIHVuaXF1ZSBpZCByZXR1cm5lZCBieSB7QGxpbmsgfldyaXRlciNvdmVycmlkZVNlbGVjdGlvbkdyYXZpdHl9LlxuXHQgKi8gcmVzdG9yZVNlbGVjdGlvbkdyYXZpdHkodWlkKSB7XG4gICAgICAgIHRoaXMubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLl9yZXN0b3JlR3Jhdml0eSh1aWQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQHBhcmFtIGtleSBLZXkgb2YgdGhlIGF0dHJpYnV0ZSB0byByZW1vdmUuXG5cdCAqIEBwYXJhbSB2YWx1ZSBBdHRyaWJ1dGUgdmFsdWUuXG5cdCAqLyBfc2V0U2VsZWN0aW9uQXR0cmlidXRlKGtleSwgdmFsdWUpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIC8vIFN0b3JlIGF0dHJpYnV0ZSBpbiBwYXJlbnQgZWxlbWVudCBpZiB0aGUgc2VsZWN0aW9uIGlzIGNvbGxhcHNlZCBpbiBhbiBlbXB0eSBub2RlLlxuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmIHNlbGVjdGlvbi5hbmNob3IucGFyZW50LmlzRW1wdHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlS2V5ID0gRG9jdW1lbnRTZWxlY3Rpb24uX2dldFN0b3JlQXR0cmlidXRlS2V5KGtleSk7XG4gICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZShzdG9yZUtleSwgdmFsdWUsIHNlbGVjdGlvbi5hbmNob3IucGFyZW50KTtcbiAgICAgICAgfVxuICAgICAgICBzZWxlY3Rpb24uX3NldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBrZXkgS2V5IG9mIHRoZSBhdHRyaWJ1dGUgdG8gcmVtb3ZlLlxuXHQgKi8gX3JlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZShrZXkpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIC8vIFJlbW92ZSBzdG9yZWQgYXR0cmlidXRlIGZyb20gcGFyZW50IGVsZW1lbnQgaWYgdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgaW4gYW4gZW1wdHkgbm9kZS5cbiAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBzZWxlY3Rpb24uYW5jaG9yLnBhcmVudC5pc0VtcHR5KSB7XG4gICAgICAgICAgICBjb25zdCBzdG9yZUtleSA9IERvY3VtZW50U2VsZWN0aW9uLl9nZXRTdG9yZUF0dHJpYnV0ZUtleShrZXkpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoc3RvcmVLZXksIHNlbGVjdGlvbi5hbmNob3IucGFyZW50KTtcbiAgICAgICAgfVxuICAgICAgICBzZWxlY3Rpb24uX3JlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhyb3dzIGB3cml0ZXItZGV0YWNoZWQtd3JpdGVyLXRyaWVzLXRvLW1vZGlmeS1tb2RlbGAgZXJyb3Igd2hlbiB0aGUgd3JpdGVyIGlzIHVzZWQgb3V0c2lkZSBvZiB0aGUgYGNoYW5nZSgpYCBibG9jay5cblx0ICovIF9hc3NlcnRXcml0ZXJVc2VkQ29ycmVjdGx5KCkge1xuICAgICAgICAvKipcblx0XHQgKiBUcnlpbmcgdG8gdXNlIGEgd3JpdGVyIG91dHNpZGUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjaGFuZ2UgYGNoYW5nZSgpYH0gb3Jcblx0XHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNlbnF1ZXVlQ2hhbmdlIGBlbnF1ZXVlQ2hhbmdlKClgfSBibG9ja3MuXG5cdFx0ICpcblx0XHQgKiBUaGUgd3JpdGVyIGNhbiBvbmx5IGJlIHVzZWQgaW5zaWRlIHRoZXNlIGJsb2NrcyB3aGljaCBlbnN1cmVzIHRoYXQgdGhlIG1vZGVsXG5cdFx0ICogY2FuIG9ubHkgYmUgY2hhbmdlZCBkdXJpbmcgc3VjaCBcInNlc3Npb25zXCIuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3Igd3JpdGVyLWluY29ycmVjdC11c2Vcblx0XHQgKi8gaWYgKHRoaXMubW9kZWwuX2N1cnJlbnRXcml0ZXIgIT09IHRoaXMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCd3cml0ZXItaW5jb3JyZWN0LXVzZScsIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb3IgZ2l2ZW4gYWN0aW9uIGB0eXBlYCBhbmQgYHBvc2l0aW9uT3JSYW5nZWAgd2hlcmUgdGhlIGFjdGlvbiBoYXBwZW5zLCB0aGlzIGZ1bmN0aW9uIGZpbmRzIGFsbCBhZmZlY3RlZCBtYXJrZXJzXG5cdCAqIGFuZCBhcHBsaWVzIGEgbWFya2VyIG9wZXJhdGlvbiB3aXRoIHRoZSBuZXcgbWFya2VyIHJhbmdlIGVxdWFsIHRvIHRoZSBjdXJyZW50IHJhbmdlLiBUaGFua3MgdG8gdGhpcywgdGhlIG1hcmtlciByYW5nZVxuXHQgKiBjYW4gYmUgbGF0ZXIgY29ycmVjdGx5IHByb2Nlc3NlZCBkdXJpbmcgdW5kby5cblx0ICpcblx0ICogQHBhcmFtIHR5cGUgV3JpdGVyIGFjdGlvbiB0eXBlLlxuXHQgKiBAcGFyYW0gcG9zaXRpb25PclJhbmdlIFBvc2l0aW9uIG9yIHJhbmdlIHdoZXJlIHRoZSB3cml0ZXIgYWN0aW9uIGhhcHBlbnMuXG5cdCAqLyBfYWRkT3BlcmF0aW9uRm9yQWZmZWN0ZWRNYXJrZXJzKHR5cGUsIHBvc2l0aW9uT3JSYW5nZSkge1xuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLm1vZGVsLm1hcmtlcnMpe1xuICAgICAgICAgICAgaWYgKCFtYXJrZXIubWFuYWdlZFVzaW5nT3BlcmF0aW9ucykge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbWFya2VyUmFuZ2UgPSBtYXJrZXIuZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgIGxldCBpc0FmZmVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ21vdmUnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBwb3NpdGlvbk9yUmFuZ2U7XG4gICAgICAgICAgICAgICAgaXNBZmZlY3RlZCA9IHJhbmdlLmNvbnRhaW5zUG9zaXRpb24obWFya2VyUmFuZ2Uuc3RhcnQpIHx8IHJhbmdlLnN0YXJ0LmlzRXF1YWwobWFya2VyUmFuZ2Uuc3RhcnQpIHx8IHJhbmdlLmNvbnRhaW5zUG9zaXRpb24obWFya2VyUmFuZ2UuZW5kKSB8fCByYW5nZS5lbmQuaXNFcXVhbChtYXJrZXJSYW5nZS5lbmQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBpZiB0eXBlID09PSAnbWVyZ2UnLlxuICAgICAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25PclJhbmdlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRCZWZvcmUgPSBwb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRBZnRlciA9IHBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgIFN0YXJ0OiAgPHA+Rm9vWzwvcD48cD5CYXJdPC9wPlxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgQWZ0ZXIgbWVyZ2U6ICA8cD5Gb29bQmFyXTwvcD5cbiAgICAgICAgICAgICAgICAvLyBBZnRlciB1bmRvaW5nIHNwbGl0OiAgPHA+Rm9vPC9wPjxwPltCYXJdPC9wPiAgICAgPC0tIGluY29ycmVjdCwgbmVlZHMgcmVtZW1iZXJpbmcgZm9yIHVuZG8uXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBjb25zdCBhZmZlY3RlZEluTGVmdEVsZW1lbnQgPSBtYXJrZXJSYW5nZS5zdGFydC5wYXJlbnQgPT0gZWxlbWVudEJlZm9yZSAmJiBtYXJrZXJSYW5nZS5zdGFydC5pc0F0RW5kO1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgU3RhcnQ6ICA8cD5bRm9vPC9wPjxwPl1CYXI8L3A+XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBBZnRlciBtZXJnZTogIDxwPltGb29dQmFyPC9wPlxuICAgICAgICAgICAgICAgIC8vIEFmdGVyIHVuZG9pbmcgc3BsaXQ6ICA8cD5bRm9vXTwvcD48cD5CYXI8L3A+ICAgICA8LS0gaW5jb3JyZWN0LCBuZWVkcyByZW1lbWJlcmluZyBmb3IgdW5kby5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIGNvbnN0IGFmZmVjdGVkSW5SaWdodEVsZW1lbnQgPSBtYXJrZXJSYW5nZS5lbmQucGFyZW50ID09IGVsZW1lbnRBZnRlciAmJiBtYXJrZXJSYW5nZS5lbmQub2Zmc2V0ID09IDA7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICBTdGFydDogIDxwPltGb288L3A+XTxwPkJhcjwvcD5cbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIEFmdGVyIG1lcmdlOiAgPHA+W0Zvb11CYXI8L3A+XG4gICAgICAgICAgICAgICAgLy8gQWZ0ZXIgdW5kb2luZyBzcGxpdDogIDxwPltGb29dPC9wPjxwPkJhcjwvcD4gICAgIDwtLSBpbmNvcnJlY3QsIG5lZWRzIHJlbWVtYmVyaW5nIGZvciB1bmRvLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgY29uc3QgYWZmZWN0ZWRBZnRlckxlZnRFbGVtZW50ID0gbWFya2VyUmFuZ2UuZW5kLm5vZGVBZnRlciA9PSBlbGVtZW50QWZ0ZXI7XG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICBTdGFydDogIDxwPkZvbzwvcD5bPHA+QmFyXTwvcD5cbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIEFmdGVyIG1lcmdlOiAgPHA+Rm9vW0Jhcl08L3A+XG4gICAgICAgICAgICAgICAgLy8gQWZ0ZXIgdW5kb2luZyBzcGxpdDogIDxwPkZvbzwvcD48cD5bQmFyXTwvcD4gICAgIDwtLSBpbmNvcnJlY3QsIG5lZWRzIHJlbWVtYmVyaW5nIGZvciB1bmRvLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgY29uc3QgYWZmZWN0ZWRCZWZvcmVSaWdodEVsZW1lbnQgPSBtYXJrZXJSYW5nZS5zdGFydC5ub2RlQWZ0ZXIgPT0gZWxlbWVudEFmdGVyO1xuICAgICAgICAgICAgICAgIGlzQWZmZWN0ZWQgPSBhZmZlY3RlZEluTGVmdEVsZW1lbnQgfHwgYWZmZWN0ZWRJblJpZ2h0RWxlbWVudCB8fCBhZmZlY3RlZEFmdGVyTGVmdEVsZW1lbnQgfHwgYWZmZWN0ZWRCZWZvcmVSaWdodEVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNBZmZlY3RlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTWFya2VyKG1hcmtlci5uYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlOiBtYXJrZXJSYW5nZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBTZXRzIGdpdmVuIGF0dHJpYnV0ZSB0byBlYWNoIG5vZGUgaW4gZ2l2ZW4gcmFuZ2UuIFdoZW4gYXR0cmlidXRlIHZhbHVlIGlzIG51bGwgdGhlbiBhdHRyaWJ1dGUgd2lsbCBiZSByZW1vdmVkLlxuICpcbiAqIEJlY2F1c2UgYXR0cmlidXRlIG9wZXJhdGlvbiBuZWVkcyB0byBoYXZlIHRoZSBzYW1lIGF0dHJpYnV0ZSB2YWx1ZSBvbiB0aGUgd2hvbGUgcmFuZ2UsIHRoaXMgZnVuY3Rpb24gc3BsaXRzXG4gKiB0aGUgcmFuZ2UgaW50byBzbWFsbGVyIHBhcnRzLlxuICpcbiAqIEdpdmVuIGByYW5nZWAgbXVzdCBiZSBmbGF0LlxuICovIGZ1bmN0aW9uIHNldEF0dHJpYnV0ZU9uUmFuZ2Uod3JpdGVyLCBrZXksIHZhbHVlLCByYW5nZSkge1xuICAgIGNvbnN0IG1vZGVsID0gd3JpdGVyLm1vZGVsO1xuICAgIGNvbnN0IGRvYyA9IG1vZGVsLmRvY3VtZW50O1xuICAgIC8vIFBvc2l0aW9uIG9mIHRoZSBsYXN0IHNwbGl0LCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBuZXcgcmFuZ2UuXG4gICAgbGV0IGxhc3RTcGxpdFBvc2l0aW9uID0gcmFuZ2Uuc3RhcnQ7XG4gICAgLy8gQ3VycmVudGx5IHBvc2l0aW9uIGluIHRoZSBzY2FubmluZyByYW5nZS4gQmVjYXVzZSB3ZSBuZWVkIHZhbHVlIGFmdGVyIHRoZSBwb3NpdGlvbiwgaXQgaXMgbm90IGEgY3VycmVudFxuICAgIC8vIHBvc2l0aW9uIG9mIHRoZSBpdGVyYXRvciBidXQgdGhlIHByZXZpb3VzIG9uZSAod2UgbmVlZCB0byBpdGVyYXRlIG9uZSBtb3JlIHRpbWUgdG8gZ2V0IHRoZSB2YWx1ZSBhZnRlcikuXG4gICAgbGV0IHBvc2l0aW9uO1xuICAgIC8vIFZhbHVlIGJlZm9yZSB0aGUgY3VycmVudGx5IHBvc2l0aW9uLlxuICAgIGxldCB2YWx1ZUJlZm9yZTtcbiAgICAvLyBWYWx1ZSBhZnRlciB0aGUgY3VycmVudGx5IHBvc2l0aW9uLlxuICAgIGxldCB2YWx1ZUFmdGVyO1xuICAgIGZvciAoY29uc3QgdmFsIG9mIHJhbmdlLmdldFdhbGtlcih7XG4gICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICB9KSl7XG4gICAgICAgIHZhbHVlQWZ0ZXIgPSB2YWwuaXRlbS5nZXRBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgLy8gQXQgdGhlIGZpcnN0IHJ1biBvZiB0aGUgaXRlcmF0b3IgdGhlIHBvc2l0aW9uIGluIHVuZGVmaW5lZC4gV2UgYWxzbyBkbyBub3QgaGF2ZSBhIHZhbHVlQmVmb3JlLCBidXRcbiAgICAgICAgLy8gYmVjYXVzZSB2YWx1ZUFmdGVyIG1heSBiZSBudWxsLCB2YWx1ZUJlZm9yZSBtYXkgYmUgZXF1YWwgdmFsdWVBZnRlciAoIHVuZGVmaW5lZCA9PSBudWxsICkuXG4gICAgICAgIGlmIChwb3NpdGlvbiAmJiB2YWx1ZUJlZm9yZSAhPSB2YWx1ZUFmdGVyKSB7XG4gICAgICAgICAgICAvLyBpZiB2YWx1ZUJlZm9yZSA9PSB2YWx1ZSB0aGVyZSBpcyBub3RoaW5nIHRvIGNoYW5nZSwgc28gd2UgYWRkIG9wZXJhdGlvbiBvbmx5IGlmIHRoZXNlIHZhbHVlcyBhcmUgZGlmZmVyZW50LlxuICAgICAgICAgICAgaWYgKHZhbHVlQmVmb3JlICE9IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgYWRkT3BlcmF0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0U3BsaXRQb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHBvc2l0aW9uID0gdmFsLm5leHRQb3NpdGlvbjtcbiAgICAgICAgdmFsdWVCZWZvcmUgPSB2YWx1ZUFmdGVyO1xuICAgIH1cbiAgICAvLyBCZWNhdXNlIHBvc2l0aW9uIGluIHRoZSBsb29wIGlzIG5vdCB0aGUgaXRlcmF0b3IgcG9zaXRpb24gKHNlZSBsZXQgcG9zaXRpb24gY29tbWVudCksIHRoZSBsYXN0IHBvc2l0aW9uIGluXG4gICAgLy8gdGhlIHdoaWxlIGxvb3Agd2lsbCBiZSBsYXN0IGJ1dCBvbmUgcG9zaXRpb24gaW4gdGhlIHJhbmdlLiBXZSBuZWVkIHRvIGNoZWNrIHRoZSBsYXN0IHBvc2l0aW9uIG1hbnVhbGx5LlxuICAgIGlmIChwb3NpdGlvbiBpbnN0YW5jZW9mIFBvc2l0aW9uICYmIHBvc2l0aW9uICE9IGxhc3RTcGxpdFBvc2l0aW9uICYmIHZhbHVlQmVmb3JlICE9IHZhbHVlKSB7XG4gICAgICAgIGFkZE9wZXJhdGlvbigpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBhZGRPcGVyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlID0gbmV3IFJhbmdlKGxhc3RTcGxpdFBvc2l0aW9uLCBwb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IHZlcnNpb24gPSByYW5nZS5yb290LmRvY3VtZW50ID8gZG9jLnZlcnNpb24gOiBudWxsO1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBuZXcgQXR0cmlidXRlT3BlcmF0aW9uKHJhbmdlLCBrZXksIHZhbHVlQmVmb3JlLCB2YWx1ZSwgdmVyc2lvbik7XG4gICAgICAgIHdyaXRlci5iYXRjaC5hZGRPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICAgICAgbW9kZWwuYXBwbHlPcGVyYXRpb24ob3BlcmF0aW9uKTtcbiAgICB9XG59XG4vKipcbiAqIFNldHMgZ2l2ZW4gYXR0cmlidXRlIHRvIHRoZSBnaXZlbiBub2RlLiBXaGVuIGF0dHJpYnV0ZSB2YWx1ZSBpcyBudWxsIHRoZW4gYXR0cmlidXRlIHdpbGwgYmUgcmVtb3ZlZC5cbiAqLyBmdW5jdGlvbiBzZXRBdHRyaWJ1dGVPbkl0ZW0od3JpdGVyLCBrZXksIHZhbHVlLCBpdGVtKSB7XG4gICAgY29uc3QgbW9kZWwgPSB3cml0ZXIubW9kZWw7XG4gICAgY29uc3QgZG9jID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgY29uc3QgcHJldmlvdXNWYWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKGtleSk7XG4gICAgbGV0IHJhbmdlLCBvcGVyYXRpb247XG4gICAgaWYgKHByZXZpb3VzVmFsdWUgIT0gdmFsdWUpIHtcbiAgICAgICAgY29uc3QgaXNSb290Q2hhbmdlZCA9IGl0ZW0ucm9vdCA9PT0gaXRlbTtcbiAgICAgICAgaWYgKGlzUm9vdENoYW5nZWQpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGNoYW5nZSBhdHRyaWJ1dGVzIG9mIHJvb3QgZWxlbWVudCwgd2UgaGF2ZSB0byB1c2UgYFJvb3RBdHRyaWJ1dGVPcGVyYXRpb25gLlxuICAgICAgICAgICAgY29uc3QgdmVyc2lvbiA9IGl0ZW0uZG9jdW1lbnQgPyBkb2MudmVyc2lvbiA6IG51bGw7XG4gICAgICAgICAgICBvcGVyYXRpb24gPSBuZXcgUm9vdEF0dHJpYnV0ZU9wZXJhdGlvbihpdGVtLCBrZXksIHByZXZpb3VzVmFsdWUsIHZhbHVlLCB2ZXJzaW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKFBvc2l0aW9uLl9jcmVhdGVCZWZvcmUoaXRlbSksIHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKGl0ZW0pKTtcbiAgICAgICAgICAgIGNvbnN0IHZlcnNpb24gPSByYW5nZS5yb290LmRvY3VtZW50ID8gZG9jLnZlcnNpb24gOiBudWxsO1xuICAgICAgICAgICAgb3BlcmF0aW9uID0gbmV3IEF0dHJpYnV0ZU9wZXJhdGlvbihyYW5nZSwga2V5LCBwcmV2aW91c1ZhbHVlLCB2YWx1ZSwgdmVyc2lvbik7XG4gICAgICAgIH1cbiAgICAgICAgd3JpdGVyLmJhdGNoLmFkZE9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgICAgICBtb2RlbC5hcHBseU9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhbmQgYXBwbGllcyBtYXJrZXIgb3BlcmF0aW9uIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL29wZXJhdGlvbi9vcGVyYXRpb25+T3BlcmF0aW9uIG9wZXJhdGlvbn0uXG4gKi8gZnVuY3Rpb24gYXBwbHlNYXJrZXJPcGVyYXRpb24od3JpdGVyLCBuYW1lLCBvbGRSYW5nZSwgbmV3UmFuZ2UsIGFmZmVjdHNEYXRhKSB7XG4gICAgY29uc3QgbW9kZWwgPSB3cml0ZXIubW9kZWw7XG4gICAgY29uc3QgZG9jID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgY29uc3Qgb3BlcmF0aW9uID0gbmV3IE1hcmtlck9wZXJhdGlvbihuYW1lLCBvbGRSYW5nZSwgbmV3UmFuZ2UsIG1vZGVsLm1hcmtlcnMsICEhYWZmZWN0c0RhdGEsIGRvYy52ZXJzaW9uKTtcbiAgICB3cml0ZXIuYmF0Y2guYWRkT3BlcmF0aW9uKG9wZXJhdGlvbik7XG4gICAgbW9kZWwuYXBwbHlPcGVyYXRpb24ob3BlcmF0aW9uKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBgTW92ZU9wZXJhdGlvbmAgb3IgYERldGFjaE9wZXJhdGlvbmAgdGhhdCByZW1vdmVzIGBob3dNYW55YCBub2RlcyBzdGFydGluZyBmcm9tIGBwb3NpdGlvbmAuXG4gKiBUaGUgb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZCBvbiBnaXZlbiBtb2RlbCBpbnN0YW5jZSBhbmQgYWRkZWQgdG8gZ2l2ZW4gb3BlcmF0aW9uIGluc3RhbmNlLlxuICpcbiAqIEBwYXJhbSBwb3NpdGlvbiBQb3NpdGlvbiBmcm9tIHdoaWNoIG5vZGVzIGFyZSByZW1vdmVkLlxuICogQHBhcmFtIGhvd01hbnkgTnVtYmVyIG9mIG5vZGVzIHRvIHJlbW92ZS5cbiAqIEBwYXJhbSBiYXRjaCBCYXRjaCB0byB3aGljaCB0aGUgb3BlcmF0aW9uIHdpbGwgYmUgYWRkZWQuXG4gKiBAcGFyYW0gbW9kZWwgTW9kZWwgaW5zdGFuY2Ugb24gd2hpY2ggb3BlcmF0aW9uIHdpbGwgYmUgYXBwbGllZC5cbiAqLyBmdW5jdGlvbiBhcHBseVJlbW92ZU9wZXJhdGlvbihwb3NpdGlvbiwgaG93TWFueSwgYmF0Y2gsIG1vZGVsKSB7XG4gICAgbGV0IG9wZXJhdGlvbjtcbiAgICBpZiAocG9zaXRpb24ucm9vdC5kb2N1bWVudCkge1xuICAgICAgICBjb25zdCBkb2MgPSBtb2RlbC5kb2N1bWVudDtcbiAgICAgICAgY29uc3QgZ3JhdmV5YXJkUG9zaXRpb24gPSBuZXcgUG9zaXRpb24oZG9jLmdyYXZleWFyZCwgW1xuICAgICAgICAgICAgMFxuICAgICAgICBdKTtcbiAgICAgICAgb3BlcmF0aW9uID0gbmV3IE1vdmVPcGVyYXRpb24ocG9zaXRpb24sIGhvd01hbnksIGdyYXZleWFyZFBvc2l0aW9uLCBkb2MudmVyc2lvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb3BlcmF0aW9uID0gbmV3IERldGFjaE9wZXJhdGlvbihwb3NpdGlvbiwgaG93TWFueSk7XG4gICAgfVxuICAgIGJhdGNoLmFkZE9wZXJhdGlvbihvcGVyYXRpb24pO1xuICAgIG1vZGVsLmFwcGx5T3BlcmF0aW9uKG9wZXJhdGlvbik7XG59XG4vKipcbiAqIFJldHVybnMgYHRydWVgIGlmIGJvdGggcm9vdCBlbGVtZW50cyBhcmUgdGhlIHNhbWUgZWxlbWVudCBvciBib3RoIGFyZSBkb2N1bWVudHMgcm9vdCBlbGVtZW50cy5cbiAqXG4gKiBFbGVtZW50cyBpbiB0aGUgc2FtZSB0cmVlIGNhbiBiZSBtb3ZlZCAoZm9yIGluc3RhbmNlIHlvdSBjYW4gbW92ZSBlbGVtZW50IGZvcm0gb25lIGRvY3VtZW50cyByb290IHRvIGFub3RoZXIsIG9yXG4gKiB3aXRoaW4gdGhlIHNhbWUgZG9jdW1lbnQgZnJhZ21lbnQpLCBidXQgd2hlbiBlbGVtZW50IHN1cHBvc2VkIHRvIGJlIG1vdmVkIGZyb20gZG9jdW1lbnQgZnJhZ21lbnQgdG8gdGhlIGRvY3VtZW50LCBvclxuICogdG8gYW5vdGhlciBkb2N1bWVudCBpdCBzaG91bGQgYmUgcmVtb3ZlZCBhbmQgaW5zZXJ0ZWQgdG8gYXZvaWQgcHJvYmxlbXMgd2l0aCBPVC4gVGhpcyBpcyBiZWNhdXNlIGZlYXR1cmVzIGxpa2UgdW5kbyBvclxuICogY29sbGFib3JhdGlvbiBtYXkgdHJhY2sgY2hhbmdlcyBvbiB0aGUgZG9jdW1lbnQgYnV0IGlnbm9yZSBjaGFuZ2VzIG9uIGRldGFjaGVkIGZyYWdtZW50cyBhbmQgc2hvdWxkIG5vdCBnZXRcbiAqIHVuZXhwZWN0ZWQgYG1vdmVgIG9wZXJhdGlvbi5cbiAqLyBmdW5jdGlvbiBpc1NhbWVUcmVlKHJvb3RBLCByb290Qikge1xuICAgIC8vIElmIGl0IGlzIHRoZSBzYW1lIHJvb3QgdGhpcyBpcyB0aGUgc2FtZSB0cmVlLlxuICAgIGlmIChyb290QSA9PT0gcm9vdEIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8vIElmIGJvdGggcm9vdHMgYXJlIGRvY3VtZW50cyByb290IGl0IGlzIG9wZXJhdGlvbiB3aXRoaW4gdGhlIGRvY3VtZW50IHdoYXQgd2Ugc3RpbGwgdHJlYXQgYXMgdGhlIHNhbWUgdHJlZS5cbiAgICBpZiAocm9vdEEgaW5zdGFuY2VvZiBSb290RWxlbWVudCAmJiByb290QiBpbnN0YW5jZW9mIFJvb3RFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8qKlxuICogRGVsZXRlcyBjb250ZW50IG9mIHRoZSBzZWxlY3Rpb24gYW5kIG1lcmdlIHNpYmxpbmdzLiBUaGUgcmVzdWx0aW5nIHNlbGVjdGlvbiBpcyBhbHdheXMgY29sbGFwc2VkLlxuICpcbiAqICoqTm90ZToqKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZGVsZXRlQ29udGVudH0gaW5zdGVhZCBvZiB0aGlzIGZ1bmN0aW9uLlxuICogVGhpcyBmdW5jdGlvbiBpcyBvbmx5IGV4cG9zZWQgdG8gYmUgcmV1c2FibGUgaW4gYWxnb3JpdGhtc1xuICogd2hpY2ggY2hhbmdlIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNkZWxldGVDb250ZW50fVxuICogbWV0aG9kJ3MgYmVoYXZpb3IuXG4gKlxuICogQHBhcmFtIG1vZGVsIFRoZSBtb2RlbCBpbiBjb250ZXh0IG9mIHdoaWNoIHRoZSBpbnNlcnRpb24gc2hvdWxkIGJlIHBlcmZvcm1lZC5cbiAqIEBwYXJhbSBzZWxlY3Rpb24gU2VsZWN0aW9uIG9mIHdoaWNoIHRoZSBjb250ZW50IHNob3VsZCBiZSBkZWxldGVkLlxuICogQHBhcmFtIG9wdGlvbnMubGVhdmVVbm1lcmdlZCBXaGV0aGVyIHRvIG1lcmdlIGVsZW1lbnRzIGFmdGVyIHJlbW92aW5nIHRoZSBjb250ZW50IG9mIHRoZSBzZWxlY3Rpb24uXG4gKlxuICogRm9yIGV4YW1wbGUgYDxoZWFkaW5nPnhbeDwvaGVhZGluZz48cGFyYWdyYXBoPnldeTwvcGFyYWdyYXBoPmAgd2lsbCBiZWNvbWU6XG4gKlxuICogKiBgPGhlYWRpbmc+eF55PC9oZWFkaW5nPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgbGVhdmVVbm1lcmdlZCA9PSBmYWxzZWApXG4gKiAqIGA8aGVhZGluZz54XjwvaGVhZGluZz48cGFyYWdyYXBoPnk8L3BhcmFncmFwaD5gIHdpdGggZW5hYmxlZCAoYGxlYXZlVW5tZXJnZWQgPT0gdHJ1ZWApLlxuICpcbiAqIE5vdGU6IHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNPYmplY3Qgb2JqZWN0fSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2NoZW1hflNjaGVtYSNpc0xpbWl0IGxpbWl0fVxuICogZWxlbWVudHMgd2lsbCBub3QgYmUgbWVyZ2VkLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zLmRvTm90UmVzZXRFbnRpcmVDb250ZW50IFdoZXRoZXIgdG8gc2tpcCByZXBsYWNpbmcgdGhlIGVudGlyZSBjb250ZW50IHdpdGggYVxuICogcGFyYWdyYXBoIHdoZW4gdGhlIGVudGlyZSBjb250ZW50IHdhcyBzZWxlY3RlZC5cbiAqXG4gKiBGb3IgZXhhbXBsZSBgPGhlYWRpbmc+W3g8L2hlYWRpbmc+PHBhcmFncmFwaD55XTwvcGFyYWdyYXBoPmAgd2lsbCBiZWNvbWU6XG4gKlxuICogKiBgPHBhcmFncmFwaD5ePC9wYXJhZ3JhcGg+YCB3aXRoIHRoZSBvcHRpb24gZGlzYWJsZWQgKGBkb05vdFJlc2V0RW50aXJlQ29udGVudCA9PSBmYWxzZWApXG4gKiAqIGA8aGVhZGluZz5ePC9oZWFkaW5nPmAgd2l0aCBlbmFibGVkIChgZG9Ob3RSZXNldEVudGlyZUNvbnRlbnQgPT0gdHJ1ZWApLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zLmRvTm90QXV0b3BhcmFncmFwaCBXaGV0aGVyIHRvIGNyZWF0ZSBhIHBhcmFncmFwaCBpZiBhZnRlciBjb250ZW50IGRlbGV0aW9uIHNlbGVjdGlvbiBpcyBtb3ZlZFxuICogdG8gYSBwbGFjZSB3aGVyZSB0ZXh0IGNhbm5vdCBiZSBpbnNlcnRlZC5cbiAqXG4gKiBGb3IgZXhhbXBsZSBgPHBhcmFncmFwaD54PC9wYXJhZ3JhcGg+WzxpbWFnZUJsb2NrIHNyYz1cImZvby5qcGdcIj48L2ltYWdlQmxvY2s+XWAgd2lsbCBiZWNvbWU6XG4gKlxuICogKiBgPHBhcmFncmFwaD54PC9wYXJhZ3JhcGg+PHBhcmFncmFwaD5bXTwvcGFyYWdyYXBoPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgZG9Ob3RBdXRvcGFyYWdyYXBoID09IGZhbHNlYClcbiAqICogYDxwYXJhZ3JhcGg+eDwvcGFyYWdyYXBoPltdYCB3aXRoIHRoZSBvcHRpb24gZW5hYmxlZCAoYGRvTm90QXV0b3BhcmFncmFwaCA9PSB0cnVlYCkuXG4gKlxuICogSWYgeW91IHVzZSB0aGlzIG9wdGlvbiB5b3UgbmVlZCB0byBtYWtlIHN1cmUgdG8gaGFuZGxlIGludmFsaWQgc2VsZWN0aW9ucyB5b3Vyc2VsZiBvciBsZWF2ZVxuICogdGhlbSB0byB0aGUgc2VsZWN0aW9uIHBvc3QtZml4ZXIgKG1heSBub3QgYWx3YXlzIHdvcmspLlxuICpcbiAqICoqTm90ZToqKiBJZiB0aGVyZSBpcyBubyB2YWxpZCBwb3NpdGlvbiBmb3IgdGhlIHNlbGVjdGlvbiwgdGhlIHBhcmFncmFwaCB3aWxsIGFsd2F5cyBiZSBjcmVhdGVkOlxuICpcbiAqIGBbPGltYWdlQmxvY2sgc3JjPVwiZm9vLmpwZ1wiPjwvaW1hZ2VCbG9jaz5dYCAtPiBgPHBhcmFncmFwaD5bXTwvcGFyYWdyYXBoPmAuXG4gKi8gZnVuY3Rpb24gZGVsZXRlQ29udGVudChtb2RlbCwgc2VsZWN0aW9uLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2VsUmFuZ2UgPSBzZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpO1xuICAgIC8vIElmIHRoZSBzZWxlY3Rpb24gaXMgYWxyZWFkeSByZW1vdmVkLCBkb24ndCBkbyBhbnl0aGluZy5cbiAgICBpZiAoc2VsUmFuZ2Uucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBzY2hlbWEgPSBtb2RlbC5zY2hlbWE7XG4gICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgIC8vIDEuIFJlcGxhY2UgdGhlIGVudGlyZSBjb250ZW50IHdpdGggcGFyYWdyYXBoLlxuICAgICAgICAvLyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2lzc3Vlcy8xMDEyI2lzc3VlY29tbWVudC0zMTUwMTc1OTQuXG4gICAgICAgIGlmICghb3B0aW9ucy5kb05vdFJlc2V0RW50aXJlQ29udGVudCAmJiBzaG91bGRFbnRpcmVDb250ZW50QmVSZXBsYWNlZFdpdGhQYXJhZ3JhcGgoc2NoZW1hLCBzZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICByZXBsYWNlRW50aXJlQ29udGVudFdpdGhQYXJhZ3JhcGgod3JpdGVyLCBzZWxlY3Rpb24pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIENvbGxlY3QgYXR0cmlidXRlcyB0byBjb3B5IGluIGNhc2Ugb2YgYXV0b3BhcmFncmFwaGluZy5cbiAgICAgICAgY29uc3QgYXR0cmlidXRlc0ZvckF1dG9wYXJhZ3JhcGggPSB7fTtcbiAgICAgICAgaWYgKCFvcHRpb25zLmRvTm90QXV0b3BhcmFncmFwaCkge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oYXR0cmlidXRlc0ZvckF1dG9wYXJhZ3JhcGgsIHNjaGVtYS5nZXRBdHRyaWJ1dGVzV2l0aFByb3BlcnR5KHNlbGVjdGVkRWxlbWVudCwgJ2NvcHlPblJlcGxhY2UnLCB0cnVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gR2V0IHRoZSBsaXZlIHBvc2l0aW9ucyBmb3IgdGhlIHJhbmdlIGFkanVzdGVkIHRvIHNwYW4gb25seSBibG9ja3Mgc2VsZWN0ZWQgZnJvbSB0aGUgdXNlciBwZXJzcGVjdGl2ZS5cbiAgICAgICAgY29uc3QgW3N0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uXSA9IGdldExpdmVQb3NpdGlvbnNGb3JTZWxlY3RlZEJsb2NrcyhzZWxSYW5nZSk7XG4gICAgICAgIC8vIDIuIFJlbW92ZSB0aGUgY29udGVudCBpZiB0aGVyZSBpcyBhbnkuXG4gICAgICAgIGlmICghc3RhcnRQb3NpdGlvbi5pc1RvdWNoaW5nKGVuZFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgd3JpdGVyLnJlbW92ZSh3cml0ZXIuY3JlYXRlUmFuZ2Uoc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAzLiBNZXJnZSBlbGVtZW50cyBpbiB0aGUgcmlnaHQgYnJhbmNoIHRvIHRoZSBlbGVtZW50cyBpbiB0aGUgbGVmdCBicmFuY2guXG4gICAgICAgIC8vIFRoZSBvbmx5IHJlYXNvbmFibGUgKGluIHRlcm1zIG9mIGRhdGEgYW5kIHNlbGVjdGlvbiBjb3JyZWN0bmVzcykgY2FzZSBpbiB3aGljaCB3ZSBuZWVkIHRvIGRvIHRoYXQgaXM6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxoZWFkaW5nIHR5cGU9MT5Gb1s8L2hlYWRpbmc+PHBhcmFncmFwaD5dYXI8L3BhcmFncmFwaD4gPT4gPGhlYWRpbmcgdHlwZT0xPkZvXmFyPC9oZWFkaW5nPlxuICAgICAgICAvL1xuICAgICAgICAvLyBIb3dldmVyLCB0aGUgYWxnb3JpdGhtIHN1cHBvcnRzIGFsc28gbWVyZ2luZyBkZWVwZXIgc3RydWN0dXJlcyAodXAgdG8gdGhlIGRlcHRoIG9mIHRoZSBzaGFsbG93ZXIgYnJhbmNoKSxcbiAgICAgICAgLy8gYXMgaXQncyBoYXJkIHRvIGltYWdpbmUgd2hhdCBzaG91bGQgYWN0dWFsbHkgYmUgdGhlIGRlZmF1bHQgYmVoYXZpb3IuIFVzdWFsbHksIHNwZWNpZmljIGZlYXR1cmVzIHdpbGxcbiAgICAgICAgLy8gd2FudCB0byBvdmVycmlkZSB0aGF0IGJlaGF2aW9yIGFueXdheS5cbiAgICAgICAgaWYgKCFvcHRpb25zLmxlYXZlVW5tZXJnZWQpIHtcbiAgICAgICAgICAgIG1lcmdlQnJhbmNoZXMod3JpdGVyLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbik7XG4gICAgICAgICAgICAvLyBUTVAgdGhpcyB3aWxsIGJlIHJlcGxhY2VkIHdpdGggYSBwb3N0Zml4ZXIuXG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGFuZCBzdHJpcCBkaXNhbGxvd2VkIGF0dHJpYnV0ZXMgaW4gYWxsIG5lc3RlZCBub2RlcyBiZWNhdXNlIGFmdGVyIG1lcmdlXG4gICAgICAgICAgICAvLyBzb21lIGF0dHJpYnV0ZXMgY291bGQgZW5kIHVwIGluIGEgcGF0aCB3aGVyZSBhcmUgZGlzYWxsb3dlZC5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBlLmcuIGJvbGQgaXMgZGlzYWxsb3dlZCBmb3IgPEgxPlxuICAgICAgICAgICAgLy8gPGgxPkZve288L2gxPjxwPmJ9YTxiPnI8L2I+PHA+IC0+IDxoMT5Gb3t9YTxiPnI8L2I+PGgxPiAtPiA8aDE+Rm97fWFyPGgxPi5cbiAgICAgICAgICAgIHNjaGVtYS5yZW1vdmVEaXNhbGxvd2VkQXR0cmlidXRlcyhzdGFydFBvc2l0aW9uLnBhcmVudC5nZXRDaGlsZHJlbigpLCB3cml0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbGxhcHNlU2VsZWN0aW9uQXQod3JpdGVyLCBzZWxlY3Rpb24sIHN0YXJ0UG9zaXRpb24pO1xuICAgICAgICAvLyA0LiBBZGQgYSBwYXJhZ3JhcGggdG8gc2V0IHNlbGVjdGlvbiBpbiBpdC5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYSB0ZXh0IGlzIGFsbG93ZWQgaW4gdGhlIG5ldyBjb250YWluZXIuIElmIG5vdCwgdHJ5IHRvIGNyZWF0ZSBhIG5ldyBwYXJhZ3JhcGggKGlmIGl0J3MgYWxsb3dlZCBoZXJlKS5cbiAgICAgICAgLy8gSWYgYXV0b3BhcmFncmFwaGluZyBpcyBvZmYsIHdlIGFzc3VtZSB0aGF0IHlvdSBrbm93IHdoYXQgeW91IGRvIHNvIHdlIGxlYXZlIHRoZSBzZWxlY3Rpb24gd2hlcmV2ZXIgaXQgd2FzLlxuICAgICAgICBpZiAoIW9wdGlvbnMuZG9Ob3RBdXRvcGFyYWdyYXBoICYmIHNob3VsZEF1dG9wYXJhZ3JhcGgoc2NoZW1hLCBzdGFydFBvc2l0aW9uKSkge1xuICAgICAgICAgICAgaW5zZXJ0UGFyYWdyYXBoKHdyaXRlciwgc3RhcnRQb3NpdGlvbiwgc2VsZWN0aW9uLCBhdHRyaWJ1dGVzRm9yQXV0b3BhcmFncmFwaCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnRQb3NpdGlvbi5kZXRhY2goKTtcbiAgICAgICAgZW5kUG9zaXRpb24uZGV0YWNoKCk7XG4gICAgfSk7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGxpdmUgcG9zaXRpb25zIGZvciB0aGUgcmFuZ2UgYWRqdXN0ZWQgdG8gc3BhbiBvbmx5IGJsb2NrcyBzZWxlY3RlZCBmcm9tIHRoZSB1c2VyIHBlcnNwZWN0aXZlLiBFeGFtcGxlOlxuICpcbiAqIGBgYFxuICogPGhlYWRpbmcxPltmb288L2hlYWRpbmcxPlxuICogPHBhcmFncmFwaD5iYXI8L3BhcmFncmFwaD5cbiAqIDxoZWFkaW5nMT5dYWJjPC9oZWFkaW5nMT4gIDwtLSB0aGlzIGJsb2NrIGlzIG5vdCBjb25zaWRlcmVkIGFzIHNlbGVjdGVkXG4gKiBgYGBcbiAqXG4gKiBUaGlzIGlzIHRoZSBzYW1lIGJlaGF2aW9yIGFzIGluIFNlbGVjdGlvbiNnZXRTZWxlY3RlZEJsb2NrcygpIFwic3BlY2lhbCBjYXNlXCIuXG4gKi8gZnVuY3Rpb24gZ2V0TGl2ZVBvc2l0aW9uc0ZvclNlbGVjdGVkQmxvY2tzKHJhbmdlKSB7XG4gICAgY29uc3QgbW9kZWwgPSByYW5nZS5yb290LmRvY3VtZW50Lm1vZGVsO1xuICAgIGNvbnN0IHN0YXJ0UG9zaXRpb24gPSByYW5nZS5zdGFydDtcbiAgICBsZXQgZW5kUG9zaXRpb24gPSByYW5nZS5lbmQ7XG4gICAgLy8gSWYgdGhlIGVuZCBvZiBzZWxlY3Rpb24gaXMgYXQgdGhlIHN0YXJ0IHBvc2l0aW9uIG9mIGxhc3QgYmxvY2sgaW4gdGhlIHNlbGVjdGlvbiwgdGhlblxuICAgIC8vIHNocmluayBpdCB0byBub3QgaW5jbHVkZSB0aGF0IHRyYWlsaW5nIGJsb2NrLiBOb3RlIHRoYXQgdGhpcyBzaG91bGQgaGFwcGVuIG9ubHkgZm9yIG5vdCBlbXB0eSBzZWxlY3Rpb24uXG4gICAgaWYgKG1vZGVsLmhhc0NvbnRlbnQocmFuZ2UsIHtcbiAgICAgICAgaWdub3JlTWFya2VyczogdHJ1ZVxuICAgIH0pKSB7XG4gICAgICAgIGNvbnN0IGVuZEJsb2NrID0gZ2V0UGFyZW50QmxvY2soZW5kUG9zaXRpb24pO1xuICAgICAgICBpZiAoZW5kQmxvY2sgJiYgZW5kUG9zaXRpb24uaXNUb3VjaGluZyhtb2RlbC5jcmVhdGVQb3NpdGlvbkF0KGVuZEJsb2NrLCAwKSkpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBmb3J3YXJkIHNlbGVjdGlvbiBhcyBhIHByb2JlIHRvIGZpbmQgYSB2YWxpZCBwb3NpdGlvbiBhZnRlciBleGNsdWRpbmcgbGFzdCBibG9jayBmcm9tIHRoZSByYW5nZS5cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmNyZWF0ZVNlbGVjdGlvbihyYW5nZSk7XG4gICAgICAgICAgICAvLyBNb2RpZnkgdGhlIGZvcndhcmQgc2VsZWN0aW9uIGluIGJhY2t3YXJkIGRpcmVjdGlvbiB0byBzaHJpbmsgaXQgYW5kIHJlbW92ZSBmaXJzdCBwb3NpdGlvbiBvZiBmb2xsb3dpbmcgYmxvY2sgZnJvbSBpdC5cbiAgICAgICAgICAgIC8vIFRoaXMgaXMgaG93IG1vZGlmeVNlbGVjdGlvbiB3b3JrcyBhbmQgaGVyZSB3ZSBhcmUgbWFraW5nIHVzZSBvZiBpdC5cbiAgICAgICAgICAgIG1vZGVsLm1vZGlmeVNlbGVjdGlvbihzZWxlY3Rpb24sIHtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdiYWNrd2FyZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgbmV3RW5kUG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0TGFzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAvLyBGb3Igc3VjaCBhIG1vZGVsIGFuZCBzZWxlY3Rpb246XG4gICAgICAgICAgICAvLyAgICAgPHBhcmFncmFwaD5BWzwvcGFyYWdyYXBoPjxpbWFnZUJsb2NrPjwvaW1hZ2VCbG9jaz48cGFyYWdyYXBoPl1CPC9wYXJhZ3JhcGg+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gQWZ0ZXIgbW9kaWZ5U2VsZWN0aW9uKCksIHdlIHdvdWxkIGVuZCB1cCB3aXRoIHRoaXM6XG4gICAgICAgICAgICAvLyAgICAgPHBhcmFncmFwaD5BWzwvcGFyYWdyYXBoPl08aW1hZ2VCbG9jaz48L2ltYWdlQmxvY2s+PHBhcmFncmFwaD5CPC9wYXJhZ3JhcGg+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gU28gd2UgbmVlZCB0byBjaGVjayBpZiB0aGVyZSBpcyBubyBjb250ZW50IGluIHRoZSBza2lwcGVkIHJhbmdlIChiZWNhdXNlIHdlIHdhbnQgdG8gaW5jbHVkZSB0aGUgPGltYWdlQmxvY2s+KS5cbiAgICAgICAgICAgIGNvbnN0IHNraXBwZWRSYW5nZSA9IG1vZGVsLmNyZWF0ZVJhbmdlKG5ld0VuZFBvc2l0aW9uLCBlbmRQb3NpdGlvbik7XG4gICAgICAgICAgICBpZiAoIW1vZGVsLmhhc0NvbnRlbnQoc2tpcHBlZFJhbmdlLCB7XG4gICAgICAgICAgICAgICAgaWdub3JlTWFya2VyczogdHJ1ZVxuICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICBlbmRQb3NpdGlvbiA9IG5ld0VuZFBvc2l0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICAgIExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24oc3RhcnRQb3NpdGlvbiwgJ3RvUHJldmlvdXMnKSxcbiAgICAgICAgTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbihlbmRQb3NpdGlvbiwgJ3RvTmV4dCcpXG4gICAgXTtcbn1cbi8qKlxuICogRmluZHMgdGhlIGxvd2VzdCBlbGVtZW50IGluIHBvc2l0aW9uJ3MgYW5jZXN0b3JzIHdoaWNoIGlzIGEgYmxvY2suXG4gKiBSZXR1cm5zIG51bGwgaWYgYSBsaW1pdCBlbGVtZW50IGlzIGVuY291bnRlcmVkIGJlZm9yZSByZWFjaGluZyBhIGJsb2NrIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gZ2V0UGFyZW50QmxvY2socG9zaXRpb24pIHtcbiAgICBjb25zdCBlbGVtZW50ID0gcG9zaXRpb24ucGFyZW50O1xuICAgIGNvbnN0IHNjaGVtYSA9IGVsZW1lbnQucm9vdC5kb2N1bWVudC5tb2RlbC5zY2hlbWE7XG4gICAgY29uc3QgYW5jZXN0b3JzID0gZWxlbWVudC5nZXRBbmNlc3RvcnMoe1xuICAgICAgICBwYXJlbnRGaXJzdDogdHJ1ZSxcbiAgICAgICAgaW5jbHVkZVNlbGY6IHRydWVcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYW5jZXN0b3JzKXtcbiAgICAgICAgaWYgKHNjaGVtYS5pc0xpbWl0KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NoZW1hLmlzQmxvY2soZWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGEgcmVzdWx0IG9mIHJlYWNoaW5nIHRoZSBCYWxsbWVyJ3MgcGVhayBmb3IganVzdCB0aGUgcmlnaHQgYW1vdW50IG9mIHRpbWUuXG4gKiBFdmVuIEkgaGFkIHRyb3VibGVzIGRvY3VtZW50aW5nIGl0IGFmdGVyIGEgd2hpbGUgYW5kIGFmdGVyIHJlYWRpbmcgaXQgYWdhaW4gSSBjb3VsZG4ndCBiZWxpZXZlIHRoYXQgaXQgcmVhbGx5IHdvcmtzLlxuICovIGZ1bmN0aW9uIG1lcmdlQnJhbmNoZXMod3JpdGVyLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbikge1xuICAgIGNvbnN0IG1vZGVsID0gd3JpdGVyLm1vZGVsO1xuICAgIC8vIFZlcmlmeSBpZiB0aGVyZSBpcyBhIG5lZWQgYW5kIHBvc3NpYmlsaXR5IHRvIG1lcmdlLlxuICAgIGlmICghY2hlY2tTaG91bGRNZXJnZSh3cml0ZXIubW9kZWwuc2NoZW1hLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBJZiB0aGUgc3RhcnQgZWxlbWVudCBvbiB0aGUgY29tbW9uIGFuY2VzdG9yIGxldmVsIGlzIGVtcHR5LCBhbmQgdGhlIGVuZCBlbGVtZW50IG9uIHRoZSBzYW1lIGxldmVsIGlzIG5vdCBlbXB0eVxuICAgIC8vIHRoZW4gbWVyZ2UgdGhvc2UgdG8gdGhlIHJpZ2h0IGVsZW1lbnQgc28gdGhhdCBpdCdzIHByb3BlcnRpZXMgYXJlIHByZXNlcnZlZCAobmFtZSwgYXR0cmlidXRlcykuXG4gICAgLy8gQmVjYXVzZSBvZiBPVCBtZXJnaW5nIGlzIHVzZWQgaW5zdGVhZCBvZiByZW1vdmluZyBlbGVtZW50cy5cbiAgICAvL1xuICAgIC8vIE1lcmdlIGxlZnQ6XG4gICAgLy8gICAgIDxoZWFkaW5nMT5mb29bPC9oZWFkaW5nMT4gICAgLT4gIDxoZWFkaW5nMT5mb29bXWJhcjwvaGVhZGluZzE+XG4gICAgLy8gICAgIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICAgICAgICAgICAtLV5cbiAgICAvL1xuICAgIC8vIE1lcmdlIHJpZ2h0OlxuICAgIC8vICAgICA8aGVhZGluZzE+WzwvaGVhZGluZzE+ICAgICAgIC0+XG4gICAgLy8gICAgIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gIDxwYXJhZ3JhcGg+W11iYXI8L3BhcmFncmFwaD5cbiAgICAvL1xuICAgIC8vIE1lcmdlIGxlZnQ6XG4gICAgLy8gICAgIDxibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgIC0+ICA8YmxvY2tRdW90ZT5cbiAgICAvLyAgICAgICAgIDxoZWFkaW5nMT5mb29bPC9oZWFkaW5nMT4gICAgLT4gICAgICA8aGVhZGluZzE+Zm9vW11iYXI8L2hlYWRpbmcxPlxuICAgIC8vICAgICAgICAgPHBhcmFncmFwaD5dYmFyPC9wYXJhZ3JhcGg+ICAtPiAgICAgICAgICAgICAgICAgICAtLV5cbiAgICAvLyAgICAgPC9ibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgLT4gIDwvYmxvY2tRdW90ZT5cbiAgICAvL1xuICAgIC8vIE1lcmdlIHJpZ2h0OlxuICAgIC8vICAgICA8YmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrUXVvdGU+XG4gICAgLy8gICAgICAgICA8aGVhZGluZzE+WzwvaGVhZGluZzE+ICAgICAgIC0+XG4gICAgLy8gICAgICAgICA8cGFyYWdyYXBoPl1iYXI8L3BhcmFncmFwaD4gIC0+ICAgICAgPHBhcmFncmFwaD5bXWJhcjwvcGFyYWdyYXBoPlxuICAgIC8vICAgICA8L2Jsb2NrUXVvdGU+ICAgICAgICAgICAgICAgICAgICAtPiAgPC9ibG9ja1F1b3RlPlxuICAgIC8vIE1lcmdpbmcgc2hvdWxkIG5vdCBnbyBkZWVwZXIgdGhhbiBjb21tb24gYW5jZXN0b3IuXG4gICAgY29uc3QgW3N0YXJ0QW5jZXN0b3IsIGVuZEFuY2VzdG9yXSA9IGdldEFuY2VzdG9yc0p1c3RCZWxvd0NvbW1vbkFuY2VzdG9yKHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uKTtcbiAgICAvLyBCcmFuY2hlcyBjYW4ndCBiZSBtZXJnZWQgaWYgb25lIG9mIHRoZSBwb3NpdGlvbnMgaXMgZGlyZWN0bHkgaW5zaWRlIGEgY29tbW9uIGFuY2VzdG9yLlxuICAgIC8vXG4gICAgLy8gRXhhbXBsZTpcbiAgICAvLyAgICAgPGJsb2NrUXVvdGU+XG4gICAgLy8gICAgICAgICA8cGFyYWdyYXBoPltmb288L3BhcmFncmFwaD5dXG4gICAgLy8gICAgICAgICA8dGFibGU+IC4uLiA8L3RhYmxlPlxuICAgIC8vICAgICA8YmxvY2tRdW90ZT5cbiAgICAvL1xuICAgIGlmICghc3RhcnRBbmNlc3RvciB8fCAhZW5kQW5jZXN0b3IpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIW1vZGVsLmhhc0NvbnRlbnQoc3RhcnRBbmNlc3Rvciwge1xuICAgICAgICBpZ25vcmVNYXJrZXJzOiB0cnVlXG4gICAgfSkgJiYgbW9kZWwuaGFzQ29udGVudChlbmRBbmNlc3Rvciwge1xuICAgICAgICBpZ25vcmVNYXJrZXJzOiB0cnVlXG4gICAgfSkpIHtcbiAgICAgICAgbWVyZ2VCcmFuY2hlc1JpZ2h0KHdyaXRlciwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24sIHN0YXJ0QW5jZXN0b3IucGFyZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBtZXJnZUJyYW5jaGVzTGVmdCh3cml0ZXIsIHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uLCBzdGFydEFuY2VzdG9yLnBhcmVudCk7XG4gICAgfVxufVxuLyoqXG4gKiBNZXJnaW5nIGJsb2NrcyB0byB0aGUgbGVmdCAocHJvcGVydGllcyBvZiB0aGUgbGVmdCBibG9jayBhcmUgcHJlc2VydmVkKS5cbiAqIFNpbXBsZSBleGFtcGxlOlxuICpcbiAqIGBgYFxuICogPGhlYWRpbmcxPmZvb1s8L2hlYWRpbmcxPiAgICAtPiAgPGhlYWRpbmcxPmZvb1tiYXI8L2hlYWRpbmcxPl1cbiAqIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICAgICAgICAgIC0tXlxuICogYGBgXG4gKlxuICogTmVzdGVkIGV4YW1wbGU6XG4gKlxuICogYGBgXG4gKiA8YmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrUXVvdGU+XG4gKiAgICAgPGhlYWRpbmcxPmZvb1s8L2hlYWRpbmcxPiAgICAtPiAgICAgIDxoZWFkaW5nMT5mb29bYmFyPC9oZWFkaW5nMT5cbiAqIDwvYmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrUXVvdGU+XSAgICBeXG4gKiA8YmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAtPiAgICAgICAgICAgICAgICAgICAgfFxuICogICAgIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICAgICAgICAgICAgIC0tLVxuICogPC9ibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgLT5cbiAqIGBgYFxuICovIGZ1bmN0aW9uIG1lcmdlQnJhbmNoZXNMZWZ0KHdyaXRlciwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24sIGNvbW1vbkFuY2VzdG9yKSB7XG4gICAgY29uc3Qgc3RhcnRFbGVtZW50ID0gc3RhcnRQb3NpdGlvbi5wYXJlbnQ7XG4gICAgY29uc3QgZW5kRWxlbWVudCA9IGVuZFBvc2l0aW9uLnBhcmVudDtcbiAgICAvLyBNZXJnaW5nIHJlYWNoZWQgdGhlIGNvbW1vbiBhbmNlc3RvciBlbGVtZW50LCBzdG9wIGhlcmUuXG4gICAgaWYgKHN0YXJ0RWxlbWVudCA9PSBjb21tb25BbmNlc3RvciB8fCBlbmRFbGVtZW50ID09IGNvbW1vbkFuY2VzdG9yKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gUmVtZW1iZXIgbmV4dCBwb3NpdGlvbnMgdG8gbWVyZ2UgaW4gbmV4dCByZWN1cnNpdmUgc3RlcCAoYWxzbyB1c2VkIGFzIG1vZGlmaWNhdGlvbiBwb2ludHMgcG9pbnRlcnMpLlxuICAgIHN0YXJ0UG9zaXRpb24gPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihzdGFydEVsZW1lbnQpO1xuICAgIGVuZFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKGVuZEVsZW1lbnQpO1xuICAgIC8vIE1vdmUgZW5kRWxlbWVudCBqdXN0IGFmdGVyIHN0YXJ0RWxlbWVudCBpZiB0aGV5IGFyZW4ndCBzaWJsaW5ncy5cbiAgICBpZiAoIWVuZFBvc2l0aW9uLmlzRXF1YWwoc3RhcnRQb3NpdGlvbikpIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgIDxibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgIC0+ICA8YmxvY2tRdW90ZT5cbiAgICAgICAgLy8gICAgICAgICA8aGVhZGluZzE+Zm9vWzwvaGVhZGluZzE+ICAgIC0+ICAgICAgPGhlYWRpbmcxPmZvbzwvaGVhZGluZzE+WzxwYXJhZ3JhcGg+YmFyPC9wYXJhZ3JhcGg+XG4gICAgICAgIC8vICAgICA8L2Jsb2NrUXVvdGU+ICAgICAgICAgICAgICAgICAgICAtPiAgPC9ibG9ja1F1b3RlPiAgICAgICAgICAgICAgICBeXG4gICAgICAgIC8vICAgICA8YmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrQmxvY2s+ICAgICAgICAgICAgICAgICB8XG4gICAgICAgIC8vICAgICAgICAgPHBhcmFncmFwaD5dYmFyPC9wYXJhZ3JhcGg+ICAtPiAgICAgIF0gICAgICAgICAgICAgICAgICAgICAtLS1cbiAgICAgICAgLy8gICAgIDwvYmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrQmxvY2s+XG4gICAgICAgIC8vXG4gICAgICAgIHdyaXRlci5pbnNlcnQoZW5kRWxlbWVudCwgc3RhcnRQb3NpdGlvbik7XG4gICAgfVxuICAgIC8vIE1lcmdlIHR3byBzaWJsaW5ncyAobm9kZXMgb24gc2lkZXMgb2Ygc3RhcnRQb3NpdGlvbik6XG4gICAgLy9cbiAgICAvLyAgICAgPGJsb2NrUXVvdGU+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIDxibG9ja1F1b3RlPlxuICAgIC8vICAgICAgICAgPGhlYWRpbmcxPmZvbzwvaGVhZGluZzE+WzxwYXJhZ3JhcGg+YmFyPC9wYXJhZ3JhcGg+ICAtPiAgICAgIDxoZWFkaW5nMT5mb29bYmFyPC9oZWFkaW5nMT5cbiAgICAvLyAgICAgPC9ibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIDwvYmxvY2tRdW90ZT5cbiAgICAvLyAgICAgPGJsb2NrQmxvY2s+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIDxibG9ja0Jsb2NrPlxuICAgIC8vICAgICAgICAgXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPiAgICAgIF1cbiAgICAvLyAgICAgPC9ibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIDwvYmxvY2tCbG9jaz5cbiAgICAvL1xuICAgIC8vIE9yIGluIHNpbXBsZSBjYXNlICh3aXRob3V0IG1vdmluZyBlbGVtZW50cyBpbiBhYm92ZSBpZik6XG4gICAgLy8gICAgIDxoZWFkaW5nMT5mb288L2hlYWRpbmcxPls8cGFyYWdyYXBoPmJhcjwvcGFyYWdyYXBoPl0gIC0+ICA8aGVhZGluZzE+Zm9vW2JhcjwvaGVhZGluZzE+XVxuICAgIC8vXG4gICAgd3JpdGVyLm1lcmdlKHN0YXJ0UG9zaXRpb24pO1xuICAgIC8vIFJlbW92ZSBlbXB0eSBlbmQgYW5jZXN0b3JzOlxuICAgIC8vXG4gICAgLy8gICAgIDxibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrUXVvdGU+XG4gICAgLy8gICAgICAgICA8aGVhZGluZzE+Zm9vW2JhcjwvaGVhZGluZzE+ICAtPiAgICAgIDxoZWFkaW5nMT5mb29bYmFyPC9oZWFkaW5nMT5cbiAgICAvLyAgICAgPC9ibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrUXVvdGU+XG4gICAgLy8gICAgIDxibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgICAtPlxuICAgIC8vICAgICAgICAgXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIF1cbiAgICAvLyAgICAgPC9ibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgIC0+XG4gICAgLy9cbiAgICB3aGlsZShlbmRQb3NpdGlvbi5wYXJlbnQuaXNFbXB0eSl7XG4gICAgICAgIGNvbnN0IHBhcmVudFRvUmVtb3ZlID0gZW5kUG9zaXRpb24ucGFyZW50O1xuICAgICAgICBlbmRQb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZShwYXJlbnRUb1JlbW92ZSk7XG4gICAgICAgIHdyaXRlci5yZW1vdmUocGFyZW50VG9SZW1vdmUpO1xuICAgIH1cbiAgICAvLyBWZXJpZnkgaWYgdGhlcmUgaXMgYSBuZWVkIGFuZCBwb3NzaWJpbGl0eSB0byBtZXJnZSBuZXh0IGxldmVsLlxuICAgIGlmICghY2hlY2tTaG91bGRNZXJnZSh3cml0ZXIubW9kZWwuc2NoZW1hLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBDb250aW51ZSBtZXJnaW5nIG5leHQgbGV2ZWwgKGJsb2NrUXVvdGUgd2l0aCBibG9ja0Jsb2NrIGluIHRoZSBleGFtcGxlcyBhYm92ZSBpZiBpdCB3b3VsZCBub3QgYmUgZW1wdHkgYW5kIGdvdCByZW1vdmVkKS5cbiAgICBtZXJnZUJyYW5jaGVzTGVmdCh3cml0ZXIsIHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uLCBjb21tb25BbmNlc3Rvcik7XG59XG4vKipcbiAqIE1lcmdpbmcgYmxvY2tzIHRvIHRoZSByaWdodCAocHJvcGVydGllcyBvZiB0aGUgcmlnaHQgYmxvY2sgYXJlIHByZXNlcnZlZCkuXG4gKiBTaW1wbGUgZXhhbXBsZTpcbiAqXG4gKiBgYGBcbiAqIDxoZWFkaW5nMT5mb29bPC9oZWFkaW5nMT4gICAgLT4gICAgICAgICAgICAtLXZcbiAqIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gIFs8cGFyYWdyYXBoPmZvb11iYXI8L3BhcmFncmFwaD5cbiAqIGBgYFxuICpcbiAqIE5lc3RlZCBleGFtcGxlOlxuICpcbiAqIGBgYFxuICogPGJsb2NrUXVvdGU+ICAgICAgICAgICAgICAgICAgICAgLT5cbiAqICAgICA8aGVhZGluZzE+Zm9vWzwvaGVhZGluZzE+ICAgIC0+ICAgICAgICAgICAgICAtLS1cbiAqIDwvYmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgIC0+ICAgICAgICAgICAgICAgICB8XG4gKiA8YmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAtPiAgWzxibG9ja0Jsb2NrPiAgdlxuICogICAgIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICA8cGFyYWdyYXBoPmZvb11iYXI8L3BhcmFncmFwaD5cbiAqIDwvYmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrQmxvY2s+XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBtZXJnZUJyYW5jaGVzUmlnaHQod3JpdGVyLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbiwgY29tbW9uQW5jZXN0b3IpIHtcbiAgICBjb25zdCBzdGFydEVsZW1lbnQgPSBzdGFydFBvc2l0aW9uLnBhcmVudDtcbiAgICBjb25zdCBlbmRFbGVtZW50ID0gZW5kUG9zaXRpb24ucGFyZW50O1xuICAgIC8vIE1lcmdpbmcgcmVhY2hlZCB0aGUgY29tbW9uIGFuY2VzdG9yIGVsZW1lbnQsIHN0b3AgaGVyZS5cbiAgICBpZiAoc3RhcnRFbGVtZW50ID09IGNvbW1vbkFuY2VzdG9yIHx8IGVuZEVsZW1lbnQgPT0gY29tbW9uQW5jZXN0b3IpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBSZW1lbWJlciBuZXh0IHBvc2l0aW9ucyB0byBtZXJnZSBpbiBuZXh0IHJlY3Vyc2l2ZSBzdGVwIChhbHNvIHVzZWQgYXMgbW9kaWZpY2F0aW9uIHBvaW50cyBwb2ludGVycykuXG4gICAgc3RhcnRQb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHN0YXJ0RWxlbWVudCk7XG4gICAgZW5kUG9zaXRpb24gPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUoZW5kRWxlbWVudCk7XG4gICAgLy8gTW92ZSBzdGFydEVsZW1lbnQganVzdCBiZWZvcmUgZW5kRWxlbWVudCBpZiB0aGV5IGFyZW4ndCBzaWJsaW5ncy5cbiAgICBpZiAoIWVuZFBvc2l0aW9uLmlzRXF1YWwoc3RhcnRQb3NpdGlvbikpIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgIDxibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgIC0+ICA8YmxvY2tRdW90ZT5cbiAgICAgICAgLy8gICAgICAgICA8aGVhZGluZzE+Zm9vWzwvaGVhZGluZzE+ICAgIC0+ICAgICAgWyAgICAgICAgICAgICAgICAgICAtLS1cbiAgICAgICAgLy8gICAgIDwvYmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrUXVvdGU+ICAgICAgICAgICAgICB8XG4gICAgICAgIC8vICAgICA8YmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrQmxvY2s+ICAgICAgICAgICAgICAgdlxuICAgICAgICAvLyAgICAgICAgIDxwYXJhZ3JhcGg+XWJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICA8aGVhZGluZzE+Zm9vPC9oZWFkaW5nMT5dPHBhcmFncmFwaD5iYXI8L3BhcmFncmFwaD5cbiAgICAgICAgLy8gICAgIDwvYmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrQmxvY2s+XG4gICAgICAgIC8vXG4gICAgICAgIHdyaXRlci5pbnNlcnQoc3RhcnRFbGVtZW50LCBlbmRQb3NpdGlvbik7XG4gICAgfVxuICAgIC8vIFJlbW92ZSBlbXB0eSBlbmQgYW5jZXN0b3JzOlxuICAgIC8vXG4gICAgLy8gICAgIDxibG9ja1F1b3RlPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+XG4gICAgLy8gICAgICAgICBbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+ICBbXG4gICAgLy8gICAgIDwvYmxvY2tRdW90ZT4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+XG4gICAgLy8gICAgIDxibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+ICA8YmxvY2tCbG9jaz5cbiAgICAvLyAgICAgICAgIDxoZWFkaW5nMT5mb288L2hlYWRpbmcxPl08cGFyYWdyYXBoPmJhcjwvcGFyYWdyYXBoPiAgLT4gICAgICA8aGVhZGluZzE+Zm9vPC9oZWFkaW5nMT5dPHBhcmFncmFwaD5iYXI8L3BhcmFncmFwaD5cbiAgICAvLyAgICAgPC9ibG9ja0Jsb2NrPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT4gIDwvYmxvY2tCbG9jaz5cbiAgICAvL1xuICAgIHdoaWxlKHN0YXJ0UG9zaXRpb24ucGFyZW50LmlzRW1wdHkpe1xuICAgICAgICBjb25zdCBwYXJlbnRUb1JlbW92ZSA9IHN0YXJ0UG9zaXRpb24ucGFyZW50O1xuICAgICAgICBzdGFydFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKHBhcmVudFRvUmVtb3ZlKTtcbiAgICAgICAgd3JpdGVyLnJlbW92ZShwYXJlbnRUb1JlbW92ZSk7XG4gICAgfVxuICAgIC8vIFVwZGF0ZSBlbmRQb3NpdGlvbiBhZnRlciBpbnNlcnRpbmcgYW5kIHJlbW92aW5nIGVsZW1lbnRzLlxuICAgIGVuZFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKGVuZEVsZW1lbnQpO1xuICAgIC8vIE1lcmdlIHJpZ2h0IHR3byBzaWJsaW5ncyAobm9kZXMgb24gc2lkZXMgb2YgZW5kUG9zaXRpb24pOlxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPlxuICAgIC8vICAgICBbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPiAgW1xuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPlxuICAgIC8vICAgICA8YmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPiAgPGJsb2NrQmxvY2s+XG4gICAgLy8gICAgICAgICA8aGVhZGluZzE+Zm9vPC9oZWFkaW5nMT5dPHBhcmFncmFwaD5iYXI8L3BhcmFncmFwaD4gIC0+ICAgICAgPHBhcmFncmFwaD5mb29dYmFyPC9wYXJhZ3JhcGg+XG4gICAgLy8gICAgIDwvYmxvY2tCbG9jaz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+ICA8L2Jsb2NrQmxvY2s+XG4gICAgLy9cbiAgICAvLyBPciBpbiBzaW1wbGUgY2FzZSAod2l0aG91dCBtb3ZpbmcgZWxlbWVudHMgaW4gYWJvdmUgaWYpOlxuICAgIC8vICAgICBbPGhlYWRpbmcxPmZvbzwvaGVhZGluZzE+XTxwYXJhZ3JhcGg+YmFyPC9wYXJhZ3JhcGg+ICAtPiAgWzxoZWFkaW5nMT5mb29dYmFyPC9oZWFkaW5nMT5cbiAgICAvL1xuICAgIG1lcmdlUmlnaHQod3JpdGVyLCBlbmRQb3NpdGlvbik7XG4gICAgLy8gVmVyaWZ5IGlmIHRoZXJlIGlzIGEgbmVlZCBhbmQgcG9zc2liaWxpdHkgdG8gbWVyZ2UgbmV4dCBsZXZlbC5cbiAgICBpZiAoIWNoZWNrU2hvdWxkTWVyZ2Uod3JpdGVyLm1vZGVsLnNjaGVtYSwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gQ29udGludWUgbWVyZ2luZyBuZXh0IGxldmVsIChibG9ja1F1b3RlIHdpdGggYmxvY2tCbG9jayBpbiB0aGUgZXhhbXBsZXMgYWJvdmUgaWYgaXQgd291bGQgbm90IGJlIGVtcHR5IGFuZCBnb3QgcmVtb3ZlZCkuXG4gICAgbWVyZ2VCcmFuY2hlc1JpZ2h0KHdyaXRlciwgc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24sIGNvbW1vbkFuY2VzdG9yKTtcbn1cbi8qKlxuICogVGhlcmUgaXMgbm8gcmlnaHQgbWVyZ2Ugb3BlcmF0aW9uIHNvIHdlIG5lZWQgdG8gc2ltdWxhdGUgaXQuXG4gKi8gZnVuY3Rpb24gbWVyZ2VSaWdodCh3cml0ZXIsIHBvc2l0aW9uKSB7XG4gICAgY29uc3Qgc3RhcnRFbGVtZW50ID0gcG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICBjb25zdCBlbmRFbGVtZW50ID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgIGlmIChzdGFydEVsZW1lbnQubmFtZSAhPSBlbmRFbGVtZW50Lm5hbWUpIHtcbiAgICAgICAgd3JpdGVyLnJlbmFtZShzdGFydEVsZW1lbnQsIGVuZEVsZW1lbnQubmFtZSk7XG4gICAgfVxuICAgIHdyaXRlci5jbGVhckF0dHJpYnV0ZXMoc3RhcnRFbGVtZW50KTtcbiAgICB3cml0ZXIuc2V0QXR0cmlidXRlcyhPYmplY3QuZnJvbUVudHJpZXMoZW5kRWxlbWVudC5nZXRBdHRyaWJ1dGVzKCkpLCBzdGFydEVsZW1lbnQpO1xuICAgIHdyaXRlci5tZXJnZShwb3NpdGlvbik7XG59XG4vKipcbiAqIFZlcmlmaWVzIGlmIG1lcmdpbmcgaXMgbmVlZGVkIGFuZCBwb3NzaWJsZS4gSXQncyBub3QgbmVlZGVkIGlmIGJvdGggcG9zaXRpb25zIGFyZSBpbiB0aGUgc2FtZSBlbGVtZW50XG4gKiBhbmQgaXQncyBub3QgcG9zc2libGUgaWYgc29tZSBlbGVtZW50IGlzIGEgbGltaXQgb3IgdGhlIHJhbmdlIGNyb3NzZXMgYSBsaW1pdCBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGNoZWNrU2hvdWxkTWVyZ2Uoc2NoZW1hLCBzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbikge1xuICAgIGNvbnN0IHN0YXJ0RWxlbWVudCA9IHN0YXJ0UG9zaXRpb24ucGFyZW50O1xuICAgIGNvbnN0IGVuZEVsZW1lbnQgPSBlbmRQb3NpdGlvbi5wYXJlbnQ7XG4gICAgLy8gSWYgYm90aCBwb3NpdGlvbnMgZW5kZWQgdXAgaW4gdGhlIHNhbWUgcGFyZW50LCB0aGVuIHRoZXJlJ3Mgbm90aGluZyBtb3JlIHRvIG1lcmdlOlxuICAgIC8vIDwkcm9vdD48cD54WzwvcD48cD5deTwvcD48LyRyb290PiA9PiA8JHJvb3Q+PHA+eHk8L3A+W108LyRyb290PlxuICAgIGlmIChzdGFydEVsZW1lbnQgPT0gZW5kRWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIElmIG9uZSBvZiB0aGUgcG9zaXRpb25zIGlzIGEgbGltaXQgZWxlbWVudCwgdGhlbiB0aGVyZSdzIG5vdGhpbmcgdG8gbWVyZ2UgYmVjYXVzZSB3ZSBkb24ndCB3YW50IHRvIGNyb3NzIHRoZSBsaW1pdCBib3VuZGFyaWVzLlxuICAgIGlmIChzY2hlbWEuaXNMaW1pdChzdGFydEVsZW1lbnQpIHx8IHNjaGVtYS5pc0xpbWl0KGVuZEVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gQ2hlY2sgaWYgb3BlcmF0aW9ucyB3ZSdsbCBuZWVkIHRvIGRvIHdvbid0IG5lZWQgdG8gY3Jvc3Mgb2JqZWN0IG9yIGxpbWl0IGJvdW5kYXJpZXMuXG4gICAgLy8gRS5nLiwgd2UgY2FuJ3QgbWVyZ2UgZW5kRWxlbWVudCBpbnRvIHN0YXJ0RWxlbWVudCBpbiB0aGlzIGNhc2U6XG4gICAgLy8gPGxpbWl0PjxzdGFydEVsZW1lbnQ+eFs8L3N0YXJ0RWxlbWVudD48L2xpbWl0PjxlbmRFbGVtZW50Pl08L2VuZEVsZW1lbnQ+XG4gICAgcmV0dXJuIGlzQ3Jvc3NpbmdMaW1pdEVsZW1lbnQoc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24sIHNjaGVtYSk7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGVsZW1lbnRzIHRoYXQgYXJlIHRoZSBhbmNlc3RvcnMgb2YgdGhlIHByb3ZpZGVkIHBvc2l0aW9ucyB0aGF0IGFyZSBkaXJlY3QgY2hpbGRyZW4gb2YgdGhlIGNvbW1vbiBhbmNlc3Rvci5cbiAqLyBmdW5jdGlvbiBnZXRBbmNlc3RvcnNKdXN0QmVsb3dDb21tb25BbmNlc3Rvcihwb3NpdGlvbkEsIHBvc2l0aW9uQikge1xuICAgIGNvbnN0IGFuY2VzdG9yc0EgPSBwb3NpdGlvbkEuZ2V0QW5jZXN0b3JzKCk7XG4gICAgY29uc3QgYW5jZXN0b3JzQiA9IHBvc2l0aW9uQi5nZXRBbmNlc3RvcnMoKTtcbiAgICBsZXQgaSA9IDA7XG4gICAgd2hpbGUoYW5jZXN0b3JzQVtpXSAmJiBhbmNlc3RvcnNBW2ldID09IGFuY2VzdG9yc0JbaV0pe1xuICAgICAgICBpKys7XG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICAgIGFuY2VzdG9yc0FbaV0sXG4gICAgICAgIGFuY2VzdG9yc0JbaV1cbiAgICBdO1xufVxuZnVuY3Rpb24gc2hvdWxkQXV0b3BhcmFncmFwaChzY2hlbWEsIHBvc2l0aW9uKSB7XG4gICAgY29uc3QgaXNUZXh0QWxsb3dlZCA9IHNjaGVtYS5jaGVja0NoaWxkKHBvc2l0aW9uLCAnJHRleHQnKTtcbiAgICBjb25zdCBpc1BhcmFncmFwaEFsbG93ZWQgPSBzY2hlbWEuY2hlY2tDaGlsZChwb3NpdGlvbiwgJ3BhcmFncmFwaCcpO1xuICAgIHJldHVybiAhaXNUZXh0QWxsb3dlZCAmJiBpc1BhcmFncmFwaEFsbG93ZWQ7XG59XG4vKipcbiAqIENoZWNrIGlmIHBhcmVudHMgb2YgdHdvIHBvc2l0aW9ucyBjYW4gYmUgbWVyZ2VkIGJ5IGNoZWNraW5nIGlmIHRoZXJlIGFyZSBubyBsaW1pdC9vYmplY3RcbiAqIGJvdW5kYXJpZXMgYmV0d2VlbiB0aG9zZSB0d28gcG9zaXRpb25zLlxuICpcbiAqIEUuZy4gaW4gPGJRPjxwPnhbXTwvcD48L2JRPjx3aWRnZXQ+PGNhcHRpb24+e308L2NhcHRpb24+PC93aWRnZXQ+XG4gKiB3ZSdsbCBjaGVjayA8cD4sIDxiUT4sIDx3aWRnZXQ+IGFuZCA8Y2FwdGlvbj4uXG4gKiBVc3VhbGx5LCB3aWRnZXQgYW5kIGNhcHRpb24gYXJlIG1hcmtlZCBhcyBvYmplY3RzL2xpbWl0cyBpbiB0aGUgc2NoZW1hLCBzbyBpbiB0aGlzIGNhc2UgbWVyZ2luZyB3aWxsIGJlIGJsb2NrZWQuXG4gKi8gZnVuY3Rpb24gaXNDcm9zc2luZ0xpbWl0RWxlbWVudChsZWZ0UG9zLCByaWdodFBvcywgc2NoZW1hKSB7XG4gICAgY29uc3QgcmFuZ2VUb0NoZWNrID0gbmV3IFJhbmdlKGxlZnRQb3MsIHJpZ2h0UG9zKTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlVG9DaGVjay5nZXRXYWxrZXIoKSl7XG4gICAgICAgIGlmIChzY2hlbWEuaXNMaW1pdCh2YWx1ZS5pdGVtKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gaW5zZXJ0UGFyYWdyYXBoKHdyaXRlciwgcG9zaXRpb24sIHNlbGVjdGlvbiwgYXR0cmlidXRlcyA9IHt9KSB7XG4gICAgY29uc3QgcGFyYWdyYXBoID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoJ3BhcmFncmFwaCcpO1xuICAgIHdyaXRlci5tb2RlbC5zY2hlbWEuc2V0QWxsb3dlZEF0dHJpYnV0ZXMocGFyYWdyYXBoLCBhdHRyaWJ1dGVzLCB3cml0ZXIpO1xuICAgIHdyaXRlci5pbnNlcnQocGFyYWdyYXBoLCBwb3NpdGlvbik7XG4gICAgY29sbGFwc2VTZWxlY3Rpb25BdCh3cml0ZXIsIHNlbGVjdGlvbiwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQocGFyYWdyYXBoLCAwKSk7XG59XG5mdW5jdGlvbiByZXBsYWNlRW50aXJlQ29udGVudFdpdGhQYXJhZ3JhcGgod3JpdGVyLCBzZWxlY3Rpb24pIHtcbiAgICBjb25zdCBsaW1pdEVsZW1lbnQgPSB3cml0ZXIubW9kZWwuc2NoZW1hLmdldExpbWl0RWxlbWVudChzZWxlY3Rpb24pO1xuICAgIHdyaXRlci5yZW1vdmUod3JpdGVyLmNyZWF0ZVJhbmdlSW4obGltaXRFbGVtZW50KSk7XG4gICAgaW5zZXJ0UGFyYWdyYXBoKHdyaXRlciwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobGltaXRFbGVtZW50LCAwKSwgc2VsZWN0aW9uKTtcbn1cbi8qKlxuICogV2Ugd2FudCB0byByZXBsYWNlIHRoZSBlbnRpcmUgY29udGVudCB3aXRoIGEgcGFyYWdyYXBoIHdoZW46XG4gKiAqIHRoZSBlbnRpcmUgY29udGVudCBpcyBzZWxlY3RlZCxcbiAqICogc2VsZWN0aW9uIGNvbnRhaW5zIGF0IGxlYXN0IHR3byBlbGVtZW50cyxcbiAqICogd2hldGhlciB0aGUgcGFyYWdyYXBoIGlzIGFsbG93ZWQgaW4gc2NoZW1hIGluIHRoZSBjb21tb24gYW5jZXN0b3IuXG4gKi8gZnVuY3Rpb24gc2hvdWxkRW50aXJlQ29udGVudEJlUmVwbGFjZWRXaXRoUGFyYWdyYXBoKHNjaGVtYSwgc2VsZWN0aW9uKSB7XG4gICAgY29uc3QgbGltaXRFbGVtZW50ID0gc2NoZW1hLmdldExpbWl0RWxlbWVudChzZWxlY3Rpb24pO1xuICAgIGlmICghc2VsZWN0aW9uLmNvbnRhaW5zRW50aXJlQ29udGVudChsaW1pdEVsZW1lbnQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgcmFuZ2UgPSBzZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpO1xuICAgIGlmIChyYW5nZS5zdGFydC5wYXJlbnQgPT0gcmFuZ2UuZW5kLnBhcmVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBzY2hlbWEuY2hlY2tDaGlsZChsaW1pdEVsZW1lbnQsICdwYXJhZ3JhcGgnKTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgc2V0cyB0aGUgc2VsZWN0aW9uLiBEZXBlbmRpbmcgd2hldGhlciBnaXZlbiBgc2VsZWN0aW9uYCBpcyBhIGRvY3VtZW50IHNlbGVjdGlvbiBvciBub3QsXG4gKiB1c2VzIGEgZGlmZmVyZW50IG1ldGhvZCB0byBzZXQgaXQuXG4gKi8gZnVuY3Rpb24gY29sbGFwc2VTZWxlY3Rpb25BdCh3cml0ZXIsIHNlbGVjdGlvbiwgcG9zaXRpb25PclJhbmdlKSB7XG4gICAgaWYgKHNlbGVjdGlvbiBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSB7XG4gICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24ocG9zaXRpb25PclJhbmdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBzZWxlY3Rpb24uc2V0VG8ocG9zaXRpb25PclJhbmdlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgZW5naW5lL21vZGVsL3V0aWxzL2dldHNlbGVjdGVkY29udGVudFxuICovIC8qKlxuICogR2V0cyBhIGNsb25lIG9mIHRoZSBzZWxlY3RlZCBjb250ZW50LlxuICpcbiAqIEZvciBleGFtcGxlLCBmb3IgdGhlIGZvbGxvd2luZyBzZWxlY3Rpb246XG4gKlxuICogYGBgaHRtbFxuICogPHA+eDwvcD48cXVvdGU+PHA+eTwvcD48aD5maXJbc3Q8L2g+PC9xdW90ZT48cD5zZV1jb25kPC9wPjxwPno8L3A+XG4gKiBgYGBcbiAqXG4gKiBJdCB3aWxsIHJldHVybiBhIGRvY3VtZW50IGZyYWdtZW50IHdpdGggc3VjaCBhIGNvbnRlbnQ6XG4gKlxuICogYGBgaHRtbFxuICogPHF1b3RlPjxoPnN0PC9oPjwvcXVvdGU+PHA+c2U8L3A+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbW9kZWwgVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIHNlbGVjdGlvbiBtb2RpZmljYXRpb24gc2hvdWxkIGJlIHBlcmZvcm1lZC5cbiAqIEBwYXJhbSBzZWxlY3Rpb24gVGhlIHNlbGVjdGlvbiBvZiB3aGljaCBjb250ZW50IHdpbGwgYmUgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gZ2V0U2VsZWN0ZWRDb250ZW50KG1vZGVsLCBzZWxlY3Rpb24pIHtcbiAgICByZXR1cm4gbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgIGNvbnN0IGZyYWcgPSB3cml0ZXIuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgICAgICBjb25zdCByYW5nZSA9IHNlbGVjdGlvbi5nZXRGaXJzdFJhbmdlKCk7XG4gICAgICAgIGlmICghcmFuZ2UgfHwgcmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmcmFnO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvb3QgPSByYW5nZS5zdGFydC5yb290O1xuICAgICAgICBjb25zdCBjb21tb25QYXRoID0gcmFuZ2Uuc3RhcnQuZ2V0Q29tbW9uUGF0aChyYW5nZS5lbmQpO1xuICAgICAgICBjb25zdCBjb21tb25QYXJlbnQgPSByb290LmdldE5vZGVCeVBhdGgoY29tbW9uUGF0aCk7XG4gICAgICAgIC8vICMjIDFzdCBzdGVwXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEZpcnN0LCB3ZSdsbCBjbG9uZSBhIGZyYWdtZW50IHJlcHJlc2VudGVkIGJ5IGEgbWluaW1hbCBmbGF0IHJhbmdlXG4gICAgICAgIC8vIGNvbnRhaW5pbmcgdGhlIG9yaWdpbmFsIHJhbmdlIHRvIGJlIGNsb25lZC5cbiAgICAgICAgLy8gRS5nLiBsZXQncyBjb25zaWRlciBzdWNoIGEgcmFuZ2U6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxwPng8L3A+PHF1b3RlPjxwPnk8L3A+PGg+ZmlyW3N0PC9oPjwvcXVvdGU+PHA+c2VdY29uZDwvcD48cD56PC9wPlxuICAgICAgICAvL1xuICAgICAgICAvLyBBIG1pbmltYWwgZmxhdCByYW5nZSBjb250YWluaW5nIHRoaXMgb25lIGlzOlxuICAgICAgICAvL1xuICAgICAgICAvLyA8cD54PC9wPls8cXVvdGU+PHA+eTwvcD48aD5maXJzdDwvaD48L3F1b3RlPjxwPnNlY29uZDwvcD5dPHA+ejwvcD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gV2UgY2FuIGVhc2lseSBjbG9uZSB0aGlzIHN0cnVjdHVyZSwgcHJlc2VydmluZyBlLmcuIHRoZSA8cXVvdGU+IGVsZW1lbnQuXG4gICAgICAgIGxldCBmbGF0U3VidHJlZVJhbmdlO1xuICAgICAgICBpZiAocmFuZ2Uuc3RhcnQucGFyZW50ID09IHJhbmdlLmVuZC5wYXJlbnQpIHtcbiAgICAgICAgICAgIC8vIFRoZSBvcmlnaW5hbCByYW5nZSBpcyBmbGF0LCBzbyB0YWtlIGl0LlxuICAgICAgICAgICAgZmxhdFN1YnRyZWVSYW5nZSA9IHJhbmdlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmxhdFN1YnRyZWVSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSh3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChjb21tb25QYXJlbnQsIHJhbmdlLnN0YXJ0LnBhdGhbY29tbW9uUGF0aC5sZW5ndGhdKSwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoY29tbW9uUGFyZW50LCByYW5nZS5lbmQucGF0aFtjb21tb25QYXRoLmxlbmd0aF0gKyAxKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaG93TWFueSA9IGZsYXRTdWJ0cmVlUmFuZ2UuZW5kLm9mZnNldCAtIGZsYXRTdWJ0cmVlUmFuZ2Uuc3RhcnQub2Zmc2V0O1xuICAgICAgICAvLyBDbG9uZSB0aGUgd2hvbGUgY29udGVudHMuXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBmbGF0U3VidHJlZVJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJyR0ZXh0UHJveHknKSkge1xuICAgICAgICAgICAgICAgIHdyaXRlci5hcHBlbmRUZXh0KGl0ZW0uZGF0YSwgaXRlbS5nZXRBdHRyaWJ1dGVzKCksIGZyYWcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3cml0ZXIuYXBwZW5kKHdyaXRlci5jbG9uZUVsZW1lbnQoaXRlbSwgdHJ1ZSksIGZyYWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vICMjIDJuZCBzdGVwXG4gICAgICAgIC8vXG4gICAgICAgIC8vIElmIHRoZSBvcmlnaW5hbCByYW5nZSB3YXNuJ3QgZmxhdCwgdGhlbiB3ZSBuZWVkIHRvIHJlbW92ZSB0aGUgZXhjZXNzIG5vZGVzIGZyb20gdGhlIGJvdGggZW5kcyBvZiB0aGUgY2xvbmVkIGZyYWdtZW50LlxuICAgICAgICAvL1xuICAgICAgICAvLyBGb3IgZXhhbXBsZSwgZm9yIHRoZSByYW5nZSBzaG93biBpbiB0aGUgMXN0IHN0ZXAgY29tbWVudCwgd2UgbmVlZCB0byByZW1vdmUgdGhlc2UgcGllY2VzOlxuICAgICAgICAvL1xuICAgICAgICAvLyA8cXVvdGU+WzxwPnk8L3A+XTxoPltmaXJdc3Q8L2g+PC9xdW90ZT48cD5zZVtjb25kXTwvcD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gU28gdGhpcyB3aWxsIGJlIHRoZSBmaW5hbCBjb3BpZWQgY29udGVudDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPHF1b3RlPjxoPnN0PC9oPjwvcXVvdGU+PHA+c2U8L3A+XG4gICAgICAgIC8vXG4gICAgICAgIC8vIEluIG9yZGVyIHRvIGRvIHRoYXQsIHdlIHJlbW92ZSBjb250ZW50IGZyb20gdGhlc2UgdHdvIHJhbmdlczpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gWzxxdW90ZT48cD55PC9wPjxoPmZpcl1zdDwvaD48L3F1b3RlPjxwPnNlW2NvbmQ8L3A+XVxuICAgICAgICBpZiAoZmxhdFN1YnRyZWVSYW5nZSAhPSByYW5nZSkge1xuICAgICAgICAgICAgLy8gRmluZCB0aGUgcG9zaXRpb24gb2YgdGhlIG9yaWdpbmFsIHJhbmdlIGluIHRoZSBjbG9uZWQgZnJhZ21lbnQuXG4gICAgICAgICAgICBjb25zdCBuZXdSYW5nZSA9IHJhbmdlLl9nZXRUcmFuc2Zvcm1lZEJ5TW92ZShmbGF0U3VidHJlZVJhbmdlLnN0YXJ0LCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChmcmFnLCAwKSwgaG93TWFueSlbMF07XG4gICAgICAgICAgICBjb25zdCBsZWZ0RXhjZXNzUmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2Uod3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoZnJhZywgMCksIG5ld1JhbmdlLnN0YXJ0KTtcbiAgICAgICAgICAgIGNvbnN0IHJpZ2h0RXhjZXNzUmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UobmV3UmFuZ2UuZW5kLCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChmcmFnLCAnZW5kJykpO1xuICAgICAgICAgICAgcmVtb3ZlUmFuZ2VDb250ZW50KHJpZ2h0RXhjZXNzUmFuZ2UsIHdyaXRlcik7XG4gICAgICAgICAgICByZW1vdmVSYW5nZUNvbnRlbnQobGVmdEV4Y2Vzc1JhbmdlLCB3cml0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmcmFnO1xuICAgIH0pO1xufVxuLy8gQWZ0ZXIgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzY5MCBpcyBmaXhlZCxcbi8vIHRoaXMgZnVuY3Rpb24gd2lsbCwgbW9zdCBsaWtlbHksIGJlIGFibGUgdG8gcmV3cml0dGVuIHVzaW5nIGdldE1pbmltYWxGbGF0UmFuZ2VzKCkuXG5mdW5jdGlvbiByZW1vdmVSYW5nZUNvbnRlbnQocmFuZ2UsIHdyaXRlcikge1xuICAgIGNvbnN0IHBhcmVudHNUb0NoZWNrID0gW107XG4gICAgQXJyYXkuZnJvbShyYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgIGRpcmVjdGlvbjogJ2JhY2t3YXJkJ1xuICAgIH0pKS8vIFdlIHNob3VsZCBiZXR0ZXIgc3RvcmUgcmFuZ2VzIGJlY2F1c2UgdGV4dCBwcm94aWVzIHdpbGwgbG9zZSBpbnRlZ3JpdHlcbiAgICAvLyB3aXRoIHRoZSB0ZXh0IG5vZGVzIHdoZW4gd2UnbGwgc3RhcnQgcmVtb3ZpbmcgY29udGVudC5cbiAgICAubWFwKChpdGVtKT0+d3JpdGVyLmNyZWF0ZVJhbmdlT24oaXRlbSkpLy8gRmlsdGVyIG9ubHkgdGhlc2UgaXRlbXMgd2hpY2ggYXJlIGZ1bGx5IGNvbnRhaW5lZCBpbiB0aGUgcGFzc2VkIHJhbmdlLlxuICAgIC8vXG4gICAgLy8gRS5nLiBmb3IgdGhlIGZvbGxvd2luZyByYW5nZTogWzxxdW90ZT48cD55PC9wPjxoPmZpcl1zdDwvaD5cbiAgICAvLyB0aGUgd2Fsa2VyIHdpbGwgcmV0dXJuIHRoZSBlbnRpcmUgPGg+IGVsZW1lbnQsIHdoZW4gb25seSB0aGUgXCJmaXJcIiBpdGVtIGluc2lkZSBpdCBpcyBmdWxseSBjb250YWluZWQuXG4gICAgLmZpbHRlcigoaXRlbVJhbmdlKT0+e1xuICAgICAgICAvLyBXZSBzaG91bGQgYmUgYWJsZSB0byB1c2UgUmFuZ2UuY29udGFpbnNSYW5nZSwgYnV0IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2lzc3Vlcy82OTEuXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lZCA9IChpdGVtUmFuZ2Uuc3RhcnQuaXNBZnRlcihyYW5nZS5zdGFydCkgfHwgaXRlbVJhbmdlLnN0YXJ0LmlzRXF1YWwocmFuZ2Uuc3RhcnQpKSAmJiAoaXRlbVJhbmdlLmVuZC5pc0JlZm9yZShyYW5nZS5lbmQpIHx8IGl0ZW1SYW5nZS5lbmQuaXNFcXVhbChyYW5nZS5lbmQpKTtcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lZDtcbiAgICB9KS5mb3JFYWNoKChpdGVtUmFuZ2UpPT57XG4gICAgICAgIHBhcmVudHNUb0NoZWNrLnB1c2goaXRlbVJhbmdlLnN0YXJ0LnBhcmVudCk7XG4gICAgICAgIHdyaXRlci5yZW1vdmUoaXRlbVJhbmdlKTtcbiAgICB9KTtcbiAgICAvLyBSZW1vdmUgYW5jZXN0b3JzIG9mIHRoZSByZW1vdmVkIGl0ZW1zIGlmIHRoZXkgdHVybmVkIHRvIGJlIGVtcHR5IG5vd1xuICAgIC8vICh0aGVpciB3aG9sZSBjb250ZW50IHdhcyBjb250YWluZWQgaW4gdGhlIHJhbmdlKS5cbiAgICBwYXJlbnRzVG9DaGVjay5mb3JFYWNoKChwYXJlbnRUb0NoZWNrKT0+e1xuICAgICAgICBsZXQgcGFyZW50ID0gcGFyZW50VG9DaGVjaztcbiAgICAgICAgd2hpbGUocGFyZW50LnBhcmVudCAmJiBwYXJlbnQuaXNFbXB0eSl7XG4gICAgICAgICAgICBjb25zdCByZW1vdmVSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZU9uKHBhcmVudCk7XG4gICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgICAgICAgd3JpdGVyLnJlbW92ZShyZW1vdmVSYW5nZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cblxuLyoqXG4gKiBJbnNlcnRzIGNvbnRlbnQgaW50byB0aGUgZWRpdG9yIChzcGVjaWZpZWQgc2VsZWN0aW9uKSBhcyBvbmUgd291bGQgZXhwZWN0IHRoZSBwYXN0ZSBmdW5jdGlvbmFsaXR5IHRvIHdvcmsuXG4gKlxuICogSXQgdGFrZXMgY2FyZSBvZiByZW1vdmluZyB0aGUgc2VsZWN0ZWQgY29udGVudCwgc3BsaXR0aW5nIGVsZW1lbnRzIChpZiBuZWVkZWQpLCBpbnNlcnRpbmcgZWxlbWVudHMgYW5kIG1lcmdpbmcgZWxlbWVudHMgYXBwcm9wcmlhdGVseS5cbiAqXG4gKiBTb21lIGV4YW1wbGVzOlxuICpcbiAqIGBgYGh0bWxcbiAqIDxwPnhePC9wPiArIDxwPnk8L3A+ID0+IDxwPng8L3A+PHA+eTwvcD4gPT4gPHA+eHlbXTwvcD5cbiAqIDxwPnheeTwvcD4gKyA8cD56PC9wPiA9PiA8cD54PC9wPl48cD55PC9wPiArIDxwPno8L3A+ID0+IDxwPng8L3A+PHA+ejwvcD48cD55PC9wPiA9PiA8cD54eltdeTwvcD5cbiAqIDxwPnheeTwvcD4gKyA8aW1nIC8+ID0+IDxwPng8L3A+XjxwPnk8L3A+ICsgPGltZyAvPiA9PiA8cD54PC9wPjxpbWcgLz48cD55PC9wPlxuICogPHA+eDwvcD48cD5ePC9wPjxwPno8L3A+ICsgPHA+eTwvcD4gPT4gPHA+eDwvcD48cD55W108L3A+PHA+ejwvcD4gKG5vIG1lcmdpbmcpXG4gKiA8cD54PC9wPls8aW1nIC8+XTxwPno8L3A+ICsgPHA+eTwvcD4gPT4gPHA+eDwvcD5ePHA+ejwvcD4gKyA8cD55PC9wPiA9PiA8cD54PC9wPjxwPnlbXTwvcD48cD56PC9wPlxuICogYGBgXG4gKlxuICogSWYgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbn0gaXMgcGFzc2VkIGFzIGBzZWxlY3RhYmxlYCBpdCB3aWxsIGJlIG1vZGlmaWVkXG4gKiB0byB0aGUgaW5zZXJ0aW9uIHNlbGVjdGlvbiAoZXF1YWwgdG8gYSByYW5nZSB0byBiZSBzZWxlY3RlZCBhZnRlciBpbnNlcnRpb24pLlxuICpcbiAqIElmIGBzZWxlY3RhYmxlYCBpcyBub3QgcGFzc2VkLCB0aGUgY29udGVudCB3aWxsIGJlIGluc2VydGVkIHVzaW5nIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBvZiB0aGUgbW9kZWwgZG9jdW1lbnQuXG4gKlxuICogKipOb3RlOioqIFVzZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNpbnNlcnRDb250ZW50fSBpbnN0ZWFkIG9mIHRoaXMgZnVuY3Rpb24uXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgZXhwb3NlZCB0byBiZSByZXVzYWJsZSBpbiBhbGdvcml0aG1zIHdoaWNoIGNoYW5nZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudH1cbiAqIG1ldGhvZCdzIGJlaGF2aW9yLlxuICpcbiAqIEBwYXJhbSBtb2RlbCBUaGUgbW9kZWwgaW4gY29udGV4dCBvZiB3aGljaCB0aGUgaW5zZXJ0aW9uIHNob3VsZCBiZSBwZXJmb3JtZWQuXG4gKiBAcGFyYW0gY29udGVudCBUaGUgY29udGVudCB0byBpbnNlcnQuXG4gKiBAcGFyYW0gc2VsZWN0YWJsZSBTZWxlY3Rpb24gaW50byB3aGljaCB0aGUgY29udGVudCBzaG91bGQgYmUgaW5zZXJ0ZWQuXG4gKiBAcGFyYW0gcGxhY2VPck9mZnNldCBTZXRzIHBsYWNlIG9yIG9mZnNldCBvZiB0aGUgc2VsZWN0aW9uLlxuICogQHJldHVybnMgUmFuZ2Ugd2hpY2ggY29udGFpbnMgYWxsIHRoZSBwZXJmb3JtZWQgY2hhbmdlcy4gVGhpcyBpcyBhIHJhbmdlIHRoYXQsIGlmIHJlbW92ZWQsXG4gKiB3b3VsZCByZXR1cm4gdGhlIG1vZGVsIHRvIHRoZSBzdGF0ZSBiZWZvcmUgdGhlIGluc2VydGlvbi4gSWYgbm8gY2hhbmdlcyB3ZXJlIHByZWZvcm1lZCBieSBgaW5zZXJ0Q29udGVudGAsIHJldHVybnMgYSByYW5nZSBjb2xsYXBzZWRcbiAqIGF0IHRoZSBpbnNlcnRpb24gcG9zaXRpb24uXG4gKi8gZnVuY3Rpb24gaW5zZXJ0Q29udGVudChtb2RlbCwgY29udGVudCwgc2VsZWN0YWJsZSkge1xuICAgIHJldHVybiBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gc2VsZWN0YWJsZSA/IHNlbGVjdGFibGUgOiBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICBtb2RlbC5kZWxldGVDb250ZW50KHNlbGVjdGlvbiwge1xuICAgICAgICAgICAgICAgIGRvTm90QXV0b3BhcmFncmFwaDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5zZXJ0aW9uID0gbmV3IEluc2VydGlvbihtb2RlbCwgd3JpdGVyLCBzZWxlY3Rpb24uYW5jaG9yKTtcbiAgICAgICAgY29uc3QgZmFrZU1hcmtlckVsZW1lbnRzID0gW107XG4gICAgICAgIGxldCBub2Rlc1RvSW5zZXJ0O1xuICAgICAgICBpZiAoY29udGVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICAvLyBJZiBkb2N1bWVudCBmcmFnbWVudCBoYXMgYW55IG1hcmtlcnMsIHRoZXNlIG1hcmtlcnMgc2hvdWxkIGJlIGluc2VydGVkIGludG8gdGhlIG1vZGVsIGFzIHdlbGwuXG4gICAgICAgICAgICBpZiAoY29udGVudC5tYXJrZXJzLnNpemUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXJrZXJzUG9zaXRpb24gPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCByYW5nZV0gb2YgY29udGVudC5tYXJrZXJzKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBzdGFydCwgZW5kIH0gPSByYW5nZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDb2xsYXBzZWQgPSBzdGFydC5pc0VxdWFsKGVuZCk7XG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcnNQb3NpdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0NvbGxhcHNlZFxuICAgICAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29sbGFwc2VkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBNYXJrZXJzIHBvc2l0aW9uIGlzIHNvcnRlZCBiYWNrd2FyZHMgdG8gZW5zdXJlIHRoYXQgdGhlIGluc2VydGlvbiBvZiBmYWtlIG1hcmtlcnMgd2lsbCBub3QgY2hhbmdlXG4gICAgICAgICAgICAgICAgLy8gdGhlIHBvc2l0aW9uIG9mIHRoZSBuZXh0IG1hcmtlcnMuXG4gICAgICAgICAgICAgICAgbWFya2Vyc1Bvc2l0aW9uLnNvcnQoKHsgcG9zaXRpb246IHBvc0EgfSwgeyBwb3NpdGlvbjogcG9zQiB9KT0+cG9zQS5pc0JlZm9yZShwb3NCKSA/IDEgOiAtMSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IHBvc2l0aW9uLCBuYW1lLCBpc0NvbGxhcHNlZCB9IG9mIG1hcmtlcnNQb3NpdGlvbil7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmYWtlRWxlbWVudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjb2xsYXBzZWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0F0QmVnaW5uaW5nID0gcG9zaXRpb24ucGFyZW50ID09PSBjb250ZW50ICYmIHBvc2l0aW9uLmlzQXRTdGFydDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBdEVuZCA9IHBvc2l0aW9uLnBhcmVudCA9PT0gY29udGVudCAmJiBwb3NpdGlvbi5pc0F0RW5kO1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byB3YXlzIG9mIGhhbmRsaW5nIG1hcmtlcnMuIEluIGdlbmVyYWwsIHdlIHdhbnQgdG8gYWRkIHRlbXBvcmFyeSA8JG1hcmtlcj4gbW9kZWwgZWxlbWVudHMgdG9cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVwcmVzZW50IG1hcmtlciBib3VuZGFyaWVzLiBUaGVzZSBlbGVtZW50cyB3aWxsIGJlIGluc2VydGVkIGludG8gY29udGVudCB0b2dldGhlciB3aXRoIHRoZSByZXN0XG4gICAgICAgICAgICAgICAgICAgIC8vIG9mIHRoZSBkb2N1bWVudCBmcmFnbWVudC4gQWZ0ZXIgaW5zZXJ0aW9uIGlzIGRvbmUsIHBvc2l0aW9ucyBmb3IgdGhlc2UgZWxlbWVudHMgd2lsbCBiZSByZWFkXG4gICAgICAgICAgICAgICAgICAgIC8vIGFuZCBwcm9wZXIsIGFjdHVhbCBtYXJrZXJzIHdpbGwgYmUgY3JlYXRlZCBpbiB0aGUgbW9kZWwgYW5kIGZha2UgZWxlbWVudHMgd2lsbCBiZSByZW1vdmVkLlxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBIb3dldmVyLCBpZiB0aGUgPCRtYXJrZXI+IGVsZW1lbnQgaXMgYXQgdGhlIGJlZ2lubmluZyBvciBhdCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudCBmcmFnbWVudCxcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQgbWF5IGFmZmVjdCBob3cgdGhlIGluc2VydGVkIGNvbnRlbnQgaXMgbWVyZ2VkIHdpdGggY3VycmVudCBtb2RlbCwgaW1wYWN0aW5nIHRoZSBpbnNlcnRpb25cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0LiBUbyBhdm9pZCB0aGF0LCB3ZSBkb24ndCBhZGQgPCRtYXJrZXI+IGVsZW1lbnRzIGF0IHRoZXNlIHBvc2l0aW9ucy4gSW5zdGVhZCwgd2Ugd2lsbCB1c2VcbiAgICAgICAgICAgICAgICAgICAgLy8gYEluc2VydGlvbiNnZXRBZmZlY3RlZFJhbmdlKClgIHRvIGZpZ3VyZSBvdXQgbmV3IHBvc2l0aW9ucyBmb3IgdGhlc2UgbWFya2VyIGJvdW5kYXJpZXMuXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNBdEJlZ2lubmluZyAmJiAhaXNBdEVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmFrZUVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCgnJG1hcmtlcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLmluc2VydChmYWtlRWxlbWVudCwgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIHdoZXRoZXIgdGhlIGNvbGxhcHNlZCBtYXJrZXIgd2FzIGF0IHRoZSBiZWdpbm5pbmcgb3IgYXQgdGhlIGVuZCBvZiBkb2N1bWVudCBmcmFnbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8ga25vdyB3aGVyZSB0byBjcmVhdGUgaXQgYWZ0ZXIgdGhlIGluc2VydGlvbiBpcyBkb25lLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VkID0gaXNBdEJlZ2lubmluZyA/ICdzdGFydCcgOiAnZW5kJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBmYWtlTWFya2VyRWxlbWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogZmFrZUVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZWRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZXNUb0luc2VydCA9IGNvbnRlbnQuZ2V0Q2hpbGRyZW4oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vZGVzVG9JbnNlcnQgPSBbXG4gICAgICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBpbnNlcnRpb24uaGFuZGxlTm9kZXMobm9kZXNUb0luc2VydCk7XG4gICAgICAgIGxldCBuZXdSYW5nZSA9IGluc2VydGlvbi5nZXRTZWxlY3Rpb25SYW5nZSgpO1xuICAgICAgICBpZiAoY29udGVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpICYmIGZha2VNYXJrZXJFbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIEFmdGVyIGluc2VydGlvbiB3YXMgZG9uZSwgdGhlIHNlbGVjdGlvbiB3YXMgc2V0IGJ1dCB0aGUgbW9kZWwgY29udGFpbnMgZmFrZSA8JG1hcmtlcj4gZWxlbWVudHMuXG4gICAgICAgICAgICAvLyBUaGVzZSA8JG1hcmtlcj4gZWxlbWVudHMgd2lsbCBiZSBub3cgcmVtb3ZlZC4gQmVjYXVzZSBvZiB0aGF0LCB3ZSB3aWxsIG5lZWQgdG8gZml4IHRoZSBzZWxlY3Rpb24uXG4gICAgICAgICAgICAvLyBXZSB3aWxsIGNyZWF0ZSBhIGxpdmUgcmFuZ2UgdGhhdCB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgdXBkYXRlIGFzIDwkbWFya2VyPiBlbGVtZW50cyBhcmUgcmVtb3ZlZC5cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbkxpdmVSYW5nZSA9IG5ld1JhbmdlID8gTGl2ZVJhbmdlLmZyb21SYW5nZShuZXdSYW5nZSkgOiBudWxsO1xuICAgICAgICAgICAgLy8gTWFya2VyIG5hbWUgLT4gWyBzdGFydCBwb3NpdGlvbiwgZW5kIHBvc2l0aW9uIF0uXG4gICAgICAgICAgICBjb25zdCBtYXJrZXJzRGF0YSA9IHt9O1xuICAgICAgICAgICAgLy8gTm90ZTogYGZha2VNYXJrZXJFbGVtZW50c2AgYXJlIHNvcnRlZCBiYWNrd2FyZHMuIEhvd2V2ZXIsIG5vdywgd2Ugd2FudCB0byBoYW5kbGUgdGhlIG1hcmtlcnNcbiAgICAgICAgICAgIC8vIGZyb20gdGhlIGJlZ2lubmluZywgc28gdGhhdCBleGlzdGluZyA8JG1hcmtlcj4gZWxlbWVudHMgZG8gbm90IGFmZmVjdCBtYXJrZXJzIHBvc2l0aW9ucy5cbiAgICAgICAgICAgIC8vIFRoaXMgaXMgd2h5IHdlIGl0ZXJhdGUgZnJvbSB0aGUgZW5kIHRvIHRoZSBzdGFydC5cbiAgICAgICAgICAgIGZvcihsZXQgaSA9IGZha2VNYXJrZXJFbGVtZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBuYW1lLCBlbGVtZW50LCBjb2xsYXBzZWQgfSA9IGZha2VNYXJrZXJFbGVtZW50c1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1N0YXJ0Qm91bmRhcnkgPSAhbWFya2Vyc0RhdGFbbmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKGlzU3RhcnRCb3VuZGFyeSkge1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzRGF0YVtuYW1lXSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIGZha2UgbWFya2VyIGVsZW1lbnQgcG9zaXRpb24gdG8gbGVhcm4gd2hlcmUgdGhlIG1hcmtlciBzaG91bGQgYmUgY3JlYXRlZC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoZWxlbWVudCwgJ2JlZm9yZScpO1xuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzRGF0YVtuYW1lXS5wdXNoKGVsZW1lbnRQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmUoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGZha2UgbWFya2VyIGVsZW1lbnQgZG9lcyBub3QgZXhpc3QsIGl0IG1lYW5zIHRoYXQgdGhlIG1hcmtlciBib3VuZGFyeSB3YXMgYXQgdGhlIGJlZ2lubmluZyBvciBhdCB0aGUgZW5kLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCByYW5nZU9uSW5zZXJ0aW9uID0gaW5zZXJ0aW9uLmdldEFmZmVjdGVkUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyYW5nZU9uSW5zZXJ0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBhZmZlY3RlZCByYW5nZSBpcyBgbnVsbGAgaXQgbWVhbnMgdGhhdCBub3RoaW5nIHdhcyBpbiB0aGUgZG9jdW1lbnQgZnJhZ21lbnQgb3IgYWxsIGNvbnRlbnQgd2FzIGZpbHRlcmVkIG91dC5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvbWUgbWFya2VycyB0aGF0IHdlcmUgaW4gdGhlIGZpbHRlcmVkIGNvbnRlbnQgbWF5IGJlIHJlbW92ZWQgKHBhcnRpYWxseSBvciB0b3RhbGx5KS5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExldCdzIGhhbmRsZSBvbmx5IHRob3NlIG1hcmtlcnMgdGhhdCB3ZXJlIGF0IHRoZSBiZWdpbm5pbmcgb3IgYXQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnQgZnJhZ21lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2Vyc0RhdGFbbmFtZV0ucHVzaChpbnNlcnRpb24ucG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxhcHNlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIG1hcmtlciB3YXMgY29sbGFwc2VkIGF0IHRoZSBiZWdpbm5pbmcgb3IgYXQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnQgZnJhZ21lbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwdXQgYm90aCBib3VuZGFyaWVzIGF0IHRoZSBiZWdpbm5pbmcgb3IgYXQgdGhlIGVuZCBvZiBpbnNlcnRlZCByYW5nZSAodG8ga2VlcCB0aGUgbWFya2VyIGNvbGxhcHNlZCkuXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJzRGF0YVtuYW1lXS5wdXNoKHJhbmdlT25JbnNlcnRpb25bY29sbGFwc2VkXSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJzRGF0YVtuYW1lXS5wdXNoKGlzU3RhcnRCb3VuZGFyeSA/IHJhbmdlT25JbnNlcnRpb24uc3RhcnQgOiByYW5nZU9uSW5zZXJ0aW9uLmVuZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBbc3RhcnQsIGVuZF1dIG9mIE9iamVjdC5lbnRyaWVzKG1hcmtlcnNEYXRhKSl7XG4gICAgICAgICAgICAgICAgLy8gRm9yIG5vdywgd2UgaWdub3JlIG1hcmtlcnMgaWYgdGhleSBhcmUgaW5jbHVkZWQgaW4gdGhlIGZpbHRlcmVkLW91dCBjb250ZW50LlxuICAgICAgICAgICAgICAgIC8vIEluIHRoZSBmdXR1cmUgaW1wbGVtZW50YXRpb24gd2Ugd2lsbCBpbXByb3ZlIHRoYXQgY2FzZSB0byBjcmVhdGUgbWFya2VycyB0aGF0IGFyZSBub3QgZmlsdGVyZWQgb3V0IGNvbXBsZXRlbHkuXG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0ICYmIGVuZCAmJiBzdGFydC5yb290ID09PSBlbmQucm9vdCAmJiBzdGFydC5yb290LmRvY3VtZW50ICYmICF3cml0ZXIubW9kZWwubWFya2Vycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLmFkZE1hcmtlcihuYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2luZ09wZXJhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFmZmVjdHNEYXRhOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IG5ldyBSYW5nZShzdGFydCwgZW5kKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uTGl2ZVJhbmdlKSB7XG4gICAgICAgICAgICAgICAgbmV3UmFuZ2UgPSBzZWxlY3Rpb25MaXZlUmFuZ2UudG9SYW5nZSgpO1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbkxpdmVSYW5nZS5kZXRhY2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAtLSBAcHJlc2VydmUgKi8gaWYgKG5ld1JhbmdlKSB7XG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1JhbmdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uLnNldFRvKG5ld1JhbmdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhZmZlY3RlZFJhbmdlID0gaW5zZXJ0aW9uLmdldEFmZmVjdGVkUmFuZ2UoKSB8fCBtb2RlbC5jcmVhdGVSYW5nZShzZWxlY3Rpb24uYW5jaG9yKTtcbiAgICAgICAgaW5zZXJ0aW9uLmRlc3Ryb3koKTtcbiAgICAgICAgcmV0dXJuIGFmZmVjdGVkUmFuZ2U7XG4gICAgfSk7XG59XG4vKipcbiAqIFV0aWxpdHkgY2xhc3MgZm9yIHBlcmZvcm1pbmcgY29udGVudCBpbnNlcnRpb24uXG4gKi8gY2xhc3MgSW5zZXJ0aW9uIHtcbiAgICAvKipcblx0ICogVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbiBzaG91bGQgYmUgcGVyZm9ybWVkLlxuXHQgKi8gbW9kZWw7XG4gICAgLyoqXG5cdCAqIEJhdGNoIHRvIHdoaWNoIG9wZXJhdGlvbnMgd2lsbCBiZSBhZGRlZC5cblx0ICovIHdyaXRlcjtcbiAgICAvKipcblx0ICogVGhlIHBvc2l0aW9uIGF0IHdoaWNoIChvciBuZWFyIHdoaWNoKSB0aGUgbmV4dCBub2RlIHdpbGwgYmUgaW5zZXJ0ZWQuXG5cdCAqLyBwb3NpdGlvbjtcbiAgICAvKipcblx0ICogRWxlbWVudHMgd2l0aCB3aGljaCB0aGUgaW5zZXJ0ZWQgZWxlbWVudHMgY2FuIGJlIG1lcmdlZC5cblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8cD54XjwvcD48cD55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eDwvcD4pXG5cdCAqIDxwPng8L3A+PHA+Xnk8L3A+ICsgPHA+ejwvcD4gKGNhbiBtZXJnZSB0byA8cD55PC9wPilcblx0ICogPHA+eF55PC9wPiArIDxwPno8L3A+IChjYW4gbWVyZ2UgdG8gPHA+eHk8L3A+IHdoaWNoIHdpbGwgYmUgc3BsaXQgZHVyaW5nIHRoZSBhY3Rpb24sXG5cdCAqIFx0XHRcdFx0XHRcdHNvIGJvdGggaXRzIHBpZWNlcyB3aWxsIGJlIGFkZGVkIHRvIHRoaXMgc2V0KVxuXHQgKiBgYGBcblx0ICovIGNhbk1lcmdlV2l0aDtcbiAgICAvKipcblx0ICogU2NoZW1hIG9mIHRoZSBtb2RlbC5cblx0ICovIHNjaGVtYTtcbiAgICAvKipcblx0ICogVGhlIHRlbXBvcmFyeSBEb2N1bWVudEZyYWdtZW50IHVzZWQgZm9yIGdyb3VwaW5nIG11bHRpcGxlIG5vZGVzIGZvciBzaW5nbGUgaW5zZXJ0IG9wZXJhdGlvbi5cblx0ICovIF9kb2N1bWVudEZyYWdtZW50O1xuICAgIC8qKlxuXHQgKiBUaGUgY3VycmVudCBwb3NpdGlvbiBpbiB0aGUgdGVtcG9yYXJ5IERvY3VtZW50RnJhZ21lbnQuXG5cdCAqLyBfZG9jdW1lbnRGcmFnbWVudFBvc2l0aW9uO1xuICAgIC8qKlxuXHQgKiBUaGUgcmVmZXJlbmNlIHRvIHRoZSBmaXJzdCBpbnNlcnRlZCBub2RlLlxuXHQgKi8gX2ZpcnN0Tm9kZSA9IG51bGw7XG4gICAgLyoqXG5cdCAqIFRoZSByZWZlcmVuY2UgdG8gdGhlIGxhc3QgaW5zZXJ0ZWQgbm9kZS5cblx0ICovIF9sYXN0Tm9kZSA9IG51bGw7XG4gICAgLyoqXG5cdCAqIFRoZSByZWZlcmVuY2UgdG8gdGhlIGxhc3QgYXV0byBwYXJhZ3JhcGggbm9kZS5cblx0ICovIF9sYXN0QXV0b1BhcmFncmFwaCA9IG51bGw7XG4gICAgLyoqXG5cdCAqIFRoZSBhcnJheSBvZiBub2RlcyB0aGF0IHNob3VsZCBiZSBjbGVhbmVkIG9mIG5vdCBhbGxvd2VkIGF0dHJpYnV0ZXMuXG5cdCAqLyBfZmlsdGVyQXR0cmlidXRlc09mID0gW107XG4gICAgLyoqXG5cdCAqIEJlZ2lubmluZyBvZiB0aGUgYWZmZWN0ZWQgcmFuZ2UuIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC91dGlscy9pbnNlcnRjb250ZW50fkluc2VydGlvbiNnZXRBZmZlY3RlZFJhbmdlfS5cblx0ICovIF9hZmZlY3RlZFN0YXJ0ID0gbnVsbDtcbiAgICAvKipcblx0ICogRW5kIG9mIHRoZSBhZmZlY3RlZCByYW5nZS4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnR+SW5zZXJ0aW9uI2dldEFmZmVjdGVkUmFuZ2V9LlxuXHQgKi8gX2FmZmVjdGVkRW5kID0gbnVsbDtcbiAgICBfbm9kZVRvU2VsZWN0ID0gbnVsbDtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgd3JpdGVyLCBwb3NpdGlvbil7XG4gICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdGhpcy53cml0ZXIgPSB3cml0ZXI7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgdGhpcy5jYW5NZXJnZVdpdGggPSBuZXcgU2V0KFtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24ucGFyZW50XG4gICAgICAgIF0pO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRGcmFnbWVudCA9IHdyaXRlci5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50RnJhZ21lbnRQb3NpdGlvbiA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHRoaXMuX2RvY3VtZW50RnJhZ21lbnQsIDApO1xuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyBpbnNlcnRpb24gb2YgYSBzZXQgb2Ygbm9kZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlcyBOb2RlcyB0byBpbnNlcnQuXG5cdCAqLyBoYW5kbGVOb2Rlcyhub2Rlcykge1xuICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgQXJyYXkuZnJvbShub2Rlcykpe1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlTm9kZShub2RlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbnNlcnQgbm9kZXMgY29sbGVjdGVkIGluIHRlbXBvcmFyeSBEb2N1bWVudEZyYWdtZW50LlxuICAgICAgICB0aGlzLl9pbnNlcnRQYXJ0aWFsRnJhZ21lbnQoKTtcbiAgICAgICAgLy8gSWYgdGhlcmUgd2FzIGFuIGF1dG8gcGFyYWdyYXBoIHRoZW4gd2UgbWlnaHQgbmVlZCB0byBhZGp1c3QgdGhlIGVuZCBvZiBpbnNlcnRpb24uXG4gICAgICAgIGlmICh0aGlzLl9sYXN0QXV0b1BhcmFncmFwaCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlTGFzdE5vZGVGcm9tQXV0b1BhcmFncmFwaCh0aGlzLl9sYXN0QXV0b1BhcmFncmFwaCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQWZ0ZXIgdGhlIGNvbnRlbnQgd2FzIGluc2VydGVkIHdlIG1heSB0cnkgdG8gbWVyZ2UgaXQgd2l0aCBpdHMgbmV4dCBzaWJsaW5nIGlmIHRoZSBzZWxlY3Rpb24gd2FzIGluIGl0IGluaXRpYWxseS5cbiAgICAgICAgLy8gTWVyZ2luZyB3aXRoIHRoZSBwcmV2aW91cyBzaWJsaW5nIHdhcyBwZXJmb3JtZWQganVzdCBhZnRlciBpbnNlcnRpbmcgdGhlIGZpcnN0IG5vZGUgdG8gdGhlIGRvY3VtZW50LlxuICAgICAgICB0aGlzLl9tZXJnZU9uUmlnaHQoKTtcbiAgICAgICAgLy8gVE1QIHRoaXMgd2lsbCBiZWNvbWUgYSBwb3N0LWZpeGVyLlxuICAgICAgICB0aGlzLnNjaGVtYS5yZW1vdmVEaXNhbGxvd2VkQXR0cmlidXRlcyh0aGlzLl9maWx0ZXJBdHRyaWJ1dGVzT2YsIHRoaXMud3JpdGVyKTtcbiAgICAgICAgdGhpcy5fZmlsdGVyQXR0cmlidXRlc09mID0gW107XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIHRoZSBsYXN0IG5vZGUgYWZ0ZXIgdGhlIGF1dG8gcGFyYWdyYXBoaW5nLlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBUaGUgbGFzdCBhdXRvIHBhcmFncmFwaGluZyBub2RlLlxuXHQgKi8gX3VwZGF0ZUxhc3ROb2RlRnJvbUF1dG9QYXJhZ3JhcGgobm9kZSkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbkFmdGVyTGFzdE5vZGUgPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHRoaXMuX2xhc3ROb2RlKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb25BZnRlck5vZGUgPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKG5vZGUpO1xuICAgICAgICAvLyBJZiB0aGUgcmVhbCBlbmQgd2FzIGFmdGVyIHRoZSBsYXN0IGF1dG8gcGFyYWdyYXBoIHRoZW4gdXBkYXRlIHJlbGV2YW50IHByb3BlcnRpZXMuXG4gICAgICAgIGlmIChwb3NpdGlvbkFmdGVyTm9kZS5pc0FmdGVyKHBvc2l0aW9uQWZ0ZXJMYXN0Tm9kZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2xhc3ROb2RlID0gbm9kZTtcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAtLSBAcHJlc2VydmUgKi8gaWYgKHRoaXMucG9zaXRpb24ucGFyZW50ICE9IG5vZGUgfHwgIXRoaXMucG9zaXRpb24uaXNBdEVuZCkge1xuICAgICAgICAgICAgICAgIC8vIEFsZ29yaXRobSdzIGNvcnJlY3RuZXNzIGNoZWNrLiBXZSBzaG91bGQgbmV2ZXIgZW5kIHVwIGhlcmUgYnV0IGl0J3MgZ29vZCB0byBrbm93IHRoYXQgd2UgZGlkLlxuICAgICAgICAgICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgdGhlIGluc2VydGlvbiBwb3NpdGlvbiBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgbGFzdCBhdXRvIHBhcmFncmFwaC5cbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGlzIGVycm9yIGlzIGRvY3VtZW50ZWQgaW4gb3RoZXIgcGxhY2UgaW4gdGhpcyBmaWxlLlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdpbnNlcnRjb250ZW50LWludmFsaWQtaW5zZXJ0aW9uLXBvc2l0aW9uJywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb25BZnRlck5vZGU7XG4gICAgICAgICAgICB0aGlzLl9zZXRBZmZlY3RlZEJvdW5kYXJpZXModGhpcy5wb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgcmFuZ2UgdG8gYmUgc2VsZWN0ZWQgYWZ0ZXIgaW5zZXJ0aW9uLlxuXHQgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBpcyBubyB2YWxpZCByYW5nZSB0byBzZWxlY3QgYWZ0ZXIgaW5zZXJ0aW9uLlxuXHQgKi8gZ2V0U2VsZWN0aW9uUmFuZ2UoKSB7XG4gICAgICAgIGlmICh0aGlzLl9ub2RlVG9TZWxlY3QpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5fY3JlYXRlT24odGhpcy5fbm9kZVRvU2VsZWN0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5zY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKHRoaXMucG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHJhbmdlIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgcGVyZm9ybWVkIGNoYW5nZXMuIFRoaXMgaXMgYSByYW5nZSB0aGF0LCBpZiByZW1vdmVkLCB3b3VsZCByZXR1cm4gdGhlIG1vZGVsIHRvIHRoZSBzdGF0ZVxuXHQgKiBiZWZvcmUgdGhlIGluc2VydGlvbi4gUmV0dXJucyBgbnVsbGAgaWYgbm8gY2hhbmdlcyB3ZXJlIGRvbmUuXG5cdCAqLyBnZXRBZmZlY3RlZFJhbmdlKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2FmZmVjdGVkU3RhcnQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5fYWZmZWN0ZWRTdGFydCwgdGhpcy5fYWZmZWN0ZWRFbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogRGVzdHJveXMgYEluc2VydGlvbmAgaW5zdGFuY2UuXG5cdCAqLyBkZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5fYWZmZWN0ZWRTdGFydCkge1xuICAgICAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydC5kZXRhY2goKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYWZmZWN0ZWRFbmQpIHtcbiAgICAgICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kLmRldGFjaCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIYW5kbGVzIGluc2VydGlvbiBvZiBhIHNpbmdsZSBub2RlLlxuXHQgKi8gX2hhbmRsZU5vZGUobm9kZSkge1xuICAgICAgICAvLyBTcGxpdCB0aGUgcG9zaXRpb24ucGFyZW50J3MgYnJhbmNoIHVwIHRvIGEgcG9pbnQgd2hlcmUgdGhlIG5vZGUgY2FuIGJlIGluc2VydGVkLlxuICAgICAgICAvLyBJZiBpdCBpc24ndCBhbGxvd2VkIGluIHRoZSB3aG9sZSBicmFuY2gsIHRoZW4gb2YgY291cnNlIGRvbid0IHNwbGl0IGFueXRoaW5nLlxuICAgICAgICBpZiAoIXRoaXMuX2NoZWNrQW5kU3BsaXRUb0FsbG93ZWRQb3NpdGlvbihub2RlKSkge1xuICAgICAgICAgICAgLy8gSGFuZGxlIGVsZW1lbnQgY2hpbGRyZW4gaWYgaXQncyBub3QgYW4gb2JqZWN0IChzdHJpcCBjb250YWluZXIpLlxuICAgICAgICAgICAgaWYgKCF0aGlzLnNjaGVtYS5pc09iamVjdChub2RlKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZURpc2FsbG93ZWROb2RlKG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFkZCBub2RlIHRvIHRoZSBjdXJyZW50IHRlbXBvcmFyeSBEb2N1bWVudEZyYWdtZW50LlxuICAgICAgICB0aGlzLl9hcHBlbmRUb0ZyYWdtZW50KG5vZGUpO1xuICAgICAgICAvLyBTdG9yZSB0aGUgZmlyc3QgYW5kIGxhc3Qgbm9kZXMgZm9yIGVhc3kgYWNjZXNzIGZvciBtZXJnaW5nIHdpdGggc2libGluZyBub2Rlcy5cbiAgICAgICAgaWYgKCF0aGlzLl9maXJzdE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpcnN0Tm9kZSA9IG5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbGFzdE5vZGUgPSBub2RlO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyB0aGUgdGVtcG9yYXJ5IERvY3VtZW50RnJhZ21lbnQgaW50byB0aGUgbW9kZWwuXG5cdCAqLyBfaW5zZXJ0UGFydGlhbEZyYWdtZW50KCkge1xuICAgICAgICBpZiAodGhpcy5fZG9jdW1lbnRGcmFnbWVudC5pc0VtcHR5KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGl2ZVBvc2l0aW9uID0gTGl2ZVBvc2l0aW9uLmZyb21Qb3NpdGlvbih0aGlzLnBvc2l0aW9uLCAndG9OZXh0Jyk7XG4gICAgICAgIHRoaXMuX3NldEFmZmVjdGVkQm91bmRhcmllcyh0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgLy8gSWYgdGhlIHZlcnkgZmlyc3Qgbm9kZSBvZiB0aGUgd2hvbGUgaW5zZXJ0aW9uIHByb2Nlc3MgaXMgaW5zZXJ0ZWQsIGluc2VydCBpdCBzZXBhcmF0ZWx5IGZvciBPVCByZWFzb25zICh1bmRvKS5cbiAgICAgICAgLy8gTm90ZTogdGhlcmUgY2FuIGJlIG11bHRpcGxlIGNhbGxzIHRvIGBfaW5zZXJ0UGFydGlhbEZyYWdtZW50KClgIGR1cmluZyBvbmUgaW5zZXJ0aW9uIHByb2Nlc3MuXG4gICAgICAgIC8vIE5vdGU6IG9ubHkgdGhlIHZlcnkgZmlyc3Qgbm9kZSBjYW4gYmUgbWVyZ2VkIHNvIHdlIGhhdmUgdG8gZG8gc2VwYXJhdGUgb3BlcmF0aW9uIG9ubHkgZm9yIGl0LlxuICAgICAgICBpZiAodGhpcy5fZG9jdW1lbnRGcmFnbWVudC5nZXRDaGlsZCgwKSA9PSB0aGlzLl9maXJzdE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMud3JpdGVyLmluc2VydCh0aGlzLl9maXJzdE5vZGUsIHRoaXMucG9zaXRpb24pO1xuICAgICAgICAgICAgLy8gV2UgbXVzdCBtZXJnZSB0aGUgZmlyc3Qgbm9kZSBqdXN0IGFmdGVyIGluc2VydGluZyBpdCB0byBhdm9pZCBwcm9ibGVtcyB3aXRoIE9ULlxuICAgICAgICAgICAgLy8gKFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9wdWxsLzg3NzMjaXNzdWVjb21tZW50LTc2MDk0NTY1MikuXG4gICAgICAgICAgICB0aGlzLl9tZXJnZU9uTGVmdCgpO1xuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGxpdmVQb3NpdGlvbi50b1Bvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5zZXJ0IHRoZSByZW1haW5pbmcgbm9kZXMgZnJvbSBkb2N1bWVudCBmcmFnbWVudC5cbiAgICAgICAgaWYgKCF0aGlzLl9kb2N1bWVudEZyYWdtZW50LmlzRW1wdHkpIHtcbiAgICAgICAgICAgIHRoaXMud3JpdGVyLmluc2VydCh0aGlzLl9kb2N1bWVudEZyYWdtZW50LCB0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kb2N1bWVudEZyYWdtZW50UG9zaXRpb24gPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHRoaXMuX2RvY3VtZW50RnJhZ21lbnQsIDApO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gbGl2ZVBvc2l0aW9uLnRvUG9zaXRpb24oKTtcbiAgICAgICAgbGl2ZVBvc2l0aW9uLmRldGFjaCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQHBhcmFtIG5vZGUgVGhlIGRpc2FsbG93ZWQgbm9kZSB3aGljaCBuZWVkcyB0byBiZSBoYW5kbGVkLlxuXHQgKi8gX2hhbmRsZURpc2FsbG93ZWROb2RlKG5vZGUpIHtcbiAgICAgICAgLy8gSWYgdGhlIG5vZGUgaXMgYW4gZWxlbWVudCwgdHJ5IGluc2VydGluZyBpdHMgY2hpbGRyZW4gKHN0cmlwIHRoZSBwYXJlbnQpLlxuICAgICAgICBpZiAobm9kZS5pcygnZWxlbWVudCcpKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZU5vZGVzKG5vZGUuZ2V0Q2hpbGRyZW4oKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEFwcGVuZCBhIG5vZGUgdG8gdGhlIHRlbXBvcmFyeSBEb2N1bWVudEZyYWdtZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gbm9kZSBUaGUgbm9kZSB0byBpbnNlcnQuXG5cdCAqLyBfYXBwZW5kVG9GcmFnbWVudChub2RlKSB7XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAtLSBAcHJlc2VydmUgKi8gaWYgKCF0aGlzLnNjaGVtYS5jaGVja0NoaWxkKHRoaXMucG9zaXRpb24sIG5vZGUpKSB7XG4gICAgICAgICAgICAvLyBBbGdvcml0aG0ncyBjb3JyZWN0bmVzcyBjaGVjay4gV2Ugc2hvdWxkIG5ldmVyIGVuZCB1cCBoZXJlIGJ1dCBpdCdzIGdvb2QgdG8ga25vdyB0aGF0IHdlIGRpZC5cbiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBpdCB3b3VsZCBvZnRlbiBiZSBhIHNpbGVudCBpc3N1ZSBpZiB3ZSBpbnNlcnQgbm9kZSBpbiBhIHBsYWNlIHdoZXJlIGl0J3Mgbm90IGFsbG93ZWQuXG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEdpdmVuIG5vZGUgY2Fubm90IGJlIGluc2VydGVkIG9uIHRoZSBnaXZlbiBwb3NpdGlvbi5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgaW5zZXJ0Y29udGVudC13cm9uZy1wb3NpdGlvblxuXHRcdFx0ICogQHBhcmFtIG5vZGUgTm9kZSB0byBpbnNlcnQuXG5cdFx0XHQgKiBAcGFyYW0gcG9zaXRpb24gUG9zaXRpb24gdG8gaW5zZXJ0IHRoZSBub2RlIGF0LlxuXHRcdFx0ICovIHRocm93IG5ldyBDS0VkaXRvckVycm9yKCdpbnNlcnRjb250ZW50LXdyb25nLXBvc2l0aW9uJywgdGhpcywge1xuICAgICAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHRoaXMucG9zaXRpb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdGVyLmluc2VydChub2RlLCB0aGlzLl9kb2N1bWVudEZyYWdtZW50UG9zaXRpb24pO1xuICAgICAgICB0aGlzLl9kb2N1bWVudEZyYWdtZW50UG9zaXRpb24gPSB0aGlzLl9kb2N1bWVudEZyYWdtZW50UG9zaXRpb24uZ2V0U2hpZnRlZEJ5KG5vZGUub2Zmc2V0U2l6ZSk7XG4gICAgICAgIC8vIFRoZSBsYXN0IGluc2VydGVkIG9iamVjdCBzaG91bGQgYmUgc2VsZWN0ZWQgYmVjYXVzZSB3ZSBjYW4ndCBwdXQgYSBjb2xsYXBzZWQgc2VsZWN0aW9uIGFmdGVyIGl0LlxuICAgICAgICBpZiAodGhpcy5zY2hlbWEuaXNPYmplY3Qobm9kZSkgJiYgIXRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQodGhpcy5wb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHRoaXMuX25vZGVUb1NlbGVjdCA9IG5vZGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9ub2RlVG9TZWxlY3QgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZi5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2V0cyBgX2FmZmVjdGVkU3RhcnRgIGFuZCBgX2FmZmVjdGVkRW5kYCB0byB0aGUgZ2l2ZW4gYHBvc2l0aW9uYC4gU2hvdWxkIGJlIHVzZWQgYmVmb3JlIGEgY2hhbmdlIGlzIGRvbmUgZHVyaW5nIGluc2VydGlvbiBwcm9jZXNzIHRvXG5cdCAqIG1hcmsgdGhlIGFmZmVjdGVkIHJhbmdlLlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIGJlZm9yZSBpbnNlcnRpbmcgYSBub2RlIG9yIHNwbGl0dGluZyBhIHBhcmVudCBub2RlLiBgX2FmZmVjdGVkU3RhcnRgIGFuZCBgX2FmZmVjdGVkRW5kYCBhcmUgYWxzbyBjaGFuZ2VkXG5cdCAqIGR1cmluZyBtZXJnaW5nLCBidXQgdGhlIGxvZ2ljIHRoZXJlIGlzIG1vcmUgY29tcGxpY2F0ZWQgc28gaXQgaXMgbGVmdCBvdXQgb2YgdGhpcyBmdW5jdGlvbi5cblx0ICovIF9zZXRBZmZlY3RlZEJvdW5kYXJpZXMocG9zaXRpb24pIHtcbiAgICAgICAgLy8gU2V0IGFmZmVjdGVkIGJvdW5kYXJpZXMgc3RpY2tpbmVzcyBzbyB0aGF0IHRob3NlIHBvc2l0aW9uIHdpbGwgXCJleHBhbmRcIiB3aGVuIHNvbWV0aGluZyBpcyBpbnNlcnRlZCBpbiBiZXR3ZWVuIHRoZW06XG4gICAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vXVtiYXI8L3BhcmFncmFwaD4gLT4gPHBhcmFncmFwaD5Gb29deHhbYmFyPC9wYXJhZ3JhcGg+XG4gICAgICAgIC8vIFRoaXMgaXMgd2h5IGl0IGNhbm5vdCBiZSBhIHJhbmdlIGJ1dCB0d28gc2VwYXJhdGUgcG9zaXRpb25zLlxuICAgICAgICBpZiAoIXRoaXMuX2FmZmVjdGVkU3RhcnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2FmZmVjdGVkU3RhcnQgPSBMaXZlUG9zaXRpb24uZnJvbVBvc2l0aW9uKHBvc2l0aW9uLCAndG9QcmV2aW91cycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIGBfYWZmZWN0ZWRFbmRgIGlzIGJlZm9yZSB0aGUgbmV3IGJvdW5kYXJ5IHBvc2l0aW9uLCBleHBhbmQgYF9hZmZlY3RlZEVuZGAuIFRoaXMgY2FuIGhhcHBlbiBpZiBmaXJzdCBpbnNlcnRlZCBub2RlIHdhc1xuICAgICAgICAvLyBpbnNlcnRlZCBpbnRvIHRoZSBwYXJlbnQgYnV0IHRoZSBuZXh0IG5vZGUgaXMgbW92ZWQtb3V0IG9mIHRoYXQgcGFyZW50OlxuICAgICAgICAvLyAoMSkgPHBhcmFncmFwaD5Gb29dWzwvcGFyYWdyYXBoPiAtPiA8cGFyYWdyYXBoPkZvb114eFs8L3BhcmFncmFwaD5cbiAgICAgICAgLy8gKDIpIDxwYXJhZ3JhcGg+Rm9vXXh4WzwvcGFyYWdyYXBoPiAtPiA8cGFyYWdyYXBoPkZvb114eDwvcGFyYWdyYXBoPjx3aWRnZXQ+PC93aWRnZXQ+W1xuICAgICAgICBpZiAoIXRoaXMuX2FmZmVjdGVkRW5kIHx8IHRoaXMuX2FmZmVjdGVkRW5kLmlzQmVmb3JlKHBvc2l0aW9uKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2FmZmVjdGVkRW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWZmZWN0ZWRFbmQuZGV0YWNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZCA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24ocG9zaXRpb24sICd0b05leHQnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogTWVyZ2VzIHRoZSBwcmV2aW91cyBzaWJsaW5nIG9mIHRoZSBmaXJzdCBub2RlIGlmIGl0IHNob3VsZCBiZSBtZXJnZWQuXG5cdCAqXG5cdCAqIEFmdGVyIHRoZSBjb250ZW50IHdhcyBpbnNlcnRlZCB3ZSBtYXkgdHJ5IHRvIG1lcmdlIGl0IHdpdGggaXRzIHNpYmxpbmdzLlxuXHQgKiBUaGlzIHNob3VsZCBoYXBwZW4gb25seSBpZiB0aGUgc2VsZWN0aW9uIHdhcyBpbiB0aG9zZSBlbGVtZW50cyBpbml0aWFsbHkuXG5cdCAqLyBfbWVyZ2VPbkxlZnQoKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLl9maXJzdE5vZGU7XG4gICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fY2FuTWVyZ2VMZWZ0KG5vZGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWVyZ2VQb3NMZWZ0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVCZWZvcmUobm9kZSk7XG4gICAgICAgIG1lcmdlUG9zTGVmdC5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgICAgIGNvbnN0IGxpdmVQb3NpdGlvbiA9IExpdmVQb3NpdGlvbi5mcm9tUG9zaXRpb24odGhpcy5wb3NpdGlvbiwgJ3RvTmV4dCcpO1xuICAgICAgICAvLyBJZiBgX2FmZmVjdGVkU3RhcnRgIGlzIHNhbWVzIGFzIG1lcmdlIHBvc2l0aW9uLCBpdCBtZWFucyB0aGF0IHRoZSBlbGVtZW50IFwibWFya2VkXCIgYnkgYF9hZmZlY3RlZFN0YXJ0YCBpcyBnb2luZyB0byBiZVxuICAgICAgICAvLyByZW1vdmVkIGFuZCBpdHMgY29udGVudHMgd2lsbCBiZSBtb3ZlZC4gVGhpcyB3b24ndCB0cmFuc2Zvcm0gYExpdmVQb3NpdGlvbmAgc28gYF9hZmZlY3RlZFN0YXJ0YCBuZWVkcyB0byBiZSBtb3ZlZFxuICAgICAgICAvLyBieSBoYW5kIHRvIHByb3Blcmx5IHJlZmxlY3QgYWZmZWN0ZWQgcmFuZ2UuIChEdWUgdG8gYF9hZmZlY3RlZFN0YXJ0YCBhbmQgYF9hZmZlY3RlZEVuZGAgc3RpY2tpbmVzcywgdGhlIFwicmFuZ2VcIiBpc1xuICAgICAgICAvLyBzaG93biBhcyBgXVtgKS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gRXhhbXBsZSAtIGluc2VydCBgPHBhcmFncmFwaD5BYmM8L3BhcmFncmFwaD48cGFyYWdyYXBoPlh5ejwvcGFyYWdyYXBoPmAgYXQgdGhlIGVuZCBvZiBgPHBhcmFncmFwaD5Gb29ePC9wYXJhZ3JhcGg+YDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPlxuICAgICAgICAvLyA8cGFyYWdyYXBoPkZvbzwvcGFyYWdyYXBoPl08cGFyYWdyYXBoPkFiYzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+ICAgLS0+XG4gICAgICAgIC8vIDxwYXJhZ3JhcGg+Rm9vXUFiYzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+WHl6PC9wYXJhZ3JhcGg+WzxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+XG4gICAgICAgIC8vXG4gICAgICAgIC8vIE5vdGUsIHRoYXQgaWYgd2UgYXJlIGhlcmUgdGhlbiBzb21ldGhpbmcgbXVzdCBoYXZlIGJlZW4gaW5zZXJ0ZWQsIHNvIGBfYWZmZWN0ZWRTdGFydGAgYW5kIGBfYWZmZWN0ZWRFbmRgIGhhdmUgdG8gYmUgc2V0LlxuICAgICAgICBpZiAodGhpcy5fYWZmZWN0ZWRTdGFydC5pc0VxdWFsKG1lcmdlUG9zTGVmdCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2FmZmVjdGVkU3RhcnQuZGV0YWNoKCk7XG4gICAgICAgICAgICB0aGlzLl9hZmZlY3RlZFN0YXJ0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc0xlZnQubm9kZUJlZm9yZSwgJ2VuZCcsICd0b1ByZXZpb3VzJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgbmVlZCB0byB1cGRhdGUgdGhlIHJlZmVyZW5jZXMgdG8gdGhlIGZpcnN0IGFuZCBsYXN0IG5vZGVzIGlmIHRoZXkgd2lsbCBiZSBtZXJnZWQgaW50byB0aGUgcHJldmlvdXMgc2libGluZyBub2RlXG4gICAgICAgIC8vIGJlY2F1c2UgdGhlIHJlZmVyZW5jZSB3b3VsZCBwb2ludCB0byB0aGUgcmVtb3ZlZCBub2RlLlxuICAgICAgICAvL1xuICAgICAgICAvLyA8cD5BXkE8L3A+ICsgPHA+WDwvcD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gPHA+QTwvcD5ePHA+QTwvcD5cbiAgICAgICAgLy8gPHA+QTwvcD48cD5YPC9wPjxwPkE8L3A+XG4gICAgICAgIC8vIDxwPkFYPC9wPjxwPkE8L3A+XG4gICAgICAgIC8vIDxwPkFYQTwvcD5cbiAgICAgICAgaWYgKHRoaXMuX2ZpcnN0Tm9kZSA9PT0gdGhpcy5fbGFzdE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpcnN0Tm9kZSA9IG1lcmdlUG9zTGVmdC5ub2RlQmVmb3JlO1xuICAgICAgICAgICAgdGhpcy5fbGFzdE5vZGUgPSBtZXJnZVBvc0xlZnQubm9kZUJlZm9yZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndyaXRlci5tZXJnZShtZXJnZVBvc0xlZnQpO1xuICAgICAgICAvLyBJZiBvbmx5IG9uZSBlbGVtZW50ICh0aGUgbWVyZ2VkIG9uZSkgaXMgaW4gdGhlIFwiYWZmZWN0ZWQgcmFuZ2VcIiwgYWxzbyBtb3ZlIHRoZSBhZmZlY3RlZCByYW5nZSBlbmQgYXBwcm9wcmlhdGVseS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gRXhhbXBsZSAtIGluc2VydCBgPHBhcmFncmFwaD5BYmM8L3BhcmFncmFwaD5gIGF0IHRoZSBvZiBgPHBhcmFncmFwaD5Gb29ePC9wYXJhZ3JhcGg+YDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPlxuICAgICAgICAvLyA8cGFyYWdyYXBoPkZvbzwvcGFyYWdyYXBoPl08cGFyYWdyYXBoPkFiYzwvcGFyYWdyYXBoPls8cGFyYWdyYXBoPkJhcjwvcGFyYWdyYXBoPiAgIC0tPlxuICAgICAgICAvLyA8cGFyYWdyYXBoPkZvb11BYmM8L3BhcmFncmFwaD5bPHBhcmFncmFwaD5CYXI8L3BhcmFncmFwaD4gICAtLT5cbiAgICAgICAgLy8gPHBhcmFncmFwaD5Gb29dQWJjWzwvcGFyYWdyYXBoPjxwYXJhZ3JhcGg+QmFyPC9wYXJhZ3JhcGg+XG4gICAgICAgIGlmIChtZXJnZVBvc0xlZnQuaXNFcXVhbCh0aGlzLl9hZmZlY3RlZEVuZCkgJiYgdGhpcy5fZmlyc3ROb2RlID09PSB0aGlzLl9sYXN0Tm9kZSkge1xuICAgICAgICAgICAgdGhpcy5fYWZmZWN0ZWRFbmQuZGV0YWNoKCk7XG4gICAgICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZCA9IExpdmVQb3NpdGlvbi5fY3JlYXRlQXQobWVyZ2VQb3NMZWZ0Lm5vZGVCZWZvcmUsICdlbmQnLCAndG9OZXh0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGxpdmVQb3NpdGlvbi50b1Bvc2l0aW9uKCk7XG4gICAgICAgIGxpdmVQb3NpdGlvbi5kZXRhY2goKTtcbiAgICAgICAgLy8gQWZ0ZXIgbWVyZ2UgZWxlbWVudHMgdGhhdCB3ZXJlIG1hcmtlZCBieSBfaW5zZXJ0KCkgdG8gYmUgZmlsdGVyZWQgbWlnaHQgYmUgZ29uZSBzb1xuICAgICAgICAvLyB3ZSBuZWVkIHRvIG1hcmsgdGhlIG5ldyBjb250YWluZXIuXG4gICAgICAgIHRoaXMuX2ZpbHRlckF0dHJpYnV0ZXNPZi5wdXNoKHRoaXMucG9zaXRpb24ucGFyZW50KTtcbiAgICAgICAgbWVyZ2VQb3NMZWZ0LmRldGFjaCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogTWVyZ2VzIHRoZSBuZXh0IHNpYmxpbmcgb2YgdGhlIGxhc3Qgbm9kZSBpZiBpdCBzaG91bGQgYmUgbWVyZ2VkLlxuXHQgKlxuXHQgKiBBZnRlciB0aGUgY29udGVudCB3YXMgaW5zZXJ0ZWQgd2UgbWF5IHRyeSB0byBtZXJnZSBpdCB3aXRoIGl0cyBzaWJsaW5ncy5cblx0ICogVGhpcyBzaG91bGQgaGFwcGVuIG9ubHkgaWYgdGhlIHNlbGVjdGlvbiB3YXMgaW4gdGhvc2UgZWxlbWVudHMgaW5pdGlhbGx5LlxuXHQgKi8gX21lcmdlT25SaWdodCgpIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMuX2xhc3ROb2RlO1xuICAgICAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgRWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2Nhbk1lcmdlUmlnaHQobm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXJnZVBvc1JpZ2h0ID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBZnRlcihub2RlKTtcbiAgICAgICAgbWVyZ2VQb3NSaWdodC5zdGlja2luZXNzID0gJ3RvTmV4dCc7XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAtLSBAcHJlc2VydmUgKi8gaWYgKCF0aGlzLnBvc2l0aW9uLmlzRXF1YWwobWVyZ2VQb3NSaWdodCkpIHtcbiAgICAgICAgICAgIC8vIEFsZ29yaXRobSdzIGNvcnJlY3RuZXNzIGNoZWNrLiBXZSBzaG91bGQgbmV2ZXIgZW5kIHVwIGhlcmUgYnV0IGl0J3MgZ29vZCB0byBrbm93IHRoYXQgd2UgZGlkLlxuICAgICAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB0aGUgaW5zZXJ0aW9uIHBvc2l0aW9uIHNob3VsZCBiZSBhZnRlciB0aGUgbm9kZSB3ZSdsbCBtZXJnZS4gSWYgaXQgaXNuJ3QsXG4gICAgICAgICAgICAvLyBpdCBzaG91bGQgbmVlZCB0byBiZSBzZWN1cmVkIGFzIGluIHRoZSBsZWZ0IG1lcmdlIGNhc2UuXG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEFuIGludGVybmFsIGVycm9yIG9jY3VycmVkIHdoZW4gbWVyZ2luZyBpbnNlcnRlZCBjb250ZW50IHdpdGggaXRzIHNpYmxpbmdzLlxuXHRcdFx0ICogVGhlIGluc2VydGlvbiBwb3NpdGlvbiBzaG91bGQgZXF1YWwgdGhlIG1lcmdlIHBvc2l0aW9uLlxuXHRcdFx0ICpcblx0XHRcdCAqIElmIHlvdSBlbmNvdW50ZXJlZCB0aGlzIGVycm9yLCByZXBvcnQgaXQgYmFjayB0byB0aGUgQ0tFZGl0b3IgNSB0ZWFtXG5cdFx0XHQgKiB3aXRoIGFzIG1hbnkgZGV0YWlscyBhcyBwb3NzaWJsZSByZWdhcmRpbmcgdGhlIGNvbnRlbnQgYmVpbmcgaW5zZXJ0ZWQgYW5kIHRoZSBpbnNlcnRpb24gcG9zaXRpb24uXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIGluc2VydGNvbnRlbnQtaW52YWxpZC1pbnNlcnRpb24tcG9zaXRpb25cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignaW5zZXJ0Y29udGVudC1pbnZhbGlkLWluc2VydGlvbi1wb3NpdGlvbicsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE1vdmUgdGhlIHBvc2l0aW9uIHRvIHRoZSBwcmV2aW91cyBub2RlLCBzbyBpdCBpc24ndCBtb3ZlZCB0byB0aGUgZ3JhdmV5YXJkIG9uIG1lcmdlLlxuICAgICAgICAvLyA8cD54PC9wPltdPHA+eTwvcD4gPT4gPHA+eFtdPC9wPjxwPnk8L3A+XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBQb3NpdGlvbi5fY3JlYXRlQXQobWVyZ2VQb3NSaWdodC5ub2RlQmVmb3JlLCAnZW5kJyk7XG4gICAgICAgIC8vIEV4cGxhbmF0aW9uIG9mIHNldHRpbmcgcG9zaXRpb24gc3RpY2tpbmVzcyB0byBgJ3RvUHJldmlvdXMnYDpcbiAgICAgICAgLy8gT0s6ICA8cD54eFtdPC9wPiArIDxwPnl5PC9wPiA9PiA8cD54eFtdeXk8L3A+ICh3aGVuIHN0aWNrcyB0byBwcmV2aW91cylcbiAgICAgICAgLy8gTk9LOiA8cD54eFtdPC9wPiArIDxwPnl5PC9wPiA9PiA8cD54eHl5W108L3A+ICh3aGVuIHN0aWNrcyB0byBuZXh0KVxuICAgICAgICBjb25zdCBsaXZlUG9zaXRpb24gPSBMaXZlUG9zaXRpb24uZnJvbVBvc2l0aW9uKHRoaXMucG9zaXRpb24sICd0b1ByZXZpb3VzJyk7XG4gICAgICAgIC8vIFNlZSBjb21tZW50IGluIGBfbWVyZ2VPbkxlZnQoKWAgb24gbW92aW5nIGBfYWZmZWN0ZWRTdGFydGAuXG4gICAgICAgIGlmICh0aGlzLl9hZmZlY3RlZEVuZC5pc0VxdWFsKG1lcmdlUG9zUmlnaHQpKSB7XG4gICAgICAgICAgICB0aGlzLl9hZmZlY3RlZEVuZC5kZXRhY2goKTtcbiAgICAgICAgICAgIHRoaXMuX2FmZmVjdGVkRW5kID0gTGl2ZVBvc2l0aW9uLl9jcmVhdGVBdChtZXJnZVBvc1JpZ2h0Lm5vZGVCZWZvcmUsICdlbmQnLCAndG9OZXh0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgbmVlZCB0byB1cGRhdGUgdGhlIHJlZmVyZW5jZXMgdG8gdGhlIGZpcnN0IGFuZCBsYXN0IG5vZGVzIGlmIHRoZXkgd2lsbCBiZSBtZXJnZWQgaW50byB0aGUgcHJldmlvdXMgc2libGluZyBub2RlXG4gICAgICAgIC8vIGJlY2F1c2UgdGhlIHJlZmVyZW5jZSB3b3VsZCBwb2ludCB0byB0aGUgcmVtb3ZlZCBub2RlLlxuICAgICAgICAvL1xuICAgICAgICAvLyA8cD5BXkE8L3A+ICsgPHA+WDwvcD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gPHA+QTwvcD5ePHA+QTwvcD5cbiAgICAgICAgLy8gPHA+QTwvcD48cD5YPC9wPjxwPkE8L3A+XG4gICAgICAgIC8vIDxwPkFYPC9wPjxwPkE8L3A+XG4gICAgICAgIC8vIDxwPkFYQTwvcD5cbiAgICAgICAgaWYgKHRoaXMuX2ZpcnN0Tm9kZSA9PT0gdGhpcy5fbGFzdE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpcnN0Tm9kZSA9IG1lcmdlUG9zUmlnaHQubm9kZUJlZm9yZTtcbiAgICAgICAgICAgIHRoaXMuX2xhc3ROb2RlID0gbWVyZ2VQb3NSaWdodC5ub2RlQmVmb3JlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdGVyLm1lcmdlKG1lcmdlUG9zUmlnaHQpO1xuICAgICAgICAvLyBTZWUgY29tbWVudCBpbiBgX21lcmdlT25MZWZ0KClgIG9uIG1vdmluZyBgX2FmZmVjdGVkU3RhcnRgLlxuICAgICAgICBpZiAobWVyZ2VQb3NSaWdodC5nZXRTaGlmdGVkQnkoLTEpLmlzRXF1YWwodGhpcy5fYWZmZWN0ZWRTdGFydCkgJiYgdGhpcy5fZmlyc3ROb2RlID09PSB0aGlzLl9sYXN0Tm9kZSkge1xuICAgICAgICAgICAgdGhpcy5fYWZmZWN0ZWRTdGFydC5kZXRhY2goKTtcbiAgICAgICAgICAgIHRoaXMuX2FmZmVjdGVkU3RhcnQgPSBMaXZlUG9zaXRpb24uX2NyZWF0ZUF0KG1lcmdlUG9zUmlnaHQubm9kZUJlZm9yZSwgMCwgJ3RvUHJldmlvdXMnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gbGl2ZVBvc2l0aW9uLnRvUG9zaXRpb24oKTtcbiAgICAgICAgbGl2ZVBvc2l0aW9uLmRldGFjaCgpO1xuICAgICAgICAvLyBBZnRlciBtZXJnZSBlbGVtZW50cyB0aGF0IHdlcmUgbWFya2VkIGJ5IF9pbnNlcnQoKSB0byBiZSBmaWx0ZXJlZCBtaWdodCBiZSBnb25lIHNvXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gbWFyayB0aGUgbmV3IGNvbnRhaW5lci5cbiAgICAgICAgdGhpcy5fZmlsdGVyQXR0cmlidXRlc09mLnB1c2godGhpcy5wb3NpdGlvbi5wYXJlbnQpO1xuICAgICAgICBtZXJnZVBvc1JpZ2h0LmRldGFjaCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgc3BlY2lmaWVkIG5vZGUgY2FuIGJlIG1lcmdlZCB3aXRoIHByZXZpb3VzIHNpYmxpbmcgZWxlbWVudC5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgVGhlIG5vZGUgd2hpY2ggY291bGQgcG90ZW50aWFsbHkgYmUgbWVyZ2VkLlxuXHQgKi8gX2Nhbk1lcmdlTGVmdChub2RlKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IG5vZGUucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICByZXR1cm4gcHJldmlvdXNTaWJsaW5nIGluc3RhbmNlb2YgRWxlbWVudCAmJiB0aGlzLmNhbk1lcmdlV2l0aC5oYXMocHJldmlvdXNTaWJsaW5nKSAmJiB0aGlzLm1vZGVsLnNjaGVtYS5jaGVja01lcmdlKHByZXZpb3VzU2libGluZywgbm9kZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciBzcGVjaWZpZWQgbm9kZSBjYW4gYmUgbWVyZ2VkIHdpdGggbmV4dCBzaWJsaW5nIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIFRoZSBub2RlIHdoaWNoIGNvdWxkIHBvdGVudGlhbGx5IGJlIG1lcmdlZC5cblx0ICovIF9jYW5NZXJnZVJpZ2h0KG5vZGUpIHtcbiAgICAgICAgY29uc3QgbmV4dFNpYmxpbmcgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgICByZXR1cm4gbmV4dFNpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIHRoaXMuY2FuTWVyZ2VXaXRoLmhhcyhuZXh0U2libGluZykgJiYgdGhpcy5tb2RlbC5zY2hlbWEuY2hlY2tNZXJnZShub2RlLCBuZXh0U2libGluZyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnNlcnRzIGEgcGFyYWdyYXBoIGFuZCBtb3ZlcyB0aGUgaW5zZXJ0aW9uIHBvc2l0aW9uIGludG8gaXQuXG5cdCAqLyBfaW5zZXJ0QXV0b1BhcmFncmFwaCgpIHtcbiAgICAgICAgLy8gSW5zZXJ0IG5vZGVzIGNvbGxlY3RlZCBpbiB0ZW1wb3JhcnkgRG9jdW1lbnRGcmFnbWVudCBpZiB0aGUgcG9zaXRpb24gcGFyZW50IG5lZWRzIGNoYW5nZSB0byBwcm9jZXNzIGZ1cnRoZXIgbm9kZXMuXG4gICAgICAgIHRoaXMuX2luc2VydFBhcnRpYWxGcmFnbWVudCgpO1xuICAgICAgICAvLyBJbnNlcnQgYSBwYXJhZ3JhcGggYW5kIG1vdmUgaW5zZXJ0aW9uIHBvc2l0aW9uIHRvIGl0LlxuICAgICAgICBjb25zdCBwYXJhZ3JhcGggPSB0aGlzLndyaXRlci5jcmVhdGVFbGVtZW50KCdwYXJhZ3JhcGgnKTtcbiAgICAgICAgdGhpcy53cml0ZXIuaW5zZXJ0KHBhcmFncmFwaCwgdGhpcy5wb3NpdGlvbik7XG4gICAgICAgIHRoaXMuX3NldEFmZmVjdGVkQm91bmRhcmllcyh0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgdGhpcy5fbGFzdEF1dG9QYXJhZ3JhcGggPSBwYXJhZ3JhcGg7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHBhcmFncmFwaCwgMCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIGFuIGFsbG93ZWQgcG9zaXRpb24gd2FzIGZvdW5kLlxuXHQgKiBgZmFsc2VgIGlzIHJldHVybmVkIGlmIHRoZSBub2RlIGlzbid0IGFsbG93ZWQgYXQgYW55IHBvc2l0aW9uIHVwIGluIHRoZSB0cmVlLCBgdHJ1ZWAgaWYgd2FzLlxuXHQgKi8gX2NoZWNrQW5kU3BsaXRUb0FsbG93ZWRQb3NpdGlvbihub2RlKSB7XG4gICAgICAgIGNvbnN0IGFsbG93ZWRJbiA9IHRoaXMuX2dldEFsbG93ZWRJbih0aGlzLnBvc2l0aW9uLnBhcmVudCwgbm9kZSk7XG4gICAgICAgIGlmICghYWxsb3dlZEluKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5zZXJ0IG5vZGVzIGNvbGxlY3RlZCBpbiB0ZW1wb3JhcnkgRG9jdW1lbnRGcmFnbWVudCBpZiB0aGUgcG9zaXRpb24gcGFyZW50IG5lZWRzIGNoYW5nZSB0byBwcm9jZXNzIGZ1cnRoZXIgbm9kZXMuXG4gICAgICAgIGlmIChhbGxvd2VkSW4gIT0gdGhpcy5wb3NpdGlvbi5wYXJlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2luc2VydFBhcnRpYWxGcmFnbWVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlKGFsbG93ZWRJbiAhPSB0aGlzLnBvc2l0aW9uLnBhcmVudCl7XG4gICAgICAgICAgICBpZiAodGhpcy5wb3NpdGlvbi5pc0F0U3RhcnQpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBpbnNlcnRpb24gcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcGFyZW50LCBtb3ZlIGl0IG91dCBpbnN0ZWFkIG9mIHNwbGl0dGluZy5cbiAgICAgICAgICAgICAgICAvLyA8cD5eRm9vPC9wPiAtPiBePHA+Rm9vPC9wPlxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMucG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZShwYXJlbnQpO1xuICAgICAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSDigJMgcGFyZW50IGlzIGVtcHR5ICg8cD5ePC9wPikuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyAxLiBwYXJlbnQuaXNFbXB0eVxuICAgICAgICAgICAgICAgIC8vIFdlIGNhbiByZW1vdmUgdGhlIGVsZW1lbnQgYWZ0ZXIgbW92aW5nIGluc2VydGlvbiBwb3NpdGlvbiBvdXQgb2YgaXQuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyAyLiBwYXJlbnQucGFyZW50ID09PSBhbGxvd2VkSW5cbiAgICAgICAgICAgICAgICAvLyBIb3dldmVyIHBhcmVudCBzaG91bGQgcmVtYWluIGluIHBsYWNlIHdoZW4gYWxsb3dlZCBlbGVtZW50IGlzIGFib3ZlIGxpbWl0IGVsZW1lbnQgaW4gZG9jdW1lbnQgdHJlZS5cbiAgICAgICAgICAgICAgICAvLyBGb3IgZXhhbXBsZSB0aGVyZSBzaG91bGRuJ3QgYmUgYWxsb3dlZCB0byByZW1vdmUgZW1wdHkgcGFyYWdyYXBoIGZyb20gdGFibGVDZWxsLCB3aGVuIGlzIHBhc3RlZFxuICAgICAgICAgICAgICAgIC8vIGNvbnRlbnQgYWxsb3dlZCBpbiAkcm9vdC5cbiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmlzRW1wdHkgJiYgcGFyZW50LnBhcmVudCA9PT0gYWxsb3dlZEluKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVyLnJlbW92ZShwYXJlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wb3NpdGlvbi5pc0F0RW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgaW5zZXJ0aW9uIHBvc2l0aW9uIGlzIGF0IHRoZSBlbmQgb2YgdGhlIHBhcmVudCwgbW92ZSBpdCBvdXQgaW5zdGVhZCBvZiBzcGxpdHRpbmcuXG4gICAgICAgICAgICAgICAgLy8gPHA+Rm9vXjwvcD4gLT4gPHA+Rm9vPC9wPl5cbiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gdGhpcy53cml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih0aGlzLnBvc2l0aW9uLnBhcmVudCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBQb3MgPSB0aGlzLndyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHRoaXMucG9zaXRpb24ucGFyZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRBZmZlY3RlZEJvdW5kYXJpZXModGhpcy5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy53cml0ZXIuc3BsaXQodGhpcy5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHRlbXBQb3M7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW5NZXJnZVdpdGguYWRkKHRoaXMucG9zaXRpb24ubm9kZUFmdGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBBdCB0aGlzIHBvaW50LCB3ZSBzcGxpdCBlbGVtZW50cyB1cCB0byB0aGUgcGFyZW50IGluIHdoaWNoIGBub2RlYCBpcyBhbGxvd2VkLlxuICAgICAgICAvLyBOb3RlIHRoYXQgYF9nZXRBbGxvd2VkSW4oKWAgY2hlY2tzIGlmIHRoZSBgbm9kZWAgaXMgYWxsb3dlZCBlaXRoZXIgZGlyZWN0bHksIG9yIHdoZW4gYXV0by1wYXJhZ3JhcGhlZC5cbiAgICAgICAgLy8gU28sIGxldCdzIGNoZWNrIGlmIHRoZSBgbm9kZWAgaXMgYWxsb3dlZCBkaXJlY3RseS4gSWYgbm90LCB3ZSBuZWVkIHRvIGF1dG8tcGFyYWdyYXBoIGl0LlxuICAgICAgICBpZiAoIXRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQodGhpcy5wb3NpdGlvbi5wYXJlbnQsIG5vZGUpKSB7XG4gICAgICAgICAgICB0aGlzLl9pbnNlcnRBdXRvUGFyYWdyYXBoKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIHRoZSBlbGVtZW50IGluIHdoaWNoIHRoZSBnaXZlbiBub2RlIGlzIGFsbG93ZWQuIEl0IGNoZWNrcyB0aGUgcGFzc2VkIGVsZW1lbnQgYW5kIGFsbCBpdHMgYW5jZXN0b3JzLlxuXHQgKlxuXHQgKiBJdCBhbHNvIHZlcmlmaWVzIGlmIGF1dG8tcGFyYWdyYXBoaW5nIGNvdWxkIGhlbHAuXG5cdCAqXG5cdCAqIEBwYXJhbSBjb250ZXh0RWxlbWVudCBUaGUgZWxlbWVudCBpbiB3aGljaCBjb250ZXh0IHRoZSBub2RlIHNob3VsZCBiZSBjaGVja2VkLlxuXHQgKiBAcGFyYW0gY2hpbGROb2RlIFRoZSBub2RlIHRvIGNoZWNrLlxuXHQgKi8gX2dldEFsbG93ZWRJbihjb250ZXh0RWxlbWVudCwgY2hpbGROb2RlKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGEgbm9kZSBjYW4gYmUgaW5zZXJ0ZWQgaW4gdGhlIGdpdmVuIGNvbnRleHQuLi5cbiAgICAgICAgaWYgKHRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQoY29udGV4dEVsZW1lbnQsIGNoaWxkTm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0RWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICAvLyAuLi5vciBpdCB3b3VsZCBiZSBhY2NlcHRlZCBpZiBhIHBhcmFncmFwaCB3b3VsZCBiZSBpbnNlcnRlZC5cbiAgICAgICAgaWYgKHRoaXMuc2NoZW1hLmNoZWNrQ2hpbGQoY29udGV4dEVsZW1lbnQsICdwYXJhZ3JhcGgnKSAmJiB0aGlzLnNjaGVtYS5jaGVja0NoaWxkKCdwYXJhZ3JhcGgnLCBjaGlsZE5vZGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGV4dEVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdGhlIGNoaWxkIHdhc24ndCBhbGxvd2VkIGluIHRoZSBjb250ZXh0IGVsZW1lbnQgYW5kIHRoZSBlbGVtZW50IGlzIGEgbGltaXQgdGhlcmUncyBubyBwb2ludCBpblxuICAgICAgICAvLyBjaGVja2luZyBhbnkgZnVydGhlciB0b3dhcmRzIHRoZSByb290LiBUaGlzIGlzIGl0OiB0aGUgbGltaXQgaXMgdW5zcGxpdHRhYmxlIGFuZCB0aGVyZSdzIG5vdGhpbmdcbiAgICAgICAgLy8gd2UgY2FuIGRvIGFib3V0IGl0LiBXaXRob3V0IHRoaXMgY2hlY2ssIHRoZSBhbGdvcml0aG0gd2lsbCBhbmFseXplIHBhcmVudCBvZiB0aGUgbGltaXQgYW5kIG1heSBjcmVhdGVcbiAgICAgICAgLy8gYW4gaWxsdXNpb24gb2YgdGhlIGNoaWxkIGJlaW5nIGFsbG93ZWQuIFRoZXJlJ3Mgbm8gd2F5IHRvIGluc2VydCBpdCBkb3duIHRoZXJlLCB0aG91Z2guIEl0IHJlc3VsdHMgaW5cbiAgICAgICAgLy8gaW5maW5pdGUgbG9vcHMuXG4gICAgICAgIGlmICh0aGlzLnNjaGVtYS5pc0xpbWl0KGNvbnRleHRFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEFsbG93ZWRJbihjb250ZXh0RWxlbWVudC5wYXJlbnQsIGNoaWxkTm9kZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEluc2VydHMgYW4ge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSNvYmplY3QtZWxlbWVudHMgb2JqZWN0IGVsZW1lbnR9IGF0IGEgc3BlY2lmaWMgcG9zaXRpb24gaW4gdGhlIGVkaXRvciBjb250ZW50LlxuICpcbiAqICoqTm90ZToqKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0T2JqZWN0fSBpbnN0ZWFkIG9mIHRoaXMgZnVuY3Rpb24uXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgZXhwb3NlZCB0byBiZSByZXVzYWJsZSBpbiBhbGdvcml0aG1zIHdoaWNoIGNoYW5nZSB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0T2JqZWN0fVxuICogbWV0aG9kJ3MgYmVoYXZpb3IuXG4gKlxuICogKipOb3RlKio6IEZvciBtb3JlIGRvY3VtZW50YXRpb24gYW5kIGV4YW1wbGVzLCBzZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0T2JqZWN0fS5cbiAqXG4gKiBAcGFyYW0gbW9kZWwgVGhlIG1vZGVsIGluIGNvbnRleHQgb2Ygd2hpY2ggdGhlIGluc2VydGlvbiBzaG91bGQgYmUgcGVyZm9ybWVkLlxuICogQHBhcmFtIG9iamVjdCBBbiBvYmplY3QgdG8gYmUgaW5zZXJ0ZWQgaW50byB0aGUgbW9kZWwgZG9jdW1lbnQuXG4gKiBAcGFyYW0gc2VsZWN0YWJsZSBBIHNlbGVjdGFibGUgd2hlcmUgdGhlIGNvbnRlbnQgc2hvdWxkIGJlIGluc2VydGVkLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgY3VycmVudFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjc2VsZWN0aW9uIGRvY3VtZW50IHNlbGVjdGlvbn0gd2lsbCBiZSB1c2VkIGluc3RlYWQuXG4gKiBAcGFyYW0gcGxhY2VPck9mZnNldCBTcGVjaWZpZXMgdGhlIGV4YWN0IHBsYWNlIG9yIG9mZnNldCBmb3IgdGhlIGluc2VydGlvbiB0byB0YWtlIHBsYWNlLCByZWxhdGl2ZSB0byBgc2VsZWN0YWJsZWAuXG4gKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMuXG4gKiBAcGFyYW0gb3B0aW9ucy5maW5kT3B0aW1hbFBvc2l0aW9uIEFuIG9wdGlvbiB0aGF0LCB3aGVuIHNldCwgYWRqdXN0cyB0aGUgaW5zZXJ0aW9uIHBvc2l0aW9uIChyZWxhdGl2ZSB0b1xuICogYHNlbGVjdGFibGVgIGFuZCBgcGxhY2VPck9mZnNldGApIHNvIHRoYXQgdGhlIGNvbnRlbnQgb2YgYHNlbGVjdGFibGVgIGlzIG5vdCBzcGxpdCB1cG9uIGluc2VydGlvbiAoYS5rLmEuIG5vbi1kZXN0cnVjdGl2ZSBpbnNlcnRpb24pLlxuICogKiBXaGVuIGAnYXV0bydgLCB0aGUgYWxnb3JpdGhtIHdpbGwgZGVjaWRlIHdoZXRoZXIgdG8gaW5zZXJ0IHRoZSBvYmplY3QgYmVmb3JlIG9yIGFmdGVyIGBzZWxlY3RhYmxlYCB0byBhdm9pZCBjb250ZW50IHNwbGl0dGluZy5cbiAqICogV2hlbiBgJ2JlZm9yZSdgLCB0aGUgY2xvc2VzdCBwb3NpdGlvbiBiZWZvcmUgYHNlbGVjdGFibGVgIHdpbGwgYmUgdXNlZCB0aGF0IHdpbGwgbm90IHJlc3VsdCBpbiBjb250ZW50IHNwbGl0dGluZy5cbiAqICogV2hlbiBgJ2FmdGVyJ2AsIHRoZSBjbG9zZXN0IHBvc2l0aW9uIGFmdGVyIGBzZWxlY3RhYmxlYCB3aWxsIGJlIHVzZWQgdGhhdCB3aWxsIG5vdCByZXN1bHQgaW4gY29udGVudCBzcGxpdHRpbmcuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgb3B0aW9uIHdvcmtzIG9ubHkgZm9yIGJsb2NrIG9iamVjdHMuIElubGluZSBvYmplY3RzIGFyZSBpbnNlcnRlZCBpbnRvIHRleHQgYW5kIGRvIG5vdCBzcGxpdCBibG9ja3MuXG4gKiBAcGFyYW0gb3B0aW9ucy5zZXRTZWxlY3Rpb24gQW4gb3B0aW9uIHRoYXQsIHdoZW4gc2V0LCBtb3ZlcyB0aGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3NlbGVjdGlvbiBkb2N1bWVudCBzZWxlY3Rpb259IGFmdGVyIGluc2VydGluZyB0aGUgb2JqZWN0LlxuICogKiBXaGVuIGAnb24nYCwgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiB3aWxsIGJlIHNldCBvbiB0aGUgaW5zZXJ0ZWQgb2JqZWN0LlxuICogKiBXaGVuIGAnYWZ0ZXInYCwgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiB3aWxsIG1vdmUgdG8gdGhlIGNsb3Nlc3QgdGV4dCBub2RlIGFmdGVyIHRoZSBpbnNlcnRlZCBvYmplY3QuIElmIHRoZXJlIGlzIG5vXG4gKiBzdWNoIHRleHQgbm9kZSwgYSBwYXJhZ3JhcGggd2lsbCBiZSBjcmVhdGVkIGFuZCB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIHdpbGwgYmUgbW92ZWQgaW5zaWRlIGl0LlxuICogQHJldHVybnMgQSByYW5nZSB3aGljaCBjb250YWlucyBhbGwgdGhlIHBlcmZvcm1lZCBjaGFuZ2VzLiBUaGlzIGlzIGEgcmFuZ2UgdGhhdCwgaWYgcmVtb3ZlZCxcbiAqIHdvdWxkIHJldHVybiB0aGUgbW9kZWwgdG8gdGhlIHN0YXRlIGJlZm9yZSB0aGUgaW5zZXJ0aW9uLiBJZiBubyBjaGFuZ2VzIHdlcmUgcHJlZm9ybWVkIGJ5IGBpbnNlcnRPYmplY3QoKWAsIHJldHVybnMgYSByYW5nZSBjb2xsYXBzZWRcbiAqIGF0IHRoZSBpbnNlcnRpb24gcG9zaXRpb24uXG4gKi8gZnVuY3Rpb24gaW5zZXJ0T2JqZWN0KG1vZGVsLCBvYmplY3QsIHNlbGVjdGFibGUsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghbW9kZWwuc2NoZW1hLmlzT2JqZWN0KG9iamVjdCkpIHtcbiAgICAgICAgLyoqXG5cdFx0ICogVHJpZWQgdG8gaW5zZXJ0IGFuIGVsZW1lbnQgd2l0aCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC91dGlscy9pbnNlcnRvYmplY3QgaW5zZXJ0T2JqZWN0KCl9IGZ1bmN0aW9uXG5cdFx0ICogdGhhdCBpcyBub3QgZGVmaW5lZCBhcyBhbiBvYmplY3QgaW4gc2NoZW1hLlxuXHRcdCAqIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hSXRlbURlZmluaXRpb24jaXNPYmplY3QgYFNjaGVtYUl0ZW1EZWZpbml0aW9uYH0uXG5cdFx0ICogSWYgeW91IHdhbnQgdG8gaW5zZXJ0IGNvbnRlbnQgdGhhdCBpcyBub3QgYW4gb2JqZWN0IHlvdSBtaWdodCB3YW50IHRvIHVzZVxuXHRcdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3V0aWxzL2luc2VydGNvbnRlbnQgaW5zZXJ0Q29udGVudCgpfSBmdW5jdGlvbi5cblx0XHQgKiBAZXJyb3IgaW5zZXJ0b2JqZWN0LWVsZW1lbnQtbm90LWFuLW9iamVjdFxuXHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignaW5zZXJ0b2JqZWN0LWVsZW1lbnQtbm90LWFuLW9iamVjdCcsIG1vZGVsLCB7XG4gICAgICAgICAgICBvYmplY3RcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIE5vcm1hbGl6ZSBzZWxlY3RhYmxlIHRvIGEgc2VsZWN0aW9uIGluc3RhbmNlLlxuICAgIGNvbnN0IG9yaWdpbmFsU2VsZWN0aW9uID0gc2VsZWN0YWJsZSA/IHNlbGVjdGFibGUgOiBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgLy8gQWRqdXN0IHRoZSBpbnNlcnRpb24gc2VsZWN0aW9uLlxuICAgIGxldCBpbnNlcnRpb25TZWxlY3Rpb24gPSBvcmlnaW5hbFNlbGVjdGlvbjtcbiAgICBpZiAob3B0aW9ucy5maW5kT3B0aW1hbFBvc2l0aW9uICYmIG1vZGVsLnNjaGVtYS5pc0Jsb2NrKG9iamVjdCkpIHtcbiAgICAgICAgaW5zZXJ0aW9uU2VsZWN0aW9uID0gbW9kZWwuY3JlYXRlU2VsZWN0aW9uKG1vZGVsLnNjaGVtYS5maW5kT3B0aW1hbEluc2VydGlvblJhbmdlKG9yaWdpbmFsU2VsZWN0aW9uLCBvcHRpb25zLmZpbmRPcHRpbWFsUG9zaXRpb24pKTtcbiAgICB9XG4gICAgLy8gQ29sbGVjdCBhdHRyaWJ1dGVzIHRvIGJlIGNvcGllZCBvbiB0aGUgaW5zZXJ0ZWQgb2JqZWN0LlxuICAgIGNvbnN0IGZpcnN0U2VsZWN0ZWRCbG9jayA9IGZpcnN0KG9yaWdpbmFsU2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgIGNvbnN0IGF0dHJpYnV0ZXNUb0NvcHkgPSB7fTtcbiAgICBpZiAoZmlyc3RTZWxlY3RlZEJsb2NrKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24oYXR0cmlidXRlc1RvQ29weSwgbW9kZWwuc2NoZW1hLmdldEF0dHJpYnV0ZXNXaXRoUHJvcGVydHkoZmlyc3RTZWxlY3RlZEJsb2NrLCAnY29weU9uUmVwbGFjZScsIHRydWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAvLyBSZW1vdmUgdGhlIHNlbGVjdGVkIGNvbnRlbnQgdG8gZmluZCBvdXQgd2hhdCB0aGUgcGFyZW50IG9mIHRoZSBpbnNlcnRlZCBvYmplY3Qgd291bGQgYmUuXG4gICAgICAgIC8vIEl0IHdvdWxkIGJlIHJlbW92ZWQgaW5zaWRlIG1vZGVsLmluc2VydENvbnRlbnQoKSBhbnl3YXkuXG4gICAgICAgIGlmICghaW5zZXJ0aW9uU2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICBtb2RlbC5kZWxldGVDb250ZW50KGluc2VydGlvblNlbGVjdGlvbiwge1xuICAgICAgICAgICAgICAgIGRvTm90QXV0b3BhcmFncmFwaDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVsZW1lbnRUb0luc2VydCA9IG9iamVjdDtcbiAgICAgICAgY29uc3QgaW5zZXJ0aW9uUG9zaXRpb25QYXJlbnQgPSBpbnNlcnRpb25TZWxlY3Rpb24uYW5jaG9yLnBhcmVudDtcbiAgICAgICAgLy8gQXV0b3BhcmFncmFwaGluZyBvZiBhbiBpbmxpbmUgb2JqZWN0cy5cbiAgICAgICAgaWYgKCFtb2RlbC5zY2hlbWEuY2hlY2tDaGlsZChpbnNlcnRpb25Qb3NpdGlvblBhcmVudCwgb2JqZWN0KSAmJiBtb2RlbC5zY2hlbWEuY2hlY2tDaGlsZChpbnNlcnRpb25Qb3NpdGlvblBhcmVudCwgJ3BhcmFncmFwaCcpICYmIG1vZGVsLnNjaGVtYS5jaGVja0NoaWxkKCdwYXJhZ3JhcGgnLCBvYmplY3QpKSB7XG4gICAgICAgICAgICBlbGVtZW50VG9JbnNlcnQgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCgncGFyYWdyYXBoJyk7XG4gICAgICAgICAgICB3cml0ZXIuaW5zZXJ0KG9iamVjdCwgZWxlbWVudFRvSW5zZXJ0KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBcHBseSBhdHRyaWJ1dGVzIHRoYXQgYXJlIGFsbG93ZWQgb24gdGhlIGluc2VydGVkIG9iamVjdCAob3IgcGFyYWdyYXBoIGlmIGF1dG9wYXJhZ3JhcGhlZCkuXG4gICAgICAgIG1vZGVsLnNjaGVtYS5zZXRBbGxvd2VkQXR0cmlidXRlcyhlbGVtZW50VG9JbnNlcnQsIGF0dHJpYnV0ZXNUb0NvcHksIHdyaXRlcik7XG4gICAgICAgIC8vIEluc2VydCB0aGUgcHJlcGFyZWQgY29udGVudCBhdCB0aGUgb3B0aW9uYWxseSBhZGp1c3RlZCBzZWxlY3Rpb24uXG4gICAgICAgIGNvbnN0IGFmZmVjdGVkUmFuZ2UgPSBtb2RlbC5pbnNlcnRDb250ZW50KGVsZW1lbnRUb0luc2VydCwgaW5zZXJ0aW9uU2VsZWN0aW9uKTtcbiAgICAgICAgLy8gTm90aGluZyBnb3QgaW5zZXJ0ZWQuXG4gICAgICAgIGlmIChhZmZlY3RlZFJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm4gYWZmZWN0ZWRSYW5nZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5zZXRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHVwZGF0ZVNlbGVjdGlvbih3cml0ZXIsIG9iamVjdCwgb3B0aW9ucy5zZXRTZWxlY3Rpb24sIGF0dHJpYnV0ZXNUb0NvcHkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhZmZlY3RlZFJhbmdlO1xuICAgIH0pO1xufVxuLyoqXG4gKiBVcGRhdGVzIGRvY3VtZW50IHNlbGVjdGlvbiBiYXNlZCBvbiBnaXZlbiBgcGxhY2VgIHBhcmFtZXRlciBpbiByZWxhdGlvbiB0byBgY29udGV4dEVsZW1lbnRgIGVsZW1lbnQuXG4gKlxuICogQHBhcmFtIHdyaXRlciBBbiBpbnN0YW5jZSBvZiB0aGUgbW9kZWwgd3JpdGVyLlxuICogQHBhcmFtIGNvbnRleHRFbGVtZW50IEFuIGVsZW1lbnQgdG8gc2V0IHRoZSBhdHRyaWJ1dGVzIG9uLlxuICogQHBhcmFtIHBsYWNlIFRoZSBwbGFjZSB3aGVyZSBzZWxlY3Rpb24gc2hvdWxkIGJlIHNldCBpbiByZWxhdGlvbiB0byB0aGUgYGNvbnRleHRFbGVtZW50YCBlbGVtZW50LlxuICogVmFsdWUgYG9uYCB3aWxsIHNldCBzZWxlY3Rpb24gb24gdGhlIHBhc3NlZCBgY29udGV4dEVsZW1lbnRgLiBWYWx1ZSBgYWZ0ZXJgIHdpbGwgc2V0IHNlbGVjdGlvbiBhZnRlciBgY29udGV4dEVsZW1lbnRgLlxuICogQHBhcmFtIGF0dHJpYnV0ZXMgQXR0cmlidXRlcyBrZXlzIGFuZCB2YWx1ZXMgdG8gc2V0IG9uIGEgcGFyYWdyYXBoIHRoYXQgdGhpcyBmdW5jdGlvbiBjYW4gY3JlYXRlIHdoZW5cbiAqIGBwbGFjZWAgcGFyYW1ldGVyIGlzIGVxdWFsIHRvIGBhZnRlcmAgYnV0IHRoZXJlIGlzIG5vIGVsZW1lbnQgd2l0aCBgJHRleHRgIG5vZGUgdG8gc2V0IHNlbGVjdGlvbiBpbi5cbiAqLyBmdW5jdGlvbiB1cGRhdGVTZWxlY3Rpb24od3JpdGVyLCBjb250ZXh0RWxlbWVudCwgcGxhY2UsIHBhcmFncmFwaEF0dHJpYnV0ZXMpIHtcbiAgICBjb25zdCBtb2RlbCA9IHdyaXRlci5tb2RlbDtcbiAgICBpZiAocGxhY2UgPT0gJ29uJykge1xuICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKGNvbnRleHRFbGVtZW50LCAnb24nKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocGxhY2UgIT0gJ2FmdGVyJykge1xuICAgICAgICAvKipcblx0XHQgKiBUaGUgdW5zdXBwb3J0ZWQgYG9wdGlvbnMuc2V0U2VsZWN0aW9uYCBwYXJhbWV0ZXIgd2FzIHBhc3NlZFxuXHRcdCAqIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC91dGlscy9pbnNlcnRvYmplY3QgaW5zZXJ0T2JqZWN0KCl9IGZ1bmN0aW9uLlxuXHRcdCAqIENoZWNrIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC91dGlscy9pbnNlcnRvYmplY3QgaW5zZXJ0T2JqZWN0KCl9IEFQSSBkb2N1bWVudGF0aW9uIGZvciBhbGxvd2VkXG5cdFx0ICogYG9wdGlvbnMuc2V0U2VsZWN0aW9uYCBwYXJhbWV0ZXIgdmFsdWVzLlxuXHRcdCAqXG5cdFx0ICogQGVycm9yIGluc2VydG9iamVjdC1pbnZhbGlkLXBsYWNlLXBhcmFtZXRlci12YWx1ZVxuXHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignaW5zZXJ0b2JqZWN0LWludmFsaWQtcGxhY2UtcGFyYW1ldGVyLXZhbHVlJywgbW9kZWwpO1xuICAgIH1cbiAgICBsZXQgbmV4dEVsZW1lbnQgPSBjb250ZXh0RWxlbWVudC5uZXh0U2libGluZztcbiAgICBpZiAobW9kZWwuc2NoZW1hLmlzSW5saW5lKGNvbnRleHRFbGVtZW50KSkge1xuICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKGNvbnRleHRFbGVtZW50LCAnYWZ0ZXInKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBDaGVjayB3aGV0aGVyIGFuIGVsZW1lbnQgbmV4dCB0byB0aGUgaW5zZXJ0ZWQgZWxlbWVudCBpcyBkZWZpbmVkIGFuZCBjYW4gY29udGFpbiBhIHRleHQuXG4gICAgY29uc3QgY2FuU2V0U2VsZWN0aW9uID0gbmV4dEVsZW1lbnQgJiYgbW9kZWwuc2NoZW1hLmNoZWNrQ2hpbGQobmV4dEVsZW1lbnQsICckdGV4dCcpO1xuICAgIC8vIElmIHRoZSBlbGVtZW50IGlzIG1pc3NpbmcsIGJ1dCBhIHBhcmFncmFwaCBjb3VsZCBiZSBpbnNlcnRlZCBuZXh0IHRvIHRoZSBlbGVtZW50LCBsZXQncyBhZGQgaXQuXG4gICAgaWYgKCFjYW5TZXRTZWxlY3Rpb24gJiYgbW9kZWwuc2NoZW1hLmNoZWNrQ2hpbGQoY29udGV4dEVsZW1lbnQucGFyZW50LCAncGFyYWdyYXBoJykpIHtcbiAgICAgICAgbmV4dEVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCgncGFyYWdyYXBoJyk7XG4gICAgICAgIG1vZGVsLnNjaGVtYS5zZXRBbGxvd2VkQXR0cmlidXRlcyhuZXh0RWxlbWVudCwgcGFyYWdyYXBoQXR0cmlidXRlcywgd3JpdGVyKTtcbiAgICAgICAgbW9kZWwuaW5zZXJ0Q29udGVudChuZXh0RWxlbWVudCwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIoY29udGV4dEVsZW1lbnQpKTtcbiAgICB9XG4gICAgLy8gUHV0IHRoZSBzZWxlY3Rpb24gaW5zaWRlIHRoZSBlbGVtZW50LCBhdCB0aGUgYmVnaW5uaW5nLlxuICAgIGlmIChuZXh0RWxlbWVudCkge1xuICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5leHRFbGVtZW50LCAwKTtcbiAgICB9XG59XG5cbmNvbnN0IHdvcmRCb3VuZGFyeUNoYXJhY3RlcnMgPSAnICwuPyE6O1wiLSgpJztcbi8qKlxuICogTW9kaWZpZXMgdGhlIHNlbGVjdGlvbi4gQ3VycmVudGx5LCB0aGUgc3VwcG9ydGVkIG1vZGlmaWNhdGlvbnMgYXJlOlxuICpcbiAqICogRXh0ZW5kaW5nLiBUaGUgc2VsZWN0aW9uIGZvY3VzIGlzIG1vdmVkIGluIHRoZSBzcGVjaWZpZWQgYG9wdGlvbnMuZGlyZWN0aW9uYCB3aXRoIGEgc3RlcCBzcGVjaWZpZWQgaW4gYG9wdGlvbnMudW5pdGAuXG4gKiBQb3NzaWJsZSB2YWx1ZXMgZm9yIGB1bml0YCBhcmU6XG4gKiAgKiBgJ2NoYXJhY3RlcidgIChkZWZhdWx0KSAtIG1vdmVzIHNlbGVjdGlvbiBieSBvbmUgdXNlci1wZXJjZWl2ZWQgY2hhcmFjdGVyLiBJbiBtb3N0IGNhc2VzIHRoaXMgbWVhbnMgbW92aW5nIGJ5IG9uZVxuICogIGNoYXJhY3RlciBpbiBgU3RyaW5nYCBzZW5zZS4gSG93ZXZlciwgdW5pY29kZSBhbHNvIGRlZmluZXMgXCJjb21iaW5nIG1hcmtzXCIuIFRoZXNlIGFyZSBzcGVjaWFsIHN5bWJvbHMsIHRoYXQgY29tYmluZXNcbiAqICB3aXRoIGEgc3ltYm9sIGJlZm9yZSBpdCAoXCJiYXNlIGNoYXJhY3RlclwiKSB0byBjcmVhdGUgb25lIHVzZXItcGVyY2VpdmVkIGNoYXJhY3Rlci4gRm9yIGV4YW1wbGUsIGBxzIfMo2AgaXMgYSBub3JtYWxcbiAqICBsZXR0ZXIgYHFgIHdpdGggdHdvIFwiY29tYmluaW5nIG1hcmtzXCI6IHVwcGVyIGRvdCAoYFV4MDMwN2ApIGFuZCBsb3dlciBkb3QgKGBVeDAzMjNgKS4gRm9yIG1vc3QgYWN0aW9ucywgaS5lLiBleHRlbmRpbmdcbiAqICBzZWxlY3Rpb24gYnkgb25lIHBvc2l0aW9uLCBpdCBpcyBjb3JyZWN0IHRvIGluY2x1ZGUgYm90aCBcImJhc2UgY2hhcmFjdGVyXCIgYW5kIGFsbCBvZiBpdCdzIFwiY29tYmluaW5nIG1hcmtzXCIuIFRoYXQgaXNcbiAqICB3aHkgYCdjaGFyYWN0ZXInYCB2YWx1ZSBpcyBtb3N0IG5hdHVyYWwgYW5kIGNvbW1vbiBtZXRob2Qgb2YgbW9kaWZ5aW5nIHNlbGVjdGlvbi5cbiAqICAqIGAnY29kZVBvaW50J2AgLSBtb3ZlcyBzZWxlY3Rpb24gYnkgb25lIHVuaWNvZGUgY29kZSBwb2ludC4gSW4gY29udHJhcnkgdG8sIGAnY2hhcmFjdGVyJ2AgdW5pdCwgdGhpcyB3aWxsIGluc2VydFxuICogIHNlbGVjdGlvbiBiZXR3ZWVuIFwiYmFzZSBjaGFyYWN0ZXJcIiBhbmQgXCJjb21iaW5pbmcgbWFya1wiLCBiZWNhdXNlIFwiY29tYmluaW5nIG1hcmtzXCIgaGF2ZSB0aGVpciBvd24gdW5pY29kZSBjb2RlIHBvaW50cy5cbiAqICBIb3dldmVyLCBmb3IgdGVjaG5pY2FsIHJlYXNvbnMsIHVuaWNvZGUgY29kZSBwb2ludHMgd2l0aCB2YWx1ZXMgYWJvdmUgYFV4RkZGRmAgYXJlIHJlcHJlc2VudGVkIGluIG5hdGl2ZSBgU3RyaW5nYCBieVxuICogIHR3byBjaGFyYWN0ZXJzLCBjYWxsZWQgXCJzdXJyb2dhdGUgcGFpcnNcIi4gSGFsdmVzIG9mIFwic3Vycm9nYXRlIHBhaXJzXCIgaGF2ZSBhIG1lYW5pbmcgb25seSB3aGVuIHBsYWNlZCBuZXh0IHRvIGVhY2ggb3RoZXIuXG4gKiAgRm9yIGV4YW1wbGUgYPCorY5gIGlzIHJlcHJlc2VudGVkIGluIGBTdHJpbmdgIGJ5IGBcXHVEODYyXFx1REY0RWAuIEJvdGggYFxcdUQ4NjJgIGFuZCBgXFx1REY0RWAgZG8gbm90IGhhdmUgYW55IG1lYW5pbmdcbiAqICBvdXRzaWRlIHRoZSBwYWlyIChhcmUgcmVuZGVyZWQgYXMgPyB3aGVuIGFsb25lKS4gUG9zaXRpb24gYmV0d2VlbiB0aGVtIHdvdWxkIGJlIGluY29ycmVjdC4gSW4gdGhpcyBjYXNlLCBzZWxlY3Rpb25cbiAqICBleHRlbnNpb24gd2lsbCBpbmNsdWRlIHdob2xlIFwic3Vycm9nYXRlIHBhaXJcIi5cbiAqICAqIGAnd29yZCdgIC0gbW92ZXMgc2VsZWN0aW9uIGJ5IGEgd2hvbGUgd29yZC5cbiAqXG4gKiAqKk5vdGU6KiogaWYgeW91IGV4dGVuZCBhIGZvcndhcmQgc2VsZWN0aW9uIGluIGEgYmFja3dhcmQgZGlyZWN0aW9uIHlvdSB3aWxsIGluIGZhY3Qgc2hyaW5rIGl0LlxuICpcbiAqICoqTm90ZToqKiBVc2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjbW9kaWZ5U2VsZWN0aW9ufSBpbnN0ZWFkIG9mIHRoaXMgZnVuY3Rpb24uXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgZXhwb3NlZCB0byBiZSByZXVzYWJsZSBpbiBhbGdvcml0aG1zXG4gKiB3aGljaCBjaGFuZ2UgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI21vZGlmeVNlbGVjdGlvbn1cbiAqIG1ldGhvZCdzIGJlaGF2aW9yLlxuICpcbiAqIEBwYXJhbSBtb2RlbCBUaGUgbW9kZWwgaW4gY29udGV4dCBvZiB3aGljaCB0aGUgc2VsZWN0aW9uIG1vZGlmaWNhdGlvbiBzaG91bGQgYmUgcGVyZm9ybWVkLlxuICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIHRvIG1vZGlmeS5cbiAqIEBwYXJhbSBvcHRpb25zLmRpcmVjdGlvbiBUaGUgZGlyZWN0aW9uIGluIHdoaWNoIHRoZSBzZWxlY3Rpb24gc2hvdWxkIGJlIG1vZGlmaWVkLiBEZWZhdWx0ICdmb3J3YXJkJy5cbiAqIEBwYXJhbSBvcHRpb25zLnVuaXQgVGhlIHVuaXQgYnkgd2hpY2ggc2VsZWN0aW9uIHNob3VsZCBiZSBtb2RpZmllZC4gRGVmYXVsdCAnY2hhcmFjdGVyJy5cbiAqIEBwYXJhbSBvcHRpb25zLnRyZWF0RW1vamlBc1NpbmdsZVVuaXQgV2hldGhlciBtdWx0aS1jaGFyYWNlciBlbW9qaSBzZXF1ZW5jZXMgc2hvdWxkIGJlIGhhbmRsZWQgYXMgc2luZ2xlIHVuaXQuXG4gKi8gZnVuY3Rpb24gbW9kaWZ5U2VsZWN0aW9uKG1vZGVsLCBzZWxlY3Rpb24sIG9wdGlvbnMgPSB7fSkge1xuICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICBjb25zdCBpc0ZvcndhcmQgPSBvcHRpb25zLmRpcmVjdGlvbiAhPSAnYmFja3dhcmQnO1xuICAgIGNvbnN0IHVuaXQgPSBvcHRpb25zLnVuaXQgPyBvcHRpb25zLnVuaXQgOiAnY2hhcmFjdGVyJztcbiAgICBjb25zdCB0cmVhdEVtb2ppQXNTaW5nbGVVbml0ID0gISFvcHRpb25zLnRyZWF0RW1vamlBc1NpbmdsZVVuaXQ7XG4gICAgY29uc3QgZm9jdXMgPSBzZWxlY3Rpb24uZm9jdXM7XG4gICAgY29uc3Qgd2Fsa2VyID0gbmV3IFRyZWVXYWxrZXIoe1xuICAgICAgICBib3VuZGFyaWVzOiBnZXRTZWFyY2hSYW5nZShmb2N1cywgaXNGb3J3YXJkKSxcbiAgICAgICAgc2luZ2xlQ2hhcmFjdGVyczogdHJ1ZSxcbiAgICAgICAgZGlyZWN0aW9uOiBpc0ZvcndhcmQgPyAnZm9yd2FyZCcgOiAnYmFja3dhcmQnXG4gICAgfSk7XG4gICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgd2Fsa2VyLFxuICAgICAgICBzY2hlbWEsXG4gICAgICAgIGlzRm9yd2FyZCxcbiAgICAgICAgdW5pdCxcbiAgICAgICAgdHJlYXRFbW9qaUFzU2luZ2xlVW5pdFxuICAgIH07XG4gICAgbGV0IG5leHQ7XG4gICAgd2hpbGUobmV4dCA9IHdhbGtlci5uZXh0KCkpe1xuICAgICAgICBpZiAobmV4dC5kb25lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSB0cnlFeHRlbmRpbmdUbyhkYXRhLCBuZXh0LnZhbHVlKTtcbiAgICAgICAgaWYgKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uIGluc3RhbmNlb2YgRG9jdW1lbnRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbkZvY3VzKHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uLnNldEZvY3VzKHBvc2l0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHNlbGVjdGlvbiBjYW4gYmUgZXh0ZW5kZWQgdG8gdGhlIHRoZSB3YWxrZXIncyBuZXh0IHZhbHVlIChuZXh0IHBvc2l0aW9uKS5cbiAqLyBmdW5jdGlvbiB0cnlFeHRlbmRpbmdUbyhkYXRhLCB2YWx1ZSkge1xuICAgIGNvbnN0IHsgaXNGb3J3YXJkLCB3YWxrZXIsIHVuaXQsIHNjaGVtYSwgdHJlYXRFbW9qaUFzU2luZ2xlVW5pdCB9ID0gZGF0YTtcbiAgICBjb25zdCB7IHR5cGUsIGl0ZW0sIG5leHRQb3NpdGlvbiB9ID0gdmFsdWU7XG4gICAgLy8gSWYgZm91bmQgdGV4dCwgd2UgY2FuIGNlcnRhaW5seSBwdXQgdGhlIGZvY3VzIGluIGl0LiBMZXQncyBqdXN0IGZpbmQgYSBjb3JyZWN0IHBvc2l0aW9uXG4gICAgLy8gYmFzZWQgb24gdGhlIHVuaXQuXG4gICAgaWYgKHR5cGUgPT0gJ3RleHQnKSB7XG4gICAgICAgIGlmIChkYXRhLnVuaXQgPT09ICd3b3JkJykge1xuICAgICAgICAgICAgcmV0dXJuIGdldENvcnJlY3RXb3JkQnJlYWtQb3NpdGlvbih3YWxrZXIsIGlzRm9yd2FyZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldENvcnJlY3RQb3NpdGlvbih3YWxrZXIsIHVuaXQsIHRyZWF0RW1vamlBc1NpbmdsZVVuaXQpO1xuICAgIH1cbiAgICAvLyBFbnRlcmluZyBhbiBlbGVtZW50LlxuICAgIGlmICh0eXBlID09IChpc0ZvcndhcmQgPyAnZWxlbWVudFN0YXJ0JyA6ICdlbGVtZW50RW5kJykpIHtcbiAgICAgICAgLy8gSWYgaXQncyBhIHNlbGVjdGFibGUsIHdlIGNhbiBzZWxlY3QgaXQgbm93LlxuICAgICAgICBpZiAoc2NoZW1hLmlzU2VsZWN0YWJsZShpdGVtKSkge1xuICAgICAgICAgICAgcmV0dXJuIFBvc2l0aW9uLl9jcmVhdGVBdChpdGVtLCBpc0ZvcndhcmQgPyAnYWZ0ZXInIDogJ2JlZm9yZScpO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRleHQgYWxsb3dlZCBvbiB0aGlzIHBvc2l0aW9uLCBleHRlbmQgdG8gdGhpcyBwbGFjZS5cbiAgICAgICAgaWYgKHNjaGVtYS5jaGVja0NoaWxkKG5leHRQb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXh0UG9zaXRpb247XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBsZWF2aW5nIGEgbGltaXQgZWxlbWVudCwgc3RvcC5cbiAgICAgICAgaWYgKHNjaGVtYS5pc0xpbWl0KGl0ZW0pKSB7XG4gICAgICAgICAgICAvLyBOT1RFOiBGYXN0LWZvcndhcmQgdGhlIHdhbGtlciB1bnRpbCB0aGUgZW5kLlxuICAgICAgICAgICAgd2Fsa2VyLnNraXAoKCk9PnRydWUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRleHQgYWxsb3dlZCBvbiB0aGlzIHBvc2l0aW9uLCBleHRlbmQgdG8gdGhpcyBwbGFjZS5cbiAgICAgICAgaWYgKHNjaGVtYS5jaGVja0NoaWxkKG5leHRQb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXh0UG9zaXRpb247XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIEZpbmRzIGEgY29ycmVjdCBwb3NpdGlvbiBieSB3YWxraW5nIGluIGEgdGV4dCBub2RlIGFuZCBjaGVja2luZyB3aGV0aGVyIHNlbGVjdGlvbiBjYW4gYmUgZXh0ZW5kZWQgdG8gZ2l2ZW4gcG9zaXRpb25cbiAqIG9yIHNob3VsZCBiZSBleHRlbmRlZCBmdXJ0aGVyLlxuICovIGZ1bmN0aW9uIGdldENvcnJlY3RQb3NpdGlvbih3YWxrZXIsIHVuaXQsIHRyZWF0RW1vamlBc1NpbmdsZVVuaXQpIHtcbiAgICBjb25zdCB0ZXh0Tm9kZSA9IHdhbGtlci5wb3NpdGlvbi50ZXh0Tm9kZTtcbiAgICBpZiAodGV4dE5vZGUpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHRleHROb2RlLmRhdGE7XG4gICAgICAgIGxldCBvZmZzZXQgPSB3YWxrZXIucG9zaXRpb24ub2Zmc2V0IC0gdGV4dE5vZGUuc3RhcnRPZmZzZXQ7XG4gICAgICAgIHdoaWxlKGlzSW5zaWRlU3Vycm9nYXRlUGFpcihkYXRhLCBvZmZzZXQpIHx8IHVuaXQgPT0gJ2NoYXJhY3RlcicgJiYgaXNJbnNpZGVDb21iaW5lZFN5bWJvbChkYXRhLCBvZmZzZXQpIHx8IHRyZWF0RW1vamlBc1NpbmdsZVVuaXQgJiYgaXNJbnNpZGVFbW9qaVNlcXVlbmNlKGRhdGEsIG9mZnNldCkpe1xuICAgICAgICAgICAgd2Fsa2VyLm5leHQoKTtcbiAgICAgICAgICAgIG9mZnNldCA9IHdhbGtlci5wb3NpdGlvbi5vZmZzZXQgLSB0ZXh0Tm9kZS5zdGFydE9mZnNldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gd2Fsa2VyLnBvc2l0aW9uO1xufVxuLyoqXG4gKiBGaW5kcyBhIGNvcnJlY3QgcG9zaXRpb24gb2YgYSB3b3JkIGJyZWFrIGJ5IHdhbGtpbmcgaW4gYSB0ZXh0IG5vZGUgYW5kIGNoZWNraW5nIHdoZXRoZXIgc2VsZWN0aW9uIGNhbiBiZSBleHRlbmRlZCB0byBnaXZlbiBwb3NpdGlvblxuICogb3Igc2hvdWxkIGJlIGV4dGVuZGVkIGZ1cnRoZXIuXG4gKi8gZnVuY3Rpb24gZ2V0Q29ycmVjdFdvcmRCcmVha1Bvc2l0aW9uKHdhbGtlciwgaXNGb3J3YXJkKSB7XG4gICAgbGV0IHRleHROb2RlID0gd2Fsa2VyLnBvc2l0aW9uLnRleHROb2RlO1xuICAgIGlmICghdGV4dE5vZGUpIHtcbiAgICAgICAgdGV4dE5vZGUgPSBpc0ZvcndhcmQgPyB3YWxrZXIucG9zaXRpb24ubm9kZUFmdGVyIDogd2Fsa2VyLnBvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgfVxuICAgIHdoaWxlKHRleHROb2RlICYmIHRleHROb2RlLmlzKCckdGV4dCcpKXtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gd2Fsa2VyLnBvc2l0aW9uLm9mZnNldCAtIHRleHROb2RlLnN0YXJ0T2Zmc2V0O1xuICAgICAgICAvLyBDaGVjayBvZiBhZGphY2VudCB0ZXh0IG5vZGVzIHdpdGggZGlmZmVyZW50IGF0dHJpYnV0ZXMgKGxpa2UgQk9MRCkuXG4gICAgICAgIC8vIEV4YW1wbGUgICAgICAgICAgOiAnZm9vZm9vIFtdYmFyPCR0ZXh0IGJvbGQ9XCJ0cnVlXCI+YmFyPC8kdGV4dD4gYmF6YmF6J1xuICAgICAgICAvLyBzaG91bGQgZXhwYW5kIHRvIDogJ2Zvb2ZvbyBbYmFyPCR0ZXh0IGJvbGQ9XCJ0cnVlXCI+YmFyPC8kdGV4dD5dIGJhemJheicuXG4gICAgICAgIGlmIChpc0F0Tm9kZUJvdW5kYXJ5KHRleHROb2RlLCBvZmZzZXQsIGlzRm9yd2FyZCkpIHtcbiAgICAgICAgICAgIHRleHROb2RlID0gaXNGb3J3YXJkID8gd2Fsa2VyLnBvc2l0aW9uLm5vZGVBZnRlciA6IHdhbGtlci5wb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQXRXb3JkQm91bmRhcnkodGV4dE5vZGUuZGF0YSwgb2Zmc2V0LCBpc0ZvcndhcmQpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdhbGtlci5uZXh0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHdhbGtlci5wb3NpdGlvbjtcbn1cbmZ1bmN0aW9uIGdldFNlYXJjaFJhbmdlKHN0YXJ0LCBpc0ZvcndhcmQpIHtcbiAgICBjb25zdCByb290ID0gc3RhcnQucm9vdDtcbiAgICBjb25zdCBzZWFyY2hFbmQgPSBQb3NpdGlvbi5fY3JlYXRlQXQocm9vdCwgaXNGb3J3YXJkID8gJ2VuZCcgOiAwKTtcbiAgICBpZiAoaXNGb3J3YXJkKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnQsIHNlYXJjaEVuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShzZWFyY2hFbmQsIHN0YXJ0KTtcbiAgICB9XG59XG4vKipcbiAqIENoZWNrcyBpZiBzZWxlY3Rpb24gaXMgb24gd29yZCBib3VuZGFyeS5cbiAqLyBmdW5jdGlvbiBpc0F0V29yZEJvdW5kYXJ5KGRhdGEsIG9mZnNldCwgaXNGb3J3YXJkKSB7XG4gICAgLy8gVGhlIG9mZnNldCB0byBjaGVjayBkZXBlbmRzIG9uIGRpcmVjdGlvbi5cbiAgICBjb25zdCBvZmZzZXRUb0NoZWNrID0gb2Zmc2V0ICsgKGlzRm9yd2FyZCA/IDAgOiAtMSk7XG4gICAgcmV0dXJuIHdvcmRCb3VuZGFyeUNoYXJhY3RlcnMuaW5jbHVkZXMoZGF0YS5jaGFyQXQob2Zmc2V0VG9DaGVjaykpO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgc2VsZWN0aW9uIGlzIG9uIG5vZGUgYm91bmRhcnkuXG4gKi8gZnVuY3Rpb24gaXNBdE5vZGVCb3VuZGFyeSh0ZXh0Tm9kZSwgb2Zmc2V0LCBpc0ZvcndhcmQpIHtcbiAgICByZXR1cm4gb2Zmc2V0ID09PSAoaXNGb3J3YXJkID8gdGV4dE5vZGUub2Zmc2V0U2l6ZSA6IDApO1xufVxuXG4vLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGNvbnN0IHsgZHVtcFRyZWVzLCBpbml0RG9jdW1lbnREdW1waW5nIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL3V0aWxzJyApO1xuLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zdCB7IE9wZXJhdGlvblJlcGxheWVyIH0gPSByZXF1aXJlKCAnLi4vZGV2LXV0aWxzL29wZXJhdGlvbnJlcGxheWVyJyApLmRlZmF1bHQ7XG4vKipcbiAqIEVkaXRvcidzIGRhdGEgbW9kZWwuIFJlYWQgYWJvdXQgdGhlIG1vZGVsIGluIHRoZVxuICoge0BnbGluayBmcmFtZXdvcmsvYXJjaGl0ZWN0dXJlL2VkaXRpbmctZW5naW5lIGVuZ2luZSBhcmNoaXRlY3R1cmV9IGd1aWRlLlxuICovIGNsYXNzIE1vZGVsIGV4dGVuZHMgLyogI19fUFVSRV9fICovIE9ic2VydmFibGVNaXhpbigpIHtcbiAgICAvKipcblx0ICogTW9kZWwncyBtYXJrZXIgY29sbGVjdGlvbi5cblx0ICovIG1hcmtlcnM7XG4gICAgLyoqXG5cdCAqIE1vZGVsJ3MgZG9jdW1lbnQuXG5cdCAqLyBkb2N1bWVudDtcbiAgICAvKipcblx0ICogTW9kZWwncyBzY2hlbWEuXG5cdCAqLyBzY2hlbWE7XG4gICAgLyoqXG5cdCAqIEFsbCBjYWxsYmFja3MgYWRkZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlfSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNlbnF1ZXVlQ2hhbmdlfSBtZXRob2RzIHdhaXRpbmcgdG8gYmUgZXhlY3V0ZWQuXG5cdCAqLyBfcGVuZGluZ0NoYW5nZXM7XG4gICAgLyoqXG5cdCAqIFRoZSBsYXN0IGNyZWF0ZWQgYW5kIGN1cnJlbnRseSB1c2VkIHdyaXRlciBpbnN0YW5jZS5cblx0ICovIF9jdXJyZW50V3JpdGVyO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gcHJpdmF0ZSBfb3BlcmF0aW9uTG9nczogQXJyYXk8c3RyaW5nPjtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIHByaXZhdGUgX2FwcGxpZWRPcGVyYXRpb25zOiBBcnJheTxPcGVyYXRpb24+O1xuICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMubWFya2VycyA9IG5ldyBNYXJrZXJDb2xsZWN0aW9uKCk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSBuZXcgRG9jdW1lbnQodGhpcyk7XG4gICAgICAgIHRoaXMuc2NoZW1hID0gbmV3IFNjaGVtYSgpO1xuICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlcyA9IFtdO1xuICAgICAgICB0aGlzLl9jdXJyZW50V3JpdGVyID0gbnVsbDtcbiAgICAgICAgW1xuICAgICAgICAgICAgJ2RlbGV0ZUNvbnRlbnQnLFxuICAgICAgICAgICAgJ21vZGlmeVNlbGVjdGlvbicsXG4gICAgICAgICAgICAnZ2V0U2VsZWN0ZWRDb250ZW50JyxcbiAgICAgICAgICAgICdhcHBseU9wZXJhdGlvbidcbiAgICAgICAgXS5mb3JFYWNoKChtZXRob2ROYW1lKT0+dGhpcy5kZWNvcmF0ZShtZXRob2ROYW1lKSk7XG4gICAgICAgIC8vIEFkZGluZyBvcGVyYXRpb24gdmFsaWRhdGlvbiB3aXRoIGBoaWdoZXN0YCBwcmlvcml0eSwgc28gaXQgaXMgY2FsbGVkIGJlZm9yZSBhbnkgb3RoZXIgZmVhdHVyZSB3b3VsZCBsaWtlXG4gICAgICAgIC8vIHRvIGRvIGFueXRoaW5nIHdpdGggdGhlIG9wZXJhdGlvbi4gSWYgdGhlIG9wZXJhdGlvbiBoYXMgaW5jb3JyZWN0IHBhcmFtZXRlcnMgaXQgc2hvdWxkIHRocm93IG9uIHRoZSBlYXJsaWVzdCBvY2Nhc2lvbi5cbiAgICAgICAgdGhpcy5vbignYXBwbHlPcGVyYXRpb24nLCAoZXZ0LCBhcmdzKT0+e1xuICAgICAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gYXJnc1swXTtcbiAgICAgICAgICAgIG9wZXJhdGlvbi5fdmFsaWRhdGUoKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVnaXN0ZXIgc29tZSBkZWZhdWx0IGFic3RyYWN0IGVudGl0aWVzLlxuICAgICAgICB0aGlzLnNjaGVtYS5yZWdpc3RlcignJHJvb3QnLCB7XG4gICAgICAgICAgICBpc0xpbWl0OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNjaGVtYS5yZWdpc3RlcignJGNvbnRhaW5lcicsIHtcbiAgICAgICAgICAgIGFsbG93SW46IFtcbiAgICAgICAgICAgICAgICAnJHJvb3QnLFxuICAgICAgICAgICAgICAgICckY29udGFpbmVyJ1xuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zY2hlbWEucmVnaXN0ZXIoJyRibG9jaycsIHtcbiAgICAgICAgICAgIGFsbG93SW46IFtcbiAgICAgICAgICAgICAgICAnJHJvb3QnLFxuICAgICAgICAgICAgICAgICckY29udGFpbmVyJ1xuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGlzQmxvY2s6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2NoZW1hLnJlZ2lzdGVyKCckYmxvY2tPYmplY3QnLCB7XG4gICAgICAgICAgICBhbGxvd1doZXJlOiAnJGJsb2NrJyxcbiAgICAgICAgICAgIGlzQmxvY2s6IHRydWUsXG4gICAgICAgICAgICBpc09iamVjdDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zY2hlbWEucmVnaXN0ZXIoJyRpbmxpbmVPYmplY3QnLCB7XG4gICAgICAgICAgICBhbGxvd1doZXJlOiAnJHRleHQnLFxuICAgICAgICAgICAgYWxsb3dBdHRyaWJ1dGVzT2Y6ICckdGV4dCcsXG4gICAgICAgICAgICBpc0lubGluZTogdHJ1ZSxcbiAgICAgICAgICAgIGlzT2JqZWN0OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNjaGVtYS5yZWdpc3RlcignJHRleHQnLCB7XG4gICAgICAgICAgICBhbGxvd0luOiAnJGJsb2NrJyxcbiAgICAgICAgICAgIGlzSW5saW5lOiB0cnVlLFxuICAgICAgICAgICAgaXNDb250ZW50OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNjaGVtYS5yZWdpc3RlcignJGNsaXBib2FyZEhvbGRlcicsIHtcbiAgICAgICAgICAgIGFsbG93Q29udGVudE9mOiAnJHJvb3QnLFxuICAgICAgICAgICAgYWxsb3dDaGlsZHJlbjogJyR0ZXh0JyxcbiAgICAgICAgICAgIGlzTGltaXQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2NoZW1hLnJlZ2lzdGVyKCckZG9jdW1lbnRGcmFnbWVudCcsIHtcbiAgICAgICAgICAgIGFsbG93Q29udGVudE9mOiAnJHJvb3QnLFxuICAgICAgICAgICAgYWxsb3dDaGlsZHJlbjogJyR0ZXh0JyxcbiAgICAgICAgICAgIGlzTGltaXQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEFuIGVsZW1lbnQgbmVlZGVkIGJ5IHRoZSBgdXBjYXN0RWxlbWVudFRvTWFya2VyYCBjb252ZXJ0ZXIuXG4gICAgICAgIC8vIFRoaXMgZWxlbWVudCB0ZW1wb3JhcmlseSByZXByZXNlbnRzIGEgbWFya2VyIGJvdW5kYXJ5IGR1cmluZyB0aGUgY29udmVyc2lvbiBwcm9jZXNzIGFuZCBpcyByZW1vdmVkXG4gICAgICAgIC8vIGF0IHRoZSBlbmQgb2YgdGhlIGNvbnZlcnNpb24uIGBVcGNhc3REaXNwYXRjaGVyYCBvciBhdCBsZWFzdCBgQ29udmVyc2lvbmAgY2xhc3MgbG9va3MgbGlrZSBhXG4gICAgICAgIC8vIGJldHRlciBwbGFjZSBmb3IgdGhpcyByZWdpc3RyYXRpb24gYnV0IGJvdGgga25vdyBub3RoaW5nIGFib3V0IGBTY2hlbWFgLlxuICAgICAgICB0aGlzLnNjaGVtYS5yZWdpc3RlcignJG1hcmtlcicpO1xuICAgICAgICB0aGlzLnNjaGVtYS5hZGRDaGlsZENoZWNrKCgpPT50cnVlLCAnJG1hcmtlcicpOyAvLyBBbGxvdyBldmVyeXdoZXJlLlxuICAgICAgICBpbmplY3RTZWxlY3Rpb25Qb3N0Rml4ZXIodGhpcyk7XG4gICAgICAgIC8vIFBvc3QtZml4ZXIgd2hpY2ggdGFrZXMgY2FyZSBvZiBhZGRpbmcgZW1wdHkgcGFyYWdyYXBoIGVsZW1lbnRzIHRvIHRoZSBlbXB0eSByb290cy5cbiAgICAgICAgdGhpcy5kb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlcihhdXRvUGFyYWdyYXBoRW1wdHlSb290cyk7XG4gICAgICAgIC8vIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIGZvciBcImRlY29yYXRlZFwiIG1ldGhvZCB3aXRoIHJlbWFwcGVkIGFyZ3VtZW50cy5cbiAgICAgICAgdGhpcy5vbignaW5zZXJ0Q29udGVudCcsIChldnQsIFtjb250ZW50LCBzZWxlY3RhYmxlXSk9PntcbiAgICAgICAgICAgIGV2dC5yZXR1cm4gPSBpbnNlcnRDb250ZW50KHRoaXMsIGNvbnRlbnQsIHNlbGVjdGFibGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gZm9yIFwiZGVjb3JhdGVkXCIgbWV0aG9kIHdpdGggcmVtYXBwZWQgYXJndW1lbnRzLlxuICAgICAgICB0aGlzLm9uKCdpbnNlcnRPYmplY3QnLCAoZXZ0LCBbZWxlbWVudCwgc2VsZWN0aW9uLCBvcHRpb25zXSk9PntcbiAgICAgICAgICAgIGV2dC5yZXR1cm4gPSBpbnNlcnRPYmplY3QodGhpcywgZWxlbWVudCwgc2VsZWN0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIGZvciBcImRlY29yYXRlZFwiIG1ldGhvZCB3aXRoIHJlbWFwcGVkIGFyZ3VtZW50cy5cbiAgICAgICAgdGhpcy5vbignY2FuRWRpdEF0JywgKGV2dCk9PntcbiAgICAgICAgICAgIGNvbnN0IGNhbkVkaXRBdCA9ICF0aGlzLmRvY3VtZW50LmlzUmVhZE9ubHk7XG4gICAgICAgICAgICBldnQucmV0dXJuID0gY2FuRWRpdEF0O1xuICAgICAgICAgICAgaWYgKCFjYW5FZGl0QXQpIHtcbiAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IGZ1cnRoZXIgcHJvY2Vzc2luZyBpZiB0aGUgc2VsZWN0aW9uIGlzIGF0IG5vbi1lZGl0YWJsZSBwbGFjZS5cbiAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIGluaXREb2N1bWVudER1bXBpbmcoIHRoaXMuZG9jdW1lbnQgKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIHRoaXMub24oICdhcHBseU9wZXJhdGlvbicsICgpID0+IHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIFx0ZHVtcFRyZWVzKCB0aGlzLmRvY3VtZW50LCB0aGlzLmRvY3VtZW50LnZlcnNpb24gKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIH0sIHsgcHJpb3JpdHk6ICdsb3dlc3QnIH0gKTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIHRoaXMuX29wZXJhdGlvbkxvZ3MgPSBbXTtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIHRoaXMuX2FwcGxpZWRPcGVyYXRpb25zID0gW107XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgYGNoYW5nZSgpYCBtZXRob2QgaXMgdGhlIHByaW1hcnkgd2F5IG9mIGNoYW5naW5nIHRoZSBtb2RlbC4gWW91IHNob3VsZCB1c2UgaXQgdG8gbW9kaWZ5IGFsbCBkb2N1bWVudCBub2Rlc1xuXHQgKiAoaW5jbHVkaW5nIGRldGFjaGVkIG5vZGVzIOKAkyBpLmUuIG5vZGVzIG5vdCBhZGRlZCB0byB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZG9jdW1lbnQgbW9kZWwgZG9jdW1lbnR9KSxcblx0ICogdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3NlbGVjdGlvbiBkb2N1bWVudCdzIHNlbGVjdGlvbn0sIGFuZFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNtYXJrZXJzIG1vZGVsIG1hcmtlcnN9LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBtb2RlbC5jaGFuZ2UoIHdyaXRlciA9PiB7XG5cdCAqIFx0d3JpdGVyLmluc2VydFRleHQoICdmb28nLCBwYXJhZ3JhcGgsICdlbmQnICk7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEFsbCBjaGFuZ2VzIGluc2lkZSB0aGUgY2hhbmdlIGJsb2NrIHVzZSB0aGUgc2FtZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9iYXRjaH5CYXRjaH0gc28gdGhleSBhcmUgY29tYmluZWRcblx0ICogaW50byBhIHNpbmdsZSB1bmRvIHN0ZXAuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIG1vZGVsLmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHR3cml0ZXIuaW5zZXJ0VGV4dCggJ2ZvbycsIHBhcmFncmFwaCwgJ2VuZCcgKTsgLy8gZm9vLlxuXHQgKlxuXHQgKiBcdG1vZGVsLmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHRcdHdyaXRlci5pbnNlcnRUZXh0KCAnYmFyJywgcGFyYWdyYXBoLCAnZW5kJyApOyAvLyBmb29iYXIuXG5cdCAqIFx0fSApO1xuXHQgKlxuXHQgKiBcdHdyaXRlci5pbnNlcnRUZXh0KCAnYm9tJywgcGFyYWdyYXBoLCAnZW5kJyApOyAvLyBmb29iYXJib20uXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFRoZSBjYWxsYmFjayBvZiB0aGUgYGNoYW5nZSgpYCBibG9jayBpcyBleGVjdXRlZCBzeW5jaHJvbm91c2x5LlxuXHQgKlxuXHQgKiBZb3UgY2FuIGFsc28gcmV0dXJuIGEgdmFsdWUgZnJvbSB0aGUgY2hhbmdlIGJsb2NrLlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBpbWcgPSBtb2RlbC5jaGFuZ2UoIHdyaXRlciA9PiB7XG5cdCAqIFx0cmV0dXJuIHdyaXRlci5jcmVhdGVFbGVtZW50KCAnaW1nJyApO1xuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAc2VlICNlbnF1ZXVlQ2hhbmdlXG5cdCAqIEB0eXBlUGFyYW0gVFJldHVybiBUaGUgcmV0dXJuIHR5cGUgb2YgdGhlIHByb3ZpZGVkIGNhbGxiYWNrLlxuXHQgKiBAcGFyYW0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggbWF5IG1vZGlmeSB0aGUgbW9kZWwuXG5cdCAqLyBjaGFuZ2UoY2FsbGJhY2spIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9wZW5kaW5nQ2hhbmdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIHRoZSBvdXRlcm1vc3QgYmxvY2ssIGNyZWF0ZSBhIG5ldyBiYXRjaCBhbmQgc3RhcnQgYF9ydW5QZW5kaW5nQ2hhbmdlc2AgZXhlY3V0aW9uIGZsb3cuXG4gICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0NoYW5nZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGJhdGNoOiBuZXcgQmF0Y2goKSxcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVuUGVuZGluZ0NoYW5nZXMoKVswXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBub3QgdGhlIG91dGVybW9zdCBibG9jaywganVzdCBleGVjdXRlIHRoZSBjYWxsYmFjay5cbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sodGhpcy5fY3VycmVudFdyaXRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHIC8vIHRocm93IGVycjtcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyBDS0VkaXRvckVycm9yLnJldGhyb3dVbmV4cGVjdGVkRXJyb3IoZXJyLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbnF1ZXVlQ2hhbmdlKGJhdGNoT3JUeXBlLCBjYWxsYmFjaykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKCFiYXRjaE9yVHlwZSkge1xuICAgICAgICAgICAgICAgIGJhdGNoT3JUeXBlID0gbmV3IEJhdGNoKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBiYXRjaE9yVHlwZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gYmF0Y2hPclR5cGU7XG4gICAgICAgICAgICAgICAgYmF0Y2hPclR5cGUgPSBuZXcgQmF0Y2goKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIShiYXRjaE9yVHlwZSBpbnN0YW5jZW9mIEJhdGNoKSkge1xuICAgICAgICAgICAgICAgIGJhdGNoT3JUeXBlID0gbmV3IEJhdGNoKGJhdGNoT3JUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdDaGFuZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIGJhdGNoOiBiYXRjaE9yVHlwZSxcbiAgICAgICAgICAgICAgICBjYWxsYmFja1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ0NoYW5nZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ydW5QZW5kaW5nQ2hhbmdlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVRyAvLyB0aHJvdyBlcnI7XG4gICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAtLSBAcHJlc2VydmUgKi8gQ0tFZGl0b3JFcnJvci5yZXRocm93VW5leHBlY3RlZEVycm9yKGVyciwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIHtAbGluayBtb2R1bGU6dXRpbHMvb2JzZXJ2YWJsZW1peGlufk9ic2VydmFibGUjZGVjb3JhdGUgRGVjb3JhdGVkfSBmdW5jdGlvbiBmb3IgYXBwbHlpbmdcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvbn5PcGVyYXRpb24gb3BlcmF0aW9uc30gdG8gdGhlIG1vZGVsLlxuXHQgKlxuXHQgKiBUaGlzIGlzIGEgbG93LWxldmVsIHdheSBvZiBjaGFuZ2luZyB0aGUgbW9kZWwuIEl0IGlzIGV4cG9zZWQgZm9yIHZlcnkgc3BlY2lmaWMgdXNlIGNhc2VzIChsaWtlIHRoZSB1bmRvIGZlYXR1cmUpLlxuXHQgKiBOb3JtYWxseSwgdG8gbW9kaWZ5IHRoZSBtb2RlbCwgeW91IHdpbGwgd2FudCB0byB1c2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciBgV3JpdGVyYH0uXG5cdCAqIFNlZSBhbHNvIHtAZ2xpbmsgZnJhbWV3b3JrL2FyY2hpdGVjdHVyZS9lZGl0aW5nLWVuZ2luZSNjaGFuZ2luZy10aGUtbW9kZWwgQ2hhbmdpbmcgdGhlIG1vZGVsfSBzZWN0aW9uXG5cdCAqIG9mIHRoZSB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUgRWRpdGluZyBhcmNoaXRlY3R1cmV9IGd1aWRlLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3BlcmF0aW9uIFRoZSBvcGVyYXRpb24gdG8gYXBwbHkuXG5cdCAqLyBhcHBseU9wZXJhdGlvbihvcGVyYXRpb24pIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBjb25zb2xlLmxvZyggJ0FwcGx5aW5nICcgKyBvcGVyYXRpb24gKTtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyB0aGlzLl9vcGVyYXRpb25Mb2dzLnB1c2goIEpTT04uc3RyaW5naWZ5KCBvcGVyYXRpb24gKSApO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIHRoaXMuX2FwcGxpZWRPcGVyYXRpb25zLnB1c2goIG9wZXJhdGlvbiApO1xuICAgICAgICBvcGVyYXRpb24uX2V4ZWN1dGUoKTtcbiAgICB9XG4gICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBwdWJsaWMgZ2V0QXBwbGllZE9wZXJhdGlvbigpOiBzdHJpbmcge1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gXHRpZiAoICF0aGlzLl9hcHBsaWVkT3BlcmF0aW9ucyApIHtcbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIFx0XHRyZXR1cm4gJyc7XG4gICAgLy8gQGlmIENLX0RFQlVHX0VOR0lORSAvLyBcdH1cbiAgICAvLyBAaWYgQ0tfREVCVUdfRU5HSU5FIC8vIFx0cmV0dXJuIHRoaXMuX2FwcGxpZWRPcGVyYXRpb25zLm1hcCggb3BlcmF0aW9uID0+IEpTT04uc3RyaW5naWZ5KCBvcGVyYXRpb24gKSApLmpvaW4oICctLS0tLS0tJyApO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gfVxuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gcHVibGljIGNyZWF0ZVJlcGxheWVyKCBzdHJpbmdpZmllZE9wZXJhdGlvbnM6IHN0cmluZyApOiB0eXBlb2YgT3BlcmF0aW9uUmVwbGF5ZXIge1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gXHRyZXR1cm4gbmV3IE9wZXJhdGlvblJlcGxheWVyKCB0aGlzLCAnLS0tLS0tLScsIHN0cmluZ2lmaWVkT3BlcmF0aW9ucyApO1xuICAgIC8vIEBpZiBDS19ERUJVR19FTkdJTkUgLy8gfVxuICAgIC8qKlxuXHQgKiBJbnNlcnRzIGNvbnRlbnQgYXQgdGhlIHBvc2l0aW9uIGluIHRoZSBlZGl0b3Igc3BlY2lmaWVkIGJ5IHRoZSBzZWxlY3Rpb24sIGFzIG9uZSB3b3VsZCBleHBlY3QgdGhlIHBhc3RlXG5cdCAqIGZ1bmN0aW9uYWxpdHkgdG8gd29yay5cblx0ICpcblx0ICogKipOb3RlKio6IElmIHlvdSB3YW50IHRvIGluc2VydCBhbiB7QGdsaW5rIGZyYW1ld29yay9kZWVwLWRpdmUvc2NoZW1hI29iamVjdC1lbGVtZW50cyBvYmplY3QgZWxlbWVudH1cblx0ICogKGUuZy4gYSB7QGxpbmsgbW9kdWxlOndpZGdldC91dGlsc350b1dpZGdldCB3aWRnZXR9KSwgc2VlIHtAbGluayAjaW5zZXJ0T2JqZWN0fSBpbnN0ZWFkLlxuXHQgKlxuXHQgKiBUaGlzIGlzIGEgaGlnaC1sZXZlbCBtZXRob2QuIEl0IHRha2VzIHRoZSB7QGxpbmsgI3NjaGVtYSBzY2hlbWF9IGludG8gY29uc2lkZXJhdGlvbiB3aGVuIGluc2VydGluZ1xuXHQgKiB0aGUgY29udGVudCwgY2xlYXJzIHRoZSBnaXZlbiBzZWxlY3Rpb24ncyBjb250ZW50IGJlZm9yZSBpbnNlcnRpbmcgbm9kZXMgYW5kIG1vdmVzIHRoZSBzZWxlY3Rpb25cblx0ICogdG8gaXRzIHRhcmdldCBwb3NpdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBwcm9jZXNzLlxuXHQgKiBJdCBjYW4gc3BsaXQgZWxlbWVudHMsIG1lcmdlIHRoZW0sIHdyYXAgYmFyZSB0ZXh0IG5vZGVzIHdpdGggcGFyYWdyYXBocywgZXRjLiAmbmRhc2g7IGp1c3QgbGlrZSB0aGVcblx0ICogcGFzdGluZyBmZWF0dXJlIHNob3VsZCBkby5cblx0ICpcblx0ICogRm9yIGxvd2VyLWxldmVsIG1ldGhvZHMgc2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgYFdyaXRlcmB9LlxuXHQgKlxuXHQgKiBUaGlzIG1ldGhvZCwgdW5saWtlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgYFdyaXRlcmB9J3MgbWV0aG9kcywgZG9lcyBub3QgaGF2ZSB0byBiZSB1c2VkXG5cdCAqIGluc2lkZSBhIHtAbGluayAjY2hhbmdlIGBjaGFuZ2UoKWAgYmxvY2t9LlxuXHQgKlxuXHQgKiAjIENvbnZlcnNpb24gYW5kIHNjaGVtYVxuXHQgKlxuXHQgKiBJbnNlcnRpbmcgZWxlbWVudHMgYW5kIHRleHQgbm9kZXMgaW50byB0aGUgbW9kZWwgaXMgbm90IGVub3VnaCB0byBtYWtlIENLRWRpdG9yIDUgcmVuZGVyIHRoYXQgY29udGVudFxuXHQgKiB0byB0aGUgdXNlci4gQ0tFZGl0b3IgNSBpbXBsZW1lbnRzIGEgbW9kZWwtdmlldy1jb250cm9sbGVyIGFyY2hpdGVjdHVyZSBhbmQgd2hhdCBgbW9kZWwuaW5zZXJ0Q29udGVudCgpYCBkb2VzXG5cdCAqIGlzIG9ubHkgYWRkaW5nIG5vZGVzIHRvIHRoZSBtb2RlbC4gQWRkaXRpb25hbGx5LCB5b3UgbmVlZCB0byBkZWZpbmVcblx0ICoge0BnbGluayBmcmFtZXdvcmsvYXJjaGl0ZWN0dXJlL2VkaXRpbmctZW5naW5lI2NvbnZlcnNpb24gY29udmVydGVyc30gYmV0d2VlbiB0aGUgbW9kZWwgYW5kIHZpZXdcblx0ICogYW5kIGRlZmluZSB0aG9zZSBub2RlcyBpbiB0aGUge0BnbGluayBmcmFtZXdvcmsvYXJjaGl0ZWN0dXJlL2VkaXRpbmctZW5naW5lI3NjaGVtYSBzY2hlbWF9LlxuXHQgKlxuXHQgKiBTbywgd2hpbGUgdGhpcyBtZXRob2QgbWF5IHNlZW0gc2ltaWxhciB0byBDS0VkaXRvciA0IGBlZGl0b3IuaW5zZXJ0SHRtbCgpYCAoaW4gZmFjdCwgYm90aCBtZXRob2RzXG5cdCAqIGFyZSB1c2VkIGZvciBwYXN0ZS1saWtlIGNvbnRlbnQgaW5zZXJ0aW9uKSwgdGhlIENLRWRpdG9yIDUgbWV0aG9kIGNhbm5vdCBiZSB1c2UgdG8gaW5zZXJ0IGFyYml0cmFyeSBIVE1MXG5cdCAqIHVubGVzcyBjb252ZXJ0ZXJzIGFyZSBkZWZpbmVkIGZvciBhbGwgZWxlbWVudHMgYW5kIGF0dHJpYnV0ZXMgaW4gdGhhdCBIVE1MLlxuXHQgKlxuXHQgKiAjIEV4YW1wbGVzXG5cdCAqXG5cdCAqIFVzaW5nIGBpbnNlcnRDb250ZW50KClgIHdpdGggYSBtYW51YWxseSBjcmVhdGVkIG1vZGVsIHN0cnVjdHVyZTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogLy8gTGV0J3MgY3JlYXRlIGEgZG9jdW1lbnQgZnJhZ21lbnQgY29udGFpbmluZyBzdWNoIGNvbnRlbnQgYXM6XG5cdCAqIC8vXG5cdCAqIC8vIDxwYXJhZ3JhcGg+Zm9vPC9wYXJhZ3JhcGg+XG5cdCAqIC8vIDxibG9ja1F1b3RlPlxuXHQgKiAvLyAgICA8cGFyYWdyYXBoPmJhcjwvcGFyYWdyYXBoPlxuXHQgKiAvLyA8L2Jsb2NrUXVvdGU+XG5cdCAqIGNvbnN0IGRvY0ZyYWcgPSBlZGl0b3IubW9kZWwuY2hhbmdlKCB3cml0ZXIgPT4ge1xuXHQgKiBcdGNvbnN0IHAxID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYXJhZ3JhcGgnICk7XG5cdCAqIFx0Y29uc3QgcDIgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCggJ3BhcmFncmFwaCcgKTtcblx0ICogXHRjb25zdCBibG9ja1F1b3RlID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdibG9ja1F1b3RlJyApO1xuXHQgKiBcdGNvbnN0IGRvY0ZyYWcgPSB3cml0ZXIuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXHQgKlxuXHQgKiBcdHdyaXRlci5hcHBlbmQoIHAxLCBkb2NGcmFnICk7XG5cdCAqIFx0d3JpdGVyLmFwcGVuZCggYmxvY2tRdW90ZSwgZG9jRnJhZyApO1xuXHQgKiBcdHdyaXRlci5hcHBlbmQoIHAyLCBibG9ja1F1b3RlICk7XG5cdCAqIFx0d3JpdGVyLmluc2VydFRleHQoICdmb28nLCBwMSApO1xuXHQgKiBcdHdyaXRlci5pbnNlcnRUZXh0KCAnYmFyJywgcDIgKTtcblx0ICpcblx0ICogXHRyZXR1cm4gZG9jRnJhZztcblx0ICogfSApO1xuXHQgKlxuXHQgKiAvLyBpbnNlcnRDb250ZW50KCkgZG9lcyBub3QgaGF2ZSB0byBiZSB1c2VkIGluIGEgY2hhbmdlKCkgYmxvY2suIEl0IGNhbiwgdGhvdWdoLFxuXHQgKiAvLyBzbyB0aGlzIGNvZGUgY291bGQgYmUgbW92ZWQgdG8gdGhlIGNhbGxiYWNrIGRlZmluZWQgYWJvdmUuXG5cdCAqIGVkaXRvci5tb2RlbC5pbnNlcnRDb250ZW50KCBkb2NGcmFnICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBVc2luZyBgaW5zZXJ0Q29udGVudCgpYCB3aXRoIGFuIEhUTUwgc3RyaW5nIGNvbnZlcnRlZCB0byBhIG1vZGVsIGRvY3VtZW50IGZyYWdtZW50IChzaW1pbGFyIHRvIHRoZSBwYXN0aW5nIG1lY2hhbmlzbSk6XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIFlvdSBjYW4gY3JlYXRlIHlvdXIgb3duIEh0bWxEYXRhUHJvY2Vzc29yIGluc3RhbmNlIG9yIHVzZSBlZGl0b3IuZGF0YS5wcm9jZXNzb3Jcblx0ICogLy8gaWYgeW91IGhhdmUgbm90IG92ZXJyaWRkZW4gdGhlIGRlZmF1bHQgb25lICh3aGljaCBpcyB0aGUgSHRtbERhdGFQcm9jZXNzb3IgaW5zdGFuY2UpLlxuXHQgKiBjb25zdCBodG1sRFAgPSBuZXcgSHRtbERhdGFQcm9jZXNzb3IoIHZpZXdEb2N1bWVudCApO1xuXHQgKlxuXHQgKiAvLyBDb252ZXJ0IGFuIEhUTUwgc3RyaW5nIHRvIGEgdmlldyBkb2N1bWVudCBmcmFnbWVudDpcblx0ICogY29uc3Qgdmlld0ZyYWdtZW50ID0gaHRtbERQLnRvVmlldyggaHRtbFN0cmluZyApO1xuXHQgKlxuXHQgKiAvLyBDb252ZXJ0IHRoZSB2aWV3IGRvY3VtZW50IGZyYWdtZW50IHRvIGEgbW9kZWwgZG9jdW1lbnQgZnJhZ21lbnRcblx0ICogLy8gaW4gdGhlIGNvbnRleHQgb2YgJHJvb3QuIFRoaXMgY29udmVyc2lvbiB0YWtlcyB0aGUgc2NoZW1hIGludG9cblx0ICogLy8gYWNjb3VudCBzbyBpZiwgZm9yIGV4YW1wbGUsIHRoZSB2aWV3IGRvY3VtZW50IGZyYWdtZW50IGNvbnRhaW5lZCBhIGJhcmUgdGV4dCBub2RlLFxuXHQgKiAvLyB0aGlzIHRleHQgbm9kZSBjYW5ub3QgYmUgYSBjaGlsZCBvZiAkcm9vdCwgc28gaXQgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG5cdCAqIC8vIHdyYXBwZWQgd2l0aCBhIDxwYXJhZ3JhcGg+LiBZb3UgY2FuIGRlZmluZSB0aGUgY29udGV4dCB5b3Vyc2VsZiAoaW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIpLFxuXHQgKiAvLyBhbmQgZS5nLiBjb252ZXJ0IHRoZSBjb250ZW50IGxpa2UgaXQgd291bGQgaGFwcGVuIGluIGEgPHBhcmFncmFwaD4uXG5cdCAqIC8vIE5vdGU6IFRoZSBjbGlwYm9hcmQgZmVhdHVyZSB1c2VzIGEgY3VzdG9tIGNvbnRleHQgY2FsbGVkICRjbGlwYm9hcmRIb2xkZXJcblx0ICogLy8gd2hpY2ggaGFzIGEgbG9vc2VuZWQgc2NoZW1hLlxuXHQgKiBjb25zdCBtb2RlbEZyYWdtZW50ID0gZWRpdG9yLmRhdGEudG9Nb2RlbCggdmlld0ZyYWdtZW50ICk7XG5cdCAqXG5cdCAqIGVkaXRvci5tb2RlbC5pbnNlcnRDb250ZW50KCBtb2RlbEZyYWdtZW50ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBCeSBkZWZhdWx0IHRoaXMgbWV0aG9kIHdpbGwgdXNlIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gYnV0IGl0IGNhbiBhbHNvIGJlIHVzZWQgd2l0aCBhIHBvc2l0aW9uLCByYW5nZSBvciBzZWxlY3Rpb24gaW5zdGFuY2UuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIC8vIEluc2VydCB0ZXh0IGF0IHRoZSBjdXJyZW50IGRvY3VtZW50IHNlbGVjdGlvbiBwb3NpdGlvbi5cblx0ICogZWRpdG9yLm1vZGVsLmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHRlZGl0b3IubW9kZWwuaW5zZXJ0Q29udGVudCggd3JpdGVyLmNyZWF0ZVRleHQoICd4JyApICk7XG5cdCAqIH0gKTtcblx0ICpcblx0ICogLy8gSW5zZXJ0IHRleHQgYXQgYSBnaXZlbiBwb3NpdGlvbiAtIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gd2lsbCBub3QgYmUgbW9kaWZpZWQuXG5cdCAqIGVkaXRvci5tb2RlbC5jaGFuZ2UoIHdyaXRlciA9PiB7XG5cdCAqIFx0ZWRpdG9yLm1vZGVsLmluc2VydENvbnRlbnQoIHdyaXRlci5jcmVhdGVUZXh0KCAneCcgKSwgZG9jLmdldFJvb3QoKSwgMiApO1xuXHQgKlxuXHQgKiBcdC8vIFdoaWNoIGlzIGEgc2hvcnRoYW5kIGZvcjpcblx0ICogXHRlZGl0b3IubW9kZWwuaW5zZXJ0Q29udGVudCggd3JpdGVyLmNyZWF0ZVRleHQoICd4JyApLCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCggZG9jLmdldFJvb3QoKSwgMiApICk7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIHlvdSB3YW50IHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gdG8gYmUgbW92ZWQgdG8gdGhlIGluc2VydGVkIGNvbnRlbnQsIHVzZSB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNzZXRTZWxlY3Rpb24gYHNldFNlbGVjdGlvbigpYH0gbWV0aG9kIG9mIHRoZSB3cml0ZXIgYWZ0ZXIgaW5zZXJ0aW5nXG5cdCAqIHRoZSBjb250ZW50OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBlZGl0b3IubW9kZWwuY2hhbmdlKCB3cml0ZXIgPT4ge1xuXHQgKiBcdGNvbnN0IHBhcmFncmFwaCA9IHdyaXRlci5jcmVhdGVFbGVtZW50KCAncGFyYWdyYXBoJyApO1xuXHQgKlxuXHQgKiBcdC8vIEluc2VydCBhbiBlbXB0eSBwYXJhZ3JhcGggYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcm9vdC5cblx0ICogXHRlZGl0b3IubW9kZWwuaW5zZXJ0Q29udGVudCggcGFyYWdyYXBoLCB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCggZWRpdG9yLm1vZGVsLmRvY3VtZW50LmdldFJvb3QoKSwgMCApICk7XG5cdCAqXG5cdCAqIFx0Ly8gTW92ZSB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIHRvIHRoZSBpbnNlcnRlZCBwYXJhZ3JhcGguXG5cdCAqIFx0d3JpdGVyLnNldFNlbGVjdGlvbiggcGFyYWdyYXBoLCAnaW4nICk7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIElmIGFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9uIG1vZGVsIHNlbGVjdGlvbn0gaXMgcGFzc2VkIGFzIGBzZWxlY3RhYmxlYCxcblx0ICogdGhlIG5ldyBjb250ZW50IHdpbGwgYmUgaW5zZXJ0ZWQgYXQgdGhlIHBhc3NlZCBzZWxlY3Rpb24gKGluc3RlYWQgb2YgZG9jdW1lbnQgc2VsZWN0aW9uKTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogZWRpdG9yLm1vZGVsLmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHQvLyBDcmVhdGUgYSBzZWxlY3Rpb24gaW4gYSBwYXJhZ3JhcGggdGhhdCB3aWxsIGJlIHVzZWQgYXMgYSBwbGFjZSBvZiBpbnNlcnRpb24uXG5cdCAqIFx0Y29uc3Qgc2VsZWN0aW9uID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbiggcGFyYWdyYXBoLCAnaW4nICk7XG5cdCAqXG5cdCAqIFx0Ly8gSW5zZXJ0IHRoZSBuZXcgdGV4dCBhdCB0aGUgY3JlYXRlZCBzZWxlY3Rpb24uXG5cdCAqIFx0ZWRpdG9yLm1vZGVsLmluc2VydENvbnRlbnQoIHdyaXRlci5jcmVhdGVUZXh0KCAneCcgKSwgc2VsZWN0aW9uICk7XG5cdCAqXG5cdCAqIFx0Ly8gaW5zZXJ0Q29udGVudCgpIG1vZGlmaWVzIHRoZSBwYXNzZWQgc2VsZWN0aW9uIGluc3RhbmNlIHNvIGl0IGNhbiBiZSB1c2VkIHRvIHNldCB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uLlxuXHQgKiBcdC8vIE5vdGU6IFRoaXMgaXMgbm90IG5lY2Vzc2FyeSB3aGVuIHlvdSBwYXNzZWQgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiB0byBpbnNlcnRDb250ZW50KCkuXG5cdCAqIFx0d3JpdGVyLnNldFNlbGVjdGlvbiggc2VsZWN0aW9uICk7XG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBmaXJlcyBpbnNlcnRDb250ZW50XG5cdCAqIEBwYXJhbSBjb250ZW50IFRoZSBjb250ZW50IHRvIGluc2VydC5cblx0ICogQHBhcmFtIHNlbGVjdGFibGUgVGhlIHNlbGVjdGlvbiBpbnRvIHdoaWNoIHRoZSBjb250ZW50IHNob3VsZCBiZSBpbnNlcnRlZC5cblx0ICogSWYgbm90IHByb3ZpZGVkIHRoZSBjdXJyZW50IG1vZGVsIGRvY3VtZW50IHNlbGVjdGlvbiB3aWxsIGJlIHVzZWQuXG5cdCAqIEBwYXJhbSBwbGFjZU9yT2Zmc2V0IFRvIGJlIHVzZWQgd2hlbiBhIG1vZGVsIGl0ZW0gd2FzIHBhc3NlZCBhcyBgc2VsZWN0YWJsZWAuXG5cdCAqIFRoaXMgcGFyYW0gZGVmaW5lcyBhIHBvc2l0aW9uIGluIHJlbGF0aW9uIHRvIHRoYXQgaXRlbS5cblx0ICogYXQgdGhlIGluc2VydGlvbiBwb3NpdGlvbi5cblx0ICovIGluc2VydENvbnRlbnQoY29udGVudCwgc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCwgLi4ucmVzdCkge1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBub3JtYWxpemVTZWxlY3RhYmxlKHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQpO1xuICAgICAgICAvLyBQYXNzaW5nIGFsbCBjYWxsIGFyZ3VtZW50cyBzbyBpdCBhY3RzIGxpa2UgZGVjb3JhdGVkIG1ldGhvZC5cbiAgICAgICAgcmV0dXJuIHRoaXMuZmlyZSgnaW5zZXJ0Q29udGVudCcsIFtcbiAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICBzZWxlY3Rpb24sXG4gICAgICAgICAgICBwbGFjZU9yT2Zmc2V0LFxuICAgICAgICAgICAgLi4ucmVzdFxuICAgICAgICBdKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgYW4ge0BnbGluayBmcmFtZXdvcmsvZGVlcC1kaXZlL3NjaGVtYSNvYmplY3QtZWxlbWVudHMgb2JqZWN0IGVsZW1lbnR9IGF0IGEgc3BlY2lmaWMgcG9zaXRpb24gaW4gdGhlIGVkaXRvciBjb250ZW50LlxuXHQgKlxuXHQgKiBUaGlzIGlzIGEgaGlnaC1sZXZlbCBBUEk6XG5cdCAqICogSXQgdGFrZXMgdGhlIHtAbGluayAjc2NoZW1hIHNjaGVtYX0gaW50byBjb25zaWRlcmF0aW9uLFxuXHQgKiAqIEl0IGNsZWFycyB0aGUgY29udGVudCBvZiBwYXNzZWQgYHNlbGVjdGFibGVgIGJlZm9yZSBpbnNlcnRpbmcsXG5cdCAqICogSXQgY2FuIG1vdmUgdGhlIHNlbGVjdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBwcm9jZXNzLFxuXHQgKiAqIEl0IHdpbGwgY29weSB0aGUgc2VsZWN0ZWQgYmxvY2sncyBhdHRyaWJ1dGVzIHRvIHByZXNlcnZlIHRoZW0gdXBvbiBpbnNlcnRpb24sXG5cdCAqICogSXQgY2FuIHNwbGl0IGVsZW1lbnRzIG9yIHdyYXAgaW5saW5lIG9iamVjdHMgd2l0aCBwYXJhZ3JhcGhzIGlmIHRoZXkgYXJlIG5vdCBhbGxvd2VkIGluIHRhcmdldCBwb3NpdGlvbixcblx0ICogKiBldGMuXG5cdCAqXG5cdCAqICMgTm90ZXNcblx0ICpcblx0ICogKiBJZiB5b3Ugd2FudCB0byBpbnNlcnQgYSBub24tb2JqZWN0IGNvbnRlbnQsIHNlZSB7QGxpbmsgI2luc2VydENvbnRlbnR9IGluc3RlYWQuXG5cdCAqICogRm9yIGxvd2VyLWxldmVsIEFQSSwgc2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3dyaXRlcn5Xcml0ZXIgYFdyaXRlcmB9LlxuXHQgKiAqIFVubGlrZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyIGBXcml0ZXJgfSwgdGhpcyBtZXRob2QgZG9lcyBub3QgaGF2ZSB0byBiZSB1c2VkIGluc2lkZVxuXHQgKiBhIHtAbGluayAjY2hhbmdlIGBjaGFuZ2UoKWAgYmxvY2t9LlxuXHQgKiAqIEluc2VydGluZyBvYmplY3QgaW50byB0aGUgbW9kZWwgaXMgbm90IGVub3VnaCB0byBtYWtlIENLRWRpdG9yIDUgcmVuZGVyIHRoYXQgY29udGVudCB0byB0aGUgdXNlci5cblx0ICogQ0tFZGl0b3IgNSBpbXBsZW1lbnRzIGEgbW9kZWwtdmlldy1jb250cm9sbGVyIGFyY2hpdGVjdHVyZSBhbmQgd2hhdCBgbW9kZWwuaW5zZXJ0T2JqZWN0KClgIGRvZXNcblx0ICogaXMgb25seSBhZGRpbmcgbm9kZXMgdG8gdGhlIG1vZGVsLiBBZGRpdGlvbmFsbHksIHlvdSBuZWVkIHRvIGRlZmluZVxuXHQgKiB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjY29udmVyc2lvbiBjb252ZXJ0ZXJzfSBiZXR3ZWVuIHRoZSBtb2RlbCBhbmQgdmlld1xuXHQgKiBhbmQgZGVmaW5lIHRob3NlIG5vZGVzIGluIHRoZSB7QGdsaW5rIGZyYW1ld29yay9hcmNoaXRlY3R1cmUvZWRpdGluZy1lbmdpbmUjc2NoZW1hIHNjaGVtYX0uXG5cdCAqXG5cdCAqICMgRXhhbXBsZXNcblx0ICpcblx0ICogVXNlIHRoZSBmb2xsb3dpbmcgY29kZSB0byBpbnNlcnQgYW4gb2JqZWN0IGF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbiBhbmQga2VlcCB0aGUgc2VsZWN0aW9uIG9uIHRoZSBpbnNlcnRlZCBlbGVtZW50OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCByYXdIdG1sRW1iZWRFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdyYXdIdG1sJyApO1xuXHQgKlxuXHQgKiBtb2RlbC5pbnNlcnRPYmplY3QoIHJhd0h0bWxFbWJlZEVsZW1lbnQsIG51bGwsIG51bGwsIHtcblx0ICogXHRzZXRTZWxlY3Rpb246ICdvbidcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogVXNlIHRoZSBmb2xsb3dpbmcgY29kZSB0byBpbnNlcnQgYW4gb2JqZWN0IGF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbiBhbmQgbnVkZ2UgdGhlIHNlbGVjdGlvbiBhZnRlciB0aGUgaW5zZXJ0ZWQgb2JqZWN0OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBjb25zdCBwYWdlQnJlYWtFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwYWdlQnJlYWsnICk7XG4gXHQgKlxuXHQgKiBtb2RlbC5pbnNlcnRPYmplY3QoIHBhZ2VCcmVha0VsZW1lbnQsIG51bGwsIG51bGwsIHtcblx0ICogXHRzZXRTZWxlY3Rpb246ICdhZnRlcidcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogVXNlIHRoZSBmb2xsb3dpbmcgY29kZSB0byBpbnNlcnQgYW4gb2JqZWN0IGF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbiBhbmQgYXZvaWQgc3BsaXR0aW5nIHRoZSBjb250ZW50IChub24tZGVzdHJ1Y3RpdmUgaW5zZXJ0aW9uKTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdGFibGVFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICd0YWJsZScgKTtcbiBcdCAqXG5cdCAqIG1vZGVsLmluc2VydE9iamVjdCggdGFibGVFbGVtZW50LCBudWxsLCBudWxsLCB7XG5cdCAqIFx0ZmluZE9wdGltYWxQb3NpdGlvbjogJ2F1dG8nXG5cdCAqIH0gKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIFVzZSB0aGUgZm9sbG93aW5nIGNvZGUgdG8gaW5zZXJ0IGFuIG9iamVjdCBhdCB0aGUgc3BlY2lmaWMgcmFuZ2UgKGFsc286IHJlcGxhY2UgdGhlIGNvbnRlbnQgb2YgdGhlIHJhbmdlKTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogY29uc3QgdGFibGVFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZUVsZW1lbnQoICd0YWJsZScgKTtcblx0ICogY29uc3QgcmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZU9uKCBtb2RlbC5kb2N1bWVudC5nZXRSb290KCkuZ2V0Q2hpbGQoIDEgKSApO1xuIFx0ICpcblx0ICogbW9kZWwuaW5zZXJ0T2JqZWN0KCB0YWJsZUVsZW1lbnQsIHJhbmdlICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBBbiBvYmplY3QgdG8gYmUgaW5zZXJ0ZWQgaW50byB0aGUgbW9kZWwgZG9jdW1lbnQuXG5cdCAqIEBwYXJhbSBzZWxlY3RhYmxlIEEgc2VsZWN0YWJsZSB3aGVyZSB0aGUgY29udGVudCBzaG91bGQgYmUgaW5zZXJ0ZWQuIElmIG5vdCBzcGVjaWZpZWQsIHRoZSBjdXJyZW50XG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2RvY3VtZW50fkRvY3VtZW50I3NlbGVjdGlvbiBkb2N1bWVudCBzZWxlY3Rpb259IHdpbGwgYmUgdXNlZCBpbnN0ZWFkLlxuXHQgKiBAcGFyYW0gcGxhY2VPck9mZnNldCBTcGVjaWZpZXMgdGhlIGV4YWN0IHBsYWNlIG9yIG9mZnNldCBmb3IgdGhlIGluc2VydGlvbiB0byB0YWtlIHBsYWNlLCByZWxhdGl2ZSB0byBgc2VsZWN0YWJsZWAuXG5cdCAqIEBwYXJhbSBvcHRpb25zIEFkZGl0aW9uYWwgb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuZmluZE9wdGltYWxQb3NpdGlvbiBBbiBvcHRpb24gdGhhdCwgd2hlbiBzZXQsIGFkanVzdHMgdGhlIGluc2VydGlvbiBwb3NpdGlvbiAocmVsYXRpdmUgdG9cblx0ICogYHNlbGVjdGFibGVgIGFuZCBgcGxhY2VPck9mZnNldGApIHNvIHRoYXQgdGhlIGNvbnRlbnQgb2YgYHNlbGVjdGFibGVgIGlzIG5vdCBzcGxpdCB1cG9uIGluc2VydGlvbiAoYS5rLmEuIG5vbi1kZXN0cnVjdGl2ZSBpbnNlcnRpb24pLlxuXHQgKiAqIFdoZW4gYCdhdXRvJ2AsIHRoZSBhbGdvcml0aG0gd2lsbCBkZWNpZGUgd2hldGhlciB0byBpbnNlcnQgdGhlIG9iamVjdCBiZWZvcmUgb3IgYWZ0ZXIgYHNlbGVjdGFibGVgIHRvIGF2b2lkIGNvbnRlbnQgc3BsaXR0aW5nLlxuXHQgKiAqIFdoZW4gYCdiZWZvcmUnYCwgdGhlIGNsb3Nlc3QgcG9zaXRpb24gYmVmb3JlIGBzZWxlY3RhYmxlYCB3aWxsIGJlIHVzZWQgdGhhdCB3aWxsIG5vdCByZXN1bHQgaW4gY29udGVudCBzcGxpdHRpbmcuXG5cdCAqICogV2hlbiBgJ2FmdGVyJ2AsIHRoZSBjbG9zZXN0IHBvc2l0aW9uIGFmdGVyIGBzZWxlY3RhYmxlYCB3aWxsIGJlIHVzZWQgdGhhdCB3aWxsIG5vdCByZXN1bHQgaW4gY29udGVudCBzcGxpdHRpbmcuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGlzIG9wdGlvbiBvbmx5IHdvcmtzIGZvciBibG9jayBvYmplY3RzLiBJbmxpbmUgb2JqZWN0cyBhcmUgaW5zZXJ0ZWQgaW50byB0ZXh0IGFuZCBkbyBub3Qgc3BsaXQgYmxvY2tzLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zZXRTZWxlY3Rpb24gQW4gb3B0aW9uIHRoYXQsIHdoZW4gc2V0LCBtb3ZlcyB0aGVcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQjc2VsZWN0aW9uIGRvY3VtZW50IHNlbGVjdGlvbn0gYWZ0ZXIgaW5zZXJ0aW5nIHRoZSBvYmplY3QuXG5cdCAqICogV2hlbiBgJ29uJ2AsIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gd2lsbCBiZSBzZXQgb24gdGhlIGluc2VydGVkIG9iamVjdC5cblx0ICogKiBXaGVuIGAnYWZ0ZXInYCwgdGhlIGRvY3VtZW50IHNlbGVjdGlvbiB3aWxsIG1vdmUgdG8gdGhlIGNsb3Nlc3QgdGV4dCBub2RlIGFmdGVyIHRoZSBpbnNlcnRlZCBvYmplY3QuIElmIHRoZXJlIGlzIG5vXG5cdCAqIHN1Y2ggdGV4dCBub2RlLCBhIHBhcmFncmFwaCB3aWxsIGJlIGNyZWF0ZWQgYW5kIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gd2lsbCBiZSBtb3ZlZCBpbnNpZGUgaXQuXG5cdCAqIGF0IHRoZSBpbnNlcnRpb24gcG9zaXRpb24uXG5cdCAqLyBpbnNlcnRPYmplY3QoZWxlbWVudCwgc2VsZWN0YWJsZSwgcGxhY2VPck9mZnNldCwgb3B0aW9ucywgLi4ucmVzdCkge1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBub3JtYWxpemVTZWxlY3RhYmxlKHNlbGVjdGFibGUsIHBsYWNlT3JPZmZzZXQpO1xuICAgICAgICAvLyBOb3RlIHRoYXQgb3B0aW9ucyBhcmUgZmlyZWQgYXMgMiBhcmd1bWVudHMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCB0aGUgZGVjb3JhdGVkIG1ldGhvZC5cbiAgICAgICAgLy8gUGFzc2luZyBhbGwgY2FsbCBhcmd1bWVudHMgc28gaXQgYWN0cyBsaWtlIGRlY29yYXRlZCBtZXRob2QuXG4gICAgICAgIHJldHVybiB0aGlzLmZpcmUoJ2luc2VydE9iamVjdCcsIFtcbiAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICBzZWxlY3Rpb24sXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIC4uLnJlc3RcbiAgICAgICAgXSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBEZWxldGVzIGNvbnRlbnQgb2YgdGhlIHNlbGVjdGlvbiBhbmQgbWVyZ2Ugc2libGluZ3MuIFRoZSByZXN1bHRpbmcgc2VsZWN0aW9uIGlzIGFsd2F5cyBjb2xsYXBzZWQuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBGb3IgdGhlIHNha2Ugb2YgcHJlZGljdGFiaWxpdHksIHRoZSByZXN1bHRpbmcgc2VsZWN0aW9uIHNob3VsZCBhbHdheXMgYmUgY29sbGFwc2VkLlxuXHQgKiBJbiBjYXNlcyB3aGVyZSBhIGZlYXR1cmUgd2FudHMgdG8gbW9kaWZ5IGRlbGV0aW5nIGJlaGF2aW9yIHNvIHNlbGVjdGlvbiBpc24ndCBjb2xsYXBzZWRcblx0ICogKGUuZy4gYSB0YWJsZSBmZWF0dXJlIG1heSB3YW50IHRvIGtlZXAgcm93IHNlbGVjdGlvbiBhZnRlciBwcmVzc2luZyA8a2JkPkJhY2tzcGFjZTwva2JkPiksXG5cdCAqIHRoZW4gdGhhdCBiZWhhdmlvciBzaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gdGhlIHZpZXcncyBsaXN0ZW5lci4gQXQgdGhlIHNhbWUgdGltZSwgdGhlIHRhYmxlIGZlYXR1cmVcblx0ICogd2lsbCBuZWVkIHRvIG1vZGlmeSB0aGlzIG1ldGhvZCdzIGJlaGF2aW9yIHRvbywgZS5nLiB0byBcImRlbGV0ZSBjb250ZW50cyBhbmQgdGhlbiBjb2xsYXBzZVxuXHQgKiB0aGUgc2VsZWN0aW9uIGluc2lkZSB0aGUgbGFzdCBzZWxlY3RlZCBjZWxsXCIgb3IgXCJkZWxldGUgdGhlIHJvdyBhbmQgY29sbGFwc2Ugc2VsZWN0aW9uIHNvbWV3aGVyZSBuZWFyXCIuXG5cdCAqIFRoYXQgbmVlZHMgdG8gYmUgZG9uZSBpbiBvcmRlciB0byBlbnN1cmUgdGhhdCBvdGhlciBmZWF0dXJlcyB3aGljaCB1c2UgYGRlbGV0ZUNvbnRlbnQoKWAgd2lsbCB3b3JrIHdlbGwgd2l0aCB0YWJsZXMuXG5cdCAqXG5cdCAqIEBmaXJlcyBkZWxldGVDb250ZW50XG5cdCAqIEBwYXJhbSBzZWxlY3Rpb24gU2VsZWN0aW9uIG9mIHdoaWNoIHRoZSBjb250ZW50IHNob3VsZCBiZSBkZWxldGVkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5sZWF2ZVVubWVyZ2VkIFdoZXRoZXIgdG8gbWVyZ2UgZWxlbWVudHMgYWZ0ZXIgcmVtb3ZpbmcgdGhlIGNvbnRlbnQgb2YgdGhlIHNlbGVjdGlvbi5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUgYDxoZWFkaW5nMT54W3g8L2hlYWRpbmcxPjxwYXJhZ3JhcGg+eV15PC9wYXJhZ3JhcGg+YCB3aWxsIGJlY29tZTpcblx0ICpcblx0ICogKiBgPGhlYWRpbmcxPnheeTwvaGVhZGluZzE+YCB3aXRoIHRoZSBvcHRpb24gZGlzYWJsZWQgKGBsZWF2ZVVubWVyZ2VkID09IGZhbHNlYClcblx0ICogKiBgPGhlYWRpbmcxPnhePC9oZWFkaW5nMT48cGFyYWdyYXBoPnk8L3BhcmFncmFwaD5gIHdpdGggZW5hYmxlZCAoYGxlYXZlVW5tZXJnZWQgPT0gdHJ1ZWApLlxuXHQgKlxuXHQgKiBOb3RlOiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI2lzT2JqZWN0IG9iamVjdH0gYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEjaXNMaW1pdCBsaW1pdH1cblx0ICogZWxlbWVudHMgd2lsbCBub3QgYmUgbWVyZ2VkLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5kb05vdFJlc2V0RW50aXJlQ29udGVudCBXaGV0aGVyIHRvIHNraXAgcmVwbGFjaW5nIHRoZSBlbnRpcmUgY29udGVudCB3aXRoIGFcblx0ICogcGFyYWdyYXBoIHdoZW4gdGhlIGVudGlyZSBjb250ZW50IHdhcyBzZWxlY3RlZC5cblx0ICpcblx0ICogRm9yIGV4YW1wbGUgYDxoZWFkaW5nMT5beDwvaGVhZGluZzE+PHBhcmFncmFwaD55XTwvcGFyYWdyYXBoPmAgd2lsbCBiZWNvbWU6XG5cdCAqXG5cdCAqICogYDxwYXJhZ3JhcGg+XjwvcGFyYWdyYXBoPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgZG9Ob3RSZXNldEVudGlyZUNvbnRlbnQgPT0gZmFsc2VgKVxuXHQgKiAqIGA8aGVhZGluZzE+XjwvaGVhZGluZzE+YCB3aXRoIGVuYWJsZWQgKGBkb05vdFJlc2V0RW50aXJlQ29udGVudCA9PSB0cnVlYClcblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMuZG9Ob3RBdXRvcGFyYWdyYXBoIFdoZXRoZXIgdG8gY3JlYXRlIGEgcGFyYWdyYXBoIGlmIGFmdGVyIGNvbnRlbnQgZGVsZXRpb24gc2VsZWN0aW9uIGlzIG1vdmVkXG5cdCAqIHRvIGEgcGxhY2Ugd2hlcmUgdGV4dCBjYW5ub3QgYmUgaW5zZXJ0ZWQuXG5cdCAqXG5cdCAqIEZvciBleGFtcGxlIGA8cGFyYWdyYXBoPng8L3BhcmFncmFwaD5bPGltYWdlQmxvY2sgc3JjPVwiZm9vLmpwZ1wiPjwvaW1hZ2VCbG9jaz5dYCB3aWxsIGJlY29tZTpcblx0ICpcblx0ICogKiBgPHBhcmFncmFwaD54PC9wYXJhZ3JhcGg+PHBhcmFncmFwaD5bXTwvcGFyYWdyYXBoPmAgd2l0aCB0aGUgb3B0aW9uIGRpc2FibGVkIChgZG9Ob3RBdXRvcGFyYWdyYXBoID09IGZhbHNlYClcblx0ICogKiBgPHBhcmFncmFwaD54W108L3BhcmFncmFwaD5gIHdpdGggdGhlIG9wdGlvbiBlbmFibGVkIChgZG9Ob3RBdXRvcGFyYWdyYXBoID09IHRydWVgKS5cblx0ICpcblx0ICogKipOb3RlOioqIGlmIHRoZXJlIGlzIG5vIHZhbGlkIHBvc2l0aW9uIGZvciB0aGUgc2VsZWN0aW9uLCB0aGUgcGFyYWdyYXBoIHdpbGwgYWx3YXlzIGJlIGNyZWF0ZWQ6XG5cdCAqXG5cdCAqIGBbPGltYWdlQmxvY2sgc3JjPVwiZm9vLmpwZ1wiPjwvaW1hZ2VCbG9jaz5dYCAtPiBgPHBhcmFncmFwaD5bXTwvcGFyYWdyYXBoPmAuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zLmRpcmVjdGlvbiBUaGUgZGlyZWN0aW9uIGluIHdoaWNoIHRoZSBjb250ZW50IGlzIGJlaW5nIGNvbnN1bWVkLlxuXHQgKiBEZWxldGluZyBiYWNrd2FyZCBjb3JyZXNwb25kcyB0byB1c2luZyB0aGUgPGtiZD5CYWNrc3BhY2U8L2tiZD4ga2V5LCB3aGlsZSBkZWxldGluZyBjb250ZW50IGZvcndhcmQgY29ycmVzcG9uZHMgdG9cblx0ICogdGhlIDxrYmQ+U2hpZnQ8L2tiZD4rPGtiZD5CYWNrc3BhY2U8L2tiZD4ga2V5c3Ryb2tlLlxuXHQgKi8gZGVsZXRlQ29udGVudChzZWxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgZGVsZXRlQ29udGVudCh0aGlzLCBzZWxlY3Rpb24sIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcblx0ICogTW9kaWZpZXMgdGhlIHNlbGVjdGlvbi4gQ3VycmVudGx5LCB0aGUgc3VwcG9ydGVkIG1vZGlmaWNhdGlvbnMgYXJlOlxuXHQgKlxuXHQgKiAqIEV4dGVuZGluZy4gVGhlIHNlbGVjdGlvbiBmb2N1cyBpcyBtb3ZlZCBpbiB0aGUgc3BlY2lmaWVkIGBvcHRpb25zLmRpcmVjdGlvbmAgd2l0aCBhIHN0ZXAgc3BlY2lmaWVkIGluIGBvcHRpb25zLnVuaXRgLlxuXHQgKiBQb3NzaWJsZSB2YWx1ZXMgZm9yIGB1bml0YCBhcmU6XG5cdCAqICAqIGAnY2hhcmFjdGVyJ2AgKGRlZmF1bHQpIC0gbW92ZXMgc2VsZWN0aW9uIGJ5IG9uZSB1c2VyLXBlcmNlaXZlZCBjaGFyYWN0ZXIuIEluIG1vc3QgY2FzZXMgdGhpcyBtZWFucyBtb3ZpbmcgYnkgb25lXG5cdCAqICBjaGFyYWN0ZXIgaW4gYFN0cmluZ2Agc2Vuc2UuIEhvd2V2ZXIsIHVuaWNvZGUgYWxzbyBkZWZpbmVzIFwiY29tYmluZyBtYXJrc1wiLiBUaGVzZSBhcmUgc3BlY2lhbCBzeW1ib2xzLCB0aGF0IGNvbWJpbmVzXG5cdCAqICB3aXRoIGEgc3ltYm9sIGJlZm9yZSBpdCAoXCJiYXNlIGNoYXJhY3RlclwiKSB0byBjcmVhdGUgb25lIHVzZXItcGVyY2VpdmVkIGNoYXJhY3Rlci4gRm9yIGV4YW1wbGUsIGBxzIfMo2AgaXMgYSBub3JtYWxcblx0ICogIGxldHRlciBgcWAgd2l0aCB0d28gXCJjb21iaW5pbmcgbWFya3NcIjogdXBwZXIgZG90IChgVXgwMzA3YCkgYW5kIGxvd2VyIGRvdCAoYFV4MDMyM2ApLiBGb3IgbW9zdCBhY3Rpb25zLCBpLmUuIGV4dGVuZGluZ1xuXHQgKiAgc2VsZWN0aW9uIGJ5IG9uZSBwb3NpdGlvbiwgaXQgaXMgY29ycmVjdCB0byBpbmNsdWRlIGJvdGggXCJiYXNlIGNoYXJhY3RlclwiIGFuZCBhbGwgb2YgaXQncyBcImNvbWJpbmluZyBtYXJrc1wiLiBUaGF0IGlzXG5cdCAqICB3aHkgYCdjaGFyYWN0ZXInYCB2YWx1ZSBpcyBtb3N0IG5hdHVyYWwgYW5kIGNvbW1vbiBtZXRob2Qgb2YgbW9kaWZ5aW5nIHNlbGVjdGlvbi5cblx0ICogICogYCdjb2RlUG9pbnQnYCAtIG1vdmVzIHNlbGVjdGlvbiBieSBvbmUgdW5pY29kZSBjb2RlIHBvaW50LiBJbiBjb250cmFyeSB0bywgYCdjaGFyYWN0ZXInYCB1bml0LCB0aGlzIHdpbGwgaW5zZXJ0XG5cdCAqICBzZWxlY3Rpb24gYmV0d2VlbiBcImJhc2UgY2hhcmFjdGVyXCIgYW5kIFwiY29tYmluaW5nIG1hcmtcIiwgYmVjYXVzZSBcImNvbWJpbmluZyBtYXJrc1wiIGhhdmUgdGhlaXIgb3duIHVuaWNvZGUgY29kZSBwb2ludHMuXG5cdCAqICBIb3dldmVyLCBmb3IgdGVjaG5pY2FsIHJlYXNvbnMsIHVuaWNvZGUgY29kZSBwb2ludHMgd2l0aCB2YWx1ZXMgYWJvdmUgYFV4RkZGRmAgYXJlIHJlcHJlc2VudGVkIGluIG5hdGl2ZSBgU3RyaW5nYCBieVxuXHQgKiAgdHdvIGNoYXJhY3RlcnMsIGNhbGxlZCBcInN1cnJvZ2F0ZSBwYWlyc1wiLiBIYWx2ZXMgb2YgXCJzdXJyb2dhdGUgcGFpcnNcIiBoYXZlIGEgbWVhbmluZyBvbmx5IHdoZW4gcGxhY2VkIG5leHQgdG8gZWFjaCBvdGhlci5cblx0ICogIEZvciBleGFtcGxlIGDwqK2OYCBpcyByZXByZXNlbnRlZCBpbiBgU3RyaW5nYCBieSBgXFx1RDg2MlxcdURGNEVgLiBCb3RoIGBcXHVEODYyYCBhbmQgYFxcdURGNEVgIGRvIG5vdCBoYXZlIGFueSBtZWFuaW5nXG5cdCAqICBvdXRzaWRlIHRoZSBwYWlyIChhcmUgcmVuZGVyZWQgYXMgPyB3aGVuIGFsb25lKS4gUG9zaXRpb24gYmV0d2VlbiB0aGVtIHdvdWxkIGJlIGluY29ycmVjdC4gSW4gdGhpcyBjYXNlLCBzZWxlY3Rpb25cblx0ICogIGV4dGVuc2lvbiB3aWxsIGluY2x1ZGUgd2hvbGUgXCJzdXJyb2dhdGUgcGFpclwiLlxuXHQgKiAgKiBgJ3dvcmQnYCAtIG1vdmVzIHNlbGVjdGlvbiBieSBhIHdob2xlIHdvcmQuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBpZiB5b3UgZXh0ZW5kIGEgZm9yd2FyZCBzZWxlY3Rpb24gaW4gYSBiYWNrd2FyZCBkaXJlY3Rpb24geW91IHdpbGwgaW4gZmFjdCBzaHJpbmsgaXQuXG5cdCAqXG5cdCAqIEBmaXJlcyBtb2RpZnlTZWxlY3Rpb25cblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIHRvIG1vZGlmeS5cblx0ICogQHBhcmFtIG9wdGlvbnMuZGlyZWN0aW9uIFRoZSBkaXJlY3Rpb24gaW4gd2hpY2ggdGhlIHNlbGVjdGlvbiBzaG91bGQgYmUgbW9kaWZpZWQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnVuaXQgVGhlIHVuaXQgYnkgd2hpY2ggc2VsZWN0aW9uIHNob3VsZCBiZSBtb2RpZmllZC5cblx0ICogQHBhcmFtIG9wdGlvbnMudHJlYXRFbW9qaUFzU2luZ2xlVW5pdCBXaGV0aGVyIG11bHRpLWNoYXJhY2VyIGVtb2ppIHNlcXVlbmNlcyBzaG91bGQgYmUgaGFuZGxlZCBhcyBzaW5nbGUgdW5pdC5cblx0ICovIG1vZGlmeVNlbGVjdGlvbihzZWxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgbW9kaWZ5U2VsZWN0aW9uKHRoaXMsIHNlbGVjdGlvbiwgb3B0aW9ucyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGEgY2xvbmUgb2YgdGhlIHNlbGVjdGVkIGNvbnRlbnQuXG5cdCAqXG5cdCAqIEZvciBleGFtcGxlLCBmb3IgdGhlIGZvbGxvd2luZyBzZWxlY3Rpb246XG5cdCAqXG5cdCAqIGBgYGh0bWxcblx0ICogPHBhcmFncmFwaD54PC9wYXJhZ3JhcGg+XG5cdCAqIDxibG9ja1F1b3RlPlxuXHQgKiBcdDxwYXJhZ3JhcGg+eTwvcGFyYWdyYXBoPlxuXHQgKiBcdDxoZWFkaW5nMT5maXJbc3Q8L2hlYWRpbmcxPlxuXHQgKiA8L2Jsb2NrUXVvdGU+XG5cdCAqIDxwYXJhZ3JhcGg+c2VdY29uZDwvcGFyYWdyYXBoPlxuXHQgKiA8cGFyYWdyYXBoPno8L3BhcmFncmFwaD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEl0IHdpbGwgcmV0dXJuIGEgZG9jdW1lbnQgZnJhZ21lbnQgd2l0aCBzdWNoIGEgY29udGVudDpcblx0ICpcblx0ICogYGBgaHRtbFxuXHQgKiA8YmxvY2tRdW90ZT5cblx0ICogXHQ8aGVhZGluZzE+c3Q8L2hlYWRpbmcxPlxuXHQgKiA8L2Jsb2NrUXVvdGU+XG5cdCAqIDxwYXJhZ3JhcGg+c2U8L3BhcmFncmFwaD5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEBmaXJlcyBnZXRTZWxlY3RlZENvbnRlbnRcblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIG9mIHdoaWNoIGNvbnRlbnQgd2lsbCBiZSByZXR1cm5lZC5cblx0ICovIGdldFNlbGVjdGVkQ29udGVudChzZWxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGdldFNlbGVjdGVkQ29udGVudCh0aGlzLCBzZWxlY3Rpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3JhbmdlflJhbmdlIHJhbmdlfSBvclxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gaGFzIGFueSBtZWFuaW5nZnVsIGNvbnRlbnQuXG5cdCAqXG5cdCAqIE1lYW5pbmdmdWwgY29udGVudCBpczpcblx0ICpcblx0ICogKiBhbnkgdGV4dCBub2RlIChgb3B0aW9ucy5pZ25vcmVXaGl0ZXNwYWNlc2AgYWxsb3dzIGNvbnRyb2xsaW5nIHdoZXRoZXIgdGhpcyB0ZXh0IG5vZGUgbXVzdCBhbHNvIGNvbnRhaW5cblx0ICogYW55IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMpLFxuXHQgKiAqIG9yIGFueSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zY2hlbWF+U2NoZW1hI2lzQ29udGVudCBjb250ZW50IGVsZW1lbnR9LFxuXHQgKiAqIG9yIGFueSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tYXJrZXJjb2xsZWN0aW9ufk1hcmtlciBtYXJrZXJ9IHdoaWNoXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21hcmtlcmNvbGxlY3Rpb25+TWFya2VyI19hZmZlY3RzRGF0YSBhZmZlY3RzIGRhdGF9LlxuXHQgKlxuXHQgKiBUaGlzIG1lYW5zIHRoYXQgYSByYW5nZSBjb250YWluaW5nIGFuIGVtcHR5IGA8cGFyYWdyYXBoPjwvcGFyYWdyYXBoPmAgaXMgbm90IGNvbnNpZGVyZWQgdG8gaGF2ZSBhIG1lYW5pbmdmdWwgY29udGVudC5cblx0ICogSG93ZXZlciwgYSByYW5nZSBjb250YWluaW5nIGFuIGA8aW1hZ2VCbG9jaz48L2ltYWdlQmxvY2s+YCAod2hpY2ggd291bGQgbm9ybWFsbHkgYmUgbWFya2VkIGluIHRoZSBzY2hlbWEgYXMgYW4gb2JqZWN0IGVsZW1lbnQpXG5cdCAqIGlzIGNvbnNpZGVyZWQgbm9uLWVtcHR5LlxuXHQgKlxuXHQgKiBAcGFyYW0gcmFuZ2VPckVsZW1lbnQgUmFuZ2Ugb3IgZWxlbWVudCB0byBjaGVjay5cblx0ICogQHBhcmFtIG9wdGlvbnMuaWdub3JlV2hpdGVzcGFjZXMgV2hldGhlciB0ZXh0IG5vZGUgd2l0aCB3aGl0ZXNwYWNlcyBvbmx5IHNob3VsZCBiZSBjb25zaWRlcmVkIGVtcHR5LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5pZ25vcmVNYXJrZXJzIFdoZXRoZXIgbWFya2VycyBzaG91bGQgYmUgaWdub3JlZC5cblx0ICovIGhhc0NvbnRlbnQocmFuZ2VPckVsZW1lbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCByYW5nZSA9IHJhbmdlT3JFbGVtZW50IGluc3RhbmNlb2YgUmFuZ2UgPyByYW5nZU9yRWxlbWVudCA6IFJhbmdlLl9jcmVhdGVJbihyYW5nZU9yRWxlbWVudCk7XG4gICAgICAgIGlmIChyYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgaWdub3JlV2hpdGVzcGFjZXMgPSBmYWxzZSwgaWdub3JlTWFya2VycyA9IGZhbHNlIH0gPSBvcHRpb25zO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IG1hcmtlcnMgd2hpY2ggYWZmZWN0cyBkYXRhIGluIHRoaXMgZ2l2ZW4gcmFuZ2UuXG4gICAgICAgIGlmICghaWdub3JlTWFya2Vycykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBpbnRlcnNlY3RpbmdNYXJrZXIgb2YgdGhpcy5tYXJrZXJzLmdldE1hcmtlcnNJbnRlcnNlY3RpbmdSYW5nZShyYW5nZSkpe1xuICAgICAgICAgICAgICAgIGlmIChpbnRlcnNlY3RpbmdNYXJrZXIuYWZmZWN0c0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiByYW5nZS5nZXRJdGVtcygpKXtcbiAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtYS5pc0NvbnRlbnQoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5pcygnJHRleHRQcm94eScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaWdub3JlV2hpdGVzcGFjZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0YS5zZWFyY2goL1xcUy8pICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2sgd2hldGhlciBnaXZlbiBzZWxlY3RhYmxlIGlzIGF0IGEgcGxhY2UgaW4gdGhlIG1vZGVsIHdoZXJlIGl0IGNhbiBiZSBlZGl0ZWQgKHJldHVybnMgYHRydWVgKSBvciBub3QgKHJldHVybnMgYGZhbHNlYCkuXG5cdCAqXG5cdCAqIFNob3VsZCBiZSB1c2VkIGluc3RlYWQgb2Yge0BsaW5rIG1vZHVsZTpjb3JlL2VkaXRvci9lZGl0b3J+RWRpdG9yI2lzUmVhZE9ubHl9IHRvIGNoZWNrIHdoZXRoZXIgYSB1c2VyIGFjdGlvbiBjYW4gaGFwcGVuIGF0XG5cdCAqIGdpdmVuIHNlbGVjdGFibGUuIEl0IG1heSBiZSBkZWNvcmF0ZWQgYW5kIHVzZWQgZGlmZmVyZW50bHkgaW4gZGlmZmVyZW50IGVudmlyb25tZW50IChlLmcuIG11bHRpLXJvb3QgZWRpdG9yIGNhbiBkaXNhYmxlXG5cdCAqIGEgcGFydGljdWxhciByb290KS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgZGVjb3JhdGVkLiBBbHRob3VnaCB0aGlzIG1ldGhvZCBhY2NlcHRzIGFueSBwYXJhbWV0ZXIgb2YgYFNlbGVjdGFibGVgIHR5cGUsIHRoZVxuXHQgKiB7QGxpbmsgfk1vZGVsI2V2ZW50OmNhbkVkaXRBdCBgY2FuRWRpdEF0YCBldmVudH0gaXMgZmlyZWQgd2l0aCBgc2VsZWN0YWJsZWAgbm9ybWFsaXplZCB0byBhbiBpbnN0YW5jZSBvZlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbn1cblx0ICpcblx0ICogQGZpcmVzIGNhbkVkaXRBdFxuXHQgKi8gY2FuRWRpdEF0KHNlbGVjdGFibGUpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gbm9ybWFsaXplU2VsZWN0YWJsZShzZWxlY3RhYmxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlyZSgnY2FuRWRpdEF0JywgW1xuICAgICAgICAgICAgc2VsZWN0aW9uXG4gICAgICAgIF0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHBvc2l0aW9uIGZyb20gdGhlIGdpdmVuIHJvb3QgYW5kIHBhdGggaW4gdGhhdCByb290LlxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVBvc2l0aW9uRnJvbVBhdGggYFdyaXRlciNjcmVhdGVQb3NpdGlvbkZyb21QYXRoKClgfS5cblx0ICpcblx0ICogQHBhcmFtIHJvb3QgUm9vdCBvZiB0aGUgcG9zaXRpb24uXG5cdCAqIEBwYXJhbSBwYXRoIFBvc2l0aW9uIHBhdGguIFNlZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9wb3NpdGlvbn5Qb3NpdGlvbiNwYXRofS5cblx0ICogQHBhcmFtIHN0aWNraW5lc3MgUG9zaXRpb24gc3RpY2tpbmVzcy4gU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uU3RpY2tpbmVzc30uXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkZyb21QYXRoKHJvb3QsIHBhdGgsIHN0aWNraW5lc3MpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQb3NpdGlvbihyb290LCBwYXRoLCBzdGlja2luZXNzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgcG9zaXRpb24gYXQgdGhlIGdpdmVuIGxvY2F0aW9uLiBUaGUgbG9jYXRpb24gY2FuIGJlIHNwZWNpZmllZCBhczpcblx0ICpcblx0ICogKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSxcblx0ICogKiBhIHBhcmVudCBlbGVtZW50IGFuZCBvZmZzZXQgaW4gdGhhdCBlbGVtZW50LFxuXHQgKiAqIGEgcGFyZW50IGVsZW1lbnQgYW5kIGAnZW5kJ2AgKHRoZSBwb3NpdGlvbiB3aWxsIGJlIHNldCBhdCB0aGUgZW5kIG9mIHRoYXQgZWxlbWVudCksXG5cdCAqICogYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9pdGVtfkl0ZW0gbW9kZWwgaXRlbX0gYW5kIGAnYmVmb3JlJ2Agb3IgYCdhZnRlcidgXG5cdCAqICh0aGUgcG9zaXRpb24gd2lsbCBiZSBzZXQgYmVmb3JlIG9yIGFmdGVyIHRoZSBnaXZlbiBtb2RlbCBpdGVtKS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgYSBzaG9ydGN1dCB0byBvdGhlciBmYWN0b3J5IG1ldGhvZHMgc3VjaCBhczpcblx0ICpcblx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNjcmVhdGVQb3NpdGlvbkJlZm9yZSBgY3JlYXRlUG9zaXRpb25CZWZvcmUoKWB9LFxuXHQgKiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2NyZWF0ZVBvc2l0aW9uQWZ0ZXIgYGNyZWF0ZVBvc2l0aW9uQWZ0ZXIoKWB9LlxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVBvc2l0aW9uQXQgYFdyaXRlciNjcmVhdGVQb3NpdGlvbkF0KClgfSxcblx0ICpcblx0ICogQHBhcmFtIGl0ZW1PclBvc2l0aW9uXG5cdCAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9yIG9uZSBvZiB0aGUgZmxhZ3MuIFVzZWQgb25seSB3aGVuIGZpcnN0IHBhcmFtZXRlciBpcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfS5cblx0ICovIGNyZWF0ZVBvc2l0aW9uQXQoaXRlbU9yUG9zaXRpb24sIG9mZnNldCkge1xuICAgICAgICByZXR1cm4gUG9zaXRpb24uX2NyZWF0ZUF0KGl0ZW1PclBvc2l0aW9uLCBvZmZzZXQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBwb3NpdGlvbiBhZnRlciB0aGUgZ2l2ZW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvaXRlbX5JdGVtIG1vZGVsIGl0ZW19LlxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVBvc2l0aW9uQWZ0ZXIgYFdyaXRlciNjcmVhdGVQb3NpdGlvbkFmdGVyKClgfS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSBhZnRlciB3aGljaCB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIHBsYWNlZC5cblx0ICovIGNyZWF0ZVBvc2l0aW9uQWZ0ZXIoaXRlbSkge1xuICAgICAgICByZXR1cm4gUG9zaXRpb24uX2NyZWF0ZUFmdGVyKGl0ZW0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIG5ldyBwb3NpdGlvbiBiZWZvcmUgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfS5cblx0ICpcblx0ICogTm90ZTogVGhpcyBtZXRob2QgaXMgYWxzbyBhdmFpbGFibGUgYXNcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNjcmVhdGVQb3NpdGlvbkJlZm9yZSBgV3JpdGVyI2NyZWF0ZVBvc2l0aW9uQmVmb3JlKClgfS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gSXRlbSBiZWZvcmUgd2hpY2ggdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBwbGFjZWQuXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkJlZm9yZShpdGVtKSB7XG4gICAgICAgIHJldHVybiBQb3NpdGlvbi5fY3JlYXRlQmVmb3JlKGl0ZW0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHNwYW5uaW5nIGZyb20gdGhlIGBzdGFydGAgcG9zaXRpb24gdG8gdGhlIGBlbmRgIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVJhbmdlIGBXcml0ZXIjY3JlYXRlUmFuZ2UoKWB9OlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiBtb2RlbC5jaGFuZ2UoIHdyaXRlciA9PiB7XG5cdCAqIFx0Y29uc3QgcmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UoIHN0YXJ0LCBlbmQgKTtcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIHN0YXJ0IFN0YXJ0IHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gZW5kIEVuZCBwb3NpdGlvbi4gSWYgbm90IHNldCwgdGhlIHJhbmdlIHdpbGwgYmUgY29sbGFwc2VkIHRvIHRoZSBgc3RhcnRgIHBvc2l0aW9uLlxuXHQgKi8gY3JlYXRlUmFuZ2Uoc3RhcnQsIGVuZCkge1xuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIGluc2lkZSB0aGUgZ2l2ZW4gZWxlbWVudCB3aGljaCBzdGFydHMgYmVmb3JlIHRoZSBmaXJzdCBjaGlsZCBvZlxuXHQgKiB0aGF0IGVsZW1lbnQgYW5kIGVuZHMgYWZ0ZXIgdGhlIGxhc3QgY2hpbGQgb2YgdGhhdCBlbGVtZW50LlxuXHQgKlxuXHQgKiBOb3RlOiBUaGlzIG1ldGhvZCBpcyBhbHNvIGF2YWlsYWJsZSBhc1xuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC93cml0ZXJ+V3JpdGVyI2NyZWF0ZVJhbmdlSW4gYFdyaXRlciNjcmVhdGVSYW5nZUluKClgfTpcblx0ICpcblx0ICogYGBgdHNcblx0ICogbW9kZWwuY2hhbmdlKCB3cml0ZXIgPT4ge1xuXHQgKiBcdGNvbnN0IHJhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlSW4oIHBhcmFncmFwaCApO1xuXHQgKiB9ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHdoaWNoIGlzIGEgcGFyZW50IGZvciB0aGUgcmFuZ2UuXG5cdCAqLyBjcmVhdGVSYW5nZUluKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIFJhbmdlLl9jcmVhdGVJbihlbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSB0aGF0IHN0YXJ0cyBiZWZvcmUgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2l0ZW1+SXRlbSBtb2RlbCBpdGVtfSBhbmQgZW5kcyBhZnRlciBpdC5cblx0ICpcblx0ICogTm90ZTogVGhpcyBtZXRob2QgaXMgYWxzbyBhdmFpbGFibGUgb24gYHdyaXRlcmAgaW5zdGFuY2UgYXNcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvd3JpdGVyfldyaXRlciNjcmVhdGVSYW5nZU9uIGBXcml0ZXIuY3JlYXRlUmFuZ2VPbigpYH06XG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIG1vZGVsLmNoYW5nZSggd3JpdGVyID0+IHtcblx0ICogXHRjb25zdCByYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZU9uKCBwYXJhZ3JhcGggKTtcblx0ICogfSApO1xuXHQgKiBgYGBcblx0ICpcblx0ICogQHBhcmFtIGl0ZW1cblx0ICovIGNyZWF0ZVJhbmdlT24oaXRlbSkge1xuICAgICAgICByZXR1cm4gUmFuZ2UuX2NyZWF0ZU9uKGl0ZW0pO1xuICAgIH1cbiAgICBjcmVhdGVTZWxlY3Rpb24oLi4uYXJncykge1xuICAgICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbiguLi5hcmdzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9iYXRjaH5CYXRjaH0gaW5zdGFuY2UuXG5cdCAqXG5cdCAqICoqTm90ZToqKiBJbiBtb3N0IGNhc2VzIGNyZWF0aW5nIGEgYmF0Y2ggaW5zdGFuY2UgaXMgbm90IG5lY2Vzc2FyeSBhcyB0aGV5IGFyZSBjcmVhdGVkIHdoZW4gdXNpbmc6XG5cdCAqXG5cdCAqICoge0BsaW5rICNjaGFuZ2UgYGNoYW5nZSgpYH0sXG5cdCAqICoge0BsaW5rICNlbnF1ZXVlQ2hhbmdlIGBlbnF1ZXVlQ2hhbmdlKClgfS5cblx0ICpcblx0ICogQHBhcmFtIHR5cGUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2gjY29uc3RydWN0b3IgVGhlIHR5cGV9IG9mIHRoZSBiYXRjaC5cblx0ICovIGNyZWF0ZUJhdGNoKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCYXRjaCh0eXBlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gb3BlcmF0aW9uIGluc3RhbmNlIGZyb20gYSBKU09OIG9iamVjdCAocGFyc2VkIEpTT04gc3RyaW5nKS5cblx0ICpcblx0ICogVGhpcyBpcyBhbiBhbGlhcyBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvb3BlcmF0aW9uL29wZXJhdGlvbmZhY3Rvcnl+T3BlcmF0aW9uRmFjdG9yeS5mcm9tSlNPTiBgT3BlcmF0aW9uRmFjdG9yeS5mcm9tSlNPTigpYH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBqc29uIERlc2VyaWFsaXplZCBKU09OIG9iamVjdC5cblx0ICovIGNyZWF0ZU9wZXJhdGlvbkZyb21KU09OKGpzb24pIHtcbiAgICAgICAgcmV0dXJuIE9wZXJhdGlvbkZhY3RvcnkuZnJvbUpTT04oanNvbiwgdGhpcy5kb2N1bWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGFsbCBldmVudHMgbGlzdGVuZXJzIHNldCBieSBtb2RlbCBpbnN0YW5jZSBhbmQgZGVzdHJveXMge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnR9LlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5kb2N1bWVudC5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29tbW9uIHBhcnQgb2Yge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjY2hhbmdlfSBhbmQge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZW5xdWV1ZUNoYW5nZX1cblx0ICogd2hpY2ggY2FsbHMgY2FsbGJhY2tzIGFuZCByZXR1cm5zIGFycmF5IG9mIHZhbHVlcyByZXR1cm5lZCBieSB0aGVzZSBjYWxsYmFja3MuXG5cdCAqLyBfcnVuUGVuZGluZ0NoYW5nZXMoKSB7XG4gICAgICAgIGNvbnN0IHJldCA9IFtdO1xuICAgICAgICB0aGlzLmZpcmUoJ19iZWZvcmVDaGFuZ2VzJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB3aGlsZSh0aGlzLl9wZW5kaW5nQ2hhbmdlcy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIG5ldyB3cml0ZXIgdXNpbmcgYmF0Y2ggaW5zdGFuY2UgY3JlYXRlZCBmb3IgdGhpcyBjaGFpbiBvZiBjaGFuZ2VzLlxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCYXRjaCA9IHRoaXMuX3BlbmRpbmdDaGFuZ2VzWzBdLmJhdGNoO1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRXcml0ZXIgPSBuZXcgV3JpdGVyKHRoaXMsIGN1cnJlbnRCYXRjaCk7XG4gICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSBjaGFuZ2VzIGNhbGxiYWNrIGFuZCBnYXRoZXIgdGhlIHJldHVybmVkIHZhbHVlLlxuICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrUmV0dXJuVmFsdWUgPSB0aGlzLl9wZW5kaW5nQ2hhbmdlc1swXS5jYWxsYmFjayh0aGlzLl9jdXJyZW50V3JpdGVyKTtcbiAgICAgICAgICAgICAgICByZXQucHVzaChjYWxsYmFja1JldHVyblZhbHVlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRvY3VtZW50Ll9oYW5kbGVDaGFuZ2VCbG9jayh0aGlzLl9jdXJyZW50V3JpdGVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlcy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRXcml0ZXIgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGZpbmFsbHl7XG4gICAgICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFdyaXRlciA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ19hZnRlckNoYW5nZXMnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH1cbn1cbi8qKlxuICogTm9ybWFsaXplcyBhIHNlbGVjdGFibGUgdG8gYSBTZWxlY3Rpb24gb3IgRG9jdW1lbnRTZWxlY3Rpb24uXG4gKi8gZnVuY3Rpb24gbm9ybWFsaXplU2VsZWN0YWJsZShzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0KSB7XG4gICAgaWYgKCFzZWxlY3RhYmxlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHNlbGVjdGFibGUgaW5zdGFuY2VvZiBTZWxlY3Rpb24gfHwgc2VsZWN0YWJsZSBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBzZWxlY3RhYmxlO1xuICAgIH1cbiAgICBpZiAoc2VsZWN0YWJsZSBpbnN0YW5jZW9mIE5vZGUkMSkge1xuICAgICAgICBpZiAocGxhY2VPck9mZnNldCB8fCBwbGFjZU9yT2Zmc2V0ID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihzZWxlY3RhYmxlLCBwbGFjZU9yT2Zmc2V0KTtcbiAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RhYmxlLmlzKCdyb290RWxlbWVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihzZWxlY3RhYmxlLCAnaW4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0aW9uKHNlbGVjdGFibGUsICdvbicpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uKHNlbGVjdGFibGUpO1xufVxuXG4vKipcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6Y2xpY2sgQ2xpY2t9IGV2ZW50IG9ic2VydmVyLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIG9ic2VydmVyIGlzIG5vdCBhdmFpbGFibGUgYnkgZGVmYXVsdC4gVG8gbWFrZSBpdCBhdmFpbGFibGUgaXQgbmVlZHMgdG8gYmUgYWRkZWQgdG9cbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3IHZpZXcgY29udHJvbGxlcn0gYnkgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNhZGRPYnNlcnZlcn0gbWV0aG9kLlxuICovIGNsYXNzIENsaWNrT2JzZXJ2ZXIgZXh0ZW5kcyBEb21FdmVudE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRvbUV2ZW50VHlwZSA9ICdjbGljayc7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvbkRvbUV2ZW50KGRvbUV2ZW50KSB7XG4gICAgICAgIHRoaXMuZmlyZShkb21FdmVudC50eXBlLCBkb21FdmVudCk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1vdXNlIGV2ZW50cyBvYnNlcnZlci5cbiAqXG4gKiBOb3RlIHRoYXQgdGhpcyBvYnNlcnZlciBpcyBub3QgYXZhaWxhYmxlIGJ5IGRlZmF1bHQuIFRvIG1ha2UgaXQgYXZhaWxhYmxlIGl0IG5lZWRzIHRvIGJlIGFkZGVkIHRvXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlld30gYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXcjYWRkT2JzZXJ2ZXJ9IG1ldGhvZC5cbiAqLyBjbGFzcyBNb3VzZU9ic2VydmVyIGV4dGVuZHMgRG9tRXZlbnRPYnNlcnZlciB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBkb21FdmVudFR5cGUgPSBbXG4gICAgICAgICdtb3VzZWRvd24nLFxuICAgICAgICAnbW91c2V1cCcsXG4gICAgICAgICdtb3VzZW92ZXInLFxuICAgICAgICAnbW91c2VvdXQnXG4gICAgXTtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIG9uRG9tRXZlbnQoZG9tRXZlbnQpIHtcbiAgICAgICAgdGhpcy5maXJlKGRvbUV2ZW50LnR5cGUsIGRvbUV2ZW50KTtcbiAgICB9XG59XG5cbi8qKlxuICogVG91Y2ggZXZlbnRzIG9ic2VydmVyLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIG9ic2VydmVyIGlzIG5vdCBhdmFpbGFibGUgYnkgZGVmYXVsdC4gVG8gbWFrZSBpdCBhdmFpbGFibGUgaXQgbmVlZHMgdG8gYmUgYWRkZWQgdG9cbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3fSBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+VmlldyNhZGRPYnNlcnZlcn0gbWV0aG9kLlxuICovIGNsYXNzIFRvdWNoT2JzZXJ2ZXIgZXh0ZW5kcyBEb21FdmVudE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRvbUV2ZW50VHlwZSA9IFtcbiAgICAgICAgJ3RvdWNoc3RhcnQnLFxuICAgICAgICAndG91Y2hlbmQnLFxuICAgICAgICAndG91Y2htb3ZlJ1xuICAgIF07XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBvbkRvbUV2ZW50KGRvbUV2ZW50KSB7XG4gICAgICAgIHRoaXMuZmlyZShkb21FdmVudC50eXBlLCBkb21FdmVudCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFZpZXcgdXBjYXN0IHdyaXRlci4gSXQgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB1c2VkIHRvIG1hbmlwdWxhdGUgbm9uLXNlbWFudGljIHZpZXcgdHJlZXMuXG4gKlxuICogSXQgc2hvdWxkIGJlIHVzZWQgb25seSB3aGlsZSB3b3JraW5nIG9uIGEgbm9uLXNlbWFudGljIHZpZXdcbiAqIChlLmcuIGEgdmlldyBjcmVhdGVkIGZyb20gSFRNTCBzdHJpbmcgb24gcGFzdGUpLlxuICogVG8gbWFuaXB1bGF0ZSBhIHZpZXcgd2hpY2ggd2FzIG9yIGlzIGJlaW5nIGRvd25jYXN0ZWQgZnJvbSB0aGUgdGhlIG1vZGVsIHVzZSB0aGVcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG93bmNhc3R3cml0ZXJ+RG93bmNhc3RXcml0ZXIgZG93bmNhc3Qgd3JpdGVyfS5cbiAqXG4gKiBSZWFkIG1vcmUgYWJvdXQgY2hhbmdpbmcgdGhlIHZpZXcgaW4gdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2FyY2hpdGVjdHVyZS9lZGl0aW5nLWVuZ2luZSNjaGFuZ2luZy10aGUtdmlldyBDaGFuZ2luZyB0aGUgdmlld31cbiAqIHNlY3Rpb24gb2YgdGhlIHtAZ2xpbmsgZnJhbWV3b3JrL2FyY2hpdGVjdHVyZS9lZGl0aW5nLWVuZ2luZSBFZGl0aW5nIGVuZ2luZSBhcmNoaXRlY3R1cmV9IGd1aWRlLlxuICpcbiAqIFVubGlrZSBgRG93bmNhc3RXcml0ZXJgLCB3aGljaCBpcyBhdmFpbGFibGUgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2NoYW5nZSBgVmlldyNjaGFuZ2UoKWB9IGJsb2NrLFxuICogYFVwY2FzdFdyaXRlcmAgY2FuIGJlIGNyZWF0ZWQgd2hlcmV2ZXIgeW91IG5lZWQgaXQ6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHdyaXRlciA9IG5ldyBVcGNhc3RXcml0ZXIoIHZpZXdEb2N1bWVudCApO1xuICogY29uc3QgdGV4dCA9IHdyaXRlci5jcmVhdGVUZXh0KCAnZm9vIScgKTtcbiAqXG4gKiB3cml0ZXIuYXBwZW5kQ2hpbGQoIHRleHQsIHNvbWVWaWV3RWxlbWVudCApO1xuICogYGBgXG4gKi8gY2xhc3MgVXBjYXN0V3JpdGVyIHtcbiAgICAvKipcblx0ICogVGhlIHZpZXcgZG9jdW1lbnQgaW5zdGFuY2UgaW4gd2hpY2ggdGhpcyB1cGNhc3Qgd3JpdGVyIG9wZXJhdGVzLlxuXHQgKi8gZG9jdW1lbnQ7XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBkb2N1bWVudCBUaGUgdmlldyBkb2N1bWVudCBpbnN0YW5jZSBpbiB3aGljaCB0aGlzIHVwY2FzdCB3cml0ZXIgb3BlcmF0ZXMuXG5cdCAqLyBjb25zdHJ1Y3Rvcihkb2N1bWVudCl7XG4gICAgICAgIHRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnR9IGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gY2hpbGRyZW4gQSBsaXN0IG9mIG5vZGVzIHRvIGJlIGluc2VydGVkIGludG8gdGhlIGNyZWF0ZWQgZG9jdW1lbnQgZnJhZ21lbnQuXG5cdCAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIGRvY3VtZW50IGZyYWdtZW50LlxuXHQgKi8gY3JlYXRlRG9jdW1lbnRGcmFnbWVudChjaGlsZHJlbikge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50RnJhZ21lbnQkMSh0aGlzLmRvY3VtZW50LCBjaGlsZHJlbik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSBpbnN0YW5jZS5cblx0ICpcblx0ICogQXR0cmlidXRlcyBjYW4gYmUgcGFzc2VkIGluIHZhcmlvdXMgZm9ybWF0czpcblx0ICpcblx0ICogYGBgdHNcblx0ICogdXBjYXN0V3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdkaXYnLCB7IGNsYXNzOiAnZWRpdG9yJywgY29udGVudEVkaXRhYmxlOiAndHJ1ZScgfSApOyAvLyBvYmplY3Rcblx0ICogdXBjYXN0V3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdkaXYnLCBbIFsgJ2NsYXNzJywgJ2VkaXRvcicgXSwgWyAnY29udGVudEVkaXRhYmxlJywgJ3RydWUnIF0gXSApOyAvLyBtYXAtbGlrZSBpdGVyYXRvclxuXHQgKiB1cGNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ2RpdicsIG1hcE9mQXR0cmlidXRlcyApOyAvLyBtYXBcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBwYXJhbSBuYW1lIE5vZGUgbmFtZS5cblx0ICogQHBhcmFtIGF0dHJzIENvbGxlY3Rpb24gb2YgYXR0cmlidXRlcy5cblx0ICogQHBhcmFtIGNoaWxkcmVuIEEgbGlzdCBvZiBub2RlcyB0byBiZSBpbnNlcnRlZCBpbnRvIGNyZWF0ZWQgZWxlbWVudC5cblx0ICogQHJldHVybnMgQ3JlYXRlZCBlbGVtZW50LlxuXHQgKi8gY3JlYXRlRWxlbWVudChuYW1lLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFbGVtZW50JDEodGhpcy5kb2N1bWVudCwgbmFtZSwgYXR0cnMsIGNoaWxkcmVuKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHR9IGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZGF0YSBUaGUgdGV4dCdzIGRhdGEuXG5cdCAqIEByZXR1cm5zIFRoZSBjcmVhdGVkIHRleHQgbm9kZS5cblx0ICovIGNyZWF0ZVRleHQoZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFRleHQkMSh0aGlzLmRvY3VtZW50LCBkYXRhKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsb25lcyB0aGUgcHJvdmlkZWQgZWxlbWVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19jbG9uZVxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIGJlIGNsb25lZC5cblx0ICogQHBhcmFtIGRlZXAgSWYgc2V0IHRvIGB0cnVlYCBjbG9uZXMgZWxlbWVudCBhbmQgYWxsIGl0cyBjaGlsZHJlbiByZWN1cnNpdmVseS4gV2hlbiBzZXQgdG8gYGZhbHNlYCxcblx0ICogZWxlbWVudCB3aWxsIGJlIGNsb25lZCB3aXRob3V0IGFueSBjaGlsZHJlbi5cblx0ICogQHJldHVybnMgQ2xvbmUgb2YgdGhpcyBlbGVtZW50LlxuXHQgKi8gY2xvbmUoZWxlbWVudCwgZGVlcCA9IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50Ll9jbG9uZShkZWVwKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFwcGVuZHMgYSBjaGlsZCBub2RlIG9yIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBhdCB0aGUgZW5kIG9mIHRoaXMgbm9kZVxuXHQgKiBhbmQgc2V0cyB0aGUgcGFyZW50IG9mIHRoZXNlIG5vZGVzIHRvIHRoaXMgZWxlbWVudC5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19hcHBlbmRDaGlsZFxuXHQgKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gYmUgaW5zZXJ0ZWQuXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgdG8gd2hpY2ggaXRlbXMgd2lsbCBiZSBhcHBlbmRlZC5cblx0ICogQHJldHVybnMgTnVtYmVyIG9mIGFwcGVuZGVkIG5vZGVzLlxuXHQgKi8gYXBwZW5kQ2hpbGQoaXRlbXMsIGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuX2FwcGVuZENoaWxkKGl0ZW1zKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgYSBjaGlsZCBub2RlIG9yIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBvbiB0aGUgZ2l2ZW4gaW5kZXggYW5kIHNldHMgdGhlIHBhcmVudCBvZiB0aGVzZSBub2RlcyB0b1xuXHQgKiB0aGlzIGVsZW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfaW5zZXJ0Q2hpbGRcblx0ICogQHBhcmFtIGluZGV4IE9mZnNldCBhdCB3aGljaCBub2RlcyBzaG91bGQgYmUgaW5zZXJ0ZWQuXG5cdCAqIEBwYXJhbSBpdGVtcyBJdGVtcyB0byBiZSBpbnNlcnRlZC5cblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB0byB3aGljaCBpdGVtcyB3aWxsIGJlIGluc2VydGVkLlxuXHQgKiBAcmV0dXJucyBOdW1iZXIgb2YgaW5zZXJ0ZWQgbm9kZXMuXG5cdCAqLyBpbnNlcnRDaGlsZChpbmRleCwgaXRlbXMsIGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQuX2luc2VydENoaWxkKGluZGV4LCBpdGVtcyk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIHRoZSBnaXZlbiBudW1iZXIgb2YgY2hpbGQgbm9kZXMgc3RhcnRpbmcgYXQgdGhlIGdpdmVuIGluZGV4IGFuZCBzZXQgdGhlIHBhcmVudCBvZiB0aGVzZSBub2RlcyB0byBgbnVsbGAuXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfcmVtb3ZlQ2hpbGRyZW5cblx0ICogQHBhcmFtIGluZGV4IE9mZnNldCBmcm9tIHdoaWNoIG5vZGVzIHdpbGwgYmUgcmVtb3ZlZC5cblx0ICogQHBhcmFtIGhvd01hbnkgTnVtYmVyIG9mIG5vZGVzIHRvIHJlbW92ZS5cblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBjaGlsZHJlbiB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqIEByZXR1cm5zIFRoZSBhcnJheSBjb250YWluaW5nIHJlbW92ZWQgbm9kZXMuXG5cdCAqLyByZW1vdmVDaGlsZHJlbihpbmRleCwgaG93TWFueSwgZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5fcmVtb3ZlQ2hpbGRyZW4oaW5kZXgsIGhvd01hbnkpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBnaXZlbiBlbGVtZW50IGZyb20gdGhlIHZpZXcgc3RydWN0dXJlLiBXaWxsIG5vdCBoYXZlIGVmZmVjdCBvbiBkZXRhY2hlZCBlbGVtZW50cy5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqIEByZXR1cm5zIFRoZSBhcnJheSBjb250YWluaW5nIHJlbW92ZWQgbm9kZXMuXG5cdCAqLyByZW1vdmUoZWxlbWVudCkge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQ2hpbGRyZW4ocGFyZW50LmdldENoaWxkSW5kZXgoZWxlbWVudCksIDEsIHBhcmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVwbGFjZXMgZ2l2ZW4gZWxlbWVudCB3aXRoIHRoZSBuZXcgb25lIGluIHRoZSB2aWV3IHN0cnVjdHVyZS4gV2lsbCBub3QgaGF2ZSBlZmZlY3Qgb24gZGV0YWNoZWQgZWxlbWVudHMuXG5cdCAqXG5cdCAqIEBwYXJhbSBvbGRFbGVtZW50IEVsZW1lbnQgd2hpY2ggd2lsbCBiZSByZXBsYWNlZC5cblx0ICogQHBhcmFtIG5ld0VsZW1lbnQgRWxlbWVudCB3aGljaCB3aWxsIGJlIGluc2VydGVkIGluIHRoZSBwbGFjZSBvZiB0aGUgb2xkIGVsZW1lbnQuXG5cdCAqIEByZXR1cm5zIFdoZXRoZXIgb2xkIGVsZW1lbnQgd2FzIHN1Y2Nlc3NmdWxseSByZXBsYWNlZC5cblx0ICovIHJlcGxhY2Uob2xkRWxlbWVudCwgbmV3RWxlbWVudCkge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBvbGRFbGVtZW50LnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleChvbGRFbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hpbGRyZW4oaW5kZXgsIDEsIHBhcmVudCk7XG4gICAgICAgICAgICB0aGlzLmluc2VydENoaWxkKGluZGV4LCBuZXdFbGVtZW50LCBwYXJlbnQpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBnaXZlbiBlbGVtZW50IGZyb20gdmlldyBzdHJ1Y3R1cmUgYW5kIHBsYWNlcyBpdHMgY2hpbGRyZW4gaW4gaXRzIHBvc2l0aW9uLlxuXHQgKiBJdCBkb2VzIG5vdGhpbmcgaWYgZWxlbWVudCBoYXMgbm8gcGFyZW50LlxuXHQgKlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IHRvIHVud3JhcC5cblx0ICovIHVud3JhcEVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJlbnQuZ2V0Q2hpbGRJbmRleChlbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKGVsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRDaGlsZChpbmRleCwgZWxlbWVudC5nZXRDaGlsZHJlbigpLCBwYXJlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW5hbWVzIGVsZW1lbnQgYnkgY3JlYXRpbmcgYSBjb3B5IG9mIGEgZ2l2ZW4gZWxlbWVudCBidXQgd2l0aCBpdHMgbmFtZSBjaGFuZ2VkIGFuZCB0aGVuIG1vdmluZyBjb250ZW50cyBvZiB0aGVcblx0ICogb2xkIGVsZW1lbnQgdG8gdGhlIG5ldyBvbmUuXG5cdCAqXG5cdCAqIFNpbmNlIHRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhIG5ldyBlbGVtZW50IGFuZCByZW1vdmVzIHRoZSBnaXZlbiBvbmUsIHRoZSBuZXcgZWxlbWVudCBpcyByZXR1cm5lZCB0byBrZWVwIHJlZmVyZW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG5ld05hbWUgTmV3IGVsZW1lbnQgbmFtZS5cblx0ICogQHBhcmFtICBlbGVtZW50IEVsZW1lbnQgdG8gYmUgcmVuYW1lZC5cblx0ICogQHJldHVybnMgTmV3IGVsZW1lbnQgb3IgbnVsbCBpZiB0aGUgb2xkIGVsZW1lbnQgd2FzIG5vdCByZXBsYWNlZCAoaGFwcGVucyBmb3IgZGV0YWNoZWQgZWxlbWVudHMpLlxuXHQgKi8gcmVuYW1lKG5ld05hbWUsIGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9IG5ldyBFbGVtZW50JDEodGhpcy5kb2N1bWVudCwgbmV3TmFtZSwgZWxlbWVudC5nZXRBdHRyaWJ1dGVzKCksIGVsZW1lbnQuZ2V0Q2hpbGRyZW4oKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoZWxlbWVudCwgbmV3RWxlbWVudCkgPyBuZXdFbGVtZW50IDogbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFkZHMgb3Igb3ZlcndyaXRlcyBlbGVtZW50J3MgYXR0cmlidXRlIHdpdGggYSBzcGVjaWZpZWQga2V5IGFuZCB2YWx1ZS5cblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLnNldEF0dHJpYnV0ZSggJ2hyZWYnLCAnaHR0cDovL2NrZWRpdG9yLmNvbScsIGxpbmtFbGVtZW50ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX3NldEF0dHJpYnV0ZVxuXHQgKiBAcGFyYW0ga2V5IEF0dHJpYnV0ZSBrZXkuXG5cdCAqIEBwYXJhbSB2YWx1ZSBBdHRyaWJ1dGUgdmFsdWUuXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgZm9yIHdoaWNoIGF0dHJpYnV0ZSB3aWxsIGJlIHNldC5cblx0ICovIHNldEF0dHJpYnV0ZShrZXksIHZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuX3NldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbW92ZXMgYXR0cmlidXRlIGZyb20gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoICdocmVmJywgbGlua0VsZW1lbnQgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfcmVtb3ZlQXR0cmlidXRlXG5cdCAqIEBwYXJhbSBrZXkgQXR0cmlidXRlIGtleS5cblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCBmcm9tIHdoaWNoIGF0dHJpYnV0ZSB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqLyByZW1vdmVBdHRyaWJ1dGUoa2V5LCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuX3JlbW92ZUF0dHJpYnV0ZShrZXkpO1xuICAgIH1cbiAgICAvKipcblx0ICogQWRkcyBzcGVjaWZpZWQgY2xhc3MgdG8gdGhlIGVsZW1lbnQuXG5cdCAqXG5cdCAqIGBgYHRzXG5cdCAqIHdyaXRlci5hZGRDbGFzcyggJ2ZvbycsIGxpbmtFbGVtZW50ICk7XG5cdCAqIHdyaXRlci5hZGRDbGFzcyggWyAnZm9vJywgJ2JhcicgXSwgbGlua0VsZW1lbnQgKTtcblx0ICogYGBgXG5cdCAqXG5cdCAqIEBzZWUgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCNfYWRkQ2xhc3Ncblx0ICogQHBhcmFtIGNsYXNzTmFtZSBTaW5nbGUgY2xhc3MgbmFtZSBvciBhcnJheSBvZiBjbGFzcyBuYW1lcyB3aGljaCB3aWxsIGJlIGFkZGVkLlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IGZvciB3aGljaCBjbGFzcyB3aWxsIGJlIGFkZGVkLlxuXHQgKi8gYWRkQ2xhc3MoY2xhc3NOYW1lLCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuX2FkZENsYXNzKGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIHNwZWNpZmllZCBjbGFzcyBmcm9tIHRoZSBlbGVtZW50LlxuXHQgKlxuXHQgKiBgYGB0c1xuXHQgKiB3cml0ZXIucmVtb3ZlQ2xhc3MoICdmb28nLCBsaW5rRWxlbWVudCApO1xuXHQgKiB3cml0ZXIucmVtb3ZlQ2xhc3MoIFsgJ2ZvbycsICdiYXInIF0sIGxpbmtFbGVtZW50ICk7XG5cdCAqIGBgYFxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX3JlbW92ZUNsYXNzXG5cdCAqIEBwYXJhbSBjbGFzc05hbWUgU2luZ2xlIGNsYXNzIG5hbWUgb3IgYXJyYXkgb2YgY2xhc3MgbmFtZXMgd2hpY2ggd2lsbCBiZSByZW1vdmVkLlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IGZyb20gd2hpY2ggY2xhc3Mgd2lsbCBiZSByZW1vdmVkLlxuXHQgKi8gcmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLCBlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuX3JlbW92ZUNsYXNzKGNsYXNzTmFtZSk7XG4gICAgfVxuICAgIHNldFN0eWxlKHByb3BlcnR5LCB2YWx1ZU9yRWxlbWVudCwgZWxlbWVudCkge1xuICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChwcm9wZXJ0eSkgJiYgZWxlbWVudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YWx1ZU9yRWxlbWVudC5fc2V0U3R5bGUocHJvcGVydHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudC5fc2V0U3R5bGUocHJvcGVydHksIHZhbHVlT3JFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBzcGVjaWZpZWQgc3R5bGUgZnJvbSB0aGUgZWxlbWVudC5cblx0ICpcblx0ICogYGBgdHNcblx0ICogd3JpdGVyLnJlbW92ZVN0eWxlKCAnY29sb3InLCBlbGVtZW50ICk7ICAvLyBSZW1vdmVzICdjb2xvcicgc3R5bGUuXG5cdCAqIHdyaXRlci5yZW1vdmVTdHlsZSggWyAnY29sb3InLCAnYm9yZGVyLXRvcCcgXSwgZWxlbWVudCApOyAvLyBSZW1vdmVzIGJvdGggJ2NvbG9yJyBhbmQgJ2JvcmRlci10b3AnIHN0eWxlcy5cblx0ICogYGBgXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBUaGlzIG1ldGhvZCBjYW4gd29yayB3aXRoIG5vcm1hbGl6ZWQgc3R5bGUgbmFtZXMgaWZcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlciNhZGRTdHlsZVByb2Nlc3NvclJ1bGVzIGEgcGFydGljdWxhciBzdHlsZSBwcm9jZXNzb3IgcnVsZSBpcyBlbmFibGVkfS5cblx0ICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc3R5bGVzbWFwflN0eWxlc01hcCNyZW1vdmUgYFN0eWxlc01hcCNyZW1vdmUoKWB9IGZvciBkZXRhaWxzLlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX3JlbW92ZVN0eWxlXG5cdCAqIEBwYXJhbSBwcm9wZXJ0eSBTdHlsZSBwcm9wZXJ0eSBuYW1lIG9yIG5hbWVzIHRvIGJlIHJlbW92ZWQuXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgZnJvbSB3aGljaCBzdHlsZSB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqLyByZW1vdmVTdHlsZShwcm9wZXJ0eSwgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50Ll9yZW1vdmVTdHlsZShwcm9wZXJ0eSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIGEgY3VzdG9tIHByb3BlcnR5IG9uIGVsZW1lbnQuIFVubGlrZSBhdHRyaWJ1dGVzLCBjdXN0b20gcHJvcGVydGllcyBhcmUgbm90IHJlbmRlcmVkIHRvIHRoZSBET00sXG5cdCAqIHNvIHRoZXkgY2FuIGJlIHVzZWQgdG8gYWRkIHNwZWNpYWwgZGF0YSB0byBlbGVtZW50cy5cblx0ICpcblx0ICogQHNlZSBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I19zZXRDdXN0b21Qcm9wZXJ0eVxuXHQgKiBAcGFyYW0ga2V5IEN1c3RvbSBwcm9wZXJ0eSBuYW1lL2tleS5cblx0ICogQHBhcmFtIHZhbHVlIEN1c3RvbSBwcm9wZXJ0eSB2YWx1ZSB0byBiZSBzdG9yZWQuXG5cdCAqIEBwYXJhbSBlbGVtZW50IEVsZW1lbnQgZm9yIHdoaWNoIGN1c3RvbSBwcm9wZXJ0eSB3aWxsIGJlIHNldC5cblx0ICovIHNldEN1c3RvbVByb3BlcnR5KGtleSwgdmFsdWUsIGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5fc2V0Q3VzdG9tUHJvcGVydHkoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGEgY3VzdG9tIHByb3BlcnR5IHN0b3JlZCB1bmRlciB0aGUgZ2l2ZW4ga2V5LlxuXHQgKlxuXHQgKiBAc2VlIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQjX3JlbW92ZUN1c3RvbVByb3BlcnR5XG5cdCAqIEBwYXJhbSBrZXkgTmFtZS9rZXkgb2YgdGhlIGN1c3RvbSBwcm9wZXJ0eSB0byBiZSByZW1vdmVkLlxuXHQgKiBAcGFyYW0gZWxlbWVudCBFbGVtZW50IGZyb20gd2hpY2ggdGhlIGN1c3RvbSBwcm9wZXJ0eSB3aWxsIGJlIHJlbW92ZWQuXG5cdCAqIEByZXR1cm5zIFJldHVybnMgdHJ1ZSBpZiBwcm9wZXJ0eSB3YXMgcmVtb3ZlZC5cblx0ICovIHJlbW92ZUN1c3RvbVByb3BlcnR5KGtleSwgZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5fcmVtb3ZlQ3VzdG9tUHJvcGVydHkoa2V5KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgcG9zaXRpb24gYXQgdGhlIGdpdmVuIGxvY2F0aW9uLiBUaGUgbG9jYXRpb24gY2FuIGJlIHNwZWNpZmllZCBhczpcblx0ICpcblx0ICogKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb24gcG9zaXRpb259LFxuXHQgKiAqIHBhcmVudCBlbGVtZW50IGFuZCBvZmZzZXQgKG9mZnNldCBkZWZhdWx0cyB0byBgMGApLFxuXHQgKiAqIHBhcmVudCBlbGVtZW50IGFuZCBgJ2VuZCdgIChzZXRzIHBvc2l0aW9uIGF0IHRoZSBlbmQgb2YgdGhhdCBlbGVtZW50KSxcblx0ICogKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19IGFuZCBgJ2JlZm9yZSdgIG9yIGAnYWZ0ZXInYCAoc2V0cyBwb3NpdGlvbiBiZWZvcmUgb3IgYWZ0ZXIgZ2l2ZW4gdmlldyBpdGVtKS5cblx0ICpcblx0ICogVGhpcyBtZXRob2QgaXMgYSBzaG9ydGN1dCB0byBvdGhlciBjb25zdHJ1Y3RvcnMgc3VjaCBhczpcblx0ICpcblx0ICogKiB7QGxpbmsgI2NyZWF0ZVBvc2l0aW9uQmVmb3JlfSxcblx0ICogKiB7QGxpbmsgI2NyZWF0ZVBvc2l0aW9uQWZ0ZXJ9LFxuXHQgKlxuXHQgKiBAcGFyYW0gb2Zmc2V0IE9mZnNldCBvciBvbmUgb2YgdGhlIGZsYWdzLiBVc2VkIG9ubHkgd2hlbiBmaXJzdCBwYXJhbWV0ZXIgaXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19LlxuXHQgKi8gY3JlYXRlUG9zaXRpb25BdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiBQb3NpdGlvbiQxLl9jcmVhdGVBdChpdGVtT3JQb3NpdGlvbiwgb2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgcG9zaXRpb24gYWZ0ZXIgZ2l2ZW4gdmlldyBpdGVtLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXRlbSBWaWV3IGl0ZW0gYWZ0ZXIgd2hpY2ggdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBsb2NhdGVkLlxuXHQgKi8gY3JlYXRlUG9zaXRpb25BZnRlcihpdGVtKSB7XG4gICAgICAgIHJldHVybiBQb3NpdGlvbiQxLl9jcmVhdGVBZnRlcihpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBuZXcgcG9zaXRpb24gYmVmb3JlIGdpdmVuIHZpZXcgaXRlbS5cblx0ICpcblx0ICogQHBhcmFtIGl0ZW0gVmlldyBpdGVtIGJlZm9yZSB3aGljaCB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGxvY2F0ZWQuXG5cdCAqLyBjcmVhdGVQb3NpdGlvbkJlZm9yZShpdGVtKSB7XG4gICAgICAgIHJldHVybiBQb3NpdGlvbiQxLl9jcmVhdGVCZWZvcmUoaXRlbSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGEgcmFuZ2Ugc3Bhbm5pbmcgZnJvbSBgc3RhcnRgIHBvc2l0aW9uIHRvIGBlbmRgIHBvc2l0aW9uLlxuXHQgKlxuXHQgKiAqKk5vdGU6KiogVGhpcyBmYWN0b3J5IG1ldGhvZCBjcmVhdGVzIGl0J3Mgb3duIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcG9zaXRpb25+UG9zaXRpb259IGluc3RhbmNlcyBiYXNpbmcgb24gcGFzc2VkIHZhbHVlcy5cblx0ICpcblx0ICogQHBhcmFtIHN0YXJ0IFN0YXJ0IHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gZW5kIEVuZCBwb3NpdGlvbi4gSWYgbm90IHNldCwgcmFuZ2Ugd2lsbCBiZSBjb2xsYXBzZWQgYXQgYHN0YXJ0YCBwb3NpdGlvbi5cblx0ICovIGNyZWF0ZVJhbmdlKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSQxKHN0YXJ0LCBlbmQpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHRoYXQgc3RhcnRzIGJlZm9yZSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2l0ZW1+SXRlbSB2aWV3IGl0ZW19IGFuZCBlbmRzIGFmdGVyIGl0LlxuXHQgKi8gY3JlYXRlUmFuZ2VPbihpdGVtKSB7XG4gICAgICAgIHJldHVybiBSYW5nZSQxLl9jcmVhdGVPbihpdGVtKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSByYW5nZSBpbnNpZGUgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gd2hpY2ggc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3QgY2hpbGQgb2Zcblx0ICogdGhhdCBlbGVtZW50IGFuZCBlbmRzIGFmdGVyIHRoZSBsYXN0IGNoaWxkIG9mIHRoYXQgZWxlbWVudC5cblx0ICpcblx0ICogQHBhcmFtIGVsZW1lbnQgRWxlbWVudCB3aGljaCBpcyBhIHBhcmVudCBmb3IgdGhlIHJhbmdlLlxuXHQgKi8gY3JlYXRlUmFuZ2VJbihlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBSYW5nZSQxLl9jcmVhdGVJbihlbGVtZW50KTtcbiAgICB9XG4gICAgY3JlYXRlU2VsZWN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24kMSguLi5hcmdzKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqLyAvKipcbiAqIEBtb2R1bGUgZW5naW5lL3ZpZXcvc3R5bGVzL3V0aWxzXG4gKi8gY29uc3QgSEVYX0NPTE9SX1JFR0VYUCA9IC9eIyhbMC05YS1mXXszLDR9fFswLTlhLWZdezZ9fFswLTlhLWZdezh9KSQvaTtcbmNvbnN0IFJHQl9DT0xPUl9SRUdFWFAgPSAvXnJnYlxcKFsgXT8oWzAtOV17MSwzfVsgJV0/LFsgXT8pezIsM31bMC05XXsxLDN9WyAlXT9cXCkkL2k7XG5jb25zdCBSR0JBX0NPTE9SX1JFR0VYUCA9IC9ecmdiYVxcKFsgXT8oWzAtOV17MSwzfVsgJV0/LFsgXT8pezN9KDF8WzAtOV0rJXxbMF0/XFwuP1swLTldKylcXCkkL2k7XG5jb25zdCBIU0xfQ09MT1JfUkVHRVhQID0gL15oc2xcXChbIF0/KFswLTldezEsM31bICVdP1ssXT9bIF0qKXszfSgxfFswLTldKyV8WzBdP1xcLj9bMC05XSspP1xcKSQvaTtcbmNvbnN0IEhTTEFfQ09MT1JfUkVHRVhQID0gL15oc2xhXFwoWyBdPyhbMC05XXsxLDN9WyAlXT8sWyBdPyl7MiwzfSgxfFswLTldKyV8WzBdP1xcLj9bMC05XSspXFwpJC9pO1xuLy8gTm90ZTogVGhpcyByZWdleHAgaGFyZGNvZGVzIGEgc2luZ2xlIGxldmVsIG9mIG5lc3RlZCAoKSBmb3IgdmFsdWVzIHN1Y2ggYXMgYGNhbGMoIHZhciggLi4uKSArIC4uLilgLlxuLy8gSWYgdGhpcyBnZXRzIG1vcmUgY29tcGxleCwgYSBwcm9wZXIgcGFyc2VyIHNob3VsZCBiZSB1c2VkIGluc3RlYWQuXG5jb25zdCBDU1NfU0hPUlRIQU5EX1ZBTFVFX1JFR0VYUCA9IC9cXHcrXFwoKD86W14oKV18XFwoW14oKV0qXFwpKSpcXCl8XFxTKy9naTtcbmNvbnN0IENPTE9SX05BTUVTID0gbmV3IFNldChbXG4gICAgLy8gQ1NTIExldmVsIDFcbiAgICAnYmxhY2snLFxuICAgICdzaWx2ZXInLFxuICAgICdncmF5JyxcbiAgICAnd2hpdGUnLFxuICAgICdtYXJvb24nLFxuICAgICdyZWQnLFxuICAgICdwdXJwbGUnLFxuICAgICdmdWNoc2lhJyxcbiAgICAnZ3JlZW4nLFxuICAgICdsaW1lJyxcbiAgICAnb2xpdmUnLFxuICAgICd5ZWxsb3cnLFxuICAgICduYXZ5JyxcbiAgICAnYmx1ZScsXG4gICAgJ3RlYWwnLFxuICAgICdhcXVhJyxcbiAgICAvLyBDU1MgTGV2ZWwgMiAoUmV2aXNpb24gMSlcbiAgICAnb3JhbmdlJyxcbiAgICAvLyBDU1MgQ29sb3IgTW9kdWxlIExldmVsIDNcbiAgICAnYWxpY2VibHVlJyxcbiAgICAnYW50aXF1ZXdoaXRlJyxcbiAgICAnYXF1YW1hcmluZScsXG4gICAgJ2F6dXJlJyxcbiAgICAnYmVpZ2UnLFxuICAgICdiaXNxdWUnLFxuICAgICdibGFuY2hlZGFsbW9uZCcsXG4gICAgJ2JsdWV2aW9sZXQnLFxuICAgICdicm93bicsXG4gICAgJ2J1cmx5d29vZCcsXG4gICAgJ2NhZGV0Ymx1ZScsXG4gICAgJ2NoYXJ0cmV1c2UnLFxuICAgICdjaG9jb2xhdGUnLFxuICAgICdjb3JhbCcsXG4gICAgJ2Nvcm5mbG93ZXJibHVlJyxcbiAgICAnY29ybnNpbGsnLFxuICAgICdjcmltc29uJyxcbiAgICAnY3lhbicsXG4gICAgJ2RhcmtibHVlJyxcbiAgICAnZGFya2N5YW4nLFxuICAgICdkYXJrZ29sZGVucm9kJyxcbiAgICAnZGFya2dyYXknLFxuICAgICdkYXJrZ3JlZW4nLFxuICAgICdkYXJrZ3JleScsXG4gICAgJ2RhcmtraGFraScsXG4gICAgJ2RhcmttYWdlbnRhJyxcbiAgICAnZGFya29saXZlZ3JlZW4nLFxuICAgICdkYXJrb3JhbmdlJyxcbiAgICAnZGFya29yY2hpZCcsXG4gICAgJ2RhcmtyZWQnLFxuICAgICdkYXJrc2FsbW9uJyxcbiAgICAnZGFya3NlYWdyZWVuJyxcbiAgICAnZGFya3NsYXRlYmx1ZScsXG4gICAgJ2RhcmtzbGF0ZWdyYXknLFxuICAgICdkYXJrc2xhdGVncmV5JyxcbiAgICAnZGFya3R1cnF1b2lzZScsXG4gICAgJ2Rhcmt2aW9sZXQnLFxuICAgICdkZWVwcGluaycsXG4gICAgJ2RlZXBza3libHVlJyxcbiAgICAnZGltZ3JheScsXG4gICAgJ2RpbWdyZXknLFxuICAgICdkb2RnZXJibHVlJyxcbiAgICAnZmlyZWJyaWNrJyxcbiAgICAnZmxvcmFsd2hpdGUnLFxuICAgICdmb3Jlc3RncmVlbicsXG4gICAgJ2dhaW5zYm9ybycsXG4gICAgJ2dob3N0d2hpdGUnLFxuICAgICdnb2xkJyxcbiAgICAnZ29sZGVucm9kJyxcbiAgICAnZ3JlZW55ZWxsb3cnLFxuICAgICdncmV5JyxcbiAgICAnaG9uZXlkZXcnLFxuICAgICdob3RwaW5rJyxcbiAgICAnaW5kaWFucmVkJyxcbiAgICAnaW5kaWdvJyxcbiAgICAnaXZvcnknLFxuICAgICdraGFraScsXG4gICAgJ2xhdmVuZGVyJyxcbiAgICAnbGF2ZW5kZXJibHVzaCcsXG4gICAgJ2xhd25ncmVlbicsXG4gICAgJ2xlbW9uY2hpZmZvbicsXG4gICAgJ2xpZ2h0Ymx1ZScsXG4gICAgJ2xpZ2h0Y29yYWwnLFxuICAgICdsaWdodGN5YW4nLFxuICAgICdsaWdodGdvbGRlbnJvZHllbGxvdycsXG4gICAgJ2xpZ2h0Z3JheScsXG4gICAgJ2xpZ2h0Z3JlZW4nLFxuICAgICdsaWdodGdyZXknLFxuICAgICdsaWdodHBpbmsnLFxuICAgICdsaWdodHNhbG1vbicsXG4gICAgJ2xpZ2h0c2VhZ3JlZW4nLFxuICAgICdsaWdodHNreWJsdWUnLFxuICAgICdsaWdodHNsYXRlZ3JheScsXG4gICAgJ2xpZ2h0c2xhdGVncmV5JyxcbiAgICAnbGlnaHRzdGVlbGJsdWUnLFxuICAgICdsaWdodHllbGxvdycsXG4gICAgJ2xpbWVncmVlbicsXG4gICAgJ2xpbmVuJyxcbiAgICAnbWFnZW50YScsXG4gICAgJ21lZGl1bWFxdWFtYXJpbmUnLFxuICAgICdtZWRpdW1ibHVlJyxcbiAgICAnbWVkaXVtb3JjaGlkJyxcbiAgICAnbWVkaXVtcHVycGxlJyxcbiAgICAnbWVkaXVtc2VhZ3JlZW4nLFxuICAgICdtZWRpdW1zbGF0ZWJsdWUnLFxuICAgICdtZWRpdW1zcHJpbmdncmVlbicsXG4gICAgJ21lZGl1bXR1cnF1b2lzZScsXG4gICAgJ21lZGl1bXZpb2xldHJlZCcsXG4gICAgJ21pZG5pZ2h0Ymx1ZScsXG4gICAgJ21pbnRjcmVhbScsXG4gICAgJ21pc3R5cm9zZScsXG4gICAgJ21vY2Nhc2luJyxcbiAgICAnbmF2YWpvd2hpdGUnLFxuICAgICdvbGRsYWNlJyxcbiAgICAnb2xpdmVkcmFiJyxcbiAgICAnb3JhbmdlcmVkJyxcbiAgICAnb3JjaGlkJyxcbiAgICAncGFsZWdvbGRlbnJvZCcsXG4gICAgJ3BhbGVncmVlbicsXG4gICAgJ3BhbGV0dXJxdW9pc2UnLFxuICAgICdwYWxldmlvbGV0cmVkJyxcbiAgICAncGFwYXlhd2hpcCcsXG4gICAgJ3BlYWNocHVmZicsXG4gICAgJ3BlcnUnLFxuICAgICdwaW5rJyxcbiAgICAncGx1bScsXG4gICAgJ3Bvd2RlcmJsdWUnLFxuICAgICdyb3N5YnJvd24nLFxuICAgICdyb3lhbGJsdWUnLFxuICAgICdzYWRkbGVicm93bicsXG4gICAgJ3NhbG1vbicsXG4gICAgJ3NhbmR5YnJvd24nLFxuICAgICdzZWFncmVlbicsXG4gICAgJ3NlYXNoZWxsJyxcbiAgICAnc2llbm5hJyxcbiAgICAnc2t5Ymx1ZScsXG4gICAgJ3NsYXRlYmx1ZScsXG4gICAgJ3NsYXRlZ3JheScsXG4gICAgJ3NsYXRlZ3JleScsXG4gICAgJ3Nub3cnLFxuICAgICdzcHJpbmdncmVlbicsXG4gICAgJ3N0ZWVsYmx1ZScsXG4gICAgJ3RhbicsXG4gICAgJ3RoaXN0bGUnLFxuICAgICd0b21hdG8nLFxuICAgICd0dXJxdW9pc2UnLFxuICAgICd2aW9sZXQnLFxuICAgICd3aGVhdCcsXG4gICAgJ3doaXRlc21va2UnLFxuICAgICd5ZWxsb3dncmVlbicsXG4gICAgLy8gQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCAzIChTeXN0ZW0gQ29sb3JzKVxuICAgICdhY3RpdmVib3JkZXInLFxuICAgICdhY3RpdmVjYXB0aW9uJyxcbiAgICAnYXBwd29ya3NwYWNlJyxcbiAgICAnYmFja2dyb3VuZCcsXG4gICAgJ2J1dHRvbmZhY2UnLFxuICAgICdidXR0b25oaWdobGlnaHQnLFxuICAgICdidXR0b25zaGFkb3cnLFxuICAgICdidXR0b250ZXh0JyxcbiAgICAnY2FwdGlvbnRleHQnLFxuICAgICdncmF5dGV4dCcsXG4gICAgJ2hpZ2hsaWdodCcsXG4gICAgJ2hpZ2hsaWdodHRleHQnLFxuICAgICdpbmFjdGl2ZWJvcmRlcicsXG4gICAgJ2luYWN0aXZlY2FwdGlvbicsXG4gICAgJ2luYWN0aXZlY2FwdGlvbnRleHQnLFxuICAgICdpbmZvYmFja2dyb3VuZCcsXG4gICAgJ2luZm90ZXh0JyxcbiAgICAnbWVudScsXG4gICAgJ21lbnV0ZXh0JyxcbiAgICAnc2Nyb2xsYmFyJyxcbiAgICAndGhyZWVkZGFya3NoYWRvdycsXG4gICAgJ3RocmVlZGZhY2UnLFxuICAgICd0aHJlZWRoaWdobGlnaHQnLFxuICAgICd0aHJlZWRsaWdodHNoYWRvdycsXG4gICAgJ3RocmVlZHNoYWRvdycsXG4gICAgJ3dpbmRvdycsXG4gICAgJ3dpbmRvd2ZyYW1lJyxcbiAgICAnd2luZG93dGV4dCcsXG4gICAgLy8gQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0XG4gICAgJ3JlYmVjY2FwdXJwbGUnLFxuICAgIC8vIEtleXdvcmRzXG4gICAgJ2N1cnJlbnRjb2xvcicsXG4gICAgJ3RyYW5zcGFyZW50J1xuXSk7XG4vKipcbiAqIENoZWNrcyBpZiBzdHJpbmcgY29udGFpbnMgW2NvbG9yXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvY29sb3IpIENTUyB2YWx1ZS5cbiAqXG4gKiBgYGB0c1xuICogaXNDb2xvciggJyNmMDAnICk7XHRcdFx0XHRcdFx0Ly8gdHJ1ZVxuICogaXNDb2xvciggJyNBQTAwQkIzMycgKTtcdFx0XHRcdFx0Ly8gdHJ1ZVxuICogaXNDb2xvciggJ3JnYigwLCAwLCAyNTApJyApO1x0XHRcdFx0Ly8gdHJ1ZVxuICogaXNDb2xvciggJ2hzbGEoMjQwLCAxMDAlLCA1MCUsIC43KScgKTtcdC8vIHRydWVcbiAqIGlzQ29sb3IoICdkZWVwc2t5Ymx1ZScgKTtcdFx0XHRcdC8vIHRydWVcbiAqIGBgYFxuICpcbiAqICoqTm90ZSoqOiBJdCBkb2VzIG5vdCBzdXBwb3J0IENTUyBMZXZlbCA0IHdoaXRlc3BhY2Ugc3ludGF4LCBzeXN0ZW0gY29sb3JzIGFuZCByYWRpdXMgdmFsdWVzIGZvciBIU0wgY29sb3JzLlxuICovIGZ1bmN0aW9uIGlzQ29sb3Ioc3RyaW5nKSB7XG4gICAgLy8gQXMgZmFyIGFzIEkgd2FzIGFibGUgdG8gdGVzdCBjaGVja2luZyBzb21lIHByZS1jb25kaXRpb25zIGlzIGZhc3RlciB0aGFuIGpvaW5pbmcgZWFjaCB0ZXN0IHdpdGggfHwuXG4gICAgaWYgKHN0cmluZy5zdGFydHNXaXRoKCcjJykpIHtcbiAgICAgICAgcmV0dXJuIEhFWF9DT0xPUl9SRUdFWFAudGVzdChzdHJpbmcpO1xuICAgIH1cbiAgICBpZiAoc3RyaW5nLnN0YXJ0c1dpdGgoJ3JnYicpKSB7XG4gICAgICAgIHJldHVybiBSR0JfQ09MT1JfUkVHRVhQLnRlc3Qoc3RyaW5nKSB8fCBSR0JBX0NPTE9SX1JFR0VYUC50ZXN0KHN0cmluZyk7XG4gICAgfVxuICAgIGlmIChzdHJpbmcuc3RhcnRzV2l0aCgnaHNsJykpIHtcbiAgICAgICAgcmV0dXJuIEhTTF9DT0xPUl9SRUdFWFAudGVzdChzdHJpbmcpIHx8IEhTTEFfQ09MT1JfUkVHRVhQLnRlc3Qoc3RyaW5nKTtcbiAgICB9XG4gICAgLy8gQXJyYXkgY2hlY2sgPiBSZWdFeHAgdGVzdC5cbiAgICByZXR1cm4gQ09MT1JfTkFNRVMuaGFzKHN0cmluZy50b0xvd2VyQ2FzZSgpKTtcbn1cbmNvbnN0IGxpbmVTdHlsZVZhbHVlcyA9IFtcbiAgICAnbm9uZScsXG4gICAgJ2hpZGRlbicsXG4gICAgJ2RvdHRlZCcsXG4gICAgJ2Rhc2hlZCcsXG4gICAgJ3NvbGlkJyxcbiAgICAnZG91YmxlJyxcbiAgICAnZ3Jvb3ZlJyxcbiAgICAncmlkZ2UnLFxuICAgICdpbnNldCcsXG4gICAgJ291dHNldCdcbl07XG4vKipcbiAqIENoZWNrcyBpZiBzdHJpbmcgY29udGFpbnMgW2xpbmUgc3R5bGVdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9ib3JkZXItc3R5bGUpIENTUyB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBpc0xpbmVTdHlsZShzdHJpbmcpIHtcbiAgICByZXR1cm4gbGluZVN0eWxlVmFsdWVzLmluY2x1ZGVzKHN0cmluZyk7XG59XG5jb25zdCBsZW5ndGhSZWdFeHAgPSAvXihbKy1dP1swLTldKihbLl1bMC05XSspPyhweHxjbXxtbXxpbnxwY3xwdHxjaHxlbXxleHxyZW18dmh8dnd8dm1pbnx2bWF4KXwwKSQvO1xuLyoqXG4gKiBDaGVja3MgaWYgc3RyaW5nIGNvbnRhaW5zIFtsZW5ndGhdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9sZW5ndGgpIENTUyB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBpc0xlbmd0aChzdHJpbmcpIHtcbiAgICByZXR1cm4gbGVuZ3RoUmVnRXhwLnRlc3Qoc3RyaW5nKTtcbn1cbmNvbnN0IFBFUkNFTlRBR0VfVkFMVUVfUkVHRVhQID0gL15bKy1dP1swLTldKihbLl1bMC05XSspPyUkLztcbi8qKlxuICogQ2hlY2tzIGlmIHN0cmluZyBjb250YWlucyBbcGVyY2VudGFnZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BlcmNlbnRhZ2UpIENTUyB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBpc1BlcmNlbnRhZ2Uoc3RyaW5nKSB7XG4gICAgcmV0dXJuIFBFUkNFTlRBR0VfVkFMVUVfUkVHRVhQLnRlc3Qoc3RyaW5nKTtcbn1cbmNvbnN0IHJlcGVhdFZhbHVlcyA9IFtcbiAgICAncmVwZWF0LXgnLFxuICAgICdyZXBlYXQteScsXG4gICAgJ3JlcGVhdCcsXG4gICAgJ3NwYWNlJyxcbiAgICAncm91bmQnLFxuICAgICduby1yZXBlYXQnXG5dO1xuLyoqXG4gKiBDaGVja3MgaWYgc3RyaW5nIGNvbnRhaW5zIFtiYWNrZ3JvdW5kIHJlcGVhdF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2JhY2tncm91bmQtcmVwZWF0KSBDU1MgdmFsdWUuXG4gKi8gZnVuY3Rpb24gaXNSZXBlYXQoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHJlcGVhdFZhbHVlcy5pbmNsdWRlcyhzdHJpbmcpO1xufVxuY29uc3QgcG9zaXRpb25WYWx1ZXMgPSBbXG4gICAgJ2NlbnRlcicsXG4gICAgJ3RvcCcsXG4gICAgJ2JvdHRvbScsXG4gICAgJ2xlZnQnLFxuICAgICdyaWdodCdcbl07XG4vKipcbiAqIENoZWNrcyBpZiBzdHJpbmcgY29udGFpbnMgW2JhY2tncm91bmQgcG9zaXRpb25dKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9iYWNrZ3JvdW5kLXBvc2l0aW9uKSBDU1MgdmFsdWUuXG4gKi8gZnVuY3Rpb24gaXNQb3NpdGlvbihzdHJpbmcpIHtcbiAgICByZXR1cm4gcG9zaXRpb25WYWx1ZXMuaW5jbHVkZXMoc3RyaW5nKTtcbn1cbmNvbnN0IGF0dGFjaG1lbnRWYWx1ZXMgPSBbXG4gICAgJ2ZpeGVkJyxcbiAgICAnc2Nyb2xsJyxcbiAgICAnbG9jYWwnXG5dO1xuLyoqXG4gKiBDaGVja3MgaWYgc3RyaW5nIGNvbnRhaW5zIFtiYWNrZ3JvdW5kIGF0dGFjaG1lbnRdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9iYWNrZ3JvdW5kLWF0dGFjaG1lbnQpIENTUyB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBpc0F0dGFjaG1lbnQoc3RyaW5nKSB7XG4gICAgcmV0dXJuIGF0dGFjaG1lbnRWYWx1ZXMuaW5jbHVkZXMoc3RyaW5nKTtcbn1cbmNvbnN0IHVybFJlZ0V4cCA9IC9edXJsXFwoLztcbi8qKlxuICogQ2hlY2tzIGlmIHN0cmluZyBjb250YWlucyBbVVJMXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvdXJsKSBDU1MgdmFsdWUuXG4gKi8gZnVuY3Rpb24gaXNVUkwoc3RyaW5nKSB7XG4gICAgcmV0dXJuIHVybFJlZ0V4cC50ZXN0KHN0cmluZyk7XG59XG4vKipcbiAqIFBhcnNlcyBib3ggc2lkZXMgYXMgaW5kaXZpZHVhbCB2YWx1ZXMuXG4gKi8gZnVuY3Rpb24gZ2V0Qm94U2lkZXNWYWx1ZXModmFsdWUgPSAnJykge1xuICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgcmlnaHQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGJvdHRvbTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgbGVmdDogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IHZhbHVlcyA9IGdldFNob3J0aGFuZFZhbHVlcyh2YWx1ZSk7XG4gICAgY29uc3QgdG9wID0gdmFsdWVzWzBdO1xuICAgIGNvbnN0IGJvdHRvbSA9IHZhbHVlc1syXSB8fCB0b3A7XG4gICAgY29uc3QgcmlnaHQgPSB2YWx1ZXNbMV0gfHwgdG9wO1xuICAgIGNvbnN0IGxlZnQgPSB2YWx1ZXNbM10gfHwgcmlnaHQ7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdG9wLFxuICAgICAgICBib3R0b20sXG4gICAgICAgIHJpZ2h0LFxuICAgICAgICBsZWZ0XG4gICAgfTtcbn1cbi8qKlxuICogRGVmYXVsdCByZWR1Y2VyIGZvciBDU1MgcHJvcGVydGllcyB0aGF0IGNvbmNlcm5zIGVkZ2VzIG9mIGEgYm94XG4gKiBbc2hvcnRoYW5kXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvU2hvcnRoYW5kX3Byb3BlcnRpZXMpIG5vdGF0aW9uczpcbiAqXG4gKiBgYGB0c1xuICogc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoICdwYWRkaW5nJywgZ2V0Qm94U2lkZXNWYWx1ZVJlZHVjZXIoICdwYWRkaW5nJyApICk7XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBnZXRCb3hTaWRlc1ZhbHVlUmVkdWNlcihzdHlsZVNob3J0aGFuZCkge1xuICAgIHJldHVybiAodmFsdWUpPT57XG4gICAgICAgIGNvbnN0IHsgdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0IH0gPSB2YWx1ZTtcbiAgICAgICAgY29uc3QgcmVkdWNlZCA9IFtdO1xuICAgICAgICBpZiAoIVtcbiAgICAgICAgICAgIHRvcCxcbiAgICAgICAgICAgIHJpZ2h0LFxuICAgICAgICAgICAgbGVmdCxcbiAgICAgICAgICAgIGJvdHRvbVxuICAgICAgICBdLmV2ZXJ5KCh2YWx1ZSk9PiEhdmFsdWUpKSB7XG4gICAgICAgICAgICBpZiAodG9wKSB7XG4gICAgICAgICAgICAgICAgcmVkdWNlZC5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVTaG9ydGhhbmQgKyAnLXRvcCcsXG4gICAgICAgICAgICAgICAgICAgIHRvcFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgcmVkdWNlZC5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVTaG9ydGhhbmQgKyAnLXJpZ2h0JyxcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChib3R0b20pIHtcbiAgICAgICAgICAgICAgICByZWR1Y2VkLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICBzdHlsZVNob3J0aGFuZCArICctYm90dG9tJyxcbiAgICAgICAgICAgICAgICAgICAgYm90dG9tXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGVmdCkge1xuICAgICAgICAgICAgICAgIHJlZHVjZWQucHVzaChbXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlU2hvcnRoYW5kICsgJy1sZWZ0JyxcbiAgICAgICAgICAgICAgICAgICAgbGVmdFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVkdWNlZC5wdXNoKFtcbiAgICAgICAgICAgICAgICBzdHlsZVNob3J0aGFuZCxcbiAgICAgICAgICAgICAgICBnZXRCb3hTaWRlc1Nob3J0aGFuZFZhbHVlKHZhbHVlKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlZHVjZWQ7XG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyBhIFtzaG9ydGhhbmRdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9TaG9ydGhhbmRfcHJvcGVydGllcykgbm90YXRpb25cbiAqIG9mIGEgQ1NTIHByb3BlcnR5IHZhbHVlLlxuICpcbiAqIGBgYHRzXG4gKiBnZXRCb3hTaWRlc1Nob3J0aGFuZFZhbHVlKCB7IHRvcDogJzFweCcsIHJpZ2h0OiAnMXB4JywgYm90dG9tOiAnMnB4JywgbGVmdDogJzFweCcgfSApO1xuICogLy8gd2lsbCByZXR1cm4gJzFweCAxcHggMnB4J1xuICogYGBgXG4gKi8gZnVuY3Rpb24gZ2V0Qm94U2lkZXNTaG9ydGhhbmRWYWx1ZSh7IHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCB9KSB7XG4gICAgY29uc3Qgb3V0ID0gW107XG4gICAgaWYgKGxlZnQgIT09IHJpZ2h0KSB7XG4gICAgICAgIG91dC5wdXNoKHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCk7XG4gICAgfSBlbHNlIGlmIChib3R0b20gIT09IHRvcCkge1xuICAgICAgICBvdXQucHVzaCh0b3AsIHJpZ2h0LCBib3R0b20pO1xuICAgIH0gZWxzZSBpZiAocmlnaHQgIT09IHRvcCkge1xuICAgICAgICBvdXQucHVzaCh0b3AsIHJpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBvdXQucHVzaCh0b3ApO1xuICAgIH1cbiAgICByZXR1cm4gb3V0LmpvaW4oJyAnKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5vcm1hbGl6ZXIgZm9yIGEgW3Nob3J0aGFuZF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL1Nob3J0aGFuZF9wcm9wZXJ0aWVzKSAxLXRvLTQgdmFsdWUuXG4gKlxuICogYGBgdHNcbiAqIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCAnbWFyZ2luJywgZ2V0UG9zaXRpb25TaG9ydGhhbmROb3JtYWxpemVyKCAnbWFyZ2luJyApICk7XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBnZXRQb3NpdGlvblNob3J0aGFuZE5vcm1hbGl6ZXIoc2hvcnRoYW5kKSB7XG4gICAgcmV0dXJuICh2YWx1ZSk9PntcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdGg6IHNob3J0aGFuZCxcbiAgICAgICAgICAgIHZhbHVlOiBnZXRCb3hTaWRlc1ZhbHVlcyh2YWx1ZSlcbiAgICAgICAgfTtcbiAgICB9O1xufVxuLyoqXG4gKiBQYXJzZXMgcGFydHMgb2YgYSAxLXRvLTQgdmFsdWUgbm90YXRpb24gLSBoYW5kbGVzIHNvbWUgQ1NTIHZhbHVlcyB3aXRoIHNwYWNlcyAobGlrZSBSR0IoKSkuXG4gKlxuICogYGBgdHNcbiAqIGdldFNob3J0aGFuZFZhbHVlcyggJ3JlZCBibHVlIFJHQigwLCAwLCAwKScpO1xuICogLy8gd2lsbCByZXR1cm4gWyAncmVkJywgJ2JsdWUnLCAnUkdCKDAsIDAsIDApJyBdXG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBnZXRTaG9ydGhhbmRWYWx1ZXMoc3RyaW5nKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IHN0cmluZy50cmltKCkuc2xpY2UoMCwgMTUwMCkubWF0Y2hBbGwoQ1NTX1NIT1JUSEFORF9WQUxVRV9SRUdFWFApO1xuICAgIHJldHVybiBBcnJheS5mcm9tKG1hdGNoZXMpLm1hcCgoaSk9PmlbMF0pO1xufVxuXG4vKipcbiAqIEFkZHMgYSBiYWNrZ3JvdW5kIENTUyBzdHlsZXMgcHJvY2Vzc2luZyBydWxlcy5cbiAqXG4gKiBgYGB0c1xuICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkQmFja2dyb3VuZFJ1bGVzICk7XG4gKiBgYGBcbiAqXG4gKiBUaGUgbm9ybWFsaXplZCB2YWx1ZSBpcyBzdG9yZWQgYXM6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHN0eWxlcyA9IHtcbiAqIFx0YmFja2dyb3VuZDoge1xuICogXHRcdGNvbG9yLFxuICogXHRcdHJlcGVhdCxcbiAqIFx0XHRwb3NpdGlvbixcbiAqIFx0XHRhdHRhY2htZW50LFxuICogXHRcdGltYWdlXG4gKiBcdH1cbiAqIH07XG4gKiBgYGBgXG4gKlxuICogKipOb3RlKio6IEN1cnJlbnRseSBvbmx5IGAnYmFja2dyb3VuZC1jb2xvcidgIGxvbmdoYW5kIHZhbHVlIGlzIHBhcnNlZCBiZXNpZGVzIGAnYmFja2dyb3VuZCdgIHNob3J0aGFuZC4gVGhlIHJlZHVjZXIgYWxzbyBzdXBwb3J0cyBvbmx5XG4gKiBgJ2JhY2tncm91bmQtY29sb3InYCB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBhZGRCYWNrZ3JvdW5kUnVsZXMoc3R5bGVzUHJvY2Vzc29yKSB7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JhY2tncm91bmQnLCBnZXRCYWNrZ3JvdW5kTm9ybWFsaXplcigpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYmFja2dyb3VuZC1jb2xvcicsIGdldEJhY2tncm91bmRDb2xvck5vcm1hbGl6ZXIoKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ2JhY2tncm91bmQnLCBnZXRCYWNrZ3JvdW5kUmVkdWNlcigpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYmFja2dyb3VuZCcsIFtcbiAgICAgICAgJ2JhY2tncm91bmQtY29sb3InXG4gICAgXSk7XG59XG5mdW5jdGlvbiBnZXRCYWNrZ3JvdW5kTm9ybWFsaXplcigpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICBjb25zdCBiYWNrZ3JvdW5kID0ge307XG4gICAgICAgIGNvbnN0IHBhcnRzID0gZ2V0U2hvcnRoYW5kVmFsdWVzKHZhbHVlKTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIHBhcnRzKXtcbiAgICAgICAgICAgIGlmIChpc1JlcGVhdChwYXJ0KSkge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQucmVwZWF0ID0gYmFja2dyb3VuZC5yZXBlYXQgfHwgW107XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZC5yZXBlYXQucHVzaChwYXJ0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNQb3NpdGlvbihwYXJ0KSkge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQucG9zaXRpb24gPSBiYWNrZ3JvdW5kLnBvc2l0aW9uIHx8IFtdO1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQucG9zaXRpb24ucHVzaChwYXJ0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBdHRhY2htZW50KHBhcnQpKSB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZC5hdHRhY2htZW50ID0gcGFydDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb2xvcihwYXJ0KSkge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQuY29sb3IgPSBwYXJ0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpc1VSTChwYXJ0KSkge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQuaW1hZ2UgPSBwYXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoOiAnYmFja2dyb3VuZCcsXG4gICAgICAgICAgICB2YWx1ZTogYmFja2dyb3VuZFxuICAgICAgICB9O1xuICAgIH07XG59XG5mdW5jdGlvbiBnZXRCYWNrZ3JvdW5kQ29sb3JOb3JtYWxpemVyKCkge1xuICAgIHJldHVybiAodmFsdWUpPT4oe1xuICAgICAgICAgICAgcGF0aDogJ2JhY2tncm91bmQuY29sb3InLFxuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgfSk7XG59XG5mdW5jdGlvbiBnZXRCYWNrZ3JvdW5kUmVkdWNlcigpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICBjb25zdCByZXQgPSBbXTtcbiAgICAgICAgcmV0LnB1c2goW1xuICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InLFxuICAgICAgICAgICAgdmFsdWUuY29sb3JcbiAgICAgICAgXSk7XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfTtcbn1cblxuLyoqXG4gKiBBZGRzIGEgYm9yZGVyIENTUyBzdHlsZXMgcHJvY2Vzc2luZyBydWxlcy5cbiAqXG4gKiBgYGB0c1xuICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkQm9yZGVyUnVsZXMgKTtcbiAqIGBgYFxuICpcbiAqIFRoaXMgcnVsZXMgbWVyZ2VzIGFsbCBbYm9yZGVyXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvYm9yZGVyKSBzdHlsZXMgbm90YXRpb24gc2hvcnRoYW5kczpcbiAqXG4gKiAtIGJvcmRlclxuICogLSBib3JkZXItdG9wXG4gKiAtIGJvcmRlci1yaWdodFxuICogLSBib3JkZXItYm90dG9tXG4gKiAtIGJvcmRlci1sZWZ0XG4gKiAtIGJvcmRlci1jb2xvclxuICogLSBib3JkZXItc3R5bGVcbiAqIC0gYm9yZGVyLXdpZHRoXG4gKlxuICogYW5kIGFsbCBjb3JyZXNwb25kaW5nIGxvbmdoYW5kIGZvcm1zIChsaWtlIGBib3JkZXItdG9wLWNvbG9yYCwgYGJvcmRlci10b3Atc3R5bGVgLCBldGMpLlxuICpcbiAqIEl0IGRvZXMgbm90IGhhbmRsZSBvdGhlciBzaG9ydGhhbmRzIChsaWtlIGBib3JkZXItcmFkaXVzYCBvciBgYm9yZGVyLWltYWdlYCkuXG4gKlxuICogVGhlIG5vcm1hbGl6ZWQgbW9kZWwgc3RvcmVzIGJvcmRlciB2YWx1ZXMgYXM6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHN0eWxlcyA9IHtcbiAqIFx0Ym9yZGVyOiB7XG4gKiBcdFx0Y29sb3I6IHsgdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0IH0sXG4gKiBcdFx0c3R5bGU6IHsgdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0IH0sXG4gKiBcdFx0d2lkdGg6IHsgdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0IH0sXG4gKiBcdH1cbiAqIH07XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBhZGRCb3JkZXJSdWxlcyhzdHlsZXNQcm9jZXNzb3IpIHtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYm9yZGVyJywgZ2V0Qm9yZGVyTm9ybWFsaXplcigpKTtcbiAgICAvLyBCb3JkZXItcG9zaXRpb24gc2hvcnRoYW5kcy5cbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYm9yZGVyLXRvcCcsIGdldEJvcmRlclBvc2l0aW9uTm9ybWFsaXplcigndG9wJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItcmlnaHQnLCBnZXRCb3JkZXJQb3NpdGlvbk5vcm1hbGl6ZXIoJ3JpZ2h0JykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItYm90dG9tJywgZ2V0Qm9yZGVyUG9zaXRpb25Ob3JtYWxpemVyKCdib3R0b20nKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1sZWZ0JywgZ2V0Qm9yZGVyUG9zaXRpb25Ob3JtYWxpemVyKCdsZWZ0JykpO1xuICAgIC8vIEJvcmRlci1wcm9wZXJ0eSBzaG9ydGhhbmRzLlxuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItY29sb3InLCBnZXRCb3JkZXJQcm9wZXJ0eU5vcm1hbGl6ZXIoJ2NvbG9yJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItd2lkdGgnLCBnZXRCb3JkZXJQcm9wZXJ0eU5vcm1hbGl6ZXIoJ3dpZHRoJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItc3R5bGUnLCBnZXRCb3JkZXJQcm9wZXJ0eU5vcm1hbGl6ZXIoJ3N0eWxlJykpO1xuICAgIC8vIEJvcmRlciBsb25naGFuZHMuXG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci10b3AtY29sb3InLCBnZXRCb3JkZXJQcm9wZXJ0eVBvc2l0aW9uTm9ybWFsaXplcignY29sb3InLCAndG9wJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItdG9wLXN0eWxlJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ3N0eWxlJywgJ3RvcCcpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYm9yZGVyLXRvcC13aWR0aCcsIGdldEJvcmRlclByb3BlcnR5UG9zaXRpb25Ob3JtYWxpemVyKCd3aWR0aCcsICd0b3AnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1yaWdodC1jb2xvcicsIGdldEJvcmRlclByb3BlcnR5UG9zaXRpb25Ob3JtYWxpemVyKCdjb2xvcicsICdyaWdodCcpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYm9yZGVyLXJpZ2h0LXN0eWxlJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ3N0eWxlJywgJ3JpZ2h0JykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItcmlnaHQtd2lkdGgnLCBnZXRCb3JkZXJQcm9wZXJ0eVBvc2l0aW9uTm9ybWFsaXplcignd2lkdGgnLCAncmlnaHQnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1ib3R0b20tY29sb3InLCBnZXRCb3JkZXJQcm9wZXJ0eVBvc2l0aW9uTm9ybWFsaXplcignY29sb3InLCAnYm90dG9tJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdib3JkZXItYm90dG9tLXN0eWxlJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ3N0eWxlJywgJ2JvdHRvbScpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignYm9yZGVyLWJvdHRvbS13aWR0aCcsIGdldEJvcmRlclByb3BlcnR5UG9zaXRpb25Ob3JtYWxpemVyKCd3aWR0aCcsICdib3R0b20nKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1sZWZ0LWNvbG9yJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ2NvbG9yJywgJ2xlZnQnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1sZWZ0LXN0eWxlJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ3N0eWxlJywgJ2xlZnQnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ2JvcmRlci1sZWZ0LXdpZHRoJywgZ2V0Qm9yZGVyUHJvcGVydHlQb3NpdGlvbk5vcm1hbGl6ZXIoJ3dpZHRoJywgJ2xlZnQnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXRvcCcsIGdldEJvcmRlclBvc2l0aW9uRXh0cmFjdG9yKCd0b3AnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXJpZ2h0JywgZ2V0Qm9yZGVyUG9zaXRpb25FeHRyYWN0b3IoJ3JpZ2h0JykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1ib3R0b20nLCBnZXRCb3JkZXJQb3NpdGlvbkV4dHJhY3RvcignYm90dG9tJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1sZWZ0JywgZ2V0Qm9yZGVyUG9zaXRpb25FeHRyYWN0b3IoJ2xlZnQnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXRvcC1jb2xvcicsICdib3JkZXIuY29sb3IudG9wJyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXJpZ2h0LWNvbG9yJywgJ2JvcmRlci5jb2xvci5yaWdodCcpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1ib3R0b20tY29sb3InLCAnYm9yZGVyLmNvbG9yLmJvdHRvbScpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1sZWZ0LWNvbG9yJywgJ2JvcmRlci5jb2xvci5sZWZ0Jyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXRvcC13aWR0aCcsICdib3JkZXIud2lkdGgudG9wJyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXJpZ2h0LXdpZHRoJywgJ2JvcmRlci53aWR0aC5yaWdodCcpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1ib3R0b20td2lkdGgnLCAnYm9yZGVyLndpZHRoLmJvdHRvbScpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1sZWZ0LXdpZHRoJywgJ2JvcmRlci53aWR0aC5sZWZ0Jyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXRvcC1zdHlsZScsICdib3JkZXIuc3R5bGUudG9wJyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldEV4dHJhY3RvcignYm9yZGVyLXJpZ2h0LXN0eWxlJywgJ2JvcmRlci5zdHlsZS5yaWdodCcpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1ib3R0b20tc3R5bGUnLCAnYm9yZGVyLnN0eWxlLmJvdHRvbScpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRFeHRyYWN0b3IoJ2JvcmRlci1sZWZ0LXN0eWxlJywgJ2JvcmRlci5zdHlsZS5sZWZ0Jyk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ2JvcmRlci1jb2xvcicsIGdldEJveFNpZGVzVmFsdWVSZWR1Y2VyKCdib3JkZXItY29sb3InKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ2JvcmRlci1zdHlsZScsIGdldEJveFNpZGVzVmFsdWVSZWR1Y2VyKCdib3JkZXItc3R5bGUnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ2JvcmRlci13aWR0aCcsIGdldEJveFNpZGVzVmFsdWVSZWR1Y2VyKCdib3JkZXItd2lkdGgnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ2JvcmRlci10b3AnLCBnZXRCb3JkZXJQb3NpdGlvblJlZHVjZXIoJ3RvcCcpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0UmVkdWNlcignYm9yZGVyLXJpZ2h0JywgZ2V0Qm9yZGVyUG9zaXRpb25SZWR1Y2VyKCdyaWdodCcpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0UmVkdWNlcignYm9yZGVyLWJvdHRvbScsIGdldEJvcmRlclBvc2l0aW9uUmVkdWNlcignYm90dG9tJykpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRSZWR1Y2VyKCdib3JkZXItbGVmdCcsIGdldEJvcmRlclBvc2l0aW9uUmVkdWNlcignbGVmdCcpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0UmVkdWNlcignYm9yZGVyJywgZ2V0Qm9yZGVyUmVkdWNlcigpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyJywgW1xuICAgICAgICAnYm9yZGVyLWNvbG9yJyxcbiAgICAgICAgJ2JvcmRlci1zdHlsZScsXG4gICAgICAgICdib3JkZXItd2lkdGgnLFxuICAgICAgICAnYm9yZGVyLXRvcCcsXG4gICAgICAgICdib3JkZXItcmlnaHQnLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbScsXG4gICAgICAgICdib3JkZXItbGVmdCcsXG4gICAgICAgICdib3JkZXItdG9wLWNvbG9yJyxcbiAgICAgICAgJ2JvcmRlci1yaWdodC1jb2xvcicsXG4gICAgICAgICdib3JkZXItYm90dG9tLWNvbG9yJyxcbiAgICAgICAgJ2JvcmRlci1sZWZ0LWNvbG9yJyxcbiAgICAgICAgJ2JvcmRlci10b3Atc3R5bGUnLFxuICAgICAgICAnYm9yZGVyLXJpZ2h0LXN0eWxlJyxcbiAgICAgICAgJ2JvcmRlci1ib3R0b20tc3R5bGUnLFxuICAgICAgICAnYm9yZGVyLWxlZnQtc3R5bGUnLFxuICAgICAgICAnYm9yZGVyLXRvcC13aWR0aCcsXG4gICAgICAgICdib3JkZXItcmlnaHQtd2lkdGgnLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS13aWR0aCcsXG4gICAgICAgICdib3JkZXItbGVmdC13aWR0aCdcbiAgICBdKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyLWNvbG9yJywgW1xuICAgICAgICAnYm9yZGVyLXRvcC1jb2xvcicsXG4gICAgICAgICdib3JkZXItcmlnaHQtY29sb3InLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS1jb2xvcicsXG4gICAgICAgICdib3JkZXItbGVmdC1jb2xvcidcbiAgICBdKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyLXN0eWxlJywgW1xuICAgICAgICAnYm9yZGVyLXRvcC1zdHlsZScsXG4gICAgICAgICdib3JkZXItcmlnaHQtc3R5bGUnLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS1zdHlsZScsXG4gICAgICAgICdib3JkZXItbGVmdC1zdHlsZSdcbiAgICBdKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyLXdpZHRoJywgW1xuICAgICAgICAnYm9yZGVyLXRvcC13aWR0aCcsXG4gICAgICAgICdib3JkZXItcmlnaHQtd2lkdGgnLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS13aWR0aCcsXG4gICAgICAgICdib3JkZXItbGVmdC13aWR0aCdcbiAgICBdKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyLXRvcCcsIFtcbiAgICAgICAgJ2JvcmRlci10b3AtY29sb3InLFxuICAgICAgICAnYm9yZGVyLXRvcC1zdHlsZScsXG4gICAgICAgICdib3JkZXItdG9wLXdpZHRoJ1xuICAgIF0pO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRTdHlsZVJlbGF0aW9uKCdib3JkZXItcmlnaHQnLCBbXG4gICAgICAgICdib3JkZXItcmlnaHQtY29sb3InLFxuICAgICAgICAnYm9yZGVyLXJpZ2h0LXN0eWxlJyxcbiAgICAgICAgJ2JvcmRlci1yaWdodC13aWR0aCdcbiAgICBdKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbignYm9yZGVyLWJvdHRvbScsIFtcbiAgICAgICAgJ2JvcmRlci1ib3R0b20tY29sb3InLFxuICAgICAgICAnYm9yZGVyLWJvdHRvbS1zdHlsZScsXG4gICAgICAgICdib3JkZXItYm90dG9tLXdpZHRoJ1xuICAgIF0pO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXRTdHlsZVJlbGF0aW9uKCdib3JkZXItbGVmdCcsIFtcbiAgICAgICAgJ2JvcmRlci1sZWZ0LWNvbG9yJyxcbiAgICAgICAgJ2JvcmRlci1sZWZ0LXN0eWxlJyxcbiAgICAgICAgJ2JvcmRlci1sZWZ0LXdpZHRoJ1xuICAgIF0pO1xufVxuZnVuY3Rpb24gZ2V0Qm9yZGVyTm9ybWFsaXplcigpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICBjb25zdCB7IGNvbG9yLCBzdHlsZSwgd2lkdGggfSA9IG5vcm1hbGl6ZUJvcmRlclNob3J0aGFuZCh2YWx1ZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoOiAnYm9yZGVyJyxcbiAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgY29sb3I6IGdldEJveFNpZGVzVmFsdWVzKGNvbG9yKSxcbiAgICAgICAgICAgICAgICBzdHlsZTogZ2V0Qm94U2lkZXNWYWx1ZXMoc3R5bGUpLFxuICAgICAgICAgICAgICAgIHdpZHRoOiBnZXRCb3hTaWRlc1ZhbHVlcyh3aWR0aClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0Qm9yZGVyUG9zaXRpb25Ob3JtYWxpemVyKHNpZGUpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICBjb25zdCB7IGNvbG9yLCBzdHlsZSwgd2lkdGggfSA9IG5vcm1hbGl6ZUJvcmRlclNob3J0aGFuZCh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IGJvcmRlciA9IHt9O1xuICAgICAgICBpZiAoY29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgYm9yZGVyLmNvbG9yID0ge1xuICAgICAgICAgICAgICAgIFtzaWRlXTogY29sb3JcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0eWxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGJvcmRlci5zdHlsZSA9IHtcbiAgICAgICAgICAgICAgICBbc2lkZV06IHN0eWxlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBib3JkZXIud2lkdGggPSB7XG4gICAgICAgICAgICAgICAgW3NpZGVdOiB3aWR0aFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogJ2JvcmRlcicsXG4gICAgICAgICAgICB2YWx1ZTogYm9yZGVyXG4gICAgICAgIH07XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldEJvcmRlclByb3BlcnR5Tm9ybWFsaXplcihwcm9wZXJ0eU5hbWUpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF0aDogJ2JvcmRlcicsXG4gICAgICAgICAgICB2YWx1ZTogdG9Cb3JkZXJQcm9wZXJ0eVNob3J0aGFuZCh2YWx1ZSwgcHJvcGVydHlOYW1lKVxuICAgICAgICB9O1xuICAgIH07XG59XG5mdW5jdGlvbiB0b0JvcmRlclByb3BlcnR5U2hvcnRoYW5kKHZhbHVlLCBwcm9wZXJ0eSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIFtwcm9wZXJ0eV06IGdldEJveFNpZGVzVmFsdWVzKHZhbHVlKVxuICAgIH07XG59XG5mdW5jdGlvbiBnZXRCb3JkZXJQcm9wZXJ0eVBvc2l0aW9uTm9ybWFsaXplcihwcm9wZXJ0eSwgc2lkZSkge1xuICAgIHJldHVybiAodmFsdWUpPT57XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwYXRoOiAnYm9yZGVyJyxcbiAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgW3Byb3BlcnR5XToge1xuICAgICAgICAgICAgICAgICAgICBbc2lkZV06IHZhbHVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG59XG5mdW5jdGlvbiBnZXRCb3JkZXJQb3NpdGlvbkV4dHJhY3Rvcih3aGljaCkge1xuICAgIHJldHVybiAobmFtZSwgc3R5bGVzKT0+e1xuICAgICAgICBpZiAoc3R5bGVzLmJvcmRlcikge1xuICAgICAgICAgICAgcmV0dXJuIGV4dHJhY3RCb3JkZXJQb3NpdGlvbihzdHlsZXMuYm9yZGVyLCB3aGljaCk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gZXh0cmFjdEJvcmRlclBvc2l0aW9uKGJvcmRlciwgd2hpY2gpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHt9O1xuICAgIGlmIChib3JkZXIud2lkdGggJiYgYm9yZGVyLndpZHRoW3doaWNoXSkge1xuICAgICAgICB2YWx1ZS53aWR0aCA9IGJvcmRlci53aWR0aFt3aGljaF07XG4gICAgfVxuICAgIGlmIChib3JkZXIuc3R5bGUgJiYgYm9yZGVyLnN0eWxlW3doaWNoXSkge1xuICAgICAgICB2YWx1ZS5zdHlsZSA9IGJvcmRlci5zdHlsZVt3aGljaF07XG4gICAgfVxuICAgIGlmIChib3JkZXIuY29sb3IgJiYgYm9yZGVyLmNvbG9yW3doaWNoXSkge1xuICAgICAgICB2YWx1ZS5jb2xvciA9IGJvcmRlci5jb2xvclt3aGljaF07XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZUJvcmRlclNob3J0aGFuZChzdHJpbmcpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBjb25zdCBwYXJ0cyA9IGdldFNob3J0aGFuZFZhbHVlcyhzdHJpbmcpO1xuICAgIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cyl7XG4gICAgICAgIGlmIChpc0xlbmd0aChwYXJ0KSB8fCAvdGhpbnxtZWRpdW18dGhpY2svLnRlc3QocGFydCkpIHtcbiAgICAgICAgICAgIHJlc3VsdC53aWR0aCA9IHBhcnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNMaW5lU3R5bGUocGFydCkpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zdHlsZSA9IHBhcnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQuY29sb3IgPSBwYXJ0O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4vKipcbiAqIFRoZSBib3JkZXIgcmVkdWNlciBmYWN0b3J5LlxuICpcbiAqIEl0IHRyaWVzIHRvIHByb2R1Y2UgdGhlIG1vc3Qgb3B0aW1hbCBvdXRwdXQgZm9yIHRoZSBzcGVjaWZpZWQgc3R5bGVzLlxuICpcbiAqIEZvciBhIGJvcmRlciBzdHlsZTpcbiAqXG4gKiBgYGBjc3NcbiAqIHN0eWxlOiB7dG9wOiBcInNvbGlkXCIsIGJvdHRvbTogXCJzb2xpZFwiLCByaWdodDogXCJzb2xpZFwiLCBsZWZ0OiBcInNvbGlkXCJ9XG4gKiBgYGBcbiAqXG4gKiBJdCB3aWxsIHByb2R1Y2U6IGBib3JkZXItc3R5bGU6IHNvbGlkYC5cbiAqIEZvciBhIGJvcmRlciBzdHlsZSBhbmQgY29sb3I6XG4gKlxuICogYGBgY3NzXG4gKiBjb2xvcjoge3RvcDogXCIjZmYwXCIsIGJvdHRvbTogXCIjZmYwXCIsIHJpZ2h0OiBcIiNmZjBcIiwgbGVmdDogXCIjZmYwXCJ9XG4gKiBzdHlsZToge3RvcDogXCJzb2xpZFwiLCBib3R0b206IFwic29saWRcIiwgcmlnaHQ6IFwic29saWRcIiwgbGVmdDogXCJzb2xpZFwifVxuICogYGBgXG4gKlxuICogSXQgd2lsbCBwcm9kdWNlOiBgYm9yZGVyLWNvbG9yOiAjZmYwOyBib3JkZXItc3R5bGU6IHNvbGlkYC5cbiAqIElmIGFsbCBib3JkZXIgcGFyYW1ldGVycyBhcmUgc3BlY2lmaWVkOlxuICpcbiAqIGBgYGNzc1xuICogY29sb3I6IHt0b3A6IFwiI2ZmMFwiLCBib3R0b206IFwiI2ZmMFwiLCByaWdodDogXCIjZmYwXCIsIGxlZnQ6IFwiI2ZmMFwifVxuICogc3R5bGU6IHt0b3A6IFwic29saWRcIiwgYm90dG9tOiBcInNvbGlkXCIsIHJpZ2h0OiBcInNvbGlkXCIsIGxlZnQ6IFwic29saWRcIn1cbiAqIHdpZHRoOiB7dG9wOiBcIjJweFwiLCBib3R0b206IFwiMnB4XCIsIHJpZ2h0OiBcIjJweFwiLCBsZWZ0OiBcIjJweFwifVxuICogYGBgXG4gKlxuICogSXQgd2lsbCBjb21iaW5lIGV2ZXJ5dGhpbmcgaW50byBhIHNpbmdsZSBwcm9wZXJ0eTogYGJvcmRlcjogMnB4IHNvbGlkICNmZjBgLlxuICpcbiAqIFRoZSBkZWZpbml0aW9ucyBhcmUgbWVyZ2VkIG9ubHkgaWYgYWxsIGJvcmRlciBzZWxlY3RvcnMgaGF2ZSB0aGUgc2FtZSB2YWx1ZXMuXG4gKi8gZnVuY3Rpb24gZ2V0Qm9yZGVyUmVkdWNlcigpIHtcbiAgICByZXR1cm4gKHZhbHVlKT0+e1xuICAgICAgICBjb25zdCB0b3BTdHlsZXMgPSBleHRyYWN0Qm9yZGVyUG9zaXRpb24odmFsdWUsICd0b3AnKTtcbiAgICAgICAgY29uc3QgcmlnaHRTdHlsZXMgPSBleHRyYWN0Qm9yZGVyUG9zaXRpb24odmFsdWUsICdyaWdodCcpO1xuICAgICAgICBjb25zdCBib3R0b21TdHlsZXMgPSBleHRyYWN0Qm9yZGVyUG9zaXRpb24odmFsdWUsICdib3R0b20nKTtcbiAgICAgICAgY29uc3QgbGVmdFN0eWxlcyA9IGV4dHJhY3RCb3JkZXJQb3NpdGlvbih2YWx1ZSwgJ2xlZnQnKTtcbiAgICAgICAgY29uc3QgYm9yZGVyU3R5bGVzID0gW1xuICAgICAgICAgICAgdG9wU3R5bGVzLFxuICAgICAgICAgICAgcmlnaHRTdHlsZXMsXG4gICAgICAgICAgICBib3R0b21TdHlsZXMsXG4gICAgICAgICAgICBsZWZ0U3R5bGVzXG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGJvcmRlclN0eWxlc0J5VHlwZSA9IHtcbiAgICAgICAgICAgIHdpZHRoOiBnZXRSZWR1Y2VkU3R5bGVWYWx1ZUZvclR5cGUoYm9yZGVyU3R5bGVzLCAnd2lkdGgnKSxcbiAgICAgICAgICAgIHN0eWxlOiBnZXRSZWR1Y2VkU3R5bGVWYWx1ZUZvclR5cGUoYm9yZGVyU3R5bGVzLCAnc3R5bGUnKSxcbiAgICAgICAgICAgIGNvbG9yOiBnZXRSZWR1Y2VkU3R5bGVWYWx1ZUZvclR5cGUoYm9yZGVyU3R5bGVzLCAnY29sb3InKVxuICAgICAgICB9O1xuICAgICAgICAvLyBUcnkgcmVkdWNpbmcgdG8gYSBzaW5nbGUgYGJvcmRlcjpgIHByb3BlcnR5LlxuICAgICAgICBjb25zdCByZWR1Y2VkQm9yZGVyU3R5bGUgPSByZWR1Y2VCb3JkZXJQb3NpdGlvbihib3JkZXJTdHlsZXNCeVR5cGUsICdhbGwnKTtcbiAgICAgICAgaWYgKHJlZHVjZWRCb3JkZXJTdHlsZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiByZWR1Y2VkQm9yZGVyU3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVHJ5IHJlZHVjaW5nIHRvIGBib3JkZXItc3R5bGU6YCwgYGJvcmRlci13aWR0aDpgLCBgYm9yZGVyLWNvbG9yOmAgcHJvcGVydGllcy5cbiAgICAgICAgY29uc3QgcmVkdWNlZFN0eWxlVHlwZXMgPSBPYmplY3QuZW50cmllcyhib3JkZXJTdHlsZXNCeVR5cGUpLnJlZHVjZSgocmVkdWNlZFN0eWxlVHlwZXMsIFt0eXBlLCB2YWx1ZV0pPT57XG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZWR1Y2VkU3R5bGVUeXBlcy5wdXNoKFtcbiAgICAgICAgICAgICAgICAgICAgYGJvcmRlci0ke3R5cGV9YCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgaXQgZnJvbSB0aGUgZnVsbCBzZXQgdG8gbm90IGluY2x1ZGUgaXQgaW4gdGhlIG1vc3Qgc3BlY2lmaWMgcHJvcGVydGllcyBsYXRlci5cbiAgICAgICAgICAgICAgICBib3JkZXJTdHlsZXMuZm9yRWFjaCgoc3R5bGUpPT5kZWxldGUgc3R5bGVbdHlwZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlZHVjZWRTdHlsZVR5cGVzO1xuICAgICAgICB9LCBbXSk7XG4gICAgICAgIC8vIFRoZSByZWR1Y2VkIHByb3BlcnRpZXMgKGJ5IHR5cGUpIGFuZCBhbGwgdGhhdCByZW1haW5zIHRoYXQgY291bGQgbm90IGJlIHJlZHVjZWQuXG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZWR1Y2VkU3R5bGVUeXBlcyxcbiAgICAgICAgICAgIC4uLnJlZHVjZUJvcmRlclBvc2l0aW9uKHRvcFN0eWxlcywgJ3RvcCcpLFxuICAgICAgICAgICAgLi4ucmVkdWNlQm9yZGVyUG9zaXRpb24ocmlnaHRTdHlsZXMsICdyaWdodCcpLFxuICAgICAgICAgICAgLi4ucmVkdWNlQm9yZGVyUG9zaXRpb24oYm90dG9tU3R5bGVzLCAnYm90dG9tJyksXG4gICAgICAgICAgICAuLi5yZWR1Y2VCb3JkZXJQb3NpdGlvbihsZWZ0U3R5bGVzLCAnbGVmdCcpXG4gICAgICAgIF07XG4gICAgfTtcbiAgICAvKipcblx0ICogQHBhcmFtIHN0eWxlcyBUaGUgYXJyYXkgb2Ygb2JqZWN0cyB3aXRoIGBzdHlsZWAsIGBjb2xvcmAsIGB3aWR0aGAgcHJvcGVydGllcy5cblx0ICovIGZ1bmN0aW9uIGdldFJlZHVjZWRTdHlsZVZhbHVlRm9yVHlwZShzdHlsZXMsIHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIHN0eWxlcy5tYXAoKHN0eWxlKT0+c3R5bGVbdHlwZV0pLnJlZHVjZSgocmVzdWx0LCBzdHlsZSk9PnJlc3VsdCA9PSBzdHlsZSA/IHJlc3VsdCA6IG51bGwpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldEJvcmRlclBvc2l0aW9uUmVkdWNlcih3aGljaCkge1xuICAgIHJldHVybiAodmFsdWUpPT5yZWR1Y2VCb3JkZXJQb3NpdGlvbih2YWx1ZSwgd2hpY2gpO1xufVxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IHdpdGggcmVkdWNlZCBib3JkZXIgc3R5bGVzIGRlcGVuZGluZyBvbiB0aGUgc3BlY2lmaWVkIHZhbHVlcy5cbiAqXG4gKiBJZiBhbGwgYm9yZGVyIHByb3BlcnRpZXMgKHdpZHRoLCBzdHlsZSwgY29sb3IpIGFyZSBzcGVjaWZpZWQsIHRoZSByZXR1cm5lZCBzZWxlY3RvciB3aWxsIGJlXG4gKiBtZXJnZWQgaW50byBhIGdyb3VwOiBgYm9yZGVyLSo6IFt3aWR0aF0gW3N0eWxlXSBbY29sb3JdYC5cbiAqXG4gKiBPdGhlcndpc2UsIHRoZSBzcGVjaWZpYyBkZWZpbml0aW9ucyB3aWxsIGJlIHJldHVybmVkOiBgYm9yZGVyLSh3aWR0aHxzdHlsZXxjb2xvciktKjogW3ZhbHVlXWAuXG4gKlxuICogQHBhcmFtIHZhbHVlIFN0eWxlcyBpZiBkZWZpbmVkLlxuICogQHBhcmFtIHdoaWNoIFRoZSBib3JkZXIgcG9zaXRpb24uXG4gKi8gZnVuY3Rpb24gcmVkdWNlQm9yZGVyUG9zaXRpb24odmFsdWUsIHdoaWNoKSB7XG4gICAgY29uc3QgYm9yZGVyVHlwZXMgPSBbXTtcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUud2lkdGgpIHtcbiAgICAgICAgYm9yZGVyVHlwZXMucHVzaCgnd2lkdGgnKTtcbiAgICB9XG4gICAgaWYgKHZhbHVlICYmIHZhbHVlLnN0eWxlKSB7XG4gICAgICAgIGJvcmRlclR5cGVzLnB1c2goJ3N0eWxlJyk7XG4gICAgfVxuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5jb2xvcikge1xuICAgICAgICBib3JkZXJUeXBlcy5wdXNoKCdjb2xvcicpO1xuICAgIH1cbiAgICBpZiAoYm9yZGVyVHlwZXMubGVuZ3RoID09IDMpIHtcbiAgICAgICAgY29uc3QgYm9yZGVyVmFsdWUgPSBib3JkZXJUeXBlcy5tYXAoKGl0ZW0pPT52YWx1ZVtpdGVtXSkuam9pbignICcpO1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgd2hpY2ggPT0gJ2FsbCcgPyBbXG4gICAgICAgICAgICAgICAgJ2JvcmRlcicsXG4gICAgICAgICAgICAgICAgYm9yZGVyVmFsdWVcbiAgICAgICAgICAgIF0gOiBbXG4gICAgICAgICAgICAgICAgYGJvcmRlci0ke3doaWNofWAsXG4gICAgICAgICAgICAgICAgYm9yZGVyVmFsdWVcbiAgICAgICAgICAgIF1cbiAgICAgICAgXTtcbiAgICB9XG4gICAgLy8gV2UgYXJlIHVuYWJsZSB0byByZWR1Y2UgdG8gYSBzaW5nbGUgYGJvcmRlcjpgIHByb3BlcnR5LlxuICAgIGlmICh3aGljaCA9PSAnYWxsJykge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBib3JkZXJUeXBlcy5tYXAoKHR5cGUpPT57XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBgYm9yZGVyLSR7d2hpY2h9LSR7dHlwZX1gLFxuICAgICAgICAgICAgdmFsdWVbdHlwZV1cbiAgICAgICAgXTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBBZGRzIGEgbWFyZ2luIENTUyBzdHlsZXMgcHJvY2Vzc2luZyBydWxlcy5cbiAqXG4gKiBgYGB0c1xuICogZWRpdG9yLmRhdGEuYWRkU3R5bGVQcm9jZXNzb3JSdWxlcyggYWRkTWFyZ2luUnVsZXMgKTtcbiAqIGBgYFxuICpcbiAqIFRoZSBub3JtYWxpemVkIHZhbHVlIGlzIHN0b3JlZCBhczpcbiAqXG4gKiBgYGB0c1xuICogY29uc3Qgc3R5bGVzID0ge1xuICogXHRtYXJnaW46IHtcbiAqIFx0XHR0b3AsXG4gKiBcdFx0cmlnaHQsXG4gKiBcdFx0Ym90dG9tLFxuICogXHRcdGxlZnRcbiAqIFx0fVxuICogfTtcbiAqIGBgYFxuICovIGZ1bmN0aW9uIGFkZE1hcmdpblJ1bGVzKHN0eWxlc1Byb2Nlc3Nvcikge1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdtYXJnaW4nLCBnZXRQb3NpdGlvblNob3J0aGFuZE5vcm1hbGl6ZXIoJ21hcmdpbicpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignbWFyZ2luLXRvcCcsICh2YWx1ZSk9Pih7XG4gICAgICAgICAgICBwYXRoOiAnbWFyZ2luLnRvcCcsXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICB9KSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ21hcmdpbi1yaWdodCcsICh2YWx1ZSk9Pih7XG4gICAgICAgICAgICBwYXRoOiAnbWFyZ2luLnJpZ2h0JyxcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgIH0pKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0Tm9ybWFsaXplcignbWFyZ2luLWJvdHRvbScsICh2YWx1ZSk9Pih7XG4gICAgICAgICAgICBwYXRoOiAnbWFyZ2luLmJvdHRvbScsXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICB9KSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ21hcmdpbi1sZWZ0JywgKHZhbHVlKT0+KHtcbiAgICAgICAgICAgIHBhdGg6ICdtYXJnaW4ubGVmdCcsXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICB9KSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ21hcmdpbicsIGdldEJveFNpZGVzVmFsdWVSZWR1Y2VyKCdtYXJnaW4nKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFN0eWxlUmVsYXRpb24oJ21hcmdpbicsIFtcbiAgICAgICAgJ21hcmdpbi10b3AnLFxuICAgICAgICAnbWFyZ2luLXJpZ2h0JyxcbiAgICAgICAgJ21hcmdpbi1ib3R0b20nLFxuICAgICAgICAnbWFyZ2luLWxlZnQnXG4gICAgXSk7XG59XG5cbi8qKlxuICogQWRkcyBhIHBhZGRpbmcgQ1NTIHN0eWxlcyBwcm9jZXNzaW5nIHJ1bGVzLlxuICpcbiAqIGBgYHRzXG4gKiBlZGl0b3IuZGF0YS5hZGRTdHlsZVByb2Nlc3NvclJ1bGVzKCBhZGRQYWRkaW5nUnVsZXMgKTtcbiAqIGBgYFxuICpcbiAqIFRoZSBub3JtYWxpemVkIHZhbHVlIGlzIHN0b3JlZCBhczpcbiAqXG4gKiBgYGB0c1xuICogY29uc3Qgc3R5bGVzID0ge1xuICogXHRwYWRkaW5nOiB7XG4gKiBcdFx0dG9wLFxuICogXHRcdHJpZ2h0LFxuICogXHRcdGJvdHRvbSxcbiAqIFx0XHRsZWZ0XG4gKiBcdH1cbiAqIH07XG4gKiBgYGBcbiAqLyBmdW5jdGlvbiBhZGRQYWRkaW5nUnVsZXMoc3R5bGVzUHJvY2Vzc29yKSB7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ3BhZGRpbmcnLCBnZXRQb3NpdGlvblNob3J0aGFuZE5vcm1hbGl6ZXIoJ3BhZGRpbmcnKSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ3BhZGRpbmctdG9wJywgKHZhbHVlKT0+KHtcbiAgICAgICAgICAgIHBhdGg6ICdwYWRkaW5nLnRvcCcsXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICB9KSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldE5vcm1hbGl6ZXIoJ3BhZGRpbmctcmlnaHQnLCAodmFsdWUpPT4oe1xuICAgICAgICAgICAgcGF0aDogJ3BhZGRpbmcucmlnaHQnLFxuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgfSkpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdwYWRkaW5nLWJvdHRvbScsICh2YWx1ZSk9Pih7XG4gICAgICAgICAgICBwYXRoOiAncGFkZGluZy5ib3R0b20nLFxuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgfSkpO1xuICAgIHN0eWxlc1Byb2Nlc3Nvci5zZXROb3JtYWxpemVyKCdwYWRkaW5nLWxlZnQnLCAodmFsdWUpPT4oe1xuICAgICAgICAgICAgcGF0aDogJ3BhZGRpbmcubGVmdCcsXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICB9KSk7XG4gICAgc3R5bGVzUHJvY2Vzc29yLnNldFJlZHVjZXIoJ3BhZGRpbmcnLCBnZXRCb3hTaWRlc1ZhbHVlUmVkdWNlcigncGFkZGluZycpKTtcbiAgICBzdHlsZXNQcm9jZXNzb3Iuc2V0U3R5bGVSZWxhdGlvbigncGFkZGluZycsIFtcbiAgICAgICAgJ3BhZGRpbmctdG9wJyxcbiAgICAgICAgJ3BhZGRpbmctcmlnaHQnLFxuICAgICAgICAncGFkZGluZy1ib3R0b20nLFxuICAgICAgICAncGFkZGluZy1sZWZ0J1xuICAgIF0pO1xufVxuXG5jb25zdCBFTEVNRU5UX1JBTkdFX1NUQVJUX1RPS0VOID0gJ1snO1xuY29uc3QgRUxFTUVOVF9SQU5HRV9FTkRfVE9LRU4gPSAnXSc7XG5jb25zdCBURVhUX1JBTkdFX1NUQVJUX1RPS0VOID0gJ3snO1xuY29uc3QgVEVYVF9SQU5HRV9FTkRfVE9LRU4gPSAnfSc7XG5jb25zdCBhbGxvd2VkVHlwZXMgPSB7XG4gICAgJ2NvbnRhaW5lcic6IENvbnRhaW5lckVsZW1lbnQsXG4gICAgJ2F0dHJpYnV0ZSc6IEF0dHJpYnV0ZUVsZW1lbnQsXG4gICAgJ2VtcHR5JzogRW1wdHlFbGVtZW50LFxuICAgICd1aSc6IFVJRWxlbWVudCxcbiAgICAncmF3JzogUmF3RWxlbWVudFxufTtcbi8vIFJldHVybnMgc2ltcGxpZmllZCBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIjc2V0Q29udGVudE9mIERvbUNvbnZlcnRlci5zZXRDb250ZW50T2Z9IG1ldGhvZC5cbi8vIFVzZWQgdG8gcmVuZGVyIFVJRWxlbWVudCBhbmQgUmF3RWxlbWVudC5cbmNvbnN0IGRvbUNvbnZlcnRlclN0dWIgPSB7XG4gICAgc2V0Q29udGVudE9mOiAobm9kZSwgaHRtbCk9PntcbiAgICAgICAgbm9kZS5pbm5lckhUTUwgPSBodG1sO1xuICAgIH1cbn07XG4vKipcbiAqIFdyaXRlcyB0aGUgY29udGVudCBvZiB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH0gdG8gYW4gSFRNTC1saWtlIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucy53aXRob3V0U2VsZWN0aW9uIFdoZXRoZXIgdG8gd3JpdGUgdGhlIHNlbGVjdGlvbi4gV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgc2VsZWN0aW9uIHdpbGxcbiAqIG5vdCBiZSBpbmNsdWRlZCBpbiB0aGUgcmV0dXJuZWQgc3RyaW5nLlxuICogQHBhcmFtIG9wdGlvbnMucm9vdE5hbWUgVGhlIG5hbWUgb2YgdGhlIHJvb3QgZnJvbSB3aGljaCB0aGUgZGF0YSBzaG91bGQgYmUgc3RyaW5naWZpZWQuIElmIG5vdCBwcm92aWRlZCxcbiAqIHRoZSBkZWZhdWx0IGBtYWluYCBuYW1lIHdpbGwgYmUgdXNlZC5cbiAqIEBwYXJhbSBvcHRpb25zLnNob3dUeXBlIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIHR5cGUgb2YgZWxlbWVudHMgd2lsbCBiZSBwcmludGVkIChgPGNvbnRhaW5lcjpwPmBcbiAqIGluc3RlYWQgb2YgYDxwPmAsIGA8YXR0cmlidXRlOmI+YCBpbnN0ZWFkIG9mIGA8Yj5gIGFuZCBgPGVtcHR5OmltZz5gIGluc3RlYWQgb2YgYDxpbWc+YCkuXG4gKiBAcGFyYW0gb3B0aW9ucy5zaG93UHJpb3JpdHkgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgYXR0cmlidXRlIGVsZW1lbnQncyBwcmlvcml0eSB3aWxsIGJlIHByaW50ZWRcbiAqIChgPHNwYW4gdmlldy1wcmlvcml0eT1cIjEyXCI+YCwgYDxiIHZpZXctcHJpb3JpdHk9XCIxMFwiPmApLlxuICogQHBhcmFtIG9wdGlvbnMuc2hvd0F0dHJpYnV0ZUVsZW1lbnRJZCBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBhdHRyaWJ1dGUgZWxlbWVudCdzIElEIHdpbGwgYmUgcHJpbnRlZFxuICogKGA8c3BhbiBpZD1cIm1hcmtlcjpmb29cIj5gKS5cbiAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclVJRWxlbWVudHMgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgaW5uZXIgY29udGVudCBvZiBlYWNoXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9IHdpbGwgYmUgcHJpbnRlZC5cbiAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclJhd0VsZW1lbnRzIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIGlubmVyIGNvbnRlbnQgb2YgZWFjaFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYXdlbGVtZW50flJhd0VsZW1lbnR9IHdpbGwgYmUgcHJpbnRlZC5cbiAqIEBwYXJhbSBvcHRpb25zLmRvbUNvbnZlcnRlciBXaGVuIHNldCB0byBhbiBhY3R1YWwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyIERvbUNvbnZlcnRlcn1cbiAqIGluc3RhbmNlLCBpdCBsZXRzIHRoZSBjb252ZXJzaW9uIGdvIHRocm91Z2ggZXhhY3RseSB0aGUgc2FtZSBmbG93IHRoZSBlZGl0aW5nIHZpZXcgaXMgZ29pbmcgdGhyb3VnaCxcbiAqIGkuZS4gd2l0aCB2aWV3IGRhdGEgZmlsdGVyaW5nLiBPdGhlcndpc2UgdGhlIHNpbXBsZSBzdHViIGlzIHVzZWQuXG4gKiBAcmV0dXJucyBUaGUgc3RyaW5naWZpZWQgZGF0YS5cbiAqLyBmdW5jdGlvbiBnZXREYXRhJDEodmlldywgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCEodmlldyBpbnN0YW5jZW9mIFZpZXcpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1ZpZXcgbmVlZHMgdG8gYmUgYW4gaW5zdGFuY2Ugb2YgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXd+Vmlldy4nKTtcbiAgICB9XG4gICAgY29uc3QgZG9jdW1lbnQxID0gdmlldy5kb2N1bWVudDtcbiAgICBjb25zdCB3aXRob3V0U2VsZWN0aW9uID0gISFvcHRpb25zLndpdGhvdXRTZWxlY3Rpb247XG4gICAgY29uc3Qgcm9vdE5hbWUgPSBvcHRpb25zLnJvb3ROYW1lIHx8ICdtYWluJztcbiAgICBjb25zdCByb290ID0gZG9jdW1lbnQxLmdldFJvb3Qocm9vdE5hbWUpO1xuICAgIGNvbnN0IHN0cmluZ2lmeU9wdGlvbnMgPSB7XG4gICAgICAgIHNob3dUeXBlOiBvcHRpb25zLnNob3dUeXBlLFxuICAgICAgICBzaG93UHJpb3JpdHk6IG9wdGlvbnMuc2hvd1ByaW9yaXR5LFxuICAgICAgICByZW5kZXJVSUVsZW1lbnRzOiBvcHRpb25zLnJlbmRlclVJRWxlbWVudHMsXG4gICAgICAgIHJlbmRlclJhd0VsZW1lbnRzOiBvcHRpb25zLnJlbmRlclJhd0VsZW1lbnRzLFxuICAgICAgICBpZ25vcmVSb290OiB0cnVlLFxuICAgICAgICBkb21Db252ZXJ0ZXI6IG9wdGlvbnMuZG9tQ29udmVydGVyXG4gICAgfTtcbiAgICByZXR1cm4gd2l0aG91dFNlbGVjdGlvbiA/IGdldERhdGEkMS5fc3RyaW5naWZ5KHJvb3QsIG51bGwsIHN0cmluZ2lmeU9wdGlvbnMpIDogZ2V0RGF0YSQxLl9zdHJpbmdpZnkocm9vdCwgZG9jdW1lbnQxLnNlbGVjdGlvbiwgc3RyaW5naWZ5T3B0aW9ucyk7XG59XG4vLyBTZXQgc3RyaW5naWZ5IGFzIGdldERhdGEgcHJpdmF0ZSBtZXRob2QgLSBuZWVkZWQgZm9yIHRlc3Rpbmcvc3B5aW5nLlxuZ2V0RGF0YSQxLl9zdHJpbmdpZnkgPSBzdHJpbmdpZnkkMTtcbi8qKlxuICogU2V0cyB0aGUgY29udGVudCBvZiBhIHZpZXcge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH0gcHJvdmlkZWQgYXMgYW4gSFRNTC1saWtlIHN0cmluZy5cbiAqXG4gKiBAcGFyYW0gZGF0YSBBbiBIVE1MLWxpa2Ugc3RyaW5nIHRvIHdyaXRlIGludG8gdGhlIGRvY3VtZW50LlxuICogQHBhcmFtIG9wdGlvbnMucm9vdE5hbWUgVGhlIHJvb3QgbmFtZSB3aGVyZSBwYXJzZWQgZGF0YSB3aWxsIGJlIHN0b3JlZC4gSWYgbm90IHByb3ZpZGVkLFxuICogdGhlIGRlZmF1bHQgYG1haW5gIG5hbWUgd2lsbCBiZSB1c2VkLlxuICovIGZ1bmN0aW9uIHNldERhdGEkMSh2aWV3LCBkYXRhLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoISh2aWV3IGluc3RhbmNlb2YgVmlldykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVmlldyBuZWVkcyB0byBiZSBhbiBpbnN0YW5jZSBvZiBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3LicpO1xuICAgIH1cbiAgICBjb25zdCBkb2N1bWVudDEgPSB2aWV3LmRvY3VtZW50O1xuICAgIGNvbnN0IHJvb3ROYW1lID0gb3B0aW9ucy5yb290TmFtZSB8fCAnbWFpbic7XG4gICAgY29uc3Qgcm9vdCA9IGRvY3VtZW50MS5nZXRSb290KHJvb3ROYW1lKTtcbiAgICB2aWV3LmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZXREYXRhJDEuX3BhcnNlKGRhdGEsIHtcbiAgICAgICAgICAgIHJvb3RFbGVtZW50OiByb290XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocmVzdWx0LnZpZXcgJiYgcmVzdWx0LnNlbGVjdGlvbikge1xuICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihyZXN1bHQuc2VsZWN0aW9uKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLy8gU2V0IHBhcnNlIGFzIHNldERhdGEgcHJpdmF0ZSBtZXRob2QgLSBuZWVkZWQgZm9yIHRlc3Rpbmcvc3B5aW5nLlxuc2V0RGF0YSQxLl9wYXJzZSA9IHBhcnNlJDE7XG4vKipcbiAqIENvbnZlcnRzIHZpZXcgZWxlbWVudHMgdG8gSFRNTC1saWtlIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAqXG4gKiBBIHJvb3QgZWxlbWVudCBjYW4gYmUgcHJvdmlkZWQgYXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dH06XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHRleHQgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnZm9vYmFyJyApO1xuICogc3RyaW5naWZ5KCB0ZXh0ICk7IC8vICdmb29iYXInXG4gKiBgYGBcbiAqXG4gKiBvciBhcyBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fTpcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgZWxlbWVudCA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwJywgbnVsbCwgZG93bmNhc3RXcml0ZXIuY3JlYXRlVGV4dCggJ2Zvb2JhcicgKSApO1xuICogc3RyaW5naWZ5KCBlbGVtZW50ICk7IC8vICc8cD5mb29iYXI8L3A+J1xuICogYGBgXG4gKlxuICogb3IgYXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50ZnJhZ21lbnR+RG9jdW1lbnRGcmFnbWVudCBkb2N1bWVudCBmcmFnbWVudH06XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHRleHQgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnZm9vYmFyJyApO1xuICogY29uc3QgYiA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdiJywgeyBuYW1lOiAndGVzdCcgfSwgdGV4dCApO1xuICogY29uc3QgcCA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUVsZW1lbnQoICdwJywgeyBzdHlsZTogJ2NvbG9yOnJlZDsnIH0gKTtcbiAqIGNvbnN0IGZyYWdtZW50ID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCggWyBwLCBiIF0gKTtcbiAqXG4gKiBzdHJpbmdpZnkoIGZyYWdtZW50ICk7IC8vICc8cCBzdHlsZT1cImNvbG9yOnJlZDtcIj48L3A+PGIgbmFtZT1cInRlc3RcIj5mb29iYXI8L2I+J1xuICogYGBgXG4gKlxuICogQWRkaXRpb25hbGx5LCBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb24gc2VsZWN0aW9ufSBpbnN0YW5jZSBjYW4gYmUgcHJvdmlkZWQuXG4gKiBSYW5nZXMgZnJvbSB0aGUgc2VsZWN0aW9uIHdpbGwgdGhlbiBiZSBpbmNsdWRlZCBpbiB0aGUgb3V0cHV0IGRhdGEuXG4gKiBJZiBhIHJhbmdlIHBvc2l0aW9uIGlzIHBsYWNlZCBpbnNpZGUgdGhlIGVsZW1lbnQgbm9kZSwgaXQgd2lsbCBiZSByZXByZXNlbnRlZCB3aXRoIGBbYCBhbmQgYF1gOlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCB0ZXh0ID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlVGV4dCggJ2Zvb2JhcicgKTtcbiAqIGNvbnN0IGIgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVFbGVtZW50KCAnYicsIG51bGwsIHRleHQgKTtcbiAqIGNvbnN0IHAgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVFbGVtZW50KCAncCcsIG51bGwsIGIgKTtcbiAqIGNvbnN0IHNlbGVjdGlvbiA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVNlbGVjdGlvbihcbiAqIFx0ZG93bmNhc3RXcml0ZXIuY3JlYXRlUmFuZ2VJbiggcCApXG4gKiApO1xuICpcbiAqIHN0cmluZ2lmeSggcCwgc2VsZWN0aW9uICk7IC8vICc8cD5bPGI+Zm9vYmFyPC9iPl08L3A+J1xuICogYGBgXG4gKlxuICogSWYgYSByYW5nZSBpcyBwbGFjZWQgaW5zaWRlIHRoZSB0ZXh0IG5vZGUsIGl0IHdpbGwgYmUgcmVwcmVzZW50ZWQgd2l0aCBge2AgYW5kIGB9YDpcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgdGV4dCA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVRleHQoICdmb29iYXInICk7XG4gKiBjb25zdCBiID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ2InLCBudWxsLCB0ZXh0ICk7XG4gKiBjb25zdCBwID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlRWxlbWVudCggJ3AnLCBudWxsLCBiICk7XG4gKiBjb25zdCBzZWxlY3Rpb24gPSBkb3duY2FzdFdyaXRlci5jcmVhdGVTZWxlY3Rpb24oXG4gKiBcdGRvd25jYXN0V3JpdGVyLmNyZWF0ZVJhbmdlKCBkb3duY2FzdFdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCB0ZXh0LCAxICksIGRvd25jYXN0V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHRleHQsIDUgKSApXG4gKiApO1xuICpcbiAqIHN0cmluZ2lmeSggcCwgc2VsZWN0aW9uICk7IC8vICc8cD48Yj5me29vYmF9cjwvYj48L3A+J1xuICogYGBgXG4gKlxuICogKiogTm90ZTogKipcbiAqIEl0IGlzIHBvc3NpYmxlIHRvIHVuaWZ5IHNlbGVjdGlvbiBtYXJrZXJzIHRvIGBbYCBhbmQgYF1gIGZvciBib3RoIChpbnNpZGUgYW5kIG91dHNpZGUgdGV4dClcbiAqIGJ5IHNldHRpbmcgdGhlIGBzYW1lU2VsZWN0aW9uQ2hhcmFjdGVycz10cnVlYCBvcHRpb24uIEl0IGlzIG1haW5seSB1c2VkIHdoZW4gdGhlIHZpZXcgc3RyaW5naWZ5IG9wdGlvbiBpcyB1c2VkIGJ5XG4gKiBtb2RlbCB1dGlsaXRpZXMuXG4gKlxuICogTXVsdGlwbGUgcmFuZ2VzIGFyZSBzdXBwb3J0ZWQ6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHRleHQgPSBkb3duY2FzdFdyaXRlci5jcmVhdGVUZXh0KCAnZm9vYmFyJyApO1xuICogY29uc3Qgc2VsZWN0aW9uID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlU2VsZWN0aW9uKCBbXG4gKiBcdGRvd25jYXN0V3JpdGVyLmNyZWF0ZVJhbmdlKCBkb3duY2FzdFdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCB0ZXh0LCAwICksIGRvd25jYXN0V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHRleHQsIDEgKSApLFxuICogXHRkb3duY2FzdFdyaXRlci5jcmVhdGVSYW5nZSggZG93bmNhc3RXcml0ZXIuY3JlYXRlUG9zaXRpb25BdCggdGV4dCwgMyApLCBkb3duY2FzdFdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KCB0ZXh0LCA1ICkgKVxuICogXSApO1xuICpcbiAqIHN0cmluZ2lmeSggdGV4dCwgc2VsZWN0aW9uICk7IC8vICd7Zn1vb3tiYX1yJ1xuICogYGBgXG4gKlxuICogQSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlIHJhbmdlfSBvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3Bvc2l0aW9uflBvc2l0aW9uIHBvc2l0aW9ufSBpbnN0YW5jZSBjYW4gYmUgcHJvdmlkZWRcbiAqIGluc3RlYWQgb2YgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb24gc2VsZWN0aW9ufSBpbnN0YW5jZS4gSWYgYSByYW5nZSBpbnN0YW5jZVxuICogaXMgcHJvdmlkZWQsIGl0IHdpbGwgYmUgY29udmVydGVkIHRvIGEgc2VsZWN0aW9uIGNvbnRhaW5pbmcgdGhpcyByYW5nZS4gSWYgYSBwb3NpdGlvbiBpbnN0YW5jZSBpcyBwcm92aWRlZCwgaXQgd2lsbFxuICogYmUgY29udmVydGVkIHRvIGEgc2VsZWN0aW9uIGNvbnRhaW5pbmcgb25lIHJhbmdlIGNvbGxhcHNlZCBhdCB0aGlzIHBvc2l0aW9uLlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCB0ZXh0ID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlVGV4dCggJ2Zvb2JhcicgKTtcbiAqIGNvbnN0IHJhbmdlID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlUmFuZ2UoIGRvd25jYXN0V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHRleHQsIDAgKSwgZG93bmNhc3RXcml0ZXIuY3JlYXRlUG9zaXRpb25BdCggdGV4dCwgMSApICk7XG4gKiBjb25zdCBwb3NpdGlvbiA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoIHRleHQsIDMgKTtcbiAqXG4gKiBzdHJpbmdpZnkoIHRleHQsIHJhbmdlICk7IC8vICd7Zn1vb2JhcidcbiAqIHN0cmluZ2lmeSggdGV4dCwgcG9zaXRpb24gKTsgLy8gJ2Zvb3t9YmFyJ1xuICogYGBgXG4gKlxuICogQW4gYWRkaXRpb25hbCBgb3B0aW9uc2Agb2JqZWN0IGNhbiBiZSBwcm92aWRlZC5cbiAqIElmIGBvcHRpb25zLnNob3dUeXBlYCBpcyBzZXQgdG8gYHRydWVgLCBlbGVtZW50J3MgdHlwZXMgd2lsbCBiZVxuICogcHJlc2VudGVkIGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudHN9LFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnRzfVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IGVtcHR5IGVsZW1lbnRzfVxuICogYW5kIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBVSSBlbGVtZW50c306XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IGF0dHJpYnV0ZSA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoICdiJyApO1xuICogY29uc3QgY29udGFpbmVyID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ3AnICk7XG4gKiBjb25zdCBlbXB0eSA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUVtcHR5RWxlbWVudCggJ2ltZycgKTtcbiAqIGNvbnN0IHVpID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlVUlFbGVtZW50KCAnc3BhbicgKTtcbiAqIGdldERhdGEoIGF0dHJpYnV0ZSwgbnVsbCwgeyBzaG93VHlwZTogdHJ1ZSB9ICk7IC8vICc8YXR0cmlidXRlOmI+PC9hdHRyaWJ1dGU6Yj4nXG4gKiBnZXREYXRhKCBjb250YWluZXIsIG51bGwsIHsgc2hvd1R5cGU6IHRydWUgfSApOyAvLyAnPGNvbnRhaW5lcjpwPjwvY29udGFpbmVyOnA+J1xuICogZ2V0RGF0YSggZW1wdHksIG51bGwsIHsgc2hvd1R5cGU6IHRydWUgfSApOyAvLyAnPGVtcHR5OmltZz48L2VtcHR5OmltZz4nXG4gKiBnZXREYXRhKCB1aSwgbnVsbCwgeyBzaG93VHlwZTogdHJ1ZSB9ICk7IC8vICc8dWk6c3Bhbj48L3VpOnNwYW4+J1xuICogYGBgXG4gKlxuICogSWYgYG9wdGlvbnMuc2hvd1ByaW9yaXR5YCBpcyBzZXQgdG8gYHRydWVgLCBhIHByaW9yaXR5IHdpbGwgYmUgZGlzcGxheWVkIGZvciBhbGxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50c30uXG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IGF0dHJpYnV0ZSA9IGRvd25jYXN0V3JpdGVyLmNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoICdiJyApO1xuICogYXR0cmlidXRlLl9wcmlvcml0eSA9IDIwO1xuICogZ2V0RGF0YSggYXR0cmlidXRlLCBudWxsLCB7IHNob3dQcmlvcml0eTogdHJ1ZSB9ICk7IC8vIDxiIHZpZXctcHJpb3JpdHk9XCIyMFwiPjwvYj5cbiAqIGBgYFxuICpcbiAqIElmIGBvcHRpb25zLnNob3dBdHRyaWJ1dGVFbGVtZW50SWRgIGlzIHNldCB0byBgdHJ1ZWAsIHRoZSBhdHRyaWJ1dGUgZWxlbWVudCdzIGlkIHdpbGwgYmUgZGlzcGxheWVkIGZvciBhbGxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50c30gdGhhdCBoYXZlIGl0IHNldC5cbiAqXG4gKiBgYGB0c1xuICogY29uc3QgYXR0cmlidXRlID0gZG93bmNhc3RXcml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCggJ3NwYW4nICk7XG4gKiBhdHRyaWJ1dGUuX2lkID0gJ21hcmtlcjpmb28nO1xuICogZ2V0RGF0YSggYXR0cmlidXRlLCBudWxsLCB7IHNob3dBdHRyaWJ1dGVFbGVtZW50SWQ6IHRydWUgfSApOyAvLyA8c3BhbiB2aWV3LWlkPVwibWFya2VyOmZvb1wiPjwvc3Bhbj5cbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBub2RlIFRoZSBub2RlIHRvIHN0cmluZ2lmeS5cbiAqIEBwYXJhbSBzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSBBIHNlbGVjdGlvbiBpbnN0YW5jZSB3aG9zZSByYW5nZXMgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmV0dXJuZWQgc3RyaW5nIGRhdGEuXG4gKiBJZiBhIHJhbmdlIGluc3RhbmNlIGlzIHByb3ZpZGVkLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIHNlbGVjdGlvbiBjb250YWluaW5nIHRoaXMgcmFuZ2UuIElmIGEgcG9zaXRpb24gaW5zdGFuY2VcbiAqIGlzIHByb3ZpZGVkLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIHNlbGVjdGlvbiBjb250YWluaW5nIG9uZSByYW5nZSBjb2xsYXBzZWQgYXQgdGhpcyBwb3NpdGlvbi5cbiAqIEBwYXJhbSBvcHRpb25zIEFuIG9iamVjdCB3aXRoIGFkZGl0aW9uYWwgb3B0aW9ucy5cbiAqIEBwYXJhbSBvcHRpb25zLnNob3dUeXBlIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIHR5cGUgb2YgZWxlbWVudHMgd2lsbCBiZSBwcmludGVkIChgPGNvbnRhaW5lcjpwPmBcbiAqIGluc3RlYWQgb2YgYDxwPmAsIGA8YXR0cmlidXRlOmI+YCBpbnN0ZWFkIG9mIGA8Yj5gIGFuZCBgPGVtcHR5OmltZz5gIGluc3RlYWQgb2YgYDxpbWc+YCkuXG4gKiBAcGFyYW0gb3B0aW9ucy5zaG93UHJpb3JpdHkgV2hlbiBzZXQgdG8gYHRydWVgLCAgdGhlIGF0dHJpYnV0ZSBlbGVtZW50J3MgcHJpb3JpdHkgd2lsbCBiZSBwcmludGVkXG4gKiAoYDxzcGFuIHZpZXctcHJpb3JpdHk9XCIxMlwiPmAsIGA8YiB2aWV3LXByaW9yaXR5PVwiMTBcIj5gKS5cbiAqIEBwYXJhbSBvcHRpb25zLnNob3dBdHRyaWJ1dGVFbGVtZW50SWQgV2hlbiBzZXQgdG8gYHRydWVgLCBhdHRyaWJ1dGUgZWxlbWVudCdzIGlkIHdpbGwgYmUgcHJpbnRlZFxuICogKGA8c3BhbiBpZD1cIm1hcmtlcjpmb29cIj5gKS5cbiAqIEBwYXJhbSBvcHRpb25zLmlnbm9yZVJvb3QgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgcm9vdCdzIGVsZW1lbnQgb3BlbmluZyBhbmQgY2xvc2luZyB3aWxsIG5vdCBiZSBwcmludGVkLlxuICogTWFpbmx5IHVzZWQgYnkgdGhlIGBnZXREYXRhYCBmdW5jdGlvbiB0byBpZ25vcmUgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQgZG9jdW1lbnQnc30gcm9vdCBlbGVtZW50LlxuICogQHBhcmFtIG9wdGlvbnMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnMgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgc2VsZWN0aW9uIGluc2lkZSB0aGUgdGV4dCB3aWxsIGJlIG1hcmtlZCBhc1xuICogIGB7YCBhbmQgYH1gIGFuZCB0aGUgc2VsZWN0aW9uIG91dHNpZGUgdGhlIHRleHQgYXMgYFtgIGFuZCBgXWAuIFdoZW4gc2V0IHRvIGBmYWxzZWAsIGJvdGggd2lsbCBiZSBtYXJrZWQgYXMgYFtgIGFuZCBgXWAgb25seS5cbiAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclVJRWxlbWVudHMgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgaW5uZXIgY29udGVudCBvZiBlYWNoXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnR9IHdpbGwgYmUgcHJpbnRlZC5cbiAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclJhd0VsZW1lbnRzIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIGlubmVyIGNvbnRlbnQgb2YgZWFjaFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYXdlbGVtZW50flJhd0VsZW1lbnR9IHdpbGwgYmUgcHJpbnRlZC5cbiAqIEBwYXJhbSBvcHRpb25zLmRvbUNvbnZlcnRlciBXaGVuIHNldCB0byBhbiBhY3R1YWwge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb21jb252ZXJ0ZXJ+RG9tQ29udmVydGVyIERvbUNvbnZlcnRlcn1cbiAqIGluc3RhbmNlLCBpdCBsZXRzIHRoZSBjb252ZXJzaW9uIGdvIHRocm91Z2ggZXhhY3RseSB0aGUgc2FtZSBmbG93IHRoZSBlZGl0aW5nIHZpZXcgaXMgZ29pbmcgdGhyb3VnaCxcbiAqIGkuZS4gd2l0aCB2aWV3IGRhdGEgZmlsdGVyaW5nLiBPdGhlcndpc2UgdGhlIHNpbXBsZSBzdHViIGlzIHVzZWQuXG4gKiBAcmV0dXJucyBBbiBIVE1MLWxpa2Ugc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmlldy5cbiAqLyBmdW5jdGlvbiBzdHJpbmdpZnkkMShub2RlLCBzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSA9IG51bGwsIG9wdGlvbnMgPSB7fSkge1xuICAgIGxldCBzZWxlY3Rpb247XG4gICAgaWYgKHNlbGVjdGlvbk9yUG9zaXRpb25PclJhbmdlIGluc3RhbmNlb2YgUG9zaXRpb24kMSB8fCBzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSBpbnN0YW5jZW9mIFJhbmdlJDEpIHtcbiAgICAgICAgc2VsZWN0aW9uID0gbmV3IERvY3VtZW50U2VsZWN0aW9uJDEoc2VsZWN0aW9uT3JQb3NpdGlvbk9yUmFuZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdGlvbiA9IHNlbGVjdGlvbk9yUG9zaXRpb25PclJhbmdlO1xuICAgIH1cbiAgICBjb25zdCB2aWV3U3RyaW5naWZ5ID0gbmV3IFZpZXdTdHJpbmdpZnkobm9kZSwgc2VsZWN0aW9uLCBvcHRpb25zKTtcbiAgICByZXR1cm4gdmlld1N0cmluZ2lmeS5zdHJpbmdpZnkoKTtcbn1cbi8qKlxuICogUGFyc2VzIGFuIEhUTUwtbGlrZSBzdHJpbmcgYW5kIHJldHVybnMgYSB2aWV3IHRyZWUuXG4gKiBBIHNpbXBsZSBzdHJpbmcgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0fSBub2RlOlxuICpcbiAqIGBgYHRzXG4gKiBwYXJzZSggJ2Zvb2JhcicgKTsgLy8gUmV0dXJucyBhbiBpbnN0YW5jZSBvZiB0ZXh0LlxuICogYGBgXG4gKlxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgRWxlbWVudHN9IHdpbGwgYmUgcGFyc2VkIHdpdGggYXR0cmlidXRlcyBhcyBjaGlsZHJlbjpcbiAqXG4gKiBgYGB0c1xuICogcGFyc2UoICc8YiBuYW1lPVwiYmF6XCI+Zm9vYmFyPC9iPicgKTsgLy8gUmV0dXJucyBhbiBpbnN0YW5jZSBvZiBlbGVtZW50IHdpdGggdGhlIGBiYXpgIGF0dHJpYnV0ZSBhbmQgYSB0ZXh0IGNoaWxkIG5vZGUuXG4gKiBgYGBcbiAqXG4gKiBNdWx0aXBsZSBub2RlcyBwcm92aWRlZCBvbiByb290IGxldmVsIHdpbGwgYmUgY29udmVydGVkIHRvIGFcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRmcmFnbWVudH5Eb2N1bWVudEZyYWdtZW50IGRvY3VtZW50IGZyYWdtZW50fTpcbiAqXG4gKiBgYGB0c1xuICogcGFyc2UoICc8Yj5mb288L2I+PGk+YmFyPC9pPicgKTsgLy8gUmV0dXJucyBhIGRvY3VtZW50IGZyYWdtZW50IHdpdGggdHdvIGNoaWxkIGVsZW1lbnRzLlxuICogYGBgXG4gKlxuICogVGhlIG1ldGhvZCBjYW4gcGFyc2UgbXVsdGlwbGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSByYW5nZXN9IHByb3ZpZGVkIGluIHN0cmluZyBkYXRhIGFuZCByZXR1cm4gYVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudHNlbGVjdGlvbn5Eb2N1bWVudFNlbGVjdGlvbiBzZWxlY3Rpb259IGluc3RhbmNlIGNvbnRhaW5pbmcgdGhlc2UgcmFuZ2VzLiBSYW5nZXMgcGxhY2VkIGluc2lkZVxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy90ZXh0flRleHQgdGV4dH0gbm9kZXMgc2hvdWxkIGJlIG1hcmtlZCB1c2luZyBge2AgYW5kIGB9YCBicmFja2V0czpcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgeyB0ZXh0LCBzZWxlY3Rpb24gfSA9IHBhcnNlKCAnZntvb2JhfXInICk7XG4gKiBgYGBcbiAqXG4gKiBSYW5nZXMgcGxhY2VkIG91dHNpZGUgdGV4dCBub2RlcyBzaG91bGQgYmUgbWFya2VkIHVzaW5nIGBbYCBhbmQgYF1gIGJyYWNrZXRzOlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCB7IHJvb3QsIHNlbGVjdGlvbiB9ID0gcGFyc2UoICc8cD5bPGI+Zm9vYmFyPC9iPl08L3A+JyApO1xuICogYGBgXG4gKlxuICogKiogTm90ZTogKipcbiAqIEl0IGlzIHBvc3NpYmxlIHRvIHVuaWZ5IHNlbGVjdGlvbiBtYXJrZXJzIHRvIGBbYCBhbmQgYF1gIGZvciBib3RoIChpbnNpZGUgYW5kIG91dHNpZGUgdGV4dClcbiAqIGJ5IHNldHRpbmcgYHNhbWVTZWxlY3Rpb25DaGFyYWN0ZXJzPXRydWVgIG9wdGlvbi4gSXQgaXMgbWFpbmx5IHVzZWQgd2hlbiB0aGUgdmlldyBwYXJzZSBvcHRpb24gaXMgdXNlZCBieSBtb2RlbCB1dGlsaXRpZXMuXG4gKlxuICogU29tZXRpbWVzIHRoZXJlIGlzIGEgbmVlZCBmb3IgZGVmaW5pbmcgdGhlIG9yZGVyIG9mIHJhbmdlcyBpbnNpZGUgdGhlIGNyZWF0ZWQgc2VsZWN0aW9uLiBUaGlzIGNhbiBiZSBhY2hpZXZlZCBieSBwcm92aWRpbmdcbiAqIHRoZSByYW5nZSBvcmRlciBhcnJheSBhcyBhbiBhZGRpdGlvbmFsIHBhcmFtZXRlcjpcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgeyByb290LCBzZWxlY3Rpb24gfSA9IHBhcnNlKCAne2ZvfW9ie2FyfXtiYX16JywgeyBvcmRlcjogWyAyLCAzLCAxIF0gfSApO1xuICogYGBgXG4gKlxuICogSW4gdGhlIGV4YW1wbGUgYWJvdmUsIHRoZSBmaXJzdCByYW5nZSAoYHtmb31gKSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBzZWxlY3Rpb24gYXMgdGhlIHNlY29uZCBvbmUsIHRoZSBzZWNvbmQgcmFuZ2UgKGB7YXJ9YCkgd2lsbCBiZVxuICogYWRkZWQgYXMgdGhlIHRoaXJkIGFuZCB0aGUgdGhpcmQgcmFuZ2UgKGB7YmF9YCkgd2lsbCBiZSBhZGRlZCBhcyB0aGUgZmlyc3Qgb25lLlxuICpcbiAqIElmIHRoZSBzZWxlY3Rpb24ncyBsYXN0IHJhbmdlIHNob3VsZCBiZSBhZGRlZCBhcyBhIGJhY2t3YXJkIG9uZVxuICogKHNvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uI2FuY2hvciBzZWxlY3Rpb24gYW5jaG9yfSBpcyByZXByZXNlbnRlZFxuICogYnkgdGhlIGBlbmRgIHBvc2l0aW9uIGFuZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uI2ZvY3VzIHNlbGVjdGlvbiBmb2N1c30gaXNcbiAqIHJlcHJlc2VudGVkIGJ5IHRoZSBgc3RhcnRgIHBvc2l0aW9uKSwgdXNlIHRoZSBgbGFzdFJhbmdlQmFja3dhcmRgIGZsYWc6XG4gKlxuICogYGBgdHNcbiAqIGNvbnN0IHsgcm9vdCwgc2VsZWN0aW9uIH0gPSBwYXJzZSggYHtmb299YmFye2Jhen1gLCB7IGxhc3RSYW5nZUJhY2t3YXJkOiB0cnVlIH0gKTtcbiAqIGBgYFxuICpcbiAqIFNvbWUgbW9yZSBleGFtcGxlcyBhbmQgZWRnZSBjYXNlczpcbiAqXG4gKiBgYGB0c1xuICogLy8gUmV0dXJucyBhbiBlbXB0eSBkb2N1bWVudCBmcmFnbWVudC5cbiAqIHBhcnNlKCAnJyApO1xuICpcbiAqIC8vIFJldHVybnMgYW4gZW1wdHkgZG9jdW1lbnQgZnJhZ21lbnQgYW5kIGEgY29sbGFwc2VkIHNlbGVjdGlvbi5cbiAqIGNvbnN0IHsgcm9vdCwgc2VsZWN0aW9uIH0gPSBwYXJzZSggJ1tdJyApO1xuICpcbiAqIC8vIFJldHVybnMgYW4gZWxlbWVudCBhbmQgYSBzZWxlY3Rpb24gdGhhdCBpcyBwbGFjZWQgaW5zaWRlIHRoZSBkb2N1bWVudCBmcmFnbWVudCBjb250YWluaW5nIHRoYXQgZWxlbWVudC5cbiAqIGNvbnN0IHsgcm9vdCwgc2VsZWN0aW9uIH0gPSBwYXJzZSggJ1s8YT48L2E+XScgKTtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBkYXRhIEFuIEhUTUwtbGlrZSBzdHJpbmcgdG8gYmUgcGFyc2VkLlxuICogQHBhcmFtIG9wdGlvbnMub3JkZXIgQW4gYXJyYXkgd2l0aCB0aGUgb3JkZXIgb2YgcGFyc2VkIHJhbmdlcyBhZGRlZCB0byB0aGUgcmV0dXJuZWRcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnRzZWxlY3Rpb25+RG9jdW1lbnRTZWxlY3Rpb24gU2VsZWN0aW9ufSBpbnN0YW5jZS4gRWFjaCBlbGVtZW50IHNob3VsZCByZXByZXNlbnQgdGhlXG4gKiBkZXNpcmVkIHBvc2l0aW9uIG9mIGVhY2ggcmFuZ2UgaW4gdGhlIHNlbGVjdGlvbiBpbnN0YW5jZS4gRm9yIGV4YW1wbGU6IGBbMiwgMywgMV1gIG1lYW5zIHRoYXQgdGhlIGZpcnN0IHJhbmdlIHdpbGwgYmVcbiAqIHBsYWNlZCBhcyB0aGUgc2Vjb25kLCB0aGUgc2Vjb25kIGFzIHRoZSB0aGlyZCBhbmQgdGhlIHRoaXJkIGFzIHRoZSBmaXJzdC5cbiAqIEBwYXJhbSBvcHRpb25zLmxhc3RSYW5nZUJhY2t3YXJkIElmIHNldCB0byBgdHJ1ZWAsIHRoZSBsYXN0IHJhbmdlIHdpbGwgYmUgYWRkZWQgYXMgYmFja3dhcmQgdG8gdGhlIHJldHVybmVkXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50c2VsZWN0aW9ufkRvY3VtZW50U2VsZWN0aW9uIHNlbGVjdGlvbn0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gb3B0aW9ucy5yb290RWxlbWVudCBUaGUgZGVmYXVsdCByb290IHRvIHVzZSB3aGVuIHBhcnNpbmcgZWxlbWVudHMuXG4gKiBXaGVuIHNldCB0byBgbnVsbGAsIHRoZSByb290IGVsZW1lbnQgd2lsbCBiZSBjcmVhdGVkIGF1dG9tYXRpY2FsbHkuIElmIHNldCB0b1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgRWxlbWVudH0gb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudGZyYWdtZW50fkRvY3VtZW50RnJhZ21lbnQgRG9jdW1lbnRGcmFnbWVudH0sXG4gKiB0aGlzIG5vZGUgd2lsbCBiZSB1c2VkIGFzIHRoZSByb290IGZvciBhbGwgcGFyc2VkIG5vZGVzLlxuICogQHBhcmFtIG9wdGlvbnMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnMgV2hlbiBzZXQgdG8gYGZhbHNlYCwgdGhlIHNlbGVjdGlvbiBpbnNpZGUgdGhlIHRleHQgc2hvdWxkIGJlIG1hcmtlZCB1c2luZ1xuICogYHtgIGFuZCBgfWAgYW5kIHRoZSBzZWxlY3Rpb24gb3V0c2lkZSB0aGUgZXh0IHVzaW5nIGBbYCBhbmQgYF1gLiBXaGVuIHNldCB0byBgdHJ1ZWAsIGJvdGggc2hvdWxkIGJlIG1hcmtlZCB3aXRoIGBbYCBhbmQgYF1gIG9ubHkuXG4gKiBAcGFyYW0gb3B0aW9ucy5zdHlsZXNQcm9jZXNzb3IgU3R5bGVzIHByb2Nlc3Nvci5cbiAqIEByZXR1cm5zIFJldHVybnMgdGhlIHBhcnNlZCB2aWV3IG5vZGUgb3IgYW4gb2JqZWN0IHdpdGggdHdvIGZpZWxkczogYHZpZXdgIGFuZCBgc2VsZWN0aW9uYCB3aGVuIHNlbGVjdGlvbiByYW5nZXMgd2VyZSBpbmNsdWRlZCBpbiB0aGVcbiAqIGRhdGEgdG8gcGFyc2UuXG4gKi8gZnVuY3Rpb24gcGFyc2UkMShkYXRhLCBvcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB2aWV3RG9jdW1lbnQgPSBuZXcgRG9jdW1lbnQkMShuZXcgU3R5bGVzUHJvY2Vzc29yKCkpO1xuICAgIG9wdGlvbnMub3JkZXIgPSBvcHRpb25zLm9yZGVyIHx8IFtdO1xuICAgIGNvbnN0IHJhbmdlUGFyc2VyID0gbmV3IFJhbmdlUGFyc2VyKHtcbiAgICAgICAgc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnM6IG9wdGlvbnMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnNcbiAgICB9KTtcbiAgICBjb25zdCBwcm9jZXNzb3IgPSBuZXcgWG1sRGF0YVByb2Nlc3Nvcih2aWV3RG9jdW1lbnQsIHtcbiAgICAgICAgbmFtZXNwYWNlczogT2JqZWN0LmtleXMoYWxsb3dlZFR5cGVzKVxuICAgIH0pO1xuICAgIGlmIChvcHRpb25zLmlubGluZU9iamVjdEVsZW1lbnRzKSB7XG4gICAgICAgIHByb2Nlc3Nvci5kb21Db252ZXJ0ZXIuaW5saW5lT2JqZWN0RWxlbWVudHMucHVzaCguLi5vcHRpb25zLmlubGluZU9iamVjdEVsZW1lbnRzKTtcbiAgICB9XG4gICAgLy8gQ29udmVydCBkYXRhIHRvIHZpZXcuXG4gICAgbGV0IHZpZXcgPSBwcm9jZXNzb3IudG9WaWV3KGRhdGEpO1xuICAgIC8vIEF0IHRoaXMgcG9pbnQgd2UgaGF2ZSBhIHZpZXcgdHJlZSB3aXRoIEVsZW1lbnRzIHRoYXQgY291bGQgaGF2ZSBuYW1lcyBsaWtlIGBhdHRyaWJ1dGU6YjoxYC4gSW4gdGhlIG5leHQgc3RlcFxuICAgIC8vIHdlIG5lZWQgdG8gcGFyc2UgRWxlbWVudCdzIG5hbWVzIGFuZCBjb252ZXJ0IHRoZW0gdG8gQXR0cmlidXRlRWxlbWVudHMgYW5kIENvbnRhaW5lckVsZW1lbnRzLlxuICAgIHZpZXcgPSBfY29udmVydFZpZXdFbGVtZW50cyh2aWV3KTtcbiAgICAvLyBJZiBjdXN0b20gcm9vdCBpcyBwcm92aWRlZCAtIG1vdmUgYWxsIG5vZGVzIHRoZXJlLlxuICAgIGlmIChvcHRpb25zLnJvb3RFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHJvb3QgPSBvcHRpb25zLnJvb3RFbGVtZW50O1xuICAgICAgICBjb25zdCBub2RlcyA9IHZpZXcuX3JlbW92ZUNoaWxkcmVuKDAsIHZpZXcuY2hpbGRDb3VudCk7XG4gICAgICAgIHJvb3QuX3JlbW92ZUNoaWxkcmVuKDAsIHJvb3QuY2hpbGRDb3VudCk7XG4gICAgICAgIHJvb3QuX2FwcGVuZENoaWxkKG5vZGVzKTtcbiAgICAgICAgdmlldyA9IHJvb3Q7XG4gICAgfVxuICAgIC8vIFBhcnNlIHJhbmdlcyBpbmNsdWRlZCBpbiB2aWV3IHRleHQgbm9kZXMuXG4gICAgY29uc3QgcmFuZ2VzID0gcmFuZ2VQYXJzZXIucGFyc2Uodmlldywgb3B0aW9ucy5vcmRlcik7XG4gICAgLy8gSWYgb25seSBvbmUgZWxlbWVudCBpcyByZXR1cm5lZCBpbnNpZGUgRG9jdW1lbnRGcmFnbWVudCAtIHJldHVybiB0aGF0IGVsZW1lbnQuXG4gICAgaWYgKHZpZXcuaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSAmJiB2aWV3LmNoaWxkQ291bnQgPT09IDEpIHtcbiAgICAgICAgdmlldyA9IHZpZXcuZ2V0Q2hpbGQoMCk7XG4gICAgfVxuICAgIC8vIFdoZW4gcmFuZ2VzIGFyZSBwcmVzZW50IC0gcmV0dXJuIG9iamVjdCBjb250YWluaW5nIHZpZXcsIGFuZCBzZWxlY3Rpb24uXG4gICAgaWYgKHJhbmdlcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gbmV3IERvY3VtZW50U2VsZWN0aW9uJDEocmFuZ2VzLCB7XG4gICAgICAgICAgICBiYWNrd2FyZDogISFvcHRpb25zLmxhc3RSYW5nZUJhY2t3YXJkXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmlldyxcbiAgICAgICAgICAgIHNlbGVjdGlvblxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBJZiBzaW5nbGUgZWxlbWVudCBpcyByZXR1cm5lZCB3aXRob3V0IHNlbGVjdGlvbiAtIHJlbW92ZSBpdCBmcm9tIHBhcmVudCBhbmQgcmV0dXJuIGRldGFjaGVkIGVsZW1lbnQuXG4gICAgaWYgKHZpZXcucGFyZW50KSB7XG4gICAgICAgIHZpZXcuX3JlbW92ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdmlldztcbn1cbi8qKlxuICogUHJpdmF0ZSBoZWxwZXIgY2xhc3MgdXNlZCBmb3IgY29udmVydGluZyByYW5nZXMgcmVwcmVzZW50ZWQgYXMgdGV4dCBpbnNpZGUgdmlldyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3RleHR+VGV4dCB0ZXh0IG5vZGVzfS5cbiAqLyBjbGFzcyBSYW5nZVBhcnNlciB7XG4gICAgc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnM7XG4gICAgX3Bvc2l0aW9ucztcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIHJhbmdlIHBhcnNlciBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnMgVGhlIHJhbmdlIHBhcnNlciBjb25maWd1cmF0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zYW1lU2VsZWN0aW9uQ2hhcmFjdGVycyBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBzZWxlY3Rpb24gaW5zaWRlIHRoZSB0ZXh0IGlzIG1hcmtlZCBhc1xuXHQgKiBge2AgYW5kIGB9YCBhbmQgdGhlIHNlbGVjdGlvbiBvdXRzaWRlIHRoZSB0ZXh0IGFzIGBbYCBhbmQgYF1gLiBXaGVuIHNldCB0byBgZmFsc2VgLCBib3RoIGFyZSBtYXJrZWQgYXMgYFtgIGFuZCBgXWAuXG5cdCAqLyBjb25zdHJ1Y3RvcihvcHRpb25zKXtcbiAgICAgICAgdGhpcy5zYW1lU2VsZWN0aW9uQ2hhcmFjdGVycyA9ICEhb3B0aW9ucy5zYW1lU2VsZWN0aW9uQ2hhcmFjdGVycztcbiAgICB9XG4gICAgLyoqXG5cdCAqIFBhcnNlcyB0aGUgdmlldyBhbmQgcmV0dXJucyByYW5nZXMgcmVwcmVzZW50ZWQgaW5zaWRlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdGV4dH5UZXh0IHRleHQgbm9kZXN9LlxuXHQgKiBUaGUgbWV0aG9kIHdpbGwgcmVtb3ZlIGFsbCBvY2N1cnJlbmNlcyBvZiBge2AsIGB9YCwgYFtgIGFuZCBgXWAgZnJvbSBmb3VuZCB0ZXh0IG5vZGVzLiBJZiBhIHRleHQgbm9kZSBpcyBlbXB0eSBhZnRlclxuXHQgKiB0aGUgcHJvY2VzcywgaXQgd2lsbCBiZSByZW1vdmVkLCB0b28uXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIFRoZSBzdGFydGluZyBub2RlLlxuXHQgKiBAcGFyYW0gb3JkZXIgVGhlIG9yZGVyIG9mIHJhbmdlcy4gRWFjaCBlbGVtZW50IHNob3VsZCByZXByZXNlbnQgdGhlIGRlc2lyZWQgcG9zaXRpb24gb2YgdGhlIHJhbmdlIGFmdGVyXG5cdCAqIHNvcnRpbmcuIEZvciBleGFtcGxlOiBgWzIsIDMsIDFdYCBtZWFucyB0aGF0IHRoZSBmaXJzdCByYW5nZSB3aWxsIGJlIHBsYWNlZCBhcyB0aGUgc2Vjb25kLCB0aGUgc2Vjb25kIGFzIHRoZSB0aGlyZCBhbmQgdGhlIHRoaXJkXG5cdCAqIGFzIHRoZSBmaXJzdC5cblx0ICogQHJldHVybnMgQW4gYXJyYXkgd2l0aCByYW5nZXMgZm91bmQuXG5cdCAqLyBwYXJzZShub2RlLCBvcmRlcikge1xuICAgICAgICB0aGlzLl9wb3NpdGlvbnMgPSBbXTtcbiAgICAgICAgLy8gUmVtb3ZlIGFsbCByYW5nZSBicmFja2V0cyBmcm9tIHZpZXcgbm9kZXMgYW5kIHNhdmUgdGhlaXIgcG9zaXRpb25zLlxuICAgICAgICB0aGlzLl9nZXRQb3NpdGlvbnMobm9kZSk7XG4gICAgICAgIC8vIENyZWF0ZSByYW5nZXMgdXNpbmcgZ2F0aGVyZWQgcG9zaXRpb25zLlxuICAgICAgICBsZXQgcmFuZ2VzID0gdGhpcy5fY3JlYXRlUmFuZ2VzKCk7XG4gICAgICAgIC8vIFNvcnQgcmFuZ2VzIGlmIG5lZWRlZC5cbiAgICAgICAgaWYgKG9yZGVyLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKG9yZGVyLmxlbmd0aCAhPSByYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQYXJzZSBlcnJvciAtIHRoZXJlIGFyZSAke3Jhbmdlcy5sZW5ndGh9IHJhbmdlcyBmb3VuZCwgYnV0IHJhbmdlcyBvcmRlciBhcnJheSBjb250YWlucyAke29yZGVyLmxlbmd0aH0gZWxlbWVudHMuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByYW5nZXMgPSB0aGlzLl9zb3J0UmFuZ2VzKHJhbmdlcywgb3JkZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHYXRoZXJzIHBvc2l0aW9ucyBvZiBicmFja2V0cyBpbnNpZGUgdGhlIHZpZXcgdHJlZSBzdGFydGluZyBmcm9tIHRoZSBwcm92aWRlZCBub2RlLiBUaGUgbWV0aG9kIHdpbGwgcmVtb3ZlIGFsbCBvY2N1cnJlbmNlcyBvZlxuXHQgKiBge2AsIGB9YCwgYFtgIGFuZCBgXWAgZnJvbSBmb3VuZCB0ZXh0IG5vZGVzLiBJZiBhIHRleHQgbm9kZSBpcyBlbXB0eSBhZnRlciB0aGUgcHJvY2VzcywgaXQgd2lsbCBiZSByZW1vdmVkLCB0b28uXG5cdCAqXG5cdCAqIEBwYXJhbSBub2RlIFN0YXJpbmcgbm9kZS5cblx0ICovIF9nZXRQb3NpdGlvbnMobm9kZSkge1xuICAgICAgICBpZiAobm9kZS5pcygnZG9jdW1lbnRGcmFnbWVudCcpIHx8IG5vZGUuaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgLy8gQ29weSBlbGVtZW50cyBpbnRvIHRoZSBhcnJheSwgd2hlbiBub2RlcyB3aWxsIGJlIHJlbW92ZWQgZnJvbSBwYXJlbnQgbm9kZSB0aGlzIGFycmF5IHdpbGwgc3RpbGwgaGF2ZSBhbGwgdGhlXG4gICAgICAgICAgICAvLyBpdGVtcyBuZWVkZWQgZm9yIGl0ZXJhdGlvbi5cbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW1xuICAgICAgICAgICAgICAgIC4uLm5vZGUuZ2V0Q2hpbGRyZW4oKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW4pe1xuICAgICAgICAgICAgICAgIHRoaXMuX2dldFBvc2l0aW9ucyhjaGlsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2V4cCA9IG5ldyBSZWdFeHAoYFske1RFWFRfUkFOR0VfU1RBUlRfVE9LRU59JHtURVhUX1JBTkdFX0VORF9UT0tFTn1cXFxcJHtFTEVNRU5UX1JBTkdFX0VORF9UT0tFTn1cXFxcJHtFTEVNRU5UX1JBTkdFX1NUQVJUX1RPS0VOfV1gLCAnZycpO1xuICAgICAgICAgICAgbGV0IHRleHQgPSBub2RlLmRhdGE7XG4gICAgICAgICAgICBsZXQgbWF0Y2g7XG4gICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICAgICAgICAgIGNvbnN0IGJyYWNrZXRzID0gW107XG4gICAgICAgICAgICAvLyBSZW1vdmUgYnJhY2tldHMgZnJvbSB0ZXh0IGFuZCBzdG9yZSBpbmZvIGFib3V0IG9mZnNldCBpbnNpZGUgdGV4dCBub2RlLlxuICAgICAgICAgICAgd2hpbGUobWF0Y2ggPSByZWdleHAuZXhlYyh0ZXh0KSl7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBtYXRjaC5pbmRleDtcbiAgICAgICAgICAgICAgICBjb25zdCBicmFja2V0ID0gbWF0Y2hbMF07XG4gICAgICAgICAgICAgICAgYnJhY2tldHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGJyYWNrZXQsXG4gICAgICAgICAgICAgICAgICAgIHRleHRPZmZzZXQ6IGluZGV4IC0gb2Zmc2V0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgb2Zmc2V0Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHJlZ2V4cCwgJycpO1xuICAgICAgICAgICAgbm9kZS5fZGF0YSA9IHRleHQ7XG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IG5vZGUuaW5kZXg7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgICAgICAgICAgIC8vIFJlbW92ZSBlbXB0eSB0ZXh0IG5vZGVzLlxuICAgICAgICAgICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgICAgICAgICAgbm9kZS5fcmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYnJhY2tldHMpe1xuICAgICAgICAgICAgICAgIC8vIE5vbi1lbXB0eSB0ZXh0IG5vZGUuXG4gICAgICAgICAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnMgfHwgIXRoaXMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnMgJiYgKGl0ZW0uYnJhY2tldCA9PSBURVhUX1JBTkdFX1NUQVJUX1RPS0VOIHx8IGl0ZW0uYnJhY2tldCA9PSBURVhUX1JBTkdFX0VORF9UT0tFTikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRleHQgcmFuZ2UgZGVsaW1pdGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyYWNrZXQ6IGl0ZW0uYnJhY2tldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IFBvc2l0aW9uJDEobm9kZSwgaXRlbS50ZXh0T2Zmc2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBlbGVtZW50IHJhbmdlIGRlbGltaXRlciBpcyBub3QgcGxhY2VkIGluc2lkZSB0ZXh0IG5vZGUuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnMgJiYgaXRlbS50ZXh0T2Zmc2V0ICE9PSAwICYmIGl0ZW0udGV4dE9mZnNldCAhPT0gdGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhcnNlIGVycm9yIC0gcmFuZ2UgZGVsaW1pdGVyICcke2l0ZW0uYnJhY2tldH0nIGlzIHBsYWNlZCBpbnNpZGUgdGV4dCBub2RlLmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYnJhY2tldCBpcyBwbGFjZWQgYXQgdGhlIGVuZCBvZiB0aGUgdGV4dCBub2RlIC0gaXQgc2hvdWxkIGJlIHBvc2l0aW9uZWQgYWZ0ZXIgaXQuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpdGVtLnRleHRPZmZzZXQgPT09IDAgPyBpbmRleCA6IGluZGV4ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IGVsZW1lbnQgcmFuZ2UgZGVsaW1pdGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyYWNrZXQ6IGl0ZW0uYnJhY2tldCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IFBvc2l0aW9uJDEocGFyZW50LCBvZmZzZXQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zYW1lU2VsZWN0aW9uQ2hhcmFjdGVycyAmJiBpdGVtLmJyYWNrZXQgPT0gVEVYVF9SQU5HRV9TVEFSVF9UT0tFTiB8fCBpdGVtLmJyYWNrZXQgPT0gVEVYVF9SQU5HRV9FTkRfVE9LRU4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGFyc2UgZXJyb3IgLSB0ZXh0IHJhbmdlIGRlbGltaXRlciAnJHtpdGVtLmJyYWNrZXR9JyBpcyBwbGFjZWQgaW5zaWRlIGVtcHR5IHRleHQgbm9kZS4gYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmUgaW5mb3JtYXRpb24gYWJvdXQgZWxlbWVudCByYW5nZSBkZWxpbWl0ZXIuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyYWNrZXQ6IGl0ZW0uYnJhY2tldCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgUG9zaXRpb24kMShwYXJlbnQsIGluZGV4KVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFNvcnRzIHJhbmdlcyBpbiBhIGdpdmVuIG9yZGVyLiBSYW5nZSBvcmRlciBzaG91bGQgYmUgYW4gYXJyYXkgYW5kIGVhY2ggZWxlbWVudCBzaG91bGQgcmVwcmVzZW50IHRoZSBkZXNpcmVkIHBvc2l0aW9uXG5cdCAqIG9mIHRoZSByYW5nZSBhZnRlciBzb3J0aW5nLlxuXHQgKiBGb3IgZXhhbXBsZTogYFsyLCAzLCAxXWAgbWVhbnMgdGhhdCB0aGUgZmlyc3QgcmFuZ2Ugd2lsbCBiZSBwbGFjZWQgYXMgdGhlIHNlY29uZCwgdGhlIHNlY29uZCBhcyB0aGUgdGhpcmQgYW5kIHRoZSB0aGlyZFxuXHQgKiBhcyB0aGUgZmlyc3QuXG5cdCAqXG5cdCAqIEBwYXJhbSByYW5nZXMgUmFuZ2VzIHRvIHNvcnQuXG5cdCAqIEBwYXJhbSByYW5nZXNPcmRlciBBbiBhcnJheSB3aXRoIG5ldyByYW5nZSBvcmRlci5cblx0ICogQHJldHVybnMgU29ydGVkIHJhbmdlcyBhcnJheS5cblx0ICovIF9zb3J0UmFuZ2VzKHJhbmdlcywgcmFuZ2VzT3JkZXIpIHtcbiAgICAgICAgY29uc3Qgc29ydGVkUmFuZ2VzID0gW107XG4gICAgICAgIGxldCBpbmRleCA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgbmV3UG9zaXRpb24gb2YgcmFuZ2VzT3JkZXIpe1xuICAgICAgICAgICAgaWYgKHJhbmdlc1tuZXdQb3NpdGlvbiAtIDFdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcnNlIGVycm9yIC0gcHJvdmlkZWQgcmFuZ2VzIG9yZGVyIGlzIGludmFsaWQuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzb3J0ZWRSYW5nZXNbbmV3UG9zaXRpb24gLSAxXSA9IHJhbmdlc1tpbmRleF07XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzb3J0ZWRSYW5nZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVc2VzIGFsbCBmb3VuZCBicmFja2V0IHBvc2l0aW9ucyB0byBjcmVhdGUgcmFuZ2VzIGZyb20gdGhlbS5cblx0ICovIF9jcmVhdGVSYW5nZXMoKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgICAgICBsZXQgcmFuZ2UgPSBudWxsO1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5fcG9zaXRpb25zKXtcbiAgICAgICAgICAgIC8vIFdoZW4gZW5kIG9mIHJhbmdlIGlzIGZvdW5kIHdpdGhvdXQgb3BlbmluZy5cbiAgICAgICAgICAgIGlmICghcmFuZ2UgJiYgKGl0ZW0uYnJhY2tldCA9PSBFTEVNRU5UX1JBTkdFX0VORF9UT0tFTiB8fCBpdGVtLmJyYWNrZXQgPT0gVEVYVF9SQU5HRV9FTkRfVE9LRU4pKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQYXJzZSBlcnJvciAtIGVuZCBvZiByYW5nZSB3YXMgZm91bmQgJyR7aXRlbS5icmFja2V0fScgYnV0IHJhbmdlIHdhcyBub3Qgc3RhcnRlZCBiZWZvcmUuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBXaGVuIHNlY29uZCBzdGFydCBvZiByYW5nZSBpcyBmb3VuZCB3aGVuIG9uZSBpcyBhbHJlYWR5IG9wZW5lZCAtIHNlbGVjdGlvbiBkb2VzIG5vdCBhbGxvdyBpbnRlcnNlY3RpbmdcbiAgICAgICAgICAgIC8vIHJhbmdlcy5cbiAgICAgICAgICAgIGlmIChyYW5nZSAmJiAoaXRlbS5icmFja2V0ID09IEVMRU1FTlRfUkFOR0VfU1RBUlRfVE9LRU4gfHwgaXRlbS5icmFja2V0ID09IFRFWFRfUkFOR0VfU1RBUlRfVE9LRU4pKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQYXJzZSBlcnJvciAtIHN0YXJ0IG9mIHJhbmdlIHdhcyBmb3VuZCAnJHtpdGVtLmJyYWNrZXR9JyBidXQgb25lIHJhbmdlIGlzIGFscmVhZHkgc3RhcnRlZC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmJyYWNrZXQgPT0gRUxFTUVOVF9SQU5HRV9TVEFSVF9UT0tFTiB8fCBpdGVtLmJyYWNrZXQgPT0gVEVYVF9SQU5HRV9TVEFSVF9UT0tFTikge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlJDEoaXRlbS5wb3NpdGlvbiwgaXRlbS5wb3NpdGlvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmdlLmVuZCA9IGl0ZW0ucG9zaXRpb247XG4gICAgICAgICAgICAgICAgcmFuZ2VzLnB1c2gocmFuZ2UpO1xuICAgICAgICAgICAgICAgIHJhbmdlID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiBhbGwgcmFuZ2VzIGhhdmUgcHJvcGVyIGVuZGluZy5cbiAgICAgICAgaWYgKHJhbmdlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcnNlIGVycm9yIC0gcmFuZ2Ugd2FzIHN0YXJ0ZWQgYnV0IG5vIGVuZCBkZWxpbWl0ZXIgd2FzIGZvdW5kLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfVxufVxuLyoqXG4gKiBQcml2YXRlIGhlbHBlciBjbGFzcyB1c2VkIGZvciBjb252ZXJ0aW5nIHRoZSB2aWV3IHRyZWUgdG8gYSBzdHJpbmcuXG4gKi8gY2xhc3MgVmlld1N0cmluZ2lmeSB7XG4gICAgcm9vdDtcbiAgICBzZWxlY3Rpb247XG4gICAgcmFuZ2VzO1xuICAgIHNob3dUeXBlO1xuICAgIHNob3dQcmlvcml0eTtcbiAgICBzaG93QXR0cmlidXRlRWxlbWVudElkO1xuICAgIGlnbm9yZVJvb3Q7XG4gICAgc2FtZVNlbGVjdGlvbkNoYXJhY3RlcnM7XG4gICAgcmVuZGVyVUlFbGVtZW50cztcbiAgICByZW5kZXJSYXdFbGVtZW50cztcbiAgICBkb21Db252ZXJ0ZXI7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSB2aWV3IHN0cmluZ2lmeSBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIHNlbGVjdGlvbiBBIHNlbGVjdGlvbiB3aG9zZSByYW5nZXMgc2hvdWxkIGFsc28gYmUgY29udmVydGVkIHRvIGEgc3RyaW5nLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBbiBvcHRpb25zIG9iamVjdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuc2hvd1R5cGUgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgdHlwZSBvZiBlbGVtZW50cyB3aWxsIGJlIHByaW50ZWQgKGA8Y29udGFpbmVyOnA+YFxuXHQgKiBpbnN0ZWFkIG9mIGA8cD5gLCBgPGF0dHJpYnV0ZTpiPmAgaW5zdGVhZCBvZiBgPGI+YCBhbmQgYDxlbXB0eTppbWc+YCBpbnN0ZWFkIG9mIGA8aW1nPmApLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zaG93UHJpb3JpdHkgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgYXR0cmlidXRlIGVsZW1lbnQncyBwcmlvcml0eSB3aWxsIGJlIHByaW50ZWQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmlnbm9yZVJvb3QgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgcm9vdCdzIGVsZW1lbnQgb3BlbmluZyBhbmQgY2xvc2luZyB0YWcgd2lsbCBub3Rcblx0ICogYmUgb3V0cHV0dGVkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zYW1lU2VsZWN0aW9uQ2hhcmFjdGVycyBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBzZWxlY3Rpb24gaW5zaWRlIHRoZSB0ZXh0IGlzIG1hcmtlZCBhc1xuXHQgKiBge2AgYW5kIGB9YCBhbmQgdGhlIHNlbGVjdGlvbiBvdXRzaWRlIHRoZSB0ZXh0IGFzIGBbYCBhbmQgYF1gLiBXaGVuIHNldCB0byBgZmFsc2VgLCBib3RoIGFyZSBtYXJrZWQgYXMgYFtgIGFuZCBgXWAuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnJlbmRlclVJRWxlbWVudHMgV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgaW5uZXIgY29udGVudCBvZiBlYWNoXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudH0gd2lsbCBiZSBwcmludGVkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5yZW5kZXJSYXdFbGVtZW50cyBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBpbm5lciBjb250ZW50IG9mIGVhY2hcblx0ICogQHBhcmFtIG9wdGlvbnMuZG9tQ29udmVydGVyIFdoZW4gc2V0IHRvIGFuIGFjdHVhbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvbWNvbnZlcnRlcn5Eb21Db252ZXJ0ZXIgRG9tQ29udmVydGVyfVxuXHQgKiBpbnN0YW5jZSwgaXQgbGV0cyB0aGUgY29udmVyc2lvbiBnbyB0aHJvdWdoIGV4YWN0bHkgdGhlIHNhbWUgZmxvdyB0aGUgZWRpdGluZyB2aWV3IGlzIGdvaW5nIHRocm91Z2gsXG5cdCAqIGkuZS4gd2l0aCB2aWV3IGRhdGEgZmlsdGVyaW5nLiBPdGhlcndpc2UgdGhlIHNpbXBsZSBzdHViIGlzIHVzZWQuXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50fSB3aWxsIGJlIHByaW50ZWQuXG5cdCAqLyBjb25zdHJ1Y3Rvcihyb290LCBzZWxlY3Rpb24sIG9wdGlvbnMpe1xuICAgICAgICB0aGlzLnJvb3QgPSByb290O1xuICAgICAgICB0aGlzLnNlbGVjdGlvbiA9IHNlbGVjdGlvbjtcbiAgICAgICAgdGhpcy5yYW5nZXMgPSBbXTtcbiAgICAgICAgaWYgKHNlbGVjdGlvbikge1xuICAgICAgICAgICAgdGhpcy5yYW5nZXMgPSBbXG4gICAgICAgICAgICAgICAgLi4uc2VsZWN0aW9uLmdldFJhbmdlcygpXG4gICAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2hvd1R5cGUgPSAhIW9wdGlvbnMuc2hvd1R5cGU7XG4gICAgICAgIHRoaXMuc2hvd1ByaW9yaXR5ID0gISFvcHRpb25zLnNob3dQcmlvcml0eTtcbiAgICAgICAgdGhpcy5zaG93QXR0cmlidXRlRWxlbWVudElkID0gISFvcHRpb25zLnNob3dBdHRyaWJ1dGVFbGVtZW50SWQ7XG4gICAgICAgIHRoaXMuaWdub3JlUm9vdCA9ICEhb3B0aW9ucy5pZ25vcmVSb290O1xuICAgICAgICB0aGlzLnNhbWVTZWxlY3Rpb25DaGFyYWN0ZXJzID0gISFvcHRpb25zLnNhbWVTZWxlY3Rpb25DaGFyYWN0ZXJzO1xuICAgICAgICB0aGlzLnJlbmRlclVJRWxlbWVudHMgPSAhIW9wdGlvbnMucmVuZGVyVUlFbGVtZW50cztcbiAgICAgICAgdGhpcy5yZW5kZXJSYXdFbGVtZW50cyA9ICEhb3B0aW9ucy5yZW5kZXJSYXdFbGVtZW50cztcbiAgICAgICAgdGhpcy5kb21Db252ZXJ0ZXIgPSBvcHRpb25zLmRvbUNvbnZlcnRlciB8fCBkb21Db252ZXJ0ZXJTdHViO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgdGhlIHZpZXcgdG8gYSBzdHJpbmcuXG5cdCAqXG5cdCAqIEByZXR1cm5zIFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdmlldyBlbGVtZW50cy5cblx0ICovIHN0cmluZ2lmeSgpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9ICcnO1xuICAgICAgICB0aGlzLl93YWxrVmlldyh0aGlzLnJvb3QsIChjaHVuayk9PntcbiAgICAgICAgICAgIHJlc3VsdCArPSBjaHVuaztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyBhIHNpbXBsZSB3YWxrZXIgdGhhdCBpdGVyYXRlcyBvdmVyIGFsbCBlbGVtZW50cyBpbiB0aGUgdmlldyB0cmVlIHN0YXJ0aW5nIGZyb20gdGhlIHJvb3QgZWxlbWVudC5cblx0ICogQ2FsbHMgdGhlIGBjYWxsYmFja2Agd2l0aCBwYXJzZWQgY2h1bmtzIG9mIHN0cmluZyBkYXRhLlxuXHQgKi8gX3dhbGtWaWV3KHJvb3QsIGNhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IGlnbm9yZSA9IHRoaXMuaWdub3JlUm9vdCAmJiB0aGlzLnJvb3QgPT09IHJvb3Q7XG4gICAgICAgIGlmIChyb290LmlzKCdlbGVtZW50JykgfHwgcm9vdC5pcygnZG9jdW1lbnRGcmFnbWVudCcpKSB7XG4gICAgICAgICAgICBpZiAocm9vdC5pcygnZWxlbWVudCcpICYmICFpZ25vcmUpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGlzLl9zdHJpbmdpZnlFbGVtZW50T3Blbihyb290KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJVSUVsZW1lbnRzICYmIHJvb3QuaXMoJ3VpRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socm9vdC5yZW5kZXIoZG9jdW1lbnQsIHRoaXMuZG9tQ29udmVydGVyKS5pbm5lckhUTUwpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJlbmRlclJhd0VsZW1lbnRzICYmIHJvb3QuaXMoJ3Jhd0VsZW1lbnQnKSkge1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlJ3Mgbm8gRE9NIGVsZW1lbnQgZm9yIFwicm9vdFwiIHRvIHBhc3MgdG8gcmVuZGVyKCkuIENyZWF0aW5nXG4gICAgICAgICAgICAgICAgLy8gYSBzdXJyb2dhdGUgY29udGFpbmVyIHRvIHJlbmRlciB0aGUgY2hpbGRyZW4gaW5zdGVhZC5cbiAgICAgICAgICAgICAgICBjb25zdCByYXdDb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgcm9vdC5yZW5kZXIocmF3Q29udGVudENvbnRhaW5lciwgdGhpcy5kb21Db252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJhd0NvbnRlbnRDb250YWluZXIuaW5uZXJIVE1MKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5fc3RyaW5naWZ5RWxlbWVudFJhbmdlcyhyb290LCBvZmZzZXQpKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHJvb3QuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhbGtWaWV3KGNoaWxkLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCsrO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGlzLl9zdHJpbmdpZnlFbGVtZW50UmFuZ2VzKHJvb3QsIG9mZnNldCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyb290LmlzKCdlbGVtZW50JykgJiYgIWlnbm9yZSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMuX3N0cmluZ2lmeUVsZW1lbnRDbG9zZShyb290KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJvb3QuaXMoJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMuX3N0cmluZ2lmeVRleHRSYW5nZXMocm9vdCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgaWYgYSBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSBoYXMgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHJhbmdlIHN0YXJ0fVxuXHQgKiBvciBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmFuZ2V+UmFuZ2Ujc3RhcnQgcmFuZ2UgZW5kfSBwbGFjZWQgYXQgYSBnaXZlbiBvZmZzZXQgYW5kIHJldHVybnMgaXRzIHN0cmluZyByZXByZXNlbnRhdGlvbi5cblx0ICovIF9zdHJpbmdpZnlFbGVtZW50UmFuZ2VzKGVsZW1lbnQsIG9mZnNldCkge1xuICAgICAgICBsZXQgc3RhcnQgPSAnJztcbiAgICAgICAgbGV0IGVuZCA9ICcnO1xuICAgICAgICBsZXQgY29sbGFwc2VkID0gJyc7XG4gICAgICAgIGZvciAoY29uc3QgcmFuZ2Ugb2YgdGhpcy5yYW5nZXMpe1xuICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0LnBhcmVudCA9PSBlbGVtZW50ICYmIHJhbmdlLnN0YXJ0Lm9mZnNldCA9PT0gb2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbGxhcHNlZCArPSBFTEVNRU5UX1JBTkdFX1NUQVJUX1RPS0VOICsgRUxFTUVOVF9SQU5HRV9FTkRfVE9LRU47XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQgKz0gRUxFTUVOVF9SQU5HRV9TVEFSVF9UT0tFTjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmFuZ2UuZW5kLnBhcmVudCA9PT0gZWxlbWVudCAmJiByYW5nZS5lbmQub2Zmc2V0ID09PSBvZmZzZXQgJiYgIXJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgZW5kICs9IEVMRU1FTlRfUkFOR0VfRU5EX1RPS0VOO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbmQgKyBjb2xsYXBzZWQgKyBzdGFydDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBhIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IFRleHQgbm9kZX0gaGFzIGFcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9yYW5nZX5SYW5nZSNzdGFydCByYW5nZSBzdGFydH0gb3IgYVxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3JhbmdlflJhbmdlI3N0YXJ0IHJhbmdlIGVuZH0gcGxhY2VkIHNvbWV3aGVyZSBpbnNpZGUuIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGV4dFxuXHQgKiB3aXRoIHJhbmdlIGRlbGltaXRlcnMgcGxhY2VkIGluc2lkZS5cblx0ICovIF9zdHJpbmdpZnlUZXh0UmFuZ2VzKG5vZGUpIHtcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gbm9kZS5kYXRhLmxlbmd0aDtcbiAgICAgICAgY29uc3QgZGF0YSA9IG5vZGUuZGF0YS5zcGxpdCgnJyk7XG4gICAgICAgIGxldCByYW5nZVN0YXJ0VG9rZW4sIHJhbmdlRW5kVG9rZW47XG4gICAgICAgIGlmICh0aGlzLnNhbWVTZWxlY3Rpb25DaGFyYWN0ZXJzKSB7XG4gICAgICAgICAgICByYW5nZVN0YXJ0VG9rZW4gPSBFTEVNRU5UX1JBTkdFX1NUQVJUX1RPS0VOO1xuICAgICAgICAgICAgcmFuZ2VFbmRUb2tlbiA9IEVMRU1FTlRfUkFOR0VfRU5EX1RPS0VOO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmFuZ2VTdGFydFRva2VuID0gVEVYVF9SQU5HRV9TVEFSVF9UT0tFTjtcbiAgICAgICAgICAgIHJhbmdlRW5kVG9rZW4gPSBURVhUX1JBTkdFX0VORF9UT0tFTjtcbiAgICAgICAgfVxuICAgICAgICAvLyBBZGQgb25lIG1vcmUgZWxlbWVudCBmb3IgcmFuZ2VzIGVuZGluZyBhZnRlciBsYXN0IGNoYXJhY3RlciBpbiB0ZXh0LlxuICAgICAgICBkYXRhW2xlbmd0aF0gPSAnJztcbiAgICAgICAgLy8gUmVwcmVzZW50IGVhY2ggbGV0dGVyIGFzIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IG9wZW5pbmcvY2xvc2luZyByYW5nZXMgYXQgZWFjaCBvZmZzZXQuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGRhdGEubWFwKChsZXR0ZXIpPT57XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGxldHRlcixcbiAgICAgICAgICAgICAgICBzdGFydDogJycsXG4gICAgICAgICAgICAgICAgZW5kOiAnJyxcbiAgICAgICAgICAgICAgICBjb2xsYXBzZWQ6ICcnXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB0aGlzLnJhbmdlcyl7XG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IHJhbmdlLnN0YXJ0O1xuICAgICAgICAgICAgY29uc3QgZW5kID0gcmFuZ2UuZW5kO1xuICAgICAgICAgICAgaWYgKHN0YXJ0LnBhcmVudCA9PSBub2RlICYmIHN0YXJ0Lm9mZnNldCA+PSAwICYmIHN0YXJ0Lm9mZnNldCA8PSBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2VuZC5vZmZzZXRdLmNvbGxhcHNlZCArPSByYW5nZVN0YXJ0VG9rZW4gKyByYW5nZUVuZFRva2VuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtzdGFydC5vZmZzZXRdLnN0YXJ0ICs9IHJhbmdlU3RhcnRUb2tlbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW5kLnBhcmVudCA9PSBub2RlICYmIGVuZC5vZmZzZXQgPj0gMCAmJiBlbmQub2Zmc2V0IDw9IGxlbmd0aCAmJiAhcmFuZ2UuaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbZW5kLm9mZnNldF0uZW5kICs9IHJhbmdlRW5kVG9rZW47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdC5tYXAoKGl0ZW0pPT5pdGVtLmVuZCArIGl0ZW0uY29sbGFwc2VkICsgaXRlbS5zdGFydCArIGl0ZW0ubGV0dGVyKS5qb2luKCcnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHRoZSBwYXNzZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gdG8gYW4gb3BlbmluZyB0YWcuXG5cdCAqXG5cdCAqIERlcGVuZGluZyBvbiB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uLCB0aGUgb3BlbmluZyB0YWcgY2FuIGJlIHNpbXBsZSAoYDxhPmApLCBjb250YWluIGEgdHlwZSBwcmVmaXggKGA8Y29udGFpbmVyOnA+YCxcblx0ICogYDxhdHRyaWJ1dGU6YT5gIG9yIGA8ZW1wdHk6aW1nPmApLCBjb250YWluIHByaW9yaXR5IGluZm9ybWF0aW9uICggYDxhdHRyaWJ1dGU6YSB2aWV3LXByaW9yaXR5PVwiMjBcIj5gICksXG5cdCAqIG9yIGNvbnRhaW4gZWxlbWVudCBpZCAoIGA8YXR0cmlidXRlOnNwYW4gdmlldy1pZD1cImZvb1wiPmAgKS4gRWxlbWVudCBhdHRyaWJ1dGVzIHdpbGwgYWxzbyBiZSBpbmNsdWRlZFxuXHQgKiAoYDxhIGhyZWY9XCJodHRwczovL2NrZWRpdG9yLmNvbVwiIG5hbWU9XCJmb29iYXJcIj5gKS5cblx0ICovIF9zdHJpbmdpZnlFbGVtZW50T3BlbihlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXR5ID0gdGhpcy5fc3RyaW5naWZ5RWxlbWVudFByaW9yaXR5KGVsZW1lbnQpO1xuICAgICAgICBjb25zdCBpZCA9IHRoaXMuX3N0cmluZ2lmeUVsZW1lbnRJZChlbGVtZW50KTtcbiAgICAgICAgY29uc3QgdHlwZSA9IHRoaXMuX3N0cmluZ2lmeUVsZW1lbnRUeXBlKGVsZW1lbnQpO1xuICAgICAgICBjb25zdCBuYW1lID0gW1xuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIGVsZW1lbnQubmFtZVxuICAgICAgICBdLmZpbHRlcigoaSk9PmkgIT09ICcnKS5qb2luKCc6Jyk7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLl9zdHJpbmdpZnlFbGVtZW50QXR0cmlidXRlcyhlbGVtZW50KTtcbiAgICAgICAgY29uc3QgcGFydHMgPSBbXG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXNcbiAgICAgICAgXTtcbiAgICAgICAgcmV0dXJuIGA8JHtwYXJ0cy5maWx0ZXIoKGkpPT5pICE9PSAnJykuam9pbignICcpfT5gO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgdGhlIHBhc3NlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB0byBhIGNsb3NpbmcgdGFnLlxuXHQgKiBEZXBlbmRpbmcgb24gdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiwgdGhlIGNsb3NpbmcgdGFnIGNhbiBiZSBzaW1wbGUgKGA8L2E+YCkgb3IgY29udGFpbiBhIHR5cGUgcHJlZml4IChgPC9jb250YWluZXI6cD5gLFxuXHQgKiBgPC9hdHRyaWJ1dGU6YT5gIG9yIGA8L2VtcHR5OmltZz5gKS5cblx0ICovIF9zdHJpbmdpZnlFbGVtZW50Q2xvc2UoZWxlbWVudCkge1xuICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5fc3RyaW5naWZ5RWxlbWVudFR5cGUoZWxlbWVudCk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBbXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgZWxlbWVudC5uYW1lXG4gICAgICAgIF0uZmlsdGVyKChpKT0+aSAhPT0gJycpLmpvaW4oJzonKTtcbiAgICAgICAgcmV0dXJuIGA8LyR7bmFtZX0+YDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHRoZSBwYXNzZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudCdzfSB0eXBlIHRvIGl0cyBzdHJpbmcgcmVwcmVzZW50YXRpb25cblx0ICpcblx0ICogUmV0dXJuczpcblx0ICogKiAnYXR0cmlidXRlJyBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnRzfSxcblx0ICogKiAnY29udGFpbmVyJyBmb3Ige0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnRzfSxcblx0ICogKiAnZW1wdHknIGZvciB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnQgZW1wdHkgZWxlbWVudHN9LFxuXHQgKiAqICd1aScgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBVSSBlbGVtZW50c30sXG5cdCAqICogJ3JhdycgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvcmF3ZWxlbWVudH5SYXdFbGVtZW50IHJhdyBlbGVtZW50c30sXG5cdCAqICogYW4gZW1wdHkgc3RyaW5nIHdoZW4gdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiBpcyBwcmV2ZW50aW5nIHNob3dpbmcgZWxlbWVudHMnIHR5cGVzLlxuXHQgKi8gX3N0cmluZ2lmeUVsZW1lbnRUeXBlKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvd1R5cGUpIHtcbiAgICAgICAgICAgIGZvcihjb25zdCB0eXBlIGluIGFsbG93ZWRUeXBlcyl7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgaW5zdGFuY2VvZiBhbGxvd2VkVHlwZXNbdHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHRoZSBwYXNzZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gdG8gaXRzIHByaW9yaXR5IHJlcHJlc2VudGF0aW9uLlxuXHQgKlxuXHQgKiBUaGUgcHJpb3JpdHkgc3RyaW5nIHJlcHJlc2VudGF0aW9uIHdpbGwgYmUgcmV0dXJuZWQgd2hlbiB0aGUgcGFzc2VkIGVsZW1lbnQgaXMgYW4gaW5zdGFuY2Ugb2Zcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnR9IGFuZCB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uIGFsbG93cyB0byBzaG93IHRoZVxuXHQgKiBwcmlvcml0eS4gT3RoZXJ3aXNlIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLlxuXHQgKi8gX3N0cmluZ2lmeUVsZW1lbnRQcmlvcml0eShlbGVtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLnNob3dQcmlvcml0eSAmJiBlbGVtZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBgdmlldy1wcmlvcml0eT1cIiR7ZWxlbWVudC5wcmlvcml0eX1cImA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgdGhlIHBhc3NlZCB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB0byBpdHMgaWQgcmVwcmVzZW50YXRpb24uXG5cdCAqXG5cdCAqIFRoZSBpZCBzdHJpbmcgcmVwcmVzZW50YXRpb24gd2lsbCBiZSByZXR1cm5lZCB3aGVuIHRoZSBwYXNzZWQgZWxlbWVudCBpcyBhbiBpbnN0YW5jZSBvZlxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2F0dHJpYnV0ZWVsZW1lbnR+QXR0cmlidXRlRWxlbWVudCBhdHRyaWJ1dGUgZWxlbWVudH0sIHRoZSBlbGVtZW50IGhhcyBhbiBpZFxuXHQgKiBhbmQgdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvbiBhbGxvd3MgdG8gc2hvdyB0aGUgaWQuIE90aGVyd2lzZSByZXR1cm5zIGFuIGVtcHR5IHN0cmluZy5cblx0ICovIF9zdHJpbmdpZnlFbGVtZW50SWQoZWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5zaG93QXR0cmlidXRlRWxlbWVudElkICYmIGVsZW1lbnQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSAmJiBlbGVtZW50LmlkKSB7XG4gICAgICAgICAgICByZXR1cm4gYHZpZXctaWQ9XCIke2VsZW1lbnQuaWR9XCJgO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIHRoZSBwYXNzZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gYXR0cmlidXRlcyB0byB0aGVpciBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG5cdCAqIElmIGFuIGVsZW1lbnQgaGFzIG5vIGF0dHJpYnV0ZXMsIGFuIGVtcHR5IHN0cmluZyBpcyByZXR1cm5lZC5cblx0ICovIF9zdHJpbmdpZnlFbGVtZW50QXR0cmlidXRlcyhlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgICAgY29uc3Qga2V5cyA9IFtcbiAgICAgICAgICAgIC4uLmVsZW1lbnQuZ2V0QXR0cmlidXRlS2V5cygpXG4gICAgICAgIF0uc29ydCgpO1xuICAgICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiBrZXlzKXtcbiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVWYWx1ZTtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICdjbGFzcycpIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZSA9IFtcbiAgICAgICAgICAgICAgICAgICAgLi4uZWxlbWVudC5nZXRDbGFzc05hbWVzKClcbiAgICAgICAgICAgICAgICBdLnNvcnQoKS5qb2luKCcgJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGF0dHJpYnV0ZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlID0gW1xuICAgICAgICAgICAgICAgICAgICAuLi5lbGVtZW50LmdldFN0eWxlTmFtZXMoKVxuICAgICAgICAgICAgICAgIF0uc29ydCgpLm1hcCgoc3R5bGUpPT5gJHtzdHlsZX06JHtlbGVtZW50LmdldFN0eWxlKHN0eWxlKS5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyl9YCkuam9pbignOycpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goYCR7YXR0cmlidXRlfT1cIiR7YXR0cmlidXRlVmFsdWV9XCJgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXR0cmlidXRlcy5qb2luKCcgJyk7XG4gICAgfVxufVxuLyoqXG4gKiBDb252ZXJ0cyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50c30gdG9cbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50c30sXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudCBjb250YWluZXIgZWxlbWVudHN9LFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IGVtcHR5IGVsZW1lbnRzfSBvclxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IFVJIGVsZW1lbnRzfS5cbiAqIEl0IGNvbnZlcnRzIHRoZSB3aG9sZSB0cmVlIHN0YXJ0aW5nIGZyb20gdGhlIGByb290Tm9kZWAuIFRoZSBjb252ZXJzaW9uIGlzIGJhc2VkIG9uIGVsZW1lbnQgbmFtZXMuXG4gKiBTZWUgdGhlIGBfY29udmVydEVsZW1lbnRgIG1ldGhvZCBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIEBwYXJhbSByb290Tm9kZSBUaGUgcm9vdCBub2RlIHRvIGNvbnZlcnQuXG4gKiBAcmV0dXJucyBUaGUgcm9vdCBub2RlIG9mIGNvbnZlcnRlZCBlbGVtZW50cy5cbiAqLyBmdW5jdGlvbiBfY29udmVydFZpZXdFbGVtZW50cyhyb290Tm9kZSkge1xuICAgIGlmIChyb290Tm9kZS5pcygnZWxlbWVudCcpIHx8IHJvb3ROb2RlLmlzKCdkb2N1bWVudEZyYWdtZW50JykpIHtcbiAgICAgICAgLy8gQ29udmVydCBlbGVtZW50IG9yIGxlYXZlIGRvY3VtZW50IGZyYWdtZW50LlxuICAgICAgICBjb25zdCBjb252ZXJ0ZWRFbGVtZW50ID0gcm9vdE5vZGUuaXMoJ2RvY3VtZW50RnJhZ21lbnQnKSA/IG5ldyBEb2N1bWVudEZyYWdtZW50JDEocm9vdE5vZGUuZG9jdW1lbnQpIDogX2NvbnZlcnRFbGVtZW50KHJvb3ROb2RlLmRvY3VtZW50LCByb290Tm9kZSk7XG4gICAgICAgIC8vIENvbnZlcnQgYWxsIGNoaWxkIG5vZGVzLlxuICAgICAgICAvLyBDYWNoZSB0aGUgbm9kZXMgaW4gYXJyYXkuIE90aGVyd2lzZSwgd2Ugd291bGQgc2tpcCBzb21lIG5vZGVzIGJlY2F1c2UgZHVyaW5nIGl0ZXJhdGlvbiB3ZSBtb3ZlIG5vZGVzXG4gICAgICAgIC8vIGZyb20gYHJvb3ROb2RlYCB0byBgY29udmVydGVkRWxlbWVudGAuIFRoaXMgd291bGQgaW50ZXJmZXJlIHdpdGggaXRlcmF0aW9uLlxuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIFtcbiAgICAgICAgICAgIC4uLnJvb3ROb2RlLmdldENoaWxkcmVuKClcbiAgICAgICAgXSl7XG4gICAgICAgICAgICBpZiAoY29udmVydGVkRWxlbWVudC5pcygnZW1wdHlFbGVtZW50JykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcnNlIGVycm9yIC0gY2Fubm90IHBhcnNlIGluc2lkZSBFbXB0eUVsZW1lbnQuJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnZlcnRlZEVsZW1lbnQuaXMoJ3VpRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXJzZSBlcnJvciAtIGNhbm5vdCBwYXJzZSBpbnNpZGUgVUlFbGVtZW50LicpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb252ZXJ0ZWRFbGVtZW50LmlzKCdyYXdFbGVtZW50JykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcnNlIGVycm9yIC0gY2Fubm90IHBhcnNlIGluc2lkZSBSYXdFbGVtZW50LicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udmVydGVkRWxlbWVudC5fYXBwZW5kQ2hpbGQoX2NvbnZlcnRWaWV3RWxlbWVudHMoY2hpbGQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29udmVydGVkRWxlbWVudDtcbiAgICB9XG4gICAgcmV0dXJuIHJvb3ROb2RlO1xufVxuLyoqXG4gKiBDb252ZXJ0cyBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VsZW1lbnR+RWxlbWVudCBlbGVtZW50fSB0b1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnR9LFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnR9LFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbXB0eWVsZW1lbnR+RW1wdHlFbGVtZW50IGVtcHR5IGVsZW1lbnR9IG9yXG4gKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3VpZWxlbWVudH5VSUVsZW1lbnQgVUkgZWxlbWVudH0uXG4gKiBJZiB0aGUgZWxlbWVudCdzIG5hbWUgaXMgaW4gdGhlIGZvcm1hdCBvZiBgYXR0cmlidXRlOmJgLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0b1xuICogYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9hdHRyaWJ1dGVlbGVtZW50fkF0dHJpYnV0ZUVsZW1lbnQgYXR0cmlidXRlIGVsZW1lbnR9IHdpdGggYSBwcmlvcml0eSBvZiAxMS5cbiAqIEFkZGl0aW9uYWxseSwgYXR0cmlidXRlIGVsZW1lbnRzIG1heSBoYXZlIHNwZWNpZmllZCBwcmlvcml0eSAoZm9yIGV4YW1wbGUgYHZpZXctcHJpb3JpdHk9XCIxMVwiYCkgYW5kL29yXG4gKiBpZCAoZm9yIGV4YW1wbGUgYHZpZXctaWQ9XCJmb29cImApLlxuICogSWYgdGhlIGVsZW1lbnQncyBuYW1lIGlzIGluIHRoZSBmb3JtYXQgb2YgYGNvbnRhaW5lcjpwYCwgaXQgd2lsbCBiZSBjb252ZXJ0ZWQgdG9cbiAqIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9jb250YWluZXJlbGVtZW50fkNvbnRhaW5lckVsZW1lbnQgY29udGFpbmVyIGVsZW1lbnR9LlxuICogSWYgdGhlIGVsZW1lbnQncyBuYW1lIGlzIGluIHRoZSBmb3JtYXQgb2YgYGVtcHR5OmltZ2AsIGl0IHdpbGwgYmUgY29udmVydGVkIHRvXG4gKiBhbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VtcHR5ZWxlbWVudH5FbXB0eUVsZW1lbnQgZW1wdHkgZWxlbWVudH0uXG4gKiBJZiB0aGUgZWxlbWVudCdzIG5hbWUgaXMgaW4gdGhlIGZvcm1hdCBvZiBgdWk6c3BhbmAsIGl0IHdpbGwgYmUgY29udmVydGVkIHRvXG4gKiBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBVSSBlbGVtZW50fS5cbiAqIElmIHRoZSBlbGVtZW50J3MgbmFtZSBkb2VzIG5vdCBjb250YWluIGFueSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uLCBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50IHZpZXcgRWxlbWVudH0gd2lsbCBiZVxuICogcmV0dXJuZWQuXG4gKlxuICogQHBhcmFtIHZpZXdFbGVtZW50IEEgdmlldyBlbGVtZW50IHRvIGNvbnZlcnQuXG4gKiBAcmV0dXJucyBBIHRyZWUgdmlldyBlbGVtZW50IGNvbnZlcnRlZCBhY2NvcmRpbmcgdG8gaXRzIG5hbWUuXG4gKi8gZnVuY3Rpb24gX2NvbnZlcnRFbGVtZW50KHZpZXdEb2N1bWVudCwgdmlld0VsZW1lbnQpIHtcbiAgICBjb25zdCBpbmZvID0gX2NvbnZlcnRFbGVtZW50TmFtZUFuZEluZm8odmlld0VsZW1lbnQpO1xuICAgIGNvbnN0IEVsZW1lbnRDb25zdHJ1Y3RvciA9IGFsbG93ZWRUeXBlc1tpbmZvLnR5cGVdO1xuICAgIGNvbnN0IG5ld0VsZW1lbnQgPSBFbGVtZW50Q29uc3RydWN0b3IgPyBuZXcgRWxlbWVudENvbnN0cnVjdG9yKHZpZXdEb2N1bWVudCwgaW5mby5uYW1lKSA6IG5ldyBFbGVtZW50JDEodmlld0RvY3VtZW50LCBpbmZvLm5hbWUpO1xuICAgIGlmIChuZXdFbGVtZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50JykpIHtcbiAgICAgICAgaWYgKGluZm8ucHJpb3JpdHkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIG5ld0VsZW1lbnQuX3ByaW9yaXR5ID0gaW5mby5wcmlvcml0eTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5mby5pZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5faWQgPSBpbmZvLmlkO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIE1vdmUgYXR0cmlidXRlcy5cbiAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZUtleSBvZiB2aWV3RWxlbWVudC5nZXRBdHRyaWJ1dGVLZXlzKCkpe1xuICAgICAgICBuZXdFbGVtZW50Ll9zZXRBdHRyaWJ1dGUoYXR0cmlidXRlS2V5LCB2aWV3RWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlS2V5KSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdFbGVtZW50O1xufVxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgYHZpZXctcHJpb3JpdHlgIGF0dHJpYnV0ZSBhbmQgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I25hbWUgZWxlbWVudCdzIG5hbWV9IGluZm9ybWF0aW9uIG5lZWRlZCBmb3JcbiAqIGNyZWF0aW5nIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvYXR0cmlidXRlZWxlbWVudH5BdHRyaWJ1dGVFbGVtZW50IGF0dHJpYnV0ZSBlbGVtZW50fSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50IGNvbnRhaW5lciBlbGVtZW50fSxcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZW1wdHllbGVtZW50fkVtcHR5RWxlbWVudCBlbXB0eSBlbGVtZW50fSBvclxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IFVJIGVsZW1lbnR9LlxuICogVGhlIG5hbWUgY2FuIGJlIHByb3ZpZGVkIGluIHR3byBmb3JtYXRzOiBhcyBhIHNpbXBsZSBlbGVtZW50J3MgbmFtZSAoYGRpdmApLCBvciBhcyBhIHR5cGUgYW5kIG5hbWUgKGBjb250YWluZXI6ZGl2YCxcbiAqIGBhdHRyaWJ1dGU6c3BhbmAsIGBlbXB0eTppbWdgLCBgdWk6c3BhbmApO1xuICpcbiAqIEBwYXJhbSB2aWV3RWxlbWVudCBUaGUgZWxlbWVudCB3aG9zZSBuYW1lIHNob3VsZCBiZSBjb252ZXJ0ZWQuXG4gKiBAcmV0dXJucyBBbiBvYmplY3Qgd2l0aCBwYXJzZWQgaW5mb3JtYXRpb246XG4gKiAqIGBuYW1lYCBUaGUgcGFyc2VkIG5hbWUgb2YgdGhlIGVsZW1lbnQuXG4gKiAqIGB0eXBlYCBUaGUgcGFyc2VkIHR5cGUgb2YgdGhlIGVsZW1lbnQuIEl0IGNhbiBiZSBgYXR0cmlidXRlYCwgYGNvbnRhaW5lcmAgb3IgYGVtcHR5YC5cbiAqICogYHByaW9yaXR5YCBUaGUgcGFyc2VkIHByaW9yaXR5IG9mIHRoZSBlbGVtZW50LlxuICovIGZ1bmN0aW9uIF9jb252ZXJ0RWxlbWVudE5hbWVBbmRJbmZvKHZpZXdFbGVtZW50KSB7XG4gICAgY29uc3QgcGFydHMgPSB2aWV3RWxlbWVudC5uYW1lLnNwbGl0KCc6Jyk7XG4gICAgY29uc3QgcHJpb3JpdHkgPSBfY29udmVydFByaW9yaXR5KHZpZXdFbGVtZW50LmdldEF0dHJpYnV0ZSgndmlldy1wcmlvcml0eScpKTtcbiAgICBjb25zdCBpZCA9IHZpZXdFbGVtZW50Lmhhc0F0dHJpYnV0ZSgndmlldy1pZCcpID8gdmlld0VsZW1lbnQuZ2V0QXR0cmlidXRlKCd2aWV3LWlkJykgOiBudWxsO1xuICAgIHZpZXdFbGVtZW50Ll9yZW1vdmVBdHRyaWJ1dGUoJ3ZpZXctcHJpb3JpdHknKTtcbiAgICB2aWV3RWxlbWVudC5fcmVtb3ZlQXR0cmlidXRlKCd2aWV3LWlkJyk7XG4gICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiBwYXJ0c1swXSxcbiAgICAgICAgICAgIHR5cGU6IHByaW9yaXR5ICE9PSBudWxsID8gJ2F0dHJpYnV0ZScgOiBudWxsLFxuICAgICAgICAgICAgcHJpb3JpdHksXG4gICAgICAgICAgICBpZFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBDaGVjayBpZiB0eXBlIGFuZCBuYW1lOiBjb250YWluZXI6ZGl2LlxuICAgIGNvbnN0IHR5cGUgPSBfY29udmVydFR5cGUocGFydHNbMF0pO1xuICAgIGlmICh0eXBlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiBwYXJ0c1sxXSxcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgICAgIGlkXG4gICAgICAgIH07XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgUGFyc2UgZXJyb3IgLSBjYW5ub3QgcGFyc2UgZWxlbWVudCdzIG5hbWU6ICR7dmlld0VsZW1lbnQubmFtZX0uYCk7XG59XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgZWxlbWVudCdzIHR5cGUgaXMgYWxsb3dlZC4gUmV0dXJucyBgYXR0cmlidXRlYCwgYGNvbnRhaW5lcmAsIGBlbXB0eWAgb3IgYG51bGxgLlxuICovIGZ1bmN0aW9uIF9jb252ZXJ0VHlwZSh0eXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgaW4gYWxsb3dlZFR5cGVzID8gdHlwZSA6IG51bGw7XG59XG4vKipcbiAqIENoZWNrcyBpZiBhIGdpdmVuIHByaW9yaXR5IGlzIGFsbG93ZWQuIFJldHVybnMgbnVsbCBpZiB0aGUgcHJpb3JpdHkgY2Fubm90IGJlIGNvbnZlcnRlZC5cbiAqLyBmdW5jdGlvbiBfY29udmVydFByaW9yaXR5KHByaW9yaXR5U3RyaW5nKSB7XG4gICAgY29uc3QgcHJpb3JpdHkgPSBwYXJzZUludChwcmlvcml0eVN0cmluZywgMTApO1xuICAgIGlmICghaXNOYU4ocHJpb3JpdHkpKSB7XG4gICAgICAgIHJldHVybiBwcmlvcml0eTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogV3JpdGVzIHRoZSBjb250ZW50IG9mIGEgbW9kZWwge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvZG9jdW1lbnR+RG9jdW1lbnQgZG9jdW1lbnR9IHRvIGFuIEhUTUwtbGlrZSBzdHJpbmcuXG4gKlxuICogYGBgdHNcbiAqIGdldERhdGEoIGVkaXRvci5tb2RlbCApOyAvLyAtPiAnPHBhcmFncmFwaD5Gb28hW108L3BhcmFncmFwaD4nXG4gKiBgYGBcbiAqXG4gKiAqKk5vdGU6KiogQSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC90ZXh0flRleHQgdGV4dH0gbm9kZSB0aGF0IGNvbnRhaW5zIGF0dHJpYnV0ZXMgd2lsbCBiZSByZXByZXNlbnRlZCBhczpcbiAqXG4gKiBgYGB4bWxcbiAqIDwkdGV4dCBhdHRyaWJ1dGU9XCJ2YWx1ZVwiPlRleHQgZGF0YTwvJHRleHQ+XG4gKiBgYGBcbiAqXG4gKiAqKk5vdGU6KiogVXNpbmcgdGhpcyB0b29sIGluIHByb2R1Y3Rpb24tZ3JhZGUgY29kZSBpcyBub3QgcmVjb21tZW5kZWQuIEl0IHdhcyBkZXNpZ25lZCBmb3IgZGV2ZWxvcG1lbnQsIHByb3RvdHlwaW5nLFxuICogZGVidWdnaW5nIGFuZCB0ZXN0aW5nLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zLndpdGhvdXRTZWxlY3Rpb24gV2hldGhlciB0byB3cml0ZSB0aGUgc2VsZWN0aW9uLiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBzZWxlY3Rpb24gd2lsbFxuICogbm90IGJlIGluY2x1ZGVkIGluIHRoZSByZXR1cm5lZCBzdHJpbmcuXG4gKiBAcGFyYW0gb3B0aW9ucy5yb290TmFtZSBUaGUgbmFtZSBvZiB0aGUgcm9vdCBmcm9tIHdoaWNoIHRoZSBkYXRhIHNob3VsZCBiZSBzdHJpbmdpZmllZC4gSWYgbm90IHByb3ZpZGVkLFxuICogdGhlIGRlZmF1bHQgYG1haW5gIG5hbWUgd2lsbCBiZSB1c2VkLlxuICogQHBhcmFtIG9wdGlvbnMuY29udmVydE1hcmtlcnMgV2hldGhlciB0byBpbmNsdWRlIG1hcmtlcnMgaW4gdGhlIHJldHVybmVkIHN0cmluZy5cbiAqIEByZXR1cm5zIFRoZSBzdHJpbmdpZmllZCBkYXRhLlxuICovIGZ1bmN0aW9uIGdldERhdGEobW9kZWwsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghKG1vZGVsIGluc3RhbmNlb2YgTW9kZWwpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ01vZGVsIG5lZWRzIHRvIGJlIGFuIGluc3RhbmNlIG9mIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwuJyk7XG4gICAgfVxuICAgIGNvbnN0IHJvb3ROYW1lID0gb3B0aW9ucy5yb290TmFtZSB8fCAnbWFpbic7XG4gICAgY29uc3Qgcm9vdCA9IG1vZGVsLmRvY3VtZW50LmdldFJvb3Qocm9vdE5hbWUpO1xuICAgIHJldHVybiBnZXREYXRhLl9zdHJpbmdpZnkocm9vdCwgb3B0aW9ucy53aXRob3V0U2VsZWN0aW9uID8gbnVsbCA6IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbiwgb3B0aW9ucy5jb252ZXJ0TWFya2VycyA/IG1vZGVsLm1hcmtlcnMgOiBudWxsKTtcbn1cbi8vIFNldCBzdHJpbmdpZnkgYXMgZ2V0RGF0YSBwcml2YXRlIG1ldGhvZCAtIG5lZWRlZCBmb3IgdGVzdGluZy9zcHlpbmcuXG5nZXREYXRhLl9zdHJpbmdpZnkgPSBzdHJpbmdpZnk7XG4vKipcbiAqIFNldHMgdGhlIGNvbnRlbnQgb2YgYSBtb2RlbCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9kb2N1bWVudH5Eb2N1bWVudCBkb2N1bWVudH0gcHJvdmlkZWQgYXMgYW4gSFRNTC1saWtlIHN0cmluZy5cbiAqXG4gKiBgYGB0c1xuICogc2V0RGF0YSggZWRpdG9yLm1vZGVsLCAnPHBhcmFncmFwaD5Gb28hW108L3BhcmFncmFwaD4nICk7XG4gKiBgYGBcbiAqXG4gKiAqKk5vdGU6KiogUmVtZW1iZXIgdG8gcmVnaXN0ZXIgZWxlbWVudHMgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI3NjaGVtYSBtb2RlbCdzIHNjaGVtYX0gYmVmb3JlXG4gKiB0cnlpbmcgdG8gdXNlIHRoZW0uXG4gKlxuICogKipOb3RlOioqIFRvIGNyZWF0ZSBhIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3RleHR+VGV4dCB0ZXh0fSBub2RlIHRoYXQgY29udGFpbnMgYXR0cmlidXRlcyB1c2U6XG4gKlxuICogYGBgeG1sXG4gKiA8JHRleHQgYXR0cmlidXRlPVwidmFsdWVcIj5UZXh0IGRhdGE8LyR0ZXh0PlxuICogYGBgXG4gKlxuICogKipOb3RlOioqIFVzaW5nIHRoaXMgdG9vbCBpbiBwcm9kdWN0aW9uLWdyYWRlIGNvZGUgaXMgbm90IHJlY29tbWVuZGVkLiBJdCB3YXMgZGVzaWduZWQgZm9yIGRldmVsb3BtZW50LCBwcm90b3R5cGluZyxcbiAqIGRlYnVnZ2luZyBhbmQgdGVzdGluZy5cbiAqXG4gKiBAcGFyYW0gZGF0YSBIVE1MLWxpa2Ugc3RyaW5nIHRvIHdyaXRlIGludG8gdGhlIGRvY3VtZW50LlxuICogQHBhcmFtIG9wdGlvbnMucm9vdE5hbWUgUm9vdCBuYW1lIHdoZXJlIHBhcnNlZCBkYXRhIHdpbGwgYmUgc3RvcmVkLiBJZiBub3QgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGBtYWluYFxuICogbmFtZSB3aWxsIGJlIHVzZWQuXG4gKiBAcGFyYW0gb3B0aW9ucy5zZWxlY3Rpb25BdHRyaWJ1dGVzIEEgbGlzdCBvZiBhdHRyaWJ1dGVzIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBzZWxlY3Rpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5sYXN0UmFuZ2VCYWNrd2FyZCBJZiBzZXQgdG8gYHRydWVgLCB0aGUgbGFzdCByYW5nZSB3aWxsIGJlIGFkZGVkIGFzIGJhY2t3YXJkLlxuICogQHBhcmFtIG9wdGlvbnMuYmF0Y2hUeXBlIEJhdGNoIHR5cGUgdXNlZCBmb3IgaW5zZXJ0aW5nIGVsZW1lbnRzLiBTZWUge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvYmF0Y2h+QmF0Y2gjY29uc3RydWN0b3J9LlxuICogU2VlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL2JhdGNofkJhdGNoI3R5cGV9LlxuICovIGZ1bmN0aW9uIHNldERhdGEobW9kZWwsIGRhdGEsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghKG1vZGVsIGluc3RhbmNlb2YgTW9kZWwpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ01vZGVsIG5lZWRzIHRvIGJlIGFuIGluc3RhbmNlIG9mIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwuJyk7XG4gICAgfVxuICAgIGxldCBtb2RlbERvY3VtZW50RnJhZ21lbnQ7XG4gICAgbGV0IHNlbGVjdGlvbiA9IG51bGw7XG4gICAgY29uc3QgbW9kZWxSb290ID0gbW9kZWwuZG9jdW1lbnQuZ2V0Um9vdChvcHRpb25zLnJvb3ROYW1lIHx8ICdtYWluJyk7XG4gICAgLy8gUGFyc2UgZGF0YSBzdHJpbmcgdG8gbW9kZWwuXG4gICAgY29uc3QgcGFyc2VkUmVzdWx0ID0gc2V0RGF0YS5fcGFyc2UoZGF0YSwgbW9kZWwuc2NoZW1hLCB7XG4gICAgICAgIGxhc3RSYW5nZUJhY2t3YXJkOiBvcHRpb25zLmxhc3RSYW5nZUJhY2t3YXJkLFxuICAgICAgICBzZWxlY3Rpb25BdHRyaWJ1dGVzOiBvcHRpb25zLnNlbGVjdGlvbkF0dHJpYnV0ZXMsXG4gICAgICAgIGNvbnRleHQ6IFtcbiAgICAgICAgICAgIG1vZGVsUm9vdC5uYW1lXG4gICAgICAgIF0sXG4gICAgICAgIGlubGluZU9iamVjdEVsZW1lbnRzOiBvcHRpb25zLmlubGluZU9iamVjdEVsZW1lbnRzXG4gICAgfSk7XG4gICAgLy8gUmV0cmlldmUgRG9jdW1lbnRGcmFnbWVudCBhbmQgU2VsZWN0aW9uIGZyb20gcGFyc2VkIG1vZGVsLlxuICAgIGlmICgnbW9kZWwnIGluIHBhcnNlZFJlc3VsdCkge1xuICAgICAgICBtb2RlbERvY3VtZW50RnJhZ21lbnQgPSBwYXJzZWRSZXN1bHQubW9kZWw7XG4gICAgICAgIHNlbGVjdGlvbiA9IHBhcnNlZFJlc3VsdC5zZWxlY3Rpb247XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbW9kZWxEb2N1bWVudEZyYWdtZW50ID0gcGFyc2VkUmVzdWx0O1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5iYXRjaFR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtb2RlbC5lbnF1ZXVlQ2hhbmdlKG9wdGlvbnMuYmF0Y2hUeXBlLCB3cml0ZVRvTW9kZWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG1vZGVsLmNoYW5nZSh3cml0ZVRvTW9kZWwpO1xuICAgIH1cbiAgICBmdW5jdGlvbiB3cml0ZVRvTW9kZWwod3JpdGVyKSB7XG4gICAgICAgIC8vIFJlcGxhY2UgZXhpc3RpbmcgbW9kZWwgaW4gZG9jdW1lbnQgYnkgbmV3IG9uZS5cbiAgICAgICAgd3JpdGVyLnJlbW92ZSh3cml0ZXIuY3JlYXRlUmFuZ2VJbihtb2RlbFJvb3QpKTtcbiAgICAgICAgd3JpdGVyLmluc2VydChtb2RlbERvY3VtZW50RnJhZ21lbnQsIG1vZGVsUm9vdCk7XG4gICAgICAgIC8vIENsZWFuIHVwIHByZXZpb3VzIGRvY3VtZW50IHNlbGVjdGlvbi5cbiAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihudWxsKTtcbiAgICAgICAgd3JpdGVyLnJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZShtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0QXR0cmlidXRlS2V5cygpKTtcbiAgICAgICAgLy8gVXBkYXRlIGRvY3VtZW50IHNlbGVjdGlvbiBpZiBzcGVjaWZpZWQuXG4gICAgICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlcyA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiBzZWxlY3Rpb24uZ2V0UmFuZ2VzKCkpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IFBvc2l0aW9uKG1vZGVsUm9vdCwgcmFuZ2Uuc3RhcnQucGF0aCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5kID0gbmV3IFBvc2l0aW9uKG1vZGVsUm9vdCwgcmFuZ2UuZW5kLnBhdGgpO1xuICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShzdGFydCwgZW5kKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKHJhbmdlcywge1xuICAgICAgICAgICAgICAgIGJhY2t3YXJkOiBzZWxlY3Rpb24uaXNCYWNrd2FyZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5zZWxlY3Rpb25BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbkF0dHJpYnV0ZShzZWxlY3Rpb24uZ2V0QXR0cmlidXRlcygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIFNldCBwYXJzZSBhcyBzZXREYXRhIHByaXZhdGUgbWV0aG9kIC0gbmVlZGVkIGZvciB0ZXN0aW5nL3NweWluZy5cbnNldERhdGEuX3BhcnNlID0gcGFyc2U7XG4vKipcbiAqIENvbnZlcnRzIG1vZGVsIG5vZGVzIHRvIEhUTUwtbGlrZSBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG4gKlxuICogKipOb3RlOioqIEEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0IHRleHR9IG5vZGUgdGhhdCBjb250YWlucyBhdHRyaWJ1dGVzIHdpbGwgYmUgcmVwcmVzZW50ZWQgYXM6XG4gKlxuICogYGBgeG1sXG4gKiA8JHRleHQgYXR0cmlidXRlPVwidmFsdWVcIj5UZXh0IGRhdGE8LyR0ZXh0PlxuICogYGBgXG4gKlxuICogQHBhcmFtIG5vZGUgQSBub2RlIHRvIHN0cmluZ2lmeS5cbiAqIEBwYXJhbSBzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSBBIHNlbGVjdGlvbiBpbnN0YW5jZSB3aG9zZSByYW5nZXMgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmV0dXJuZWQgc3RyaW5nIGRhdGEuXG4gKiBJZiBhIHJhbmdlIGluc3RhbmNlIGlzIHByb3ZpZGVkLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIHNlbGVjdGlvbiBjb250YWluaW5nIHRoaXMgcmFuZ2UuIElmIGEgcG9zaXRpb24gaW5zdGFuY2VcbiAqIGlzIHByb3ZpZGVkLCBpdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIHNlbGVjdGlvbiBjb250YWluaW5nIG9uZSByYW5nZSBjb2xsYXBzZWQgYXQgdGhpcyBwb3NpdGlvbi5cbiAqIEBwYXJhbSBtYXJrZXJzIE1hcmtlcnMgdG8gaW5jbHVkZS5cbiAqIEByZXR1cm5zIEFuIEhUTUwtbGlrZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBtb2RlbC5cbiAqLyBmdW5jdGlvbiBzdHJpbmdpZnkobm9kZSwgc2VsZWN0aW9uT3JQb3NpdGlvbk9yUmFuZ2UgPSBudWxsLCBtYXJrZXJzID0gbnVsbCkge1xuICAgIGNvbnN0IG1vZGVsID0gbmV3IE1vZGVsKCk7XG4gICAgY29uc3QgbWFwcGVyID0gbmV3IE1hcHBlcigpO1xuICAgIGxldCBzZWxlY3Rpb24gPSBudWxsO1xuICAgIGxldCByYW5nZTtcbiAgICAvLyBDcmVhdGUgYSByYW5nZSB3aXRjaCB3cmFwcyBwYXNzZWQgbm9kZS5cbiAgICBpZiAobm9kZSBpbnN0YW5jZW9mIFJvb3RFbGVtZW50IHx8IG5vZGUgaW5zdGFuY2VvZiBEb2N1bWVudEZyYWdtZW50KSB7XG4gICAgICAgIHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2VJbihub2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb2RlIGlzIGRldGFjaGVkIC0gY3JlYXRlIG5ldyBkb2N1bWVudCBmcmFnbWVudC5cbiAgICAgICAgaWYgKCFub2RlLnBhcmVudCkge1xuICAgICAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBuZXcgRG9jdW1lbnRGcmFnbWVudChub2RlKTtcbiAgICAgICAgICAgIHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2VJbihmcmFnbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByYW5nZSA9IG5ldyBSYW5nZShtb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShub2RlKSwgbW9kZWwuY3JlYXRlUG9zaXRpb25BZnRlcihub2RlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gR2V0IHNlbGVjdGlvbiBmcm9tIHBhc3NlZCBzZWxlY3Rpb24gb3IgcG9zaXRpb24gb3IgcmFuZ2UgaWYgYXQgbGVhc3Qgb25lIGlzIHNwZWNpZmllZC5cbiAgICBpZiAoc2VsZWN0aW9uT3JQb3NpdGlvbk9yUmFuZ2UgaW5zdGFuY2VvZiBTZWxlY3Rpb24pIHtcbiAgICAgICAgc2VsZWN0aW9uID0gc2VsZWN0aW9uT3JQb3NpdGlvbk9yUmFuZ2U7XG4gICAgfSBlbHNlIGlmIChzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uKSB7XG4gICAgICAgIHNlbGVjdGlvbiA9IHNlbGVjdGlvbk9yUG9zaXRpb25PclJhbmdlO1xuICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uT3JQb3NpdGlvbk9yUmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkge1xuICAgICAgICBzZWxlY3Rpb24gPSBuZXcgU2VsZWN0aW9uKHNlbGVjdGlvbk9yUG9zaXRpb25PclJhbmdlKTtcbiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbk9yUG9zaXRpb25PclJhbmdlIGluc3RhbmNlb2YgUG9zaXRpb24pIHtcbiAgICAgICAgc2VsZWN0aW9uID0gbmV3IFNlbGVjdGlvbihzZWxlY3Rpb25PclBvc2l0aW9uT3JSYW5nZSk7XG4gICAgfVxuICAgIC8vIFNldCB1cCBjb252ZXJzaW9uLlxuICAgIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSB2aWV3IGNvbnRyb2xsZXIuXG4gICAgY29uc3Qgc3R5bGVzUHJvY2Vzc29yID0gbmV3IFN0eWxlc1Byb2Nlc3NvcigpO1xuICAgIGNvbnN0IHZpZXcgPSBuZXcgVmlldyhzdHlsZXNQcm9jZXNzb3IpO1xuICAgIGNvbnN0IHZpZXdEb2N1bWVudCA9IHZpZXcuZG9jdW1lbnQ7XG4gICAgY29uc3Qgdmlld1Jvb3QgPSBuZXcgUm9vdEVkaXRhYmxlRWxlbWVudCh2aWV3RG9jdW1lbnQsICdkaXYnKTtcbiAgICAvLyBDcmVhdGUgYSB0ZW1wb3Jhcnkgcm9vdCBlbGVtZW50IGluIHZpZXcgZG9jdW1lbnQuXG4gICAgdmlld1Jvb3Qucm9vdE5hbWUgPSAnbWFpbic7XG4gICAgdmlld0RvY3VtZW50LnJvb3RzLmFkZCh2aWV3Um9vdCk7XG4gICAgLy8gQ3JlYXRlIGFuZCBzZXR1cCBkb3duY2FzdCBkaXNwYXRjaGVyLlxuICAgIGNvbnN0IGRvd25jYXN0RGlzcGF0Y2hlciA9IG5ldyBEb3duY2FzdERpc3BhdGNoZXIoe1xuICAgICAgICBtYXBwZXIsXG4gICAgICAgIHNjaGVtYTogbW9kZWwuc2NoZW1hXG4gICAgfSk7XG4gICAgLy8gQmluZCByb290IGVsZW1lbnRzLlxuICAgIG1hcHBlci5iaW5kRWxlbWVudHMobm9kZS5yb290LCB2aWV3Um9vdCk7XG4gICAgZG93bmNhc3REaXNwYXRjaGVyLm9uKCdpbnNlcnQ6JHRleHQnLCBpbnNlcnRUZXh0KCkpO1xuICAgIGRvd25jYXN0RGlzcGF0Y2hlci5vbignaW5zZXJ0JywgaW5zZXJ0QXR0cmlidXRlc0FuZENoaWxkcmVuKCksIHtcbiAgICAgICAgcHJpb3JpdHk6ICdsb3dlc3QnXG4gICAgfSk7XG4gICAgZG93bmNhc3REaXNwYXRjaGVyLm9uKCdhdHRyaWJ1dGUnLCAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBpZiAoZGF0YS5pdGVtIGluc3RhbmNlb2YgU2VsZWN0aW9uIHx8IGRhdGEuaXRlbSBpbnN0YW5jZW9mIERvY3VtZW50U2VsZWN0aW9uIHx8IGRhdGEuaXRlbS5pcygnJHRleHRQcm94eScpKSB7XG4gICAgICAgICAgICBjb25zdCBjb252ZXJ0ZXIgPSB3cmFwKChtb2RlbEF0dHJpYnV0ZVZhbHVlLCB7IHdyaXRlciB9KT0+e1xuICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCgnbW9kZWwtdGV4dC13aXRoLWF0dHJpYnV0ZXMnLCB7XG4gICAgICAgICAgICAgICAgICAgIFtkYXRhLmF0dHJpYnV0ZUtleV06IHN0cmluZ2lmeUF0dHJpYnV0ZVZhbHVlKG1vZGVsQXR0cmlidXRlVmFsdWUpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnZlcnRlcihldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZG93bmNhc3REaXNwYXRjaGVyLm9uKCdpbnNlcnQnLCBpbnNlcnRFbGVtZW50KChtb2RlbEl0ZW0pPT57XG4gICAgICAgIC8vIFN0cmluZ2lmeSBvYmplY3QgdHlwZXMgdmFsdWVzIGZvciBwcm9wZXJseSBkaXNwbGF5IGFzIGFuIG91dHB1dCBzdHJpbmcuXG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBjb252ZXJ0QXR0cmlidXRlcyhtb2RlbEl0ZW0uZ2V0QXR0cmlidXRlcygpLCBzdHJpbmdpZnlBdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICAgIHJldHVybiBuZXcgQ29udGFpbmVyRWxlbWVudCh2aWV3RG9jdW1lbnQsIG1vZGVsSXRlbS5uYW1lLCBhdHRyaWJ1dGVzKTtcbiAgICB9KSk7XG4gICAgZG93bmNhc3REaXNwYXRjaGVyLm9uKCdzZWxlY3Rpb24nLCBjb252ZXJ0UmFuZ2VTZWxlY3Rpb24oKSk7XG4gICAgZG93bmNhc3REaXNwYXRjaGVyLm9uKCdzZWxlY3Rpb24nLCBjb252ZXJ0Q29sbGFwc2VkU2VsZWN0aW9uKCkpO1xuICAgIGRvd25jYXN0RGlzcGF0Y2hlci5vbignYWRkTWFya2VyJywgaW5zZXJ0VUlFbGVtZW50KChkYXRhLCB7IHdyaXRlciB9KT0+e1xuICAgICAgICBjb25zdCBuYW1lID0gZGF0YS5tYXJrZXJOYW1lICsgJzonICsgKGRhdGEuaXNPcGVuaW5nID8gJ3N0YXJ0JyA6ICdlbmQnKTtcbiAgICAgICAgcmV0dXJuIHdyaXRlci5jcmVhdGVVSUVsZW1lbnQobmFtZSk7XG4gICAgfSkpO1xuICAgIGNvbnN0IG1hcmtlcnNNYXAgPSBuZXcgTWFwKCk7XG4gICAgaWYgKG1hcmtlcnMpIHtcbiAgICAgICAgLy8gVG8gcHJvdmlkZSBzdGFibGUgcmVzdWx0cywgc29ydCBtYXJrZXJzIGJ5IG5hbWUuXG4gICAgICAgIGZvciAoY29uc3QgbWFya2VyIG9mIEFycmF5LmZyb20obWFya2Vycykuc29ydCgoYSwgYik9PmEubmFtZSA8IGIubmFtZSA/IDEgOiAtMSkpe1xuICAgICAgICAgICAgbWFya2Vyc01hcC5zZXQobWFya2VyLm5hbWUsIG1hcmtlci5nZXRSYW5nZSgpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBDb252ZXJ0IG1vZGVsIHRvIHZpZXcuXG4gICAgY29uc3Qgd3JpdGVyID0gdmlldy5fd3JpdGVyO1xuICAgIGRvd25jYXN0RGlzcGF0Y2hlci5jb252ZXJ0KHJhbmdlLCBtYXJrZXJzTWFwLCB3cml0ZXIpO1xuICAgIC8vIENvbnZlcnQgbW9kZWwgc2VsZWN0aW9uIHRvIHZpZXcgc2VsZWN0aW9uLlxuICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgZG93bmNhc3REaXNwYXRjaGVyLmNvbnZlcnRTZWxlY3Rpb24oc2VsZWN0aW9uLCBtYXJrZXJzIHx8IG1vZGVsLm1hcmtlcnMsIHdyaXRlcik7XG4gICAgfVxuICAgIC8vIFBhcnNlIHZpZXcgdG8gZGF0YSBzdHJpbmcuXG4gICAgbGV0IGRhdGEgPSBzdHJpbmdpZnkkMSh2aWV3Um9vdCwgdmlld0RvY3VtZW50LnNlbGVjdGlvbiwge1xuICAgICAgICBzYW1lU2VsZWN0aW9uQ2hhcmFjdGVyczogdHJ1ZVxuICAgIH0pO1xuICAgIC8vIFJlbW92aW5nIHVubmVjZXNzYXJ5IDxkaXY+IGFuZCA8L2Rpdj4gYWRkZWQgYmVjYXVzZSBgdmlld1Jvb3RgIHdhcyBhbHNvIHN0cmluZ2lmaWVkIGFsb25nc2lkZSBpbnB1dCBkYXRhLlxuICAgIGRhdGEgPSBkYXRhLnN1YnN0cig1LCBkYXRhLmxlbmd0aCAtIDExKTtcbiAgICB2aWV3LmRlc3Ryb3koKTtcbiAgICAvLyBSZXBsYWNlIHZhbGlkIFhNTCBgbW9kZWwtdGV4dC13aXRoLWF0dHJpYnV0ZXNgIGVsZW1lbnQgbmFtZSB0byBgJHRleHRgLlxuICAgIHJldHVybiBkYXRhLnJlcGxhY2UobmV3IFJlZ0V4cCgnbW9kZWwtdGV4dC13aXRoLWF0dHJpYnV0ZXMnLCAnZycpLCAnJHRleHQnKTtcbn1cbi8qKlxuICogUGFyc2VzIGFuIEhUTUwtbGlrZSBzdHJpbmcgYW5kIHJldHVybnMgdGhlIG1vZGVsIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3Jvb3RlbGVtZW50flJvb3RFbGVtZW50IHJvb3RFbGVtZW50fS5cbiAqXG4gKiAqKk5vdGU6KiogVG8gY3JlYXRlIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvdGV4dH5UZXh0IHRleHR9IG5vZGUgdGhhdCBjb250YWlucyBhdHRyaWJ1dGVzIHVzZTpcbiAqXG4gKiBgYGB4bWxcbiAqIDwkdGV4dCBhdHRyaWJ1dGU9XCJ2YWx1ZVwiPlRleHQgZGF0YTwvJHRleHQ+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gZGF0YSBIVE1MLWxpa2Ugc3RyaW5nIHRvIGJlIHBhcnNlZC5cbiAqIEBwYXJhbSBzY2hlbWEgQSBzY2hlbWEgaW5zdGFuY2UgdXNlZCBieSBjb252ZXJ0ZXJzIGZvciBlbGVtZW50IHZhbGlkYXRpb24uXG4gKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5zZWxlY3Rpb25BdHRyaWJ1dGVzIEEgbGlzdCBvZiBhdHRyaWJ1dGVzIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBzZWxlY3Rpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5sYXN0UmFuZ2VCYWNrd2FyZCBJZiBzZXQgdG8gYHRydWVgLCB0aGUgbGFzdCByYW5nZSB3aWxsIGJlIGFkZGVkIGFzIGJhY2t3YXJkLlxuICogQHBhcmFtIG9wdGlvbnMuY29udGV4dCBUaGUgY29udmVyc2lvbiBjb250ZXh0LiBJZiBub3QgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGAnJHJvb3QnYCB3aWxsIGJlIHVzZWQuXG4gKiBAcmV0dXJucyBSZXR1cm5zIHRoZSBwYXJzZWQgbW9kZWwgbm9kZSBvciBhbiBvYmplY3Qgd2l0aCB0d28gZmllbGRzOiBgbW9kZWxgIGFuZCBgc2VsZWN0aW9uYCxcbiAqIHdoZW4gc2VsZWN0aW9uIHJhbmdlcyB3ZXJlIGluY2x1ZGVkIGluIHRoZSBkYXRhIHRvIHBhcnNlLlxuICovIGZ1bmN0aW9uIHBhcnNlKGRhdGEsIHNjaGVtYSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgbWFwcGVyID0gbmV3IE1hcHBlcigpO1xuICAgIC8vIFJlcGxhY2Ugbm90IGFjY2VwdGVkIGJ5IFhNTCBgJHRleHRgIHRhZyBuYW1lIGJ5IHZhbGlkIG9uZSBgbW9kZWwtdGV4dC13aXRoLWF0dHJpYnV0ZXNgLlxuICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXCR0ZXh0JywgJ2cnKSwgJ21vZGVsLXRleHQtd2l0aC1hdHRyaWJ1dGVzJyk7XG4gICAgLy8gUGFyc2UgZGF0YSB0byB2aWV3IHVzaW5nIHZpZXcgdXRpbHMuXG4gICAgY29uc3QgcGFyc2VkUmVzdWx0ID0gcGFyc2UkMShkYXRhLCB7XG4gICAgICAgIHNhbWVTZWxlY3Rpb25DaGFyYWN0ZXJzOiB0cnVlLFxuICAgICAgICBsYXN0UmFuZ2VCYWNrd2FyZDogISFvcHRpb25zLmxhc3RSYW5nZUJhY2t3YXJkLFxuICAgICAgICBpbmxpbmVPYmplY3RFbGVtZW50czogb3B0aW9ucy5pbmxpbmVPYmplY3RFbGVtZW50c1xuICAgIH0pO1xuICAgIC8vIFJldHJpZXZlIERvY3VtZW50RnJhZ21lbnQgYW5kIFNlbGVjdGlvbiBmcm9tIHBhcnNlZCB2aWV3LlxuICAgIGxldCB2aWV3RG9jdW1lbnRGcmFnbWVudDtcbiAgICBsZXQgdmlld1NlbGVjdGlvbiA9IG51bGw7XG4gICAgbGV0IHNlbGVjdGlvbiA9IG51bGw7XG4gICAgaWYgKCd2aWV3JyBpbiBwYXJzZWRSZXN1bHQgJiYgJ3NlbGVjdGlvbicgaW4gcGFyc2VkUmVzdWx0KSB7XG4gICAgICAgIHZpZXdEb2N1bWVudEZyYWdtZW50ID0gcGFyc2VkUmVzdWx0LnZpZXc7XG4gICAgICAgIHZpZXdTZWxlY3Rpb24gPSBwYXJzZWRSZXN1bHQuc2VsZWN0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHZpZXdEb2N1bWVudEZyYWdtZW50ID0gcGFyc2VkUmVzdWx0O1xuICAgIH1cbiAgICAvLyBTZXQgdXAgdXBjYXN0IGRpc3BhdGNoZXIuXG4gICAgY29uc3QgbW9kZWxDb250cm9sbGVyID0gbmV3IE1vZGVsKCk7XG4gICAgY29uc3QgdXBjYXN0RGlzcGF0Y2hlciA9IG5ldyBVcGNhc3REaXNwYXRjaGVyKHtcbiAgICAgICAgc2NoZW1hXG4gICAgfSk7XG4gICAgdXBjYXN0RGlzcGF0Y2hlci5vbignZG9jdW1lbnRGcmFnbWVudCcsIGNvbnZlcnRUb01vZGVsRnJhZ21lbnQobWFwcGVyKSk7XG4gICAgdXBjYXN0RGlzcGF0Y2hlci5vbignZWxlbWVudDptb2RlbC10ZXh0LXdpdGgtYXR0cmlidXRlcycsIGNvbnZlcnRUb01vZGVsVGV4dCgpKTtcbiAgICB1cGNhc3REaXNwYXRjaGVyLm9uKCdlbGVtZW50JywgY29udmVydFRvTW9kZWxFbGVtZW50KG1hcHBlcikpO1xuICAgIHVwY2FzdERpc3BhdGNoZXIub24oJ3RleHQnLCBjb252ZXJ0VG9Nb2RlbFRleHQoKSk7XG4gICAgLy8gQ29udmVydCB2aWV3IHRvIG1vZGVsLlxuICAgIGxldCBtb2RlbCA9IG1vZGVsQ29udHJvbGxlci5jaGFuZ2UoKHdyaXRlcik9PnVwY2FzdERpc3BhdGNoZXIuY29udmVydCh2aWV3RG9jdW1lbnRGcmFnbWVudC5yb290LCB3cml0ZXIsIG9wdGlvbnMuY29udGV4dCB8fCAnJHJvb3QnKSk7XG4gICAgbWFwcGVyLmJpbmRFbGVtZW50cyhtb2RlbCwgdmlld0RvY3VtZW50RnJhZ21lbnQucm9vdCk7XG4gICAgLy8gSWYgcm9vdCBEb2N1bWVudEZyYWdtZW50IGNvbnRhaW5zIG9ubHkgb25lIGVsZW1lbnQgLSByZXR1cm4gdGhhdCBlbGVtZW50LlxuICAgIGlmIChtb2RlbC5jaGlsZENvdW50ID09IDEpIHtcbiAgICAgICAgbW9kZWwgPSBtb2RlbC5nZXRDaGlsZCgwKTtcbiAgICB9XG4gICAgLy8gQ29udmVydCB2aWV3IHNlbGVjdGlvbiB0byBtb2RlbCBzZWxlY3Rpb24uXG4gICAgaWYgKHZpZXdTZWxlY3Rpb24pIHtcbiAgICAgICAgY29uc3QgcmFuZ2VzID0gW107XG4gICAgICAgIC8vIENvbnZlcnQgcmFuZ2VzLlxuICAgICAgICBmb3IgKGNvbnN0IHZpZXdSYW5nZSBvZiB2aWV3U2VsZWN0aW9uLmdldFJhbmdlcygpKXtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG1hcHBlci50b01vZGVsUmFuZ2Uodmlld1JhbmdlKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBzZWxlY3Rpb24uXG4gICAgICAgIHNlbGVjdGlvbiA9IG5ldyBTZWxlY3Rpb24ocmFuZ2VzLCB7XG4gICAgICAgICAgICBiYWNrd2FyZDogdmlld1NlbGVjdGlvbi5pc0JhY2t3YXJkXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBTZXQgYXR0cmlidXRlcyB0byBzZWxlY3Rpb24gaWYgc3BlY2lmaWVkLlxuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiB0b01hcChvcHRpb25zLnNlbGVjdGlvbkF0dHJpYnV0ZXMgfHwgW10pKXtcbiAgICAgICAgICAgIHNlbGVjdGlvbi5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gUmV0dXJuIG1vZGVsIGVuZCBzZWxlY3Rpb24gd2hlbiBzZWxlY3Rpb24gd2FzIHNwZWNpZmllZC5cbiAgICBpZiAoc2VsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtb2RlbCxcbiAgICAgICAgICAgIHNlbGVjdGlvblxuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBPdGhlcndpc2UgcmV0dXJuIG1vZGVsIG9ubHkuXG4gICAgcmV0dXJuIG1vZGVsO1xufVxuLy8gLS0gQ29udmVydGVycyB2aWV3IC0+IG1vZGVsIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBjb252ZXJ0VG9Nb2RlbEZyYWdtZW50KG1hcHBlcikge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCBjaGlsZHJlblJlc3VsdCA9IGNvbnZlcnNpb25BcGkuY29udmVydENoaWxkcmVuKGRhdGEudmlld0l0ZW0sIGRhdGEubW9kZWxDdXJzb3IpO1xuICAgICAgICBtYXBwZXIuYmluZEVsZW1lbnRzKGRhdGEubW9kZWxDdXJzb3IucGFyZW50LCBkYXRhLnZpZXdJdGVtKTtcbiAgICAgICAgZGF0YSA9IE9iamVjdC5hc3NpZ24oZGF0YSwgY2hpbGRyZW5SZXN1bHQpO1xuICAgICAgICBldnQuc3RvcCgpO1xuICAgIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9Nb2RlbEVsZW1lbnQobWFwcGVyKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IGVsZW1lbnROYW1lID0gZGF0YS52aWV3SXRlbS5uYW1lO1xuICAgICAgICBpZiAoIWNvbnZlcnNpb25BcGkuc2NoZW1hLmNoZWNrQ2hpbGQoZGF0YS5tb2RlbEN1cnNvciwgZWxlbWVudE5hbWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVsZW1lbnQgJyR7ZWxlbWVudE5hbWV9JyB3YXMgbm90IGFsbG93ZWQgaW4gZ2l2ZW4gcG9zaXRpb24uYCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVmlldyBhdHRyaWJ1dGUgdmFsdWUgaXMgYSBzdHJpbmcgc28gd2Ugd2FudCB0byB0eXBlY2FzdCBpdCB0byB0aGUgb3JpZ2luYWwgdHlwZS5cbiAgICAgICAgLy8gRS5nLiBgYm9sZD1cInRydWVcImAgLSB2YWx1ZSB3aWxsIGJlIHBhcnNlZCBmcm9tIHN0cmluZyBgXCJ0cnVlXCJgIHRvIGJvb2xlYW4gYHRydWVgLlxuICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gY29udmVydEF0dHJpYnV0ZXMoZGF0YS52aWV3SXRlbS5nZXRBdHRyaWJ1dGVzKCksIHBhcnNlQXR0cmlidXRlVmFsdWUpO1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlRWxlbWVudChkYXRhLnZpZXdJdGVtLm5hbWUsIGF0dHJpYnV0ZXMpO1xuICAgICAgICBjb252ZXJzaW9uQXBpLndyaXRlci5pbnNlcnQoZWxlbWVudCwgZGF0YS5tb2RlbEN1cnNvcik7XG4gICAgICAgIG1hcHBlci5iaW5kRWxlbWVudHMoZWxlbWVudCwgZGF0YS52aWV3SXRlbSk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkuY29udmVydENoaWxkcmVuKGRhdGEudmlld0l0ZW0sIGVsZW1lbnQpO1xuICAgICAgICBkYXRhLm1vZGVsUmFuZ2UgPSBSYW5nZS5fY3JlYXRlT24oZWxlbWVudCk7XG4gICAgICAgIGRhdGEubW9kZWxDdXJzb3IgPSBkYXRhLm1vZGVsUmFuZ2UuZW5kO1xuICAgICAgICBldnQuc3RvcCgpO1xuICAgIH07XG59XG5mdW5jdGlvbiBjb252ZXJ0VG9Nb2RlbFRleHQoKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5zY2hlbWEuY2hlY2tDaGlsZChkYXRhLm1vZGVsQ3Vyc29yLCAnJHRleHQnKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IHdhcyBub3QgYWxsb3dlZCBpbiBnaXZlbiBwb3NpdGlvbi4nKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbm9kZTtcbiAgICAgICAgaWYgKGRhdGEudmlld0l0ZW0uaXMoJ2VsZW1lbnQnKSkge1xuICAgICAgICAgICAgLy8gVmlldyBhdHRyaWJ1dGUgdmFsdWUgaXMgYSBzdHJpbmcgc28gd2Ugd2FudCB0byB0eXBlY2FzdCBpdCB0byB0aGUgb3JpZ2luYWwgdHlwZS5cbiAgICAgICAgICAgIC8vIEUuZy4gYGJvbGQ9XCJ0cnVlXCJgIC0gdmFsdWUgd2lsbCBiZSBwYXJzZWQgZnJvbSBzdHJpbmcgYFwidHJ1ZVwiYCB0byBib29sZWFuIGB0cnVlYC5cbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBjb252ZXJ0QXR0cmlidXRlcyhkYXRhLnZpZXdJdGVtLmdldEF0dHJpYnV0ZXMoKSwgcGFyc2VBdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICAgICAgICBjb25zdCB2aWV3VGV4dCA9IGRhdGEudmlld0l0ZW0uZ2V0Q2hpbGQoMCk7XG4gICAgICAgICAgICBub2RlID0gY29udmVyc2lvbkFwaS53cml0ZXIuY3JlYXRlVGV4dCh2aWV3VGV4dC5kYXRhLCBhdHRyaWJ1dGVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUgPSBjb252ZXJzaW9uQXBpLndyaXRlci5jcmVhdGVUZXh0KGRhdGEudmlld0l0ZW0uZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuaW5zZXJ0KG5vZGUsIGRhdGEubW9kZWxDdXJzb3IpO1xuICAgICAgICBkYXRhLm1vZGVsUmFuZ2UgPSBSYW5nZS5fY3JlYXRlRnJvbVBvc2l0aW9uQW5kU2hpZnQoZGF0YS5tb2RlbEN1cnNvciwgbm9kZS5vZmZzZXRTaXplKTtcbiAgICAgICAgZGF0YS5tb2RlbEN1cnNvciA9IGRhdGEubW9kZWxSYW5nZS5lbmQ7XG4gICAgICAgIGV2dC5zdG9wKCk7XG4gICAgfTtcbn1cbi8vIFRyaWVzIHRvIGdldCBvcmlnaW5hbCB0eXBlIG9mIGF0dHJpYnV0ZSB2YWx1ZSB1c2luZyBKU09OIHBhcnNpbmc6XG4vL1xuLy9cdFx0YCd0cnVlJ2AgPT4gYHRydWVgXG4vL1x0XHRgJzEnYCA9PiBgMWBcbi8vXHRcdGAne1wieFwiOjEsXCJ5XCI6Mn0nYCA9PiBgeyB4OiAxLCB5OiAyIH1gXG4vL1xuLy8gUGFyc2UgZXJyb3IgbWVhbnMgdGhhdCB2YWx1ZSBzaG91bGQgYmUgYSBzdHJpbmc6XG4vL1xuLy9cdFx0YCdmb29iYXInYCA9PiBgJ2Zvb2JhcidgXG5mdW5jdGlvbiBwYXJzZUF0dHJpYnV0ZVZhbHVlKGF0dHJpYnV0ZSkge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGF0dHJpYnV0ZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gYXR0cmlidXRlO1xuICAgIH1cbn1cbi8vIFdoZW4gdmFsdWUgaXMgYW4gT2JqZWN0IHN0cmluZ2lmeSBpdC5cbmZ1bmN0aW9uIHN0cmluZ2lmeUF0dHJpYnV0ZVZhbHVlKGRhdGEpIHtcbiAgICBpZiAoaXNQbGFpbk9iamVjdChkYXRhKSkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuLy8gTG9vcCB0cm91Z2ggYXR0cmlidXRlcyBtYXAgYW5kIGNvbnZlcnRzIGVhY2ggdmFsdWUgYnkgcGFzc2VkIGNvbnZlcnRlci5cbmZ1bmN0aW9uKiBjb252ZXJ0QXR0cmlidXRlcyhhdHRyaWJ1dGVzLCBjb252ZXJ0ZXIpIHtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBhdHRyaWJ1dGVzKXtcbiAgICAgICAgeWllbGQgW1xuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgY29udmVydGVyKHZhbHVlKVxuICAgICAgICBdO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQXR0cmlidXRlRWxlbWVudCwgQXR0cmlidXRlT3BlcmF0aW9uLCBCdWJibGluZ0V2ZW50SW5mbywgQ2xpY2tPYnNlcnZlciwgQ29udmVyc2lvbiwgRGF0YUNvbnRyb2xsZXIsIERhdGFUcmFuc2ZlciwgRG9jdW1lbnRGcmFnbWVudCwgRG9jdW1lbnRTZWxlY3Rpb24sIERvbUNvbnZlcnRlciwgRG9tRXZlbnREYXRhLCBEb21FdmVudE9ic2VydmVyLCBEb3duY2FzdFdyaXRlciwgRWRpdGluZ0NvbnRyb2xsZXIsIFZpZXcgYXMgRWRpdGluZ1ZpZXcsIEVsZW1lbnQsIEZvY3VzT2JzZXJ2ZXIsIEhpc3RvcnksIEh0bWxEYXRhUHJvY2Vzc29yLCBJbnNlcnRPcGVyYXRpb24sIExpdmVQb3NpdGlvbiwgTGl2ZVJhbmdlLCBNYXJrZXJPcGVyYXRpb24sIE1hdGNoZXIsIE1lcmdlT3BlcmF0aW9uLCBNb2RlbCwgTW91c2VPYnNlcnZlciwgTW92ZU9wZXJhdGlvbiwgTm9PcGVyYXRpb24sIE9ic2VydmVyLCBPcGVyYXRpb25GYWN0b3J5LCBQb3NpdGlvbiwgUmFuZ2UsIFJlbmFtZU9wZXJhdGlvbiwgUmVuZGVyZXIsIFJvb3RBdHRyaWJ1dGVPcGVyYXRpb24sIFJvb3RPcGVyYXRpb24sIFNjaGVtYUNvbnRleHQsIFNwbGl0T3BlcmF0aW9uLCBTdHlsZXNNYXAsIFN0eWxlc1Byb2Nlc3NvciwgVGFiT2JzZXJ2ZXIsIFRleHQsIFRleHRQcm94eSwgVG91Y2hPYnNlcnZlciwgVHJlZVdhbGtlciwgVXBjYXN0V3JpdGVyLCBBdHRyaWJ1dGVFbGVtZW50IGFzIFZpZXdBdHRyaWJ1dGVFbGVtZW50LCBDb250YWluZXJFbGVtZW50IGFzIFZpZXdDb250YWluZXJFbGVtZW50LCBEb2N1bWVudCQxIGFzIFZpZXdEb2N1bWVudCwgRG9jdW1lbnRGcmFnbWVudCQxIGFzIFZpZXdEb2N1bWVudEZyYWdtZW50LCBFZGl0YWJsZUVsZW1lbnQgYXMgVmlld0VkaXRhYmxlRWxlbWVudCwgRWxlbWVudCQxIGFzIFZpZXdFbGVtZW50LCBFbXB0eUVsZW1lbnQgYXMgVmlld0VtcHR5RWxlbWVudCwgUmF3RWxlbWVudCBhcyBWaWV3UmF3RWxlbWVudCwgUm9vdEVkaXRhYmxlRWxlbWVudCBhcyBWaWV3Um9vdEVkaXRhYmxlRWxlbWVudCwgVGV4dCQxIGFzIFZpZXdUZXh0LCBUcmVlV2Fsa2VyJDEgYXMgVmlld1RyZWVXYWxrZXIsIFVJRWxlbWVudCBhcyBWaWV3VUlFbGVtZW50LCBYbWxEYXRhUHJvY2Vzc29yLCBnZXREYXRhIGFzIF9nZXRNb2RlbERhdGEsIGdldERhdGEkMSBhcyBfZ2V0Vmlld0RhdGEsIHBhcnNlIGFzIF9wYXJzZU1vZGVsLCBwYXJzZSQxIGFzIF9wYXJzZVZpZXcsIHNldERhdGEgYXMgX3NldE1vZGVsRGF0YSwgc2V0RGF0YSQxIGFzIF9zZXRWaWV3RGF0YSwgc3RyaW5naWZ5IGFzIF9zdHJpbmdpZnlNb2RlbCwgc3RyaW5naWZ5JDEgYXMgX3N0cmluZ2lmeVZpZXcsIGFkZEJhY2tncm91bmRSdWxlcywgYWRkQm9yZGVyUnVsZXMsIGFkZE1hcmdpblJ1bGVzLCBhZGRQYWRkaW5nUnVsZXMsIGF1dG9QYXJhZ3JhcGhFbXB0eVJvb3RzLCBkaXNhYmxlUGxhY2Vob2xkZXIsIGVuYWJsZVBsYWNlaG9sZGVyLCBnZXRCb3hTaWRlc1Nob3J0aGFuZFZhbHVlLCBnZXRCb3hTaWRlc1ZhbHVlUmVkdWNlciwgZ2V0Qm94U2lkZXNWYWx1ZXMsIGdldEZpbGxlck9mZnNldCQ0IGFzIGdldEZpbGxlck9mZnNldCwgZ2V0UG9zaXRpb25TaG9ydGhhbmROb3JtYWxpemVyLCBnZXRTaG9ydGhhbmRWYWx1ZXMsIGhpZGVQbGFjZWhvbGRlciwgaXNBdHRhY2htZW50LCBpc0NvbG9yLCBpc0xlbmd0aCwgaXNMaW5lU3R5bGUsIGlzUGFyYWdyYXBoYWJsZSwgaXNQZXJjZW50YWdlLCBpc1Bvc2l0aW9uLCBpc1JlcGVhdCwgaXNVUkwsIG5lZWRzUGxhY2Vob2xkZXIsIHNob3dQbGFjZWhvbGRlciwgdHJhbnNmb3JtU2V0cywgd3JhcEluUGFyYWdyYXBoIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiIsIid1c2Ugc3RyaWN0J1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblx0XCJhbGljZWJsdWVcIjogWzI0MCwgMjQ4LCAyNTVdLFxyXG5cdFwiYW50aXF1ZXdoaXRlXCI6IFsyNTAsIDIzNSwgMjE1XSxcclxuXHRcImFxdWFcIjogWzAsIDI1NSwgMjU1XSxcclxuXHRcImFxdWFtYXJpbmVcIjogWzEyNywgMjU1LCAyMTJdLFxyXG5cdFwiYXp1cmVcIjogWzI0MCwgMjU1LCAyNTVdLFxyXG5cdFwiYmVpZ2VcIjogWzI0NSwgMjQ1LCAyMjBdLFxyXG5cdFwiYmlzcXVlXCI6IFsyNTUsIDIyOCwgMTk2XSxcclxuXHRcImJsYWNrXCI6IFswLCAwLCAwXSxcclxuXHRcImJsYW5jaGVkYWxtb25kXCI6IFsyNTUsIDIzNSwgMjA1XSxcclxuXHRcImJsdWVcIjogWzAsIDAsIDI1NV0sXHJcblx0XCJibHVldmlvbGV0XCI6IFsxMzgsIDQzLCAyMjZdLFxyXG5cdFwiYnJvd25cIjogWzE2NSwgNDIsIDQyXSxcclxuXHRcImJ1cmx5d29vZFwiOiBbMjIyLCAxODQsIDEzNV0sXHJcblx0XCJjYWRldGJsdWVcIjogWzk1LCAxNTgsIDE2MF0sXHJcblx0XCJjaGFydHJldXNlXCI6IFsxMjcsIDI1NSwgMF0sXHJcblx0XCJjaG9jb2xhdGVcIjogWzIxMCwgMTA1LCAzMF0sXHJcblx0XCJjb3JhbFwiOiBbMjU1LCAxMjcsIDgwXSxcclxuXHRcImNvcm5mbG93ZXJibHVlXCI6IFsxMDAsIDE0OSwgMjM3XSxcclxuXHRcImNvcm5zaWxrXCI6IFsyNTUsIDI0OCwgMjIwXSxcclxuXHRcImNyaW1zb25cIjogWzIyMCwgMjAsIDYwXSxcclxuXHRcImN5YW5cIjogWzAsIDI1NSwgMjU1XSxcclxuXHRcImRhcmtibHVlXCI6IFswLCAwLCAxMzldLFxyXG5cdFwiZGFya2N5YW5cIjogWzAsIDEzOSwgMTM5XSxcclxuXHRcImRhcmtnb2xkZW5yb2RcIjogWzE4NCwgMTM0LCAxMV0sXHJcblx0XCJkYXJrZ3JheVwiOiBbMTY5LCAxNjksIDE2OV0sXHJcblx0XCJkYXJrZ3JlZW5cIjogWzAsIDEwMCwgMF0sXHJcblx0XCJkYXJrZ3JleVwiOiBbMTY5LCAxNjksIDE2OV0sXHJcblx0XCJkYXJra2hha2lcIjogWzE4OSwgMTgzLCAxMDddLFxyXG5cdFwiZGFya21hZ2VudGFcIjogWzEzOSwgMCwgMTM5XSxcclxuXHRcImRhcmtvbGl2ZWdyZWVuXCI6IFs4NSwgMTA3LCA0N10sXHJcblx0XCJkYXJrb3JhbmdlXCI6IFsyNTUsIDE0MCwgMF0sXHJcblx0XCJkYXJrb3JjaGlkXCI6IFsxNTMsIDUwLCAyMDRdLFxyXG5cdFwiZGFya3JlZFwiOiBbMTM5LCAwLCAwXSxcclxuXHRcImRhcmtzYWxtb25cIjogWzIzMywgMTUwLCAxMjJdLFxyXG5cdFwiZGFya3NlYWdyZWVuXCI6IFsxNDMsIDE4OCwgMTQzXSxcclxuXHRcImRhcmtzbGF0ZWJsdWVcIjogWzcyLCA2MSwgMTM5XSxcclxuXHRcImRhcmtzbGF0ZWdyYXlcIjogWzQ3LCA3OSwgNzldLFxyXG5cdFwiZGFya3NsYXRlZ3JleVwiOiBbNDcsIDc5LCA3OV0sXHJcblx0XCJkYXJrdHVycXVvaXNlXCI6IFswLCAyMDYsIDIwOV0sXHJcblx0XCJkYXJrdmlvbGV0XCI6IFsxNDgsIDAsIDIxMV0sXHJcblx0XCJkZWVwcGlua1wiOiBbMjU1LCAyMCwgMTQ3XSxcclxuXHRcImRlZXBza3libHVlXCI6IFswLCAxOTEsIDI1NV0sXHJcblx0XCJkaW1ncmF5XCI6IFsxMDUsIDEwNSwgMTA1XSxcclxuXHRcImRpbWdyZXlcIjogWzEwNSwgMTA1LCAxMDVdLFxyXG5cdFwiZG9kZ2VyYmx1ZVwiOiBbMzAsIDE0NCwgMjU1XSxcclxuXHRcImZpcmVicmlja1wiOiBbMTc4LCAzNCwgMzRdLFxyXG5cdFwiZmxvcmFsd2hpdGVcIjogWzI1NSwgMjUwLCAyNDBdLFxyXG5cdFwiZm9yZXN0Z3JlZW5cIjogWzM0LCAxMzksIDM0XSxcclxuXHRcImZ1Y2hzaWFcIjogWzI1NSwgMCwgMjU1XSxcclxuXHRcImdhaW5zYm9yb1wiOiBbMjIwLCAyMjAsIDIyMF0sXHJcblx0XCJnaG9zdHdoaXRlXCI6IFsyNDgsIDI0OCwgMjU1XSxcclxuXHRcImdvbGRcIjogWzI1NSwgMjE1LCAwXSxcclxuXHRcImdvbGRlbnJvZFwiOiBbMjE4LCAxNjUsIDMyXSxcclxuXHRcImdyYXlcIjogWzEyOCwgMTI4LCAxMjhdLFxyXG5cdFwiZ3JlZW5cIjogWzAsIDEyOCwgMF0sXHJcblx0XCJncmVlbnllbGxvd1wiOiBbMTczLCAyNTUsIDQ3XSxcclxuXHRcImdyZXlcIjogWzEyOCwgMTI4LCAxMjhdLFxyXG5cdFwiaG9uZXlkZXdcIjogWzI0MCwgMjU1LCAyNDBdLFxyXG5cdFwiaG90cGlua1wiOiBbMjU1LCAxMDUsIDE4MF0sXHJcblx0XCJpbmRpYW5yZWRcIjogWzIwNSwgOTIsIDkyXSxcclxuXHRcImluZGlnb1wiOiBbNzUsIDAsIDEzMF0sXHJcblx0XCJpdm9yeVwiOiBbMjU1LCAyNTUsIDI0MF0sXHJcblx0XCJraGFraVwiOiBbMjQwLCAyMzAsIDE0MF0sXHJcblx0XCJsYXZlbmRlclwiOiBbMjMwLCAyMzAsIDI1MF0sXHJcblx0XCJsYXZlbmRlcmJsdXNoXCI6IFsyNTUsIDI0MCwgMjQ1XSxcclxuXHRcImxhd25ncmVlblwiOiBbMTI0LCAyNTIsIDBdLFxyXG5cdFwibGVtb25jaGlmZm9uXCI6IFsyNTUsIDI1MCwgMjA1XSxcclxuXHRcImxpZ2h0Ymx1ZVwiOiBbMTczLCAyMTYsIDIzMF0sXHJcblx0XCJsaWdodGNvcmFsXCI6IFsyNDAsIDEyOCwgMTI4XSxcclxuXHRcImxpZ2h0Y3lhblwiOiBbMjI0LCAyNTUsIDI1NV0sXHJcblx0XCJsaWdodGdvbGRlbnJvZHllbGxvd1wiOiBbMjUwLCAyNTAsIDIxMF0sXHJcblx0XCJsaWdodGdyYXlcIjogWzIxMSwgMjExLCAyMTFdLFxyXG5cdFwibGlnaHRncmVlblwiOiBbMTQ0LCAyMzgsIDE0NF0sXHJcblx0XCJsaWdodGdyZXlcIjogWzIxMSwgMjExLCAyMTFdLFxyXG5cdFwibGlnaHRwaW5rXCI6IFsyNTUsIDE4MiwgMTkzXSxcclxuXHRcImxpZ2h0c2FsbW9uXCI6IFsyNTUsIDE2MCwgMTIyXSxcclxuXHRcImxpZ2h0c2VhZ3JlZW5cIjogWzMyLCAxNzgsIDE3MF0sXHJcblx0XCJsaWdodHNreWJsdWVcIjogWzEzNSwgMjA2LCAyNTBdLFxyXG5cdFwibGlnaHRzbGF0ZWdyYXlcIjogWzExOSwgMTM2LCAxNTNdLFxyXG5cdFwibGlnaHRzbGF0ZWdyZXlcIjogWzExOSwgMTM2LCAxNTNdLFxyXG5cdFwibGlnaHRzdGVlbGJsdWVcIjogWzE3NiwgMTk2LCAyMjJdLFxyXG5cdFwibGlnaHR5ZWxsb3dcIjogWzI1NSwgMjU1LCAyMjRdLFxyXG5cdFwibGltZVwiOiBbMCwgMjU1LCAwXSxcclxuXHRcImxpbWVncmVlblwiOiBbNTAsIDIwNSwgNTBdLFxyXG5cdFwibGluZW5cIjogWzI1MCwgMjQwLCAyMzBdLFxyXG5cdFwibWFnZW50YVwiOiBbMjU1LCAwLCAyNTVdLFxyXG5cdFwibWFyb29uXCI6IFsxMjgsIDAsIDBdLFxyXG5cdFwibWVkaXVtYXF1YW1hcmluZVwiOiBbMTAyLCAyMDUsIDE3MF0sXHJcblx0XCJtZWRpdW1ibHVlXCI6IFswLCAwLCAyMDVdLFxyXG5cdFwibWVkaXVtb3JjaGlkXCI6IFsxODYsIDg1LCAyMTFdLFxyXG5cdFwibWVkaXVtcHVycGxlXCI6IFsxNDcsIDExMiwgMjE5XSxcclxuXHRcIm1lZGl1bXNlYWdyZWVuXCI6IFs2MCwgMTc5LCAxMTNdLFxyXG5cdFwibWVkaXVtc2xhdGVibHVlXCI6IFsxMjMsIDEwNCwgMjM4XSxcclxuXHRcIm1lZGl1bXNwcmluZ2dyZWVuXCI6IFswLCAyNTAsIDE1NF0sXHJcblx0XCJtZWRpdW10dXJxdW9pc2VcIjogWzcyLCAyMDksIDIwNF0sXHJcblx0XCJtZWRpdW12aW9sZXRyZWRcIjogWzE5OSwgMjEsIDEzM10sXHJcblx0XCJtaWRuaWdodGJsdWVcIjogWzI1LCAyNSwgMTEyXSxcclxuXHRcIm1pbnRjcmVhbVwiOiBbMjQ1LCAyNTUsIDI1MF0sXHJcblx0XCJtaXN0eXJvc2VcIjogWzI1NSwgMjI4LCAyMjVdLFxyXG5cdFwibW9jY2FzaW5cIjogWzI1NSwgMjI4LCAxODFdLFxyXG5cdFwibmF2YWpvd2hpdGVcIjogWzI1NSwgMjIyLCAxNzNdLFxyXG5cdFwibmF2eVwiOiBbMCwgMCwgMTI4XSxcclxuXHRcIm9sZGxhY2VcIjogWzI1MywgMjQ1LCAyMzBdLFxyXG5cdFwib2xpdmVcIjogWzEyOCwgMTI4LCAwXSxcclxuXHRcIm9saXZlZHJhYlwiOiBbMTA3LCAxNDIsIDM1XSxcclxuXHRcIm9yYW5nZVwiOiBbMjU1LCAxNjUsIDBdLFxyXG5cdFwib3JhbmdlcmVkXCI6IFsyNTUsIDY5LCAwXSxcclxuXHRcIm9yY2hpZFwiOiBbMjE4LCAxMTIsIDIxNF0sXHJcblx0XCJwYWxlZ29sZGVucm9kXCI6IFsyMzgsIDIzMiwgMTcwXSxcclxuXHRcInBhbGVncmVlblwiOiBbMTUyLCAyNTEsIDE1Ml0sXHJcblx0XCJwYWxldHVycXVvaXNlXCI6IFsxNzUsIDIzOCwgMjM4XSxcclxuXHRcInBhbGV2aW9sZXRyZWRcIjogWzIxOSwgMTEyLCAxNDddLFxyXG5cdFwicGFwYXlhd2hpcFwiOiBbMjU1LCAyMzksIDIxM10sXHJcblx0XCJwZWFjaHB1ZmZcIjogWzI1NSwgMjE4LCAxODVdLFxyXG5cdFwicGVydVwiOiBbMjA1LCAxMzMsIDYzXSxcclxuXHRcInBpbmtcIjogWzI1NSwgMTkyLCAyMDNdLFxyXG5cdFwicGx1bVwiOiBbMjIxLCAxNjAsIDIyMV0sXHJcblx0XCJwb3dkZXJibHVlXCI6IFsxNzYsIDIyNCwgMjMwXSxcclxuXHRcInB1cnBsZVwiOiBbMTI4LCAwLCAxMjhdLFxyXG5cdFwicmViZWNjYXB1cnBsZVwiOiBbMTAyLCA1MSwgMTUzXSxcclxuXHRcInJlZFwiOiBbMjU1LCAwLCAwXSxcclxuXHRcInJvc3licm93blwiOiBbMTg4LCAxNDMsIDE0M10sXHJcblx0XCJyb3lhbGJsdWVcIjogWzY1LCAxMDUsIDIyNV0sXHJcblx0XCJzYWRkbGVicm93blwiOiBbMTM5LCA2OSwgMTldLFxyXG5cdFwic2FsbW9uXCI6IFsyNTAsIDEyOCwgMTE0XSxcclxuXHRcInNhbmR5YnJvd25cIjogWzI0NCwgMTY0LCA5Nl0sXHJcblx0XCJzZWFncmVlblwiOiBbNDYsIDEzOSwgODddLFxyXG5cdFwic2Vhc2hlbGxcIjogWzI1NSwgMjQ1LCAyMzhdLFxyXG5cdFwic2llbm5hXCI6IFsxNjAsIDgyLCA0NV0sXHJcblx0XCJzaWx2ZXJcIjogWzE5MiwgMTkyLCAxOTJdLFxyXG5cdFwic2t5Ymx1ZVwiOiBbMTM1LCAyMDYsIDIzNV0sXHJcblx0XCJzbGF0ZWJsdWVcIjogWzEwNiwgOTAsIDIwNV0sXHJcblx0XCJzbGF0ZWdyYXlcIjogWzExMiwgMTI4LCAxNDRdLFxyXG5cdFwic2xhdGVncmV5XCI6IFsxMTIsIDEyOCwgMTQ0XSxcclxuXHRcInNub3dcIjogWzI1NSwgMjUwLCAyNTBdLFxyXG5cdFwic3ByaW5nZ3JlZW5cIjogWzAsIDI1NSwgMTI3XSxcclxuXHRcInN0ZWVsYmx1ZVwiOiBbNzAsIDEzMCwgMTgwXSxcclxuXHRcInRhblwiOiBbMjEwLCAxODAsIDE0MF0sXHJcblx0XCJ0ZWFsXCI6IFswLCAxMjgsIDEyOF0sXHJcblx0XCJ0aGlzdGxlXCI6IFsyMTYsIDE5MSwgMjE2XSxcclxuXHRcInRvbWF0b1wiOiBbMjU1LCA5OSwgNzFdLFxyXG5cdFwidHVycXVvaXNlXCI6IFs2NCwgMjI0LCAyMDhdLFxyXG5cdFwidmlvbGV0XCI6IFsyMzgsIDEzMCwgMjM4XSxcclxuXHRcIndoZWF0XCI6IFsyNDUsIDIyMiwgMTc5XSxcclxuXHRcIndoaXRlXCI6IFsyNTUsIDI1NSwgMjU1XSxcclxuXHRcIndoaXRlc21va2VcIjogWzI0NSwgMjQ1LCAyNDVdLFxyXG5cdFwieWVsbG93XCI6IFsyNTUsIDI1NSwgMF0sXHJcblx0XCJ5ZWxsb3dncmVlblwiOiBbMTU0LCAyMDUsIDUwXVxyXG59O1xyXG4iLCIvKiBNSVQgbGljZW5zZSAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tbWl4ZWQtb3BlcmF0b3JzICovXG5jb25zdCBjc3NLZXl3b3JkcyA9IHJlcXVpcmUoJ2NvbG9yLW5hbWUnKTtcblxuLy8gTk9URTogY29udmVyc2lvbnMgc2hvdWxkIG9ubHkgcmV0dXJuIHByaW1pdGl2ZSB2YWx1ZXMgKGkuZS4gYXJyYXlzLCBvclxuLy8gICAgICAgdmFsdWVzIHRoYXQgZ2l2ZSBjb3JyZWN0IGB0eXBlb2ZgIHJlc3VsdHMpLlxuLy8gICAgICAgZG8gbm90IHVzZSBib3ggdmFsdWVzIHR5cGVzIChpLmUuIE51bWJlcigpLCBTdHJpbmcoKSwgZXRjLilcblxuY29uc3QgcmV2ZXJzZUtleXdvcmRzID0ge307XG5mb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhjc3NLZXl3b3JkcykpIHtcblx0cmV2ZXJzZUtleXdvcmRzW2Nzc0tleXdvcmRzW2tleV1dID0ga2V5O1xufVxuXG5jb25zdCBjb252ZXJ0ID0ge1xuXHRyZ2I6IHtjaGFubmVsczogMywgbGFiZWxzOiAncmdiJ30sXG5cdGhzbDoge2NoYW5uZWxzOiAzLCBsYWJlbHM6ICdoc2wnfSxcblx0aHN2OiB7Y2hhbm5lbHM6IDMsIGxhYmVsczogJ2hzdid9LFxuXHRod2I6IHtjaGFubmVsczogMywgbGFiZWxzOiAnaHdiJ30sXG5cdGNteWs6IHtjaGFubmVsczogNCwgbGFiZWxzOiAnY215ayd9LFxuXHR4eXo6IHtjaGFubmVsczogMywgbGFiZWxzOiAneHl6J30sXG5cdGxhYjoge2NoYW5uZWxzOiAzLCBsYWJlbHM6ICdsYWInfSxcblx0bGNoOiB7Y2hhbm5lbHM6IDMsIGxhYmVsczogJ2xjaCd9LFxuXHRoZXg6IHtjaGFubmVsczogMSwgbGFiZWxzOiBbJ2hleCddfSxcblx0a2V5d29yZDoge2NoYW5uZWxzOiAxLCBsYWJlbHM6IFsna2V5d29yZCddfSxcblx0YW5zaTE2OiB7Y2hhbm5lbHM6IDEsIGxhYmVsczogWydhbnNpMTYnXX0sXG5cdGFuc2kyNTY6IHtjaGFubmVsczogMSwgbGFiZWxzOiBbJ2Fuc2kyNTYnXX0sXG5cdGhjZzoge2NoYW5uZWxzOiAzLCBsYWJlbHM6IFsnaCcsICdjJywgJ2cnXX0sXG5cdGFwcGxlOiB7Y2hhbm5lbHM6IDMsIGxhYmVsczogWydyMTYnLCAnZzE2JywgJ2IxNiddfSxcblx0Z3JheToge2NoYW5uZWxzOiAxLCBsYWJlbHM6IFsnZ3JheSddfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBjb252ZXJ0O1xuXG4vLyBIaWRlIC5jaGFubmVscyBhbmQgLmxhYmVscyBwcm9wZXJ0aWVzXG5mb3IgKGNvbnN0IG1vZGVsIG9mIE9iamVjdC5rZXlzKGNvbnZlcnQpKSB7XG5cdGlmICghKCdjaGFubmVscycgaW4gY29udmVydFttb2RlbF0pKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdtaXNzaW5nIGNoYW5uZWxzIHByb3BlcnR5OiAnICsgbW9kZWwpO1xuXHR9XG5cblx0aWYgKCEoJ2xhYmVscycgaW4gY29udmVydFttb2RlbF0pKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdtaXNzaW5nIGNoYW5uZWwgbGFiZWxzIHByb3BlcnR5OiAnICsgbW9kZWwpO1xuXHR9XG5cblx0aWYgKGNvbnZlcnRbbW9kZWxdLmxhYmVscy5sZW5ndGggIT09IGNvbnZlcnRbbW9kZWxdLmNoYW5uZWxzKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdjaGFubmVsIGFuZCBsYWJlbCBjb3VudHMgbWlzbWF0Y2g6ICcgKyBtb2RlbCk7XG5cdH1cblxuXHRjb25zdCB7Y2hhbm5lbHMsIGxhYmVsc30gPSBjb252ZXJ0W21vZGVsXTtcblx0ZGVsZXRlIGNvbnZlcnRbbW9kZWxdLmNoYW5uZWxzO1xuXHRkZWxldGUgY29udmVydFttb2RlbF0ubGFiZWxzO1xuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoY29udmVydFttb2RlbF0sICdjaGFubmVscycsIHt2YWx1ZTogY2hhbm5lbHN9KTtcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbnZlcnRbbW9kZWxdLCAnbGFiZWxzJywge3ZhbHVlOiBsYWJlbHN9KTtcbn1cblxuY29udmVydC5yZ2IuaHNsID0gZnVuY3Rpb24gKHJnYikge1xuXHRjb25zdCByID0gcmdiWzBdIC8gMjU1O1xuXHRjb25zdCBnID0gcmdiWzFdIC8gMjU1O1xuXHRjb25zdCBiID0gcmdiWzJdIC8gMjU1O1xuXHRjb25zdCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcblx0Y29uc3QgbWF4ID0gTWF0aC5tYXgociwgZywgYik7XG5cdGNvbnN0IGRlbHRhID0gbWF4IC0gbWluO1xuXHRsZXQgaDtcblx0bGV0IHM7XG5cblx0aWYgKG1heCA9PT0gbWluKSB7XG5cdFx0aCA9IDA7XG5cdH0gZWxzZSBpZiAociA9PT0gbWF4KSB7XG5cdFx0aCA9IChnIC0gYikgLyBkZWx0YTtcblx0fSBlbHNlIGlmIChnID09PSBtYXgpIHtcblx0XHRoID0gMiArIChiIC0gcikgLyBkZWx0YTtcblx0fSBlbHNlIGlmIChiID09PSBtYXgpIHtcblx0XHRoID0gNCArIChyIC0gZykgLyBkZWx0YTtcblx0fVxuXG5cdGggPSBNYXRoLm1pbihoICogNjAsIDM2MCk7XG5cblx0aWYgKGggPCAwKSB7XG5cdFx0aCArPSAzNjA7XG5cdH1cblxuXHRjb25zdCBsID0gKG1pbiArIG1heCkgLyAyO1xuXG5cdGlmIChtYXggPT09IG1pbikge1xuXHRcdHMgPSAwO1xuXHR9IGVsc2UgaWYgKGwgPD0gMC41KSB7XG5cdFx0cyA9IGRlbHRhIC8gKG1heCArIG1pbik7XG5cdH0gZWxzZSB7XG5cdFx0cyA9IGRlbHRhIC8gKDIgLSBtYXggLSBtaW4pO1xuXHR9XG5cblx0cmV0dXJuIFtoLCBzICogMTAwLCBsICogMTAwXTtcbn07XG5cbmNvbnZlcnQucmdiLmhzdiA9IGZ1bmN0aW9uIChyZ2IpIHtcblx0bGV0IHJkaWY7XG5cdGxldCBnZGlmO1xuXHRsZXQgYmRpZjtcblx0bGV0IGg7XG5cdGxldCBzO1xuXG5cdGNvbnN0IHIgPSByZ2JbMF0gLyAyNTU7XG5cdGNvbnN0IGcgPSByZ2JbMV0gLyAyNTU7XG5cdGNvbnN0IGIgPSByZ2JbMl0gLyAyNTU7XG5cdGNvbnN0IHYgPSBNYXRoLm1heChyLCBnLCBiKTtcblx0Y29uc3QgZGlmZiA9IHYgLSBNYXRoLm1pbihyLCBnLCBiKTtcblx0Y29uc3QgZGlmZmMgPSBmdW5jdGlvbiAoYykge1xuXHRcdHJldHVybiAodiAtIGMpIC8gNiAvIGRpZmYgKyAxIC8gMjtcblx0fTtcblxuXHRpZiAoZGlmZiA9PT0gMCkge1xuXHRcdGggPSAwO1xuXHRcdHMgPSAwO1xuXHR9IGVsc2Uge1xuXHRcdHMgPSBkaWZmIC8gdjtcblx0XHRyZGlmID0gZGlmZmMocik7XG5cdFx0Z2RpZiA9IGRpZmZjKGcpO1xuXHRcdGJkaWYgPSBkaWZmYyhiKTtcblxuXHRcdGlmIChyID09PSB2KSB7XG5cdFx0XHRoID0gYmRpZiAtIGdkaWY7XG5cdFx0fSBlbHNlIGlmIChnID09PSB2KSB7XG5cdFx0XHRoID0gKDEgLyAzKSArIHJkaWYgLSBiZGlmO1xuXHRcdH0gZWxzZSBpZiAoYiA9PT0gdikge1xuXHRcdFx0aCA9ICgyIC8gMykgKyBnZGlmIC0gcmRpZjtcblx0XHR9XG5cblx0XHRpZiAoaCA8IDApIHtcblx0XHRcdGggKz0gMTtcblx0XHR9IGVsc2UgaWYgKGggPiAxKSB7XG5cdFx0XHRoIC09IDE7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIFtcblx0XHRoICogMzYwLFxuXHRcdHMgKiAxMDAsXG5cdFx0diAqIDEwMFxuXHRdO1xufTtcblxuY29udmVydC5yZ2IuaHdiID0gZnVuY3Rpb24gKHJnYikge1xuXHRjb25zdCByID0gcmdiWzBdO1xuXHRjb25zdCBnID0gcmdiWzFdO1xuXHRsZXQgYiA9IHJnYlsyXTtcblx0Y29uc3QgaCA9IGNvbnZlcnQucmdiLmhzbChyZ2IpWzBdO1xuXHRjb25zdCB3ID0gMSAvIDI1NSAqIE1hdGgubWluKHIsIE1hdGgubWluKGcsIGIpKTtcblxuXHRiID0gMSAtIDEgLyAyNTUgKiBNYXRoLm1heChyLCBNYXRoLm1heChnLCBiKSk7XG5cblx0cmV0dXJuIFtoLCB3ICogMTAwLCBiICogMTAwXTtcbn07XG5cbmNvbnZlcnQucmdiLmNteWsgPSBmdW5jdGlvbiAocmdiKSB7XG5cdGNvbnN0IHIgPSByZ2JbMF0gLyAyNTU7XG5cdGNvbnN0IGcgPSByZ2JbMV0gLyAyNTU7XG5cdGNvbnN0IGIgPSByZ2JbMl0gLyAyNTU7XG5cblx0Y29uc3QgayA9IE1hdGgubWluKDEgLSByLCAxIC0gZywgMSAtIGIpO1xuXHRjb25zdCBjID0gKDEgLSByIC0gaykgLyAoMSAtIGspIHx8IDA7XG5cdGNvbnN0IG0gPSAoMSAtIGcgLSBrKSAvICgxIC0gaykgfHwgMDtcblx0Y29uc3QgeSA9ICgxIC0gYiAtIGspIC8gKDEgLSBrKSB8fCAwO1xuXG5cdHJldHVybiBbYyAqIDEwMCwgbSAqIDEwMCwgeSAqIDEwMCwgayAqIDEwMF07XG59O1xuXG5mdW5jdGlvbiBjb21wYXJhdGl2ZURpc3RhbmNlKHgsIHkpIHtcblx0Lypcblx0XHRTZWUgaHR0cHM6Ly9lbi5tLndpa2lwZWRpYS5vcmcvd2lraS9FdWNsaWRlYW5fZGlzdGFuY2UjU3F1YXJlZF9FdWNsaWRlYW5fZGlzdGFuY2Vcblx0Ki9cblx0cmV0dXJuIChcblx0XHQoKHhbMF0gLSB5WzBdKSAqKiAyKSArXG5cdFx0KCh4WzFdIC0geVsxXSkgKiogMikgK1xuXHRcdCgoeFsyXSAtIHlbMl0pICoqIDIpXG5cdCk7XG59XG5cbmNvbnZlcnQucmdiLmtleXdvcmQgPSBmdW5jdGlvbiAocmdiKSB7XG5cdGNvbnN0IHJldmVyc2VkID0gcmV2ZXJzZUtleXdvcmRzW3JnYl07XG5cdGlmIChyZXZlcnNlZCkge1xuXHRcdHJldHVybiByZXZlcnNlZDtcblx0fVxuXG5cdGxldCBjdXJyZW50Q2xvc2VzdERpc3RhbmNlID0gSW5maW5pdHk7XG5cdGxldCBjdXJyZW50Q2xvc2VzdEtleXdvcmQ7XG5cblx0Zm9yIChjb25zdCBrZXl3b3JkIG9mIE9iamVjdC5rZXlzKGNzc0tleXdvcmRzKSkge1xuXHRcdGNvbnN0IHZhbHVlID0gY3NzS2V5d29yZHNba2V5d29yZF07XG5cblx0XHQvLyBDb21wdXRlIGNvbXBhcmF0aXZlIGRpc3RhbmNlXG5cdFx0Y29uc3QgZGlzdGFuY2UgPSBjb21wYXJhdGl2ZURpc3RhbmNlKHJnYiwgdmFsdWUpO1xuXG5cdFx0Ly8gQ2hlY2sgaWYgaXRzIGxlc3MsIGlmIHNvIHNldCBhcyBjbG9zZXN0XG5cdFx0aWYgKGRpc3RhbmNlIDwgY3VycmVudENsb3Nlc3REaXN0YW5jZSkge1xuXHRcdFx0Y3VycmVudENsb3Nlc3REaXN0YW5jZSA9IGRpc3RhbmNlO1xuXHRcdFx0Y3VycmVudENsb3Nlc3RLZXl3b3JkID0ga2V5d29yZDtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gY3VycmVudENsb3Nlc3RLZXl3b3JkO1xufTtcblxuY29udmVydC5rZXl3b3JkLnJnYiA9IGZ1bmN0aW9uIChrZXl3b3JkKSB7XG5cdHJldHVybiBjc3NLZXl3b3Jkc1trZXl3b3JkXTtcbn07XG5cbmNvbnZlcnQucmdiLnh5eiA9IGZ1bmN0aW9uIChyZ2IpIHtcblx0bGV0IHIgPSByZ2JbMF0gLyAyNTU7XG5cdGxldCBnID0gcmdiWzFdIC8gMjU1O1xuXHRsZXQgYiA9IHJnYlsyXSAvIDI1NTtcblxuXHQvLyBBc3N1bWUgc1JHQlxuXHRyID0gciA+IDAuMDQwNDUgPyAoKChyICsgMC4wNTUpIC8gMS4wNTUpICoqIDIuNCkgOiAociAvIDEyLjkyKTtcblx0ZyA9IGcgPiAwLjA0MDQ1ID8gKCgoZyArIDAuMDU1KSAvIDEuMDU1KSAqKiAyLjQpIDogKGcgLyAxMi45Mik7XG5cdGIgPSBiID4gMC4wNDA0NSA/ICgoKGIgKyAwLjA1NSkgLyAxLjA1NSkgKiogMi40KSA6IChiIC8gMTIuOTIpO1xuXG5cdGNvbnN0IHggPSAociAqIDAuNDEyNCkgKyAoZyAqIDAuMzU3NikgKyAoYiAqIDAuMTgwNSk7XG5cdGNvbnN0IHkgPSAociAqIDAuMjEyNikgKyAoZyAqIDAuNzE1MikgKyAoYiAqIDAuMDcyMik7XG5cdGNvbnN0IHogPSAociAqIDAuMDE5MykgKyAoZyAqIDAuMTE5MikgKyAoYiAqIDAuOTUwNSk7XG5cblx0cmV0dXJuIFt4ICogMTAwLCB5ICogMTAwLCB6ICogMTAwXTtcbn07XG5cbmNvbnZlcnQucmdiLmxhYiA9IGZ1bmN0aW9uIChyZ2IpIHtcblx0Y29uc3QgeHl6ID0gY29udmVydC5yZ2IueHl6KHJnYik7XG5cdGxldCB4ID0geHl6WzBdO1xuXHRsZXQgeSA9IHh5elsxXTtcblx0bGV0IHogPSB4eXpbMl07XG5cblx0eCAvPSA5NS4wNDc7XG5cdHkgLz0gMTAwO1xuXHR6IC89IDEwOC44ODM7XG5cblx0eCA9IHggPiAwLjAwODg1NiA/ICh4ICoqICgxIC8gMykpIDogKDcuNzg3ICogeCkgKyAoMTYgLyAxMTYpO1xuXHR5ID0geSA+IDAuMDA4ODU2ID8gKHkgKiogKDEgLyAzKSkgOiAoNy43ODcgKiB5KSArICgxNiAvIDExNik7XG5cdHogPSB6ID4gMC4wMDg4NTYgPyAoeiAqKiAoMSAvIDMpKSA6ICg3Ljc4NyAqIHopICsgKDE2IC8gMTE2KTtcblxuXHRjb25zdCBsID0gKDExNiAqIHkpIC0gMTY7XG5cdGNvbnN0IGEgPSA1MDAgKiAoeCAtIHkpO1xuXHRjb25zdCBiID0gMjAwICogKHkgLSB6KTtcblxuXHRyZXR1cm4gW2wsIGEsIGJdO1xufTtcblxuY29udmVydC5oc2wucmdiID0gZnVuY3Rpb24gKGhzbCkge1xuXHRjb25zdCBoID0gaHNsWzBdIC8gMzYwO1xuXHRjb25zdCBzID0gaHNsWzFdIC8gMTAwO1xuXHRjb25zdCBsID0gaHNsWzJdIC8gMTAwO1xuXHRsZXQgdDI7XG5cdGxldCB0Mztcblx0bGV0IHZhbDtcblxuXHRpZiAocyA9PT0gMCkge1xuXHRcdHZhbCA9IGwgKiAyNTU7XG5cdFx0cmV0dXJuIFt2YWwsIHZhbCwgdmFsXTtcblx0fVxuXG5cdGlmIChsIDwgMC41KSB7XG5cdFx0dDIgPSBsICogKDEgKyBzKTtcblx0fSBlbHNlIHtcblx0XHR0MiA9IGwgKyBzIC0gbCAqIHM7XG5cdH1cblxuXHRjb25zdCB0MSA9IDIgKiBsIC0gdDI7XG5cblx0Y29uc3QgcmdiID0gWzAsIDAsIDBdO1xuXHRmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuXHRcdHQzID0gaCArIDEgLyAzICogLShpIC0gMSk7XG5cdFx0aWYgKHQzIDwgMCkge1xuXHRcdFx0dDMrKztcblx0XHR9XG5cblx0XHRpZiAodDMgPiAxKSB7XG5cdFx0XHR0My0tO1xuXHRcdH1cblxuXHRcdGlmICg2ICogdDMgPCAxKSB7XG5cdFx0XHR2YWwgPSB0MSArICh0MiAtIHQxKSAqIDYgKiB0Mztcblx0XHR9IGVsc2UgaWYgKDIgKiB0MyA8IDEpIHtcblx0XHRcdHZhbCA9IHQyO1xuXHRcdH0gZWxzZSBpZiAoMyAqIHQzIDwgMikge1xuXHRcdFx0dmFsID0gdDEgKyAodDIgLSB0MSkgKiAoMiAvIDMgLSB0MykgKiA2O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2YWwgPSB0MTtcblx0XHR9XG5cblx0XHRyZ2JbaV0gPSB2YWwgKiAyNTU7XG5cdH1cblxuXHRyZXR1cm4gcmdiO1xufTtcblxuY29udmVydC5oc2wuaHN2ID0gZnVuY3Rpb24gKGhzbCkge1xuXHRjb25zdCBoID0gaHNsWzBdO1xuXHRsZXQgcyA9IGhzbFsxXSAvIDEwMDtcblx0bGV0IGwgPSBoc2xbMl0gLyAxMDA7XG5cdGxldCBzbWluID0gcztcblx0Y29uc3QgbG1pbiA9IE1hdGgubWF4KGwsIDAuMDEpO1xuXG5cdGwgKj0gMjtcblx0cyAqPSAobCA8PSAxKSA/IGwgOiAyIC0gbDtcblx0c21pbiAqPSBsbWluIDw9IDEgPyBsbWluIDogMiAtIGxtaW47XG5cdGNvbnN0IHYgPSAobCArIHMpIC8gMjtcblx0Y29uc3Qgc3YgPSBsID09PSAwID8gKDIgKiBzbWluKSAvIChsbWluICsgc21pbikgOiAoMiAqIHMpIC8gKGwgKyBzKTtcblxuXHRyZXR1cm4gW2gsIHN2ICogMTAwLCB2ICogMTAwXTtcbn07XG5cbmNvbnZlcnQuaHN2LnJnYiA9IGZ1bmN0aW9uIChoc3YpIHtcblx0Y29uc3QgaCA9IGhzdlswXSAvIDYwO1xuXHRjb25zdCBzID0gaHN2WzFdIC8gMTAwO1xuXHRsZXQgdiA9IGhzdlsyXSAvIDEwMDtcblx0Y29uc3QgaGkgPSBNYXRoLmZsb29yKGgpICUgNjtcblxuXHRjb25zdCBmID0gaCAtIE1hdGguZmxvb3IoaCk7XG5cdGNvbnN0IHAgPSAyNTUgKiB2ICogKDEgLSBzKTtcblx0Y29uc3QgcSA9IDI1NSAqIHYgKiAoMSAtIChzICogZikpO1xuXHRjb25zdCB0ID0gMjU1ICogdiAqICgxIC0gKHMgKiAoMSAtIGYpKSk7XG5cdHYgKj0gMjU1O1xuXG5cdHN3aXRjaCAoaGkpIHtcblx0XHRjYXNlIDA6XG5cdFx0XHRyZXR1cm4gW3YsIHQsIHBdO1xuXHRcdGNhc2UgMTpcblx0XHRcdHJldHVybiBbcSwgdiwgcF07XG5cdFx0Y2FzZSAyOlxuXHRcdFx0cmV0dXJuIFtwLCB2LCB0XTtcblx0XHRjYXNlIDM6XG5cdFx0XHRyZXR1cm4gW3AsIHEsIHZdO1xuXHRcdGNhc2UgNDpcblx0XHRcdHJldHVybiBbdCwgcCwgdl07XG5cdFx0Y2FzZSA1OlxuXHRcdFx0cmV0dXJuIFt2LCBwLCBxXTtcblx0fVxufTtcblxuY29udmVydC5oc3YuaHNsID0gZnVuY3Rpb24gKGhzdikge1xuXHRjb25zdCBoID0gaHN2WzBdO1xuXHRjb25zdCBzID0gaHN2WzFdIC8gMTAwO1xuXHRjb25zdCB2ID0gaHN2WzJdIC8gMTAwO1xuXHRjb25zdCB2bWluID0gTWF0aC5tYXgodiwgMC4wMSk7XG5cdGxldCBzbDtcblx0bGV0IGw7XG5cblx0bCA9ICgyIC0gcykgKiB2O1xuXHRjb25zdCBsbWluID0gKDIgLSBzKSAqIHZtaW47XG5cdHNsID0gcyAqIHZtaW47XG5cdHNsIC89IChsbWluIDw9IDEpID8gbG1pbiA6IDIgLSBsbWluO1xuXHRzbCA9IHNsIHx8IDA7XG5cdGwgLz0gMjtcblxuXHRyZXR1cm4gW2gsIHNsICogMTAwLCBsICogMTAwXTtcbn07XG5cbi8vIGh0dHA6Ly9kZXYudzMub3JnL2Nzc3dnL2Nzcy1jb2xvci8jaHdiLXRvLXJnYlxuY29udmVydC5od2IucmdiID0gZnVuY3Rpb24gKGh3Yikge1xuXHRjb25zdCBoID0gaHdiWzBdIC8gMzYwO1xuXHRsZXQgd2ggPSBod2JbMV0gLyAxMDA7XG5cdGxldCBibCA9IGh3YlsyXSAvIDEwMDtcblx0Y29uc3QgcmF0aW8gPSB3aCArIGJsO1xuXHRsZXQgZjtcblxuXHQvLyBXaCArIGJsIGNhbnQgYmUgPiAxXG5cdGlmIChyYXRpbyA+IDEpIHtcblx0XHR3aCAvPSByYXRpbztcblx0XHRibCAvPSByYXRpbztcblx0fVxuXG5cdGNvbnN0IGkgPSBNYXRoLmZsb29yKDYgKiBoKTtcblx0Y29uc3QgdiA9IDEgLSBibDtcblx0ZiA9IDYgKiBoIC0gaTtcblxuXHRpZiAoKGkgJiAweDAxKSAhPT0gMCkge1xuXHRcdGYgPSAxIC0gZjtcblx0fVxuXG5cdGNvbnN0IG4gPSB3aCArIGYgKiAodiAtIHdoKTsgLy8gTGluZWFyIGludGVycG9sYXRpb25cblxuXHRsZXQgcjtcblx0bGV0IGc7XG5cdGxldCBiO1xuXHQvKiBlc2xpbnQtZGlzYWJsZSBtYXgtc3RhdGVtZW50cy1wZXItbGluZSxuby1tdWx0aS1zcGFjZXMgKi9cblx0c3dpdGNoIChpKSB7XG5cdFx0ZGVmYXVsdDpcblx0XHRjYXNlIDY6XG5cdFx0Y2FzZSAwOiByID0gdjsgIGcgPSBuOyAgYiA9IHdoOyBicmVhaztcblx0XHRjYXNlIDE6IHIgPSBuOyAgZyA9IHY7ICBiID0gd2g7IGJyZWFrO1xuXHRcdGNhc2UgMjogciA9IHdoOyBnID0gdjsgIGIgPSBuOyBicmVhaztcblx0XHRjYXNlIDM6IHIgPSB3aDsgZyA9IG47ICBiID0gdjsgYnJlYWs7XG5cdFx0Y2FzZSA0OiByID0gbjsgIGcgPSB3aDsgYiA9IHY7IGJyZWFrO1xuXHRcdGNhc2UgNTogciA9IHY7ICBnID0gd2g7IGIgPSBuOyBicmVhaztcblx0fVxuXHQvKiBlc2xpbnQtZW5hYmxlIG1heC1zdGF0ZW1lbnRzLXBlci1saW5lLG5vLW11bHRpLXNwYWNlcyAqL1xuXG5cdHJldHVybiBbciAqIDI1NSwgZyAqIDI1NSwgYiAqIDI1NV07XG59O1xuXG5jb252ZXJ0LmNteWsucmdiID0gZnVuY3Rpb24gKGNteWspIHtcblx0Y29uc3QgYyA9IGNteWtbMF0gLyAxMDA7XG5cdGNvbnN0IG0gPSBjbXlrWzFdIC8gMTAwO1xuXHRjb25zdCB5ID0gY215a1syXSAvIDEwMDtcblx0Y29uc3QgayA9IGNteWtbM10gLyAxMDA7XG5cblx0Y29uc3QgciA9IDEgLSBNYXRoLm1pbigxLCBjICogKDEgLSBrKSArIGspO1xuXHRjb25zdCBnID0gMSAtIE1hdGgubWluKDEsIG0gKiAoMSAtIGspICsgayk7XG5cdGNvbnN0IGIgPSAxIC0gTWF0aC5taW4oMSwgeSAqICgxIC0gaykgKyBrKTtcblxuXHRyZXR1cm4gW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTVdO1xufTtcblxuY29udmVydC54eXoucmdiID0gZnVuY3Rpb24gKHh5eikge1xuXHRjb25zdCB4ID0geHl6WzBdIC8gMTAwO1xuXHRjb25zdCB5ID0geHl6WzFdIC8gMTAwO1xuXHRjb25zdCB6ID0geHl6WzJdIC8gMTAwO1xuXHRsZXQgcjtcblx0bGV0IGc7XG5cdGxldCBiO1xuXG5cdHIgPSAoeCAqIDMuMjQwNikgKyAoeSAqIC0xLjUzNzIpICsgKHogKiAtMC40OTg2KTtcblx0ZyA9ICh4ICogLTAuOTY4OSkgKyAoeSAqIDEuODc1OCkgKyAoeiAqIDAuMDQxNSk7XG5cdGIgPSAoeCAqIDAuMDU1NykgKyAoeSAqIC0wLjIwNDApICsgKHogKiAxLjA1NzApO1xuXG5cdC8vIEFzc3VtZSBzUkdCXG5cdHIgPSByID4gMC4wMDMxMzA4XG5cdFx0PyAoKDEuMDU1ICogKHIgKiogKDEuMCAvIDIuNCkpKSAtIDAuMDU1KVxuXHRcdDogciAqIDEyLjkyO1xuXG5cdGcgPSBnID4gMC4wMDMxMzA4XG5cdFx0PyAoKDEuMDU1ICogKGcgKiogKDEuMCAvIDIuNCkpKSAtIDAuMDU1KVxuXHRcdDogZyAqIDEyLjkyO1xuXG5cdGIgPSBiID4gMC4wMDMxMzA4XG5cdFx0PyAoKDEuMDU1ICogKGIgKiogKDEuMCAvIDIuNCkpKSAtIDAuMDU1KVxuXHRcdDogYiAqIDEyLjkyO1xuXG5cdHIgPSBNYXRoLm1pbihNYXRoLm1heCgwLCByKSwgMSk7XG5cdGcgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBnKSwgMSk7XG5cdGIgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBiKSwgMSk7XG5cblx0cmV0dXJuIFtyICogMjU1LCBnICogMjU1LCBiICogMjU1XTtcbn07XG5cbmNvbnZlcnQueHl6LmxhYiA9IGZ1bmN0aW9uICh4eXopIHtcblx0bGV0IHggPSB4eXpbMF07XG5cdGxldCB5ID0geHl6WzFdO1xuXHRsZXQgeiA9IHh5elsyXTtcblxuXHR4IC89IDk1LjA0Nztcblx0eSAvPSAxMDA7XG5cdHogLz0gMTA4Ljg4MztcblxuXHR4ID0geCA+IDAuMDA4ODU2ID8gKHggKiogKDEgLyAzKSkgOiAoNy43ODcgKiB4KSArICgxNiAvIDExNik7XG5cdHkgPSB5ID4gMC4wMDg4NTYgPyAoeSAqKiAoMSAvIDMpKSA6ICg3Ljc4NyAqIHkpICsgKDE2IC8gMTE2KTtcblx0eiA9IHogPiAwLjAwODg1NiA/ICh6ICoqICgxIC8gMykpIDogKDcuNzg3ICogeikgKyAoMTYgLyAxMTYpO1xuXG5cdGNvbnN0IGwgPSAoMTE2ICogeSkgLSAxNjtcblx0Y29uc3QgYSA9IDUwMCAqICh4IC0geSk7XG5cdGNvbnN0IGIgPSAyMDAgKiAoeSAtIHopO1xuXG5cdHJldHVybiBbbCwgYSwgYl07XG59O1xuXG5jb252ZXJ0LmxhYi54eXogPSBmdW5jdGlvbiAobGFiKSB7XG5cdGNvbnN0IGwgPSBsYWJbMF07XG5cdGNvbnN0IGEgPSBsYWJbMV07XG5cdGNvbnN0IGIgPSBsYWJbMl07XG5cdGxldCB4O1xuXHRsZXQgeTtcblx0bGV0IHo7XG5cblx0eSA9IChsICsgMTYpIC8gMTE2O1xuXHR4ID0gYSAvIDUwMCArIHk7XG5cdHogPSB5IC0gYiAvIDIwMDtcblxuXHRjb25zdCB5MiA9IHkgKiogMztcblx0Y29uc3QgeDIgPSB4ICoqIDM7XG5cdGNvbnN0IHoyID0geiAqKiAzO1xuXHR5ID0geTIgPiAwLjAwODg1NiA/IHkyIDogKHkgLSAxNiAvIDExNikgLyA3Ljc4Nztcblx0eCA9IHgyID4gMC4wMDg4NTYgPyB4MiA6ICh4IC0gMTYgLyAxMTYpIC8gNy43ODc7XG5cdHogPSB6MiA+IDAuMDA4ODU2ID8gejIgOiAoeiAtIDE2IC8gMTE2KSAvIDcuNzg3O1xuXG5cdHggKj0gOTUuMDQ3O1xuXHR5ICo9IDEwMDtcblx0eiAqPSAxMDguODgzO1xuXG5cdHJldHVybiBbeCwgeSwgel07XG59O1xuXG5jb252ZXJ0LmxhYi5sY2ggPSBmdW5jdGlvbiAobGFiKSB7XG5cdGNvbnN0IGwgPSBsYWJbMF07XG5cdGNvbnN0IGEgPSBsYWJbMV07XG5cdGNvbnN0IGIgPSBsYWJbMl07XG5cdGxldCBoO1xuXG5cdGNvbnN0IGhyID0gTWF0aC5hdGFuMihiLCBhKTtcblx0aCA9IGhyICogMzYwIC8gMiAvIE1hdGguUEk7XG5cblx0aWYgKGggPCAwKSB7XG5cdFx0aCArPSAzNjA7XG5cdH1cblxuXHRjb25zdCBjID0gTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpO1xuXG5cdHJldHVybiBbbCwgYywgaF07XG59O1xuXG5jb252ZXJ0LmxjaC5sYWIgPSBmdW5jdGlvbiAobGNoKSB7XG5cdGNvbnN0IGwgPSBsY2hbMF07XG5cdGNvbnN0IGMgPSBsY2hbMV07XG5cdGNvbnN0IGggPSBsY2hbMl07XG5cblx0Y29uc3QgaHIgPSBoIC8gMzYwICogMiAqIE1hdGguUEk7XG5cdGNvbnN0IGEgPSBjICogTWF0aC5jb3MoaHIpO1xuXHRjb25zdCBiID0gYyAqIE1hdGguc2luKGhyKTtcblxuXHRyZXR1cm4gW2wsIGEsIGJdO1xufTtcblxuY29udmVydC5yZ2IuYW5zaTE2ID0gZnVuY3Rpb24gKGFyZ3MsIHNhdHVyYXRpb24gPSBudWxsKSB7XG5cdGNvbnN0IFtyLCBnLCBiXSA9IGFyZ3M7XG5cdGxldCB2YWx1ZSA9IHNhdHVyYXRpb24gPT09IG51bGwgPyBjb252ZXJ0LnJnYi5oc3YoYXJncylbMl0gOiBzYXR1cmF0aW9uOyAvLyBIc3YgLT4gYW5zaTE2IG9wdGltaXphdGlvblxuXG5cdHZhbHVlID0gTWF0aC5yb3VuZCh2YWx1ZSAvIDUwKTtcblxuXHRpZiAodmFsdWUgPT09IDApIHtcblx0XHRyZXR1cm4gMzA7XG5cdH1cblxuXHRsZXQgYW5zaSA9IDMwXG5cdFx0KyAoKE1hdGgucm91bmQoYiAvIDI1NSkgPDwgMilcblx0XHR8IChNYXRoLnJvdW5kKGcgLyAyNTUpIDw8IDEpXG5cdFx0fCBNYXRoLnJvdW5kKHIgLyAyNTUpKTtcblxuXHRpZiAodmFsdWUgPT09IDIpIHtcblx0XHRhbnNpICs9IDYwO1xuXHR9XG5cblx0cmV0dXJuIGFuc2k7XG59O1xuXG5jb252ZXJ0Lmhzdi5hbnNpMTYgPSBmdW5jdGlvbiAoYXJncykge1xuXHQvLyBPcHRpbWl6YXRpb24gaGVyZTsgd2UgYWxyZWFkeSBrbm93IHRoZSB2YWx1ZSBhbmQgZG9uJ3QgbmVlZCB0byBnZXRcblx0Ly8gaXQgY29udmVydGVkIGZvciB1cy5cblx0cmV0dXJuIGNvbnZlcnQucmdiLmFuc2kxNihjb252ZXJ0Lmhzdi5yZ2IoYXJncyksIGFyZ3NbMl0pO1xufTtcblxuY29udmVydC5yZ2IuYW5zaTI1NiA9IGZ1bmN0aW9uIChhcmdzKSB7XG5cdGNvbnN0IHIgPSBhcmdzWzBdO1xuXHRjb25zdCBnID0gYXJnc1sxXTtcblx0Y29uc3QgYiA9IGFyZ3NbMl07XG5cblx0Ly8gV2UgdXNlIHRoZSBleHRlbmRlZCBncmV5c2NhbGUgcGFsZXR0ZSBoZXJlLCB3aXRoIHRoZSBleGNlcHRpb24gb2Zcblx0Ly8gYmxhY2sgYW5kIHdoaXRlLiBub3JtYWwgcGFsZXR0ZSBvbmx5IGhhcyA0IGdyZXlzY2FsZSBzaGFkZXMuXG5cdGlmIChyID09PSBnICYmIGcgPT09IGIpIHtcblx0XHRpZiAociA8IDgpIHtcblx0XHRcdHJldHVybiAxNjtcblx0XHR9XG5cblx0XHRpZiAociA+IDI0OCkge1xuXHRcdFx0cmV0dXJuIDIzMTtcblx0XHR9XG5cblx0XHRyZXR1cm4gTWF0aC5yb3VuZCgoKHIgLSA4KSAvIDI0NykgKiAyNCkgKyAyMzI7XG5cdH1cblxuXHRjb25zdCBhbnNpID0gMTZcblx0XHQrICgzNiAqIE1hdGgucm91bmQociAvIDI1NSAqIDUpKVxuXHRcdCsgKDYgKiBNYXRoLnJvdW5kKGcgLyAyNTUgKiA1KSlcblx0XHQrIE1hdGgucm91bmQoYiAvIDI1NSAqIDUpO1xuXG5cdHJldHVybiBhbnNpO1xufTtcblxuY29udmVydC5hbnNpMTYucmdiID0gZnVuY3Rpb24gKGFyZ3MpIHtcblx0bGV0IGNvbG9yID0gYXJncyAlIDEwO1xuXG5cdC8vIEhhbmRsZSBncmV5c2NhbGVcblx0aWYgKGNvbG9yID09PSAwIHx8IGNvbG9yID09PSA3KSB7XG5cdFx0aWYgKGFyZ3MgPiA1MCkge1xuXHRcdFx0Y29sb3IgKz0gMy41O1xuXHRcdH1cblxuXHRcdGNvbG9yID0gY29sb3IgLyAxMC41ICogMjU1O1xuXG5cdFx0cmV0dXJuIFtjb2xvciwgY29sb3IsIGNvbG9yXTtcblx0fVxuXG5cdGNvbnN0IG11bHQgPSAofn4oYXJncyA+IDUwKSArIDEpICogMC41O1xuXHRjb25zdCByID0gKChjb2xvciAmIDEpICogbXVsdCkgKiAyNTU7XG5cdGNvbnN0IGcgPSAoKChjb2xvciA+PiAxKSAmIDEpICogbXVsdCkgKiAyNTU7XG5cdGNvbnN0IGIgPSAoKChjb2xvciA+PiAyKSAmIDEpICogbXVsdCkgKiAyNTU7XG5cblx0cmV0dXJuIFtyLCBnLCBiXTtcbn07XG5cbmNvbnZlcnQuYW5zaTI1Ni5yZ2IgPSBmdW5jdGlvbiAoYXJncykge1xuXHQvLyBIYW5kbGUgZ3JleXNjYWxlXG5cdGlmIChhcmdzID49IDIzMikge1xuXHRcdGNvbnN0IGMgPSAoYXJncyAtIDIzMikgKiAxMCArIDg7XG5cdFx0cmV0dXJuIFtjLCBjLCBjXTtcblx0fVxuXG5cdGFyZ3MgLT0gMTY7XG5cblx0bGV0IHJlbTtcblx0Y29uc3QgciA9IE1hdGguZmxvb3IoYXJncyAvIDM2KSAvIDUgKiAyNTU7XG5cdGNvbnN0IGcgPSBNYXRoLmZsb29yKChyZW0gPSBhcmdzICUgMzYpIC8gNikgLyA1ICogMjU1O1xuXHRjb25zdCBiID0gKHJlbSAlIDYpIC8gNSAqIDI1NTtcblxuXHRyZXR1cm4gW3IsIGcsIGJdO1xufTtcblxuY29udmVydC5yZ2IuaGV4ID0gZnVuY3Rpb24gKGFyZ3MpIHtcblx0Y29uc3QgaW50ZWdlciA9ICgoTWF0aC5yb3VuZChhcmdzWzBdKSAmIDB4RkYpIDw8IDE2KVxuXHRcdCsgKChNYXRoLnJvdW5kKGFyZ3NbMV0pICYgMHhGRikgPDwgOClcblx0XHQrIChNYXRoLnJvdW5kKGFyZ3NbMl0pICYgMHhGRik7XG5cblx0Y29uc3Qgc3RyaW5nID0gaW50ZWdlci50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcblx0cmV0dXJuICcwMDAwMDAnLnN1YnN0cmluZyhzdHJpbmcubGVuZ3RoKSArIHN0cmluZztcbn07XG5cbmNvbnZlcnQuaGV4LnJnYiA9IGZ1bmN0aW9uIChhcmdzKSB7XG5cdGNvbnN0IG1hdGNoID0gYXJncy50b1N0cmluZygxNikubWF0Y2goL1thLWYwLTldezZ9fFthLWYwLTldezN9L2kpO1xuXHRpZiAoIW1hdGNoKSB7XG5cdFx0cmV0dXJuIFswLCAwLCAwXTtcblx0fVxuXG5cdGxldCBjb2xvclN0cmluZyA9IG1hdGNoWzBdO1xuXG5cdGlmIChtYXRjaFswXS5sZW5ndGggPT09IDMpIHtcblx0XHRjb2xvclN0cmluZyA9IGNvbG9yU3RyaW5nLnNwbGl0KCcnKS5tYXAoY2hhciA9PiB7XG5cdFx0XHRyZXR1cm4gY2hhciArIGNoYXI7XG5cdFx0fSkuam9pbignJyk7XG5cdH1cblxuXHRjb25zdCBpbnRlZ2VyID0gcGFyc2VJbnQoY29sb3JTdHJpbmcsIDE2KTtcblx0Y29uc3QgciA9IChpbnRlZ2VyID4+IDE2KSAmIDB4RkY7XG5cdGNvbnN0IGcgPSAoaW50ZWdlciA+PiA4KSAmIDB4RkY7XG5cdGNvbnN0IGIgPSBpbnRlZ2VyICYgMHhGRjtcblxuXHRyZXR1cm4gW3IsIGcsIGJdO1xufTtcblxuY29udmVydC5yZ2IuaGNnID0gZnVuY3Rpb24gKHJnYikge1xuXHRjb25zdCByID0gcmdiWzBdIC8gMjU1O1xuXHRjb25zdCBnID0gcmdiWzFdIC8gMjU1O1xuXHRjb25zdCBiID0gcmdiWzJdIC8gMjU1O1xuXHRjb25zdCBtYXggPSBNYXRoLm1heChNYXRoLm1heChyLCBnKSwgYik7XG5cdGNvbnN0IG1pbiA9IE1hdGgubWluKE1hdGgubWluKHIsIGcpLCBiKTtcblx0Y29uc3QgY2hyb21hID0gKG1heCAtIG1pbik7XG5cdGxldCBncmF5c2NhbGU7XG5cdGxldCBodWU7XG5cblx0aWYgKGNocm9tYSA8IDEpIHtcblx0XHRncmF5c2NhbGUgPSBtaW4gLyAoMSAtIGNocm9tYSk7XG5cdH0gZWxzZSB7XG5cdFx0Z3JheXNjYWxlID0gMDtcblx0fVxuXG5cdGlmIChjaHJvbWEgPD0gMCkge1xuXHRcdGh1ZSA9IDA7XG5cdH0gZWxzZVxuXHRpZiAobWF4ID09PSByKSB7XG5cdFx0aHVlID0gKChnIC0gYikgLyBjaHJvbWEpICUgNjtcblx0fSBlbHNlXG5cdGlmIChtYXggPT09IGcpIHtcblx0XHRodWUgPSAyICsgKGIgLSByKSAvIGNocm9tYTtcblx0fSBlbHNlIHtcblx0XHRodWUgPSA0ICsgKHIgLSBnKSAvIGNocm9tYTtcblx0fVxuXG5cdGh1ZSAvPSA2O1xuXHRodWUgJT0gMTtcblxuXHRyZXR1cm4gW2h1ZSAqIDM2MCwgY2hyb21hICogMTAwLCBncmF5c2NhbGUgKiAxMDBdO1xufTtcblxuY29udmVydC5oc2wuaGNnID0gZnVuY3Rpb24gKGhzbCkge1xuXHRjb25zdCBzID0gaHNsWzFdIC8gMTAwO1xuXHRjb25zdCBsID0gaHNsWzJdIC8gMTAwO1xuXG5cdGNvbnN0IGMgPSBsIDwgMC41ID8gKDIuMCAqIHMgKiBsKSA6ICgyLjAgKiBzICogKDEuMCAtIGwpKTtcblxuXHRsZXQgZiA9IDA7XG5cdGlmIChjIDwgMS4wKSB7XG5cdFx0ZiA9IChsIC0gMC41ICogYykgLyAoMS4wIC0gYyk7XG5cdH1cblxuXHRyZXR1cm4gW2hzbFswXSwgYyAqIDEwMCwgZiAqIDEwMF07XG59O1xuXG5jb252ZXJ0Lmhzdi5oY2cgPSBmdW5jdGlvbiAoaHN2KSB7XG5cdGNvbnN0IHMgPSBoc3ZbMV0gLyAxMDA7XG5cdGNvbnN0IHYgPSBoc3ZbMl0gLyAxMDA7XG5cblx0Y29uc3QgYyA9IHMgKiB2O1xuXHRsZXQgZiA9IDA7XG5cblx0aWYgKGMgPCAxLjApIHtcblx0XHRmID0gKHYgLSBjKSAvICgxIC0gYyk7XG5cdH1cblxuXHRyZXR1cm4gW2hzdlswXSwgYyAqIDEwMCwgZiAqIDEwMF07XG59O1xuXG5jb252ZXJ0LmhjZy5yZ2IgPSBmdW5jdGlvbiAoaGNnKSB7XG5cdGNvbnN0IGggPSBoY2dbMF0gLyAzNjA7XG5cdGNvbnN0IGMgPSBoY2dbMV0gLyAxMDA7XG5cdGNvbnN0IGcgPSBoY2dbMl0gLyAxMDA7XG5cblx0aWYgKGMgPT09IDAuMCkge1xuXHRcdHJldHVybiBbZyAqIDI1NSwgZyAqIDI1NSwgZyAqIDI1NV07XG5cdH1cblxuXHRjb25zdCBwdXJlID0gWzAsIDAsIDBdO1xuXHRjb25zdCBoaSA9IChoICUgMSkgKiA2O1xuXHRjb25zdCB2ID0gaGkgJSAxO1xuXHRjb25zdCB3ID0gMSAtIHY7XG5cdGxldCBtZyA9IDA7XG5cblx0LyogZXNsaW50LWRpc2FibGUgbWF4LXN0YXRlbWVudHMtcGVyLWxpbmUgKi9cblx0c3dpdGNoIChNYXRoLmZsb29yKGhpKSkge1xuXHRcdGNhc2UgMDpcblx0XHRcdHB1cmVbMF0gPSAxOyBwdXJlWzFdID0gdjsgcHVyZVsyXSA9IDA7IGJyZWFrO1xuXHRcdGNhc2UgMTpcblx0XHRcdHB1cmVbMF0gPSB3OyBwdXJlWzFdID0gMTsgcHVyZVsyXSA9IDA7IGJyZWFrO1xuXHRcdGNhc2UgMjpcblx0XHRcdHB1cmVbMF0gPSAwOyBwdXJlWzFdID0gMTsgcHVyZVsyXSA9IHY7IGJyZWFrO1xuXHRcdGNhc2UgMzpcblx0XHRcdHB1cmVbMF0gPSAwOyBwdXJlWzFdID0gdzsgcHVyZVsyXSA9IDE7IGJyZWFrO1xuXHRcdGNhc2UgNDpcblx0XHRcdHB1cmVbMF0gPSB2OyBwdXJlWzFdID0gMDsgcHVyZVsyXSA9IDE7IGJyZWFrO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRwdXJlWzBdID0gMTsgcHVyZVsxXSA9IDA7IHB1cmVbMl0gPSB3O1xuXHR9XG5cdC8qIGVzbGludC1lbmFibGUgbWF4LXN0YXRlbWVudHMtcGVyLWxpbmUgKi9cblxuXHRtZyA9ICgxLjAgLSBjKSAqIGc7XG5cblx0cmV0dXJuIFtcblx0XHQoYyAqIHB1cmVbMF0gKyBtZykgKiAyNTUsXG5cdFx0KGMgKiBwdXJlWzFdICsgbWcpICogMjU1LFxuXHRcdChjICogcHVyZVsyXSArIG1nKSAqIDI1NVxuXHRdO1xufTtcblxuY29udmVydC5oY2cuaHN2ID0gZnVuY3Rpb24gKGhjZykge1xuXHRjb25zdCBjID0gaGNnWzFdIC8gMTAwO1xuXHRjb25zdCBnID0gaGNnWzJdIC8gMTAwO1xuXG5cdGNvbnN0IHYgPSBjICsgZyAqICgxLjAgLSBjKTtcblx0bGV0IGYgPSAwO1xuXG5cdGlmICh2ID4gMC4wKSB7XG5cdFx0ZiA9IGMgLyB2O1xuXHR9XG5cblx0cmV0dXJuIFtoY2dbMF0sIGYgKiAxMDAsIHYgKiAxMDBdO1xufTtcblxuY29udmVydC5oY2cuaHNsID0gZnVuY3Rpb24gKGhjZykge1xuXHRjb25zdCBjID0gaGNnWzFdIC8gMTAwO1xuXHRjb25zdCBnID0gaGNnWzJdIC8gMTAwO1xuXG5cdGNvbnN0IGwgPSBnICogKDEuMCAtIGMpICsgMC41ICogYztcblx0bGV0IHMgPSAwO1xuXG5cdGlmIChsID4gMC4wICYmIGwgPCAwLjUpIHtcblx0XHRzID0gYyAvICgyICogbCk7XG5cdH0gZWxzZVxuXHRpZiAobCA+PSAwLjUgJiYgbCA8IDEuMCkge1xuXHRcdHMgPSBjIC8gKDIgKiAoMSAtIGwpKTtcblx0fVxuXG5cdHJldHVybiBbaGNnWzBdLCBzICogMTAwLCBsICogMTAwXTtcbn07XG5cbmNvbnZlcnQuaGNnLmh3YiA9IGZ1bmN0aW9uIChoY2cpIHtcblx0Y29uc3QgYyA9IGhjZ1sxXSAvIDEwMDtcblx0Y29uc3QgZyA9IGhjZ1syXSAvIDEwMDtcblx0Y29uc3QgdiA9IGMgKyBnICogKDEuMCAtIGMpO1xuXHRyZXR1cm4gW2hjZ1swXSwgKHYgLSBjKSAqIDEwMCwgKDEgLSB2KSAqIDEwMF07XG59O1xuXG5jb252ZXJ0Lmh3Yi5oY2cgPSBmdW5jdGlvbiAoaHdiKSB7XG5cdGNvbnN0IHcgPSBod2JbMV0gLyAxMDA7XG5cdGNvbnN0IGIgPSBod2JbMl0gLyAxMDA7XG5cdGNvbnN0IHYgPSAxIC0gYjtcblx0Y29uc3QgYyA9IHYgLSB3O1xuXHRsZXQgZyA9IDA7XG5cblx0aWYgKGMgPCAxKSB7XG5cdFx0ZyA9ICh2IC0gYykgLyAoMSAtIGMpO1xuXHR9XG5cblx0cmV0dXJuIFtod2JbMF0sIGMgKiAxMDAsIGcgKiAxMDBdO1xufTtcblxuY29udmVydC5hcHBsZS5yZ2IgPSBmdW5jdGlvbiAoYXBwbGUpIHtcblx0cmV0dXJuIFsoYXBwbGVbMF0gLyA2NTUzNSkgKiAyNTUsIChhcHBsZVsxXSAvIDY1NTM1KSAqIDI1NSwgKGFwcGxlWzJdIC8gNjU1MzUpICogMjU1XTtcbn07XG5cbmNvbnZlcnQucmdiLmFwcGxlID0gZnVuY3Rpb24gKHJnYikge1xuXHRyZXR1cm4gWyhyZ2JbMF0gLyAyNTUpICogNjU1MzUsIChyZ2JbMV0gLyAyNTUpICogNjU1MzUsIChyZ2JbMl0gLyAyNTUpICogNjU1MzVdO1xufTtcblxuY29udmVydC5ncmF5LnJnYiA9IGZ1bmN0aW9uIChhcmdzKSB7XG5cdHJldHVybiBbYXJnc1swXSAvIDEwMCAqIDI1NSwgYXJnc1swXSAvIDEwMCAqIDI1NSwgYXJnc1swXSAvIDEwMCAqIDI1NV07XG59O1xuXG5jb252ZXJ0LmdyYXkuaHNsID0gZnVuY3Rpb24gKGFyZ3MpIHtcblx0cmV0dXJuIFswLCAwLCBhcmdzWzBdXTtcbn07XG5cbmNvbnZlcnQuZ3JheS5oc3YgPSBjb252ZXJ0LmdyYXkuaHNsO1xuXG5jb252ZXJ0LmdyYXkuaHdiID0gZnVuY3Rpb24gKGdyYXkpIHtcblx0cmV0dXJuIFswLCAxMDAsIGdyYXlbMF1dO1xufTtcblxuY29udmVydC5ncmF5LmNteWsgPSBmdW5jdGlvbiAoZ3JheSkge1xuXHRyZXR1cm4gWzAsIDAsIDAsIGdyYXlbMF1dO1xufTtcblxuY29udmVydC5ncmF5LmxhYiA9IGZ1bmN0aW9uIChncmF5KSB7XG5cdHJldHVybiBbZ3JheVswXSwgMCwgMF07XG59O1xuXG5jb252ZXJ0LmdyYXkuaGV4ID0gZnVuY3Rpb24gKGdyYXkpIHtcblx0Y29uc3QgdmFsID0gTWF0aC5yb3VuZChncmF5WzBdIC8gMTAwICogMjU1KSAmIDB4RkY7XG5cdGNvbnN0IGludGVnZXIgPSAodmFsIDw8IDE2KSArICh2YWwgPDwgOCkgKyB2YWw7XG5cblx0Y29uc3Qgc3RyaW5nID0gaW50ZWdlci50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcblx0cmV0dXJuICcwMDAwMDAnLnN1YnN0cmluZyhzdHJpbmcubGVuZ3RoKSArIHN0cmluZztcbn07XG5cbmNvbnZlcnQucmdiLmdyYXkgPSBmdW5jdGlvbiAocmdiKSB7XG5cdGNvbnN0IHZhbCA9IChyZ2JbMF0gKyByZ2JbMV0gKyByZ2JbMl0pIC8gMztcblx0cmV0dXJuIFt2YWwgLyAyNTUgKiAxMDBdO1xufTtcbiIsImNvbnN0IGNvbnZlcnNpb25zID0gcmVxdWlyZSgnLi9jb252ZXJzaW9ucycpO1xuXG4vKlxuXHRUaGlzIGZ1bmN0aW9uIHJvdXRlcyBhIG1vZGVsIHRvIGFsbCBvdGhlciBtb2RlbHMuXG5cblx0YWxsIGZ1bmN0aW9ucyB0aGF0IGFyZSByb3V0ZWQgaGF2ZSBhIHByb3BlcnR5IGAuY29udmVyc2lvbmAgYXR0YWNoZWRcblx0dG8gdGhlIHJldHVybmVkIHN5bnRoZXRpYyBmdW5jdGlvbi4gVGhpcyBwcm9wZXJ0eSBpcyBhbiBhcnJheVxuXHRvZiBzdHJpbmdzLCBlYWNoIHdpdGggdGhlIHN0ZXBzIGluIGJldHdlZW4gdGhlICdmcm9tJyBhbmQgJ3RvJ1xuXHRjb2xvciBtb2RlbHMgKGluY2x1c2l2ZSkuXG5cblx0Y29udmVyc2lvbnMgdGhhdCBhcmUgbm90IHBvc3NpYmxlIHNpbXBseSBhcmUgbm90IGluY2x1ZGVkLlxuKi9cblxuZnVuY3Rpb24gYnVpbGRHcmFwaCgpIHtcblx0Y29uc3QgZ3JhcGggPSB7fTtcblx0Ly8gaHR0cHM6Ly9qc3BlcmYuY29tL29iamVjdC1rZXlzLXZzLWZvci1pbi13aXRoLWNsb3N1cmUvM1xuXHRjb25zdCBtb2RlbHMgPSBPYmplY3Qua2V5cyhjb252ZXJzaW9ucyk7XG5cblx0Zm9yIChsZXQgbGVuID0gbW9kZWxzLmxlbmd0aCwgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdGdyYXBoW21vZGVsc1tpXV0gPSB7XG5cdFx0XHQvLyBodHRwOi8vanNwZXJmLmNvbS8xLXZzLWluZmluaXR5XG5cdFx0XHQvLyBtaWNyby1vcHQsIGJ1dCB0aGlzIGlzIHNpbXBsZS5cblx0XHRcdGRpc3RhbmNlOiAtMSxcblx0XHRcdHBhcmVudDogbnVsbFxuXHRcdH07XG5cdH1cblxuXHRyZXR1cm4gZ3JhcGg7XG59XG5cbi8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JyZWFkdGgtZmlyc3Rfc2VhcmNoXG5mdW5jdGlvbiBkZXJpdmVCRlMoZnJvbU1vZGVsKSB7XG5cdGNvbnN0IGdyYXBoID0gYnVpbGRHcmFwaCgpO1xuXHRjb25zdCBxdWV1ZSA9IFtmcm9tTW9kZWxdOyAvLyBVbnNoaWZ0IC0+IHF1ZXVlIC0+IHBvcFxuXG5cdGdyYXBoW2Zyb21Nb2RlbF0uZGlzdGFuY2UgPSAwO1xuXG5cdHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcblx0XHRjb25zdCBjdXJyZW50ID0gcXVldWUucG9wKCk7XG5cdFx0Y29uc3QgYWRqYWNlbnRzID0gT2JqZWN0LmtleXMoY29udmVyc2lvbnNbY3VycmVudF0pO1xuXG5cdFx0Zm9yIChsZXQgbGVuID0gYWRqYWNlbnRzLmxlbmd0aCwgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuXHRcdFx0Y29uc3QgYWRqYWNlbnQgPSBhZGphY2VudHNbaV07XG5cdFx0XHRjb25zdCBub2RlID0gZ3JhcGhbYWRqYWNlbnRdO1xuXG5cdFx0XHRpZiAobm9kZS5kaXN0YW5jZSA9PT0gLTEpIHtcblx0XHRcdFx0bm9kZS5kaXN0YW5jZSA9IGdyYXBoW2N1cnJlbnRdLmRpc3RhbmNlICsgMTtcblx0XHRcdFx0bm9kZS5wYXJlbnQgPSBjdXJyZW50O1xuXHRcdFx0XHRxdWV1ZS51bnNoaWZ0KGFkamFjZW50KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gZ3JhcGg7XG59XG5cbmZ1bmN0aW9uIGxpbmsoZnJvbSwgdG8pIHtcblx0cmV0dXJuIGZ1bmN0aW9uIChhcmdzKSB7XG5cdFx0cmV0dXJuIHRvKGZyb20oYXJncykpO1xuXHR9O1xufVxuXG5mdW5jdGlvbiB3cmFwQ29udmVyc2lvbih0b01vZGVsLCBncmFwaCkge1xuXHRjb25zdCBwYXRoID0gW2dyYXBoW3RvTW9kZWxdLnBhcmVudCwgdG9Nb2RlbF07XG5cdGxldCBmbiA9IGNvbnZlcnNpb25zW2dyYXBoW3RvTW9kZWxdLnBhcmVudF1bdG9Nb2RlbF07XG5cblx0bGV0IGN1ciA9IGdyYXBoW3RvTW9kZWxdLnBhcmVudDtcblx0d2hpbGUgKGdyYXBoW2N1cl0ucGFyZW50KSB7XG5cdFx0cGF0aC51bnNoaWZ0KGdyYXBoW2N1cl0ucGFyZW50KTtcblx0XHRmbiA9IGxpbmsoY29udmVyc2lvbnNbZ3JhcGhbY3VyXS5wYXJlbnRdW2N1cl0sIGZuKTtcblx0XHRjdXIgPSBncmFwaFtjdXJdLnBhcmVudDtcblx0fVxuXG5cdGZuLmNvbnZlcnNpb24gPSBwYXRoO1xuXHRyZXR1cm4gZm47XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGZyb21Nb2RlbCkge1xuXHRjb25zdCBncmFwaCA9IGRlcml2ZUJGUyhmcm9tTW9kZWwpO1xuXHRjb25zdCBjb252ZXJzaW9uID0ge307XG5cblx0Y29uc3QgbW9kZWxzID0gT2JqZWN0LmtleXMoZ3JhcGgpO1xuXHRmb3IgKGxldCBsZW4gPSBtb2RlbHMubGVuZ3RoLCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0Y29uc3QgdG9Nb2RlbCA9IG1vZGVsc1tpXTtcblx0XHRjb25zdCBub2RlID0gZ3JhcGhbdG9Nb2RlbF07XG5cblx0XHRpZiAobm9kZS5wYXJlbnQgPT09IG51bGwpIHtcblx0XHRcdC8vIE5vIHBvc3NpYmxlIGNvbnZlcnNpb24sIG9yIHRoaXMgbm9kZSBpcyB0aGUgc291cmNlIG1vZGVsLlxuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXG5cdFx0Y29udmVyc2lvblt0b01vZGVsXSA9IHdyYXBDb252ZXJzaW9uKHRvTW9kZWwsIGdyYXBoKTtcblx0fVxuXG5cdHJldHVybiBjb252ZXJzaW9uO1xufTtcblxuIiwiY29uc3QgY29udmVyc2lvbnMgPSByZXF1aXJlKCcuL2NvbnZlcnNpb25zJyk7XG5jb25zdCByb3V0ZSA9IHJlcXVpcmUoJy4vcm91dGUnKTtcblxuY29uc3QgY29udmVydCA9IHt9O1xuXG5jb25zdCBtb2RlbHMgPSBPYmplY3Qua2V5cyhjb252ZXJzaW9ucyk7XG5cbmZ1bmN0aW9uIHdyYXBSYXcoZm4pIHtcblx0Y29uc3Qgd3JhcHBlZEZuID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcblx0XHRjb25zdCBhcmcwID0gYXJnc1swXTtcblx0XHRpZiAoYXJnMCA9PT0gdW5kZWZpbmVkIHx8IGFyZzAgPT09IG51bGwpIHtcblx0XHRcdHJldHVybiBhcmcwO1xuXHRcdH1cblxuXHRcdGlmIChhcmcwLmxlbmd0aCA+IDEpIHtcblx0XHRcdGFyZ3MgPSBhcmcwO1xuXHRcdH1cblxuXHRcdHJldHVybiBmbihhcmdzKTtcblx0fTtcblxuXHQvLyBQcmVzZXJ2ZSAuY29udmVyc2lvbiBwcm9wZXJ0eSBpZiB0aGVyZSBpcyBvbmVcblx0aWYgKCdjb252ZXJzaW9uJyBpbiBmbikge1xuXHRcdHdyYXBwZWRGbi5jb252ZXJzaW9uID0gZm4uY29udmVyc2lvbjtcblx0fVxuXG5cdHJldHVybiB3cmFwcGVkRm47XG59XG5cbmZ1bmN0aW9uIHdyYXBSb3VuZGVkKGZuKSB7XG5cdGNvbnN0IHdyYXBwZWRGbiA9IGZ1bmN0aW9uICguLi5hcmdzKSB7XG5cdFx0Y29uc3QgYXJnMCA9IGFyZ3NbMF07XG5cblx0XHRpZiAoYXJnMCA9PT0gdW5kZWZpbmVkIHx8IGFyZzAgPT09IG51bGwpIHtcblx0XHRcdHJldHVybiBhcmcwO1xuXHRcdH1cblxuXHRcdGlmIChhcmcwLmxlbmd0aCA+IDEpIHtcblx0XHRcdGFyZ3MgPSBhcmcwO1xuXHRcdH1cblxuXHRcdGNvbnN0IHJlc3VsdCA9IGZuKGFyZ3MpO1xuXG5cdFx0Ly8gV2UncmUgYXNzdW1pbmcgdGhlIHJlc3VsdCBpcyBhbiBhcnJheSBoZXJlLlxuXHRcdC8vIHNlZSBub3RpY2UgaW4gY29udmVyc2lvbnMuanM7IGRvbid0IHVzZSBib3ggdHlwZXNcblx0XHQvLyBpbiBjb252ZXJzaW9uIGZ1bmN0aW9ucy5cblx0XHRpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcpIHtcblx0XHRcdGZvciAobGV0IGxlbiA9IHJlc3VsdC5sZW5ndGgsIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcblx0XHRcdFx0cmVzdWx0W2ldID0gTWF0aC5yb3VuZChyZXN1bHRbaV0pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiByZXN1bHQ7XG5cdH07XG5cblx0Ly8gUHJlc2VydmUgLmNvbnZlcnNpb24gcHJvcGVydHkgaWYgdGhlcmUgaXMgb25lXG5cdGlmICgnY29udmVyc2lvbicgaW4gZm4pIHtcblx0XHR3cmFwcGVkRm4uY29udmVyc2lvbiA9IGZuLmNvbnZlcnNpb247XG5cdH1cblxuXHRyZXR1cm4gd3JhcHBlZEZuO1xufVxuXG5tb2RlbHMuZm9yRWFjaChmcm9tTW9kZWwgPT4ge1xuXHRjb252ZXJ0W2Zyb21Nb2RlbF0gPSB7fTtcblxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoY29udmVydFtmcm9tTW9kZWxdLCAnY2hhbm5lbHMnLCB7dmFsdWU6IGNvbnZlcnNpb25zW2Zyb21Nb2RlbF0uY2hhbm5lbHN9KTtcblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbnZlcnRbZnJvbU1vZGVsXSwgJ2xhYmVscycsIHt2YWx1ZTogY29udmVyc2lvbnNbZnJvbU1vZGVsXS5sYWJlbHN9KTtcblxuXHRjb25zdCByb3V0ZXMgPSByb3V0ZShmcm9tTW9kZWwpO1xuXHRjb25zdCByb3V0ZU1vZGVscyA9IE9iamVjdC5rZXlzKHJvdXRlcyk7XG5cblx0cm91dGVNb2RlbHMuZm9yRWFjaCh0b01vZGVsID0+IHtcblx0XHRjb25zdCBmbiA9IHJvdXRlc1t0b01vZGVsXTtcblxuXHRcdGNvbnZlcnRbZnJvbU1vZGVsXVt0b01vZGVsXSA9IHdyYXBSb3VuZGVkKGZuKTtcblx0XHRjb252ZXJ0W2Zyb21Nb2RlbF1bdG9Nb2RlbF0ucmF3ID0gd3JhcFJhdyhmbik7XG5cdH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gY29udmVydDtcbiIsIi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqL1xuaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1jb3JlL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgTW91c2VPYnNlcnZlciwgVHJlZVdhbGtlciB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtZW5naW5lL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgRGVsZXRlIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS10eXBpbmcvZGlzdC9pbmRleC5qcyc7XG5pbXBvcnQgeyBFbWl0dGVyTWl4aW4sIFJlY3QsIENLRWRpdG9yRXJyb3IsIHRvQXJyYXksIGlzRm9yd2FyZEFycm93S2V5Q29kZSwgZW52LCBrZXlDb2RlcywgZ2V0TG9jYWxpemVkQXJyb3dLZXlDb2RlRGlyZWN0aW9uLCBnZXRSYW5nZUZyb21Nb3VzZUV2ZW50LCBsb2dXYXJuaW5nLCBPYnNlcnZhYmxlTWl4aW4sIGNvbXBhcmVBcnJheXMsIGdsb2JhbCwgRG9tRW1pdHRlck1peGluIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11dGlscy9kaXN0L2luZGV4LmpzJztcbmltcG9ydCB7IEljb25WaWV3LCBUZW1wbGF0ZSwgQ29udGV4dHVhbEJhbGxvb24sIFRvb2xiYXJWaWV3LCBCYWxsb29uUGFuZWxWaWV3LCBWaWV3IH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS11aS9kaXN0L2luZGV4LmpzJztcbmltcG9ydCB7IEVudGVyIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lbnRlci9kaXN0L2luZGV4LmpzJztcbmltcG9ydCB7IHRocm90dGxlIH0gZnJvbSAnbG9kYXNoLWVzJztcblxuLyoqXG4gKiBDbGFzcyB1c2VkIHRvIGhhbmRsZSB0aGUgY29ycmVjdCBvcmRlciBvZiBoaWdobGlnaHRzIG9uIGVsZW1lbnRzLlxuICpcbiAqIFdoZW4gZGlmZmVyZW50IGhpZ2hsaWdodHMgYXJlIGFwcGxpZWQgdG8gc2FtZSBlbGVtZW50IHRoZSBjb3JyZWN0IG9yZGVyIHNob3VsZCBiZSBwcmVzZXJ2ZWQ6XG4gKlxuICogKiBoaWdobGlnaHQgd2l0aCBoaWdoZXN0IHByaW9yaXR5IHNob3VsZCBiZSBhcHBsaWVkLFxuICogKiBpZiB0d28gaGlnaGxpZ2h0cyBoYXZlIHNhbWUgcHJpb3JpdHkgLSBzb3J0IGJ5IENTUyBjbGFzcyBwcm92aWRlZCBpblxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+SGlnaGxpZ2h0RGVzY3JpcHRvcn0uXG4gKlxuICogVGhpcyB3YXksIGhpZ2hsaWdodCB3aWxsIGJlIGFwcGxpZWQgd2l0aCB0aGUgc2FtZSBydWxlcyBpdCBpcyBhcHBsaWVkIG9uIHRleHRzLlxuICovIGNsYXNzIEhpZ2hsaWdodFN0YWNrIGV4dGVuZHMgLyogI19fUFVSRV9fICovIEVtaXR0ZXJNaXhpbigpIHtcbiAgICBfc3RhY2sgPSBbXTtcbiAgICAvKipcblx0ICogQWRkcyBoaWdobGlnaHQgZGVzY3JpcHRvciB0byB0aGUgc3RhY2suXG5cdCAqXG5cdCAqIEBmaXJlcyBjaGFuZ2U6dG9wXG5cdCAqLyBhZGQoZGVzY3JpcHRvciwgd3JpdGVyKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fc3RhY2s7XG4gICAgICAgIC8vIFNhdmUgdG9wIGRlc2NyaXB0b3IgYW5kIGluc2VydCBuZXcgb25lLiBJZiB0b3AgaXMgY2hhbmdlZCAtIGZpcmUgZXZlbnQuXG4gICAgICAgIGNvbnN0IG9sZFRvcCA9IHN0YWNrWzBdO1xuICAgICAgICB0aGlzLl9pbnNlcnREZXNjcmlwdG9yKGRlc2NyaXB0b3IpO1xuICAgICAgICBjb25zdCBuZXdUb3AgPSBzdGFja1swXTtcbiAgICAgICAgLy8gV2hlbiBuZXcgb2JqZWN0IGlzIGF0IHRoZSB0b3AgYW5kIHN0b3JlcyBkaWZmZXJlbnQgaW5mb3JtYXRpb24uXG4gICAgICAgIGlmIChvbGRUb3AgIT09IG5ld1RvcCAmJiAhY29tcGFyZURlc2NyaXB0b3JzKG9sZFRvcCwgbmV3VG9wKSkge1xuICAgICAgICAgICAgdGhpcy5maXJlKCdjaGFuZ2U6dG9wJywge1xuICAgICAgICAgICAgICAgIG9sZERlc2NyaXB0b3I6IG9sZFRvcCxcbiAgICAgICAgICAgICAgICBuZXdEZXNjcmlwdG9yOiBuZXdUb3AsXG4gICAgICAgICAgICAgICAgd3JpdGVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmVtb3ZlcyBoaWdobGlnaHQgZGVzY3JpcHRvciBmcm9tIHRoZSBzdGFjay5cblx0ICpcblx0ICogQGZpcmVzIGNoYW5nZTp0b3Bcblx0ICogQHBhcmFtIGlkIElkIG9mIHRoZSBkZXNjcmlwdG9yIHRvIHJlbW92ZS5cblx0ICovIHJlbW92ZShpZCwgd3JpdGVyKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fc3RhY2s7XG4gICAgICAgIGNvbnN0IG9sZFRvcCA9IHN0YWNrWzBdO1xuICAgICAgICB0aGlzLl9yZW1vdmVEZXNjcmlwdG9yKGlkKTtcbiAgICAgICAgY29uc3QgbmV3VG9wID0gc3RhY2tbMF07XG4gICAgICAgIC8vIFdoZW4gbmV3IG9iamVjdCBpcyBhdCB0aGUgdG9wIGFuZCBzdG9yZXMgZGlmZmVyZW50IGluZm9ybWF0aW9uLlxuICAgICAgICBpZiAob2xkVG9wICE9PSBuZXdUb3AgJiYgIWNvbXBhcmVEZXNjcmlwdG9ycyhvbGRUb3AsIG5ld1RvcCkpIHtcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlOnRvcCcsIHtcbiAgICAgICAgICAgICAgICBvbGREZXNjcmlwdG9yOiBvbGRUb3AsXG4gICAgICAgICAgICAgICAgbmV3RGVzY3JpcHRvcjogbmV3VG9wLFxuICAgICAgICAgICAgICAgIHdyaXRlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEluc2VydHMgYSBnaXZlbiBkZXNjcmlwdG9yIGluIGNvcnJlY3QgcGxhY2UgaW4gdGhlIHN0YWNrLiBJdCBhbHNvIHRha2VzIGNhcmUgYWJvdXQgdXBkYXRpbmcgaW5mb3JtYXRpb25cblx0ICogd2hlbiBkZXNjcmlwdG9yIHdpdGggc2FtZSBpZCBpcyBhbHJlYWR5IHByZXNlbnQuXG5cdCAqLyBfaW5zZXJ0RGVzY3JpcHRvcihkZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fc3RhY2s7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gc3RhY2suZmluZEluZGV4KChpdGVtKT0+aXRlbS5pZCA9PT0gZGVzY3JpcHRvci5pZCk7XG4gICAgICAgIC8vIEluc2VydGluZyBleGFjdCBzYW1lIGRlc2NyaXB0b3IgLSBkbyBub3RoaW5nLlxuICAgICAgICBpZiAoY29tcGFyZURlc2NyaXB0b3JzKGRlc2NyaXB0b3IsIHN0YWNrW2luZGV4XSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBkZXNjcmlwdG9yIHdpdGggc2FtZSBpZCBidXQgd2l0aCBkaWZmZXJlbnQgaW5mb3JtYXRpb24gaXMgb24gdGhlIHN0YWNrIC0gcmVtb3ZlIGl0LlxuICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICAgICAgc3RhY2suc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBGaW5kIGNvcnJlY3QgcGxhY2UgdG8gaW5zZXJ0IGRlc2NyaXB0b3IgaW4gdGhlIHN0YWNrLlxuICAgICAgICAvLyBJdCBoYXMgZGlmZmVyZW50IGluZm9ybWF0aW9uIChmb3IgZXhhbXBsZSBwcmlvcml0eSkgc28gaXQgbXVzdCBiZSByZS1pbnNlcnRlZCBpbiBjb3JyZWN0IHBsYWNlLlxuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHdoaWxlKHN0YWNrW2ldICYmIHNob3VsZEFCZUJlZm9yZUIoc3RhY2tbaV0sIGRlc2NyaXB0b3IpKXtcbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgfVxuICAgICAgICBzdGFjay5zcGxpY2UoaSwgMCwgZGVzY3JpcHRvcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIGRlc2NyaXB0b3Igd2l0aCBnaXZlbiBpZCBmcm9tIHRoZSBzdGFjay5cblx0ICpcblx0ICogQHBhcmFtIGlkIERlc2NyaXB0b3IncyBpZC5cblx0ICovIF9yZW1vdmVEZXNjcmlwdG9yKGlkKSB7XG4gICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fc3RhY2s7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gc3RhY2suZmluZEluZGV4KChpdGVtKT0+aXRlbS5pZCA9PT0gaWQpO1xuICAgICAgICAvLyBJZiBkZXNjcmlwdG9yIHdpdGggc2FtZSBpZCBpcyBvbiB0aGUgbGlzdCAtIHJlbW92ZSBpdC5cbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIHN0YWNrLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIENvbXBhcmVzIHR3byBkZXNjcmlwdG9ycyBieSBjaGVja2luZyB0aGVpciBwcmlvcml0eSBhbmQgY2xhc3MgbGlzdC5cbiAqXG4gKiBAcmV0dXJucyBSZXR1cm5zIHRydWUgaWYgYm90aCBkZXNjcmlwdG9ycyBhcmUgZGVmaW5lZCBhbmQgaGF2ZSBzYW1lIHByaW9yaXR5IGFuZCBjbGFzc2VzLlxuICovIGZ1bmN0aW9uIGNvbXBhcmVEZXNjcmlwdG9ycyhhLCBiKSB7XG4gICAgcmV0dXJuIGEgJiYgYiAmJiBhLnByaW9yaXR5ID09IGIucHJpb3JpdHkgJiYgY2xhc3Nlc1RvU3RyaW5nKGEuY2xhc3NlcykgPT0gY2xhc3Nlc1RvU3RyaW5nKGIuY2xhc3Nlcyk7XG59XG4vKipcbiAqIENoZWNrcyB3aGVuZXZlciBmaXJzdCBkZXNjcmlwdG9yIHNob3VsZCBiZSBwbGFjZWQgaW4gdGhlIHN0YWNrIGJlZm9yZSBzZWNvbmQgb25lLlxuICovIGZ1bmN0aW9uIHNob3VsZEFCZUJlZm9yZUIoYSwgYikge1xuICAgIGlmIChhLnByaW9yaXR5ID4gYi5wcmlvcml0eSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGEucHJpb3JpdHkgPCBiLnByaW9yaXR5KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gV2hlbiBwcmlvcml0aWVzIGFyZSBlcXVhbCBhbmQgbmFtZXMgYXJlIGRpZmZlcmVudCAtIHVzZSBjbGFzc2VzIHRvIGNvbXBhcmUuXG4gICAgcmV0dXJuIGNsYXNzZXNUb1N0cmluZyhhLmNsYXNzZXMpID4gY2xhc3Nlc1RvU3RyaW5nKGIuY2xhc3Nlcyk7XG59XG4vKipcbiAqIENvbnZlcnRzIENTUyBjbGFzc2VzIHBhc3NlZCB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RoZWxwZXJzfkhpZ2hsaWdodERlc2NyaXB0b3J9IHRvXG4gKiBzb3J0ZWQgc3RyaW5nLlxuICovIGZ1bmN0aW9uIGNsYXNzZXNUb1N0cmluZyhjbGFzc2VzKSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoY2xhc3NlcykgPyBjbGFzc2VzLnNvcnQoKS5qb2luKCcsJykgOiBjbGFzc2VzO1xufVxuXG52YXIgZHJhZ0hhbmRsZUljb24gPSBcIjxzdmcgdmlld0JveD1cXFwiMCAwIDE2IDE2XFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiPjxwYXRoIGQ9XFxcIk00IDB2MUgxdjNIMFYuNUEuNS41IDAgMCAxIC41IDBINHptOCAwaDMuNWEuNS41IDAgMCAxIC41LjVWNGgtMVYxaC0zVjB6TTQgMTZILjVhLjUuNSAwIDAgMS0uNS0uNVYxMmgxdjNoM3Yxem04IDB2LTFoM3YtM2gxdjMuNWEuNS41IDAgMCAxLS41LjVIMTJ6XFxcIi8+PHBhdGggZmlsbC1vcGFjaXR5PVxcXCIuMjU2XFxcIiBkPVxcXCJNMSAxaDE0djE0SDF6XFxcIi8+PGcgY2xhc3M9XFxcImNrLWljb25fX3NlbGVjdGVkLWluZGljYXRvclxcXCI+PHBhdGggZD1cXFwiTTcgMGgydjFIN1Ywek0wIDdoMXYySDBWN3ptMTUgMGgxdjJoLTFWN3ptLTggOGgydjFIN3YtMXpcXFwiLz48cGF0aCBmaWxsLW9wYWNpdHk9XFxcIi4yNTRcXFwiIGQ9XFxcIk0xIDFoMTR2MTRIMXpcXFwiLz48L2c+PC9zdmc+XCI7XG5cbi8qKlxuICogQ1NTIGNsYXNzIGFkZGVkIHRvIGVhY2ggd2lkZ2V0IGVsZW1lbnQuXG4gKi8gY29uc3QgV0lER0VUX0NMQVNTX05BTUUgPSAnY2std2lkZ2V0Jztcbi8qKlxuICogQ1NTIGNsYXNzIGFkZGVkIHRvIGN1cnJlbnRseSBzZWxlY3RlZCB3aWRnZXQgZWxlbWVudC5cbiAqLyBjb25zdCBXSURHRVRfU0VMRUNURURfQ0xBU1NfTkFNRSA9ICdjay13aWRnZXRfc2VsZWN0ZWQnO1xuLyoqXG4gKiBSZXR1cm5zIGB0cnVlYCBpZiBnaXZlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L25vZGV+Tm9kZX0gaXMgYW4ge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lbGVtZW50fkVsZW1lbnR9IGFuZCBhIHdpZGdldC5cbiAqLyBmdW5jdGlvbiBpc1dpZGdldChub2RlKSB7XG4gICAgaWYgKCFub2RlLmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gISFub2RlLmdldEN1c3RvbVByb3BlcnR5KCd3aWRnZXQnKTtcbn1cbi8qKlxuICogQ29udmVydHMgdGhlIGdpdmVuIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50fSB0byBhIHdpZGdldCBpbiB0aGUgZm9sbG93aW5nIHdheTpcbiAqXG4gKiAqIHNldHMgdGhlIGBjb250ZW50ZWRpdGFibGVgIGF0dHJpYnV0ZSB0byBgXCJmYWxzZVwiYCxcbiAqICogYWRkcyB0aGUgYGNrLXdpZGdldGAgQ1NTIGNsYXNzLFxuICogKiBhZGRzIGEgY3VzdG9tIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZWxlbWVudH5FbGVtZW50I2dldEZpbGxlck9mZnNldCBgZ2V0RmlsbGVyT2Zmc2V0KClgfSBtZXRob2QgcmV0dXJuaW5nIGBudWxsYCxcbiAqICogYWRkcyBhIGN1c3RvbSBwcm9wZXJ0eSBhbGxvd2luZyB0byByZWNvZ25pemUgd2lkZ2V0IGVsZW1lbnRzIGJ5IHVzaW5nIHtAbGluayB+aXNXaWRnZXQgYGlzV2lkZ2V0KClgfSxcbiAqICogaW1wbGVtZW50cyB0aGUge0BsaW5rIH5zZXRIaWdobGlnaHRIYW5kbGluZyB2aWV3IGhpZ2hsaWdodCBvbiB3aWRnZXRzfS5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIG5lZWRzIHRvIGJlIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aFxuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+RG93bmNhc3RIZWxwZXJzIGRvd25jYXN0IGNvbnZlcnNpb24gaGVscGVyc31cbiAqIGxpa2Uge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGhlbHBlcnN+RG93bmNhc3RIZWxwZXJzI2VsZW1lbnRUb0VsZW1lbnQgYGVsZW1lbnRUb0VsZW1lbnQoKWB9LlxuICogTW9yZW92ZXIsIHR5cGljYWxseSB5b3Ugd2lsbCB3YW50IHRvIHVzZSBgdG9XaWRnZXQoKWAgb25seSBmb3IgYGVkaXRpbmdEb3duY2FzdGAsIHdoaWxlIGtlZXBpbmcgdGhlIGBkYXRhRG93bmNhc3RgIGNsZWFuLlxuICpcbiAqIEZvciBleGFtcGxlLCBpbiBvcmRlciB0byBjb252ZXJ0IGEgYDx3aWRnZXQ+YCBtb2RlbCBlbGVtZW50IHRvIGA8ZGl2IGNsYXNzPVwid2lkZ2V0XCI+YCBpbiB0aGUgdmlldywgeW91IGNhbiBkZWZpbmVcbiAqIHN1Y2ggY29udmVydGVyczpcbiAqXG4gKiBgYGB0c1xuICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZWRpdGluZ0Rvd25jYXN0JyApXG4gKiBcdC5lbGVtZW50VG9FbGVtZW50KCB7XG4gKiBcdFx0bW9kZWw6ICd3aWRnZXQnLFxuICogXHRcdHZpZXc6ICggbW9kZWxJdGVtLCB7IHdyaXRlciB9ICkgPT4ge1xuICogXHRcdFx0Y29uc3QgZGl2ID0gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoICdkaXYnLCB7IGNsYXNzOiAnd2lkZ2V0JyB9ICk7XG4gKlxuICogXHRcdFx0cmV0dXJuIHRvV2lkZ2V0KCBkaXYsIHdyaXRlciwgeyBsYWJlbDogJ3NvbWUgd2lkZ2V0JyB9ICk7XG4gKiBcdFx0fVxuICogXHR9ICk7XG4gKlxuICogZWRpdG9yLmNvbnZlcnNpb24uZm9yKCAnZGF0YURvd25jYXN0JyApXG4gKiBcdC5lbGVtZW50VG9FbGVtZW50KCB7XG4gKiBcdFx0bW9kZWw6ICd3aWRnZXQnLFxuICogXHRcdHZpZXc6ICggbW9kZWxJdGVtLCB7IHdyaXRlciB9ICkgPT4ge1xuICogXHRcdFx0cmV0dXJuIHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCAnZGl2JywgeyBjbGFzczogJ3dpZGdldCcgfSApO1xuICogXHRcdH1cbiAqIFx0fSApO1xuICogYGBgXG4gKlxuICogU2VlIHRoZSBmdWxsIHNvdXJjZSBjb2RlIG9mIHRoZSB3aWRnZXQgKHdpdGggYSBuZXN0ZWQgZWRpdGFibGUpIHNjaGVtYSBkZWZpbml0aW9uIGFuZCBjb252ZXJ0ZXJzIGluXG4gKiBbdGhpcyBzYW1wbGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtd2lkZ2V0L2Jsb2IvbWFzdGVyL3Rlc3RzL21hbnVhbC93aWRnZXQtd2l0aC1uZXN0ZWRlZGl0YWJsZS5qcykuXG4gKlxuICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBvcHRpb25zLlxuICogQHBhcmFtIG9wdGlvbnMubGFiZWwgRWxlbWVudCdzIGxhYmVsIHByb3ZpZGVkIHRvIHRoZSB7QGxpbmsgfnNldExhYmVsfSBmdW5jdGlvbi4gSXQgY2FuIGJlIHBhc3NlZCBhc1xuICogYSBwbGFpbiBzdHJpbmcgb3IgYSBmdW5jdGlvbiByZXR1cm5pbmcgYSBzdHJpbmcuIEl0IHJlcHJlc2VudHMgdGhlIHdpZGdldCBmb3IgYXNzaXN0aXZlIHRlY2hub2xvZ2llcyAobGlrZSBzY3JlZW4gcmVhZGVycykuXG4gKiBAcGFyYW0gb3B0aW9ucy5oYXNTZWxlY3Rpb25IYW5kbGUgSWYgYHRydWVgLCB0aGUgd2lkZ2V0IHdpbGwgaGF2ZSBhIHNlbGVjdGlvbiBoYW5kbGUgYWRkZWQuXG4gKiBAcmV0dXJucyBSZXR1cm5zIHRoZSBzYW1lIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gdG9XaWRnZXQoZWxlbWVudCwgd3JpdGVyLCBvcHRpb25zID0ge30pIHtcbiAgICBpZiAoIWVsZW1lbnQuaXMoJ2NvbnRhaW5lckVsZW1lbnQnKSkge1xuICAgICAgICAvKipcblx0XHQgKiBUaGUgZWxlbWVudCBwYXNzZWQgdG8gYHRvV2lkZ2V0KClgIG11c3QgYmUgYSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2NvbnRhaW5lcmVsZW1lbnR+Q29udGFpbmVyRWxlbWVudH1cblx0XHQgKiBpbnN0YW5jZS5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciB3aWRnZXQtdG8td2lkZ2V0LXdyb25nLWVsZW1lbnQtdHlwZVxuXHRcdCAqIEBwYXJhbSBlbGVtZW50IFRoZSB2aWV3IGVsZW1lbnQgcGFzc2VkIHRvIGB0b1dpZGdldCgpYC5cblx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ3dpZGdldC10by13aWRnZXQtd3JvbmctZWxlbWVudC10eXBlJywgbnVsbCwge1xuICAgICAgICAgICAgZWxlbWVudFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgJ2ZhbHNlJywgZWxlbWVudCk7XG4gICAgd3JpdGVyLmFkZENsYXNzKFdJREdFVF9DTEFTU19OQU1FLCBlbGVtZW50KTtcbiAgICB3cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ3dpZGdldCcsIHRydWUsIGVsZW1lbnQpO1xuICAgIGVsZW1lbnQuZ2V0RmlsbGVyT2Zmc2V0ID0gZ2V0RmlsbGVyT2Zmc2V0O1xuICAgIHdyaXRlci5zZXRDdXN0b21Qcm9wZXJ0eSgnd2lkZ2V0TGFiZWwnLCBbXSwgZWxlbWVudCk7XG4gICAgaWYgKG9wdGlvbnMubGFiZWwpIHtcbiAgICAgICAgc2V0TGFiZWwoZWxlbWVudCwgb3B0aW9ucy5sYWJlbCk7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmhhc1NlbGVjdGlvbkhhbmRsZSkge1xuICAgICAgICBhZGRTZWxlY3Rpb25IYW5kbGUoZWxlbWVudCwgd3JpdGVyKTtcbiAgICB9XG4gICAgc2V0SGlnaGxpZ2h0SGFuZGxpbmcoZWxlbWVudCwgd3JpdGVyKTtcbiAgICByZXR1cm4gZWxlbWVudDtcbn1cbi8qKlxuICogRGVmYXVsdCBoYW5kbGVyIGZvciBhZGRpbmcgYSBoaWdobGlnaHQgb24gYSB3aWRnZXQuXG4gKiBJdCBhZGRzIENTUyBjbGFzcyBhbmQgYXR0cmlidXRlcyBiYXNpbmcgb24gdGhlIGdpdmVuIGhpZ2hsaWdodCBkZXNjcmlwdG9yLlxuICovIGZ1bmN0aW9uIGFkZEhpZ2hsaWdodChlbGVtZW50LCBkZXNjcmlwdG9yLCB3cml0ZXIpIHtcbiAgICBpZiAoZGVzY3JpcHRvci5jbGFzc2VzKSB7XG4gICAgICAgIHdyaXRlci5hZGRDbGFzcyh0b0FycmF5KGRlc2NyaXB0b3IuY2xhc3NlcyksIGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoZGVzY3JpcHRvci5hdHRyaWJ1dGVzKSB7XG4gICAgICAgIGZvcihjb25zdCBrZXkgaW4gZGVzY3JpcHRvci5hdHRyaWJ1dGVzKXtcbiAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoa2V5LCBkZXNjcmlwdG9yLmF0dHJpYnV0ZXNba2V5XSwgZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIERlZmF1bHQgaGFuZGxlciBmb3IgcmVtb3ZpbmcgYSBoaWdobGlnaHQgZnJvbSBhIHdpZGdldC5cbiAqIEl0IHJlbW92ZXMgQ1NTIGNsYXNzIGFuZCBhdHRyaWJ1dGVzIGJhc2luZyBvbiB0aGUgZ2l2ZW4gaGlnaGxpZ2h0IGRlc2NyaXB0b3IuXG4gKi8gZnVuY3Rpb24gcmVtb3ZlSGlnaGxpZ2h0KGVsZW1lbnQsIGRlc2NyaXB0b3IsIHdyaXRlcikge1xuICAgIGlmIChkZXNjcmlwdG9yLmNsYXNzZXMpIHtcbiAgICAgICAgd3JpdGVyLnJlbW92ZUNsYXNzKHRvQXJyYXkoZGVzY3JpcHRvci5jbGFzc2VzKSwgZWxlbWVudCk7XG4gICAgfVxuICAgIGlmIChkZXNjcmlwdG9yLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgZm9yKGNvbnN0IGtleSBpbiBkZXNjcmlwdG9yLmF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZShrZXksIGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBTZXRzIGhpZ2hsaWdodCBoYW5kbGluZyBtZXRob2RzLiBVc2VzIHtAbGluayBtb2R1bGU6d2lkZ2V0L2hpZ2hsaWdodHN0YWNrfkhpZ2hsaWdodFN0YWNrfSB0b1xuICogcHJvcGVybHkgZGV0ZXJtaW5lIHdoaWNoIGhpZ2hsaWdodCBkZXNjcmlwdG9yIHNob3VsZCBiZSB1c2VkIGF0IGdpdmVuIHRpbWUuXG4gKi8gZnVuY3Rpb24gc2V0SGlnaGxpZ2h0SGFuZGxpbmcoZWxlbWVudCwgd3JpdGVyLCBhZGQgPSBhZGRIaWdobGlnaHQsIHJlbW92ZSA9IHJlbW92ZUhpZ2hsaWdodCkge1xuICAgIGNvbnN0IHN0YWNrID0gbmV3IEhpZ2hsaWdodFN0YWNrKCk7XG4gICAgc3RhY2sub24oJ2NoYW5nZTp0b3AnLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICBpZiAoZGF0YS5vbGREZXNjcmlwdG9yKSB7XG4gICAgICAgICAgICByZW1vdmUoZWxlbWVudCwgZGF0YS5vbGREZXNjcmlwdG9yLCBkYXRhLndyaXRlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEubmV3RGVzY3JpcHRvcikge1xuICAgICAgICAgICAgYWRkKGVsZW1lbnQsIGRhdGEubmV3RGVzY3JpcHRvciwgZGF0YS53cml0ZXIpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3QgYWRkSGlnaGxpZ2h0Q2FsbGJhY2sgPSAoZWxlbWVudCwgZGVzY3JpcHRvciwgd3JpdGVyKT0+c3RhY2suYWRkKGRlc2NyaXB0b3IsIHdyaXRlcik7XG4gICAgY29uc3QgcmVtb3ZlSGlnaGxpZ2h0Q2FsbGJhY2sgPSAoZWxlbWVudCwgaWQsIHdyaXRlcik9PnN0YWNrLnJlbW92ZShpZCwgd3JpdGVyKTtcbiAgICB3cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ2FkZEhpZ2hsaWdodCcsIGFkZEhpZ2hsaWdodENhbGxiYWNrLCBlbGVtZW50KTtcbiAgICB3cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ3JlbW92ZUhpZ2hsaWdodCcsIHJlbW92ZUhpZ2hsaWdodENhbGxiYWNrLCBlbGVtZW50KTtcbn1cbi8qKlxuICogU2V0cyBsYWJlbCBmb3IgZ2l2ZW4gZWxlbWVudC5cbiAqIEl0IGNhbiBiZSBwYXNzZWQgYXMgYSBwbGFpbiBzdHJpbmcgb3IgYSBmdW5jdGlvbiByZXR1cm5pbmcgYSBzdHJpbmcuIEZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGVhY2ggdGltZSBsYWJlbCBpcyByZXRyaWV2ZWQgYnlcbiAqIHtAbGluayB+Z2V0TGFiZWwgYGdldExhYmVsKClgfS5cbiAqLyBmdW5jdGlvbiBzZXRMYWJlbChlbGVtZW50LCBsYWJlbE9yQ3JlYXRvcikge1xuICAgIGNvbnN0IHdpZGdldExhYmVsID0gZWxlbWVudC5nZXRDdXN0b21Qcm9wZXJ0eSgnd2lkZ2V0TGFiZWwnKTtcbiAgICB3aWRnZXRMYWJlbC5wdXNoKGxhYmVsT3JDcmVhdG9yKTtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgbGFiZWwgb2YgdGhlIHByb3ZpZGVkIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gZ2V0TGFiZWwoZWxlbWVudCkge1xuICAgIGNvbnN0IHdpZGdldExhYmVsID0gZWxlbWVudC5nZXRDdXN0b21Qcm9wZXJ0eSgnd2lkZ2V0TGFiZWwnKTtcbiAgICByZXR1cm4gd2lkZ2V0TGFiZWwucmVkdWNlKChwcmV2LCBjdXJyZW50KT0+e1xuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmV2ID8gcHJldiArICcuICcgKyBjdXJyZW50KCkgOiBjdXJyZW50KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldiA/IHByZXYgKyAnLiAnICsgY3VycmVudCA6IGN1cnJlbnQ7XG4gICAgICAgIH1cbiAgICB9LCAnJyk7XG59XG4vKipcbiAqIEFkZHMgZnVuY3Rpb25hbGl0eSB0byB0aGUgcHJvdmlkZWQge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9lZGl0YWJsZWVsZW1lbnR+RWRpdGFibGVFbGVtZW50fSB0byBhY3QgYXMgYSB3aWRnZXQncyBlZGl0YWJsZTpcbiAqXG4gKiAqIHNldHMgdGhlIGBjb250ZW50ZWRpdGFibGVgIGF0dHJpYnV0ZSB0byBgdHJ1ZWAgd2hlbiB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2VkaXRhYmxlZWxlbWVudH5FZGl0YWJsZUVsZW1lbnQjaXNSZWFkT25seX0gaXMgYGZhbHNlYCxcbiAqIG90aGVyd2lzZSBzZXRzIGl0IHRvIGBmYWxzZWAsXG4gKiAqIGFkZHMgdGhlIGBjay1lZGl0b3JfX2VkaXRhYmxlYCBhbmQgYGNrLWVkaXRvcl9fbmVzdGVkLWVkaXRhYmxlYCBDU1MgY2xhc3NlcyxcbiAqICogYWRkcyB0aGUgYGNrLWVkaXRvcl9fbmVzdGVkLWVkaXRhYmxlX2ZvY3VzZWRgIENTUyBjbGFzcyB3aGVuIHRoZSBlZGl0YWJsZSBpcyBmb2N1c2VkIGFuZCByZW1vdmVzIGl0IHdoZW4gaXQgaXMgYmx1cnJlZC5cbiAqICogaW1wbGVtZW50cyB0aGUge0BsaW5rIH5zZXRIaWdobGlnaHRIYW5kbGluZyB2aWV3IGhpZ2hsaWdodCBvbiB3aWRnZXQncyBlZGl0YWJsZX0uXG4gKlxuICogU2ltaWxhcmx5IHRvIHtAbGluayB+dG9XaWRnZXQgYHRvV2lkZ2V0KClgfSB0aGlzIGZ1bmN0aW9uIHNob3VsZCBiZSB1c2VkIGluIGBlZGl0aW5nRG93bmNhc3RgIG9ubHkgYW5kIGl0IGlzIHVzdWFsbHlcbiAqIHVzZWQgdG9nZXRoZXIgd2l0aCB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0aGVscGVyc35Eb3duY2FzdEhlbHBlcnMjZWxlbWVudFRvRWxlbWVudCBgZWxlbWVudFRvRWxlbWVudCgpYH0uXG4gKlxuICogRm9yIGV4YW1wbGUsIGluIG9yZGVyIHRvIGNvbnZlcnQgYSBgPG5lc3RlZD5gIG1vZGVsIGVsZW1lbnQgdG8gYDxkaXYgY2xhc3M9XCJuZXN0ZWRcIj5gIGluIHRoZSB2aWV3LCB5b3UgY2FuIGRlZmluZVxuICogc3VjaCBjb252ZXJ0ZXJzOlxuICpcbiAqIGBgYHRzXG4gKiBlZGl0b3IuY29udmVyc2lvbi5mb3IoICdlZGl0aW5nRG93bmNhc3QnIClcbiAqIFx0LmVsZW1lbnRUb0VsZW1lbnQoIHtcbiAqIFx0XHRtb2RlbDogJ25lc3RlZCcsXG4gKiBcdFx0dmlldzogKCBtb2RlbEl0ZW0sIHsgd3JpdGVyIH0gKSA9PiB7XG4gKiBcdFx0XHRjb25zdCBkaXYgPSB3cml0ZXIuY3JlYXRlRWRpdGFibGVFbGVtZW50KCAnZGl2JywgeyBjbGFzczogJ25lc3RlZCcgfSApO1xuICpcbiAqIFx0XHRcdHJldHVybiB0b1dpZGdldEVkaXRhYmxlKCBuZXN0ZWQsIHdyaXRlciwgeyBsYWJlbDogJ2xhYmVsIGZvciBlZGl0YWJsZScgfSApO1xuICogXHRcdH1cbiAqIFx0fSApO1xuICpcbiAqIGVkaXRvci5jb252ZXJzaW9uLmZvciggJ2RhdGFEb3duY2FzdCcgKVxuICogXHQuZWxlbWVudFRvRWxlbWVudCgge1xuICogXHRcdG1vZGVsOiAnbmVzdGVkJyxcbiAqIFx0XHR2aWV3OiAoIG1vZGVsSXRlbSwgeyB3cml0ZXIgfSApID0+IHtcbiAqIFx0XHRcdHJldHVybiB3cml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCggJ2RpdicsIHsgY2xhc3M6ICduZXN0ZWQnIH0gKTtcbiAqIFx0XHR9XG4gKiBcdH0gKTtcbiAqIGBgYFxuICpcbiAqIFNlZSB0aGUgZnVsbCBzb3VyY2UgY29kZSBvZiB0aGUgd2lkZ2V0ICh3aXRoIG5lc3RlZCBlZGl0YWJsZSkgc2NoZW1hIGRlZmluaXRpb24gYW5kIGNvbnZlcnRlcnMgaW5cbiAqIFt0aGlzIHNhbXBsZV0oaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS13aWRnZXQvYmxvYi9tYXN0ZXIvdGVzdHMvbWFudWFsL3dpZGdldC13aXRoLW5lc3RlZGVkaXRhYmxlLmpzKS5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMuXG4gKiBAcGFyYW0gb3B0aW9ucy5sYWJlbCBFZGl0YWJsZSdzIGxhYmVsIHVzZWQgYnkgYXNzaXN0aXZlIHRlY2hub2xvZ2llcyAoZS5nLiBzY3JlZW4gcmVhZGVycykuXG4gKiBAcmV0dXJucyBSZXR1cm5zIHRoZSBzYW1lIGVsZW1lbnQgdGhhdCB3YXMgcHJvdmlkZWQgaW4gdGhlIGBlZGl0YWJsZWAgcGFyYW1ldGVyXG4gKi8gZnVuY3Rpb24gdG9XaWRnZXRFZGl0YWJsZShlZGl0YWJsZSwgd3JpdGVyLCBvcHRpb25zID0ge30pIHtcbiAgICB3cml0ZXIuYWRkQ2xhc3MoW1xuICAgICAgICAnY2stZWRpdG9yX19lZGl0YWJsZScsXG4gICAgICAgICdjay1lZGl0b3JfX25lc3RlZC1lZGl0YWJsZSdcbiAgICBdLCBlZGl0YWJsZSk7XG4gICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgncm9sZScsICd0ZXh0Ym94JywgZWRpdGFibGUpO1xuICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJy0xJywgZWRpdGFibGUpO1xuICAgIGlmIChvcHRpb25zLmxhYmVsKSB7XG4gICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBvcHRpb25zLmxhYmVsLCBlZGl0YWJsZSk7XG4gICAgfVxuICAgIC8vIFNldCBpbml0aWFsIGNvbnRlbnRlZGl0YWJsZSB2YWx1ZS5cbiAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCBlZGl0YWJsZS5pc1JlYWRPbmx5ID8gJ2ZhbHNlJyA6ICd0cnVlJywgZWRpdGFibGUpO1xuICAgIC8vIEJpbmQgdGhlIGNvbnRlbnRlZGl0YWJsZSBwcm9wZXJ0eSB0byBlbGVtZW50I2lzUmVhZE9ubHkuXG4gICAgZWRpdGFibGUub24oJ2NoYW5nZTppc1JlYWRPbmx5JywgKGV2dCwgcHJvcGVydHksIGlzKT0+e1xuICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnLCBpcyA/ICdmYWxzZScgOiAndHJ1ZScsIGVkaXRhYmxlKTtcbiAgICB9KTtcbiAgICBlZGl0YWJsZS5vbignY2hhbmdlOmlzRm9jdXNlZCcsIChldnQsIHByb3BlcnR5LCBpcyk9PntcbiAgICAgICAgaWYgKGlzKSB7XG4gICAgICAgICAgICB3cml0ZXIuYWRkQ2xhc3MoJ2NrLWVkaXRvcl9fbmVzdGVkLWVkaXRhYmxlX2ZvY3VzZWQnLCBlZGl0YWJsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3cml0ZXIucmVtb3ZlQ2xhc3MoJ2NrLWVkaXRvcl9fbmVzdGVkLWVkaXRhYmxlX2ZvY3VzZWQnLCBlZGl0YWJsZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBzZXRIaWdobGlnaHRIYW5kbGluZyhlZGl0YWJsZSwgd3JpdGVyKTtcbiAgICByZXR1cm4gZWRpdGFibGU7XG59XG4vKipcbiAqIFJldHVybnMgYSBtb2RlbCByYW5nZSB3aGljaCBpcyBvcHRpbWFsIChpbiB0ZXJtcyBvZiBVWCkgZm9yIGluc2VydGluZyBhIHdpZGdldCBibG9jay5cbiAqXG4gKiBGb3IgaW5zdGFuY2UsIGlmIGEgc2VsZWN0aW9uIGlzIGluIHRoZSBtaWRkbGUgb2YgYSBwYXJhZ3JhcGgsIHRoZSBjb2xsYXBzZWQgcmFuZ2UgYmVmb3JlIHRoaXMgcGFyYWdyYXBoXG4gKiB3aWxsIGJlIHJldHVybmVkIHNvIHRoYXQgaXQgaXMgbm90IHNwbGl0LiBJZiB0aGUgc2VsZWN0aW9uIGlzIGF0IHRoZSBlbmQgb2YgYSBwYXJhZ3JhcGgsXG4gKiB0aGUgY29sbGFwc2VkIHJhbmdlIGFmdGVyIHRoaXMgcGFyYWdyYXBoIHdpbGwgYmUgcmV0dXJuZWQuXG4gKlxuICogTm90ZTogSWYgdGhlIHNlbGVjdGlvbiBpcyBwbGFjZWQgaW4gYW4gZW1wdHkgYmxvY2ssIHRoZSByYW5nZSBpbiB0aGF0IGJsb2NrIHdpbGwgYmUgcmV0dXJuZWQuIElmIHRoYXQgcmFuZ2VcbiAqIGlzIHRoZW4gcGFzc2VkIHRvIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2luc2VydENvbnRlbnR9LCB0aGUgYmxvY2sgd2lsbCBiZSBmdWxseSByZXBsYWNlZFxuICogYnkgdGhlIGluc2VydGVkIHdpZGdldCBibG9jay5cbiAqXG4gKiBAcGFyYW0gc2VsZWN0aW9uIFRoZSBzZWxlY3Rpb24gYmFzZWQgb24gd2hpY2ggdGhlIGluc2VydGlvbiBwb3NpdGlvbiBzaG91bGQgYmUgY2FsY3VsYXRlZC5cbiAqIEBwYXJhbSBtb2RlbCBNb2RlbCBpbnN0YW5jZS5cbiAqIEByZXR1cm5zIFRoZSBvcHRpbWFsIHJhbmdlLlxuICovIGZ1bmN0aW9uIGZpbmRPcHRpbWFsSW5zZXJ0aW9uUmFuZ2Uoc2VsZWN0aW9uLCBtb2RlbCkge1xuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudCA9IHNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICBpZiAoc2VsZWN0ZWRFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbiA9IGdldFR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbihzZWxlY3Rpb24pO1xuICAgICAgICAvLyBJZiB0aGUgV2lkZ2V0VHlwZUFyb3VuZCBcImZha2UgY2FyZXRcIiBpcyBkaXNwbGF5ZWQsIHVzZSBpdHMgcG9zaXRpb24gZm9yIHRoZSBpbnNlcnRpb25cbiAgICAgICAgLy8gdG8gcHJvdmlkZSB0aGUgbW9zdCBwcmVkaWN0YWJsZSBVWCAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvNzQzOCkuXG4gICAgICAgIGlmICh0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBtb2RlbC5jcmVhdGVSYW5nZShtb2RlbC5jcmVhdGVQb3NpdGlvbkF0KHNlbGVjdGVkRWxlbWVudCwgdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1vZGVsLnNjaGVtYS5maW5kT3B0aW1hbEluc2VydGlvblJhbmdlKHNlbGVjdGlvbik7XG59XG4vKipcbiAqIEEgdXRpbCB0byBiZSB1c2VkIGluIG9yZGVyIHRvIG1hcCB2aWV3IHBvc2l0aW9ucyB0byBjb3JyZWN0IG1vZGVsIHBvc2l0aW9ucyB3aGVuIGltcGxlbWVudGluZyBhIHdpZGdldFxuICogd2hpY2ggcmVuZGVycyBub24tZW1wdHkgdmlldyBlbGVtZW50IGZvciBhbiBlbXB0eSBtb2RlbCBlbGVtZW50LlxuICpcbiAqIEZvciBleGFtcGxlOlxuICpcbiAqIGBgYFxuICogLy8gTW9kZWw6XG4gKiA8cGxhY2Vob2xkZXIgdHlwZT1cIm5hbWVcIj48L3BsYWNlaG9sZGVyPlxuICpcbiAqIC8vIFZpZXc6XG4gKiA8c3BhbiBjbGFzcz1cInBsYWNlaG9sZGVyXCI+bmFtZTwvc3Bhbj5cbiAqIGBgYFxuICpcbiAqIEluIHN1Y2ggY2FzZSwgdmlldyBwb3NpdGlvbnMgaW5zaWRlIGA8c3Bhbj5gIGNhbm5vdCBiZSBjb3JyZWN0bHkgbWFwcGVkIHRvIHRoZSBtb2RlbCAoYmVjYXVzZSB0aGUgbW9kZWwgZWxlbWVudCBpcyBlbXB0eSkuXG4gKiBUbyBoYW5kbGUgbWFwcGluZyBwb3NpdGlvbnMgaW5zaWRlIGA8c3BhbiBjbGFzcz1cInBsYWNlaG9sZGVyXCI+YCB0byB0aGUgbW9kZWwgdXNlIHRoaXMgdXRpbCBhcyBmb2xsb3dzOlxuICpcbiAqIGBgYHRzXG4gKiBlZGl0b3IuZWRpdGluZy5tYXBwZXIub24oXG4gKiBcdCd2aWV3VG9Nb2RlbFBvc2l0aW9uJyxcbiAqIFx0dmlld1RvTW9kZWxQb3NpdGlvbk91dHNpZGVNb2RlbEVsZW1lbnQoIG1vZGVsLCB2aWV3RWxlbWVudCA9PiB2aWV3RWxlbWVudC5oYXNDbGFzcyggJ3BsYWNlaG9sZGVyJyApIClcbiAqICk7XG4gKiBgYGBcbiAqXG4gKiBUaGUgY2FsbGJhY2sgd2lsbCB0cnkgdG8gbWFwIHRoZSB2aWV3IG9mZnNldCBvZiBzZWxlY3Rpb24gdG8gYW4gZXhwZWN0ZWQgbW9kZWwgcG9zaXRpb24uXG4gKlxuICogMS4gV2hlbiB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGVuZCAob3IgaW4gdGhlIG1pZGRsZSkgb2YgdGhlIGlubGluZSB3aWRnZXQ6XG4gKlxuICogYGBgXG4gKiAvLyBWaWV3OlxuICogPHA+Zm9vIDxzcGFuIGNsYXNzPVwicGxhY2Vob2xkZXJcIj5uYW1lfDwvc3Bhbj4gYmFyPC9wPlxuICpcbiAqIC8vIE1vZGVsOlxuICogPHBhcmFncmFwaD5mb28gPHBsYWNlaG9sZGVyIHR5cGU9XCJuYW1lXCI+PC9wbGFjZWhvbGRlcj58IGJhcjwvcGFyYWdyYXBoPlxuICogYGBgXG4gKlxuICogMi4gV2hlbiB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgaW5saW5lIHdpZGdldDpcbiAqXG4gKiBgYGBcbiAqIC8vIFZpZXc6XG4gKiA8cD5mb28gPHNwYW4gY2xhc3M9XCJwbGFjZWhvbGRlclwiPnxuYW1lPC9zcGFuPiBiYXI8L3A+XG4gKlxuICogLy8gTW9kZWw6XG4gKiA8cGFyYWdyYXBoPmZvbyB8PHBsYWNlaG9sZGVyIHR5cGU9XCJuYW1lXCI+PC9wbGFjZWhvbGRlcj4gYmFyPC9wYXJhZ3JhcGg+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbW9kZWwgTW9kZWwgaW5zdGFuY2Ugb24gd2hpY2ggdGhlIGNhbGxiYWNrIG9wZXJhdGVzLlxuICogQHBhcmFtIHZpZXdFbGVtZW50TWF0Y2hlciBGdW5jdGlvbiB0aGF0IGlzIHBhc3NlZCBhIHZpZXcgZWxlbWVudCBhbmQgc2hvdWxkIHJldHVybiBgdHJ1ZWAgaWYgdGhlIGN1c3RvbSBtYXBwaW5nXG4gKiBzaG91bGQgYmUgYXBwbGllZCB0byB0aGUgZ2l2ZW4gdmlldyBlbGVtZW50LlxuICovIGZ1bmN0aW9uIHZpZXdUb01vZGVsUG9zaXRpb25PdXRzaWRlTW9kZWxFbGVtZW50KG1vZGVsLCB2aWV3RWxlbWVudE1hdGNoZXIpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSk9PntcbiAgICAgICAgY29uc3QgeyBtYXBwZXIsIHZpZXdQb3NpdGlvbiB9ID0gZGF0YTtcbiAgICAgICAgY29uc3Qgdmlld1BhcmVudCA9IG1hcHBlci5maW5kTWFwcGVkVmlld0FuY2VzdG9yKHZpZXdQb3NpdGlvbik7XG4gICAgICAgIGlmICghdmlld0VsZW1lbnRNYXRjaGVyKHZpZXdQYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZWxQYXJlbnQgPSBtYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld1BhcmVudCk7XG4gICAgICAgIGRhdGEubW9kZWxQb3NpdGlvbiA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQobW9kZWxQYXJlbnQsIHZpZXdQb3NpdGlvbi5pc0F0U3RhcnQgPyAnYmVmb3JlJyA6ICdhZnRlcicpO1xuICAgIH07XG59XG4vKipcbiAqIERlZmF1bHQgZmlsbGVyIG9mZnNldCBmdW5jdGlvbiBhcHBsaWVkIHRvIGFsbCB3aWRnZXQgZWxlbWVudHMuXG4gKi8gZnVuY3Rpb24gZ2V0RmlsbGVyT2Zmc2V0KCkge1xuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBBZGRzIGEgZHJhZyBoYW5kbGUgdG8gdGhlIHdpZGdldC5cbiAqLyBmdW5jdGlvbiBhZGRTZWxlY3Rpb25IYW5kbGUod2lkZ2V0RWxlbWVudCwgd3JpdGVyKSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uSGFuZGxlID0gd3JpdGVyLmNyZWF0ZVVJRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBjbGFzczogJ2NrIGNrLXdpZGdldF9fc2VsZWN0aW9uLWhhbmRsZSdcbiAgICB9LCBmdW5jdGlvbihkb21Eb2N1bWVudCkge1xuICAgICAgICBjb25zdCBkb21FbGVtZW50ID0gdGhpcy50b0RvbUVsZW1lbnQoZG9tRG9jdW1lbnQpO1xuICAgICAgICAvLyBVc2UgdGhlIEljb25WaWV3IGZyb20gdGhlIHVpIGxpYnJhcnkuXG4gICAgICAgIGNvbnN0IGljb24gPSBuZXcgSWNvblZpZXcoKTtcbiAgICAgICAgaWNvbi5zZXQoJ2NvbnRlbnQnLCBkcmFnSGFuZGxlSWNvbik7XG4gICAgICAgIC8vIFJlbmRlciB0aGUgaWNvbiB2aWV3IHJpZ2h0IGF3YXkgdG8gYXBwZW5kIGl0cyAjZWxlbWVudCB0byB0aGUgc2VsZWN0aW9uSGFuZGxlIERPTSBlbGVtZW50LlxuICAgICAgICBpY29uLnJlbmRlcigpO1xuICAgICAgICBkb21FbGVtZW50LmFwcGVuZENoaWxkKGljb24uZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBkb21FbGVtZW50O1xuICAgIH0pO1xuICAgIC8vIEFwcGVuZCB0aGUgc2VsZWN0aW9uIGhhbmRsZSBpbnRvIHRoZSB3aWRnZXQgd3JhcHBlci5cbiAgICB3cml0ZXIuaW5zZXJ0KHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHdpZGdldEVsZW1lbnQsIDApLCBzZWxlY3Rpb25IYW5kbGUpO1xuICAgIHdyaXRlci5hZGRDbGFzcyhbXG4gICAgICAgICdjay13aWRnZXRfd2l0aC1zZWxlY3Rpb24taGFuZGxlJ1xuICAgIF0sIHdpZGdldEVsZW1lbnQpO1xufVxuLyoqXG4gKiBTdGFydGluZyBmcm9tIGEgRE9NIHJlc2l6ZSBob3N0IGVsZW1lbnQgKGFuIGVsZW1lbnQgdGhhdCByZWNlaXZlcyBkaW1lbnNpb25zIGFzIGEgcmVzdWx0IG9mIHJlc2l6aW5nKSxcbiAqIHRoaXMgaGVscGVyIHJldHVybnMgdGhlIHdpZHRoIG9mIHRoZSBmb3VuZCBhbmNlc3RvciBlbGVtZW50LlxuICpcbiAqXHQqIEl0IHNlYXJjaGVzIHVwIHRvIDUgbGV2ZWxzIG9mIGFuY2VzdG9ycyBvbmx5LlxuICpcbiAqIEBwYXJhbSBkb21SZXNpemVIb3N0IFJlc2l6ZSBob3N0IERPTSBlbGVtZW50IHRoYXQgcmVjZWl2ZXMgZGltZW5zaW9ucyBhcyBhIHJlc3VsdCBvZiByZXNpemluZy5cbiAqIEByZXR1cm5zIFdpZHRoIG9mIGFuY2VzdG9yIGVsZW1lbnQgaW4gcGl4ZWxzIG9yIDAgaWYgbm8gYW5jZXN0b3Igd2l0aCBhIGNvbXB1dGVkIHdpZHRoIGhhcyBiZWVuIGZvdW5kLlxuICovIGZ1bmN0aW9uIGNhbGN1bGF0ZVJlc2l6ZUhvc3RBbmNlc3RvcldpZHRoKGRvbVJlc2l6ZUhvc3QpIHtcbiAgICBjb25zdCBnZXRFbGVtZW50Q29tcHV0ZWRXaWR0aCA9IChlbGVtZW50KT0+e1xuICAgICAgICBjb25zdCB7IHdpZHRoLCBwYWRkaW5nTGVmdCwgcGFkZGluZ1JpZ2h0IH0gPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQod2lkdGgpIC0gKHBhcnNlRmxvYXQocGFkZGluZ0xlZnQpIHx8IDApIC0gKHBhcnNlRmxvYXQocGFkZGluZ1JpZ2h0KSB8fCAwKTtcbiAgICB9O1xuICAgIGNvbnN0IGRvbVJlc2l6ZUhvc3RQYXJlbnQgPSBkb21SZXNpemVIb3N0LnBhcmVudEVsZW1lbnQ7XG4gICAgaWYgKCFkb21SZXNpemVIb3N0UGFyZW50KSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvLyBOZWVkIHRvIHVzZSBjb21wdXRlZCBzdHlsZSBhcyBpdCBwcm9wZXJseSBleGNsdWRlcyBwYXJlbnQncyBwYWRkaW5ncyBmcm9tIHRoZSByZXR1cm5lZCB2YWx1ZS5cbiAgICBsZXQgcGFyZW50V2lkdGggPSBnZXRFbGVtZW50Q29tcHV0ZWRXaWR0aChkb21SZXNpemVIb3N0UGFyZW50KTtcbiAgICAvLyBTb21ldGltZXMgcGFyZW50IHdpZHRoIGNhbm5vdCBiZSBhY2Nlc3NlZC4gSWYgdGhhdCBoYXBwZW5zIHdlIHNob3VsZCBnbyB1cCBpbiB0aGUgZWxlbWVudHMgdHJlZVxuICAgIC8vIGFuZCB0cnkgdG8gZ2V0IHdpZHRoIGZyb20gbmV4dCBhbmNlc3Rvci5cbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMDc3NlxuICAgIGNvbnN0IGFuY2VzdG9yTGV2ZWxMaW1pdCA9IDU7XG4gICAgbGV0IGN1cnJlbnRMZXZlbCA9IDA7XG4gICAgbGV0IGNoZWNrZWRFbGVtZW50ID0gZG9tUmVzaXplSG9zdFBhcmVudDtcbiAgICB3aGlsZShpc05hTihwYXJlbnRXaWR0aCkpe1xuICAgICAgICBjaGVja2VkRWxlbWVudCA9IGNoZWNrZWRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIGlmICgrK2N1cnJlbnRMZXZlbCA+IGFuY2VzdG9yTGV2ZWxMaW1pdCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcGFyZW50V2lkdGggPSBnZXRFbGVtZW50Q29tcHV0ZWRXaWR0aChjaGVja2VkRWxlbWVudCk7XG4gICAgfVxuICAgIHJldHVybiBwYXJlbnRXaWR0aDtcbn1cbi8qKlxuICogQ2FsY3VsYXRlcyBhIHJlbGF0aXZlIHdpZHRoIG9mIGEgYGRvbVJlc2l6ZUhvc3RgIGNvbXBhcmVkIHRvIGl0cyBhbmNlc3RvciBpbiBwZXJjZW50cy5cbiAqXG4gKiBAcGFyYW0gZG9tUmVzaXplSG9zdCBSZXNpemUgaG9zdCBET00gZWxlbWVudC5cbiAqIEByZXR1cm5zIFBlcmNlbnRhZ2UgdmFsdWUgYmV0d2VlbiAwIGFuZCAxMDAuXG4gKi8gZnVuY3Rpb24gY2FsY3VsYXRlUmVzaXplSG9zdFBlcmNlbnRhZ2VXaWR0aChkb21SZXNpemVIb3N0LCByZXNpemVIb3N0UmVjdCA9IG5ldyBSZWN0KGRvbVJlc2l6ZUhvc3QpKSB7XG4gICAgY29uc3QgcGFyZW50V2lkdGggPSBjYWxjdWxhdGVSZXNpemVIb3N0QW5jZXN0b3JXaWR0aChkb21SZXNpemVIb3N0KTtcbiAgICBpZiAoIXBhcmVudFdpZHRoKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gcmVzaXplSG9zdFJlY3Qud2lkdGggLyBwYXJlbnRXaWR0aCAqIDEwMDtcbn1cblxuLyoqXG4gKiBUaGUgbmFtZSBvZiB0aGUgdHlwZSBhcm91bmQgbW9kZWwgc2VsZWN0aW9uIGF0dHJpYnV0ZSByZXNwb25zaWJsZSBmb3JcbiAqIGRpc3BsYXlpbmcgYSBmYWtlIGNhcmV0IG5leHQgdG8gYSBzZWxlY3RlZCB3aWRnZXQuXG4gKi8gY29uc3QgVFlQRV9BUk9VTkRfU0VMRUNUSU9OX0FUVFJJQlVURSA9ICd3aWRnZXQtdHlwZS1hcm91bmQnO1xuLyoqXG4gKiBDaGVja3MgaWYgYW4gZWxlbWVudCBpcyBhIHdpZGdldCB0aGF0IHF1YWxpZmllcyB0byBnZXQgdGhlIHdpZGdldCB0eXBlIGFyb3VuZCBVSS5cbiAqLyBmdW5jdGlvbiBpc1R5cGVBcm91bmRXaWRnZXQodmlld0VsZW1lbnQsIG1vZGVsRWxlbWVudCwgc2NoZW1hKSB7XG4gICAgcmV0dXJuICEhdmlld0VsZW1lbnQgJiYgaXNXaWRnZXQodmlld0VsZW1lbnQpICYmICFzY2hlbWEuaXNJbmxpbmUobW9kZWxFbGVtZW50KTtcbn1cbi8qKlxuICogRm9yIHRoZSBwYXNzZWQgSFRNTCBlbGVtZW50LCB0aGlzIGhlbHBlciBmaW5kcyB0aGUgY2xvc2VzdCB3aWRnZXQgdHlwZSBhcm91bmQgYnV0dG9uIGFuY2VzdG9yLlxuICovIGZ1bmN0aW9uIGdldENsb3Nlc3RUeXBlQXJvdW5kRG9tQnV0dG9uKGRvbUVsZW1lbnQpIHtcbiAgICByZXR1cm4gZG9tRWxlbWVudC5jbG9zZXN0KCcuY2std2lkZ2V0X190eXBlLWFyb3VuZF9fYnV0dG9uJyk7XG59XG4vKipcbiAqIEZvciB0aGUgcGFzc2VkIHdpZGdldCB0eXBlIGFyb3VuZCBidXR0b24gZWxlbWVudCwgdGhpcyBoZWxwZXIgZGV0ZXJtaW5lcyBhdCB3aGljaCBwb3NpdGlvblxuICogdGhlIHBhcmFncmFwaCB3b3VsZCBiZSBpbnNlcnRlZCBpbnRvIHRoZSBjb250ZW50IGlmLCBmb3IgaW5zdGFuY2UsIHRoZSBidXR0b24gd2FzXG4gKiBjbGlja2VkIGJ5IHRoZSB1c2VyLlxuICpcbiAqIEByZXR1cm5zIFRoZSBwb3NpdGlvbiBvZiB0aGUgYnV0dG9uLlxuICovIGZ1bmN0aW9uIGdldFR5cGVBcm91bmRCdXR0b25Qb3NpdGlvbihkb21FbGVtZW50KSB7XG4gICAgcmV0dXJuIGRvbUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjay13aWRnZXRfX3R5cGUtYXJvdW5kX19idXR0b25fYmVmb3JlJykgPyAnYmVmb3JlJyA6ICdhZnRlcic7XG59XG4vKipcbiAqIEZvciB0aGUgcGFzc2VkIEhUTUwgZWxlbWVudCwgdGhpcyBoZWxwZXIgcmV0dXJucyB0aGUgY2xvc2VzdCB2aWV3IHdpZGdldCBhbmNlc3Rvci5cbiAqLyBmdW5jdGlvbiBnZXRDbG9zZXN0V2lkZ2V0Vmlld0VsZW1lbnQoZG9tRWxlbWVudCwgZG9tQ29udmVydGVyKSB7XG4gICAgY29uc3Qgd2lkZ2V0RG9tRWxlbWVudCA9IGRvbUVsZW1lbnQuY2xvc2VzdCgnLmNrLXdpZGdldCcpO1xuICAgIHJldHVybiBkb21Db252ZXJ0ZXIubWFwRG9tVG9WaWV3KHdpZGdldERvbUVsZW1lbnQpO1xufVxuLyoqXG4gKiBGb3IgdGhlIHBhc3NlZCBzZWxlY3Rpb24gaW5zdGFuY2UsIGl0IHJldHVybnMgdGhlIHBvc2l0aW9uIG9mIHRoZSBmYWtlIGNhcmV0IGRpc3BsYXllZCBuZXh0IHRvIGEgd2lkZ2V0LlxuICpcbiAqICoqTm90ZSoqOiBJZiB0aGUgZmFrZSBjYXJldCBpcyBub3QgY3VycmVudGx5IGRpc3BsYXllZCwgYG51bGxgIGlzIHJldHVybmVkLlxuICpcbiAqIEByZXR1cm5zIFRoZSBwb3NpdGlvbiBvZiB0aGUgZmFrZSBjYXJldCBvciBgbnVsbGAgd2hlbiBub25lIGlzIHByZXNlbnQuXG4gKi8gZnVuY3Rpb24gZ2V0VHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKHNlbGVjdGlvbikge1xuICAgIHJldHVybiBzZWxlY3Rpb24uZ2V0QXR0cmlidXRlKFRZUEVfQVJPVU5EX1NFTEVDVElPTl9BVFRSSUJVVEUpO1xufVxuXG52YXIgcmV0dXJuSWNvbiA9IFwiPHN2ZyB2aWV3Qm94PVxcXCIwIDAgMTAgOFxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIj48cGF0aCBkPVxcXCJNOS4wNTUuMjYzdjMuOTcyaC02Ljc3TTEgNC4yMTZsMi0yLjAzOG0tMiAyIDIgMi4wMzhcXFwiLz48L3N2Zz5cIjtcblxuY29uc3QgUE9TU0lCTEVfSU5TRVJUSU9OX1BPU0lUSU9OUyA9IFtcbiAgICAnYmVmb3JlJyxcbiAgICAnYWZ0ZXInXG5dO1xuLy8gRG8gdGhlIFNWRyBwYXJzaW5nIG9uY2UgYW5kIHRoZW4gY2xvbmUgdGhlIHJlc3VsdCA8c3ZnPiBET00gZWxlbWVudCBmb3IgZWFjaCBuZXcgYnV0dG9uLlxuY29uc3QgUkVUVVJOX0FSUk9XX0lDT05fRUxFTUVOVCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcocmV0dXJuSWNvbiwgJ2ltYWdlL3N2Zyt4bWwnKS5maXJzdENoaWxkO1xuY29uc3QgUExVR0lOX0RJU0FCTEVEX0VESVRJTkdfUk9PVF9DTEFTUyA9ICdjay13aWRnZXRfX3R5cGUtYXJvdW5kX2Rpc2FibGVkJztcbi8qKlxuICogQSBwbHVnaW4gdGhhdCBhbGxvd3MgdXNlcnMgdG8gdHlwZSBhcm91bmQgd2lkZ2V0cyB3aGVyZSBub3JtYWxseSBpdCBpcyBpbXBvc3NpYmxlIHRvIHBsYWNlIHRoZSBjYXJldCBkdWVcbiAqIHRvIGxpbWl0YXRpb25zIG9mIHdlYiBicm93c2Vycy4gVGhlc2UgXCJ0aWdodCBzcG90c1wiIG9jY3VyLCBmb3IgaW5zdGFuY2UsIGJlZm9yZSAob3IgYWZ0ZXIpIGEgd2lkZ2V0IGJlaW5nXG4gKiB0aGUgZmlyc3QgKG9yIGxhc3QpIGNoaWxkIG9mIGl0cyBwYXJlbnQgb3IgYmV0d2VlbiB0d28gYmxvY2sgd2lkZ2V0cy5cbiAqXG4gKiBUaGlzIHBsdWdpbiBleHRlbmRzIHRoZSB7QGxpbmsgbW9kdWxlOndpZGdldC93aWRnZXR+V2lkZ2V0IGBXaWRnZXRgfSBwbHVnaW4gYW5kIGluamVjdHMgdGhlIHVzZXIgaW50ZXJmYWNlXG4gKiB3aXRoIHR3byBidXR0b25zIGludG8gZWFjaCB3aWRnZXQgaW5zdGFuY2UgaW4gdGhlIGVkaXRvci4gRWFjaCBvZiB0aGUgYnV0dG9ucyBjYW4gYmUgY2xpY2tlZCBieSB0aGVcbiAqIHVzZXIgaWYgdGhlIHdpZGdldCBpcyBuZXh0IHRvIHRoZSBcInRpZ2h0IHNwb3RcIi4gT25jZSBjbGlja2VkLCBhIHBhcmFncmFwaCBpcyBjcmVhdGVkIHdpdGggdGhlIHNlbGVjdGlvbiBhbmNob3JlZFxuICogaW4gaXQgc28gdGhhdCB1c2VycyBjYW4gdHlwZSAob3IgaW5zZXJ0IGNvbnRlbnQsIHBhc3RlLCBldGMuKSBzdHJhaWdodCBhd2F5LlxuICovIGNsYXNzIFdpZGdldFR5cGVBcm91bmQgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBBIHJlZmVyZW5jZSB0byB0aGUgbW9kZWwgd2lkZ2V0IGVsZW1lbnQgdGhhdCBoYXMgdGhlIGZha2UgY2FyZXQgYWN0aXZlXG5cdCAqIG9uIGVpdGhlciBzaWRlIG9mIGl0LiBJdCBpcyBsYXRlciB1c2VkIHRvIHJlbW92ZSBDU1MgY2xhc3NlcyBhc3NvY2lhdGVkIHdpdGggdGhlIGZha2UgY2FyZXRcblx0ICogd2hlbiB0aGUgd2lkZ2V0IG5vIGxvbmdlciBuZWVkcyBpdC5cblx0ICovIF9jdXJyZW50RmFrZUNhcmV0TW9kZWxFbGVtZW50ID0gbnVsbDtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdXaWRnZXRUeXBlQXJvdW5kJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBFbnRlcixcbiAgICAgICAgICAgIERlbGV0ZVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGluaXQoKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBlZGl0aW5nVmlldyA9IGVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIC8vIFNldCBhIENTUyBjbGFzcyBvbiB0aGUgdmlldyBlZGl0aW5nIHJvb3Qgd2hlbiB0aGUgcGx1Z2luIGlzIGRpc2FibGVkIHNvIGFsbCB0aGUgYnV0dG9uc1xuICAgICAgICAvLyBhbmQgbGluZXMgdmlzdWFsbHkgZGlzYXBwZWFyLiBBbGwgdGhlIGludGVyYWN0aW9ucyBhcmUgZGlzYWJsZWQgaW4gaW5kaXZpZHVhbCBwbHVnaW4gbWV0aG9kcy5cbiAgICAgICAgdGhpcy5vbignY2hhbmdlOmlzRW5hYmxlZCcsIChldnQsIGRhdGEsIGlzRW5hYmxlZCk9PntcbiAgICAgICAgICAgIGVkaXRpbmdWaWV3LmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgcm9vdCBvZiBlZGl0aW5nVmlldy5kb2N1bWVudC5yb290cyl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVDbGFzcyhQTFVHSU5fRElTQUJMRURfRURJVElOR19ST09UX0NMQVNTLCByb290KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5hZGRDbGFzcyhQTFVHSU5fRElTQUJMRURfRURJVElOR19ST09UX0NMQVNTLCByb290KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFpc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUoVFlQRV9BUk9VTkRfU0VMRUNUSU9OX0FUVFJJQlVURSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9lbmFibGVUeXBlQXJvdW5kVUlJbmplY3Rpb24oKTtcbiAgICAgICAgdGhpcy5fZW5hYmxlSW5zZXJ0aW5nUGFyYWdyYXBoc09uQnV0dG9uQ2xpY2soKTtcbiAgICAgICAgdGhpcy5fZW5hYmxlSW5zZXJ0aW5nUGFyYWdyYXBoc09uRW50ZXJLZXlwcmVzcygpO1xuICAgICAgICB0aGlzLl9lbmFibGVJbnNlcnRpbmdQYXJhZ3JhcGhzT25UeXBpbmdLZXlzdHJva2UoKTtcbiAgICAgICAgdGhpcy5fZW5hYmxlVHlwZUFyb3VuZEZha2VDYXJldEFjdGl2YXRpb25Vc2luZ0tleWJvYXJkQXJyb3dzKCk7XG4gICAgICAgIHRoaXMuX2VuYWJsZURlbGV0ZUludGVncmF0aW9uKCk7XG4gICAgICAgIHRoaXMuX2VuYWJsZUluc2VydENvbnRlbnRJbnRlZ3JhdGlvbigpO1xuICAgICAgICB0aGlzLl9lbmFibGVJbnNlcnRPYmplY3RJbnRlZ3JhdGlvbigpO1xuICAgICAgICB0aGlzLl9lbmFibGVEZWxldGVDb250ZW50SW50ZWdyYXRpb24oKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBkZXN0cm95KCkge1xuICAgICAgICBzdXBlci5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRGYWtlQ2FyZXRNb2RlbEVsZW1lbnQgPSBudWxsO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5zZXJ0cyBhIG5ldyBwYXJhZ3JhcGggbmV4dCB0byBhIHdpZGdldCBlbGVtZW50IHdpdGggdGhlIHNlbGVjdGlvbiBhbmNob3JlZCBpbiBpdC5cblx0ICpcblx0ICogKipOb3RlKio6IFRoaXMgbWV0aG9kIGlzIGhlYXZpbHkgdXNlci1vcmllbnRlZCBhbmQgd2lsbCBib3RoIGZvY3VzIHRoZSBlZGl0aW5nIHZpZXcgYW5kIHNjcm9sbFxuXHQgKiB0aGUgdmlld3BvcnQgdG8gdGhlIHNlbGVjdGlvbiBpbiB0aGUgaW5zZXJ0ZWQgcGFyYWdyYXBoLlxuXHQgKlxuXHQgKiBAcGFyYW0gd2lkZ2V0TW9kZWxFbGVtZW50IFRoZSBtb2RlbCB3aWRnZXQgZWxlbWVudCBuZXh0IHRvIHdoaWNoIGEgcGFyYWdyYXBoIGlzIGluc2VydGVkLlxuXHQgKiBAcGFyYW0gcG9zaXRpb24gVGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBwYXJhZ3JhcGggaXMgaW5zZXJ0ZWQuIEVpdGhlciBgJ2JlZm9yZSdgIG9yIGAnYWZ0ZXInYCB0aGUgd2lkZ2V0LlxuXHQgKi8gX2luc2VydFBhcmFncmFwaCh3aWRnZXRNb2RlbEVsZW1lbnQsIHBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBlZGl0aW5nVmlldyA9IGVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZXNUb0NvcHkgPSBlZGl0b3IubW9kZWwuc2NoZW1hLmdldEF0dHJpYnV0ZXNXaXRoUHJvcGVydHkod2lkZ2V0TW9kZWxFbGVtZW50LCAnY29weU9uUmVwbGFjZScsIHRydWUpO1xuICAgICAgICBlZGl0b3IuZXhlY3V0ZSgnaW5zZXJ0UGFyYWdyYXBoJywge1xuICAgICAgICAgICAgcG9zaXRpb246IGVkaXRvci5tb2RlbC5jcmVhdGVQb3NpdGlvbkF0KHdpZGdldE1vZGVsRWxlbWVudCwgcG9zaXRpb24pLFxuICAgICAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlc1RvQ29weVxuICAgICAgICB9KTtcbiAgICAgICAgZWRpdGluZ1ZpZXcuZm9jdXMoKTtcbiAgICAgICAgZWRpdGluZ1ZpZXcuc2Nyb2xsVG9UaGVTZWxlY3Rpb24oKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgd3JhcHBlciBmb3IgdGhlIHtAbGluayBtb2R1bGU6dXRpbHMvZW1pdHRlcm1peGlufkVtaXR0ZXIjbGlzdGVuVG99IG1ldGhvZCB0aGF0IGV4ZWN1dGVzIHRoZSBjYWxsYmFja3Mgb25seVxuXHQgKiB3aGVuIHRoZSBwbHVnaW4ge0BsaW5rICNpc0VuYWJsZWQgaXMgZW5hYmxlZH0uXG5cdCAqXG5cdCAqIEBwYXJhbSBlbWl0dGVyIFRoZSBvYmplY3QgdGhhdCBmaXJlcyB0aGUgZXZlbnQuXG5cdCAqIEBwYXJhbSBldmVudCBUaGUgbmFtZSBvZiB0aGUgZXZlbnQuXG5cdCAqIEBwYXJhbSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIG9uIGV2ZW50LlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbnMuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnByaW9yaXR5IFRoZSBwcmlvcml0eSBvZiB0aGlzIGV2ZW50IGNhbGxiYWNrLiBUaGUgaGlnaGVyIHRoZSBwcmlvcml0eSB2YWx1ZSB0aGUgc29vbmVyXG5cdCAqIHRoZSBjYWxsYmFjayB3aWxsIGJlIGZpcmVkLiBFdmVudHMgaGF2aW5nIHRoZSBzYW1lIHByaW9yaXR5IGFyZSBjYWxsZWQgaW4gdGhlIG9yZGVyIHRoZXkgd2VyZSBhZGRlZC5cblx0ICovIF9saXN0ZW5Ub0lmRW5hYmxlZChlbWl0dGVyLCBldmVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlbWl0dGVyLCBldmVudCwgKC4uLmFyZ3MpPT57XG4gICAgICAgICAgICAvLyBEbyBub3QgcmVzcG9uZCBpZiB0aGUgcGx1Z2luIGlzIGRpc2FibGVkLlxuICAgICAgICAgICAgaWYgKHRoaXMuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soLi4uYXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcblx0ICogU2ltaWxhciB0byB7QGxpbmsgI19pbnNlcnRQYXJhZ3JhcGh9LCB0aGlzIG1ldGhvZCBpbnNlcnRzIGEgcGFyYWdyYXBoIGV4Y2VwdCB0aGF0IGl0XG5cdCAqIGRvZXMgbm90IGV4cGVjdCBhIHBvc2l0aW9uLiBJbnN0ZWFkLCBpdCBwZXJmb3JtcyB0aGUgaW5zZXJ0aW9uIG5leHQgdG8gYSBzZWxlY3RlZCB3aWRnZXRcblx0ICogYWNjb3JkaW5nIHRvIHRoZSBgd2lkZ2V0LXR5cGUtYXJvdW5kYCBtb2RlbCBzZWxlY3Rpb24gYXR0cmlidXRlIHZhbHVlIChmYWtlIGNhcmV0IHBvc2l0aW9uKS5cblx0ICpcblx0ICogQmVjYXVzZSB0aGlzIG1ldGhvZCByZXF1aXJlcyB0aGUgYHdpZGdldC10eXBlLWFyb3VuZGAgYXR0cmlidXRlIHRvIGJlIHNldCxcblx0ICogdGhlIGluc2VydGlvbiBjYW4gb25seSBoYXBwZW4gd2hlbiB0aGUgd2lkZ2V0J3MgZmFrZSBjYXJldCBpcyBhY3RpdmUgKGUuZy4gYWN0aXZhdGVkXG5cdCAqIHVzaW5nIHRoZSBrZXlib2FyZCkuXG5cdCAqXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIHdoZW4gdGhlIHBhcmFncmFwaCB3YXMgaW5zZXJ0ZWQgKHRoZSBhdHRyaWJ1dGUgd2FzIHByZXNlbnQpIGFuZCBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIF9pbnNlcnRQYXJhZ3JhcGhBY2NvcmRpbmdUb0Zha2VDYXJldFBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IG1vZGVsU2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24gPSBnZXRUeXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24obW9kZWxTZWxlY3Rpb24pO1xuICAgICAgICBpZiAoIXR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gaWYgKCAoIHdpbmRvdyBhcyBhbnkgKS5sb2dDS0VUeXBpbmcgKSB7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRjb25zb2xlLmluZm8oICclY1tXaWRnZXRUeXBlQXJvdW5kXSVjIEZha2UgY2FyZXQgLT4gaW5zZXJ0IHBhcmFncmFwaCcsXG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gXHRcdCdmb250LXdlaWdodDogYm9sZDsgY29sb3I6IGdyZWVuJywgJydcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX1RZUElORyAvLyBcdCk7XG4gICAgICAgIC8vIEBpZiBDS19ERUJVR19UWVBJTkcgLy8gfVxuICAgICAgICBjb25zdCBzZWxlY3RlZE1vZGVsRWxlbWVudCA9IG1vZGVsU2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICB0aGlzLl9pbnNlcnRQYXJhZ3JhcGgoc2VsZWN0ZWRNb2RlbEVsZW1lbnQsIHR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyBhIGxpc3RlbmVyIGluIHRoZSBlZGl0aW5nIGNvbnZlcnNpb24gcGlwZWxpbmUgdGhhdCBpbmplY3RzIHRoZSB3aWRnZXQgdHlwZSBhcm91bmRcblx0ICogVUkgaW50byBldmVyeSBzaW5nbGUgd2lkZ2V0IGluc3RhbmNlIGNyZWF0ZWQgaW4gdGhlIGVkaXRvci5cblx0ICpcblx0ICogVGhlIFVJIGlzIGRlbGl2ZXJlZCBhcyBhIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudH1cblx0ICogd3JhcHBlciB3aGljaCByZW5kZXJzIERPTSBidXR0b25zIHRoYXQgdXNlcnMgY2FuIHVzZSB0byBpbnNlcnQgcGFyYWdyYXBocy5cblx0ICovIF9lbmFibGVUeXBlQXJvdW5kVUlJbmplY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSBlZGl0b3IubW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCB0ID0gZWRpdG9yLmxvY2FsZS50O1xuICAgICAgICBjb25zdCBidXR0b25UaXRsZXMgPSB7XG4gICAgICAgICAgICBiZWZvcmU6IHQoJ0luc2VydCBwYXJhZ3JhcGggYmVmb3JlIGJsb2NrJyksXG4gICAgICAgICAgICBhZnRlcjogdCgnSW5zZXJ0IHBhcmFncmFwaCBhZnRlciBibG9jaycpXG4gICAgICAgIH07XG4gICAgICAgIGVkaXRvci5lZGl0aW5nLmRvd25jYXN0RGlzcGF0Y2hlci5vbignaW5zZXJ0JywgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3RWxlbWVudChkYXRhLml0ZW0pO1xuICAgICAgICAgICAgaWYgKCF2aWV3RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZpbHRlciBvdXQgbm9uLXdpZGdldHMgYW5kIGlubGluZSB3aWRnZXRzLlxuICAgICAgICAgICAgaWYgKGlzVHlwZUFyb3VuZFdpZGdldCh2aWV3RWxlbWVudCwgZGF0YS5pdGVtLCBzY2hlbWEpKSB7XG4gICAgICAgICAgICAgICAgaW5qZWN0VUlJbnRvV2lkZ2V0KGNvbnZlcnNpb25BcGkud3JpdGVyLCBidXR0b25UaXRsZXMsIHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICBjb25zdCB3aWRnZXRMYWJlbCA9IHZpZXdFbGVtZW50LmdldEN1c3RvbVByb3BlcnR5KCd3aWRnZXRMYWJlbCcpO1xuICAgICAgICAgICAgICAgIHdpZGdldExhYmVsLnB1c2goKCk9PntcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNFbmFibGVkID8gdCgnUHJlc3MgRW50ZXIgdG8gdHlwZSBhZnRlciBvciBwcmVzcyBTaGlmdCArIEVudGVyIHRvIHR5cGUgYmVmb3JlIHRoZSB3aWRnZXQnKSA6ICcnO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBCcmluZ3Mgc3VwcG9ydCBmb3IgdGhlIGZha2UgY2FyZXQgdGhhdCBhcHBlYXJzIHdoZW4gZWl0aGVyOlxuXHQgKlxuXHQgKiAqIHRoZSBzZWxlY3Rpb24gbW92ZXMgdG8gYSB3aWRnZXQgZnJvbSBhIHBvc2l0aW9uIG5leHQgdG8gaXQgdXNpbmcgYXJyb3cga2V5cyxcblx0ICogKiB0aGUgYXJyb3cga2V5IGlzIHByZXNzZWQgd2hlbiB0aGUgd2lkZ2V0IGlzIGFscmVhZHkgc2VsZWN0ZWQuXG5cdCAqXG5cdCAqIFRoZSBmYWtlIGNhcmV0IGxldHMgdGhlIHVzZXIga25vdyB0aGF0IHRoZXkgY2FuIHN0YXJ0IHR5cGluZyBvciBqdXN0IHByZXNzXG5cdCAqIDxrYmQ+RW50ZXI8L2tiZD4gdG8gaW5zZXJ0IGEgcGFyYWdyYXBoIGF0IHRoZSBwb3NpdGlvbiBuZXh0IHRvIGEgd2lkZ2V0IGFzIHN1Z2dlc3RlZCBieSB0aGUgZmFrZSBjYXJldC5cblx0ICpcblx0ICogVGhlIGZha2UgY2FyZXQgZGlzYXBwZWFycyB3aGVuIHRoZSB1c2VyIGNoYW5nZXMgdGhlIHNlbGVjdGlvbiBvciB0aGUgZWRpdG9yXG5cdCAqIGdldHMgYmx1cnJlZC5cblx0ICpcblx0ICogVGhlIHdob2xlIGlkZWEgaXMgYXMgZm9sbG93czpcblx0ICpcblx0ICogMS4gQSB1c2VyIGRvZXMgb25lIG9mIHRoZSAyIHNjZW5hcmlvcyBkZXNjcmliZWQgYXQgdGhlIGJlZ2lubmluZy5cblx0ICogMi4gVGhlIFwia2V5ZG93blwiIGxpc3RlbmVyIGlzIGV4ZWN1dGVkIGFuZCB0aGUgZGVjaXNpb24gaXMgbWFkZSB3aGV0aGVyIHRvIHNob3cgb3IgaGlkZSB0aGUgZmFrZSBjYXJldC5cblx0ICogMy4gSWYgaXQgc2hvdWxkIHNob3cgdXAsIHRoZSBgd2lkZ2V0LXR5cGUtYXJvdW5kYCBtb2RlbCBzZWxlY3Rpb24gYXR0cmlidXRlIGlzIHNldCBpbmRpY2F0aW5nXG5cdCAqICAgIG9uIHdoaWNoIHNpZGUgb2YgdGhlIHdpZGdldCBpdCBzaG91bGQgYXBwZWFyLlxuXHQgKiA0LiBUaGUgc2VsZWN0aW9uIGRpc3BhdGNoZXIgcmVhY3RzIHRvIHRoZSBzZWxlY3Rpb24gYXR0cmlidXRlIGFuZCBzZXRzIENTUyBjbGFzc2VzIHJlc3BvbnNpYmxlIGZvciB0aGVcblx0ICogICAgZmFrZSBjYXJldCBvbiB0aGUgdmlldyB3aWRnZXQuXG5cdCAqIDUuIElmIHRoZSBmYWtlIGNhcmV0IHNob3VsZCBkaXNhcHBlYXIsIHRoZSBzZWxlY3Rpb24gYXR0cmlidXRlIGlzIHJlbW92ZWQgYW5kIHRoZSBkaXNwYXRjaGVyXG5cdCAqICAgIGRvZXMgdGhlIENTUyBjbGFzcyBjbGVhbi11cCBpbiB0aGUgdmlldy5cblx0ICogNi4gQWRkaXRpb25hbGx5LCBgY2hhbmdlOnJhbmdlYCBhbmQgYEZvY3VzVHJhY2tlciNpc0ZvY3VzZWRgIGxpc3RlbmVycyBhbHNvIHJlbW92ZSB0aGUgc2VsZWN0aW9uXG5cdCAqICAgIGF0dHJpYnV0ZSAodGhlIGZvcm1lciBhbHNvIHJlbW92ZXMgd2lkZ2V0IENTUyBjbGFzc2VzKS5cblx0ICovIF9lbmFibGVUeXBlQXJvdW5kRmFrZUNhcmV0QWN0aXZhdGlvblVzaW5nS2V5Ym9hcmRBcnJvd3MoKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICAvLyBUaGlzIGlzIHRoZSBtYWluIGxpc3RlbmVyIHJlc3BvbnNpYmxlIGZvciB0aGUgZmFrZSBjYXJldC5cbiAgICAgICAgLy8gTm90ZTogVGhlIHByaW9yaXR5IG11c3QgcHJlY2VkZSB0aGUgZGVmYXVsdCBXaWRnZXQgY2xhc3Mga2V5ZG93biBoYW5kbGVyIChcImhpZ2hcIikuXG4gICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKGVkaXRpbmdWaWV3LmRvY3VtZW50LCAnYXJyb3dLZXknLCAoZXZ0LCBkb21FdmVudERhdGEpPT57XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVBcnJvd0tleVByZXNzKGV2dCwgZG9tRXZlbnREYXRhKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogW1xuICAgICAgICAgICAgICAgIGlzV2lkZ2V0LFxuICAgICAgICAgICAgICAgICckdGV4dCdcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUaGlzIGxpc3RlbmVyIG1ha2VzIHN1cmUgdGhlIHdpZGdldCB0eXBlIGFyb3VuZCBzZWxlY3Rpb24gYXR0cmlidXRlIHdpbGwgYmUgZ29uZSBmcm9tIHRoZSBtb2RlbFxuICAgICAgICAvLyBzZWxlY3Rpb24gYXMgc29vbiBhcyB0aGUgbW9kZWwgcmFuZ2UgY2hhbmdlcy4gVGhpcyBhdHRyaWJ1dGUgb25seSBtYWtlcyBzZW5zZSB3aGVuIGEgd2lkZ2V0IGlzIHNlbGVjdGVkXG4gICAgICAgIC8vIChhbmQgdGhlIFwiZmFrZSBob3Jpem9udGFsIGNhcmV0XCIgaXMgdmlzaWJsZSkgc28gd2hlbmV2ZXIgdGhlIHJhbmdlIGNoYW5nZXMgKGUuZy4gc2VsZWN0aW9uIG1vdmVkIHNvbWV3aGVyZSBlbHNlKSxcbiAgICAgICAgLy8gbGV0J3MgZ2V0IHJpZCBvZiB0aGUgYXR0cmlidXRlIHNvIHRoYXQgdGhlIHNlbGVjdGlvbiBkb3duY2FzdCBkaXNwYXRjaGVyIGlzbid0IGV2ZW4gYm90aGVyZWQuXG4gICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKG1vZGVsU2VsZWN0aW9uLCAnY2hhbmdlOnJhbmdlJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgIC8vIERvIG5vdCByZXNldCB0aGUgc2VsZWN0aW9uIGF0dHJpYnV0ZSB3aGVuIHRoZSBjaGFuZ2Ugd2FzIGluZGlyZWN0LlxuICAgICAgICAgICAgaWYgKCFkYXRhLmRpcmVjdENoYW5nZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEdldCByaWQgb2YgdGhlIHdpZGdldCB0eXBlIGFyb3VuZCBhdHRyaWJ1dGUgb2YgdGhlIHNlbGVjdGlvbiBvbiBldmVyeSBjaGFuZ2U6cmFuZ2UuXG4gICAgICAgICAgICAvLyBJZiB0aGUgcmFuZ2UgY2hhbmdlcywgaXQgbWVhbnMgZm9yIHN1cmUsIHRoZSB1c2VyIGlzIG5vIGxvbmdlciBpbiB0aGUgYWN0aXZlIChcImZha2UgaG9yaXpvbnRhbCBjYXJldFwiKSBtb2RlLlxuICAgICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUoVFlQRV9BUk9VTkRfU0VMRUNUSU9OX0FUVFJJQlVURSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEdldCByaWQgb2YgdGhlIHdpZGdldCB0eXBlIGFyb3VuZCBhdHRyaWJ1dGUgb2YgdGhlIHNlbGVjdGlvbiBvbiBldmVyeSBkb2N1bWVudCBjaGFuZ2VcbiAgICAgICAgLy8gdGhhdCBtYWtlcyB3aWRnZXQgbm90IHNlbGVjdGVkIGFueSBtb3JlIChpLmUuIHdpZGdldCB3YXMgcmVtb3ZlZCkuXG4gICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKG1vZGVsLmRvY3VtZW50LCAnY2hhbmdlOmRhdGEnLCAoKT0+e1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRNb2RlbEVsZW1lbnQgPSBtb2RlbFNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZE1vZGVsRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVmlld0VsZW1lbnQgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXIudG9WaWV3RWxlbWVudChzZWxlY3RlZE1vZGVsRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgaWYgKGlzVHlwZUFyb3VuZFdpZGdldChzZWxlY3RlZFZpZXdFbGVtZW50LCBzZWxlY3RlZE1vZGVsRWxlbWVudCwgc2NoZW1hKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUoVFlQRV9BUk9VTkRfU0VMRUNUSU9OX0FUVFJJQlVURSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlYWN0IHRvIGNoYW5nZXMgb2YgdGhlIG1vZGVsIHNlbGVjdGlvbiBhdHRyaWJ1dGUgbWFkZSBieSB0aGUgYXJyb3cga2V5cyBsaXN0ZW5lci5cbiAgICAgICAgLy8gSWYgdGhlIGJsb2NrIHdpZGdldCBpcyBzZWxlY3RlZCBhbmQgdGhlIGF0dHJpYnV0ZSBjaGFuZ2VzLCBkb3duY2FzdCB0aGUgYXR0cmlidXRlIHRvIHNwZWNpYWxcbiAgICAgICAgLy8gQ1NTIGNsYXNzZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhY3RpdmUgKFwiZmFrZSBob3Jpem9udGFsIGNhcmV0XCIpIG1vZGUgb2YgdGhlIHdpZGdldC5cbiAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQoZWRpdG9yLmVkaXRpbmcuZG93bmNhc3REaXNwYXRjaGVyLCAnc2VsZWN0aW9uJywgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgIGNvbnN0IHdyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRGYWtlQ2FyZXRNb2RlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFZpZXdFbGVtZW50ID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3RWxlbWVudCh0aGlzLl9jdXJyZW50RmFrZUNhcmV0TW9kZWxFbGVtZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRWaWV3RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgcmlkIG9mIENTUyBjbGFzc2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWN0aXZlIChcImZha2UgaG9yaXpvbnRhbCBjYXJldFwiKSBtb2RlIGZyb20gdGhlIHZpZXcgd2lkZ2V0LlxuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQ2xhc3MoUE9TU0lCTEVfSU5TRVJUSU9OX1BPU0lUSU9OUy5tYXAocG9zaXRpb25Ub1dpZGdldENzc0NsYXNzKSwgc2VsZWN0ZWRWaWV3RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGYWtlQ2FyZXRNb2RlbEVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTW9kZWxFbGVtZW50ID0gZGF0YS5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7XG4gICAgICAgICAgICBpZiAoIXNlbGVjdGVkTW9kZWxFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRWaWV3RWxlbWVudCA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld0VsZW1lbnQoc2VsZWN0ZWRNb2RlbEVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKCFpc1R5cGVBcm91bmRXaWRnZXQoc2VsZWN0ZWRWaWV3RWxlbWVudCwgc2VsZWN0ZWRNb2RlbEVsZW1lbnQsIHNjaGVtYSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24gPSBnZXRUeXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24oZGF0YS5zZWxlY3Rpb24pO1xuICAgICAgICAgICAgaWYgKCF0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3cml0ZXIuYWRkQ2xhc3MocG9zaXRpb25Ub1dpZGdldENzc0NsYXNzKHR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbiksIHNlbGVjdGVkVmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhlIHZpZXcgd2lkZ2V0IHRoYXQgZ290IHRoZSBcImZha2UtY2FyZXRcIiBDU1MgY2xhc3MuIFRoaXMgY2xhc3Mgc2hvdWxkIGJlIHJlbW92ZWQgQVNBUCB3aGVuIHRoZVxuICAgICAgICAgICAgLy8gc2VsZWN0aW9uIGNoYW5nZXNcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGYWtlQ2FyZXRNb2RlbEVsZW1lbnQgPSBzZWxlY3RlZE1vZGVsRWxlbWVudDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKGVkaXRvci51aS5mb2N1c1RyYWNrZXIsICdjaGFuZ2U6aXNGb2N1c2VkJywgKGV2dCwgbmFtZSwgaXNGb2N1c2VkKT0+e1xuICAgICAgICAgICAgaWYgKCFpc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVTZWxlY3Rpb25BdHRyaWJ1dGUoVFlQRV9BUk9VTkRfU0VMRUNUSU9OX0FUVFJJQlVURSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBwb3NpdGlvblRvV2lkZ2V0Q3NzQ2xhc3MocG9zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBgY2std2lkZ2V0X3R5cGUtYXJvdW5kX3Nob3ctZmFrZS1jYXJldF8ke3Bvc2l0aW9ufWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgbGlzdGVuZXIgZXhlY3V0ZWQgb24gZWFjaCBcImtleWRvd25cIiBpbiB0aGUgdmlldyBkb2N1bWVudCwgYSBwYXJ0IG9mXG5cdCAqIHtAbGluayAjX2VuYWJsZVR5cGVBcm91bmRGYWtlQ2FyZXRBY3RpdmF0aW9uVXNpbmdLZXlib2FyZEFycm93c30uXG5cdCAqXG5cdCAqIEl0IGRlY2lkZXMgd2hldGhlciB0aGUgYXJyb3cga2V5cHJlc3Mgc2hvdWxkIGFjdGl2YXRlIHRoZSBmYWtlIGNhcmV0IG9yIG5vdCAoYWxzbyB3aGV0aGVyIGl0IHNob3VsZFxuXHQgKiBiZSBkZWFjdGl2YXRlZCkuXG5cdCAqXG5cdCAqIFRoZSBmYWtlIGNhcmV0IGFjdGl2YXRpb24gaXMgZG9uZSBieSBzZXR0aW5nIHRoZSBgd2lkZ2V0LXR5cGUtYXJvdW5kYCBtb2RlbCBzZWxlY3Rpb24gYXR0cmlidXRlXG5cdCAqIGluIHRoaXMgbGlzdGVuZXIsIGFuZCBzdG9wcGluZyBhbmQgcHJldmVudGluZyB0aGUgZXZlbnQgdGhhdCB3b3VsZCBub3JtYWxseSBiZSBoYW5kbGVkIGJ5IHRoZSB3aWRnZXRcblx0ICogcGx1Z2luIHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIHRoZSByZWd1bGFyIGtleWJvYXJkIG5hdmlnYXRpb24gbmVhci9hY3Jvc3MgYWxsIHdpZGdldHMgKHRoYXRcblx0ICogaW5jbHVkZXMgaW5saW5lIHdpZGdldHMsIHdoaWNoIGFyZSBpZ25vcmVkIGJ5IHRoZSB3aWRnZXQgdHlwZSBhcm91bmQgcGx1Z2luKS5cblx0ICovIF9oYW5kbGVBcnJvd0tleVByZXNzKGV2dCwgZG9tRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICBjb25zdCBrZXlDb2RlID0gZG9tRXZlbnREYXRhLmtleUNvZGU7XG4gICAgICAgIGNvbnN0IGlzRm9yd2FyZCA9IGlzRm9yd2FyZEFycm93S2V5Q29kZShrZXlDb2RlLCBlZGl0b3IubG9jYWxlLmNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbik7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkVmlld0VsZW1lbnQgPSBlZGl0aW5nVmlldy5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkTW9kZWxFbGVtZW50ID0gZWRpdG9yLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxFbGVtZW50KHNlbGVjdGVkVmlld0VsZW1lbnQpO1xuICAgICAgICBsZXQgc2hvdWxkU3RvcEFuZFByZXZlbnREZWZhdWx0O1xuICAgICAgICAvLyBIYW5kbGUga2V5Ym9hcmQgbmF2aWdhdGlvbiB3aGVuIGEgdHlwZS1hcm91bmQtY29tcGF0aWJsZSB3aWRnZXQgaXMgY3VycmVudGx5IHNlbGVjdGVkLlxuICAgICAgICBpZiAoaXNUeXBlQXJvdW5kV2lkZ2V0KHNlbGVjdGVkVmlld0VsZW1lbnQsIHNlbGVjdGVkTW9kZWxFbGVtZW50LCBzY2hlbWEpKSB7XG4gICAgICAgICAgICBzaG91bGRTdG9wQW5kUHJldmVudERlZmF1bHQgPSB0aGlzLl9oYW5kbGVBcnJvd0tleVByZXNzT25TZWxlY3RlZFdpZGdldChpc0ZvcndhcmQpO1xuICAgICAgICB9IGVsc2UgaWYgKG1vZGVsU2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICBzaG91bGRTdG9wQW5kUHJldmVudERlZmF1bHQgPSB0aGlzLl9oYW5kbGVBcnJvd0tleVByZXNzV2hlblNlbGVjdGlvbk5leHRUb0FXaWRnZXQoaXNGb3J3YXJkKTtcbiAgICAgICAgfSBlbHNlIGlmICghZG9tRXZlbnREYXRhLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICBzaG91bGRTdG9wQW5kUHJldmVudERlZmF1bHQgPSB0aGlzLl9oYW5kbGVBcnJvd0tleVByZXNzV2hlbk5vbkNvbGxhcHNlZFNlbGVjdGlvbihpc0ZvcndhcmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzaG91bGRTdG9wQW5kUHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyB0aGUga2V5Ym9hcmQgbmF2aWdhdGlvbiBvbiBcImtleWRvd25cIiB3aGVuIGEgd2lkZ2V0IGlzIGN1cnJlbnRseSBzZWxlY3RlZCBhbmQgYWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzXG5cdCAqIHRoZSBmYWtlIGNhcmV0IGZvciB0aGF0IHdpZGdldCwgZGVwZW5kaW5nIG9uIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBgd2lkZ2V0LXR5cGUtYXJvdW5kYCBtb2RlbFxuXHQgKiBzZWxlY3Rpb24gYXR0cmlidXRlIGFuZCB0aGUgZGlyZWN0aW9uIG9mIHRoZSBwcmVzc2VkIGFycm93IGtleS5cblx0ICpcblx0ICogQHBhcmFtIGlzRm9yd2FyZCBgdHJ1ZWAgd2hlbiB0aGUgcHJlc3NlZCBhcnJvdyBrZXkgd2FzIHJlc3BvbnNpYmxlIGZvciB0aGUgZm9yd2FyZCBtb2RlbCBzZWxlY3Rpb24gbW92ZW1lbnRcblx0ICogYXMgaW4ge0BsaW5rIG1vZHVsZTp1dGlscy9rZXlib2FyZH5pc0ZvcndhcmRBcnJvd0tleUNvZGV9LlxuXHQgKiBAcmV0dXJucyBSZXR1cm5zIGB0cnVlYCB3aGVuIHRoZSBrZXlwcmVzcyB3YXMgaGFuZGxlZCBhbmQgbm8gb3RoZXIga2V5ZG93biBsaXN0ZW5lciBvZiB0aGUgZWRpdG9yIHNob3VsZFxuXHQgKiBwcm9jZXNzIHRoZSBldmVudCBhbnkgZnVydGhlci4gUmV0dXJucyBgZmFsc2VgIG90aGVyd2lzZS5cblx0ICovIF9oYW5kbGVBcnJvd0tleVByZXNzT25TZWxlY3RlZFdpZGdldChpc0ZvcndhcmQpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBtb2RlbFNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uID0gZ2V0VHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKG1vZGVsU2VsZWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgLy8gSWYgdGhlIGZha2UgY2FyZXQgaXMgZGlzcGxheWVkLi4uXG4gICAgICAgICAgICBpZiAodHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNMZWF2aW5nV2lkZ2V0ID0gdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uID09PSAoaXNGb3J3YXJkID8gJ2FmdGVyJyA6ICdiZWZvcmUnKTtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUga2V5Ym9hcmQgYXJyb3cgd29ya3MgYWdhaW5zdCB0aGUgdmFsdWUgb2YgdGhlIHNlbGVjdGlvbiBhdHRyaWJ1dGUuLi5cbiAgICAgICAgICAgICAgICAvLyB0aGVuIHJlbW92ZSB0aGUgc2VsZWN0aW9uIGF0dHJpYnV0ZSBidXQgcHJldmVudCBkZWZhdWx0IERPTSBhY3Rpb25zXG4gICAgICAgICAgICAgICAgLy8gYW5kIGRvIG5vdCBsZXQgdGhlIFdpZGdldCBwbHVnaW4gbGlzdGVuZXIgbW92ZSB0aGUgc2VsZWN0aW9uLiBUaGlzIGJyaW5nc1xuICAgICAgICAgICAgICAgIC8vIHRoZSB3aWRnZXQgYmFjayB0byB0aGUgc3RhdGUsIGZvciBpbnN0YW5jZSwgbGlrZSBpZiB3YXMgc2VsZWN0ZWQgdXNpbmcgdGhlIG1vdXNlLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gKipOb3RlKio6IElmIGxlYXZpbmcgdGhlIHdpZGdldCB3aGVuIHRoZSBmYWtlIGNhcmV0IGlzIGFjdGl2ZSwgdGhlbiB0aGUgZGVmYXVsdFxuICAgICAgICAgICAgICAgIC8vIFdpZGdldCBoYW5kbGVyIHdpbGwgY2hhbmdlIHRoZSBzZWxlY3Rpb24gYW5kLCBpbiB0dXJuLCB0aGlzIHdpbGwgYXV0b21hdGljYWxseSBkaXNjYXJkXG4gICAgICAgICAgICAgICAgLy8gdGhlIHNlbGVjdGlvbiBhdHRyaWJ1dGUuXG4gICAgICAgICAgICAgICAgaWYgKCFpc0xlYXZpbmdXaWRnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZShUWVBFX0FST1VORF9TRUxFQ1RJT05fQVRUUklCVVRFKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uQXR0cmlidXRlKFRZUEVfQVJPVU5EX1NFTEVDVElPTl9BVFRSSUJVVEUsIGlzRm9yd2FyZCA/ICdhZnRlcicgOiAnYmVmb3JlJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyB0aGUga2V5Ym9hcmQgbmF2aWdhdGlvbiBvbiBcImtleWRvd25cIiB3aGVuICoqbm8qKiB3aWRnZXQgaXMgc2VsZWN0ZWQgYnV0IHRoZSBzZWxlY3Rpb24gaXMgKipkaXJlY3RseSoqIG5leHRcblx0ICogdG8gb25lIGFuZCB1cG9uIHRoZSBmYWtlIGNhcmV0IHNob3VsZCBiZWNvbWUgYWN0aXZlIGZvciB0aGlzIHdpZGdldCB1cG9uIGFycm93IGtleXByZXNzXG5cdCAqIChBS0EgZW50ZXJpbmcvc2VsZWN0aW5nIHRoZSB3aWRnZXQpLlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogVGhpcyBjb2RlIG1pcnJvcnMgdGhlIGltcGxlbWVudGF0aW9uIGZyb20gdGhlIHdpZGdldCBwbHVnaW4gYnV0IGFsc28gYWRkcyB0aGUgc2VsZWN0aW9uIGF0dHJpYnV0ZS5cblx0ICogVW5mb3J0dW5hdGVseSwgdGhlcmUgaXMgbm8gc2FmZSB3YXkgdG8gbGV0IHRoZSB3aWRnZXQgcGx1Z2luIGRvIHRoZSBzZWxlY3Rpb24gcGFydCBmaXJzdCBhbmQgdGhlbiBqdXN0IHNldCB0aGVcblx0ICogc2VsZWN0aW9uIGF0dHJpYnV0ZSBoZXJlIGluIHRoZSB3aWRnZXQgdHlwZSBhcm91bmQgcGx1Z2luLiBUaGlzIGlzIHdoeSB0aGlzIGNvZGUgbXVzdCBkdXBsaWNhdGUgc29tZSBmcm9tIHRoZSB3aWRnZXQgcGx1Z2luLlxuXHQgKlxuXHQgKiBAcGFyYW0gaXNGb3J3YXJkIGB0cnVlYCB3aGVuIHRoZSBwcmVzc2VkIGFycm93IGtleSB3YXMgcmVzcG9uc2libGUgZm9yIHRoZSBmb3J3YXJkIG1vZGVsIHNlbGVjdGlvbiBtb3ZlbWVudFxuXHQgKiBhcyBpbiB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleWJvYXJkfmlzRm9yd2FyZEFycm93S2V5Q29kZX0uXG5cdCAqIEByZXR1cm5zIFJldHVybnMgYHRydWVgIHdoZW4gdGhlIGtleXByZXNzIHdhcyBoYW5kbGVkIGFuZCBubyBvdGhlciBrZXlkb3duIGxpc3RlbmVyIG9mIHRoZSBlZGl0b3Igc2hvdWxkXG5cdCAqIHByb2Nlc3MgdGhlIGV2ZW50IGFueSBmdXJ0aGVyLiBSZXR1cm5zIGBmYWxzZWAgb3RoZXJ3aXNlLlxuXHQgKi8gX2hhbmRsZUFycm93S2V5UHJlc3NXaGVuU2VsZWN0aW9uTmV4dFRvQVdpZGdldChpc0ZvcndhcmQpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSBtb2RlbC5zY2hlbWE7XG4gICAgICAgIGNvbnN0IHdpZGdldFBsdWdpbiA9IGVkaXRvci5wbHVnaW5zLmdldCgnV2lkZ2V0Jyk7XG4gICAgICAgIC8vIFRoaXMgaXMgdGhlIHdpZGdldCB0aGUgc2VsZWN0aW9uIGlzIGFib3V0IHRvIGJlIHNldCBvbi5cbiAgICAgICAgY29uc3QgbW9kZWxFbGVtZW50TmV4dFRvU2VsZWN0aW9uID0gd2lkZ2V0UGx1Z2luLl9nZXRPYmplY3RFbGVtZW50TmV4dFRvU2VsZWN0aW9uKGlzRm9yd2FyZCk7XG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50TmV4dFRvU2VsZWN0aW9uID0gZWRpdG9yLmVkaXRpbmcubWFwcGVyLnRvVmlld0VsZW1lbnQobW9kZWxFbGVtZW50TmV4dFRvU2VsZWN0aW9uKTtcbiAgICAgICAgaWYgKGlzVHlwZUFyb3VuZFdpZGdldCh2aWV3RWxlbWVudE5leHRUb1NlbGVjdGlvbiwgbW9kZWxFbGVtZW50TmV4dFRvU2VsZWN0aW9uLCBzY2hlbWEpKSB7XG4gICAgICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICB3aWRnZXRQbHVnaW4uX3NldFNlbGVjdGlvbk92ZXJFbGVtZW50KG1vZGVsRWxlbWVudE5leHRUb1NlbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbkF0dHJpYnV0ZShUWVBFX0FST1VORF9TRUxFQ1RJT05fQVRUUklCVVRFLCBpc0ZvcndhcmQgPyAnYmVmb3JlJyA6ICdhZnRlcicpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBUaGUgY2hhbmdlKCkgYmxvY2sgYWJvdmUgZG9lcyB0aGUgc2FtZSBqb2IgYXMgdGhlIFdpZGdldCBwbHVnaW4uIFRoZSBldmVudCBjYW5cbiAgICAgICAgICAgIC8vIGJlIHNhZmVseSBjYW5jZWxlZC5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhhbmRsZXMgdGhlIGtleWJvYXJkIG5hdmlnYXRpb24gb24gXCJrZXlkb3duXCIgd2hlbiBhIHdpZGdldCBpcyBjdXJyZW50bHkgc2VsZWN0ZWQgKHRvZ2V0aGVyIHdpdGggc29tZSBvdGhlciBjb250ZW50KVxuXHQgKiBhbmQgdGhlIHdpZGdldCBpcyB0aGUgZmlyc3Qgb3IgbGFzdCBlbGVtZW50IGluIHRoZSBzZWxlY3Rpb24uIEl0IGFjdGl2YXRlcyBvciBkZWFjdGl2YXRlcyB0aGUgZmFrZSBjYXJldCBmb3IgdGhhdCB3aWRnZXQuXG5cdCAqXG5cdCAqIEBwYXJhbSBpc0ZvcndhcmQgYHRydWVgIHdoZW4gdGhlIHByZXNzZWQgYXJyb3cga2V5IHdhcyByZXNwb25zaWJsZSBmb3IgdGhlIGZvcndhcmQgbW9kZWwgc2VsZWN0aW9uIG1vdmVtZW50XG5cdCAqIGFzIGluIHtAbGluayBtb2R1bGU6dXRpbHMva2V5Ym9hcmR+aXNGb3J3YXJkQXJyb3dLZXlDb2RlfS5cblx0ICogQHJldHVybnMgUmV0dXJucyBgdHJ1ZWAgd2hlbiB0aGUga2V5cHJlc3Mgd2FzIGhhbmRsZWQgYW5kIG5vIG90aGVyIGtleWRvd24gbGlzdGVuZXIgb2YgdGhlIGVkaXRvciBzaG91bGRcblx0ICogcHJvY2VzcyB0aGUgZXZlbnQgYW55IGZ1cnRoZXIuIFJldHVybnMgYGZhbHNlYCBvdGhlcndpc2UuXG5cdCAqLyBfaGFuZGxlQXJyb3dLZXlQcmVzc1doZW5Ob25Db2xsYXBzZWRTZWxlY3Rpb24oaXNGb3J3YXJkKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCBtYXBwZXIgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXI7XG4gICAgICAgIGNvbnN0IG1vZGVsU2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBzZWxlY3RlZE1vZGVsTm9kZSA9IGlzRm9yd2FyZCA/IG1vZGVsU2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpLm5vZGVCZWZvcmUgOiBtb2RlbFNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkubm9kZUFmdGVyO1xuICAgICAgICBjb25zdCBzZWxlY3RlZFZpZXdOb2RlID0gbWFwcGVyLnRvVmlld0VsZW1lbnQoc2VsZWN0ZWRNb2RlbE5vZGUpO1xuICAgICAgICAvLyBUaGVyZSBpcyBhIHdpZGdldCBhdCB0aGUgY29sbGFwc2UgcG9zaXRpb24gc28gY29sbGFwc2UgdGhlIHNlbGVjdGlvbiB0byB0aGUgZmFrZSBjYXJldCBvbiBpdC5cbiAgICAgICAgaWYgKGlzVHlwZUFyb3VuZFdpZGdldChzZWxlY3RlZFZpZXdOb2RlLCBzZWxlY3RlZE1vZGVsTm9kZSwgc2NoZW1hKSkge1xuICAgICAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihzZWxlY3RlZE1vZGVsTm9kZSwgJ29uJyk7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbkF0dHJpYnV0ZShUWVBFX0FST1VORF9TRUxFQ1RJT05fQVRUUklCVVRFLCBpc0ZvcndhcmQgPyAnYWZ0ZXInIDogJ2JlZm9yZScpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgYSBgbW91c2Vkb3duYCBsaXN0ZW5lciBmb3IgdGhlIHZpZXcgZG9jdW1lbnQgd2hpY2ggaW50ZXJjZXB0cyBldmVudHNcblx0ICogY29taW5nIGZyb20gdGhlIHdpZGdldCB0eXBlIGFyb3VuZCBVSSwgd2hpY2ggaGFwcGVucyB3aGVuIGEgdXNlciBjbGlja3Mgb25lIG9mIHRoZSBidXR0b25zXG5cdCAqIHRoYXQgaW5zZXJ0IGEgcGFyYWdyYXBoIG5leHQgdG8gYSB3aWRnZXQuXG5cdCAqLyBfZW5hYmxlSW5zZXJ0aW5nUGFyYWdyYXBoc09uQnV0dG9uQ2xpY2soKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBlZGl0aW5nVmlldyA9IGVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKGVkaXRpbmdWaWV3LmRvY3VtZW50LCAnbW91c2Vkb3duJywgKGV2dCwgZG9tRXZlbnREYXRhKT0+e1xuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZ2V0Q2xvc2VzdFR5cGVBcm91bmREb21CdXR0b24oZG9tRXZlbnREYXRhLmRvbVRhcmdldCk7XG4gICAgICAgICAgICBpZiAoIWJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvblBvc2l0aW9uID0gZ2V0VHlwZUFyb3VuZEJ1dHRvblBvc2l0aW9uKGJ1dHRvbik7XG4gICAgICAgICAgICBjb25zdCB3aWRnZXRWaWV3RWxlbWVudCA9IGdldENsb3Nlc3RXaWRnZXRWaWV3RWxlbWVudChidXR0b24sIGVkaXRpbmdWaWV3LmRvbUNvbnZlcnRlcik7XG4gICAgICAgICAgICBjb25zdCB3aWRnZXRNb2RlbEVsZW1lbnQgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXIudG9Nb2RlbEVsZW1lbnQod2lkZ2V0Vmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5faW5zZXJ0UGFyYWdyYXBoKHdpZGdldE1vZGVsRWxlbWVudCwgYnV0dG9uUG9zaXRpb24pO1xuICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgdGhlIDxrYmQ+RW50ZXI8L2tiZD4ga2V5IGxpc3RlbmVyIG9uIHRoZSB2aWV3IGRvY3VtZW50IHRoYXQgYWxsb3dzIHRoZSB1c2VyIHRvIGluc2VydCBhIHBhcmFncmFwaFxuXHQgKiBuZWFyIHRoZSB3aWRnZXQgd2hlbiBlaXRoZXI6XG5cdCAqXG5cdCAqICogVGhlIGZha2UgY2FyZXQgd2FzIGZpcnN0IGFjdGl2YXRlZCB1c2luZyB0aGUgYXJyb3cga2V5cyxcblx0ICogKiBUaGUgZW50aXJlIHdpZGdldCBpcyBzZWxlY3RlZCBpbiB0aGUgbW9kZWwuXG5cdCAqXG5cdCAqIEluIHRoZSBmaXJzdCBjYXNlLCB0aGUgbmV3IHBhcmFncmFwaCBpcyBpbnNlcnRlZCBhY2NvcmRpbmcgdG8gdGhlIGB3aWRnZXQtdHlwZS1hcm91bmRgIHNlbGVjdGlvblxuXHQgKiBhdHRyaWJ1dGUgKHNlZSB7QGxpbmsgI19oYW5kbGVBcnJvd0tleVByZXNzfSkuXG5cdCAqXG5cdCAqIEluIHRoZSBzZWNvbmQgY2FzZSwgdGhlIG5ldyBwYXJhZ3JhcGggaXMgaW5zZXJ0ZWQgYmFzZWQgb24gd2hldGhlciBhIHNvZnQgKDxrYmQ+U2hpZnQ8L2tiZD4rPGtiZD5FbnRlcjwva2JkPikga2V5c3Ryb2tlXG5cdCAqIHdhcyBwcmVzc2VkIG9yIG5vdC5cblx0ICovIF9lbmFibGVJbnNlcnRpbmdQYXJhZ3JhcGhzT25FbnRlcktleXByZXNzKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZWRpdG9yLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICB0aGlzLl9saXN0ZW5Ub0lmRW5hYmxlZChlZGl0aW5nVmlldy5kb2N1bWVudCwgJ2VudGVyJywgKGV2dCwgZG9tRXZlbnREYXRhKT0+e1xuICAgICAgICAgICAgLy8gVGhpcyBldmVudCBjb3VsZCBiZSB0cmlnZ2VyZWQgZnJvbSBpbnNpZGUgdGhlIHdpZGdldCBidXQgd2UgYXJlIGludGVyZXN0ZWRcbiAgICAgICAgICAgIC8vIG9ubHkgd2hlbiB0aGUgd2lkZ2V0IGlzIHNlbGVjdGVkIGl0c2VsZi5cbiAgICAgICAgICAgIGlmIChldnQuZXZlbnRQaGFzZSAhPSAnYXRUYXJnZXQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRNb2RlbEVsZW1lbnQgPSBzZWxlY3Rpb24uZ2V0U2VsZWN0ZWRFbGVtZW50KCk7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZFZpZXdFbGVtZW50ID0gZWRpdG9yLmVkaXRpbmcubWFwcGVyLnRvVmlld0VsZW1lbnQoc2VsZWN0ZWRNb2RlbEVsZW1lbnQpO1xuICAgICAgICAgICAgY29uc3Qgc2NoZW1hID0gZWRpdG9yLm1vZGVsLnNjaGVtYTtcbiAgICAgICAgICAgIGxldCB3YXNIYW5kbGVkO1xuICAgICAgICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIHdpZGdldCBpcyBzZWxlY3RlZCBhbmQgdGhlcmUncyBhIHR5cGUgYXJvdW5kIHNlbGVjdGlvbiBhdHRyaWJ1dGUgYXNzb2NpYXRlZFxuICAgICAgICAgICAgLy8gd2l0aCB0aGUgZmFrZSBjYXJldCB0aGF0IHdvdWxkIHRlbGwgd2hlcmUgdG8gaW5zZXJ0IGEgbmV3IHBhcmFncmFwaC5cbiAgICAgICAgICAgIGlmICh0aGlzLl9pbnNlcnRQYXJhZ3JhcGhBY2NvcmRpbmdUb0Zha2VDYXJldFBvc2l0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICB3YXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNUeXBlQXJvdW5kV2lkZ2V0KHNlbGVjdGVkVmlld0VsZW1lbnQsIHNlbGVjdGVkTW9kZWxFbGVtZW50LCBzY2hlbWEpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5zZXJ0UGFyYWdyYXBoKHNlbGVjdGVkTW9kZWxFbGVtZW50LCBkb21FdmVudERhdGEuaXNTb2Z0ID8gJ2JlZm9yZScgOiAnYWZ0ZXInKTtcbiAgICAgICAgICAgICAgICB3YXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3YXNIYW5kbGVkKSB7XG4gICAgICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogaXNXaWRnZXRcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTaW1pbGFyIHRvIHRoZSB7QGxpbmsgI19lbmFibGVJbnNlcnRpbmdQYXJhZ3JhcGhzT25FbnRlcktleXByZXNzfSwgaXQgYWxsb3dzIHRoZSB1c2VyXG5cdCAqIHRvIGluc2VydCBhIHBhcmFncmFwaCBuZXh0IHRvIGEgd2lkZ2V0IHdoZW4gdGhlIGZha2UgY2FyZXQgd2FzIGFjdGl2YXRlZCB1c2luZyBhcnJvd1xuXHQgKiBrZXlzIGJ1dCBpdCByZXNwb25kcyB0byB0eXBpbmcgaW5zdGVhZCBvZiA8a2JkPkVudGVyPC9rYmQ+LlxuXHQgKlxuXHQgKiBMaXN0ZW5lciBlbmFibGVkIGJ5IHRoaXMgbWV0aG9kIHdpbGwgaW5zZXJ0IGEgbmV3IHBhcmFncmFwaCBhY2NvcmRpbmcgdG8gdGhlIGB3aWRnZXQtdHlwZS1hcm91bmRgXG5cdCAqIG1vZGVsIHNlbGVjdGlvbiBhdHRyaWJ1dGUgYXMgdGhlIHVzZXIgc2ltcGx5IHN0YXJ0cyB0eXBpbmcsIHdoaWNoIGNyZWF0ZXMgdGhlIGltcHJlc3Npb24gdGhhdCB0aGUgZmFrZSBjYXJldFxuXHQgKiBiZWhhdmVzIGxpa2UgYSByZWFsIG9uZSByZW5kZXJlZCBieSB0aGUgYnJvd3NlciAoQUtBIHlvdXIgdGV4dCBhcHBlYXJzIHdoZXJlIHRoZSBjYXJldCB3YXMpLlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogQXQgdGhlIG1vbWVudCB0aGlzIGxpc3RlbmVyIGNyZWF0ZXMgMiB1bmRvIHN0ZXBzOiBvbmUgZm9yIHRoZSBgaW5zZXJ0UGFyYWdyYXBoYCBjb21tYW5kXG5cdCAqIGFuZCBhbm90aGVyIG9uZSBmb3IgYWN0dWFsIHR5cGluZy4gSXQgaXMgbm90IGEgZGlzYXN0ZXIgYnV0IHRoaXMgbWF5IG5lZWQgdG8gYmUgZml4ZWRcblx0ICogc29vbmVyIG9yIGxhdGVyLlxuXHQgKi8gX2VuYWJsZUluc2VydGluZ1BhcmFncmFwaHNPblR5cGluZ0tleXN0cm9rZSgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IHZpZXdEb2N1bWVudCA9IGVkaXRvci5lZGl0aW5nLnZpZXcuZG9jdW1lbnQ7XG4gICAgICAgIC8vIE5vdGU6IFRoZSBwcmlvcml0eSBtdXN0IHByZWNlZGUgdGhlIGRlZmF1bHQgSW5wdXQgcGx1Z2luIGluc2VydFRleHQgaGFuZGxlci5cbiAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQodmlld0RvY3VtZW50LCAnaW5zZXJ0VGV4dCcsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAodGhpcy5faW5zZXJ0UGFyYWdyYXBoQWNjb3JkaW5nVG9GYWtlQ2FyZXRQb3NpdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIHZpZXcgc2VsZWN0aW9uIGluIHRoZSBldmVudCBkYXRhIGNvbnRhaW5zIHRoZSB3aWRnZXQuIElmIHRoZSBuZXcgcGFyYWdyYXBoXG4gICAgICAgICAgICAgICAgLy8gd2FzIGluc2VydGVkLCBtb2RpZnkgdGhlIHZpZXcgc2VsZWN0aW9uIHBhc3NlZCBhbG9uZyB3aXRoIHRoZSBpbnNlcnRUZXh0IGV2ZW50XG4gICAgICAgICAgICAgICAgLy8gc28gdGhlIGRlZmF1bHQgZXZlbnQgaGFuZGxlciBpbiB0aGUgSW5wdXQgcGx1Z2luIHN0YXJ0cyB0eXBpbmcgaW5zaWRlIHRoZSBwYXJhZ3JhcGguXG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aGUgdHlwaW5nIHdvdWxkIGJlIG92ZXIgdGhlIHdpZGdldC5cbiAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdGlvbiA9IHZpZXdEb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlbnYuaXNBbmRyb2lkKSB7XG4gICAgICAgICAgICAvLyBPbiBBbmRyb2lkIHdpdGggRW5nbGlzaCBrZXlib2FyZCwgdGhlIGNvbXBvc2l0aW9uIHN0YXJ0cyBqdXN0IGJ5IHB1dHRpbmcgY2FyZXRcbiAgICAgICAgICAgIC8vIGF0IHRoZSB3b3JkIGVuZCBvciBieSBzZWxlY3RpbmcgYSB0YWJsZSBjb2x1bW4uIFRoaXMgaXMgbm90IGEgcmVhbCBjb21wb3NpdGlvbiBzdGFydGVkLlxuICAgICAgICAgICAgLy8gVHJpZ2dlciBkZWxldGUgY29udGVudCBvbiBmaXJzdCBjb21wb3NpdGlvbiBrZXkgcHJlc3NlZC5cbiAgICAgICAgICAgIHRoaXMuX2xpc3RlblRvSWZFbmFibGVkKHZpZXdEb2N1bWVudCwgJ2tleWRvd24nLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmtleUNvZGUgPT0gMjI5KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc2VydFBhcmFncmFwaEFjY29yZGluZ1RvRmFrZUNhcmV0UG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBwcmlvcml0eSBtdXN0IHByZWNlZGUgdGhlIGRlZmF1bHQgSW5wdXQgcGx1Z2luIGNvbXBvc2l0aW9uc3RhcnQgaGFuZGxlciAodG8gY2FsbCBpdCBiZWZvcmUgZGVsZXRlIGNvbnRlbnQpLlxuICAgICAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQodmlld0RvY3VtZW50LCAnY29tcG9zaXRpb25zdGFydCcsICgpPT57XG4gICAgICAgICAgICAgICAgdGhpcy5faW5zZXJ0UGFyYWdyYXBoQWNjb3JkaW5nVG9GYWtlQ2FyZXRQb3NpdGlvbigpO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdCBjcmVhdGVzIGEgXCJkZWxldGVcIiBldmVudCBsaXN0ZW5lciBvbiB0aGUgdmlldyBkb2N1bWVudCB0byBoYW5kbGUgY2FzZXMgd2hlbiB0aGUgPGtiZD5EZWxldGU8L2tiZD4gb3IgPGtiZD5CYWNrc3BhY2U8L2tiZD5cblx0ICogaXMgcHJlc3NlZCBhbmQgdGhlIGZha2UgY2FyZXQgaXMgY3VycmVudGx5IGFjdGl2ZS5cblx0ICpcblx0ICogVGhlIGZha2UgY2FyZXQgc2hvdWxkIGNyZWF0ZSBhbiBpbGx1c2lvbiBvZiBhIHJlYWwgYnJvd3NlciBjYXJldCBzbyB0aGF0IHdoZW4gaXQgYXBwZWFycyBiZWZvcmUgb3IgYWZ0ZXJcblx0ICogYSB3aWRnZXQsIHByZXNzaW5nIDxrYmQ+RGVsZXRlPC9rYmQ+IG9yIDxrYmQ+QmFja3NwYWNlPC9rYmQ+IHNob3VsZCByZW1vdmUgYSB3aWRnZXQgb3IgZGVsZXRlIHRoZSBjb250ZW50XG5cdCAqIGJlZm9yZSBvciBhZnRlciBhIHdpZGdldCAoZGVwZW5kaW5nIG9uIHRoZSBjb250ZW50IHN1cnJvdW5kaW5nIHRoZSB3aWRnZXQpLlxuXHQgKi8gX2VuYWJsZURlbGV0ZUludGVncmF0aW9uKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICB0aGlzLl9saXN0ZW5Ub0lmRW5hYmxlZChlZGl0aW5nVmlldy5kb2N1bWVudCwgJ2RlbGV0ZScsIChldnQsIGRvbUV2ZW50RGF0YSk9PntcbiAgICAgICAgICAgIC8vIFRoaXMgZXZlbnQgY291bGQgYmUgdHJpZ2dlcmVkIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQgYnV0IHdlIGFyZSBpbnRlcmVzdGVkXG4gICAgICAgICAgICAvLyBvbmx5IHdoZW4gdGhlIHdpZGdldCBpcyBzZWxlY3RlZCBpdHNlbGYuXG4gICAgICAgICAgICBpZiAoZXZ0LmV2ZW50UGhhc2UgIT0gJ2F0VGFyZ2V0Jykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbiA9IGdldFR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbihtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24pO1xuICAgICAgICAgICAgLy8gVGhpcyBsaXN0ZW5lciBoYW5kbGVzIG9ubHkgdGhlc2UgY2FzZXMgd2hlbiB0aGUgZmFrZSBjYXJldCBpcyBhY3RpdmUuXG4gICAgICAgICAgICBpZiAoIXR5cGVBcm91bmRGYWtlQ2FyZXRQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGRvbUV2ZW50RGF0YS5kaXJlY3Rpb247XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZE1vZGVsV2lkZ2V0ID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICAgICAgY29uc3QgaXNGYWtlQ2FyZXRCZWZvcmUgPSB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24gPT09ICdiZWZvcmUnO1xuICAgICAgICAgICAgY29uc3QgaXNEZWxldGVGb3J3YXJkID0gZGlyZWN0aW9uID09ICdmb3J3YXJkJztcbiAgICAgICAgICAgIGNvbnN0IHNob3VsZERlbGV0ZUVudGlyZVdpZGdldCA9IGlzRmFrZUNhcmV0QmVmb3JlID09PSBpc0RlbGV0ZUZvcndhcmQ7XG4gICAgICAgICAgICBpZiAoc2hvdWxkRGVsZXRlRW50aXJlV2lkZ2V0KSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ2RlbGV0ZScsIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBtb2RlbC5jcmVhdGVTZWxlY3Rpb24oc2VsZWN0ZWRNb2RlbFdpZGdldCwgJ29uJylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBzY2hlbWEuZ2V0TmVhcmVzdFNlbGVjdGlvblJhbmdlKG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQoc2VsZWN0ZWRNb2RlbFdpZGdldCwgdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKSwgZGlyZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBzb21ld2hlcmUgdG8gbW92ZSBzZWxlY3Rpb24gdG8sIHRoZW4gdGhlcmUgd2lsbCBiZSBzb21ldGhpbmcgdG8gZGVsZXRlLlxuICAgICAgICAgICAgICAgIGlmIChyYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmFuZ2UgaXMgTk9UIGNvbGxhcHNlZCwgdGhlbiB3ZSBrbm93IHRoYXQgdGhlIHJhbmdlIGNvbnRhaW5zIGFuIG9iamVjdCAoc2VlIGdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZSgpIGRvY3MpLlxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJhbmdlLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKHJhbmdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuZXhlY3V0ZShpc0RlbGV0ZUZvcndhcmQgPyAnZGVsZXRlRm9yd2FyZCcgOiAnZGVsZXRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2JlID0gbW9kZWwuY3JlYXRlU2VsZWN0aW9uKHJhbmdlLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLm1vZGlmeVNlbGVjdGlvbihwcm9iZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmFuZ2UgaXMgY29sbGFwc2VkLCBsZXQncyBzZWUgaWYgYSBub24tY29sbGFwc2VkIHJhbmdlIGV4aXN0cyB0aGF0IGNhbiBjb3VsZCBiZSBkZWxldGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgc3VjaCByYW5nZSBleGlzdHMsIHVzZSB0aGUgZWRpdG9yIGNvbW1hbmQgYmVjYXVzZSBpdCBpdCBzYWZlIGZvciBjb2xsYWJvcmF0aW9uIChpdCBtZXJnZXMgd2hlcmUgaXQgY2FuKS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvYmUuZm9jdXMuaXNFcXVhbChyYW5nZS5zdGFydCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihyYW5nZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKGlzRGVsZXRlRm9yd2FyZCA/ICdkZWxldGVGb3J3YXJkJyA6ICdkZWxldGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVlcGVzdEVtcHR5UmFuZ2VBbmNlc3RvciA9IGdldERlZXBlc3RFbXB0eUVsZW1lbnRBbmNlc3RvcihzY2hlbWEsIHJhbmdlLnN0YXJ0LnBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuZGVsZXRlQ29udGVudChtb2RlbC5jcmVhdGVTZWxlY3Rpb24oZGVlcGVzdEVtcHR5UmFuZ2VBbmNlc3RvciwgJ29uJyksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9Ob3RBdXRvcGFyYWdyYXBoOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiBzb21lIGNvbnRlbnQgd2FzIGRlbGV0ZWQsIGRvbid0IGxldCB0aGUgaGFuZGxlciBmcm9tIHRoZSBXaWRnZXQgcGx1Z2luIGtpY2sgaW4uXG4gICAgICAgICAgICAvLyBJZiBub3RoaW5nIHdhcyBkZWxldGVkLCB0aGVuIHRoZSBkZWZhdWx0IGhhbmRsZXIgd2lsbCBoYXZlIG5vdGhpbmcgdG8gZG8gYW55d2F5LlxuICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBjb250ZXh0OiBpc1dpZGdldFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEF0dGFjaGVzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNldmVudDppbnNlcnRDb250ZW50fSBldmVudCBsaXN0ZW5lciB0aGF0LCBmb3IgaW5zdGFuY2UsIGFsbG93cyB0aGUgdXNlciB0byBwYXN0ZVxuXHQgKiBjb250ZW50IG5lYXIgYSB3aWRnZXQgd2hlbiB0aGUgZmFrZSBjYXJldCBpcyBmaXJzdCBhY3RpdmF0ZWQgdXNpbmcgdGhlIGFycm93IGtleXMuXG5cdCAqXG5cdCAqIFRoZSBjb250ZW50IGlzIGluc2VydGVkIGFjY29yZGluZyB0byB0aGUgYHdpZGdldC10eXBlLWFyb3VuZGAgc2VsZWN0aW9uIGF0dHJpYnV0ZSAoc2VlIHtAbGluayAjX2hhbmRsZUFycm93S2V5UHJlc3N9KS5cblx0ICovIF9lbmFibGVJbnNlcnRDb250ZW50SW50ZWdyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudFNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQoZWRpdG9yLm1vZGVsLCAnaW5zZXJ0Q29udGVudCcsIChldnQsIFtjb250ZW50LCBzZWxlY3RhYmxlXSk9PntcbiAgICAgICAgICAgIGlmIChzZWxlY3RhYmxlICYmICFzZWxlY3RhYmxlLmlzKCdkb2N1bWVudFNlbGVjdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uID0gZ2V0VHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKGRvY3VtZW50U2VsZWN0aW9uKTtcbiAgICAgICAgICAgIGlmICghdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIHJldHVybiBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSBkb2N1bWVudFNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQoc2VsZWN0ZWRFbGVtZW50LCB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdyaXRlci5jcmVhdGVTZWxlY3Rpb24ocG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG1vZGVsLmluc2VydENvbnRlbnQoY29udGVudCwgc2VsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKHNlbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQXR0YWNoZXMgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2V2ZW50Omluc2VydE9iamVjdH0gZXZlbnQgbGlzdGVuZXIgdGhhdCBtb2RpZmllcyB0aGVcblx0ICogYG9wdGlvbnMuZmluZE9wdGltYWxQb3NpdGlvbmBwYXJhbWV0ZXIgdG8gcG9zaXRpb24gb2YgZmFrZSBjYXJldCBpbiByZWxhdGlvbiB0byBzZWxlY3RlZCBlbGVtZW50XG5cdCAqIHRvIHJlZmxlY3QgdXNlcidzIGludGVudCBvZiBkZXNpcmVkIGluc2VydGlvbiBwb3NpdGlvbi5cblx0ICpcblx0ICogVGhlIG9iamVjdCBpcyBpbnNlcnRlZCBhY2NvcmRpbmcgdG8gdGhlIGB3aWRnZXQtdHlwZS1hcm91bmRgIHNlbGVjdGlvbiBhdHRyaWJ1dGUgKHNlZSB7QGxpbmsgI19oYW5kbGVBcnJvd0tleVByZXNzfSkuXG5cdCAqLyBfZW5hYmxlSW5zZXJ0T2JqZWN0SW50ZWdyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudFNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQoZWRpdG9yLm1vZGVsLCAnaW5zZXJ0T2JqZWN0JywgKGV2dCwgYXJncyk9PntcbiAgICAgICAgICAgIGNvbnN0IFssIHNlbGVjdGFibGUsIG9wdGlvbnMgPSB7fV0gPSBhcmdzO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGFibGUgJiYgIXNlbGVjdGFibGUuaXMoJ2RvY3VtZW50U2VsZWN0aW9uJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24gPSBnZXRUeXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24oZG9jdW1lbnRTZWxlY3Rpb24pO1xuICAgICAgICAgICAgaWYgKCF0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcHRpb25zLmZpbmRPcHRpbWFsUG9zaXRpb24gPSB0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb247XG4gICAgICAgICAgICBhcmdzWzNdID0gb3B0aW9ucztcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEF0dGFjaGVzIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNldmVudDpkZWxldGVDb250ZW50fSBldmVudCBsaXN0ZW5lciB0byBibG9jayB0aGUgZXZlbnQgd2hlbiB0aGUgZmFrZVxuXHQgKiBjYXJldCBpcyBhY3RpdmUuXG5cdCAqXG5cdCAqIFRoaXMgaXMgcmVxdWlyZWQgZm9yIGNhc2VzIHRoYXQgdHJpZ2dlciB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNkZWxldGVDb250ZW50IGBtb2RlbC5kZWxldGVDb250ZW50KClgfVxuXHQgKiBiZWZvcmUgY2FsbGluZyB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNpbnNlcnRDb250ZW50IGBtb2RlbC5pbnNlcnRDb250ZW50KClgfSBsaWtlLCBmb3IgaW5zdGFuY2UsXG5cdCAqIHBsYWluIHRleHQgcGFzdGluZy5cblx0ICovIF9lbmFibGVEZWxldGVDb250ZW50SW50ZWdyYXRpb24oKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudFNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgdGhpcy5fbGlzdGVuVG9JZkVuYWJsZWQoZWRpdG9yLm1vZGVsLCAnZGVsZXRlQ29udGVudCcsIChldnQsIFtzZWxlY3Rpb25dKT0+e1xuICAgICAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiAhc2VsZWN0aW9uLmlzKCdkb2N1bWVudFNlbGVjdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uID0gZ2V0VHlwZUFyb3VuZEZha2VDYXJldFBvc2l0aW9uKGRvY3VtZW50U2VsZWN0aW9uKTtcbiAgICAgICAgICAgIC8vIERpc2FibGUgcmVtb3ZpbmcgdGhlIHNlbGVjdGlvbiBjb250ZW50IHdoaWxlIHBhc3RpbmcgcGxhaW4gdGV4dC5cbiAgICAgICAgICAgIGlmICh0eXBlQXJvdW5kRmFrZUNhcmV0UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogSW5qZWN0cyB0aGUgdHlwZSBhcm91bmQgVUkgaW50byBhIHZpZXcgd2lkZ2V0IGluc3RhbmNlLlxuICovIGZ1bmN0aW9uIGluamVjdFVJSW50b1dpZGdldCh2aWV3V3JpdGVyLCBidXR0b25UaXRsZXMsIHdpZGdldFZpZXdFbGVtZW50KSB7XG4gICAgY29uc3QgdHlwZUFyb3VuZFdyYXBwZXIgPSB2aWV3V3JpdGVyLmNyZWF0ZVVJRWxlbWVudCgnZGl2Jywge1xuICAgICAgICBjbGFzczogJ2NrIGNrLXJlc2V0X2FsbCBjay13aWRnZXRfX3R5cGUtYXJvdW5kJ1xuICAgIH0sIGZ1bmN0aW9uKGRvbURvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IHdyYXBwZXJEb21FbGVtZW50ID0gdGhpcy50b0RvbUVsZW1lbnQoZG9tRG9jdW1lbnQpO1xuICAgICAgICBpbmplY3RCdXR0b25zKHdyYXBwZXJEb21FbGVtZW50LCBidXR0b25UaXRsZXMpO1xuICAgICAgICBpbmplY3RGYWtlQ2FyZXQod3JhcHBlckRvbUVsZW1lbnQpO1xuICAgICAgICByZXR1cm4gd3JhcHBlckRvbUVsZW1lbnQ7XG4gICAgfSk7XG4gICAgLy8gSW5qZWN0IHRoZSB0eXBlIGFyb3VuZCB3cmFwcGVyIGludG8gdGhlIHdpZGdldCdzIHdyYXBwZXIuXG4gICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHdpZGdldFZpZXdFbGVtZW50LCAnZW5kJyksIHR5cGVBcm91bmRXcmFwcGVyKTtcbn1cbi8qKlxuICogRllJOiBOb3QgdXNpbmcgdGhlIEljb25WaWV3IGNsYXNzIGJlY2F1c2UgZWFjaCBpbnN0YW5jZSB3b3VsZCBuZWVkIHRvIGJlIGRlc3Ryb3llZCB0byBhdm9pZCBtZW1vcnkgbGVha3NcbiAqIGFuZCBpdCdzIHByZXR0eSBoYXJkIHRvIGZpZ3VyZSBvdXQgd2hlbiBhIHZpZXcgKHdpZGdldCkgaXMgZ29uZSBmb3IgZ29vZCBzbyBpdCdzIGNoZWFwZXIgdG8gdXNlIHJhd1xuICogPHN2Zz4gaGVyZS5cbiAqLyBmdW5jdGlvbiBpbmplY3RCdXR0b25zKHdyYXBwZXJEb21FbGVtZW50LCBidXR0b25UaXRsZXMpIHtcbiAgICBmb3IgKGNvbnN0IHBvc2l0aW9uIG9mIFBPU1NJQkxFX0lOU0VSVElPTl9QT1NJVElPTlMpe1xuICAgICAgICBjb25zdCBidXR0b25UZW1wbGF0ZSA9IG5ldyBUZW1wbGF0ZSh7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBbXG4gICAgICAgICAgICAgICAgICAgICdjaycsXG4gICAgICAgICAgICAgICAgICAgICdjay13aWRnZXRfX3R5cGUtYXJvdW5kX19idXR0b24nLFxuICAgICAgICAgICAgICAgICAgICBgY2std2lkZ2V0X190eXBlLWFyb3VuZF9fYnV0dG9uXyR7cG9zaXRpb259YFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgdGl0bGU6IGJ1dHRvblRpdGxlc1twb3NpdGlvbl0sXG4gICAgICAgICAgICAgICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICB3cmFwcGVyRG9tRWxlbWVudC5vd25lckRvY3VtZW50LmltcG9ydE5vZGUoUkVUVVJOX0FSUk9XX0lDT05fRUxFTUVOVCwgdHJ1ZSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIHdyYXBwZXJEb21FbGVtZW50LmFwcGVuZENoaWxkKGJ1dHRvblRlbXBsYXRlLnJlbmRlcigpKTtcbiAgICB9XG59XG5mdW5jdGlvbiBpbmplY3RGYWtlQ2FyZXQod3JhcHBlckRvbUVsZW1lbnQpIHtcbiAgICBjb25zdCBjYXJldFRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKHtcbiAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgY2xhc3M6IFtcbiAgICAgICAgICAgICAgICAnY2snLFxuICAgICAgICAgICAgICAgICdjay13aWRnZXRfX3R5cGUtYXJvdW5kX19mYWtlLWNhcmV0J1xuICAgICAgICAgICAgXVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgd3JhcHBlckRvbUVsZW1lbnQuYXBwZW5kQ2hpbGQoY2FyZXRUZW1wbGF0ZS5yZW5kZXIoKSk7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGFuY2VzdG9yIG9mIGFuIGVsZW1lbnQgY2xvc2VzdCB0byB0aGUgcm9vdCB3aGljaCBpcyBlbXB0eS4gRm9yIGluc3RhbmNlLFxuICogZm9yIGA8YmF6PmA6XG4gKlxuICogYGBgXG4gKiA8Zm9vPmFiYzxiYXI+PGJhej48L2Jhej48L2Jhcj48L2Zvbz5cbiAqIGBgYFxuICpcbiAqIGl0IHJldHVybnMgYDxiYXI+YC5cbiAqLyBmdW5jdGlvbiBnZXREZWVwZXN0RW1wdHlFbGVtZW50QW5jZXN0b3Ioc2NoZW1hLCBlbGVtZW50KSB7XG4gICAgbGV0IGRlZXBlc3RFbXB0eUFuY2VzdG9yID0gZWxlbWVudDtcbiAgICBmb3IgKGNvbnN0IGFuY2VzdG9yIG9mIGVsZW1lbnQuZ2V0QW5jZXN0b3JzKHtcbiAgICAgICAgcGFyZW50Rmlyc3Q6IHRydWVcbiAgICB9KSl7XG4gICAgICAgIGlmIChhbmNlc3Rvci5jaGlsZENvdW50ID4gMSB8fCBzY2hlbWEuaXNMaW1pdChhbmNlc3RvcikpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGRlZXBlc3RFbXB0eUFuY2VzdG9yID0gYW5jZXN0b3I7XG4gICAgfVxuICAgIHJldHVybiBkZWVwZXN0RW1wdHlBbmNlc3Rvcjtcbn1cblxuLyoqXG4gKiBSZXR1cm5zICdrZXlkb3duJyBoYW5kbGVyIGZvciB1cC9kb3duIGFycm93IGtleXMgdGhhdCBtb2RpZmllcyB0aGUgY2FyZXQgbW92ZW1lbnQgaWYgaXQncyBpbiBhIHRleHQgbGluZSBuZXh0IHRvIGFuIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0gZWRpdGluZyBUaGUgZWRpdGluZyBjb250cm9sbGVyLlxuICovIGZ1bmN0aW9uIHZlcnRpY2FsTmF2aWdhdGlvbkhhbmRsZXIoZWRpdGluZykge1xuICAgIGNvbnN0IG1vZGVsID0gZWRpdGluZy5tb2RlbDtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSk9PntcbiAgICAgICAgY29uc3QgYXJyb3dVcFByZXNzZWQgPSBkYXRhLmtleUNvZGUgPT0ga2V5Q29kZXMuYXJyb3d1cDtcbiAgICAgICAgY29uc3QgYXJyb3dEb3duUHJlc3NlZCA9IGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd2Rvd247XG4gICAgICAgIGNvbnN0IGV4cGFuZFNlbGVjdGlvbiA9IGRhdGEuc2hpZnRLZXk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgaWYgKCFhcnJvd1VwUHJlc3NlZCAmJiAhYXJyb3dEb3duUHJlc3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzRm9yd2FyZCA9IGFycm93RG93blByZXNzZWQ7XG4gICAgICAgIC8vIE5hdmlnYXRpb24gaXMgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0aGFuIHRoZSBzZWxlY3Rpb24gZGlyZWN0aW9uIHNvIHRoaXMgaXMgc2hyaW5raW5nIG9mIHRoZSBzZWxlY3Rpb24uXG4gICAgICAgIC8vIFNlbGVjdGlvbiBmb3Igc3VyZSB3aWxsIG5vdCBhcHByb2FjaCBhbnkgb2JqZWN0LlxuICAgICAgICBpZiAoZXhwYW5kU2VsZWN0aW9uICYmIHNlbGVjdGlvbldpbGxTaHJpbmsoc2VsZWN0aW9uLCBpc0ZvcndhcmQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRmluZCBhIHJhbmdlIGJldHdlZW4gc2VsZWN0aW9uIGFuZCBjbG9zZXN0IGxpbWl0IGVsZW1lbnQuXG4gICAgICAgIGNvbnN0IHJhbmdlID0gZmluZFRleHRSYW5nZUZyb21TZWxlY3Rpb24oZWRpdGluZywgc2VsZWN0aW9uLCBpc0ZvcndhcmQpO1xuICAgICAgICAvLyBUaGVyZSBpcyBubyBzZWxlY3Rpb24gcG9zaXRpb24gaW5zaWRlIHRoZSBsaW1pdCBlbGVtZW50LlxuICAgICAgICBpZiAoIXJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgYWxyZWFkeSBhdCB0aGUgZWRnZSBvZiBhIGxpbWl0IGVsZW1lbnQuXG4gICAgICAgIGlmIChyYW5nZS5pc0NvbGxhcHNlZCkge1xuICAgICAgICAgICAgLy8gQSBjb2xsYXBzZWQgc2VsZWN0aW9uIGF0IGxpbWl0IGVkZ2UgLSBub3RoaW5nIG1vcmUgdG8gZG8uXG4gICAgICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleHBhbmRTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdGhlIHJhbmdlIGlzIGEgc2luZ2xlIGxpbmUgKHRoZXJlIGlzIG5vIHdvcmQgd3JhcHBpbmcpIHRoZW4gbW92ZSB0aGUgc2VsZWN0aW9uIHRvIHRoZSBwb3NpdGlvbiBjbG9zZXN0IHRvIHRoZSBsaW1pdCBlbGVtZW50LlxuICAgICAgICAvL1xuICAgICAgICAvLyBXZSBjYW4ndCBtb3ZlIHRoZSBzZWxlY3Rpb24gZGlyZWN0bHkgdG8gdGhlIGlzT2JqZWN0IGVsZW1lbnQgKGVnLiB0YWJsZSBjZWxsKSBiZWNhdXNlIG9mIGR1YWwgcG9zaXRpb24gYXQgdGhlIGVuZC9iZWdpbm5pbmdcbiAgICAgICAgLy8gb2Ygd3JhcHBlZCBsaW5lIChpdCdzIGF0IHRoZSBzYW1lIHRpbWUgYXQgdGhlIGVuZCBvZiBvbmUgbGluZSBhbmQgYXQgdGhlIHN0YXJ0IG9mIHRoZSBuZXh0IGxpbmUpLlxuICAgICAgICBpZiAocmFuZ2UuaXNDb2xsYXBzZWQgfHwgaXNTaW5nbGVMaW5lUmFuZ2UoZWRpdGluZywgcmFuZ2UsIGlzRm9yd2FyZCkpIHtcbiAgICAgICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1Bvc2l0aW9uID0gaXNGb3J3YXJkID8gcmFuZ2UuZW5kIDogcmFuZ2Uuc3RhcnQ7XG4gICAgICAgICAgICAgICAgaWYgKGV4cGFuZFNlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTZWxlY3Rpb24gPSBtb2RlbC5jcmVhdGVTZWxlY3Rpb24oc2VsZWN0aW9uLmFuY2hvcik7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NlbGVjdGlvbi5zZXRGb2N1cyhuZXdQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24obmV3U2VsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1Bvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBkYXRhLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogRmluZHMgdGhlIHJhbmdlIGJldHdlZW4gc2VsZWN0aW9uIGFuZCBjbG9zZXN0IGxpbWl0IGVsZW1lbnQgKGluIHRoZSBkaXJlY3Rpb24gb2YgbmF2aWdhdGlvbikuXG4gKiBUaGUgcG9zaXRpb24gbmV4dCB0byBsaW1pdCBlbGVtZW50IGlzIGFkanVzdGVkIHRvIHRoZSBjbG9zZXN0IGFsbG93ZWQgYCR0ZXh0YCBwb3NpdGlvbi5cbiAqXG4gKiBSZXR1cm5zIGBudWxsYCBpZiwgYWNjb3JkaW5nIHRvIHRoZSBzY2hlbWEsIHRoZSByZXN1bHRpbmcgcmFuZ2UgY2Fubm90IGNvbnRhaW4gYSBgJHRleHRgIGVsZW1lbnQuXG4gKlxuICogQHBhcmFtIGVkaXRpbmcgVGhlIGVkaXRpbmcgY29udHJvbGxlci5cbiAqIEBwYXJhbSBzZWxlY3Rpb24gVGhlIGN1cnJlbnQgc2VsZWN0aW9uLlxuICogQHBhcmFtIGlzRm9yd2FyZCBUaGUgZXhwZWN0ZWQgbmF2aWdhdGlvbiBkaXJlY3Rpb24uXG4gKi8gZnVuY3Rpb24gZmluZFRleHRSYW5nZUZyb21TZWxlY3Rpb24oZWRpdGluZywgc2VsZWN0aW9uLCBpc0ZvcndhcmQpIHtcbiAgICBjb25zdCBtb2RlbCA9IGVkaXRpbmcubW9kZWw7XG4gICAgaWYgKGlzRm9yd2FyZCkge1xuICAgICAgICBjb25zdCBzdGFydFBvc2l0aW9uID0gc2VsZWN0aW9uLmlzQ29sbGFwc2VkID8gc2VsZWN0aW9uLmZvY3VzIDogc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpO1xuICAgICAgICBjb25zdCBlbmRQb3NpdGlvbiA9IGdldE5lYXJlc3ROb25JbmxpbmVMaW1pdChtb2RlbCwgc3RhcnRQb3NpdGlvbiwgJ2ZvcndhcmQnKTtcbiAgICAgICAgLy8gVGhlcmUgaXMgbm8gbGltaXQgZWxlbWVudCwgYnJvd3NlciBzaG91bGQgaGFuZGxlIHRoaXMuXG4gICAgICAgIGlmICghZW5kUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2Uoc3RhcnRQb3NpdGlvbiwgZW5kUG9zaXRpb24pO1xuICAgICAgICBjb25zdCBsYXN0UmFuZ2VQb3NpdGlvbiA9IGdldE5lYXJlc3RUZXh0UG9zaXRpb24obW9kZWwuc2NoZW1hLCByYW5nZSwgJ2JhY2t3YXJkJyk7XG4gICAgICAgIGlmIChsYXN0UmFuZ2VQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG1vZGVsLmNyZWF0ZVJhbmdlKHN0YXJ0UG9zaXRpb24sIGxhc3RSYW5nZVBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbmRQb3NpdGlvbiA9IHNlbGVjdGlvbi5pc0NvbGxhcHNlZCA/IHNlbGVjdGlvbi5mb2N1cyA6IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgICAgIGNvbnN0IHN0YXJ0UG9zaXRpb24gPSBnZXROZWFyZXN0Tm9uSW5saW5lTGltaXQobW9kZWwsIGVuZFBvc2l0aW9uLCAnYmFja3dhcmQnKTtcbiAgICAgICAgLy8gVGhlcmUgaXMgbm8gbGltaXQgZWxlbWVudCwgYnJvd3NlciBzaG91bGQgaGFuZGxlIHRoaXMuXG4gICAgICAgIGlmICghc3RhcnRQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZShzdGFydFBvc2l0aW9uLCBlbmRQb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IGZpcnN0UmFuZ2VQb3NpdGlvbiA9IGdldE5lYXJlc3RUZXh0UG9zaXRpb24obW9kZWwuc2NoZW1hLCByYW5nZSwgJ2ZvcndhcmQnKTtcbiAgICAgICAgaWYgKGZpcnN0UmFuZ2VQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIG1vZGVsLmNyZWF0ZVJhbmdlKGZpcnN0UmFuZ2VQb3NpdGlvbiwgZW5kUG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbi8qKlxuICogRmluZHMgdGhlIGxpbWl0IGVsZW1lbnQgcG9zaXRpb24gdGhhdCBpcyBjbG9zZXN0IHRvIHN0YXJ0UG9zaXRpb24uXG4gKlxuICogQHBhcmFtIGRpcmVjdGlvbiBTZWFyY2ggZGlyZWN0aW9uLlxuICovIGZ1bmN0aW9uIGdldE5lYXJlc3ROb25JbmxpbmVMaW1pdChtb2RlbCwgc3RhcnRQb3NpdGlvbiwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgIGNvbnN0IHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2VJbihzdGFydFBvc2l0aW9uLnJvb3QpO1xuICAgIGNvbnN0IHdhbGtlclZhbHVlVHlwZSA9IGRpcmVjdGlvbiA9PSAnZm9yd2FyZCcgPyAnZWxlbWVudFN0YXJ0JyA6ICdlbGVtZW50RW5kJztcbiAgICBmb3IgKGNvbnN0IHsgcHJldmlvdXNQb3NpdGlvbiwgaXRlbSwgdHlwZSB9IG9mIHJhbmdlLmdldFdhbGtlcih7XG4gICAgICAgIHN0YXJ0UG9zaXRpb24sXG4gICAgICAgIGRpcmVjdGlvblxuICAgIH0pKXtcbiAgICAgICAgaWYgKHNjaGVtYS5pc0xpbWl0KGl0ZW0pICYmICFzY2hlbWEuaXNJbmxpbmUoaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1Bvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIC8vIFN0b3AgbG9va2luZyBmb3IgaXNMaW1pdCBlbGVtZW50IGlmIHRoZSBuZXh0IGVsZW1lbnQgaXMgYSBibG9jayBlbGVtZW50IChpdCBpcyBmb3Igc3VyZSBub3Qgc2luZ2xlIGxpbmUpLlxuICAgICAgICBpZiAodHlwZSA9PSB3YWxrZXJWYWx1ZVR5cGUgJiYgc2NoZW1hLmlzQmxvY2soaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuLyoqXG4gKiBCYXNpbmcgb24gdGhlIHByb3ZpZGVkIHJhbmdlLCBmaW5kcyB0aGUgZmlyc3Qgb3IgbGFzdCAoZGVwZW5kaW5nIG9uIGBkaXJlY3Rpb25gKSBwb3NpdGlvbiBpbnNpZGUgdGhlIHJhbmdlXG4gKiB0aGF0IGNhbiBjb250YWluIGAkdGV4dGAgKGFjY29yZGluZyB0byBzY2hlbWEpLlxuICpcbiAqIEBwYXJhbSBzY2hlbWEgVGhlIHNjaGVtYS5cbiAqIEBwYXJhbSByYW5nZSBUaGUgcmFuZ2UgdG8gZmluZCB0aGUgcG9zaXRpb24gaW4uXG4gKiBAcGFyYW0gZGlyZWN0aW9uIFNlYXJjaCBkaXJlY3Rpb24uXG4gKiBAcmV0dXJucyBUaGUgbmVhcmVzdCBzZWxlY3Rpb24gcG9zaXRpb24uXG4gKlxuICovIGZ1bmN0aW9uIGdldE5lYXJlc3RUZXh0UG9zaXRpb24oc2NoZW1hLCByYW5nZSwgZGlyZWN0aW9uKSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSBkaXJlY3Rpb24gPT0gJ2JhY2t3YXJkJyA/IHJhbmdlLmVuZCA6IHJhbmdlLnN0YXJ0O1xuICAgIGlmIChzY2hlbWEuY2hlY2tDaGlsZChwb3NpdGlvbiwgJyR0ZXh0JykpIHtcbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHsgbmV4dFBvc2l0aW9uIH0gb2YgcmFuZ2UuZ2V0V2Fsa2VyKHtcbiAgICAgICAgZGlyZWN0aW9uXG4gICAgfSkpe1xuICAgICAgICBpZiAoc2NoZW1hLmNoZWNrQ2hpbGQobmV4dFBvc2l0aW9uLCAnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5leHRQb3NpdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBET00gcmFuZ2UgY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgbW9kZWwgcmFuZ2UgcmVuZGVycyBhcyBhIHNpbmdsZSBsaW5lIGJ5IGFuYWx5emluZyBET01SZWN0c1xuICogKHZlcmlmeWluZyBpZiB0aGV5IHZpc3VhbGx5IHdyYXAgY29udGVudCB0byB0aGUgbmV4dCBsaW5lKS5cbiAqXG4gKiBAcGFyYW0gZWRpdGluZyBUaGUgZWRpdGluZyBjb250cm9sbGVyLlxuICogQHBhcmFtIG1vZGVsUmFuZ2UgVGhlIGN1cnJlbnQgdGFibGUgY2VsbCBjb250ZW50IHJhbmdlLlxuICogQHBhcmFtIGlzRm9yd2FyZCBUaGUgZXhwZWN0ZWQgbmF2aWdhdGlvbiBkaXJlY3Rpb24uXG4gKi8gZnVuY3Rpb24gaXNTaW5nbGVMaW5lUmFuZ2UoZWRpdGluZywgbW9kZWxSYW5nZSwgaXNGb3J3YXJkKSB7XG4gICAgY29uc3QgbW9kZWwgPSBlZGl0aW5nLm1vZGVsO1xuICAgIGNvbnN0IGRvbUNvbnZlcnRlciA9IGVkaXRpbmcudmlldy5kb21Db252ZXJ0ZXI7XG4gICAgLy8gV3JhcHBlZCBsaW5lcyBjb250YWluIGV4YWN0bHkgdGhlIHNhbWUgcG9zaXRpb24gYXQgdGhlIGVuZCBvZiBjdXJyZW50IGxpbmVcbiAgICAvLyBhbmQgYXQgdGhlIGJlZ2lubmluZyBvZiBuZXh0IGxpbmUuIFRoYXQgcG9zaXRpb24ncyBjbGllbnQgcmVjdCBpcyBhdCB0aGUgZW5kXG4gICAgLy8gb2YgY3VycmVudCBsaW5lLiBJbiBjYXNlIG9mIGNhcmV0IGF0IGZpcnN0IHBvc2l0aW9uIG9mIHRoZSBsYXN0IGxpbmUgdGhhdCAnZHVhbCdcbiAgICAvLyBwb3NpdGlvbiB3b3VsZCBiZSBkZXRlY3RlZCBhcyBpdCdzIG5vdCB0aGUgbGFzdCBsaW5lLlxuICAgIGlmIChpc0ZvcndhcmQpIHtcbiAgICAgICAgY29uc3QgcHJvYmUgPSBtb2RlbC5jcmVhdGVTZWxlY3Rpb24obW9kZWxSYW5nZS5zdGFydCk7XG4gICAgICAgIG1vZGVsLm1vZGlmeVNlbGVjdGlvbihwcm9iZSk7XG4gICAgICAgIC8vIElmIHRoZSBuZXcgcG9zaXRpb24gaXMgYXQgdGhlIGVuZCBvZiB0aGUgY29udGFpbmVyIHRoZW4gd2UgY2FuJ3QgdXNlIHRoaXMgcG9zaXRpb25cbiAgICAgICAgLy8gYmVjYXVzZSBpdCB3b3VsZCBwcm92aWRlIGluY29ycmVjdCByZXN1bHQgZm9yIGVnIGNhcHRpb24gb2YgaW1hZ2UgYW5kIHNlbGVjdGlvblxuICAgICAgICAvLyBqdXN0IGJlZm9yZSBlbmQgb2YgaXQuIEFsc28gaW4gdGhpcyBjYXNlIHRoZXJlIGlzIG5vIFwiZHVhbFwiIHBvc2l0aW9uLlxuICAgICAgICBpZiAoIXByb2JlLmZvY3VzLmlzQXRFbmQgJiYgIW1vZGVsUmFuZ2Uuc3RhcnQuaXNFcXVhbChwcm9iZS5mb2N1cykpIHtcbiAgICAgICAgICAgIG1vZGVsUmFuZ2UgPSBtb2RlbC5jcmVhdGVSYW5nZShwcm9iZS5mb2N1cywgbW9kZWxSYW5nZS5lbmQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHZpZXdSYW5nZSA9IGVkaXRpbmcubWFwcGVyLnRvVmlld1JhbmdlKG1vZGVsUmFuZ2UpO1xuICAgIGNvbnN0IGRvbVJhbmdlID0gZG9tQ29udmVydGVyLnZpZXdSYW5nZVRvRG9tKHZpZXdSYW5nZSk7XG4gICAgY29uc3QgcmVjdHMgPSBSZWN0LmdldERvbVJhbmdlUmVjdHMoZG9tUmFuZ2UpO1xuICAgIGxldCBib3VuZGFyeVZlcnRpY2FsUG9zaXRpb247XG4gICAgZm9yIChjb25zdCByZWN0IG9mIHJlY3RzKXtcbiAgICAgICAgaWYgKGJvdW5kYXJ5VmVydGljYWxQb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBib3VuZGFyeVZlcnRpY2FsUG9zaXRpb24gPSBNYXRoLnJvdW5kKHJlY3QuYm90dG9tKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIExldCdzIGNoZWNrIGlmIHRoaXMgcmVjdCBpcyBpbiBuZXcgbGluZS5cbiAgICAgICAgaWYgKE1hdGgucm91bmQocmVjdC50b3ApID49IGJvdW5kYXJ5VmVydGljYWxQb3NpdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGJvdW5kYXJ5VmVydGljYWxQb3NpdGlvbiA9IE1hdGgubWF4KGJvdW5kYXJ5VmVydGljYWxQb3NpdGlvbiwgTWF0aC5yb3VuZChyZWN0LmJvdHRvbSkpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHNlbGVjdGlvbldpbGxTaHJpbmsoc2VsZWN0aW9uLCBpc0ZvcndhcmQpIHtcbiAgICByZXR1cm4gIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBzZWxlY3Rpb24uaXNCYWNrd2FyZCA9PSBpc0ZvcndhcmQ7XG59XG5cbi8qKlxuICogVGhlIHdpZGdldCBwbHVnaW4uIEl0IGVuYWJsZXMgYmFzZSBzdXBwb3J0IGZvciB3aWRnZXRzLlxuICpcbiAqIFNlZSB7QGdsaW5rIGFwaS93aWRnZXQgcGFja2FnZSBwYWdlfSBmb3IgbW9yZSBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uLlxuICpcbiAqIFRoaXMgcGx1Z2luIGVuYWJsZXMgbXVsdGlwbGUgYmVoYXZpb3JzIHJlcXVpcmVkIGJ5IHdpZGdldHM6XG4gKlxuICogKiBUaGUgbW9kZWwgdG8gdmlldyBzZWxlY3Rpb24gY29udmVydGVyIGZvciB0aGUgZWRpdGluZyBwaXBlbGluZSAoaXQgaGFuZGxlcyB3aWRnZXQgY3VzdG9tIHNlbGVjdGlvbiByZW5kZXJpbmcpLlxuICogSWYgYSBjb252ZXJ0ZWQgc2VsZWN0aW9uIHdyYXBzIGFyb3VuZCBhIHdpZGdldCBlbGVtZW50LCB0aGF0IHNlbGVjdGlvbiBpcyBtYXJrZWQgYXNcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvc2VsZWN0aW9uflNlbGVjdGlvbiNpc0Zha2UgZmFrZX0uIEFkZGl0aW9uYWxseSwgdGhlIGBjay13aWRnZXRfc2VsZWN0ZWRgIENTUyBjbGFzc1xuICogaXMgYWRkZWQgdG8gaW5kaWNhdGUgdGhhdCB3aWRnZXQgaGFzIGJlZW4gc2VsZWN0ZWQuXG4gKiAqIFRoZSBtb3VzZSBhbmQga2V5Ym9hcmQgZXZlbnRzIGhhbmRsaW5nIG9uIGFuZCBhcm91bmQgd2lkZ2V0IGVsZW1lbnRzLlxuICovIGNsYXNzIFdpZGdldCBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEhvbGRzIHByZXZpb3VzbHkgc2VsZWN0ZWQgd2lkZ2V0cy5cblx0ICovIF9wcmV2aW91c2x5U2VsZWN0ZWQgPSBuZXcgU2V0KCk7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnV2lkZ2V0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBXaWRnZXRUeXBlQXJvdW5kLFxuICAgICAgICAgICAgRGVsZXRlXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICBjb25zdCB2aWV3RG9jdW1lbnQgPSB2aWV3LmRvY3VtZW50O1xuICAgICAgICBjb25zdCB0ID0gZWRpdG9yLnQ7XG4gICAgICAgIC8vIE1vZGVsIHRvIHZpZXcgc2VsZWN0aW9uIGNvbnZlcnRlci5cbiAgICAgICAgLy8gQ29udmVydHMgc2VsZWN0aW9uIHBsYWNlZCBvdmVyIHdpZGdldCBlbGVtZW50IHRvIGZha2Ugc2VsZWN0aW9uLlxuICAgICAgICAvL1xuICAgICAgICAvLyBCeSBkZWZhdWx0LCB0aGUgc2VsZWN0aW9uIGlzIGRvd25jYXN0ZWQgYnkgdGhlIGVuZ2luZSB0byBzdXJyb3VuZCB0aGUgYXR0cmlidXRlIGVsZW1lbnQsIGV2ZW4gdGhvdWdoIGl0cyBvbmx5XG4gICAgICAgIC8vIGNoaWxkIGlzIGFuIGlubGluZSB3aWRnZXQuIEEgc2ltaWxhciB0aGluZyBhbHNvIGhhcHBlbnMgd2hlbiBhIGNvbGxhcHNlZCBtYXJrZXIgaXMgcmVuZGVyZWQgYXMgYSBVSSBlbGVtZW50XG4gICAgICAgIC8vIG5leHQgdG8gYW4gaW5saW5lIHdpZGdldDogdGhlIHZpZXcgc2VsZWN0aW9uIGNvbnRhaW5zIGJvdGggdGhlIHdpZGdldCBhbmQgdGhlIG1hcmtlci5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhpcyBwcmV2ZW50cyBjcmVhdGluZyBhIGNvcnJlY3QgZmFrZSBzZWxlY3Rpb24gd2hlbiB0aGlzIGlubGluZSB3aWRnZXQgaXMgc2VsZWN0ZWQuIE5vcm1hbGl6ZSB0aGUgc2VsZWN0aW9uXG4gICAgICAgIC8vIGluIHRoZXNlIGNhc2VzIGJhc2VkIG9uIHRoZSBtb2RlbDpcbiAgICAgICAgLy9cbiAgICAgICAgLy9cdFx0WzxhdHRyaWJ1dGVFbGVtZW50PjxpbmxpbmVXaWRnZXQgLz48L2F0dHJpYnV0ZUVsZW1lbnQ+XSAtPiA8YXR0cmlidXRlRWxlbWVudD5bPGlubGluZVdpZGdldCAvPl08L2F0dHJpYnV0ZUVsZW1lbnQ+XG4gICAgICAgIC8vXHRcdFs8dWlFbGVtZW50PjwvdWlFbGVtZW50PjxpbmxpbmVXaWRnZXQgLz5dIC0+IDx1aUVsZW1lbnQ+PC91aUVsZW1lbnQ+WzxpbmxpbmVXaWRnZXQgLz5dXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoYW5rcyB0byB0aGlzOlxuICAgICAgICAvL1xuICAgICAgICAvLyAqIGZha2Ugc2VsZWN0aW9uIGNhbiBiZSBzZXQgY29ycmVjdGx5LFxuICAgICAgICAvLyAqIGFueSBsb2dpYyBkZXBlbmRpbmcgb24gKFZpZXcpU2VsZWN0aW9uI2dldFNlbGVjdGVkRWxlbWVudCgpIGFsc28gd29ya3MgT0suXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy85NTI0LlxuICAgICAgICB0aGlzLmVkaXRvci5lZGl0aW5nLmRvd25jYXN0RGlzcGF0Y2hlci5vbignc2VsZWN0aW9uJywgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsU2VsZWN0aW9uID0gZGF0YS5zZWxlY3Rpb247XG4gICAgICAgICAgICAvLyBUaGUgY29sbGFwc2VkIHNlbGVjdGlvbiBjYW4ndCBjb250YWluIGFueSB3aWRnZXQuXG4gICAgICAgICAgICBpZiAobW9kZWxTZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZE1vZGVsRWxlbWVudCA9IG1vZGVsU2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICAgICAgaWYgKCFzZWxlY3RlZE1vZGVsRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkVmlld0VsZW1lbnQgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXIudG9WaWV3RWxlbWVudChzZWxlY3RlZE1vZGVsRWxlbWVudCk7XG4gICAgICAgICAgICBpZiAoIWlzV2lkZ2V0KHNlbGVjdGVkVmlld0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShtb2RlbFNlbGVjdGlvbiwgJ3NlbGVjdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlld1dyaXRlci5zZXRTZWxlY3Rpb24odmlld1dyaXRlci5jcmVhdGVSYW5nZU9uKHNlbGVjdGVkVmlld0VsZW1lbnQpLCB7XG4gICAgICAgICAgICAgICAgZmFrZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYWJlbDogZ2V0TGFiZWwoc2VsZWN0ZWRWaWV3RWxlbWVudClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gTWFyayBhbGwgd2lkZ2V0cyBpbnNpZGUgdGhlIHNlbGVjdGlvbiB3aXRoIHRoZSBjc3MgY2xhc3MuXG4gICAgICAgIC8vIFRoaXMgaGFuZGxlciBpcyByZWdpc3RlcmVkIGF0IHRoZSAnbG93JyBwcmlvcml0eSBzbyBpdCdzIHRyaWdnZXJlZCBhZnRlciB0aGUgcmVhbCBzZWxlY3Rpb24gY29udmVyc2lvbi5cbiAgICAgICAgdGhpcy5lZGl0b3IuZWRpdGluZy5kb3duY2FzdERpc3BhdGNoZXIub24oJ3NlbGVjdGlvbicsIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgICAgICAvLyBSZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIHdpZGdldHMuXG4gICAgICAgICAgICB0aGlzLl9jbGVhclByZXZpb3VzbHlTZWxlY3RlZFdpZGdldHMoY29udmVyc2lvbkFwaS53cml0ZXIpO1xuICAgICAgICAgICAgY29uc3Qgdmlld1dyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICAgICAgY29uc3Qgdmlld1NlbGVjdGlvbiA9IHZpZXdXcml0ZXIuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgbGV0IGxhc3RNYXJrZWQgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChjb25zdCByYW5nZSBvZiB2aWV3U2VsZWN0aW9uLmdldFJhbmdlcygpKXtcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGVyZSBjb3VsZCBiZSBtdWx0aXBsZSBzZWxlY3RlZCB3aWRnZXRzIGluIGEgcmFuZ2UgYnV0IG5vIGZha2Ugc2VsZWN0aW9uLlxuICAgICAgICAgICAgICAgIC8vIEFsbCBvZiB0aGVtIG11c3QgYmUgbWFya2VkIGFzIHNlbGVjdGVkLCBmb3IgaW5zdGFuY2UgWzx3aWRnZXQ+PC93aWRnZXQ+PHdpZGdldD48L3dpZGdldD5dXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByYW5nZSl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB2YWx1ZS5pdGVtO1xuICAgICAgICAgICAgICAgICAgICAvLyBEbyBub3QgbWFyayBuZXN0ZWQgd2lkZ2V0cyBpbiBzZWxlY3RlZCBvbmUuIFNlZTogIzQ1OTRcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzV2lkZ2V0KG5vZGUpICYmICFpc0NoaWxkKG5vZGUsIGxhc3RNYXJrZWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3V3JpdGVyLmFkZENsYXNzKFdJREdFVF9TRUxFQ1RFRF9DTEFTU19OQU1FLCBub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZpb3VzbHlTZWxlY3RlZC5hZGQobm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0TWFya2VkID0gbm9kZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBJZiBtb3VzZSBkb3duIGlzIHByZXNzZWQgb24gd2lkZ2V0IC0gY3JlYXRlIHNlbGVjdGlvbiBvdmVyIHdob2xlIHdpZGdldC5cbiAgICAgICAgdmlldy5hZGRPYnNlcnZlcihNb3VzZU9ic2VydmVyKTtcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh2aWV3RG9jdW1lbnQsICdtb3VzZWRvd24nLCAoLi4uYXJncyk9PnRoaXMuX29uTW91c2Vkb3duKC4uLmFyZ3MpKTtcbiAgICAgICAgLy8gVGhlcmUgYXJlIHR3byBrZXlkb3duIGxpc3RlbmVycyB3b3JraW5nIG9uIGRpZmZlcmVudCBwcmlvcml0aWVzLiBUaGlzIGFsbG93cyBvdGhlclxuICAgICAgICAvLyBmZWF0dXJlcyBzdWNoIGFzIFdpZGdldFR5cGVBcm91bmQgb3IgVGFibGVLZXlib2FyZCB0byBhdHRhY2ggdGhlaXIgbGlzdGVuZXJzIGluIGJldHdlZW5cbiAgICAgICAgLy8gYW5kIGN1c3RvbWl6ZSB0aGUgYmVoYXZpb3IgZXZlbiBmdXJ0aGVyIGluIGRpZmZlcmVudCBjb250ZW50L3NlbGVjdGlvbiBzY2VuYXJpb3MuXG4gICAgICAgIC8vXG4gICAgICAgIC8vICogVGhlIGZpcnN0IGxpc3RlbmVyIGhhbmRsZXMgY2hhbmdpbmcgdGhlIHNlbGVjdGlvbiBvbiBhcnJvdyBrZXkgcHJlc3NcbiAgICAgICAgLy8gaWYgdGhlIHdpZGdldCBpcyBzZWxlY3RlZCBvciBpZiB0aGUgc2VsZWN0aW9uIGlzIG5leHQgdG8gYSB3aWRnZXQgYW5kIHRoZSB3aWRnZXRcbiAgICAgICAgLy8gc2hvdWxkIGJlY29tZSBzZWxlY3RlZCB1cG9uIHRoZSBhcnJvdyBrZXkgcHJlc3MuXG4gICAgICAgIC8vXG4gICAgICAgIC8vICogVGhlIHNlY29uZCAobGF0ZSkgbGlzdGVuZXIgbWFrZXMgc3VyZSB0aGUgZGVmYXVsdCBicm93c2VyIGFjdGlvbiBvbiBhcnJvdyBrZXkgcHJlc3MgaXNcbiAgICAgICAgLy8gcHJldmVudGVkIHdoZW4gYSB3aWRnZXQgaXMgc2VsZWN0ZWQuIFRoaXMgcHJldmVudHMgdGhlIHNlbGVjdGlvbiBmcm9tIGJlaW5nIG1vdmVkXG4gICAgICAgIC8vIGZyb20gYSBmYWtlIHNlbGVjdGlvbiBjb250YWluZXIuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnYXJyb3dLZXknLCAoLi4uYXJncyk9PntcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZVNlbGVjdGlvbkNoYW5nZU9uQXJyb3dLZXlQcmVzcyguLi5hcmdzKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogW1xuICAgICAgICAgICAgICAgIGlzV2lkZ2V0LFxuICAgICAgICAgICAgICAgICckdGV4dCdcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAnYXJyb3dLZXknLCAoLi4uYXJncyk9PntcbiAgICAgICAgICAgIHRoaXMuX3ByZXZlbnREZWZhdWx0T25BcnJvd0tleVByZXNzKC4uLmFyZ3MpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBjb250ZXh0OiAnJHJvb3QnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxpc3RlblRvKHZpZXdEb2N1bWVudCwgJ2Fycm93S2V5JywgdmVydGljYWxOYXZpZ2F0aW9uSGFuZGxlcih0aGlzLmVkaXRvci5lZGl0aW5nKSwge1xuICAgICAgICAgICAgY29udGV4dDogJyR0ZXh0J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gSGFuZGxlIGN1c3RvbSBkZWxldGUgYmVoYXZpb3VyLlxuICAgICAgICB0aGlzLmxpc3RlblRvKHZpZXdEb2N1bWVudCwgJ2RlbGV0ZScsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAodGhpcy5faGFuZGxlRGVsZXRlKGRhdGEuZGlyZWN0aW9uID09ICdmb3J3YXJkJykpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogJyRyb290J1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gSGFuZGxlIFRhYiBrZXkgd2hpbGUgYSB3aWRnZXQgaXMgc2VsZWN0ZWQuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAndGFiJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgIC8vIFRoaXMgZXZlbnQgY291bGQgYmUgdHJpZ2dlcmVkIGZyb20gaW5zaWRlIHRoZSB3aWRnZXQsIGJ1dCB3ZSBhcmUgaW50ZXJlc3RlZFxuICAgICAgICAgICAgLy8gb25seSB3aGVuIHRoZSB3aWRnZXQgaXMgc2VsZWN0ZWQgaXRzZWxmLlxuICAgICAgICAgICAgaWYgKGV2dC5ldmVudFBoYXNlICE9ICdhdFRhcmdldCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGF0YS5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9zZWxlY3RGaXJzdE5lc3RlZEVkaXRhYmxlKCkpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogaXNXaWRnZXQsXG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEhhbmRsZSBTaGlmdCtUYWIga2V5IHdoaWxlIGNhcmV0IGluc2lkZSBhIHdpZGdldCBlZGl0YWJsZS5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh2aWV3RG9jdW1lbnQsICd0YWInLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgaWYgKCFkYXRhLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX3NlbGVjdEFuY2VzdG9yV2lkZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBIYW5kbGUgRXNjIGtleSB3aGlsZSBpbnNpZGUgYSBuZXN0ZWQgZWRpdGFibGUuXG4gICAgICAgIHRoaXMubGlzdGVuVG8odmlld0RvY3VtZW50LCAna2V5ZG93bicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAoZGF0YS5rZXlzdHJva2UgIT0ga2V5Q29kZXMuZXNjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX3NlbGVjdEFuY2VzdG9yV2lkZ2V0KCkpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgdGhlIGluZm9ybWF0aW9uIGFib3V0IHRoZSBrZXlzdHJva2VzIHRvIHRoZSBhY2Nlc3NpYmlsaXR5IGRhdGFiYXNlLlxuICAgICAgICBlZGl0b3IuYWNjZXNzaWJpbGl0eS5hZGRLZXlzdHJva2VJbmZvR3JvdXAoe1xuICAgICAgICAgICAgaWQ6ICd3aWRnZXQnLFxuICAgICAgICAgICAgbGFiZWw6IHQoJ0tleXN0cm9rZXMgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGEgd2lkZ2V0IGlzIHNlbGVjdGVkIChmb3IgZXhhbXBsZTogaW1hZ2UsIHRhYmxlLCBldGMuKScpLFxuICAgICAgICAgICAga2V5c3Ryb2tlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQoJ01vdmUgZm9jdXMgZnJvbSBhbiBlZGl0YWJsZSBhcmVhIGJhY2sgdG8gdGhlIHBhcmVudCB3aWRnZXQnKSxcbiAgICAgICAgICAgICAgICAgICAga2V5c3Ryb2tlOiAnRXNjJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnSW5zZXJ0IGEgbmV3IHBhcmFncmFwaCBkaXJlY3RseSBhZnRlciBhIHdpZGdldCcpLFxuICAgICAgICAgICAgICAgICAgICBrZXlzdHJva2U6ICdFbnRlcidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQoJ0luc2VydCBhIG5ldyBwYXJhZ3JhcGggZGlyZWN0bHkgYmVmb3JlIGEgd2lkZ2V0JyksXG4gICAgICAgICAgICAgICAgICAgIGtleXN0cm9rZTogJ1NoaWZ0K0VudGVyJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnTW92ZSB0aGUgY2FyZXQgdG8gYWxsb3cgdHlwaW5nIGRpcmVjdGx5IGJlZm9yZSBhIHdpZGdldCcpLFxuICAgICAgICAgICAgICAgICAgICBrZXlzdHJva2U6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJyb3d1cCdcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fycm93bGVmdCdcbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnTW92ZSB0aGUgY2FyZXQgdG8gYWxsb3cgdHlwaW5nIGRpcmVjdGx5IGFmdGVyIGEgd2lkZ2V0JyksXG4gICAgICAgICAgICAgICAgICAgIGtleXN0cm9rZTogW1xuICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhcnJvd2Rvd24nXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhcnJvd3JpZ2h0J1xuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhhbmRsZXMge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDptb3VzZWRvd24gbW91c2Vkb3dufSBldmVudHMgb24gd2lkZ2V0IGVsZW1lbnRzLlxuXHQgKi8gX29uTW91c2Vkb3duKGV2ZW50SW5mbywgZG9tRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCB2aWV3ID0gZWRpdG9yLmVkaXRpbmcudmlldztcbiAgICAgICAgY29uc3Qgdmlld0RvY3VtZW50ID0gdmlldy5kb2N1bWVudDtcbiAgICAgICAgbGV0IGVsZW1lbnQgPSBkb21FdmVudERhdGEudGFyZ2V0O1xuICAgICAgICAvLyBTb21lIG9mIERPTSBlbGVtZW50cyBoYXZlIG5vIHZpZXcgZWxlbWVudCByZXByZXNlbnRhdGlvbiBzbyBpdCBtYXkgYmUgbnVsbC5cbiAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdHJpcGxlIGNsaWNrIHNob3VsZCBzZWxlY3QgZW50aXJlIHBhcmFncmFwaC5cbiAgICAgICAgaWYgKGRvbUV2ZW50RGF0YS5kb21FdmVudC5kZXRhaWwgPj0gMykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3NlbGVjdEJsb2NrQ29udGVudChlbGVtZW50KSkge1xuICAgICAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRhcmdldCBpcyBub3QgYSB3aWRnZXQgZWxlbWVudCAtIGNoZWNrIGlmIG9uZSBvZiB0aGUgYW5jZXN0b3JzIGlzLlxuICAgICAgICBpZiAoIWlzV2lkZ2V0KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICBjb25zdCBlZGl0YWJsZU9yV2lkZ2V0RWxlbWVudCA9IGZpbmRDbG9zZXN0RWRpdGFibGVPcldpZGdldEFuY2VzdG9yKGVsZW1lbnQpO1xuICAgICAgICAgICAgaWYgKCFlZGl0YWJsZU9yV2lkZ2V0RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1dpZGdldChlZGl0YWJsZU9yV2lkZ2V0RWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWRpdGFibGVPcldpZGdldEVsZW1lbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFBpY2sgdmlldyByYW5nZSBmcm9tIHRoZSBwb2ludCB3aGVyZSB0aGUgbW91c2Ugd2FzIGNsaWNrZWQuXG4gICAgICAgICAgICAgICAgY29uc3QgY2xpY2tUYXJnZXRGcm9tUG9pbnQgPSBnZXRFbGVtZW50RnJvbU1vdXNlRXZlbnQodmlldywgZG9tRXZlbnREYXRhKTtcbiAgICAgICAgICAgICAgICBpZiAoY2xpY2tUYXJnZXRGcm9tUG9pbnQgJiYgaXNXaWRnZXQoY2xpY2tUYXJnZXRGcm9tUG9pbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBjbGlja1RhcmdldEZyb21Qb2ludDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE9uIEFuZHJvaWQgc2VsZWN0aW9uIHdvdWxkIGp1bXAgdG8gdGhlIGZpcnN0IHRhYmxlIGNlbGwsIG9uIG90aGVyIGRldmljZXNcbiAgICAgICAgLy8gd2UgY2FuJ3QgYmxvY2sgaXQgKGFuZCBkb24ndCBuZWVkIHRvKSBiZWNhdXNlIG9mIGRyYWcgYW5kIGRyb3Agc3VwcG9ydC5cbiAgICAgICAgaWYgKGVudi5pc0FuZHJvaWQpIHtcbiAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZvY3VzIGVkaXRvciBpZiBpcyBub3QgZm9jdXNlZCBhbHJlYWR5LlxuICAgICAgICBpZiAoIXZpZXdEb2N1bWVudC5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHZpZXcuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDcmVhdGUgbW9kZWwgc2VsZWN0aW9uIG92ZXIgd2lkZ2V0LlxuICAgICAgICBjb25zdCBtb2RlbEVsZW1lbnQgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXIudG9Nb2RlbEVsZW1lbnQoZWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3NldFNlbGVjdGlvbk92ZXJFbGVtZW50KG1vZGVsRWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWxlY3RzIGVudGlyZSBibG9jayBjb250ZW50LCBlLmcuIG9uIHRyaXBsZSBjbGljayBpdCBzZWxlY3RzIGVudGlyZSBwYXJhZ3JhcGguXG5cdCAqLyBfc2VsZWN0QmxvY2tDb250ZW50KGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBtYXBwZXIgPSBlZGl0b3IuZWRpdGluZy5tYXBwZXI7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBtYXBwZXIuZmluZE1hcHBlZFZpZXdBbmNlc3Rvcih0aGlzLmVkaXRvci5lZGl0aW5nLnZpZXcuY3JlYXRlUG9zaXRpb25BdChlbGVtZW50LCAwKSk7XG4gICAgICAgIGNvbnN0IG1vZGVsRWxlbWVudCA9IGZpbmRUZXh0QmxvY2tBbmNlc3RvcihtYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld0VsZW1lbnQpLCBtb2RlbC5zY2hlbWEpO1xuICAgICAgICBpZiAoIW1vZGVsRWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgbmV4dFRleHRCbG9jayA9ICFzY2hlbWEuaXNMaW1pdChtb2RlbEVsZW1lbnQpID8gZmluZE5leHRUZXh0QmxvY2sod3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIobW9kZWxFbGVtZW50KSwgc2NoZW1hKSA6IG51bGw7XG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KG1vZGVsRWxlbWVudCwgMCk7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBuZXh0VGV4dEJsb2NrID8gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobmV4dFRleHRCbG9jaywgMCkgOiB3cml0ZXIuY3JlYXRlUG9zaXRpb25BdChtb2RlbEVsZW1lbnQsICdlbmQnKTtcbiAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24od3JpdGVyLmNyZWF0ZVJhbmdlKHN0YXJ0LCBlbmQpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmtleWRvd24ga2V5ZG93bn0gZXZlbnRzIGFuZCBjaGFuZ2VzXG5cdCAqIHRoZSBtb2RlbCBzZWxlY3Rpb24gd2hlbjpcblx0ICpcblx0ICogKiBhcnJvdyBrZXkgaXMgcHJlc3NlZCB3aGVuIHRoZSB3aWRnZXQgaXMgc2VsZWN0ZWQsXG5cdCAqICogdGhlIHNlbGVjdGlvbiBpcyBuZXh0IHRvIGEgd2lkZ2V0IGFuZCB0aGUgd2lkZ2V0IHNob3VsZCBiZWNvbWUgc2VsZWN0ZWQgdXBvbiB0aGUgYXJyb3cga2V5IHByZXNzLlxuXHQgKlxuXHQgKiBTZWUge0BsaW5rICNfcHJldmVudERlZmF1bHRPbkFycm93S2V5UHJlc3N9LlxuXHQgKi8gX2hhbmRsZVNlbGVjdGlvbkNoYW5nZU9uQXJyb3dLZXlQcmVzcyhldmVudEluZm8sIGRvbUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zdCBrZXlDb2RlID0gZG9tRXZlbnREYXRhLmtleUNvZGU7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3QgbW9kZWxTZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IG9iamVjdEVsZW1lbnQgPSBtb2RlbFNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gZ2V0TG9jYWxpemVkQXJyb3dLZXlDb2RlRGlyZWN0aW9uKGtleUNvZGUsIHRoaXMuZWRpdG9yLmxvY2FsZS5jb250ZW50TGFuZ3VhZ2VEaXJlY3Rpb24pO1xuICAgICAgICBjb25zdCBpc0ZvcndhcmQgPSBkaXJlY3Rpb24gPT0gJ2Rvd24nIHx8IGRpcmVjdGlvbiA9PSAncmlnaHQnO1xuICAgICAgICBjb25zdCBpc1ZlcnRpY2FsTmF2aWdhdGlvbiA9IGRpcmVjdGlvbiA9PSAndXAnIHx8IGRpcmVjdGlvbiA9PSAnZG93bic7XG4gICAgICAgIC8vIElmIG9iamVjdCBlbGVtZW50IGlzIHNlbGVjdGVkLlxuICAgICAgICBpZiAob2JqZWN0RWxlbWVudCAmJiBzY2hlbWEuaXNPYmplY3Qob2JqZWN0RWxlbWVudCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gaXNGb3J3YXJkID8gbW9kZWxTZWxlY3Rpb24uZ2V0TGFzdFBvc2l0aW9uKCkgOiBtb2RlbFNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBuZXdSYW5nZSA9IHNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2UocG9zaXRpb24sIGlzRm9yd2FyZCA/ICdmb3J3YXJkJyA6ICdiYWNrd2FyZCcpO1xuICAgICAgICAgICAgaWYgKG5ld1JhbmdlKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24obmV3UmFuZ2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50SW5mby5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gSGFuZGxlIGNvbGxhcHNpbmcgb2YgdGhlIHNlbGVjdGlvbiB3aGVuIHRoZXJlIGlzIGFueSB3aWRnZXQgb24gdGhlIGVkZ2Ugb2Ygc2VsZWN0aW9uLlxuICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBiZWNhdXNlIGJyb3dzZXJzIGhhdmUgcHJvYmxlbXMgd2l0aCBjb2xsYXBzaW5nIHN1Y2ggc2VsZWN0aW9uLlxuICAgICAgICBpZiAoIW1vZGVsU2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmICFkb21FdmVudERhdGEuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0UG9zaXRpb24gPSBtb2RlbFNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBsYXN0UG9zaXRpb24gPSBtb2RlbFNlbGVjdGlvbi5nZXRMYXN0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0U2VsZWN0ZWROb2RlID0gZmlyc3RQb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgICAgICAgICBjb25zdCBsYXN0U2VsZWN0ZWROb2RlID0gbGFzdFBvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgICAgICBpZiAoZmlyc3RTZWxlY3RlZE5vZGUgJiYgc2NoZW1hLmlzT2JqZWN0KGZpcnN0U2VsZWN0ZWROb2RlKSB8fCBsYXN0U2VsZWN0ZWROb2RlICYmIHNjaGVtYS5pc09iamVjdChsYXN0U2VsZWN0ZWROb2RlKSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKGlzRm9yd2FyZCA/IGxhc3RQb3NpdGlvbiA6IGZpcnN0UG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50SW5mby5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0dXJuIGlmIG5vdCBjb2xsYXBzZWQuXG4gICAgICAgIGlmICghbW9kZWxTZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBzZWxlY3Rpb24gaXMgbmV4dCB0byBvYmplY3QgZWxlbWVudC5cbiAgICAgICAgY29uc3Qgb2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbiA9IHRoaXMuX2dldE9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24oaXNGb3J3YXJkKTtcbiAgICAgICAgaWYgKG9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24gJiYgc2NoZW1hLmlzT2JqZWN0KG9iamVjdEVsZW1lbnROZXh0VG9TZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICAvLyBEbyBub3Qgc2VsZWN0IGFuIGlubGluZSB3aWRnZXQgd2hpbGUgaGFuZGxpbmcgdXAvZG93biBhcnJvdy5cbiAgICAgICAgICAgIGlmIChzY2hlbWEuaXNJbmxpbmUob2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbikgJiYgaXNWZXJ0aWNhbE5hdmlnYXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9zZXRTZWxlY3Rpb25PdmVyRWxlbWVudChvYmplY3RFbGVtZW50TmV4dFRvU2VsZWN0aW9uKTtcbiAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXZlbnRJbmZvLnN0b3AoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmtleWRvd24ga2V5ZG93bn0gZXZlbnRzIGFuZCBwcmV2ZW50c1xuXHQgKiB0aGUgZGVmYXVsdCBicm93c2VyIGJlaGF2aW9yIHRvIG1ha2Ugc3VyZSB0aGUgZmFrZSBzZWxlY3Rpb24gaXMgbm90IGJlaW5nIG1vdmVkIGZyb20gYSBmYWtlIHNlbGVjdGlvblxuXHQgKiBjb250YWluZXIuXG5cdCAqXG5cdCAqIFNlZSB7QGxpbmsgI19oYW5kbGVTZWxlY3Rpb25DaGFuZ2VPbkFycm93S2V5UHJlc3N9LlxuXHQgKi8gX3ByZXZlbnREZWZhdWx0T25BcnJvd0tleVByZXNzKGV2ZW50SW5mbywgZG9tRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3Qgb2JqZWN0RWxlbWVudCA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICAgICAgLy8gSWYgb2JqZWN0IGVsZW1lbnQgaXMgc2VsZWN0ZWQuXG4gICAgICAgIGlmIChvYmplY3RFbGVtZW50ICYmIHNjaGVtYS5pc09iamVjdChvYmplY3RFbGVtZW50KSkge1xuICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldmVudEluZm8uc3RvcCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIYW5kbGVzIGRlbGV0ZSBrZXlzOiBiYWNrc3BhY2UgYW5kIGRlbGV0ZS5cblx0ICpcblx0ICogQHBhcmFtIGlzRm9yd2FyZCBTZXQgdG8gdHJ1ZSBpZiBkZWxldGUgd2FzIHBlcmZvcm1lZCBpbiBmb3J3YXJkIGRpcmVjdGlvbi5cblx0ICogQHJldHVybnMgUmV0dXJucyBgdHJ1ZWAgaWYga2V5cyB3ZXJlIGhhbmRsZWQgY29ycmVjdGx5LlxuXHQgKi8gX2hhbmRsZURlbGV0ZShpc0ZvcndhcmQpIHtcbiAgICAgICAgY29uc3QgbW9kZWxEb2N1bWVudCA9IHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBtb2RlbFNlbGVjdGlvbiA9IG1vZGVsRG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAvLyBEbyBub3RoaW5nIHdoZW4gdGhlIHJlYWQgb25seSBtb2RlIGlzIGVuYWJsZWQuXG4gICAgICAgIGlmICghdGhpcy5lZGl0b3IubW9kZWwuY2FuRWRpdEF0KG1vZGVsU2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvIG5vdGhpbmcgb24gbm9uLWNvbGxhcHNlZCBzZWxlY3Rpb24uXG4gICAgICAgIGlmICghbW9kZWxTZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvYmplY3RFbGVtZW50ID0gdGhpcy5fZ2V0T2JqZWN0RWxlbWVudE5leHRUb1NlbGVjdGlvbihpc0ZvcndhcmQpO1xuICAgICAgICBpZiAob2JqZWN0RWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5lZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgbGV0IHByZXZpb3VzTm9kZSA9IG1vZGVsU2VsZWN0aW9uLmFuY2hvci5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHByZXZpb3VzIGVsZW1lbnQgaWYgZW1wdHkuXG4gICAgICAgICAgICAgICAgd2hpbGUocHJldmlvdXNOb2RlLmlzRW1wdHkpe1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBub2RlVG9SZW1vdmUgPSBwcmV2aW91c05vZGU7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzTm9kZSA9IG5vZGVUb1JlbW92ZS5wYXJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmUobm9kZVRvUmVtb3ZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0U2VsZWN0aW9uT3ZlckVsZW1lbnQob2JqZWN0RWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb24gZG9jdW1lbnQncyBzZWxlY3Rpb259IG92ZXIgZ2l2ZW4gZWxlbWVudC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfc2V0U2VsZWN0aW9uT3ZlckVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICB0aGlzLmVkaXRvci5tb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24od3JpdGVyLmNyZWF0ZVJhbmdlT24oZWxlbWVudCkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9lbGVtZW50fkVsZW1lbnQgZWxlbWVudH0gcGxhY2VkIG5leHQgdG8gdGhlIGN1cnJlbnRcblx0ICoge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvc2VsZWN0aW9uflNlbGVjdGlvbiBtb2RlbCBzZWxlY3Rpb259IGV4aXN0cyBhbmQgaXMgbWFya2VkIGluXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NjaGVtYX5TY2hlbWEgc2NoZW1hfSBhcyBgb2JqZWN0YC5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqIEBwYXJhbSBmb3J3YXJkIERpcmVjdGlvbiBvZiBjaGVja2luZy5cblx0ICovIF9nZXRPYmplY3RFbGVtZW50TmV4dFRvU2VsZWN0aW9uKGZvcndhcmQpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCBtb2RlbFNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgLy8gQ2xvbmUgY3VycmVudCBzZWxlY3Rpb24gdG8gdXNlIGl0IGFzIGEgcHJvYmUuIFdlIG11c3QgbGVhdmUgZGVmYXVsdCBzZWxlY3Rpb24gYXMgaXQgaXMgc28gaXQgY2FuIHJldHVyblxuICAgICAgICAvLyB0byBpdHMgY3VycmVudCBzdGF0ZSBhZnRlciB1bmRvLlxuICAgICAgICBjb25zdCBwcm9iZSA9IG1vZGVsLmNyZWF0ZVNlbGVjdGlvbihtb2RlbFNlbGVjdGlvbik7XG4gICAgICAgIG1vZGVsLm1vZGlmeVNlbGVjdGlvbihwcm9iZSwge1xuICAgICAgICAgICAgZGlyZWN0aW9uOiBmb3J3YXJkID8gJ2ZvcndhcmQnIDogJ2JhY2t3YXJkJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlIHNlbGVjdGlvbiBkaWRuJ3QgY2hhbmdlIHNvIHRoZXJlIGlzIG5vdGhpbmcgdGhlcmUuXG4gICAgICAgIGlmIChwcm9iZS5pc0VxdWFsKG1vZGVsU2VsZWN0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2JqZWN0RWxlbWVudCA9IGZvcndhcmQgPyBwcm9iZS5mb2N1cy5ub2RlQmVmb3JlIDogcHJvYmUuZm9jdXMubm9kZUFmdGVyO1xuICAgICAgICBpZiAoISFvYmplY3RFbGVtZW50ICYmIHNjaGVtYS5pc09iamVjdChvYmplY3RFbGVtZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuIG9iamVjdEVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZW1vdmVzIENTUyBjbGFzcyBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgd2lkZ2V0cy5cblx0ICovIF9jbGVhclByZXZpb3VzbHlTZWxlY3RlZFdpZGdldHMod3JpdGVyKSB7XG4gICAgICAgIGZvciAoY29uc3Qgd2lkZ2V0IG9mIHRoaXMuX3ByZXZpb3VzbHlTZWxlY3RlZCl7XG4gICAgICAgICAgICB3cml0ZXIucmVtb3ZlQ2xhc3MoV0lER0VUX1NFTEVDVEVEX0NMQVNTX05BTUUsIHdpZGdldCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcHJldmlvdXNseVNlbGVjdGVkLmNsZWFyKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNb3ZlcyB0aGUgZG9jdW1lbnQgc2VsZWN0aW9uIGludG8gdGhlIGZpcnN0IG5lc3RlZCBlZGl0YWJsZS5cblx0ICovIF9zZWxlY3RGaXJzdE5lc3RlZEVkaXRhYmxlKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuZWRpdG9yLmVkaXRpbmcudmlldztcbiAgICAgICAgY29uc3Qgdmlld0RvY3VtZW50ID0gdmlldy5kb2N1bWVudDtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHZpZXdEb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpLmdldEl0ZW1zKCkpe1xuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VkaXRhYmxlRWxlbWVudCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kZWxFbGVtZW50ID0gZWRpdG9yLmVkaXRpbmcubWFwcGVyLnRvTW9kZWxFbGVtZW50KGl0ZW0pO1xuICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyBpZiAoIW1vZGVsRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBlZGl0b3IubW9kZWwuY3JlYXRlUG9zaXRpb25BdChtb2RlbEVsZW1lbnQsIDApO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1JhbmdlID0gZWRpdG9yLm1vZGVsLnNjaGVtYS5nZXROZWFyZXN0U2VsZWN0aW9uUmFuZ2UocG9zaXRpb24sICdmb3J3YXJkJyk7XG4gICAgICAgICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1JhbmdlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBVcGRhdGVzIHRoZSBkb2N1bWVudCBzZWxlY3Rpb24gc28gdGhhdCBpdCBzZWxlY3RzIGZpcnN0IGFuY2VzdG9yIHdpZGdldC5cblx0ICovIF9zZWxlY3RBbmNlc3RvcldpZGdldCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1hcHBlciA9IGVkaXRvci5lZGl0aW5nLm1hcHBlcjtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKS5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50RWxlbWVudCA9IHBvc2l0aW9uUGFyZW50LmlzKCckdGV4dCcpID8gcG9zaXRpb25QYXJlbnQucGFyZW50IDogcG9zaXRpb25QYXJlbnQ7XG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gcG9zaXRpb25QYXJlbnRFbGVtZW50LmZpbmRBbmNlc3Rvcihpc1dpZGdldCk7XG4gICAgICAgIGlmICghdmlld0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb2RlbEVsZW1lbnQgPSBtYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld0VsZW1lbnQpO1xuICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAtLSBAcHJlc2VydmUgKi8gaWYgKCFtb2RlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICB3cml0ZXIuc2V0U2VsZWN0aW9uKG1vZGVsRWxlbWVudCwgJ29uJyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG4vKipcbiAqIEZpbmRzIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVsZW1lbnQgdGhhdCBpcyBlaXRoZXIgYW4gZWRpdGFibGUgZWxlbWVudCBvciBhIHdpZGdldC5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBUaGUgZWxlbWVudCBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZy5cbiAqIEByZXR1cm5zIFRoZSBjbG9zZXN0IGFuY2VzdG9yIGVsZW1lbnQgdGhhdCBpcyBlaXRoZXIgYW4gZWRpdGFibGUgZWxlbWVudCBvciBhIHdpZGdldCwgb3IgbnVsbCBpZiBub25lIGlzIGZvdW5kLlxuICovIGZ1bmN0aW9uIGZpbmRDbG9zZXN0RWRpdGFibGVPcldpZGdldEFuY2VzdG9yKGVsZW1lbnQpIHtcbiAgICBsZXQgY3VycmVudEVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHdoaWxlKGN1cnJlbnRFbGVtZW50KXtcbiAgICAgICAgaWYgKGN1cnJlbnRFbGVtZW50LmlzKCdlZGl0YWJsZUVsZW1lbnQnKSB8fCBpc1dpZGdldChjdXJyZW50RWxlbWVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50RWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIFJldHJpZXZlcyB0aGUgVmlld0VsZW1lbnQgYXNzb2NpYXRlZCB3aXRoIGEgbW91c2UgZXZlbnQgaW4gdGhlIGVkaXRpbmcgdmlldy5cbiAqXG4gKiBAcGFyYW0gdmlldyBUaGUgZWRpdGluZyB2aWV3LlxuICogQHBhcmFtIGRvbUV2ZW50RGF0YSBUaGUgRE9NIGV2ZW50IGRhdGEgY29udGFpbmluZyB0aGUgbW91c2UgZXZlbnQuXG4gKiBAcmV0dXJucyBUaGUgVmlld0VsZW1lbnQgYXNzb2NpYXRlZCB3aXRoIHRoZSBtb3VzZSBldmVudCwgb3IgbnVsbCBpZiBub3QgZm91bmQuXG4gKi8gZnVuY3Rpb24gZ2V0RWxlbWVudEZyb21Nb3VzZUV2ZW50KHZpZXcsIGRvbUV2ZW50RGF0YSkge1xuICAgIGNvbnN0IGRvbVJhbmdlID0gZ2V0UmFuZ2VGcm9tTW91c2VFdmVudChkb21FdmVudERhdGEuZG9tRXZlbnQpO1xuICAgIGxldCB2aWV3UmFuZ2UgPSBudWxsO1xuICAgIGlmIChkb21SYW5nZSkge1xuICAgICAgICB2aWV3UmFuZ2UgPSB2aWV3LmRvbUNvbnZlcnRlci5kb21SYW5nZVRvVmlldyhkb21SYW5nZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmFsbGJhY2sgdG8gY3JlYXRlIHJhbmdlIGluIHRhcmdldCBlbGVtZW50LiBJdCBoYXBwZW5zIGZyZXF1ZW50bHkgb24gU2FmYXJpIGJyb3dzZXIuXG4gICAgICAgIC8vIFNlZSBtb3JlOiBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xNjk3OFxuICAgICAgICB2aWV3UmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlKHZpZXcuY3JlYXRlUG9zaXRpb25BdChkb21FdmVudERhdGEudGFyZ2V0LCAwKSk7XG4gICAgfVxuICAgIGlmICghdmlld1JhbmdlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB2aWV3UG9zaXRpb24gPSB2aWV3UmFuZ2Uuc3RhcnQ7XG4gICAgaWYgKCF2aWV3UG9zaXRpb24ucGFyZW50KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBsZXQgdmlld05vZGUgPSB2aWV3UG9zaXRpb24ucGFyZW50O1xuICAgIGlmICh2aWV3UG9zaXRpb24ucGFyZW50LmlzKCdlZGl0YWJsZUVsZW1lbnQnKSkge1xuICAgICAgICBpZiAodmlld1Bvc2l0aW9uLmlzQXRFbmQgJiYgdmlld1Bvc2l0aW9uLm5vZGVCZWZvcmUpIHtcbiAgICAgICAgICAgIC8vIENsaWNrIGFmdGVyIGEgd2lkZ2V0IHRlbmQgdG8gcmV0dXJuIHBvc2l0aW9uIGF0IHRoZSBlbmQgb2YgdGhlIGVkaXRhYmxlIGVsZW1lbnRcbiAgICAgICAgICAgIC8vIHNvIHVzZSB0aGUgbm9kZSBiZWZvcmUgaXQgaWYgcmFuZ2UgaXMgYXQgdGhlIGVuZCBvZiBhIHBhcmVudC5cbiAgICAgICAgICAgIHZpZXdOb2RlID0gdmlld1Bvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgIH0gZWxzZSBpZiAodmlld1Bvc2l0aW9uLmlzQXRTdGFydCAmJiB2aWV3UG9zaXRpb24ubm9kZUFmdGVyKSB7XG4gICAgICAgICAgICAvLyBDbGljayBiZWZvcmUgYSB3aWRnZXQgdGVuZCB0byByZXR1cm4gcG9zaXRpb24gYXQgdGhlIHN0YXJ0IG9mIHRoZSBlZGl0YWJsZSBlbGVtZW50XG4gICAgICAgICAgICAvLyBzbyB1c2UgdGhlIG5vZGUgYWZ0ZXIgaXQgaWYgcmFuZ2UgaXMgYXQgdGhlIHN0YXJ0IG9mIGEgcGFyZW50LlxuICAgICAgICAgICAgLy8gU2VlIG1vcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE2OTkyXG4gICAgICAgICAgICB2aWV3Tm9kZSA9IHZpZXdQb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHZpZXdOb2RlLmlzKCckdGV4dCcpKSB7XG4gICAgICAgIHJldHVybiB2aWV3Tm9kZS5wYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiB2aWV3Tm9kZTtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHNwZWNpZmllZCBgZWxlbWVudGAgaXMgYSBjaGlsZCBvZiB0aGUgYHBhcmVudGAgZWxlbWVudC5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudCBBbiBlbGVtZW50IHRvIGNoZWNrLlxuICogQHBhcmFtIHBhcmVudCBBIHBhcmVudCBmb3IgdGhlIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gaXNDaGlsZChlbGVtZW50LCBwYXJlbnQpIHtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBBcnJheS5mcm9tKGVsZW1lbnQuZ2V0QW5jZXN0b3JzKCkpLmluY2x1ZGVzKHBhcmVudCk7XG59XG4vKipcbiAqIFJldHVybnMgbmVhcmVzdCB0ZXh0IGJsb2NrIGFuY2VzdG9yLlxuICovIGZ1bmN0aW9uIGZpbmRUZXh0QmxvY2tBbmNlc3Rvcihtb2RlbEVsZW1lbnQsIHNjaGVtYSkge1xuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBtb2RlbEVsZW1lbnQuZ2V0QW5jZXN0b3JzKHtcbiAgICAgICAgaW5jbHVkZVNlbGY6IHRydWUsXG4gICAgICAgIHBhcmVudEZpcnN0OiB0cnVlXG4gICAgfSkpe1xuICAgICAgICBpZiAoc2NoZW1hLmNoZWNrQ2hpbGQoZWxlbWVudCwgJyR0ZXh0JykpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIC8vIERvIG5vdCBnbyBiZXlvbmQgbmVzdGVkIGVkaXRhYmxlLlxuICAgICAgICBpZiAoc2NoZW1hLmlzTGltaXQoZWxlbWVudCkgJiYgIXNjaGVtYS5pc09iamVjdChlbGVtZW50KSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIFJldHVybnMgbmV4dCB0ZXh0IGJsb2NrIHdoZXJlIGNvdWxkIHB1dCBzZWxlY3Rpb24uXG4gKi8gZnVuY3Rpb24gZmluZE5leHRUZXh0QmxvY2socG9zaXRpb24sIHNjaGVtYSkge1xuICAgIGNvbnN0IHRyZWVXYWxrZXIgPSBuZXcgVHJlZVdhbGtlcih7XG4gICAgICAgIHN0YXJ0UG9zaXRpb246IHBvc2l0aW9uXG4gICAgfSk7XG4gICAgZm9yIChjb25zdCB7IGl0ZW0gfSBvZiB0cmVlV2Fsa2VyKXtcbiAgICAgICAgaWYgKHNjaGVtYS5pc0xpbWl0KGl0ZW0pIHx8ICFpdGVtLmlzKCdlbGVtZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzY2hlbWEuY2hlY2tDaGlsZChpdGVtLCAnJHRleHQnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogV2lkZ2V0IHRvb2xiYXIgcmVwb3NpdG9yeSBwbHVnaW4uIEEgY2VudHJhbCBwb2ludCBmb3IgcmVnaXN0ZXJpbmcgd2lkZ2V0IHRvb2xiYXJzLiBUaGlzIHBsdWdpbiBoYW5kbGVzIHRoZSB3aG9sZVxuICogdG9vbGJhciByZW5kZXJpbmcgcHJvY2VzcyBhbmQgZXhwb3NlcyBhIGNvbmNpc2UgQVBJLlxuICpcbiAqIFRvIGFkZCBhIHRvb2xiYXIgZm9yIHlvdXIgd2lkZ2V0IHVzZSB0aGUge0BsaW5rIH5XaWRnZXRUb29sYmFyUmVwb3NpdG9yeSNyZWdpc3RlciBgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkjcmVnaXN0ZXIoKWB9IG1ldGhvZC5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgY29tZXMgZnJvbSB0aGUge0BsaW5rIG1vZHVsZTppbWFnZS9pbWFnZXRvb2xiYXJ+SW1hZ2VUb29sYmFyfSBwbHVnaW46XG4gKlxuICogYGBgdHNcbiAqIGNsYXNzIEltYWdlVG9vbGJhciBleHRlbmRzIFBsdWdpbiB7XG4gKiBcdHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gKiBcdFx0cmV0dXJuIFsgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkgXTtcbiAqIFx0fVxuICpcbiAqIFx0YWZ0ZXJJbml0KCkge1xuICogXHRcdGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICogXHRcdGNvbnN0IHdpZGdldFRvb2xiYXJSZXBvc2l0b3J5ID0gZWRpdG9yLnBsdWdpbnMuZ2V0KCBXaWRnZXRUb29sYmFyUmVwb3NpdG9yeSApO1xuICpcbiAqIFx0XHR3aWRnZXRUb29sYmFyUmVwb3NpdG9yeS5yZWdpc3RlciggJ2ltYWdlJywge1xuICogXHRcdFx0aXRlbXM6IGVkaXRvci5jb25maWcuZ2V0KCAnaW1hZ2UudG9vbGJhcicgKSxcbiAqIFx0XHRcdGdldFJlbGF0ZWRFbGVtZW50OiBnZXRDbG9zZXN0U2VsZWN0ZWRJbWFnZVdpZGdldFxuICogXHRcdH0gKTtcbiAqIFx0fVxuICogfVxuICogYGBgXG4gKi8gY2xhc3MgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBBIG1hcCBvZiB0b29sYmFyIGRlZmluaXRpb25zLlxuXHQgKi8gX3Rvb2xiYXJEZWZpbml0aW9ucyA9IG5ldyBNYXAoKTtcbiAgICBfYmFsbG9vbjtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBDb250ZXh0dWFsQmFsbG9vblxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdXaWRnZXRUb29sYmFyUmVwb3NpdG9yeSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgLy8gRGlzYWJsZXMgdGhlIGRlZmF1bHQgYmFsbG9vbiB0b29sYmFyIGZvciBhbGwgd2lkZ2V0cy5cbiAgICAgICAgaWYgKGVkaXRvci5wbHVnaW5zLmhhcygnQmFsbG9vblRvb2xiYXInKSkge1xuICAgICAgICAgICAgY29uc3QgYmFsbG9vblRvb2xiYXIgPSBlZGl0b3IucGx1Z2lucy5nZXQoJ0JhbGxvb25Ub29sYmFyJyk7XG4gICAgICAgICAgICB0aGlzLmxpc3RlblRvKGJhbGxvb25Ub29sYmFyLCAnc2hvdycsIChldnQpPT57XG4gICAgICAgICAgICAgICAgaWYgKGlzV2lkZ2V0U2VsZWN0ZWQoZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2JhbGxvb24gPSB0aGlzLmVkaXRvci5wbHVnaW5zLmdldCgnQ29udGV4dHVhbEJhbGxvb24nKTtcbiAgICAgICAgdGhpcy5vbignY2hhbmdlOmlzRW5hYmxlZCcsICgpPT57XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUb29sYmFyc1Zpc2liaWxpdHkoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLnVpLCAndXBkYXRlJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRvb2xiYXJzVmlzaWJpbGl0eSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVUkjdXBkYXRlIGlzIG5vdCBmaXJlZCBhZnRlciBmb2N1cyBpcyBiYWNrIGluIGVkaXRvciwgd2UgbmVlZCB0byBjaGVjayBpZiBiYWxsb29uIHBhbmVsIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRvci51aS5mb2N1c1RyYWNrZXIsICdjaGFuZ2U6aXNGb2N1c2VkJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVRvb2xiYXJzVmlzaWJpbGl0eSgpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgZm9yIChjb25zdCB0b29sYmFyQ29uZmlnIG9mIHRoaXMuX3Rvb2xiYXJEZWZpbml0aW9ucy52YWx1ZXMoKSl7XG4gICAgICAgICAgICB0b29sYmFyQ29uZmlnLnZpZXcuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgdG9vbGJhciBpbiB0aGUgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnkuIEl0IHJlbmRlcnMgaXQgaW4gdGhlIGBDb250ZXh0dWFsQmFsbG9vbmAgYmFzZWQgb24gdGhlIHZhbHVlIG9mIHRoZSBpbnZva2VkXG5cdCAqIGBnZXRSZWxhdGVkRWxlbWVudGAgZnVuY3Rpb24uIFRvb2xiYXIgaXRlbXMgYXJlIGdhdGhlcmVkIGZyb20gYGl0ZW1zYCBhcnJheS5cblx0ICogVGhlIGJhbGxvb24ncyBDU1MgY2xhc3MgaXMgYnkgZGVmYXVsdCBgY2stdG9vbGJhci1jb250YWluZXJgIGFuZCBtYXkgYmUgb3ZlcnJpZGUgd2l0aCB0aGUgYGJhbGxvb25DbGFzc05hbWVgIG9wdGlvbi5cblx0ICpcblx0ICogTm90ZTogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBpbiB0aGUge0BsaW5rIG1vZHVsZTpjb3JlL3BsdWdpbn5QbHVnaW5JbnRlcmZhY2UjYWZ0ZXJJbml0IGBQbHVnaW4jYWZ0ZXJJbml0KClgfVxuXHQgKiBjYWxsYmFjayAob3IgbGF0ZXIpIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBnaXZlbiB0b29sYmFyIGl0ZW1zIHdlcmUgYWxyZWFkeSByZWdpc3RlcmVkIGJ5IG90aGVyIHBsdWdpbnMuXG5cdCAqXG5cdCAqIEBwYXJhbSB0b29sYmFySWQgQW4gaWQgZm9yIHRoZSB0b29sYmFyLiBVc2VkIHRvXG5cdCAqIEBwYXJhbSBvcHRpb25zLmFyaWFMYWJlbCBMYWJlbCB1c2VkIGJ5IGFzc2lzdGl2ZSB0ZWNobm9sb2dpZXMgdG8gZGVzY3JpYmUgdGhpcyB0b29sYmFyIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLml0ZW1zIEFycmF5IG9mIHRvb2xiYXIgaXRlbXMuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmdldFJlbGF0ZWRFbGVtZW50IENhbGxiYWNrIHdoaWNoIHJldHVybnMgYW4gZWxlbWVudCB0aGUgdG9vbGJhciBzaG91bGQgYmUgYXR0YWNoZWQgdG8uXG5cdCAqIEBwYXJhbSBvcHRpb25zLmJhbGxvb25DbGFzc05hbWUgQ1NTIGNsYXNzIGZvciB0aGUgd2lkZ2V0IGJhbGxvb24uXG5cdCAqLyByZWdpc3Rlcih0b29sYmFySWQsIHsgYXJpYUxhYmVsLCBpdGVtcywgZ2V0UmVsYXRlZEVsZW1lbnQsIGJhbGxvb25DbGFzc05hbWUgPSAnY2stdG9vbGJhci1jb250YWluZXInIH0pIHtcbiAgICAgICAgLy8gVHJ5aW5nIHRvIHJlZ2lzdGVyIGEgdG9vbGJhciB3aXRob3V0IGFueSBpdGVtLlxuICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBXaGVuIHtAbGluayBtb2R1bGU6d2lkZ2V0L3dpZGdldHRvb2xiYXJyZXBvc2l0b3J5fldpZGdldFRvb2xiYXJSZXBvc2l0b3J5I3JlZ2lzdGVyIHJlZ2lzdGVyaW5nfSBhIG5ldyB3aWRnZXQgdG9vbGJhciwgeW91XG5cdFx0XHQgKiBuZWVkIHRvIHByb3ZpZGUgYSBub24tZW1wdHkgYXJyYXkgd2l0aCB0aGUgaXRlbXMgdGhhdCB3aWxsIGJlIGluc2VydGVkIGludG8gdGhlIHRvb2xiYXIuXG5cdFx0XHQgKlxuXHRcdFx0ICogSWYgeW91IHNlZSB0aGlzIGVycm9yIHdoZW4gaW50ZWdyYXRpbmcgdGhlIGVkaXRvciwgeW91IGxpa2VseSBmb3Jnb3QgdG8gY29uZmlndXJlIG9uZSBvZiB0aGUgd2lkZ2V0IHRvb2xiYXJzLlxuXHRcdFx0ICpcblx0XHRcdCAqIFNlZSBmb3IgaW5zdGFuY2U6XG5cdFx0XHQgKlxuXHRcdFx0ICogKiB7QGxpbmsgbW9kdWxlOnRhYmxlL3RhYmxlY29uZmlnflRhYmxlQ29uZmlnI2NvbnRlbnRUb29sYmFyIGBjb25maWcudGFibGUuY29udGVudFRvb2xiYXJgfVxuXHRcdFx0ICogKiB7QGxpbmsgbW9kdWxlOmltYWdlL2ltYWdlY29uZmlnfkltYWdlQ29uZmlnI3Rvb2xiYXIgYGNvbmZpZy5pbWFnZS50b29sYmFyYH1cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3Igd2lkZ2V0LXRvb2xiYXItbm8taXRlbXNcblx0XHRcdCAqIEBwYXJhbSB0b29sYmFySWQgVGhlIGlkIG9mIHRoZSB0b29sYmFyIHRoYXQgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQgY29ycmVjdGx5LlxuXHRcdFx0ICovIGxvZ1dhcm5pbmcoJ3dpZGdldC10b29sYmFyLW5vLWl0ZW1zJywge1xuICAgICAgICAgICAgICAgIHRvb2xiYXJJZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IHQgPSBlZGl0b3IudDtcbiAgICAgICAgY29uc3QgdG9vbGJhclZpZXcgPSBuZXcgVG9vbGJhclZpZXcoZWRpdG9yLmxvY2FsZSk7XG4gICAgICAgIHRvb2xiYXJWaWV3LmFyaWFMYWJlbCA9IGFyaWFMYWJlbCB8fCB0KCdXaWRnZXQgdG9vbGJhcicpO1xuICAgICAgICBpZiAodGhpcy5fdG9vbGJhckRlZmluaXRpb25zLmhhcyh0b29sYmFySWQpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRvb2xiYXIgd2l0aCB0aGUgZ2l2ZW4gaWQgd2FzIGFscmVhZHkgYWRkZWQuXG5cdFx0XHQgKlxuXHRcdFx0ICogQGVycm9yIHdpZGdldC10b29sYmFyLWR1cGxpY2F0ZWRcblx0XHRcdCAqIEBwYXJhbSB0b29sYmFySWQgVG9vbGJhciBpZC5cblx0XHRcdCAqLyB0aHJvdyBuZXcgQ0tFZGl0b3JFcnJvcignd2lkZ2V0LXRvb2xiYXItZHVwbGljYXRlZCcsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICB0b29sYmFySWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRvb2xiYXJEZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgdmlldzogdG9vbGJhclZpZXcsXG4gICAgICAgICAgICBnZXRSZWxhdGVkRWxlbWVudCxcbiAgICAgICAgICAgIGJhbGxvb25DbGFzc05hbWUsXG4gICAgICAgICAgICBpdGVtc0NvbmZpZzogaXRlbXMsXG4gICAgICAgICAgICBpbml0aWFsaXplZDogZmFsc2VcbiAgICAgICAgfTtcbiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIHRvb2xiYXIgc28gaXQgYmVjb21lcyBhdmFpbGFibGUgZm9yIEFsdCtGMTAgYW5kIEVzYyBuYXZpZ2F0aW9uLlxuICAgICAgICBlZGl0b3IudWkuYWRkVG9vbGJhcih0b29sYmFyVmlldywge1xuICAgICAgICAgICAgaXNDb250ZXh0dWFsOiB0cnVlLFxuICAgICAgICAgICAgYmVmb3JlRm9jdXM6ICgpPT57XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsYXRlZEVsZW1lbnQgPSBnZXRSZWxhdGVkRWxlbWVudChlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0ZWRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dUb29sYmFyKHRvb2xiYXJEZWZpbml0aW9uLCByZWxhdGVkRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFmdGVyQmx1cjogKCk9PntcbiAgICAgICAgICAgICAgICB0aGlzLl9oaWRlVG9vbGJhcih0b29sYmFyRGVmaW5pdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90b29sYmFyRGVmaW5pdGlvbnMuc2V0KHRvb2xiYXJJZCwgdG9vbGJhckRlZmluaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogSXRlcmF0ZXMgb3ZlciBzdG9yZWQgdG9vbGJhcnMgYW5kIG1ha2VzIHRoZW0gdmlzaWJsZSBvciBoaWRkZW4uXG5cdCAqLyBfdXBkYXRlVG9vbGJhcnNWaXNpYmlsaXR5KCkge1xuICAgICAgICBsZXQgbWF4UmVsYXRlZEVsZW1lbnREZXB0aCA9IDA7XG4gICAgICAgIGxldCBkZWVwZXN0UmVsYXRlZEVsZW1lbnQgPSBudWxsO1xuICAgICAgICBsZXQgZGVlcGVzdFRvb2xiYXJEZWZpbml0aW9uID0gbnVsbDtcbiAgICAgICAgZm9yIChjb25zdCBkZWZpbml0aW9uIG9mIHRoaXMuX3Rvb2xiYXJEZWZpbml0aW9ucy52YWx1ZXMoKSl7XG4gICAgICAgICAgICBjb25zdCByZWxhdGVkRWxlbWVudCA9IGRlZmluaXRpb24uZ2V0UmVsYXRlZEVsZW1lbnQodGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbik7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNFbmFibGVkIHx8ICFyZWxhdGVkRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1Rvb2xiYXJJbkJhbGxvb24oZGVmaW5pdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZVRvb2xiYXIoZGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5lZGl0b3IudWkuZm9jdXNUcmFja2VyLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1Rvb2xiYXJWaXNpYmxlKGRlZmluaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVUb29sYmFyKGRlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsYXRlZEVsZW1lbnREZXB0aCA9IHJlbGF0ZWRFbGVtZW50LmdldEFuY2VzdG9ycygpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAvLyBNYW55IHRvb2xiYXJzIGNhbiBleHByZXNzIHdpbGxpbmduZXNzIHRvIGJlIGRpc3BsYXllZCBidXQgdGhleSBkbyBub3Qga25vdyBhYm91dFxuICAgICAgICAgICAgICAgIC8vIGVhY2ggb3RoZXIuIEZpZ3VyZSBvdXQgd2hpY2ggdG9vbGJhciBpcyBkZWVwZXN0IGluIHRoZSB2aWV3IHRyZWUgdG8gZGVjaWRlIHdoaWNoXG4gICAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGRpc3BsYXllZC4gRm9yIGluc3RhbmNlLCBpZiBhIHNlbGVjdGVkIGltYWdlIGlzIGluc2lkZSBhIHRhYmxlIGNlbGwsIGRpc3BsYXlcbiAgICAgICAgICAgICAgICAvLyB0aGUgSW1hZ2VUb29sYmFyIHJhdGhlciB0aGFuIHRoZSBUYWJsZVRvb2xiYXIgKCM2MCkuXG4gICAgICAgICAgICAgICAgaWYgKHJlbGF0ZWRFbGVtZW50RGVwdGggPiBtYXhSZWxhdGVkRWxlbWVudERlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIG1heFJlbGF0ZWRFbGVtZW50RGVwdGggPSByZWxhdGVkRWxlbWVudERlcHRoO1xuICAgICAgICAgICAgICAgICAgICBkZWVwZXN0UmVsYXRlZEVsZW1lbnQgPSByZWxhdGVkRWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgZGVlcGVzdFRvb2xiYXJEZWZpbml0aW9uID0gZGVmaW5pdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRlZXBlc3RUb29sYmFyRGVmaW5pdGlvbikge1xuICAgICAgICAgICAgdGhpcy5fc2hvd1Rvb2xiYXIoZGVlcGVzdFRvb2xiYXJEZWZpbml0aW9uLCBkZWVwZXN0UmVsYXRlZEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIaWRlcyB0aGUgZ2l2ZW4gdG9vbGJhci5cblx0ICovIF9oaWRlVG9vbGJhcih0b29sYmFyRGVmaW5pdGlvbikge1xuICAgICAgICB0aGlzLl9iYWxsb29uLnJlbW92ZSh0b29sYmFyRGVmaW5pdGlvbi52aWV3KTtcbiAgICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKHRoaXMuX2JhbGxvb24sICdjaGFuZ2U6dmlzaWJsZVZpZXcnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFNob3dzIHVwIHRoZSB0b29sYmFyIGlmIHRoZSB0b29sYmFyIGlzIG5vdCB2aXNpYmxlLlxuXHQgKiBPdGhlcndpc2UsIHJlcG9zaXRpb25zIHRoZSB0b29sYmFyJ3MgYmFsbG9vbiB3aGVuIHRvb2xiYXIncyB2aWV3IGlzIHRoZSBtb3N0IHRvcCB2aWV3IGluIGJhbGxvb24gc3RhY2suXG5cdCAqXG5cdCAqIEl0IG1pZ2h0IGhhcHBlbiBoZXJlIHRoYXQgdGhlIHRvb2xiYXIncyB2aWV3IGlzIHVuZGVyIGFub3RoZXIgdmlldy4gVGhlbiBkbyBub3RoaW5nIGFzIHRoZSBvdGhlciB0b29sYmFyIHZpZXdcblx0ICogc2hvdWxkIGJlIHN0aWxsIHZpc2libGUgYWZ0ZXIgdGhlIHtAbGluayBtb2R1bGU6dWkvZWRpdG9ydWkvZWRpdG9ydWl+RWRpdG9yVUkjZXZlbnQ6dXBkYXRlfS5cblx0ICovIF9zaG93VG9vbGJhcih0b29sYmFyRGVmaW5pdGlvbiwgcmVsYXRlZEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzVG9vbGJhclZpc2libGUodG9vbGJhckRlZmluaXRpb24pKSB7XG4gICAgICAgICAgICByZXBvc2l0aW9uQ29udGV4dHVhbEJhbGxvb24odGhpcy5lZGl0b3IsIHJlbGF0ZWRFbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5faXNUb29sYmFySW5CYWxsb29uKHRvb2xiYXJEZWZpbml0aW9uKSkge1xuICAgICAgICAgICAgaWYgKCF0b29sYmFyRGVmaW5pdGlvbi5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgIHRvb2xiYXJEZWZpbml0aW9uLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0b29sYmFyRGVmaW5pdGlvbi52aWV3LmZpbGxGcm9tQ29uZmlnKHRvb2xiYXJEZWZpbml0aW9uLml0ZW1zQ29uZmlnLCB0aGlzLmVkaXRvci51aS5jb21wb25lbnRGYWN0b3J5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2JhbGxvb24uYWRkKHtcbiAgICAgICAgICAgICAgICB2aWV3OiB0b29sYmFyRGVmaW5pdGlvbi52aWV3LFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBnZXRCYWxsb29uUG9zaXRpb25EYXRhKHRoaXMuZWRpdG9yLCByZWxhdGVkRWxlbWVudCksXG4gICAgICAgICAgICAgICAgYmFsbG9vbkNsYXNzTmFtZTogdG9vbGJhckRlZmluaXRpb24uYmFsbG9vbkNsYXNzTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdG9vbGJhciBwb3NpdGlvbiBlYWNoIHRpbWUgc3RhY2sgd2l0aCB0b29sYmFyIHZpZXcgaXMgc3dpdGNoZWQgdG8gdmlzaWJsZS5cbiAgICAgICAgICAgIC8vIFRoaXMgaXMgaW4gYSBjYXNlIHRhcmdldCBlbGVtZW50IGhhcyBjaGFuZ2VkIHdoZW4gdG9vbGJhciB3YXMgaW4gaW52aXNpYmxlIHN0YWNrXG4gICAgICAgICAgICAvLyBlLmcuIHRhcmdldCBpbWFnZSB3YXMgd3JhcHBlZCBieSBhIGJsb2NrIHF1b3RlLlxuICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUtd2lkZ2V0L2lzc3Vlcy85Mi5cbiAgICAgICAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5fYmFsbG9vbiwgJ2NoYW5nZTp2aXNpYmxlVmlldycsICgpPT57XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBkZWZpbml0aW9uIG9mIHRoaXMuX3Rvb2xiYXJEZWZpbml0aW9ucy52YWx1ZXMoKSl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1Rvb2xiYXJWaXNpYmxlKGRlZmluaXRpb24pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWxhdGVkRWxlbWVudCA9IGRlZmluaXRpb24uZ2V0UmVsYXRlZEVsZW1lbnQodGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXBvc2l0aW9uQ29udGV4dHVhbEJhbGxvb24odGhpcy5lZGl0b3IsIHJlbGF0ZWRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9pc1Rvb2xiYXJWaXNpYmxlKHRvb2xiYXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JhbGxvb24udmlzaWJsZVZpZXcgPT09IHRvb2xiYXIudmlldztcbiAgICB9XG4gICAgX2lzVG9vbGJhckluQmFsbG9vbih0b29sYmFyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9iYWxsb29uLmhhc1ZpZXcodG9vbGJhci52aWV3KTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXBvc2l0aW9uQ29udGV4dHVhbEJhbGxvb24oZWRpdG9yLCByZWxhdGVkRWxlbWVudCkge1xuICAgIGNvbnN0IGJhbGxvb24gPSBlZGl0b3IucGx1Z2lucy5nZXQoJ0NvbnRleHR1YWxCYWxsb29uJyk7XG4gICAgY29uc3QgcG9zaXRpb24gPSBnZXRCYWxsb29uUG9zaXRpb25EYXRhKGVkaXRvciwgcmVsYXRlZEVsZW1lbnQpO1xuICAgIGJhbGxvb24udXBkYXRlUG9zaXRpb24ocG9zaXRpb24pO1xufVxuZnVuY3Rpb24gZ2V0QmFsbG9vblBvc2l0aW9uRGF0YShlZGl0b3IsIHJlbGF0ZWRFbGVtZW50KSB7XG4gICAgY29uc3QgZWRpdGluZ1ZpZXcgPSBlZGl0b3IuZWRpdGluZy52aWV3O1xuICAgIGNvbnN0IGRlZmF1bHRQb3NpdGlvbnMgPSBCYWxsb29uUGFuZWxWaWV3LmRlZmF1bHRQb3NpdGlvbnM7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0OiBlZGl0aW5nVmlldy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKHJlbGF0ZWRFbGVtZW50KSxcbiAgICAgICAgcG9zaXRpb25zOiBbXG4gICAgICAgICAgICBkZWZhdWx0UG9zaXRpb25zLm5vcnRoQXJyb3dTb3V0aCxcbiAgICAgICAgICAgIGRlZmF1bHRQb3NpdGlvbnMubm9ydGhBcnJvd1NvdXRoV2VzdCxcbiAgICAgICAgICAgIGRlZmF1bHRQb3NpdGlvbnMubm9ydGhBcnJvd1NvdXRoRWFzdCxcbiAgICAgICAgICAgIGRlZmF1bHRQb3NpdGlvbnMuc291dGhBcnJvd05vcnRoLFxuICAgICAgICAgICAgZGVmYXVsdFBvc2l0aW9ucy5zb3V0aEFycm93Tm9ydGhXZXN0LFxuICAgICAgICAgICAgZGVmYXVsdFBvc2l0aW9ucy5zb3V0aEFycm93Tm9ydGhFYXN0LFxuICAgICAgICAgICAgZGVmYXVsdFBvc2l0aW9ucy52aWV3cG9ydFN0aWNreU5vcnRoXG4gICAgICAgIF1cbiAgICB9O1xufVxuZnVuY3Rpb24gaXNXaWRnZXRTZWxlY3RlZChzZWxlY3Rpb24pIHtcbiAgICBjb25zdCB2aWV3RWxlbWVudCA9IHNlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICByZXR1cm4gISEodmlld0VsZW1lbnQgJiYgaXNXaWRnZXQodmlld0VsZW1lbnQpKTtcbn1cblxuLyoqXG4gKiBTdG9yZXMgdGhlIGludGVybmFsIHN0YXRlIG9mIGEgc2luZ2xlIHJlc2l6YWJsZSBvYmplY3QuXG4gKi8gY2xhc3MgUmVzaXplU3RhdGUgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gT2JzZXJ2YWJsZU1peGluKCkge1xuICAgIC8qKlxuXHQgKiBUaGUgcmVmZXJlbmNlIHBvaW50IG9mIHRoZSByZXNpemVyIHdoZXJlIHRoZSBkcmFnZ2luZyBzdGFydGVkLiBJdCBpcyB1c2VkIHRvIG1lYXN1cmUgdGhlIGRpc3RhbmNlIHRoZSB1c2VyIGN1cnNvclxuXHQgKiB0cmF2ZWxlZCwgc28gaG93IG11Y2ggdGhlIGltYWdlIHNob3VsZCBiZSBlbmxhcmdlZC5cblx0ICogVGhpcyBpbmZvcm1hdGlvbiBpcyBvbmx5IGtub3duIGFmdGVyIHRoZSBET00gd2FzIHJlbmRlcmVkLCBzbyBpdCB3aWxsIGJlIHVwZGF0ZWQgbGF0ZXIuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKi8gX3JlZmVyZW5jZUNvb3JkaW5hdGVzO1xuICAgIC8qKlxuXHQgKiBSZXNpemVyIG9wdGlvbnMuXG5cdCAqLyBfb3B0aW9ucztcbiAgICAvKipcblx0ICogVGhlIG9yaWdpbmFsIHdpZHRoIChwaXhlbHMpIG9mIHRoZSByZXNpemVkIG9iamVjdCB3aGVuIHRoZSByZXNpemUgcHJvY2VzcyB3YXMgc3RhcnRlZC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqLyBfb3JpZ2luYWxXaWR0aDtcbiAgICAvKipcblx0ICogVGhlIG9yaWdpbmFsIGhlaWdodCAocGl4ZWxzKSBvZiB0aGUgcmVzaXplZCBvYmplY3Qgd2hlbiB0aGUgcmVzaXplIHByb2Nlc3Mgd2FzIHN0YXJ0ZWQuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gX29yaWdpbmFsSGVpZ2h0O1xuICAgIC8qKlxuXHQgKiBUaGUgb3JpZ2luYWwgd2lkdGggKHBlcmNlbnRzKSBvZiB0aGUgcmVzaXplZCBvYmplY3Qgd2hlbiB0aGUgcmVzaXplIHByb2Nlc3Mgd2FzIHN0YXJ0ZWQuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gX29yaWdpbmFsV2lkdGhQZXJjZW50cztcbiAgICAvKipcblx0ICogQSB3aWR0aCB0byBoZWlnaHQgcmF0aW8gb2YgdGhlIHJlc2l6ZWQgaW1hZ2UuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gX2FzcGVjdFJhdGlvO1xuICAgIC8qKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBSZXNpemVyIG9wdGlvbnMuXG5cdCAqLyBjb25zdHJ1Y3RvcihvcHRpb25zKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zZXQoJ2FjdGl2ZUhhbmRsZVBvc2l0aW9uJywgbnVsbCk7XG4gICAgICAgIHRoaXMuc2V0KCdwcm9wb3NlZFdpZHRoUGVyY2VudHMnLCBudWxsKTtcbiAgICAgICAgdGhpcy5zZXQoJ3Byb3Bvc2VkV2lkdGgnLCBudWxsKTtcbiAgICAgICAgdGhpcy5zZXQoJ3Byb3Bvc2VkSGVpZ2h0JywgbnVsbCk7XG4gICAgICAgIHRoaXMuc2V0KCdwcm9wb3NlZEhhbmRsZUhvc3RXaWR0aCcsIG51bGwpO1xuICAgICAgICB0aGlzLnNldCgncHJvcG9zZWRIYW5kbGVIb3N0SGVpZ2h0JywgbnVsbCk7XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLl9yZWZlcmVuY2VDb29yZGluYXRlcyA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBUaGUgb3JpZ2luYWwgd2lkdGggKHBpeGVscykgb2YgdGhlIHJlc2l6ZWQgb2JqZWN0IHdoZW4gdGhlIHJlc2l6ZSBwcm9jZXNzIHdhcyBzdGFydGVkLlxuXHQgKi8gZ2V0IG9yaWdpbmFsV2lkdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW5hbFdpZHRoO1xuICAgIH1cbiAgICAvKipcblx0ICogVGhlIG9yaWdpbmFsIGhlaWdodCAocGl4ZWxzKSBvZiB0aGUgcmVzaXplZCBvYmplY3Qgd2hlbiB0aGUgcmVzaXplIHByb2Nlc3Mgd2FzIHN0YXJ0ZWQuXG5cdCAqLyBnZXQgb3JpZ2luYWxIZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW5hbEhlaWdodDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFRoZSBvcmlnaW5hbCB3aWR0aCAocGVyY2VudHMpIG9mIHRoZSByZXNpemVkIG9iamVjdCB3aGVuIHRoZSByZXNpemUgcHJvY2VzcyB3YXMgc3RhcnRlZC5cblx0ICovIGdldCBvcmlnaW5hbFdpZHRoUGVyY2VudHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW5hbFdpZHRoUGVyY2VudHM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBIHdpZHRoIHRvIGhlaWdodCByYXRpbyBvZiB0aGUgcmVzaXplZCBpbWFnZS5cblx0ICovIGdldCBhc3BlY3RSYXRpbygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FzcGVjdFJhdGlvO1xuICAgIH1cbiAgICAvKipcblx0ICpcblx0ICogQHBhcmFtIGRvbVJlc2l6ZUhhbmRsZSBUaGUgaGFuZGxlIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSByZWZlcmVuY2UgcG9pbnQuXG5cdCAqLyBiZWdpbihkb21SZXNpemVIYW5kbGUsIGRvbUhhbmRsZUhvc3QsIGRvbVJlc2l6ZUhvc3QpIHtcbiAgICAgICAgY29uc3QgY2xpZW50UmVjdCA9IG5ldyBSZWN0KGRvbUhhbmRsZUhvc3QpO1xuICAgICAgICB0aGlzLmFjdGl2ZUhhbmRsZVBvc2l0aW9uID0gZ2V0SGFuZGxlUG9zaXRpb24oZG9tUmVzaXplSGFuZGxlKTtcbiAgICAgICAgdGhpcy5fcmVmZXJlbmNlQ29vcmRpbmF0ZXMgPSBnZXRBYnNvbHV0ZUJvdW5kYXJ5UG9pbnQoZG9tSGFuZGxlSG9zdCwgZ2V0T3Bwb3NpdGVQb3NpdGlvbih0aGlzLmFjdGl2ZUhhbmRsZVBvc2l0aW9uKSk7XG4gICAgICAgIHRoaXMuX29yaWdpbmFsV2lkdGggPSBjbGllbnRSZWN0LndpZHRoO1xuICAgICAgICB0aGlzLl9vcmlnaW5hbEhlaWdodCA9IGNsaWVudFJlY3QuaGVpZ2h0O1xuICAgICAgICB0aGlzLl9hc3BlY3RSYXRpbyA9IGNsaWVudFJlY3Qud2lkdGggLyBjbGllbnRSZWN0LmhlaWdodDtcbiAgICAgICAgY29uc3Qgd2lkdGhTdHlsZSA9IGRvbVJlc2l6ZUhvc3Quc3R5bGUud2lkdGg7XG4gICAgICAgIGlmICh3aWR0aFN0eWxlICYmIHdpZHRoU3R5bGUubWF0Y2goL15cXGQrKFxcLlxcZCopPyUkLykpIHtcbiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsV2lkdGhQZXJjZW50cyA9IHBhcnNlRmxvYXQod2lkdGhTdHlsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9vcmlnaW5hbFdpZHRoUGVyY2VudHMgPSBjYWxjdWxhdGVSZXNpemVIb3N0UGVyY2VudGFnZVdpZHRoKGRvbVJlc2l6ZUhvc3QsIGNsaWVudFJlY3QpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVwZGF0ZShuZXdTaXplKSB7XG4gICAgICAgIHRoaXMucHJvcG9zZWRXaWR0aCA9IG5ld1NpemUud2lkdGg7XG4gICAgICAgIHRoaXMucHJvcG9zZWRIZWlnaHQgPSBuZXdTaXplLmhlaWdodDtcbiAgICAgICAgdGhpcy5wcm9wb3NlZFdpZHRoUGVyY2VudHMgPSBuZXdTaXplLndpZHRoUGVyY2VudHM7XG4gICAgICAgIHRoaXMucHJvcG9zZWRIYW5kbGVIb3N0V2lkdGggPSBuZXdTaXplLmhhbmRsZUhvc3RXaWR0aDtcbiAgICAgICAgdGhpcy5wcm9wb3NlZEhhbmRsZUhvc3RIZWlnaHQgPSBuZXdTaXplLmhhbmRsZUhvc3RIZWlnaHQ7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGNvb3JkaW5hdGVzIG9mIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgYW4gZWxlbWVudCwgcmVsYXRpdmUgdG8gdGhlIGRvY3VtZW50J3MgdG9wLWxlZnQgY29ybmVyLlxuICpcbiAqIEBwYXJhbSByZXNpemVyUG9zaXRpb24gVGhlIHBvc2l0aW9uIG9mIHRoZSByZXNpemUgaGFuZGxlLCBlLmcuIGBcInRvcC1sZWZ0XCJgLCBgXCJib3R0b20tcmlnaHRcImAuXG4gKi8gZnVuY3Rpb24gZ2V0QWJzb2x1dGVCb3VuZGFyeVBvaW50KGVsZW1lbnQsIHJlc2l6ZXJQb3NpdGlvbikge1xuICAgIGNvbnN0IGVsZW1lbnRSZWN0ID0gbmV3IFJlY3QoZWxlbWVudCk7XG4gICAgY29uc3QgcG9zaXRpb25QYXJ0cyA9IHJlc2l6ZXJQb3NpdGlvbi5zcGxpdCgnLScpO1xuICAgIGNvbnN0IHJldCA9IHtcbiAgICAgICAgeDogcG9zaXRpb25QYXJ0c1sxXSA9PSAncmlnaHQnID8gZWxlbWVudFJlY3QucmlnaHQgOiBlbGVtZW50UmVjdC5sZWZ0LFxuICAgICAgICB5OiBwb3NpdGlvblBhcnRzWzBdID09ICdib3R0b20nID8gZWxlbWVudFJlY3QuYm90dG9tIDogZWxlbWVudFJlY3QudG9wXG4gICAgfTtcbiAgICByZXQueCArPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuc2Nyb2xsWDtcbiAgICByZXQueSArPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuc2Nyb2xsWTtcbiAgICByZXR1cm4gcmV0O1xufVxuLyoqXG4gKiBAcGFyYW0gcmVzaXplclBvc2l0aW9uIFRoZSBleHBlY3RlZCByZXNpemVyIHBvc2l0aW9uLCBsaWtlIGBcInRvcC1sZWZ0XCJgLCBgXCJib3R0b20tcmlnaHRcImAuXG4gKiBAcmV0dXJucyBBIHByZWZpeGVkIEhUTUwgY2xhc3MgbmFtZSBmb3IgdGhlIHJlc2l6ZXIgZWxlbWVudC5cbiAqLyBmdW5jdGlvbiBnZXRSZXNpemVySGFuZGxlQ2xhc3MocmVzaXplclBvc2l0aW9uKSB7XG4gICAgcmV0dXJuIGBjay13aWRnZXRfX3Jlc2l6ZXJfX2hhbmRsZS0ke3Jlc2l6ZXJQb3NpdGlvbn1gO1xufVxuLyoqXG4gKiBEZXRlcm1pbmVzIHRoZSBwb3NpdGlvbiBvZiBhIGdpdmVuIHJlc2l6ZSBoYW5kbGUuXG4gKlxuICogQHBhcmFtIGRvbUhhbmRsZSBIYW5kbGUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIHJlZmVyZW5jZSBwb2ludC5cbiAqIEByZXR1cm5zIFJldHVybnMgYSBzdHJpbmcgbGlrZSBgXCJ0b3AtbGVmdFwiYCBvciBgdW5kZWZpbmVkYCBpZiBub3QgbWF0Y2hlZC5cbiAqLyBmdW5jdGlvbiBnZXRIYW5kbGVQb3NpdGlvbihkb21IYW5kbGUpIHtcbiAgICBjb25zdCByZXNpemVyUG9zaXRpb25zID0gW1xuICAgICAgICAndG9wLWxlZnQnLFxuICAgICAgICAndG9wLXJpZ2h0JyxcbiAgICAgICAgJ2JvdHRvbS1yaWdodCcsXG4gICAgICAgICdib3R0b20tbGVmdCdcbiAgICBdO1xuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgcmVzaXplclBvc2l0aW9ucyl7XG4gICAgICAgIGlmIChkb21IYW5kbGUuY2xhc3NMaXN0LmNvbnRhaW5zKGdldFJlc2l6ZXJIYW5kbGVDbGFzcyhwb3NpdGlvbikpKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIEBwYXJhbSBwb3NpdGlvbiBMaWtlIGBcInRvcC1sZWZ0XCJgLlxuICogQHJldHVybnMgSW52ZXJ0ZWQgYHBvc2l0aW9uYCwgZS5nLiBpdCByZXR1cm5zIGBcImJvdHRvbS1yaWdodFwiYCBpZiBgXCJ0b3AtbGVmdFwiYCB3YXMgZ2l2ZW4gYXMgYHBvc2l0aW9uYC5cbiAqLyBmdW5jdGlvbiBnZXRPcHBvc2l0ZVBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgY29uc3QgcGFydHMgPSBwb3NpdGlvbi5zcGxpdCgnLScpO1xuICAgIGNvbnN0IHJlcGxhY2VtZW50cyA9IHtcbiAgICAgICAgdG9wOiAnYm90dG9tJyxcbiAgICAgICAgYm90dG9tOiAndG9wJyxcbiAgICAgICAgbGVmdDogJ3JpZ2h0JyxcbiAgICAgICAgcmlnaHQ6ICdsZWZ0J1xuICAgIH07XG4gICAgcmV0dXJuIGAke3JlcGxhY2VtZW50c1twYXJ0c1swXV19LSR7cmVwbGFjZW1lbnRzW3BhcnRzWzFdXX1gO1xufVxuXG4vKipcbiAqIEEgdmlldyBkaXNwbGF5aW5nIHRoZSBwcm9wb3NlZCBuZXcgZWxlbWVudCBzaXplIGR1cmluZyB0aGUgcmVzaXppbmcuXG4gKi8gY2xhc3MgU2l6ZVZpZXcgZXh0ZW5kcyBWaWV3IHtcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBjb25zdCBiaW5kID0gdGhpcy5iaW5kVGVtcGxhdGU7XG4gICAgICAgIHRoaXMuc2V0VGVtcGxhdGUoe1xuICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICBjbGFzczogW1xuICAgICAgICAgICAgICAgICAgICAnY2snLFxuICAgICAgICAgICAgICAgICAgICAnY2stc2l6ZS12aWV3JyxcbiAgICAgICAgICAgICAgICAgICAgYmluZC50bygnX3ZpZXdQb3NpdGlvbicsICh2YWx1ZSk9PnZhbHVlID8gYGNrLW9yaWVudGF0aW9uLSR7dmFsdWV9YCA6ICcnKVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmluZC5pZignX2lzVmlzaWJsZScsICdub25lJywgKHZpc2libGUpPT4hdmlzaWJsZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGJpbmQudG8oJ19sYWJlbCcpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEEgbWV0aG9kIHVzZWQgZm9yIGJpbmRpbmcgdGhlIGBTaXplVmlld2AgaW5zdGFuY2UgcHJvcGVydGllcyB0byB0aGUgYFJlc2l6ZVN0YXRlYCBpbnN0YW5jZSBvYnNlcnZhYmxlIHByb3BlcnRpZXMuXG5cdCAqXG5cdCAqIEBpbnRlcm5hbFxuXHQgKiBAcGFyYW0gb3B0aW9ucyBBbiBvYmplY3QgZGVmaW5pbmcgdGhlIHJlc2l6ZXIgb3B0aW9ucywgdXNlZCBmb3Igc2V0dGluZyB0aGUgcHJvcGVyIHNpemUgbGFiZWwuXG5cdCAqIEBwYXJhbSByZXNpemVTdGF0ZSBUaGUgYFJlc2l6ZVN0YXRlYCBjbGFzcyBpbnN0YW5jZSwgdXNlZCBmb3Iga2VlcGluZyB0aGUgYFNpemVWaWV3YCBzdGF0ZSB1cCB0byBkYXRlLlxuXHQgKi8gX2JpbmRUb1N0YXRlKG9wdGlvbnMsIHJlc2l6ZVN0YXRlKSB7XG4gICAgICAgIHRoaXMuYmluZCgnX2lzVmlzaWJsZScpLnRvKHJlc2l6ZVN0YXRlLCAncHJvcG9zZWRXaWR0aCcsIHJlc2l6ZVN0YXRlLCAncHJvcG9zZWRIZWlnaHQnLCAod2lkdGgsIGhlaWdodCk9PndpZHRoICE9PSBudWxsICYmIGhlaWdodCAhPT0gbnVsbCk7XG4gICAgICAgIHRoaXMuYmluZCgnX2xhYmVsJykudG8ocmVzaXplU3RhdGUsICdwcm9wb3NlZEhhbmRsZUhvc3RXaWR0aCcsIHJlc2l6ZVN0YXRlLCAncHJvcG9zZWRIYW5kbGVIb3N0SGVpZ2h0JywgcmVzaXplU3RhdGUsICdwcm9wb3NlZFdpZHRoUGVyY2VudHMnLCAod2lkdGgsIGhlaWdodCwgd2lkdGhQZXJjZW50cyk9PntcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnVuaXQgPT09ICdweCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7d2lkdGh9w5cke2hlaWdodH1gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7d2lkdGhQZXJjZW50c30lYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYmluZCgnX3ZpZXdQb3NpdGlvbicpLnRvKHJlc2l6ZVN0YXRlLCAnYWN0aXZlSGFuZGxlUG9zaXRpb24nLCByZXNpemVTdGF0ZSwgJ3Byb3Bvc2VkSGFuZGxlSG9zdFdpZHRoJywgcmVzaXplU3RhdGUsICdwcm9wb3NlZEhhbmRsZUhvc3RIZWlnaHQnLCAvLyBJZiB0aGUgd2lkZ2V0IGlzIHRvbyBzbWFsbCB0byBjb250YWluIHRoZSBzaXplIGxhYmVsLCBkaXNwbGF5IHRoZSBsYWJlbCBhYm92ZS5cbiAgICAgICAgKHBvc2l0aW9uLCB3aWR0aCwgaGVpZ2h0KT0+d2lkdGggPCA1MCB8fCBoZWlnaHQgPCA1MCA/ICdhYm92ZS1jZW50ZXInIDogcG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcblx0ICogQSBtZXRob2QgdXNlZCBmb3IgY2xlYW5pbmcgdXAuIEl0IHJlbW92ZXMgdGhlIGJpbmRpbmdzIGFuZCBoaWRlcyB0aGUgdmlldy5cblx0ICpcblx0ICogQGludGVybmFsXG5cdCAqLyBfZGlzbWlzcygpIHtcbiAgICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICAgICAgdGhpcy5faXNWaXNpYmxlID0gZmFsc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgYSByZXNpemVyIGZvciBhIHNpbmdsZSByZXNpemFibGUgb2JqZWN0LlxuICovIGNsYXNzIFJlc2l6ZXIgZXh0ZW5kcyAvKiAjX19QVVJFX18gKi8gT2JzZXJ2YWJsZU1peGluKCkge1xuICAgIC8qKlxuXHQgKiBTdG9yZXMgdGhlIHN0YXRlIG9mIHRoZSByZXNpemFibGUgaG9zdCBnZW9tZXRyeSwgc3VjaCBhcyB0aGUgb3JpZ2luYWwgd2lkdGgsIHRoZSBjdXJyZW50bHkgcHJvcG9zZWQgaGVpZ2h0LCBldGMuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCBhIG5ldyBzdGF0ZSBpcyBjcmVhdGVkIGZvciBlYWNoIHJlc2l6ZSB0cmFuc2FjdGlvbi5cblx0ICovIF9zdGF0ZTtcbiAgICAvKipcblx0ICogQSB2aWV3IGRpc3BsYXlpbmcgdGhlIHByb3Bvc2VkIG5ldyBlbGVtZW50IHNpemUgZHVyaW5nIHRoZSByZXNpemluZy5cblx0ICovIF9zaXplVmlldztcbiAgICAvKipcblx0ICogT3B0aW9ucyBwYXNzZWQgdG8gdGhlIHtAbGluayAjY29uc3RydWN0b3J9LlxuXHQgKi8gX29wdGlvbnM7XG4gICAgLyoqXG5cdCAqIEEgd3JhcHBlciB0aGF0IGlzIGNvbnRyb2xsZWQgYnkgdGhlIHJlc2l6ZXIuIFRoaXMgaXMgdXN1YWxseSBhIHdpZGdldCBlbGVtZW50LlxuXHQgKi8gX3ZpZXdSZXNpemVyV3JhcHBlciA9IG51bGw7XG4gICAgLyoqXG5cdCAqIFRoZSB3aWR0aCBvZiB0aGUgcmVzaXplZCB7QGxpbmsgbW9kdWxlOndpZGdldC93aWRnZXRyZXNpemV+UmVzaXplck9wdGlvbnMjdmlld0VsZW1lbnQgdmlld0VsZW1lbnR9IGJlZm9yZSB0aGUgcmVzaXppbmcgc3RhcnRlZC5cblx0ICovIF9pbml0aWFsVmlld1dpZHRoO1xuICAgIC8qKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBSZXNpemVyIG9wdGlvbnMuXG5cdCAqLyBjb25zdHJ1Y3RvcihvcHRpb25zKXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuc2V0KCdpc0VuYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgdGhpcy5zZXQoJ2lzU2VsZWN0ZWQnLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuYmluZCgnaXNWaXNpYmxlJykudG8odGhpcywgJ2lzRW5hYmxlZCcsIHRoaXMsICdpc1NlbGVjdGVkJywgKGlzRW5hYmxlZCwgaXNTZWxlY3RlZCk9PmlzRW5hYmxlZCAmJiBpc1NlbGVjdGVkKTtcbiAgICAgICAgdGhpcy5kZWNvcmF0ZSgnYmVnaW4nKTtcbiAgICAgICAgdGhpcy5kZWNvcmF0ZSgnY2FuY2VsJyk7XG4gICAgICAgIHRoaXMuZGVjb3JhdGUoJ2NvbW1pdCcpO1xuICAgICAgICB0aGlzLmRlY29yYXRlKCd1cGRhdGVTaXplJyk7XG4gICAgICAgIHRoaXMub24oJ2NvbW1pdCcsIChldmVudCk9PntcbiAgICAgICAgICAgIC8vIFN0YXRlIG1pZ2h0IG5vdCBiZSBpbml0aWFsaXplZCB5ZXQuIEluIHRoaXMgY2FzZSwgcHJldmVudCBmdXJ0aGVyIGhhbmRsaW5nIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgcmVzaXplciBpc1xuICAgICAgICAgICAgLy8gY2xlYW5lZCB1cCAoIzUxOTUpLlxuICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnByb3Bvc2VkV2lkdGggJiYgIXRoaXMuc3RhdGUucHJvcG9zZWRXaWR0aFBlcmNlbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2xlYW51cCgpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0b3JlcyB0aGUgc3RhdGUgb2YgdGhlIHJlc2l6YWJsZSBob3N0IGdlb21ldHJ5LCBzdWNoIGFzIHRoZSBvcmlnaW5hbCB3aWR0aCwgdGhlIGN1cnJlbnRseSBwcm9wb3NlZCBoZWlnaHQsIGV0Yy5cblx0ICpcblx0ICogTm90ZSB0aGF0IGEgbmV3IHN0YXRlIGlzIGNyZWF0ZWQgZm9yIGVhY2ggcmVzaXplIHRyYW5zYWN0aW9uLlxuXHQgKi8gZ2V0IHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYWtlcyByZXNpemVyIHZpc2libGUgaW4gdGhlIFVJLlxuXHQgKi8gc2hvdygpIHtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSB0aGlzLl9vcHRpb25zLmVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIGVkaXRpbmdWaWV3LmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUNsYXNzKCdjay1oaWRkZW4nLCB0aGlzLl92aWV3UmVzaXplcldyYXBwZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhpZGVzIHJlc2l6ZXIgaW4gdGhlIFVJLlxuXHQgKi8gaGlkZSgpIHtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSB0aGlzLl9vcHRpb25zLmVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIGVkaXRpbmdWaWV3LmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgd3JpdGVyLmFkZENsYXNzKCdjay1oaWRkZW4nLCB0aGlzLl92aWV3UmVzaXplcldyYXBwZXIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEF0dGFjaGVzIHRoZSByZXNpemVyIHRvIHRoZSBET00uXG5cdCAqLyBhdHRhY2goKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdGhpcy1hbGlhc1xuICAgICAgICBjb25zdCB0aGF0ID0gdGhpcztcbiAgICAgICAgY29uc3Qgd2lkZ2V0RWxlbWVudCA9IHRoaXMuX29wdGlvbnMudmlld0VsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGVkaXRpbmdWaWV3ID0gdGhpcy5fb3B0aW9ucy5lZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICBlZGl0aW5nVmlldy5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIGNvbnN0IHZpZXdSZXNpemVyV3JhcHBlciA9IHdyaXRlci5jcmVhdGVVSUVsZW1lbnQoJ2RpdicsIHtcbiAgICAgICAgICAgICAgICBjbGFzczogJ2NrIGNrLXJlc2V0X2FsbCBjay13aWRnZXRfX3Jlc2l6ZXInXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihkb21Eb2N1bWVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvbUVsZW1lbnQgPSB0aGlzLnRvRG9tRWxlbWVudChkb21Eb2N1bWVudCk7XG4gICAgICAgICAgICAgICAgdGhhdC5fYXBwZW5kSGFuZGxlcyhkb21FbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGF0Ll9hcHBlbmRTaXplVUkoZG9tRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvbUVsZW1lbnQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIEFwcGVuZCB0aGUgcmVzaXplciB3cmFwcGVyIHRvIHRoZSB3aWRnZXQncyB3cmFwcGVyLlxuICAgICAgICAgICAgd3JpdGVyLmluc2VydCh3cml0ZXIuY3JlYXRlUG9zaXRpb25BdCh3aWRnZXRFbGVtZW50LCAnZW5kJyksIHZpZXdSZXNpemVyV3JhcHBlcik7XG4gICAgICAgICAgICB3cml0ZXIuYWRkQ2xhc3MoJ2NrLXdpZGdldF93aXRoLXJlc2l6ZXInLCB3aWRnZXRFbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMuX3ZpZXdSZXNpemVyV3JhcHBlciA9IHZpZXdSZXNpemVyV3JhcHBlcjtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1Zpc2libGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24oJ2NoYW5nZTppc1Zpc2libGUnLCAoKT0+e1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogU3RhcnRzIHRoZSByZXNpemluZyBwcm9jZXNzLlxuXHQgKlxuXHQgKiBDcmVhdGVzIGEgbmV3IHtAbGluayAjc3RhdGV9IGZvciB0aGUgY3VycmVudCBwcm9jZXNzLlxuXHQgKlxuXHQgKiBAZmlyZXMgYmVnaW5cblx0ICogQHBhcmFtIGRvbVJlc2l6ZUhhbmRsZSBDbGlja2VkIGhhbmRsZS5cblx0ICovIGJlZ2luKGRvbVJlc2l6ZUhhbmRsZSkge1xuICAgICAgICB0aGlzLl9zdGF0ZSA9IG5ldyBSZXNpemVTdGF0ZSh0aGlzLl9vcHRpb25zKTtcbiAgICAgICAgdGhpcy5fc2l6ZVZpZXcuX2JpbmRUb1N0YXRlKHRoaXMuX29wdGlvbnMsIHRoaXMuc3RhdGUpO1xuICAgICAgICB0aGlzLl9pbml0aWFsVmlld1dpZHRoID0gdGhpcy5fb3B0aW9ucy52aWV3RWxlbWVudC5nZXRTdHlsZSgnd2lkdGgnKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5iZWdpbihkb21SZXNpemVIYW5kbGUsIHRoaXMuX2dldEhhbmRsZUhvc3QoKSwgdGhpcy5fZ2V0UmVzaXplSG9zdCgpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVwZGF0ZXMgdGhlIHByb3Bvc2VkIHNpemUgYmFzZWQgb24gYGRvbUV2ZW50RGF0YWAuXG5cdCAqXG5cdCAqIEBmaXJlcyB1cGRhdGVTaXplXG5cdCAqLyB1cGRhdGVTaXplKGRvbUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zdCBuZXdTaXplID0gdGhpcy5fcHJvcG9zZU5ld1NpemUoZG9tRXZlbnREYXRhKTtcbiAgICAgICAgY29uc3QgZWRpdGluZ1ZpZXcgPSB0aGlzLl9vcHRpb25zLmVkaXRvci5lZGl0aW5nLnZpZXc7XG4gICAgICAgIGVkaXRpbmdWaWV3LmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgdW5pdCA9IHRoaXMuX29wdGlvbnMudW5pdCB8fCAnJSc7XG4gICAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9ICh1bml0ID09PSAnJScgPyBuZXdTaXplLndpZHRoUGVyY2VudHMgOiBuZXdTaXplLndpZHRoKSArIHVuaXQ7XG4gICAgICAgICAgICB3cml0ZXIuc2V0U3R5bGUoJ3dpZHRoJywgbmV3V2lkdGgsIHRoaXMuX29wdGlvbnMudmlld0VsZW1lbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gR2V0IGFuIGFjdHVhbCBpbWFnZSB3aWR0aCwgYW5kOlxuICAgICAgICAvLyAqIHJlZmxlY3QgdGhpcyBzaXplIHRvIHRoZSByZXNpemUgd3JhcHBlclxuICAgICAgICAvLyAqIGFwcGx5IHRoaXMgKipyZWFsKiogc2l6ZSB0byB0aGUgc3RhdGVcbiAgICAgICAgY29uc3QgZG9tSGFuZGxlSG9zdCA9IHRoaXMuX2dldEhhbmRsZUhvc3QoKTtcbiAgICAgICAgY29uc3QgZG9tSGFuZGxlSG9zdFJlY3QgPSBuZXcgUmVjdChkb21IYW5kbGVIb3N0KTtcbiAgICAgICAgY29uc3QgaGFuZGxlSG9zdFdpZHRoID0gTWF0aC5yb3VuZChkb21IYW5kbGVIb3N0UmVjdC53aWR0aCk7XG4gICAgICAgIGNvbnN0IGhhbmRsZUhvc3RIZWlnaHQgPSBNYXRoLnJvdW5kKGRvbUhhbmRsZUhvc3RSZWN0LmhlaWdodCk7XG4gICAgICAgIC8vIEhhbmRsZSBtYXgtd2lkdGggbGltaXRhdGlvbi5cbiAgICAgICAgY29uc3QgZG9tUmVzaXplSG9zdFJlY3QgPSBuZXcgUmVjdChkb21IYW5kbGVIb3N0KTtcbiAgICAgICAgbmV3U2l6ZS53aWR0aCA9IE1hdGgucm91bmQoZG9tUmVzaXplSG9zdFJlY3Qud2lkdGgpO1xuICAgICAgICBuZXdTaXplLmhlaWdodCA9IE1hdGgucm91bmQoZG9tUmVzaXplSG9zdFJlY3QuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5yZWRyYXcoZG9tSGFuZGxlSG9zdFJlY3QpO1xuICAgICAgICB0aGlzLnN0YXRlLnVwZGF0ZSh7XG4gICAgICAgICAgICAuLi5uZXdTaXplLFxuICAgICAgICAgICAgaGFuZGxlSG9zdFdpZHRoLFxuICAgICAgICAgICAgaGFuZGxlSG9zdEhlaWdodFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEFwcGxpZXMgdGhlIGdlb21ldHJ5IHByb3Bvc2VkIHdpdGggdGhlIHJlc2l6ZXIuXG5cdCAqXG5cdCAqIEBmaXJlcyBjb21taXRcblx0ICovIGNvbW1pdCgpIHtcbiAgICAgICAgY29uc3QgdW5pdCA9IHRoaXMuX29wdGlvbnMudW5pdCB8fCAnJSc7XG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gKHVuaXQgPT09ICclJyA/IHRoaXMuc3RhdGUucHJvcG9zZWRXaWR0aFBlcmNlbnRzIDogdGhpcy5zdGF0ZS5wcm9wb3NlZFdpZHRoKSArIHVuaXQ7XG4gICAgICAgIC8vIEJvdGggY2xlYW51cCBhbmQgb25Db21taXQgY2FsbGJhY2sgYXJlIHZlcnkgbGlrZWx5IHRvIG1ha2UgdmlldyBjaGFuZ2VzLiBFbnN1cmUgdGhhdCBpdCBpcyBtYWRlIGluIGEgc2luZ2xlIHN0ZXAuXG4gICAgICAgIHRoaXMuX29wdGlvbnMuZWRpdG9yLmVkaXRpbmcudmlldy5jaGFuZ2UoKCk9PntcbiAgICAgICAgICAgIHRoaXMuX2NsZWFudXAoKTtcbiAgICAgICAgICAgIHRoaXMuX29wdGlvbnMub25Db21taXQobmV3VmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENhbmNlbHMgYW5kIHJlamVjdHMgdGhlIHByb3Bvc2VkIHJlc2l6ZSBkaW1lbnNpb25zLCBoaWRpbmcgdGhlIFVJLlxuXHQgKlxuXHQgKiBAZmlyZXMgY2FuY2VsXG5cdCAqLyBjYW5jZWwoKSB7XG4gICAgICAgIHRoaXMuX2NsZWFudXAoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERlc3Ryb3lzIHRoZSByZXNpemVyLlxuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5jYW5jZWwoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZHJhd3MgdGhlIHJlc2l6ZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVIb3N0UmVjdCBIYW5kbGUgaG9zdCByZWN0YW5nbGUgbWlnaHQgYmUgZ2l2ZW4gdG8gaW1wcm92ZSBwZXJmb3JtYW5jZS5cblx0ICovIHJlZHJhdyhoYW5kbGVIb3N0UmVjdCkge1xuICAgICAgICBjb25zdCBkb21XcmFwcGVyID0gdGhpcy5fZG9tUmVzaXplcldyYXBwZXI7XG4gICAgICAgIC8vIFJlZnJlc2ggb25seSBpZiByZXNpemVyIGV4aXN0cyBpbiB0aGUgRE9NLlxuICAgICAgICBpZiAoIWV4aXN0c0luRG9tKGRvbVdyYXBwZXIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd2lkZ2V0V3JhcHBlciA9IGRvbVdyYXBwZXIucGFyZW50RWxlbWVudDtcbiAgICAgICAgY29uc3QgaGFuZGxlSG9zdCA9IHRoaXMuX2dldEhhbmRsZUhvc3QoKTtcbiAgICAgICAgY29uc3QgcmVzaXplcldyYXBwZXIgPSB0aGlzLl92aWV3UmVzaXplcldyYXBwZXI7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREaW1lbnNpb25zID0gW1xuICAgICAgICAgICAgcmVzaXplcldyYXBwZXIuZ2V0U3R5bGUoJ3dpZHRoJyksXG4gICAgICAgICAgICByZXNpemVyV3JhcHBlci5nZXRTdHlsZSgnaGVpZ2h0JyksXG4gICAgICAgICAgICByZXNpemVyV3JhcHBlci5nZXRTdHlsZSgnbGVmdCcpLFxuICAgICAgICAgICAgcmVzaXplcldyYXBwZXIuZ2V0U3R5bGUoJ3RvcCcpXG4gICAgICAgIF07XG4gICAgICAgIGxldCBuZXdEaW1lbnNpb25zO1xuICAgICAgICBpZiAod2lkZ2V0V3JhcHBlci5pc1NhbWVOb2RlKGhhbmRsZUhvc3QpKSB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRSZWN0ID0gaGFuZGxlSG9zdFJlY3QgfHwgbmV3IFJlY3QoaGFuZGxlSG9zdCk7XG4gICAgICAgICAgICBuZXdEaW1lbnNpb25zID0gW1xuICAgICAgICAgICAgICAgIGNsaWVudFJlY3Qud2lkdGggKyAncHgnLFxuICAgICAgICAgICAgICAgIGNsaWVudFJlY3QuaGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkXG4gICAgICAgICAgICBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3RGltZW5zaW9ucyA9IFtcbiAgICAgICAgICAgICAgICBoYW5kbGVIb3N0Lm9mZnNldFdpZHRoICsgJ3B4JyxcbiAgICAgICAgICAgICAgICBoYW5kbGVIb3N0Lm9mZnNldEhlaWdodCArICdweCcsXG4gICAgICAgICAgICAgICAgaGFuZGxlSG9zdC5vZmZzZXRMZWZ0ICsgJ3B4JyxcbiAgICAgICAgICAgICAgICBoYW5kbGVIb3N0Lm9mZnNldFRvcCArICdweCdcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFrZSBjaGFuZ2VzIHRvIHRoZSB2aWV3IG9ubHkgaWYgdGhlIHJlc2l6ZXIgc2hvdWxkIGFjdHVhbGx5IGdldCBuZXcgZGltZW5zaW9ucy5cbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiBWaWV3I2NoYW5nZSgpIHdhcyBhbHdheXMgY2FsbGVkLCB0aGlzIHdvdWxkIGNhdXNlIEVkaXRvclVJI3VwZGF0ZVxuICAgICAgICAvLyBsb29wcyBiZWNhdXNlIHRoZSBXaWRnZXRSZXNpemUgcGx1Z2luIGxpc3RlbnMgdG8gRWRpdG9yVUkjdXBkYXRlIGFuZCB1cGRhdGVzXG4gICAgICAgIC8vIHRoZSByZXNpemVyLlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy83NjMzXG4gICAgICAgIGlmIChjb21wYXJlQXJyYXlzKGN1cnJlbnREaW1lbnNpb25zLCBuZXdEaW1lbnNpb25zKSAhPT0gJ3NhbWUnKSB7XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zLmVkaXRvci5lZGl0aW5nLnZpZXcuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldFN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG5ld0RpbWVuc2lvbnNbMF0sXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogbmV3RGltZW5zaW9uc1sxXSxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogbmV3RGltZW5zaW9uc1syXSxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBuZXdEaW1lbnNpb25zWzNdXG4gICAgICAgICAgICAgICAgfSwgcmVzaXplcldyYXBwZXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udGFpbnNIYW5kbGUoZG9tRWxlbWVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZG9tUmVzaXplcldyYXBwZXIuY29udGFpbnMoZG9tRWxlbWVudCk7XG4gICAgfVxuICAgIHN0YXRpYyBpc1Jlc2l6ZUhhbmRsZShkb21FbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBkb21FbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnY2std2lkZ2V0X19yZXNpemVyX19oYW5kbGUnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENsZWFucyB1cCB0aGUgY29udGV4dCBzdGF0ZS5cblx0ICovIF9jbGVhbnVwKCkge1xuICAgICAgICB0aGlzLl9zaXplVmlldy5fZGlzbWlzcygpO1xuICAgICAgICBjb25zdCBlZGl0aW5nVmlldyA9IHRoaXMuX29wdGlvbnMuZWRpdG9yLmVkaXRpbmcudmlldztcbiAgICAgICAgZWRpdGluZ1ZpZXcuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICB3cml0ZXIuc2V0U3R5bGUoJ3dpZHRoJywgdGhpcy5faW5pdGlhbFZpZXdXaWR0aCwgdGhpcy5fb3B0aW9ucy52aWV3RWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2FsY3VsYXRlcyB0aGUgcHJvcG9zZWQgc2l6ZSBhcyB0aGUgcmVzaXplIGhhbmRsZXMgYXJlIGRyYWdnZWQuXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21FdmVudERhdGEgRXZlbnQgZGF0YSB0aGF0IGNhdXNlZCB0aGUgc2l6ZSB1cGRhdGUgcmVxdWVzdC4gSXQgc2hvdWxkIGJlIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSBwcm9wb3NlZCBzaXplLlxuXHQgKi8gX3Byb3Bvc2VOZXdTaXplKGRvbUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb29yZGluYXRlcyA9IGV4dHJhY3RDb29yZGluYXRlcyhkb21FdmVudERhdGEpO1xuICAgICAgICBjb25zdCBpc0NlbnRlcmVkID0gdGhpcy5fb3B0aW9ucy5pc0NlbnRlcmVkID8gdGhpcy5fb3B0aW9ucy5pc0NlbnRlcmVkKHRoaXMpIDogdHJ1ZTtcbiAgICAgICAgLy8gRW5sYXJnZW1lbnQgZGVmaW5lcyBob3cgbXVjaCB0aGUgcmVzaXplIGhvc3QgaGFzIGNoYW5nZWQgaW4gYSBnaXZlbiBheGlzLiBOYXR1cmFsbHkgaXQgY291bGQgYmUgYSBuZWdhdGl2ZSBudW1iZXJcbiAgICAgICAgLy8gbWVhbmluZyB0aGF0IGl0IGhhcyBiZWVuIHNocnVuay5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gKy0tLS0tLS0tLS0tLS0tLS0rLS0rXG4gICAgICAgIC8vIHwgICAgICAgICAgICAgICAgfCAgfFxuICAgICAgICAvLyB8ICAgICAgIGltZyAgICAgIHwgIHxcbiAgICAgICAgLy8gfCAgL2hhbmRsZSBob3N0ICB8ICB8XG4gICAgICAgIC8vICstLS0tLS0tLS0tLS0tLS0tKyAgfCBeXG4gICAgICAgIC8vIHwgICAgICAgICAgICAgICAgICAgfCB8IC0gZW5sYXJnZSB5XG4gICAgICAgIC8vICstLS0tLS0tLS0tLS0tLS0tLS0tKyB2XG4gICAgICAgIC8vIFx0XHRcdFx0XHQ8LS0+XG4gICAgICAgIC8vIFx0XHRcdFx0XHQgZW5sYXJnZSB4XG4gICAgICAgIGNvbnN0IGVubGFyZ2VtZW50ID0ge1xuICAgICAgICAgICAgeDogc3RhdGUuX3JlZmVyZW5jZUNvb3JkaW5hdGVzLnggLSAoY3VycmVudENvb3JkaW5hdGVzLnggKyBzdGF0ZS5vcmlnaW5hbFdpZHRoKSxcbiAgICAgICAgICAgIHk6IGN1cnJlbnRDb29yZGluYXRlcy55IC0gc3RhdGUub3JpZ2luYWxIZWlnaHQgLSBzdGF0ZS5fcmVmZXJlbmNlQ29vcmRpbmF0ZXMueVxuICAgICAgICB9O1xuICAgICAgICBpZiAoaXNDZW50ZXJlZCAmJiBzdGF0ZS5hY3RpdmVIYW5kbGVQb3NpdGlvbi5lbmRzV2l0aCgnLXJpZ2h0JykpIHtcbiAgICAgICAgICAgIGVubGFyZ2VtZW50LnggPSBjdXJyZW50Q29vcmRpbmF0ZXMueCAtIChzdGF0ZS5fcmVmZXJlbmNlQ29vcmRpbmF0ZXMueCArIHN0YXRlLm9yaWdpbmFsV2lkdGgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE9iamVjdHMgbmVlZHMgdG8gYmUgcmVzaXplZCB0d2ljZSBhcyBtdWNoIGluIGhvcml6b250YWwgYXhpcyBpZiBjZW50ZXJlZCwgc2luY2UgZW5sYXJnZW1lbnQgaXMgY291bnRlZCBmcm9tXG4gICAgICAgIC8vIG9uZSByZXNpemVkIGNvcm5lciB0byB5b3VyIGN1cnNvci4gSXQgbmVlZHMgdG8gYmUgZHVwbGljYXRlZCB0byBjb21wZW5zYXRlIGZvciB0aGUgb3RoZXIgc2lkZSB0b28uXG4gICAgICAgIGlmIChpc0NlbnRlcmVkKSB7XG4gICAgICAgICAgICBlbmxhcmdlbWVudC54ICo9IDI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uc3QgcmVzaXplSG9zdCA9IHRoaXMuX2dldFJlc2l6ZUhvc3QoKTtcbiAgICAgICAgLy8gVGhlIHNpemUgcHJvcG9zZWQgYnkgdGhlIHVzZXIuIEl0IGRvZXMgbm90IGNvbnNpZGVyIHRoZSBhc3BlY3QgcmF0aW8uXG4gICAgICAgIGxldCB3aWR0aCA9IE1hdGguYWJzKHN0YXRlLm9yaWdpbmFsV2lkdGggKyBlbmxhcmdlbWVudC54KTtcbiAgICAgICAgbGV0IGhlaWdodCA9IE1hdGguYWJzKHN0YXRlLm9yaWdpbmFsSGVpZ2h0ICsgZW5sYXJnZW1lbnQueSk7XG4gICAgICAgIC8vIERvbWluYW50IGRldGVybWluYXRpb24gbXVzdCB0YWtlIHRoZSByYXRpbyBpbnRvIGFjY291bnQuXG4gICAgICAgIGNvbnN0IGRvbWluYW50ID0gd2lkdGggLyBzdGF0ZS5hc3BlY3RSYXRpbyA+IGhlaWdodCA/ICd3aWR0aCcgOiAnaGVpZ2h0JztcbiAgICAgICAgaWYgKGRvbWluYW50ID09ICd3aWR0aCcpIHtcbiAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoIC8gc3RhdGUuYXNwZWN0UmF0aW87XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aWR0aCA9IGhlaWdodCAqIHN0YXRlLmFzcGVjdFJhdGlvO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCh3aWR0aCksXG4gICAgICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQoaGVpZ2h0KSxcbiAgICAgICAgICAgIHdpZHRoUGVyY2VudHM6IE1hdGgubWluKE1hdGgucm91bmQoc3RhdGUub3JpZ2luYWxXaWR0aFBlcmNlbnRzIC8gc3RhdGUub3JpZ2luYWxXaWR0aCAqIHdpZHRoICogMTAwKSAvIDEwMCwgMTAwKVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcblx0ICogT2J0YWlucyB0aGUgcmVzaXplIGhvc3QuXG5cdCAqXG5cdCAqIFJlc2l6ZSBob3N0IGlzIGFuIG9iamVjdCB0aGF0IHJlY2VpdmVzIGRpbWVuc2lvbnMgd2hpY2ggYXJlIHRoZSByZXN1bHQgb2YgcmVzaXppbmcuXG5cdCAqLyBfZ2V0UmVzaXplSG9zdCgpIHtcbiAgICAgICAgY29uc3Qgd2lkZ2V0V3JhcHBlciA9IHRoaXMuX2RvbVJlc2l6ZXJXcmFwcGVyLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zLmdldFJlc2l6ZUhvc3Qod2lkZ2V0V3JhcHBlcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBPYnRhaW5zIHRoZSBoYW5kbGUgaG9zdC5cblx0ICpcblx0ICogSGFuZGxlIGhvc3QgaXMgYW4gb2JqZWN0IHRoYXQgdGhlIGhhbmRsZXMgYXJlIGFsaWduZWQgdG8uXG5cdCAqXG5cdCAqIEhhbmRsZSBob3N0IHdpbGwgbm90IGFsd2F5cyBiZSBhbiBlbnRpcmUgd2lkZ2V0IGl0c2VsZi4gVGFrZSBhbiBpbWFnZSBhcyBhbiBleGFtcGxlLiBUaGUgaW1hZ2Ugd2lkZ2V0XG5cdCAqIGNvbnRhaW5zIGFuIGltYWdlIGFuZCBhIGNhcHRpb24uIE9ubHkgdGhlIGltYWdlIHNob3VsZCBiZSBzdXJyb3VuZGVkIHdpdGggaGFuZGxlcy5cblx0ICovIF9nZXRIYW5kbGVIb3N0KCkge1xuICAgICAgICBjb25zdCB3aWRnZXRXcmFwcGVyID0gdGhpcy5fZG9tUmVzaXplcldyYXBwZXIucGFyZW50RWxlbWVudDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnMuZ2V0SGFuZGxlSG9zdCh3aWRnZXRXcmFwcGVyKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIERPTSBjb250YWluZXIgb2YgdGhlIGVudGlyZSByZXNpemUgVUkuXG5cdCAqXG5cdCAqIE5vdGUgdGhhdCB0aGlzIHByb3BlcnR5IHdpbGwgaGF2ZSBhIHZhbHVlIG9ubHkgYWZ0ZXIgdGhlIGVsZW1lbnQgYm91bmQgd2l0aCB0aGUgcmVzaXplciBpcyByZW5kZXJlZFxuXHQgKiAob3RoZXJ3aXNlIGBudWxsYCkuXG5cdCAqLyBnZXQgX2RvbVJlc2l6ZXJXcmFwcGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucy5lZGl0b3IuZWRpdGluZy52aWV3LmRvbUNvbnZlcnRlci5tYXBWaWV3VG9Eb20odGhpcy5fdmlld1Jlc2l6ZXJXcmFwcGVyKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbmRlcnMgdGhlIHJlc2l6ZSBoYW5kbGVzIGluIHRoZSBET00uXG5cdCAqXG5cdCAqIEBwYXJhbSBkb21FbGVtZW50IFRoZSByZXNpemVyIHdyYXBwZXIuXG5cdCAqLyBfYXBwZW5kSGFuZGxlcyhkb21FbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHJlc2l6ZXJQb3NpdGlvbnMgPSBbXG4gICAgICAgICAgICAndG9wLWxlZnQnLFxuICAgICAgICAgICAgJ3RvcC1yaWdodCcsXG4gICAgICAgICAgICAnYm90dG9tLXJpZ2h0JyxcbiAgICAgICAgICAgICdib3R0b20tbGVmdCdcbiAgICAgICAgXTtcbiAgICAgICAgZm9yIChjb25zdCBjdXJyZW50UG9zaXRpb24gb2YgcmVzaXplclBvc2l0aW9ucyl7XG4gICAgICAgICAgICBkb21FbGVtZW50LmFwcGVuZENoaWxkKG5ldyBUZW1wbGF0ZSh7XG4gICAgICAgICAgICAgICAgdGFnOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiBgY2std2lkZ2V0X19yZXNpemVyX19oYW5kbGUgJHtnZXRSZXNpemVyQ2xhc3MoY3VycmVudFBvc2l0aW9uKX1gXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkucmVuZGVyKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZXRzIHVwIHRoZSB7QGxpbmsgI19zaXplVmlld30gcHJvcGVydHkgYW5kIGFkZHMgaXQgdG8gdGhlIHBhc3NlZCBgZG9tRWxlbWVudGAuXG5cdCAqLyBfYXBwZW5kU2l6ZVVJKGRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fc2l6ZVZpZXcgPSBuZXcgU2l6ZVZpZXcoKTtcbiAgICAgICAgLy8gTWFrZSBzdXJlIGljb24jZWxlbWVudCBpcyByZW5kZXJlZCBiZWZvcmUgcGFzc2luZyB0byBhcHBlbmRDaGlsZCgpLlxuICAgICAgICB0aGlzLl9zaXplVmlldy5yZW5kZXIoKTtcbiAgICAgICAgZG9tRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9zaXplVmlldy5lbGVtZW50KTtcbiAgICB9XG59XG4vKipcbiAqIEBwYXJhbSByZXNpemVyUG9zaXRpb24gRXhwZWN0ZWQgcmVzaXplciBwb3NpdGlvbiBsaWtlIGBcInRvcC1sZWZ0XCJgLCBgXCJib3R0b20tcmlnaHRcImAuXG4gKiBAcmV0dXJucyBBIHByZWZpeGVkIEhUTUwgY2xhc3MgbmFtZSBmb3IgdGhlIHJlc2l6ZXIgZWxlbWVudFxuICovIGZ1bmN0aW9uIGdldFJlc2l6ZXJDbGFzcyhyZXNpemVyUG9zaXRpb24pIHtcbiAgICByZXR1cm4gYGNrLXdpZGdldF9fcmVzaXplcl9faGFuZGxlLSR7cmVzaXplclBvc2l0aW9ufWA7XG59XG5mdW5jdGlvbiBleHRyYWN0Q29vcmRpbmF0ZXMoZXZlbnQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB4OiBldmVudC5wYWdlWCxcbiAgICAgICAgeTogZXZlbnQucGFnZVlcbiAgICB9O1xufVxuZnVuY3Rpb24gZXhpc3RzSW5Eb20oZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50ICYmIGVsZW1lbnQub3duZXJEb2N1bWVudCAmJiBlbGVtZW50Lm93bmVyRG9jdW1lbnQuY29udGFpbnMoZWxlbWVudCk7XG59XG5cbi8qKlxuICogVGhlIHdpZGdldCByZXNpemUgZmVhdHVyZSBwbHVnaW4uXG4gKlxuICogVXNlIHRoZSB7QGxpbmsgbW9kdWxlOndpZGdldC93aWRnZXRyZXNpemV+V2lkZ2V0UmVzaXplI2F0dGFjaFRvfSBtZXRob2QgdG8gY3JlYXRlIGEgcmVzaXplciBmb3IgdGhlIHNwZWNpZmllZCB3aWRnZXQuXG4gKi8gY2xhc3MgV2lkZ2V0UmVzaXplIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQSBtYXAgb2YgcmVzaXplcnMgY3JlYXRlZCB1c2luZyB0aGlzIHBsdWdpbiBpbnN0YW5jZS5cblx0ICovIF9yZXNpemVycyA9IG5ldyBNYXAoKTtcbiAgICBfb2JzZXJ2ZXI7XG4gICAgX3JlZHJhd1NlbGVjdGVkUmVzaXplclRocm90dGxlZDtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdXaWRnZXRSZXNpemUnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdGluZyA9IHRoaXMuZWRpdG9yLmVkaXRpbmc7XG4gICAgICAgIGNvbnN0IGRvbURvY3VtZW50ID0gZ2xvYmFsLndpbmRvdy5kb2N1bWVudDtcbiAgICAgICAgdGhpcy5zZXQoJ3NlbGVjdGVkUmVzaXplcicsIG51bGwpO1xuICAgICAgICB0aGlzLnNldCgnX2FjdGl2ZVJlc2l6ZXInLCBudWxsKTtcbiAgICAgICAgZWRpdGluZy52aWV3LmFkZE9ic2VydmVyKE1vdXNlT2JzZXJ2ZXIpO1xuICAgICAgICB0aGlzLl9vYnNlcnZlciA9IG5ldyAoRG9tRW1pdHRlck1peGluKCkpKCk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdGluZy52aWV3LmRvY3VtZW50LCAnbW91c2Vkb3duJywgdGhpcy5fbW91c2VEb3duTGlzdGVuZXIuYmluZCh0aGlzKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXIubGlzdGVuVG8oZG9tRG9jdW1lbnQsICdtb3VzZW1vdmUnLCB0aGlzLl9tb3VzZU1vdmVMaXN0ZW5lci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXIubGlzdGVuVG8oZG9tRG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5fbW91c2VVcExpc3RlbmVyLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLl9yZWRyYXdTZWxlY3RlZFJlc2l6ZXJUaHJvdHRsZWQgPSB0aHJvdHRsZSgoKT0+dGhpcy5yZWRyYXdTZWxlY3RlZFJlc2l6ZXIoKSwgMjAwKTtcbiAgICAgICAgLy8gUmVkcmF3aW5nIG9uIGFueSBjaGFuZ2Ugb2YgdGhlIFVJIG9mIHRoZSBlZGl0b3IgKGluY2x1ZGluZyBjb250ZW50IGNoYW5nZXMpLlxuICAgICAgICB0aGlzLmVkaXRvci51aS5vbigndXBkYXRlJywgdGhpcy5fcmVkcmF3U2VsZWN0ZWRSZXNpemVyVGhyb3R0bGVkKTtcbiAgICAgICAgLy8gUmVtb3ZlIHZpZXcgd2lkZ2V0LXJlc2l6ZXIgbWFwcGluZ3MgZm9yIHdpZGdldHMgdGhhdCBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBkb2N1bWVudC5cbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTAxNTZcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTAyNjZcbiAgICAgICAgdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQub24oJ2NoYW5nZScsICgpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFt2aWV3RWxlbWVudCwgcmVzaXplcl0gb2YgdGhpcy5fcmVzaXplcnMpe1xuICAgICAgICAgICAgICAgIGlmICghdmlld0VsZW1lbnQuaXNBdHRhY2hlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2l6ZXJzLmRlbGV0ZSh2aWV3RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc2l6ZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3dlc3QnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBSZXNpemVycyBuZWVkIHRvIGJlIHJlZHJhd24gdXBvbiB3aW5kb3cgcmVzaXplLCBiZWNhdXNlIG5ldyB3aW5kb3cgbWlnaHQgc2hyaW5rIHJlc2l6ZSBob3N0LlxuICAgICAgICB0aGlzLl9vYnNlcnZlci5saXN0ZW5UbyhnbG9iYWwud2luZG93LCAncmVzaXplJywgdGhpcy5fcmVkcmF3U2VsZWN0ZWRSZXNpemVyVGhyb3R0bGVkKTtcbiAgICAgICAgY29uc3Qgdmlld1NlbGVjdGlvbiA9IHRoaXMuZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIHZpZXdTZWxlY3Rpb24ub24oJ2NoYW5nZScsICgpPT57XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSB2aWV3U2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgICAgICAgICAgY29uc3QgcmVzaXplciA9IHRoaXMuZ2V0UmVzaXplckJ5Vmlld0VsZW1lbnQoc2VsZWN0ZWRFbGVtZW50KSB8fCBudWxsO1xuICAgICAgICAgICAgaWYgKHJlc2l6ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdChyZXNpemVyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZXNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZHJhd3MgdGhlIHNlbGVjdGVkIHJlc2l6ZXIgaWYgdGhlcmUgaXMgYW55IHNlbGVjdGVkIHJlc2l6ZXIgYW5kIGlmIGl0IGlzIHZpc2libGUuXG5cdCAqLyByZWRyYXdTZWxlY3RlZFJlc2l6ZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUmVzaXplciAmJiB0aGlzLnNlbGVjdGVkUmVzaXplci5pc1Zpc2libGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSZXNpemVyLnJlZHJhdygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZGVzdHJveSgpIHtcbiAgICAgICAgc3VwZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLl9vYnNlcnZlci5zdG9wTGlzdGVuaW5nKCk7XG4gICAgICAgIGZvciAoY29uc3QgcmVzaXplciBvZiB0aGlzLl9yZXNpemVycy52YWx1ZXMoKSl7XG4gICAgICAgICAgICByZXNpemVyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZWRyYXdTZWxlY3RlZFJlc2l6ZXJUaHJvdHRsZWQuY2FuY2VsKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBNYXJrcyByZXNpemVyIGFzIHNlbGVjdGVkLlxuXHQgKi8gc2VsZWN0KHJlc2l6ZXIpIHtcbiAgICAgICAgdGhpcy5kZXNlbGVjdCgpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkUmVzaXplciA9IHJlc2l6ZXI7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRSZXNpemVyLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogRGVzZWxlY3RzIGN1cnJlbnRseSBzZXQgcmVzaXplci5cblx0ICovIGRlc2VsZWN0KCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFJlc2l6ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSZXNpemVyLmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlbGVjdGVkUmVzaXplciA9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBSZXNpemVyIG9wdGlvbnMuXG5cdCAqLyBhdHRhY2hUbyhvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHJlc2l6ZXIgPSBuZXcgUmVzaXplcihvcHRpb25zKTtcbiAgICAgICAgY29uc3QgcGx1Z2lucyA9IHRoaXMuZWRpdG9yLnBsdWdpbnM7XG4gICAgICAgIHJlc2l6ZXIuYXR0YWNoKCk7XG4gICAgICAgIGlmIChwbHVnaW5zLmhhcygnV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnknKSkge1xuICAgICAgICAgICAgLy8gSGlkaW5nIHdpZGdldCB0b29sYmFyIHRvIGltcHJvdmUgdGhlIHBlcmZvcm1hbmNlXG4gICAgICAgICAgICAvLyAoaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS13aWRnZXQvcHVsbC8xMTIjaXNzdWVjb21tZW50LTU2NDUyODc2NSkuXG4gICAgICAgICAgICBjb25zdCB3aWRnZXRUb29sYmFyUmVwb3NpdG9yeSA9IHBsdWdpbnMuZ2V0KCdXaWRnZXRUb29sYmFyUmVwb3NpdG9yeScpO1xuICAgICAgICAgICAgcmVzaXplci5vbignYmVnaW4nLCAoKT0+e1xuICAgICAgICAgICAgICAgIHdpZGdldFRvb2xiYXJSZXBvc2l0b3J5LmZvcmNlRGlzYWJsZWQoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNpemVyLm9uKCdjYW5jZWwnLCAoKT0+e1xuICAgICAgICAgICAgICAgIHdpZGdldFRvb2xiYXJSZXBvc2l0b3J5LmNsZWFyRm9yY2VEaXNhYmxlZCgncmVzaXplJyk7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNpemVyLm9uKCdjb21taXQnLCAoKT0+e1xuICAgICAgICAgICAgICAgIHdpZGdldFRvb2xiYXJSZXBvc2l0b3J5LmNsZWFyRm9yY2VEaXNhYmxlZCgncmVzaXplJyk7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVzaXplcnMuc2V0KG9wdGlvbnMudmlld0VsZW1lbnQsIHJlc2l6ZXIpO1xuICAgICAgICBjb25zdCB2aWV3U2VsZWN0aW9uID0gdGhpcy5lZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gdmlld1NlbGVjdGlvbi5nZXRTZWxlY3RlZEVsZW1lbnQoKTtcbiAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgdGhlIHJlc2l6ZXIgaXMgY3JlYXRlZCBmb3IgaXMgY3VycmVudGx5IGZvY3VzZWQsIGl0IHNob3VsZCBiZWNvbWUgdmlzaWJsZS5cbiAgICAgICAgaWYgKHRoaXMuZ2V0UmVzaXplckJ5Vmlld0VsZW1lbnQoc2VsZWN0ZWRFbGVtZW50KSA9PSByZXNpemVyKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdChyZXNpemVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzaXplcjtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgYSByZXNpemVyIGNyZWF0ZWQgZm9yIGEgZ2l2ZW4gdmlldyBlbGVtZW50ICh3aWRnZXQgZWxlbWVudCkuXG5cdCAqXG5cdCAqIEBwYXJhbSB2aWV3RWxlbWVudCBWaWV3IGVsZW1lbnQgYXNzb2NpYXRlZCB3aXRoIHRoZSByZXNpemVyLlxuXHQgKi8gZ2V0UmVzaXplckJ5Vmlld0VsZW1lbnQodmlld0VsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc2l6ZXJzLmdldCh2aWV3RWxlbWVudCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGEgcmVzaXplciB0aGF0IGNvbnRhaW5zIGEgZ2l2ZW4gcmVzaXplIGhhbmRsZS5cblx0ICovIF9nZXRSZXNpemVyQnlIYW5kbGUoZG9tUmVzaXplSGFuZGxlKSB7XG4gICAgICAgIGZvciAoY29uc3QgcmVzaXplciBvZiB0aGlzLl9yZXNpemVycy52YWx1ZXMoKSl7XG4gICAgICAgICAgICBpZiAocmVzaXplci5jb250YWluc0hhbmRsZShkb21SZXNpemVIYW5kbGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc2l6ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIEBwYXJhbSBkb21FdmVudERhdGEgTmF0aXZlIERPTSBldmVudC5cblx0ICovIF9tb3VzZURvd25MaXN0ZW5lcihldmVudCwgZG9tRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnN0IHJlc2l6ZUhhbmRsZSA9IGRvbUV2ZW50RGF0YS5kb21UYXJnZXQ7XG4gICAgICAgIGlmICghUmVzaXplci5pc1Jlc2l6ZUhhbmRsZShyZXNpemVIYW5kbGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYWN0aXZlUmVzaXplciA9IHRoaXMuX2dldFJlc2l6ZXJCeUhhbmRsZShyZXNpemVIYW5kbGUpIHx8IG51bGw7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVSZXNpemVyKSB7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVSZXNpemVyLmJlZ2luKHJlc2l6ZUhhbmRsZSk7XG4gICAgICAgICAgICAvLyBEbyBub3QgY2FsbCBvdGhlciBldmVudHMgd2hlbiByZXNpemluZy4gU2VlOiAjNjc1NS5cbiAgICAgICAgICAgIGV2ZW50LnN0b3AoKTtcbiAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAcGFyYW0gZG9tRXZlbnREYXRhIE5hdGl2ZSBET00gZXZlbnQuXG5cdCAqLyBfbW91c2VNb3ZlTGlzdGVuZXIoZXZlbnQsIGRvbUV2ZW50RGF0YSkge1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlUmVzaXplcikge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZlUmVzaXplci51cGRhdGVTaXplKGRvbUV2ZW50RGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX21vdXNlVXBMaXN0ZW5lcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVJlc2l6ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVJlc2l6ZXIuY29tbWl0KCk7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVSZXNpemVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgV0lER0VUX0NMQVNTX05BTUUsIFdJREdFVF9TRUxFQ1RFRF9DTEFTU19OQU1FLCBXaWRnZXQsIFdpZGdldFJlc2l6ZSwgV2lkZ2V0VG9vbGJhclJlcG9zaXRvcnksIFdpZGdldFR5cGVBcm91bmQsIGNhbGN1bGF0ZVJlc2l6ZUhvc3RBbmNlc3RvcldpZHRoLCBjYWxjdWxhdGVSZXNpemVIb3N0UGVyY2VudGFnZVdpZHRoLCBmaW5kT3B0aW1hbEluc2VydGlvblJhbmdlLCBnZXRMYWJlbCwgaXNXaWRnZXQsIHNldEhpZ2hsaWdodEhhbmRsaW5nLCBzZXRMYWJlbCwgdG9XaWRnZXQsIHRvV2lkZ2V0RWRpdGFibGUsIHZpZXdUb01vZGVsUG9zaXRpb25PdXRzaWRlTW9kZWxFbGVtZW50IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiIsIi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqL1xuaW1wb3J0IHsgQ29tbWFuZCwgUGx1Z2luLCBpY29ucyB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtY29yZS9kaXN0L2luZGV4LmpzJztcbmltcG9ydCB7IERlbGV0ZSB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdHlwaW5nL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgRW50ZXIgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWVudGVyL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgdG9BcnJheSwgZmlyc3QsIHVpZCwgQ0tFZGl0b3JFcnJvciwgRm9jdXNUcmFja2VyLCBLZXlzdHJva2VIYW5kbGVyLCBnbG9iYWwsIGdldENvZGUsIHBhcnNlS2V5c3Ryb2tlLCBnZXRMb2NhbGl6ZWRBcnJvd0tleUNvZGVEaXJlY3Rpb24sIGNyZWF0ZUVsZW1lbnQsIGxvZ1dhcm5pbmcgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXV0aWxzL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgQ2xpcGJvYXJkUGlwZWxpbmUgfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LWNsaXBib2FyZC9kaXN0L2luZGV4LmpzJztcbmltcG9ydCB7IEJ1dHRvblZpZXcsIE1lbnVCYXJNZW51TGlzdEl0ZW1CdXR0b25WaWV3LCBWaWV3LCBWaWV3Q29sbGVjdGlvbiwgRm9jdXNDeWNsZXIsIGFkZEtleWJvYXJkSGFuZGxpbmdGb3JHcmlkLCBDb2xsYXBzaWJsZVZpZXcsIExhYmVsZWRGaWVsZFZpZXcsIGNyZWF0ZUxhYmVsZWRJbnB1dE51bWJlciwgU3dpdGNoQnV0dG9uVmlldywgY3JlYXRlRHJvcGRvd24sIFNwbGl0QnV0dG9uVmlldywgTWVudUJhck1lbnVWaWV3LCBmb2N1c0NoaWxkT25Ecm9wZG93bk9wZW4gfSBmcm9tICdAY2tlZGl0b3IvY2tlZGl0b3I1LXVpL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgRG9tRXZlbnRPYnNlcnZlciwgTWF0Y2hlciwgVHJlZVdhbGtlciwgZ2V0RmlsbGVyT2Zmc2V0IH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvZGlzdC9pbmRleC5qcyc7XG5cbi8qKlxuICogRG9jdW1lbnQgbGlzdCBibG9ja3MgaXRlcmF0b3IuXG4gKi8gY2xhc3MgTGlzdFdhbGtlciB7XG4gICAgLyoqXG5cdCAqIFRoZSBzdGFydCBsaXN0IGl0ZW0gYmxvY2sgZWxlbWVudC5cblx0ICovIF9zdGFydEVsZW1lbnQ7XG4gICAgLyoqXG5cdCAqIFRoZSByZWZlcmVuY2UgaW5kZW50LiBJbml0aWFsaXplZCBieSB0aGUgaW5kZW50IG9mIHRoZSBzdGFydCBibG9jay5cblx0ICovIF9yZWZlcmVuY2VJbmRlbnQ7XG4gICAgLyoqXG5cdCAqIFRoZSBpdGVyYXRpbmcgZGlyZWN0aW9uLlxuXHQgKi8gX2lzRm9yd2FyZDtcbiAgICAvKipcblx0ICogV2hldGhlciBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdCAoaWYgaXQncyBtYXRjaGluZyBvdGhlciBjcml0ZXJpYSkuXG5cdCAqLyBfaW5jbHVkZVNlbGY7XG4gICAgLyoqXG5cdCAqIEFkZGl0aW9uYWwgYXR0cmlidXRlcyB0aGF0IG11c3QgYmUgdGhlIHNhbWUgZm9yIGVhY2ggYmxvY2suXG5cdCAqLyBfc2FtZUF0dHJpYnV0ZXM7XG4gICAgLyoqXG5cdCAqIFdoZXRoZXIgYmxvY2tzIHdpdGggdGhlIHNhbWUgaW5kZW50IGxldmVsIGFzIHRoZSBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdC5cblx0ICovIF9zYW1lSW5kZW50O1xuICAgIC8qKlxuXHQgKiBXaGV0aGVyIGJsb2NrcyB3aXRoIGEgbG93ZXIgaW5kZW50IGxldmVsIHRoYW4gdGhlIHN0YXJ0IGJsb2NrIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0LlxuXHQgKi8gX2xvd2VySW5kZW50O1xuICAgIC8qKlxuXHQgKiBXaGV0aGVyIGJsb2NrcyB3aXRoIGEgaGlnaGVyIGluZGVudCBsZXZlbCB0aGFuIHRoZSBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdC5cblx0ICovIF9oaWdoZXJJbmRlbnQ7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBkb2N1bWVudCBsaXN0IGl0ZXJhdG9yLlxuXHQgKlxuXHQgKiBAcGFyYW0gc3RhcnRFbGVtZW50IFRoZSBzdGFydCBsaXN0IGl0ZW0gYmxvY2sgZWxlbWVudC5cblx0ICogQHBhcmFtIG9wdGlvbnMuZGlyZWN0aW9uIFRoZSBpdGVyYXRpbmcgZGlyZWN0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5pbmNsdWRlU2VsZiBXaGV0aGVyIHN0YXJ0IGJsb2NrIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0IChpZiBpdCdzIG1hdGNoaW5nIG90aGVyIGNyaXRlcmlhKS5cblx0ICogQHBhcmFtIG9wdGlvbnMuc2FtZUF0dHJpYnV0ZXMgQWRkaXRpb25hbCBhdHRyaWJ1dGVzIHRoYXQgbXVzdCBiZSB0aGUgc2FtZSBmb3IgZWFjaCBibG9jay5cblx0ICogQHBhcmFtIG9wdGlvbnMuc2FtZUluZGVudCBXaGV0aGVyIGJsb2NrcyB3aXRoIHRoZSBzYW1lIGluZGVudCBsZXZlbCBhcyB0aGUgc3RhcnQgYmxvY2sgc2hvdWxkIGJlIGluY2x1ZGVkXG5cdCAqIGluIHRoZSByZXN1bHQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmxvd2VySW5kZW50IFdoZXRoZXIgYmxvY2tzIHdpdGggYSBsb3dlciBpbmRlbnQgbGV2ZWwgdGhhbiB0aGUgc3RhcnQgYmxvY2sgc2hvdWxkIGJlIGluY2x1ZGVkXG5cdCAqIGluIHRoZSByZXN1bHQuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmhpZ2hlckluZGVudCBXaGV0aGVyIGJsb2NrcyB3aXRoIGEgaGlnaGVyIGluZGVudCBsZXZlbCB0aGFuIHRoZSBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWRcblx0ICogaW4gdGhlIHJlc3VsdC5cblx0ICovIGNvbnN0cnVjdG9yKHN0YXJ0RWxlbWVudCwgb3B0aW9ucyl7XG4gICAgICAgIHRoaXMuX3N0YXJ0RWxlbWVudCA9IHN0YXJ0RWxlbWVudDtcbiAgICAgICAgdGhpcy5fcmVmZXJlbmNlSW5kZW50ID0gc3RhcnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICB0aGlzLl9pc0ZvcndhcmQgPSBvcHRpb25zLmRpcmVjdGlvbiA9PSAnZm9yd2FyZCc7XG4gICAgICAgIHRoaXMuX2luY2x1ZGVTZWxmID0gISFvcHRpb25zLmluY2x1ZGVTZWxmO1xuICAgICAgICB0aGlzLl9zYW1lQXR0cmlidXRlcyA9IHRvQXJyYXkob3B0aW9ucy5zYW1lQXR0cmlidXRlcyB8fCBbXSk7XG4gICAgICAgIHRoaXMuX3NhbWVJbmRlbnQgPSAhIW9wdGlvbnMuc2FtZUluZGVudDtcbiAgICAgICAgdGhpcy5fbG93ZXJJbmRlbnQgPSAhIW9wdGlvbnMubG93ZXJJbmRlbnQ7XG4gICAgICAgIHRoaXMuX2hpZ2hlckluZGVudCA9ICEhb3B0aW9ucy5oaWdoZXJJbmRlbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBQZXJmb3JtcyBvbmx5IGZpcnN0IHN0ZXAgb2YgaXRlcmF0aW9uIGFuZCByZXR1cm5zIHRoZSByZXN1bHQuXG5cdCAqXG5cdCAqIEBwYXJhbSBzdGFydEVsZW1lbnQgVGhlIHN0YXJ0IGxpc3QgaXRlbSBibG9jayBlbGVtZW50LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5kaXJlY3Rpb24gVGhlIGl0ZXJhdGluZyBkaXJlY3Rpb24uXG5cdCAqIEBwYXJhbSBvcHRpb25zLmluY2x1ZGVTZWxmIFdoZXRoZXIgc3RhcnQgYmxvY2sgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHQgKGlmIGl0J3MgbWF0Y2hpbmcgb3RoZXIgY3JpdGVyaWEpLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zYW1lQXR0cmlidXRlcyBBZGRpdGlvbmFsIGF0dHJpYnV0ZXMgdGhhdCBtdXN0IGJlIHRoZSBzYW1lIGZvciBlYWNoIGJsb2NrLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zYW1lSW5kZW50IFdoZXRoZXIgYmxvY2tzIHdpdGggdGhlIHNhbWUgaW5kZW50IGxldmVsIGFzIHRoZSBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWRcblx0ICogaW4gdGhlIHJlc3VsdC5cblx0ICogQHBhcmFtIG9wdGlvbnMubG93ZXJJbmRlbnQgV2hldGhlciBibG9ja3Mgd2l0aCBhIGxvd2VyIGluZGVudCBsZXZlbCB0aGFuIHRoZSBzdGFydCBibG9jayBzaG91bGQgYmUgaW5jbHVkZWRcblx0ICogaW4gdGhlIHJlc3VsdC5cblx0ICogQHBhcmFtIG9wdGlvbnMuaGlnaGVySW5kZW50IFdoZXRoZXIgYmxvY2tzIHdpdGggYSBoaWdoZXIgaW5kZW50IGxldmVsIHRoYW4gdGhlIHN0YXJ0IGJsb2NrIHNob3VsZCBiZSBpbmNsdWRlZFxuXHQgKiBpbiB0aGUgcmVzdWx0LlxuXHQgKi8gc3RhdGljIGZpcnN0KHN0YXJ0RWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICBjb25zdCB3YWxrZXIgPSBuZXcgdGhpcyhzdGFydEVsZW1lbnQsIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCBpdGVyYXRvciA9IHdhbGtlcltTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgIHJldHVybiBmaXJzdChpdGVyYXRvcik7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJdGVyYWJsZSBpbnRlcmZhY2UuXG5cdCAqLyAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIGNvbnN0IG5lc3RlZEl0ZW1zID0gW107XG4gICAgICAgIGZvciAoY29uc3QgeyBub2RlIH0gb2YgbmV3IFNpYmxpbmdMaXN0QmxvY2tzSXRlcmF0b3IodGhpcy5fZ2V0U3RhcnROb2RlKCksIHRoaXMuX2lzRm9yd2FyZCA/ICdmb3J3YXJkJyA6ICdiYWNrd2FyZCcpKXtcbiAgICAgICAgICAgIGNvbnN0IGluZGVudCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgICAgICAvLyBMZWF2aW5nIGEgbmVzdGVkIGxpc3QuXG4gICAgICAgICAgICBpZiAoaW5kZW50IDwgdGhpcy5fcmVmZXJlbmNlSW5kZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gQWJvcnQgc2VhcmNoaW5nIGJsb2Nrcy5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2xvd2VySW5kZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBXaGlsZSBzZWFyY2hpbmcgZm9yIGxvd2VyIGluZGVudHMsIHVwZGF0ZSB0aGUgcmVmZXJlbmNlIGluZGVudCB0byBmaW5kIGFub3RoZXIgcGFyZW50IGluIHRoZSBuZXh0IHN0ZXAuXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlSW5kZW50ID0gaW5kZW50O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRlbnQgPiB0aGlzLl9yZWZlcmVuY2VJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbmVzdGVkIGJsb2Nrcy5cbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2hpZ2hlckluZGVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ29sbGVjdCBuZXN0ZWQgYmxvY2tzIHRvIHZlcmlmeSBpZiB0aGV5IGFyZSByZWFsbHkgbmVzdGVkLCBvciBpdCdzIGEgZGlmZmVyZW50IGl0ZW0uXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0ZvcndhcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgbmVzdGVkSXRlbXMucHVzaChub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgc2FtZSBpbmRlbnQgYmxvY2suXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zYW1lSW5kZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdoaWxlIGxvb2tpbmcgZm9yIG5lc3RlZCBibG9ja3MsIHN0b3AgaXRlcmF0aW5nIHdoaWxlIGVuY291bnRlcmluZyBmaXJzdCBzYW1lIGluZGVudCBibG9jay5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2hpZ2hlckluZGVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm8gbW9yZSBuZXN0ZWQgYmxvY2tzIHNvIHlpZWxkIG5lc3RlZCBpdGVtcy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXN0ZWRJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCogbmVzdGVkSXRlbXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVzdGVkSXRlbXMubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBBYm9ydCBpZiBpdGVtIGhhcyBhbnkgYWRkaXRpb25hbGx5IHNwZWNpZmllZCBhdHRyaWJ1dGUgZGlmZmVyZW50LlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zYW1lQXR0cmlidXRlcy5zb21lKChhdHRyKT0+bm9kZS5nZXRBdHRyaWJ1dGUoYXR0cikgIT09IHRoaXMuX3N0YXJ0RWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cikpKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoZXJlIGlzIGFub3RoZXIgYmxvY2sgZm9yIHRoZSBzYW1lIGxpc3QgaXRlbSBzbyB0aGUgbmVzdGVkIGl0ZW1zIHdlcmUgaW4gdGhlIHNhbWUgbGlzdCBpdGVtLlxuICAgICAgICAgICAgaWYgKG5lc3RlZEl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHlpZWxkKiBuZXN0ZWRJdGVtcztcbiAgICAgICAgICAgICAgICBuZXN0ZWRJdGVtcy5sZW5ndGggPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeWllbGQgbm9kZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0aGUgbW9kZWwgZWxlbWVudCB0byBzdGFydCBpdGVyYXRpbmcuXG5cdCAqLyBfZ2V0U3RhcnROb2RlKCkge1xuICAgICAgICBpZiAodGhpcy5faW5jbHVkZVNlbGYpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydEVsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRm9yd2FyZCA/IHRoaXMuX3N0YXJ0RWxlbWVudC5uZXh0U2libGluZyA6IHRoaXMuX3N0YXJ0RWxlbWVudC5wcmV2aW91c1NpYmxpbmc7XG4gICAgfVxufVxuLyoqXG4gKiBJdGVyYXRlcyBzaWJsaW5nIGxpc3QgYmxvY2tzIHN0YXJ0aW5nIGZyb20gdGhlIGdpdmVuIG5vZGUuXG4gKi8gY2xhc3MgU2libGluZ0xpc3RCbG9ja3NJdGVyYXRvciB7XG4gICAgX25vZGU7XG4gICAgX2lzRm9yd2FyZDtcbiAgICBfcHJldmlvdXNOb2Rlc0J5SW5kZW50ID0gW107XG4gICAgX3ByZXZpb3VzID0gbnVsbDtcbiAgICBfcHJldmlvdXNOb2RlSW5kZW50ID0gbnVsbDtcbiAgICAvKipcblx0ICogQHBhcmFtIG5vZGUgVGhlIG1vZGVsIG5vZGUuXG5cdCAqIEBwYXJhbSBkaXJlY3Rpb24gSXRlcmF0aW9uIGRpcmVjdGlvbi5cblx0ICovIGNvbnN0cnVjdG9yKG5vZGUsIGRpcmVjdGlvbiA9ICdmb3J3YXJkJyl7XG4gICAgICAgIHRoaXMuX25vZGUgPSBub2RlO1xuICAgICAgICB0aGlzLl9pc0ZvcndhcmQgPSBkaXJlY3Rpb24gPT09ICdmb3J3YXJkJztcbiAgICB9XG4gICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBuZXh0KCkge1xuICAgICAgICBpZiAoIWlzTGlzdEl0ZW1CbG9jayh0aGlzLl9ub2RlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkb25lOiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm9kZUluZGVudCA9IHRoaXMuX25vZGUuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgIGxldCBwcmV2aW91c05vZGVJbkxpc3QgPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5fcHJldmlvdXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzTm9kZUluZGVudCA9IHRoaXMuX3ByZXZpb3VzTm9kZUluZGVudDtcbiAgICAgICAgICAgIC8vIExldCdzIGZpbmQgcHJldmlvdXMgbm9kZSBmb3IgdGhlIHNhbWUgaW5kZW50LlxuICAgICAgICAgICAgLy8gV2UncmUgZ29pbmcgdG8gbmVlZCB0aGF0IHdoZW4gd2UgZ2V0IGJhY2sgdG8gcHJldmlvdXMgaW5kZW50LlxuICAgICAgICAgICAgaWYgKG5vZGVJbmRlbnQgPiBwcmV2aW91c05vZGVJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wcmV2aW91c05vZGVzQnlJbmRlbnRbcHJldmlvdXNOb2RlSW5kZW50XSA9IHRoaXMuX3ByZXZpb3VzO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlSW5kZW50IDwgcHJldmlvdXNOb2RlSW5kZW50KSB7XG4gICAgICAgICAgICAgICAgcHJldmlvdXNOb2RlSW5MaXN0ID0gdGhpcy5fcHJldmlvdXNOb2Rlc0J5SW5kZW50W25vZGVJbmRlbnRdIHx8IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5fcHJldmlvdXNOb2Rlc0J5SW5kZW50Lmxlbmd0aCA9IG5vZGVJbmRlbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByZXZpb3VzTm9kZUluTGlzdCA9IHRoaXMuX3ByZXZpb3VzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZhbHVlID0ge1xuICAgICAgICAgICAgbm9kZTogdGhpcy5fbm9kZSxcbiAgICAgICAgICAgIHByZXZpb3VzOiB0aGlzLl9wcmV2aW91cyxcbiAgICAgICAgICAgIHByZXZpb3VzTm9kZUluTGlzdFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9wcmV2aW91cyA9IHRoaXMuX25vZGU7XG4gICAgICAgIHRoaXMuX3ByZXZpb3VzTm9kZUluZGVudCA9IG5vZGVJbmRlbnQ7XG4gICAgICAgIHRoaXMuX25vZGUgPSB0aGlzLl9pc0ZvcndhcmQgPyB0aGlzLl9ub2RlLm5leHRTaWJsaW5nIDogdGhpcy5fbm9kZS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIGRvbmU6IGZhbHNlXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBUaGUgaXRlcmFibGUgcHJvdG9jb2wgb3ZlciB0aGUgbGlzdCBlbGVtZW50cy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBMaXN0QmxvY2tzSXRlcmFibGUge1xuICAgIF9saXN0SGVhZDtcbiAgICAvKipcblx0ICogQHBhcmFtIGxpc3RIZWFkIFRoZSBoZWFkIGVsZW1lbnQgb2YgYSBsaXN0LlxuXHQgKi8gY29uc3RydWN0b3IobGlzdEhlYWQpe1xuICAgICAgICB0aGlzLl9saXN0SGVhZCA9IGxpc3RIZWFkO1xuICAgIH1cbiAgICAvKipcblx0ICogTGlzdCBibG9ja3MgaXRlcmF0b3IuXG5cdCAqXG5cdCAqIEl0ZXJhdGVzIG92ZXIgYWxsIGJsb2NrcyBvZiBhIGxpc3QuXG5cdCAqLyBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTaWJsaW5nTGlzdEJsb2Nrc0l0ZXJhdG9yKHRoaXMuX2xpc3RIZWFkKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3QgaXRlbSBJRCBnZW5lcmF0b3IuXG4gKlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgTGlzdEl0ZW1VaWQge1xuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBuZXh0IElELlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0OiBzdGF0aWMgZnVuY3Rpb24gZGVmaW5pdGlvbiAtLSBAcHJlc2VydmUgKi8gc3RhdGljIG5leHQoKSB7XG4gICAgICAgIHJldHVybiB1aWQoKTtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gbW9kZWwgbm9kZSBpcyBhIGxpc3QgaXRlbSBibG9jay5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBpc0xpc3RJdGVtQmxvY2sobm9kZSkge1xuICAgIHJldHVybiAhIW5vZGUgJiYgbm9kZS5pcygnZWxlbWVudCcpICYmIG5vZGUuaGFzQXR0cmlidXRlKCdsaXN0SXRlbUlkJyk7XG59XG4vKipcbiAqIFJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgZWxlbWVudHMgdGhhdCByZXByZXNlbnRzIHRoZSBzYW1lIGxpc3QgaXRlbS5cbiAqXG4gKiBJdCBtZWFucyB0aGF0IHZhbHVlcyBmb3IgYGxpc3RJbmRlbnRgLCBhbmQgYGxpc3RJdGVtSWRgIGZvciBhbGwgaXRlbXMgYXJlIGVxdWFsLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxpc3RJdGVtIFN0YXJ0aW5nIGxpc3QgaXRlbSBlbGVtZW50LlxuICogQHBhcmFtIG9wdGlvbnMuaGlnaGVySW5kZW50IFdoZXRoZXIgYmxvY2tzIHdpdGggYSBoaWdoZXIgaW5kZW50IGxldmVsIHRoYW4gdGhlIHN0YXJ0IGJsb2NrIHNob3VsZCBiZSBpbmNsdWRlZFxuICogaW4gdGhlIHJlc3VsdC5cbiAqLyBmdW5jdGlvbiBnZXRBbGxMaXN0SXRlbUJsb2NrcyhsaXN0SXRlbSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgLi4uZ2V0TGlzdEl0ZW1CbG9ja3MobGlzdEl0ZW0sIHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBkaXJlY3Rpb246ICdiYWNrd2FyZCdcbiAgICAgICAgfSksXG4gICAgICAgIC4uLmdldExpc3RJdGVtQmxvY2tzKGxpc3RJdGVtLCB7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiAnZm9yd2FyZCdcbiAgICAgICAgfSlcbiAgICBdO1xufVxuLyoqXG4gKiBSZXR1cm5zIGFuIGFycmF5IHdpdGggZWxlbWVudHMgdGhhdCByZXByZXNlbnRzIHRoZSBzYW1lIGxpc3QgaXRlbSBpbiB0aGUgc3BlY2lmaWVkIGRpcmVjdGlvbi5cbiAqXG4gKiBJdCBtZWFucyB0aGF0IHZhbHVlcyBmb3IgYGxpc3RJbmRlbnRgIGFuZCBgbGlzdEl0ZW1JZGAgZm9yIGFsbCBpdGVtcyBhcmUgZXF1YWwuXG4gKlxuICogKipOb3RlKio6IEZvciBiYWNrd2FyZCBzZWFyY2ggdGhlIHByb3ZpZGVkIGl0ZW0gaXMgbm90IGluY2x1ZGVkLCBidXQgZm9yIGZvcndhcmQgc2VhcmNoIGl0IGlzIGluY2x1ZGVkIGluIHRoZSByZXN1bHQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGlzdEl0ZW0gU3RhcnRpbmcgbGlzdCBpdGVtIGVsZW1lbnQuXG4gKiBAcGFyYW0gb3B0aW9ucy5kaXJlY3Rpb24gV2Fsa2luZyBkaXJlY3Rpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5oaWdoZXJJbmRlbnQgV2hldGhlciBibG9ja3Mgd2l0aCBhIGhpZ2hlciBpbmRlbnQgbGV2ZWwgdGhhbiB0aGUgc3RhcnQgYmxvY2sgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHQuXG4gKi8gZnVuY3Rpb24gZ2V0TGlzdEl0ZW1CbG9ja3MobGlzdEl0ZW0sIG9wdGlvbnMgPSB7fSkge1xuICAgIGNvbnN0IGlzRm9yd2FyZCA9IG9wdGlvbnMuZGlyZWN0aW9uID09ICdmb3J3YXJkJztcbiAgICBjb25zdCBpdGVtcyA9IEFycmF5LmZyb20obmV3IExpc3RXYWxrZXIobGlzdEl0ZW0sIHtcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgaW5jbHVkZVNlbGY6IGlzRm9yd2FyZCxcbiAgICAgICAgc2FtZUluZGVudDogdHJ1ZSxcbiAgICAgICAgc2FtZUF0dHJpYnV0ZXM6ICdsaXN0SXRlbUlkJ1xuICAgIH0pKTtcbiAgICByZXR1cm4gaXNGb3J3YXJkID8gaXRlbXMgOiBpdGVtcy5yZXZlcnNlKCk7XG59XG4vKipcbiAqIFJldHVybnMgYSBsaXN0IGl0ZW1zIG5lc3RlZCBpbnNpZGUgdGhlIGdpdmVuIGxpc3QgaXRlbS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBnZXROZXN0ZWRMaXN0QmxvY2tzKGxpc3RJdGVtKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20obmV3IExpc3RXYWxrZXIobGlzdEl0ZW0sIHtcbiAgICAgICAgZGlyZWN0aW9uOiAnZm9yd2FyZCcsXG4gICAgICAgIGhpZ2hlckluZGVudDogdHJ1ZVxuICAgIH0pKTtcbn1cbi8qKlxuICogUmV0dXJucyBhcnJheSBvZiBhbGwgYmxvY2tzL2l0ZW1zIG9mIHRoZSBzYW1lIGxpc3QgYXMgZ2l2ZW4gYmxvY2sgKHNhbWUgaW5kZW50LCBzYW1lIHR5cGUgYW5kIHByb3BlcnRpZXMpLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxpc3RJdGVtIFN0YXJ0aW5nIGxpc3QgaXRlbSBlbGVtZW50LlxuICogQHBhcmFtIG9wdGlvbnMgQWRkaXRpb25hbCBsaXN0IHdhbGtlciBvcHRpb25zIHRvIG1vZGlmeSB0aGUgcmFuZ2Ugb2YgcmV0dXJuZWQgbGlzdCBpdGVtcy5cbiAqLyBmdW5jdGlvbiBnZXRMaXN0SXRlbXMobGlzdEl0ZW0sIG9wdGlvbnMpIHtcbiAgICBjb25zdCBiYWNrd2FyZEJsb2NrcyA9IG5ldyBMaXN0V2Fsa2VyKGxpc3RJdGVtLCB7XG4gICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgIHNhbWVBdHRyaWJ1dGVzOiAnbGlzdFR5cGUnLFxuICAgICAgICAuLi5vcHRpb25zXG4gICAgfSk7XG4gICAgY29uc3QgZm9yd2FyZEJsb2NrcyA9IG5ldyBMaXN0V2Fsa2VyKGxpc3RJdGVtLCB7XG4gICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgIHNhbWVBdHRyaWJ1dGVzOiAnbGlzdFR5cGUnLFxuICAgICAgICBpbmNsdWRlU2VsZjogdHJ1ZSxcbiAgICAgICAgZGlyZWN0aW9uOiAnZm9yd2FyZCcsXG4gICAgICAgIC4uLm9wdGlvbnNcbiAgICB9KTtcbiAgICByZXR1cm4gW1xuICAgICAgICAuLi5BcnJheS5mcm9tKGJhY2t3YXJkQmxvY2tzKS5yZXZlcnNlKCksXG4gICAgICAgIC4uLmZvcndhcmRCbG9ja3NcbiAgICBdO1xufVxuLyoqXG4gKiBDaGVjayBpZiB0aGUgZ2l2ZW4gYmxvY2sgaXMgdGhlIGZpcnN0IGluIHRoZSBsaXN0IGl0ZW0uXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGlzdEJsb2NrIFRoZSBsaXN0IGJsb2NrIGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gaXNGaXJzdEJsb2NrT2ZMaXN0SXRlbShsaXN0QmxvY2spIHtcbiAgICBjb25zdCBwcmV2aW91c1NpYmxpbmcgPSBMaXN0V2Fsa2VyLmZpcnN0KGxpc3RCbG9jaywge1xuICAgICAgICBzYW1lSW5kZW50OiB0cnVlLFxuICAgICAgICBzYW1lQXR0cmlidXRlczogJ2xpc3RJdGVtSWQnXG4gICAgfSk7XG4gICAgaWYgKCFwcmV2aW91c1NpYmxpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbi8qKlxuICogQ2hlY2sgaWYgdGhlIGdpdmVuIGJsb2NrIGlzIHRoZSBsYXN0IGluIHRoZSBsaXN0IGl0ZW0uXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gaXNMYXN0QmxvY2tPZkxpc3RJdGVtKGxpc3RCbG9jaykge1xuICAgIGNvbnN0IG5leHRTaWJsaW5nID0gTGlzdFdhbGtlci5maXJzdChsaXN0QmxvY2ssIHtcbiAgICAgICAgZGlyZWN0aW9uOiAnZm9yd2FyZCcsXG4gICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgIHNhbWVBdHRyaWJ1dGVzOiAnbGlzdEl0ZW1JZCdcbiAgICB9KTtcbiAgICBpZiAoIW5leHRTaWJsaW5nKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG4vKipcbiAqIEV4cGFuZHMgdGhlIGdpdmVuIGxpc3Qgb2Ygc2VsZWN0ZWQgYmxvY2tzIHRvIGluY2x1ZGUgdGhlIGxlYWRpbmcgYW5kIHRhaWxpbmcgYmxvY2tzIG9mIHBhcnRpYWxseSBzZWxlY3RlZCBsaXN0IGl0ZW1zLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGJsb2NrcyBUaGUgbGlzdCBvZiBzZWxlY3RlZCBibG9ja3MuXG4gKiBAcGFyYW0gb3B0aW9ucy53aXRoTmVzdGVkIFdoZXRoZXIgc2hvdWxkIGluY2x1ZGUgbmVzdGVkIGxpc3QgaXRlbXMuXG4gKi8gZnVuY3Rpb24gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9ja3MsIG9wdGlvbnMgPSB7fSkge1xuICAgIGJsb2NrcyA9IHRvQXJyYXkoYmxvY2tzKTtcbiAgICBjb25zdCBoaWdoZXJJbmRlbnQgPSBvcHRpb25zLndpdGhOZXN0ZWQgIT09IGZhbHNlO1xuICAgIGNvbnN0IGFsbEJsb2NrcyA9IG5ldyBTZXQoKTtcbiAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbUJsb2NrIG9mIGdldEFsbExpc3RJdGVtQmxvY2tzKGJsb2NrLCB7XG4gICAgICAgICAgICBoaWdoZXJJbmRlbnRcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgYWxsQmxvY2tzLmFkZChpdGVtQmxvY2spO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzb3J0QmxvY2tzKGFsbEJsb2Nrcyk7XG59XG4vKipcbiAqIEV4cGFuZHMgdGhlIGdpdmVuIGxpc3Qgb2Ygc2VsZWN0ZWQgYmxvY2tzIHRvIGluY2x1ZGUgYWxsIHRoZSBpdGVtcyBvZiB0aGUgbGlzdHMgdGhleSdyZSBpbi5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBibG9ja3MgVGhlIGxpc3Qgb2Ygc2VsZWN0ZWQgYmxvY2tzLlxuICovIGZ1bmN0aW9uIGV4cGFuZExpc3RCbG9ja3NUb0NvbXBsZXRlTGlzdChibG9ja3MpIHtcbiAgICBibG9ja3MgPSB0b0FycmF5KGJsb2Nrcyk7XG4gICAgY29uc3QgYWxsQmxvY2tzID0gbmV3IFNldCgpO1xuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKXtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtQmxvY2sgb2YgZ2V0TGlzdEl0ZW1zKGJsb2NrKSl7XG4gICAgICAgICAgICBhbGxCbG9ja3MuYWRkKGl0ZW1CbG9jayk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNvcnRCbG9ja3MoYWxsQmxvY2tzKTtcbn1cbi8qKlxuICogU3BsaXRzIHRoZSBsaXN0IGl0ZW0ganVzdCBiZWZvcmUgdGhlIHByb3ZpZGVkIGxpc3QgYmxvY2suXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGlzdEJsb2NrIFRoZSBsaXN0IGJsb2NrIGVsZW1lbnQuXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSBtb2RlbCB3cml0ZXIuXG4gKiBAcmV0dXJucyBUaGUgYXJyYXkgb2YgdXBkYXRlZCBibG9ja3MuXG4gKi8gZnVuY3Rpb24gc3BsaXRMaXN0SXRlbUJlZm9yZShsaXN0QmxvY2ssIHdyaXRlcikge1xuICAgIGNvbnN0IGJsb2NrcyA9IGdldExpc3RJdGVtQmxvY2tzKGxpc3RCbG9jaywge1xuICAgICAgICBkaXJlY3Rpb246ICdmb3J3YXJkJ1xuICAgIH0pO1xuICAgIGNvbnN0IGlkID0gTGlzdEl0ZW1VaWQubmV4dCgpO1xuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKXtcbiAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcsIGlkLCBibG9jayk7XG4gICAgfVxuICAgIHJldHVybiBibG9ja3M7XG59XG4vKipcbiAqIE1lcmdlcyB0aGUgbGlzdCBpdGVtIHdpdGggdGhlIHBhcmVudCBsaXN0IGl0ZW0uXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbGlzdEJsb2NrIFRoZSBsaXN0IGJsb2NrIGVsZW1lbnQuXG4gKiBAcGFyYW0gcGFyZW50QmxvY2sgVGhlIGxpc3QgYmxvY2sgZWxlbWVudCB0byBtZXJnZSB3aXRoLlxuICogQHBhcmFtIHdyaXRlciBUaGUgbW9kZWwgd3JpdGVyLlxuICogQHJldHVybnMgVGhlIGFycmF5IG9mIHVwZGF0ZWQgYmxvY2tzLlxuICovIGZ1bmN0aW9uIG1lcmdlTGlzdEl0ZW1CZWZvcmUobGlzdEJsb2NrLCBwYXJlbnRCbG9jaywgd3JpdGVyKSB7XG4gICAgY29uc3QgYXR0cmlidXRlcyA9IHt9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHBhcmVudEJsb2NrLmdldEF0dHJpYnV0ZXMoKSl7XG4gICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnbGlzdCcpKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBibG9ja3MgPSBnZXRMaXN0SXRlbUJsb2NrcyhsaXN0QmxvY2ssIHtcbiAgICAgICAgZGlyZWN0aW9uOiAnZm9yd2FyZCdcbiAgICB9KTtcbiAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGVzKGF0dHJpYnV0ZXMsIGJsb2NrKTtcbiAgICB9XG4gICAgcmV0dXJuIGJsb2Nrcztcbn1cbi8qKlxuICogSW5jcmVhc2VzIGluZGVudGF0aW9uIG9mIGdpdmVuIGxpc3QgYmxvY2tzLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGJsb2NrcyBUaGUgYmxvY2sgb3IgaXRlcmFibGUgb2YgYmxvY2tzLlxuICogQHBhcmFtIHdyaXRlciBUaGUgbW9kZWwgd3JpdGVyLlxuICogQHBhcmFtIG9wdGlvbnMuZXhwYW5kIFdoZXRoZXIgc2hvdWxkIGV4cGFuZCB0aGUgbGlzdCBvZiBibG9ja3MgdG8gaW5jbHVkZSBjb21wbGV0ZSBsaXN0IGl0ZW1zLlxuICogQHBhcmFtIG9wdGlvbnMuaW5kZW50QnkgVGhlIG51bWJlciBvZiBsZXZlbHMgdGhlIGluZGVudGF0aW9uIHNob3VsZCBjaGFuZ2UgKGNvdWxkIGJlIG5lZ2F0aXZlKS5cbiAqLyBmdW5jdGlvbiBpbmRlbnRCbG9ja3MoYmxvY2tzLCB3cml0ZXIsIHsgZXhwYW5kLCBpbmRlbnRCeSA9IDEgfSA9IHt9KSB7XG4gICAgYmxvY2tzID0gdG9BcnJheShibG9ja3MpO1xuICAgIC8vIEV4cGFuZCB0aGUgc2VsZWN0ZWQgYmxvY2tzIHRvIGNvbnRhaW4gdGhlIHdob2xlIGxpc3QgaXRlbXMuXG4gICAgY29uc3QgYWxsQmxvY2tzID0gZXhwYW5kID8gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9ja3MpIDogYmxvY2tzO1xuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYWxsQmxvY2tzKXtcbiAgICAgICAgY29uc3QgYmxvY2tJbmRlbnQgPSBibG9jay5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSArIGluZGVudEJ5O1xuICAgICAgICBpZiAoYmxvY2tJbmRlbnQgPCAwKSB7XG4gICAgICAgICAgICByZW1vdmVMaXN0QXR0cmlidXRlcyhibG9jaywgd3JpdGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnLCBibG9ja0luZGVudCwgYmxvY2spO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhbGxCbG9ja3M7XG59XG4vKipcbiAqIERlY3JlYXNlcyBpbmRlbnRhdGlvbiBvZiBnaXZlbiBsaXN0IG9mIGJsb2Nrcy4gSWYgdGhlIGluZGVudGF0aW9uIG9mIHNvbWUgYmxvY2tzIG1hdGNoZXMgdGhlIGluZGVudGF0aW9uXG4gKiBvZiBzdXJyb3VuZGluZyBibG9ja3MsIHRoZXkgZ2V0IG1lcmdlZCB0b2dldGhlci5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBibG9ja3MgVGhlIGJsb2NrIG9yIGl0ZXJhYmxlIG9mIGJsb2Nrcy5cbiAqIEBwYXJhbSB3cml0ZXIgVGhlIG1vZGVsIHdyaXRlci5cbiAqLyBmdW5jdGlvbiBvdXRkZW50QmxvY2tzV2l0aE1lcmdlKGJsb2Nrcywgd3JpdGVyKSB7XG4gICAgYmxvY2tzID0gdG9BcnJheShibG9ja3MpO1xuICAgIC8vIEV4cGFuZCB0aGUgc2VsZWN0ZWQgYmxvY2tzIHRvIGNvbnRhaW4gdGhlIHdob2xlIGxpc3QgaXRlbXMuXG4gICAgY29uc3QgYWxsQmxvY2tzID0gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9ja3MpO1xuICAgIGNvbnN0IHZpc2l0ZWQgPSBuZXcgU2V0KCk7XG4gICAgY29uc3QgcmVmZXJlbmNlSW5kZW50ID0gTWF0aC5taW4oLi4uYWxsQmxvY2tzLm1hcCgoYmxvY2spPT5ibG9jay5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSkpO1xuICAgIGNvbnN0IHBhcmVudEJsb2NrcyA9IG5ldyBNYXAoKTtcbiAgICAvLyBDb2xsZWN0IHBhcmVudCBibG9ja3MgYmVmb3JlIHRoZSBsaXN0IHN0cnVjdHVyZSBnZXRzIGFsdGVyZWQuXG4gICAgZm9yIChjb25zdCBibG9jayBvZiBhbGxCbG9ja3Mpe1xuICAgICAgICBwYXJlbnRCbG9ja3Muc2V0KGJsb2NrLCBMaXN0V2Fsa2VyLmZpcnN0KGJsb2NrLCB7XG4gICAgICAgICAgICBsb3dlckluZGVudDogdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYWxsQmxvY2tzKXtcbiAgICAgICAgaWYgKHZpc2l0ZWQuaGFzKGJsb2NrKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdmlzaXRlZC5hZGQoYmxvY2spO1xuICAgICAgICBjb25zdCBibG9ja0luZGVudCA9IGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpIC0gMTtcbiAgICAgICAgaWYgKGJsb2NrSW5kZW50IDwgMCkge1xuICAgICAgICAgICAgcmVtb3ZlTGlzdEF0dHJpYnV0ZXMoYmxvY2ssIHdyaXRlcik7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBNZXJnZSB3aXRoIHBhcmVudCBsaXN0IGl0ZW0gd2hpbGUgb3V0ZGVudGluZyBhbmQgaW5kZW50IG1hdGNoZXMgcmVmZXJlbmNlIGluZGVudC5cbiAgICAgICAgaWYgKGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID09IHJlZmVyZW5jZUluZGVudCkge1xuICAgICAgICAgICAgY29uc3QgbWVyZ2VkQmxvY2tzID0gbWVyZ2VMaXN0SXRlbUlmTm90TGFzdChibG9jaywgcGFyZW50QmxvY2tzLmdldChibG9jayksIHdyaXRlcik7XG4gICAgICAgICAgICAvLyBBbGwgbGlzdCBpdGVtIGJsb2NrcyBhcmUgdXBkYXRlZCB3aGlsZSBtZXJnaW5nIHNvIGFkZCB0aG9zZSB0byB2aXNpdGVkIHNldC5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbWVyZ2VkQmxvY2sgb2YgbWVyZ2VkQmxvY2tzKXtcbiAgICAgICAgICAgICAgICB2aXNpdGVkLmFkZChtZXJnZWRCbG9jayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUaGUgaW5kZW50IGxldmVsIHdhcyB1cGRhdGVkIHdoaWxlIG1lcmdpbmcgc28gY29udGludWUgdG8gbmV4dCBibG9jay5cbiAgICAgICAgICAgIGlmIChtZXJnZWRCbG9ja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcsIGJsb2NrSW5kZW50LCBibG9jayk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0QmxvY2tzKHZpc2l0ZWQpO1xufVxuLyoqXG4gKiBSZW1vdmVzIGFsbCBsaXN0IGF0dHJpYnV0ZXMgZnJvbSB0aGUgZ2l2ZW4gYmxvY2tzLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGJsb2NrcyBUaGUgYmxvY2sgb3IgaXRlcmFibGUgb2YgYmxvY2tzLlxuICogQHBhcmFtIHdyaXRlciBUaGUgbW9kZWwgd3JpdGVyLlxuICogQHJldHVybnMgQXJyYXkgb2YgYWx0ZXJlZCBibG9ja3MuXG4gKi8gZnVuY3Rpb24gcmVtb3ZlTGlzdEF0dHJpYnV0ZXMoYmxvY2tzLCB3cml0ZXIpIHtcbiAgICBibG9ja3MgPSB0b0FycmF5KGJsb2Nrcyk7XG4gICAgLy8gQ29udmVydCBzaW1wbGUgbGlzdCBpdGVtcyB0byBwbGFpbiBwYXJhZ3JhcGhzLlxuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKXtcbiAgICAgICAgaWYgKGJsb2NrLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIHdyaXRlci5yZW5hbWUoYmxvY2ssICdwYXJhZ3JhcGgnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBSZW1vdmUgbGlzdCBhdHRyaWJ1dGVzLlxuICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKXtcbiAgICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGVLZXkgb2YgYmxvY2suZ2V0QXR0cmlidXRlS2V5cygpKXtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVLZXkuc3RhcnRzV2l0aCgnbGlzdCcpKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZShhdHRyaWJ1dGVLZXksIGJsb2NrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYmxvY2tzO1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gYmxvY2tzIGFyZSByZWxhdGVkIHRvIGEgc2luZ2xlIGxpc3QgaXRlbS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBibG9ja3MgVGhlIGxpc3QgYmxvY2sgZWxlbWVudHMuXG4gKi8gZnVuY3Rpb24gaXNTaW5nbGVMaXN0SXRlbShibG9ja3MpIHtcbiAgICBpZiAoIWJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBmaXJzdEl0ZW1JZCA9IGJsb2Nrc1swXS5nZXRBdHRyaWJ1dGUoJ2xpc3RJdGVtSWQnKTtcbiAgICBpZiAoIWZpcnN0SXRlbUlkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuICFibG9ja3Muc29tZSgoaXRlbSk9Pml0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJykgIT0gZmlyc3RJdGVtSWQpO1xufVxuLyoqXG4gKiBNb2RpZmllcyB0aGUgaW5kZW50cyBvZiBsaXN0IGJsb2NrcyBmb2xsb3dpbmcgdGhlIGdpdmVuIGxpc3QgYmxvY2sgc28gdGhlIGluZGVudGF0aW9uIGlzIHZhbGlkIGFmdGVyXG4gKiB0aGUgZ2l2ZW4gYmxvY2sgaXMgbm8gbG9uZ2VyIGEgbGlzdCBpdGVtLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxhc3RCbG9jayBUaGUgbGFzdCBsaXN0IGJsb2NrIHRoYXQgaGFzIGJlY29tZSBhIG5vbi1saXN0IGVsZW1lbnQuXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSBtb2RlbCB3cml0ZXIuXG4gKiBAcmV0dXJucyBBcnJheSBvZiBhbHRlcmVkIGJsb2Nrcy5cbiAqLyBmdW5jdGlvbiBvdXRkZW50Rm9sbG93aW5nSXRlbXMobGFzdEJsb2NrLCB3cml0ZXIpIHtcbiAgICBjb25zdCBjaGFuZ2VkQmxvY2tzID0gW107XG4gICAgLy8gU3RhcnQgZnJvbSB0aGUgbW9kZWwgaXRlbSB0aGF0IGlzIGp1c3QgYWZ0ZXIgdGhlIGxhc3QgdHVybmVkLW9mZiBpdGVtLlxuICAgIGxldCBjdXJyZW50SW5kZW50ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgIC8vIENvcnJlY3QgaW5kZW50IG9mIGFsbCBpdGVtcyBhZnRlciB0aGUgbGFzdCB0dXJuZWQgb2ZmIGl0ZW0uXG4gICAgLy8gUnVsZXMgdGhhdCBzaG91bGQgYmUgZm9sbG93ZWQ6XG4gICAgLy8gMS4gQWxsIGRpcmVjdCBzdWItaXRlbXMgb2YgdHVybmVkLW9mZiBpdGVtIHNob3VsZCBiZWNvbWUgaW5kZW50IDAsIGJlY2F1c2UgdGhlIGZpcnN0IGl0ZW0gYWZ0ZXIgaXRcbiAgICAvLyAgICB3aWxsIGJlIHRoZSBmaXJzdCBpdGVtIG9mIGEgbmV3IGxpc3QuIE90aGVyIGl0ZW1zIGFyZSBhdCB0aGUgc2FtZSBsZXZlbCwgc28gc2hvdWxkIGhhdmUgc2FtZSAwIGluZGV4LlxuICAgIC8vIDIuIEFsbCBpdGVtcyB3aXRoIGluZGVudCBsb3dlciB0aGFuIGluZGVudCBvZiB0dXJuZWQtb2ZmIGl0ZW0gc2hvdWxkIGJlY29tZSBpbmRlbnQgMCwgYmVjYXVzZSB0aGV5XG4gICAgLy8gICAgc2hvdWxkIG5vdCBlbmQgdXAgYXMgYSBjaGlsZCBvZiBhbnkgb2YgbGlzdCBpdGVtcyB0aGF0IHRoZXkgd2VyZSBub3QgY2hpbGRyZW4gb2YgYmVmb3JlLlxuICAgIC8vIDMuIEFsbCBvdGhlciBpdGVtcyBzaG91bGQgaGF2ZSB0aGVpciBpbmRlbnQgY2hhbmdlZCByZWxhdGl2ZWx5IHRvIGl0J3MgcGFyZW50LlxuICAgIC8vXG4gICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgLy8gMSAgKiAtLS0tLS0tLVxuICAgIC8vIDIgICAgICogLS0tLS0tLS1cbiAgICAvLyAzICAgICAgICAqIC0tLS0tLS0tXHRcdFx0PC0tIHRoaXMgaXMgdHVybmVkIG9mZi5cbiAgICAvLyA0ICAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIGhhcyB0byBiZWNvbWUgaW5kZW50ID0gMCwgYmVjYXVzZSBpdCB3aWxsIGJlIGZpcnN0IGl0ZW0gb24gYSBuZXcgbGlzdC5cbiAgICAvLyA1ICAgICAgICAgICAgICAqIC0tLS0tLS0tXHQ8LS0gdGhpcyBzaG91bGQgYmUgc3RpbGwgYmUgYSBjaGlsZCBvZiBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAxLlxuICAgIC8vIDYgICAgICAgICogLS0tLS0tLS1cdFx0XHQ8LS0gdGhpcyBoYXMgdG8gYmVjb21lIGluZGVudCA9IDAsIGJlY2F1c2UgaXQgc2hvdWxkIG5vdCBiZSBhIGNoaWxkIG9mIGFueSBvZiBpdGVtcyBhYm92ZS5cbiAgICAvLyA3ICAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIHNob3VsZCBiZSBzdGlsbCBiZSBhIGNoaWxkIG9mIGl0ZW0gYWJvdmUsIHNvIGluZGVudCA9IDEuXG4gICAgLy8gOCAgICAgKiAtLS0tLS0tLVx0XHRcdFx0PC0tIHRoaXMgaGFzIHRvIGJlY29tZSBpbmRlbnQgPSAwLlxuICAgIC8vIDkgICAgICAgICogLS0tLS0tLS1cdFx0XHQ8LS0gdGhpcyBzaG91bGQgc3RpbGwgYmUgYSBjaGlsZCBvZiBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAxLlxuICAgIC8vIDEwICAgICAgICAgICogLS0tLS0tLS1cdFx0PC0tIHRoaXMgc2hvdWxkIHN0aWxsIGJlIGEgY2hpbGQgb2YgaXRlbSBhYm92ZSwgc28gaW5kZW50ID0gMi5cbiAgICAvLyAxMSAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIHNob3VsZCBzdGlsbCBiZSBhdCB0aGUgc2FtZSBsZXZlbCBhcyBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAyLlxuICAgIC8vIDEyICogLS0tLS0tLS1cdFx0XHRcdDwtLSB0aGlzIGFuZCBhbGwgYmVsb3cgYXJlIGxlZnQgdW5jaGFuZ2VkLlxuICAgIC8vIDEzICAgICogLS0tLS0tLS1cbiAgICAvLyAxNCAgICAgICAqIC0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBBZnRlciB0dXJuaW5nIG9mZiAzIHRoZSBsaXN0IGJlY29tZXM6XG4gICAgLy9cbiAgICAvLyAxICAqIC0tLS0tLS0tXG4gICAgLy8gMiAgICAgKiAtLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gMyAgLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vIDQgICogLS0tLS0tLS1cbiAgICAvLyA1ICAgICAqIC0tLS0tLS0tXG4gICAgLy8gNiAgKiAtLS0tLS0tLVxuICAgIC8vIDcgICAgICogLS0tLS0tLS1cbiAgICAvLyA4ICAqIC0tLS0tLS0tXG4gICAgLy8gOSAgICAgKiAtLS0tLS0tLVxuICAgIC8vIDEwICAgICAgICogLS0tLS0tLS1cbiAgICAvLyAxMSAgICAgICAqIC0tLS0tLS0tXG4gICAgLy8gMTIgKiAtLS0tLS0tLVxuICAgIC8vIDEzICAgICogLS0tLS0tLS1cbiAgICAvLyAxNCAgICAgICAqIC0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyBUaGFua3MgdG8gdGhpcyBhbGdvcml0aG0gbm8gbGlzdHMgYXJlIG1pc21hdGNoZWQgYW5kIG5vIGl0ZW1zIGdldCB1bmV4cGVjdGVkIGNoaWxkcmVuL3BhcmVudCwgd2hpbGVcbiAgICAvLyB0aG9zZSBwYXJlbnQtY2hpbGQgY29ubmVjdGlvbiB3aGljaCBhcmUgcG9zc2libGUgdG8gbWFpbnRhaW4gYXJlIHN0aWxsIG1haW50YWluZWQuIEl0J3Mgd29ydGggbm90aW5nXG4gICAgLy8gdGhhdCB0aGlzIGlzIHRoZSBzYW1lIGVmZmVjdCB0aGF0IHdlIHdvdWxkIGJlIGdldCBieSBtdWx0aXBsZSB1c2Ugb2Ygb3V0ZGVudCBjb21tYW5kLiBIb3dldmVyIGRvaW5nXG4gICAgLy8gaXQgbGlrZSB0aGlzIGlzIG11Y2ggbW9yZSBlZmZpY2llbnQgYmVjYXVzZSBpdCdzIGxlc3Mgb3BlcmF0aW9uIChsZXNzIG1lbW9yeSB1c2FnZSwgZWFzaWVyIE9UKSBhbmRcbiAgICAvLyBsZXNzIGNvbnZlcnNpb24gKGZhc3RlcikuXG4gICAgZm9yIChjb25zdCB7IG5vZGUgfSBvZiBuZXcgU2libGluZ0xpc3RCbG9ja3NJdGVyYXRvcihsYXN0QmxvY2submV4dFNpYmxpbmcpKXtcbiAgICAgICAgLy8gQ2hlY2sgZWFjaCBuZXh0IGxpc3QgaXRlbSwgYXMgbG9uZyBhcyBpdHMgaW5kZW50IGlzIGhpZ2hlciB0aGFuIDAuXG4gICAgICAgIGNvbnN0IGluZGVudCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgIC8vIElmIHRoZSBpbmRlbnQgaXMgMCB3ZSBhcmUgbm90IGdvaW5nIHRvIGNoYW5nZSBhbnl0aGluZyBhbnl3YXkuXG4gICAgICAgIGlmIChpbmRlbnQgPT0gMCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2UgY2hlY2sgaWYgdGhhdCdzIGl0ZW0gaW5kZW50IGlzIGxvd2VyIHRoYW4gY3VycmVudCByZWxhdGl2ZSBpbmRlbnQuXG4gICAgICAgIGlmIChpbmRlbnQgPCBjdXJyZW50SW5kZW50KSB7XG4gICAgICAgICAgICAvLyBJZiBpdCBpcywgY3VycmVudCByZWxhdGl2ZSBpbmRlbnQgYmVjb21lcyB0aGF0IGluZGVudC5cbiAgICAgICAgICAgIGN1cnJlbnRJbmRlbnQgPSBpbmRlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRml4IGluZGVudCByZWxhdGl2ZWx5IHRvIGN1cnJlbnQgcmVsYXRpdmUgaW5kZW50LlxuICAgICAgICAvLyBOb3RlLCB0aGF0IGlmIHdlIGp1c3QgY2hhbmdlZCB0aGUgY3VycmVudCByZWxhdGl2ZSBpbmRlbnQsIHRoZSBuZXdJbmRlbnQgd2lsbCBiZSBlcXVhbCB0byAwLlxuICAgICAgICBjb25zdCBuZXdJbmRlbnQgPSBpbmRlbnQgLSBjdXJyZW50SW5kZW50O1xuICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JywgbmV3SW5kZW50LCBub2RlKTtcbiAgICAgICAgY2hhbmdlZEJsb2Nrcy5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICByZXR1cm4gY2hhbmdlZEJsb2Nrcztcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgYXJyYXkgb2YgZ2l2ZW4gYmxvY2tzIHNvcnRlZCBieSBtb2RlbCBpbmRleGVzIChkb2N1bWVudCBvcmRlcikuXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gc29ydEJsb2NrcyhibG9ja3MpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShibG9ja3MpLmZpbHRlcigoYmxvY2spPT5ibG9jay5yb290LnJvb3ROYW1lICE9PSAnJGdyYXZleWFyZCcpLnNvcnQoKGEsIGIpPT5hLmluZGV4IC0gYi5pbmRleCk7XG59XG4vKipcbiAqIFJldHVybnMgYSBzZWxlY3RlZCBibG9jayBvYmplY3QuIElmIGEgc2VsZWN0ZWQgb2JqZWN0IGlzIGlubGluZSBvciB3aGVuIHRoZXJlIGlzIG5vIHNlbGVjdGVkXG4gKiBvYmplY3QsIGBudWxsYCBpcyByZXR1cm5lZC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBtb2RlbCBUaGUgaW5zdGFuY2Ugb2YgZWRpdG9yIG1vZGVsLlxuICogQHJldHVybnMgU2VsZWN0ZWQgYmxvY2sgb2JqZWN0IG9yIGBudWxsYC5cbiAqLyBmdW5jdGlvbiBnZXRTZWxlY3RlZEJsb2NrT2JqZWN0KG1vZGVsKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkRWxlbWVudCgpO1xuICAgIGlmICghc2VsZWN0ZWRFbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAobW9kZWwuc2NoZW1hLmlzT2JqZWN0KHNlbGVjdGVkRWxlbWVudCkgJiYgbW9kZWwuc2NoZW1hLmlzQmxvY2soc2VsZWN0ZWRFbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbGVtZW50O1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIGdpdmVuIGJsb2NrIGNhbiBiZSByZXBsYWNlZCBieSBhIGxpc3RJdGVtLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIGlzIHBvc3NpYmxlIG9ubHkgd2hlbiBtdWx0aUJsb2NrID0gZmFsc2Ugb3B0aW9uIGlzIHNldCBpbiBmZWF0dXJlIGNvbmZpZy5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgQSBibG9jayB0byBiZSB0ZXN0ZWQuXG4gKiBAcGFyYW0gc2NoZW1hIFRoZSBzY2hlbWEgb2YgdGhlIGRvY3VtZW50LlxuICovIGZ1bmN0aW9uIGNhbkJlY29tZVNpbXBsZUxpc3RJdGVtKGJsb2NrLCBzY2hlbWEpIHtcbiAgICByZXR1cm4gc2NoZW1hLmNoZWNrQ2hpbGQoYmxvY2sucGFyZW50LCAnbGlzdEl0ZW0nKSAmJiBzY2hlbWEuY2hlY2tDaGlsZChibG9jaywgJyR0ZXh0JykgJiYgIXNjaGVtYS5pc09iamVjdChibG9jayk7XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBsaXN0VHlwZSBpcyBvZiB0eXBlIGBudW1iZXJlZGAgb3IgYGN1c3RvbU51bWJlcmVkYC5cbiAqLyBmdW5jdGlvbiBpc051bWJlcmVkTGlzdFR5cGUobGlzdFR5cGUpIHtcbiAgICByZXR1cm4gbGlzdFR5cGUgPT0gJ251bWJlcmVkJyB8fCBsaXN0VHlwZSA9PSAnY3VzdG9tTnVtYmVyZWQnO1xufVxuLyoqXG4gKiBNZXJnZXMgYSBnaXZlbiBibG9jayB0byB0aGUgZ2l2ZW4gcGFyZW50IGJsb2NrIGlmIHBhcmVudCBpcyBhIGxpc3QgaXRlbSBhbmQgdGhlcmUgaXMgbm8gbW9yZSBibG9ja3MgaW4gdGhlIHNhbWUgaXRlbS5cbiAqLyBmdW5jdGlvbiBtZXJnZUxpc3RJdGVtSWZOb3RMYXN0KGJsb2NrLCBwYXJlbnRCbG9jaywgd3JpdGVyKSB7XG4gICAgY29uc3QgcGFyZW50SXRlbUJsb2NrcyA9IGdldExpc3RJdGVtQmxvY2tzKHBhcmVudEJsb2NrLCB7XG4gICAgICAgIGRpcmVjdGlvbjogJ2ZvcndhcmQnXG4gICAgfSk7XG4gICAgLy8gTWVyZ2Ugd2l0aCBwYXJlbnQgb25seSBpZiBvdXRkZW50ZWQgaXRlbSB3YXNuJ3QgdGhlIGxhc3Qgb25lIGluIGl0cyBwYXJlbnQuXG4gICAgLy8gTWVyZ2U6XG4gICAgLy8gKiBhXHRcdFx0LT5cdFx0KiBhXG4gICAgLy8gICAqIFtiXVx0XHQtPlx0XHQgIGJcbiAgICAvLyAgIGNcdFx0XHQtPlx0XHQgIGNcbiAgICAvLyBEb24ndCBtZXJnZTpcbiAgICAvLyAqIGFcdFx0XHQtPlx0XHQqIGFcbiAgICAvLyAgICogW2JdXHRcdC0+IFx0XHQqIGJcbiAgICAvLyAqIGNcdFx0XHQtPlx0XHQqIGNcbiAgICBpZiAocGFyZW50SXRlbUJsb2Nrcy5wb3AoKS5pbmRleCA+IGJsb2NrLmluZGV4KSB7XG4gICAgICAgIHJldHVybiBtZXJnZUxpc3RJdGVtQmVmb3JlKGJsb2NrLCBwYXJlbnRCbG9jaywgd3JpdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xufVxuXG4vKipcbiAqIFRoZSBkb2N1bWVudCBsaXN0IGluZGVudCBjb21tYW5kLiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdH5MaXN0IGxpc3QgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGlzdEluZGVudENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogRGV0ZXJtaW5lcyBieSBob3cgbXVjaCB0aGUgY29tbWFuZCB3aWxsIGNoYW5nZSB0aGUgbGlzdCBpdGVtJ3MgaW5kZW50IGF0dHJpYnV0ZS5cblx0ICovIF9kaXJlY3Rpb247XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIGNvbW1hbmQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlZGl0b3IgVGhlIGVkaXRvciBpbnN0YW5jZS5cblx0ICogQHBhcmFtIGluZGVudERpcmVjdGlvbiBUaGUgZGlyZWN0aW9uIG9mIGluZGVudC4gSWYgaXQgaXMgZXF1YWwgdG8gYGJhY2t3YXJkYCwgdGhlIGNvbW1hbmRcblx0ICogd2lsbCBvdXRkZW50IGEgbGlzdCBpdGVtLlxuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yLCBpbmRlbnREaXJlY3Rpb24pe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICB0aGlzLl9kaXJlY3Rpb24gPSBpbmRlbnREaXJlY3Rpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5pc0VuYWJsZWQgPSB0aGlzLl9jaGVja0VuYWJsZWQoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEluZGVudHMgb3Igb3V0ZGVudHMgKGRlcGVuZGluZyBvbiB0aGUge0BsaW5rICNjb25zdHJ1Y3Rvcn0ncyBgaW5kZW50RGlyZWN0aW9uYCBwYXJhbWV0ZXIpIHNlbGVjdGVkIGxpc3QgaXRlbXMuXG5cdCAqXG5cdCAqIEBmaXJlcyBleGVjdXRlXG5cdCAqIEBmaXJlcyBhZnRlckV4ZWN1dGVcblx0ICovIGV4ZWN1dGUoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGJsb2NrcyA9IGdldFNlbGVjdGVkTGlzdEJsb2Nrcyhtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24pO1xuICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRCbG9ja3MgPSBbXTtcbiAgICAgICAgICAgIC8vIEhhbmRsZSBzZWxlY3Rpb24gY29udGFpbmVkIGluIHRoZSBzaW5nbGUgbGlzdCBpdGVtIGFuZCBzdGFydGluZyBpbiB0aGUgZm9sbG93aW5nIGJsb2Nrcy5cbiAgICAgICAgICAgIGlmIChpc1NpbmdsZUxpc3RJdGVtKGJsb2NrcykgJiYgIWlzRmlyc3RCbG9ja09mTGlzdEl0ZW0oYmxvY2tzWzBdKSkge1xuICAgICAgICAgICAgICAgIC8vIEFsbG93IGluY3JlYXNpbmcgaW5kZW50IG9mIGZvbGxvd2luZyBsaXN0IGl0ZW0gYmxvY2tzLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9kaXJlY3Rpb24gPT0gJ2ZvcndhcmQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaCguLi5pbmRlbnRCbG9ja3MoYmxvY2tzLCB3cml0ZXIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRm9yIGluZGVudCBtYWtlIHN1cmUgdGhhdCBpbmRlbnRlZCBibG9ja3MgaGF2ZSBhIG5ldyBJRC5cbiAgICAgICAgICAgICAgICAvLyBGb3Igb3V0ZGVudCBqdXN0IHNwbGl0IGJsb2NrcyBmcm9tIHRoZSBsaXN0IGl0ZW0gKGdpdmUgdGhlbSBhIG5ldyBJRHMpLlxuICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaCguLi5zcGxpdExpc3RJdGVtQmVmb3JlKGJsb2Nrc1swXSwgd3JpdGVyKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE5vdyBqdXN0IHVwZGF0ZSB0aGUgYXR0cmlidXRlcyBvZiBibG9ja3MuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2RpcmVjdGlvbiA9PSAnZm9yd2FyZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEJsb2Nrcy5wdXNoKC4uLmluZGVudEJsb2NrcyhibG9ja3MsIHdyaXRlciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwYW5kOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkQmxvY2tzLnB1c2goLi4ub3V0ZGVudEJsb2Nrc1dpdGhNZXJnZShibG9ja3MsIHdyaXRlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFsaWduIHRoZSBsaXN0IGl0ZW0gdHlwZSB0byBtYXRjaCB0aGUgcHJldmlvdXMgbGlzdCBpdGVtIChmcm9tIHRoZSBzYW1lIGxpc3QpLlxuICAgICAgICAgICAgZm9yIChjb25zdCBibG9jayBvZiBjaGFuZ2VkQmxvY2tzKXtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGJsb2NrIGJlY29tZSBhIHBsYWluIGJsb2NrIChmb3IgZXhhbXBsZSBhIHBhcmFncmFwaCkuXG4gICAgICAgICAgICAgICAgaWYgKCFibG9jay5oYXNBdHRyaWJ1dGUoJ2xpc3RUeXBlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzSXRlbUJsb2NrID0gTGlzdFdhbGtlci5maXJzdChibG9jaywge1xuICAgICAgICAgICAgICAgICAgICBzYW1lSW5kZW50OiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzSXRlbUJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgcHJldmlvdXNJdGVtQmxvY2suZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpLCBibG9jayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyB0aGUgYGFmdGVyRXhlY3V0ZWAgZXZlbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBjaGFuZ2VkQmxvY2tzIFRoZSBjaGFuZ2VkIGxpc3QgZWxlbWVudHMuXG5cdCAqLyBfZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKSB7XG4gICAgICAgIHRoaXMuZmlyZSgnYWZ0ZXJFeGVjdXRlJywgc29ydEJsb2NrcyhuZXcgU2V0KGNoYW5nZWRCbG9ja3MpKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgY29tbWFuZCBjYW4gYmUgZW5hYmxlZCBpbiB0aGUgY3VycmVudCBjb250ZXh0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuXHQgKi8gX2NoZWNrRW5hYmxlZCgpIHtcbiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciBhbnkgb2YgcG9zaXRpb24ncyBhbmNlc3RvciBpcyBhIGxpc3QgaXRlbS5cbiAgICAgICAgbGV0IGJsb2NrcyA9IGdldFNlbGVjdGVkTGlzdEJsb2Nrcyh0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24pO1xuICAgICAgICBsZXQgZmlyc3RCbG9jayA9IGJsb2Nrc1swXTtcbiAgICAgICAgLy8gSWYgc2VsZWN0aW9uIGlzIG5vdCBpbiBhIGxpc3QgaXRlbSwgdGhlIGNvbW1hbmQgaXMgZGlzYWJsZWQuXG4gICAgICAgIGlmICghZmlyc3RCbG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGFyZSBvdXRkZW50aW5nIGl0IGlzIGVub3VnaCB0byBiZSBpbiBsaXN0IGl0ZW0uIEV2ZXJ5IGxpc3QgaXRlbSBjYW4gYWx3YXlzIGJlIG91dGRlbnRlZC5cbiAgICAgICAgaWYgKHRoaXMuX2RpcmVjdGlvbiA9PSAnYmFja3dhcmQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBIHNpbmdsZSBibG9jayBvZiBhIGxpc3QgaXRlbSBpcyBzZWxlY3RlZCwgc28gaXQgY291bGQgYmUgaW5kZW50ZWQgYXMgYSBzdWJsaXN0LlxuICAgICAgICBpZiAoaXNTaW5nbGVMaXN0SXRlbShibG9ja3MpICYmICFpc0ZpcnN0QmxvY2tPZkxpc3RJdGVtKGJsb2Nrc1swXSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGJsb2NrcyA9IGV4cGFuZExpc3RCbG9ja3NUb0NvbXBsZXRlSXRlbXMoYmxvY2tzKTtcbiAgICAgICAgZmlyc3RCbG9jayA9IGJsb2Nrc1swXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW55IGxpc3QgaXRlbSBiZWZvcmUgc2VsZWN0ZWQgaXRlbXMgdGhhdCBjb3VsZCBiZWNvbWUgYSBwYXJlbnQgb2Ygc2VsZWN0ZWQgaXRlbXMuXG4gICAgICAgIGNvbnN0IHNpYmxpbmdJdGVtID0gTGlzdFdhbGtlci5maXJzdChmaXJzdEJsb2NrLCB7XG4gICAgICAgICAgICBzYW1lSW5kZW50OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXNpYmxpbmdJdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNpYmxpbmdJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PSBmaXJzdEJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKlxuICogUmV0dXJucyBhbiBhcnJheSBvZiBzZWxlY3RlZCBibG9ja3MgdHJ1bmNhdGVkIHRvIHRoZSBmaXJzdCBub24gbGlzdCBibG9jayBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGdldFNlbGVjdGVkTGlzdEJsb2NrcyhzZWxlY3Rpb24pIHtcbiAgICBjb25zdCBibG9ja3MgPSBBcnJheS5mcm9tKHNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpKTtcbiAgICBjb25zdCBmaXJzdE5vbkxpc3RCbG9ja0luZGV4ID0gYmxvY2tzLmZpbmRJbmRleCgoYmxvY2spPT4haXNMaXN0SXRlbUJsb2NrKGJsb2NrKSk7XG4gICAgaWYgKGZpcnN0Tm9uTGlzdEJsb2NrSW5kZXggIT0gLTEpIHtcbiAgICAgICAgYmxvY2tzLmxlbmd0aCA9IGZpcnN0Tm9uTGlzdEJsb2NrSW5kZXg7XG4gICAgfVxuICAgIHJldHVybiBibG9ja3M7XG59XG5cbi8qKlxuICogVGhlIGxpc3QgY29tbWFuZC4gSXQgaXMgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L2xpc3R+TGlzdCBsaXN0IGZlYXR1cmV9LlxuICovIGNsYXNzIExpc3RDb21tYW5kIGV4dGVuZHMgQ29tbWFuZCB7XG4gICAgLyoqXG5cdCAqIFRoZSB0eXBlIG9mIHRoZSBsaXN0IGNyZWF0ZWQgYnkgdGhlIGNvbW1hbmQuXG5cdCAqLyB0eXBlO1xuICAgIC8qKlxuXHQgKiBMaXN0IFdhbGtlciBvcHRpb25zIHRoYXQgY2hhbmdlIHRoZSByYW5nZSBvZiB0aGUgbGlzdCBpdGVtcyB0byBiZSBjaGFuZ2VkIHdoZW4gdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgd2l0aGluIGEgbGlzdCBpdGVtLlxuXHQgKlxuXHQgKiBJbiBhIG11bHRpLWxldmVsIGxpc3QsIHdoZW4gdGhlIHNlbGVjdGlvbiBpcyBjb2xsYXBzZWQgd2l0aGluIGEgbGlzdCBpdGVtLCBpbnN0ZWFkIG9mIGNoYW5naW5nIG9ubHkgdGhlIGxpc3QgaXRlbXMgb2YgdGhlIHNhbWUgbGlzdFxuXHQgKiB0eXBlIGFuZCBjdXJyZW50IGluZGVudCBsZXZlbCwgdGhlIGVudGlyZSBsaXN0IHN0cnVjdHVyZSBpcyBjaGFuZ2VkIChhbGwgbGlzdCBpdGVtcyBhdCBhbGwgaW5kZW50IGxldmVscyBvZiBhbnkgbGlzdCB0eXBlKS5cblx0ICovIF9saXN0V2Fsa2VyT3B0aW9ucztcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgY29tbWFuZC5cblx0ICpcblx0ICogQHBhcmFtIGVkaXRvciBUaGUgZWRpdG9yIGluc3RhbmNlLlxuXHQgKiBAcGFyYW0gdHlwZSBMaXN0IHR5cGUgdGhhdCB3aWxsIGJlIGhhbmRsZWQgYnkgdGhpcyBjb21tYW5kLlxuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yLCB0eXBlLCBvcHRpb25zID0ge30pe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLl9saXN0V2Fsa2VyT3B0aW9ucyA9IG9wdGlvbnMubXVsdGlMZXZlbCA/IHtcbiAgICAgICAgICAgIGhpZ2hlckluZGVudDogdHJ1ZSxcbiAgICAgICAgICAgIGxvd2VySW5kZW50OiB0cnVlLFxuICAgICAgICAgICAgc2FtZUF0dHJpYnV0ZXM6IFtdXG4gICAgICAgIH0gOiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2dldFZhbHVlKCk7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdGhpcy5fY2hlY2tFbmFibGVkKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyB0aGUgbGlzdCBjb21tYW5kLlxuXHQgKlxuXHQgKiBAZmlyZXMgZXhlY3V0ZVxuXHQgKiBAZmlyZXMgYWZ0ZXJFeGVjdXRlXG5cdCAqIEBwYXJhbSBvcHRpb25zIENvbW1hbmQgb3B0aW9ucy5cblx0ICogQHBhcmFtIG9wdGlvbnMuZm9yY2VWYWx1ZSBJZiBzZXQsIGl0IHdpbGwgZm9yY2UgdGhlIGNvbW1hbmQgYmVoYXZpb3IuIElmIGB0cnVlYCwgdGhlIGNvbW1hbmQgd2lsbCB0cnkgdG8gY29udmVydCB0aGVcblx0ICogc2VsZWN0ZWQgaXRlbXMgYW5kIHBvdGVudGlhbGx5IHRoZSBuZWlnaGJvciBlbGVtZW50cyB0byB0aGUgcHJvcGVyIGxpc3QgaXRlbXMuIElmIHNldCB0byBgZmFsc2VgIGl0IHdpbGwgY29udmVydCBzZWxlY3RlZCBlbGVtZW50c1xuXHQgKiB0byBwYXJhZ3JhcGhzLiBJZiBub3Qgc2V0LCB0aGUgY29tbWFuZCB3aWxsIHRvZ2dsZSBzZWxlY3RlZCBlbGVtZW50cyB0byBsaXN0IGl0ZW1zIG9yIHBhcmFncmFwaHMsIGRlcGVuZGluZyBvbiB0aGUgc2VsZWN0aW9uLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5hZGRpdGlvbmFsQXR0cmlidXRlcyBBZGRpdGlvbmFsIGF0dHJpYnV0ZXMgdGhhdCBhcmUgc2V0IGZvciBsaXN0IGl0ZW1zIHdoZW4gdGhlIGNvbW1hbmQgaXMgZXhlY3V0ZWQuXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBzZWxlY3RlZEJsb2NrT2JqZWN0ID0gZ2V0U2VsZWN0ZWRCbG9ja09iamVjdChtb2RlbCk7XG4gICAgICAgIGNvbnN0IGJsb2NrcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpLmZpbHRlcigoYmxvY2spPT5tb2RlbC5zY2hlbWEuY2hlY2tBdHRyaWJ1dGUoYmxvY2ssICdsaXN0VHlwZScpIHx8IGNhbkJlY29tZVNpbXBsZUxpc3RJdGVtKGJsb2NrLCBtb2RlbC5zY2hlbWEpKTtcbiAgICAgICAgLy8gV2hldGhlciB3ZSBhcmUgdHVybmluZyBvZmYgc29tZSBpdGVtcy5cbiAgICAgICAgY29uc3QgdHVybk9mZiA9IG9wdGlvbnMuZm9yY2VWYWx1ZSAhPT0gdW5kZWZpbmVkID8gIW9wdGlvbnMuZm9yY2VWYWx1ZSA6IHRoaXMudmFsdWU7XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgaWYgKHR1cm5PZmYpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0QmxvY2sgPSBibG9ja3NbYmxvY2tzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgIC8vIFNwbGl0IHRoZSBmaXJzdCBibG9jayBmcm9tIHRoZSBsaXN0IGl0ZW0uXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbUJsb2NrcyA9IGdldExpc3RJdGVtQmxvY2tzKGxhc3RCbG9jaywge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdmb3J3YXJkJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRCbG9ja3MgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbUJsb2Nrcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaCguLi5zcGxpdExpc3RJdGVtQmVmb3JlKGl0ZW1CbG9ja3NbMV0sIHdyaXRlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTdHJpcCBsaXN0IGF0dHJpYnV0ZXMuXG4gICAgICAgICAgICAgICAgY2hhbmdlZEJsb2Nrcy5wdXNoKC4uLnJlbW92ZUxpc3RBdHRyaWJ1dGVzKGJsb2Nrcywgd3JpdGVyKSk7XG4gICAgICAgICAgICAgICAgLy8gT3V0ZGVudCBpdGVtcyBmb2xsb3dpbmcgdGhlIHNlbGVjdGVkIGxpc3QgaXRlbS5cbiAgICAgICAgICAgICAgICBjaGFuZ2VkQmxvY2tzLnB1c2goLi4ub3V0ZGVudEZvbGxvd2luZ0l0ZW1zKGxhc3RCbG9jaywgd3JpdGVyKSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoKHNlbGVjdGVkQmxvY2tPYmplY3QgfHwgZG9jdW1lbnQuc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSAmJiBpc0xpc3RJdGVtQmxvY2soYmxvY2tzWzBdKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRCbG9ja3MgPSBnZXRMaXN0SXRlbXMoc2VsZWN0ZWRCbG9ja09iamVjdCB8fCBibG9ja3NbMF0sIHRoaXMuX2xpc3RXYWxrZXJPcHRpb25zKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGNoYW5nZWRCbG9ja3Mpe1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLmFkZGl0aW9uYWxBdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdFR5cGU6IHRoaXMudHlwZVxuICAgICAgICAgICAgICAgICAgICB9LCBibG9jayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpcmVBZnRlckV4ZWN1dGUoY2hhbmdlZEJsb2Nrcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5nZWRCbG9ja3MgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgICAgICAgICAgICAgIC8vIFByb21vdGUgdGhlIGdpdmVuIGJsb2NrIHRvIHRoZSBsaXN0IGl0ZW0uXG4gICAgICAgICAgICAgICAgICAgIGlmICghYmxvY2suaGFzQXR0cmlidXRlKCdsaXN0VHlwZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW5hbWUgYmxvY2sgdG8gYSBzaW1wbGUgbGlzdCBpdGVtIGlmIHRoaXMgb3B0aW9uIGlzIGVuYWJsZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJsb2NrLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykgJiYgY2FuQmVjb21lU2ltcGxlTGlzdEl0ZW0oYmxvY2ssIG1vZGVsLnNjaGVtYSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVuYW1lKGJsb2NrLCAnbGlzdEl0ZW0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLmFkZGl0aW9uYWxBdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RJbmRlbnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW1JZDogTGlzdEl0ZW1VaWQubmV4dCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RUeXBlOiB0aGlzLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGJsb2NrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaChibG9jayk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9jaywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhOZXN0ZWQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9IHRoaXMudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zLmFkZGl0aW9uYWxBdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdFR5cGU6IHRoaXMudHlwZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZEJsb2Nrcy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9maXJlQWZ0ZXJFeGVjdXRlKGNoYW5nZWRCbG9ja3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEZpcmVzIHRoZSBgYWZ0ZXJFeGVjdXRlYCBldmVudC5cblx0ICpcblx0ICogQHBhcmFtIGNoYW5nZWRCbG9ja3MgVGhlIGNoYW5nZWQgbGlzdCBlbGVtZW50cy5cblx0ICovIF9maXJlQWZ0ZXJFeGVjdXRlKGNoYW5nZWRCbG9ja3MpIHtcbiAgICAgICAgdGhpcy5maXJlKCdhZnRlckV4ZWN1dGUnLCBzb3J0QmxvY2tzKG5ldyBTZXQoY2hhbmdlZEJsb2NrcykpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB0aGUgY29tbWFuZCdzIHtAbGluayAjdmFsdWV9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBUaGUgY3VycmVudCB2YWx1ZS5cblx0ICovIF9nZXRWYWx1ZSgpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBibG9ja3MgPSBBcnJheS5mcm9tKHNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpKTtcbiAgICAgICAgaWYgKCFibG9ja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBibG9jayBvZiBibG9ja3Mpe1xuICAgICAgICAgICAgaWYgKGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPSB0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgY29tbWFuZCBjYW4gYmUgZW5hYmxlZCBpbiB0aGUgY3VycmVudCBjb250ZXh0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuXHQgKi8gX2NoZWNrRW5hYmxlZCgpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IGJsb2NrcyA9IEFycmF5LmZyb20oc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgICAgICBpZiAoIWJsb2Nrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBjb21tYW5kIHZhbHVlIGlzIHRydWUgaXQgbWVhbnMgdGhhdCB3ZSBhcmUgaW4gbGlzdCBpdGVtLCBzbyB0aGUgY29tbWFuZCBzaG91bGQgYmUgZW5hYmxlZC5cbiAgICAgICAgaWYgKHRoaXMudmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgYmxvY2sgb2YgYmxvY2tzKXtcbiAgICAgICAgICAgIGlmIChzY2hlbWEuY2hlY2tBdHRyaWJ1dGUoYmxvY2ssICdsaXN0VHlwZScpIHx8IGNhbkJlY29tZVNpbXBsZUxpc3RJdGVtKGJsb2NrLCBzY2hlbWEpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgZG9jdW1lbnQgbGlzdCBtZXJnZSBjb21tYW5kLiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdH5MaXN0IGxpc3QgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGlzdE1lcmdlQ29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICAgIC8qKlxuXHQgKiBXaGV0aGVyIGxpc3QgaXRlbSBzaG91bGQgYmUgbWVyZ2VkIGJlZm9yZSBvciBhZnRlciB0aGUgc2VsZWN0ZWQgYmxvY2suXG5cdCAqLyBfZGlyZWN0aW9uO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWRpdG9yIFRoZSBlZGl0b3IgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBkaXJlY3Rpb24gV2hldGhlciBsaXN0IGl0ZW0gc2hvdWxkIGJlIG1lcmdlZCBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHNlbGVjdGVkIGJsb2NrLlxuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yLCBkaXJlY3Rpb24pe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICB0aGlzLl9kaXJlY3Rpb24gPSBkaXJlY3Rpb247XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5pc0VuYWJsZWQgPSB0aGlzLl9jaGVja0VuYWJsZWQoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1lcmdlcyBsaXN0IGJsb2NrcyB0b2dldGhlciAoZGVwZW5kaW5nIG9uIHRoZSB7QGxpbmsgI2NvbnN0cnVjdG9yfSdzIGBkaXJlY3Rpb25gIHBhcmFtZXRlcikuXG5cdCAqXG5cdCAqIEBmaXJlcyBleGVjdXRlXG5cdCAqIEBmaXJlcyBhZnRlckV4ZWN1dGVcblx0ICogQHBhcmFtIG9wdGlvbnMgQ29tbWFuZCBvcHRpb25zLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zaG91bGRNZXJnZU9uQmxvY2tzQ29udGVudExldmVsIFdoZW4gc2V0IGB0cnVlYCwgbWVyZ2luZyB3aWxsIGJlIHBlcmZvcm1lZCB0b2dldGhlclxuXHQgKiB3aXRoIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2RlbGV0ZUNvbnRlbnR9IHRvIGdldCByaWQgb2YgdGhlIGlubGluZSBjb250ZW50IGluIHRoZSBzZWxlY3Rpb24gb3IgdGFrZSBhZHZhbnRhZ2Vcblx0ICogb2YgdGhlIGhldXJpc3RpY3MgaW4gYGRlbGV0ZUNvbnRlbnQoKWAgdGhhdCBoZWxwcyBjb252ZXJ0IGxpc3RzIGludG8gcGFyYWdyYXBocyBpbiBjZXJ0YWluIGNhc2VzLlxuXHQgKi8gZXhlY3V0ZSh7IHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWwgPSBmYWxzZSB9ID0ge30pIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBjaGFuZ2VkQmxvY2tzID0gW107XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgeyBmaXJzdEVsZW1lbnQsIGxhc3RFbGVtZW50IH0gPSB0aGlzLl9nZXRNZXJnZVN1YmplY3RFbGVtZW50cyhzZWxlY3Rpb24sIHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWwpO1xuICAgICAgICAgICAgY29uc3QgZmlyc3RJbmRlbnQgPSBmaXJzdEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgfHwgMDtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RJbmRlbnQgPSBsYXN0RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RFbGVtZW50SWQgPSBsYXN0RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RJdGVtSWQnKTtcbiAgICAgICAgICAgIGlmIChmaXJzdEluZGVudCAhPSBsYXN0SW5kZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmVzdGVkTGFzdEVsZW1lbnRCbG9ja3MgPSBnZXROZXN0ZWRMaXN0QmxvY2tzKGxhc3RFbGVtZW50KTtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkQmxvY2tzLnB1c2goLi4uaW5kZW50QmxvY2tzKFtcbiAgICAgICAgICAgICAgICAgICAgbGFzdEVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICAgIC4uLm5lc3RlZExhc3RFbGVtZW50QmxvY2tzXG4gICAgICAgICAgICAgICAgXSwgd3JpdGVyLCB7XG4gICAgICAgICAgICAgICAgICAgIGluZGVudEJ5OiBmaXJzdEluZGVudCAtIGxhc3RJbmRlbnQsXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG91dGRlbnRpbmcsIHRoZSBlbnRpcmUgc3ViLXRyZWUgdGhhdCBmb2xsb3dzIG11c3QgYmUgaW5jbHVkZWQuXG4gICAgICAgICAgICAgICAgICAgIGV4cGFuZDogZmlyc3RJbmRlbnQgPCBsYXN0SW5kZW50XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBsZXQgc2VsID0gc2VsZWN0aW9uO1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsID0gd3JpdGVyLmNyZWF0ZVNlbGVjdGlvbih3cml0ZXIuY3JlYXRlUmFuZ2Uod3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoZmlyc3RFbGVtZW50LCAnZW5kJyksIHdyaXRlci5jcmVhdGVQb3NpdGlvbkF0KGxhc3RFbGVtZW50LCAwKSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBEZWxldGUgc2VsZWN0ZWQgY29udGVudC4gUmVwbGFjZSBlbnRpcmUgY29udGVudCBvbmx5IGZvciBub24tY29sbGFwc2VkIHNlbGVjdGlvbi5cbiAgICAgICAgICAgICAgICBtb2RlbC5kZWxldGVDb250ZW50KHNlbCwge1xuICAgICAgICAgICAgICAgICAgICBkb05vdFJlc2V0RW50aXJlQ29udGVudDogc2VsZWN0aW9uLmlzQ29sbGFwc2VkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBsYXN0IFwidG91Y2hlZFwiIGVsZW1lbnQgYWZ0ZXIgZGVsZXRlQ29udGVudCBjYWxsIChjYW4ndCB1c2UgdGhlIGxhc3RFbGVtZW50IGJlY2F1c2VcbiAgICAgICAgICAgICAgICAvLyBpdCBjb3VsZCBnZXQgbWVyZ2VkIGludG8gdGhlIGZpcnN0RWxlbWVudCB3aGlsZSBkZWxldGluZyBjb250ZW50KS5cbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0RWxlbWVudEFmdGVyRGVsZXRlID0gc2VsLmdldExhc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZWxlbWVudCBhZnRlciBpdCB3YXMgaW4gdGhlIHNhbWUgbGlzdCBpdGVtIGFuZCBhZGp1c3QgaXQgaWYgbmVlZGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRTaWJsaW5nID0gbGFzdEVsZW1lbnRBZnRlckRlbGV0ZS5uZXh0U2libGluZztcbiAgICAgICAgICAgICAgICBjaGFuZ2VkQmxvY2tzLnB1c2gobGFzdEVsZW1lbnRBZnRlckRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRTaWJsaW5nICYmIG5leHRTaWJsaW5nICE9PSBsYXN0RWxlbWVudCAmJiBuZXh0U2libGluZy5nZXRBdHRyaWJ1dGUoJ2xpc3RJdGVtSWQnKSA9PSBsYXN0RWxlbWVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaCguLi5tZXJnZUxpc3RJdGVtQmVmb3JlKG5leHRTaWJsaW5nLCBsYXN0RWxlbWVudEFmdGVyRGVsZXRlLCB3cml0ZXIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoYW5nZWRCbG9ja3MucHVzaCguLi5tZXJnZUxpc3RJdGVtQmVmb3JlKGxhc3RFbGVtZW50LCBmaXJzdEVsZW1lbnQsIHdyaXRlcikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyB0aGUgYGFmdGVyRXhlY3V0ZWAgZXZlbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBjaGFuZ2VkQmxvY2tzIFRoZSBjaGFuZ2VkIGxpc3QgZWxlbWVudHMuXG5cdCAqLyBfZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKSB7XG4gICAgICAgIHRoaXMuZmlyZSgnYWZ0ZXJFeGVjdXRlJywgc29ydEJsb2NrcyhuZXcgU2V0KGNoYW5nZWRCbG9ja3MpKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgY29tbWFuZCBjYW4gYmUgZW5hYmxlZCBpbiB0aGUgY3VycmVudCBjb250ZXh0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuXHQgKi8gX2NoZWNrRW5hYmxlZCgpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEJsb2NrT2JqZWN0ID0gZ2V0U2VsZWN0ZWRCbG9ja09iamVjdChtb2RlbCk7XG4gICAgICAgIGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQgfHwgc2VsZWN0ZWRCbG9ja09iamVjdCkge1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBzZWxlY3RlZEJsb2NrT2JqZWN0IHx8IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkucGFyZW50O1xuICAgICAgICAgICAgaWYgKCFpc0xpc3RJdGVtQmxvY2socG9zaXRpb25QYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2libGluZ05vZGUgPSB0aGlzLl9kaXJlY3Rpb24gPT0gJ2JhY2t3YXJkJyA/IHBvc2l0aW9uUGFyZW50LnByZXZpb3VzU2libGluZyA6IHBvc2l0aW9uUGFyZW50Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgaWYgKCFzaWJsaW5nTm9kZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1NpbmdsZUxpc3RJdGVtKFtcbiAgICAgICAgICAgICAgICBwb3NpdGlvblBhcmVudCxcbiAgICAgICAgICAgICAgICBzaWJsaW5nTm9kZVxuICAgICAgICAgICAgXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBsYXN0UG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0TGFzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBmaXJzdFBvc2l0aW9uID0gc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIC8vIElmIGRlbGV0aW5nIHdpdGhpbiBhIHNpbmdsZSBibG9jayBvZiBhIGxpc3QgaXRlbSwgdGhlcmUncyBubyBuZWVkIHRvIG1lcmdlIGFueXRoaW5nLlxuICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZGVsZXRlIHNob3VsZCBiZSBleGVjdXRlZCBpbnN0ZWFkLlxuICAgICAgICAgICAgaWYgKGxhc3RQb3NpdGlvbi5wYXJlbnQgPT09IGZpcnN0UG9zaXRpb24ucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpc0xpc3RJdGVtQmxvY2sobGFzdFBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBib3VuZGFyeSBlbGVtZW50cyB0aGUgbWVyZ2Ugc2hvdWxkIGJlIGV4ZWN1dGVkIGZvci4gVGhlc2UgYXJlIG5vdCBuZWNlc3NhcmlseSBzZWxlY3Rpb24ncyBmaXJzdFxuXHQgKiBhbmQgbGFzdCBwb3NpdGlvbiBwYXJlbnRzIGJ1dCBzb21ldGltZXMgc2libGluZyBvciBldmVuIGZ1cnRoZXIgYmxvY2tzIGRlcGVuZGluZyBvbiB0aGUgY29udGV4dC5cblx0ICpcblx0ICogQHBhcmFtIHNlbGVjdGlvbiBUaGUgc2VsZWN0aW9uIHRoZSBtZXJnZSBpcyBleGVjdXRlZCBmb3IuXG5cdCAqIEBwYXJhbSBzaG91bGRNZXJnZU9uQmxvY2tzQ29udGVudExldmVsIFdoZW4gYHRydWVgLCBtZXJnZSBpcyBwZXJmb3JtZWQgdG9nZXRoZXIgd2l0aFxuXHQgKiB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9tb2RlbH5Nb2RlbCNkZWxldGVDb250ZW50fSB0byByZW1vdmUgdGhlIGlubGluZSBjb250ZW50IHdpdGhpbiB0aGUgc2VsZWN0aW9uLlxuXHQgKi8gX2dldE1lcmdlU3ViamVjdEVsZW1lbnRzKHNlbGVjdGlvbiwgc2hvdWxkTWVyZ2VPbkJsb2Nrc0NvbnRlbnRMZXZlbCkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBzZWxlY3RlZEJsb2NrT2JqZWN0ID0gZ2V0U2VsZWN0ZWRCbG9ja09iamVjdChtb2RlbCk7XG4gICAgICAgIGxldCBmaXJzdEVsZW1lbnQsIGxhc3RFbGVtZW50O1xuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkIHx8IHNlbGVjdGVkQmxvY2tPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gc2VsZWN0ZWRCbG9ja09iamVjdCB8fCBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGlzRmlyc3RCbG9jayA9IGlzRmlyc3RCbG9ja09mTGlzdEl0ZW0ocG9zaXRpb25QYXJlbnQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RpcmVjdGlvbiA9PSAnYmFja3dhcmQnKSB7XG4gICAgICAgICAgICAgICAgbGFzdEVsZW1lbnQgPSBwb3NpdGlvblBhcmVudDtcbiAgICAgICAgICAgICAgICBpZiAoaXNGaXJzdEJsb2NrICYmICFzaG91bGRNZXJnZU9uQmxvY2tzQ29udGVudExldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZvciB0aGUgXCJjXCIgYXMgYW4gYW5jaG9yRWxlbWVudDpcbiAgICAgICAgICAgICAgICAgICAgLy8gICogYVxuICAgICAgICAgICAgICAgICAgICAvLyAgICAqIGJcbiAgICAgICAgICAgICAgICAgICAgLy8gICogW2NdICA8LS0gdGhpcyBibG9jayBzaG91bGQgYmUgbWVyZ2VkIHdpdGggXCJhXCJcbiAgICAgICAgICAgICAgICAgICAgLy8gSXQgc2hvdWxkIGZpbmQgXCJhXCIgZWxlbWVudCB0byBtZXJnZSB3aXRoOlxuICAgICAgICAgICAgICAgICAgICAvLyAgKiBhXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICogYlxuICAgICAgICAgICAgICAgICAgICAvLyAgICBjXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0RWxlbWVudCA9IExpc3RXYWxrZXIuZmlyc3QocG9zaXRpb25QYXJlbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsb3dlckluZGVudDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaXJzdEVsZW1lbnQgPSBwb3NpdGlvblBhcmVudC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBjYXNlIG9mIHRoZSBmb3J3YXJkIG1lcmdlIHRoZXJlIGlzIG5vIGNhc2UgYXMgYWJvdmUsIGp1c3QgbWVyZ2Ugd2l0aCBuZXh0IHNpYmxpbmcuXG4gICAgICAgICAgICAgICAgZmlyc3RFbGVtZW50ID0gcG9zaXRpb25QYXJlbnQ7XG4gICAgICAgICAgICAgICAgbGFzdEVsZW1lbnQgPSBwb3NpdGlvblBhcmVudC5uZXh0U2libGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpcnN0RWxlbWVudCA9IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkucGFyZW50O1xuICAgICAgICAgICAgbGFzdEVsZW1lbnQgPSBzZWxlY3Rpb24uZ2V0TGFzdFBvc2l0aW9uKCkucGFyZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaXJzdEVsZW1lbnQ6IGZpcnN0RWxlbWVudCxcbiAgICAgICAgICAgIGxhc3RFbGVtZW50OiBsYXN0RWxlbWVudFxuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgZG9jdW1lbnQgbGlzdCBzcGxpdCBjb21tYW5kIHRoYXQgc3BsaXRzIHRoZSBsaXN0IGl0ZW0gYXQgdGhlIHNlbGVjdGlvbi5cbiAqXG4gKiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdH5MaXN0IGxpc3QgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGlzdFNwbGl0Q29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICAgIC8qKlxuXHQgKiBXaGV0aGVyIGxpc3QgaXRlbSBzaG91bGQgYmUgc3BsaXQgYmVmb3JlIG9yIGFmdGVyIHRoZSBzZWxlY3RlZCBibG9jay5cblx0ICovIF9kaXJlY3Rpb247XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIGNvbW1hbmQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlZGl0b3IgVGhlIGVkaXRvciBpbnN0YW5jZS5cblx0ICogQHBhcmFtIGRpcmVjdGlvbiBXaGV0aGVyIGxpc3QgaXRlbSBzaG91bGQgYmUgc3BsaXQgYmVmb3JlIG9yIGFmdGVyIHRoZSBzZWxlY3RlZCBibG9jay5cblx0ICovIGNvbnN0cnVjdG9yKGVkaXRvciwgZGlyZWN0aW9uKXtcbiAgICAgICAgc3VwZXIoZWRpdG9yKTtcbiAgICAgICAgdGhpcy5fZGlyZWN0aW9uID0gZGlyZWN0aW9uO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdGhpcy5fY2hlY2tFbmFibGVkKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTcGxpdHMgdGhlIGxpc3QgaXRlbSBhdCB0aGUgc2VsZWN0aW9uLlxuXHQgKlxuXHQgKiBAZmlyZXMgZXhlY3V0ZVxuXHQgKiBAZmlyZXMgYWZ0ZXJFeGVjdXRlXG5cdCAqLyBleGVjdXRlKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlZEJsb2NrcyA9IHNwbGl0TGlzdEl0ZW1CZWZvcmUodGhpcy5fZ2V0U3RhcnRCbG9jaygpLCB3cml0ZXIpO1xuICAgICAgICAgICAgdGhpcy5fZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGaXJlcyB0aGUgYGFmdGVyRXhlY3V0ZWAgZXZlbnQuXG5cdCAqXG5cdCAqIEBwYXJhbSBjaGFuZ2VkQmxvY2tzIFRoZSBjaGFuZ2VkIGxpc3QgZWxlbWVudHMuXG5cdCAqLyBfZmlyZUFmdGVyRXhlY3V0ZShjaGFuZ2VkQmxvY2tzKSB7XG4gICAgICAgIHRoaXMuZmlyZSgnYWZ0ZXJFeGVjdXRlJywgc29ydEJsb2NrcyhuZXcgU2V0KGNoYW5nZWRCbG9ja3MpKSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgY29tbWFuZCBjYW4gYmUgZW5hYmxlZCBpbiB0aGUgY3VycmVudCBjb250ZXh0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuXHQgKi8gX2NoZWNrRW5hYmxlZCgpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBibG9jayA9IHRoaXMuX2dldFN0YXJ0QmxvY2soKTtcbiAgICAgICAgcmV0dXJuIHNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBpc0xpc3RJdGVtQmxvY2soYmxvY2spICYmICFpc0ZpcnN0QmxvY2tPZkxpc3RJdGVtKGJsb2NrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdGhlIG1vZGVsIGVsZW1lbnQgdGhhdCBpcyB0aGUgbWFpbiBmb2N1cyBvZiB0aGUgY29tbWFuZCAoYWNjb3JkaW5nIHRvIHRoZSBjdXJyZW50IHNlbGVjdGlvbiBhbmQgY29tbWFuZCBkaXJlY3Rpb24pLlxuXHQgKi8gX2dldFN0YXJ0QmxvY2soKSB7XG4gICAgICAgIGNvbnN0IGRvYyA9IHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBwb3NpdGlvblBhcmVudCA9IGRvYy5zZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbiA9PSAnYmVmb3JlJyA/IHBvc2l0aW9uUGFyZW50IDogcG9zaXRpb25QYXJlbnQubmV4dFNpYmxpbmc7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgc2V0IG9mIGhlbHBlcnMgcmVsYXRlZCB0byBkb2N1bWVudCBsaXN0cy5cbiAqLyBjbGFzcyBMaXN0VXRpbHMgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xpc3RVdGlscyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4cGFuZHMgdGhlIGdpdmVuIGxpc3Qgb2Ygc2VsZWN0ZWQgYmxvY2tzIHRvIGluY2x1ZGUgYWxsIHRoZSBpdGVtcyBvZiB0aGUgbGlzdHMgdGhleSdyZSBpbi5cblx0ICpcblx0ICogQHBhcmFtIGJsb2NrcyBUaGUgbGlzdCBvZiBzZWxlY3RlZCBibG9ja3MuXG5cdCAqLyBleHBhbmRMaXN0QmxvY2tzVG9Db21wbGV0ZUxpc3QoYmxvY2tzKSB7XG4gICAgICAgIHJldHVybiBleHBhbmRMaXN0QmxvY2tzVG9Db21wbGV0ZUxpc3QoYmxvY2tzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrIGlmIHRoZSBnaXZlbiBibG9jayBpcyB0aGUgZmlyc3QgaW4gdGhlIGxpc3QgaXRlbS5cblx0ICpcblx0ICogQHBhcmFtIGxpc3RCbG9jayBUaGUgbGlzdCBibG9jayBlbGVtZW50LlxuXHQgKi8gaXNGaXJzdEJsb2NrT2ZMaXN0SXRlbShsaXN0QmxvY2spIHtcbiAgICAgICAgcmV0dXJuIGlzRmlyc3RCbG9ja09mTGlzdEl0ZW0obGlzdEJsb2NrKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gbW9kZWwgbm9kZSBpcyBhIGxpc3QgaXRlbSBibG9jay5cblx0ICpcblx0ICogQHBhcmFtIG5vZGUgQSBtb2RlbCBub2RlLlxuXHQgKi8gaXNMaXN0SXRlbUJsb2NrKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGlzTGlzdEl0ZW1CbG9jayhub2RlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4cGFuZHMgdGhlIGdpdmVuIGxpc3Qgb2Ygc2VsZWN0ZWQgYmxvY2tzIHRvIGluY2x1ZGUgdGhlIGxlYWRpbmcgYW5kIHRhaWxpbmcgYmxvY2tzIG9mIHBhcnRpYWxseSBzZWxlY3RlZCBsaXN0IGl0ZW1zLlxuXHQgKlxuXHQgKiBAcGFyYW0gYmxvY2tzIFRoZSBsaXN0IG9mIHNlbGVjdGVkIGJsb2Nrcy5cblx0ICogQHBhcmFtIG9wdGlvbnMud2l0aE5lc3RlZCBXaGV0aGVyIHNob3VsZCBpbmNsdWRlIG5lc3RlZCBsaXN0IGl0ZW1zLlxuXHQgKi8gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9ja3MsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVJdGVtcyhibG9ja3MsIG9wdGlvbnMpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0cnVlIGlmIGxpc3RUeXBlIGlzIG9mIHR5cGUgYG51bWJlcmVkYCBvciBgY3VzdG9tTnVtYmVyZWRgLlxuXHQgKi8gaXNOdW1iZXJlZExpc3RUeXBlKGxpc3RUeXBlKSB7XG4gICAgICAgIHJldHVybiBpc051bWJlcmVkTGlzdFR5cGUobGlzdFR5cGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZSBDb3B5cmlnaHQgKGMpIDIwMDMtMjAyNSwgQ0tTb3VyY2UgSG9sZGluZyBzcC4geiBvLm8uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBGb3IgbGljZW5zaW5nLCBzZWUgTElDRU5TRS5tZCBvciBodHRwczovL2NrZWRpdG9yLmNvbS9sZWdhbC9ja2VkaXRvci1saWNlbnNpbmctb3B0aW9uc1xuICovIC8qKlxuICogQG1vZHVsZSBsaXN0L2xpc3QvdXRpbHMvdmlld1xuICovIC8qKlxuICogQ2hlY2tzIGlmIHZpZXcgZWxlbWVudCBpcyBhIGxpc3QgdHlwZSAodWwgb3Igb2wpLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIGlzTGlzdFZpZXcodmlld0VsZW1lbnQpIHtcbiAgICByZXR1cm4gdmlld0VsZW1lbnQuaXMoJ2VsZW1lbnQnLCAnb2wnKSB8fCB2aWV3RWxlbWVudC5pcygnZWxlbWVudCcsICd1bCcpO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgdmlldyBlbGVtZW50IGlzIGEgbGlzdCBpdGVtIChsaSkuXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gaXNMaXN0SXRlbVZpZXcodmlld0VsZW1lbnQpIHtcbiAgICByZXR1cm4gdmlld0VsZW1lbnQuaXMoJ2VsZW1lbnQnLCAnbGknKTtcbn1cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgaW5kZW50IHZhbHVlIGZvciBhIGxpc3QgaXRlbS4gSGFuZGxlcyBIVE1MIGNvbXBsaWFudCBhbmQgbm9uLWNvbXBsaWFudCBsaXN0cy5cbiAqXG4gKiBBbHNvLCBmaXhlcyBub24gSFRNTCBjb21wbGlhbnQgbGlzdHMgaW5kZW50czpcbiAqXG4gKiBgYGBcbiAqIGJlZm9yZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWQgbGlzdDpcbiAqIE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0xcbiAqIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICAgICAgICAgICAgICAgfC0+IExJICAgICAoaW5kZW50OiAwKVxuICogICAgIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8LT4gT0xcbiAqICAgICAgICAgfC0+IE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgICAgfCAgIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgICAgfCAgICAgICB8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgICAgfCAgICAgICAgICAgfC0+IExJIChwYXJlbnQgTElzOiAxKSAgICAgIHwtPiBMSSAoaW5kZW50OiAxKVxuICogICAgICAgICB8LT4gTEkgKHBhcmVudCBMSXM6IDEpICAgICAgICAgICAgICAgICAgfC0+IExJIChpbmRlbnQ6IDEpXG4gKlxuICogYmVmb3JlOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXhlZCBsaXN0OlxuICogT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPTFxuICogfC0+IE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgfC0+IE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgICAgIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICAgICAgICAgICAgIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICB8LT4gTEkgICAgICAgIChpbmRlbnQ6IDApXG4gKlxuICogYmVmb3JlOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXhlZCBsaXN0OlxuICogT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPTFxuICogfC0+IExJIChwYXJlbnQgTElzOiAwKSAgICAgICAgICAgICAgICAgICAgICB8LT4gTEkgICAgICAgICAoaW5kZW50OiAwKVxuICogfC0+IE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfC0+IE9MXG4gKiAgICAgfC0+IExJIChwYXJlbnQgTElzOiAwKSAgICAgICAgICAgICAgICAgICAgICAgICAgfC0+IExJIChpbmRlbnQ6IDEpXG4gKiBgYGBcbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBnZXRJbmRlbnQkMShsaXN0SXRlbSkge1xuICAgIGxldCBpbmRlbnQgPSAwO1xuICAgIGxldCBwYXJlbnQgPSBsaXN0SXRlbS5wYXJlbnQ7XG4gICAgd2hpbGUocGFyZW50KXtcbiAgICAgICAgLy8gRWFjaCBMSSBpbiB0aGUgdHJlZSB3aWxsIHJlc3VsdCBpbiBhbiBpbmNyZWFzZWQgaW5kZW50IGZvciBIVE1MIGNvbXBsaWFudCBsaXN0cy5cbiAgICAgICAgaWYgKGlzTGlzdEl0ZW1WaWV3KHBhcmVudCkpIHtcbiAgICAgICAgICAgIGluZGVudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgaG93ZXZlciB0aGUgbGlzdCBpcyBuZXN0ZWQgaW4gb3RoZXIgbGlzdCB3ZSBzaG91bGQgY2hlY2sgcHJldmlvdXMgc2libGluZyBvZiBhbnkgb2YgdGhlIGxpc3QgZWxlbWVudHMuLi5cbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IHBhcmVudC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICAvLyAuLi5iZWNhdXNlIHRoZSB3ZSBtaWdodCBuZWVkIGluY3JlYXNlIGl0cyBpbmRlbnQ6XG4gICAgICAgICAgICAvL1x0XHRiZWZvcmU6ICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWQgbGlzdDpcbiAgICAgICAgICAgIC8vXHRcdE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPTFxuICAgICAgICAgICAgLy9cdFx0fC0+IExJIChwYXJlbnQgTElzOiAwKSAgICAgICAgICAgIHwtPiBMSSAgICAgICAgIChpbmRlbnQ6IDApXG4gICAgICAgICAgICAvL1x0XHR8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwtPiBPTFxuICAgICAgICAgICAgLy9cdFx0ICAgIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICAgICAgICAgfC0+IExJIChpbmRlbnQ6IDEpXG4gICAgICAgICAgICBpZiAocHJldmlvdXNTaWJsaW5nICYmIGlzTGlzdEl0ZW1WaWV3KHByZXZpb3VzU2libGluZykpIHtcbiAgICAgICAgICAgICAgICBpbmRlbnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgIH1cbiAgICByZXR1cm4gaW5kZW50O1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgbGlzdCBhdHRyaWJ1dGUgZWxlbWVudCAob2wgb3IgdWwpLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIGNyZWF0ZUxpc3RFbGVtZW50KHdyaXRlciwgaW5kZW50LCB0eXBlLCBpZCA9IGdldFZpZXdFbGVtZW50SWRGb3JMaXN0VHlwZSh0eXBlLCBpbmRlbnQpKSB7XG4gICAgLy8gTmVnYXRpdmUgcHJpb3JpdGllcyBzbyB0aGF0IHJlc3RyaWN0ZWQgZWRpdGluZyBhdHRyaWJ1dGUgd29uJ3Qgd3JhcCBsaXN0cy5cbiAgICByZXR1cm4gd3JpdGVyLmNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoZ2V0Vmlld0VsZW1lbnROYW1lRm9yTGlzdFR5cGUodHlwZSksIG51bGwsIHtcbiAgICAgICAgcHJpb3JpdHk6IDIgKiBpbmRlbnQgLyAxMDAgLSAxMDAsXG4gICAgICAgIGlkXG4gICAgfSk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBsaXN0IGl0ZW0gYXR0cmlidXRlIGVsZW1lbnQgKGxpKS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBjcmVhdGVMaXN0SXRlbUVsZW1lbnQod3JpdGVyLCBpbmRlbnQsIGlkKSB7XG4gICAgLy8gTmVnYXRpdmUgcHJpb3JpdGllcyBzbyB0aGF0IHJlc3RyaWN0ZWQgZWRpdGluZyBhdHRyaWJ1dGUgd29uJ3Qgd3JhcCBsaXN0IGl0ZW1zLlxuICAgIHJldHVybiB3cml0ZXIuY3JlYXRlQXR0cmlidXRlRWxlbWVudCgnbGknLCBudWxsLCB7XG4gICAgICAgIHByaW9yaXR5OiAoMiAqIGluZGVudCArIDEpIC8gMTAwIC0gMTAwLFxuICAgICAgICBpZFxuICAgIH0pO1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgdmlldyBlbGVtZW50IG5hbWUgZm9yIHRoZSBnaXZlbiBsaXN0IHR5cGUuXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gZ2V0Vmlld0VsZW1lbnROYW1lRm9yTGlzdFR5cGUodHlwZSkge1xuICAgIHJldHVybiB0eXBlID09ICdudW1iZXJlZCcgfHwgdHlwZSA9PSAnY3VzdG9tTnVtYmVyZWQnID8gJ29sJyA6ICd1bCc7XG59XG4vKipcbiAqIFJldHVybnMgYSB2aWV3IGVsZW1lbnQgSUQgZm9yIHRoZSBnaXZlbiBsaXN0IHR5cGUgYW5kIGluZGVudC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBnZXRWaWV3RWxlbWVudElkRm9yTGlzdFR5cGUodHlwZSwgaW5kZW50KSB7XG4gICAgcmV0dXJuIGBsaXN0LSR7dHlwZX0tJHtpbmRlbnR9YDtcbn1cblxuLyoqXG4gKiBCYXNlZCBvbiB0aGUgcHJvdmlkZWQgcG9zaXRpb25zIGxvb2tzIGZvciB0aGUgbGlzdCBoZWFkIGFuZCBzdG9yZXMgaXQgaW4gdGhlIHByb3ZpZGVkIG1hcC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBwb3NpdGlvbiBUaGUgc2VhcmNoIHN0YXJ0aW5nIHBvc2l0aW9uLlxuICogQHBhcmFtIGl0ZW1Ub0xpc3RIZWFkIFRoZSBtYXAgZnJvbSBsaXN0IGl0ZW0gZWxlbWVudCB0byB0aGUgbGlzdCBoZWFkIGVsZW1lbnQuXG4gKiBAcGFyYW0gdmlzaXRlZCBBIHNldCBvZiBlbGVtZW50cyB0aGF0IHdlcmUgYWxyZWFkeSB2aXNpdGVkLlxuICovIGZ1bmN0aW9uIGZpbmRBbmRBZGRMaXN0SGVhZFRvTWFwKHBvc2l0aW9uLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCkge1xuICAgIGNvbnN0IHByZXZpb3VzTm9kZSA9IHBvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgaWYgKCFpc0xpc3RJdGVtQmxvY2socHJldmlvdXNOb2RlKSkge1xuICAgICAgICBjb25zdCBpdGVtID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICBpZiAoaXNMaXN0SXRlbUJsb2NrKGl0ZW0pKSB7XG4gICAgICAgICAgICBpdGVtVG9MaXN0SGVhZC5hZGQoaXRlbSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgbGlzdEhlYWQgPSBwcmV2aW91c05vZGU7XG4gICAgICAgIC8vIFByZXZpb3VzbHksIHRoZSBsb29wIGJlbG93IHdhcyBkZWZpbmVkIGxpa2UgdGhpczpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gXHRcdGZvciAoIHsgbm9kZTogbGlzdEhlYWQgfSBvZiBuZXcgU2libGluZ0xpc3RCbG9ja3NJdGVyYXRvciggbGlzdEhlYWQsICdiYWNrd2FyZCcgKSApXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFVuZm9ydHVuYXRlbHksIHN1Y2ggYSBkZXN0cnVjdHVyaW5nIGlzIGluY29ycmVjdGx5IHRyYW5zcGlsZWQgYnkgQmFiZWwgYW5kIHRoZSBsb29wIG5ldmVyIGVuZHMuXG4gICAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1yZWFjdC9pc3N1ZXMvMzQ1LlxuICAgICAgICBmb3IgKGNvbnN0IHsgbm9kZSB9IG9mIG5ldyBTaWJsaW5nTGlzdEJsb2Nrc0l0ZXJhdG9yKGxpc3RIZWFkLCAnYmFja3dhcmQnKSl7XG4gICAgICAgICAgICBsaXN0SGVhZCA9IG5vZGU7XG4gICAgICAgICAgICBpZiAodmlzaXRlZC5oYXMobGlzdEhlYWQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlzaXRlZC5hZGQobGlzdEhlYWQpO1xuICAgICAgICAgICAgaWYgKGl0ZW1Ub0xpc3RIZWFkLmhhcyhwcmV2aW91c05vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGl0ZW1Ub0xpc3RIZWFkLmFkZChsaXN0SGVhZCk7XG4gICAgfVxufVxuLyoqXG4gKiBTY2FucyB0aGUgbGlzdCBzdGFydGluZyBmcm9tIHRoZSBnaXZlbiBsaXN0IGhlYWQgZWxlbWVudCBhbmQgZml4ZXMgaXRlbXMnIGluZGVudGF0aW9uLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxpc3ROb2RlcyBUaGUgaXRlcmFibGUgb2YgbGlzdCBub2Rlcy5cbiAqIEBwYXJhbSB3cml0ZXIgVGhlIG1vZGVsIHdyaXRlci5cbiAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIG1vZGVsIHdhcyBtb2RpZmllZC5cbiAqLyBmdW5jdGlvbiBmaXhMaXN0SW5kZW50cyhsaXN0Tm9kZXMsIHdyaXRlcikge1xuICAgIGxldCBtYXhJbmRlbnQgPSAwOyAvLyBHdWFyZHMgbG9jYWwgc3VibGlzdCBtYXggaW5kZW50cyB0aGF0IG5lZWQgZml4aW5nLlxuICAgIGxldCBwcmV2SW5kZW50ID0gLTE7IC8vIFByZXZpb3VzIGl0ZW0gaW5kZW50LlxuICAgIGxldCBmaXhCeSA9IG51bGw7XG4gICAgbGV0IGFwcGxpZWQgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IHsgbm9kZSB9IG9mIGxpc3ROb2Rlcyl7XG4gICAgICAgIGNvbnN0IGl0ZW1JbmRlbnQgPSBub2RlLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICBpZiAoaXRlbUluZGVudCA+IG1heEluZGVudCkge1xuICAgICAgICAgICAgbGV0IG5ld0luZGVudDtcbiAgICAgICAgICAgIGlmIChmaXhCeSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZpeEJ5ID0gaXRlbUluZGVudCAtIG1heEluZGVudDtcbiAgICAgICAgICAgICAgICBuZXdJbmRlbnQgPSBtYXhJbmRlbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChmaXhCeSA+IGl0ZW1JbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZml4QnkgPSBpdGVtSW5kZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdJbmRlbnQgPSBpdGVtSW5kZW50IC0gZml4Qnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmV3SW5kZW50ID4gcHJldkluZGVudCArIDEpIHtcbiAgICAgICAgICAgICAgICBuZXdJbmRlbnQgPSBwcmV2SW5kZW50ICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnLCBuZXdJbmRlbnQsIG5vZGUpO1xuICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7XG4gICAgICAgICAgICBwcmV2SW5kZW50ID0gbmV3SW5kZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZml4QnkgPSBudWxsO1xuICAgICAgICAgICAgbWF4SW5kZW50ID0gaXRlbUluZGVudCArIDE7XG4gICAgICAgICAgICBwcmV2SW5kZW50ID0gaXRlbUluZGVudDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXBwbGllZDtcbn1cbi8qKlxuICogU2NhbnMgdGhlIGxpc3Qgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gbGlzdCBoZWFkIGVsZW1lbnQgYW5kIGZpeGVzIGl0ZW1zJyB0eXBlcy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBsaXN0Tm9kZXMgVGhlIGl0ZXJhYmxlIG9mIGxpc3Qgbm9kZXMuXG4gKiBAcGFyYW0gc2VlbklkcyBUaGUgc2V0IG9mIGFscmVhZHkga25vd24gSURzLlxuICogQHBhcmFtIHdyaXRlciBUaGUgbW9kZWwgd3JpdGVyLlxuICogQHJldHVybnMgV2hldGhlciB0aGUgbW9kZWwgd2FzIG1vZGlmaWVkLlxuICovIGZ1bmN0aW9uIGZpeExpc3RJdGVtSWRzKGxpc3ROb2Rlcywgc2Vlbklkcywgd3JpdGVyKSB7XG4gICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQoKTtcbiAgICBsZXQgYXBwbGllZCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgeyBub2RlIH0gb2YgbGlzdE5vZGVzKXtcbiAgICAgICAgaWYgKHZpc2l0ZWQuaGFzKG5vZGUpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGlzdFR5cGUgPSBub2RlLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKTtcbiAgICAgICAgbGV0IGxpc3RJdGVtSWQgPSBub2RlLmdldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcpO1xuICAgICAgICAvLyBVc2UgYSBuZXcgSUQgaWYgdGhpcyBvbmUgd2FzIHNwb3QgZWFybGllciAoZXZlbiBpbiBvdGhlciBsaXN0KS5cbiAgICAgICAgaWYgKHNlZW5JZHMuaGFzKGxpc3RJdGVtSWQpKSB7XG4gICAgICAgICAgICBsaXN0SXRlbUlkID0gTGlzdEl0ZW1VaWQubmV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIHNlZW5JZHMuYWRkKGxpc3RJdGVtSWQpO1xuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhbGwgaXRlbXMgaW4gYSBzaW1wbGUgbGlzdCBoYXZlIHVuaXF1ZSBJRHMuXG4gICAgICAgIGlmIChub2RlLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcpICE9IGxpc3RJdGVtSWQpIHtcbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJywgbGlzdEl0ZW1JZCwgbm9kZSk7XG4gICAgICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGdldExpc3RJdGVtQmxvY2tzKG5vZGUsIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbjogJ2ZvcndhcmQnXG4gICAgICAgIH0pKXtcbiAgICAgICAgICAgIHZpc2l0ZWQuYWRkKGJsb2NrKTtcbiAgICAgICAgICAgIC8vIFVzZSBhIG5ldyBJRCBpZiBhIGJsb2NrIG9mIGEgYmlnZ2VyIGxpc3QgaXRlbSBoYXMgZGlmZmVyZW50IHR5cGUuXG4gICAgICAgICAgICBpZiAoYmxvY2suZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9IGxpc3RUeXBlKSB7XG4gICAgICAgICAgICAgICAgbGlzdEl0ZW1JZCA9IExpc3RJdGVtVWlkLm5leHQoKTtcbiAgICAgICAgICAgICAgICBsaXN0VHlwZSA9IGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChibG9jay5nZXRBdHRyaWJ1dGUoJ2xpc3RJdGVtSWQnKSAhPSBsaXN0SXRlbUlkKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcsIGxpc3RJdGVtSWQsIGJsb2NrKTtcbiAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXBwbGllZDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB1cGNhc3QgY29udmVydGVyIGZvciBsaXN0IGl0ZW1zLiBJdCdzIHN1cHBvc2VkIHRvIHdvcmsgYWZ0ZXIgdGhlIGJsb2NrIGNvbnZlcnRlcnMgKGNvbnRlbnQgaW5zaWRlIGxpc3QgaXRlbXMpIGFyZSBjb252ZXJ0ZWQuXG4gKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gbGlzdEl0ZW1VcGNhc3RDb252ZXJ0ZXIoKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHsgd3JpdGVyLCBzY2hlbWEgfSA9IGNvbnZlcnNpb25BcGk7XG4gICAgICAgIGlmICghZGF0YS5tb2RlbFJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbXMgPSBBcnJheS5mcm9tKGRhdGEubW9kZWxSYW5nZS5nZXRJdGVtcyh7XG4gICAgICAgICAgICBzaGFsbG93OiB0cnVlXG4gICAgICAgIH0pKS5maWx0ZXIoKGl0ZW0pPT5zY2hlbWEuY2hlY2tBdHRyaWJ1dGUoaXRlbSwgJ2xpc3RJdGVtSWQnKSk7XG4gICAgICAgIGlmICghaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGlzdEl0ZW1JZCA9IExpc3RJdGVtVWlkLm5leHQoKTtcbiAgICAgICAgY29uc3QgbGlzdEluZGVudCA9IGdldEluZGVudCQxKGRhdGEudmlld0l0ZW0pO1xuICAgICAgICBsZXQgbGlzdFR5cGUgPSBkYXRhLnZpZXdJdGVtLnBhcmVudCAmJiBkYXRhLnZpZXdJdGVtLnBhcmVudC5pcygnZWxlbWVudCcsICdvbCcpID8gJ251bWJlcmVkJyA6ICdidWxsZXRlZCc7XG4gICAgICAgIC8vIFByZXNlcnZlIGxpc3QgdHlwZSBpZiB3YXMgYWxyZWFkeSBzZXQgKGZvciBleGFtcGxlIGJ5IHRvLWRvIGxpc3QgZmVhdHVyZSkuXG4gICAgICAgIGNvbnN0IGZpcnN0SXRlbUxpc3RUeXBlID0gaXRlbXNbMF0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpO1xuICAgICAgICBpZiAoZmlyc3RJdGVtTGlzdFR5cGUpIHtcbiAgICAgICAgICAgIGxpc3RUeXBlID0gZmlyc3RJdGVtTGlzdFR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHtcbiAgICAgICAgICAgIGxpc3RJdGVtSWQsXG4gICAgICAgICAgICBsaXN0SW5kZW50LFxuICAgICAgICAgICAgbGlzdFR5cGVcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgIC8vIFNldCBsaXN0IGF0dHJpYnV0ZXMgb25seSBvbiBzYW1lIGxldmVsIGl0ZW1zLCB0aG9zZSBuZXN0ZWQgZGVlcGVyIGFyZSBhbHJlYWR5IGhhbmRsZWQgYnkgdGhlIHJlY3Vyc2l2ZSBjb252ZXJzaW9uLlxuICAgICAgICAgICAgaWYgKCFpdGVtLmhhc0F0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcpKSB7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZXMoYXR0cmlidXRlcywgaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGxpc3QgaXRlbSB0aGF0IGNvbnRhaW4gb25seSBuZXN0ZWQgbGlzdCB3aWxsIHByZXNlcnZlIHBhcmFncmFwaCBmb3IgaXRzZWxmOlxuICAgICAgICAgICAgLy9cdDx1bD5cbiAgICAgICAgICAgIC8vXHRcdDxsaT5cbiAgICAgICAgICAgIC8vXHRcdFx0PHA+PC9wPiAgPC0tIHRoaXMgb25lIG11c3QgYmUga2VwdFxuICAgICAgICAgICAgLy9cdFx0XHQ8dWw+XG4gICAgICAgICAgICAvL1x0XHRcdFx0PGxpPjwvbGk+XG4gICAgICAgICAgICAvL1x0XHRcdDwvdWw+XG4gICAgICAgICAgICAvL1x0XHQ8L2xpPlxuICAgICAgICAgICAgLy9cdDwvdWw+XG4gICAgICAgICAgICBpZiAoaXRlbXNbMV0uZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJykgIT0gYXR0cmlidXRlcy5saXN0SXRlbUlkKSB7XG4gICAgICAgICAgICAgICAgY29udmVyc2lvbkFwaS5rZWVwRW1wdHlFbGVtZW50KGl0ZW1zWzBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIFJldHVybnMgYSBtb2RlbCBkb2N1bWVudCBjaGFuZ2U6ZGF0YSBldmVudCBsaXN0ZW5lciB0aGF0IHRyaWdnZXJzIGNvbnZlcnNpb24gb2YgcmVsYXRlZCBpdGVtcyBpZiBuZWVkZWQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gbW9kZWwgVGhlIGVkaXRvciBtb2RlbC5cbiAqIEBwYXJhbSBlZGl0aW5nIFRoZSBlZGl0aW5nIGNvbnRyb2xsZXIuXG4gKiBAcGFyYW0gYXR0cmlidXRlTmFtZXMgVGhlIGxpc3Qgb2YgYWxsIG1vZGVsIGxpc3QgYXR0cmlidXRlcyAoaW5jbHVkaW5nIHJlZ2lzdGVyZWQgc3RyYXRlZ2llcykuXG4gKiBAcGFyYW0gbGlzdEVkaXRpbmcgVGhlIGRvY3VtZW50IGxpc3QgZWRpdGluZyBwbHVnaW4uXG4gKi8gZnVuY3Rpb24gcmVjb252ZXJ0SXRlbXNPbkRhdGFDaGFuZ2UobW9kZWwsIGVkaXRpbmcsIGF0dHJpYnV0ZU5hbWVzLCBsaXN0RWRpdGluZykge1xuICAgIHJldHVybiAoKT0+e1xuICAgICAgICBjb25zdCBjaGFuZ2VzID0gbW9kZWwuZG9jdW1lbnQuZGlmZmVyLmdldENoYW5nZXMoKTtcbiAgICAgICAgY29uc3QgaXRlbXNUb1JlZnJlc2ggPSBbXTtcbiAgICAgICAgY29uc3QgaXRlbVRvTGlzdEhlYWQgPSBuZXcgU2V0KCk7XG4gICAgICAgIGNvbnN0IGNoYW5nZWRJdGVtcyA9IG5ldyBTZXQoKTtcbiAgICAgICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBjaGFuZ2VzKXtcbiAgICAgICAgICAgIGlmIChlbnRyeS50eXBlID09ICdpbnNlcnQnICYmIGVudHJ5Lm5hbWUgIT0gJyR0ZXh0Jykge1xuICAgICAgICAgICAgICAgIGZpbmRBbmRBZGRMaXN0SGVhZFRvTWFwKGVudHJ5LnBvc2l0aW9uLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCk7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0IG9mIGEgbm9uLWxpc3QgaXRlbS5cbiAgICAgICAgICAgICAgICBpZiAoIWVudHJ5LmF0dHJpYnV0ZXMuaGFzKCdsaXN0SXRlbUlkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmluZEFuZEFkZExpc3RIZWFkVG9NYXAoZW50cnkucG9zaXRpb24uZ2V0U2hpZnRlZEJ5KGVudHJ5Lmxlbmd0aCksIGl0ZW1Ub0xpc3RIZWFkLCB2aXNpdGVkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMuYWRkKGVudHJ5LnBvc2l0aW9uLm5vZGVBZnRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09ICdyZW1vdmUnICYmIGVudHJ5LmF0dHJpYnV0ZXMuaGFzKCdsaXN0SXRlbUlkJykpIHtcbiAgICAgICAgICAgICAgICBmaW5kQW5kQWRkTGlzdEhlYWRUb01hcChlbnRyeS5wb3NpdGlvbiwgaXRlbVRvTGlzdEhlYWQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGVudHJ5LnJhbmdlLnN0YXJ0Lm5vZGVBZnRlcjtcbiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlTmFtZXMuaW5jbHVkZXMoZW50cnkuYXR0cmlidXRlS2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBmaW5kQW5kQWRkTGlzdEhlYWRUb01hcChlbnRyeS5yYW5nZS5zdGFydCwgaXRlbVRvTGlzdEhlYWQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuYXR0cmlidXRlTmV3VmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmRBbmRBZGRMaXN0SGVhZFRvTWFwKGVudHJ5LnJhbmdlLnN0YXJ0LmdldFNoaWZ0ZWRCeSgxKSwgaXRlbVRvTGlzdEhlYWQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcGFyYWdyYXBoIHNob3VsZCBiZSBjb252ZXJ0ZWQgZnJvbSBib2d1cyB0byBwbGFpbiBwYXJhZ3JhcGguXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9lc0l0ZW1CbG9ja1JlcXVpcmVzUmVmcmVzaChpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9SZWZyZXNoLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkSXRlbXMuYWRkKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0xpc3RJdGVtQmxvY2soaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gU29tZSBvdGhlciBhdHRyaWJ1dGUgd2FzIGNoYW5nZWQgb24gdGhlIGxpc3QgaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgcGFyYWdyYXBoIGRvZXMgbm90IG5lZWQgdG8gYmUgY29udmVydGVkIHRvIGJvZ3VzIG9yIGJhY2suXG4gICAgICAgICAgICAgICAgICAgIGlmIChkb2VzSXRlbUJsb2NrUmVxdWlyZXNSZWZyZXNoKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUmVmcmVzaC5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgbGlzdEhlYWQgb2YgaXRlbVRvTGlzdEhlYWQudmFsdWVzKCkpe1xuICAgICAgICAgICAgaXRlbXNUb1JlZnJlc2gucHVzaCguLi5jb2xsZWN0TGlzdEl0ZW1zVG9SZWZyZXNoKGxpc3RIZWFkLCBjaGFuZ2VkSXRlbXMpKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgbmV3IFNldChpdGVtc1RvUmVmcmVzaCkpe1xuICAgICAgICAgICAgZWRpdGluZy5yZWNvbnZlcnRJdGVtKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBmdW5jdGlvbiBjb2xsZWN0TGlzdEl0ZW1zVG9SZWZyZXNoKGxpc3RIZWFkLCBjaGFuZ2VkSXRlbXMpIHtcbiAgICAgICAgY29uc3QgaXRlbXNUb1JlZnJlc2ggPSBbXTtcbiAgICAgICAgY29uc3QgdmlzaXRlZCA9IG5ldyBTZXQoKTtcbiAgICAgICAgY29uc3Qgc3RhY2sgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB7IG5vZGUsIHByZXZpb3VzIH0gb2YgbmV3IFNpYmxpbmdMaXN0QmxvY2tzSXRlcmF0b3IobGlzdEhlYWQpKXtcbiAgICAgICAgICAgIGlmICh2aXNpdGVkLmhhcyhub2RlKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaXRlbUluZGVudCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgICAgICAvLyBDdXJyZW50IG5vZGUgaXMgYXQgdGhlIGxvd2VyIGluZGVudCBzbyB0cmltIHRoZSBzdGFjay5cbiAgICAgICAgICAgIGlmIChwcmV2aW91cyAmJiBpdGVtSW5kZW50IDwgcHJldmlvdXMuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykpIHtcbiAgICAgICAgICAgICAgICBzdGFjay5sZW5ndGggPSBpdGVtSW5kZW50ICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc3RhY2sgZm9yIHRoZSBjdXJyZW50IGluZGVudCBsZXZlbC5cbiAgICAgICAgICAgIHN0YWNrW2l0ZW1JbmRlbnRdID0gT2JqZWN0LmZyb21FbnRyaWVzKEFycmF5LmZyb20obm9kZS5nZXRBdHRyaWJ1dGVzKCkpLmZpbHRlcigoW2tleV0pPT5hdHRyaWJ1dGVOYW1lcy5pbmNsdWRlcyhrZXkpKSk7XG4gICAgICAgICAgICAvLyBGaW5kIGFsbCBibG9ja3Mgb2YgdGhlIGN1cnJlbnQgbm9kZS5cbiAgICAgICAgICAgIGNvbnN0IGJsb2NrcyA9IGdldExpc3RJdGVtQmxvY2tzKG5vZGUsIHtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdmb3J3YXJkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgICAgICAgICAgdmlzaXRlZC5hZGQoYmxvY2spO1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGJvZ3VzIHZzIHBsYWluIHBhcmFncmFwaCBuZWVkcyByZWZyZXNoLlxuICAgICAgICAgICAgICAgIGlmIChkb2VzSXRlbUJsb2NrUmVxdWlyZXNSZWZyZXNoKGJsb2NrLCBibG9ja3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9SZWZyZXNoLnB1c2goYmxvY2spO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9lc0l0ZW1XcmFwcGluZ1JlcXVpcmVzUmVmcmVzaChibG9jaywgc3RhY2ssIGNoYW5nZWRJdGVtcykpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1JlZnJlc2gucHVzaChibG9jayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpdGVtc1RvUmVmcmVzaDtcbiAgICB9XG4gICAgZnVuY3Rpb24gZG9lc0l0ZW1CbG9ja1JlcXVpcmVzUmVmcmVzaChpdGVtLCBibG9ja3MpIHtcbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBlZGl0aW5nLm1hcHBlci50b1ZpZXdFbGVtZW50KGl0ZW0pO1xuICAgICAgICBpZiAoIXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmVlZHNSZWZyZXNoID0gbGlzdEVkaXRpbmcuZmlyZSgnY2hlY2tFbGVtZW50Jywge1xuICAgICAgICAgICAgbW9kZWxFbGVtZW50OiBpdGVtLFxuICAgICAgICAgICAgdmlld0VsZW1lbnRcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChuZWVkc1JlZnJlc2gpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXRlbS5pcygnZWxlbWVudCcsICdwYXJhZ3JhcGgnKSAmJiAhaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXNlQm9ndXMgPSBzaG91bGRVc2VCb2d1c1BhcmFncmFwaChpdGVtLCBhdHRyaWJ1dGVOYW1lcywgYmxvY2tzKTtcbiAgICAgICAgaWYgKHVzZUJvZ3VzICYmIHZpZXdFbGVtZW50LmlzKCdlbGVtZW50JywgJ3AnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoIXVzZUJvZ3VzICYmIHZpZXdFbGVtZW50LmlzKCdlbGVtZW50JywgJ3NwYW4nKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkb2VzSXRlbVdyYXBwaW5nUmVxdWlyZXNSZWZyZXNoKGl0ZW0sIHN0YWNrLCBjaGFuZ2VkSXRlbXMpIHtcbiAgICAgICAgLy8gSXRlbXMgZGlyZWN0bHkgYWZmZWN0ZWQgYnkgc29tZSBcImNoYW5nZVwiIGRvbid0IG5lZWQgYSByZWZyZXNoLCB0aGV5IHdpbGwgYmUgY29udmVydGVkIGJ5IHRoZWlyIG93biBjaGFuZ2VzLlxuICAgICAgICBpZiAoY2hhbmdlZEl0ZW1zLmhhcyhpdGVtKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gZWRpdGluZy5tYXBwZXIudG9WaWV3RWxlbWVudChpdGVtKTtcbiAgICAgICAgbGV0IGluZGVudCA9IHN0YWNrLmxlbmd0aCAtIDE7XG4gICAgICAgIC8vIFRyYXZlcnNlIGRvd24gdGhlIHN0YWNrIHRvIHRoZSByb290IHRvIHZlcmlmeSBpZiBhbGwgVUxzLCBPTHMsIGFuZCBMSXMgYXJlIGFzIGV4cGVjdGVkLlxuICAgICAgICBmb3IobGV0IGVsZW1lbnQgPSB2aWV3RWxlbWVudC5wYXJlbnQ7ICFlbGVtZW50LmlzKCdlZGl0YWJsZUVsZW1lbnQnKTsgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50KXtcbiAgICAgICAgICAgIGNvbnN0IGlzTGlzdEl0ZW1FbGVtZW50ID0gaXNMaXN0SXRlbVZpZXcoZWxlbWVudCk7XG4gICAgICAgICAgICBjb25zdCBpc0xpc3RFbGVtZW50ID0gaXNMaXN0VmlldyhlbGVtZW50KTtcbiAgICAgICAgICAgIGlmICghaXNMaXN0RWxlbWVudCAmJiAhaXNMaXN0SXRlbUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IGBjaGVja0F0dHJpYnV0ZXM6JHtpc0xpc3RJdGVtRWxlbWVudCA/ICdpdGVtJyA6ICdsaXN0J31gO1xuICAgICAgICAgICAgY29uc3QgbmVlZHNSZWZyZXNoID0gbGlzdEVkaXRpbmcuZmlyZShldmVudE5hbWUsIHtcbiAgICAgICAgICAgICAgICB2aWV3RWxlbWVudDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICBtb2RlbEF0dHJpYnV0ZXM6IHN0YWNrW2luZGVudF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKG5lZWRzUmVmcmVzaCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzTGlzdEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpbmRlbnQtLTtcbiAgICAgICAgICAgICAgICAvLyBEb24ndCBuZWVkIHRvIGl0ZXJhdGUgZnVydGhlciBpZiB3ZSBhbHJlYWR5IGtub3cgdGhhdCB0aGUgaXRlbSBpcyB3cmFwcGVkIGFwcHJvcHJpYXRlbHkuXG4gICAgICAgICAgICAgICAgaWYgKGluZGVudCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgdGhlIGxpc3QgaXRlbSBkb3duY2FzdCBjb252ZXJ0ZXIuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gYXR0cmlidXRlTmFtZXMgQSBsaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0aGF0IHNob3VsZCBiZSBjb252ZXJ0ZWQgaWYgdGhleSBhcmUgc2V0LlxuICogQHBhcmFtIHN0cmF0ZWdpZXMgVGhlIHN0cmF0ZWdpZXMuXG4gKiBAcGFyYW0gbW9kZWwgVGhlIG1vZGVsLlxuICovIGZ1bmN0aW9uIGxpc3RJdGVtRG93bmNhc3RDb252ZXJ0ZXIoYXR0cmlidXRlTmFtZXMsIHN0cmF0ZWdpZXMsIG1vZGVsLCB7IGRhdGFQaXBlbGluZSB9ID0ge30pIHtcbiAgICBjb25zdCBjb25zdW1lciA9IGNyZWF0ZUF0dHJpYnV0ZXNDb25zdW1lcihhdHRyaWJ1dGVOYW1lcyk7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHsgd3JpdGVyLCBtYXBwZXIsIGNvbnN1bWFibGUgfSA9IGNvbnZlcnNpb25BcGk7XG4gICAgICAgIGNvbnN0IGxpc3RJdGVtID0gZGF0YS5pdGVtO1xuICAgICAgICBpZiAoIWF0dHJpYnV0ZU5hbWVzLmluY2x1ZGVzKGRhdGEuYXR0cmlidXRlS2V5KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRlc3QgaWYgYXR0cmlidXRlcyBvbiB0aGUgY29udmVydGVkIGl0ZW1zIGFyZSBub3QgY29uc3VtZWQuXG4gICAgICAgIGlmICghY29uc3VtZXIobGlzdEl0ZW0sIGNvbnN1bWFibGUpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXNlIHBvc2l0aW9ucyBtYXBwaW5nIGluc3RlYWQgb2YgbWFwcGVyLnRvVmlld0VsZW1lbnQoIGxpc3RJdGVtICkgdG8gZmluZCBvdXRlcm1vc3QgdmlldyBlbGVtZW50LlxuICAgICAgICAvLyBUaGlzIGlzIGZvciBjYXNlcyB3aGVuIG1hcHBpbmcgaXMgdXNpbmcgaW5uZXIgdmlldyBlbGVtZW50IGxpa2UgaW4gdGhlIGNvZGUgYmxvY2tzIChwcmUgPiBjb2RlKS5cbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSBmaW5kTWFwcGVkVmlld0VsZW1lbnQobGlzdEl0ZW0sIG1hcHBlciwgbW9kZWwpO1xuICAgICAgICAvLyBSZW1vdmUgY3VzdG9tIGl0ZW0gbWFya2VyLlxuICAgICAgICByZW1vdmVDdXN0b21NYXJrZXJFbGVtZW50cyh2aWV3RWxlbWVudCwgd3JpdGVyLCBtYXBwZXIpO1xuICAgICAgICAvLyBVbndyYXAgZWxlbWVudCBmcm9tIGN1cnJlbnQgbGlzdCB3cmFwcGVycy5cbiAgICAgICAgdW53cmFwTGlzdEl0ZW1CbG9jayh2aWV3RWxlbWVudCwgd3JpdGVyKTtcbiAgICAgICAgLy8gSW5zZXJ0IGN1c3RvbSBpdGVtIG1hcmtlci5cbiAgICAgICAgY29uc3Qgdmlld1JhbmdlID0gaW5zZXJ0Q3VzdG9tTWFya2VyRWxlbWVudHMobGlzdEl0ZW0sIHZpZXdFbGVtZW50LCBzdHJhdGVnaWVzLCB3cml0ZXIsIHtcbiAgICAgICAgICAgIGRhdGFQaXBlbGluZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlbiB3cmFwIHRoZW0gd2l0aCB0aGUgbmV3IGxpc3Qgd3JhcHBlcnMgKFVMLCBPTCwgTEkpLlxuICAgICAgICB3cmFwTGlzdEl0ZW1CbG9jayhsaXN0SXRlbSwgdmlld1JhbmdlLCBzdHJhdGVnaWVzLCB3cml0ZXIpO1xuICAgIH07XG59XG4vKipcbiAqIFRoZSAncmVtb3ZlJyBkb3duY2FzdCBjb252ZXJ0ZXIgZm9yIGN1c3RvbSBtYXJrZXJzLlxuICovIGZ1bmN0aW9uIGxpc3RJdGVtRG93bmNhc3RSZW1vdmVDb252ZXJ0ZXIoc2NoZW1hKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IHsgd3JpdGVyLCBtYXBwZXIgfSA9IGNvbnZlcnNpb25BcGk7XG4gICAgICAgIGNvbnN0IGVsZW1lbnROYW1lID0gZXZ0Lm5hbWUuc3BsaXQoJzonKVsxXTtcbiAgICAgICAgLy8gRG8gbm90IHJlbW92ZSBtYXJrZXIgaWYgdGhlIGRlbGV0ZWQgZWxlbWVudCBpcyBzb21lIGlubGluZSBvYmplY3QgaW5zaWRlIHBhcmFncmFwaC5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja3NvdXJjZS9ja2VkaXRvcjUtaW50ZXJuYWwvaXNzdWVzLzM2ODAuXG4gICAgICAgIGlmICghc2NoZW1hLmNoZWNrQXR0cmlidXRlKGVsZW1lbnROYW1lLCAnbGlzdEl0ZW1JZCcpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gRmluZCB0aGUgdmlldyByYW5nZSBzdGFydCBwb3NpdGlvbiBieSBtYXBwaW5nIHRoZSBtb2RlbCBwb3NpdGlvbiBhdCB3aGljaCB0aGUgcmVtb3ZlIGhhcHBlbmVkLlxuICAgICAgICBjb25zdCB2aWV3U3RhcnQgPSBtYXBwZXIudG9WaWV3UG9zaXRpb24oZGF0YS5wb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IG1vZGVsRW5kID0gZGF0YS5wb3NpdGlvbi5nZXRTaGlmdGVkQnkoZGF0YS5sZW5ndGgpO1xuICAgICAgICBjb25zdCB2aWV3RW5kID0gbWFwcGVyLnRvVmlld1Bvc2l0aW9uKG1vZGVsRW5kLCB7XG4gICAgICAgICAgICBpc1BoYW50b206IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFRyaW0gdGhlIHJhbmdlIHRvIHJlbW92ZSBpbiBjYXNlIHNvbWUgVUkgZWxlbWVudHMgYXJlIG9uIHRoZSB2aWV3IHJhbmdlIGJvdW5kYXJpZXMuXG4gICAgICAgIGNvbnN0IHZpZXdSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSh2aWV3U3RhcnQsIHZpZXdFbmQpLmdldFRyaW1tZWQoKTtcbiAgICAgICAgLy8gVXNlIHBvc2l0aW9ucyBtYXBwaW5nIGluc3RlYWQgb2YgbWFwcGVyLnRvVmlld0VsZW1lbnQoIGxpc3RJdGVtICkgdG8gZmluZCBvdXRlcm1vc3QgdmlldyBlbGVtZW50LlxuICAgICAgICAvLyBUaGlzIGlzIGZvciBjYXNlcyB3aGVuIG1hcHBpbmcgaXMgdXNpbmcgaW5uZXIgdmlldyBlbGVtZW50IGxpa2UgaW4gdGhlIGNvZGUgYmxvY2tzIChwcmUgPiBjb2RlKS5cbiAgICAgICAgY29uc3Qgdmlld0VsZW1lbnQgPSB2aWV3UmFuZ2UuZW5kLm5vZGVCZWZvcmU7XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0IC0tIEBwcmVzZXJ2ZSAqLyBpZiAoIXZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVtb3ZlIGN1c3RvbSBpdGVtIG1hcmtlci5cbiAgICAgICAgcmVtb3ZlQ3VzdG9tTWFya2VyRWxlbWVudHModmlld0VsZW1lbnQsIHdyaXRlciwgbWFwcGVyKTtcbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBib2d1cyBwYXJhZ3JhcGggdmlldyBlbGVtZW50IGNyZWF0b3IuIEEgYm9ndXMgcGFyYWdyYXBoIGlzIHVzZWQgaWYgYSBsaXN0IGl0ZW0gY29udGFpbnMgb25seSBhIHNpbmdsZSBibG9jayBvciBuZXN0ZWQgbGlzdC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqIEBwYXJhbSBhdHRyaWJ1dGVOYW1lcyBUaGUgbGlzdCBvZiBhbGwgbW9kZWwgbGlzdCBhdHRyaWJ1dGVzIChpbmNsdWRpbmcgcmVnaXN0ZXJlZCBzdHJhdGVnaWVzKS5cbiAqLyBmdW5jdGlvbiBib2d1c1BhcmFncmFwaENyZWF0b3IoYXR0cmlidXRlTmFtZXMsIHsgZGF0YVBpcGVsaW5lIH0gPSB7fSkge1xuICAgIHJldHVybiAobW9kZWxFbGVtZW50LCB7IHdyaXRlciB9KT0+e1xuICAgICAgICAvLyBDb252ZXJ0IG9ubHkgaWYgYSBib2d1cyBwYXJhZ3JhcGggc2hvdWxkIGJlIHVzZWQuXG4gICAgICAgIGlmICghc2hvdWxkVXNlQm9ndXNQYXJhZ3JhcGgobW9kZWxFbGVtZW50LCBhdHRyaWJ1dGVOYW1lcykpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YVBpcGVsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6ICdjay1saXN0LWJvZ3VzLXBhcmFncmFwaCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVzaW5nIGA8cD5gIGluIGNhc2UgdGhlcmUgYXJlIHNvbWUgbWFya2VycyBvbiBpdCBhbmQgdHJhbnNwYXJlbnRSZW5kZXJpbmcgd2lsbCByZW5kZXIgaXQgYW55d2F5LlxuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCdwJyk7XG4gICAgICAgIHdyaXRlci5zZXRDdXN0b21Qcm9wZXJ0eSgnZGF0YVBpcGVsaW5lOnRyYW5zcGFyZW50UmVuZGVyaW5nJywgdHJ1ZSwgdmlld0VsZW1lbnQpO1xuICAgICAgICByZXR1cm4gdmlld0VsZW1lbnQ7XG4gICAgfTtcbn1cbi8qKlxuICogSGVscGVyIGZvciBtYXBwaW5nIG1vZGUgdG8gdmlldyBlbGVtZW50cy4gSXQncyB1c2luZyBwb3NpdGlvbnMgbWFwcGluZyBpbnN0ZWFkIG9mIG1hcHBlci50b1ZpZXdFbGVtZW50KCBlbGVtZW50IClcbiAqIHRvIGZpbmQgb3V0ZXJtb3N0IHZpZXcgZWxlbWVudC4gVGhpcyBpcyBmb3IgY2FzZXMgd2hlbiBtYXBwaW5nIGlzIHVzaW5nIGlubmVyIHZpZXcgZWxlbWVudCBsaWtlIGluIHRoZSBjb2RlIGJsb2NrcyAocHJlID4gY29kZSkuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gZWxlbWVudCBUaGUgbW9kZWwgZWxlbWVudC5cbiAqIEBwYXJhbSBtYXBwZXIgVGhlIG1hcHBlciBpbnN0YW5jZS5cbiAqIEBwYXJhbSBtb2RlbCBUaGUgbW9kZWwuXG4gKi8gZnVuY3Rpb24gZmluZE1hcHBlZFZpZXdFbGVtZW50KGVsZW1lbnQsIG1hcHBlciwgbW9kZWwpIHtcbiAgICBjb25zdCBtb2RlbFJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2VPbihlbGVtZW50KTtcbiAgICBjb25zdCB2aWV3UmFuZ2UgPSBtYXBwZXIudG9WaWV3UmFuZ2UobW9kZWxSYW5nZSkuZ2V0VHJpbW1lZCgpO1xuICAgIHJldHVybiB2aWV3UmFuZ2UuZW5kLm5vZGVCZWZvcmU7XG59XG4vKipcbiAqIFRoZSBtb2RlbCB0byB2aWV3IGN1c3RvbSBwb3NpdGlvbiBtYXBwaW5nIGZvciBjYXNlcyB3aGVuIG1hcmtlciBpcyBpbmplY3RlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgYmxvY2suXG4gKi8gZnVuY3Rpb24gY3JlYXRlTW9kZWxUb1ZpZXdQb3NpdGlvbk1hcHBlcihzdHJhdGVnaWVzLCB2aWV3KSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEpPT57XG4gICAgICAgIGlmIChkYXRhLm1vZGVsUG9zaXRpb24ub2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gZGF0YS5tb2RlbFBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgaWYgKCFpc0xpc3RJdGVtQmxvY2socG9zaXRpb25QYXJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzdHJhdGVnaWVzLnNvbWUoKHN0cmF0ZWd5KT0+c3RyYXRlZ3kuc2NvcGUgPT0gJ2l0ZW1NYXJrZXInICYmIHN0cmF0ZWd5LmNhbkluamVjdE1hcmtlckludG9FbGVtZW50ICYmIHN0cmF0ZWd5LmNhbkluamVjdE1hcmtlckludG9FbGVtZW50KHBvc2l0aW9uUGFyZW50KSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IGRhdGEubWFwcGVyLnRvVmlld0VsZW1lbnQocG9zaXRpb25QYXJlbnQpO1xuICAgICAgICBjb25zdCB2aWV3UmFuZ2UgPSB2aWV3LmNyZWF0ZVJhbmdlSW4odmlld0VsZW1lbnQpO1xuICAgICAgICBjb25zdCB2aWV3V2Fsa2VyID0gdmlld1JhbmdlLmdldFdhbGtlcigpO1xuICAgICAgICBsZXQgcG9zaXRpb25BZnRlckxhc3RNYXJrZXIgPSB2aWV3UmFuZ2Uuc3RhcnQ7XG4gICAgICAgIGZvciAoY29uc3QgeyBpdGVtIH0gb2Ygdmlld1dhbGtlcil7XG4gICAgICAgICAgICAvLyBXYWxrIG9ubHkgb3ZlciB0aGUgbm9uLW1hcHBlZCBlbGVtZW50cyAoVUlFbGVtZW50cywgQXR0cmlidXRlRWxlbWVudHMsICR0ZXh0LCBvciBhbnkgb3RoZXIgZWxlbWVudCB3aXRob3V0IG1hcHBpbmcpLlxuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSAmJiBkYXRhLm1hcHBlci50b01vZGVsRWxlbWVudChpdGVtKSB8fCBpdGVtLmlzKCckdGV4dFByb3h5JykpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtLmlzKCdlbGVtZW50JykgJiYgaXRlbS5nZXRDdXN0b21Qcm9wZXJ0eSgnbGlzdEl0ZW1NYXJrZXInKSkge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uQWZ0ZXJMYXN0TWFya2VyID0gdmlldy5jcmVhdGVQb3NpdGlvbkFmdGVyKGl0ZW0pO1xuICAgICAgICAgICAgICAgIC8vIEp1bXAgb3ZlciB0aGUgY29udGVudCBvZiB0aGUgbWFya2VyICh0aGlzIGlzIG5vdCBuZWVkZWQgZm9yIFVJRWxlbWVudCBidXQgcmVxdWlyZWQgZm9yIG90aGVyIGVsZW1lbnQgdHlwZXMpLlxuICAgICAgICAgICAgICAgIHZpZXdXYWxrZXIuc2tpcCgoeyBwcmV2aW91c1Bvc2l0aW9uIH0pPT4hcHJldmlvdXNQb3NpdGlvbi5pc0VxdWFsKHBvc2l0aW9uQWZ0ZXJMYXN0TWFya2VyKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGF0YS52aWV3UG9zaXRpb24gPSBwb3NpdGlvbkFmdGVyTGFzdE1hcmtlcjtcbiAgICB9O1xufVxuLyoqXG4gKiBSZW1vdmVzIGEgY3VzdG9tIG1hcmtlciBlbGVtZW50cyBhbmQgaXRlbSB3cmFwcGVycyByZWxhdGVkIHRvIHRoYXQgbWFya2VyLlxuICovIGZ1bmN0aW9uIHJlbW92ZUN1c3RvbU1hcmtlckVsZW1lbnRzKHZpZXdFbGVtZW50LCB2aWV3V3JpdGVyLCBtYXBwZXIpIHtcbiAgICAvLyBSZW1vdmUgaXRlbSB3cmFwcGVyLlxuICAgIHdoaWxlKHZpZXdFbGVtZW50LnBhcmVudC5pcygnYXR0cmlidXRlRWxlbWVudCcpICYmIHZpZXdFbGVtZW50LnBhcmVudC5nZXRDdXN0b21Qcm9wZXJ0eSgnbGlzdEl0ZW1XcmFwcGVyJykpe1xuICAgICAgICB2aWV3V3JpdGVyLnVud3JhcCh2aWV3V3JpdGVyLmNyZWF0ZVJhbmdlT24odmlld0VsZW1lbnQpLCB2aWV3RWxlbWVudC5wYXJlbnQpO1xuICAgIH1cbiAgICAvLyBSZW1vdmUgY3VzdG9tIGl0ZW0gbWFya2Vycy5cbiAgICBjb25zdCBtYXJrZXJzVG9SZW1vdmUgPSBbXTtcbiAgICAvLyBNYXJrZXJzIGJlZm9yZSBhIGJsb2NrLlxuICAgIGNvbGxlY3RNYXJrZXJzVG9SZW1vdmUodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZSh2aWV3RWxlbWVudCkuZ2V0V2Fsa2VyKHtcbiAgICAgICAgZGlyZWN0aW9uOiAnYmFja3dhcmQnXG4gICAgfSkpO1xuICAgIC8vIE1hcmtlcnMgaW5zaWRlIGEgYmxvY2suXG4gICAgY29sbGVjdE1hcmtlcnNUb1JlbW92ZSh2aWV3V3JpdGVyLmNyZWF0ZVJhbmdlSW4odmlld0VsZW1lbnQpLmdldFdhbGtlcigpKTtcbiAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiBtYXJrZXJzVG9SZW1vdmUpe1xuICAgICAgICB2aWV3V3JpdGVyLnJlbW92ZShtYXJrZXIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb2xsZWN0TWFya2Vyc1RvUmVtb3ZlKHZpZXdXYWxrZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCB7IGl0ZW0gfSBvZiB2aWV3V2Fsa2VyKXtcbiAgICAgICAgICAgIC8vIFdhbGsgb25seSBvdmVyIHRoZSBub24tbWFwcGVkIGVsZW1lbnRzIChVSUVsZW1lbnRzLCBBdHRyaWJ1dGVFbGVtZW50cywgJHRleHQsIG9yIGFueSBvdGhlciBlbGVtZW50IHdpdGhvdXQgbWFwcGluZykuXG4gICAgICAgICAgICBpZiAoaXRlbS5pcygnZWxlbWVudCcpICYmIG1hcHBlci50b01vZGVsRWxlbWVudChpdGVtKSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSAmJiBpdGVtLmdldEN1c3RvbVByb3BlcnR5KCdsaXN0SXRlbU1hcmtlcicpKSB7XG4gICAgICAgICAgICAgICAgbWFya2Vyc1RvUmVtb3ZlLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIEluc2VydHMgYSBjdXN0b20gbWFya2VyIGVsZW1lbnRzIGFuZCB3cmFwcyBmaXJzdCBibG9jayBvZiBhIGxpc3QgaXRlbSBpZiBtYXJrZXIgcmVxdWlyZXMgaXQuXG4gKi8gZnVuY3Rpb24gaW5zZXJ0Q3VzdG9tTWFya2VyRWxlbWVudHMobGlzdEl0ZW0sIHZpZXdFbGVtZW50LCBzdHJhdGVnaWVzLCB3cml0ZXIsIHsgZGF0YVBpcGVsaW5lIH0pIHtcbiAgICBsZXQgdmlld1JhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlT24odmlld0VsZW1lbnQpO1xuICAgIC8vIE1hcmtlciBjYW4gYmUgaW5zZXJ0ZWQgb25seSBiZWZvcmUgdGhlIGZpcnN0IGJsb2NrIG9mIGEgbGlzdCBpdGVtLlxuICAgIGlmICghaXNGaXJzdEJsb2NrT2ZMaXN0SXRlbShsaXN0SXRlbSkpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdSYW5nZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBzdHJhdGVnaWVzKXtcbiAgICAgICAgaWYgKHN0cmF0ZWd5LnNjb3BlICE9ICdpdGVtTWFya2VyJykge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBjdXN0b20gbWFya2VyIGVsZW1lbnQgYW5kIGluamVjdCBpdCBiZWZvcmUgdGhlIGZpcnN0IGJsb2NrIG9mIHRoZSBsaXN0IGl0ZW0uXG4gICAgICAgIGNvbnN0IG1hcmtlckVsZW1lbnQgPSBzdHJhdGVneS5jcmVhdGVFbGVtZW50KHdyaXRlciwgbGlzdEl0ZW0sIHtcbiAgICAgICAgICAgIGRhdGFQaXBlbGluZVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFtYXJrZXJFbGVtZW50KSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB3cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ2xpc3RJdGVtTWFya2VyJywgdHJ1ZSwgbWFya2VyRWxlbWVudCk7XG4gICAgICAgIGlmIChzdHJhdGVneS5jYW5JbmplY3RNYXJrZXJJbnRvRWxlbWVudCAmJiBzdHJhdGVneS5jYW5JbmplY3RNYXJrZXJJbnRvRWxlbWVudChsaXN0SXRlbSkpIHtcbiAgICAgICAgICAgIHdyaXRlci5pbnNlcnQod3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQodmlld0VsZW1lbnQsIDApLCBtYXJrZXJFbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdyaXRlci5pbnNlcnQodmlld1JhbmdlLnN0YXJ0LCBtYXJrZXJFbGVtZW50KTtcbiAgICAgICAgICAgIHZpZXdSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSh3cml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUobWFya2VyRWxlbWVudCksIHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHZpZXdFbGVtZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV3JhcCB0aGUgbWFya2VyIGFuZCBvcHRpb25hbGx5IHRoZSBmaXJzdCBibG9jayB3aXRoIGFuIGF0dHJpYnV0ZSBlbGVtZW50IChsYWJlbCBmb3IgdG8tZG8gbGlzdHMpLlxuICAgICAgICBpZiAoIXN0cmF0ZWd5LmNyZWF0ZVdyYXBwZXJFbGVtZW50IHx8ICFzdHJhdGVneS5jYW5XcmFwRWxlbWVudCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHN0cmF0ZWd5LmNyZWF0ZVdyYXBwZXJFbGVtZW50KHdyaXRlciwgbGlzdEl0ZW0sIHtcbiAgICAgICAgICAgIGRhdGFQaXBlbGluZVxuICAgICAgICB9KTtcbiAgICAgICAgd3JpdGVyLnNldEN1c3RvbVByb3BlcnR5KCdsaXN0SXRlbVdyYXBwZXInLCB0cnVlLCB3cmFwcGVyKTtcbiAgICAgICAgLy8gVGhlIHdob2xlIGJsb2NrIGNhbiBiZSB3cmFwcGVkLi4uXG4gICAgICAgIGlmIChzdHJhdGVneS5jYW5XcmFwRWxlbWVudChsaXN0SXRlbSkpIHtcbiAgICAgICAgICAgIHZpZXdSYW5nZSA9IHdyaXRlci53cmFwKHZpZXdSYW5nZSwgd3JhcHBlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAuLi4gb3Igb25seSB0aGUgbWFya2VyIGVsZW1lbnQgKGlmIHRoZSBibG9jayBpcyBkb3duY2FzdGVkIHRvIGhlYWRpbmcgb3IgYmxvY2sgd2lkZ2V0KS5cbiAgICAgICAgICAgIHZpZXdSYW5nZSA9IHdyaXRlci53cmFwKHdyaXRlci5jcmVhdGVSYW5nZU9uKG1hcmtlckVsZW1lbnQpLCB3cmFwcGVyKTtcbiAgICAgICAgICAgIHZpZXdSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZSh2aWV3UmFuZ2Uuc3RhcnQsIHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHZpZXdFbGVtZW50KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZpZXdSYW5nZTtcbn1cbi8qKlxuICogVW53cmFwcyBhbGwgb2wsIHVsLCBhbmQgbGkgYXR0cmlidXRlIGVsZW1lbnRzIHRoYXQgYXJlIHdyYXBwaW5nIHRoZSBwcm92aWRlZCB2aWV3IGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gdW53cmFwTGlzdEl0ZW1CbG9jayh2aWV3RWxlbWVudCwgdmlld1dyaXRlcikge1xuICAgIGxldCBhdHRyaWJ1dGVFbGVtZW50ID0gdmlld0VsZW1lbnQucGFyZW50O1xuICAgIHdoaWxlKGF0dHJpYnV0ZUVsZW1lbnQuaXMoJ2F0dHJpYnV0ZUVsZW1lbnQnKSAmJiBbXG4gICAgICAgICd1bCcsXG4gICAgICAgICdvbCcsXG4gICAgICAgICdsaSdcbiAgICBdLmluY2x1ZGVzKGF0dHJpYnV0ZUVsZW1lbnQubmFtZSkpe1xuICAgICAgICBjb25zdCBwYXJlbnRFbGVtZW50ID0gYXR0cmlidXRlRWxlbWVudC5wYXJlbnQ7XG4gICAgICAgIHZpZXdXcml0ZXIudW53cmFwKHZpZXdXcml0ZXIuY3JlYXRlUmFuZ2VPbih2aWV3RWxlbWVudCksIGF0dHJpYnV0ZUVsZW1lbnQpO1xuICAgICAgICBhdHRyaWJ1dGVFbGVtZW50ID0gcGFyZW50RWxlbWVudDtcbiAgICB9XG59XG4vKipcbiAqIFdyYXBzIHRoZSBnaXZlbiBsaXN0IGl0ZW0gd2l0aCBhcHByb3ByaWF0ZSBhdHRyaWJ1dGUgZWxlbWVudHMgZm9yIHVsLCBvbCwgYW5kIGxpLlxuICovIGZ1bmN0aW9uIHdyYXBMaXN0SXRlbUJsb2NrKGxpc3RJdGVtLCB2aWV3UmFuZ2UsIHN0cmF0ZWdpZXMsIHdyaXRlcikge1xuICAgIGlmICghbGlzdEl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0SW5kZW50JykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBsaXN0SXRlbUluZGVudCA9IGxpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgIGxldCBjdXJyZW50TGlzdEl0ZW0gPSBsaXN0SXRlbTtcbiAgICBmb3IobGV0IGluZGVudCA9IGxpc3RJdGVtSW5kZW50OyBpbmRlbnQgPj0gMDsgaW5kZW50LS0pe1xuICAgICAgICBjb25zdCBsaXN0SXRlbVZpZXdFbGVtZW50ID0gY3JlYXRlTGlzdEl0ZW1FbGVtZW50KHdyaXRlciwgaW5kZW50LCBjdXJyZW50TGlzdEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJykpO1xuICAgICAgICBjb25zdCBsaXN0Vmlld0VsZW1lbnQgPSBjcmVhdGVMaXN0RWxlbWVudCh3cml0ZXIsIGluZGVudCwgY3VycmVudExpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSk7XG4gICAgICAgIGZvciAoY29uc3Qgc3RyYXRlZ3kgb2Ygc3RyYXRlZ2llcyl7XG4gICAgICAgICAgICBpZiAoKHN0cmF0ZWd5LnNjb3BlID09ICdsaXN0JyB8fCBzdHJhdGVneS5zY29wZSA9PSAnaXRlbScpICYmIGN1cnJlbnRMaXN0SXRlbS5oYXNBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBzdHJhdGVneS5zZXRBdHRyaWJ1dGVPbkRvd25jYXN0KHdyaXRlciwgY3VycmVudExpc3RJdGVtLmdldEF0dHJpYnV0ZShzdHJhdGVneS5hdHRyaWJ1dGVOYW1lKSwgc3RyYXRlZ3kuc2NvcGUgPT0gJ2xpc3QnID8gbGlzdFZpZXdFbGVtZW50IDogbGlzdEl0ZW1WaWV3RWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmlld1JhbmdlID0gd3JpdGVyLndyYXAodmlld1JhbmdlLCBsaXN0SXRlbVZpZXdFbGVtZW50KTtcbiAgICAgICAgdmlld1JhbmdlID0gd3JpdGVyLndyYXAodmlld1JhbmdlLCBsaXN0Vmlld0VsZW1lbnQpO1xuICAgICAgICBpZiAoaW5kZW50ID09IDApIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRMaXN0SXRlbSA9IExpc3RXYWxrZXIuZmlyc3QoY3VycmVudExpc3RJdGVtLCB7XG4gICAgICAgICAgICBsb3dlckluZGVudDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlcmUgaXMgbm8gbGlzdCBpdGVtIHdpdGggbG93ZXIgaW5kZW50LCB0aGlzIG1lYW5zIHRoaXMgaXMgYSBkb2N1bWVudCBmcmFnbWVudCBjb250YWluaW5nXG4gICAgICAgIC8vIG9ubHkgYSBwYXJ0IG9mIG5lc3RlZCBsaXN0IChsaWtlIGNvcHkgdG8gY2xpcGJvYXJkKSBzbyB3ZSBkb24ndCBuZWVkIHRvIHRyeSB0byB3cmFwIGl0IGZ1cnRoZXIuXG4gICAgICAgIGlmICghY3VycmVudExpc3RJdGVtKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIFJldHVybnMgdGhlIGZ1bmN0aW9uIHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGNvbnN1bWluZyBhdHRyaWJ1dGVzIHRoYXQgYXJlIHNldCBvbiB0aGUgbW9kZWwgbm9kZS5cbmZ1bmN0aW9uIGNyZWF0ZUF0dHJpYnV0ZXNDb25zdW1lcihhdHRyaWJ1dGVOYW1lcykge1xuICAgIHJldHVybiAobm9kZSwgY29uc3VtYWJsZSk9PntcbiAgICAgICAgY29uc3QgZXZlbnRzID0gW107XG4gICAgICAgIC8vIENvbGxlY3QgYWxsIHNldCBhdHRyaWJ1dGVzIHRoYXQgYXJlIHRyaWdnZXJpbmcgY29udmVyc2lvbi5cbiAgICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGVOYW1lIG9mIGF0dHJpYnV0ZU5hbWVzKXtcbiAgICAgICAgICAgIGlmIChub2RlLmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIGV2ZW50cy5wdXNoKGBhdHRyaWJ1dGU6JHthdHRyaWJ1dGVOYW1lfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghZXZlbnRzLmV2ZXJ5KChldmVudCk9PmNvbnN1bWFibGUudGVzdChub2RlLCBldmVudCkgIT09IGZhbHNlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKChldmVudCk9PmNvbnN1bWFibGUuY29uc3VtZShub2RlLCBldmVudCkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xufVxuLy8gV2hldGhlciB0aGUgZ2l2ZW4gaXRlbSBzaG91bGQgYmUgcmVuZGVyZWQgYXMgYSBib2d1cyBwYXJhZ3JhcGguXG5mdW5jdGlvbiBzaG91bGRVc2VCb2d1c1BhcmFncmFwaChpdGVtLCBhdHRyaWJ1dGVOYW1lcywgYmxvY2tzID0gZ2V0QWxsTGlzdEl0ZW1CbG9ja3MoaXRlbSkpIHtcbiAgICBpZiAoIWlzTGlzdEl0ZW1CbG9jayhpdGVtKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAoY29uc3QgYXR0cmlidXRlS2V5IG9mIGl0ZW0uZ2V0QXR0cmlidXRlS2V5cygpKXtcbiAgICAgICAgLy8gSWdub3JlIHNlbGVjdGlvbiBhdHRyaWJ1dGVzIHN0b3JlZCBvbiBibG9jayBlbGVtZW50cy5cbiAgICAgICAgaWYgKGF0dHJpYnV0ZUtleS5zdGFydHNXaXRoKCdzZWxlY3Rpb246JykgfHwgYXR0cmlidXRlS2V5ID09ICdodG1sRW1wdHlCbG9jaycpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIERvbid0IHVzZSBib2d1cyBwYXJhZ3JhcGggaWYgdGhlcmUgYXJlIGF0dHJpYnV0ZXMgZnJvbSBvdGhlciBmZWF0dXJlcy5cbiAgICAgICAgaWYgKCFhdHRyaWJ1dGVOYW1lcy5pbmNsdWRlcyhhdHRyaWJ1dGVLZXkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGJsb2Nrcy5sZW5ndGggPCAyO1xufVxuXG4vKipcbiAqIEEgbGlzdCBvZiBiYXNlIGxpc3QgbW9kZWwgYXR0cmlidXRlcy5cbiAqLyBjb25zdCBMSVNUX0JBU0VfQVRUUklCVVRFUyA9IFtcbiAgICAnbGlzdFR5cGUnLFxuICAgICdsaXN0SW5kZW50JyxcbiAgICAnbGlzdEl0ZW1JZCdcbl07XG4vKipcbiAqIFRoZSBlZGl0aW5nIHBhcnQgb2YgdGhlIGRvY3VtZW50LWxpc3QgZmVhdHVyZS4gSXQgaGFuZGxlcyBjcmVhdGluZywgZWRpdGluZyBhbmQgcmVtb3ZpbmcgbGlzdHMgYW5kIGxpc3QgaXRlbXMuXG4gKi8gY2xhc3MgTGlzdEVkaXRpbmcgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBUaGUgbGlzdCBvZiByZWdpc3RlcmVkIGRvd25jYXN0IHN0cmF0ZWdpZXMuXG5cdCAqLyBfZG93bmNhc3RTdHJhdGVnaWVzID0gW107XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGlzdEVkaXRpbmcnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCByZXF1aXJlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIEVudGVyLFxuICAgICAgICAgICAgRGVsZXRlLFxuICAgICAgICAgICAgTGlzdFV0aWxzLFxuICAgICAgICAgICAgQ2xpcGJvYXJkUGlwZWxpbmVcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBjb25zdHJ1Y3RvcihlZGl0b3Ipe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICBlZGl0b3IuY29uZmlnLmRlZmluZSgnbGlzdC5tdWx0aUJsb2NrJywgdHJ1ZSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBtdWx0aUJsb2NrID0gZWRpdG9yLmNvbmZpZy5nZXQoJ2xpc3QubXVsdGlCbG9jaycpO1xuICAgICAgICBpZiAoZWRpdG9yLnBsdWdpbnMuaGFzKCdMZWdhY3lMaXN0RWRpdGluZycpKSB7XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIFRoZSBgTGlzdGAgZmVhdHVyZSBjYW4gbm90IGJlIGxvYWRlZCB0b2dldGhlciB3aXRoIHRoZSBgTGVnYWN5TGlzdGAgcGx1Z2luLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBlcnJvciBsaXN0LWZlYXR1cmUtY29uZmxpY3Rcblx0XHRcdCAqIEBwYXJhbSBjb25mbGljdFBsdWdpbiBOYW1lIG9mIHRoZSBwbHVnaW4uXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ2xpc3QtZmVhdHVyZS1jb25mbGljdCcsIHRoaXMsIHtcbiAgICAgICAgICAgICAgICBjb25mbGljdFBsdWdpbjogJ0xlZ2FjeUxpc3RFZGl0aW5nJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kZWwuc2NoZW1hLnJlZ2lzdGVyKCckbGlzdEl0ZW0nLCB7XG4gICAgICAgICAgICBhbGxvd0F0dHJpYnV0ZXM6IExJU1RfQkFTRV9BVFRSSUJVVEVTXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobXVsdGlCbG9jaykge1xuICAgICAgICAgICAgbW9kZWwuc2NoZW1hLmV4dGVuZCgnJGNvbnRhaW5lcicsIHtcbiAgICAgICAgICAgICAgICBhbGxvd0F0dHJpYnV0ZXNPZjogJyRsaXN0SXRlbSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kZWwuc2NoZW1hLmV4dGVuZCgnJGJsb2NrJywge1xuICAgICAgICAgICAgICAgIGFsbG93QXR0cmlidXRlc09mOiAnJGxpc3RJdGVtJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2RlbC5zY2hlbWEuZXh0ZW5kKCckYmxvY2tPYmplY3QnLCB7XG4gICAgICAgICAgICAgICAgYWxsb3dBdHRyaWJ1dGVzT2Y6ICckbGlzdEl0ZW0nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1vZGVsLnNjaGVtYS5yZWdpc3RlcignbGlzdEl0ZW0nLCB7XG4gICAgICAgICAgICAgICAgaW5oZXJpdEFsbEZyb206ICckYmxvY2snLFxuICAgICAgICAgICAgICAgIGFsbG93QXR0cmlidXRlc09mOiAnJGxpc3RJdGVtJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGUgb2YgTElTVF9CQVNFX0FUVFJJQlVURVMpe1xuICAgICAgICAgICAgbW9kZWwuc2NoZW1hLnNldEF0dHJpYnV0ZVByb3BlcnRpZXMoYXR0cmlidXRlLCB7XG4gICAgICAgICAgICAgICAgY29weU9uUmVwbGFjZTogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29tbWFuZHMuXG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ251bWJlcmVkTGlzdCcsIG5ldyBMaXN0Q29tbWFuZChlZGl0b3IsICdudW1iZXJlZCcpKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnYnVsbGV0ZWRMaXN0JywgbmV3IExpc3RDb21tYW5kKGVkaXRvciwgJ2J1bGxldGVkJykpO1xuICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdjdXN0b21OdW1iZXJlZExpc3QnLCBuZXcgTGlzdENvbW1hbmQoZWRpdG9yLCAnY3VzdG9tTnVtYmVyZWQnLCB7XG4gICAgICAgICAgICBtdWx0aUxldmVsOiB0cnVlXG4gICAgICAgIH0pKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnY3VzdG9tQnVsbGV0ZWRMaXN0JywgbmV3IExpc3RDb21tYW5kKGVkaXRvciwgJ2N1c3RvbUJ1bGxldGVkJywge1xuICAgICAgICAgICAgbXVsdGlMZXZlbDogdHJ1ZVxuICAgICAgICB9KSk7XG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ2luZGVudExpc3QnLCBuZXcgTGlzdEluZGVudENvbW1hbmQoZWRpdG9yLCAnZm9yd2FyZCcpKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnb3V0ZGVudExpc3QnLCBuZXcgTGlzdEluZGVudENvbW1hbmQoZWRpdG9yLCAnYmFja3dhcmQnKSk7XG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ3NwbGl0TGlzdEl0ZW1CZWZvcmUnLCBuZXcgTGlzdFNwbGl0Q29tbWFuZChlZGl0b3IsICdiZWZvcmUnKSk7XG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ3NwbGl0TGlzdEl0ZW1BZnRlcicsIG5ldyBMaXN0U3BsaXRDb21tYW5kKGVkaXRvciwgJ2FmdGVyJykpO1xuICAgICAgICBpZiAobXVsdGlCbG9jaykge1xuICAgICAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnbWVyZ2VMaXN0SXRlbUJhY2t3YXJkJywgbmV3IExpc3RNZXJnZUNvbW1hbmQoZWRpdG9yLCAnYmFja3dhcmQnKSk7XG4gICAgICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdtZXJnZUxpc3RJdGVtRm9yd2FyZCcsIG5ldyBMaXN0TWVyZ2VDb21tYW5kKGVkaXRvciwgJ2ZvcndhcmQnKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc2V0dXBEZWxldGVJbnRlZ3JhdGlvbigpO1xuICAgICAgICB0aGlzLl9zZXR1cEVudGVySW50ZWdyYXRpb24oKTtcbiAgICAgICAgdGhpcy5fc2V0dXBUYWJJbnRlZ3JhdGlvbigpO1xuICAgICAgICB0aGlzLl9zZXR1cENsaXBib2FyZEludGVncmF0aW9uKCk7XG4gICAgICAgIHRoaXMuX3NldHVwQWNjZXNzaWJpbGl0eUludGVncmF0aW9uKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gYWZ0ZXJJbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgY29tbWFuZHMgPSBlZGl0b3IuY29tbWFuZHM7XG4gICAgICAgIGNvbnN0IGluZGVudCA9IGNvbW1hbmRzLmdldCgnaW5kZW50Jyk7XG4gICAgICAgIGNvbnN0IG91dGRlbnQgPSBjb21tYW5kcy5nZXQoJ291dGRlbnQnKTtcbiAgICAgICAgaWYgKGluZGVudCkge1xuICAgICAgICAgICAgLy8gUHJpb3JpdHkgaXMgaGlnaCBkdWUgdG8gaW50ZWdyYXRpb24gd2l0aCBgSW5kZW50QmxvY2tgIHBsdWdpbi4gV2Ugd2FudCB0byBpbmRlbnQgbGlzdCBmaXJzdCBhbmQgaWYgaXQncyBub3QgcG9zc2libGVcbiAgICAgICAgICAgIC8vIHVzZXIgY2FuIGluZGVudCBjb250ZW50IHdpdGggYEluZGVudEJsb2NrYCBwbHVnaW4uXG4gICAgICAgICAgICBpbmRlbnQucmVnaXN0ZXJDaGlsZENvbW1hbmQoY29tbWFuZHMuZ2V0KCdpbmRlbnRMaXN0JyksIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3V0ZGVudCkge1xuICAgICAgICAgICAgLy8gUHJpb3JpdHkgaXMgbG93ZXN0IGR1ZSB0byBpbnRlZ3JhdGlvbiB3aXRoIGBJbmRlbnRCbG9ja2AgYW5kIGBJbmRlbnRDb2RlYCBwbHVnaW5zLlxuICAgICAgICAgICAgLy8gRmlyc3Qgd2Ugd2FudCB0byBhbGxvdyB1c2VyIHRvIG91dGRlbnQgYWxsIGluZGVuZGF0aW9ucyBmcm9tIG90aGVyIGZlYXR1cmVzIHRoZW4gaGUgY2FuIG91ZGVudCBsaXN0IGl0ZW0uXG4gICAgICAgICAgICBvdXRkZW50LnJlZ2lzdGVyQ2hpbGRDb21tYW5kKGNvbW1hbmRzLmdldCgnb3V0ZGVudExpc3QnKSwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnbG93ZXN0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmVnaXN0ZXIgY29udmVyc2lvbiBhbmQgbW9kZWwgcG9zdC1maXhlciBhZnRlciBvdGhlciBwbHVnaW5zIGhhZCBhIGNoYW5jZSB0byByZWdpc3RlciB0aGVpciBhdHRyaWJ1dGUgc3RyYXRlZ2llcy5cbiAgICAgICAgdGhpcy5fc2V0dXBNb2RlbFBvc3RGaXhpbmcoKTtcbiAgICAgICAgdGhpcy5fc2V0dXBDb252ZXJzaW9uKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgYSBkb3duY2FzdCBzdHJhdGVneS5cblx0ICpcblx0ICogKipOb3RlKio6IFN0cmF0ZWdpZXMgbXVzdCBiZSByZWdpc3RlcmVkIGluIHRoZSBgUGx1Z2luI2luaXQoKWAgcGhhc2Ugc28gdGhhdCBpdCBjYW4gYmUgYXBwbGllZFxuXHQgKiBpbiB0aGUgYExpc3RFZGl0aW5nI2FmdGVySW5pdCgpYC5cblx0ICpcblx0ICogQHBhcmFtIHN0cmF0ZWd5IFRoZSBkb3duY2FzdCBzdHJhdGVneSB0byByZWdpc3Rlci5cblx0ICovIHJlZ2lzdGVyRG93bmNhc3RTdHJhdGVneShzdHJhdGVneSkge1xuICAgICAgICB0aGlzLl9kb3duY2FzdFN0cmF0ZWdpZXMucHVzaChzdHJhdGVneSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXR1cm5zIGxpc3Qgb2YgbW9kZWwgYXR0cmlidXRlIG5hbWVzIHRoYXQgc2hvdWxkIGFmZmVjdCBkb3duY2FzdCBjb252ZXJzaW9uLlxuXHQgKi8gZ2V0TGlzdEF0dHJpYnV0ZU5hbWVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgLi4uTElTVF9CQVNFX0FUVFJJQlVURVMsXG4gICAgICAgICAgICAuLi50aGlzLl9kb3duY2FzdFN0cmF0ZWdpZXMubWFwKChzdHJhdGVneSk9PnN0cmF0ZWd5LmF0dHJpYnV0ZU5hbWUpXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBdHRhY2hlcyB0aGUgbGlzdGVuZXIgdG8gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvZG9jdW1lbnR+RG9jdW1lbnQjZXZlbnQ6ZGVsZXRlfSBldmVudCBhbmQgaGFuZGxlcyBiYWNrc3BhY2UvZGVsZXRlXG5cdCAqIGtleXMgaW4gYW5kIGFyb3VuZCBkb2N1bWVudCBsaXN0cy5cblx0ICovIF9zZXR1cERlbGV0ZUludGVncmF0aW9uKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbWVyZ2VCYWNrd2FyZENvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdtZXJnZUxpc3RJdGVtQmFja3dhcmQnKTtcbiAgICAgICAgY29uc3QgbWVyZ2VGb3J3YXJkQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ21lcmdlTGlzdEl0ZW1Gb3J3YXJkJyk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudCwgJ2RlbGV0ZScsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgLy8gTGV0IHRoZSBXaWRnZXQgcGx1Z2luIHRha2UgY2FyZSBvZiBibG9jayB3aWRnZXRzIHdoaWxlIGRlbGV0aW5nIChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMTM0NikuXG4gICAgICAgICAgICBpZiAoZ2V0U2VsZWN0ZWRCbG9ja09iamVjdChlZGl0b3IubW9kZWwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgoKT0+e1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0UG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQgJiYgZGF0YS5kaXJlY3Rpb24gPT0gJ2JhY2t3YXJkJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpcnN0UG9zaXRpb24uaXNBdFN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBmaXJzdFBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0xpc3RJdGVtQmxvY2socG9zaXRpb25QYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNCbG9jayA9IExpc3RXYWxrZXIuZmlyc3QocG9zaXRpb25QYXJlbnQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhbWVBdHRyaWJ1dGVzOiAnbGlzdFR5cGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2FtZUluZGVudDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gT3V0ZGVudCB0aGUgZmlyc3QgYmxvY2sgb2YgYSBmaXJzdCBsaXN0IGl0ZW0uXG4gICAgICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXNCbG9jayAmJiBwb3NpdGlvblBhcmVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0xhc3RCbG9ja09mTGlzdEl0ZW0ocG9zaXRpb25QYXJlbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ3NwbGl0TGlzdEl0ZW1BZnRlcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ291dGRlbnRMaXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1lcmdlQmFja3dhcmRDb21tYW5kIHx8ICFtZXJnZUJhY2t3YXJkQ29tbWFuZC5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXJnZUJhY2t3YXJkQ29tbWFuZC5leGVjdXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRNZXJnZU9uQmxvY2tzQ29udGVudExldmVsOiBzaG91bGRNZXJnZU9uQmxvY2tzQ29udGVudExldmVsKGVkaXRvci5tb2RlbCwgJ2JhY2t3YXJkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBDb2xsYXBzZWQgc2VsZWN0aW9uIHNob3VsZCB0cmlnZ2VyIGZvcndhcmQgbWVyZ2luZyBvbmx5IGlmIGF0IHRoZSBlbmQgb2YgYSBibG9jay5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiAhc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpLmlzQXRFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoIW1lcmdlRm9yd2FyZENvbW1hbmQgfHwgIW1lcmdlRm9yd2FyZENvbW1hbmQuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VGb3J3YXJkQ29tbWFuZC5leGVjdXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWw6IHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWwoZWRpdG9yLm1vZGVsLCAnZm9yd2FyZCcpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGNvbnRleHQ6ICdsaSdcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBBdHRhY2hlcyBhIGxpc3RlbmVyIHRvIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L2RvY3VtZW50fkRvY3VtZW50I2V2ZW50OmVudGVyfSBldmVudCBhbmQgaGFuZGxlcyBlbnRlciBrZXkgcHJlc3Ncblx0ICogaW4gZG9jdW1lbnQgbGlzdHMuXG5cdCAqLyBfc2V0dXBFbnRlckludGVncmF0aW9uKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRzID0gZWRpdG9yLmNvbW1hbmRzO1xuICAgICAgICBjb25zdCBlbnRlckNvbW1hbmQgPSBjb21tYW5kcy5nZXQoJ2VudGVyJyk7XG4gICAgICAgIC8vIE92ZXJ3cml0ZSB0aGUgZGVmYXVsdCBFbnRlciBrZXkgYmVoYXZpb3I6IG91dGRlbnQgb3Igc3BsaXQgdGhlIGxpc3QgaW4gY2VydGFpbiBjYXNlcy5cbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50LCAnZW50ZXInLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgY29uc3QgZG9jID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgICAgICAgICBjb25zdCBwb3NpdGlvblBhcmVudCA9IGRvYy5zZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgICAgIGlmIChkb2Muc2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmIGlzTGlzdEl0ZW1CbG9jayhwb3NpdGlvblBhcmVudCkgJiYgcG9zaXRpb25QYXJlbnQuaXNFbXB0eSAmJiAhZGF0YS5pc1NvZnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0ZpcnN0QmxvY2sgPSBpc0ZpcnN0QmxvY2tPZkxpc3RJdGVtKHBvc2l0aW9uUGFyZW50KTtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0xhc3RCbG9jayA9IGlzTGFzdEJsb2NrT2ZMaXN0SXRlbShwb3NpdGlvblBhcmVudCk7XG4gICAgICAgICAgICAgICAgLy8gKiBhICAgICAg4oaSICAgICAgKiBhXG4gICAgICAgICAgICAgICAgLy8gKiBbXSAgICAg4oaSICAgICAgW11cbiAgICAgICAgICAgICAgICBpZiAoaXNGaXJzdEJsb2NrICYmIGlzTGFzdEJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdvdXRkZW50TGlzdCcpO1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0ZpcnN0QmxvY2sgJiYgIWlzTGFzdEJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdzcGxpdExpc3RJdGVtQWZ0ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNMYXN0QmxvY2spIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ3NwbGl0TGlzdEl0ZW1CZWZvcmUnKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogJ2xpJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gSW4gc29tZSBjYXNlcywgYWZ0ZXIgdGhlIGRlZmF1bHQgYmxvY2sgc3BsaXR0aW5nLCB3ZSB3YW50IHRvIG1vZGlmeSB0aGUgbmV3IGJsb2NrIHRvIGJlY29tZSBhIG5ldyBsaXN0IGl0ZW1cbiAgICAgICAgLy8gaW5zdGVhZCBvZiBhbiBhZGRpdGlvbmFsIGJsb2NrIGluIHRoZSBzYW1lIGxpc3QgaXRlbS5cbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlbnRlckNvbW1hbmQsICdhZnRlckV4ZWN1dGUnLCAoKT0+e1xuICAgICAgICAgICAgY29uc3Qgc3BsaXRDb21tYW5kID0gY29tbWFuZHMuZ2V0KCdzcGxpdExpc3RJdGVtQmVmb3JlJyk7XG4gICAgICAgICAgICAvLyBUaGUgY29tbWFuZCBoYXMgbm90IHJlZnJlc2hlZCBiZWNhdXNlIHRoZSBjaGFuZ2UgYmxvY2sgcmVsYXRlZCB0byBFbnRlckNvbW1hbmQjZXhlY3V0ZSgpIGlzIG5vdCBvdmVyIHlldC5cbiAgICAgICAgICAgIC8vIExldCdzIGtlZXAgaXQgdXAgdG8gZGF0ZSBhbmQgdGFrZSBhZHZhbnRhZ2Ugb2YgTGlzdFNwbGl0Q29tbWFuZCNpc0VuYWJsZWQuXG4gICAgICAgICAgICBzcGxpdENvbW1hbmQucmVmcmVzaCgpO1xuICAgICAgICAgICAgaWYgKCFzcGxpdENvbW1hbmQuaXNFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZG9jID0gZWRpdG9yLm1vZGVsLmRvY3VtZW50O1xuICAgICAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBkb2Muc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RJdGVtQmxvY2tzID0gZ2V0QWxsTGlzdEl0ZW1CbG9ja3MocG9zaXRpb25QYXJlbnQpO1xuICAgICAgICAgICAgLy8gS2VlcCBpbiBtaW5kIHRoaXMgc3BsaXQgaGFwcGVucyBhZnRlciB0aGUgZGVmYXVsdCBlbnRlciBoYW5kbGVyIHdhcyBleGVjdXRlZC4gRm9yIGluc3RhbmNlOlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIOKUgiAgICAgICBJbml0aWFsIHN0YXRlICAgICAgIOKUgiAgICBBZnRlciBkZWZhdWx0IGVudGVyICAgIOKUgiAgIEhlcmUgaW4gI2FmdGVyRXhlY3V0ZSAgIOKUglxuICAgICAgICAgICAgLy8g4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkXG4gICAgICAgICAgICAvLyDilIIgICAgICAgICAgKiBhW10gICAgICAgICAgICDilIIgICAgICAgICAgICogYSAgICAgICAgICAgICDilIIgICAgICAgICAgICogYSAgICAgICAgICAgICDilIJcbiAgICAgICAgICAgIC8vIOKUgiAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICBbXSAgICAgICAgICAgIOKUgiAgICAgICAgICAgKiBbXSAgICAgICAgICAgIOKUglxuICAgICAgICAgICAgaWYgKGxpc3RJdGVtQmxvY2tzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgIHNwbGl0Q29tbWFuZC5leGVjdXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQXR0YWNoZXMgYSBsaXN0ZW5lciB0byB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy9kb2N1bWVudH5Eb2N1bWVudCNldmVudDp0YWJ9IGV2ZW50IGFuZCBoYW5kbGVzIHRhYiBrZXkgYW5kIHRhYitzaGlmdCBrZXlzXG5cdCAqIHByZXNzZXMgaW4gZG9jdW1lbnQgbGlzdHMuXG5cdCAqLyBfc2V0dXBUYWJJbnRlZ3JhdGlvbigpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudCwgJ3RhYicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGRhdGEuc2hpZnRLZXkgPyAnb3V0ZGVudExpc3QnIDogJ2luZGVudExpc3QnO1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IHRoaXMuZWRpdG9yLmNvbW1hbmRzLmdldChjb21tYW5kTmFtZSk7XG4gICAgICAgICAgICBpZiAoY29tbWFuZC5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuZXhlY3V0ZShjb21tYW5kTmFtZSk7XG4gICAgICAgICAgICAgICAgZGF0YS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogJ2xpJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyB0aGUgY29udmVyc2lvbiBoZWxwZXJzIGZvciB0aGUgZG9jdW1lbnQtbGlzdCBmZWF0dXJlLlxuXHQgKi8gX3NldHVwQ29udmVyc2lvbigpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBhdHRyaWJ1dGVOYW1lcyA9IHRoaXMuZ2V0TGlzdEF0dHJpYnV0ZU5hbWVzKCk7XG4gICAgICAgIGNvbnN0IG11bHRpQmxvY2sgPSBlZGl0b3IuY29uZmlnLmdldCgnbGlzdC5tdWx0aUJsb2NrJyk7XG4gICAgICAgIGNvbnN0IGVsZW1lbnROYW1lID0gbXVsdGlCbG9jayA/ICdwYXJhZ3JhcGgnIDogJ2xpc3RJdGVtJztcbiAgICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCd1cGNhc3QnKS8vIENvbnZlcnQgPGxpPiB0byBhIGdlbmVyaWMgcGFyYWdyYXBoIChvciBsaXN0SXRlbSBlbGVtZW50KSBzbyB0aGUgY29udGVudCBvZiA8bGk+IGlzIGFsd2F5cyBpbnNpZGUgYSBibG9jay5cbiAgICAgICAgLy8gU2V0dGluZyB0aGUgbGlzdFR5cGUgYXR0cmlidXRlIHRvIGxldCBvdGhlciBmZWF0dXJlcyAodG8tZG8gbGlzdCkga25vdyB0aGF0IHRoaXMgaXMgcGFydCBvZiBhIGxpc3QgaXRlbS5cbiAgICAgICAgLy8gVGhpcyBpcyBhbHNvIGltcG9ydGFudCB0byBwcm9wZXJseSBoYW5kbGUgc2ltcGxlIGxpc3RzIHNvIHRoYXQgcGFyYWdyYXBocyBpbnNpZGUgYSBsaXN0IGl0ZW0gd29uJ3QgYnJlYWsgdGhlIGxpc3QgaXRlbS5cbiAgICAgICAgLy8gPGxpPiAgPC0tIGNvbnZlcnRlZCB0byBsaXN0SXRlbVxuICAgICAgICAvLyAgIDxwPjwvcD4gPC0tIHNob3VsZCBiZSBhbHNvIGNvbnZlcnRlZCB0byBsaXN0SXRlbSwgc28gaXQgd29uJ3Qgc3BsaXQgYW5kIHJlcGxhY2UgdGhlIGxpc3RJdGVtIGdlbmVyYXRlZCBmcm9tIHRoZSBhYm92ZSBsaS5cbiAgICAgICAgLmVsZW1lbnRUb0VsZW1lbnQoe1xuICAgICAgICAgICAgdmlldzogJ2xpJyxcbiAgICAgICAgICAgIG1vZGVsOiAodmlld0VsZW1lbnQsIHsgd3JpdGVyIH0pPT53cml0ZXIuY3JlYXRlRWxlbWVudChlbGVtZW50TmFtZSwge1xuICAgICAgICAgICAgICAgICAgICBsaXN0VHlwZTogJydcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KS8vIENvbnZlcnQgcGFyYWdyYXBoIHRvIHRoZSBsaXN0IGJsb2NrICh3aXRob3V0IGxpc3QgdHlwZSBkZWZpbmVkIHlldCkuXG4gICAgICAgIC8vIFRoaXMgaXMgaW1wb3J0YW50IHRvIHByb3Blcmx5IGhhbmRsZSBib2d1cyBwYXJhZ3JhcGggYW5kIHRvLWRvIGxpc3RzLlxuICAgICAgICAvLyBNb3N0IG9mIHRoZSB0aW1lIHRoZSBib2d1cyBwYXJhZ3JhcGggc2hvdWxkIG5vdCBhcHBlYXIgaW4gdGhlIGRhdGEgb2YgdG8tZG8gbGlzdCxcbiAgICAgICAgLy8gYnV0IGlmIHRoZXJlIGlzIGFueSBtYXJrZXIgb3IgYW4gYXR0cmlidXRlIG9uIHRoZSBwYXJhZ3JhcGggdGhlbiB0aGUgYm9ndXMgcGFyYWdyYXBoXG4gICAgICAgIC8vIGlzIHByZXNlcnZlZCBpbiB0aGUgZGF0YSwgYW5kIHdlIG5lZWQgdG8gYmUgYWJsZSB0byBkZXRlY3QgdGhpcyBjYXNlLlxuICAgICAgICAuZWxlbWVudFRvRWxlbWVudCh7XG4gICAgICAgICAgICB2aWV3OiAncCcsXG4gICAgICAgICAgICBtb2RlbDogKHZpZXdFbGVtZW50LCB7IHdyaXRlciB9KT0+e1xuICAgICAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudC5wYXJlbnQgJiYgdmlld0VsZW1lbnQucGFyZW50LmlzKCdlbGVtZW50JywgJ2xpJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlci5jcmVhdGVFbGVtZW50KGVsZW1lbnROYW1lLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0VHlwZTogJydcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSkuYWRkKChkaXNwYXRjaGVyKT0+e1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDpsaScsIGxpc3RJdGVtVXBjYXN0Q29udmVydGVyKCkpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFtdWx0aUJsb2NrKSB7XG4gICAgICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2Rvd25jYXN0JykuZWxlbWVudFRvRWxlbWVudCh7XG4gICAgICAgICAgICAgICAgbW9kZWw6ICdsaXN0SXRlbScsXG4gICAgICAgICAgICAgICAgdmlldzogJ3AnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2VkaXRpbmdEb3duY2FzdCcpLmVsZW1lbnRUb0VsZW1lbnQoe1xuICAgICAgICAgICAgbW9kZWw6IGVsZW1lbnROYW1lLFxuICAgICAgICAgICAgdmlldzogYm9ndXNQYXJhZ3JhcGhDcmVhdG9yKGF0dHJpYnV0ZU5hbWVzKSxcbiAgICAgICAgICAgIGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSkuYWRkKChkaXNwYXRjaGVyKT0+e1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignYXR0cmlidXRlJywgbGlzdEl0ZW1Eb3duY2FzdENvbnZlcnRlcihhdHRyaWJ1dGVOYW1lcywgdGhpcy5fZG93bmNhc3RTdHJhdGVnaWVzLCBtb2RlbCkpO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbigncmVtb3ZlJywgbGlzdEl0ZW1Eb3duY2FzdFJlbW92ZUNvbnZlcnRlcihtb2RlbC5zY2hlbWEpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcignZGF0YURvd25jYXN0JykuZWxlbWVudFRvRWxlbWVudCh7XG4gICAgICAgICAgICBtb2RlbDogZWxlbWVudE5hbWUsXG4gICAgICAgICAgICB2aWV3OiBib2d1c1BhcmFncmFwaENyZWF0b3IoYXR0cmlidXRlTmFtZXMsIHtcbiAgICAgICAgICAgICAgICBkYXRhUGlwZWxpbmU6IHRydWVcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY29udmVydGVyUHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KS5hZGQoKGRpc3BhdGNoZXIpPT57XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdhdHRyaWJ1dGUnLCBsaXN0SXRlbURvd25jYXN0Q29udmVydGVyKGF0dHJpYnV0ZU5hbWVzLCB0aGlzLl9kb3duY2FzdFN0cmF0ZWdpZXMsIG1vZGVsLCB7XG4gICAgICAgICAgICAgICAgZGF0YVBpcGVsaW5lOiB0cnVlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBtb2RlbFRvVmlld1Bvc2l0aW9uTWFwcGVyID0gY3JlYXRlTW9kZWxUb1ZpZXdQb3NpdGlvbk1hcHBlcih0aGlzLl9kb3duY2FzdFN0cmF0ZWdpZXMsIGVkaXRvci5lZGl0aW5nLnZpZXcpO1xuICAgICAgICBlZGl0b3IuZWRpdGluZy5tYXBwZXIub24oJ21vZGVsVG9WaWV3UG9zaXRpb24nLCBtb2RlbFRvVmlld1Bvc2l0aW9uTWFwcGVyKTtcbiAgICAgICAgZWRpdG9yLmRhdGEubWFwcGVyLm9uKCdtb2RlbFRvVmlld1Bvc2l0aW9uJywgbW9kZWxUb1ZpZXdQb3NpdGlvbk1hcHBlcik7XG4gICAgICAgIHRoaXMubGlzdGVuVG8obW9kZWwuZG9jdW1lbnQsICdjaGFuZ2U6ZGF0YScsIHJlY29udmVydEl0ZW1zT25EYXRhQ2hhbmdlKG1vZGVsLCBlZGl0b3IuZWRpdGluZywgYXR0cmlidXRlTmFtZXMsIHRoaXMpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBGb3IgTEkgdmVyaWZ5IGlmIGFuIElEIG9mIHRoZSBhdHRyaWJ1dGUgZWxlbWVudCBpcyBjb3JyZWN0LlxuICAgICAgICB0aGlzLm9uKCdjaGVja0F0dHJpYnV0ZXM6aXRlbScsIChldnQsIHsgdmlld0VsZW1lbnQsIG1vZGVsQXR0cmlidXRlcyB9KT0+e1xuICAgICAgICAgICAgaWYgKHZpZXdFbGVtZW50LmlkICE9IG1vZGVsQXR0cmlidXRlcy5saXN0SXRlbUlkKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnJldHVybiA9IHRydWU7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEZvciBVTCBhbmQgT0wgY2hlY2sgaWYgdGhlIG5hbWUgYW5kIElEIG9mIGVsZW1lbnQgaXMgY29ycmVjdC5cbiAgICAgICAgdGhpcy5vbignY2hlY2tBdHRyaWJ1dGVzOmxpc3QnLCAoZXZ0LCB7IHZpZXdFbGVtZW50LCBtb2RlbEF0dHJpYnV0ZXMgfSk9PntcbiAgICAgICAgICAgIGlmICh2aWV3RWxlbWVudC5uYW1lICE9IGdldFZpZXdFbGVtZW50TmFtZUZvckxpc3RUeXBlKG1vZGVsQXR0cmlidXRlcy5saXN0VHlwZSkgfHwgdmlld0VsZW1lbnQuaWQgIT0gZ2V0Vmlld0VsZW1lbnRJZEZvckxpc3RUeXBlKG1vZGVsQXR0cmlidXRlcy5saXN0VHlwZSwgbW9kZWxBdHRyaWJ1dGVzLmxpc3RJbmRlbnQpKSB7XG4gICAgICAgICAgICAgICAgZXZ0LnJldHVybiA9IHRydWU7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZWdpc3RlcnMgbW9kZWwgcG9zdC1maXhlcnMuXG5cdCAqLyBfc2V0dXBNb2RlbFBvc3RGaXhpbmcoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWVzID0gdGhpcy5nZXRMaXN0QXR0cmlidXRlTmFtZXMoKTtcbiAgICAgICAgLy8gUmVnaXN0ZXIgbGlzdCBmaXhpbmcuXG4gICAgICAgIC8vIEZpcnN0IHRoZSBsb3cgbGV2ZWwgaGFuZGxlci5cbiAgICAgICAgbW9kZWwuZG9jdW1lbnQucmVnaXN0ZXJQb3N0Rml4ZXIoKHdyaXRlcik9Pm1vZGVsQ2hhbmdlUG9zdEZpeGVyJDEobW9kZWwsIHdyaXRlciwgYXR0cmlidXRlTmFtZXMsIHRoaXMpKTtcbiAgICAgICAgLy8gVGhlbiB0aGUgY2FsbGJhY2tzIGZvciB0aGUgc3BlY2lmaWMgbGlzdHMuXG4gICAgICAgIC8vIFRoZSBpbmRlbnRhdGlvbiBmaXhpbmcgbXVzdCBiZSB0aGUgZmlyc3Qgb25lLi4uXG4gICAgICAgIHRoaXMub24oJ3Bvc3RGaXhlcicsIChldnQsIHsgbGlzdE5vZGVzLCB3cml0ZXIgfSk9PntcbiAgICAgICAgICAgIGV2dC5yZXR1cm4gPSBmaXhMaXN0SW5kZW50cyhsaXN0Tm9kZXMsIHdyaXRlcikgfHwgZXZ0LnJldHVybjtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gLi4udGhlbiB0aGUgaXRlbSBpZHMuLi4gYW5kIGFmdGVyIHRoYXQgb3RoZXIgZml4ZXJzIHRoYXQgcmVseSBvbiB0aGUgY29ycmVjdCBpbmRlbnRhdGlvbiBhbmQgaWRzLlxuICAgICAgICB0aGlzLm9uKCdwb3N0Rml4ZXInLCAoZXZ0LCB7IGxpc3ROb2Rlcywgd3JpdGVyLCBzZWVuSWRzIH0pPT57XG4gICAgICAgICAgICBldnQucmV0dXJuID0gZml4TGlzdEl0ZW1JZHMobGlzdE5vZGVzLCBzZWVuSWRzLCB3cml0ZXIpIHx8IGV2dC5yZXR1cm47XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbnRlZ3JhdGVzIHRoZSBmZWF0dXJlIHdpdGggdGhlIGNsaXBib2FyZCB2aWEge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjaW5zZXJ0Q29udGVudH0gYW5kXG5cdCAqIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsI2dldFNlbGVjdGVkQ29udGVudH0uXG5cdCAqLyBfc2V0dXBDbGlwYm9hcmRJbnRlZ3JhdGlvbigpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgY2xpcGJvYXJkUGlwZWxpbmUgPSB0aGlzLmVkaXRvci5wbHVnaW5zLmdldCgnQ2xpcGJvYXJkUGlwZWxpbmUnKTtcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2luc2VydENvbnRlbnQnLCBjcmVhdGVNb2RlbEluZGVudFBhc3RlRml4ZXIobW9kZWwpLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUbyBlbmhhbmNlIHRoZSBVWCwgdGhlIGVkaXRvciBzaG91bGQgbm90IGNvcHkgbGlzdCBhdHRyaWJ1dGVzIHRvIHRoZSBjbGlwYm9hcmQgaWYgdGhlIHNlbGVjdGlvblxuICAgICAgICAvLyBzdGFydGVkIGFuZCBlbmRlZCBpbiB0aGUgc2FtZSBsaXN0IGl0ZW0uXG4gICAgICAgIC8vXG4gICAgICAgIC8vIElmIHRoZSBzZWxlY3Rpb24gd2FzIGVuY2xvc2VkIGluIGEgc2luZ2xlIGxpc3QgaXRlbSwgdGhlcmUgaXMgYSBnb29kIGNoYW5jZSB0aGUgdXNlciBkaWQgbm90IHdhbnQgaXRcbiAgICAgICAgLy8gY29waWVkIGFzIGEgbGlzdCBpdGVtIGJ1dCBwbGFpbiBibG9ja3MuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoaXMgYXZvaWRzIHBhc3Rpbmcgb3JwaGFuZWQgbGlzdCBpdGVtcyBpbnN0ZWFkIG9mIHBhcmFncmFwaHMsIGZvciBpbnN0YW5jZSwgc3RyYWlnaHQgaW50byB0aGUgcm9vdC5cbiAgICAgICAgLy9cbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSs4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiBTZWxlY3Rpb24gICAgICAgICAgIOKUgiBDbGlwYm9hcmQgY29udGVudCDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiBbKiA8V2lkZ2V0IC8+XSAgICAgIOKUgiA8V2lkZ2V0IC8+ICAgICAgICDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiBbKiBGb29dICAgICAgICAgICAgIOKUgiBGb28gICAgICAgICAgICAgICDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiAqIEZvbyBbYmFyXSBiYXogICAgIOKUgiBiYXIgICAgICAgICAgICAgICDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSkXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiAqIEZvW28gICAgICAgICAgICAgIOKUgiBvICAgICAgICAgICAgICAgICDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSCICAgYmFdciAgICAgICAgICAgICAg4pSCIGJhICAgICAgICAgICAgICAgIOKUglxuICAgICAgICAvL1x0ICAgICAgICAgICAgICAgICAgICAgICDilJzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilLzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilKRcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSCICogRm9bbyAgICAgICAgICAgICAg4pSCICogbyAgICAgICAgICAgICAgIOKUglxuICAgICAgICAvL1x0ICAgICAgICAgICAgICAgICAgICAgICDilIIgKiBiYV1yICAgICAgICAgICAgICDilIIgKiBiYSAgICAgICAgICAgICAg4pSCXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUvOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUpFxuICAgICAgICAvL1x0ICAgICAgICAgICAgICAgICAgICAgICDilIIgWyogRm9vICAgICAgICAgICAgICDilIIgKiBGb28gICAgICAgICAgICAg4pSCXG4gICAgICAgIC8vXHQgICAgICAgICAgICAgICAgICAgICAgIOKUgiAgKiBiYXJdICAgICAgICAgICAgIOKUgiAqIGJhciAgICAgICAgICAgICDilIJcbiAgICAgICAgLy9cdCAgICAgICAgICAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pS04pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMTYwOCwgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTQ5NjlcbiAgICAgICAgdGhpcy5saXN0ZW5UbyhjbGlwYm9hcmRQaXBlbGluZSwgJ291dHB1dFRyYW5zZm9ybWF0aW9uJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBsYXN0IGJsb2NrIGlmIGl0J3MgZW1wdHkuXG4gICAgICAgICAgICAgICAgY29uc3QgYWxsQ29udGVudENoaWxkcmVuID0gQXJyYXkuZnJvbShkYXRhLmNvbnRlbnQuZ2V0Q2hpbGRyZW4oKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdEl0ZW0gPSBhbGxDb250ZW50Q2hpbGRyZW5bYWxsQ29udGVudENoaWxkcmVuLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgIGlmIChhbGxDb250ZW50Q2hpbGRyZW4ubGVuZ3RoID4gMSAmJiBsYXN0SXRlbS5pcygnZWxlbWVudCcpICYmIGxhc3RJdGVtLmlzRW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudENoaWxkcmVuRXhjZXB0TGFzdEl0ZW0gPSBhbGxDb250ZW50Q2hpbGRyZW4uc2xpY2UoMCwgLTEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudENoaWxkcmVuRXhjZXB0TGFzdEl0ZW0uZXZlcnkoaXNMaXN0SXRlbUJsb2NrKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZShsYXN0SXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ29weS9jdXQgb25seSBjb250ZW50IG9mIGEgbGlzdCBpdGVtIChmb3IgZHJhZy1kcm9wIG1vdmUgdGhlIHdob2xlIGxpc3QgaXRlbSkuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubWV0aG9kID09ICdjb3B5JyB8fCBkYXRhLm1ldGhvZCA9PSAnY3V0Jykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxDaGlsZHJlbiA9IEFycmF5LmZyb20oZGF0YS5jb250ZW50LmdldENoaWxkcmVuKCkpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1NpbmdsZUxpc3RJdGVtU2VsZWN0ZWQgPSBpc1NpbmdsZUxpc3RJdGVtKGFsbENoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU2luZ2xlTGlzdEl0ZW1TZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlTGlzdEF0dHJpYnV0ZXMoYWxsQ2hpbGRyZW4sIHdyaXRlcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBJbmZvcm1zIGVkaXRvciBhY2Nlc3NpYmlsaXR5IGZlYXR1cmVzIGFib3V0IGtleXN0cm9rZXMgYnJvdWdodCBieSB0aGUgcGx1Z2luLlxuXHQgKi8gX3NldHVwQWNjZXNzaWJpbGl0eUludGVncmF0aW9uKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgdCA9IGVkaXRvci50O1xuICAgICAgICBlZGl0b3IuYWNjZXNzaWJpbGl0eS5hZGRLZXlzdHJva2VJbmZvR3JvdXAoe1xuICAgICAgICAgICAgaWQ6ICdsaXN0JyxcbiAgICAgICAgICAgIGxhYmVsOiB0KCdLZXlzdHJva2VzIHRoYXQgY2FuIGJlIHVzZWQgaW4gYSBsaXN0JyksXG4gICAgICAgICAgICBrZXlzdHJva2VzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnSW5jcmVhc2UgbGlzdCBpdGVtIGluZGVudCcpLFxuICAgICAgICAgICAgICAgICAgICBrZXlzdHJva2U6ICdUYWInXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdEZWNyZWFzZSBsaXN0IGl0ZW0gaW5kZW50JyksXG4gICAgICAgICAgICAgICAgICAgIGtleXN0cm9rZTogJ1NoaWZ0K1RhYidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogUG9zdC1maXhlciB0aGF0IHJlYWN0cyB0byBjaGFuZ2VzIG9uIGRvY3VtZW50IGFuZCBmaXhlcyBpbmNvcnJlY3QgbW9kZWwgc3RhdGVzIChpbnZhbGlkIGBsaXN0SXRlbUlkYCBhbmQgYGxpc3RJbmRlbnRgIHZhbHVlcykuXG4gKlxuICogSW4gdGhlIGV4YW1wbGUgYmVsb3csIHRoZXJlIGlzIGEgY29ycmVjdCBsaXN0IHN0cnVjdHVyZS5cbiAqIFRoZW4gdGhlIG1pZGRsZSBlbGVtZW50IGlzIHJlbW92ZWQgc28gdGhlIGxpc3Qgc3RydWN0dXJlIHdpbGwgYmVjb21lIGluY29ycmVjdDpcbiAqXG4gKiBgYGB4bWxcbiAqIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJdGVtSWQ9XCJhXCIgbGlzdEluZGVudD0wPkl0ZW0gMTwvcGFyYWdyYXBoPlxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImJcIiBsaXN0SW5kZW50PTE+SXRlbSAyPC9wYXJhZ3JhcGg+ICAgPC0tLSB0aGlzIGlzIHJlbW92ZWQuXG4gKiA8cGFyYWdyYXBoIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SXRlbUlkPVwiY1wiIGxpc3RJbmRlbnQ9Mj5JdGVtIDM8L3BhcmFncmFwaD5cbiAqIGBgYFxuICpcbiAqIFRoZSBsaXN0IHN0cnVjdHVyZSBhZnRlciB0aGUgbWlkZGxlIGVsZW1lbnQgaXMgcmVtb3ZlZDpcbiAqXG4gKiBgYGB4bWxcbiAqIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJdGVtSWQ9XCJhXCIgbGlzdEluZGVudD0wPkl0ZW0gMTwvcGFyYWdyYXBoPlxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImNcIiBsaXN0SW5kZW50PTI+SXRlbSAzPC9wYXJhZ3JhcGg+XG4gKiBgYGBcbiAqXG4gKiBTaG91bGQgYmVjb21lOlxuICpcbiAqIGBgYHhtbFxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImFcIiBsaXN0SW5kZW50PTA+SXRlbSAxPC9wYXJhZ3JhcGg+XG4gKiA8cGFyYWdyYXBoIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SXRlbUlkPVwiY1wiIGxpc3RJbmRlbnQ9MT5JdGVtIDM8L3BhcmFncmFwaD4gICA8LS0tIG5vdGUgdGhhdCBpbmRlbnQgZ290IHBvc3QtZml4ZWQuXG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbW9kZWwgVGhlIGRhdGEgbW9kZWwuXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSB3cml0ZXIgdG8gZG8gY2hhbmdlcyB3aXRoLlxuICogQHBhcmFtIGF0dHJpYnV0ZU5hbWVzIFRoZSBsaXN0IG9mIGFsbCBtb2RlbCBsaXN0IGF0dHJpYnV0ZXMgKGluY2x1ZGluZyByZWdpc3RlcmVkIHN0cmF0ZWdpZXMpLlxuICogQHBhcmFtIExpc3RFZGl0aW5nIFRoZSBkb2N1bWVudCBsaXN0IGVkaXRpbmcgcGx1Z2luLlxuICogQHJldHVybnMgYHRydWVgIGlmIGFueSBjaGFuZ2UgaGFzIGJlZW4gYXBwbGllZCwgYGZhbHNlYCBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gbW9kZWxDaGFuZ2VQb3N0Rml4ZXIkMShtb2RlbCwgd3JpdGVyLCBhdHRyaWJ1dGVOYW1lcywgbGlzdEVkaXRpbmcpIHtcbiAgICBjb25zdCBjaGFuZ2VzID0gbW9kZWwuZG9jdW1lbnQuZGlmZmVyLmdldENoYW5nZXMoKTtcbiAgICBjb25zdCB2aXNpdGVkID0gbmV3IFNldCgpO1xuICAgIGNvbnN0IGl0ZW1Ub0xpc3RIZWFkID0gbmV3IFNldCgpO1xuICAgIGNvbnN0IG11bHRpQmxvY2sgPSBsaXN0RWRpdGluZy5lZGl0b3IuY29uZmlnLmdldCgnbGlzdC5tdWx0aUJsb2NrJyk7XG4gICAgbGV0IGFwcGxpZWQgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGNoYW5nZXMpe1xuICAgICAgICBpZiAoZW50cnkudHlwZSA9PSAnaW5zZXJ0JyAmJiBlbnRyeS5uYW1lICE9ICckdGV4dCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBlbnRyeS5wb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgICAgICAgICAvLyBSZW1vdmUgYXR0cmlidXRlcyBpbiBjYXNlIG9mIHJlbmFtZWQgZWxlbWVudC5cbiAgICAgICAgICAgIGlmICghbW9kZWwuc2NoZW1hLmNoZWNrQXR0cmlidXRlKGl0ZW0sICdsaXN0SXRlbUlkJykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZU5hbWUgb2YgQXJyYXkuZnJvbShpdGVtLmdldEF0dHJpYnV0ZUtleXMoKSkpe1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlTmFtZXMuaW5jbHVkZXMoYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmRBbmRBZGRMaXN0SGVhZFRvTWFwKGVudHJ5LnBvc2l0aW9uLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCk7XG4gICAgICAgICAgICAvLyBJbnNlcnQgb2YgYSBub24tbGlzdCBpdGVtIC0gY2hlY2sgaWYgdGhlcmUgaXMgYSBsaXN0IGFmdGVyIGl0LlxuICAgICAgICAgICAgaWYgKCFlbnRyeS5hdHRyaWJ1dGVzLmhhcygnbGlzdEl0ZW1JZCcpKSB7XG4gICAgICAgICAgICAgICAgZmluZEFuZEFkZExpc3RIZWFkVG9NYXAoZW50cnkucG9zaXRpb24uZ2V0U2hpZnRlZEJ5KGVudHJ5Lmxlbmd0aCksIGl0ZW1Ub0xpc3RIZWFkLCB2aXNpdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIG5vIG5lc3RlZCBsaXN0LlxuICAgICAgICAgICAgZm9yIChjb25zdCB7IGl0ZW06IGlubmVySXRlbSwgcHJldmlvdXNQb3NpdGlvbiB9IG9mIG1vZGVsLmNyZWF0ZVJhbmdlSW4oaXRlbSkpe1xuICAgICAgICAgICAgICAgIGlmIChpc0xpc3RJdGVtQmxvY2soaW5uZXJJdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICBmaW5kQW5kQWRkTGlzdEhlYWRUb01hcChwcmV2aW91c1Bvc2l0aW9uLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LnR5cGUgPT0gJ3JlbW92ZScpIHtcbiAgICAgICAgICAgIGZpbmRBbmRBZGRMaXN0SGVhZFRvTWFwKGVudHJ5LnBvc2l0aW9uLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZW50cnkudHlwZSA9PSAnYXR0cmlidXRlJyAmJiBhdHRyaWJ1dGVOYW1lcy5pbmNsdWRlcyhlbnRyeS5hdHRyaWJ1dGVLZXkpKSB7XG4gICAgICAgICAgICBmaW5kQW5kQWRkTGlzdEhlYWRUb01hcChlbnRyeS5yYW5nZS5zdGFydCwgaXRlbVRvTGlzdEhlYWQsIHZpc2l0ZWQpO1xuICAgICAgICAgICAgaWYgKGVudHJ5LmF0dHJpYnV0ZU5ld1ZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZmluZEFuZEFkZExpc3RIZWFkVG9NYXAoZW50cnkucmFuZ2Uuc3RhcnQuZ2V0U2hpZnRlZEJ5KDEpLCBpdGVtVG9MaXN0SGVhZCwgdmlzaXRlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlcmUgaXMgbm8gbGVmdCBvdmVyIGxpc3RJdGVtIGVsZW1lbnQgd2l0aG91dCBhdHRyaWJ1dGVzIG9yIGEgYmxvY2sgd2l0aCBsaXN0IGF0dHJpYnV0ZXMgdGhhdCBpcyBub3QgYSBsaXN0SXRlbS5cbiAgICAgICAgaWYgKCFtdWx0aUJsb2NrICYmIGVudHJ5LnR5cGUgPT0gJ2F0dHJpYnV0ZScgJiYgTElTVF9CQVNFX0FUVFJJQlVURVMuaW5jbHVkZXMoZW50cnkuYXR0cmlidXRlS2V5KSkge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGVudHJ5LnJhbmdlLnN0YXJ0Lm5vZGVBZnRlcjtcbiAgICAgICAgICAgIGlmIChlbnRyeS5hdHRyaWJ1dGVOZXdWYWx1ZSA9PT0gbnVsbCAmJiBlbGVtZW50ICYmIGVsZW1lbnQuaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgICAgIHdyaXRlci5yZW5hbWUoZWxlbWVudCwgJ3BhcmFncmFwaCcpO1xuICAgICAgICAgICAgICAgIGFwcGxpZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5hdHRyaWJ1dGVPbGRWYWx1ZSA9PT0gbnVsbCAmJiBlbGVtZW50ICYmIGVsZW1lbnQuaXMoJ2VsZW1lbnQnKSAmJiBlbGVtZW50Lm5hbWUgIT0gJ2xpc3RJdGVtJykge1xuICAgICAgICAgICAgICAgIHdyaXRlci5yZW5hbWUoZWxlbWVudCwgJ2xpc3RJdGVtJyk7XG4gICAgICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gTWFrZSBzdXJlIHRoYXQgSURzIGFyZSBub3Qgc2hhcmVkIGJ5IHNwbGl0IGxpc3QuXG4gICAgY29uc3Qgc2VlbklkcyA9IG5ldyBTZXQoKTtcbiAgICBmb3IgKGNvbnN0IGxpc3RIZWFkIG9mIGl0ZW1Ub0xpc3RIZWFkLnZhbHVlcygpKXtcbiAgICAgICAgYXBwbGllZCA9IGxpc3RFZGl0aW5nLmZpcmUoJ3Bvc3RGaXhlcicsIHtcbiAgICAgICAgICAgIGxpc3ROb2RlczogbmV3IExpc3RCbG9ja3NJdGVyYWJsZShsaXN0SGVhZCksXG4gICAgICAgICAgICBsaXN0SGVhZCxcbiAgICAgICAgICAgIHdyaXRlcixcbiAgICAgICAgICAgIHNlZW5JZHNcbiAgICAgICAgfSkgfHwgYXBwbGllZDtcbiAgICB9XG4gICAgcmV0dXJuIGFwcGxpZWQ7XG59XG4vKipcbiAqIEEgZml4ZXIgZm9yIHBhc3RlZCBjb250ZW50IHRoYXQgaW5jbHVkZXMgbGlzdCBpdGVtcy5cbiAqXG4gKiBJdCBmaXhlcyBpbmRlbnRhdGlvbiBvZiBwYXN0ZWQgbGlzdCBpdGVtcyBzbyB0aGUgcGFzdGVkIGl0ZW1zIG1hdGNoIGNvcnJlY3RseSB0byB0aGUgY29udGV4dCB0aGV5IGFyZSBwYXN0ZWQgaW50by5cbiAqXG4gKiBFeGFtcGxlOlxuICpcbiAqIGBgYHhtbFxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImFcIiBsaXN0SW5kZW50PVwiMFwiPkE8L3BhcmFncmFwaD5cbiAqIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJdGVtSWQ9XCJiXCIgbGlzdEluZGVudD1cIjFcIj5CXjwvcGFyYWdyYXBoPlxuICogLy8gQXQgXiBwYXN0ZTogIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJudW1iZXJlZFwiIGxpc3RJdGVtSWQ9XCJ4XCIgbGlzdEluZGVudD1cIjBcIj5YPC9wYXJhZ3JhcGg+XG4gKiAvLyAgICAgICAgICAgICAgPHBhcmFncmFwaCBsaXN0VHlwZT1cIm51bWJlcmVkXCIgbGlzdEl0ZW1JZD1cInlcIiBsaXN0SW5kZW50PVwiMVwiPlk8L3BhcmFncmFwaD5cbiAqIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJdGVtSWQ9XCJjXCIgbGlzdEluZGVudD1cIjJcIj5DPC9wYXJhZ3JhcGg+XG4gKiBgYGBcbiAqXG4gKiBTaG91bGQgYmVjb21lOlxuICpcbiAqIGBgYHhtbFxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImFcIiBsaXN0SW5kZW50PVwiMFwiPkE8L3BhcmFncmFwaD5cbiAqIDxwYXJhZ3JhcGggbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJdGVtSWQ9XCJiXCIgbGlzdEluZGVudD1cIjFcIj5CWDwvcGFyYWdyYXBoPlxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cInlcIiBsaXN0SW5kZW50PVwiMlwiPlkvcGFyYWdyYXBoPlxuICogPHBhcmFncmFwaCBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEl0ZW1JZD1cImNcIiBsaXN0SW5kZW50PVwiMlwiPkM8L3BhcmFncmFwaD5cbiAqIGBgYFxuICovIGZ1bmN0aW9uIGNyZWF0ZU1vZGVsSW5kZW50UGFzdGVGaXhlcihtb2RlbCkge1xuICAgIHJldHVybiAoZXZ0LCBbY29udGVudCwgc2VsZWN0YWJsZV0pPT57XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gY29udGVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpID8gQXJyYXkuZnJvbShjb250ZW50LmdldENoaWxkcmVuKCkpIDogW1xuICAgICAgICAgICAgY29udGVudFxuICAgICAgICBdO1xuICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHNlbGVjdGFibGUgPyBtb2RlbC5jcmVhdGVTZWxlY3Rpb24oc2VsZWN0YWJsZSkgOiBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKTtcbiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIGxpc3QgaXRlbS4gQXR0cmlidXRlcyBvZiB0aGUgaW5zZXJ0ZWQgbGlzdCBpdGVtcyB3aWxsIGJlIGZpeGVkIGFjY29yZGluZyB0byB0aGF0IGl0ZW0uXG4gICAgICAgIGxldCByZWZJdGVtO1xuICAgICAgICBpZiAoaXNMaXN0SXRlbUJsb2NrKHBvc2l0aW9uLnBhcmVudCkpIHtcbiAgICAgICAgICAgIHJlZkl0ZW0gPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNMaXN0SXRlbUJsb2NrKHBvc2l0aW9uLm5vZGVCZWZvcmUpICYmIGlzTGlzdEl0ZW1CbG9jayhwb3NpdGlvbi5ub2RlQWZ0ZXIpKSB7XG4gICAgICAgICAgICByZWZJdGVtID0gcG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjsgLy8gQ29udGVudCBpcyBub3QgY29waWVkIGludG8gYSBsaXN0LlxuICAgICAgICB9XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgcmVmVHlwZSA9IHJlZkl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpO1xuICAgICAgICAgICAgY29uc3QgcmVmSW5kZW50ID0gcmVmSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0RWxlbWVudEluZGVudCA9IGl0ZW1zWzBdLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpIHx8IDA7XG4gICAgICAgICAgICBjb25zdCBpbmRlbnREaWZmID0gTWF0aC5tYXgocmVmSW5kZW50IC0gZmlyc3RFbGVtZW50SW5kZW50LCAwKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNMaXN0SXRlbSA9IGlzTGlzdEl0ZW1CbG9jayhpdGVtKTtcbiAgICAgICAgICAgICAgICBpZiAocmVmSXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpICYmIGl0ZW0uaXMoJ2VsZW1lbnQnLCAncGFyYWdyYXBoJykpIHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG5cdFx0XHRcdFx0ICogV2hlbiBwYXJhZ3JhcGhzIG9yIGEgcGxhaW4gdGV4dCBsaXN0IGlzIHBhc3RlZCBpbnRvIGEgc2ltcGxlIGxpc3QsIGNvbnZlcnRcblx0XHRcdFx0XHQgKiB0aGUgYDxwYXJhZ3JhcGhzPicgdG8gYDxsaXN0SXRlbT4nIHRvIGF2b2lkIGJyZWFraW5nIHRoZSB0YXJnZXQgbGlzdC5cblx0XHRcdFx0XHQgKlxuXHRcdFx0XHRcdCAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMzgyNi5cblx0XHRcdFx0XHQgKi8gd3JpdGVyLnJlbmFtZShpdGVtLCAnbGlzdEl0ZW0nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICBsaXN0SW5kZW50OiAoaXNMaXN0SXRlbSA/IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgOiAwKSArIGluZGVudERpZmYsXG4gICAgICAgICAgICAgICAgICAgIGxpc3RJdGVtSWQ6IGlzTGlzdEl0ZW0gPyBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcpIDogTGlzdEl0ZW1VaWQubmV4dCgpLFxuICAgICAgICAgICAgICAgICAgICBsaXN0VHlwZTogcmVmVHlwZVxuICAgICAgICAgICAgICAgIH0sIGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBEZWNpZGVzIHdoZXRoZXIgdGhlIG1lcmdlIHNob3VsZCBiZSBhY2NvbXBhbmllZCBieSB0aGUgbW9kZWwncyBgZGVsZXRlQ29udGVudCgpYCwgZm9yIGluc3RhbmNlLCB0byBnZXQgcmlkIG9mIHRoZSBpbmxpbmVcbiAqIGNvbnRlbnQgaW4gdGhlIHNlbGVjdGlvbiBvciB0YWtlIGFkdmFudGFnZSBvZiB0aGUgaGV1cmlzdGljcyBpbiBgZGVsZXRlQ29udGVudCgpYCB0aGF0IGhlbHBzIGNvbnZlcnQgbGlzdHMgaW50byBwYXJhZ3JhcGhzXG4gKiBpbiBjZXJ0YWluIGNhc2VzLlxuICovIGZ1bmN0aW9uIHNob3VsZE1lcmdlT25CbG9ja3NDb250ZW50TGV2ZWwobW9kZWwsIGRpcmVjdGlvbikge1xuICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICBpZiAoIXNlbGVjdGlvbi5pc0NvbGxhcHNlZCkge1xuICAgICAgICByZXR1cm4gIWdldFNlbGVjdGVkQmxvY2tPYmplY3QobW9kZWwpO1xuICAgIH1cbiAgICBpZiAoZGlyZWN0aW9uID09PSAnZm9yd2FyZCcpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IGZpcnN0UG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gZmlyc3RQb3NpdGlvbi5wYXJlbnQ7XG4gICAgY29uc3QgcHJldmlvdXNTaWJsaW5nID0gcG9zaXRpb25QYXJlbnQucHJldmlvdXNTaWJsaW5nO1xuICAgIGlmIChtb2RlbC5zY2hlbWEuaXNPYmplY3QocHJldmlvdXNTaWJsaW5nKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChwcmV2aW91c1NpYmxpbmcuaXNFbXB0eSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGlzU2luZ2xlTGlzdEl0ZW0oW1xuICAgICAgICBwb3NpdGlvblBhcmVudCxcbiAgICAgICAgcHJldmlvdXNTaWJsaW5nXG4gICAgXSk7XG59XG5cbi8qKlxuICogSGVscGVyIG1ldGhvZCBmb3IgY3JlYXRpbmcgdG9vbGJhciBhbmQgbWVudSBidXR0b25zIGFuZCBsaW5raW5nIHRoZW0gd2l0aCBhbiBhcHByb3ByaWF0ZSBjb21tYW5kLlxuICpcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGVkaXRvciBUaGUgZWRpdG9yIGluc3RhbmNlIHRvIHdoaWNoIHRoZSBVSSBjb21wb25lbnQgd2lsbCBiZSBhZGRlZC5cbiAqIEBwYXJhbSBjb21tYW5kTmFtZSBUaGUgbmFtZSBvZiB0aGUgY29tbWFuZC5cbiAqIEBwYXJhbSBsYWJlbCBUaGUgYnV0dG9uIGxhYmVsLlxuICogQHBhcmFtIGljb24gVGhlIHNvdXJjZSBvZiB0aGUgaWNvbi5cbiAqLyBmdW5jdGlvbiBjcmVhdGVVSUNvbXBvbmVudHMoZWRpdG9yLCBjb21tYW5kTmFtZSwgbGFiZWwsIGljb24pIHtcbiAgICBlZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5hZGQoY29tbWFuZE5hbWUsICgpPT57XG4gICAgICAgIGNvbnN0IGJ1dHRvblZpZXcgPSBfY3JlYXRlQnV0dG9uKEJ1dHRvblZpZXcsIGVkaXRvciwgY29tbWFuZE5hbWUsIGxhYmVsLCBpY29uKTtcbiAgICAgICAgYnV0dG9uVmlldy5zZXQoe1xuICAgICAgICAgICAgdG9vbHRpcDogdHJ1ZSxcbiAgICAgICAgICAgIGlzVG9nZ2xlYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvblZpZXc7XG4gICAgfSk7XG4gICAgZWRpdG9yLnVpLmNvbXBvbmVudEZhY3RvcnkuYWRkKGBtZW51QmFyOiR7Y29tbWFuZE5hbWV9YCwgKCk9PntcbiAgICAgICAgY29uc3QgYnV0dG9uVmlldyA9IF9jcmVhdGVCdXR0b24oTWVudUJhck1lbnVMaXN0SXRlbUJ1dHRvblZpZXcsIGVkaXRvciwgY29tbWFuZE5hbWUsIGxhYmVsLCBpY29uKTtcbiAgICAgICAgYnV0dG9uVmlldy5zZXQoe1xuICAgICAgICAgICAgcm9sZTogJ21lbnVpdGVtY2hlY2tib3gnLFxuICAgICAgICAgICAgaXNUb2dnbGVhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYnV0dG9uVmlldztcbiAgICB9KTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIGJ1dHRvbiB0byB1c2UgZWl0aGVyIGluIHRvb2xiYXIgb3IgaW4gbWVudSBiYXIuXG4gKi8gZnVuY3Rpb24gX2NyZWF0ZUJ1dHRvbihCdXR0b25DbGFzcywgZWRpdG9yLCBjb21tYW5kTmFtZSwgbGFiZWwsIGljb24pIHtcbiAgICBjb25zdCBjb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldChjb21tYW5kTmFtZSk7XG4gICAgY29uc3QgdmlldyA9IG5ldyBCdXR0b25DbGFzcyhlZGl0b3IubG9jYWxlKTtcbiAgICB2aWV3LnNldCh7XG4gICAgICAgIGxhYmVsLFxuICAgICAgICBpY29uXG4gICAgfSk7XG4gICAgLy8gQmluZCBidXR0b24gbW9kZWwgdG8gY29tbWFuZC5cbiAgICB2aWV3LmJpbmQoJ2lzT24nLCAnaXNFbmFibGVkJykudG8oY29tbWFuZCwgJ3ZhbHVlJywgJ2lzRW5hYmxlZCcpO1xuICAgIC8vIEV4ZWN1dGUgdGhlIGNvbW1hbmQuXG4gICAgdmlldy5vbignZXhlY3V0ZScsICgpPT57XG4gICAgICAgIGVkaXRvci5leGVjdXRlKGNvbW1hbmROYW1lKTtcbiAgICAgICAgZWRpdG9yLmVkaXRpbmcudmlldy5mb2N1cygpO1xuICAgIH0pO1xuICAgIHJldHVybiB2aWV3O1xufVxuXG4vKipcbiAqIFRoZSBsaXN0IFVJIGZlYXR1cmUuIEl0IGludHJvZHVjZXMgdGhlIGAnbnVtYmVyZWRMaXN0J2AgYW5kIGAnYnVsbGV0ZWRMaXN0J2AgYnV0dG9ucyB0aGF0XG4gKiBhbGxvdyB0byBjb252ZXJ0IHBhcmFncmFwaHMgdG8gYW5kIGZyb20gbGlzdCBpdGVtcyBhbmQgaW5kZW50IG9yIG91dGRlbnQgdGhlbS5cbiAqLyBjbGFzcyBMaXN0VUkgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xpc3RVSSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5lZGl0b3IudDtcbiAgICAgICAgLy8gQ3JlYXRlIGJ1dHRvbiBudW1iZXJlZExpc3QuXG4gICAgICAgIGlmICghdGhpcy5lZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5oYXMoJ251bWJlcmVkTGlzdCcpKSB7XG4gICAgICAgICAgICBjcmVhdGVVSUNvbXBvbmVudHModGhpcy5lZGl0b3IsICdudW1iZXJlZExpc3QnLCB0KCdOdW1iZXJlZCBMaXN0JyksIGljb25zLm51bWJlcmVkTGlzdCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIGJ1dHRvbiBidWxsZXRlZExpc3QuXG4gICAgICAgIGlmICghdGhpcy5lZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5oYXMoJ2J1bGxldGVkTGlzdCcpKSB7XG4gICAgICAgICAgICBjcmVhdGVVSUNvbXBvbmVudHModGhpcy5lZGl0b3IsICdidWxsZXRlZExpc3QnLCB0KCdCdWxsZXRlZCBMaXN0JyksIGljb25zLmJ1bGxldGVkTGlzdCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3QgZmVhdHVyZS5cbiAqXG4gKiBUaGlzIGlzIGEgXCJnbHVlXCIgcGx1Z2luIHRoYXQgbG9hZHMgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9saXN0L2xpc3RlZGl0aW5nfkxpc3RFZGl0aW5nICBsaXN0XG4gKiBlZGl0aW5nIGZlYXR1cmV9IGFuZCB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdC9saXN0dWl+TGlzdFVJIGxpc3QgVUkgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGlzdCBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHJlcXVpcmVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgTGlzdEVkaXRpbmcsXG4gICAgICAgICAgICBMaXN0VUlcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGlzdCc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3Qgc3RhcnQgaW5kZXggY29tbWFuZC4gSXQgY2hhbmdlcyB0aGUgYGxpc3RTdGFydGAgYXR0cmlidXRlIG9mIHRoZSBzZWxlY3RlZCBsaXN0IGl0ZW1zLFxuICogbGV0dGluZyB0aGUgdXNlciB0byBjaG9vc2UgdGhlIHN0YXJ0aW5nIHBvaW50IG9mIGFuIG9yZGVyZWQgbGlzdC5cbiAqIEl0IGlzIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9saXN0cHJvcGVydGllc35MaXN0UHJvcGVydGllcyBsaXN0IHByb3BlcnRpZXMgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGlzdFN0YXJ0Q29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9nZXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdmFsdWUgIT0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4ZWN1dGVzIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAZmlyZXMgZXhlY3V0ZVxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zdGFydEluZGV4IFRoZSBsaXN0IHN0YXJ0IGluZGV4LlxuXHQgKi8gZXhlY3V0ZSh7IHN0YXJ0SW5kZXggPSAxIH0gPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBsZXQgYmxvY2tzID0gQXJyYXkuZnJvbShkb2N1bWVudC5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKSkuZmlsdGVyKChibG9jayk9PmlzTGlzdEl0ZW1CbG9jayhibG9jaykgJiYgaXNOdW1iZXJlZExpc3RUeXBlKGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSkpO1xuICAgICAgICBibG9ja3MgPSBleHBhbmRMaXN0QmxvY2tzVG9Db21wbGV0ZUxpc3QoYmxvY2tzKTtcbiAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdFN0YXJ0Jywgc3RhcnRJbmRleCA+PSAwID8gc3RhcnRJbmRleCA6IDEsIGJsb2NrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgdGhlIGNvbW1hbmQncyB7QGxpbmsgI3ZhbHVlfS5cblx0ICpcblx0ICogQHJldHVybnMgVGhlIGN1cnJlbnQgdmFsdWUuXG5cdCAqLyBfZ2V0VmFsdWUoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZmlyc3QoZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgICAgICBpZiAoYmxvY2sgJiYgaXNMaXN0SXRlbUJsb2NrKGJsb2NrKSAmJiBpc051bWJlcmVkTGlzdFR5cGUoYmxvY2suZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFN0YXJ0Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4qIEBtb2R1bGUgbGlzdC9saXN0cHJvcGVydGllcy91dGlscy9zdHlsZVxuKi8gY29uc3QgTElTVF9TVFlMRV9UT19MSVNUX1RZUEUgPSB7fTtcbmNvbnN0IExJU1RfU1RZTEVfVE9fVFlQRV9BVFRSSUJVVEUgPSB7fTtcbmNvbnN0IFRZUEVfQVRUUklCVVRFX1RPX0xJU1RfU1RZTEUgPSB7fTtcbmNvbnN0IExJU1RfU1RZTEVfVFlQRVMgPSBbXG4gICAge1xuICAgICAgICBsaXN0U3R5bGU6ICdkaXNjJyxcbiAgICAgICAgdHlwZUF0dHJpYnV0ZTogJ2Rpc2MnLFxuICAgICAgICBsaXN0VHlwZTogJ2J1bGxldGVkJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBsaXN0U3R5bGU6ICdjaXJjbGUnLFxuICAgICAgICB0eXBlQXR0cmlidXRlOiAnY2lyY2xlJyxcbiAgICAgICAgbGlzdFR5cGU6ICdidWxsZXRlZCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbGlzdFN0eWxlOiAnc3F1YXJlJyxcbiAgICAgICAgdHlwZUF0dHJpYnV0ZTogJ3NxdWFyZScsXG4gICAgICAgIGxpc3RUeXBlOiAnYnVsbGV0ZWQnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGxpc3RTdHlsZTogJ2RlY2ltYWwnLFxuICAgICAgICB0eXBlQXR0cmlidXRlOiAnMScsXG4gICAgICAgIGxpc3RUeXBlOiAnbnVtYmVyZWQnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGxpc3RTdHlsZTogJ2RlY2ltYWwtbGVhZGluZy16ZXJvJyxcbiAgICAgICAgdHlwZUF0dHJpYnV0ZTogbnVsbCxcbiAgICAgICAgbGlzdFR5cGU6ICdudW1iZXJlZCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbGlzdFN0eWxlOiAnbG93ZXItcm9tYW4nLFxuICAgICAgICB0eXBlQXR0cmlidXRlOiAnaScsXG4gICAgICAgIGxpc3RUeXBlOiAnbnVtYmVyZWQnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGxpc3RTdHlsZTogJ3VwcGVyLXJvbWFuJyxcbiAgICAgICAgdHlwZUF0dHJpYnV0ZTogJ0knLFxuICAgICAgICBsaXN0VHlwZTogJ251bWJlcmVkJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBsaXN0U3R5bGU6ICdsb3dlci1hbHBoYScsXG4gICAgICAgIHR5cGVBdHRyaWJ1dGU6ICdhJyxcbiAgICAgICAgbGlzdFR5cGU6ICdudW1iZXJlZCdcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbGlzdFN0eWxlOiAndXBwZXItYWxwaGEnLFxuICAgICAgICB0eXBlQXR0cmlidXRlOiAnQScsXG4gICAgICAgIGxpc3RUeXBlOiAnbnVtYmVyZWQnXG4gICAgfSxcbiAgICB7XG4gICAgICAgIGxpc3RTdHlsZTogJ2xvd2VyLWxhdGluJyxcbiAgICAgICAgdHlwZUF0dHJpYnV0ZTogJ2EnLFxuICAgICAgICBsaXN0VHlwZTogJ251bWJlcmVkJ1xuICAgIH0sXG4gICAge1xuICAgICAgICBsaXN0U3R5bGU6ICd1cHBlci1sYXRpbicsXG4gICAgICAgIHR5cGVBdHRyaWJ1dGU6ICdBJyxcbiAgICAgICAgbGlzdFR5cGU6ICdudW1iZXJlZCdcbiAgICB9XG5dO1xuZm9yIChjb25zdCB7IGxpc3RTdHlsZSwgdHlwZUF0dHJpYnV0ZSwgbGlzdFR5cGUgfSBvZiBMSVNUX1NUWUxFX1RZUEVTKXtcbiAgICBMSVNUX1NUWUxFX1RPX0xJU1RfVFlQRVtsaXN0U3R5bGVdID0gbGlzdFR5cGU7XG4gICAgTElTVF9TVFlMRV9UT19UWVBFX0FUVFJJQlVURVtsaXN0U3R5bGVdID0gdHlwZUF0dHJpYnV0ZTtcbiAgICBpZiAodHlwZUF0dHJpYnV0ZSkge1xuICAgICAgICBUWVBFX0FUVFJJQlVURV9UT19MSVNUX1NUWUxFW3R5cGVBdHRyaWJ1dGVdID0gbGlzdFN0eWxlO1xuICAgIH1cbn1cbi8qKlxuICogR2V0cyBhbGwgdGhlIHN0eWxlIHR5cGVzIHN1cHBvcnRlZCBieSBnaXZlbiBsaXN0IHR5cGUuXG4gKi8gZnVuY3Rpb24gZ2V0QWxsU3VwcG9ydGVkU3R5bGVUeXBlcygpIHtcbiAgICByZXR1cm4gTElTVF9TVFlMRV9UWVBFUy5tYXAoKHgpPT54Lmxpc3RTdHlsZSk7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBsaXN0LXN0eWxlLXR5cGUgaXMgc3VwcG9ydGVkIGJ5IG51bWJlcmVkIG9yIGJ1bGxldGVkIGxpc3QuXG4gKi8gZnVuY3Rpb24gZ2V0TGlzdFR5cGVGcm9tTGlzdFN0eWxlVHlwZSQxKGxpc3RTdHlsZVR5cGUpIHtcbiAgICByZXR1cm4gTElTVF9TVFlMRV9UT19MSVNUX1RZUEVbbGlzdFN0eWxlVHlwZV0gfHwgbnVsbDtcbn1cbi8qKlxuICogQ29udmVydHMgYHR5cGVgIGF0dHJpYnV0ZSBvZiBgPHVsPmAgb3IgYDxvbD5gIGVsZW1lbnRzIHRvIGBsaXN0LXN0eWxlLXR5cGVgIGVxdWl2YWxlbnQuXG4gKi8gZnVuY3Rpb24gZ2V0TGlzdFN0eWxlVHlwZUZyb21UeXBlQXR0cmlidXRlKHZhbHVlKSB7XG4gICAgcmV0dXJuIFRZUEVfQVRUUklCVVRFX1RPX0xJU1RfU1RZTEVbdmFsdWVdIHx8IG51bGw7XG59XG4vKipcbiAqIENvbnZlcnRzIGBsaXN0LXN0eWxlLXR5cGVgIHN0eWxlIHRvIGB0eXBlYCBhdHRyaWJ1dGUgb2YgYDx1bD5gIG9yIGA8b2w+YCBlbGVtZW50cy5cbiAqLyBmdW5jdGlvbiBnZXRUeXBlQXR0cmlidXRlRnJvbUxpc3RTdHlsZVR5cGUodmFsdWUpIHtcbiAgICByZXR1cm4gTElTVF9TVFlMRV9UT19UWVBFX0FUVFJJQlVURVt2YWx1ZV0gfHwgbnVsbDtcbn1cbi8qKlxuICogTm9ybWFsaXplcyBsaXN0IHN0eWxlIGJ5IGNvbnZlcnRpbmcgYWxpYXNlcyB0byB0aGVpciBjYW5vbmljYWwgZm9ybS5cbiAqXG4gKiBAcGFyYW0gbGlzdFN0eWxlIFRoZSBsaXN0IHN0eWxlIHZhbHVlIHRvIG5vcm1hbGl6ZS5cbiAqIEByZXR1cm5zIFRoZSBjYW5vbmljYWwgZm9ybSBvZiB0aGUgbGlzdCBzdHlsZS5cbiAqXG4gKiBAZXhhbXBsZVxuICogbm9ybWFsaXplTGlzdFN0eWxlKCAnbG93ZXItYWxwaGEnICk7IC8vIFJldHVybnMgJ2xvd2VyLWxhdGluJ1xuICogbm9ybWFsaXplTGlzdFN0eWxlKCAndXBwZXItYWxwaGEnICk7IC8vIFJldHVybnMgJ3VwcGVyLWxhdGluJ1xuICogbm9ybWFsaXplTGlzdFN0eWxlKCAnZGlzYycgKTsgLy8gUmV0dXJucyAnZGlzYydcbiAqLyBmdW5jdGlvbiBub3JtYWxpemVMaXN0U3R5bGUobGlzdFN0eWxlKSB7XG4gICAgc3dpdGNoKGxpc3RTdHlsZSl7XG4gICAgICAgIGNhc2UgJ2xvd2VyLWFscGhhJzpcbiAgICAgICAgICAgIHJldHVybiAnbG93ZXItbGF0aW4nO1xuICAgICAgICBjYXNlICd1cHBlci1hbHBoYSc6XG4gICAgICAgICAgICByZXR1cm4gJ3VwcGVyLWxhdGluJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBsaXN0U3R5bGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSBsaXN0IHN0eWxlIGNvbW1hbmQuIEl0IGNoYW5nZXMgYGxpc3RTdHlsZWAgYXR0cmlidXRlIG9mIHRoZSBzZWxlY3RlZCBsaXN0IGl0ZW1zLFxuICogbGV0dGluZyB0aGUgdXNlciBjaG9vc2Ugc3R5bGVzIGZvciB0aGUgbGlzdCBpdGVtIG1hcmtlcnMuXG4gKiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdHByb3BlcnRpZXN+TGlzdFByb3BlcnRpZXMgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmV9LlxuICovIGNsYXNzIExpc3RTdHlsZUNvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogVGhlIGRlZmF1bHQgdHlwZSBvZiB0aGUgbGlzdCBzdHlsZS5cblx0ICovIGRlZmF1bHRUeXBlO1xuICAgIC8qKlxuXHQgKiBUaGUgbGlzdCBvZiBzdXBwb3J0ZWQgc3R5bGUgdHlwZXMgYnkgdGhpcyBjb21tYW5kLlxuXHQgKi8gX3N1cHBvcnRlZFR5cGVzO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWRpdG9yIFRoZSBlZGl0b3IgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBkZWZhdWx0VHlwZSBUaGUgbGlzdCB0eXBlIHRoYXQgd2lsbCBiZSB1c2VkIGJ5IGRlZmF1bHQgaWYgdGhlIHZhbHVlIHdhcyBub3Qgc3BlY2lmaWVkIGR1cmluZ1xuXHQgKiB0aGUgY29tbWFuZCBleGVjdXRpb24uXG5cdCAqIEBwYXJhbSBzdXBwb3J0ZWRUeXBlcyBUaGUgbGlzdCBvZiBzdXBwb3J0ZWQgc3R5bGUgdHlwZXMgYnkgdGhpcyBjb21tYW5kLlxuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yLCBkZWZhdWx0VHlwZSwgc3VwcG9ydGVkVHlwZXMpe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICB0aGlzLmRlZmF1bHRUeXBlID0gZGVmYXVsdFR5cGU7XG4gICAgICAgIHRoaXMuX3N1cHBvcnRlZFR5cGVzID0gc3VwcG9ydGVkVHlwZXM7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2dldFZhbHVlKCk7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdGhpcy5fY2hlY2tFbmFibGVkKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyB0aGUgY29tbWFuZC5cblx0ICpcblx0ICogQGZpcmVzIGV4ZWN1dGVcblx0ICogQHBhcmFtIG9wdGlvbnMudHlwZSBUaGUgdHlwZSBvZiB0aGUgbGlzdCBzdHlsZSwgZS5nLiBgJ2Rpc2MnYCBvciBgJ3NxdWFyZSdgLiBJZiBgbnVsbGAgaXMgc3BlY2lmaWVkLCB0aGUgZGVmYXVsdFxuXHQgKiBzdHlsZSB3aWxsIGJlIGFwcGxpZWQuXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIHRoaXMuX3RyeVRvQ29udmVydEl0ZW1zVG9MaXN0KG9wdGlvbnMpO1xuICAgICAgICAgICAgbGV0IGJsb2NrcyA9IEFycmF5LmZyb20oZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpLmZpbHRlcigoYmxvY2spPT5ibG9jay5oYXNBdHRyaWJ1dGUoJ2xpc3RUeXBlJykpO1xuICAgICAgICAgICAgaWYgKCFibG9ja3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2tzID0gZXhwYW5kTGlzdEJsb2Nrc1RvQ29tcGxldGVMaXN0KGJsb2Nrcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdFN0eWxlJywgb3B0aW9ucy50eXBlIHx8IHRoaXMuZGVmYXVsdFR5cGUsIGJsb2NrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGdpdmVuIHN0eWxlIHR5cGUgaXMgc3VwcG9ydGVkIGJ5IHRoaXMgcGx1Z2luLlxuXHQgKi8gaXNTdHlsZVR5cGVTdXBwb3J0ZWQodmFsdWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9zdXBwb3J0ZWRUeXBlcykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cHBvcnRlZFR5cGVzLmluY2x1ZGVzKHZhbHVlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB0aGUgY29tbWFuZCdzIHtAbGluayAjdmFsdWV9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBUaGUgY3VycmVudCB2YWx1ZS5cblx0ICovIF9nZXRWYWx1ZSgpIHtcbiAgICAgICAgY29uc3QgbGlzdEl0ZW0gPSBmaXJzdCh0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKSk7XG4gICAgICAgIGlmIChpc0xpc3RJdGVtQmxvY2sobGlzdEl0ZW0pKSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0U3R5bGUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoZSBjb21tYW5kIGNhbiBiZSBlbmFibGVkIGluIHRoZSBjdXJyZW50IGNvbnRleHQuXG5cdCAqXG5cdCAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIGNvbW1hbmQgc2hvdWxkIGJlIGVuYWJsZWQuXG5cdCAqLyBfY2hlY2tFbmFibGVkKCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbnVtYmVyZWRMaXN0ID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbnVtYmVyZWRMaXN0Jyk7XG4gICAgICAgIGNvbnN0IGJ1bGxldGVkTGlzdCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2J1bGxldGVkTGlzdCcpO1xuICAgICAgICByZXR1cm4gbnVtYmVyZWRMaXN0LmlzRW5hYmxlZCB8fCBidWxsZXRlZExpc3QuaXNFbmFibGVkO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2sgaWYgdGhlIHByb3ZpZGVkIGxpc3Qgc3R5bGUgaXMgdmFsaWQuIEFsc28gY2hhbmdlIHRoZSBzZWxlY3Rpb24gdG8gYSBsaXN0IGlmIGl0J3Mgbm90IHNldCB5ZXQuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zLnR5cGUgVGhlIHR5cGUgb2YgdGhlIGxpc3Qgc3R5bGUuIElmIGBudWxsYCBpcyBzcGVjaWZpZWQsIHRoZSBmdW5jdGlvbiBkb2VzIG5vdGhpbmcuXG5cdCovIF90cnlUb0NvbnZlcnRJdGVtc1RvTGlzdChvcHRpb25zKSB7XG4gICAgICAgIGlmICghb3B0aW9ucy50eXBlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGlzdFR5cGUgPSBnZXRMaXN0VHlwZUZyb21MaXN0U3R5bGVUeXBlJDEob3B0aW9ucy50eXBlKTtcbiAgICAgICAgaWYgKCFsaXN0VHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGAke2xpc3RUeXBlfUxpc3RgO1xuICAgICAgICBjb25zdCBjb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldChjb21tYW5kTmFtZSk7XG4gICAgICAgIGlmICghY29tbWFuZC52YWx1ZSkge1xuICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoY29tbWFuZE5hbWUpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSBsaXN0IHJldmVyc2VkIGNvbW1hbmQuIEl0IGNoYW5nZXMgdGhlIGBsaXN0UmV2ZXJzZWRgIGF0dHJpYnV0ZSBvZiB0aGUgc2VsZWN0ZWQgbGlzdCBpdGVtcyxcbiAqIGxldHRpbmcgdGhlIHVzZXIgdG8gY2hvb3NlIHRoZSBvcmRlciBvZiBhbiBvcmRlcmVkIGxpc3QuXG4gKiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdHByb3BlcnRpZXN+TGlzdFByb3BlcnRpZXMgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmV9LlxuICovIGNsYXNzIExpc3RSZXZlcnNlZENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHJlZnJlc2goKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fZ2V0VmFsdWUoKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHZhbHVlICE9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyB0aGUgY29tbWFuZC5cblx0ICpcblx0ICogQGZpcmVzIGV4ZWN1dGVcblx0ICogQHBhcmFtIG9wdGlvbnMucmV2ZXJzZWQgV2hldGhlciB0aGUgbGlzdCBzaG91bGQgYmUgcmV2ZXJzZWQuXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBsZXQgYmxvY2tzID0gQXJyYXkuZnJvbShkb2N1bWVudC5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKSkuZmlsdGVyKChibG9jayk9PmlzTGlzdEl0ZW1CbG9jayhibG9jaykgJiYgYmxvY2suZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICdudW1iZXJlZCcpO1xuICAgICAgICBibG9ja3MgPSBleHBhbmRMaXN0QmxvY2tzVG9Db21wbGV0ZUxpc3QoYmxvY2tzKTtcbiAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJsb2NrIG9mIGJsb2Nrcyl7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdFJldmVyc2VkJywgISFvcHRpb25zLnJldmVyc2VkLCBibG9jayk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHRoZSBjb21tYW5kJ3Mge0BsaW5rICN2YWx1ZX0uXG5cdCAqLyBfZ2V0VmFsdWUoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZmlyc3QoZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgICAgICBpZiAoaXNMaXN0SXRlbUJsb2NrKGJsb2NrKSAmJiBibG9jay5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ251bWJlcmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIGJsb2NrLmdldEF0dHJpYnV0ZSgnbGlzdFJldmVyc2VkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlIENvcHlyaWdodCAoYykgMjAwMy0yMDI1LCBDS1NvdXJjZSBIb2xkaW5nIHNwLiB6IG8uby4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEZvciBsaWNlbnNpbmcsIHNlZSBMSUNFTlNFLm1kIG9yIGh0dHBzOi8vY2tlZGl0b3IuY29tL2xlZ2FsL2NrZWRpdG9yLWxpY2Vuc2luZy1vcHRpb25zXG4gKi8gLyoqXG4gKiBAbW9kdWxlIGxpc3QvbGlzdHByb3BlcnRpZXMvY29udmVydGVyc1xuICovIC8qKlxuICogUmV0dXJucyBhIGNvbnZlcnRlciB0aGF0IGNvbnN1bWVzIHRoZSBgc3R5bGVgLCBgcmV2ZXJzZWRgLCBhbmQgYHN0YXJ0YCBhdHRyaWJ1dGVzLlxuICogSW4gYHN0eWxlYCwgaXQgc2VhcmNoZXMgZm9yIHRoZSBgbGlzdC1zdHlsZS10eXBlYCBkZWZpbml0aW9uLlxuICogSWYgbm90IGZvdW5kLCB0aGUgYFwiZGVmYXVsdFwiYCB2YWx1ZSB3aWxsIGJlIHVzZWQuXG4gKlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gc3RyYXRlZ3lcbiAqLyBmdW5jdGlvbiBsaXN0UHJvcGVydGllc1VwY2FzdENvbnZlcnRlcihzdHJhdGVneSkge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCB7IHdyaXRlciwgc2NoZW1hLCBjb25zdW1hYmxlIH0gPSBjb252ZXJzaW9uQXBpO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyB2aWV3IGNvbnN1bWFibGUgdG8gY29uc3VtZSwgc2V0IHRoZSBkZWZhdWx0IGF0dHJpYnV0ZSB2YWx1ZSB0byBiZSBhYmxlIHRvIHJlY29udmVydCBuZXN0ZWQgbGlzdHMgb24gcGFyZW50IGNoYW5nZS5cbiAgICAgICAgLy8gU28gYWJvcnQgY29udmVydGluZyBpZiBhdHRyaWJ1dGUgd2FzIGRpcmVjdGx5IGNvbnN1bWVkLlxuICAgICAgICBpZiAoY29uc3VtYWJsZS50ZXN0KGRhdGEudmlld0l0ZW0sIHN0cmF0ZWd5LnZpZXdDb25zdW1hYmxlcykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkYXRhLm1vZGVsUmFuZ2UpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS52aWV3SXRlbSwgZGF0YS5tb2RlbEN1cnNvcikpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBhcHBsaWVkID0gZmFsc2U7XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhLm1vZGVsUmFuZ2UuZ2V0SXRlbXMoe1xuICAgICAgICAgICAgc2hhbGxvdzogdHJ1ZVxuICAgICAgICB9KSl7XG4gICAgICAgICAgICBpZiAoIXNjaGVtYS5jaGVja0F0dHJpYnV0ZShpdGVtLCBzdHJhdGVneS5hdHRyaWJ1dGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFzdHJhdGVneS5hcHBsaWVzVG9MaXN0SXRlbShpdGVtKSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0IGxpc3QgYXR0cmlidXRlcyBvbmx5IG9uIHNhbWUgbGV2ZWwgaXRlbXMsIHRob3NlIG5lc3RlZCBkZWVwZXIgYXJlIGFscmVhZHkgaGFuZGxlZCBieSB0aGUgcmVjdXJzaXZlIGNvbnZlcnNpb24uXG4gICAgICAgICAgICBpZiAoaXRlbS5oYXNBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSwgc3RyYXRlZ3kuZ2V0QXR0cmlidXRlT25VcGNhc3QoZGF0YS52aWV3SXRlbSksIGl0ZW0pO1xuICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFwcGxpZWQpIHtcbiAgICAgICAgICAgIGNvbnN1bWFibGUuY29uc3VtZShkYXRhLnZpZXdJdGVtLCBzdHJhdGVneS52aWV3Q29uc3VtYWJsZXMpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKiBBIHNldCBvZiBoZWxwZXJzIHJlbGF0ZWQgdG8gZG9jdW1lbnQgbGlzdHMuXG4gKi8gY2xhc3MgTGlzdFByb3BlcnRpZXNVdGlscyBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGlzdFByb3BlcnRpZXNVdGlscyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgYWxsIHRoZSBzdHlsZSB0eXBlcyBzdXBwb3J0ZWQgYnkgZ2l2ZW4gbGlzdCB0eXBlLlxuXHQgKi8gZ2V0QWxsU3VwcG9ydGVkU3R5bGVUeXBlcygpIHtcbiAgICAgICAgcmV0dXJuIGdldEFsbFN1cHBvcnRlZFN0eWxlVHlwZXMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBsaXN0LXN0eWxlLXR5cGUgaXMgc3VwcG9ydGVkIGJ5IG51bWJlcmVkIG9yIGJ1bGxldGVkIGxpc3QuXG5cdCAqLyBnZXRMaXN0VHlwZUZyb21MaXN0U3R5bGVUeXBlKGxpc3RTdHlsZVR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGdldExpc3RUeXBlRnJvbUxpc3RTdHlsZVR5cGUkMShsaXN0U3R5bGVUeXBlKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENvbnZlcnRzIGB0eXBlYCBhdHRyaWJ1dGUgb2YgYDx1bD5gIG9yIGA8b2w+YCBlbGVtZW50cyB0byBgbGlzdC1zdHlsZS10eXBlYCBlcXVpdmFsZW50LlxuXHQgKi8gZ2V0TGlzdFN0eWxlVHlwZUZyb21UeXBlQXR0cmlidXRlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBnZXRMaXN0U3R5bGVUeXBlRnJvbVR5cGVBdHRyaWJ1dGUodmFsdWUpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ29udmVydHMgYGxpc3Qtc3R5bGUtdHlwZWAgc3R5bGUgdG8gYHR5cGVgIGF0dHJpYnV0ZSBvZiBgPHVsPmAgb3IgYDxvbD5gIGVsZW1lbnRzLlxuXHQgKi8gZ2V0VHlwZUF0dHJpYnV0ZUZyb21MaXN0U3R5bGVUeXBlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBnZXRUeXBlQXR0cmlidXRlRnJvbUxpc3RTdHlsZVR5cGUodmFsdWUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBOb3JtYWxpemVzIHtAbGluayBtb2R1bGU6bGlzdC9saXN0Y29uZmlnfkxpc3RQcm9wZXJ0aWVzQ29uZmlnfSBpbiB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmUuXG4gKiBUaGUgc3RydWN0dXJlIG9mIG5vcm1hbGl6ZWQgbGlzdCBwcm9wZXJ0aWVzIG9wdGlvbnMgbG9va3MgYXMgZm9sbG93czpcbiAqXG4gKiBgYGB0c1xuICoge1xuICogXHRzdHlsZXM6IHtcbiAqIFx0XHRsaXN0VHlwZXM6IFsgJ2J1bGxldGVkJywgJ251bWJlcmVkJyBdLFxuICogXHRcdHVzZUF0dHJpYnV0ZTogZmFsc2VcbiAqIFx0fSxcbiAqIFx0c3RhcnRJbmRleDogdHJ1ZSxcbiAqIFx0cmV2ZXJzZWQ6IHRydWVcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBjb25maWcgVGhlIGxpc3QgcHJvcGVydGllcyB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdGNvbmZpZ35MaXN0UHJvcGVydGllc0NvbmZpZyBjb25maWd9LlxuICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggbm9ybWFsaXplZCBsaXN0IHByb3BlcnRpZXMgb3B0aW9ucy5cbiAqLyBmdW5jdGlvbiBnZXROb3JtYWxpemVkQ29uZmlnKGNvbmZpZykge1xuICAgIGNvbnN0IHsgc3RhcnRJbmRleCwgcmV2ZXJzZWQsIHN0eWxlcyB9ID0gY29uZmlnO1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0eWxlczogZ2V0Tm9ybWFsaXplZFN0eWxlc0NvbmZpZyhzdHlsZXMpLFxuICAgICAgICBzdGFydEluZGV4OiBzdGFydEluZGV4IHx8IGZhbHNlLFxuICAgICAgICByZXZlcnNlZDogcmV2ZXJzZWQgfHwgZmFsc2VcbiAgICB9O1xufVxuLyoqXG4gKiBOb3JtYWxpemVzIHN0eWxlcyBpbiB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmUuXG4gKiBUaGUgc3RydWN0dXJlIG9mIG5vcm1hbGl6ZWQgbGlzdCBwcm9wZXJ0aWVzIG9wdGlvbnMgbG9va3MgYXMgZm9sbG93czpcbiAqXG4gKiBgYGB0c1xuICoge1xuICogXHRsaXN0VHlwZXM6IFsgJ2J1bGxldGVkJywgJ251bWJlcmVkJyBdLFxuICogXHR1c2VBdHRyaWJ1dGU6IGZhbHNlXG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gc3R5bGVzIFRoZSBsaXN0IHByb3BlcnRpZXMgc3R5bGVzLlxuICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggbm9ybWFsaXplZCBsaXN0IHByb3BlcnRpZXMgc3R5bGVzLlxuICovIGZ1bmN0aW9uIGdldE5vcm1hbGl6ZWRTdHlsZXNDb25maWcoc3R5bGVzKSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZENvbmZpZyA9IHtcbiAgICAgICAgbGlzdFR5cGVzOiBbXG4gICAgICAgICAgICAnYnVsbGV0ZWQnLFxuICAgICAgICAgICAgJ251bWJlcmVkJ1xuICAgICAgICBdLFxuICAgICAgICB1c2VBdHRyaWJ1dGU6IGZhbHNlXG4gICAgfTtcbiAgICBpZiAoc3R5bGVzID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVkQ29uZmlnO1xuICAgIH1cbiAgICBpZiAoIXN0eWxlcykge1xuICAgICAgICBub3JtYWxpemVkQ29uZmlnLmxpc3RUeXBlcyA9IFtdO1xuICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShzdHlsZXMpIHx8IHR5cGVvZiBzdHlsZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgbm9ybWFsaXplZENvbmZpZy5saXN0VHlwZXMgPSB0b0FycmF5KHN0eWxlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgbm9ybWFsaXplZENvbmZpZy5saXN0VHlwZXMgPSBzdHlsZXMubGlzdFR5cGVzID8gdG9BcnJheShzdHlsZXMubGlzdFR5cGVzKSA6IG5vcm1hbGl6ZWRDb25maWcubGlzdFR5cGVzO1xuICAgICAgICBub3JtYWxpemVkQ29uZmlnLnVzZUF0dHJpYnV0ZSA9ICEhc3R5bGVzLnVzZUF0dHJpYnV0ZTtcbiAgICAgICAgaWYgKHN0eWxlcy5saXN0U3R5bGVUeXBlcykge1xuICAgICAgICAgICAgbm9ybWFsaXplZENvbmZpZy5saXN0U3R5bGVUeXBlcyA9IHN0eWxlcy5saXN0U3R5bGVUeXBlcztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm9ybWFsaXplZENvbmZpZztcbn1cblxuY29uc3QgREVGQVVMVF9MSVNUX1RZUEUkMSA9ICdkZWZhdWx0Jztcbi8qKlxuICogVGhlIGRvY3VtZW50IGxpc3QgcHJvcGVydGllcyBlbmdpbmUgZmVhdHVyZS5cbiAqXG4gKiBJdCByZWdpc3RlcnMgdGhlIGAnbGlzdFN0eWxlJ2AsIGAnbGlzdFJldmVyc2VkJ2AgYW5kIGAnbGlzdFN0YXJ0J2AgY29tbWFuZHMgaWYgdGhleSBhcmUgZW5hYmxlZCBpbiB0aGUgY29uZmlndXJhdGlvbi5cbiAqIFJlYWQgbW9yZSBpbiB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdGNvbmZpZ35MaXN0UHJvcGVydGllc0NvbmZpZ30uXG4gKi8gY2xhc3MgTGlzdFByb3BlcnRpZXNFZGl0aW5nIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMaXN0RWRpdGluZyxcbiAgICAgICAgICAgIExpc3RQcm9wZXJ0aWVzVXRpbHNcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGlzdFByb3BlcnRpZXNFZGl0aW5nJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNvbnN0cnVjdG9yKGVkaXRvcil7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIGVkaXRvci5jb25maWcuZGVmaW5lKCdsaXN0LnByb3BlcnRpZXMnLCB7XG4gICAgICAgICAgICBzdHlsZXM6IHRydWUsXG4gICAgICAgICAgICBzdGFydEluZGV4OiBmYWxzZSxcbiAgICAgICAgICAgIHJldmVyc2VkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGxpc3RFZGl0aW5nID0gZWRpdG9yLnBsdWdpbnMuZ2V0KExpc3RFZGl0aW5nKTtcbiAgICAgICAgY29uc3QgZW5hYmxlZFByb3BlcnRpZXMgPSBlZGl0b3IuY29uZmlnLmdldCgnbGlzdC5wcm9wZXJ0aWVzJyk7XG4gICAgICAgIGNvbnN0IHN0cmF0ZWdpZXMgPSBjcmVhdGVBdHRyaWJ1dGVTdHJhdGVnaWVzJDEoZW5hYmxlZFByb3BlcnRpZXMpO1xuICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIHN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgc3RyYXRlZ3kuYWRkQ29tbWFuZChlZGl0b3IpO1xuICAgICAgICAgICAgbW9kZWwuc2NoZW1hLmV4dGVuZCgnJGxpc3RJdGVtJywge1xuICAgICAgICAgICAgICAgIGFsbG93QXR0cmlidXRlczogc3RyYXRlZ3kuYXR0cmlidXRlTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBSZWdpc3RlciBkb3duY2FzdCBzdHJhdGVneS5cbiAgICAgICAgICAgIGxpc3RFZGl0aW5nLnJlZ2lzdGVyRG93bmNhc3RTdHJhdGVneSh7XG4gICAgICAgICAgICAgICAgc2NvcGU6ICdsaXN0JyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiBzdHJhdGVneS5hdHRyaWJ1dGVOYW1lLFxuICAgICAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uRG93bmNhc3QgKHdyaXRlciwgYXR0cmlidXRlVmFsdWUsIHZpZXdFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmF0ZWd5LnNldEF0dHJpYnV0ZU9uRG93bmNhc3Qod3JpdGVyLCBhdHRyaWJ1dGVWYWx1ZSwgdmlld0VsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFNldCB1cCBjb252ZXJzaW9uLlxuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ3VwY2FzdCcpLmFkZCgoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3RyYXRlZ3kgb2Ygc3RyYXRlZ2llcyl7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDpvbCcsIGxpc3RQcm9wZXJ0aWVzVXBjYXN0Q29udmVydGVyKHN0cmF0ZWd5KSk7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDp1bCcsIGxpc3RQcm9wZXJ0aWVzVXBjYXN0Q29udmVydGVyKHN0cmF0ZWd5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBWZXJpZnkgaWYgdGhlIGxpc3QgdmlldyBlbGVtZW50ICh1bCBvciBvbCkgcmVxdWlyZXMgcmVmcmVzaGluZy5cbiAgICAgICAgbGlzdEVkaXRpbmcub24oJ2NoZWNrQXR0cmlidXRlczpsaXN0JywgKGV2dCwgeyB2aWV3RWxlbWVudCwgbW9kZWxBdHRyaWJ1dGVzIH0pPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIHN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgICAgIGlmIChzdHJhdGVneS5nZXRBdHRyaWJ1dGVPblVwY2FzdCh2aWV3RWxlbWVudCkgIT0gbW9kZWxBdHRyaWJ1dGVzW3N0cmF0ZWd5LmF0dHJpYnV0ZU5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5yZXR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlc2V0IGxpc3QgcHJvcGVydGllcyBhZnRlciBpbmRlbnRpbmcgbGlzdCBpdGVtcy5cbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlZGl0b3IuY29tbWFuZHMuZ2V0KCdpbmRlbnRMaXN0JyksICdhZnRlckV4ZWN1dGUnLCAoZXZ0LCBjaGFuZ2VkQmxvY2tzKT0+e1xuICAgICAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBub2RlIG9mIGNoYW5nZWRCbG9ja3Mpe1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIHN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmF0ZWd5LmFwcGxpZXNUb0xpc3RJdGVtKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVzdCByZXNldCB0aGUgYXR0cmlidXRlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgcHJldmlvdXMgaW5kZW50ZWQgbGlzdCB0aGF0IHRoaXMgbm9kZSBzaG91bGQgYmUgbWVyZ2VkIGludG8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBvc3RmaXhlciB3aWxsIHVuaWZ5IGFsbCB0aGUgYXR0cmlidXRlcyBvZiBib3RoIHN1Yi1saXN0cy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKHN0cmF0ZWd5LmF0dHJpYnV0ZU5hbWUsIHN0cmF0ZWd5LmRlZmF1bHRWYWx1ZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEFkZCBvciByZW1vdmUgbGlzdCBwcm9wZXJ0aWVzIGF0dHJpYnV0ZXMgZGVwZW5kaW5nIG9uIHRoZSBsaXN0IHR5cGUuXG4gICAgICAgIGxpc3RFZGl0aW5nLm9uKCdwb3N0Rml4ZXInLCAoZXZ0LCB7IGxpc3ROb2Rlcywgd3JpdGVyIH0pPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgbm9kZSB9IG9mIGxpc3ROb2Rlcyl7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBzdHJhdGVnaWVzKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYXR0cmlidXRlIGlzIHZhbGlkLlxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyYXRlZ3kuaGFzVmFsaWRBdHRyaWJ1dGUobm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBtaXNzaW5nIGRlZmF1bHQgcHJvcGVydHkgYXR0cmlidXRlcy4uLlxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyYXRlZ3kuYXBwbGllc1RvTGlzdEl0ZW0obm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSwgc3RyYXRlZ3kuZGVmYXVsdFZhbHVlLCBub2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXZ0LnJldHVybiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgYWxsIGl0ZW1zIGluIGEgc2luZ2xlIGxpc3QgKGl0ZW1zIGF0IHRoZSBzYW1lIGxldmVsICYgbGlzdFR5cGUpIGhhdmUgdGhlIHNhbWUgcHJvcGVydGllcy5cbiAgICAgICAgbGlzdEVkaXRpbmcub24oJ3Bvc3RGaXhlcicsIChldnQsIHsgbGlzdE5vZGVzLCB3cml0ZXIgfSk9PntcbiAgICAgICAgICAgIGZvciAoY29uc3QgeyBub2RlLCBwcmV2aW91c05vZGVJbkxpc3QgfSBvZiBsaXN0Tm9kZXMpe1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBmaXJzdCBpdGVtIG9mIGEgbmVzdGVkIGxpc3QuXG4gICAgICAgICAgICAgICAgaWYgKCFwcmV2aW91c05vZGVJbkxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBmaXJzdCBibG9jayBvZiBhIGxpc3Qgb2YgYSBkaWZmZXJlbnQgdHlwZS5cbiAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNOb2RlSW5MaXN0LmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPSBub2RlLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gQ29weSBwcm9wZXJ0aWVzIGZyb20gdGhlIHByZXZpb3VzIG9uZS5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIHN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGF0dHJpYnV0ZU5hbWUgfSA9IHN0cmF0ZWd5O1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmF0ZWd5LmFwcGxpZXNUb0xpc3RJdGVtKG5vZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHByZXZpb3VzTm9kZUluTGlzdC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lKSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCB2YWx1ZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldnQucmV0dXJuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGFuIGFycmF5IG9mIHN0cmF0ZWdpZXMgZm9yIGRlYWxpbmcgd2l0aCBlbmFibGVkIGxpc3RJdGVtIGF0dHJpYnV0ZXMuXG4gKi8gZnVuY3Rpb24gY3JlYXRlQXR0cmlidXRlU3RyYXRlZ2llcyQxKGVuYWJsZWRQcm9wZXJ0aWVzKSB7XG4gICAgY29uc3Qgc3RyYXRlZ2llcyA9IFtdO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRDb25maWcgPSBnZXROb3JtYWxpemVkQ29uZmlnKGVuYWJsZWRQcm9wZXJ0aWVzKTtcbiAgICBpZiAoZW5hYmxlZFByb3BlcnRpZXMuc3R5bGVzKSB7XG4gICAgICAgIGNvbnN0IHVzZUF0dHJpYnV0ZSA9IG5vcm1hbGl6ZWRDb25maWcuc3R5bGVzLnVzZUF0dHJpYnV0ZTtcbiAgICAgICAgc3RyYXRlZ2llcy5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdsaXN0U3R5bGUnLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBERUZBVUxUX0xJU1RfVFlQRSQxLFxuICAgICAgICAgICAgdmlld0NvbnN1bWFibGVzOiB7XG4gICAgICAgICAgICAgICAgc3R5bGVzOiAnbGlzdC1zdHlsZS10eXBlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZENvbW1hbmQgKGVkaXRvcikge1xuICAgICAgICAgICAgICAgIGxldCBzdXBwb3J0ZWRUeXBlcyA9IGdldEFsbFN1cHBvcnRlZFN0eWxlVHlwZXMoKTtcbiAgICAgICAgICAgICAgICBpZiAodXNlQXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1cHBvcnRlZFR5cGVzID0gc3VwcG9ydGVkVHlwZXMuZmlsdGVyKChzdHlsZVR5cGUpPT4hIWdldFR5cGVBdHRyaWJ1dGVGcm9tTGlzdFN0eWxlVHlwZShzdHlsZVR5cGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnbGlzdFN0eWxlJywgbmV3IExpc3RTdHlsZUNvbW1hbmQoZWRpdG9yLCBERUZBVUxUX0xJU1RfVFlQRSQxLCBzdXBwb3J0ZWRUeXBlcykpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFwcGxpZXNUb0xpc3RJdGVtIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICdudW1iZXJlZCcgfHwgaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ2J1bGxldGVkJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoYXNWYWxpZEF0dHJpYnV0ZSAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5hcHBsaWVzVG9MaXN0SXRlbShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIWl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0U3R5bGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtLmhhc0F0dHJpYnV0ZSgnbGlzdFN0eWxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0U3R5bGUnKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gREVGQVVMVF9MSVNUX1RZUEUkMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldExpc3RUeXBlRnJvbUxpc3RTdHlsZVR5cGUkMSh2YWx1ZSkgPT0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0QXR0cmlidXRlT25Eb3duY2FzdCAod3JpdGVyLCBsaXN0U3R5bGUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdFN0eWxlICYmIGxpc3RTdHlsZSAhPT0gREVGQVVMVF9MSVNUX1RZUEUkMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlQXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldFR5cGVBdHRyaWJ1dGVGcm9tTGlzdFN0eWxlVHlwZShsaXN0U3R5bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgndHlwZScsIHZhbHVlLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0U3R5bGUoJ2xpc3Qtc3R5bGUtdHlwZScsIGxpc3RTdHlsZSwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZVN0eWxlKCdsaXN0LXN0eWxlLXR5cGUnLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCd0eXBlJywgZWxlbWVudCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QXR0cmlidXRlT25VcGNhc3QgKGxpc3RQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdHlsZSA9IGxpc3RQYXJlbnQuZ2V0U3R5bGUoJ2xpc3Qtc3R5bGUtdHlwZScpO1xuICAgICAgICAgICAgICAgIGlmIChzdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplTGlzdFN0eWxlKHN0eWxlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlID0gbGlzdFBhcmVudC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTtcbiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRMaXN0U3R5bGVUeXBlRnJvbVR5cGVBdHRyaWJ1dGUoYXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIERFRkFVTFRfTElTVF9UWVBFJDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoZW5hYmxlZFByb3BlcnRpZXMucmV2ZXJzZWQpIHtcbiAgICAgICAgc3RyYXRlZ2llcy5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdsaXN0UmV2ZXJzZWQnLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSxcbiAgICAgICAgICAgIHZpZXdDb25zdW1hYmxlczoge1xuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6ICdyZXZlcnNlZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhZGRDb21tYW5kIChlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdsaXN0UmV2ZXJzZWQnLCBuZXcgTGlzdFJldmVyc2VkQ29tbWFuZChlZGl0b3IpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcHBsaWVzVG9MaXN0SXRlbSAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PSAnbnVtYmVyZWQnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhc1ZhbGlkQXR0cmlidXRlIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBwbGllc1RvTGlzdEl0ZW0oaXRlbSkgPT0gaXRlbS5oYXNBdHRyaWJ1dGUoJ2xpc3RSZXZlcnNlZCcpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uRG93bmNhc3QgKHdyaXRlciwgbGlzdFJldmVyc2VkLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3RSZXZlcnNlZCkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdyZXZlcnNlZCcsICdyZXZlcnNlZCcsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoJ3JldmVyc2VkJywgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEF0dHJpYnV0ZU9uVXBjYXN0IChsaXN0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RQYXJlbnQuaGFzQXR0cmlidXRlKCdyZXZlcnNlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVuYWJsZWRQcm9wZXJ0aWVzLnN0YXJ0SW5kZXgpIHtcbiAgICAgICAgc3RyYXRlZ2llcy5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdsaXN0U3RhcnQnLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAxLFxuICAgICAgICAgICAgdmlld0NvbnN1bWFibGVzOiB7XG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczogJ3N0YXJ0J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFkZENvbW1hbmQgKGVkaXRvcikge1xuICAgICAgICAgICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ2xpc3RTdGFydCcsIG5ldyBMaXN0U3RhcnRDb21tYW5kKGVkaXRvcikpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFwcGxpZXNUb0xpc3RJdGVtIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzTnVtYmVyZWRMaXN0VHlwZShpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFzVmFsaWRBdHRyaWJ1dGUgKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hcHBsaWVzVG9MaXN0SXRlbShpdGVtKSA9PSBpdGVtLmhhc0F0dHJpYnV0ZSgnbGlzdFN0YXJ0Jyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0QXR0cmlidXRlT25Eb3duY2FzdCAod3JpdGVyLCBsaXN0U3RhcnQsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdFN0YXJ0ID09IDAgfHwgbGlzdFN0YXJ0ID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdzdGFydCcsIGxpc3RTdGFydCwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgnc3RhcnQnLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0QXR0cmlidXRlT25VcGNhc3QgKGxpc3RQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEF0dHJpYnV0ZVZhbHVlID0gbGlzdFBhcmVudC5nZXRBdHRyaWJ1dGUoJ3N0YXJ0Jyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0QXR0cmlidXRlVmFsdWUgPj0gMCA/IHN0YXJ0QXR0cmlidXRlVmFsdWUgOiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmF0ZWdpZXM7XG59XG5cbi8qKlxuICogVGhlIGxpc3QgcHJvcGVydGllcyB2aWV3IHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGlzdCBkcm9wZG93bi5cbiAqXG4gKiBDb250YWlucyBhIGdyaWQgb2YgYXZhaWxhYmxlIGxpc3Qgc3R5bGVzIGFuZCwgZm9yIG51bWJlcmVkIGxpc3QsIGFsc28gdGhlIGxpc3Qgc3RhcnQgaW5kZXggYW5kIHJldmVyc2VkIGZpZWxkcy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBMaXN0UHJvcGVydGllc1ZpZXcgZXh0ZW5kcyBWaWV3IHtcbiAgICAvKipcblx0ICogQSBjb2xsZWN0aW9uIG9mIHRoZSBjaGlsZCB2aWV3cy5cblx0ICovIGNoaWxkcmVuO1xuICAgIC8qKlxuXHQgKiBBIHZpZXcgdGhhdCByZW5kZXJzIHRoZSBncmlkIG9mIGxpc3Qgc3R5bGVzLlxuXHQgKi8gc3R5bGVzVmlldyA9IG51bGw7XG4gICAgLyoqXG5cdCAqIEEgY29sbGFwc2libGUgdmlldyB0aGF0IGhvc3RzIGFkZGl0aW9uYWwgbGlzdCBwcm9wZXJ0eSBmaWVsZHMgKHtAbGluayAjc3RhcnRJbmRleEZpZWxkVmlld30gYW5kXG5cdCAqIHtAbGluayAjcmV2ZXJzZWRTd2l0Y2hCdXR0b25WaWV3fSkgdG8gdmlzdWFsbHkgc2VwYXJhdGUgdGhlbSBmcm9tIHRoZSB7QGxpbmsgI3N0eWxlc1ZpZXcgZ3JpZCBvZiBzdHlsZXN9LlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogT25seSBwcmVzZW50IHdoZW46XG5cdCAqICogdGhlIHZpZXcgcmVwcmVzZW50cyAqKm51bWJlcmVkKiogbGlzdCBwcm9wZXJ0aWVzLFxuXHQgKiAqIGFuZCB0aGUge0BsaW5rICNzdHlsZXNWaWV3fSBpcyByZW5kZXJlZCxcblx0ICogKiBhbmQgZWl0aGVyIHtAbGluayAjc3RhcnRJbmRleEZpZWxkVmlld30gb3Ige0BsaW5rICNyZXZlcnNlZFN3aXRjaEJ1dHRvblZpZXd9IGlzIHJlbmRlcmVkLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIGFkZGl0aW9uYWxQcm9wZXJ0aWVzQ29sbGFwc2libGVWaWV3ID0gbnVsbDtcbiAgICAvKipcblx0ICogQSBsYWJlbGVkIG51bWJlciBmaWVsZCBhbGxvd2luZyB0aGUgdXNlciB0byBzZXQgdGhlIHN0YXJ0IGluZGV4IG9mIHRoZSBsaXN0LlxuXHQgKlxuXHQgKiAqKk5vdGUqKjogT25seSBwcmVzZW50IHdoZW4gdGhlIHZpZXcgcmVwcmVzZW50cyAqKm51bWJlcmVkKiogbGlzdCBwcm9wZXJ0aWVzLlxuXHQgKlxuXHQgKiBAcmVhZG9ubHlcblx0ICovIHN0YXJ0SW5kZXhGaWVsZFZpZXcgPSBudWxsO1xuICAgIC8qKlxuXHQgKiBBIHN3aXRjaCBidXR0b24gYWxsb3dpbmcgdGhlIHVzZXIgdG8gbWFrZSB0aGUgZWRpdGVkIGxpc3QgcmV2ZXJzZWQuXG5cdCAqXG5cdCAqICoqTm90ZSoqOiBPbmx5IHByZXNlbnQgd2hlbiB0aGUgdmlldyByZXByZXNlbnRzICoqbnVtYmVyZWQqKiBsaXN0IHByb3BlcnRpZXMuXG5cdCAqXG5cdCAqIEByZWFkb25seVxuXHQgKi8gcmV2ZXJzZWRTd2l0Y2hCdXR0b25WaWV3ID0gbnVsbDtcbiAgICAvKipcblx0ICogVHJhY2tzIGluZm9ybWF0aW9uIGFib3V0IHRoZSBET00gZm9jdXMgaW4gdGhlIHZpZXcuXG5cdCAqLyBmb2N1c1RyYWNrZXIgPSBuZXcgRm9jdXNUcmFja2VyKCk7XG4gICAgLyoqXG5cdCAqIEFuIGluc3RhbmNlIG9mIHRoZSB7QGxpbmsgbW9kdWxlOnV0aWxzL2tleXN0cm9rZWhhbmRsZXJ+S2V5c3Ryb2tlSGFuZGxlcn0uXG5cdCAqLyBrZXlzdHJva2VzID0gbmV3IEtleXN0cm9rZUhhbmRsZXIoKTtcbiAgICAvKipcblx0ICogQSBjb2xsZWN0aW9uIG9mIHZpZXdzIHRoYXQgY2FuIGJlIGZvY3VzZWQgaW4gdGhlIHByb3BlcnRpZXMgdmlldy5cblx0ICovIGZvY3VzYWJsZXMgPSBuZXcgVmlld0NvbGxlY3Rpb24oKTtcbiAgICAvKipcblx0ICogSGVscHMgY3ljbGluZyBvdmVyIHtAbGluayAjZm9jdXNhYmxlc30gaW4gdGhlIHZpZXcuXG5cdCAqLyBmb2N1c0N5Y2xlcjtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgbGlzdCBwcm9wZXJ0aWVzIHZpZXcuXG5cdCAqXG5cdCAqIEBwYXJhbSBsb2NhbGUgVGhlIHtAbGluayBtb2R1bGU6Y29yZS9lZGl0b3IvZWRpdG9yfkVkaXRvciNsb2NhbGV9IGluc3RhbmNlLlxuXHQgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25zIG9mIHRoZSB2aWV3LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5lbmFibGVkUHJvcGVydGllcyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgY29uZmlndXJhdGlvbiBvZiBlbmFibGVkIGxpc3QgcHJvcGVydHkgbmFtZXMuXG5cdCAqIEFsbG93cyBjb25kaXRpb25hbCByZW5kZXJpbmcgdGhlIHN1Yi1jb21wb25lbnRzIG9mIHRoZSBwcm9wZXJ0aWVzIHZpZXcuXG5cdCAqIEBwYXJhbSBvcHRpb25zLnN0eWxlQnV0dG9uVmlld3MgQSBsaXN0IG9mIHN0eWxlIGJ1dHRvbnMgdG8gYmUgcmVuZGVyZWRcblx0ICogaW5zaWRlIHRoZSBzdHlsZXMgZ3JpZC4gVGhlIGdyaWQgd2lsbCBub3QgYmUgcmVuZGVyZWQgd2hlbiBgZW5hYmxlZFByb3BlcnRpZXNgIGRvZXMgbm90IGluY2x1ZGUgdGhlIGAnc3R5bGVzJ2Aga2V5LlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zdHlsZUdyaWRBcmlhTGFiZWwgQW4gYXNzaXN0aXZlIHRlY2hub2xvZ2llcyBsYWJlbCBzZXQgb24gdGhlIGdyaWQgb2Ygc3R5bGVzIChpZiB0aGUgZ3JpZCBpcyByZW5kZXJlZCkuXG5cdCAqLyBjb25zdHJ1Y3Rvcihsb2NhbGUsIHsgZW5hYmxlZFByb3BlcnRpZXMsIHN0eWxlQnV0dG9uVmlld3MsIHN0eWxlR3JpZEFyaWFMYWJlbCB9KXtcbiAgICAgICAgc3VwZXIobG9jYWxlKTtcbiAgICAgICAgY29uc3QgZWxlbWVudENzc0NsYXNzZXMgPSBbXG4gICAgICAgICAgICAnY2snLFxuICAgICAgICAgICAgJ2NrLWxpc3QtcHJvcGVydGllcydcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IHRoaXMuY3JlYXRlQ29sbGVjdGlvbigpO1xuICAgICAgICB0aGlzLmZvY3VzQ3ljbGVyID0gbmV3IEZvY3VzQ3ljbGVyKHtcbiAgICAgICAgICAgIGZvY3VzYWJsZXM6IHRoaXMuZm9jdXNhYmxlcyxcbiAgICAgICAgICAgIGZvY3VzVHJhY2tlcjogdGhpcy5mb2N1c1RyYWNrZXIsXG4gICAgICAgICAgICBrZXlzdHJva2VIYW5kbGVyOiB0aGlzLmtleXN0cm9rZXMsXG4gICAgICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgLy8gTmF2aWdhdGUgI2NoaWxkcmVuIGJhY2t3YXJkcyB1c2luZyB0aGUgPGtiZD5TaGlmdDwva2JkPiArIDxrYmQ+VGFiPC9rYmQ+IGtleXN0cm9rZS5cbiAgICAgICAgICAgICAgICBmb2N1c1ByZXZpb3VzOiAnc2hpZnQgKyB0YWInLFxuICAgICAgICAgICAgICAgIC8vIE5hdmlnYXRlICNjaGlsZHJlbiBmb3J3YXJkcyB1c2luZyB0aGUgPGtiZD5UYWI8L2tiZD4ga2V5LlxuICAgICAgICAgICAgICAgIGZvY3VzTmV4dDogJ3RhYidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFRoZSByZW5kZXJpbmcgb2YgdGhlIHN0eWxlcyBncmlkIGlzIGNvbmRpdGlvbmFsLiBXaGVuIHRoZXJlIGlzIG5vIHN0eWxlcyBncmlkLCB0aGUgdmlldyB3aWxsIHJlbmRlciB3aXRob3V0IGNvbGxhcHNpYmxlXG4gICAgICAgIC8vIGZvciBudW1iZXJlZCBsaXN0IHByb3BlcnRpZXMsIGhlbmNlIHNpbXBsaWZ5aW5nIHRoZSBsYXlvdXQuXG4gICAgICAgIGlmIChzdHlsZUJ1dHRvblZpZXdzICYmIHN0eWxlQnV0dG9uVmlld3MubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlc1ZpZXcgPSB0aGlzLl9jcmVhdGVTdHlsZXNWaWV3KHN0eWxlQnV0dG9uVmlld3MsIHN0eWxlR3JpZEFyaWFMYWJlbCk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmFkZCh0aGlzLnN0eWxlc1ZpZXcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZWxlbWVudENzc0NsYXNzZXMucHVzaCgnY2stbGlzdC1wcm9wZXJ0aWVzX3dpdGhvdXQtc3R5bGVzJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIHJlbmRlcmluZyBvZiB0aGUgbnVtYmVyZWQgbGlzdCBwcm9wZXJ0eSB2aWV3cyBpcyBhbHNvIGNvbmRpdGlvbmFsLiBJdCBvbmx5IG1ha2VzIHNlbnNlIGZvciB0aGUgbnVtYmVyZWQgbGlzdFxuICAgICAgICAvLyBkcm9wZG93bi4gVGhlIHVub3JkZXJlZCBsaXN0IGRvZXMgbm90IGhhdmUgc3VjaCBwcm9wZXJ0aWVzLlxuICAgICAgICBpZiAoZW5hYmxlZFByb3BlcnRpZXMuc3RhcnRJbmRleCB8fCBlbmFibGVkUHJvcGVydGllcy5yZXZlcnNlZCkge1xuICAgICAgICAgICAgdGhpcy5fYWRkTnVtYmVyZWRMaXN0UHJvcGVydHlWaWV3cyhlbmFibGVkUHJvcGVydGllcyk7XG4gICAgICAgICAgICBlbGVtZW50Q3NzQ2xhc3Nlcy5wdXNoKCdjay1saXN0LXByb3BlcnRpZXNfd2l0aC1udW1iZXJlZC1wcm9wZXJ0aWVzJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRUZW1wbGF0ZSh7XG4gICAgICAgICAgICB0YWc6ICdkaXYnLFxuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBlbGVtZW50Q3NzQ2xhc3Nlc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLmNoaWxkcmVuXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHJlbmRlcigpIHtcbiAgICAgICAgc3VwZXIucmVuZGVyKCk7XG4gICAgICAgIGlmICh0aGlzLnN0eWxlc1ZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNhYmxlcy5hZGQodGhpcy5zdHlsZXNWaWV3KTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNUcmFja2VyLmFkZCh0aGlzLnN0eWxlc1ZpZXcuZWxlbWVudCk7XG4gICAgICAgICAgICAvLyBSZWdpc3RlciB0aGUgY29sbGFwc2libGUgdG9nZ2xlIGJ1dHRvbiB0byB0aGUgZm9jdXMgc3lzdGVtLlxuICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRJbmRleEZpZWxkVmlldyB8fCB0aGlzLnJldmVyc2VkU3dpdGNoQnV0dG9uVmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNhYmxlcy5hZGQodGhpcy5jaGlsZHJlbi5sYXN0LmJ1dHRvblZpZXcpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNUcmFja2VyLmFkZCh0aGlzLmNoaWxkcmVuLmxhc3QuYnV0dG9uVmlldy5lbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnN0eWxlc1ZpZXcuY2hpbGRyZW4pe1xuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVzVmlldy5mb2N1c1RyYWNrZXIuYWRkKGl0ZW0uZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRLZXlib2FyZEhhbmRsaW5nRm9yR3JpZCh7XG4gICAgICAgICAgICAgICAga2V5c3Ryb2tlSGFuZGxlcjogdGhpcy5zdHlsZXNWaWV3LmtleXN0cm9rZXMsXG4gICAgICAgICAgICAgICAgZm9jdXNUcmFja2VyOiB0aGlzLnN0eWxlc1ZpZXcuZm9jdXNUcmFja2VyLFxuICAgICAgICAgICAgICAgIGdyaWRJdGVtczogdGhpcy5zdHlsZXNWaWV3LmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBzdHlsZXMgdmlldyBoYXMgYSBkaWZmZXJlbnQgbnVtYmVyIG9mIGNvbHVtbnMgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIG90aGVyIHByb3BlcnRpZXNcbiAgICAgICAgICAgICAgICAvLyBhcmUgZW5hYmxlZCBpbiB0aGUgZHJvcGRvd24gb3Igbm90IChodHRwczovL2dpdGh1Yi5jb20vY2tlZGl0b3IvY2tlZGl0b3I1L2lzc3Vlcy8xMjM0MClcbiAgICAgICAgICAgICAgICBudW1iZXJPZkNvbHVtbnM6ICgpPT5nbG9iYWwud2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5zdHlsZXNWaWV3LmVsZW1lbnQpLmdldFByb3BlcnR5VmFsdWUoJ2dyaWQtdGVtcGxhdGUtY29sdW1ucycpLnNwbGl0KCcgJykubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHVpTGFuZ3VhZ2VEaXJlY3Rpb246IHRoaXMubG9jYWxlICYmIHRoaXMubG9jYWxlLnVpTGFuZ3VhZ2VEaXJlY3Rpb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0SW5kZXhGaWVsZFZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNhYmxlcy5hZGQodGhpcy5zdGFydEluZGV4RmllbGRWaWV3KTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNUcmFja2VyLmFkZCh0aGlzLnN0YXJ0SW5kZXhGaWVsZFZpZXcuZWxlbWVudCk7XG4gICAgICAgICAgICBjb25zdCBzdG9wUHJvcGFnYXRpb24gPSAoZGF0YSk9PmRhdGEuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAvLyBTaW5jZSB0aGUgZm9ybSBpcyBpbiB0aGUgZHJvcGRvd24gcGFuZWwgd2hpY2ggaXMgYSBjaGlsZCBvZiB0aGUgdG9vbGJhciwgdGhlIHRvb2xiYXInc1xuICAgICAgICAgICAgLy8ga2V5c3Ryb2tlIGhhbmRsZXIgd291bGQgdGFrZSBvdmVyIHRoZSBrZXkgbWFuYWdlbWVudCBpbiB0aGUgaW5wdXQuIFdlIG5lZWQgdG8gcHJldmVudFxuICAgICAgICAgICAgLy8gdGhpcyBBU0FQLiBPdGhlcndpc2UsIHRoZSBiYXNpYyBjYXJldCBtb3ZlbWVudCB1c2luZyB0aGUgYXJyb3cga2V5cyB3aWxsIGJlIGltcG9zc2libGUuXG4gICAgICAgICAgICB0aGlzLmtleXN0cm9rZXMuc2V0KCdhcnJvd3JpZ2h0Jywgc3RvcFByb3BhZ2F0aW9uKTtcbiAgICAgICAgICAgIHRoaXMua2V5c3Ryb2tlcy5zZXQoJ2Fycm93bGVmdCcsIHN0b3BQcm9wYWdhdGlvbik7XG4gICAgICAgICAgICB0aGlzLmtleXN0cm9rZXMuc2V0KCdhcnJvd3VwJywgc3RvcFByb3BhZ2F0aW9uKTtcbiAgICAgICAgICAgIHRoaXMua2V5c3Ryb2tlcy5zZXQoJ2Fycm93ZG93bicsIHN0b3BQcm9wYWdhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucmV2ZXJzZWRTd2l0Y2hCdXR0b25WaWV3KSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzYWJsZXMuYWRkKHRoaXMucmV2ZXJzZWRTd2l0Y2hCdXR0b25WaWV3KTtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNUcmFja2VyLmFkZCh0aGlzLnJldmVyc2VkU3dpdGNoQnV0dG9uVmlldy5lbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTdGFydCBsaXN0ZW5pbmcgZm9yIHRoZSBrZXlzdHJva2VzIGNvbWluZyBmcm9tICNlbGVtZW50LlxuICAgICAgICB0aGlzLmtleXN0cm9rZXMubGlzdGVuVG8odGhpcy5lbGVtZW50KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBmb2N1cygpIHtcbiAgICAgICAgdGhpcy5mb2N1c0N5Y2xlci5mb2N1c0ZpcnN0KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gZm9jdXNMYXN0KCkge1xuICAgICAgICB0aGlzLmZvY3VzQ3ljbGVyLmZvY3VzTGFzdCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5mb2N1c1RyYWNrZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLmtleXN0cm9rZXMuZGVzdHJveSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyB0aGUgbGlzdCBzdHlsZXMgZ3JpZC5cblx0ICpcblx0ICogQHBhcmFtIHN0eWxlQnV0dG9ucyBCdXR0b25zIHRvIGJlIHBsYWNlZCBpbiB0aGUgZ3JpZC5cblx0ICogQHBhcmFtIHN0eWxlR3JpZEFyaWFMYWJlbCBUaGUgYXNzaXN0aXZlIHRlY2hub2xvZ3kgbGFiZWwgb2YgdGhlIGdyaWQuXG5cdCAqLyBfY3JlYXRlU3R5bGVzVmlldyhzdHlsZUJ1dHRvbnMsIHN0eWxlR3JpZEFyaWFMYWJlbCkge1xuICAgICAgICBjb25zdCBzdHlsZXNWaWV3ID0gbmV3IFZpZXcodGhpcy5sb2NhbGUpO1xuICAgICAgICBzdHlsZXNWaWV3LmNoaWxkcmVuID0gc3R5bGVzVmlldy5jcmVhdGVDb2xsZWN0aW9uKCk7XG4gICAgICAgIHN0eWxlc1ZpZXcuY2hpbGRyZW4uYWRkTWFueShzdHlsZUJ1dHRvbnMpO1xuICAgICAgICBzdHlsZXNWaWV3LnNldFRlbXBsYXRlKHtcbiAgICAgICAgICAgIHRhZzogJ2RpdicsXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgJ2FyaWEtbGFiZWwnOiBzdHlsZUdyaWRBcmlhTGFiZWwsXG4gICAgICAgICAgICAgICAgY2xhc3M6IFtcbiAgICAgICAgICAgICAgICAgICAgJ2NrJyxcbiAgICAgICAgICAgICAgICAgICAgJ2NrLWxpc3Qtc3R5bGVzLWxpc3QnXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBzdHlsZXNWaWV3LmNoaWxkcmVuXG4gICAgICAgIH0pO1xuICAgICAgICBzdHlsZXNWaWV3LmNoaWxkcmVuLmRlbGVnYXRlKCdleGVjdXRlJykudG8odGhpcyk7XG4gICAgICAgIHN0eWxlc1ZpZXcuZm9jdXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgYnV0dG9uIHRoYXQgaXMgYWxyZWFkeSBvbiwgZm9jdXMgaXQuXG4gICAgICAgICAgICAvLyBJdCdzIGNvdW50ZXJpbnR1aXRpdmUgdG8gZm9jdXMgdGhlIGZpcnN0IGJ1dHRvbiB3aGVuIHRoZXJlIGlzIGFscmVhZHkgYSBidXR0b24gb24uXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuY2hpbGRyZW4pe1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEJ1dHRvblZpZXcgJiYgY2hpbGQuaXNPbikge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZC5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gLi4uIG90aGVyd2lzZSBmb2N1cyB0aGUgZmlyc3QgYnV0dG9uLlxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5maXJzdC5mb2N1cygpO1xuICAgICAgICB9O1xuICAgICAgICBzdHlsZXNWaWV3LmZvY3VzVHJhY2tlciA9IG5ldyBGb2N1c1RyYWNrZXIoKTtcbiAgICAgICAgc3R5bGVzVmlldy5rZXlzdHJva2VzID0gbmV3IEtleXN0cm9rZUhhbmRsZXIoKTtcbiAgICAgICAgc3R5bGVzVmlldy5yZW5kZXIoKTtcbiAgICAgICAgc3R5bGVzVmlldy5rZXlzdHJva2VzLmxpc3RlblRvKHN0eWxlc1ZpZXcuZWxlbWVudCk7XG4gICAgICAgIHJldHVybiBzdHlsZXNWaWV3O1xuICAgIH1cbiAgICAvKipcblx0ICogUmVuZGVycyB7QGxpbmsgI3N0YXJ0SW5kZXhGaWVsZFZpZXd9IGFuZC9vciB7QGxpbmsgI3JldmVyc2VkU3dpdGNoQnV0dG9uVmlld30gZGVwZW5kaW5nIG9uIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBwcm9wZXJ0aWVzIHZpZXcuXG5cdCAqXG5cdCAqIEBwYXJhbSBlbmFibGVkUHJvcGVydGllcyBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgY29uZmlndXJhdGlvbiBvZiBlbmFibGVkIGxpc3QgcHJvcGVydHkgbmFtZXNcblx0ICogKHNlZSB7QGxpbmsgI2NvbnN0cnVjdG9yfSkuXG5cdCAqLyBfYWRkTnVtYmVyZWRMaXN0UHJvcGVydHlWaWV3cyhlbmFibGVkUHJvcGVydGllcykge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5sb2NhbGUudDtcbiAgICAgICAgY29uc3QgbnVtYmVyZWRQcm9wZXJ0eVZpZXdzID0gW107XG4gICAgICAgIGlmIChlbmFibGVkUHJvcGVydGllcy5zdGFydEluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0SW5kZXhGaWVsZFZpZXcgPSB0aGlzLl9jcmVhdGVTdGFydEluZGV4RmllbGQoKTtcbiAgICAgICAgICAgIG51bWJlcmVkUHJvcGVydHlWaWV3cy5wdXNoKHRoaXMuc3RhcnRJbmRleEZpZWxkVmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVuYWJsZWRQcm9wZXJ0aWVzLnJldmVyc2VkKSB7XG4gICAgICAgICAgICB0aGlzLnJldmVyc2VkU3dpdGNoQnV0dG9uVmlldyA9IHRoaXMuX2NyZWF0ZVJldmVyc2VkU3dpdGNoQnV0dG9uKCk7XG4gICAgICAgICAgICBudW1iZXJlZFByb3BlcnR5Vmlld3MucHVzaCh0aGlzLnJldmVyc2VkU3dpdGNoQnV0dG9uVmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gV2hlbiB0aGVyZSBhcmUgc29tZSBzdHlsZSBidXR0b25zLCBwYWNrIHRoZSBudW1iZXJlZCBsaXN0IHByb3BlcnRpZXMgaW50byBhIGNvbGxhcHNpYmxlIHRvIHNlcGFyYXRlIHRoZW0uXG4gICAgICAgIGlmICh0aGlzLnN0eWxlc1ZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkaXRpb25hbFByb3BlcnRpZXNDb2xsYXBzaWJsZVZpZXcgPSBuZXcgQ29sbGFwc2libGVWaWV3KHRoaXMubG9jYWxlLCBudW1iZXJlZFByb3BlcnR5Vmlld3MpO1xuICAgICAgICAgICAgdGhpcy5hZGRpdGlvbmFsUHJvcGVydGllc0NvbGxhcHNpYmxlVmlldy5zZXQoe1xuICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdMaXN0IHByb3BlcnRpZXMnKSxcbiAgICAgICAgICAgICAgICBpc0NvbGxhcHNlZDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBEb24ndCBlbmFibGUgdGhlIGNvbGxhcHNpYmxlIHZpZXcgdW5sZXNzIGVpdGhlciBzdGFydCBpbmRleCBvciByZXZlcnNlZCBmaWVsZCBpcyBlbmFibGVkIChlLmcuIHdoZW4gbm8gbGlzdCBpcyBzZWxlY3RlZCkuXG4gICAgICAgICAgICB0aGlzLmFkZGl0aW9uYWxQcm9wZXJ0aWVzQ29sbGFwc2libGVWaWV3LmJ1dHRvblZpZXcuYmluZCgnaXNFbmFibGVkJykudG9NYW55KG51bWJlcmVkUHJvcGVydHlWaWV3cywgJ2lzRW5hYmxlZCcsICguLi5hcmVFbmFibGVkKT0+YXJlRW5hYmxlZC5zb21lKChpc0VuYWJsZWQpPT5pc0VuYWJsZWQpKTtcbiAgICAgICAgICAgIC8vIEF1dG9tYXRpY2FsbHkgY29sbGFwc2UgdGhlIGFkZGl0aW9uYWwgcHJvcGVydGllcyBjb2xsYXBzaWJsZSB3aGVuIGVpdGhlciBzdGFydCBpbmRleCBvciByZXZlcnNlZCBmaWVsZCBnZXRzIGRpc2FibGVkLlxuICAgICAgICAgICAgdGhpcy5hZGRpdGlvbmFsUHJvcGVydGllc0NvbGxhcHNpYmxlVmlldy5idXR0b25WaWV3Lm9uKCdjaGFuZ2U6aXNFbmFibGVkJywgKGV2dCwgZGF0YSwgaXNFbmFibGVkKT0+e1xuICAgICAgICAgICAgICAgIGlmICghaXNFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkaXRpb25hbFByb3BlcnRpZXNDb2xsYXBzaWJsZVZpZXcuaXNDb2xsYXBzZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5hZGQodGhpcy5hZGRpdGlvbmFsUHJvcGVydGllc0NvbGxhcHNpYmxlVmlldyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLmFkZE1hbnkobnVtYmVyZWRQcm9wZXJ0eVZpZXdzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyB0aGUgbGlzdCBzdGFydCBpbmRleCBsYWJlbGVkIGZpZWxkLlxuXHQgKi8gX2NyZWF0ZVN0YXJ0SW5kZXhGaWVsZCgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubG9jYWxlLnQ7XG4gICAgICAgIGNvbnN0IHN0YXJ0SW5kZXhGaWVsZFZpZXcgPSBuZXcgTGFiZWxlZEZpZWxkVmlldyh0aGlzLmxvY2FsZSwgY3JlYXRlTGFiZWxlZElucHV0TnVtYmVyKTtcbiAgICAgICAgc3RhcnRJbmRleEZpZWxkVmlldy5zZXQoe1xuICAgICAgICAgICAgbGFiZWw6IHQoJ1N0YXJ0IGF0JyksXG4gICAgICAgICAgICBjbGFzczogJ2NrLW51bWJlcmVkLWxpc3QtcHJvcGVydGllc19fc3RhcnQtaW5kZXgnXG4gICAgICAgIH0pO1xuICAgICAgICBzdGFydEluZGV4RmllbGRWaWV3LmZpZWxkVmlldy5zZXQoe1xuICAgICAgICAgICAgbWluOiAwLFxuICAgICAgICAgICAgc3RlcDogMSxcbiAgICAgICAgICAgIHZhbHVlOiAxLFxuICAgICAgICAgICAgaW5wdXRNb2RlOiAnbnVtZXJpYydcbiAgICAgICAgfSk7XG4gICAgICAgIHN0YXJ0SW5kZXhGaWVsZFZpZXcuZmllbGRWaWV3Lm9uKCdpbnB1dCcsICgpPT57XG4gICAgICAgICAgICBjb25zdCBpbnB1dEVsZW1lbnQgPSBzdGFydEluZGV4RmllbGRWaWV3LmZpZWxkVmlldy5lbGVtZW50O1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IGlucHV0RWxlbWVudC52YWx1ZUFzTnVtYmVyO1xuICAgICAgICAgICAgaWYgKE51bWJlci5pc05hTihzdGFydEluZGV4KSkge1xuICAgICAgICAgICAgICAgIC8vIE51bWJlciBpbnB1dHMgYWxsb3cgZm9yIHRoZSBlbnRyeSBvZiBjaGFyYWN0ZXJzIHRoYXQgbWF5IHJlc3VsdCBpbiBOYU4sXG4gICAgICAgICAgICAgICAgLy8gc3VjaCBhcyAnZScsICcrJywgJzEyM2UnLCAnMi0nLlxuICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXhGaWVsZFZpZXcuZXJyb3JUZXh0ID0gdCgnSW52YWxpZCBzdGFydCBpbmRleCB2YWx1ZS4nKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWlucHV0RWxlbWVudC5jaGVja1ZhbGlkaXR5KCkpIHtcbiAgICAgICAgICAgICAgICBzdGFydEluZGV4RmllbGRWaWV3LmVycm9yVGV4dCA9IHQoJ1N0YXJ0IGluZGV4IG11c3QgYmUgZ3JlYXRlciB0aGFuIDAuJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnbGlzdFN0YXJ0Jywge1xuICAgICAgICAgICAgICAgICAgICBzdGFydEluZGV4XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3RhcnRJbmRleEZpZWxkVmlldztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgdGhlIHJldmVyc2VkIGxpc3Qgc3dpdGNoIGJ1dHRvbi5cblx0ICovIF9jcmVhdGVSZXZlcnNlZFN3aXRjaEJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubG9jYWxlLnQ7XG4gICAgICAgIGNvbnN0IHJldmVyc2VkQnV0dG9uVmlldyA9IG5ldyBTd2l0Y2hCdXR0b25WaWV3KHRoaXMubG9jYWxlKTtcbiAgICAgICAgcmV2ZXJzZWRCdXR0b25WaWV3LnNldCh7XG4gICAgICAgICAgICB3aXRoVGV4dDogdHJ1ZSxcbiAgICAgICAgICAgIGxhYmVsOiB0KCdSZXZlcnNlZCBvcmRlcicpLFxuICAgICAgICAgICAgY2xhc3M6ICdjay1udW1iZXJlZC1saXN0LXByb3BlcnRpZXNfX3JldmVyc2VkLW9yZGVyJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV2ZXJzZWRCdXR0b25WaWV3LmRlbGVnYXRlKCdleGVjdXRlJykudG8odGhpcywgJ2xpc3RSZXZlcnNlZCcpO1xuICAgICAgICByZXR1cm4gcmV2ZXJzZWRCdXR0b25WaWV3O1xuICAgIH1cbn1cblxudmFyIGxpc3RTdHlsZURpc2NJY29uID0gXCI8c3ZnIHZpZXdCb3g9XFxcIjAgMCA0NCA0NFxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIj48cGF0aCBkPVxcXCJNMzUgMjlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3elxcXCIgZmlsbC1vcGFjaXR5PVxcXCIuMTYzXFxcIi8+PHBhdGggZD1cXFwiTTExIDI3YTMgMyAwIDEgMSAwIDYgMyAzIDAgMCAxIDAtNnptMC05YTMgMyAwIDEgMSAwIDYgMyAzIDAgMCAxIDAtNnptMC05YTMgMyAwIDEgMSAwIDYgMyAzIDAgMCAxIDAtNnpcXFwiLz48L3N2Zz5cIjtcblxudmFyIGxpc3RTdHlsZUNpcmNsZUljb24gPSBcIjxzdmcgdmlld0JveD1cXFwiMCAwIDQ0IDQ0XFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiPjxwYXRoIGQ9XFxcIk0zNSAyOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6XFxcIiBmaWxsLW9wYWNpdHk9XFxcIi4xNjNcXFwiLz48cGF0aCBkPVxcXCJNMTEgMjdhMyAzIDAgMSAxIDAgNiAzIDMgMCAwIDEgMC02em0wIDFhMiAyIDAgMSAwIDAgNCAyIDIgMCAwIDAgMC00em0wLTEwYTMgMyAwIDEgMSAwIDYgMyAzIDAgMCAxIDAtNnptMCAxYTIgMiAwIDEgMCAwIDQgMiAyIDAgMCAwIDAtNHptMC0xMGEzIDMgMCAxIDEgMCA2IDMgMyAwIDAgMSAwLTZ6bTAgMWEyIDIgMCAxIDAgMCA0IDIgMiAwIDAgMCAwLTR6XFxcIi8+PC9zdmc+XCI7XG5cbnZhciBsaXN0U3R5bGVTcXVhcmVJY29uID0gXCI8c3ZnIHZpZXdCb3g9XFxcIjAgMCA0NCA0NFxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIj48cGF0aCBkPVxcXCJNMzUgMjlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3elxcXCIgZmlsbC1vcGFjaXR5PVxcXCIuMTYzXFxcIi8+PHBhdGggZD1cXFwiTTE0IDI3djZIOHYtNmg2em0wLTl2Nkg4di02aDZ6bTAtOXY2SDhWOWg2elxcXCIvPjwvc3ZnPlwiO1xuXG52YXIgbGlzdFN0eWxlRGVjaW1hbEljb24gPSBcIjxzdmcgdmlld0JveD1cXFwiMCAwIDQ0IDQ0XFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiPjxwYXRoIGQ9XFxcIk0zNSAyOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6XFxcIiBmaWxsLW9wYWNpdHk9XFxcIi4xNjNcXFwiLz48cGF0aCBkPVxcXCJNMTAuMjkgMTVWOC41MzFIOS4yODZjLS4xNC4zOTMtLjQuNzM2LS43NzggMS4wMy0uMzc4LjI5NS0uNzI4LjQ5NS0xLjA1LjZ2MS4xMjFhNC4yNTcgNC4yNTcgMCAwIDAgMS41OTUtLjkzNlYxNWgxLjIzNXptMy4zNDMgMHYtMS4yMzVoLTEuMjM1VjE1aDEuMjM1ek0xMS4zIDI0di0xLjE0N0g4Ljg0OGMuMDY0LS4xMTEuMTQ4LS4yMjYuMjUyLS4zNDMuMTA0LS4xMTcuMzUxLS4zNTQuNzQtLjcxMi4zOS0uMzU3LjY2LS42MzEuODEtLjgyMS4yMjUtLjI4OC4zOS0uNTYyLjQ5NC0uODI0LjEwNC0uMjYzLjE1Ni0uNTM5LjE1Ni0uODI5IDAtLjUxLS4xODItLjkzNi0uNTQ1LTEuMjc5LS4zNjMtLjM0Mi0uODYzLS41MTQtMS40OTktLjUxNC0uNTggMC0xLjA2My4xNDgtMS40NS40NDQtLjM4Ny4yOTYtLjYxNy43ODQtLjY5IDEuNDYzbDEuMjMuMTI0Yy4wMjQtLjM2LjExMi0uNjE5LjI2NC0uNzc0LjE1My0uMTU1LjM1OC0uMjMzLjYxNi0uMjMzLjI2IDAgLjQ2NS4wNzQuNjEzLjIyMi4xNDguMTQ4LjIyMi4zNi4yMjIuNjM1IDAgLjI1LS4wODUuNTAxLS4yNTUuNzU2LS4xMjYuMTg1LS40NjguNTM2LTEuMDI0IDEuMDU1LS42OTIuNjQxLTEuMTU1IDEuMTU2LTEuMzg5IDEuNTQ0LS4yMzQuMzg5LS4zNzUuOC0uNDIyIDEuMjMzSDExLjN6bTIuMzMzIDB2LTEuMjM1aC0xLjIzNVYyNGgxLjIzNXpNOS4yMDQgMzQuMTFjLjYxNSAwIDEuMTI5LS4yIDEuNTQyLS41OTguNDEzLS4zOTguNjItLjg4LjYyLTEuNDQ2IDAtLjM5LS4xMS0uNzIyLS4zMzItLjk5N2ExLjUgMS41IDAgMCAwLS44ODYtLjUzMmMuNjE5LS4zMzcuOTI4LS43ODguOTI4LTEuMzUzIDAtLjM5OS0uMTUxLS43NTYtLjQ1My0xLjA3My0uMzY2LS4zODYtLjg1Mi0uNTgtMS40NTktLjU4YTIuMjUgMi4yNSAwIDAgMC0uOTYuMiAxLjYxNyAxLjYxNyAwIDAgMC0uNjY4LjU1Yy0uMTYuMjMyLS4yOC41NDQtLjM1OC45MzNsMS4xMzguMTk0Yy4wMzItLjI4Mi4xMjMtLjQ5NS4yNzItLjY0Mi4xNS0uMTQ2LjMzLS4yMi41NC0uMjIuMjE1IDAgLjM4Ni4wNjUuNTE1LjE5NHMuMTkzLjMwMi4xOTMuNTE4YzAgLjI1NS0uMDg3LjQ2LS4yNjMuNjEzLS4xNzYuMTU0LS40My4yMjctLjc2NS4yMThsLS4xMzYgMS4wMDZjLjIyLS4wNjEuNDA5LS4wOTIuNTY3LS4wOTIuMjQgMCAuNDQ0LjA5LjYxLjI3Mi4xNjguMTgyLjI1MS40MjguMjUxLjczOSAwIC4zMjgtLjA4Ny41ODktLjI2MS43ODJhLjgzMy44MzMgMCAwIDEtLjY0NC4yOS44NDEuODQxIDAgMCAxLS42MDctLjI0MmMtLjE2Ny0uMTYtLjI3LS4zOTQtLjMwNy0uNjk4bC0xLjE5Ni4xNDVjLjA2Mi41NDIuMjg1Ljk4LjY2OCAxLjMxNi4zODQuMzM1Ljg2OC41MDMgMS40NS41MDN6bTQuNDMtLjExdi0xLjIzNWgtMS4yMzZWMzRoMS4yMzV6XFxcIi8+PC9zdmc+XCI7XG5cbnZhciBsaXN0U3R5bGVEZWNpbWFsV2l0aExlYWRpbmdaZXJvSWNvbiA9IFwiPHN2ZyB2aWV3Qm94PVxcXCIwIDAgNDQgNDRcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCI+PHBhdGggZD1cXFwiTTM1IDI5YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3pcXFwiIGZpbGwtb3BhY2l0eT1cXFwiLjE2M1xcXCIvPjxwYXRoIGQ9XFxcIk01LjcxNCAxNS4xMWMuNjI0IDAgMS4xMS0uMjIgMS40Ni0uNjYuNDIxLS41MzMuNjMyLTEuNDA4LjYzMi0yLjYyNyAwLTEuMjIyLS4yMS0yLjA5Ni0uNjI5LTIuNjI0LS4zNTEtLjQ0NS0uODM5LS42NjgtMS40NjMtLjY2OC0uNjI0IDAtMS4xMS4yMi0xLjQ1OS42Ni0uNDIyLjUzMy0uNjMzIDEuNDA2LS42MzMgMi42MTkgMCAxLjIzNi4xOTIgMi4wOTUuNTc2IDIuNTc3LjM4NC40ODIuODkuNzIzIDEuNTE2LjcyM3ptMC0xLjAyNGEuNjE0LjYxNCAwIDAgMS0uMzk4LS4xNGMtLjExNS0uMDk0LS4yMTEtLjI4My0uMjg3LS41NjUtLjA3Ny0uMjgzLS4xMTUtLjgwMi0uMTE1LTEuNTU4cy4wNDMtMS4yOTQuMTI4LTEuNjEzYy4wNjQtLjI0Ni4xNTUtLjQxNy4yNzItLjUxMmEuNjE3LjYxNyAwIDAgMSAuNC0uMTQzLjYxLjYxIDAgMCAxIC4zOTguMTQzYy4xMTYuMDk1LjIxMS4yODQuMjg4LjU2Ny4wNzYuMjgzLjExNC44MDIuMTE0IDEuNTU4cy0uMDQzIDEuMjkyLS4xMjggMS42MDhjLS4wNjQuMjQ2LS4xNTUuNDE3LS4yNzIuNTEyYS42MTcuNjE3IDAgMCAxLS40LjE0M3ptNi4wNzguOTE0VjguNTMxSDEwLjc5Yy0uMTQuMzkzLS40LjczNi0uNzc4IDEuMDMtLjM3OC4yOTUtLjcyOC40OTUtMS4wNS42djEuMTIxYTQuMjU3IDQuMjU3IDAgMCAwIDEuNTk1LS45MzZWMTVoMS4yMzV6bTMuMzQ0IDB2LTEuMjM1aC0xLjIzNVYxNWgxLjIzNXptLTkuNDIyIDkuMTFjLjYyNCAwIDEuMTEtLjIyIDEuNDYtLjY2LjQyMS0uNTMzLjYzMi0xLjQwOC42MzItMi42MjcgMC0xLjIyMi0uMjEtMi4wOTYtLjYyOS0yLjYyNC0uMzUxLS40NDUtLjgzOS0uNjY4LTEuNDYzLS42NjgtLjYyNCAwLTEuMTEuMjItMS40NTkuNjYtLjQyMi41MzMtLjYzMyAxLjQwNi0uNjMzIDIuNjE5IDAgMS4yMzYuMTkyIDIuMDk1LjU3NiAyLjU3Ny4zODQuNDgyLjg5LjcyMyAxLjUxNi43MjN6bTAtMS4wMjRhLjYxNC42MTQgMCAwIDEtLjM5OC0uMTRjLS4xMTUtLjA5NC0uMjExLS4yODMtLjI4Ny0uNTY1LS4wNzctLjI4My0uMTE1LS44MDItLjExNS0xLjU1OHMuMDQzLTEuMjk0LjEyOC0xLjYxM2MuMDY0LS4yNDYuMTU1LS40MTcuMjcyLS41MTJhLjYxNy42MTcgMCAwIDEgLjQtLjE0My42MS42MSAwIDAgMSAuMzk4LjE0M2MuMTE2LjA5NS4yMTEuMjg0LjI4OC41NjcuMDc2LjI4My4xMTQuODAyLjExNCAxLjU1OHMtLjA0MyAxLjI5Mi0uMTI4IDEuNjA4Yy0uMDY0LjI0Ni0uMTU1LjQxNy0uMjcyLjUxMmEuNjE3LjYxNyAwIDAgMS0uNC4xNDN6bTcuMDg4LjkxNHYtMS4xNDdIMTAuMzVjLjA2NS0uMTExLjE0OS0uMjI2LjI1My0uMzQzLjEwNC0uMTE3LjM1LS4zNTQuNzQtLjcxMi4zOS0uMzU3LjY2LS42MzEuODEtLjgyMS4yMjUtLjI4OC4zOS0uNTYyLjQ5My0uODI0LjEwNC0uMjYzLjE1Ni0uNTM5LjE1Ni0uODI5IDAtLjUxLS4xODEtLjkzNi0uNTQ0LTEuMjc5LS4zNjQtLjM0Mi0uODYzLS41MTQtMS40OTktLjUxNC0uNTggMC0xLjA2My4xNDgtMS40NS40NDQtLjM4Ny4yOTYtLjYxNy43ODQtLjY5IDEuNDYzbDEuMjMuMTI0Yy4wMjQtLjM2LjExMi0uNjE5LjI2NC0uNzc0LjE1Mi0uMTU1LjM1Ny0uMjMzLjYxNS0uMjMzLjI2MSAwIC40NjUuMDc0LjYxMy4yMjIuMTQ4LjE0OC4yMjIuMzYuMjIyLjYzNSAwIC4yNS0uMDg1LjUwMS0uMjU1Ljc1Ni0uMTI2LjE4NS0uNDY3LjUzNi0xLjAyNCAxLjA1NS0uNjkxLjY0MS0xLjE1NCAxLjE1Ni0xLjM4OCAxLjU0NC0uMjM1LjM4OS0uMzc1LjgtLjQyMiAxLjIzM2g0LjMyOHptMi4zMzQgMHYtMS4yMzVoLTEuMjM1VjI0aDEuMjM1ek01LjcxNCAzNC4xMWMuNjI0IDAgMS4xMS0uMjIgMS40Ni0uNjYuNDIxLS41MzMuNjMyLTEuNDA4LjYzMi0yLjYyNyAwLTEuMjIyLS4yMS0yLjA5Ni0uNjI5LTIuNjI0LS4zNTEtLjQ0NS0uODM5LS42NjgtMS40NjMtLjY2OC0uNjI0IDAtMS4xMS4yMi0xLjQ1OS42Ni0uNDIyLjUzMy0uNjMzIDEuNDA2LS42MzMgMi42MTkgMCAxLjIzNi4xOTIgMi4wOTUuNTc2IDIuNTc3LjM4NC40ODIuODkuNzIzIDEuNTE2LjcyM3ptMC0xLjAyNGEuNjE0LjYxNCAwIDAgMS0uMzk4LS4xNGMtLjExNS0uMDk0LS4yMTEtLjI4My0uMjg3LS41NjUtLjA3Ny0uMjgzLS4xMTUtLjgwMi0uMTE1LTEuNTU4cy4wNDMtMS4yOTQuMTI4LTEuNjEzYy4wNjQtLjI0Ni4xNTUtLjQxNy4yNzItLjUxMmEuNjE3LjYxNyAwIDAgMSAuNC0uMTQzLjYxLjYxIDAgMCAxIC4zOTguMTQzYy4xMTYuMDk1LjIxMS4yODQuMjg4LjU2Ny4wNzYuMjgzLjExNC44MDIuMTE0IDEuNTU4cy0uMDQzIDEuMjkyLS4xMjggMS42MDhjLS4wNjQuMjQ2LS4xNTUuNDE3LS4yNzIuNTEyYS42MTcuNjE3IDAgMCAxLS40LjE0M3ptNC45OTIgMS4wMjRjLjYxNiAwIDEuMTMtLjIgMS41NDMtLjU5OC40MTMtLjM5OC42Mi0uODguNjItMS40NDYgMC0uMzktLjExMS0uNzIyLS4zMzItLjk5N2ExLjUgMS41IDAgMCAwLS44ODYtLjUzMmMuNjE4LS4zMzcuOTI3LS43ODguOTI3LTEuMzUzIDAtLjM5OS0uMTUtLjc1Ni0uNDUyLTEuMDczLS4zNjYtLjM4Ni0uODUzLS41OC0xLjQ2LS41OGEyLjI1IDIuMjUgMCAwIDAtLjk2LjIgMS42MTcgMS42MTcgMCAwIDAtLjY2Ny41NWMtLjE2LjIzMi0uMjguNTQ0LS4zNTkuOTMzbDEuMTM5LjE5NGMuMDMyLS4yODIuMTIzLS40OTUuMjcyLS42NDIuMTUtLjE0Ni4zMy0uMjIuNTQtLjIyLjIxNCAwIC4zODYuMDY1LjUxNS4xOTRzLjE5My4zMDIuMTkzLjUxOGMwIC4yNTUtLjA4OC40Ni0uMjY0LjYxMy0uMTc1LjE1NC0uNDMuMjI3LS43NjQuMjE4bC0uMTM2IDEuMDA2Yy4yMi0uMDYxLjQwOC0uMDkyLjU2Ni0uMDkyLjI0IDAgLjQ0NC4wOS42MTEuMjcyLjE2Ny4xODIuMjUuNDI4LjI1LjczOSAwIC4zMjgtLjA4Ni41ODktLjI2Ljc4MmEuODMzLjgzMyAwIDAgMS0uNjQ0LjI5Ljg0MS44NDEgMCAwIDEtLjYwNy0uMjQyYy0uMTY3LS4xNi0uMjctLjM5NC0uMzA4LS42OThsLTEuMTk1LjE0NWMuMDYyLjU0Mi4yODQuOTguNjY4IDEuMzE2LjM4NC4zMzUuODY3LjUwMyAxLjQ1LjUwM3ptNC40My0uMTF2LTEuMjM1aC0xLjIzNVYzNGgxLjIzNXpcXFwiLz48L3N2Zz5cIjtcblxudmFyIGxpc3RTdHlsZUxvd2VyUm9tYW5JY29uID0gXCI8c3ZnIHZpZXdCb3g9XFxcIjAgMCA0NCA0NFxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIj48cGF0aCBkPVxcXCJNMzUgMjlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3em0wLTlhMSAxIDAgMCAxIDEgMXYxYTEgMSAwIDAgMS0xIDFIMThhMSAxIDAgMCAxLTEtMXYtMWExIDEgMCAwIDEgMS0xaDE3elxcXCIgZmlsbC1vcGFjaXR5PVxcXCIuMTYzXFxcIi8+PHBhdGggZD1cXFwiTTExLjg4IDguN1Y3LjU1OGgtMS4yMzRWOC43aDEuMjM0em0wIDUuM1Y5LjMzM2gtMS4yMzRWMTRoMS4yMzR6bTIuNSAwdi0xLjIzNWgtMS4yMzRWMTRoMS4yMzV6bS00Ljc1IDQuN3YtMS4xNDJIOC4zOTVWMTguN0g5LjYzem0wIDUuM3YtNC42NjdIOC4zOTVWMjRIOS42M3ptMi41LTUuM3YtMS4xNDJoLTEuMjM0VjE4LjdoMS4yMzV6bTAgNS4zdi00LjY2N2gtMS4yMzRWMjRoMS4yMzV6bTIuNTAxIDB2LTEuMjM1aC0xLjIzNVYyNGgxLjIzNXpNNy4zOCAyOC43di0xLjE0Mkg2LjE0NVYyOC43SDcuMzh6bTAgNS4zdi00LjY2N0g2LjE0NVYzNEg3LjM4em0yLjUtNS4zdi0xLjE0Mkg4LjY0NlYyOC43SDkuODh6bTAgNS4zdi00LjY2N0g4LjY0NlYzNEg5Ljg4em0yLjUtNS4zdi0xLjE0MmgtMS4yMzRWMjguN2gxLjIzNXptMCA1LjN2LTQuNjY3aC0xLjIzNFYzNGgxLjIzNXptMi41MDEgMHYtMS4yMzVoLTEuMjM1VjM0aDEuMjM1elxcXCIvPjwvc3ZnPlwiO1xuXG52YXIgbGlzdFN0eWxlVXBwZXJSb21hbkljb24gPSBcIjxzdmcgdmlld0JveD1cXFwiMCAwIDQ0IDQ0XFxcIiB4bWxucz1cXFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcXFwiPjxwYXRoIGQ9XFxcIk0zNSAyOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6bTAtOWExIDEgMCAwIDEgMSAxdjFhMSAxIDAgMCAxLTEgMUgxOGExIDEgMCAwIDEtMS0xdi0xYTEgMSAwIDAgMSAxLTFoMTd6XFxcIiBmaWxsLW9wYWNpdHk9XFxcIi4xNjNcXFwiLz48cGF0aCBkPVxcXCJNMTEuOTE2IDE1VjguNTU4aC0xLjMwMVYxNWgxLjN6bTIuNDY1IDB2LTEuMjM1aC0xLjIzNVYxNWgxLjIzNXpNOS42NjUgMjV2LTYuNDQyaC0xLjNWMjVoMS4zem0yLjUgMHYtNi40NDJoLTEuM1YyNWgxLjN6bTIuNDY2IDB2LTEuMjM1aC0xLjIzNVYyNWgxLjIzNXptLTcuMjE2IDl2LTYuNDQyaC0xLjNWMzRoMS4zem0yLjUgMHYtNi40NDJoLTEuM1YzNGgxLjN6bTIuNTAxIDB2LTYuNDQyaC0xLjNWMzRoMS4zem0yLjQ2NSAwdi0xLjIzNWgtMS4yMzVWMzRoMS4yMzV6XFxcIi8+PC9zdmc+XCI7XG5cbnZhciBsaXN0U3R5bGVMb3dlckxhdGluSWNvbiA9IFwiPHN2ZyB2aWV3Qm94PVxcXCIwIDAgNDQgNDRcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCI+PHBhdGggZD1cXFwiTTM1IDI5YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3pcXFwiIGZpbGwtb3BhY2l0eT1cXFwiLjE2M1xcXCIvPjxwYXRoIGQ9XFxcIk05LjYyIDE0LjEwNWMuMjcyIDAgLjUyOC0uMDUuNzY4LS4xNTNzLjQ2Ni0uMjU3LjY3Ny0uNDYyYy4wMDkuMDI0LjAyMy4wNzIuMDQ0LjE0NS4wNDcuMTYxLjA4Ni4yODMuMTE5LjM2NWgxLjIyMWEyLjY0OSAyLjY0OSAwIDAgMS0uMjIyLS42MjZjLS4wNC0uMTk1LS4wNTktLjQ5OC0uMDU5LS45MDhsLjAxMy0xLjQ0MWMwLS41MzYtLjA1NS0uOTA1LS4xNjUtMS4xMDUtLjExLS4yMDEtLjMtLjM2Ny0uNTY5LS40OTctLjI3LS4xMy0uNjgtLjE5NS0xLjIzLS4xOTUtLjYwNyAwLTEuMDY0LjEwOC0xLjM3MS4zMjUtLjMwOC4yMTctLjUyNS41NS0uNjUgMS4wMDJsMS4xMi4yMDJjLjA3Ni0uMjE3LjE3Ni0uMzY5LjI5OS0uNDU1LjEyMy0uMDg2LjI5NC0uMTMuNTE0LS4xMy4zMjUgMCAuNTQ2LjA1LjY2My4xNTIuMTE4LjEwMS4xNzYuMjcuMTc2LjUwOHYuMTIzYy0uMjIyLjA5My0uNjIyLjE5NC0xLjIuMzAzLS40MjcuMDgyLS43NTUuMTc4LS45ODIuMjg4LS4yMjcuMTEtLjQwMy4yNjgtLjUzLjQ3NGExLjMyNyAxLjMyNyAwIDAgMC0uMTg4LjcwNmMwIC4zOTguMTM4LjcyOC40MTUuOTg4LjI3Ny4yNjEuNjU2LjM5MSAxLjEzNi4zOTF6bS4zNjgtLjg3YS42NzUuNjc1IDAgMCAxLS40OTItLjE4OS42MDYuNjA2IDAgMCAxLS4xOTMtLjQ0OGMwLS4xNzYuMDgtLjMyLjI0MS0uNDM1LjEwNi0uMDcuMzMtLjE0Mi42NzMtLjIxNWE3LjE5IDcuMTkgMCAwIDAgLjc1MS0uMTl2LjI0N2MwIC4yOTYtLjAxNi40OTYtLjA0OC42MDJhLjc3My43NzMgMCAwIDEtLjI5NS40MDkgMS4wNyAxLjA3IDAgMCAxLS42MzcuMjJ6bTQuNjQ1Ljc2NXYtMS4yMzVoLTEuMjM1VjE0aDEuMjM1ek0xMC4yIDI1LjEwNWMuNTQyIDAgMS4wMDMtLjIxNSAxLjM4Mi0uNjQ2LjM4LS40My41Ny0xLjA0NC41Ny0xLjg0IDAtLjc3MS0uMTg3LTEuMzYyLS41NTktMS43NzRhMS44MiAxLjgyIDAgMCAwLTEuNDEtLjYxN2MtLjUyMiAwLS45NzMuMjE2LTEuMzU0LjY1di0yLjMySDcuNTk0VjI1aDEuMTQ3di0uNjg2YTEuOSAxLjkgMCAwIDAgLjY3LjU5MmMuMjYuMTMzLjUyMy4yLjc5LjJ6bS0uMjk5LS45NzVjLS4zNTQgMC0uNjM4LS4xNjQtLjg1Mi0uNDkyLS4xNTMtLjIzMi0uMjI5LS41OS0uMjI5LTEuMDczIDAtLjQ2OC4wOTgtLjgxOC4yOTUtMS4wNDhhLjkzLjkzIDAgMCAxIC43MzgtLjM0NWMuMzAyIDAgLjU1LjExOC43NDMuMzU0LjE5My4yMzYuMjkuNjIuMjkgMS4xNTQgMCAuNS0uMDk2Ljg2OC0uMjg4IDEuMS0uMTkyLjIzMy0uNDI0LjM1LS42OTcuMzV6bTQuNDc4Ljg3di0xLjIzNWgtMS4yMzRWMjVoMS4yMzR6bS00LjAxNyA5LjEwNWMuNiAwIDEuMDgtLjE0MiAxLjQzNy0uNDI2LjM1Ny0uMjg0LjU5OS0uNzA0LjcyNS0xLjI2MWwtMS4yMTMtLjIwN2MtLjA2MS4zMjYtLjE2Ny41NTUtLjMxNi42ODhhLjgzMi44MzIgMCAwIDEtLjU3Ni4yLjkxNi45MTYgMCAwIDEtLjc1LS4zNDNjLS4xODUtLjIyOC0uMjc4LS42Mi0uMjc4LTEuMTczIDAtLjQ5OC4wOTEtLjg1My4yNzQtMS4wNjYuMTgzLS4yMTIuNDI5LS4zMTguNzM2LS4zMTguMjMyIDAgLjQyLjA2MS41NjUuMTg0LjE0NS4xMjMuMjM4LjMwNi4yOC41NWwxLjIxNi0uMjJjLS4xNDYtLjUwMS0uMzg3LS44NzQtLjcyMi0xLjExOS0uMzM2LS4yNDQtLjc4OC0uMzY2LTEuMzU2LS4zNjYtLjY5NSAwLTEuMjQ1LjIxNC0xLjY1My42NDMtLjQwNy40My0uNjEgMS4wMy0uNjEgMS44IDAgLjc2Mi4yMDIgMS4zNTguNjA4IDEuNzg4LjQwNi40MzEuOTUuNjQ2IDEuNjMzLjY0NnpNMTQuNjMzIDM0di0xLjIzNWgtMS4yMzVWMzRoMS4yMzV6XFxcIi8+PC9zdmc+XCI7XG5cbnZhciBsaXN0U3R5bGVVcHBlckxhdGluSWNvbiA9IFwiPHN2ZyB2aWV3Qm94PVxcXCIwIDAgNDQgNDRcXFwiIHhtbG5zPVxcXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1xcXCI+PHBhdGggZD1cXFwiTTM1IDI5YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3ptMC05YTEgMSAwIDAgMSAxIDF2MWExIDEgMCAwIDEtMSAxSDE4YTEgMSAwIDAgMS0xLTF2LTFhMSAxIDAgMCAxIDEtMWgxN3pcXFwiIGZpbGwtb3BhY2l0eT1cXFwiLjE2M1xcXCIvPjxwYXRoIGQ9XFxcIm03Ljg4IDE1IC41MzItMS40NjNoMi41NzVMMTEuNTQ5IDE1aDEuNDE1bC0yLjU4LTYuNDQySDkuMDFMNi41IDE1aDEuMzh6bTIuNjktMi41NDlIOC44MTFsLjg3LTIuMzkuODg3IDIuMzl6TTE0Ljg4IDE1di0xLjIzNWgtMS4yMzRWMTVoMS4yMzR6TTkuMzUyIDI1Yy44My0uMDA2IDEuMzUyLS4wMiAxLjU2OS0uMDQ0LjM0Ni0uMDM4LjYzNi0uMTQuODcyLS4zMDUuMjM2LS4xNjYuNDIyLS4zODcuNTU4LS42NjQuMTM3LS4yNzcuMjA1LS41NjIuMjA1LS44NTUgMC0uMzcyLS4xMDYtLjY5NS0uMzE3LS45Ny0uMjEtLjI3Ni0uNTEyLS40NzEtLjkwNS0uNTg1YTEuNTEgMS41MSAwIDAgMCAuNjYxLS41NjcgMS41IDEuNSAwIDAgMCAuMjQ0LS44M2MwLS4yOC0uMDY2LS41My0uMTk3LS43NTRhMS42NTQgMS42NTQgMCAwIDAtLjQ5NS0uNTM5IDEuNjc2IDEuNjc2IDAgMCAwLS42NzItLjI2NmMtLjI1LS4wNDItLjYzLS4wNjMtMS4xNC0uMDYzSDcuMTU4VjI1aDIuMTkzem0uMTQyLTMuODhIOC40NnYtMS40OWguNzQ3Yy42MTIgMCAuOTgzLjAwNyAxLjExMi4wMjIuMjE3LjAyNi4zOC4xMDIuNDkuMjI2LjExLjEyNS4xNjUuMjg3LjE2NS40ODZhLjY4LjY4IDAgMCAxLS4xOTIuNTAzLjg2Ljg2IDAgMCAxLS41MjUuMjMgMTEuNDcgMTEuNDcgMCAwIDEtLjk0NC4wMjNoLjE4em0uMTcgMi43OTVIOC40NnYtMS43MjNoMS4wNWMuNTkyIDAgLjk3Ny4wMyAxLjE1NC4wOTIuMTc3LjA2Mi4zMTMuMTYuNDA2LjI5NWEuODQuODQgMCAwIDEgLjE0LjQ5MmMwIC4yMjgtLjA2LjQxLS4xODEuNTQ3YS44MDYuODA2IDAgMCAxLS40NzMuMjU3Yy0uMTI2LjAyNi0uNDIzLjA0LS44OTIuMDR6TTE0Ljg4IDI1di0xLjIzNWgtMS4yMzRWMjVoMS4yMzR6bS01LjAxOCA5LjExYy42OTEgMCAxLjI2Mi0uMTcgMS43MTEtLjUxMi40NS0uMzQxLjc3Mi0uODY0Ljk2NS0xLjU2N2wtMS4yNjEtLjRjLS4xMDkuNDcyLS4yODcuODE4LS41MzYgMS4wMzctLjI1LjIyLS41NDcuMzMtLjg5Mi4zMy0uNDcgMC0uODUtLjE3My0xLjE0My0uNTE5LS4yOTMtLjM0NS0uNDQtLjkyNS0uNDQtMS43NCAwLS43NjcuMTUtMS4zMjIuNDQ3LTEuNjY1LjI5Ny0uMzQzLjY4NC0uNTE0IDEuMTYyLS41MTQuMzQ2IDAgLjY0LjA5Ni44ODEuMjkuMjQyLjE5My40LjQ1Ny40NzcuNzlsMS4yODgtLjMwN2MtLjE0Ny0uNTE2LS4zNjctLjkxMS0uNjYtMS4xODctLjQ5Mi0uNDY1LTEuMTMyLS42OTgtMS45Mi0uNjk4LS45MDIgMC0xLjYzLjI5Ni0yLjE4NC44OS0uNTU0LjU5My0uODMgMS40MjYtLjgzIDIuNDk4IDAgMS4wMTQuMjc1IDEuODEzLjgyNSAyLjM5Ny41NTEuNTg1IDEuMjU0Ljg3NyAyLjExLjg3N3pNMTQuODggMzR2LTEuMjM1aC0xLjIzNFYzNGgxLjIzNHpcXFwiLz48L3N2Zz5cIjtcblxuLyoqXG4gKiBUaGUgbGlzdCBwcm9wZXJ0aWVzIFVJIHBsdWdpbi4gSXQgaW50cm9kdWNlcyB0aGUgZXh0ZW5kZWQgYCdidWxsZXRlZExpc3QnYCBhbmQgYCdudW1iZXJlZExpc3QnYCB0b29sYmFyXG4gKiBidXR0b25zIHRoYXQgYWxsb3cgdXNlcnMgdG8gY29udHJvbCBzdWNoIGFzcGVjdHMgb2YgbGlzdCBhcyB0aGUgbWFya2VyLCBzdGFydCBpbmRleCBvciBvcmRlci5cbiAqXG4gKiAqKk5vdGUqKjogQnV0dG9ucyBpbnRyb2R1Y2VkIGJ5IHRoaXMgcGx1Z2luIG92ZXJyaWRlIGltcGxlbWVudGF0aW9ucyBmcm9tIHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdC9saXN0dWl+TGlzdFVJfVxuICogKGJlY2F1c2UgdGhleSBzaGFyZSB0aGUgc2FtZSBuYW1lcykuXG4gKi8gY2xhc3MgTGlzdFByb3BlcnRpZXNVSSBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGlzdFByb3BlcnRpZXNVSSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IHQgPSBlZGl0b3IubG9jYWxlLnQ7XG4gICAgICAgIGNvbnN0IHByb3BlcnRpZXNDb25maWcgPSBlZGl0b3IuY29uZmlnLmdldCgnbGlzdC5wcm9wZXJ0aWVzJyk7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRDb25maWcgPSBnZXROb3JtYWxpemVkQ29uZmlnKHByb3BlcnRpZXNDb25maWcpO1xuICAgICAgICBjb25zdCBzdHlsZXNMaXN0VHlwZXMgPSBub3JtYWxpemVkQ29uZmlnLnN0eWxlcy5saXN0VHlwZXM7XG4gICAgICAgIC8vIE5vdGU6IFdoZW4gdGhpcyBwbHVnaW4gZG9lcyBub3QgcmVnaXN0ZXIgdGhlIFwiYnVsbGV0ZWRMaXN0XCIgZHJvcGRvd24gZHVlIHRvIHByb3BlcnRpZXMgY29uZmlndXJhdGlvbixcbiAgICAgICAgLy8gYSBzaW1wbGUgYnV0dG9uIHdpbGwgYmUgc3RpbGwgcmVnaXN0ZXJlZCB1bmRlciB0aGUgc2FtZSBuYW1lIGJ5IExpc3RVSSBhcyBhIGZhbGxiYWNrLiBUaGlzIHNob3VsZCBoYXBwZW5cbiAgICAgICAgLy8gaW4gbW9zdCBlZGl0b3IgY29uZmlndXJhdGlvbiBiZWNhdXNlIHRoZSBMaXN0IHBsdWdpbiBhdXRvbWF0aWNhbGx5IHJlcXVpcmVzIExpc3RVSS5cbiAgICAgICAgaWYgKHN0eWxlc0xpc3RUeXBlcy5pbmNsdWRlcygnYnVsbGV0ZWQnKSkge1xuICAgICAgICAgICAgY29uc3Qgc3R5bGVEZWZpbml0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdUb2dnbGUgdGhlIGRpc2MgbGlzdCBzdHlsZScpLFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB0KCdEaXNjJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkaXNjJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogbGlzdFN0eWxlRGlzY0ljb25cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQoJ1RvZ2dsZSB0aGUgY2lyY2xlIGxpc3Qgc3R5bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogdCgnQ2lyY2xlJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBsaXN0U3R5bGVDaXJjbGVJY29uXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdUb2dnbGUgdGhlIHNxdWFyZSBsaXN0IHN0eWxlJyksXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHQoJ1NxdWFyZScpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3F1YXJlJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogbGlzdFN0eWxlU3F1YXJlSWNvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjb25zdCBidXR0b25MYWJlbCA9IHQoJ0J1bGxldGVkIExpc3QnKTtcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlR3JpZEFyaWFMYWJlbCA9IHQoJ0J1bGxldGVkIGxpc3Qgc3R5bGVzIHRvb2xiYXInKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gJ2J1bGxldGVkTGlzdCc7XG4gICAgICAgICAgICBlZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5hZGQoY29tbWFuZE5hbWUsIGdldERyb3Bkb3duVmlld0NyZWF0b3Ioe1xuICAgICAgICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICAgICAgICBub3JtYWxpemVkQ29uZmlnLFxuICAgICAgICAgICAgICAgIHBhcmVudENvbW1hbmROYW1lOiBjb21tYW5kTmFtZSxcbiAgICAgICAgICAgICAgICBidXR0b25MYWJlbCxcbiAgICAgICAgICAgICAgICBidXR0b25JY29uOiBpY29ucy5idWxsZXRlZExpc3QsXG4gICAgICAgICAgICAgICAgc3R5bGVHcmlkQXJpYUxhYmVsLFxuICAgICAgICAgICAgICAgIHN0eWxlRGVmaW5pdGlvbnNcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIEFkZCB0aGUgbWVudSBiYXIgaXRlbSBmb3IgYnVsbGV0ZWQgbGlzdC5cbiAgICAgICAgICAgIGVkaXRvci51aS5jb21wb25lbnRGYWN0b3J5LmFkZChgbWVudUJhcjoke2NvbW1hbmROYW1lfWAsIGdldE1lbnVCYXJTdHlsZXNNZW51Q3JlYXRvcih7XG4gICAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRDb25maWcsXG4gICAgICAgICAgICAgICAgcGFyZW50Q29tbWFuZE5hbWU6IGNvbW1hbmROYW1lLFxuICAgICAgICAgICAgICAgIGJ1dHRvbkxhYmVsLFxuICAgICAgICAgICAgICAgIHN0eWxlR3JpZEFyaWFMYWJlbCxcbiAgICAgICAgICAgICAgICBzdHlsZURlZmluaXRpb25zXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm90ZTogV2hlbiB0aGlzIHBsdWdpbiBkb2VzIG5vdCByZWdpc3RlciB0aGUgXCJudW1iZXJlZExpc3RcIiBkcm9wZG93biBkdWUgdG8gcHJvcGVydGllcyBjb25maWd1cmF0aW9uLFxuICAgICAgICAvLyBhIHNpbXBsZSBidXR0b24gd2lsbCBiZSBzdGlsbCByZWdpc3RlcmVkIHVuZGVyIHRoZSBzYW1lIG5hbWUgYnkgTGlzdFVJIGFzIGEgZmFsbGJhY2suIFRoaXMgc2hvdWxkIGhhcHBlblxuICAgICAgICAvLyBpbiBtb3N0IGVkaXRvciBjb25maWd1cmF0aW9uIGJlY2F1c2UgdGhlIExpc3QgcGx1Z2luIGF1dG9tYXRpY2FsbHkgcmVxdWlyZXMgTGlzdFVJLlxuICAgICAgICBpZiAoc3R5bGVzTGlzdFR5cGVzLmluY2x1ZGVzKCdudW1iZXJlZCcpIHx8IHByb3BlcnRpZXNDb25maWcuc3RhcnRJbmRleCB8fCBwcm9wZXJ0aWVzQ29uZmlnLnJldmVyc2VkKSB7XG4gICAgICAgICAgICBjb25zdCBzdHlsZURlZmluaXRpb25zID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQoJ1RvZ2dsZSB0aGUgZGVjaW1hbCBsaXN0IHN0eWxlJyksXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHQoJ0RlY2ltYWwnKSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RlY2ltYWwnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBsaXN0U3R5bGVEZWNpbWFsSWNvblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnVG9nZ2xlIHRoZSBkZWNpbWFsIHdpdGggbGVhZGluZyB6ZXJvIGxpc3Qgc3R5bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogdCgnRGVjaW1hbCB3aXRoIGxlYWRpbmcgemVybycpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGVjaW1hbC1sZWFkaW5nLXplcm8nLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBsaXN0U3R5bGVEZWNpbWFsV2l0aExlYWRpbmdaZXJvSWNvblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnVG9nZ2xlIHRoZSBsb3dlcuKAk3JvbWFuIGxpc3Qgc3R5bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogdCgnTG93ZXLigJNyb21hbicpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbG93ZXItcm9tYW4nLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBsaXN0U3R5bGVMb3dlclJvbWFuSWNvblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbDogdCgnVG9nZ2xlIHRoZSB1cHBlcuKAk3JvbWFuIGxpc3Qgc3R5bGUnKSxcbiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcDogdCgnVXBwZXItcm9tYW4nKSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VwcGVyLXJvbWFuJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogbGlzdFN0eWxlVXBwZXJSb21hbkljb25cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHQoJ1RvZ2dsZSB0aGUgbG93ZXLigJNsYXRpbiBsaXN0IHN0eWxlJyksXG4gICAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHQoJ0xvd2VyLWxhdGluJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsb3dlci1sYXRpbicsXG4gICAgICAgICAgICAgICAgICAgIGljb246IGxpc3RTdHlsZUxvd2VyTGF0aW5JY29uXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdUb2dnbGUgdGhlIHVwcGVy4oCTbGF0aW4gbGlzdCBzdHlsZScpLFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB0KCdVcHBlci1sYXRpbicpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndXBwZXItbGF0aW4nLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBsaXN0U3R5bGVVcHBlckxhdGluSWNvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBjb25zdCBidXR0b25MYWJlbCA9IHQoJ051bWJlcmVkIExpc3QnKTtcbiAgICAgICAgICAgIGNvbnN0IHN0eWxlR3JpZEFyaWFMYWJlbCA9IHQoJ051bWJlcmVkIGxpc3Qgc3R5bGVzIHRvb2xiYXInKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbW1hbmROYW1lID0gJ251bWJlcmVkTGlzdCc7XG4gICAgICAgICAgICBlZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5hZGQoY29tbWFuZE5hbWUsIGdldERyb3Bkb3duVmlld0NyZWF0b3Ioe1xuICAgICAgICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICAgICAgICBub3JtYWxpemVkQ29uZmlnLFxuICAgICAgICAgICAgICAgIHBhcmVudENvbW1hbmROYW1lOiBjb21tYW5kTmFtZSxcbiAgICAgICAgICAgICAgICBidXR0b25MYWJlbCxcbiAgICAgICAgICAgICAgICBidXR0b25JY29uOiBpY29ucy5udW1iZXJlZExpc3QsXG4gICAgICAgICAgICAgICAgc3R5bGVHcmlkQXJpYUxhYmVsLFxuICAgICAgICAgICAgICAgIHN0eWxlRGVmaW5pdGlvbnNcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIE1lbnUgYmFyIG1lbnUgZG9lcyBub3QgZGlzcGxheSBsaXN0IHN0YXJ0IGluZGV4IG9yIHJldmVyc2UgVUkuIElmIHRoZXJlIGFyZSBubyBzdHlsZXMgZW5hYmxlZCxcbiAgICAgICAgICAgIC8vIHRoZSBtZW51IG1ha2VzIG5vIHNlbnNlIGFuZCBzaG91bGQgYmUgb21pdHRlZC5cbiAgICAgICAgICAgIGlmIChzdHlsZXNMaXN0VHlwZXMuaW5jbHVkZXMoJ251bWJlcmVkJykpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IudWkuY29tcG9uZW50RmFjdG9yeS5hZGQoYG1lbnVCYXI6JHtjb21tYW5kTmFtZX1gLCBnZXRNZW51QmFyU3R5bGVzTWVudUNyZWF0b3Ioe1xuICAgICAgICAgICAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRDb25maWcsXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENvbW1hbmROYW1lOiBjb21tYW5kTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uTGFiZWwsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlR3JpZEFyaWFMYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVEZWZpbml0aW9uc1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQSBoZWxwZXIgdGhhdCByZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgc3BsaXQgYnV0dG9uIHdpdGggYSB0b29sYmFyIGluIHRoZSBkcm9wZG93bixcbiAqIHdoaWNoIGluIHR1cm4gY29udGFpbnMgYnV0dG9ucyBhbGxvd2luZyB1c2VycyB0byBjaGFuZ2UgbGlzdCBzdHlsZXMgaW4gdGhlIGNvbnRleHQgb2YgdGhlIGN1cnJlbnQgc2VsZWN0aW9uLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zLmVkaXRvclxuICogQHBhcmFtIG9wdGlvbnMubm9ybWFsaXplZENvbmZpZyBMaXN0IHByb3BlcnRpZXMgY29uZmlndXJhdGlvbi5cbiAqIEBwYXJhbSBvcHRpb25zLnBhcmVudENvbW1hbmROYW1lIFRoZSBuYW1lIG9mIHRoZSBoaWdoZXItb3JkZXIgZWRpdG9yIGNvbW1hbmQgYXNzb2NpYXRlZCB3aXRoXG4gKiB0aGUgc2V0IG9mIHBhcnRpY3VsYXIgbGlzdCBzdHlsZXMgKGUuZy4gXCJidWxsZXRlZExpc3RcIiBmb3IgXCJkaXNjXCIsIFwiY2lyY2xlXCIsIGFuZCBcInNxdWFyZVwiIHN0eWxlcykuXG4gKiBAcGFyYW0gb3B0aW9ucy5idXR0b25MYWJlbCBMYWJlbCBvZiB0aGUgbWFpbiBwYXJ0IG9mIHRoZSBzcGxpdCBidXR0b24uXG4gKiBAcGFyYW0gb3B0aW9ucy5idXR0b25JY29uIFRoZSBTVkcgc3RyaW5nIG9mIGFuIGljb24gZm9yIHRoZSBtYWluIHBhcnQgb2YgdGhlIHNwbGl0IGJ1dHRvbi5cbiAqIEBwYXJhbSBvcHRpb25zLnN0eWxlR3JpZEFyaWFMYWJlbCBUaGUgQVJJQSBsYWJlbCBmb3IgdGhlIHN0eWxlcyBncmlkIGluIHRoZSBzcGxpdCBidXR0b24gZHJvcGRvd24uXG4gKiBAcGFyYW0gb3B0aW9ucy5zdHlsZURlZmluaXRpb25zIERlZmluaXRpb25zIG9mIHRoZSBzdHlsZSBidXR0b25zLlxuICogQHJldHVybnMgQSBmdW5jdGlvbiB0aGF0IGNhbiBiZSBwYXNzZWQgc3RyYWlnaHQgaW50byB7QGxpbmsgbW9kdWxlOnVpL2NvbXBvbmVudGZhY3Rvcnl+Q29tcG9uZW50RmFjdG9yeSNhZGR9LlxuICovIGZ1bmN0aW9uIGdldERyb3Bkb3duVmlld0NyZWF0b3IoeyBlZGl0b3IsIG5vcm1hbGl6ZWRDb25maWcsIHBhcmVudENvbW1hbmROYW1lLCBidXR0b25MYWJlbCwgYnV0dG9uSWNvbiwgc3R5bGVHcmlkQXJpYUxhYmVsLCBzdHlsZURlZmluaXRpb25zIH0pIHtcbiAgICBjb25zdCBwYXJlbnRDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldChwYXJlbnRDb21tYW5kTmFtZSk7XG4gICAgcmV0dXJuIChsb2NhbGUpPT57XG4gICAgICAgIGNvbnN0IGRyb3Bkb3duVmlldyA9IGNyZWF0ZURyb3Bkb3duKGxvY2FsZSwgU3BsaXRCdXR0b25WaWV3KTtcbiAgICAgICAgY29uc3QgbWFpbkJ1dHRvblZpZXcgPSBkcm9wZG93blZpZXcuYnV0dG9uVmlldztcbiAgICAgICAgZHJvcGRvd25WaWV3LmJpbmQoJ2lzRW5hYmxlZCcpLnRvKHBhcmVudENvbW1hbmQpO1xuICAgICAgICBkcm9wZG93blZpZXcuY2xhc3MgPSAnY2stbGlzdC1zdHlsZXMtZHJvcGRvd24nO1xuICAgICAgICAvLyBNYWluIGJ1dHRvbiB3YXMgY2xpY2tlZC5cbiAgICAgICAgbWFpbkJ1dHRvblZpZXcub24oJ2V4ZWN1dGUnLCAoKT0+e1xuICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUocGFyZW50Q29tbWFuZE5hbWUpO1xuICAgICAgICAgICAgZWRpdG9yLmVkaXRpbmcudmlldy5mb2N1cygpO1xuICAgICAgICB9KTtcbiAgICAgICAgbWFpbkJ1dHRvblZpZXcuc2V0KHtcbiAgICAgICAgICAgIGxhYmVsOiBidXR0b25MYWJlbCxcbiAgICAgICAgICAgIGljb246IGJ1dHRvbkljb24sXG4gICAgICAgICAgICB0b29sdGlwOiB0cnVlLFxuICAgICAgICAgICAgaXNUb2dnbGVhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBtYWluQnV0dG9uVmlldy5iaW5kKCdpc09uJykudG8ocGFyZW50Q29tbWFuZCwgJ3ZhbHVlJywgKHZhbHVlKT0+ISF2YWx1ZSk7XG4gICAgICAgIGRyb3Bkb3duVmlldy5vbmNlKCdjaGFuZ2U6aXNPcGVuJywgKCk9PntcbiAgICAgICAgICAgIGNvbnN0IGxpc3RQcm9wZXJ0aWVzVmlldyA9IGNyZWF0ZUxpc3RQcm9wZXJ0aWVzVmlldyh7XG4gICAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRDb25maWcsXG4gICAgICAgICAgICAgICAgZHJvcGRvd25WaWV3LFxuICAgICAgICAgICAgICAgIHBhcmVudENvbW1hbmROYW1lLFxuICAgICAgICAgICAgICAgIHN0eWxlR3JpZEFyaWFMYWJlbCxcbiAgICAgICAgICAgICAgICBzdHlsZURlZmluaXRpb25zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRyb3Bkb3duVmlldy5wYW5lbFZpZXcuY2hpbGRyZW4uYWRkKGxpc3RQcm9wZXJ0aWVzVmlldyk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBGb2N1cyB0aGUgZWRpdGFibGUgYWZ0ZXIgZXhlY3V0aW5nIHRoZSBjb21tYW5kLlxuICAgICAgICAvLyBPdmVycmlkZXMgYSBkZWZhdWx0IGJlaGF2aW91ciB3aGVyZSB0aGUgZm9jdXMgaXMgbW92ZWQgdG8gdGhlIGRyb3Bkb3duIGJ1dHRvbiAoIzEyMTI1KS5cbiAgICAgICAgZHJvcGRvd25WaWV3Lm9uKCdleGVjdXRlJywgKCk9PntcbiAgICAgICAgICAgIGVkaXRvci5lZGl0aW5nLnZpZXcuZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkcm9wZG93blZpZXc7XG4gICAgfTtcbn1cbi8qKlxuICogQSBoZWxwZXIgdGhhdCByZXR1cm5zIGEgZnVuY3Rpb24gKGZhY3RvcnkpIHRoYXQgY3JlYXRlcyBpbmRpdmlkdWFsIGJ1dHRvbnMgdXNlZCBieSB1c2VycyB0byBjaGFuZ2Ugc3R5bGVzXG4gKiBvZiBsaXN0cy5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucy5lZGl0b3JcbiAqIEBwYXJhbSBvcHRpb25zLmxpc3RTdHlsZUNvbW1hbmQgVGhlIGluc3RhbmNlIG9mIHRoZSBgTGlzdFN0eWxlc0NvbW1hbmRgIGNsYXNzLlxuICogQHBhcmFtIG9wdGlvbnMucGFyZW50Q29tbWFuZE5hbWUgVGhlIG5hbWUgb2YgdGhlIGhpZ2hlci1vcmRlciBjb21tYW5kIGFzc29jaWF0ZWQgd2l0aCBhXG4gKiBwYXJ0aWN1bGFyIGxpc3Qgc3R5bGUgKGUuZy4gXCJidWxsZXRlZExpc3RcIiBpcyBhc3NvY2lhdGVkIHdpdGggXCJzcXVhcmVcIiBhbmQgXCJudW1iZXJlZExpc3RcIiBpcyBhc3NvY2lhdGVkIHdpdGggXCJyb21hblwiKS5cbiAqIEByZXR1cm5zIEEgZnVuY3Rpb24gdGhhdCBjYW4gYmUgcGFzc2VkIHN0cmFpZ2h0IGludG8ge0BsaW5rIG1vZHVsZTp1aS9jb21wb25lbnRmYWN0b3J5fkNvbXBvbmVudEZhY3RvcnkjYWRkfS5cbiAqLyBmdW5jdGlvbiBnZXRTdHlsZUJ1dHRvbkNyZWF0b3IoeyBlZGl0b3IsIGxpc3RTdHlsZUNvbW1hbmQsIHBhcmVudENvbW1hbmROYW1lIH0pIHtcbiAgICBjb25zdCBsb2NhbGUgPSBlZGl0b3IubG9jYWxlO1xuICAgIGNvbnN0IHBhcmVudENvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KHBhcmVudENvbW1hbmROYW1lKTtcbiAgICByZXR1cm4gKHsgbGFiZWwsIHR5cGUsIGljb24sIHRvb2x0aXAgfSk9PntcbiAgICAgICAgY29uc3QgYnV0dG9uID0gbmV3IEJ1dHRvblZpZXcobG9jYWxlKTtcbiAgICAgICAgYnV0dG9uLnNldCh7XG4gICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgIGljb24sXG4gICAgICAgICAgICB0b29sdGlwXG4gICAgICAgIH0pO1xuICAgICAgICBidXR0b24uYmluZCgnaXNPbicpLnRvKGxpc3RTdHlsZUNvbW1hbmQsICd2YWx1ZScsICh2YWx1ZSk9PnZhbHVlID09PSB0eXBlKTtcbiAgICAgICAgYnV0dG9uLm9uKCdleGVjdXRlJywgKCk9PntcbiAgICAgICAgICAgIC8vIElmIHRoZSBjb250ZW50IHRoZSBzZWxlY3Rpb24gaXMgYW5jaG9yZWQgdG8gaXMgYSBsaXN0LCBsZXQncyBjaGFuZ2UgaXRzIHN0eWxlLlxuICAgICAgICAgICAgaWYgKHBhcmVudENvbW1hbmQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGxpc3Qgd2hlbiB0aGUgY3VycmVudCBsaXN0IHN0eWxlIGlzIHRoZSBzYW1lIGFzIHRoZSBvbmUgdGhhdCB3b3VsZCBub3JtYWxseSBiZSBhcHBsaWVkLlxuICAgICAgICAgICAgICAgIGlmIChsaXN0U3R5bGVDb21tYW5kLnZhbHVlID09PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKHBhcmVudENvbW1hbmROYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxpc3RTdHlsZUNvbW1hbmQudmFsdWUgIT09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ2xpc3RTdHlsZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCgpPT57XG4gICAgICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdsaXN0U3R5bGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9O1xufVxuLyoqXG4gKiBBIGhlbHBlciB0aGF0IGNyZWF0ZXMgdGhlIHByb3BlcnRpZXMgdmlldyBmb3IgdGhlIGluZGl2aWR1YWwgc3R5bGUgZHJvcGRvd24uXG4gKlxuICogQHBhcmFtIG9wdGlvbnMuZWRpdG9yIEVkaXRvciBpbnN0YW5jZS5cbiAqIEBwYXJhbSBvcHRpb25zLm5vcm1hbGl6ZWRDb25maWcgTGlzdCBwcm9wZXJ0aWVzIGNvbmZpZ3VyYXRpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5kcm9wZG93blZpZXcgU3R5bGVzIGRyb3Bkb3duIHZpZXcgdGhhdCBob3N0cyB0aGUgcHJvcGVydGllcyB2aWV3LlxuICogQHBhcmFtIG9wdGlvbnMucGFyZW50Q29tbWFuZE5hbWUgVGhlIG5hbWUgb2YgdGhlIGhpZ2hlci1vcmRlciBlZGl0b3IgY29tbWFuZCBhc3NvY2lhdGVkIHdpdGhcbiAqIHRoZSBzZXQgb2YgcGFydGljdWxhciBsaXN0IHN0eWxlcyAoZS5nLiBcImJ1bGxldGVkTGlzdFwiIGZvciBcImRpc2NcIiwgXCJjaXJjbGVcIiwgYW5kIFwic3F1YXJlXCIgc3R5bGVzKS5cbiAqIEBwYXJhbSBvcHRpb25zLnN0eWxlRGVmaW5pdGlvbnMgRGVmaW5pdGlvbnMgb2YgdGhlIHN0eWxlIGJ1dHRvbnMuXG4gKiBAcGFyYW0gb3B0aW9ucy5zdHlsZUdyaWRBcmlhTGFiZWwgQW4gYXNzaXN0aXZlIHRlY2hub2xvZ2llcyBsYWJlbCBzZXQgb24gdGhlIGdyaWQgb2Ygc3R5bGVzIChpZiB0aGUgZ3JpZCBpcyByZW5kZXJlZCkuXG4gKi8gZnVuY3Rpb24gY3JlYXRlTGlzdFByb3BlcnRpZXNWaWV3KHsgZWRpdG9yLCBub3JtYWxpemVkQ29uZmlnLCBkcm9wZG93blZpZXcsIHBhcmVudENvbW1hbmROYW1lLCBzdHlsZURlZmluaXRpb25zLCBzdHlsZUdyaWRBcmlhTGFiZWwgfSkge1xuICAgIGNvbnN0IGxvY2FsZSA9IGVkaXRvci5sb2NhbGU7XG4gICAgY29uc3QgZW5hYmxlZFByb3BlcnRpZXMgPSB7XG4gICAgICAgIC4uLm5vcm1hbGl6ZWRDb25maWcsXG4gICAgICAgIC4uLnBhcmVudENvbW1hbmROYW1lICE9ICdudW1iZXJlZExpc3QnID8ge1xuICAgICAgICAgICAgc3RhcnRJbmRleDogZmFsc2UsXG4gICAgICAgICAgICByZXZlcnNlZDogZmFsc2VcbiAgICAgICAgfSA6IG51bGxcbiAgICB9O1xuICAgIGNvbnN0IGxpc3RUeXBlID0gcGFyZW50Q29tbWFuZE5hbWUucmVwbGFjZSgnTGlzdCcsICcnKTtcbiAgICBsZXQgc3R5bGVCdXR0b25WaWV3cyA9IG51bGw7XG4gICAgaWYgKG5vcm1hbGl6ZWRDb25maWcuc3R5bGVzLmxpc3RUeXBlcy5pbmNsdWRlcyhsaXN0VHlwZSkpIHtcbiAgICAgICAgY29uc3QgbGlzdFN0eWxlQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpc3RTdHlsZScpO1xuICAgICAgICBjb25zdCBzdHlsZUJ1dHRvbkNyZWF0b3IgPSBnZXRTdHlsZUJ1dHRvbkNyZWF0b3Ioe1xuICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgcGFyZW50Q29tbWFuZE5hbWUsXG4gICAgICAgICAgICBsaXN0U3R5bGVDb21tYW5kXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWd1cmVkTGlzdFN0eWxlc1R5cGVzID0gbm9ybWFsaXplZENvbmZpZy5zdHlsZXMubGlzdFN0eWxlVHlwZXM7XG4gICAgICAgIGxldCBmaWx0ZXJlZERlZmluaXRpb25zID0gc3R5bGVEZWZpbml0aW9ucztcbiAgICAgICAgaWYgKGNvbmZpZ3VyZWRMaXN0U3R5bGVzVHlwZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IGNvbmZpZ3VyZWRMaXN0U3R5bGVzVHlwZXNbbGlzdFR5cGVdO1xuICAgICAgICAgICAgaWYgKGFsbG93ZWRUeXBlcykge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkRGVmaW5pdGlvbnMgPSBzdHlsZURlZmluaXRpb25zLmZpbHRlcigoZGVmKT0+YWxsb3dlZFR5cGVzLmluY2x1ZGVzKGRlZi50eXBlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNTdHlsZVR5cGVTdXBwb3J0ZWQgPSBnZXRTdHlsZVR5cGVTdXBwb3J0Q2hlY2tlcihsaXN0U3R5bGVDb21tYW5kKTtcbiAgICAgICAgc3R5bGVCdXR0b25WaWV3cyA9IGZpbHRlcmVkRGVmaW5pdGlvbnMuZmlsdGVyKGlzU3R5bGVUeXBlU3VwcG9ydGVkKS5tYXAoc3R5bGVCdXR0b25DcmVhdG9yKTtcbiAgICB9XG4gICAgY29uc3QgbGlzdFByb3BlcnRpZXNWaWV3ID0gbmV3IExpc3RQcm9wZXJ0aWVzVmlldyhsb2NhbGUsIHtcbiAgICAgICAgc3R5bGVHcmlkQXJpYUxhYmVsLFxuICAgICAgICBlbmFibGVkUHJvcGVydGllcyxcbiAgICAgICAgc3R5bGVCdXR0b25WaWV3c1xuICAgIH0pO1xuICAgIGlmIChub3JtYWxpemVkQ29uZmlnLnN0eWxlcy5saXN0VHlwZXMuaW5jbHVkZXMobGlzdFR5cGUpKSB7XG4gICAgICAgIC8vIEFjY2Vzc2liaWxpdHk6IGZvY3VzIHRoZSBmaXJzdCBhY3RpdmUgc3R5bGUgd2hlbiBvcGVuaW5nIHRoZSBkcm9wZG93bi5cbiAgICAgICAgZm9jdXNDaGlsZE9uRHJvcGRvd25PcGVuKGRyb3Bkb3duVmlldywgKCk9PntcbiAgICAgICAgICAgIHJldHVybiBsaXN0UHJvcGVydGllc1ZpZXcuc3R5bGVzVmlldy5jaGlsZHJlbi5maW5kKChjaGlsZCk9PmNoaWxkLmlzT24pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVuYWJsZWRQcm9wZXJ0aWVzLnN0YXJ0SW5kZXgpIHtcbiAgICAgICAgY29uc3QgbGlzdFN0YXJ0Q29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpc3RTdGFydCcpO1xuICAgICAgICBsaXN0UHJvcGVydGllc1ZpZXcuc3RhcnRJbmRleEZpZWxkVmlldy5iaW5kKCdpc0VuYWJsZWQnKS50byhsaXN0U3RhcnRDb21tYW5kKTtcbiAgICAgICAgbGlzdFByb3BlcnRpZXNWaWV3LnN0YXJ0SW5kZXhGaWVsZFZpZXcuZmllbGRWaWV3LmJpbmQoJ3ZhbHVlJykudG8obGlzdFN0YXJ0Q29tbWFuZCk7XG4gICAgICAgIGxpc3RQcm9wZXJ0aWVzVmlldy5vbignbGlzdFN0YXJ0JywgKGV2dCwgZGF0YSk9PmVkaXRvci5leGVjdXRlKCdsaXN0U3RhcnQnLCBkYXRhKSk7XG4gICAgfVxuICAgIGlmIChlbmFibGVkUHJvcGVydGllcy5yZXZlcnNlZCkge1xuICAgICAgICBjb25zdCBsaXN0UmV2ZXJzZWRDb21tYW5kID0gZWRpdG9yLmNvbW1hbmRzLmdldCgnbGlzdFJldmVyc2VkJyk7XG4gICAgICAgIGxpc3RQcm9wZXJ0aWVzVmlldy5yZXZlcnNlZFN3aXRjaEJ1dHRvblZpZXcuYmluZCgnaXNFbmFibGVkJykudG8obGlzdFJldmVyc2VkQ29tbWFuZCk7XG4gICAgICAgIGxpc3RQcm9wZXJ0aWVzVmlldy5yZXZlcnNlZFN3aXRjaEJ1dHRvblZpZXcuYmluZCgnaXNPbicpLnRvKGxpc3RSZXZlcnNlZENvbW1hbmQsICd2YWx1ZScsICh2YWx1ZSk9PiEhdmFsdWUpO1xuICAgICAgICBsaXN0UHJvcGVydGllc1ZpZXcub24oJ2xpc3RSZXZlcnNlZCcsICgpPT57XG4gICAgICAgICAgICBjb25zdCBpc1JldmVyc2VkID0gbGlzdFJldmVyc2VkQ29tbWFuZC52YWx1ZTtcbiAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdsaXN0UmV2ZXJzZWQnLCB7XG4gICAgICAgICAgICAgICAgcmV2ZXJzZWQ6ICFpc1JldmVyc2VkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIE1ha2Ugc3VyZSBhcHBseWluZyBzdHlsZXMgY2xvc2VzIHRoZSBkcm9wZG93bi5cbiAgICBsaXN0UHJvcGVydGllc1ZpZXcuZGVsZWdhdGUoJ2V4ZWN1dGUnKS50byhkcm9wZG93blZpZXcpO1xuICAgIHJldHVybiBsaXN0UHJvcGVydGllc1ZpZXc7XG59XG4vKipcbiAqIEEgaGVscGVyIHRoYXQgY3JlYXRlcyB0aGUgbGlzdCBzdHlsZSBzdWJtZW51IGZvciBtZW51IGJhci5cbiAqXG4gKiBAcGFyYW0gZWRpdG9yIEVkaXRvciBpbnN0YW5jZS5cbiAqIEBwYXJhbSBub3JtYWxpemVkQ29uZmlnIExpc3QgcHJvcGVydGllcyBjb25maWd1cmF0aW9uLlxuICogQHBhcmFtIHBhcmVudENvbW1hbmROYW1lIE5hbWUgb2YgdGhlIGxpc3QgY29tbWFuZC5cbiAqIEBwYXJhbSBidXR0b25MYWJlbCBMYWJlbCBvZiB0aGUgbWVudSBidXR0b24uXG4gKiBAcGFyYW0gc3R5bGVHcmlkQXJpYUxhYmVsIEFSSUEgbGFiZWwgb2YgdGhlIHN0eWxlcyBncmlkLlxuICovIGZ1bmN0aW9uIGdldE1lbnVCYXJTdHlsZXNNZW51Q3JlYXRvcih7IGVkaXRvciwgbm9ybWFsaXplZENvbmZpZywgcGFyZW50Q29tbWFuZE5hbWUsIGJ1dHRvbkxhYmVsLCBzdHlsZUdyaWRBcmlhTGFiZWwsIHN0eWxlRGVmaW5pdGlvbnMgfSkge1xuICAgIHJldHVybiAobG9jYWxlKT0+e1xuICAgICAgICBjb25zdCBtZW51VmlldyA9IG5ldyBNZW51QmFyTWVudVZpZXcobG9jYWxlKTtcbiAgICAgICAgY29uc3QgbGlzdENvbW1hbmQgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KHBhcmVudENvbW1hbmROYW1lKTtcbiAgICAgICAgY29uc3QgbGlzdFN0eWxlQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ2xpc3RTdHlsZScpO1xuICAgICAgICBjb25zdCBpc1N0eWxlVHlwZVN1cHBvcnRlZCA9IGdldFN0eWxlVHlwZVN1cHBvcnRDaGVja2VyKGxpc3RTdHlsZUNvbW1hbmQpO1xuICAgICAgICBjb25zdCBzdHlsZUJ1dHRvbkNyZWF0b3IgPSBnZXRTdHlsZUJ1dHRvbkNyZWF0b3Ioe1xuICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgcGFyZW50Q29tbWFuZE5hbWUsXG4gICAgICAgICAgICBsaXN0U3R5bGVDb21tYW5kXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWd1cmVkTGlzdFN0eWxlc1R5cGVzID0gbm9ybWFsaXplZENvbmZpZy5zdHlsZXMubGlzdFN0eWxlVHlwZXM7XG4gICAgICAgIGxldCBmaWx0ZXJlZERlZmluaXRpb25zID0gc3R5bGVEZWZpbml0aW9ucztcbiAgICAgICAgaWYgKGNvbmZpZ3VyZWRMaXN0U3R5bGVzVHlwZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RUeXBlID0gbGlzdENvbW1hbmQudHlwZTtcbiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IGNvbmZpZ3VyZWRMaXN0U3R5bGVzVHlwZXNbbGlzdFR5cGVdO1xuICAgICAgICAgICAgaWYgKGFsbG93ZWRUeXBlcykge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkRGVmaW5pdGlvbnMgPSBzdHlsZURlZmluaXRpb25zLmZpbHRlcigoZGVmKT0+YWxsb3dlZFR5cGVzLmluY2x1ZGVzKGRlZi50eXBlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3R5bGVCdXR0b25WaWV3cyA9IGZpbHRlcmVkRGVmaW5pdGlvbnMuZmlsdGVyKGlzU3R5bGVUeXBlU3VwcG9ydGVkKS5tYXAoc3R5bGVCdXR0b25DcmVhdG9yKTtcbiAgICAgICAgY29uc3QgbGlzdFByb3BlcnRpZXNWaWV3ID0gbmV3IExpc3RQcm9wZXJ0aWVzVmlldyhsb2NhbGUsIHtcbiAgICAgICAgICAgIHN0eWxlR3JpZEFyaWFMYWJlbCxcbiAgICAgICAgICAgIGVuYWJsZWRQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgLi4ubm9ybWFsaXplZENvbmZpZyxcbiAgICAgICAgICAgICAgICAvLyBEaXNhYmxlIGxpc3Qgc3RhcnQgaW5kZXggYW5kIHJldmVyc2VkIGluIHRoZSBtZW51IGJhci5cbiAgICAgICAgICAgICAgICBzdGFydEluZGV4OiBmYWxzZSxcbiAgICAgICAgICAgICAgICByZXZlcnNlZDogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdHlsZUJ1dHRvblZpZXdzXG4gICAgICAgIH0pO1xuICAgICAgICBsaXN0UHJvcGVydGllc1ZpZXcuZGVsZWdhdGUoJ2V4ZWN1dGUnKS50byhtZW51Vmlldyk7XG4gICAgICAgIG1lbnVWaWV3LmJ1dHRvblZpZXcuc2V0KHtcbiAgICAgICAgICAgIGxhYmVsOiBidXR0b25MYWJlbCxcbiAgICAgICAgICAgIGljb246IGljb25zW3BhcmVudENvbW1hbmROYW1lXVxuICAgICAgICB9KTtcbiAgICAgICAgbWVudVZpZXcucGFuZWxWaWV3LmNoaWxkcmVuLmFkZChsaXN0UHJvcGVydGllc1ZpZXcpO1xuICAgICAgICBtZW51Vmlldy5iaW5kKCdpc0VuYWJsZWQnKS50byhsaXN0Q29tbWFuZCwgJ2lzRW5hYmxlZCcpO1xuICAgICAgICBtZW51Vmlldy5vbignZXhlY3V0ZScsICgpPT57XG4gICAgICAgICAgICBlZGl0b3IuZWRpdGluZy52aWV3LmZvY3VzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVudVZpZXc7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldFN0eWxlVHlwZVN1cHBvcnRDaGVja2VyKGxpc3RTdHlsZUNvbW1hbmQpIHtcbiAgICBpZiAodHlwZW9mIGxpc3RTdHlsZUNvbW1hbmQuaXNTdHlsZVR5cGVTdXBwb3J0ZWQgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gKHN0eWxlRGVmaW5pdGlvbik9Pmxpc3RTdHlsZUNvbW1hbmQuaXNTdHlsZVR5cGVTdXBwb3J0ZWQoc3R5bGVEZWZpbml0aW9uLnR5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoKT0+dHJ1ZTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3QgcHJvcGVydGllcyBmZWF0dXJlLlxuICpcbiAqIFRoaXMgaXMgYSBcImdsdWVcIiBwbHVnaW4gdGhhdCBsb2FkcyB0aGVcbiAqIHtAbGluayBtb2R1bGU6bGlzdC9saXN0cHJvcGVydGllcy9saXN0cHJvcGVydGllc2VkaXRpbmd+TGlzdFByb3BlcnRpZXNFZGl0aW5nIGxpc3QgcHJvcGVydGllc1xuICogZWRpdGluZyBmZWF0dXJlfSBhbmQgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9saXN0cHJvcGVydGllcy9saXN0cHJvcGVydGllc3Vpfkxpc3RQcm9wZXJ0aWVzVUkgbGlzdCBwcm9wZXJ0aWVzIFVJIGZlYXR1cmV9LlxuICovIGNsYXNzIExpc3RQcm9wZXJ0aWVzIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMaXN0UHJvcGVydGllc0VkaXRpbmcsXG4gICAgICAgICAgICBMaXN0UHJvcGVydGllc1VJXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xpc3RQcm9wZXJ0aWVzJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgY2hlY2sgdG8tZG8gY29tbWFuZC5cbiAqXG4gKiBUaGUgY29tbWFuZCBpcyByZWdpc3RlcmVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvdG9kb2xpc3QvdG9kb2xpc3RlZGl0aW5nflRvZG9MaXN0RWRpdGluZ30gYXNcbiAqIHRoZSBgY2hlY2tUb2RvTGlzdGAgZWRpdG9yIGNvbW1hbmQuXG4gKi8gY2xhc3MgQ2hlY2tUb2RvTGlzdENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNvbnN0cnVjdG9yKGVkaXRvcil7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIC8vIFJlZnJlc2ggY29tbWFuZCBiZWZvcmUgZXhlY3V0aW5nIHRvIGJlIHN1cmUgYWxsIHZhbHVlcyBhcmUgdXAgdG8gZGF0ZS5cbiAgICAgICAgLy8gSXQgaXMgbmVlZGVkIHdoZW4gc2VsZWN0aW9uIGhhcyBjaGFuZ2VkIGJlZm9yZSBjb21tYW5kIGV4ZWN1dGlvbiwgaW4gdGhlIHNhbWUgY2hhbmdlIGJsb2NrLlxuICAgICAgICB0aGlzLm9uKCdleGVjdXRlJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogVXBkYXRlcyB0aGUgY29tbWFuZCdzIHtAbGluayAjdmFsdWV9IGFuZCB7QGxpbmsgI2lzRW5hYmxlZH0gcHJvcGVydGllcyBiYXNlZCBvbiB0aGUgY3VycmVudCBzZWxlY3Rpb24uXG5cdCAqLyByZWZyZXNoKCkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnRzID0gdGhpcy5fZ2V0U2VsZWN0ZWRJdGVtcygpO1xuICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5fZ2V0VmFsdWUoc2VsZWN0ZWRFbGVtZW50cyk7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gISFzZWxlY3RlZEVsZW1lbnRzLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4ZWN1dGVzIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5mb3JjZVZhbHVlIElmIHNldCwgaXQgd2lsbCBmb3JjZSB0aGUgY29tbWFuZCBiZWhhdmlvci4gSWYgYHRydWVgLCB0aGUgY29tbWFuZCB3aWxsIGFwcGx5XG5cdCAqIHRoZSBhdHRyaWJ1dGUuIE90aGVyd2lzZSwgdGhlIGNvbW1hbmQgd2lsbCByZW1vdmUgdGhlIGF0dHJpYnV0ZS4gSWYgbm90IHNldCwgdGhlIGNvbW1hbmQgd2lsbCBsb29rIGZvciBpdHMgY3VycmVudFxuXHQgKiB2YWx1ZSB0byBkZWNpZGUgd2hhdCBpdCBzaG91bGQgZG8uXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLmVkaXRvci5tb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudHMgPSB0aGlzLl9nZXRTZWxlY3RlZEl0ZW1zKCk7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9wdGlvbnMuZm9yY2VWYWx1ZSA9PT0gdW5kZWZpbmVkID8gIXRoaXMuX2dldFZhbHVlKHNlbGVjdGVkRWxlbWVudHMpIDogb3B0aW9ucy5mb3JjZVZhbHVlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHNlbGVjdGVkRWxlbWVudHMpe1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnLCB0cnVlLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhIHZhbHVlIGZvciB0aGUgY29tbWFuZC5cblx0ICovIF9nZXRWYWx1ZShzZWxlY3RlZEVsZW1lbnRzKSB7XG4gICAgICAgIHJldHVybiBzZWxlY3RlZEVsZW1lbnRzLmV2ZXJ5KChlbGVtZW50KT0+ZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RvZG9MaXN0Q2hlY2tlZCcpKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEdldHMgYWxsIHRvLWRvIGxpc3QgaXRlbXMgc2VsZWN0ZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb259LlxuXHQgKi8gX2dldFNlbGVjdGVkSXRlbXMoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IG1vZGVsLnNjaGVtYTtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uUmFuZ2UgPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpO1xuICAgICAgICBjb25zdCBzdGFydEVsZW1lbnQgPSBzZWxlY3Rpb25SYW5nZS5zdGFydC5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gW107XG4gICAgICAgIGlmIChzY2hlbWEuY2hlY2tBdHRyaWJ1dGUoc3RhcnRFbGVtZW50LCAndG9kb0xpc3RDaGVja2VkJykpIHtcbiAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goLi4uZ2V0QWxsTGlzdEl0ZW1CbG9ja3Moc3RhcnRFbGVtZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHNlbGVjdGlvblJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpe1xuICAgICAgICAgICAgaWYgKHNjaGVtYS5jaGVja0F0dHJpYnV0ZShpdGVtLCAndG9kb0xpc3RDaGVja2VkJykgJiYgIWVsZW1lbnRzLmluY2x1ZGVzKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCguLi5nZXRBbGxMaXN0SXRlbUJsb2NrcyhpdGVtKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgIH1cbn1cblxuLyoqXG4gKiBPYnNlcnZlcyBhbGwgdG8tZG8gbGlzdCBjaGVja2JveGVzIHN0YXRlIGNoYW5nZXMuXG4gKlxuICogTm90ZSB0aGF0IHRoaXMgb2JzZXJ2ZXIgaXMgbm90IGF2YWlsYWJsZSBieSBkZWZhdWx0LiBUbyBtYWtlIGl0IGF2YWlsYWJsZSBpdCBuZWVkcyB0byBiZSBhZGRlZCB0b1xuICoge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy92aWV3flZpZXd9IGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdmlld35WaWV3I2FkZE9ic2VydmVyfSBtZXRob2QuXG4gKi8gY2xhc3MgVG9kb0NoZWNrYm94Q2hhbmdlT2JzZXJ2ZXIgZXh0ZW5kcyBEb21FdmVudE9ic2VydmVyIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRvbUV2ZW50VHlwZSA9IFtcbiAgICAgICAgJ2NoYW5nZSdcbiAgICBdO1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gb25Eb21FdmVudChkb21FdmVudCkge1xuICAgICAgICBpZiAoZG9tRXZlbnQudGFyZ2V0KSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3VGFyZ2V0ID0gdGhpcy52aWV3LmRvbUNvbnZlcnRlci5tYXBEb21Ub1ZpZXcoZG9tRXZlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgIGlmICh2aWV3VGFyZ2V0ICYmIHZpZXdUYXJnZXQuaXMoJ2VsZW1lbnQnLCAnaW5wdXQnKSAmJiB2aWV3VGFyZ2V0LmdldEF0dHJpYnV0ZSgndHlwZScpID09ICdjaGVja2JveCcgJiYgdmlld1RhcmdldC5maW5kQW5jZXN0b3Ioe1xuICAgICAgICAgICAgICAgIGNsYXNzZXM6ICd0b2RvLWxpc3RfX2xhYmVsJ1xuICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3RvZG9DaGVja2JveENoYW5nZScsIGRvbUV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3QgSVRFTV9UT0dHTEVfS0VZU1RST0tFJDEgPSAvKiAjX19QVVJFX18gKi8gcGFyc2VLZXlzdHJva2UoJ0N0cmwrRW50ZXInKTtcbi8qKlxuICogVGhlIGVuZ2luZSBvZiB0aGUgdG8tZG8gbGlzdCBmZWF0dXJlLiBJdCBoYW5kbGVzIGNyZWF0aW5nLCBlZGl0aW5nIGFuZCByZW1vdmluZyB0by1kbyBsaXN0cyBhbmQgdGhlaXIgaXRlbXMuXG4gKlxuICogSXQgcmVnaXN0ZXJzIHRoZSBlbnRpcmUgZnVuY3Rpb25hbGl0eSBvZiB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L2xpc3QvbGlzdGVkaXRpbmd+TGlzdEVkaXRpbmcgbGlzdCBlZGl0aW5nIHBsdWdpbn1cbiAqIGFuZCBleHRlbmRzIGl0IHdpdGggdGhlIGNvbW1hbmRzOlxuICpcbiAqIC0gYCd0b2RvTGlzdCdgLFxuICogLSBgJ2NoZWNrVG9kb0xpc3QnYCxcbiAqLyBjbGFzcyBUb2RvTGlzdEVkaXRpbmcgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ1RvZG9MaXN0RWRpdGluZyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHJlcXVpcmVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgTGlzdEVkaXRpbmdcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGVkaXRpbmcgPSBlZGl0b3IuZWRpdGluZztcbiAgICAgICAgY29uc3QgbGlzdEVkaXRpbmcgPSBlZGl0b3IucGx1Z2lucy5nZXQoTGlzdEVkaXRpbmcpO1xuICAgICAgICBjb25zdCBtdWx0aUJsb2NrID0gZWRpdG9yLmNvbmZpZy5nZXQoJ2xpc3QubXVsdGlCbG9jaycpO1xuICAgICAgICBjb25zdCBlbGVtZW50TmFtZSA9IG11bHRpQmxvY2sgPyAncGFyYWdyYXBoJyA6ICdsaXN0SXRlbSc7XG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ3RvZG9MaXN0JywgbmV3IExpc3RDb21tYW5kKGVkaXRvciwgJ3RvZG8nKSk7XG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ2NoZWNrVG9kb0xpc3QnLCBuZXcgQ2hlY2tUb2RvTGlzdENvbW1hbmQoZWRpdG9yKSk7XG4gICAgICAgIGVkaXRpbmcudmlldy5hZGRPYnNlcnZlcihUb2RvQ2hlY2tib3hDaGFuZ2VPYnNlcnZlcik7XG4gICAgICAgIG1vZGVsLnNjaGVtYS5leHRlbmQoJyRsaXN0SXRlbScsIHtcbiAgICAgICAgICAgIGFsbG93QXR0cmlidXRlczogJ3RvZG9MaXN0Q2hlY2tlZCdcbiAgICAgICAgfSk7XG4gICAgICAgIG1vZGVsLnNjaGVtYS5hZGRBdHRyaWJ1dGVDaGVjaygoY29udGV4dCk9PntcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjb250ZXh0Lmxhc3Q7XG4gICAgICAgICAgICAvLyBEb24ndCBhbGxvdyBgdG9kb0xpc3RDaGVja2VkYCBhdHRyaWJ1dGUgb24gZWxlbWVudHMgd2hpY2ggYXJlIG5vdCB0b2RvIGxpc3QgaXRlbXMuXG4gICAgICAgICAgICBpZiAoIWl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJykgfHwgaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgIT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAndG9kb0xpc3RDaGVja2VkJyk7XG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcigndXBjYXN0JykuYWRkKChkaXNwYXRjaGVyKT0+e1xuICAgICAgICAgICAgLy8gVXBjYXN0IG9mIHRvLWRvIGxpc3QgaXRlbSBpcyBiYXNlZCBvbiBhIGNoZWNrYm94IGF0IHRoZSBiZWdpbm5pbmcgb2YgYSA8bGk+IHRvIGtlZXAgY29tcGF0aWJpbGl0eSB3aXRoIG1hcmtkb3duIGlucHV0LlxuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDppbnB1dCcsIHRvZG9JdGVtSW5wdXRDb252ZXJ0ZXIoKSk7XG4gICAgICAgICAgICAvLyBQcmlvcml0eSBpcyBzZXQgdG8gbG93IHRvIGFsbG93IGdlbmVyaWMgbGlzdCBpdGVtIGNvbnZlcnRlciB0byBydW4gZmlyc3QuXG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50OmxpJywgdG9kb0xpc3RJdGVtVXBjYXN0Q29udmVydGVyKCksIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gQ29uc3VtZSBvdGhlciBlbGVtZW50cyB0aGF0IGFyZSBub3JtYWxseSBnZW5lcmF0ZWQgaW4gZGF0YSBkb3duY2FzdCwgc28gdGhleSB3b24ndCBnZXQgY2FwdHVyZWQgYnkgR0hTLlxuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDpsYWJlbCcsIGVsZW1lbnRVcGNhc3RDb25zdW1pbmdDb252ZXJ0ZXIoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdsYWJlbCcsXG4gICAgICAgICAgICAgICAgY2xhc3NlczogJ3RvZG8tbGlzdF9fbGFiZWwnXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50OmxhYmVsJywgZWxlbWVudFVwY2FzdENvbnN1bWluZ0NvbnZlcnRlcih7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2xhYmVsJyxcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAgICAgICAgICd0b2RvLWxpc3RfX2xhYmVsJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RvZG8tbGlzdF9fbGFiZWxfd2l0aG91dC1kZXNjcmlwdGlvbidcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50OnNwYW4nLCBlbGVtZW50VXBjYXN0Q29uc3VtaW5nQ29udmVydGVyKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnc3BhbicsXG4gICAgICAgICAgICAgICAgY2xhc3NlczogJ3RvZG8tbGlzdF9fbGFiZWxfX2Rlc2NyaXB0aW9uJ1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDp1bCcsIGF0dHJpYnV0ZVVwY2FzdENvbnN1bWluZ0NvbnZlcnRlcih7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3VsJyxcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiAndG9kby1saXN0J1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCdkb3duY2FzdCcpLmVsZW1lbnRUb0VsZW1lbnQoe1xuICAgICAgICAgICAgbW9kZWw6IGVsZW1lbnROYW1lLFxuICAgICAgICAgICAgdmlldzogKGVsZW1lbnQsIHsgd3JpdGVyIH0pPT57XG4gICAgICAgICAgICAgICAgaWYgKGlzRGVzY3JpcHRpb25CbG9jayhlbGVtZW50LCBsaXN0RWRpdGluZy5nZXRMaXN0QXR0cmlidXRlTmFtZXMoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCdzcGFuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M6ICd0b2RvLWxpc3RfX2xhYmVsX19kZXNjcmlwdGlvbidcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnZlcnRlclByaW9yaXR5OiAnaGlnaGVzdCdcbiAgICAgICAgfSk7XG4gICAgICAgIGxpc3RFZGl0aW5nLnJlZ2lzdGVyRG93bmNhc3RTdHJhdGVneSh7XG4gICAgICAgICAgICBzY29wZTogJ2xpc3QnLFxuICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogJ2xpc3RUeXBlJyxcbiAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uRG93bmNhc3QgKHdyaXRlciwgdmFsdWUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5hZGRDbGFzcygndG9kby1saXN0JywgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUNsYXNzKCd0b2RvLWxpc3QnLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBsaXN0RWRpdGluZy5yZWdpc3RlckRvd25jYXN0U3RyYXRlZ3koe1xuICAgICAgICAgICAgc2NvcGU6ICdpdGVtTWFya2VyJyxcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICd0b2RvTGlzdENoZWNrZWQnLFxuICAgICAgICAgICAgY3JlYXRlRWxlbWVudCAod3JpdGVyLCBtb2RlbEVsZW1lbnQsIHsgZGF0YVBpcGVsaW5lIH0pIHtcbiAgICAgICAgICAgICAgICBpZiAobW9kZWxFbGVtZW50LmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPSAndG9kbycpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gd3JpdGVyLmNyZWF0ZVVJRWxlbWVudCgnaW5wdXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgICAgICAgICAgICAgICAgIC4uLm1vZGVsRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RvZG9MaXN0Q2hlY2tlZCcpID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZDogJ2NoZWNrZWQnXG4gICAgICAgICAgICAgICAgICAgIH0gOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAuLi5kYXRhUGlwZWxpbmUgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogJ2Rpc2FibGVkJ1xuICAgICAgICAgICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFiaW5kZXg6ICctMSdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhUGlwZWxpbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdFbGVtZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB3cmFwcGVyID0gd3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRlZGl0YWJsZTogJ2ZhbHNlJ1xuICAgICAgICAgICAgICAgIH0sIHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB3cmFwcGVyLmdldEZpbGxlck9mZnNldCA9ICgpPT5udWxsO1xuICAgICAgICAgICAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhbldyYXBFbGVtZW50IChtb2RlbEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNEZXNjcmlwdGlvbkJsb2NrKG1vZGVsRWxlbWVudCwgbGlzdEVkaXRpbmcuZ2V0TGlzdEF0dHJpYnV0ZU5hbWVzKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZVdyYXBwZXJFbGVtZW50ICh3cml0ZXIsIG1vZGVsRWxlbWVudCwgeyBkYXRhUGlwZWxpbmUgfSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsYXNzZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICd0b2RvLWxpc3RfX2xhYmVsJ1xuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgaWYgKCFpc0Rlc2NyaXB0aW9uQmxvY2sobW9kZWxFbGVtZW50LCBsaXN0RWRpdGluZy5nZXRMaXN0QXR0cmlidXRlTmFtZXMoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKCd0b2RvLWxpc3RfX2xhYmVsX3dpdGhvdXQtZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlci5jcmVhdGVBdHRyaWJ1dGVFbGVtZW50KGRhdGFQaXBlbGluZSA/ICdsYWJlbCcgOiAnc3BhbicsIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IGNsYXNzZXMuam9pbignICcpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBWZXJpZmllcyBpZiBhIHRvLWRvIGxpc3QgYmxvY2sgcmVxdWlyZXMgcmVjb252ZXJzaW9uIG9mIGEgZmlyc3QgaXRlbSBkb3duY2FzdGVkIGFzIGFuIGl0ZW0gZGVzY3JpcHRpb24uXG4gICAgICAgIGxpc3RFZGl0aW5nLm9uKCdjaGVja0VsZW1lbnQnLCAoZXZ0LCB7IG1vZGVsRWxlbWVudCwgdmlld0VsZW1lbnQgfSk9PntcbiAgICAgICAgICAgIGNvbnN0IGlzRmlyc3RUb2RvTW9kZWxQYXJhZ3JhcGhCbG9jayA9IGlzRGVzY3JpcHRpb25CbG9jayhtb2RlbEVsZW1lbnQsIGxpc3RFZGl0aW5nLmdldExpc3RBdHRyaWJ1dGVOYW1lcygpKTtcbiAgICAgICAgICAgIGNvbnN0IGhhc1ZpZXdDbGFzcyA9IHZpZXdFbGVtZW50Lmhhc0NsYXNzKCd0b2RvLWxpc3RfX2xhYmVsX19kZXNjcmlwdGlvbicpO1xuICAgICAgICAgICAgaWYgKGhhc1ZpZXdDbGFzcyAhPSBpc0ZpcnN0VG9kb01vZGVsUGFyYWdyYXBoQmxvY2spIHtcbiAgICAgICAgICAgICAgICBldnQucmV0dXJuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVmVyaWZpZXMgaWYgYSB0by1kbyBsaXN0IGJsb2NrIHJlcXVpcmVzIHJlY29udmVyc2lvbiBvZiBhIGNoZWNrYm94IGVsZW1lbnRcbiAgICAgICAgLy8gKGZvciBleGFtcGxlIHRoZXJlIGlzIGEgbmV3IHBhcmFncmFwaCBpbnNlcnRlZCBhcyBhIGZpcnN0IGJsb2NrIG9mIGEgbGlzdCBpdGVtKS5cbiAgICAgICAgbGlzdEVkaXRpbmcub24oJ2NoZWNrRWxlbWVudCcsIChldnQsIHsgbW9kZWxFbGVtZW50LCB2aWV3RWxlbWVudCB9KT0+e1xuICAgICAgICAgICAgY29uc3QgaXNGaXJzdFRvZG9Nb2RlbEl0ZW1CbG9jayA9IG1vZGVsRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ3RvZG8nICYmIGlzRmlyc3RCbG9ja09mTGlzdEl0ZW0obW9kZWxFbGVtZW50KTtcbiAgICAgICAgICAgIGxldCBoYXNWaWV3SXRlbU1hcmtlciA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3Qgdmlld1dhbGtlciA9IGVkaXRvci5lZGl0aW5nLnZpZXcuY3JlYXRlUG9zaXRpb25CZWZvcmUodmlld0VsZW1lbnQpLmdldFdhbGtlcih7XG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnYmFja3dhcmQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgeyBpdGVtIH0gb2Ygdmlld1dhbGtlcil7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXMoJ2VsZW1lbnQnKSAmJiBlZGl0b3IuZWRpdGluZy5tYXBwZXIudG9Nb2RlbEVsZW1lbnQoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzKCdlbGVtZW50JywgJ2lucHV0JykgJiYgaXRlbS5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSA9PSAnY2hlY2tib3gnKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhc1ZpZXdJdGVtTWFya2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFzVmlld0l0ZW1NYXJrZXIgIT0gaXNGaXJzdFRvZG9Nb2RlbEl0ZW1CbG9jaykge1xuICAgICAgICAgICAgICAgIGV2dC5yZXR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBhbGwgYmxvY2tzIG9mIHRoZSBzYW1lIGxpc3QgaXRlbSBoYXZlIHRoZSBzYW1lIHRvZG9MaXN0Q2hlY2tlZCBhdHRyaWJ1dGUuXG4gICAgICAgIGxpc3RFZGl0aW5nLm9uKCdwb3N0Rml4ZXInLCAoZXZ0LCB7IGxpc3ROb2Rlcywgd3JpdGVyIH0pPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgbm9kZSwgcHJldmlvdXNOb2RlSW5MaXN0IH0gb2YgbGlzdE5vZGVzKXtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgZmlyc3QgaXRlbSBvZiBhIG5lc3RlZCBsaXN0LlxuICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXNOb2RlSW5MaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNOb2RlSW5MaXN0LmdldEF0dHJpYnV0ZSgnbGlzdEl0ZW1JZCcpICE9IG5vZGUuZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzSGFzQXR0cmlidXRlID0gcHJldmlvdXNOb2RlSW5MaXN0Lmhhc0F0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJyk7XG4gICAgICAgICAgICAgICAgY29uc3Qgbm9kZUhhc0F0dHJpYnV0ZSA9IG5vZGUuaGFzQXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnKTtcbiAgICAgICAgICAgICAgICBpZiAobm9kZUhhc0F0dHJpYnV0ZSAmJiAhcHJldmlvdXNIYXNBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJywgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5yZXR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW5vZGVIYXNBdHRyaWJ1dGUgJiYgcHJldmlvdXNIYXNBdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJywgdHJ1ZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIGV2dC5yZXR1cm4gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRvZG9MaXN0Q2hlY2tlZCBhdHRyaWJ1dGUgaXMgb25seSBwcmVzZW50IGZvciB0by1kbyBsaXN0IGl0ZW1zLlxuICAgICAgICBtb2RlbC5kb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlcigod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgY2hhbmdlcyA9IG1vZGVsLmRvY3VtZW50LmRpZmZlci5nZXRDaGFuZ2VzKCk7XG4gICAgICAgICAgICBsZXQgd2FzRml4ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY2hhbmdlIG9mIGNoYW5nZXMpe1xuICAgICAgICAgICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PSAnYXR0cmlidXRlJyAmJiBjaGFuZ2UuYXR0cmlidXRlS2V5ID09ICdsaXN0VHlwZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGNoYW5nZS5yYW5nZS5zdGFydC5ub2RlQWZ0ZXI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2UuYXR0cmlidXRlT2xkVmFsdWUgPT0gJ3RvZG8nICYmIGVsZW1lbnQuaGFzQXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJywgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3YXNGaXhlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYW5nZS50eXBlID09ICdpbnNlcnQnICYmIGNoYW5nZS5uYW1lICE9ICckdGV4dCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IGl0ZW0gfSBvZiB3cml0ZXIuY3JlYXRlUmFuZ2VPbihjaGFuZ2UucG9zaXRpb24ubm9kZUFmdGVyKSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pcygnZWxlbWVudCcpICYmIGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9ICd0b2RvJyAmJiBpdGVtLmhhc0F0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXNGaXhlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2FzRml4ZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUb2dnbGUgY2hlY2sgc3RhdGUgb2Ygc2VsZWN0ZWQgdG8tZG8gbGlzdCBpdGVtcyBvbiBrZXlzdHJva2UuXG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdGluZy52aWV3LmRvY3VtZW50LCAna2V5ZG93bicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBpZiAoZ2V0Q29kZShkYXRhKSA9PT0gSVRFTV9UT0dHTEVfS0VZU1RST0tFJDEpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuZXhlY3V0ZSgnY2hlY2tUb2RvTGlzdCcpO1xuICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFRvZ2dsZSBjaGVjayBzdGF0ZSBvZiBhIHRvLWRvIGxpc3QgaXRlbSBjbGlja2VkIG9uIHRoZSBjaGVja2JveC5cbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlZGl0aW5nLnZpZXcuZG9jdW1lbnQsICd0b2RvQ2hlY2tib3hDaGFuZ2UnLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgY29uc3Qgdmlld1RhcmdldCA9IGRhdGEudGFyZ2V0O1xuICAgICAgICAgICAgaWYgKCF2aWV3VGFyZ2V0IHx8ICF2aWV3VGFyZ2V0LmlzKCdlbGVtZW50JywgJ2lucHV0JykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2aWV3UG9zaXRpb25BZnRlciA9IGVkaXRpbmcudmlldy5jcmVhdGVQb3NpdGlvbkFmdGVyKHZpZXdUYXJnZXQpO1xuICAgICAgICAgICAgY29uc3QgbW9kZWxQb3NpdGlvbkFmdGVyID0gZWRpdGluZy5tYXBwZXIudG9Nb2RlbFBvc2l0aW9uKHZpZXdQb3NpdGlvbkFmdGVyKTtcbiAgICAgICAgICAgIGNvbnN0IG1vZGVsRWxlbWVudCA9IG1vZGVsUG9zaXRpb25BZnRlci5wYXJlbnQ7XG4gICAgICAgICAgICBpZiAobW9kZWxFbGVtZW50ICYmIGlzTGlzdEl0ZW1CbG9jayhtb2RlbEVsZW1lbnQpICYmIG1vZGVsRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2hlY2ttYXJrQ2hhbmdlKG1vZGVsRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBKdW1wIGF0IHRoZSBzdGFydC9lbmQgb2YgdGhlIG5leHQgbm9kZSBvbiByaWdodCBhcnJvdyBrZXkgcHJlc3MsIHdoZW4gc2VsZWN0aW9uIGlzIGJlZm9yZSB0aGUgY2hlY2tib3guXG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxibG9ja3F1b3RlPjxwPkZvb3t9PC9wPjwvYmxvY2txdW90ZT5cbiAgICAgICAgLy8gPHVsPjxsaT48Y2hlY2tib3gvPkJhcjwvbGk+PC91bD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gcHJlc3M6IGAtPmBcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPGJsb2NrcXVvdGU+PHA+Rm9vPC9wPjwvYmxvY2txdW90ZT5cbiAgICAgICAgLy8gPHVsPjxsaT48Y2hlY2tib3gvPnt9QmFyPC9saT48L3VsPlxuICAgICAgICAvL1xuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRpbmcudmlldy5kb2N1bWVudCwgJ2Fycm93S2V5JywganVtcE92ZXJDaGVja21hcmtPblNpZGVBcnJvd0tleVByZXNzJDEobW9kZWwsIGVkaXRvci5sb2NhbGUpLCB7XG4gICAgICAgICAgICBjb250ZXh0OiAnJHRleHQnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBNYXAgdmlldyBwb3NpdGlvbnMgaW5zaWRlIHRoZSBjaGVja2JveCBhbmQgd3JhcHBlcnMgdG8gdGhlIHBvc2l0aW9uIGluIHRoZSBmaXJzdCBibG9jayBvZiB0aGUgbGlzdCBpdGVtLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRpbmcubWFwcGVyLCAndmlld1RvTW9kZWxQb3NpdGlvbicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCB2aWV3UGFyZW50ID0gZGF0YS52aWV3UG9zaXRpb24ucGFyZW50O1xuICAgICAgICAgICAgY29uc3QgaXNTdGFydE9mTGlzdEl0ZW0gPSB2aWV3UGFyZW50LmlzKCdhdHRyaWJ1dGVFbGVtZW50JywgJ2xpJykgJiYgZGF0YS52aWV3UG9zaXRpb24ub2Zmc2V0ID09IDA7XG4gICAgICAgICAgICBjb25zdCBpc1N0YXJ0T2ZMaXN0TGFiZWwgPSBpc0xhYmVsRWxlbWVudCh2aWV3UGFyZW50KSAmJiBkYXRhLnZpZXdQb3NpdGlvbi5vZmZzZXQgPD0gMTtcbiAgICAgICAgICAgIGNvbnN0IGlzSW5JbnB1dFdyYXBwZXIgPSB2aWV3UGFyZW50LmlzKCdlbGVtZW50JywgJ3NwYW4nKSAmJiB2aWV3UGFyZW50LmdldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykgPT0gJ2ZhbHNlJyAmJiBpc0xhYmVsRWxlbWVudCh2aWV3UGFyZW50LnBhcmVudCk7XG4gICAgICAgICAgICBpZiAoIWlzU3RhcnRPZkxpc3RJdGVtICYmICFpc1N0YXJ0T2ZMaXN0TGFiZWwgJiYgIWlzSW5JbnB1dFdyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXIgPSBkYXRhLm1vZGVsUG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICAgICAgaWYgKG5vZGVBZnRlciAmJiBub2RlQWZ0ZXIuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICd0b2RvJykge1xuICAgICAgICAgICAgICAgIGRhdGEubW9kZWxQb3NpdGlvbiA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQobm9kZUFmdGVyLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9pbml0QXJpYUFubm91bmNlbWVudHMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhhbmRsZXMgdGhlIGNoZWNrYm94IGVsZW1lbnQgY2hhbmdlLCBtb3ZlcyB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjb3JyZXNwb25kaW5nIG1vZGVsIGl0ZW0gdG8gbWFrZSBpdCBwb3NzaWJsZVxuXHQgKiB0byB0b2dnbGUgdGhlIGB0b2RvTGlzdENoZWNrZWRgIGF0dHJpYnV0ZSB1c2luZyB0aGUgY29tbWFuZCwgYW5kIHJlc3RvcmVzIHRoZSBzZWxlY3Rpb24gcG9zaXRpb24uXG5cdCAqXG5cdCAqIFNvbWUgc2F5IGl0J3MgYSBoYWNrIDopIE1vdmluZyB0aGUgc2VsZWN0aW9uIG9ubHkgZm9yIGV4ZWN1dGluZyB0aGUgY29tbWFuZCBvbiBhIGNlcnRhaW4gbm9kZSBhbmQgcmVzdG9yaW5nIGl0IGFmdGVyLFxuXHQgKiBpcyBub3QgYSBjbGVhciBzb2x1dGlvbi4gV2UgbmVlZCB0byBkZXNpZ24gYW4gQVBJIGZvciB1c2luZyBjb21tYW5kcyBiZXlvbmQgdGhlIHNlbGVjdGlvbiByYW5nZS5cblx0ICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE5NTQuXG5cdCAqLyBfaGFuZGxlQ2hlY2ttYXJrQ2hhbmdlKGxpc3RJdGVtKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgcHJldmlvdXNTZWxlY3Rpb25SYW5nZXMgPSBBcnJheS5mcm9tKG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRSYW5nZXMoKSk7XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihsaXN0SXRlbSwgJ2VuZCcpO1xuICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ2NoZWNrVG9kb0xpc3QnKTtcbiAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24ocHJldmlvdXNTZWxlY3Rpb25SYW5nZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE9ic2VydmUgd2hlbiB1c2VyIGVudGVycyBvciBsZWF2ZXMgdG9kbyBsaXN0IGFuZCBzZXQgcHJvcGVyIGFyaWEgdmFsdWUgaW4gZ2xvYmFsIGxpdmUgYW5ub3VuY2VyLlxuXHQgKiBUaGlzIGFsbG93cyBzY3JlZW4gcmVhZGVycyB0byBpbmRpY2F0ZSB3aGVuIHRoZSB1c2VyIGhhcyBlbnRlcmVkIGFuZCBsZWZ0IHRoZSBzcGVjaWZpZWQgdG9kbyBsaXN0LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9pbml0QXJpYUFubm91bmNlbWVudHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbW9kZWwsIHVpLCB0IH0gPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgbGV0IGxhc3RGb2N1c2VkQ29kZUJsb2NrID0gbnVsbDtcbiAgICAgICAgaWYgKCF1aSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5vbignY2hhbmdlOnJhbmdlJywgKCk9PntcbiAgICAgICAgICAgIGNvbnN0IGZvY3VzUGFyZW50ID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmZvY3VzLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RFbGVtZW50SXNUb2RvTGlzdCA9IGlzVG9kb0xpc3RJdGVtRWxlbWVudChsYXN0Rm9jdXNlZENvZGVCbG9jayk7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50RWxlbWVudElzVG9kb0xpc3QgPSBpc1RvZG9MaXN0SXRlbUVsZW1lbnQoZm9jdXNQYXJlbnQpO1xuICAgICAgICAgICAgaWYgKGxhc3RFbGVtZW50SXNUb2RvTGlzdCAmJiAhY3VycmVudEVsZW1lbnRJc1RvZG9MaXN0KSB7XG4gICAgICAgICAgICAgICAgdWkuYXJpYUxpdmVBbm5vdW5jZXIuYW5ub3VuY2UodCgnTGVhdmluZyBhIHRvLWRvIGxpc3QnKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFsYXN0RWxlbWVudElzVG9kb0xpc3QgJiYgY3VycmVudEVsZW1lbnRJc1RvZG9MaXN0KSB7XG4gICAgICAgICAgICAgICAgdWkuYXJpYUxpdmVBbm5vdW5jZXIuYW5ub3VuY2UodCgnRW50ZXJpbmcgYSB0by1kbyBsaXN0JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdEZvY3VzZWRDb2RlQmxvY2sgPSBmb2N1c1BhcmVudDtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIGFuIHVwY2FzdCBjb252ZXJ0ZXIgZm9yIHRvLWRvIGxpc3QgaXRlbXMuXG4gKi8gZnVuY3Rpb24gdG9kb0xpc3RJdGVtVXBjYXN0Q29udmVydGVyKCkge1xuICAgIHJldHVybiAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgICAgICBjb25zdCB7IHdyaXRlciwgc2NoZW1hIH0gPSBjb252ZXJzaW9uQXBpO1xuICAgICAgICBpZiAoIWRhdGEubW9kZWxSYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEdyb3VwIHRvLWRvIGxpc3QgaXRlbXMgYnkgdGhlaXIgbGlzdEl0ZW1JZCBhdHRyaWJ1dGUgdG8gZW5zdXJlIHRoYXQgYWxsIGl0ZW1zIG9mIHRoZSBzYW1lIGxpc3QgaXRlbSBoYXZlIHRoZSBzYW1lIGNoZWNrZWQgc3RhdGUuXG4gICAgICAgIGNvbnN0IGdyb3VwZWRJdGVtcyA9IEFycmF5LmZyb20oZGF0YS5tb2RlbFJhbmdlLmdldEl0ZW1zKHtcbiAgICAgICAgICAgIHNoYWxsb3c6IHRydWVcbiAgICAgICAgfSkpLmZpbHRlcigoaXRlbSk9Pml0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09PSAndG9kbycgJiYgc2NoZW1hLmNoZWNrQXR0cmlidXRlKGl0ZW0sICdsaXN0SXRlbUlkJykpLnJlZHVjZSgoYWNjLCBpdGVtKT0+e1xuICAgICAgICAgICAgY29uc3QgbGlzdEl0ZW1JZCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SXRlbUlkJyk7XG4gICAgICAgICAgICBpZiAoIWFjYy5oYXMobGlzdEl0ZW1JZCkpIHtcbiAgICAgICAgICAgICAgICBhY2Muc2V0KGxpc3RJdGVtSWQsIGdldEFsbExpc3RJdGVtQmxvY2tzKGl0ZW0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIG5ldyBNYXAoKSk7XG4gICAgICAgIC8vIER1cmluZyB0aGUgdXBjYXN0LCB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IGFsbCBpdGVtcyBvZiB0aGUgc2FtZSBsaXN0IGhhdmUgdGhlIHNhbWUgY2hlY2tlZCBzdGF0ZS4gRnJvbSB0aW1lIHRvIHRpbWVcbiAgICAgICAgLy8gdGhlIGNoZWNrZWQgc3RhdGUgb2YgdGhlIGl0ZW1zIGNhbiBiZSBkaWZmZXJlbnQgd2hlbiB0aGUgdXNlciBwYXN0ZXMgY29udGVudCBmcm9tIHRoZSBjbGlwYm9hcmQgd2l0aCA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCI+XG4gICAgICAgIC8vIHRoYXQgaGFzIGNoZWNrZWQgc3RhdGUgc2V0IHRvIHRydWUuIEluIHN1Y2ggY2FzZXMsIHdlIG5lZWQgdG8gZW5zdXJlIHRoYXQgYWxsIGl0ZW1zIG9mIHRoZSBzYW1lIGxpc3QgaGF2ZSB0aGUgc2FtZSBjaGVja2VkIHN0YXRlLlxuICAgICAgICAvLyBTZWUgbW9yZTogaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTU2MDJcbiAgICAgICAgZm9yIChjb25zdCBbLCBpdGVtc10gb2YgZ3JvdXBlZEl0ZW1zLmVudHJpZXMoKSl7XG4gICAgICAgICAgICBpZiAoaXRlbXMuc29tZSgoaXRlbSk9Pml0ZW0uZ2V0QXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnKSkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpe1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnLCB0cnVlLCBpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm5zIGFuIHVwY2FzdCBjb252ZXJ0ZXIgdGhhdCBkZXRlY3RzIGEgdG8tZG8gbGlzdCBjaGVja2JveCBhbmQgbWFya3MgdGhlIGxpc3QgaXRlbSBhcyBhIHRvLWRvIGxpc3QuXG4gKi8gZnVuY3Rpb24gdG9kb0l0ZW1JbnB1dENvbnZlcnRlcigpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgbW9kZWxDdXJzb3IgPSBkYXRhLm1vZGVsQ3Vyc29yO1xuICAgICAgICBjb25zdCBtb2RlbEl0ZW0gPSBtb2RlbEN1cnNvci5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IHZpZXdJdGVtID0gZGF0YS52aWV3SXRlbTtcbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdCh2aWV3SXRlbSwge1xuICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICB9KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aWV3SXRlbS5nZXRBdHRyaWJ1dGUoJ3R5cGUnKSAhPSAnY2hlY2tib3gnIHx8ICFtb2RlbEN1cnNvci5pc0F0U3RhcnQgfHwgIW1vZGVsSXRlbS5oYXNBdHRyaWJ1dGUoJ2xpc3RUeXBlJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZSh2aWV3SXRlbSwge1xuICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgd3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgJ3RvZG8nLCBtb2RlbEl0ZW0pO1xuICAgICAgICBpZiAoZGF0YS52aWV3SXRlbS5oYXNBdHRyaWJ1dGUoJ2NoZWNrZWQnKSkge1xuICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJywgdHJ1ZSwgbW9kZWxJdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBkYXRhLm1vZGVsUmFuZ2UgPSB3cml0ZXIuY3JlYXRlUmFuZ2UobW9kZWxDdXJzb3IpO1xuICAgIH07XG59XG4vKipcbiAqIFJldHVybnMgYW4gdXBjYXN0IGNvbnZlcnRlciB0aGF0IGNvbnN1bWVzIGVsZW1lbnQgbWF0Y2hpbmcgdGhlIGdpdmVuIG1hdGNoZXIgcGF0dGVybi5cbiAqLyBmdW5jdGlvbiBlbGVtZW50VXBjYXN0Q29uc3VtaW5nQ29udmVydGVyKG1hdGNoZXJQYXR0ZXJuKSB7XG4gICAgY29uc3QgbWF0Y2hlciA9IG5ldyBNYXRjaGVyKG1hdGNoZXJQYXR0ZXJuKTtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgbWF0Y2hlclJlc3VsdCA9IG1hdGNoZXIubWF0Y2goZGF0YS52aWV3SXRlbSk7XG4gICAgICAgIGlmICghbWF0Y2hlclJlc3VsdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS52aWV3SXRlbSwgbWF0Y2hlclJlc3VsdC5tYXRjaCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3QuYXNzaWduKGRhdGEsIGNvbnZlcnNpb25BcGkuY29udmVydENoaWxkcmVuKGRhdGEudmlld0l0ZW0sIGRhdGEubW9kZWxDdXJzb3IpKTtcbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm5zIGFuIHVwY2FzdCBjb252ZXJ0ZXIgdGhhdCBjb25zdW1lcyBhdHRyaWJ1dGVzIG1hdGNoaW5nIHRoZSBnaXZlbiBtYXRjaGVyIHBhdHRlcm4uXG4gKi8gZnVuY3Rpb24gYXR0cmlidXRlVXBjYXN0Q29uc3VtaW5nQ29udmVydGVyKG1hdGNoZXJQYXR0ZXJuKSB7XG4gICAgY29uc3QgbWF0Y2hlciA9IG5ldyBNYXRjaGVyKG1hdGNoZXJQYXR0ZXJuKTtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgbWF0Y2hlclJlc3VsdCA9IG1hdGNoZXIubWF0Y2goZGF0YS52aWV3SXRlbSk7XG4gICAgICAgIGlmICghbWF0Y2hlclJlc3VsdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hdGNoID0gbWF0Y2hlclJlc3VsdC5tYXRjaDtcbiAgICAgICAgbWF0Y2gubmFtZSA9IGZhbHNlO1xuICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLnZpZXdJdGVtLCBtYXRjaCk7XG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBsaXN0IGl0ZW0gYmxvY2sgc2hvdWxkIGJlIGNvbnZlcnRlZCBhcyBhIGRlc2NyaXB0aW9uIGJsb2NrIG9mIGEgdG8tZG8gbGlzdCBpdGVtLlxuICovIGZ1bmN0aW9uIGlzRGVzY3JpcHRpb25CbG9jayhtb2RlbEVsZW1lbnQsIGxpc3RBdHRyaWJ1dGVOYW1lcykge1xuICAgIHJldHVybiAobW9kZWxFbGVtZW50LmlzKCdlbGVtZW50JywgJ3BhcmFncmFwaCcpIHx8IG1vZGVsRWxlbWVudC5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSAmJiBtb2RlbEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICd0b2RvJyAmJiBpc0ZpcnN0QmxvY2tPZkxpc3RJdGVtKG1vZGVsRWxlbWVudCkgJiYgaGFzT25seUxpc3RBdHRyaWJ1dGVzKG1vZGVsRWxlbWVudCwgbGlzdEF0dHJpYnV0ZU5hbWVzKTtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIG9ubHkgYXR0cmlidXRlcyBmcm9tIHRoZSBnaXZlbiBsaXN0IGFyZSBwcmVzZW50IG9uIHRoZSBtb2RlbCBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGhhc09ubHlMaXN0QXR0cmlidXRlcyhtb2RlbEVsZW1lbnQsIGF0dHJpYnV0ZU5hbWVzKSB7XG4gICAgZm9yIChjb25zdCBhdHRyaWJ1dGVLZXkgb2YgbW9kZWxFbGVtZW50LmdldEF0dHJpYnV0ZUtleXMoKSl7XG4gICAgICAgIC8vIElnbm9yZSBzZWxlY3Rpb24gYXR0cmlidXRlcyBzdG9yZWQgb24gYmxvY2sgZWxlbWVudHMuXG4gICAgICAgIGlmIChhdHRyaWJ1dGVLZXkuc3RhcnRzV2l0aCgnc2VsZWN0aW9uOicpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWF0dHJpYnV0ZU5hbWVzLmluY2x1ZGVzKGF0dHJpYnV0ZUtleSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogSnVtcCBhdCB0aGUgc3RhcnQgYW5kIGVuZCBvZiBhIHRvLWRvIGxpc3QgaXRlbS5cbiAqLyBmdW5jdGlvbiBqdW1wT3ZlckNoZWNrbWFya09uU2lkZUFycm93S2V5UHJlc3MkMShtb2RlbCwgbG9jYWxlKSB7XG4gICAgcmV0dXJuIChldmVudEluZm8sIGRvbUV2ZW50RGF0YSk9PntcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gZ2V0TG9jYWxpemVkQXJyb3dLZXlDb2RlRGlyZWN0aW9uKGRvbUV2ZW50RGF0YS5rZXlDb2RlLCBsb2NhbGUuY29udGVudExhbmd1YWdlRGlyZWN0aW9uKTtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIC8vIFJpZ2h0IGFycm93IGJlZm9yZSBhIHRvLWRvIGxpc3QgaXRlbS5cbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PSAncmlnaHQnICYmIHBvc2l0aW9uLmlzQXRFbmQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1JhbmdlID0gc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShtb2RlbC5jcmVhdGVQb3NpdGlvbkFmdGVyKHBhcmVudCksICdmb3J3YXJkJyk7XG4gICAgICAgICAgICBpZiAoIW5ld1JhbmdlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV3UmFuZ2VQYXJlbnQgPSBuZXdSYW5nZS5zdGFydC5wYXJlbnQ7XG4gICAgICAgICAgICBpZiAobmV3UmFuZ2VQYXJlbnQgJiYgaXNMaXN0SXRlbUJsb2NrKG5ld1JhbmdlUGFyZW50KSAmJiBuZXdSYW5nZVBhcmVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT53cml0ZXIuc2V0U2VsZWN0aW9uKG5ld1JhbmdlKSk7XG4gICAgICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZG9tRXZlbnREYXRhLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGV2ZW50SW5mby5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09ICdsZWZ0JyAmJiBwb3NpdGlvbi5pc0F0U3RhcnQgJiYgaXNMaXN0SXRlbUJsb2NrKHBhcmVudCkgJiYgcGFyZW50LmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PSAndG9kbycpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1JhbmdlID0gc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShtb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShwYXJlbnQpLCAnYmFja3dhcmQnKTtcbiAgICAgICAgICAgIGlmICghbmV3UmFuZ2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PndyaXRlci5zZXRTZWxlY3Rpb24obmV3UmFuZ2UpKTtcbiAgICAgICAgICAgIGRvbUV2ZW50RGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZG9tRXZlbnREYXRhLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnRJbmZvLnN0b3AoKTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBhIGxhYmVsIGVsZW1lbnQgb2YgYSB0by1kbyBsaXN0IGl0ZW0uXG4gKi8gZnVuY3Rpb24gaXNMYWJlbEVsZW1lbnQodmlld0VsZW1lbnQpIHtcbiAgICByZXR1cm4gISF2aWV3RWxlbWVudCAmJiB2aWV3RWxlbWVudC5pcygnYXR0cmlidXRlRWxlbWVudCcpICYmIHZpZXdFbGVtZW50Lmhhc0NsYXNzKCd0b2RvLWxpc3RfX2xhYmVsJyk7XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZWxlbWVudCBpcyBhIGxpc3QgaXRlbSBtb2RlbCBlbGVtZW50IG9mIGEgdG8tZG8gbGlzdC5cbiAqLyBmdW5jdGlvbiBpc1RvZG9MaXN0SXRlbUVsZW1lbnQoZWxlbWVudCkge1xuICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICghZWxlbWVudC5pcygnZWxlbWVudCcsICdwYXJhZ3JhcGgnKSAmJiAhZWxlbWVudC5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICd0b2RvJztcbn1cblxuLyoqXG4gKiBUaGUgdG8tZG8gbGlzdCBVSSBmZWF0dXJlLiBJdCBpbnRyb2R1Y2VzIHRoZSBgJ3RvZG9MaXN0J2AgYnV0dG9uIHRoYXRcbiAqIGFsbG93cyB0byBjb252ZXJ0IGVsZW1lbnRzIHRvIGFuZCBmcm9tIHRvLWRvIGxpc3QgaXRlbXMgYW5kIHRvIGluZGVudCBvciBvdXRkZW50IHRoZW0uXG4gKi8gY2xhc3MgVG9kb0xpc3RVSSBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnVG9kb0xpc3RVSSc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5lZGl0b3IudDtcbiAgICAgICAgY3JlYXRlVUlDb21wb25lbnRzKHRoaXMuZWRpdG9yLCAndG9kb0xpc3QnLCB0KCdUby1kbyBMaXN0JyksIGljb25zLnRvZG9MaXN0KTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIHRvLWRvIGxpc3QgZmVhdHVyZS5cbiAqXG4gKiBUaGlzIGlzIGEgXCJnbHVlXCIgcGx1Z2luIHRoYXQgbG9hZHMgdGhlIHtAbGluayBtb2R1bGU6bGlzdC90b2RvbGlzdC90b2RvbGlzdGVkaXRpbmd+VG9kb0xpc3RFZGl0aW5nIHRvLWRvIGxpc3RcbiAqIGVkaXRpbmcgZmVhdHVyZX0gYW5kIHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvdG9kb2xpc3QvdG9kb2xpc3R1aX5Ub2RvTGlzdFVJIHRvLWRvIGxpc3QgVUkgZmVhdHVyZX0uXG4gKi8gY2xhc3MgVG9kb0xpc3QgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCByZXF1aXJlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIFRvZG9MaXN0RWRpdGluZyxcbiAgICAgICAgICAgIFRvZG9MaXN0VUlcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnVG9kb0xpc3QnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSBsaXN0IGNvbW1hbmQuIEl0IGlzIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0fkxlZ2FjeUxpc3QgbGVnYWN5IGxpc3QgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGVnYWN5TGlzdENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogVGhlIHR5cGUgb2YgdGhlIGxpc3QgY3JlYXRlZCBieSB0aGUgY29tbWFuZC5cblx0ICovIHR5cGU7XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgdGhlIGNvbW1hbmQuXG5cdCAqXG5cdCAqIEBwYXJhbSBlZGl0b3IgVGhlIGVkaXRvciBpbnN0YW5jZS5cblx0ICogQHBhcmFtIHR5cGUgTGlzdCB0eXBlIHRoYXQgd2lsbCBiZSBoYW5kbGVkIGJ5IHRoaXMgY29tbWFuZC5cblx0ICovIGNvbnN0cnVjdG9yKGVkaXRvciwgdHlwZSl7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX2dldFZhbHVlKCk7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdGhpcy5fY2hlY2tFbmFibGVkKCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyB0aGUgbGlzdCBjb21tYW5kLlxuXHQgKlxuXHQgKiBAZmlyZXMgZXhlY3V0ZVxuXHQgKiBAcGFyYW0gb3B0aW9ucyBDb21tYW5kIG9wdGlvbnMuXG5cdCAqIEBwYXJhbSBvcHRpb25zLmZvcmNlVmFsdWUgSWYgc2V0LCBpdCB3aWxsIGZvcmNlIHRoZSBjb21tYW5kIGJlaGF2aW9yLiBJZiBgdHJ1ZWAsIHRoZSBjb21tYW5kIHdpbGwgdHJ5IHRvIGNvbnZlcnQgdGhlXG5cdCAqIHNlbGVjdGVkIGl0ZW1zIGFuZCBwb3RlbnRpYWxseSB0aGUgbmVpZ2hib3IgZWxlbWVudHMgdG8gdGhlIHByb3BlciBsaXN0IGl0ZW1zLiBJZiBzZXQgdG8gYGZhbHNlYCwgaXQgd2lsbCBjb252ZXJ0IHNlbGVjdGVkIGVsZW1lbnRzXG5cdCAqIHRvIHBhcmFncmFwaHMuIElmIG5vdCBzZXQsIHRoZSBjb21tYW5kIHdpbGwgdG9nZ2xlIHNlbGVjdGVkIGVsZW1lbnRzIHRvIGxpc3QgaXRlbXMgb3IgcGFyYWdyYXBocywgZGVwZW5kaW5nIG9uIHRoZSBzZWxlY3Rpb24uXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2N1bWVudCA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBibG9ja3MgPSBBcnJheS5mcm9tKGRvY3VtZW50LnNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpKS5maWx0ZXIoKGJsb2NrKT0+Y2hlY2tDYW5CZWNvbWVMaXN0SXRlbShibG9jaywgbW9kZWwuc2NoZW1hKSk7XG4gICAgICAgIC8vIFdoZXRoZXIgd2UgYXJlIHR1cm5pbmcgb2ZmIHNvbWUgaXRlbXMuXG4gICAgICAgIGNvbnN0IHR1cm5PZmYgPSBvcHRpb25zLmZvcmNlVmFsdWUgIT09IHVuZGVmaW5lZCA/ICFvcHRpb25zLmZvcmNlVmFsdWUgOiB0aGlzLnZhbHVlO1xuICAgICAgICAvLyBJZiB3ZSBhcmUgdHVybmluZyBvZmYgaXRlbXMsIHdlIGFyZSBnb2luZyB0byByZW5hbWUgdGhlbSB0byBwYXJhZ3JhcGhzLlxuICAgICAgICBtb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIC8vIElmIHBhcnQgb2YgYSBsaXN0IGdvdCB0dXJuZWQgb2ZmLCB3ZSBuZWVkIHRvIGhhbmRsZSAob3V0ZGVudCkgYWxsIG9mIHN1Yi1pdGVtcyBvZiB0aGUgbGFzdCB0dXJuZWQtb2ZmIGl0ZW0uXG4gICAgICAgICAgICAvLyBUbyBiZSBzdXJlIHRoYXQgbW9kZWwgaXMgYWxsIHRoZSB0aW1lIGluIGEgZ29vZCBzdGF0ZSwgd2UgZmlyc3QgZml4IGl0ZW1zIGJlbG93IHR1cm5lZC1vZmYgaXRlbS5cbiAgICAgICAgICAgIGlmICh0dXJuT2ZmKSB7XG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgZnJvbSB0aGUgbW9kZWwgaXRlbSB0aGF0IGlzIGp1c3QgYWZ0ZXIgdGhlIGxhc3QgdHVybmVkLW9mZiBpdGVtLlxuICAgICAgICAgICAgICAgIGxldCBuZXh0ID0gYmxvY2tzW2Jsb2Nrcy5sZW5ndGggLSAxXS5uZXh0U2libGluZztcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudEluZGVudCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTtcbiAgICAgICAgICAgICAgICBsZXQgY2hhbmdlcyA9IFtdO1xuICAgICAgICAgICAgICAgIC8vIENvcnJlY3QgaW5kZW50IG9mIGFsbCBpdGVtcyBhZnRlciB0aGUgbGFzdCB0dXJuZWQgb2ZmIGl0ZW0uXG4gICAgICAgICAgICAgICAgLy8gUnVsZXMgdGhhdCBzaG91bGQgYmUgZm9sbG93ZWQ6XG4gICAgICAgICAgICAgICAgLy8gMS4gQWxsIGRpcmVjdCBzdWItaXRlbXMgb2YgdHVybmVkLW9mZiBpdGVtIHNob3VsZCBiZWNvbWUgaW5kZW50IDAsIGJlY2F1c2UgdGhlIGZpcnN0IGl0ZW0gYWZ0ZXIgaXRcbiAgICAgICAgICAgICAgICAvLyAgICB3aWxsIGJlIHRoZSBmaXJzdCBpdGVtIG9mIGEgbmV3IGxpc3QuIE90aGVyIGl0ZW1zIGFyZSBhdCB0aGUgc2FtZSBsZXZlbCwgc28gc2hvdWxkIGhhdmUgc2FtZSAwIGluZGV4LlxuICAgICAgICAgICAgICAgIC8vIDIuIEFsbCBpdGVtcyB3aXRoIGluZGVudCBsb3dlciB0aGFuIGluZGVudCBvZiB0dXJuZWQtb2ZmIGl0ZW0gc2hvdWxkIGJlY29tZSBpbmRlbnQgMCwgYmVjYXVzZSB0aGV5XG4gICAgICAgICAgICAgICAgLy8gICAgc2hvdWxkIG5vdCBlbmQgdXAgYXMgYSBjaGlsZCBvZiBhbnkgb2YgbGlzdCBpdGVtcyB0aGF0IHRoZXkgd2VyZSBub3QgY2hpbGRyZW4gb2YgYmVmb3JlLlxuICAgICAgICAgICAgICAgIC8vIDMuIEFsbCBvdGhlciBpdGVtcyBzaG91bGQgaGF2ZSB0aGVpciBpbmRlbnQgY2hhbmdlZCByZWxhdGl2ZWx5IHRvIGl0J3MgcGFyZW50LlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgICAgICAgICAgICAgLy8gMSAgKiAtLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIDIgICAgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyAzICAgICAgICAqIC0tLS0tLS0tXHRcdFx0PC0tIHRoaXMgaXMgdHVybmVkIG9mZi5cbiAgICAgICAgICAgICAgICAvLyA0ICAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIGhhcyB0byBiZWNvbWUgaW5kZW50ID0gMCwgYmVjYXVzZSBpdCB3aWxsIGJlIGZpcnN0IGl0ZW0gb24gYSBuZXcgbGlzdC5cbiAgICAgICAgICAgICAgICAvLyA1ICAgICAgICAgICAgICAqIC0tLS0tLS0tXHQ8LS0gdGhpcyBzaG91bGQgYmUgc3RpbGwgYmUgYSBjaGlsZCBvZiBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAxLlxuICAgICAgICAgICAgICAgIC8vIDYgICAgICAgICogLS0tLS0tLS1cdFx0XHQ8LS0gdGhpcyBoYXMgdG8gYmVjb21lIGluZGVudCA9IDAsIGJlY2F1c2UgaXQgc2hvdWxkIG5vdCBiZSBhIGNoaWxkIG9mIGFueSBvZiBpdGVtcyBhYm92ZS5cbiAgICAgICAgICAgICAgICAvLyA3ICAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIHNob3VsZCBiZSBzdGlsbCBiZSBhIGNoaWxkIG9mIGl0ZW0gYWJvdmUsIHNvIGluZGVudCA9IDEuXG4gICAgICAgICAgICAgICAgLy8gOCAgICAgKiAtLS0tLS0tLVx0XHRcdFx0PC0tIHRoaXMgaGFzIHRvIGJlY29tZSBpbmRlbnQgPSAwLlxuICAgICAgICAgICAgICAgIC8vIDkgICAgICAgICogLS0tLS0tLS1cdFx0XHQ8LS0gdGhpcyBzaG91bGQgc3RpbGwgYmUgYSBjaGlsZCBvZiBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAxLlxuICAgICAgICAgICAgICAgIC8vIDEwICAgICAgICAgICogLS0tLS0tLS1cdFx0PC0tIHRoaXMgc2hvdWxkIHN0aWxsIGJlIGEgY2hpbGQgb2YgaXRlbSBhYm92ZSwgc28gaW5kZW50ID0gMi5cbiAgICAgICAgICAgICAgICAvLyAxMSAgICAgICAgICAqIC0tLS0tLS0tXHRcdDwtLSB0aGlzIHNob3VsZCBzdGlsbCBiZSBhdCB0aGUgc2FtZSBsZXZlbCBhcyBpdGVtIGFib3ZlLCBzbyBpbmRlbnQgPSAyLlxuICAgICAgICAgICAgICAgIC8vIDEyICogLS0tLS0tLS1cdFx0XHRcdDwtLSB0aGlzIGFuZCBhbGwgYmVsb3cgYXJlIGxlZnQgdW5jaGFuZ2VkLlxuICAgICAgICAgICAgICAgIC8vIDEzICAgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyAxNCAgICAgICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBBZnRlciB0dXJuaW5nIG9mZiAzIHRoZSBsaXN0IGJlY29tZXM6XG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyAxICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gMiAgICAgKiAtLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gMyAgLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIDQgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyA1ICAgICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gNiAgKiAtLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIDcgICAgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyA4ICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gOSAgICAgKiAtLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIDEwICAgICAgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyAxMSAgICAgICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gMTIgKiAtLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIDEzICAgICogLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyAxNCAgICAgICAqIC0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBUaGFua3MgdG8gdGhpcyBhbGdvcml0aG0gbm8gbGlzdHMgYXJlIG1pc21hdGNoZWQgYW5kIG5vIGl0ZW1zIGdldCB1bmV4cGVjdGVkIGNoaWxkcmVuL3BhcmVudCwgd2hpbGVcbiAgICAgICAgICAgICAgICAvLyB0aG9zZSBwYXJlbnQtY2hpbGQgY29ubmVjdGlvbiB3aGljaCBhcmUgcG9zc2libGUgdG8gbWFpbnRhaW4gYXJlIHN0aWxsIG1haW50YWluZWQuIEl0J3Mgd29ydGggbm90aW5nXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB0aGlzIGlzIHRoZSBzYW1lIGVmZmVjdCB0aGF0IHdlIHdvdWxkIGJlIGdldCBieSBtdWx0aXBsZSB1c2Ugb2Ygb3V0ZGVudCBjb21tYW5kLiBIb3dldmVyIGRvaW5nXG4gICAgICAgICAgICAgICAgLy8gaXQgbGlrZSB0aGlzIGlzIG11Y2ggbW9yZSBlZmZpY2llbnQgYmVjYXVzZSBpdCdzIGxlc3Mgb3BlcmF0aW9uIChsZXNzIG1lbW9yeSB1c2FnZSwgZWFzaWVyIE9UKSBhbmRcbiAgICAgICAgICAgICAgICAvLyBsZXNzIGNvbnZlcnNpb24gKGZhc3RlcikuXG4gICAgICAgICAgICAgICAgd2hpbGUobmV4dCAmJiBuZXh0Lm5hbWUgPT0gJ2xpc3RJdGVtJyAmJiBuZXh0LmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpICE9PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZWFjaCBuZXh0IGxpc3QgaXRlbSwgYXMgbG9uZyBhcyBpdHMgaW5kZW50IGlzIGJpZ2dlciB0aGFuIDAuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbmRlbnQgaXMgMCB3ZSBhcmUgbm90IGdvaW5nIHRvIGNoYW5nZSBhbnl0aGluZyBhbnl3YXkuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGVudCA9IG5leHQuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGNoZWNrIGlmIHRoYXQncyBpdGVtIGluZGVudCBpcyBsb3dlciBhcyBjdXJyZW50IHJlbGF0aXZlIGluZGVudC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGVudCA8IGN1cnJlbnRJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGlzLCBjdXJyZW50IHJlbGF0aXZlIGluZGVudCBiZWNvbWVzIHRoYXQgaW5kZW50LlxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEluZGVudCA9IGluZGVudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBGaXggaW5kZW50IHJlbGF0aXZlbHkgdG8gY3VycmVudCByZWxhdGl2ZSBpbmRlbnQuXG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdGUsIHRoYXQgaWYgd2UganVzdCBjaGFuZ2VkIHRoZSBjdXJyZW50IHJlbGF0aXZlIGluZGVudCwgdGhlIG5ld0luZGVudCB3aWxsIGJlIGVxdWFsIHRvIDAuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0luZGVudCA9IGluZGVudCAtIGN1cnJlbnRJbmRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIGVudHJ5IGluIGNoYW5nZXMgYXJyYXkuIFdlIGRvIG5vdCBhcHBseSBpdCBhdCB0aGUgbW9tZW50LCBiZWNhdXNlIHdlIHdpbGwgbmVlZCB0b1xuICAgICAgICAgICAgICAgICAgICAvLyByZXZlcnNlIHRoZSBjaGFuZ2VzIHNvIHRoZSBsYXN0IGl0ZW0gaXMgY2hhbmdlZCBmaXJzdC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0byBrZWVwIG1vZGVsIGluIGNvcnJlY3Qgc3RhdGUgYWxsIHRoZSB0aW1lLlxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogbmV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RJbmRlbnQ6IG5ld0luZGVudFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBuZXh0IGl0ZW0uXG4gICAgICAgICAgICAgICAgICAgIG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjaGFuZ2VzID0gY2hhbmdlcy5yZXZlcnNlKCk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGNoYW5nZXMpe1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JywgaXRlbS5saXN0SW5kZW50LCBpdGVtLmVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlIGFyZSB0dXJuaW5nIG9uLCB3ZSBtaWdodCBjaGFuZ2Ugc29tZSBpdGVtcyB0aGF0IGFyZSBhbHJlYWR5IGBsaXN0SXRlbWBzIGJ1dCB3aXRoIGRpZmZlcmVudCB0eXBlLlxuICAgICAgICAgICAgLy8gQ2hhbmdpbmcgb25lIG5lc3RlZCBsaXN0IGl0ZW0gdG8gb3RoZXIgdHlwZSBzaG91bGQgYWxzbyB0cmlnZ2VyIGNoYW5naW5nIGFsbCBpdHMgc2libGluZ3Mgc28gdGhlXG4gICAgICAgICAgICAvLyB3aG9sZSBuZXN0ZWQgbGlzdCBpcyBvZiB0aGUgc2FtZSB0eXBlLlxuICAgICAgICAgICAgLy8gRXhhbXBsZSAoYXNzdW1lIGNoYW5naW5nIHRvIG51bWJlcmVkIGxpc3QpOlxuICAgICAgICAgICAgLy8gKiAtLS0tLS1cdFx0XHRcdDwtLSBkbyBub3QgZml4LCB0b3AgbGV2ZWwgaXRlbVxuICAgICAgICAgICAgLy8gICAqIC0tLS0tLVx0XHRcdDwtLSBmaXgsIGJlY2F1c2UgbGF0dGVyIGxpc3QgaXRlbSBvZiB0aGlzIGl0ZW0ncyBsaXN0IGlzIGNoYW5nZWRcbiAgICAgICAgICAgIC8vICAgICAgKiAtLS0tLS1cdFx0PC0tIGRvIG5vdCBmaXgsIGl0ZW0gaXMgbm90IGFmZmVjdGVkIChkaWZmZXJlbnQgbGlzdClcbiAgICAgICAgICAgIC8vICAgKiAtLS0tLS1cdFx0XHQ8LS0gZml4LCBiZWNhdXNlIGxhdHRlciBsaXN0IGl0ZW0gb2YgdGhpcyBpdGVtJ3MgbGlzdCBpcyBjaGFuZ2VkXG4gICAgICAgICAgICAvLyAgICAgICogLS0tLS0tXHRcdDwtLSBmaXgsIGJlY2F1c2UgbGF0dGVyIGxpc3QgaXRlbSBvZiB0aGlzIGl0ZW0ncyBsaXN0IGlzIGNoYW5nZWRcbiAgICAgICAgICAgIC8vICAgICAgKiAtLS1bLS1cdFx0PC0tIGFscmVhZHkgaW4gc2VsZWN0aW9uXG4gICAgICAgICAgICAvLyAgICogLS0tLS0tXHRcdFx0PC0tIGFscmVhZHkgaW4gc2VsZWN0aW9uXG4gICAgICAgICAgICAvLyAgICogLS0tLS0tXHRcdFx0PC0tIGFscmVhZHkgaW4gc2VsZWN0aW9uXG4gICAgICAgICAgICAvLyAqIC0tLS0tLVx0XHRcdFx0PC0tIGFscmVhZHkgaW4gc2VsZWN0aW9uLCBidXQgZG9lcyBub3QgY2F1c2Ugb3RoZXIgbGlzdCBpdGVtcyB0byBjaGFuZ2UgYmVjYXVzZSBpcyB0b3AtbGV2ZWxcbiAgICAgICAgICAgIC8vICAgKiAtLS1dLS1cdFx0XHQ8LS0gYWxyZWFkeSBpbiBzZWxlY3Rpb25cbiAgICAgICAgICAgIC8vICAgKiAtLS0tLS1cdFx0XHQ8LS0gZml4LCBiZWNhdXNlIHByZWNlZGluZyBsaXN0IGl0ZW0gb2YgdGhpcyBpdGVtJ3MgbGlzdCBpcyBjaGFuZ2VkXG4gICAgICAgICAgICAvLyAgICAgICogLS0tLS0tXHRcdDwtLSBkbyBub3QgZml4LCBpdGVtIGlzIG5vdCBhZmZlY3RlZCAoZGlmZmVyZW50IGxpc3QpXG4gICAgICAgICAgICAvLyAqIC0tLS0tLVx0XHRcdFx0PC0tIGRvIG5vdCBmaXgsIHRvcCBsZXZlbCBpdGVtXG4gICAgICAgICAgICBpZiAoIXR1cm5PZmYpIHtcbiAgICAgICAgICAgICAgICAvLyBGaW5kIGxvd2VzdCBpbmRlbnQgYW1vbmcgc2VsZWN0ZWQgaXRlbXMuIFRoaXMgd2lsbCBiZSBpbmRpY2F0b3Igd2hhdCBpcyB0aGUgaW5kZW50IG9mXG4gICAgICAgICAgICAgICAgLy8gdG9wLW1vc3QgbGlzdCBhZmZlY3RlZCBieSB0aGUgY29tbWFuZC5cbiAgICAgICAgICAgICAgICBsZXQgbG93ZXN0SW5kZW50ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBibG9ja3Mpe1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpICYmIGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgPCBsb3dlc3RJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VzdEluZGVudCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRG8gbm90IGV4ZWN1dGUgdGhlIGZpeCBmb3IgdG9wLWxldmVsIGxpc3RzLlxuICAgICAgICAgICAgICAgIGxvd2VzdEluZGVudCA9IGxvd2VzdEluZGVudCA9PT0gMCA/IDEgOiBsb3dlc3RJbmRlbnQ7XG4gICAgICAgICAgICAgICAgLy8gRml4IHR5cGVzIG9mIGxpc3QgaXRlbXMgdGhhdCBhcmUgXCJiZWZvcmVcIiB0aGUgc2VsZWN0ZWQgYmxvY2tzLlxuICAgICAgICAgICAgICAgIF9maXhUeXBlKGJsb2NrcywgdHJ1ZSwgbG93ZXN0SW5kZW50KTtcbiAgICAgICAgICAgICAgICAvLyBGaXggdHlwZXMgb2YgbGlzdCBpdGVtcyB0aGF0IGFyZSBcImFmdGVyXCIgdGhlIHNlbGVjdGVkIGJsb2Nrcy5cbiAgICAgICAgICAgICAgICBfZml4VHlwZShibG9ja3MsIGZhbHNlLCBsb3dlc3RJbmRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUGhldyEgTm93IGl0IHdpbGwgYmUgZWFzaWVyIDopLlxuICAgICAgICAgICAgLy8gRm9yIGVhY2ggYmxvY2sgZWxlbWVudCB0aGF0IHdhcyBpbiB0aGUgc2VsZWN0aW9uLCB3ZSB3aWxsIGVpdGhlcjogdHVybiBpdCB0byBsaXN0IGl0ZW0sXG4gICAgICAgICAgICAvLyB0dXJuIGl0IHRvIHBhcmFncmFwaCwgb3IgY2hhbmdlIGl0J3MgdHlwZS4gT3IgbGVhdmUgaXQgYXMgaXQgaXMuXG4gICAgICAgICAgICAvLyBEbyBpdCBpbiByZXZlcnNlIGFzIHRoZXJlIG1pZ2h0IGJlIG11bHRpcGxlIGJsb2NrcyAoc2FtZSBhcyB3aXRoIGNoYW5naW5nIGluZGVudHMpLlxuICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGJsb2Nrcy5yZXZlcnNlKCkpe1xuICAgICAgICAgICAgICAgIGlmICh0dXJuT2ZmICYmIGVsZW1lbnQubmFtZSA9PSAnbGlzdEl0ZW0nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIGFyZSB0dXJuaW5nIG9mZiBhbmQgdGhlIGVsZW1lbnQgaXMgYSBgbGlzdEl0ZW1gIC0gaXQgc2hvdWxkIGJlIGNvbnZlcnRlZCB0byBgcGFyYWdyYXBoYC5cbiAgICAgICAgICAgICAgICAgICAgLy8gTGlzdCBpdGVtIHNwZWNpZmljIGF0dHJpYnV0ZXMgYXJlIHJlbW92ZWQgYnkgcG9zdCBmaXhlci5cbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbmFtZShlbGVtZW50LCAncGFyYWdyYXBoJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdHVybk9mZiAmJiBlbGVtZW50Lm5hbWUgIT0gJ2xpc3RJdGVtJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBhcmUgdHVybmluZyBvbiBhbmQgdGhlIGVsZW1lbnQgaXMgbm90IGEgYGxpc3RJdGVtYCAtIGl0IHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYGxpc3RJdGVtYC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG9yZGVyIG9mIG9wZXJhdGlvbnMgaXMgaW1wb3J0YW50IHRvIGtlZXAgbW9kZWwgaW4gY29ycmVjdCBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdFR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RJbmRlbnQ6IDBcbiAgICAgICAgICAgICAgICAgICAgfSwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW5hbWUoZWxlbWVudCwgJ2xpc3RJdGVtJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdHVybk9mZiAmJiBlbGVtZW50Lm5hbWUgPT0gJ2xpc3RJdGVtJyAmJiBlbGVtZW50LmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPSB0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIHR1cm5pbmcgb24gYW5kIHRoZSBlbGVtZW50IGlzIGEgYGxpc3RJdGVtYCBidXQgaGFzIGRpZmZlcmVudCB0eXBlIC0gY2hhbmdlIGl0J3MgdHlwZSBhbmRcbiAgICAgICAgICAgICAgICAgICAgLy8gdHlwZSBvZiBpdCdzIGFsbCBzaWJsaW5ncyB0aGF0IGhhdmUgc2FtZSBpbmRlbnQuXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgdGhpcy50eXBlLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcblx0XHRcdCAqIEV2ZW50IGZpcmVkIGJ5IHRoZSB7QGxpbmsgI2V4ZWN1dGV9IG1ldGhvZC5cblx0XHRcdCAqXG5cdFx0XHQgKiBJdCBhbGxvd3MgdG8gZXhlY3V0ZSBhbiBhY3Rpb24gYWZ0ZXIgZXhlY3V0aW5nIHRoZSB7QGxpbmsgfkxpc3RDb21tYW5kI2V4ZWN1dGV9IG1ldGhvZCwgZm9yIGV4YW1wbGUgYWRqdXN0aW5nXG5cdFx0XHQgKiBhdHRyaWJ1dGVzIG9mIGNoYW5nZWQgYmxvY2tzLlxuXHRcdFx0ICpcblx0XHRcdCAqIEBwcm90ZWN0ZWRcblx0XHRcdCAqIEBldmVudCBfZXhlY3V0ZUNsZWFudXBcblx0XHRcdCAqLyB0aGlzLmZpcmUoJ19leGVjdXRlQ2xlYW51cCcsIGJsb2Nrcyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHRoZSBjb21tYW5kJ3Mge0BsaW5rICN2YWx1ZX0uXG5cdCAqXG5cdCAqIEByZXR1cm5zIFRoZSBjdXJyZW50IHZhbHVlLlxuXHQgKi8gX2dldFZhbHVlKCkge1xuICAgICAgICAvLyBDaGVjayB3aGV0aGVyIGNsb3Nlc3QgYGxpc3RJdGVtYCBhbmNlc3RvciBvZiB0aGUgcG9zaXRpb24gaGFzIGEgY29ycmVjdCB0eXBlLlxuICAgICAgICBjb25zdCBsaXN0SXRlbSA9IGZpcnN0KHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpKTtcbiAgICAgICAgcmV0dXJuICEhbGlzdEl0ZW0gJiYgbGlzdEl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSAmJiBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gdGhpcy50eXBlO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGNvbW1hbmQgY2FuIGJlIGVuYWJsZWQgaW4gdGhlIGN1cnJlbnQgY29udGV4dC5cblx0ICpcblx0ICogQHJldHVybnMgV2hldGhlciB0aGUgY29tbWFuZCBzaG91bGQgYmUgZW5hYmxlZC5cblx0ICovIF9jaGVja0VuYWJsZWQoKSB7XG4gICAgICAgIC8vIElmIGNvbW1hbmQgdmFsdWUgaXMgdHJ1ZSBpdCBtZWFucyB0aGF0IHdlIGFyZSBpbiBsaXN0IGl0ZW0sIHNvIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuICAgICAgICBpZiAodGhpcy52YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLmVkaXRvci5tb2RlbC5zY2hlbWE7XG4gICAgICAgIGNvbnN0IGZpcnN0QmxvY2sgPSBmaXJzdChzZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKSk7XG4gICAgICAgIGlmICghZmlyc3RCbG9jaykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIE90aGVyd2lzZSwgY2hlY2sgaWYgbGlzdCBpdGVtIGNhbiBiZSBpbnNlcnRlZCBhdCB0aGUgcG9zaXRpb24gc3RhcnQuXG4gICAgICAgIHJldHVybiBjaGVja0NhbkJlY29tZUxpc3RJdGVtKGZpcnN0QmxvY2ssIHNjaGVtYSk7XG4gICAgfVxufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdXNlZCB3aGVuIG9uZSBvciBtb3JlIGxpc3QgaXRlbSBoYXZlIHRoZWlyIHR5cGUgY2hhbmdlZC4gRml4ZXMgdHlwZSBvZiBvdGhlciBsaXN0IGl0ZW1zXG4gKiB0aGF0IGFyZSBhZmZlY3RlZCBieSB0aGUgY2hhbmdlIChhcmUgaW4gc2FtZSBsaXN0cykgYnV0IGFyZSBub3QgZGlyZWN0bHkgaW4gc2VsZWN0aW9uLiBUaGUgZnVuY3Rpb24gZ290IGV4dHJhY3RlZFxuICogbm90IHRvIGR1cGxpY2F0ZWQgY29kZSwgYXMgc2FtZSBmaXggaGFzIHRvIGJlIHBlcmZvcm1lZCBiZWZvcmUgYW5kIGFmdGVyIHNlbGVjdGlvbi5cbiAqXG4gKiBAcGFyYW0gYmxvY2tzIEJsb2NrcyB0aGF0IGFyZSBpbiBzZWxlY3Rpb24uXG4gKiBAcGFyYW0gaXNCYWNrd2FyZCBTcGVjaWZpZWQgd2hldGhlciBmaXggd2lsbCBiZSBhcHBsaWVkIGZvciBibG9ja3MgYmVmb3JlIGZpcnN0IHNlbGVjdGVkIGJsb2NrIChgdHJ1ZWApXG4gKiBvciBibG9ja3MgYWZ0ZXIgbGFzdCBzZWxlY3RlZCBibG9jayAoYGZhbHNlYCkuXG4gKiBAcGFyYW0gbG93ZXN0SW5kZW50IExvd2VzdCBpbmRlbnQgYW1vbmcgc2VsZWN0ZWQgYmxvY2tzLlxuICovIGZ1bmN0aW9uIF9maXhUeXBlKGJsb2NrcywgaXNCYWNrd2FyZCwgbG93ZXN0SW5kZW50KSB7XG4gICAgLy8gV2UgbmVlZCB0byBjaGVjayBwcmV2aW91cyBzaWJsaW5nIG9mIGZpcnN0IGNoYW5nZWQgaXRlbSBhbmQgbmV4dCBzaWJsaW5ncyBvZiBsYXN0IGNoYW5nZWQgaXRlbS5cbiAgICBjb25zdCBzdGFydGluZ0l0ZW0gPSBpc0JhY2t3YXJkID8gYmxvY2tzWzBdIDogYmxvY2tzW2Jsb2Nrcy5sZW5ndGggLSAxXTtcbiAgICBpZiAoc3RhcnRpbmdJdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgbGV0IGl0ZW0gPSBzdGFydGluZ0l0ZW1baXNCYWNrd2FyZCA/ICdwcmV2aW91c1NpYmxpbmcnIDogJ25leHRTaWJsaW5nJ107XG4gICAgICAgIC8vIER1cmluZyBwcm9jZXNzaW5nIGl0ZW1zLCBrZWVwcyB0aGUgbG93ZXN0IGluZGVudCBvZiBhbHJlYWR5IHByb2Nlc3NlZCBpdGVtcy5cbiAgICAgICAgLy8gVGhpcyBzYXZlcyB1cyBmcm9tIGNoYW5naW5nIHRvbyBtYW55IGl0ZW1zLlxuICAgICAgICAvLyBGb2xsb3dpbmcgZXhhbXBsZSBpcyBmb3IgZ29pbmcgZm9yd2FyZCBhcyBpdCBpcyBlYXNpZXIgdG8gcmVhZCwgaG93ZXZlciBzYW1lIGFwcGxpZXMgdG8gZ29pbmcgYmFja3dhcmQuXG4gICAgICAgIC8vICogLS0tLS0tXG4gICAgICAgIC8vICAgKiAtLS0tLS1cbiAgICAgICAgLy8gICAgICogLS1bLS0tXG4gICAgICAgIC8vICAgKiAtLS0tLS1cdFx0PC0tIGBsb3dlc3RJbmRlbnRgIHNob3VsZCBiZSAxXG4gICAgICAgIC8vICAgICAqIC0tXS0tLVx0XHQ8LS0gYHN0YXJ0aW5nSXRlbWAsIGBjdXJyZW50SW5kZW50YCA9IDIsIGBsb3dlc3RJbmRlbnRgID09IDFcbiAgICAgICAgLy8gICAgICogLS0tLS0tXHRcdDwtLSBzaG91bGQgYmUgZml4ZWQsIGBpbmRlbnRgID09IDIgPT0gYGN1cnJlbnRJbmRlbnRgXG4gICAgICAgIC8vICAgKiAtLS0tLS1cdFx0PC0tIHNob3VsZCBiZSBmaXhlZCwgc2V0IGBjdXJyZW50SW5kZW50YCB0byAxLCBgaW5kZW50YCA9PSAxID09IGBjdXJyZW50SW5kZW50YFxuICAgICAgICAvLyAgICAgKiAtLS0tLS1cdFx0PC0tIHNob3VsZCBub3QgYmUgZml4ZWQsIGl0ZW0gaXMgaW4gZGlmZmVyZW50IGxpc3QsIGBpbmRlbnRgID0gMiwgYGluZGVudGAgIT0gYGN1cnJlbnRJbmRlbnRgXG4gICAgICAgIC8vICAgKiAtLS0tLS1cdFx0PC0tIHNob3VsZCBiZSBmaXhlZCwgYGluZGVudGAgPT0gMSA9PSBgY3VycmVudEluZGVudGBcbiAgICAgICAgLy8gKiAtLS0tLS1cdFx0XHQ8LS0gYnJlYWsgbG9vcCAoYGluZGVudGAgPCBgbG93ZXN0SW5kZW50YClcbiAgICAgICAgbGV0IGN1cnJlbnRJbmRlbnQgPSBzdGFydGluZ0l0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgIC8vIExvb2sgYmFjayB1bnRpbCBhIGxpc3QgaXRlbSB3aXRoIGluZGVudCBsb3dlciB0aGFuIHJlZmVyZW5jZSBgbG93ZXN0SW5kZW50YC5cbiAgICAgICAgLy8gVGhhdCB3b3VsZCBiZSB0aGUgcGFyZW50IG9mIG5lc3RlZCBzdWJsaXN0IHdoaWNoIGNvbnRhaW5zIGl0ZW0gaGF2aW5nIGBsb3dlc3RJbmRlbnRgLlxuICAgICAgICB3aGlsZShpdGVtICYmIGl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSAmJiBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID49IGxvd2VzdEluZGVudCl7XG4gICAgICAgICAgICBpZiAoY3VycmVudEluZGVudCA+IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50SW5kZW50ID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZvdW5kIGFuIGl0ZW0gdGhhdCBpcyBpbiB0aGUgc2FtZSBuZXN0ZWQgc3VibGlzdC5cbiAgICAgICAgICAgIGlmIChpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID09IGN1cnJlbnRJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAvLyBKdXN0IGFkZCB0aGUgaXRlbSB0byBzZWxlY3RlZCBibG9ja3MgbGlrZSBpdCB3YXMgc2VsZWN0ZWQgYnkgdGhlIHVzZXIuXG4gICAgICAgICAgICAgICAgYmxvY2tzW2lzQmFja3dhcmQgPyAndW5zaGlmdCcgOiAncHVzaCddKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbSA9IGl0ZW1baXNCYWNrd2FyZCA/ICdwcmV2aW91c1NpYmxpbmcnIDogJ25leHRTaWJsaW5nJ107XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBibG9jayBjYW4gYmUgcmVwbGFjZWQgYnkgYSBsaXN0SXRlbS5cbiAqXG4gKiBAcGFyYW0gYmxvY2sgQSBibG9jayB0byBiZSB0ZXN0ZWQuXG4gKiBAcGFyYW0gc2NoZW1hIFRoZSBzY2hlbWEgb2YgdGhlIGRvY3VtZW50LlxuICovIGZ1bmN0aW9uIGNoZWNrQ2FuQmVjb21lTGlzdEl0ZW0oYmxvY2ssIHNjaGVtYSkge1xuICAgIHJldHVybiBzY2hlbWEuY2hlY2tDaGlsZChibG9jay5wYXJlbnQsICdsaXN0SXRlbScpICYmICFzY2hlbWEuaXNPYmplY3QoYmxvY2spO1xufVxuXG4vKipcbiAqIFRoZSBsaXN0IGluZGVudCBjb21tYW5kLiBJdCBpcyB1c2VkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGVnYWN5bGlzdH5MZWdhY3lMaXN0IGxlZ2FjeSBsaXN0IGZlYXR1cmV9LlxuICovIGNsYXNzIExlZ2FjeUluZGVudENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogRGV0ZXJtaW5lcyBieSBob3cgbXVjaCB0aGUgY29tbWFuZCB3aWxsIGNoYW5nZSB0aGUgbGlzdCBpdGVtJ3MgaW5kZW50IGF0dHJpYnV0ZS5cblx0ICovIF9pbmRlbnRCeTtcbiAgICAvKipcblx0ICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiB0aGUgY29tbWFuZC5cblx0ICpcblx0ICogQHBhcmFtIGVkaXRvciBUaGUgZWRpdG9yIGluc3RhbmNlLlxuXHQgKiBAcGFyYW0gaW5kZW50RGlyZWN0aW9uIFRoZSBkaXJlY3Rpb24gb2YgaW5kZW50LiBJZiBpdCBpcyBlcXVhbCB0byBgYmFja3dhcmRgLCB0aGUgY29tbWFuZCB3aWxsIG91dGRlbnQgYSBsaXN0IGl0ZW0uXG5cdCAqLyBjb25zdHJ1Y3RvcihlZGl0b3IsIGluZGVudERpcmVjdGlvbil7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIHRoaXMuX2luZGVudEJ5ID0gaW5kZW50RGlyZWN0aW9uID09ICdmb3J3YXJkJyA/IDEgOiAtMTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyByZWZyZXNoKCkge1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHRoaXMuX2NoZWNrRW5hYmxlZCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogSW5kZW50cyBvciBvdXRkZW50cyAoZGVwZW5kaW5nIG9uIHRoZSB7QGxpbmsgI2NvbnN0cnVjdG9yfSdzIGBpbmRlbnREaXJlY3Rpb25gIHBhcmFtZXRlcikgc2VsZWN0ZWQgbGlzdCBpdGVtcy5cblx0ICpcblx0ICogQGZpcmVzIGV4ZWN1dGVcblx0ICovIGV4ZWN1dGUoKSB7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGRvYyA9IG1vZGVsLmRvY3VtZW50O1xuICAgICAgICBsZXQgaXRlbXNUb0NoYW5nZSA9IEFycmF5LmZyb20oZG9jLnNlbGVjdGlvbi5nZXRTZWxlY3RlZEJsb2NrcygpKTtcbiAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBjb25zdCBsYXN0SXRlbSA9IGl0ZW1zVG9DaGFuZ2VbaXRlbXNUb0NoYW5nZS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIC8vIEluZGVudGluZyBhIGxpc3QgaXRlbSBzaG91bGQgYWxzbyBpbmRlbnQgYWxsIHRoZSBpdGVtcyB0aGF0IGFyZSBhbHJlYWR5IHN1Yi1pdGVtcyBvZiBpbmRlbnRlZCBpdGVtLlxuICAgICAgICAgICAgbGV0IG5leHQgPSBsYXN0SXRlbS5uZXh0U2libGluZztcbiAgICAgICAgICAgIC8vIENoZWNrIGFsbCBpdGVtcyBhZnRlciBsYXN0IGluZGVudGVkIGl0ZW0sIGFzIGxvbmcgYXMgdGhlaXIgaW5kZW50IGlzIGJpZ2dlciB0aGFuIGluZGVudCBvZiB0aGF0IGl0ZW0uXG4gICAgICAgICAgICB3aGlsZShuZXh0ICYmIG5leHQubmFtZSA9PSAnbGlzdEl0ZW0nICYmIG5leHQuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgPiBsYXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSl7XG4gICAgICAgICAgICAgICAgaXRlbXNUb0NoYW5nZS5wdXNoKG5leHQpO1xuICAgICAgICAgICAgICAgIG5leHQgPSBuZXh0Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBiZSBzdXJlIHRvIGtlZXAgbW9kZWwgaW4gY29ycmVjdCBzdGF0ZSBhZnRlciBlYWNoIHNtYWxsIGNoYW5nZSwgYmVjYXVzZSBjb252ZXJ0ZXJzXG4gICAgICAgICAgICAvLyBiYXNlcyBvbiB0aGF0IHN0YXRlIGFuZCBhc3N1bWVzIHRoYXQgbW9kZWwgaXMgY29ycmVjdC5cbiAgICAgICAgICAgIC8vIEJlY2F1c2Ugb2YgdGhhdCwgaWYgdGhlIGNvbW1hbmQgb3V0ZGVudHMgaXRlbXMsIHdlIHdpbGwgb3V0ZGVudCB0aGVtIHN0YXJ0aW5nIGZyb20gdGhlIGxhc3QgaXRlbSwgYXNcbiAgICAgICAgICAgIC8vIGl0IGlzIHNhZmVyLlxuICAgICAgICAgICAgaWYgKHRoaXMuX2luZGVudEJ5IDwgMCkge1xuICAgICAgICAgICAgICAgIGl0ZW1zVG9DaGFuZ2UgPSBpdGVtc1RvQ2hhbmdlLnJldmVyc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtc1RvQ2hhbmdlKXtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRlbnQgPSBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpICsgdGhpcy5faW5kZW50Qnk7XG4gICAgICAgICAgICAgICAgLy8gSWYgaW5kZW50IGlzIGxvd2VyIHRoYW4gMCwgaXQgbWVhbnMgdGhhdCB0aGUgaXRlbSBnb3Qgb3V0ZGVudGVkIHdoZW4gaXQgd2FzIG5vdCBpbmRlbnRlZC5cbiAgICAgICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgd2UgbmVlZCB0byBjb252ZXJ0IHRoYXQgbGlzdCBpdGVtIHRvIHBhcmFncmFwaC5cbiAgICAgICAgICAgICAgICBpZiAoaW5kZW50IDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUbyBrZWVwIHRoZSBtb2RlbCBhcyBjb3JyZWN0IGFzIHBvc3NpYmxlLCBmaXJzdCByZW5hbWUgbGlzdEl0ZW0sIHRoZW4gcmVtb3ZlIGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgIC8vIGFzIGxpc3RJdGVtIHdpdGhvdXQgYXR0cmlidXRlcyBpcyB2ZXJ5IGluY29ycmVjdCBhbmQgd2lsbCBjYXVzZSBwcm9ibGVtcyBpbiBjb252ZXJ0ZXJzLlxuICAgICAgICAgICAgICAgICAgICAvLyBObyBuZWVkIHRvIHJlbW92ZSBhdHRyaWJ1dGVzLCB3aWxsIGJlIHJlbW92ZWQgYnkgcG9zdCBmaXhlci5cbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbmFtZShpdGVtLCAncGFyYWdyYXBoJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcsIGluZGVudCwgaXRlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSXQgYWxsb3dzIHRvIGV4ZWN1dGUgYW4gYWN0aW9uIGFmdGVyIGV4ZWN1dGluZyB0aGUgYH5JbmRlbnRDb21tYW5kI2V4ZWN1dGVgIG1ldGhvZCwgZm9yIGV4YW1wbGUgYWRqdXN0aW5nXG4gICAgICAgICAgICAvLyBhdHRyaWJ1dGVzIG9mIGNoYW5nZWQgbGlzdCBpdGVtcy5cbiAgICAgICAgICAgIHRoaXMuZmlyZSgnX2V4ZWN1dGVDbGVhbnVwJywgaXRlbXNUb0NoYW5nZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHdoZXRoZXIgdGhlIGNvbW1hbmQgY2FuIGJlIGVuYWJsZWQgaW4gdGhlIGN1cnJlbnQgY29udGV4dC5cblx0ICpcblx0ICogQHJldHVybnMgV2hldGhlciB0aGUgY29tbWFuZCBzaG91bGQgYmUgZW5hYmxlZC5cblx0ICovIF9jaGVja0VuYWJsZWQoKSB7XG4gICAgICAgIC8vIENoZWNrIHdoZXRoZXIgYW55IG9mIHBvc2l0aW9uJ3MgYW5jZXN0b3IgaXMgYSBsaXN0IGl0ZW0uXG4gICAgICAgIGNvbnN0IGxpc3RJdGVtID0gZmlyc3QodGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmdldFNlbGVjdGVkQmxvY2tzKCkpO1xuICAgICAgICAvLyBJZiBzZWxlY3Rpb24gaXMgbm90IGluIGEgbGlzdCBpdGVtLCB0aGUgY29tbWFuZCBpcyBkaXNhYmxlZC5cbiAgICAgICAgaWYgKCFsaXN0SXRlbSB8fCAhbGlzdEl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9pbmRlbnRCeSA+IDApIHtcbiAgICAgICAgICAgIC8vIENhbm5vdCBpbmRlbnQgZmlyc3QgaXRlbSBpbiBpdCdzIGxpc3QuIENoZWNrIGlmIGJlZm9yZSBgbGlzdEl0ZW1gIGlzIGEgbGlzdCBpdGVtIHRoYXQgaXMgaW4gc2FtZSBsaXN0LlxuICAgICAgICAgICAgLy8gVG8gYmUgaW4gdGhlIHNhbWUgbGlzdCwgdGhlIGl0ZW0gaGFzIHRvIGhhdmUgc2FtZSBhdHRyaWJ1dGVzIGFuZCBjYW5ub3QgYmUgXCJzcGxpdFwiIGJ5IGFuIGl0ZW0gd2l0aCBsb3dlciBpbmRlbnQuXG4gICAgICAgICAgICBjb25zdCBpbmRlbnQgPSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJyk7XG4gICAgICAgICAgICBsZXQgcHJldiA9IGxpc3RJdGVtLnByZXZpb3VzU2libGluZztcbiAgICAgICAgICAgIHdoaWxlKHByZXYgJiYgcHJldi5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpICYmIHByZXYuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgPj0gaW5kZW50KXtcbiAgICAgICAgICAgICAgICBpZiAocHJldi5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSA9PSBpbmRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGl0ZW0gaXMgb24gdGhlIHNhbWUgbGV2ZWwuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGhhcyBzYW1lIHR5cGUsIGl0IG1lYW5zIHRoYXQgd2UgZm91bmQgYSBwcmVjZWRpbmcgc2libGluZyBmcm9tIHRoZSBzYW1lIGxpc3QuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGl0IGRvZXMgbm90IGhhdmUgc2FtZSB0eXBlLCBpdCBtZWFucyB0aGF0IGBsaXN0SXRlbWAgaXMgb24gZGlmZmVyZW50IGxpc3QgKHRoaXMgY2FuIGhhcHBlbiBvbmx5XG4gICAgICAgICAgICAgICAgICAgIC8vIG9uIHRvcCBsZXZlbCBsaXN0cywgdGhvdWdoKS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZXYuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09IHR5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByZXYgPSBwcmV2LnByZXZpb3VzU2libGluZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENvdWxkIG5vdCBmaW5kIHNpbWlsYXIgbGlzdCBpdGVtLCB0aGlzIG1lYW5zIHRoYXQgYGxpc3RJdGVtYCBpcyBmaXJzdCBpbiBpdHMgbGlzdC5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBhcmUgb3V0ZGVudGluZyBpdCBpcyBlbm91Z2ggdG8gYmUgaW4gbGlzdCBpdGVtLiBFdmVyeSBsaXN0IGl0ZW0gY2FuIGFsd2F5cyBiZSBvdXRkZW50ZWQuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbGlzdCBpdGVtIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvY29udGFpbmVyZWxlbWVudH5Db250YWluZXJFbGVtZW50fS5cbiAqXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSB3cml0ZXIgaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gY3JlYXRlVmlld0xpc3RJdGVtRWxlbWVudCh3cml0ZXIpIHtcbiAgICBjb25zdCB2aWV3SXRlbSA9IHdyaXRlci5jcmVhdGVDb250YWluZXJFbGVtZW50KCdsaScpO1xuICAgIHZpZXdJdGVtLmdldEZpbGxlck9mZnNldCA9IGdldExpc3RJdGVtRmlsbGVyT2Zmc2V0O1xuICAgIHJldHVybiB2aWV3SXRlbTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIGA8dWw+PGxpPjwvbGk+PC91bD5gIG9yIChgPG9sPmApIHN0cnVjdHVyZSBvdXQgb2YgdGhlIGdpdmVuIGBtb2RlbEl0ZW1gIG1vZGVsIGBsaXN0SXRlbWAgZWxlbWVudC5cbiAqIFRoZW4sIGl0IGJpbmRzIHRoZSBjcmVhdGVkIHZpZXcgbGlzdCBpdGVtIChgPGxpPmApIHdpdGggdGhlIG1vZGVsIGBsaXN0SXRlbWAgZWxlbWVudC5cbiAqIFRoZSBmdW5jdGlvbiB0aGVuIHJldHVybnMgdGhlIGNyZWF0ZWQgdmlldyBsaXN0IGl0ZW0gKGA8bGk+YCkuXG4gKlxuICogQHBhcmFtIG1vZGVsSXRlbSBNb2RlbCBsaXN0IGl0ZW0uXG4gKiBAcGFyYW0gY29udmVyc2lvbkFwaSBDb252ZXJzaW9uIGludGVyZmFjZS5cbiAqIEByZXR1cm5zIFZpZXcgbGlzdCBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGdlbmVyYXRlTGlJblVsKG1vZGVsSXRlbSwgY29udmVyc2lvbkFwaSkge1xuICAgIGNvbnN0IG1hcHBlciA9IGNvbnZlcnNpb25BcGkubWFwcGVyO1xuICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICBjb25zdCBsaXN0VHlwZSA9IG1vZGVsSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ251bWJlcmVkJyA/ICdvbCcgOiAndWwnO1xuICAgIGNvbnN0IHZpZXdJdGVtID0gY3JlYXRlVmlld0xpc3RJdGVtRWxlbWVudCh2aWV3V3JpdGVyKTtcbiAgICBjb25zdCB2aWV3TGlzdCA9IHZpZXdXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudChsaXN0VHlwZSwgbnVsbCk7XG4gICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHZpZXdMaXN0LCAwKSwgdmlld0l0ZW0pO1xuICAgIG1hcHBlci5iaW5kRWxlbWVudHMobW9kZWxJdGVtLCB2aWV3SXRlbSk7XG4gICAgcmV0dXJuIHZpZXdJdGVtO1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdGhhdCBpbnNlcnRzIGEgdmlldyBsaXN0IGF0IGEgY29ycmVjdCBwbGFjZSBhbmQgbWVyZ2VzIGl0IHdpdGggaXRzIHNpYmxpbmdzLlxuICogSXQgdGFrZXMgYSBtb2RlbCBsaXN0IGl0ZW0gZWxlbWVudCAoYG1vZGVsSXRlbWApIGFuZCBhIGNvcnJlc3BvbmRpbmcgdmlldyBsaXN0IGl0ZW0gZWxlbWVudCAoYGluamVjdGVkSXRlbWApLiBUaGUgdmlldyBsaXN0IGl0ZW1cbiAqIHNob3VsZCBiZSBpbiBhIHZpZXcgbGlzdCBlbGVtZW50IChgPHVsPmAgb3IgYDxvbD5gKSBhbmQgc2hvdWxkIGJlIGl0cyBvbmx5IGNoaWxkLlxuICogU2VlIGNvbW1lbnRzIGJlbG93IHRvIGJldHRlciB1bmRlcnN0YW5kIHRoZSBhbGdvcml0aG0uXG4gKlxuICogQHBhcmFtIG1vZGVsSXRlbSBNb2RlbCBsaXN0IGl0ZW0uXG4gKiBAcGFyYW0gaW5qZWN0ZWRJdGVtXG4gKiBAcGFyYW0gY29udmVyc2lvbkFwaSBDb252ZXJzaW9uIGludGVyZmFjZS5cbiAqIEBwYXJhbSBtb2RlbCBUaGUgbW9kZWwgaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gaW5qZWN0Vmlld0xpc3QobW9kZWxJdGVtLCBpbmplY3RlZEl0ZW0sIGNvbnZlcnNpb25BcGksIG1vZGVsKSB7XG4gICAgY29uc3QgaW5qZWN0ZWRMaXN0ID0gaW5qZWN0ZWRJdGVtLnBhcmVudDtcbiAgICBjb25zdCBtYXBwZXIgPSBjb252ZXJzaW9uQXBpLm1hcHBlcjtcbiAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgLy8gVGhlIHBvc2l0aW9uIHdoZXJlIHRoZSB2aWV3IGxpc3Qgd2lsbCBiZSBpbnNlcnRlZC5cbiAgICBsZXQgaW5zZXJ0UG9zaXRpb24gPSBtYXBwZXIudG9WaWV3UG9zaXRpb24obW9kZWwuY3JlYXRlUG9zaXRpb25CZWZvcmUobW9kZWxJdGVtKSk7XG4gICAgLy8gMS4gRmluZCB0aGUgcHJldmlvdXMgbGlzdCBpdGVtIHRoYXQgaGFzIHRoZSBzYW1lIG9yIHNtYWxsZXIgaW5kZW50LiBCYXNpY2FsbHkgd2UgYXJlIGxvb2tpbmcgZm9yIHRoZSBmaXJzdCBtb2RlbCBpdGVtXG4gICAgLy8gdGhhdCBpcyBhIFwicGFyZW50XCIgb3IgXCJzaWJsaW5nXCIgb2YgdGhlIGluamVjdGVkIG1vZGVsIGl0ZW0uXG4gICAgLy8gSWYgdGhlcmUgaXMgbm8gc3VjaCBsaXN0IGl0ZW0sIGl0IG1lYW5zIHRoYXQgdGhlIGluamVjdGVkIGxpc3QgaXRlbSBpcyB0aGUgZmlyc3QgaXRlbSBpbiBcIml0cyBsaXN0XCIuXG4gICAgY29uc3QgcmVmSXRlbSA9IGdldFNpYmxpbmdMaXN0SXRlbShtb2RlbEl0ZW0ucHJldmlvdXNTaWJsaW5nLCB7XG4gICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgIHNtYWxsZXJJbmRlbnQ6IHRydWUsXG4gICAgICAgIGxpc3RJbmRlbnQ6IG1vZGVsSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKVxuICAgIH0pO1xuICAgIGNvbnN0IHByZXZJdGVtID0gbW9kZWxJdGVtLnByZXZpb3VzU2libGluZztcbiAgICBpZiAocmVmSXRlbSAmJiByZWZJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID09IG1vZGVsSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSkge1xuICAgICAgICAvLyBUaGVyZSBpcyBhIGxpc3QgaXRlbSB3aXRoIHRoZSBzYW1lIGluZGVudCAtIHdlIGZvdW5kIHRoZSBzYW1lLWxldmVsIHNpYmxpbmcuXG4gICAgICAgIC8vIEJyZWFrIHRoZSBsaXN0IGFmdGVyIGl0LiBUaGUgaW5zZXJ0ZWQgdmlldyBpdGVtIHdpbGwgYmUgYWRkZWQgaW4gdGhlIGJyb2tlbiBzcGFjZS5cbiAgICAgICAgY29uc3Qgdmlld0l0ZW0gPSBtYXBwZXIudG9WaWV3RWxlbWVudChyZWZJdGVtKTtcbiAgICAgICAgaW5zZXJ0UG9zaXRpb24gPSB2aWV3V3JpdGVyLmJyZWFrQ29udGFpbmVyKHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih2aWV3SXRlbSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoZXJlIGlzIG5vIGxpc3QgaXRlbSB3aXRoIHRoZSBzYW1lIGluZGVudC4gQ2hlY2sgdGhlIHByZXZpb3VzIG1vZGVsIGl0ZW0uXG4gICAgICAgIGlmIChwcmV2SXRlbSAmJiBwcmV2SXRlbS5uYW1lID09ICdsaXN0SXRlbScpIHtcbiAgICAgICAgICAgIC8vIElmIGl0IGlzIGEgbGlzdCBpdGVtLCBpdCBoYXMgdG8gaGF2ZSBhIGxvd2VyIGluZGVudC5cbiAgICAgICAgICAgIC8vIEl0IG1lYW5zIHRoYXQgdGhlIGluc2VydGVkIGl0ZW0gc2hvdWxkIGJlIGFkZGVkIHRvIGl0IGFzIGl0cyBuZXN0ZWQgaXRlbS5cbiAgICAgICAgICAgIGluc2VydFBvc2l0aW9uID0gbWFwcGVyLnRvVmlld1Bvc2l0aW9uKG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQocHJldkl0ZW0sICdlbmQnKSk7XG4gICAgICAgICAgICAvLyBUaGVyZSBjb3VsZCBiZSBzb21lIG5vdCBtYXBwZWQgZWxlbWVudHMgKGVnLiBzcGFuIGluIHRvLWRvIGxpc3QpIGJ1dCB3ZSBuZWVkIHRvIGluc2VydFxuICAgICAgICAgICAgLy8gYSBuZXN0ZWQgbGlzdCBkaXJlY3RseSBpbnNpZGUgdGhlIGxpIGVsZW1lbnQuXG4gICAgICAgICAgICBjb25zdCBtYXBwZWRWaWV3QW5jZXN0b3IgPSBtYXBwZXIuZmluZE1hcHBlZFZpZXdBbmNlc3RvcihpbnNlcnRQb3NpdGlvbik7XG4gICAgICAgICAgICBjb25zdCBuZXN0ZWRMaXN0ID0gZmluZE5lc3RlZExpc3QobWFwcGVkVmlld0FuY2VzdG9yKTtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFscmVhZHkgaXMgc29tZSBuZXN0ZWQgbGlzdCwgdGhlbiB1c2UgaXQncyBwb3NpdGlvbi5cbiAgICAgICAgICAgIGlmIChuZXN0ZWRMaXN0KSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0UG9zaXRpb24gPSB2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKG5lc3RlZExpc3QpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBFbHNlIGp1c3QgcHV0IG5ldyBsaXN0IG9uIHRoZSBlbmQgb2YgbGlzdCBpdGVtIGNvbnRlbnQuXG4gICAgICAgICAgICAgICAgaW5zZXJ0UG9zaXRpb24gPSB2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobWFwcGVkVmlld0FuY2VzdG9yLCAnZW5kJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUaGUgcHJldmlvdXMgaXRlbSBpcyBub3QgYSBsaXN0IGl0ZW0gKG9yIGRvZXMgbm90IGV4aXN0IGF0IGFsbCkuXG4gICAgICAgICAgICAvLyBKdXN0IG1hcCB0aGUgcG9zaXRpb24gYW5kIGluc2VydCB0aGUgdmlldyBpdGVtIGF0IHRoZSBtYXBwZWQgcG9zaXRpb24uXG4gICAgICAgICAgICBpbnNlcnRQb3NpdGlvbiA9IG1hcHBlci50b1ZpZXdQb3NpdGlvbihtb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShtb2RlbEl0ZW0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpbnNlcnRQb3NpdGlvbiA9IHBvc2l0aW9uQWZ0ZXJVaUVsZW1lbnRzKGluc2VydFBvc2l0aW9uKTtcbiAgICAvLyBJbnNlcnQgdGhlIHZpZXcgaXRlbS5cbiAgICB2aWV3V3JpdGVyLmluc2VydChpbnNlcnRQb3NpdGlvbiwgaW5qZWN0ZWRMaXN0KTtcbiAgICAvLyAyLiBIYW5kbGUgcG9zc2libGUgY2hpbGRyZW4gb2YgdGhlIGluamVjdGVkIG1vZGVsIGl0ZW0uXG4gICAgaWYgKHByZXZJdGVtICYmIHByZXZJdGVtLm5hbWUgPT0gJ2xpc3RJdGVtJykge1xuICAgICAgICBjb25zdCBwcmV2VmlldyA9IG1hcHBlci50b1ZpZXdFbGVtZW50KHByZXZJdGVtKTtcbiAgICAgICAgY29uc3Qgd2Fsa2VyQm91bmRhcmllcyA9IHZpZXdXcml0ZXIuY3JlYXRlUmFuZ2Uodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHByZXZWaWV3LCAwKSwgaW5zZXJ0UG9zaXRpb24pO1xuICAgICAgICBjb25zdCB3YWxrZXIgPSB3YWxrZXJCb3VuZGFyaWVzLmdldFdhbGtlcih7XG4gICAgICAgICAgICBpZ25vcmVFbGVtZW50RW5kOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHdhbGtlcil7XG4gICAgICAgICAgICBpZiAodmFsdWUuaXRlbS5pcygnZWxlbWVudCcsICdsaScpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYnJlYWtQb3NpdGlvbiA9IHZpZXdXcml0ZXIuYnJlYWtDb250YWluZXIodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZSh2YWx1ZS5pdGVtKSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgdmlld0xpc3QgPSB2YWx1ZS5pdGVtLnBhcmVudDtcbiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BdChpbmplY3RlZEl0ZW0sICdlbmQnKTtcbiAgICAgICAgICAgICAgICBtZXJnZVZpZXdMaXN0cyh2aWV3V3JpdGVyLCB0YXJnZXRQb3NpdGlvbi5ub2RlQmVmb3JlLCB0YXJnZXRQb3NpdGlvbi5ub2RlQWZ0ZXIpO1xuICAgICAgICAgICAgICAgIHZpZXdXcml0ZXIubW92ZSh2aWV3V3JpdGVyLmNyZWF0ZVJhbmdlT24odmlld0xpc3QpLCB0YXJnZXRQb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBiYWQsIGJ1dCB0aG9zZSBsaXN0cyB3aWxsIGJlIHJlbW92ZWQgc29vbiBhbnl3YXkuXG4gICAgICAgICAgICAgICAgd2Fsa2VyLl9wb3NpdGlvbiA9IGJyZWFrUG9zaXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBuZXh0Vmlld0xpc3QgPSBpbmplY3RlZExpc3QubmV4dFNpYmxpbmc7XG4gICAgICAgIGlmIChuZXh0Vmlld0xpc3QgJiYgKG5leHRWaWV3TGlzdC5pcygnZWxlbWVudCcsICd1bCcpIHx8IG5leHRWaWV3TGlzdC5pcygnZWxlbWVudCcsICdvbCcpKSkge1xuICAgICAgICAgICAgbGV0IGxhc3RTdWJDaGlsZCA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5leHRWaWV3TGlzdC5nZXRDaGlsZHJlbigpKXtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbENoaWxkID0gbWFwcGVyLnRvTW9kZWxFbGVtZW50KGNoaWxkKTtcbiAgICAgICAgICAgICAgICBpZiAobW9kZWxDaGlsZCAmJiBtb2RlbENoaWxkLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID4gbW9kZWxJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RTdWJDaGlsZCA9IGNoaWxkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsYXN0U3ViQ2hpbGQpIHtcbiAgICAgICAgICAgICAgICB2aWV3V3JpdGVyLmJyZWFrQ29udGFpbmVyKHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihsYXN0U3ViQ2hpbGQpKTtcbiAgICAgICAgICAgICAgICB2aWV3V3JpdGVyLm1vdmUodmlld1dyaXRlci5jcmVhdGVSYW5nZU9uKGxhc3RTdWJDaGlsZC5wYXJlbnQpLCB2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoaW5qZWN0ZWRJdGVtLCAnZW5kJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIE1lcmdlIHRoZSBpbnNlcnRlZCB2aWV3IGxpc3Qgd2l0aCBpdHMgcG9zc2libGUgbmVpZ2hib3IgbGlzdHMuXG4gICAgbWVyZ2VWaWV3TGlzdHModmlld1dyaXRlciwgaW5qZWN0ZWRMaXN0LCBpbmplY3RlZExpc3QubmV4dFNpYmxpbmcpO1xuICAgIG1lcmdlVmlld0xpc3RzKHZpZXdXcml0ZXIsIGluamVjdGVkTGlzdC5wcmV2aW91c1NpYmxpbmcsIGluamVjdGVkTGlzdCk7XG59XG5mdW5jdGlvbiBtZXJnZVZpZXdMaXN0cyh2aWV3V3JpdGVyLCBmaXJzdExpc3QsIHNlY29uZExpc3QpIHtcbiAgICAvLyBDaGVjayBpZiB0d28gbGlzdHMgYXJlIGdvaW5nIHRvIGJlIG1lcmdlZC5cbiAgICBpZiAoIWZpcnN0TGlzdCB8fCAhc2Vjb25kTGlzdCB8fCBmaXJzdExpc3QubmFtZSAhPSAndWwnICYmIGZpcnN0TGlzdC5uYW1lICE9ICdvbCcpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIEJvdGggcGFyYW1ldGVycyBhcmUgbGlzdCBlbGVtZW50cywgc28gY29tcGFyZSB0eXBlcyBub3cuXG4gICAgaWYgKGZpcnN0TGlzdC5uYW1lICE9IHNlY29uZExpc3QubmFtZSB8fCBmaXJzdExpc3QuZ2V0QXR0cmlidXRlKCdjbGFzcycpICE9PSBzZWNvbmRMaXN0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHZpZXdXcml0ZXIubWVyZ2VDb250YWluZXJzKHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihmaXJzdExpc3QpKTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgZm9yIGEgZ2l2ZW4gYHZpZXcuUG9zaXRpb25gLCByZXR1cm5zIGEgYHZpZXcuUG9zaXRpb25gIHRoYXQgaXMgYWZ0ZXIgYWxsIGB2aWV3LlVJRWxlbWVudGBzIHRoYXRcbiAqIGFyZSBhZnRlciB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gKlxuICogRm9yIGV4YW1wbGU6XG4gKiBgPGNvbnRhaW5lcjpwPmZvb148dWk6c3Bhbj48L3VpOnNwYW4+PHVpOnNwYW4+PC91aTpzcGFuPmJhcjwvY29udGFpbmVyOnA+YFxuICogRm9yIHBvc2l0aW9uIF4sIHRoZSBwb3NpdGlvbiBiZWZvcmUgXCJiYXJcIiB3aWxsIGJlIHJldHVybmVkLlxuICpcbiAqLyBmdW5jdGlvbiBwb3NpdGlvbkFmdGVyVWlFbGVtZW50cyh2aWV3UG9zaXRpb24pIHtcbiAgICByZXR1cm4gdmlld1Bvc2l0aW9uLmdldExhc3RNYXRjaGluZ1Bvc2l0aW9uKCh2YWx1ZSk9PnZhbHVlLml0ZW0uaXMoJ3VpRWxlbWVudCcpKTtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgc2VhcmNoZXMgZm9yIGEgcHJldmlvdXMgbGlzdCBpdGVtIHNpYmxpbmcgb2YgYSBnaXZlbiBtb2RlbCBpdGVtIHRoYXQgbWVldHMgdGhlIGdpdmVuIGNyaXRlcmlhXG4gKiBwYXNzZWQgYnkgdGhlIG9wdGlvbnMgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIFNlYXJjaCBjcml0ZXJpYS5cbiAqIEBwYXJhbSBvcHRpb25zLnNhbWVJbmRlbnQgV2hldGhlciB0aGUgc291Z2h0IHNpYmxpbmcgc2hvdWxkIGhhdmUgdGhlIHNhbWUgaW5kZW50YXRpb24uXG4gKiBAcGFyYW0gb3B0aW9ucy5zbWFsbGVySW5kZW50IFdoZXRoZXIgdGhlIHNvdWdodCBzaWJsaW5nIHNob3VsZCBoYXZlIGEgc21hbGxlciBpbmRlbnRhdGlvbi5cbiAqIEBwYXJhbSBvcHRpb25zLmxpc3RJbmRlbnQgVGhlIHJlZmVyZW5jZSBpbmRlbnRhdGlvbi5cbiAqIEBwYXJhbSBvcHRpb25zLmRpcmVjdGlvbiBXYWxraW5nIGRpcmVjdGlvbi5cbiAqLyBmdW5jdGlvbiBnZXRTaWJsaW5nTGlzdEl0ZW0obW9kZWxJdGVtLCBvcHRpb25zKSB7XG4gICAgY29uc3Qgc2FtZUluZGVudCA9ICEhb3B0aW9ucy5zYW1lSW5kZW50O1xuICAgIGNvbnN0IHNtYWxsZXJJbmRlbnQgPSAhIW9wdGlvbnMuc21hbGxlckluZGVudDtcbiAgICBjb25zdCBpbmRlbnQgPSBvcHRpb25zLmxpc3RJbmRlbnQ7XG4gICAgbGV0IGl0ZW0gPSBtb2RlbEl0ZW07XG4gICAgd2hpbGUoaXRlbSAmJiBpdGVtLm5hbWUgPT0gJ2xpc3RJdGVtJyl7XG4gICAgICAgIGNvbnN0IGl0ZW1JbmRlbnQgPSBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICBpZiAoc2FtZUluZGVudCAmJiBpbmRlbnQgPT0gaXRlbUluZGVudCB8fCBzbWFsbGVySW5kZW50ICYmIGluZGVudCA+IGl0ZW1JbmRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PT0gJ2ZvcndhcmQnKSB7XG4gICAgICAgICAgICBpdGVtID0gaXRlbS5uZXh0U2libGluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZW0gPSBpdGVtLnByZXZpb3VzU2libGluZztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyBhIGZpcnN0IGxpc3QgdmlldyBlbGVtZW50IHRoYXQgaXMgZGlyZWN0IGNoaWxkIG9mIHRoZSBnaXZlbiB2aWV3IGVsZW1lbnQuXG4gKi8gZnVuY3Rpb24gZmluZE5lc3RlZExpc3Qodmlld0VsZW1lbnQpIHtcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2Ygdmlld0VsZW1lbnQuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgIGlmIChub2RlLm5hbWUgPT0gJ3VsJyB8fCBub2RlLm5hbWUgPT0gJ29sJykge1xuICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIFJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgYGxpc3RJdGVtYCBlbGVtZW50cyB0aGF0IHJlcHJlc2VudCB0aGUgc2FtZSBsaXN0LlxuICpcbiAqIEl0IG1lYW5zIHRoYXQgdmFsdWVzIG9mIGBsaXN0SW5kZW50YCwgYGxpc3RUeXBlYCwgYGxpc3RTdHlsZWAsIGBsaXN0UmV2ZXJzZWRgIGFuZCBgbGlzdFN0YXJ0YCBmb3IgYWxsIGl0ZW1zIGFyZSBlcXVhbC5cbiAqXG4gKiBBZGRpdGlvbmFsbHksIGlmIHRoZSBgcG9zaXRpb25gIGlzIGluc2lkZSBhIGxpc3QgaXRlbSwgdGhhdCBsaXN0IGl0ZW0gd2lsbCBiZSByZXR1cm5lZCBhcyB3ZWxsLlxuICpcbiAqIEBwYXJhbSBwb3NpdGlvbiBTdGFydGluZyBwb3NpdGlvbi5cbiAqIEBwYXJhbSBkaXJlY3Rpb24gV2Fsa2luZyBkaXJlY3Rpb24uXG4gKi8gZnVuY3Rpb24gZ2V0U2libGluZ05vZGVzKHBvc2l0aW9uLCBkaXJlY3Rpb24pIHtcbiAgICBjb25zdCBpdGVtcyA9IFtdO1xuICAgIGNvbnN0IGxpc3RJdGVtID0gcG9zaXRpb24ucGFyZW50O1xuICAgIGNvbnN0IHdhbGtlck9wdGlvbnMgPSB7XG4gICAgICAgIGlnbm9yZUVsZW1lbnRFbmQ6IGZhbHNlLFxuICAgICAgICBzdGFydFBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgc2hhbGxvdzogdHJ1ZSxcbiAgICAgICAgZGlyZWN0aW9uXG4gICAgfTtcbiAgICBjb25zdCBsaW1pdEluZGVudCA9IGxpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgIGNvbnN0IG5vZGVzID0gW1xuICAgICAgICAuLi5uZXcgVHJlZVdhbGtlcih3YWxrZXJPcHRpb25zKVxuICAgIF0uZmlsdGVyKCh2YWx1ZSk9PnZhbHVlLml0ZW0uaXMoJ2VsZW1lbnQnKSkubWFwKCh2YWx1ZSk9PnZhbHVlLml0ZW0pO1xuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBub2Rlcyl7XG4gICAgICAgIC8vIElmIGZvdW5kIHNvbWV0aGluZyBlbHNlIHRoYW4gYGxpc3RJdGVtYCwgd2UncmUgb3V0IG9mIHRoZSBsaXN0IHNjb3BlLlxuICAgICAgICBpZiAoIWVsZW1lbnQuaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgY3VycmVudCBwYXJzZWQgaXRlbSBoYXMgbG93ZXIgaW5kZW50IHRoYXQgZWxlbWVudCB0aGF0IHRoZSBlbGVtZW50IHRoYXQgd2FzIGEgc3RhcnRpbmcgcG9pbnQsXG4gICAgICAgIC8vIGl0IG1lYW5zIHdlIGxlZnQgYSBuZXN0ZWQgbGlzdC4gQWJvcnQgc2VhcmNoaW5nIGl0ZW1zLlxuICAgICAgICAvL1xuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDEuICAgICAgIFtsaXN0SW5kZW50PTBdXG4gICAgICAgIC8vICAgICDil4sgTGlzdCBpdGVtIDIuW10gW2xpc3RJbmRlbnQ9MV0sIGxpbWl0SW5kZW50ID0gMSxcbiAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMy4gICBbbGlzdEluZGVudD0xXVxuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDQuICAgICAgIFtsaXN0SW5kZW50PTBdXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEFib3J0IHNlYXJjaGluZyB3aGVuIGxlYXZlIG5lc3RlZCBsaXN0LlxuICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSA8IGxpbWl0SW5kZW50KSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDEuW10gICAgIFtsaXN0SW5kZW50PTBdIGxpbWl0SW5kZW50ID0gMCxcbiAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMi4gICBbbGlzdEluZGVudD0xXVxuICAgICAgICAvLyAgICAg4peLIExpc3QgaXRlbSAzLiAgIFtsaXN0SW5kZW50PTFdXG4gICAgICAgIC8vIOKWoCBMaXN0IGl0ZW0gNC4gICAgICAgW2xpc3RJbmRlbnQ9MF1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSWdub3JlIG5lc3RlZCBsaXN0cy5cbiAgICAgICAgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgPiBsaW1pdEluZGVudCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLltdICBbbGlzdFR5cGU9YnVsbGV0ZWRdXG4gICAgICAgIC8vIDEuIExpc3QgaXRlbSAyLiAgIFtsaXN0VHlwZT1udW1iZXJlZF1cbiAgICAgICAgLy8gMi5MaXN0IGl0ZW0gMy4gICAgW2xpc3RUeXBlPW51bWJlcmVkXVxuICAgICAgICAvL1xuICAgICAgICAvLyBBYm9ydCBzZWFyY2hpbmcgd2hlbiBmb3VuZCBhIGRpZmZlcmVudCBraW5kIG9mIGEgbGlzdC5cbiAgICAgICAgaWYgKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9PSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIC8vIOKWoCBMaXN0IGl0ZW0gMS5bXSAgW2xpc3RUeXBlPWJ1bGxldGVkXVxuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDIuICAgIFtsaXN0VHlwZT1idWxsZXRlZF1cbiAgICAgICAgLy8g4peLIExpc3QgaXRlbSAzLiAgICBbbGlzdFR5cGU9YnVsbGV0ZWRdXG4gICAgICAgIC8vIOKXiyBMaXN0IGl0ZW0gNC4gICAgW2xpc3RUeXBlPWJ1bGxldGVkXVxuICAgICAgICAvL1xuICAgICAgICAvLyBBYm9ydCBzZWFyY2hpbmcgd2hlbiBmb3VuZCBhIGRpZmZlcmVudCBsaXN0IHN0eWxlLFxuICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RTdHlsZScpICE9PSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RTdHlsZScpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvLyAuLi4gZGlmZmVyZW50IGRpcmVjdGlvblxuICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RSZXZlcnNlZCcpICE9PSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RSZXZlcnNlZCcpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvLyAuLi4gYW5kIGRpZmZlcmVudCBzdGFydCBpbmRleFxuICAgICAgICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RTdGFydCcpICE9PSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RTdGFydCcpKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAnYmFja3dhcmQnKSB7XG4gICAgICAgICAgICBpdGVtcy51bnNoaWZ0KGVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlbXMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbXM7XG59XG4vKipcbiAqIFJldHVybnMgYW4gYXJyYXkgd2l0aCBhbGwgYGxpc3RJdGVtYCBlbGVtZW50cyBpbiB0aGUgbW9kZWwgc2VsZWN0aW9uLlxuICpcbiAqIEl0IHJldHVybnMgYWxsIHRoZSBpdGVtcyBldmVuIGlmIG9ubHkgYSBwYXJ0IG9mIHRoZSBsaXN0IGlzIHNlbGVjdGVkLCBpbmNsdWRpbmcgaXRlbXMgdGhhdCBiZWxvbmcgdG8gbmVzdGVkIGxpc3RzLlxuICogSWYgbm8gbGlzdCBpcyBzZWxlY3RlZCwgaXQgcmV0dXJucyBhbiBlbXB0eSBhcnJheS5cbiAqIFRoZSBvcmRlciBvZiB0aGUgZWxlbWVudHMgaXMgbm90IHNwZWNpZmllZC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBnZXRTZWxlY3RlZExpc3RJdGVtcyhtb2RlbCkge1xuICAgIGNvbnN0IGRvY3VtZW50ID0gbW9kZWwuZG9jdW1lbnQ7XG4gICAgLy8gRm9yIGFsbCBzZWxlY3RlZCBibG9ja3MgZmluZCBhbGwgbGlzdCBpdGVtcyB0aGF0IGFyZSBiZWluZyBzZWxlY3RlZFxuICAgIC8vIGFuZCB1cGRhdGUgdGhlIGBsaXN0U3R5bGVgIGF0dHJpYnV0ZSBpbiB0aG9zZSBsaXN0cy5cbiAgICBsZXQgbGlzdEl0ZW1zID0gW1xuICAgICAgICAuLi5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRCbG9ja3MoKVxuICAgIF0uZmlsdGVyKChlbGVtZW50KT0+ZWxlbWVudC5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKS5tYXAoKGVsZW1lbnQpPT57XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT53cml0ZXIuY3JlYXRlUG9zaXRpb25BdChlbGVtZW50LCAwKSk7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5nZXRTaWJsaW5nTm9kZXMocG9zaXRpb24sICdiYWNrd2FyZCcpLFxuICAgICAgICAgICAgLi4uZ2V0U2libGluZ05vZGVzKHBvc2l0aW9uLCAnZm9yd2FyZCcpXG4gICAgICAgIF07XG4gICAgfSkuZmxhdCgpO1xuICAgIC8vIFNpbmNlIGBnZXRTZWxlY3RlZEJsb2NrcygpYCBjYW4gcmV0dXJuIGl0ZW1zIHRoYXQgYmVsb25nIHRvIHRoZSBzYW1lIGxpc3QsIGFuZFxuICAgIC8vIGBnZXRTaWJsaW5nTm9kZXMoKWAgcmV0dXJucyB0aGUgZW50aXJlIGxpc3QsIHdlIG5lZWQgdG8gcmVtb3ZlIGR1cGxpY2F0ZWQgaXRlbXMuXG4gICAgbGlzdEl0ZW1zID0gW1xuICAgICAgICAuLi5uZXcgU2V0KGxpc3RJdGVtcylcbiAgICBdO1xuICAgIHJldHVybiBsaXN0SXRlbXM7XG59XG5jb25zdCBCVUxMRVRFRF9MSVNUX1NUWUxFX1RZUEVTID0gW1xuICAgICdkaXNjJyxcbiAgICAnY2lyY2xlJyxcbiAgICAnc3F1YXJlJ1xuXTtcbi8vIFRoZXJlJ3MgYSBsb3Qgb2YgdGhlbSAoaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1jb3VudGVyLXN0eWxlcy0zLyN0eXBlZGVmLWNvdW50ZXItc3R5bGUpLlxuLy8gTGV0J3Mgc3VwcG9ydCBvbmx5IHRob3NlIHRoYXQgY2FuIGJlIHNlbGVjdGVkIGJ5IExpc3RQcm9wZXJ0aWVzVUkuXG5jb25zdCBOVU1CRVJFRF9MSVNUX1NUWUxFX1RZUEVTID0gW1xuICAgICdkZWNpbWFsJyxcbiAgICAnZGVjaW1hbC1sZWFkaW5nLXplcm8nLFxuICAgICdsb3dlci1yb21hbicsXG4gICAgJ3VwcGVyLXJvbWFuJyxcbiAgICAnbG93ZXItbGF0aW4nLFxuICAgICd1cHBlci1sYXRpbidcbl07XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBsaXN0LXN0eWxlLXR5cGUgaXMgc3VwcG9ydGVkIGJ5IG51bWJlcmVkIG9yIGJ1bGxldGVkIGxpc3QuXG4gKi8gZnVuY3Rpb24gZ2V0TGlzdFR5cGVGcm9tTGlzdFN0eWxlVHlwZShsaXN0U3R5bGVUeXBlKSB7XG4gICAgaWYgKEJVTExFVEVEX0xJU1RfU1RZTEVfVFlQRVMuaW5jbHVkZXMobGlzdFN0eWxlVHlwZSkpIHtcbiAgICAgICAgcmV0dXJuICdidWxsZXRlZCc7XG4gICAgfVxuICAgIGlmIChOVU1CRVJFRF9MSVNUX1NUWUxFX1RZUEVTLmluY2x1ZGVzKGxpc3RTdHlsZVR5cGUpKSB7XG4gICAgICAgIHJldHVybiAnbnVtYmVyZWQnO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2YgZ2V0RmlsbGVyT2Zmc2V0IGZvciB2aWV3IGxpc3QgaXRlbSBlbGVtZW50LlxuICpcbiAqIEByZXR1cm5zIEJsb2NrIGZpbGxlciBvZmZzZXQgb3IgYG51bGxgIGlmIGJsb2NrIGZpbGxlciBpcyBub3QgbmVlZGVkLlxuICovIGZ1bmN0aW9uIGdldExpc3RJdGVtRmlsbGVyT2Zmc2V0KCkge1xuICAgIGNvbnN0IGhhc09ubHlMaXN0cyA9ICF0aGlzLmlzRW1wdHkgJiYgKHRoaXMuZ2V0Q2hpbGQoMCkubmFtZSA9PSAndWwnIHx8IHRoaXMuZ2V0Q2hpbGQoMCkubmFtZSA9PSAnb2wnKTtcbiAgICBpZiAodGhpcy5pc0VtcHR5IHx8IGhhc09ubHlMaXN0cykge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgcmV0dXJuIGdldEZpbGxlck9mZnNldC5jYWxsKHRoaXMpO1xufVxuXG4vKipcbiAqIEEgc2V0IG9mIGhlbHBlcnMgcmVsYXRlZCB0byBsZWdhY3kgbGlzdHMuXG4gKi8gY2xhc3MgTGVnYWN5TGlzdFV0aWxzIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdMZWdhY3lMaXN0VXRpbHMnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgZ2l2ZW4gbGlzdC1zdHlsZS10eXBlIGlzIHN1cHBvcnRlZCBieSBudW1iZXJlZCBvciBidWxsZXRlZCBsaXN0LlxuXHQgKi8gZ2V0TGlzdFR5cGVGcm9tTGlzdFN0eWxlVHlwZShsaXN0U3R5bGVUeXBlKSB7XG4gICAgICAgIHJldHVybiBnZXRMaXN0VHlwZUZyb21MaXN0U3R5bGVUeXBlKGxpc3RTdHlsZVR5cGUpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSB3aXRoIGFsbCBgbGlzdEl0ZW1gIGVsZW1lbnRzIGluIHRoZSBtb2RlbCBzZWxlY3Rpb24uXG5cdCAqXG5cdCAqIEl0IHJldHVybnMgYWxsIHRoZSBpdGVtcyBldmVuIGlmIG9ubHkgYSBwYXJ0IG9mIHRoZSBsaXN0IGlzIHNlbGVjdGVkLCBpbmNsdWRpbmcgaXRlbXMgdGhhdCBiZWxvbmcgdG8gbmVzdGVkIGxpc3RzLlxuXHQgKiBJZiBubyBsaXN0IGlzIHNlbGVjdGVkLCBpdCByZXR1cm5zIGFuIGVtcHR5IGFycmF5LlxuXHQgKiBUaGUgb3JkZXIgb2YgdGhlIGVsZW1lbnRzIGlzIG5vdCBzcGVjaWZpZWQuXG5cdCAqLyBnZXRTZWxlY3RlZExpc3RJdGVtcyhtb2RlbCkge1xuICAgICAgICByZXR1cm4gZ2V0U2VsZWN0ZWRMaXN0SXRlbXMobW9kZWwpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBhbiBhcnJheSB3aXRoIGFsbCBgbGlzdEl0ZW1gIGVsZW1lbnRzIHRoYXQgcmVwcmVzZW50IHRoZSBzYW1lIGxpc3QuXG5cdCAqXG5cdCAqIEl0IG1lYW5zIHRoYXQgdmFsdWVzIG9mIGBsaXN0SW5kZW50YCwgYGxpc3RUeXBlYCwgYGxpc3RTdHlsZWAsIGBsaXN0UmV2ZXJzZWRgIGFuZCBgbGlzdFN0YXJ0YCBmb3IgYWxsIGl0ZW1zIGFyZSBlcXVhbC5cblx0ICpcblx0ICogQWRkaXRpb25hbGx5LCBpZiB0aGUgYHBvc2l0aW9uYCBpcyBpbnNpZGUgYSBsaXN0IGl0ZW0sIHRoYXQgbGlzdCBpdGVtIHdpbGwgYmUgcmV0dXJuZWQgYXMgd2VsbC5cblx0ICpcblx0ICogQHBhcmFtIHBvc2l0aW9uIFN0YXJ0aW5nIHBvc2l0aW9uLlxuXHQgKiBAcGFyYW0gZGlyZWN0aW9uIFdhbGtpbmcgZGlyZWN0aW9uLlxuXHQgKi8gZ2V0U2libGluZ05vZGVzKHBvc2l0aW9uLCBkaXJlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGdldFNpYmxpbmdOb2Rlcyhwb3NpdGlvbiwgZGlyZWN0aW9uKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBtb2RlbC10by12aWV3IGNvbnZlcnRlciBmb3IgdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudCBpbnNlcnRpb24uXG4gKlxuICogSXQgY3JlYXRlcyBhIGA8dWw+PGxpPjwvbGk+PHVsPmAgKG9yIGA8b2w+YCkgdmlldyBzdHJ1Y3R1cmUgb3V0IG9mIGEgYGxpc3RJdGVtYCBtb2RlbCBlbGVtZW50LCBpbnNlcnRzIGl0IGF0IHRoZSBjb3JyZWN0XG4gKiBwb3NpdGlvbiwgYW5kIG1lcmdlcyB0aGUgbGlzdCB3aXRoIHN1cnJvdW5kaW5nIGxpc3RzIChpZiBhdmFpbGFibGUpLlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6aW5zZXJ0XG4gKiBAcGFyYW0gbW9kZWwgTW9kZWwgaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gbW9kZWxWaWV3SW5zZXJ0aW9uJDEobW9kZWwpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgY29uc3VtYWJsZSA9IGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZTtcbiAgICAgICAgaWYgKCFjb25zdW1hYmxlLnRlc3QoZGF0YS5pdGVtLCAnaW5zZXJ0JykgfHwgIWNvbnN1bWFibGUudGVzdChkYXRhLml0ZW0sICdhdHRyaWJ1dGU6bGlzdFR5cGUnKSB8fCAhY29uc3VtYWJsZS50ZXN0KGRhdGEuaXRlbSwgJ2F0dHJpYnV0ZTpsaXN0SW5kZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdW1hYmxlLmNvbnN1bWUoZGF0YS5pdGVtLCAnaW5zZXJ0Jyk7XG4gICAgICAgIGNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sICdhdHRyaWJ1dGU6bGlzdFR5cGUnKTtcbiAgICAgICAgY29uc3VtYWJsZS5jb25zdW1lKGRhdGEuaXRlbSwgJ2F0dHJpYnV0ZTpsaXN0SW5kZW50Jyk7XG4gICAgICAgIGNvbnN0IG1vZGVsSXRlbSA9IGRhdGEuaXRlbTtcbiAgICAgICAgY29uc3Qgdmlld0l0ZW0gPSBnZW5lcmF0ZUxpSW5VbChtb2RlbEl0ZW0sIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICBpbmplY3RWaWV3TGlzdChtb2RlbEl0ZW0sIHZpZXdJdGVtLCBjb252ZXJzaW9uQXBpLCBtb2RlbCk7XG4gICAgfTtcbn1cbi8qKlxuICogQSBtb2RlbC10by12aWV3IGNvbnZlcnRlciBmb3IgdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudCByZW1vdmFsLlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6cmVtb3ZlXG4gKiBAcGFyYW0gbW9kZWwgTW9kZWwgaW5zdGFuY2UuXG4gKiBAcmV0dXJucyBSZXR1cm5zIGEgY29udmVyc2lvbiBjYWxsYmFjay5cbiAqLyBmdW5jdGlvbiBtb2RlbFZpZXdSZW1vdmUobW9kZWwpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3Qgdmlld1Bvc2l0aW9uID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3UG9zaXRpb24oZGF0YS5wb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IHZpZXdTdGFydCA9IHZpZXdQb3NpdGlvbi5nZXRMYXN0TWF0Y2hpbmdQb3NpdGlvbigodmFsdWUpPT4hdmFsdWUuaXRlbS5pcygnZWxlbWVudCcsICdsaScpKTtcbiAgICAgICAgY29uc3Qgdmlld0l0ZW0gPSB2aWV3U3RhcnQubm9kZUFmdGVyO1xuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIC8vIDEuIEJyZWFrIHRoZSBjb250YWluZXIgYWZ0ZXIgYW5kIGJlZm9yZSB0aGUgbGlzdCBpdGVtLlxuICAgICAgICAvLyBUaGlzIHdpbGwgY3JlYXRlIGEgdmlldyBsaXN0IHdpdGggb25lIHZpZXcgbGlzdCBpdGVtIC0gdGhlIG9uZSB0byByZW1vdmUuXG4gICAgICAgIHZpZXdXcml0ZXIuYnJlYWtDb250YWluZXIodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZSh2aWV3SXRlbSkpO1xuICAgICAgICB2aWV3V3JpdGVyLmJyZWFrQ29udGFpbmVyKHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih2aWV3SXRlbSkpO1xuICAgICAgICAvLyAyLiBSZW1vdmUgdGhlIGxpc3Qgd2l0aCB0aGUgaXRlbSB0byByZW1vdmUuXG4gICAgICAgIGNvbnN0IHZpZXdMaXN0ID0gdmlld0l0ZW0ucGFyZW50O1xuICAgICAgICBjb25zdCB2aWV3TGlzdFByZXYgPSB2aWV3TGlzdC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgIGNvbnN0IHJlbW92ZVJhbmdlID0gdmlld1dyaXRlci5jcmVhdGVSYW5nZU9uKHZpZXdMaXN0KTtcbiAgICAgICAgY29uc3QgcmVtb3ZlZCA9IHZpZXdXcml0ZXIucmVtb3ZlKHJlbW92ZVJhbmdlKTtcbiAgICAgICAgLy8gMy4gTWVyZ2UgdGhlIHdob2xlIGNyZWF0ZWQgYnkgYnJlYWtpbmcgYW5kIHJlbW92aW5nIHRoZSBsaXN0LlxuICAgICAgICBpZiAodmlld0xpc3RQcmV2ICYmIHZpZXdMaXN0UHJldi5uZXh0U2libGluZykge1xuICAgICAgICAgICAgbWVyZ2VWaWV3TGlzdHModmlld1dyaXRlciwgdmlld0xpc3RQcmV2LCB2aWV3TGlzdFByZXYubmV4dFNpYmxpbmcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIDQuIEJyaW5nIGJhY2sgbmVzdGVkIGxpc3QgdGhhdCB3YXMgaW4gdGhlIHJlbW92ZWQgPGxpPi5cbiAgICAgICAgY29uc3QgbW9kZWxJdGVtID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld0l0ZW0pO1xuICAgICAgICBob2lzdE5lc3RlZExpc3RzKG1vZGVsSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSArIDEsIGRhdGEucG9zaXRpb24sIHJlbW92ZVJhbmdlLnN0YXJ0LCB2aWV3SXRlbSwgY29udmVyc2lvbkFwaSwgbW9kZWwpO1xuICAgICAgICAvLyA1LiBVbmJpbmQgcmVtb3ZlZCB2aWV3IGl0ZW0gYW5kIGFsbCBjaGlsZHJlbi5cbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB2aWV3V3JpdGVyLmNyZWF0ZVJhbmdlSW4ocmVtb3ZlZCkuZ2V0SXRlbXMoKSl7XG4gICAgICAgICAgICBjb252ZXJzaW9uQXBpLm1hcHBlci51bmJpbmRWaWV3RWxlbWVudChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICB9O1xufVxuLyoqXG4gKiBBIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGZvciB0aGUgYHR5cGVgIGF0dHJpYnV0ZSBjaGFuZ2Ugb24gdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudC5cbiAqXG4gKiBUaGlzIGNoYW5nZSBtZWFucyB0aGF0IHRoZSBgPGxpPmAgZWxlbWVudCBwYXJlbnQgY2hhbmdlcyBmcm9tIGA8dWw+YCB0byBgPG9sPmAgKG9yIHZpY2UgdmVyc2EpLiBUaGlzIGlzIGFjY29tcGxpc2hlZFxuICogYnkgYnJlYWtpbmcgdmlldyBlbGVtZW50cyBhbmQgY2hhbmdpbmcgdGhlaXIgbmFtZS4gVGhlIG5leHQge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeWxpc3QvbGVnYWN5Y29udmVydGVyc35tb2RlbFZpZXdNZXJnZUFmdGVyQ2hhbmdlVHlwZX1cbiAqIGNvbnZlcnRlciB3aWxsIGF0dGVtcHQgdG8gbWVyZ2Ugc3BsaXQgbm9kZXMuXG4gKlxuICogU3BsaXR0aW5nIHRoaXMgY29udmVyc2lvbiBpbnRvIDIgc3RlcHMgbWFrZXMgaXQgcG9zc2libGUgdG8gYWRkIGFuIGFkZGl0aW9uYWwgY29udmVyc2lvbiBpbiB0aGUgbWlkZGxlLlxuICogQ2hlY2sge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeXRvZG9saXN0L2xlZ2FjeXRvZG9saXN0Y29udmVydGVyc35tb2RlbFZpZXdDaGFuZ2VUeXBlfSB0byBzZWUgYW4gZXhhbXBsZSBvZiBpdC5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmF0dHJpYnV0ZVxuICovIGNvbnN0IG1vZGVsVmlld0NoYW5nZVR5cGUkMSA9IChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUudGVzdChkYXRhLml0ZW0sIGV2dC5uYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHZpZXdJdGVtID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3RWxlbWVudChkYXRhLml0ZW0pO1xuICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAvLyBCcmVhayB0aGUgY29udGFpbmVyIGFmdGVyIGFuZCBiZWZvcmUgdGhlIGxpc3QgaXRlbS5cbiAgICAvLyBUaGlzIHdpbGwgY3JlYXRlIGEgdmlldyBsaXN0IHdpdGggb25lIHZpZXcgbGlzdCBpdGVtIC0tIHRoZSBvbmUgdGhhdCBjaGFuZ2VkIHR5cGUuXG4gICAgdmlld1dyaXRlci5icmVha0NvbnRhaW5lcih2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQmVmb3JlKHZpZXdJdGVtKSk7XG4gICAgdmlld1dyaXRlci5icmVha0NvbnRhaW5lcih2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIodmlld0l0ZW0pKTtcbiAgICAvLyBDaGFuZ2UgbmFtZSBvZiB0aGUgdmlldyBsaXN0IHRoYXQgaG9sZHMgdGhlIGNoYW5nZWQgdmlldyBpdGVtLlxuICAgIC8vIFdlIGNhbm5vdCBqdXN0IGNoYW5nZSBuYW1lIHByb3BlcnR5LCBiZWNhdXNlIHRoYXQgd291bGQgbm90IHJlbmRlciBwcm9wZXJseS5cbiAgICBjb25zdCB2aWV3TGlzdCA9IHZpZXdJdGVtLnBhcmVudDtcbiAgICBjb25zdCBsaXN0TmFtZSA9IGRhdGEuYXR0cmlidXRlTmV3VmFsdWUgPT0gJ251bWJlcmVkJyA/ICdvbCcgOiAndWwnO1xuICAgIHZpZXdXcml0ZXIucmVuYW1lKGxpc3ROYW1lLCB2aWV3TGlzdCk7XG59O1xuLyoqXG4gKiBBIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIHRoYXQgYXR0ZW1wdHMgdG8gbWVyZ2Ugbm9kZXMgc3BsaXQgYnkge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeWxpc3QvbGVnYWN5Y29udmVydGVyc35tb2RlbFZpZXdDaGFuZ2VUeXBlfS5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmF0dHJpYnV0ZVxuICovIGNvbnN0IG1vZGVsVmlld01lcmdlQWZ0ZXJDaGFuZ2VUeXBlID0gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sIGV2dC5uYW1lKTtcbiAgICBjb25zdCB2aWV3SXRlbSA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld0VsZW1lbnQoZGF0YS5pdGVtKTtcbiAgICBjb25zdCB2aWV3TGlzdCA9IHZpZXdJdGVtLnBhcmVudDtcbiAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgLy8gTWVyZ2UgdGhlIGNoYW5nZWQgdmlldyBsaXN0IHdpdGggb3RoZXIgbGlzdHMsIGlmIHBvc3NpYmxlLlxuICAgIG1lcmdlVmlld0xpc3RzKHZpZXdXcml0ZXIsIHZpZXdMaXN0LCB2aWV3TGlzdC5uZXh0U2libGluZyk7XG4gICAgbWVyZ2VWaWV3TGlzdHModmlld1dyaXRlciwgdmlld0xpc3QucHJldmlvdXNTaWJsaW5nLCB2aWV3TGlzdCk7XG59O1xuLyoqXG4gKiBBIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGZvciB0aGUgYGxpc3RJbmRlbnRgIGF0dHJpYnV0ZSBjaGFuZ2Ugb24gdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudC5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmF0dHJpYnV0ZVxuICogQHBhcmFtIG1vZGVsIE1vZGVsIGluc3RhbmNlLlxuICogQHJldHVybnMgUmV0dXJucyBhIGNvbnZlcnNpb24gY2FsbGJhY2suXG4gKi8gZnVuY3Rpb24gbW9kZWxWaWV3Q2hhbmdlSW5kZW50KG1vZGVsKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS5pdGVtLCAnYXR0cmlidXRlOmxpc3RJbmRlbnQnKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdJdGVtID0gY29udmVyc2lvbkFwaS5tYXBwZXIudG9WaWV3RWxlbWVudChkYXRhLml0ZW0pO1xuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIC8vIDEuIEJyZWFrIHRoZSBjb250YWluZXIgYWZ0ZXIgYW5kIGJlZm9yZSB0aGUgbGlzdCBpdGVtLlxuICAgICAgICAvLyBUaGlzIHdpbGwgY3JlYXRlIGEgdmlldyBsaXN0IHdpdGggb25lIHZpZXcgbGlzdCBpdGVtIC0tIHRoZSBvbmUgdGhhdCBjaGFuZ2VkIHR5cGUuXG4gICAgICAgIHZpZXdXcml0ZXIuYnJlYWtDb250YWluZXIodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZSh2aWV3SXRlbSkpO1xuICAgICAgICB2aWV3V3JpdGVyLmJyZWFrQ29udGFpbmVyKHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcih2aWV3SXRlbSkpO1xuICAgICAgICAvLyAyLiBFeHRyYWN0IHZpZXcgbGlzdCB3aXRoIGNoYW5nZWQgdmlldyBsaXN0IGl0ZW0gYW5kIG1lcmdlIFwiaG9sZVwiIHBvc3NpYmx5IGNyZWF0ZWQgYnkgYnJlYWtpbmcgYW5kIHJlbW92aW5nIGVsZW1lbnRzLlxuICAgICAgICBjb25zdCB2aWV3TGlzdCA9IHZpZXdJdGVtLnBhcmVudDtcbiAgICAgICAgY29uc3Qgdmlld0xpc3RQcmV2ID0gdmlld0xpc3QucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICBjb25zdCByZW1vdmVSYW5nZSA9IHZpZXdXcml0ZXIuY3JlYXRlUmFuZ2VPbih2aWV3TGlzdCk7XG4gICAgICAgIHZpZXdXcml0ZXIucmVtb3ZlKHJlbW92ZVJhbmdlKTtcbiAgICAgICAgaWYgKHZpZXdMaXN0UHJldiAmJiB2aWV3TGlzdFByZXYubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgICAgIG1lcmdlVmlld0xpc3RzKHZpZXdXcml0ZXIsIHZpZXdMaXN0UHJldiwgdmlld0xpc3RQcmV2Lm5leHRTaWJsaW5nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAzLiBCcmluZyBiYWNrIG5lc3RlZCBsaXN0IHRoYXQgd2FzIGluIHRoZSByZW1vdmVkIDxsaT4uXG4gICAgICAgIGhvaXN0TmVzdGVkTGlzdHMoZGF0YS5hdHRyaWJ1dGVPbGRWYWx1ZSArIDEsIGRhdGEucmFuZ2Uuc3RhcnQsIHJlbW92ZVJhbmdlLnN0YXJ0LCB2aWV3SXRlbSwgY29udmVyc2lvbkFwaSwgbW9kZWwpO1xuICAgICAgICAvLyA0LiBJbmplY3QgdmlldyBsaXN0IGxpa2UgaXQgaXMgbmV3bHkgaW5zZXJ0ZWQuXG4gICAgICAgIGluamVjdFZpZXdMaXN0KGRhdGEuaXRlbSwgdmlld0l0ZW0sIGNvbnZlcnNpb25BcGksIG1vZGVsKTtcbiAgICAgICAgLy8gNS4gQ29uc3VtZSBpbnNlcnRpb24gb2YgY2hpbGRyZW4gaW5zaWRlIHRoZSBpdGVtLiBUaGV5IGFyZSBhbHJlYWR5IGhhbmRsZWQgYnkgcmUtYnVpbGRpbmcgdGhlIGl0ZW0gaW4gdmlldy5cbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBkYXRhLml0ZW0uZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShjaGlsZCwgJ2luc2VydCcpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogQSBzcGVjaWFsIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGludHJvZHVjZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0fkxlZ2FjeUxpc3QgbGlzdCBmZWF0dXJlfS4gVGhpcyBjb252ZXJ0ZXIgaXMgZmlyZWQgZm9yXG4gKiBpbnNlcnQgY2hhbmdlIG9mIGV2ZXJ5IG1vZGVsIGl0ZW0sIGFuZCBzaG91bGQgYmUgZmlyZWQgYmVmb3JlIHRoZSBhY3R1YWwgY29udmVydGVyLiBUaGUgY29udmVydGVyIGNoZWNrcyB3aGV0aGVyIHRoZSBpbnNlcnRlZFxuICogbW9kZWwgaXRlbSBpcyBhIG5vbi1gbGlzdEl0ZW1gIGVsZW1lbnQuIElmIGl0IGlzLCBhbmQgaXQgaXMgaW5zZXJ0ZWQgaW5zaWRlIGEgdmlldyBsaXN0LCB0aGUgY29udmVydGVyIGJyZWFrcyB0aGVcbiAqIGxpc3Qgc28gdGhlIG1vZGVsIGVsZW1lbnQgaXMgaW5zZXJ0ZWQgdG8gdGhlIHZpZXcgcGFyZW50IGVsZW1lbnQgY29ycmVzcG9uZGluZyB0byBpdHMgbW9kZWwgcGFyZW50IGVsZW1lbnQuXG4gKlxuICogVGhlIGNvbnZlcnRlciBwcmV2ZW50cyBzdWNoIHNpdHVhdGlvbnM6XG4gKlxuICogYGBgeG1sXG4gKiAvLyBNb2RlbDogICAgICAgICAgICAgICAgICAgICAgICAvLyBWaWV3OlxuICogPGxpc3RJdGVtPmZvbzwvbGlzdEl0ZW0+ICAgICAgICAgPHVsPlxuICogPGxpc3RJdGVtPmJhcjwvbGlzdEl0ZW0+ICAgICAgICAgICAgIDxsaT5mb288L2xpPlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5iYXI8L2xpPlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC91bD5cbiAqXG4gKiAvLyBBZnRlciBjaGFuZ2U6ICAgICAgICAgICAgICAgICAvLyBDb3JyZWN0IHZpZXcgZ3VhcmFudGVlZCBieSB0aGlzIGNvbnZlcnRlcjpcbiAqIDxsaXN0SXRlbT5mb288L2xpc3RJdGVtPiAgICAgICAgIDx1bD48bGk+Zm9vPC9saT48L3VsPjxwPnh4eDwvcD48dWw+PGxpPmJhcjwvbGk+PC91bD5cbiAqIDxwYXJhZ3JhcGg+eHh4PC9wYXJhZ3JhcGg+ICAgICAgIC8vIEluc3RlYWQgb2YgdGhpcyB3cm9uZyB2aWV3IHN0YXRlOlxuICogPGxpc3RJdGVtPmJhcjwvbGlzdEl0ZW0+ICAgICAgICAgPHVsPjxsaT5mb288L2xpPjxwPnh4eDwvcD48bGk+YmFyPC9saT48L3VsPlxuICogYGBgXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDppbnNlcnRcbiAqLyBjb25zdCBtb2RlbFZpZXdTcGxpdE9uSW5zZXJ0ID0gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGRhdGEuaXRlbSwgZXZ0Lm5hbWUpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGRhdGEuaXRlbS5uYW1lICE9ICdsaXN0SXRlbScpIHtcbiAgICAgICAgbGV0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKGRhdGEucmFuZ2Uuc3RhcnQpO1xuICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgIGNvbnN0IGxpc3RzID0gW107XG4gICAgICAgIC8vIEJyZWFrIG11bHRpcGxlIFVMcy9PTHMgaWYgdGhlcmUgYXJlLlxuICAgICAgICAvL1xuICAgICAgICAvLyBJbWFnaW5lIGZvbGxvd2luZyBsaXN0OlxuICAgICAgICAvL1xuICAgICAgICAvLyAxIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgICAxLjEuMSAtLS0tLS0tLVxuICAgICAgICAvLyAgICAgMS4xLjIgLS0tLS0tLS1cbiAgICAgICAgLy8gICAgIDEuMS4zIC0tLS0tLS0tXG4gICAgICAgIC8vICAgICAgIDEuMS4zLjEgLS0tLS0tLS1cbiAgICAgICAgLy8gICAxLjIgLS0tLS0tLS1cbiAgICAgICAgLy8gICAgIDEuMi4xIC0tLS0tLS0tXG4gICAgICAgIC8vIDIgLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gSW5zZXJ0IHBhcmFncmFwaCBhZnRlciBpdGVtIDEuMS4xOlxuICAgICAgICAvL1xuICAgICAgICAvLyAxIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgICAxLjEuMSAtLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyBMb3JlbSBpcHN1bS5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgIDEuMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgICAxLjEuMyAtLS0tLS0tLVxuICAgICAgICAvLyAgICAgICAxLjEuMy4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgICAxLjIuMSAtLS0tLS0tLVxuICAgICAgICAvLyAyIC0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEluIHRoaXMgY2FzZSAxLjEuMiBoYXMgdG8gYmVjb21lIGJlZ2lubmluZyBvZiBhIG5ldyBsaXN0LlxuICAgICAgICAvLyBXZSBuZWVkIHRvIGJyZWFrIGxpc3QgYmVmb3JlIDEuMS4yIChvYnZpb3VzKSwgdGhlbiB3ZSBuZWVkIHRvIGJyZWFrIGxpc3QgYWxzbyBiZWZvcmUgMS4yLlxuICAgICAgICAvLyBUaGVuIHdlIG5lZWQgdG8gbW92ZSB0aG9zZSBicm9rZW4gcGllY2VzIG9uZSBhZnRlciBhbm90aGVyIGFuZCBtZXJnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gMSAtLS0tLS0tLVxuICAgICAgICAvLyAgIDEuMSAtLS0tLS0tLVxuICAgICAgICAvLyAgICAgMS4xLjEgLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTG9yZW0gaXBzdW0uXG4gICAgICAgIC8vXG4gICAgICAgIC8vIDEuMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4xLjMgLS0tLS0tLS1cbiAgICAgICAgLy8gICAgIDEuMS4zLjEgLS0tLS0tLS1cbiAgICAgICAgLy8gMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4yLjEgLS0tLS0tLS1cbiAgICAgICAgLy8gMiAtLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICB3aGlsZSh2aWV3UG9zaXRpb24ucGFyZW50Lm5hbWUgPT0gJ3VsJyB8fCB2aWV3UG9zaXRpb24ucGFyZW50Lm5hbWUgPT0gJ29sJyl7XG4gICAgICAgICAgICB2aWV3UG9zaXRpb24gPSB2aWV3V3JpdGVyLmJyZWFrQ29udGFpbmVyKHZpZXdQb3NpdGlvbik7XG4gICAgICAgICAgICBpZiAodmlld1Bvc2l0aW9uLnBhcmVudC5uYW1lICE9ICdsaScpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJlbW92ZSBsaXN0cyB0aGF0IGFyZSBhZnRlciBpbnNlcnRlZCBlbGVtZW50LlxuICAgICAgICAgICAgLy8gVGhleSB3aWxsIGJlIGJyb3VnaHQgYmFjayBsYXRlciwgYmVsb3cgdGhlIGluc2VydGVkIGVsZW1lbnQuXG4gICAgICAgICAgICBjb25zdCByZW1vdmVTdGFydCA9IHZpZXdQb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZUVuZCA9IHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BdCh2aWV3UG9zaXRpb24ucGFyZW50LCAnZW5kJyk7XG4gICAgICAgICAgICAvLyBEb24ndCByZW1vdmUgaWYgdGhlcmUgaXMgbm90aGluZyB0byByZW1vdmUuXG4gICAgICAgICAgICBpZiAoIXJlbW92ZVN0YXJ0LmlzRXF1YWwocmVtb3ZlRW5kKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZWQgPSB2aWV3V3JpdGVyLnJlbW92ZSh2aWV3V3JpdGVyLmNyZWF0ZVJhbmdlKHJlbW92ZVN0YXJ0LCByZW1vdmVFbmQpKTtcbiAgICAgICAgICAgICAgICBsaXN0cy5wdXNoKHJlbW92ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlld1Bvc2l0aW9uID0gdmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHZpZXdQb3NpdGlvbi5wYXJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJyaW5nIGJhY2sgcmVtb3ZlZCBsaXN0cy5cbiAgICAgICAgaWYgKGxpc3RzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsaXN0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNMaXN0ID0gdmlld1Bvc2l0aW9uLm5vZGVCZWZvcmU7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5zZXJ0ZWRSYW5nZSA9IHZpZXdXcml0ZXIuaW5zZXJ0KHZpZXdQb3NpdGlvbiwgbGlzdHNbaV0pO1xuICAgICAgICAgICAgICAgIHZpZXdQb3NpdGlvbiA9IGluc2VydGVkUmFuZ2UuZW5kO1xuICAgICAgICAgICAgICAgIC8vIERvbid0IG1lcmdlIGZpcnN0IGxpc3QhIFdlIHdhbnQgYSBzcGxpdCBpbiB0aGF0IHBsYWNlICh0aGlzIGlzIHdoeSB0aGlzIGNvbnZlcnRlciBpcyBpbnRyb2R1Y2VkKS5cbiAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVyZ2VQb3MgPSBtZXJnZVZpZXdMaXN0cyh2aWV3V3JpdGVyLCBwcmV2aW91c0xpc3QsIHByZXZpb3VzTGlzdC5uZXh0U2libGluZyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIGBtZXJnZVBvc2AgaXMgaW4gYHByZXZpb3VzTGlzdGAgaXQgbWVhbnMgdGhhdCB0aGUgbGlzdHMgZ290IG1lcmdlZC5cbiAgICAgICAgICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlLCB3ZSBuZWVkIHRvIGZpeCBpbnNlcnQgcG9zaXRpb24uXG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXJnZVBvcyAmJiBtZXJnZVBvcy5wYXJlbnQgPT0gcHJldmlvdXNMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3UG9zaXRpb24ub2Zmc2V0LS07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBNZXJnZSBsYXN0IGluc2VydGVkIGxpc3Qgd2l0aCBlbGVtZW50IGFmdGVyIGl0LlxuICAgICAgICAgICAgbWVyZ2VWaWV3TGlzdHModmlld1dyaXRlciwgdmlld1Bvc2l0aW9uLm5vZGVCZWZvcmUsIHZpZXdQb3NpdGlvbi5ub2RlQWZ0ZXIpO1xuICAgICAgICB9XG4gICAgfVxufTtcbi8qKlxuICogQSBzcGVjaWFsIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGludHJvZHVjZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0fkxlZ2FjeUxpc3QgbGlzdCBmZWF0dXJlfS4gVGhpcyBjb252ZXJ0ZXIgdGFrZXMgY2FyZSBvZlxuICogbWVyZ2luZyB2aWV3IGxpc3RzIGFmdGVyIHNvbWV0aGluZyBpcyByZW1vdmVkIG9yIG1vdmVkIGZyb20gbmVhciB0aGVtLlxuICpcbiAqIEV4YW1wbGU6XG4gKlxuICogYGBgeG1sXG4gKiAvLyBNb2RlbDogICAgICAgICAgICAgICAgICAgICAgICAvLyBWaWV3OlxuICogPGxpc3RJdGVtPmZvbzwvbGlzdEl0ZW0+ICAgICAgICAgPHVsPjxsaT5mb288L2xpPjwvdWw+XG4gKiA8cGFyYWdyYXBoPnh4eDwvcGFyYWdyYXBoPiAgICAgICA8cD54eHg8L3A+XG4gKiA8bGlzdEl0ZW0+YmFyPC9saXN0SXRlbT4gICAgICAgICA8dWw+PGxpPmJhcjwvbGk+PC91bD5cbiAqXG4gKiAvLyBBZnRlciBjaGFuZ2U6ICAgICAgICAgICAgICAgICAvLyBDb3JyZWN0IHZpZXcgZ3VhcmFudGVlZCBieSB0aGlzIGNvbnZlcnRlcjpcbiAqIDxsaXN0SXRlbT5mb288L2xpc3RJdGVtPiAgICAgICAgIDx1bD5cbiAqIDxsaXN0SXRlbT5iYXI8L2xpc3RJdGVtPiAgICAgICAgICAgICA8bGk+Zm9vPC9saT5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+YmFyPC9saT5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+XG4gKiBgYGBcbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OnJlbW92ZVxuICovIGNvbnN0IG1vZGVsVmlld01lcmdlQWZ0ZXIgPSAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgIGNvbnN0IHZpZXdQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld1Bvc2l0aW9uKGRhdGEucG9zaXRpb24pO1xuICAgIGNvbnN0IHZpZXdJdGVtUHJldiA9IHZpZXdQb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgIGNvbnN0IHZpZXdJdGVtTmV4dCA9IHZpZXdQb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgLy8gTWVyZ2UgbGlzdHMgaWYgc29tZXRoaW5nIChyZW1vdmUsIG1vdmUpIHdhcyBkb25lIGZyb20gaW5zaWRlIG9mIGxpc3QuXG4gICAgLy8gTWVyZ2luZyB3aWxsIGJlIGRvbmUgb25seSBpZiBib3RoIGl0ZW1zIGFyZSB2aWV3IGxpc3RzIG9mIHRoZSBzYW1lIHR5cGUuXG4gICAgLy8gVGhlIGNoZWNrIGlzIGRvbmUgaW5zaWRlIHRoZSBoZWxwZXIgZnVuY3Rpb24uXG4gICAgbWVyZ2VWaWV3TGlzdHMoY29udmVyc2lvbkFwaS53cml0ZXIsIHZpZXdJdGVtUHJldiwgdmlld0l0ZW1OZXh0KTtcbn07XG4vKipcbiAqIEEgdmlldy10by1tb2RlbCBjb252ZXJ0ZXIgdGhhdCBjb252ZXJ0cyB0aGUgYDxsaT5gIHZpZXcgZWxlbWVudHMgaW50byB0aGUgYGxpc3RJdGVtYCBtb2RlbCBlbGVtZW50cy5cbiAqXG4gKiBUbyBzZXQgY29ycmVjdCB2YWx1ZXMgb2YgdGhlIGBsaXN0VHlwZWAgYW5kIGBsaXN0SW5kZW50YCBhdHRyaWJ1dGVzIHRoZSBjb252ZXJ0ZXI6XG4gKiAqIGNoZWNrcyBgPGxpPmAncyBwYXJlbnQsXG4gKiAqIHN0b3JlcyBhbmQgaW5jcmVhc2VzIHRoZSBgY29udmVyc2lvbkFwaS5zdG9yZS5pbmRlbnRgIHZhbHVlIHdoZW4gYDxsaT5gJ3Mgc3ViLWl0ZW1zIGFyZSBjb252ZXJ0ZWQuXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3REaXNwYXRjaGVyI2V2ZW50OmVsZW1lbnRcbiAqLyBjb25zdCB2aWV3TW9kZWxDb252ZXJ0ZXIgPSAoZXZ0LCBkYXRhLCBjb252ZXJzaW9uQXBpKT0+e1xuICAgIGlmIChjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLnZpZXdJdGVtLCB7XG4gICAgICAgIG5hbWU6IHRydWVcbiAgICB9KSkge1xuICAgICAgICBjb25zdCB3cml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgLy8gMS4gQ3JlYXRlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudC5cbiAgICAgICAgY29uc3QgbGlzdEl0ZW0gPSB3cml0ZXIuY3JlYXRlRWxlbWVudCgnbGlzdEl0ZW0nKTtcbiAgICAgICAgLy8gMi4gSGFuZGxlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudCBhdHRyaWJ1dGVzLlxuICAgICAgICBjb25zdCBpbmRlbnQgPSBnZXRJbmRlbnQoZGF0YS52aWV3SXRlbSk7XG4gICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnLCBpbmRlbnQsIGxpc3RJdGVtKTtcbiAgICAgICAgLy8gU2V0ICdidWxsZXRlZCcgYXMgZGVmYXVsdC4gSWYgdGhpcyBpdGVtIGlzIHBhc3RlZCBpbnRvIGEgY29udGV4dCxcbiAgICAgICAgY29uc3QgdHlwZSA9IGRhdGEudmlld0l0ZW0ucGFyZW50ICYmIGRhdGEudmlld0l0ZW0ucGFyZW50Lm5hbWUgPT0gJ29sJyA/ICdudW1iZXJlZCcgOiAnYnVsbGV0ZWQnO1xuICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0VHlwZScsIHR5cGUsIGxpc3RJdGVtKTtcbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLnNhZmVJbnNlcnQobGlzdEl0ZW0sIGRhdGEubW9kZWxDdXJzb3IpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV4dFBvc2l0aW9uID0gdmlld1RvTW9kZWxMaXN0SXRlbUNoaWxkcmVuQ29udmVydGVyKGxpc3RJdGVtLCBkYXRhLnZpZXdJdGVtLmdldENoaWxkcmVuKCksIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICAvLyBSZXN1bHQgcmFuZ2Ugc3RhcnRzIGJlZm9yZSB0aGUgZmlyc3QgaXRlbSBhbmQgZW5kcyBhZnRlciB0aGUgbGFzdC5cbiAgICAgICAgZGF0YS5tb2RlbFJhbmdlID0gd3JpdGVyLmNyZWF0ZVJhbmdlKGRhdGEubW9kZWxDdXJzb3IsIG5leHRQb3NpdGlvbik7XG4gICAgICAgIGNvbnZlcnNpb25BcGkudXBkYXRlQ29udmVyc2lvblJlc3VsdChsaXN0SXRlbSwgZGF0YSk7XG4gICAgfVxufTtcbi8qKlxuICogQSB2aWV3LXRvLW1vZGVsIGNvbnZlcnRlciBmb3IgdGhlIGA8dWw+YCBhbmQgYDxvbD5gIHZpZXcgZWxlbWVudHMgdGhhdCBjbGVhbnMgdGhlIGlucHV0IHZpZXcgb2YgZ2FyYmFnZS5cbiAqIFRoaXMgaXMgbW9zdGx5IHRvIGNsZWFuIHdoaXRlc3BhY2VzIGZyb20gYmV0d2VlbiB0aGUgYDxsaT5gIHZpZXcgZWxlbWVudHMgaW5zaWRlIHRoZSB2aWV3IGxpc3QgZWxlbWVudCwgaG93ZXZlciwgYWxzb1xuICogaW5jb3JyZWN0IGRhdGEgY2FuIGJlIGNsZWFyZWQgaWYgdGhlIHZpZXcgd2FzIGluY29ycmVjdC5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi91cGNhc3RkaXNwYXRjaGVyflVwY2FzdERpc3BhdGNoZXIjZXZlbnQ6ZWxlbWVudFxuICovIGNvbnN0IGNsZWFuTGlzdCA9IChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgaWYgKGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS50ZXN0KGRhdGEudmlld0l0ZW0sIHtcbiAgICAgICAgbmFtZTogdHJ1ZVxuICAgIH0pKSB7XG4gICAgICAgIC8vIENhY2hpbmcgY2hpbGRyZW4gYmVjYXVzZSB3aGVuIHdlIHN0YXJ0IHJlbW92aW5nIHRoZW0gaXRlcmF0aW5nIGZhaWxzLlxuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IEFycmF5LmZyb20oZGF0YS52aWV3SXRlbS5nZXRDaGlsZHJlbigpKTtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbil7XG4gICAgICAgICAgICBjb25zdCBpc1dyb25nRWxlbWVudCA9ICEoY2hpbGQuaXMoJ2VsZW1lbnQnLCAnbGknKSB8fCBpc0xpc3QoY2hpbGQpKTtcbiAgICAgICAgICAgIGlmIChpc1dyb25nRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGNoaWxkLl9yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIEEgdmlldy10by1tb2RlbCBjb252ZXJ0ZXIgZm9yIHRoZSBgPGxpPmAgZWxlbWVudHMgdGhhdCBjbGVhbnMgd2hpdGVzcGFjZSBmb3JtYXR0aW5nIGZyb20gdGhlIGlucHV0IHZpZXcuXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3REaXNwYXRjaGVyI2V2ZW50OmVsZW1lbnRcbiAqLyBjb25zdCBjbGVhbkxpc3RJdGVtID0gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICBpZiAoY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLnRlc3QoZGF0YS52aWV3SXRlbSwge1xuICAgICAgICBuYW1lOiB0cnVlXG4gICAgfSkpIHtcbiAgICAgICAgaWYgKGRhdGEudmlld0l0ZW0uY2hpbGRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW1xuICAgICAgICAgICAgLi4uZGF0YS52aWV3SXRlbS5nZXRDaGlsZHJlbigpXG4gICAgICAgIF07XG4gICAgICAgIGxldCBmb3VuZExpc3QgPSBmYWxzZTtcbiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbil7XG4gICAgICAgICAgICBpZiAoZm91bmRMaXN0ICYmICFpc0xpc3QoY2hpbGQpKSB7XG4gICAgICAgICAgICAgICAgY2hpbGQuX3JlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzTGlzdChjaGlsZCkpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgPHVsPiBvciA8b2w+LCBkbyBub3QgcHJvY2VzcyBpdCwganVzdCBtYXJrIHRoYXQgd2UgYWxyZWFkeSB2aXNpdGVkIGxpc3QgZWxlbWVudC5cbiAgICAgICAgICAgICAgICBmb3VuZExpc3QgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcbi8qKlxuICogUmV0dXJucyBhIGNhbGxiYWNrIGZvciBtb2RlbCBwb3NpdGlvbiB0byB2aWV3IHBvc2l0aW9uIG1hcHBpbmcgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlcn0uIFRoZSBjYWxsYmFjayBmaXhlc1xuICogcG9zaXRpb25zIGJldHdlZW4gdGhlIGBsaXN0SXRlbWAgZWxlbWVudHMgdGhhdCB3b3VsZCBiZSBpbmNvcnJlY3RseSBtYXBwZWQgYmVjYXVzZSBvZiBob3cgbGlzdCBpdGVtcyBhcmUgcmVwcmVzZW50ZWQgaW4gdGhlIG1vZGVsXG4gKiBhbmQgaW4gdGhlIHZpZXcuXG4gKi8gZnVuY3Rpb24gbW9kZWxUb1ZpZXdQb3NpdGlvbih2aWV3KSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEpPT57XG4gICAgICAgIGlmIChkYXRhLmlzUGhhbnRvbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vZGVsSXRlbSA9IGRhdGEubW9kZWxQb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgICAgICBpZiAobW9kZWxJdGVtICYmIG1vZGVsSXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICBjb25zdCB2aWV3SXRlbSA9IGRhdGEubWFwcGVyLnRvVmlld0VsZW1lbnQobW9kZWxJdGVtKTtcbiAgICAgICAgICAgIGNvbnN0IHRvcG1vc3RWaWV3TGlzdCA9IHZpZXdJdGVtLmdldEFuY2VzdG9ycygpLmZpbmQoaXNMaXN0KTtcbiAgICAgICAgICAgIGNvbnN0IHdhbGtlciA9IHZpZXcuY3JlYXRlUG9zaXRpb25BdCh2aWV3SXRlbSwgMCkuZ2V0V2Fsa2VyKCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHdhbGtlcil7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLnR5cGUgPT0gJ2VsZW1lbnRTdGFydCcgJiYgdmFsdWUuaXRlbS5pcygnZWxlbWVudCcsICdsaScpKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEudmlld1Bvc2l0aW9uID0gdmFsdWUucHJldmlvdXNQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09ICdlbGVtZW50RW5kJyAmJiB2YWx1ZS5pdGVtID09IHRvcG1vc3RWaWV3TGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnZpZXdQb3NpdGlvbiA9IHZhbHVlLm5leHRQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogVGhlIGNhbGxiYWNrIGZvciB2aWV3IHBvc2l0aW9uIHRvIG1vZGVsIHBvc2l0aW9uIG1hcHBpbmcgZm9yIHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vbWFwcGVyfk1hcHBlcn0uIFRoZSBjYWxsYmFjayBmaXhlc1xuICogcG9zaXRpb25zIGJldHdlZW4gdGhlIGA8bGk+YCBlbGVtZW50cyB0aGF0IHdvdWxkIGJlIGluY29ycmVjdGx5IG1hcHBlZCBiZWNhdXNlIG9mIGhvdyBsaXN0IGl0ZW1zIGFyZSByZXByZXNlbnRlZCBpbiB0aGUgbW9kZWxcbiAqIGFuZCBpbiB0aGUgdmlldy5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9tYXBwZXJ+TWFwcGVyI2V2ZW50OnZpZXdUb01vZGVsUG9zaXRpb25cbiAqIEBwYXJhbSBtb2RlbCBNb2RlbCBpbnN0YW5jZS5cbiAqIEByZXR1cm5zIFJldHVybnMgYSBjb252ZXJzaW9uIGNhbGxiYWNrLlxuICovIGZ1bmN0aW9uIHZpZXdUb01vZGVsUG9zaXRpb24obW9kZWwpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSk9PntcbiAgICAgICAgY29uc3Qgdmlld1BvcyA9IGRhdGEudmlld1Bvc2l0aW9uO1xuICAgICAgICBjb25zdCB2aWV3UGFyZW50ID0gdmlld1Bvcy5wYXJlbnQ7XG4gICAgICAgIGNvbnN0IG1hcHBlciA9IGRhdGEubWFwcGVyO1xuICAgICAgICBpZiAodmlld1BhcmVudC5uYW1lID09ICd1bCcgfHwgdmlld1BhcmVudC5uYW1lID09ICdvbCcpIHtcbiAgICAgICAgICAgIC8vIFBvc2l0aW9uIGlzIGRpcmVjdGx5IGluIDx1bD4gb3IgPG9sPi5cbiAgICAgICAgICAgIGlmICghdmlld1Bvcy5pc0F0RW5kKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgcG9zaXRpb24gaXMgbm90IGF0IHRoZSBlbmQsIGl0IG11c3QgYmUgYmVmb3JlIDxsaT4uXG4gICAgICAgICAgICAgICAgLy8gR2V0IHRoYXQgPGxpPiwgbWFwIGl0IHRvIGBsaXN0SXRlbWAgYW5kIHNldCBtb2RlbCBwb3NpdGlvbiBiZWZvcmUgdGhhdCBgbGlzdEl0ZW1gLlxuICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVsTm9kZSA9IG1hcHBlci50b01vZGVsRWxlbWVudCh2aWV3UG9zLm5vZGVBZnRlcik7XG4gICAgICAgICAgICAgICAgZGF0YS5tb2RlbFBvc2l0aW9uID0gbW9kZWwuY3JlYXRlUG9zaXRpb25CZWZvcmUobW9kZWxOb2RlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gUG9zaXRpb24gaXMgYXQgdGhlIGVuZCBvZiA8dWw+IG9yIDxvbD4sIHNvIHRoZXJlIGlzIG5vIDxsaT4gYWZ0ZXIgaXQgdG8gYmUgbWFwcGVkLlxuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGlzIDxsaT4gYmVmb3JlIHRoZSBwb3NpdGlvbiwgYnV0IHdlIGNhbm5vdCBqdXN0IG1hcCBpdCB0byBgbGlzdEl0ZW1gIGFuZCBzZXQgbW9kZWwgcG9zaXRpb24gYWZ0ZXIgaXQsXG4gICAgICAgICAgICAgICAgLy8gYmVjYXVzZSB0aGF0IDxsaT4gbWF5IGNvbnRhaW4gbmVzdGVkIGl0ZW1zLlxuICAgICAgICAgICAgICAgIC8vIFdlIHdpbGwgY2hlY2sgXCJtb2RlbCBsZW5ndGhcIiBvZiB0aGF0IDxsaT4sIGluIG90aGVyIHdvcmRzIC0gaG93IG1hbnkgYGxpc3RJdGVtYHMgYXJlIGluIHRoYXQgPGxpPi5cbiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbE5vZGUgPSBtYXBwZXIudG9Nb2RlbEVsZW1lbnQodmlld1Bvcy5ub2RlQmVmb3JlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtb2RlbExlbmd0aCA9IG1hcHBlci5nZXRNb2RlbExlbmd0aCh2aWV3UG9zLm5vZGVCZWZvcmUpO1xuICAgICAgICAgICAgICAgIC8vIFRoZW4gd2UgZ2V0IG1vZGVsIHBvc2l0aW9uIGJlZm9yZSBtYXBwZWQgYGxpc3RJdGVtYCBhbmQgc2hpZnQgaXQgYWNjb3JkaW5nbHkuXG4gICAgICAgICAgICAgICAgZGF0YS5tb2RlbFBvc2l0aW9uID0gbW9kZWwuY3JlYXRlUG9zaXRpb25CZWZvcmUobW9kZWxOb2RlKS5nZXRTaGlmdGVkQnkobW9kZWxMZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgfSBlbHNlIGlmICh2aWV3UGFyZW50Lm5hbWUgPT0gJ2xpJyAmJiB2aWV3UG9zLm5vZGVCZWZvcmUgJiYgKHZpZXdQb3Mubm9kZUJlZm9yZS5uYW1lID09ICd1bCcgfHwgdmlld1Bvcy5ub2RlQmVmb3JlLm5hbWUgPT0gJ29sJykpIHtcbiAgICAgICAgICAgIC8vIEluIG1vc3QgY2FzZXMgd2hlbiB2aWV3IHBvc2l0aW9uIGlzIGluIDxsaT4gaXQgaXMgaW4gdGV4dCBhbmQgdGhpcyBpcyBhIGNvcnJlY3QgcG9zaXRpb24uXG4gICAgICAgICAgICAvLyBIb3dldmVyLCBpZiBwb3NpdGlvbiBpcyBhZnRlciA8dWw+IG9yIDxvbD4gd2UgaGF2ZSB0byBmaXggaXQgLS0gYmVjYXVzZSBpbiBtb2RlbCA8dWw+LzxvbD4gYXJlIG5vdCBpbiB0aGUgYGxpc3RJdGVtYC5cbiAgICAgICAgICAgIGNvbnN0IG1vZGVsTm9kZSA9IG1hcHBlci50b01vZGVsRWxlbWVudCh2aWV3UGFyZW50KTtcbiAgICAgICAgICAgIC8vIENoZWNrIGFsbCA8dWw+cyBhbmQgPG9sPnMgdGhhdCBhcmUgaW4gdGhlIDxsaT4gYnV0IGJlZm9yZSBtYXBwZWQgcG9zaXRpb24uXG4gICAgICAgICAgICAvLyBHZXQgbW9kZWwgbGVuZ3RoIG9mIHRob3NlIGVsZW1lbnRzIGFuZCB0aGVuIGFkZCBpdCB0byB0aGUgb2Zmc2V0IG9mIGBsaXN0SXRlbWAgbWFwcGVkIHRvIHRoZSBvcmlnaW5hbCA8bGk+LlxuICAgICAgICAgICAgbGV0IG1vZGVsTGVuZ3RoID0gMTsgLy8gU3RhcnRzIGZyb20gMSBiZWNhdXNlIHRoZSBvcmlnaW5hbCA8bGk+IGhhcyB0byBiZSBjb3VudGVkIGluIHRvby5cbiAgICAgICAgICAgIGxldCB2aWV3TGlzdCA9IHZpZXdQb3Mubm9kZUJlZm9yZTtcbiAgICAgICAgICAgIHdoaWxlKHZpZXdMaXN0ICYmIGlzTGlzdCh2aWV3TGlzdCkpe1xuICAgICAgICAgICAgICAgIG1vZGVsTGVuZ3RoICs9IG1hcHBlci5nZXRNb2RlbExlbmd0aCh2aWV3TGlzdCk7XG4gICAgICAgICAgICAgICAgdmlld0xpc3QgPSB2aWV3TGlzdC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkYXRhLm1vZGVsUG9zaXRpb24gPSBtb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShtb2RlbE5vZGUpLmdldFNoaWZ0ZWRCeShtb2RlbExlbmd0aCk7XG4gICAgICAgICAgICBldnQuc3RvcCgpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogUG9zdC1maXhlciB0aGF0IHJlYWN0cyB0byBjaGFuZ2VzIG9uIGRvY3VtZW50IGFuZCBmaXhlcyBpbmNvcnJlY3QgbW9kZWwgc3RhdGVzLlxuICpcbiAqIEluIHRoZSBleGFtcGxlIGJlbG93LCB0aGVyZSBpcyBhIGNvcnJlY3QgbGlzdCBzdHJ1Y3R1cmUuXG4gKiBUaGVuIHRoZSBtaWRkbGUgZWxlbWVudCBpcyByZW1vdmVkIHNvIHRoZSBsaXN0IHN0cnVjdHVyZSB3aWxsIGJlY29tZSBpbmNvcnJlY3Q6XG4gKlxuICogYGBgeG1sXG4gKiA8bGlzdEl0ZW0gbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJbmRlbnQ9MD5JdGVtIDE8L2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTE+SXRlbSAyPC9saXN0SXRlbT4gICA8LS0tIHRoaXMgaXMgcmVtb3ZlZC5cbiAqIDxsaXN0SXRlbSBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEluZGVudD0yPkl0ZW0gMzwvbGlzdEl0ZW0+XG4gKiBgYGBcbiAqXG4gKiBUaGUgbGlzdCBzdHJ1Y3R1cmUgYWZ0ZXIgdGhlIG1pZGRsZSBlbGVtZW50IGlzIHJlbW92ZWQ6XG4gKlxuICogYGBgeG1sXG4gKiA8bGlzdEl0ZW0gbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJbmRlbnQ9MD5JdGVtIDE8L2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTI+SXRlbSAzPC9saXN0SXRlbT5cbiAqIGBgYFxuICpcbiAqIFNob3VsZCBiZWNvbWU6XG4gKlxuICogYGBgeG1sXG4gKiA8bGlzdEl0ZW0gbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJbmRlbnQ9MD5JdGVtIDE8L2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTE+SXRlbSAzPC9saXN0SXRlbT4gICA8LS0tIG5vdGUgdGhhdCBpbmRlbnQgZ290IHBvc3QtZml4ZWQuXG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gbW9kZWwgVGhlIGRhdGEgbW9kZWwuXG4gKiBAcGFyYW0gd3JpdGVyIFRoZSB3cml0ZXIgdG8gZG8gY2hhbmdlcyB3aXRoLlxuICogQHJldHVybnMgYHRydWVgIGlmIGFueSBjaGFuZ2UgaGFzIGJlZW4gYXBwbGllZCwgYGZhbHNlYCBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gbW9kZWxDaGFuZ2VQb3N0Rml4ZXIobW9kZWwsIHdyaXRlcikge1xuICAgIGNvbnN0IGNoYW5nZXMgPSBtb2RlbC5kb2N1bWVudC5kaWZmZXIuZ2V0Q2hhbmdlcygpO1xuICAgIGNvbnN0IGl0ZW1Ub0xpc3RIZWFkID0gbmV3IE1hcCgpO1xuICAgIGxldCBhcHBsaWVkID0gZmFsc2U7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiBjaGFuZ2VzKXtcbiAgICAgICAgaWYgKGVudHJ5LnR5cGUgPT0gJ2luc2VydCcgJiYgZW50cnkubmFtZSA9PSAnbGlzdEl0ZW0nKSB7XG4gICAgICAgICAgICBfYWRkTGlzdFRvRml4KGVudHJ5LnBvc2l0aW9uKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09ICdpbnNlcnQnICYmIGVudHJ5Lm5hbWUgIT0gJ2xpc3RJdGVtJykge1xuICAgICAgICAgICAgaWYgKGVudHJ5Lm5hbWUgIT0gJyR0ZXh0Jykge1xuICAgICAgICAgICAgICAgIC8vIEluIGNhc2Ugb2YgcmVuYW1lZCBlbGVtZW50LlxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBlbnRyeS5wb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0SW5kZW50JykpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgnbGlzdEluZGVudCcsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0VHlwZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGFwcGxpZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNBdHRyaWJ1dGUoJ2xpc3RTdHlsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoJ2xpc3RTdHlsZScsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0UmV2ZXJzZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCdsaXN0UmV2ZXJzZWQnLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0F0dHJpYnV0ZSgnbGlzdFN0YXJ0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgnbGlzdFN0YXJ0JywgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIGFwcGxpZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGlubmVySXRlbSBvZiBBcnJheS5mcm9tKG1vZGVsLmNyZWF0ZVJhbmdlSW4oaXRlbSkpLmZpbHRlcigoZSk9PmUuaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSl7XG4gICAgICAgICAgICAgICAgICAgIF9hZGRMaXN0VG9GaXgoaW5uZXJJdGVtLnByZXZpb3VzUG9zaXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBvc0FmdGVyID0gZW50cnkucG9zaXRpb24uZ2V0U2hpZnRlZEJ5KGVudHJ5Lmxlbmd0aCk7XG4gICAgICAgICAgICBfYWRkTGlzdFRvRml4KHBvc0FmdGVyKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09ICdyZW1vdmUnICYmIGVudHJ5Lm5hbWUgPT0gJ2xpc3RJdGVtJykge1xuICAgICAgICAgICAgX2FkZExpc3RUb0ZpeChlbnRyeS5wb3NpdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAoZW50cnkudHlwZSA9PSAnYXR0cmlidXRlJyAmJiBlbnRyeS5hdHRyaWJ1dGVLZXkgPT0gJ2xpc3RJbmRlbnQnKSB7XG4gICAgICAgICAgICBfYWRkTGlzdFRvRml4KGVudHJ5LnJhbmdlLnN0YXJ0KTtcbiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS50eXBlID09ICdhdHRyaWJ1dGUnICYmIGVudHJ5LmF0dHJpYnV0ZUtleSA9PSAnbGlzdFR5cGUnKSB7XG4gICAgICAgICAgICBfYWRkTGlzdFRvRml4KGVudHJ5LnJhbmdlLnN0YXJ0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IGxpc3RIZWFkIG9mIGl0ZW1Ub0xpc3RIZWFkLnZhbHVlcygpKXtcbiAgICAgICAgX2ZpeExpc3RJbmRlbnRzKGxpc3RIZWFkKTtcbiAgICAgICAgX2ZpeExpc3RUeXBlcyhsaXN0SGVhZCk7XG4gICAgfVxuICAgIHJldHVybiBhcHBsaWVkO1xuICAgIGZ1bmN0aW9uIF9hZGRMaXN0VG9GaXgocG9zaXRpb24pIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNOb2RlID0gcG9zaXRpb24ubm9kZUJlZm9yZTtcbiAgICAgICAgaWYgKCFwcmV2aW91c05vZGUgfHwgIXByZXZpb3VzTm9kZS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gcG9zaXRpb24ubm9kZUFmdGVyO1xuICAgICAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICAgICAgaXRlbVRvTGlzdEhlYWQuc2V0KGl0ZW0sIGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IGxpc3RIZWFkID0gcHJldmlvdXNOb2RlO1xuICAgICAgICAgICAgaWYgKGl0ZW1Ub0xpc3RIZWFkLmhhcyhsaXN0SGVhZCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IoLy8gQ2FjaGUgcHJldmlvdXNTaWJsaW5nIGFuZCByZXVzZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucy4gU2VlICM2NTgxLlxuICAgICAgICAgICAgbGV0IHByZXZpb3VzU2libGluZyA9IGxpc3RIZWFkLnByZXZpb3VzU2libGluZzsgcHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpOyBwcmV2aW91c1NpYmxpbmcgPSBsaXN0SGVhZC5wcmV2aW91c1NpYmxpbmcpe1xuICAgICAgICAgICAgICAgIGxpc3RIZWFkID0gcHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtVG9MaXN0SGVhZC5oYXMobGlzdEhlYWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtVG9MaXN0SGVhZC5zZXQocHJldmlvdXNOb2RlLCBsaXN0SGVhZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gX2ZpeExpc3RJbmRlbnRzKGl0ZW0pIHtcbiAgICAgICAgbGV0IG1heEluZGVudCA9IDA7XG4gICAgICAgIGxldCBmaXhCeSA9IG51bGw7XG4gICAgICAgIHdoaWxlKGl0ZW0gJiYgaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKXtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JbmRlbnQgPSBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICAgICAgaWYgKGl0ZW1JbmRlbnQgPiBtYXhJbmRlbnQpIHtcbiAgICAgICAgICAgICAgICBsZXQgbmV3SW5kZW50O1xuICAgICAgICAgICAgICAgIGlmIChmaXhCeSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBmaXhCeSA9IGl0ZW1JbmRlbnQgLSBtYXhJbmRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIG5ld0luZGVudCA9IG1heEluZGVudDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZml4QnkgPiBpdGVtSW5kZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXhCeSA9IGl0ZW1JbmRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbmV3SW5kZW50ID0gaXRlbUluZGVudCAtIGZpeEJ5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JywgbmV3SW5kZW50LCBpdGVtKTtcbiAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZml4QnkgPSBudWxsO1xuICAgICAgICAgICAgICAgIG1heEluZGVudCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaXRlbSA9IGl0ZW0ubmV4dFNpYmxpbmc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gX2ZpeExpc3RUeXBlcyhpdGVtKSB7XG4gICAgICAgIGxldCB0eXBlc1N0YWNrID0gW107XG4gICAgICAgIGxldCBwcmV2ID0gbnVsbDtcbiAgICAgICAgd2hpbGUoaXRlbSAmJiBpdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpe1xuICAgICAgICAgICAgY29uc3QgaXRlbUluZGVudCA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgICAgICBpZiAocHJldiAmJiBwcmV2LmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpID4gaXRlbUluZGVudCkge1xuICAgICAgICAgICAgICAgIHR5cGVzU3RhY2sgPSB0eXBlc1N0YWNrLnNsaWNlKDAsIGl0ZW1JbmRlbnQgKyAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpdGVtSW5kZW50ICE9IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZXNTdGFja1tpdGVtSW5kZW50XSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gdHlwZXNTdGFja1tpdGVtSW5kZW50XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9IHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgdHlwZSwgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVzU3RhY2tbaXRlbUluZGVudF0gPSBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcmV2ID0gaXRlbTtcbiAgICAgICAgICAgIGl0ZW0gPSBpdGVtLm5leHRTaWJsaW5nO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBBIGZpeGVyIGZvciBwYXN0ZWQgY29udGVudCB0aGF0IGluY2x1ZGVzIGxpc3QgaXRlbXMuXG4gKlxuICogSXQgZml4ZXMgaW5kZW50YXRpb24gb2YgcGFzdGVkIGxpc3QgaXRlbXMgc28gdGhlIHBhc3RlZCBpdGVtcyBtYXRjaCBjb3JyZWN0bHkgdG8gdGhlIGNvbnRleHQgdGhleSBhcmUgcGFzdGVkIGludG8uXG4gKlxuICogRXhhbXBsZTpcbiAqXG4gKiBgYGB4bWxcbiAqIDxsaXN0SXRlbSBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEluZGVudD0wPkE8L2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTE+Ql48L2xpc3RJdGVtPlxuICogLy8gQXQgXiBwYXN0ZTogIDxsaXN0SXRlbSBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEluZGVudD00Plg8L2xpc3RJdGVtPlxuICogLy8gICAgICAgICAgICAgIDxsaXN0SXRlbSBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdEluZGVudD01Plk8L2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTI+QzwvbGlzdEl0ZW0+XG4gKiBgYGBcbiAqXG4gKiBTaG91bGQgYmVjb21lOlxuICpcbiAqIGBgYHhtbFxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTA+QTwvbGlzdEl0ZW0+XG4gKiA8bGlzdEl0ZW0gbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJbmRlbnQ9MT5CWDwvbGlzdEl0ZW0+XG4gKiA8bGlzdEl0ZW0gbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RJbmRlbnQ9Mj5ZL2xpc3RJdGVtPlxuICogPGxpc3RJdGVtIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0SW5kZW50PTI+QzwvbGlzdEl0ZW0+XG4gKiBgYGBcbiAqLyBjb25zdCBtb2RlbEluZGVudFBhc3RlRml4ZXIgPSBmdW5jdGlvbihldnQsIFtjb250ZW50LCBzZWxlY3RhYmxlXSkge1xuICAgIGNvbnN0IG1vZGVsID0gdGhpcztcbiAgICAvLyBDaGVjayB3aGV0aGVyIGluc2VydGVkIGNvbnRlbnQgc3RhcnRzIGZyb20gYSBgbGlzdEl0ZW1gLiBJZiBpdCBkb2VzIG5vdCwgaXQgbWVhbnMgdGhhdCB0aGVyZSBhcmUgc29tZSBvdGhlclxuICAgIC8vIGVsZW1lbnRzIGJlZm9yZSBpdCBhbmQgdGhlcmUgaXMgbm8gbmVlZCB0byBmaXggaW5kZW50cywgYmVjYXVzZSBldmVuIGlmIHdlIGluc2VydCB0aGF0IGNvbnRlbnQgaW50byBhIGxpc3QsXG4gICAgLy8gdGhhdCBsaXN0IHdpbGwgYmUgYnJva2VuLlxuICAgIC8vIE5vdGU6IHdlIGFsc28gbmVlZCB0byBoYW5kbGUgc2luZ3VsYXIgZWxlbWVudHMgYmVjYXVzZSBpbnNlcnRpbmcgaXRlbSB3aXRoIGluZGVudCAwIGludG8gMCwxLFtdLDJcbiAgICAvLyB3b3VsZCBjcmVhdGUgaW5jb3JyZWN0IG1vZGVsLlxuICAgIGxldCBpdGVtID0gY29udGVudC5pcygnZG9jdW1lbnRGcmFnbWVudCcpID8gY29udGVudC5nZXRDaGlsZCgwKSA6IGNvbnRlbnQ7XG4gICAgbGV0IHNlbGVjdGlvbjtcbiAgICBpZiAoIXNlbGVjdGFibGUpIHtcbiAgICAgICAgc2VsZWN0aW9uID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdGlvbiA9IG1vZGVsLmNyZWF0ZVNlbGVjdGlvbihzZWxlY3RhYmxlKTtcbiAgICB9XG4gICAgaWYgKGl0ZW0gJiYgaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgIC8vIEdldCBhIHJlZmVyZW5jZSBsaXN0IGl0ZW0uIEluc2VydGVkIGxpc3QgaXRlbXMgd2lsbCBiZSBmaXhlZCBhY2NvcmRpbmcgdG8gdGhhdCBpdGVtLlxuICAgICAgICBjb25zdCBwb3MgPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICBsZXQgcmVmSXRlbSA9IG51bGw7XG4gICAgICAgIGlmIChwb3MucGFyZW50LmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIHJlZkl0ZW0gPSBwb3MucGFyZW50O1xuICAgICAgICB9IGVsc2UgaWYgKHBvcy5ub2RlQmVmb3JlICYmIHBvcy5ub2RlQmVmb3JlLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIHJlZkl0ZW0gPSBwb3Mubm9kZUJlZm9yZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB0aGVyZSBpcyBgcmVmSXRlbWAgaXQgbWVhbnMgdGhhdCB3ZSBkbyBpbnNlcnQgbGlzdCBpdGVtcyBpbnRvIGFuIGV4aXN0aW5nIGxpc3QuXG4gICAgICAgIGlmIChyZWZJdGVtKSB7XG4gICAgICAgICAgICAvLyBGaXJzdCBsaXN0IGl0ZW0gaW4gYGRhdGFgIGhhcyBpbmRlbnQgZXF1YWwgdG8gMCAoaXQgaXMgYSBmaXJzdCBsaXN0IGl0ZW0pLiBJdCBzaG91bGQgaGF2ZSBpbmRlbnQgZXF1YWxcbiAgICAgICAgICAgIC8vIHRvIHRoZSBpbmRlbnQgb2YgcmVmZXJlbmNlIGl0ZW0uIFdlIGhhdmUgdG8gZml4IHRoZSBmaXJzdCBpdGVtIGFuZCBhbGwgb2YgaXQncyBjaGlsZHJlbiBhbmQgZm9sbG93aW5nIHNpYmxpbmdzLlxuICAgICAgICAgICAgLy8gSW5kZW50IG9mIGFsbCB0aG9zZSBpdGVtcyBoYXMgdG8gYmUgYWRqdXN0ZWQgdG8gcmVmZXJlbmNlIGl0ZW0uXG4gICAgICAgICAgICBjb25zdCBpbmRlbnRDaGFuZ2UgPSByZWZJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICAgICAgLy8gRml4IG9ubHkgaWYgdGhlcmUgaXMgYW55dGhpbmcgdG8gZml4LlxuICAgICAgICAgICAgaWYgKGluZGVudENoYW5nZSA+IDApIHtcbiAgICAgICAgICAgICAgICAvLyBBZGp1c3QgaW5kZW50IG9mIGFsbCBcImZpcnN0XCIgbGlzdCBpdGVtcyBpbiBpbnNlcnRlZCBkYXRhLlxuICAgICAgICAgICAgICAgIHdoaWxlKGl0ZW0gJiYgaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKXtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5fc2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JywgaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSArIGluZGVudENoYW5nZSk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtLm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGNoaWxkcmVuIG9mIGEgZ2l2ZW4gYDxsaT5gIHZpZXcgZWxlbWVudCBpbnRvIGNvcnJlc3BvbmRpbmcgbW9kZWwgZWxlbWVudHMuXG4gKiBUaGUgZnVuY3Rpb24gbWFpbnRhaW5zIHByb3BlciBvcmRlciBvZiBlbGVtZW50cyBpZiBtb2RlbCBgbGlzdEl0ZW1gIGlzIHNwbGl0IGR1cmluZyB0aGUgY29udmVyc2lvblxuICogZHVlIHRvIGJsb2NrIGNoaWxkcmVuIGNvbnZlcnNpb24uXG4gKlxuICogQHBhcmFtIGxpc3RJdGVtTW9kZWwgTGlzdCBpdGVtIG1vZGVsIGVsZW1lbnQgdG8gd2hpY2ggY29udmVydGVkIGNoaWxkcmVuIHdpbGwgYmUgaW5zZXJ0ZWQuXG4gKiBAcGFyYW0gdmlld0NoaWxkcmVuIFZpZXcgZWxlbWVudHMgd2hpY2ggd2lsbCBiZSBjb252ZXJ0ZWQuXG4gKiBAcGFyYW0gY29udmVyc2lvbkFwaSBDb252ZXJzaW9uIGludGVyZmFjZSB0byBiZSB1c2VkIGJ5IHRoZSBjYWxsYmFjay5cbiAqIEByZXR1cm5zIFBvc2l0aW9uIG9uIHdoaWNoIG5leHQgZWxlbWVudHMgc2hvdWxkIGJlIGluc2VydGVkIGFmdGVyIGNoaWxkcmVuIGNvbnZlcnNpb24uXG4gKi8gZnVuY3Rpb24gdmlld1RvTW9kZWxMaXN0SXRlbUNoaWxkcmVuQ29udmVydGVyKGxpc3RJdGVtTW9kZWwsIHZpZXdDaGlsZHJlbiwgY29udmVyc2lvbkFwaSkge1xuICAgIGNvbnN0IHsgd3JpdGVyLCBzY2hlbWEgfSA9IGNvbnZlcnNpb25BcGk7XG4gICAgLy8gQSBwb3NpdGlvbiBhZnRlciB0aGUgbGFzdCBpbnNlcnRlZCBgbGlzdEl0ZW1gLlxuICAgIGxldCBuZXh0UG9zaXRpb24gPSB3cml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihsaXN0SXRlbU1vZGVsKTtcbiAgICAvLyBDaGVjayBhbGwgY2hpbGRyZW4gb2YgdGhlIGNvbnZlcnRlZCBgPGxpPmAuIEF0IHRoaXMgcG9pbnQgd2UgYXNzdW1lIHRoZXJlIGFyZSBubyBcIndoaXRlc3BhY2VcIiB2aWV3IHRleHQgbm9kZXNcbiAgICAvLyBpbiB2aWV3IGxpc3QsIGJldHdlZW4gdmlldyBsaXN0IGl0ZW1zLiBUaGlzIHNob3VsZCBiZSBoYW5kbGVkIGJ5IGA8dWw+YCBhbmQgYDxvbD5gIGNvbnZlcnRlcnMuXG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiB2aWV3Q2hpbGRyZW4pe1xuICAgICAgICBpZiAoY2hpbGQubmFtZSA9PSAndWwnIHx8IGNoaWxkLm5hbWUgPT0gJ29sJykge1xuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkcmVuIGlzIGEgbGlzdCwgd2Ugd2lsbCBpbnNlcnQgaXRzIGNvbnZlcnNpb24gcmVzdWx0IGFmdGVyIGN1cnJlbnRseSBoYW5kbGVkIGBsaXN0SXRlbWAuXG4gICAgICAgICAgICAvLyBUaGVuLCBuZXh0IGluc2VydGlvbiBwb3NpdGlvbiB3aWxsIGJlIHNldCBhZnRlciBhbGwgdGhlIG5ldyBsaXN0IGl0ZW1zIChhbmQgbWF5YmUgb3RoZXIgZWxlbWVudHMgaWZcbiAgICAgICAgICAgIC8vIHNvbWV0aGluZyBzcGxpdCBsaXN0IGl0ZW0pLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBsaXN0LCB3ZSBleHBlY3QgdGhhdCBzb21lIGBsaXN0SXRlbWBzIGFuZCBwb3NzaWJseSBvdGhlciBibG9ja3Mgd2lsbCBiZSBpbnNlcnRlZCwgaG93ZXZlciBgLm1vZGVsQ3Vyc29yYFxuICAgICAgICAgICAgLy8gc2hvdWxkIGJlIHNldCBhZnRlciBsYXN0IGBsaXN0SXRlbWAgKG9yIGJsb2NrKS4gVGhpcyBpcyB3aHkgaXQgZmVlbHMgc2FmZSB0byB1c2UgaXQgYXMgYG5leHRQb3NpdGlvbmBcbiAgICAgICAgICAgIG5leHRQb3NpdGlvbiA9IGNvbnZlcnNpb25BcGkuY29udmVydEl0ZW0oY2hpbGQsIG5leHRQb3NpdGlvbikubW9kZWxDdXJzb3I7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJZiB0aGlzIGlzIG5vdCBhIGxpc3QsIHRyeSBpbnNlcnRpbmcgY29udGVudCBhdCB0aGUgZW5kIG9mIHRoZSBjdXJyZW50bHkgaGFuZGxlZCBgbGlzdEl0ZW1gLlxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29udmVyc2lvbkFwaS5jb252ZXJ0SXRlbShjaGlsZCwgd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobGlzdEl0ZW1Nb2RlbCwgJ2VuZCcpKTtcbiAgICAgICAgICAgIC8vIEl0IG1heSBlbmQgdXAgdGhhdCB0aGUgY3VycmVudCBgbGlzdEl0ZW1gIGJlY29tZXMgc3BsaXQgKGlmIHRoYXQgY29udGVudCBjYW5ub3QgYmUgaW5zaWRlIGBsaXN0SXRlbWApLiBGb3IgZXhhbXBsZTpcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyA8bGk+PHA+Rm9vPC9wPjwvbGk+XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gd2lsbCBiZSBjb252ZXJ0ZWQgdG86XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gPGxpc3RJdGVtPjwvbGlzdEl0ZW0+PHBhcmFncmFwaD5Gb288L3BhcmFncmFwaD48bGlzdEl0ZW0+PC9saXN0SXRlbT5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBjb25zdCBjb252ZXJ0ZWRDaGlsZCA9IHJlc3VsdC5tb2RlbFJhbmdlLnN0YXJ0Lm5vZGVBZnRlcjtcbiAgICAgICAgICAgIGNvbnN0IHdhc1NwbGl0ID0gY29udmVydGVkQ2hpbGQgJiYgY29udmVydGVkQ2hpbGQuaXMoJ2VsZW1lbnQnKSAmJiAhc2NoZW1hLmNoZWNrQ2hpbGQobGlzdEl0ZW1Nb2RlbCwgY29udmVydGVkQ2hpbGQubmFtZSk7XG4gICAgICAgICAgICBpZiAod2FzU3BsaXQpIHtcbiAgICAgICAgICAgICAgICAvLyBBcyBgbGFzdExpc3RJdGVtYCBnb3Qgc3BsaXQsIHdlIG5lZWQgdG8gdXBkYXRlIGl0IHRvIHRoZSBzZWNvbmQgcGFydCBvZiB0aGUgc3BsaXQgYGxpc3RJdGVtYCBlbGVtZW50LlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gYG1vZGVsQ3Vyc29yYCBzaG91bGQgYmUgc2V0IHRvIGEgcG9zaXRpb24gd2hlcmUgdGhlIGNvbnZlcnNpb24gc2hvdWxkIGNvbnRpbnVlLiBUaGVyZSBhcmUgbXVsdGlwbGUgcG9zc2libGUgc2NlbmFyaW9zXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBtYXkgaGFwcGVuLiBVc3VhbGx5LCBgbW9kZWxDdXJzb3JgIChtYXJrZWQgYXMgYCNgIGJlbG93KSB3b3VsZCBwb2ludCB0byB0aGUgc2Vjb25kIGxpc3QgaXRlbSBhZnRlciBjb252ZXJzaW9uOlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy9cdFx0YDxsaT48cD5Gb288L3A+PC9saT5gIC0+IGA8bGlzdEl0ZW0+PC9saXN0SXRlbT48cGFyYWdyYXBoPkZvbzwvcGFyYWdyYXBoPjxsaXN0SXRlbT4jPC9saXN0SXRlbT5gXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBIb3dldmVyLCBpbiBzb21lIGNhc2VzLCBsaWtlIGF1dG8tcGFyYWdyYXBoaW5nLCB0aGUgcG9zaXRpb24gaXMgcGxhY2VkIGF0IHRoZSBlbmQgb2YgdGhlIGJsb2NrIGVsZW1lbnQ6XG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvL1x0XHRgPGxpPjxkaXY+Rm9vPC9kaXY+PC9saT5gIC0+IGA8bGlzdEl0ZW0+PC9saXN0SXRlbT48cGFyYWdyYXBoPkZvbyM8L3BhcmFncmFwaD48bGlzdEl0ZW0+PC9saXN0SXRlbT5gXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBvciBhZnRlciBhbiBlbGVtZW50IGlmIGFub3RoZXIgZWxlbWVudCBicm9rZW4gYXV0by1wYXJhZ3JhcGhlZCBlbGVtZW50OlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy9cdFx0YDxsaT48ZGl2PjxoMj5Gb288L2gyPjwvZGl2PjwvbGk+YCAtPiBgPGxpc3RJdGVtPjwvbGlzdEl0ZW0+PGhlYWRpbmcxPkZvbzwvaGVhZGluZzE+IzxsaXN0SXRlbT48L2xpc3RJdGVtPmBcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY2hlY2sgZm9yIHN1Y2ggY2FzZXMgYW5kIHVzZSBwcm9wZXIgbGlzdCBpdGVtIGFuZCBwb3NpdGlvbiBiYXNlZCBvbiBpdC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubW9kZWxDdXJzb3IucGFyZW50LmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gKDEpLlxuICAgICAgICAgICAgICAgICAgICBsaXN0SXRlbU1vZGVsID0gcmVzdWx0Lm1vZGVsQ3Vyc29yLnBhcmVudDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyAoMiksICgzKS5cbiAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW1Nb2RlbCA9IGZpbmROZXh0TGlzdEl0ZW0ocmVzdWx0Lm1vZGVsQ3Vyc29yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmV4dFBvc2l0aW9uID0gd3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIobGlzdEl0ZW1Nb2RlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5leHRQb3NpdGlvbjtcbn1cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRoYXQgc2Vla3MgZm9yIGEgbmV4dCBsaXN0IGl0ZW0gc3RhcnRpbmcgZnJvbSBnaXZlbiBgc3RhcnRQb3NpdGlvbmAuXG4gKi8gZnVuY3Rpb24gZmluZE5leHRMaXN0SXRlbShzdGFydFBvc2l0aW9uKSB7XG4gICAgY29uc3QgdHJlZVdhbGtlciA9IG5ldyBUcmVlV2Fsa2VyKHtcbiAgICAgICAgc3RhcnRQb3NpdGlvblxuICAgIH0pO1xuICAgIGxldCB2YWx1ZTtcbiAgICBkbyB7XG4gICAgICAgIHZhbHVlID0gdHJlZVdhbGtlci5uZXh0KCk7XG4gICAgfXdoaWxlICghdmFsdWUudmFsdWUuaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKVxuICAgIHJldHVybiB2YWx1ZS52YWx1ZS5pdGVtO1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdGhhdCB0YWtlcyBhbGwgY2hpbGRyZW4gb2YgZ2l2ZW4gYHZpZXdSZW1vdmVkSXRlbWAgYW5kIG1vdmVzIHRoZW0gaW4gYSBjb3JyZWN0IHBsYWNlLCBhY2NvcmRpbmdcbiAqIHRvIG90aGVyIGdpdmVuIHBhcmFtZXRlcnMuXG4gKi8gZnVuY3Rpb24gaG9pc3ROZXN0ZWRMaXN0cyhuZXh0SW5kZW50LCBtb2RlbFJlbW92ZVN0YXJ0UG9zaXRpb24sIHZpZXdSZW1vdmVTdGFydFBvc2l0aW9uLCB2aWV3UmVtb3ZlZEl0ZW0sIGNvbnZlcnNpb25BcGksIG1vZGVsKSB7XG4gICAgLy8gRmluZCBjb3JyZWN0IHByZXZpb3VzIG1vZGVsIGxpc3QgaXRlbSBlbGVtZW50LlxuICAgIC8vIFRoZSBlbGVtZW50IGhhcyB0byBoYXZlIGVpdGhlciBzYW1lIG9yIHNtYWxsZXIgaW5kZW50IHRoYW4gZ2l2ZW4gcmVmZXJlbmNlIGluZGVudC5cbiAgICAvLyBUaGlzIHdpbGwgYmUgdGhlIG1vZGVsIGVsZW1lbnQgd2hpY2ggd2lsbCBnZXQgbmVzdGVkIGl0ZW1zIChpZiBpdCBoYXMgc21hbGxlciBpbmRlbnQpIG9yIHNpYmxpbmcgaXRlbXMgKGlmIGl0IGhhcyBzYW1lIGluZGVudCkuXG4gICAgLy8gS2VlcCBpbiBtaW5kIHRoYXQgc3VjaCBlbGVtZW50IG1pZ2h0IG5vdCBiZSBmb3VuZCwgaWYgcmVtb3ZlZCBpdGVtIHdhcyB0aGUgZmlyc3QgaXRlbS5cbiAgICBjb25zdCBwcmV2TW9kZWxJdGVtID0gZ2V0U2libGluZ0xpc3RJdGVtKG1vZGVsUmVtb3ZlU3RhcnRQb3NpdGlvbi5ub2RlQmVmb3JlLCB7XG4gICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgIHNtYWxsZXJJbmRlbnQ6IHRydWUsXG4gICAgICAgIGxpc3RJbmRlbnQ6IG5leHRJbmRlbnRcbiAgICB9KTtcbiAgICBjb25zdCBtYXBwZXIgPSBjb252ZXJzaW9uQXBpLm1hcHBlcjtcbiAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgLy8gSW5kZW50IG9mIGZvdW5kIGVsZW1lbnQgb3IgYG51bGxgIGlmIHRoZSBlbGVtZW50IGhhcyBub3QgYmVlbiBmb3VuZC5cbiAgICBjb25zdCBwcmV2SW5kZW50ID0gcHJldk1vZGVsSXRlbSA/IHByZXZNb2RlbEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgOiBudWxsO1xuICAgIGxldCBpbnNlcnRQb3NpdGlvbjtcbiAgICBpZiAoIXByZXZNb2RlbEl0ZW0pIHtcbiAgICAgICAgLy8gSWYgZWxlbWVudCBoYXMgbm90IGJlZW4gZm91bmQsIHNpbXBseSBpbnNlcnQgbGlzdHMgYXQgdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSByZW1vdmVkIGl0ZW0gd2FzOlxuICAgICAgICAvL1xuICAgICAgICAvLyBMb3JlbSBpcHN1bS5cbiAgICAgICAgLy8gMSAtLS0tLS0tLSAgICAgICAgICAgPC0tLSB0aGlzIGlzIHJlbW92ZWQsIG5vIHByZXZpb3VzIGxpc3QgaXRlbSwgcHV0IG5lc3RlZCBpdGVtcyBpbiBwbGFjZSBvZiByZW1vdmVkIGl0ZW0uXG4gICAgICAgIC8vICAgMS4xIC0tLS0tLS0tICAgICAgIDwtLS0gdGhpcyBpcyByZWZlcmVuY2UgaW5kZW50LlxuICAgICAgICAvLyAgICAgMS4xLjEgLS0tLS0tLS1cbiAgICAgICAgLy8gICAgIDEuMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEJlY29tZXM6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIExvcmVtIGlwc3VtLlxuICAgICAgICAvLyAxLjEgLS0tLS0tLS1cbiAgICAgICAgLy8gICAxLjEuMSAtLS0tLS0tLVxuICAgICAgICAvLyAgIDEuMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vIDEuMiAtLS0tLS0tLVxuICAgICAgICBpbnNlcnRQb3NpdGlvbiA9IHZpZXdSZW1vdmVTdGFydFBvc2l0aW9uO1xuICAgIH0gZWxzZSBpZiAocHJldkluZGVudCA9PSBuZXh0SW5kZW50KSB7XG4gICAgICAgIC8vIElmIGVsZW1lbnQgaGFzIGJlZW4gZm91bmQgYW5kIGhhcyBzYW1lIGluZGVudCBhcyByZWZlcmVuY2UgaW5kZW50IGl0IG1lYW5zIHRoYXQgbmVzdGVkIGl0ZW1zIHNob3VsZFxuICAgICAgICAvLyBiZWNvbWUgc2libGluZ3Mgb2YgZm91bmQgZWxlbWVudDpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gMSAtLS0tLS0tLVxuICAgICAgICAvLyAgIDEuMSAtLS0tLS0tLVxuICAgICAgICAvLyAgIDEuMiAtLS0tLS0tLSAgICAgICA8LS0tIHRoaXMgaXMgYHByZXZNb2RlbEl0ZW1gLlxuICAgICAgICAvLyAyIC0tLS0tLS0tICAgICAgICAgICA8LS0tIHRoaXMgaXMgcmVtb3ZlZCwgcHJldmlvdXMgbGlzdCBpdGVtIGhhcyBpbmRlbnQgc2FtZSBhcyByZWZlcmVuY2UgaW5kZW50LlxuICAgICAgICAvLyAgIDIuMSAtLS0tLS0tLSAgICAgICA8LS0tIHRoaXMgaXMgcmVmZXJlbmNlIGluZGVudCwgdGhpcyBhbmQgMi4yIHNob3VsZCBiZWNvbWUgc2libGluZ3Mgb2YgMS4yLlxuICAgICAgICAvLyAgIDIuMiAtLS0tLS0tLVxuICAgICAgICAvL1xuICAgICAgICAvLyBCZWNvbWVzOlxuICAgICAgICAvL1xuICAgICAgICAvLyAxIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4yIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMi4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMi4yIC0tLS0tLS0tXG4gICAgICAgIGNvbnN0IHByZXZWaWV3TGlzdCA9IG1hcHBlci50b1ZpZXdFbGVtZW50KHByZXZNb2RlbEl0ZW0pLnBhcmVudDtcbiAgICAgICAgaW5zZXJ0UG9zaXRpb24gPSB2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIocHJldlZpZXdMaXN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBlbGVtZW50IGhhcyBiZWVuIGZvdW5kIGFuZCBoYXMgc21hbGxlciBpbmRlbnQgYXMgcmVmZXJlbmNlIGluZGVudCBpdCBtZWFucyB0aGF0IG5lc3RlZCBpdGVtc1xuICAgICAgICAvLyBzaG91bGQgYmVjb21lIG5lc3RlZCBpdGVtcyBvZiBmb3VuZCBpdGVtOlxuICAgICAgICAvL1xuICAgICAgICAvLyAxIC0tLS0tLS0tICAgICAgICAgICA8LS0tIHRoaXMgaXMgYHByZXZNb2RlbEl0ZW1gLlxuICAgICAgICAvLyAgIDEuMSAtLS0tLS0tLSAgICAgICA8LS0tIHRoaXMgaXMgcmVtb3ZlZCwgcHJldmlvdXMgbGlzdCBpdGVtIGhhcyBpbmRlbnQgc21hbGxlciB0aGFuIHJlZmVyZW5jZSBpbmRlbnQuXG4gICAgICAgIC8vICAgICAxLjEuMSAtLS0tLS0tLSAgIDwtLS0gdGhpcyBpcyByZWZlcmVuY2UgaW5kZW50LCB0aGlzIGFuZCAxLjEuMSBzaG91bGQgYmVjb21lIG5lc3RlZCBpdGVtcyBvZiAxLlxuICAgICAgICAvLyAgICAgMS4xLjIgLS0tLS0tLS1cbiAgICAgICAgLy8gICAxLjIgLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gQmVjb21lczpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gMSAtLS0tLS0tLVxuICAgICAgICAvLyAgIDEuMS4xIC0tLS0tLS0tXG4gICAgICAgIC8vICAgMS4xLjIgLS0tLS0tLS1cbiAgICAgICAgLy8gICAxLjIgLS0tLS0tLS1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTm90ZTogaW4gdGhpcyBjYXNlIDEuMS4xIGhhdmUgaW5kZW50IDIgd2hpbGUgMSBoYXZlIGluZGVudCAwLiBJbiBtb2RlbCB0aGF0IHNob3VsZCBub3QgYmUgcG9zc2libGUsXG4gICAgICAgIC8vIGJlY2F1c2UgZm9sbG93aW5nIGl0ZW0gbWF5IGhhdmUgaW5kZW50IGJpZ2dlciBvbmx5IGJ5IG9uZS4gQnV0IHRoaXMgaXMgZml4ZWQgYnkgcG9zdGZpeGVyLlxuICAgICAgICBjb25zdCBtb2RlbFBvc2l0aW9uID0gbW9kZWwuY3JlYXRlUG9zaXRpb25BdChwcmV2TW9kZWxJdGVtLCAnZW5kJyk7XG4gICAgICAgIGluc2VydFBvc2l0aW9uID0gbWFwcGVyLnRvVmlld1Bvc2l0aW9uKG1vZGVsUG9zaXRpb24pO1xuICAgIH1cbiAgICBpbnNlcnRQb3NpdGlvbiA9IHBvc2l0aW9uQWZ0ZXJVaUVsZW1lbnRzKGluc2VydFBvc2l0aW9uKTtcbiAgICAvLyBIYW5kbGUgbXVsdGlwbGUgbGlzdHMuIFRoaXMgaGFwcGVucyBpZiBsaXN0IGl0ZW0gaGFzIG5lc3RlZCBudW1iZXJlZCBhbmQgYnVsbGV0ZWQgbGlzdHMuIEZvbGxvd2luZyBsaXN0c1xuICAgIC8vIGFyZSBpbnNlcnRlZCBhZnRlciB0aGUgZmlyc3QgbGlzdCAobm8gbmVlZCB0byByZWNhbGN1bGF0ZSBpbnNlcnRpb24gcG9zaXRpb24gZm9yIHRoZW0pLlxuICAgIGZvciAoY29uc3QgY2hpbGQgb2YgW1xuICAgICAgICAuLi52aWV3UmVtb3ZlZEl0ZW0uZ2V0Q2hpbGRyZW4oKVxuICAgIF0pe1xuICAgICAgICBpZiAoaXNMaXN0KGNoaWxkKSkge1xuICAgICAgICAgICAgaW5zZXJ0UG9zaXRpb24gPSB2aWV3V3JpdGVyLm1vdmUodmlld1dyaXRlci5jcmVhdGVSYW5nZU9uKGNoaWxkKSwgaW5zZXJ0UG9zaXRpb24pLmVuZDtcbiAgICAgICAgICAgIG1lcmdlVmlld0xpc3RzKHZpZXdXcml0ZXIsIGNoaWxkLCBjaGlsZC5uZXh0U2libGluZyk7XG4gICAgICAgICAgICBtZXJnZVZpZXdMaXN0cyh2aWV3V3JpdGVyLCBjaGlsZC5wcmV2aW91c1NpYmxpbmcsIGNoaWxkKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQ2hlY2tzIGlmIHZpZXcgZWxlbWVudCBpcyBhIGxpc3QgdHlwZSAodWwgb3Igb2wpLlxuICovIGZ1bmN0aW9uIGlzTGlzdCh2aWV3RWxlbWVudCkge1xuICAgIHJldHVybiB2aWV3RWxlbWVudC5pcygnZWxlbWVudCcsICdvbCcpIHx8IHZpZXdFbGVtZW50LmlzKCdlbGVtZW50JywgJ3VsJyk7XG59XG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIGluZGVudCB2YWx1ZSBmb3IgYSBsaXN0IGl0ZW0uIEhhbmRsZXMgSFRNTCBjb21wbGlhbnQgYW5kIG5vbi1jb21wbGlhbnQgbGlzdHMuXG4gKlxuICogQWxzbywgZml4ZXMgbm9uIEhUTUwgY29tcGxpYW50IGxpc3RzIGluZGVudHM6XG4gKlxuICogYGBgXG4gKiBiZWZvcmU6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkIGxpc3Q6XG4gKiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9MXG4gKiB8LT4gTEkgKHBhcmVudCBMSXM6IDApICAgICAgICAgICAgICAgICAgICAgIHwtPiBMSSAgICAgKGluZGVudDogMClcbiAqICAgICB8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfC0+IE9MXG4gKiAgICAgICAgIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgICAgIHwgICB8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgICAgIHwgICAgICAgfC0+IE9MICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgICAgIHwgICAgICAgICAgIHwtPiBMSSAocGFyZW50IExJczogMSkgICAgICB8LT4gTEkgKGluZGVudDogMSlcbiAqICAgICAgICAgfC0+IExJIChwYXJlbnQgTElzOiAxKSAgICAgICAgICAgICAgICAgIHwtPiBMSSAoaW5kZW50OiAxKVxuICpcbiAqIGJlZm9yZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWQgbGlzdDpcbiAqIE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0xcbiAqIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICAgIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICAgICAgICB8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICAgICAgICAgICB8LT4gTEkgKHBhcmVudCBMSXM6IDApICAgICAgICAgfC0+IExJICAgICAgICAoaW5kZW50OiAwKVxuICpcbiAqIGJlZm9yZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWQgbGlzdDpcbiAqIE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT0xcbiAqIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICAgICAgICAgICAgICAgfC0+IExJICAgICAgICAgKGluZGVudDogMClcbiAqIHwtPiBPTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwtPiBPTFxuICogICAgIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICAgICAgICAgICAgICAgICAgIHwtPiBMSSAoaW5kZW50OiAxKVxuICogYGBgXG4gKi8gZnVuY3Rpb24gZ2V0SW5kZW50KGxpc3RJdGVtKSB7XG4gICAgbGV0IGluZGVudCA9IDA7XG4gICAgbGV0IHBhcmVudCA9IGxpc3RJdGVtLnBhcmVudDtcbiAgICB3aGlsZShwYXJlbnQpe1xuICAgICAgICAvLyBFYWNoIExJIGluIHRoZSB0cmVlIHdpbGwgcmVzdWx0IGluIGFuIGluY3JlYXNlZCBpbmRlbnQgZm9yIEhUTUwgY29tcGxpYW50IGxpc3RzLlxuICAgICAgICBpZiAocGFyZW50LmlzKCdlbGVtZW50JywgJ2xpJykpIHtcbiAgICAgICAgICAgIGluZGVudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgaG93ZXZlciB0aGUgbGlzdCBpcyBuZXN0ZWQgaW4gb3RoZXIgbGlzdCB3ZSBzaG91bGQgY2hlY2sgcHJldmlvdXMgc2libGluZyBvZiBhbnkgb2YgdGhlIGxpc3QgZWxlbWVudHMuLi5cbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IHBhcmVudC5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICAvLyAuLi5iZWNhdXNlIHRoZSB3ZSBtaWdodCBuZWVkIGluY3JlYXNlIGl0cyBpbmRlbnQ6XG4gICAgICAgICAgICAvL1x0XHRiZWZvcmU6ICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWQgbGlzdDpcbiAgICAgICAgICAgIC8vXHRcdE9MICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPTFxuICAgICAgICAgICAgLy9cdFx0fC0+IExJIChwYXJlbnQgTElzOiAwKSAgICAgICAgICAgIHwtPiBMSSAgICAgICAgIChpbmRlbnQ6IDApXG4gICAgICAgICAgICAvL1x0XHR8LT4gT0wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwtPiBPTFxuICAgICAgICAgICAgLy9cdFx0ICAgIHwtPiBMSSAocGFyZW50IExJczogMCkgICAgICAgICAgICAgICAgfC0+IExJIChpbmRlbnQ6IDEpXG4gICAgICAgICAgICBpZiAocHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5pcygnZWxlbWVudCcsICdsaScpKSB7XG4gICAgICAgICAgICAgICAgaW5kZW50Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIGluZGVudDtcbn1cblxuLyoqXG4gKiBUaGUgZW5naW5lIG9mIHRoZSBsaXN0IGZlYXR1cmUuIEl0IGhhbmRsZXMgY3JlYXRpbmcsIGVkaXRpbmcgYW5kIHJlbW92aW5nIGxpc3RzIGFuZCBsaXN0IGl0ZW1zLlxuICpcbiAqIEl0IHJlZ2lzdGVycyB0aGUgYCdudW1iZXJlZExpc3QnYCwgYCdidWxsZXRlZExpc3QnYCwgYCdpbmRlbnRMaXN0J2AgYW5kIGAnb3V0ZGVudExpc3QnYCBjb21tYW5kcy5cbiAqLyBjbGFzcyBMZWdhY3lMaXN0RWRpdGluZyBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTGVnYWN5TGlzdEVkaXRpbmcnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCByZXF1aXJlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIEVudGVyLFxuICAgICAgICAgICAgRGVsZXRlLFxuICAgICAgICAgICAgTGVnYWN5TGlzdFV0aWxzXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIC8vIFNjaGVtYS5cbiAgICAgICAgLy8gTm90ZTogaW4gY2FzZSBgJGJsb2NrYCB3aWxsIGV2ZXIgYmUgYWxsb3dlZCBpbiBgbGlzdEl0ZW1gLCBrZWVwIGluIG1pbmQgdGhhdCB0aGlzIGZlYXR1cmVcbiAgICAgICAgLy8gdXNlcyBgU2VsZWN0aW9uI2dldFNlbGVjdGVkQmxvY2tzKClgIHdpdGhvdXQgYW55IGFkZGl0aW9uYWwgcHJvY2Vzc2luZyB0byBvYnRhaW4gYWxsIHNlbGVjdGVkIGxpc3QgaXRlbXMuXG4gICAgICAgIC8vIElmIHRoZXJlIGFyZSBibG9ja3MgYWxsb3dlZCBpbnNpZGUgbGlzdCBpdGVtLCBhbGdvcml0aG1zIHVzaW5nIGBnZXRTZWxlY3RlZEJsb2NrcygpYCB3aWxsIGhhdmUgdG8gYmUgbW9kaWZpZWQuXG4gICAgICAgIGVkaXRvci5tb2RlbC5zY2hlbWEucmVnaXN0ZXIoJ2xpc3RJdGVtJywge1xuICAgICAgICAgICAgaW5oZXJpdEFsbEZyb206ICckYmxvY2snLFxuICAgICAgICAgICAgYWxsb3dBdHRyaWJ1dGVzOiBbXG4gICAgICAgICAgICAgICAgJ2xpc3RUeXBlJyxcbiAgICAgICAgICAgICAgICAnbGlzdEluZGVudCdcbiAgICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIENvbnZlcnRlcnMuXG4gICAgICAgIGNvbnN0IGRhdGEgPSBlZGl0b3IuZGF0YTtcbiAgICAgICAgY29uc3QgZWRpdGluZyA9IGVkaXRvci5lZGl0aW5nO1xuICAgICAgICBlZGl0b3IubW9kZWwuZG9jdW1lbnQucmVnaXN0ZXJQb3N0Rml4ZXIoKHdyaXRlcik9Pm1vZGVsQ2hhbmdlUG9zdEZpeGVyKGVkaXRvci5tb2RlbCwgd3JpdGVyKSk7XG4gICAgICAgIGVkaXRpbmcubWFwcGVyLnJlZ2lzdGVyVmlld1RvTW9kZWxMZW5ndGgoJ2xpJywgZ2V0Vmlld0xpc3RJdGVtTGVuZ3RoKTtcbiAgICAgICAgZGF0YS5tYXBwZXIucmVnaXN0ZXJWaWV3VG9Nb2RlbExlbmd0aCgnbGknLCBnZXRWaWV3TGlzdEl0ZW1MZW5ndGgpO1xuICAgICAgICBlZGl0aW5nLm1hcHBlci5vbignbW9kZWxUb1ZpZXdQb3NpdGlvbicsIG1vZGVsVG9WaWV3UG9zaXRpb24oZWRpdGluZy52aWV3KSk7XG4gICAgICAgIGVkaXRpbmcubWFwcGVyLm9uKCd2aWV3VG9Nb2RlbFBvc2l0aW9uJywgdmlld1RvTW9kZWxQb3NpdGlvbihlZGl0b3IubW9kZWwpKTtcbiAgICAgICAgZGF0YS5tYXBwZXIub24oJ21vZGVsVG9WaWV3UG9zaXRpb24nLCBtb2RlbFRvVmlld1Bvc2l0aW9uKGVkaXRpbmcudmlldykpO1xuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2VkaXRpbmdEb3duY2FzdCcpLmFkZCgoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ2luc2VydCcsIG1vZGVsVmlld1NwbGl0T25JbnNlcnQsIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ2luc2VydDpsaXN0SXRlbScsIG1vZGVsVmlld0luc2VydGlvbiQxKGVkaXRvci5tb2RlbCkpO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignYXR0cmlidXRlOmxpc3RUeXBlOmxpc3RJdGVtJywgbW9kZWxWaWV3Q2hhbmdlVHlwZSQxLCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdhdHRyaWJ1dGU6bGlzdFR5cGU6bGlzdEl0ZW0nLCBtb2RlbFZpZXdNZXJnZUFmdGVyQ2hhbmdlVHlwZSwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdhdHRyaWJ1dGU6bGlzdEluZGVudDpsaXN0SXRlbScsIG1vZGVsVmlld0NoYW5nZUluZGVudChlZGl0b3IubW9kZWwpKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ3JlbW92ZTpsaXN0SXRlbScsIG1vZGVsVmlld1JlbW92ZShlZGl0b3IubW9kZWwpKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ3JlbW92ZScsIG1vZGVsVmlld01lcmdlQWZ0ZXIsIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCdkYXRhRG93bmNhc3QnKS5hZGQoKGRpc3BhdGNoZXIpPT57XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdpbnNlcnQnLCBtb2RlbFZpZXdTcGxpdE9uSW5zZXJ0LCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdpbnNlcnQ6bGlzdEl0ZW0nLCBtb2RlbFZpZXdJbnNlcnRpb24kMShlZGl0b3IubW9kZWwpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcigndXBjYXN0JykuYWRkKChkaXNwYXRjaGVyKT0+e1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDp1bCcsIGNsZWFuTGlzdCwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDpvbCcsIGNsZWFuTGlzdCwge1xuICAgICAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGlzcGF0Y2hlci5vbignZWxlbWVudDpsaScsIGNsZWFuTGlzdEl0ZW0sIHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ2VsZW1lbnQ6bGknLCB2aWV3TW9kZWxDb252ZXJ0ZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gRml4IGluZGVudGF0aW9uIG9mIHBhc3RlZCBpdGVtcy5cbiAgICAgICAgZWRpdG9yLm1vZGVsLm9uKCdpbnNlcnRDb250ZW50JywgbW9kZWxJbmRlbnRQYXN0ZUZpeGVyLCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBSZWdpc3RlciBjb21tYW5kcyBmb3IgbnVtYmVyZWQgYW5kIGJ1bGxldGVkIGxpc3QuXG4gICAgICAgIGVkaXRvci5jb21tYW5kcy5hZGQoJ251bWJlcmVkTGlzdCcsIG5ldyBMZWdhY3lMaXN0Q29tbWFuZChlZGl0b3IsICdudW1iZXJlZCcpKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnYnVsbGV0ZWRMaXN0JywgbmV3IExlZ2FjeUxpc3RDb21tYW5kKGVkaXRvciwgJ2J1bGxldGVkJykpO1xuICAgICAgICAvLyBSZWdpc3RlciBjb21tYW5kcyBmb3IgaW5kZW50aW5nLlxuICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdpbmRlbnRMaXN0JywgbmV3IExlZ2FjeUluZGVudENvbW1hbmQoZWRpdG9yLCAnZm9yd2FyZCcpKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnb3V0ZGVudExpc3QnLCBuZXcgTGVnYWN5SW5kZW50Q29tbWFuZChlZGl0b3IsICdiYWNrd2FyZCcpKTtcbiAgICAgICAgY29uc3Qgdmlld0RvY3VtZW50ID0gZWRpdGluZy52aWV3LmRvY3VtZW50O1xuICAgICAgICAvLyBPdmVyd3JpdGUgZGVmYXVsdCBFbnRlciBrZXkgYmVoYXZpb3IuXG4gICAgICAgIC8vIElmIEVudGVyIGtleSBpcyBwcmVzc2VkIHdpdGggc2VsZWN0aW9uIGNvbGxhcHNlZCBpbiBlbXB0eSBsaXN0IGl0ZW0sIG91dGRlbnQgaXQgaW5zdGVhZCBvZiBicmVha2luZyBpdC5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh2aWV3RG9jdW1lbnQsICdlbnRlcicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBkb2MgPSB0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudDtcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uUGFyZW50ID0gZG9jLnNlbGVjdGlvbi5nZXRMYXN0UG9zaXRpb24oKS5wYXJlbnQ7XG4gICAgICAgICAgICBpZiAoZG9jLnNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBwb3NpdGlvblBhcmVudC5uYW1lID09ICdsaXN0SXRlbScgJiYgcG9zaXRpb25QYXJlbnQuaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWRpdG9yLmV4ZWN1dGUoJ291dGRlbnRMaXN0Jyk7XG4gICAgICAgICAgICAgICAgZGF0YS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGNvbnRleHQ6ICdsaSdcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIE92ZXJ3cml0ZSBkZWZhdWx0IEJhY2tzcGFjZSBrZXkgYmVoYXZpb3IuXG4gICAgICAgIC8vIElmIEJhY2tzcGFjZSBrZXkgaXMgcHJlc3NlZCB3aXRoIHNlbGVjdGlvbiBjb2xsYXBzZWQgb24gZmlyc3QgcG9zaXRpb24gaW4gZmlyc3QgbGlzdCBpdGVtLCBvdXRkZW50IGl0LiAjODNcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh2aWV3RG9jdW1lbnQsICdkZWxldGUnLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgLy8gQ2hlY2sgY29uZGl0aW9ucyBmcm9tIHRob3NlIHRoYXQgcmVxdWlyZSBsZXNzIGNvbXB1dGF0aW9ucyBsaWtlIHRob3NlIGltbWVkaWF0ZWx5IGF2YWlsYWJsZS5cbiAgICAgICAgICAgIGlmIChkYXRhLmRpcmVjdGlvbiAhPT0gJ2JhY2t3YXJkJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbjtcbiAgICAgICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZmlyc3RQb3NpdGlvbiA9IHNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCk7XG4gICAgICAgICAgICBpZiAoIWZpcnN0UG9zaXRpb24uaXNBdFN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcG9zaXRpb25QYXJlbnQgPSBmaXJzdFBvc2l0aW9uLnBhcmVudDtcbiAgICAgICAgICAgIGlmIChwb3NpdGlvblBhcmVudC5uYW1lICE9PSAnbGlzdEl0ZW0nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcHJldmlvdXNJc0FMaXN0SXRlbSA9IHBvc2l0aW9uUGFyZW50LnByZXZpb3VzU2libGluZyAmJiBwb3NpdGlvblBhcmVudC5wcmV2aW91c1NpYmxpbmcubmFtZSA9PT0gJ2xpc3RJdGVtJztcbiAgICAgICAgICAgIGlmIChwcmV2aW91c0lzQUxpc3RJdGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lZGl0b3IuZXhlY3V0ZSgnb3V0ZGVudExpc3QnKTtcbiAgICAgICAgICAgIGRhdGEucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2dC5zdG9wKCk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGNvbnRleHQ6ICdsaSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLmVkaXRpbmcudmlldy5kb2N1bWVudCwgJ3RhYicsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBjb21tYW5kTmFtZSA9IGRhdGEuc2hpZnRLZXkgPyAnb3V0ZGVudExpc3QnIDogJ2luZGVudExpc3QnO1xuICAgICAgICAgICAgY29uc3QgY29tbWFuZCA9IHRoaXMuZWRpdG9yLmNvbW1hbmRzLmdldChjb21tYW5kTmFtZSk7XG4gICAgICAgICAgICBpZiAoY29tbWFuZC5pc0VuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuZXhlY3V0ZShjb21tYW5kTmFtZSk7XG4gICAgICAgICAgICAgICAgZGF0YS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgY29udGV4dDogJ2xpJ1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBhZnRlckluaXQoKSB7XG4gICAgICAgIGNvbnN0IGNvbW1hbmRzID0gdGhpcy5lZGl0b3IuY29tbWFuZHM7XG4gICAgICAgIGNvbnN0IGluZGVudCA9IGNvbW1hbmRzLmdldCgnaW5kZW50Jyk7XG4gICAgICAgIGNvbnN0IG91dGRlbnQgPSBjb21tYW5kcy5nZXQoJ291dGRlbnQnKTtcbiAgICAgICAgaWYgKGluZGVudCkge1xuICAgICAgICAgICAgaW5kZW50LnJlZ2lzdGVyQ2hpbGRDb21tYW5kKGNvbW1hbmRzLmdldCgnaW5kZW50TGlzdCcpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3V0ZGVudCkge1xuICAgICAgICAgICAgb3V0ZGVudC5yZWdpc3RlckNoaWxkQ29tbWFuZChjb21tYW5kcy5nZXQoJ291dGRlbnRMaXN0JykpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0Vmlld0xpc3RJdGVtTGVuZ3RoKGVsZW1lbnQpIHtcbiAgICBsZXQgbGVuZ3RoID0gMTtcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGVsZW1lbnQuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgIGlmIChjaGlsZC5uYW1lID09ICd1bCcgfHwgY2hpbGQubmFtZSA9PSAnb2wnKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hpbGQuZ2V0Q2hpbGRyZW4oKSl7XG4gICAgICAgICAgICAgICAgbGVuZ3RoICs9IGdldFZpZXdMaXN0SXRlbUxlbmd0aChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbGVuZ3RoO1xufVxuXG4vKipcbiAqIFRoZSBsZWdhY3kgbGlzdCBmZWF0dXJlLlxuICpcbiAqIFRoaXMgaXMgYSBcImdsdWVcIiBwbHVnaW4gdGhhdCBsb2FkcyB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeWxpc3QvbGVnYWN5bGlzdGVkaXRpbmd+TGVnYWN5TGlzdEVkaXRpbmcgbGVnYWN5IGxpc3QgZWRpdGluZyBmZWF0dXJlfVxuICogYW5kIHtAbGluayBtb2R1bGU6bGlzdC9saXN0L2xpc3R1aX5MaXN0VUkgbGlzdCBVSSBmZWF0dXJlfS5cbiAqLyBjbGFzcyBMZWdhY3lMaXN0IGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMZWdhY3lMaXN0RWRpdGluZyxcbiAgICAgICAgICAgIExpc3RVSVxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdMZWdhY3lMaXN0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgbGlzdCBzdHlsZSBjb21tYW5kLiBJdCBjaGFuZ2VzIHRoZSBgbGlzdFN0eWxlYCBhdHRyaWJ1dGUgb2YgdGhlIHNlbGVjdGVkIGxpc3QgaXRlbXMuXG4gKlxuICogSWYgdGhlIGxpc3QgdHlwZSAobnVtYmVyZWQgb3IgYnVsbGV0ZWQpIGNhbiBiZSBpbmZlcnJlZCBmcm9tIHRoZSBwYXNzZWQgc3R5bGUgdHlwZSxcbiAqIHRoZSBjb21tYW5kIHRyaWVzIHRvIGNvbnZlcnQgc2VsZWN0ZWQgaXRlbXMgdG8gYSBsaXN0IG9mIHRoYXQgdHlwZS5cbiAqIEl0IGlzIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0cHJvcGVydGllc35MZWdhY3lMaXN0UHJvcGVydGllcyBsZWdhY3kgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmV9LlxuICovIGNsYXNzIExlZ2FjeUxpc3RTdHlsZUNvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogVGhlIGRlZmF1bHQgdHlwZSBvZiB0aGUgbGlzdCBzdHlsZS5cblx0ICovIGRlZmF1bHRUeXBlO1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gZWRpdG9yIFRoZSBlZGl0b3IgaW5zdGFuY2UuXG5cdCAqIEBwYXJhbSBkZWZhdWx0VHlwZSBUaGUgbGlzdCB0eXBlIHRoYXQgd2lsbCBiZSB1c2VkIGJ5IGRlZmF1bHQgaWYgdGhlIHZhbHVlIHdhcyBub3Qgc3BlY2lmaWVkIGR1cmluZ1xuXHQgKiB0aGUgY29tbWFuZCBleGVjdXRpb24uXG5cdCAqLyBjb25zdHJ1Y3RvcihlZGl0b3IsIGRlZmF1bHRUeXBlKXtcbiAgICAgICAgc3VwZXIoZWRpdG9yKTtcbiAgICAgICAgdGhpcy5kZWZhdWx0VHlwZSA9IGRlZmF1bHRUeXBlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl9nZXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHRoaXMuX2NoZWNrRW5hYmxlZCgpO1xuICAgIH1cbiAgICAvKipcblx0ICogRXhlY3V0ZXMgdGhlIGNvbW1hbmQuXG5cdCAqXG5cdCAqIEBmaXJlcyBleGVjdXRlXG5cdCAqIEBwYXJhbSBvcHRpb25zLnR5cGUgVGhlIHR5cGUgb2YgdGhlIGxpc3Qgc3R5bGUsIGUuZy4gYCdkaXNjJ2Agb3IgYCdzcXVhcmUnYC4gSWYgYG51bGxgIGlzIHNwZWNpZmllZCwgdGhlIGRlZmF1bHRcblx0ICogc3R5bGUgd2lsbCBiZSBhcHBsaWVkLlxuXHQgKi8gZXhlY3V0ZShvcHRpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5fdHJ5VG9Db252ZXJ0SXRlbXNUb0xpc3Qob3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gdGhpcy5lZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGxpc3RJdGVtcyA9IGdldFNlbGVjdGVkTGlzdEl0ZW1zKG1vZGVsKTtcbiAgICAgICAgaWYgKCFsaXN0SXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgbGlzdEl0ZW1zKXtcbiAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdsaXN0U3R5bGUnLCBvcHRpb25zLnR5cGUgfHwgdGhpcy5kZWZhdWx0VHlwZSwgaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQ2hlY2tzIHRoZSBjb21tYW5kJ3Mge0BsaW5rICN2YWx1ZX0uXG5cdCAqXG5cdCAqIEByZXR1cm5zIFRoZSBjdXJyZW50IHZhbHVlLlxuXHQgKi8gX2dldFZhbHVlKCkge1xuICAgICAgICBjb25zdCBsaXN0SXRlbSA9IHRoaXMuZWRpdG9yLm1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRGaXJzdFBvc2l0aW9uKCkucGFyZW50O1xuICAgICAgICBpZiAobGlzdEl0ZW0gJiYgbGlzdEl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFN0eWxlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3Mgd2hldGhlciB0aGUgY29tbWFuZCBjYW4gYmUgZW5hYmxlZCBpbiB0aGUgY3VycmVudCBjb250ZXh0LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBjb21tYW5kIHNob3VsZCBiZSBlbmFibGVkLlxuXHQgKi8gX2NoZWNrRW5hYmxlZCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG51bWJlcmVkTGlzdCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ251bWJlcmVkTGlzdCcpO1xuICAgICAgICBjb25zdCBidWxsZXRlZExpc3QgPSBlZGl0b3IuY29tbWFuZHMuZ2V0KCdidWxsZXRlZExpc3QnKTtcbiAgICAgICAgcmV0dXJuIG51bWJlcmVkTGlzdC5pc0VuYWJsZWQgfHwgYnVsbGV0ZWRMaXN0LmlzRW5hYmxlZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiB0aGUgcHJvdmlkZWQgbGlzdCBzdHlsZSBpcyB2YWxpZC4gQWxzbyBjaGFuZ2VzIHRoZSBzZWxlY3Rpb24gdG8gYSBsaXN0IGlmIGl0J3Mgbm90IHNldCB5ZXQuXG5cdCAqXG5cdCAqIEBwYXJhbSBUaGUgdHlwZSBvZiB0aGUgbGlzdCBzdHlsZS4gSWYgYG51bGxgIGlzIHNwZWNpZmllZCwgdGhlIGZ1bmN0aW9uIGRvZXMgbm90aGluZy5cblx0Ki8gX3RyeVRvQ29udmVydEl0ZW1zVG9MaXN0KG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCFvcHRpb25zLnR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaXN0VHlwZSA9IGdldExpc3RUeXBlRnJvbUxpc3RTdHlsZVR5cGUob3B0aW9ucy50eXBlKTtcbiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgLS0gQHByZXNlcnZlICovIGlmICghbGlzdFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgY29tbWFuZE5hbWUgPSBgJHtsaXN0VHlwZX1MaXN0YDtcbiAgICAgICAgY29uc3QgY29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoY29tbWFuZE5hbWUpO1xuICAgICAgICBpZiAoIWNvbW1hbmQudmFsdWUpIHtcbiAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKGNvbW1hbmROYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgcmV2ZXJzZWQgbGlzdCBjb21tYW5kLiBJdCBjaGFuZ2VzIHRoZSBgbGlzdFJldmVyc2VkYCBhdHRyaWJ1dGUgb2YgdGhlIHNlbGVjdGVkIGxpc3QgaXRlbXMuIEFzIGEgcmVzdWx0LCB0aGUgbGlzdCBvcmRlciB3aWxsIGJlXG4gKiByZXZlcnNlZC5cbiAqIEl0IGlzIHVzZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0cHJvcGVydGllc35MZWdhY3lMaXN0UHJvcGVydGllcyBsZWdhY3kgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmV9LlxuICovIGNsYXNzIExlZ2FjeUxpc3RSZXZlcnNlZENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHJlZnJlc2goKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fZ2V0VmFsdWUoKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9IHZhbHVlICE9IG51bGw7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBFeGVjdXRlcyB0aGUgY29tbWFuZC5cblx0ICpcblx0ICogQGZpcmVzIGV4ZWN1dGVcblx0ICogQHBhcmFtIG9wdGlvbnMucmV2ZXJzZWQgV2hldGhlciB0aGUgbGlzdCBzaG91bGQgYmUgcmV2ZXJzZWQuXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBsaXN0SXRlbXMgPSBnZXRTZWxlY3RlZExpc3RJdGVtcyhtb2RlbCkuZmlsdGVyKChpdGVtKT0+aXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ251bWJlcmVkJyk7XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGxpc3RJdGVtcyl7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdFJldmVyc2VkJywgISFvcHRpb25zLnJldmVyc2VkLCBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBDaGVja3MgdGhlIGNvbW1hbmQncyB7QGxpbmsgI3ZhbHVlfS5cblx0ICpcblx0ICogQHJldHVybnMgVGhlIGN1cnJlbnQgdmFsdWUuXG5cdCAqLyBfZ2V0VmFsdWUoKSB7XG4gICAgICAgIGNvbnN0IGxpc3RJdGVtID0gdGhpcy5lZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmdldEZpcnN0UG9zaXRpb24oKS5wYXJlbnQ7XG4gICAgICAgIGlmIChsaXN0SXRlbSAmJiBsaXN0SXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpICYmIGxpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PSAnbnVtYmVyZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gbGlzdEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0UmV2ZXJzZWQnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGxpc3Qgc3RhcnQgaW5kZXggY29tbWFuZC4gSXQgY2hhbmdlcyB0aGUgYGxpc3RTdGFydGAgYXR0cmlidXRlIG9mIHRoZSBzZWxlY3RlZCBsaXN0IGl0ZW1zLlxuICogSXQgaXMgdXNlZCBieSB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeWxpc3Rwcm9wZXJ0aWVzfkxlZ2FjeUxpc3RQcm9wZXJ0aWVzIGxlZ2FjeSBsaXN0IHByb3BlcnRpZXMgZmVhdHVyZX0uXG4gKi8gY2xhc3MgTGVnYWN5TGlzdFN0YXJ0Q29tbWFuZCBleHRlbmRzIENvbW1hbmQge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9nZXRWYWx1ZSgpO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdmFsdWUgIT0gbnVsbDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4ZWN1dGVzIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAZmlyZXMgZXhlY3V0ZVxuXHQgKiBAcGFyYW0gb3B0aW9ucy5zdGFydEluZGV4IFRoZSBsaXN0IHN0YXJ0IGluZGV4LlxuXHQgKi8gZXhlY3V0ZSh7IHN0YXJ0SW5kZXggPSAxIH0gPSB7fSkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBsaXN0SXRlbXMgPSBnZXRTZWxlY3RlZExpc3RJdGVtcyhtb2RlbCkuZmlsdGVyKChpdGVtKT0+aXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ251bWJlcmVkJyk7XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGxpc3RJdGVtcyl7XG4gICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZSgnbGlzdFN0YXJ0Jywgc3RhcnRJbmRleCA+PSAwID8gc3RhcnRJbmRleCA6IDEsIGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyB0aGUgY29tbWFuZCdzIHtAbGluayAjdmFsdWV9LlxuXHQgKlxuXHQgKiBAcmV0dXJucyBUaGUgY3VycmVudCB2YWx1ZS5cblx0ICovIF9nZXRWYWx1ZSgpIHtcbiAgICAgICAgY29uc3QgbGlzdEl0ZW0gPSB0aGlzLmVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpLnBhcmVudDtcbiAgICAgICAgaWYgKGxpc3RJdGVtICYmIGxpc3RJdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykgJiYgbGlzdEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICdudW1iZXJlZCcpIHtcbiAgICAgICAgICAgIHJldHVybiBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RTdGFydCcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuY29uc3QgREVGQVVMVF9MSVNUX1RZUEUgPSAnZGVmYXVsdCc7XG4vKipcbiAqIFRoZSBlbmdpbmUgb2YgdGhlIGxpc3QgcHJvcGVydGllcyBmZWF0dXJlLlxuICpcbiAqIEl0IHNldHMgdGhlIHZhbHVlIGZvciB0aGUgYGxpc3RJdGVtYCBhdHRyaWJ1dGUgb2YgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0fkxlZ2FjeUxpc3QgYDxsaXN0SXRlbT5gfSBlbGVtZW50IHRoYXRcbiAqIGFsbG93cyBtb2RpZnlpbmcgdGhlIGxpc3Qgc3R5bGUgdHlwZS5cbiAqXG4gKiBJdCByZWdpc3RlcnMgdGhlIGAnbGlzdFN0eWxlJ2AsIGAnbGlzdFJldmVyc2VkJ2AgYW5kIGAnbGlzdFN0YXJ0J2AgY29tbWFuZHMgaWYgdGhleSBhcmUgZW5hYmxlZCBpbiB0aGUgY29uZmlndXJhdGlvbi5cbiAqIFJlYWQgbW9yZSBpbiB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdGNvbmZpZ35MaXN0UHJvcGVydGllc0NvbmZpZ30uXG4gKi8gY2xhc3MgTGVnYWN5TGlzdFByb3BlcnRpZXNFZGl0aW5nIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMZWdhY3lMaXN0RWRpdGluZ1xuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdMZWdhY3lMaXN0UHJvcGVydGllc0VkaXRpbmcnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yKXtcbiAgICAgICAgc3VwZXIoZWRpdG9yKTtcbiAgICAgICAgZWRpdG9yLmNvbmZpZy5kZWZpbmUoJ2xpc3QnLCB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgc3R5bGVzOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXg6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHJldmVyc2VkOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgIGNvbnN0IGVuYWJsZWRQcm9wZXJ0aWVzID0gZWRpdG9yLmNvbmZpZy5nZXQoJ2xpc3QucHJvcGVydGllcycpO1xuICAgICAgICBjb25zdCBzdHJhdGVnaWVzID0gY3JlYXRlQXR0cmlidXRlU3RyYXRlZ2llcyhlbmFibGVkUHJvcGVydGllcyk7XG4gICAgICAgIC8vIEV4dGVuZCBzY2hlbWEuXG4gICAgICAgIG1vZGVsLnNjaGVtYS5leHRlbmQoJ2xpc3RJdGVtJywge1xuICAgICAgICAgICAgYWxsb3dBdHRyaWJ1dGVzOiBzdHJhdGVnaWVzLm1hcCgocyk9PnMuYXR0cmlidXRlTmFtZSlcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAoY29uc3Qgc3RyYXRlZ3kgb2Ygc3RyYXRlZ2llcyl7XG4gICAgICAgICAgICBzdHJhdGVneS5hZGRDb21tYW5kKGVkaXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRml4IGxpc3QgYXR0cmlidXRlcyB3aGVuIG1vZGlmeWluZyB0aGVpciBuZXN0aW5nIGxldmVscyAodGhlIGBsaXN0SW5kZW50YCBhdHRyaWJ1dGUpLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRvci5jb21tYW5kcy5nZXQoJ2luZGVudExpc3QnKSwgJ19leGVjdXRlQ2xlYW51cCcsIGZpeExpc3RBZnRlckluZGVudExpc3RDb21tYW5kKGVkaXRvciwgc3RyYXRlZ2llcykpO1xuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRvci5jb21tYW5kcy5nZXQoJ291dGRlbnRMaXN0JyksICdfZXhlY3V0ZUNsZWFudXAnLCBmaXhMaXN0QWZ0ZXJPdXRkZW50TGlzdENvbW1hbmQoZWRpdG9yLCBzdHJhdGVnaWVzKSk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8oZWRpdG9yLmNvbW1hbmRzLmdldCgnYnVsbGV0ZWRMaXN0JyksICdfZXhlY3V0ZUNsZWFudXAnLCByZXN0b3JlRGVmYXVsdExpc3RTdHlsZShlZGl0b3IpKTtcbiAgICAgICAgdGhpcy5saXN0ZW5UbyhlZGl0b3IuY29tbWFuZHMuZ2V0KCdudW1iZXJlZExpc3QnKSwgJ19leGVjdXRlQ2xlYW51cCcsIHJlc3RvcmVEZWZhdWx0TGlzdFN0eWxlKGVkaXRvcikpO1xuICAgICAgICAvLyBSZWdpc3RlciBhIHBvc3QtZml4ZXIgdGhhdCBlbnN1cmVzIHRoYXQgdGhlIGF0dHJpYnV0ZXMgaXMgc3BlY2lmaWVkIGluIGVhY2ggYGxpc3RJdGVtYCBlbGVtZW50LlxuICAgICAgICBtb2RlbC5kb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlcihmaXhMaXN0QXR0cmlidXRlc09uTGlzdEl0ZW1FbGVtZW50cyhlZGl0b3IsIHN0cmF0ZWdpZXMpKTtcbiAgICAgICAgLy8gU2V0IHVwIGNvbnZlcnNpb24uXG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcigndXBjYXN0JykuYWRkKHVwY2FzdExpc3RJdGVtQXR0cmlidXRlcyhzdHJhdGVnaWVzKSk7XG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcignZG93bmNhc3QnKS5hZGQoZG93bmNhc3RMaXN0SXRlbUF0dHJpYnV0ZXMoc3RyYXRlZ2llcykpO1xuICAgICAgICAvLyBIYW5kbGUgbWVyZ2luZyB0d28gc2VwYXJhdGVkIGxpc3RzIGludG8gdGhlIHNpbmdsZSBvbmUuXG4gICAgICAgIHRoaXMuX21lcmdlTGlzdEF0dHJpYnV0ZXNXaGlsZU1lcmdpbmdMaXN0cyhzdHJhdGVnaWVzKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBhZnRlckluaXQoKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICAvLyBFbmFibGUgcG9zdC1maXhlciB0aGF0IHJlbW92ZXMgdGhlIGF0dHJpYnV0ZXMgZnJvbSB0by1kbyBsaXN0IGl0ZW1zIG9ubHkgaWYgdGhlIFwiVG9kb0xpc3RcIiBwbHVnaW4gaXMgb24uXG4gICAgICAgIC8vIFdlIG5lZWQgdG8gcmVnaXN0cnkgdGhlIGhvb2sgaGVyZSBzaW5jZSB0aGUgYFRvZG9MaXN0YCBwbHVnaW4gY2FuIGJlIGFkZGVkIGFmdGVyIHRoZSBgTGlzdFByb3BlcnRpZXNFZGl0aW5nYC5cbiAgICAgICAgaWYgKGVkaXRvci5jb21tYW5kcy5nZXQoJ3RvZG9MaXN0JykpIHtcbiAgICAgICAgICAgIGVkaXRvci5tb2RlbC5kb2N1bWVudC5yZWdpc3RlclBvc3RGaXhlcihyZW1vdmVMaXN0SXRlbUF0dHJpYnV0ZXNGcm9tVG9kb0xpc3QoZWRpdG9yKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFN0YXJ0cyBsaXN0ZW5pbmcgdG8ge0BsaW5rIG1vZHVsZTplbmdpbmUvbW9kZWwvbW9kZWx+TW9kZWwjZGVsZXRlQ29udGVudH0gYW5kIGNoZWNrcyB3aGV0aGVyIHR3byBsaXN0cyB3aWxsIGJlIG1lcmdlZCBpbnRvIGEgc2luZ2xlXG5cdCAqIG9uZSBhZnRlciBkZWxldGluZyB0aGUgY29udGVudC5cblx0ICpcblx0ICogVGhlIHB1cnBvc2Ugb2YgdGhpcyBhY3Rpb24gaXMgdG8gYWRqdXN0IHRoZSBgbGlzdFN0eWxlYCwgYGxpc3RSZXZlcnNlZGAgYW5kIGBsaXN0U3RhcnRgIHZhbHVlc1xuXHQgKiBmb3IgdGhlIGxpc3QgdGhhdCB3YXMgbWVyZ2VkLlxuXHQgKlxuXHQgKiBDb25zaWRlciB0aGUgZm9sbG93aW5nIG1vZGVsJ3MgY29udGVudDpcblx0ICpcblx0ICogYGBgeG1sXG5cdCAqIDxsaXN0SXRlbSBsaXN0SW5kZW50PVwiMFwiIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0U3R5bGU9XCJzcXVhcmVcIj5VTCBMaXN0IGl0ZW0gMTwvbGlzdEl0ZW0+XG5cdCAqIDxsaXN0SXRlbSBsaXN0SW5kZW50PVwiMFwiIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0U3R5bGU9XCJzcXVhcmVcIj5VTCBMaXN0IGl0ZW0gMjwvbGlzdEl0ZW0+XG5cdCAqIDxwYXJhZ3JhcGg+W0EgcGFyYWdyYXBoLl08L3BhcmFncmFwaD5cblx0ICogPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIwXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cImNpcmNsZVwiPlVMIExpc3QgaXRlbSAxPC9saXN0SXRlbT5cblx0ICogPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIwXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cImNpcmNsZVwiPlVMIExpc3QgaXRlbSAyPC9saXN0SXRlbT5cblx0ICogYGBgXG5cdCAqXG5cdCAqIEFmdGVyIHJlbW92aW5nIHRoZSBwYXJhZ3JhcGggZWxlbWVudCwgdGhlIHNlY29uZCBsaXN0IHdpbGwgYmUgbWVyZ2VkIGludG8gdGhlIGZpcnN0IG9uZS5cblx0ICogV2Ugd2FudCB0byBpbmhlcml0IHRoZSBgbGlzdFN0eWxlYCBhdHRyaWJ1dGUgZm9yIHRoZSBzZWNvbmQgbGlzdCBmcm9tIHRoZSBmaXJzdCBvbmUuXG5cdCAqXG5cdCAqIGBgYHhtbFxuXHQgKiA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwic3F1YXJlXCI+VUwgTGlzdCBpdGVtIDE8L2xpc3RJdGVtPlxuXHQgKiA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwic3F1YXJlXCI+VUwgTGlzdCBpdGVtIDI8L2xpc3RJdGVtPlxuXHQgKiA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwic3F1YXJlXCI+VUwgTGlzdCBpdGVtIDE8L2xpc3RJdGVtPlxuXHQgKiA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwic3F1YXJlXCI+VUwgTGlzdCBpdGVtIDI8L2xpc3RJdGVtPlxuXHQgKiBgYGBcblx0ICpcblx0ICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzc4NzkuXG5cdCAqXG5cdCAqIEBwYXJhbSBhdHRyaWJ1dGVTdHJhdGVnaWVzIFN0cmF0ZWdpZXMgZm9yIHRoZSBlbmFibGVkIGF0dHJpYnV0ZXMuXG5cdCAqLyBfbWVyZ2VMaXN0QXR0cmlidXRlc1doaWxlTWVyZ2luZ0xpc3RzKGF0dHJpYnV0ZVN0cmF0ZWdpZXMpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICAvLyBGaXJzdCB0aGUgb3V0ZXItbW9zdGBsaXN0SXRlbWAgaW4gdGhlIGZpcnN0IGxpc3QgcmVmZXJlbmNlLlxuICAgICAgICAvLyBJZiBmb3VuZCwgdGhlIGxpc3RzIHNob3VsZCBiZSBtZXJnZWQgYW5kIHRoaXMgYGxpc3RJdGVtYCBwcm92aWRlcyB0aGUgYXR0cmlidXRlc1xuICAgICAgICAvLyBhbmQgaXQgaXMgYWxzbyBhIHN0YXJ0aW5nIHBvaW50IHdoZW4gc2VhcmNoaW5nIGZvciBpdGVtcyBpbiB0aGUgc2Vjb25kIGxpc3QuXG4gICAgICAgIGxldCBmaXJzdE1vc3RPdXRlckl0ZW07XG4gICAgICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlIHJlbW92ZWQgY29udGVudCBpcyBiZXR3ZWVuIHR3byBsaXN0cy5cbiAgICAgICAgdGhpcy5saXN0ZW5Ubyhtb2RlbCwgJ2RlbGV0ZUNvbnRlbnQnLCAoZXZ0LCBbc2VsZWN0aW9uXSk9PntcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0UG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICAgICAgY29uc3QgbGFzdFBvc2l0aW9uID0gc2VsZWN0aW9uLmdldExhc3RQb3NpdGlvbigpO1xuICAgICAgICAgICAgLy8gVHlwaW5nIG9yIHJlbW92aW5nIGNvbnRlbnQgaW4gYSBzaW5nbGUgaXRlbS4gQWJvcnRpbmcuXG4gICAgICAgICAgICBpZiAoZmlyc3RQb3NpdGlvbi5wYXJlbnQgPT09IGxhc3RQb3NpdGlvbi5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBBbiBlbGVtZW50IGJlZm9yZSB0aGUgY29udGVudCB0aGF0IHdpbGwgYmUgcmVtb3ZlZCBpcyBub3QgYSBsaXN0LlxuICAgICAgICAgICAgaWYgKCFmaXJzdFBvc2l0aW9uLnBhcmVudC5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV4dFNpYmxpbmcgPSBsYXN0UG9zaXRpb24ucGFyZW50Lm5leHRTaWJsaW5nO1xuICAgICAgICAgICAgLy8gQW4gZWxlbWVudCBhZnRlciB0aGUgY29udGVudCB0aGF0IHdpbGwgYmUgcmVtb3ZlZCBpcyBub3QgYSBsaXN0LlxuICAgICAgICAgICAgaWYgKCFuZXh0U2libGluZyB8fCAhbmV4dFNpYmxpbmcuaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIG91dGVybW9zdCBsaXN0IGl0ZW0gYmFzZWQgb24gdGhlIGBsaXN0SW5kZW50YCBhdHRyaWJ1dGUuIFdlIGNhbid0IGFzc3VtZSB0aGF0IGBsaXN0SW5kZW50PTBgXG4gICAgICAgICAgICAvLyBiZWNhdXNlIHRoZSBzZWxlY3Rpb24gY2FuIGJlIGhvb2tlZCBpbiBuZXN0ZWQgbGlzdHMuXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIwXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cInNxdWFyZVwiPlVMIExpc3QgaXRlbSAxPC9saXN0SXRlbT5cbiAgICAgICAgICAgIC8vIDxsaXN0SXRlbSBsaXN0SW5kZW50PVwiMVwiIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0U3R5bGU9XCJzcXVhcmVcIj5VTCBMaXN0IFtpdGVtIDEuMTwvbGlzdEl0ZW0+XG4gICAgICAgICAgICAvLyA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwiY2lyY2xlXCI+W11VTCBMaXN0IGl0ZW0gMS48L2xpc3RJdGVtPlxuICAgICAgICAgICAgLy8gPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIxXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cImNpcmNsZVwiPlVMIExpc3QgXWl0ZW0gMS4xPC9saXN0SXRlbT5cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyBBZnRlciBkZWxldGluZyB0aGUgY29udGVudCwgd2Ugd291bGQgbGlrZSB0byBpbmhlcml0IHRoZSBcInNxdWFyZVwiIGF0dHJpYnV0ZSBmb3IgdGhlIGxhc3QgZWxlbWVudDpcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwic3F1YXJlXCI+VUwgTGlzdCBpdGVtIDE8L2xpc3RJdGVtPlxuICAgICAgICAgICAgLy8gPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIxXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cInNxdWFyZVwiPlVMIExpc3QgW11pdGVtIDEuMTwvbGlzdEl0ZW0+XG4gICAgICAgICAgICBjb25zdCBtb3N0T3V0ZXJJdGVtTGlzdCA9IGdldFNpYmxpbmdMaXN0SXRlbShmaXJzdFBvc2l0aW9uLnBhcmVudCwge1xuICAgICAgICAgICAgICAgIHNhbWVJbmRlbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbGlzdEluZGVudDogbmV4dFNpYmxpbmcuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gVGhlIG91dGVybW9zdCBsaXN0IGl0ZW0gbWF5IG5vdCBleGlzdCB3aGlsZSByZW1vdmluZyBlbGVtZW50cyBiZXR3ZWVuIGxpc3RzIHdpdGggZGlmZmVyZW50IHZhbHVlXG4gICAgICAgICAgICAvLyBvZiB0aGUgYGxpc3RJbmRlbnRgIGF0dHJpYnV0ZS4gSW4gc3VjaCBhIGNhc2Ugd2UgZG9uJ3Qgd2FudCB0byB1cGRhdGUgYW55dGhpbmcuIFNlZTogIzgwNzMuXG4gICAgICAgICAgICBpZiAoIW1vc3RPdXRlckl0ZW1MaXN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vc3RPdXRlckl0ZW1MaXN0LmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PT0gbmV4dFNpYmxpbmcuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpKSB7XG4gICAgICAgICAgICAgICAgZmlyc3RNb3N0T3V0ZXJJdGVtID0gbW9zdE91dGVySXRlbUxpc3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIElmIHNvLCB1cGRhdGUgdGhlIGBsaXN0U3R5bGVgIGF0dHJpYnV0ZSBmb3IgdGhlIHNlY29uZCBsaXN0LlxuICAgICAgICB0aGlzLmxpc3RlblRvKG1vZGVsLCAnZGVsZXRlQ29udGVudCcsICgpPT57XG4gICAgICAgICAgICBpZiAoIWZpcnN0TW9zdE91dGVySXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGZpcnN0IG1vc3Qtb3V0ZXIgaXRlbSBsaXN0IGluIHRoZSBtZXJnZWQgbGlzdC5cbiAgICAgICAgICAgICAgICAvLyBBIGNhc2Ugd2hlbiB0aGUgZmlyc3QgbGlzdCBpdGVtIGluIHRoZSBzZWNvbmQgbGlzdCB3YXMgbWVyZ2VkIGludG8gdGhlIGxhc3QgaXRlbSBpbiB0aGUgZmlyc3QgbGlzdC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIDxsaXN0SXRlbSBsaXN0SW5kZW50PVwiMFwiIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIiBsaXN0U3R5bGU9XCJzcXVhcmVcIj5VTCBMaXN0IGl0ZW0gMTwvbGlzdEl0ZW0+XG4gICAgICAgICAgICAgICAgLy8gPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIwXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cInNxdWFyZVwiPlVMIExpc3QgaXRlbSAyPC9saXN0SXRlbT5cbiAgICAgICAgICAgICAgICAvLyA8bGlzdEl0ZW0gbGlzdEluZGVudD1cIjBcIiBsaXN0VHlwZT1cImJ1bGxldGVkXCIgbGlzdFN0eWxlPVwiY2lyY2xlXCI+W11VTCBMaXN0IGl0ZW0gMTwvbGlzdEl0ZW0+XG4gICAgICAgICAgICAgICAgLy8gPGxpc3RJdGVtIGxpc3RJbmRlbnQ9XCIwXCIgbGlzdFR5cGU9XCJidWxsZXRlZFwiIGxpc3RTdHlsZT1cImNpcmNsZVwiPlVMIExpc3QgaXRlbSAyPC9saXN0SXRlbT5cbiAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRMaXN0TW9zdE91dGVySXRlbSA9IGdldFNpYmxpbmdMaXN0SXRlbShmaXJzdE1vc3RPdXRlckl0ZW0ubmV4dFNpYmxpbmcsIHtcbiAgICAgICAgICAgICAgICAgICAgc2FtZUluZGVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbGlzdEluZGVudDogZmlyc3RNb3N0T3V0ZXJJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpLFxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdmb3J3YXJkJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzZWxlY3Rpb24gZW5kcyBpbiBhIG5vbi1saXN0IGVsZW1lbnQsIHRoZXJlIGFyZSBubyA8bGlzdEl0ZW0+cyB0aGF0IHdvdWxkIHJlcXVpcmUgYWRqdXN0bWVudHMuXG4gICAgICAgICAgICAgICAgLy8gU2VlOiAjODY0Mi5cbiAgICAgICAgICAgICAgICBpZiAoIXNlY29uZExpc3RNb3N0T3V0ZXJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpcnN0TW9zdE91dGVySXRlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBbXG4gICAgICAgICAgICAgICAgICAgIHNlY29uZExpc3RNb3N0T3V0ZXJJdGVtLFxuICAgICAgICAgICAgICAgICAgICAuLi5nZXRTaWJsaW5nTm9kZXMod3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoc2Vjb25kTGlzdE1vc3RPdXRlckl0ZW0sIDApLCAnZm9yd2FyZCcpXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RJdGVtIG9mIGl0ZW1zKXtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBhdHRyaWJ1dGVTdHJhdGVnaWVzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJhdGVneS5hcHBsaWVzVG9MaXN0SXRlbShsaXN0SXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVOYW1lID0gc3RyYXRlZ3kuYXR0cmlidXRlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGZpcnN0TW9zdE91dGVySXRlbS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCB2YWx1ZSwgbGlzdEl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmaXJzdE1vc3RPdXRlckl0ZW0gPSBudWxsO1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdydcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGFuIGFycmF5IG9mIHN0cmF0ZWdpZXMgZm9yIGRlYWxpbmcgd2l0aCBlbmFibGVkIGxpc3RJdGVtIGF0dHJpYnV0ZXMuXG4gKi8gZnVuY3Rpb24gY3JlYXRlQXR0cmlidXRlU3RyYXRlZ2llcyhlbmFibGVkUHJvcGVydGllcykge1xuICAgIGNvbnN0IHN0cmF0ZWdpZXMgPSBbXTtcbiAgICBpZiAoZW5hYmxlZFByb3BlcnRpZXMuc3R5bGVzKSB7XG4gICAgICAgIHN0cmF0ZWdpZXMucHVzaCh7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbGlzdFN0eWxlJyxcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogREVGQVVMVF9MSVNUX1RZUEUsXG4gICAgICAgICAgICBhZGRDb21tYW5kIChlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdsaXN0U3R5bGUnLCBuZXcgTGVnYWN5TGlzdFN0eWxlQ29tbWFuZChlZGl0b3IsIERFRkFVTFRfTElTVF9UWVBFKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXBwbGllc1RvTGlzdEl0ZW0gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uRG93bmNhc3QgKHdyaXRlciwgbGlzdFN0eWxlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3RTdHlsZSAmJiBsaXN0U3R5bGUgIT09IERFRkFVTFRfTElTVF9UWVBFKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRTdHlsZSgnbGlzdC1zdHlsZS10eXBlJywgbGlzdFN0eWxlLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlU3R5bGUoJ2xpc3Qtc3R5bGUtdHlwZScsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRBdHRyaWJ1dGVPblVwY2FzdCAobGlzdFBhcmVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVMaXN0U3R5bGUobGlzdFBhcmVudC5nZXRTdHlsZSgnbGlzdC1zdHlsZS10eXBlJykpIHx8IERFRkFVTFRfTElTVF9UWVBFO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVuYWJsZWRQcm9wZXJ0aWVzLnJldmVyc2VkKSB7XG4gICAgICAgIHN0cmF0ZWdpZXMucHVzaCh7XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lOiAnbGlzdFJldmVyc2VkJyxcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgICAgICAgICBhZGRDb21tYW5kIChlZGl0b3IpIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdsaXN0UmV2ZXJzZWQnLCBuZXcgTGVnYWN5TGlzdFJldmVyc2VkQ29tbWFuZChlZGl0b3IpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcHBsaWVzVG9MaXN0SXRlbSAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSA9PSAnbnVtYmVyZWQnO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldEF0dHJpYnV0ZU9uRG93bmNhc3QgKHdyaXRlciwgbGlzdFJldmVyc2VkLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3RSZXZlcnNlZCkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKCdyZXZlcnNlZCcsICdyZXZlcnNlZCcsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoJ3JldmVyc2VkJywgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldEF0dHJpYnV0ZU9uVXBjYXN0IChsaXN0UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RQYXJlbnQuaGFzQXR0cmlidXRlKCdyZXZlcnNlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGVuYWJsZWRQcm9wZXJ0aWVzLnN0YXJ0SW5kZXgpIHtcbiAgICAgICAgc3RyYXRlZ2llcy5wdXNoKHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZU5hbWU6ICdsaXN0U3RhcnQnLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiAxLFxuICAgICAgICAgICAgYWRkQ29tbWFuZCAoZWRpdG9yKSB7XG4gICAgICAgICAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnbGlzdFN0YXJ0JywgbmV3IExlZ2FjeUxpc3RTdGFydENvbW1hbmQoZWRpdG9yKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXBwbGllc1RvTGlzdEl0ZW0gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT0gJ251bWJlcmVkJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRBdHRyaWJ1dGVPbkRvd25jYXN0ICh3cml0ZXIsIGxpc3RTdGFydCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0U3RhcnQgPT0gMCB8fCBsaXN0U3RhcnQgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ3N0YXJ0JywgbGlzdFN0YXJ0LCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCdzdGFydCcsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRBdHRyaWJ1dGVPblVwY2FzdCAobGlzdFBhcmVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0QXR0cmlidXRlVmFsdWUgPSBsaXN0UGFyZW50LmdldEF0dHJpYnV0ZSgnc3RhcnQnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnRBdHRyaWJ1dGVWYWx1ZSA+PSAwID8gc3RhcnRBdHRyaWJ1dGVWYWx1ZSA6IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gc3RyYXRlZ2llcztcbn1cbi8qKlxuICogUmV0dXJucyBhIGNvbnZlcnRlciBjb25zdW1lcyB0aGUgYHN0eWxlYCwgYHJldmVyc2VkYCBhbmQgYHN0YXJ0YCBhdHRyaWJ1dGUuXG4gKiBJbiBgc3R5bGVgIGl0IHNlYXJjaGVzIGZvciB0aGUgYGxpc3Qtc3R5bGUtdHlwZWAgZGVmaW5pdGlvbi5cbiAqIElmIG5vdCBmb3VuZCwgdGhlIGBcImRlZmF1bHRcImAgdmFsdWUgd2lsbCBiZSB1c2VkLlxuICovIGZ1bmN0aW9uIHVwY2FzdExpc3RJdGVtQXR0cmlidXRlcyhhdHRyaWJ1dGVTdHJhdGVnaWVzKSB7XG4gICAgcmV0dXJuIChkaXNwYXRjaGVyKT0+e1xuICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50OmxpJywgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzEzODU4XG4gICAgICAgICAgICBpZiAoIWRhdGEubW9kZWxSYW5nZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGxpc3RQYXJlbnQgPSBkYXRhLnZpZXdJdGVtLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RJdGVtID0gZGF0YS5tb2RlbFJhbmdlLnN0YXJ0Lm5vZGVBZnRlciB8fCBkYXRhLm1vZGVsUmFuZ2UuZW5kLm5vZGVCZWZvcmU7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIGF0dHJpYnV0ZVN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgICAgIGlmIChzdHJhdGVneS5hcHBsaWVzVG9MaXN0SXRlbShsaXN0SXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlzdFN0eWxlID0gc3RyYXRlZ3kuZ2V0QXR0cmlidXRlT25VcGNhc3QobGlzdFBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnZlcnNpb25BcGkud3JpdGVyLnNldEF0dHJpYnV0ZShzdHJhdGVneS5hdHRyaWJ1dGVOYW1lLCBsaXN0U3R5bGUsIGxpc3RJdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93J1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgY29udmVydGVyIHRoYXQgYWRkcyBgcmV2ZXJzZWRgLCBgc3RhcnRgIGF0dHJpYnV0ZXMgYW5kIGFkZHMgYGxpc3Qtc3R5bGUtdHlwZWAgZGVmaW5pdGlvbiBhcyBhIHZhbHVlIGZvciB0aGUgYHN0eWxlYCBhdHRyaWJ1dGUuXG4gKiBUaGUgYFwiZGVmYXVsdFwiYCB2YWx1ZXMgYXJlIHJlbW92ZWQgYW5kIG5vdCBwcmVzZW50IGluIHRoZSB2aWV3L2RhdGEuXG4gKi8gZnVuY3Rpb24gZG93bmNhc3RMaXN0SXRlbUF0dHJpYnV0ZXMoYXR0cmlidXRlU3RyYXRlZ2llcykge1xuICAgIHJldHVybiAoZGlzcGF0Y2hlcik9PntcbiAgICAgICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBhdHRyaWJ1dGVTdHJhdGVnaWVzKXtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oYGF0dHJpYnV0ZToke3N0cmF0ZWd5LmF0dHJpYnV0ZU5hbWV9Omxpc3RJdGVtYCwgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3V3JpdGVyID0gY29udmVyc2lvbkFwaS53cml0ZXI7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEVsZW1lbnQgPSBkYXRhLml0ZW07XG4gICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNFbGVtZW50ID0gZ2V0U2libGluZ0xpc3RJdGVtKGN1cnJlbnRFbGVtZW50LnByZXZpb3VzU2libGluZywge1xuICAgICAgICAgICAgICAgICAgICBzYW1lSW5kZW50OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsaXN0SW5kZW50OiBjdXJyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSxcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnYmFja3dhcmQnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgdmlld0l0ZW0gPSBjb252ZXJzaW9uQXBpLm1hcHBlci50b1ZpZXdFbGVtZW50KGN1cnJlbnRFbGVtZW50KTtcbiAgICAgICAgICAgICAgICAvLyBBIGNhc2Ugd2hlbiBlbGVtZW50cyByZXByZXNlbnQgZGlmZmVyZW50IGxpc3RzLiBXZSBuZWVkIHRvIHNlcGFyYXRlIHRoZWlyIGNvbnRhaW5lci5cbiAgICAgICAgICAgICAgICBpZiAoIWFyZVJlcHJlc2VudGluZ1NhbWVMaXN0KGN1cnJlbnRFbGVtZW50LCBwcmV2aW91c0VsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpZXdXcml0ZXIuYnJlYWtDb250YWluZXIodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkJlZm9yZSh2aWV3SXRlbSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHJhdGVneS5zZXRBdHRyaWJ1dGVPbkRvd25jYXN0KHZpZXdXcml0ZXIsIGRhdGEuYXR0cmlidXRlTmV3VmFsdWUsIHZpZXdJdGVtLnBhcmVudCk7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG5cdCAqIENoZWNrcyB3aGV0aGVyIHNwZWNpZmllZCBsaXN0IGl0ZW1zIGJlbG9uZyB0byB0aGUgc2FtZSBsaXN0LlxuXHQgKi8gZnVuY3Rpb24gYXJlUmVwcmVzZW50aW5nU2FtZUxpc3QobGlzdEl0ZW0xLCBsaXN0SXRlbTIpIHtcbiAgICAgICAgcmV0dXJuIGxpc3RJdGVtMiAmJiBsaXN0SXRlbTEuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09PSBsaXN0SXRlbTIuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICYmIGxpc3RJdGVtMS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSA9PT0gbGlzdEl0ZW0yLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpICYmIGxpc3RJdGVtMS5nZXRBdHRyaWJ1dGUoJ2xpc3RTdHlsZScpID09PSBsaXN0SXRlbTIuZ2V0QXR0cmlidXRlKCdsaXN0U3R5bGUnKSAmJiBsaXN0SXRlbTEuZ2V0QXR0cmlidXRlKCdsaXN0UmV2ZXJzZWQnKSA9PT0gbGlzdEl0ZW0yLmdldEF0dHJpYnV0ZSgnbGlzdFJldmVyc2VkJykgJiYgbGlzdEl0ZW0xLmdldEF0dHJpYnV0ZSgnbGlzdFN0YXJ0JykgPT09IGxpc3RJdGVtMi5nZXRBdHRyaWJ1dGUoJ2xpc3RTdGFydCcpO1xuICAgIH1cbn1cbi8qKlxuICogV2hlbiBpbmRlbnRpbmcgbGlzdCwgbmVzdGVkIGxpc3Qgc2hvdWxkIGNsZWFyIGl0cyB2YWx1ZSBmb3IgdGhlIGF0dHJpYnV0ZXMgb3IgaW5oZXJpdCBmcm9tIG5lc3RlZCBsaXN0cy5cbiAqXG4gKiDilqAgTGlzdCBpdGVtIDEuXG4gKiDilqAgTGlzdCBpdGVtIDIuW11cbiAqIOKWoCBMaXN0IGl0ZW0gMy5cbiAqIGVkaXRvci5leGVjdXRlKCAnaW5kZW50TGlzdCcgKTtcbiAqXG4gKiDilqAgTGlzdCBpdGVtIDEuXG4gKiAgICAg4peLIExpc3QgaXRlbSAyLltdXG4gKiDilqAgTGlzdCBpdGVtIDMuXG4gKi8gZnVuY3Rpb24gZml4TGlzdEFmdGVySW5kZW50TGlzdENvbW1hbmQoZWRpdG9yLCBhdHRyaWJ1dGVTdHJhdGVnaWVzKSB7XG4gICAgcmV0dXJuIChldnQsIGNoYW5nZWRJdGVtcyk9PntcbiAgICAgICAgY29uc3Qgcm9vdCA9IGNoYW5nZWRJdGVtc1swXTtcbiAgICAgICAgY29uc3Qgcm9vdEluZGVudCA9IHJvb3QuZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50Jyk7XG4gICAgICAgIGNvbnN0IGl0ZW1zVG9VcGRhdGUgPSBjaGFuZ2VkSXRlbXMuZmlsdGVyKChpdGVtKT0+aXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSA9PT0gcm9vdEluZGVudCk7XG4gICAgICAgIC8vIEEgY2FzZSB3aGVyZSBhIGZldyBsaXN0IGl0ZW1zIGFyZSBpbmRlbnRlZCBtdXN0IGJlIGNoZWNrZWQgc2VwYXJhdGVseVxuICAgICAgICAvLyBzaW5jZSBgZ2V0U2libGluZ0xpc3RJdGVtKClgIHJldHVybnMgdGhlIGZpcnN0IGNoYW5nZWQgZWxlbWVudC5cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLlxuICAgICAgICAvLyAgICAg4peLIFtMaXN0IGl0ZW0gMi5cbiAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMy5dXG4gICAgICAgIC8vIOKWoCBMaXN0IGl0ZW0gNC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gTGlzdCBpdGVtczogYDJgIGFuZCBgM2Agc2hvdWxkIGJlIGFkanVzdGVkLlxuICAgICAgICBsZXQgcHJldmlvdXNTaWJsaW5nID0gbnVsbDtcbiAgICAgICAgaWYgKHJvb3QucHJldmlvdXNTaWJsaW5nLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpICsgMSAhPT0gcm9vdEluZGVudCkge1xuICAgICAgICAgICAgcHJldmlvdXNTaWJsaW5nID0gZ2V0U2libGluZ0xpc3RJdGVtKHJvb3QucHJldmlvdXNTaWJsaW5nLCB7XG4gICAgICAgICAgICAgICAgc2FtZUluZGVudDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdiYWNrd2FyZCcsXG4gICAgICAgICAgICAgICAgbGlzdEluZGVudDogcm9vdEluZGVudFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zVG9VcGRhdGUpe1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3RyYXRlZ3kgb2YgYXR0cmlidXRlU3RyYXRlZ2llcyl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHJhdGVneS5hcHBsaWVzVG9MaXN0SXRlbShpdGVtKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWVUb1NldCA9IHByZXZpb3VzU2libGluZyA9PSBudWxsID8gc3RyYXRlZ3kuZGVmYXVsdFZhbHVlIDogcHJldmlvdXNTaWJsaW5nLmdldEF0dHJpYnV0ZShzdHJhdGVneS5hdHRyaWJ1dGVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoc3RyYXRlZ3kuYXR0cmlidXRlTmFtZSwgdmFsdWVUb1NldCwgaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIFdoZW4gb3V0ZGVudGluZyBhIGxpc3QsIGEgbmVzdGVkIGxpc3Qgc2hvdWxkIGNvcHkgYXR0cmlidXRlIHZhbHVlc1xuICogZnJvbSB0aGUgcHJldmlvdXMgc2libGluZyBsaXN0IGl0ZW0gaW5jbHVkaW5nIHRoZSBzYW1lIHZhbHVlIGZvciB0aGUgYGxpc3RJbmRlbnRgIHZhbHVlLlxuICpcbiAqIOKWoCBMaXN0IGl0ZW0gMS5cbiAqICAgICDil4sgTGlzdCBpdGVtIDIuW11cbiAqIOKWoCBMaXN0IGl0ZW0gMy5cbiAqXG4gKiBlZGl0b3IuZXhlY3V0ZSggJ291dGRlbnRMaXN0JyApO1xuICpcbiAqIOKWoCBMaXN0IGl0ZW0gMS5cbiAqIOKWoCBMaXN0IGl0ZW0gMi5bXVxuICog4pagIExpc3QgaXRlbSAzLlxuICovIGZ1bmN0aW9uIGZpeExpc3RBZnRlck91dGRlbnRMaXN0Q29tbWFuZChlZGl0b3IsIGF0dHJpYnV0ZVN0cmF0ZWdpZXMpIHtcbiAgICByZXR1cm4gKGV2dCwgY2hhbmdlZEl0ZW1zKT0+e1xuICAgICAgICBjaGFuZ2VkSXRlbXMgPSBjaGFuZ2VkSXRlbXMucmV2ZXJzZSgpLmZpbHRlcigoaXRlbSk9Pml0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSk7XG4gICAgICAgIGlmICghY2hhbmdlZEl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluZGVudCA9IGNoYW5nZWRJdGVtc1swXS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICAgICAgY29uc3QgbGlzdFR5cGUgPSBjaGFuZ2VkSXRlbXNbMF0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpO1xuICAgICAgICBsZXQgbGlzdEl0ZW0gPSBjaGFuZ2VkSXRlbXNbMF0ucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDEuXG4gICAgICAgIC8vICAgICDil4sgTGlzdCBpdGVtIDIuXG4gICAgICAgIC8vICAgICDil4sgTGlzdCBpdGVtIDMuW11cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSA0LlxuICAgICAgICAvL1xuICAgICAgICAvLyBBZnRlciBvdXRkZW50aW5nIGEgbGlzdCwgYExpc3QgaXRlbSAzYCBzaG91bGQgaW5oZXJpdCB0aGUgYGxpc3RTdHlsZWAgYXR0cmlidXRlIGZyb20gYExpc3QgaXRlbSAxYC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLlxuICAgICAgICAvLyAgICAg4peLIExpc3QgaXRlbSAyLlxuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDMuW11cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSA0LlxuICAgICAgICBpZiAobGlzdEl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSkge1xuICAgICAgICAgICAgd2hpbGUobGlzdEl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgIT09IGluZGVudCl7XG4gICAgICAgICAgICAgICAgbGlzdEl0ZW0gPSBsaXN0SXRlbS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaXN0SXRlbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3V0ZGVudGluZyBzdWNoIGEgbGlzdCBzaG91bGQgcmVzdG9yZSB2YWx1ZXMgYmFzZWQgb24gYExpc3QgaXRlbSA0YC5cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLltdXG4gICAgICAgIC8vICAgICDil4sgTGlzdCBpdGVtIDIuXG4gICAgICAgIC8vICAgICDil4sgTGlzdCBpdGVtIDMuXG4gICAgICAgIC8vIOKWoCBMaXN0IGl0ZW0gNC5cbiAgICAgICAgaWYgKCFsaXN0SXRlbSkge1xuICAgICAgICAgICAgbGlzdEl0ZW0gPSBjaGFuZ2VkSXRlbXNbY2hhbmdlZEl0ZW1zLmxlbmd0aCAtIDFdLm5leHRTaWJsaW5nO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFuZCBzdWNoIGEgbGlzdCBzaG91bGQgbm90IG1vZGlmeSBhbnl0aGluZy5cbiAgICAgICAgLy8gSG93ZXZlciwgYGxpc3RJdGVtYCBjYW4gaW5kaWNhdGUgYSBub2RlIGJlbG93IHRoZSBsaXN0LiBCZSBzdXJlIHRoYXQgd2UgaGF2ZSB0aGUgYGxpc3RJdGVtYCBlbGVtZW50LlxuICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDEuW11cbiAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMi5cbiAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMy5cbiAgICAgICAgLy8gPHBhcmFncmFwaD5UaGUgbGF0ZXIgaWYgY2hlY2suPC9wYXJhZ3JhcGg+XG4gICAgICAgIGlmICghbGlzdEl0ZW0gfHwgIWxpc3RJdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBEbyBub3QgbW9kaWZ5IHRoZSBsaXN0IGlmIGZvdW5kIGBsaXN0SXRlbWAgcmVwcmVzZW50cyBvdGhlciB0eXBlIG9mIGxpc3QgdGhhbiBvdXRkZW50ZWQgbGlzdCBpdGVtcy5cbiAgICAgICAgaWYgKGxpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPT0gbGlzdFR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBjb25zdCBpdGVtc1RvVXBkYXRlID0gY2hhbmdlZEl0ZW1zLmZpbHRlcigoaXRlbSk9Pml0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0SW5kZW50JykgPT09IGluZGVudCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXNUb1VwZGF0ZSl7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBhdHRyaWJ1dGVTdHJhdGVnaWVzKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmF0ZWd5LmFwcGxpZXNUb0xpc3RJdGVtKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhdHRyaWJ1dGVOYW1lID0gc3RyYXRlZ3kuYXR0cmlidXRlTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlVG9TZXQgPSBsaXN0SXRlbS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIHZhbHVlVG9TZXQsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufVxuLyoqXG4gKiBFYWNoIGBsaXN0SXRlbWAgZWxlbWVudCBtdXN0IGhhdmUgc3BlY2lmaWVkIHRoZSBgbGlzdFN0eWxlYCwgYGxpc3RSZXZlcnNlZGAgYW5kIGBsaXN0U3RhcnRgIGF0dHJpYnV0ZXNcbiAqIGlmIHRoZXkgYXJlIGVuYWJsZWQgYW5kIHN1cHBvcnRlZCBieSBpdHMgYGxpc3RUeXBlYC5cbiAqIFRoaXMgcG9zdC1maXhlciBjaGVja3Mgd2hldGhlciBpbnNlcnRlZCBlbGVtZW50cyBgbGlzdEl0ZW1gIGVsZW1lbnRzIHNob3VsZCBpbmhlcml0IHRoZSBhdHRyaWJ1dGUgdmFsdWVzIGZyb21cbiAqIHRoZWlyIHNpYmxpbmcgbm9kZXMgb3Igc2hvdWxkIHVzZSB0aGUgZGVmYXVsdCB2YWx1ZXMuXG4gKlxuICogUGFyYWdyYXBoW11cbiAqIOKWoCBMaXN0IGl0ZW0gMS4gLy8gW2xpc3RTdHlsZT1cInNxdWFyZVwiLCBsaXN0VHlwZT1cImJ1bGxldGVkXCJdXG4gKiDilqAgTGlzdCBpdGVtIDIuIC8vIC4uLlxuICog4pagIExpc3QgaXRlbSAzLiAvLyAuLi5cbiAqXG4gKiBlZGl0b3IuZXhlY3V0ZSggJ2J1bGxldGVkTGlzdCcgKVxuICpcbiAqIOKWoCBQYXJhZ3JhcGhbXSAgLy8gW2xpc3RTdHlsZT1cInNxdWFyZVwiLCBsaXN0VHlwZT1cImJ1bGxldGVkXCJdXG4gKiDilqAgTGlzdCBpdGVtIDEuIC8vIFtsaXN0U3R5bGU9XCJzcXVhcmVcIiwgbGlzdFR5cGU9XCJidWxsZXRlZFwiXVxuICog4pagIExpc3QgaXRlbSAyLlxuICog4pagIExpc3QgaXRlbSAzLlxuICpcbiAqIEl0IGFsc28gY292ZXJzIGEgc3VjaCBjaGFuZ2U6XG4gKlxuICogW1BhcmFncmFwaCAxXG4gKiBQYXJhZ3JhcGggMl1cbiAqIOKWoCBMaXN0IGl0ZW0gMS4gLy8gW2xpc3RTdHlsZT1cInNxdWFyZVwiLCBsaXN0VHlwZT1cImJ1bGxldGVkXCJdXG4gKiDilqAgTGlzdCBpdGVtIDIuIC8vIC4uLlxuICog4pagIExpc3QgaXRlbSAzLiAvLyAuLi5cbiAqXG4gKiBlZGl0b3IuZXhlY3V0ZSggJ251bWJlcmVkTGlzdCcgKVxuICpcbiAqIDEuIFtQYXJhZ3JhcGggMSAvLyBbbGlzdFN0eWxlPVwiZGVmYXVsdFwiLCBsaXN0VHlwZT1cIm51bWJlcmVkXCJdXG4gKiAyLiBQYXJhZ3JhcGggMl0gLy8gW2xpc3RTdHlsZT1cImRlZmF1bHRcIiwgbGlzdFR5cGU9XCJudW1iZXJlZFwiXVxuICog4pagIExpc3QgaXRlbSAxLiAgLy8gW2xpc3RTdHlsZT1cInNxdWFyZVwiLCBsaXN0VHlwZT1cImJ1bGxldGVkXCJdXG4gKiDilqAgTGlzdCBpdGVtIDIuICAvLyAuLi5cbiAqIOKWoCBMaXN0IGl0ZW0gMy4gIC8vIC4uLlxuICovIGZ1bmN0aW9uIGZpeExpc3RBdHRyaWJ1dGVzT25MaXN0SXRlbUVsZW1lbnRzKGVkaXRvciwgYXR0cmlidXRlU3RyYXRlZ2llcykge1xuICAgIHJldHVybiAod3JpdGVyKT0+e1xuICAgICAgICBsZXQgd2FzRml4ZWQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgaW5zZXJ0ZWRMaXN0SXRlbXMgPSBnZXRDaGFuZ2VkTGlzdEl0ZW1zKGVkaXRvci5tb2RlbC5kb2N1bWVudC5kaWZmZXIuZ2V0Q2hhbmdlcygpKS5maWx0ZXIoKGl0ZW0pPT57XG4gICAgICAgICAgICAvLyBEb24ndCB0b3VjaCB0b2RvIGxpc3RzLiBUaGV5IGFyZSBoYW5kbGVkIGluIGFub3RoZXIgcG9zdC1maXhlci5cbiAgICAgICAgICAgIHJldHVybiBpdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPT0gJ3RvZG8nO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFpbnNlcnRlZExpc3RJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB3YXNGaXhlZDtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSBsYXN0IGluc2VydGVkIGVsZW1lbnQgaXMgbmV4dCB0byB0aGUgYGxpc3RJdGVtYCBlbGVtZW50LlxuICAgICAgICAvL1xuICAgICAgICAvLyDilqAgUGFyYWdyYXBoW10gIC8vIDwtLSBUaGUgaW5zZXJ0ZWQgaXRlbS5cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLlxuICAgICAgICBsZXQgZXhpc3RpbmdMaXN0SXRlbSA9IGluc2VydGVkTGlzdEl0ZW1zW2luc2VydGVkTGlzdEl0ZW1zLmxlbmd0aCAtIDFdLm5leHRTaWJsaW5nO1xuICAgICAgICAvLyBJZiBpdCBkb2Vzbid0LCBtYXliZSB0aGUgYGxpc3RJdGVtYCB3YXMgaW5zZXJ0ZWQgYXQgdGhlIGVuZCBvZiB0aGUgbGlzdC5cbiAgICAgICAgLy9cbiAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLlxuICAgICAgICAvLyDilqAgUGFyYWdyYXBoW10gIC8vIDwtLSBUaGUgaW5zZXJ0ZWQgaXRlbS5cbiAgICAgICAgaWYgKCFleGlzdGluZ0xpc3RJdGVtIHx8ICFleGlzdGluZ0xpc3RJdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgICAgIGV4aXN0aW5nTGlzdEl0ZW0gPSBpbnNlcnRlZExpc3RJdGVtc1swXS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdMaXN0SXRlbSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGVudCA9IGluc2VydGVkTGlzdEl0ZW1zWzBdLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpO1xuICAgICAgICAgICAgICAgIC8vIEJ1dCB3ZSBuZWVkIHRvIGZpbmQgYSBgbGlzdEl0ZW1gIHdpdGggdGhlIGBsaXN0SW5kZW50PTBgIGF0dHJpYnV0ZS5cbiAgICAgICAgICAgICAgICAvLyBJZiBkb2Vzbid0LCBtYXliZSB0aGUgYGxpc3RJdGVtYCB3YXMgaW5zZXJ0ZWQgYXQgdGhlIGVuZCBvZiB0aGUgbGlzdC5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIOKWoCBMaXN0IGl0ZW0gMS5cbiAgICAgICAgICAgICAgICAvLyAgICAg4peLIExpc3QgaXRlbSAyLlxuICAgICAgICAgICAgICAgIC8vIOKWoCBQYXJhZ3JhcGhbXSAgLy8gPC0tIFRoZSBpbnNlcnRlZCBpdGVtLlxuICAgICAgICAgICAgICAgIHdoaWxlKGV4aXN0aW5nTGlzdEl0ZW0uaXMoJ2VsZW1lbnQnLCAnbGlzdEl0ZW0nKSAmJiBleGlzdGluZ0xpc3RJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdEluZGVudCcpICE9PSBpbmRlbnQpe1xuICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0xpc3RJdGVtID0gZXhpc3RpbmdMaXN0SXRlbS5wcmV2aW91c1NpYmxpbmc7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpdGVtIGRvZXMgbm90IGV4aXN0LCBtb3N0IHByb2JhYmx5IHRoZXJlIGlzIG5vIG90aGVyIGNvbnRlbnQgaW4gdGhlIGVkaXRvci4gU2VlOiAjODA3Mi5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdGluZ0xpc3RJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIGF0dHJpYnV0ZVN0cmF0ZWdpZXMpe1xuICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlTmFtZSA9IHN0cmF0ZWd5LmF0dHJpYnV0ZU5hbWU7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaW5zZXJ0ZWRMaXN0SXRlbXMpe1xuICAgICAgICAgICAgICAgIGlmICghc3RyYXRlZ3kuYXBwbGllc1RvTGlzdEl0ZW0oaXRlbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghaXRlbS5oYXNBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZEluaGVyaXRMaXN0VHlwZShleGlzdGluZ0xpc3RJdGVtLCBpdGVtLCBzdHJhdGVneSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSwgZXhpc3RpbmdMaXN0SXRlbS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSksIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lLCBzdHJhdGVneS5kZWZhdWx0VmFsdWUsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHdhc0ZpeGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGp1c3QgdGhlIGBsaXN0U3R5bGVgLCBgbGlzdFJldmVyc2VkYCBhbmQgYGxpc3RTdGFydGBcbiAgICAgICAgICAgICAgICAgICAgLy8gYXR0cmlidXRlcyBmb3IgaW5zZXJ0ZWQgKHBhc3RlZCkgaXRlbXMuIFNlZSAjODE2MC5cbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgLy8g4pagIExpc3QgaXRlbSAxLiAvLyBbbGlzdFN0eWxlPVwic3F1YXJlXCIsIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIl1cbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIOKXiyBMaXN0IGl0ZW0gMS4xLiAvLyBbbGlzdFN0eWxlPVwiY2lyY2xlXCIsIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIl1cbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIOKXiyBbXSAoc2VsZWN0aW9uIGlzIGhlcmUpXG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZW4sIHBhc3RpbmcgYSBsaXN0IHdpdGggZGlmZmVyZW50IGF0dHJpYnV0ZXMgKGxpc3RTdHlsZSwgbGlzdFR5cGUpOlxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyAxLiBGaXJzdC4gLy8gW2xpc3RTdHlsZT1cImRlY2ltYWxcIiwgbGlzdFR5cGU9XCJudW1iZXJlZFwiXVxuICAgICAgICAgICAgICAgICAgICAvLyAyLiBTZWNvbmQgLy8gW2xpc3RTdHlsZT1cImRlY2ltYWxcIiwgbGlzdFR5cGU9XCJudW1iZXJlZFwiXVxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYGxpc3RUeXBlYCBhdHRyaWJ1dGUgd2lsbCBiZSBjb3JyZWN0ZWQgYnkgdGhlIGBMaXN0RWRpdGluZ2AgY29udmVydGVycy5cbiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBhZGp1c3QgdGhlIGBsaXN0U3R5bGVgIGF0dHJpYnV0ZS4gRXhwZWN0ZWQgc3RydWN0dXJlOlxuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyDilqAgTGlzdCBpdGVtIDEuIC8vIFtsaXN0U3R5bGU9XCJzcXVhcmVcIiwgbGlzdFR5cGU9XCJidWxsZXRlZFwiXVxuICAgICAgICAgICAgICAgICAgICAvLyAgICAg4peLIExpc3QgaXRlbSAxLjEuIC8vIFtsaXN0U3R5bGU9XCJjaXJjbGVcIiwgbGlzdFR5cGU9XCJidWxsZXRlZFwiXVxuICAgICAgICAgICAgICAgICAgICAvLyAgICAg4peLIEZpcnN0LiAvLyBbbGlzdFN0eWxlPVwiY2lyY2xlXCIsIGxpc3RUeXBlPVwiYnVsbGV0ZWRcIl1cbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIOKXiyBTZWNvbmQgLy8gW2xpc3RTdHlsZT1cImNpcmNsZVwiLCBsaXN0VHlwZT1cImJ1bGxldGVkXCJdXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzU2libGluZyA9IGl0ZW0ucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkSW5oZXJpdExpc3RUeXBlRnJvbVByZXZpb3VzSXRlbShwcmV2aW91c1NpYmxpbmcsIGl0ZW0sIHN0cmF0ZWd5LmF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUsIHByZXZpb3VzU2libGluZy5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlTmFtZSksIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FzRml4ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3YXNGaXhlZDtcbiAgICB9O1xufVxuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgYGxpc3RTdHlsZWAsIGBsaXN0UmV2ZXJzZWRgIGFuZCBgbGlzdFN0YXJ0YCBhdHRyaWJ1dGVzXG4gKiBzaG91bGQgYmUgY29waWVkIGZyb20gdGhlIGBiYXNlSXRlbWAgZWxlbWVudC5cbiAqXG4gKiBUaGUgYXR0cmlidXRlIHNob3VsZCBiZSBjb3BpZWQgaWYgdGhlIGluc2VydGVkIGVsZW1lbnQgZG9lcyBub3QgaGF2ZSBkZWZpbmVkIGl0IGFuZFxuICogdGhlIHZhbHVlIGZvciB0aGUgZWxlbWVudCBpcyBvdGhlciB0aGFuIGRlZmF1bHQgaW4gdGhlIGJhc2UgZWxlbWVudC5cbiAqLyBmdW5jdGlvbiBzaG91bGRJbmhlcml0TGlzdFR5cGUoYmFzZUl0ZW0sIGl0ZW1Ub0NoYW5nZSwgYXR0cmlidXRlU3RyYXRlZ3kpIHtcbiAgICBpZiAoIWJhc2VJdGVtKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgYmFzZUxpc3RBdHRyaWJ1dGUgPSBiYXNlSXRlbS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlU3RyYXRlZ3kuYXR0cmlidXRlTmFtZSk7XG4gICAgaWYgKCFiYXNlTGlzdEF0dHJpYnV0ZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChiYXNlTGlzdEF0dHJpYnV0ZSA9PSBhdHRyaWJ1dGVTdHJhdGVneS5kZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoYmFzZUl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9PSBpdGVtVG9DaGFuZ2UuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBgbGlzdFN0eWxlYCwgYGxpc3RSZXZlcnNlZGAgYW5kIGBsaXN0U3RhcnRgIGF0dHJpYnV0ZXNcbiAqIHNob3VsZCBiZSBjb3BpZWQgZnJvbSBwcmV2aW91cyBsaXN0IGl0ZW0uXG4gKlxuICogVGhlIGF0dHJpYnV0ZSBzaG91bGQgYmUgY29waWVkIGlmIHRoZXJlJ3MgYSBtaXNtYXRjaCBvZiBzdHlsZXMgb2YgdGhlIHBhc3RlZCBsaXN0IGludG8gYSBuZXN0ZWQgbGlzdC5cbiAqIFRvcC1sZXZlbCBsaXN0cyBhcmUgbm90IG5vcm1hbGl6ZWQgYXMgd2UgYWxsb3cgc2lkZS1ieS1zaWRlIGxpc3Qgb2YgZGlmZmVyZW50IHR5cGVzLlxuICovIGZ1bmN0aW9uIHNob3VsZEluaGVyaXRMaXN0VHlwZUZyb21QcmV2aW91c0l0ZW0ocHJldmlvdXNJdGVtLCBpdGVtVG9DaGFuZ2UsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICBpZiAoIXByZXZpb3VzSXRlbSB8fCAhcHJldmlvdXNJdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoaXRlbVRvQ2hhbmdlLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPT0gcHJldmlvdXNJdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzSXRlbUluZGVudCA9IHByZXZpb3VzSXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKTtcbiAgICBpZiAocHJldmlvdXNJdGVtSW5kZW50IDwgMSB8fCBwcmV2aW91c0l0ZW1JbmRlbnQgIT09IGl0ZW1Ub0NoYW5nZS5nZXRBdHRyaWJ1dGUoJ2xpc3RJbmRlbnQnKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHByZXZpb3VzSXRlbUxpc3RBdHRyaWJ1dGUgPSBwcmV2aW91c0l0ZW0uZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpO1xuICAgIGlmICghcHJldmlvdXNJdGVtTGlzdEF0dHJpYnV0ZSB8fCBwcmV2aW91c0l0ZW1MaXN0QXR0cmlidXRlID09PSBpdGVtVG9DaGFuZ2UuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG4vKipcbiAqIFJlbW92ZXMgdGhlIGBsaXN0U3R5bGVgLCBgbGlzdFJldmVyc2VkYCBhbmQgYGxpc3RTdGFydGAgYXR0cmlidXRlcyBmcm9tIFwidG9kb1wiIGxpc3QgaXRlbXMuXG4gKi8gZnVuY3Rpb24gcmVtb3ZlTGlzdEl0ZW1BdHRyaWJ1dGVzRnJvbVRvZG9MaXN0KGVkaXRvcikge1xuICAgIHJldHVybiAod3JpdGVyKT0+e1xuICAgICAgICBjb25zdCB0b2RvTGlzdEl0ZW1zID0gZ2V0Q2hhbmdlZExpc3RJdGVtcyhlZGl0b3IubW9kZWwuZG9jdW1lbnQuZGlmZmVyLmdldENoYW5nZXMoKSkuZmlsdGVyKChpdGVtKT0+e1xuICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSB0b2RvIGxpc3RzIG9ubHkuIFRoZSByZXN0IGlzIGhhbmRsZWQgaW4gYW5vdGhlciBwb3N0LWZpeGVyLlxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09PSAndG9kbycgJiYgKGl0ZW0uaGFzQXR0cmlidXRlKCdsaXN0U3R5bGUnKSB8fCBpdGVtLmhhc0F0dHJpYnV0ZSgnbGlzdFJldmVyc2VkJykgfHwgaXRlbS5oYXNBdHRyaWJ1dGUoJ2xpc3RTdGFydCcpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghdG9kb0xpc3RJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdG9kb0xpc3RJdGVtcyl7XG4gICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCdsaXN0U3R5bGUnLCBpdGVtKTtcbiAgICAgICAgICAgIHdyaXRlci5yZW1vdmVBdHRyaWJ1dGUoJ2xpc3RSZXZlcnNlZCcsIGl0ZW0pO1xuICAgICAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgnbGlzdFN0YXJ0JywgaXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbn1cbi8qKlxuICogUmVzdG9yZXMgdGhlIGBsaXN0U3R5bGVgIGF0dHJpYnV0ZSBhZnRlciBjaGFuZ2luZyB0aGUgbGlzdCB0eXBlLlxuICovIGZ1bmN0aW9uIHJlc3RvcmVEZWZhdWx0TGlzdFN0eWxlKGVkaXRvcikge1xuICAgIHJldHVybiAoZXZ0LCBjaGFuZ2VkSXRlbXMpPT57XG4gICAgICAgIGNoYW5nZWRJdGVtcyA9IGNoYW5nZWRJdGVtcy5maWx0ZXIoKGl0ZW0pPT5pdGVtLmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykpO1xuICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hhbmdlZEl0ZW1zKXtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGF0dHJpYnV0ZS4gUG9zdC1maXhlciB3aWxsIHJlc3RvcmUgdGhlIHByb3BlciB2YWx1ZS5cbiAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCdsaXN0U3R5bGUnLCBpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgYGxpc3RJdGVtYCB0aGF0IHdhcyBpbnNlcnRlZCBvciBjaGFuZ2VkLlxuICpcbiAqIEBwYXJhbSBjaGFuZ2VzIFRoZSBjaGFuZ2VzIGxpc3QgcmV0dXJuZWQgYnkgdGhlIGRpZmZlci5cbiAqLyBmdW5jdGlvbiBnZXRDaGFuZ2VkTGlzdEl0ZW1zKGNoYW5nZXMpIHtcbiAgICBjb25zdCBpdGVtcyA9IFtdO1xuICAgIGZvciAoY29uc3QgY2hhbmdlIG9mIGNoYW5nZXMpe1xuICAgICAgICBjb25zdCBpdGVtID0gZ2V0SXRlbUZyb21DaGFuZ2UoY2hhbmdlKTtcbiAgICAgICAgaWYgKGl0ZW0gJiYgaXRlbS5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpKSB7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtcztcbn1cbmZ1bmN0aW9uIGdldEl0ZW1Gcm9tQ2hhbmdlKGNoYW5nZSkge1xuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gJ2F0dHJpYnV0ZScpIHtcbiAgICAgICAgcmV0dXJuIGNoYW5nZS5yYW5nZS5zdGFydC5ub2RlQWZ0ZXI7XG4gICAgfVxuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gJ2luc2VydCcpIHtcbiAgICAgICAgcmV0dXJuIGNoYW5nZS5wb3NpdGlvbi5ub2RlQWZ0ZXI7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIFRoZSBsZWdhY3kgbGlzdCBwcm9wZXJ0aWVzIGZlYXR1cmUuXG4gKlxuICogVGhpcyBpcyBhIFwiZ2x1ZVwiIHBsdWdpbiB0aGF0IGxvYWRzIHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGVnYWN5bGlzdHByb3BlcnRpZXMvbGVnYWN5bGlzdHByb3BlcnRpZXNlZGl0aW5nfkxlZ2FjeUxpc3RQcm9wZXJ0aWVzRWRpdGluZ1xuICogbGVnYWN5IGxpc3QgcHJvcGVydGllcyBlZGl0aW5nIGZlYXR1cmV9IGFuZCB0aGVcbiAqIHtAbGluayBtb2R1bGU6bGlzdC9saXN0cHJvcGVydGllcy9saXN0cHJvcGVydGllc3Vpfkxpc3RQcm9wZXJ0aWVzVUkgbGlzdCBwcm9wZXJ0aWVzIFVJIGZlYXR1cmV9LlxuICovIGNsYXNzIExlZ2FjeUxpc3RQcm9wZXJ0aWVzIGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMZWdhY3lMaXN0UHJvcGVydGllc0VkaXRpbmcsXG4gICAgICAgICAgICBMaXN0UHJvcGVydGllc1VJXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xlZ2FjeUxpc3RQcm9wZXJ0aWVzJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuY29uc3QgYXR0cmlidXRlS2V5ID0gJ3RvZG9MaXN0Q2hlY2tlZCc7XG4vKipcbiAqIFRoZSBjaGVjayB0by1kbyBjb21tYW5kLlxuICpcbiAqIFRoZSBjb21tYW5kIGlzIHJlZ2lzdGVyZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3l0b2RvbGlzdC9sZWdhY3l0b2RvbGlzdGVkaXRpbmd+TGVnYWN5VG9kb0xpc3RFZGl0aW5nfSBhc1xuICogdGhlIGBjaGVja1RvZG9MaXN0YCBlZGl0b3IgY29tbWFuZCBhbmQgaXQgaXMgYWxzbyBhdmFpbGFibGUgdmlhIGFsaWFzZWQgYHRvZG9MaXN0Q2hlY2tgIG5hbWUuXG4gKi8gY2xhc3MgTGVnYWN5Q2hlY2tUb2RvTGlzdENvbW1hbmQgZXh0ZW5kcyBDb21tYW5kIHtcbiAgICAvKipcblx0ICogQSBsaXN0IG9mIHRvLWRvIGxpc3QgaXRlbXMgc2VsZWN0ZWQgYnkgdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL3NlbGVjdGlvbn5TZWxlY3Rpb259LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9zZWxlY3RlZEVsZW1lbnRzO1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gY29uc3RydWN0b3IoZWRpdG9yKXtcbiAgICAgICAgc3VwZXIoZWRpdG9yKTtcbiAgICAgICAgdGhpcy5fc2VsZWN0ZWRFbGVtZW50cyA9IFtdO1xuICAgICAgICAvLyBSZWZyZXNoIGNvbW1hbmQgYmVmb3JlIGV4ZWN1dGluZyB0byBiZSBzdXJlIGFsbCB2YWx1ZXMgYXJlIHVwIHRvIGRhdGUuXG4gICAgICAgIC8vIEl0IGlzIG5lZWRlZCB3aGVuIHNlbGVjdGlvbiBoYXMgY2hhbmdlZCBiZWZvcmUgY29tbWFuZCBleGVjdXRpb24sIGluIHRoZSBzYW1lIGNoYW5nZSBibG9jay5cbiAgICAgICAgdGhpcy5vbignZXhlY3V0ZScsICgpPT57XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoZXN0J1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFVwZGF0ZXMgdGhlIGNvbW1hbmQncyB7QGxpbmsgI3ZhbHVlfSBhbmQge0BsaW5rICNpc0VuYWJsZWR9IHByb3BlcnRpZXMgYmFzZWQgb24gdGhlIGN1cnJlbnQgc2VsZWN0aW9uLlxuXHQgKi8gcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5fc2VsZWN0ZWRFbGVtZW50cyA9IHRoaXMuX2dldFNlbGVjdGVkSXRlbXMoKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuX3NlbGVjdGVkRWxlbWVudHMuZXZlcnkoKGVsZW1lbnQpPT4hIWVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZUtleSkpO1xuICAgICAgICB0aGlzLmlzRW5hYmxlZCA9ICEhdGhpcy5fc2VsZWN0ZWRFbGVtZW50cy5sZW5ndGg7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBHZXRzIGFsbCB0by1kbyBsaXN0IGl0ZW1zIHNlbGVjdGVkIGJ5IHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9tb2RlbC9zZWxlY3Rpb25+U2VsZWN0aW9ufS5cblx0ICovIF9nZXRTZWxlY3RlZEl0ZW1zKCkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSBtb2RlbC5zY2hlbWE7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvblJhbmdlID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKTtcbiAgICAgICAgY29uc3Qgc3RhcnRFbGVtZW50ID0gc2VsZWN0aW9uUmFuZ2Uuc3RhcnQucGFyZW50O1xuICAgICAgICBjb25zdCBlbGVtZW50cyA9IFtdO1xuICAgICAgICBpZiAoc2NoZW1hLmNoZWNrQXR0cmlidXRlKHN0YXJ0RWxlbWVudCwgYXR0cmlidXRlS2V5KSkge1xuICAgICAgICAgICAgZWxlbWVudHMucHVzaChzdGFydEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBzZWxlY3Rpb25SYW5nZS5nZXRJdGVtcygpKXtcbiAgICAgICAgICAgIGlmIChzY2hlbWEuY2hlY2tBdHRyaWJ1dGUoaXRlbSwgYXR0cmlidXRlS2V5KSAmJiAhZWxlbWVudHMuaW5jbHVkZXMoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlbGVtZW50cztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEV4ZWN1dGVzIHRoZSBjb21tYW5kLlxuXHQgKlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5mb3JjZVZhbHVlIElmIHNldCwgaXQgd2lsbCBmb3JjZSB0aGUgY29tbWFuZCBiZWhhdmlvci4gSWYgYHRydWVgLCB0aGUgY29tbWFuZCB3aWxsIGFwcGx5XG5cdCAqIHRoZSBhdHRyaWJ1dGUuIE90aGVyd2lzZSwgdGhlIGNvbW1hbmQgd2lsbCByZW1vdmUgdGhlIGF0dHJpYnV0ZS4gSWYgbm90IHNldCwgdGhlIGNvbW1hbmQgd2lsbCBsb29rIGZvciBpdHMgY3VycmVudFxuXHQgKiB2YWx1ZSB0byBkZWNpZGUgd2hhdCBpdCBzaG91bGQgZG8uXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLmVkaXRvci5tb2RlbC5jaGFuZ2UoKHdyaXRlcik9PntcbiAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiB0aGlzLl9zZWxlY3RlZEVsZW1lbnRzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9wdGlvbnMuZm9yY2VWYWx1ZSA9PT0gdW5kZWZpbmVkID8gIXRoaXMudmFsdWUgOiBvcHRpb25zLmZvcmNlVmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlS2V5LCB0cnVlLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZUtleSwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBtb2RlbC10by12aWV3IGNvbnZlcnRlciBmb3IgdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudCBpbnNlcnRpb24uXG4gKlxuICogSXQgY29udmVydHMgdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudCB0byBhbiB1bm9yZGVyZWQgbGlzdCB3aXRoIGEge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IGNoZWNrYm94IGVsZW1lbnR9XG4gKiBhdCB0aGUgYmVnaW5uaW5nIG9mIGVhY2ggbGlzdCBpdGVtLiBJdCBhbHNvIG1lcmdlcyB0aGUgbGlzdCB3aXRoIHN1cnJvdW5kaW5nIGxpc3RzIChpZiBhdmFpbGFibGUpLlxuICpcbiAqIEl0IGlzIHVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9lZGl0aW5nY29udHJvbGxlcn5FZGl0aW5nQ29udHJvbGxlcn0uXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDppbnNlcnRcbiAqIEBwYXJhbSBtb2RlbCBNb2RlbCBpbnN0YW5jZS5cbiAqIEBwYXJhbSBvbkNoZWNrYm94Q2hlY2tlZCBDYWxsYmFjayBmdW5jdGlvbi5cbiAqIEByZXR1cm5zIFJldHVybnMgYSBjb252ZXJzaW9uIGNhbGxiYWNrLlxuICovIGZ1bmN0aW9uIG1vZGVsVmlld0luc2VydGlvbihtb2RlbCwgb25DaGVja2JveENoZWNrZWQpIHtcbiAgICByZXR1cm4gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgY29uc3VtYWJsZSA9IGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZTtcbiAgICAgICAgaWYgKCFjb25zdW1hYmxlLnRlc3QoZGF0YS5pdGVtLCAnaW5zZXJ0JykgfHwgIWNvbnN1bWFibGUudGVzdChkYXRhLml0ZW0sICdhdHRyaWJ1dGU6bGlzdFR5cGUnKSB8fCAhY29uc3VtYWJsZS50ZXN0KGRhdGEuaXRlbSwgJ2F0dHJpYnV0ZTpsaXN0SW5kZW50JykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS5pdGVtLmdldEF0dHJpYnV0ZSgnbGlzdFR5cGUnKSAhPSAndG9kbycpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb2RlbEl0ZW0gPSBkYXRhLml0ZW07XG4gICAgICAgIGNvbnN1bWFibGUuY29uc3VtZShtb2RlbEl0ZW0sICdpbnNlcnQnKTtcbiAgICAgICAgY29uc3VtYWJsZS5jb25zdW1lKG1vZGVsSXRlbSwgJ2F0dHJpYnV0ZTpsaXN0VHlwZScpO1xuICAgICAgICBjb25zdW1hYmxlLmNvbnN1bWUobW9kZWxJdGVtLCAnYXR0cmlidXRlOmxpc3RJbmRlbnQnKTtcbiAgICAgICAgY29uc3VtYWJsZS5jb25zdW1lKG1vZGVsSXRlbSwgJ2F0dHJpYnV0ZTp0b2RvTGlzdENoZWNrZWQnKTtcbiAgICAgICAgY29uc3Qgdmlld1dyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICBjb25zdCB2aWV3SXRlbSA9IGdlbmVyYXRlTGlJblVsKG1vZGVsSXRlbSwgY29udmVyc2lvbkFwaSk7XG4gICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9ICEhbW9kZWxJdGVtLmdldEF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJyk7XG4gICAgICAgIGNvbnN0IGNoZWNrbWFya0VsZW1lbnQgPSBjcmVhdGVDaGVja21hcmtFbGVtZW50KG1vZGVsSXRlbSwgdmlld1dyaXRlciwgaXNDaGVja2VkLCBvbkNoZWNrYm94Q2hlY2tlZCk7XG4gICAgICAgIGNvbnN0IHNwYW4gPSB2aWV3V3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICBjbGFzczogJ3RvZG8tbGlzdF9fbGFiZWxfX2Rlc2NyaXB0aW9uJ1xuICAgICAgICB9KTtcbiAgICAgICAgdmlld1dyaXRlci5hZGRDbGFzcygndG9kby1saXN0Jywgdmlld0l0ZW0ucGFyZW50KTtcbiAgICAgICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHZpZXdJdGVtLCAwKSwgY2hlY2ttYXJrRWxlbWVudCk7XG4gICAgICAgIHZpZXdXcml0ZXIuaW5zZXJ0KHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihjaGVja21hcmtFbGVtZW50KSwgc3Bhbik7XG4gICAgICAgIGluamVjdFZpZXdMaXN0KG1vZGVsSXRlbSwgdmlld0l0ZW0sIGNvbnZlcnNpb25BcGksIG1vZGVsKTtcbiAgICB9O1xufVxuLyoqXG4gKiBBIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGZvciB0aGUgYGxpc3RJdGVtYCBtb2RlbCBlbGVtZW50IGluc2VydGlvbi5cbiAqXG4gKiBJdCBpcyB1c2VkIGJ5IHtAbGluayBtb2R1bGU6ZW5naW5lL2NvbnRyb2xsZXIvZGF0YWNvbnRyb2xsZXJ+RGF0YUNvbnRyb2xsZXJ9LlxuICpcbiAqIEBzZWUgbW9kdWxlOmVuZ2luZS9jb252ZXJzaW9uL2Rvd25jYXN0ZGlzcGF0Y2hlcn5Eb3duY2FzdERpc3BhdGNoZXIjZXZlbnQ6aW5zZXJ0XG4gKiBAcGFyYW0gbW9kZWwgTW9kZWwgaW5zdGFuY2UuXG4gKiBAcmV0dXJucyBSZXR1cm5zIGEgY29udmVyc2lvbiBjYWxsYmFjay5cbiAqLyBmdW5jdGlvbiBkYXRhTW9kZWxWaWV3SW5zZXJ0aW9uKG1vZGVsKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IGNvbnN1bWFibGUgPSBjb252ZXJzaW9uQXBpLmNvbnN1bWFibGU7XG4gICAgICAgIGlmICghY29uc3VtYWJsZS50ZXN0KGRhdGEuaXRlbSwgJ2luc2VydCcpIHx8ICFjb25zdW1hYmxlLnRlc3QoZGF0YS5pdGVtLCAnYXR0cmlidXRlOmxpc3RUeXBlJykgfHwgIWNvbnN1bWFibGUudGVzdChkYXRhLml0ZW0sICdhdHRyaWJ1dGU6bGlzdEluZGVudCcpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgIT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kZWxJdGVtID0gZGF0YS5pdGVtO1xuICAgICAgICBjb25zdW1hYmxlLmNvbnN1bWUobW9kZWxJdGVtLCAnaW5zZXJ0Jyk7XG4gICAgICAgIGNvbnN1bWFibGUuY29uc3VtZShtb2RlbEl0ZW0sICdhdHRyaWJ1dGU6bGlzdFR5cGUnKTtcbiAgICAgICAgY29uc3VtYWJsZS5jb25zdW1lKG1vZGVsSXRlbSwgJ2F0dHJpYnV0ZTpsaXN0SW5kZW50Jyk7XG4gICAgICAgIGNvbnN1bWFibGUuY29uc3VtZShtb2RlbEl0ZW0sICdhdHRyaWJ1dGU6dG9kb0xpc3RDaGVja2VkJyk7XG4gICAgICAgIGNvbnN0IHZpZXdXcml0ZXIgPSBjb252ZXJzaW9uQXBpLndyaXRlcjtcbiAgICAgICAgY29uc3Qgdmlld0l0ZW0gPSBnZW5lcmF0ZUxpSW5VbChtb2RlbEl0ZW0sIGNvbnZlcnNpb25BcGkpO1xuICAgICAgICB2aWV3V3JpdGVyLmFkZENsYXNzKCd0b2RvLWxpc3QnLCB2aWV3SXRlbS5wYXJlbnQpO1xuICAgICAgICBjb25zdCBsYWJlbCA9IHZpZXdXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCgnbGFiZWwnLCB7XG4gICAgICAgICAgICBjbGFzczogJ3RvZG8tbGlzdF9fbGFiZWwnXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjaGVja2JveCA9IHZpZXdXcml0ZXIuY3JlYXRlRW1wdHlFbGVtZW50KCdpbnB1dCcsIHtcbiAgICAgICAgICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgICAgICAgICBkaXNhYmxlZDogJ2Rpc2FibGVkJ1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc3BhbiA9IHZpZXdXcml0ZXIuY3JlYXRlQ29udGFpbmVyRWxlbWVudCgnc3BhbicsIHtcbiAgICAgICAgICAgIGNsYXNzOiAndG9kby1saXN0X19sYWJlbF9fZGVzY3JpcHRpb24nXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobW9kZWxJdGVtLmdldEF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJykpIHtcbiAgICAgICAgICAgIHZpZXdXcml0ZXIuc2V0QXR0cmlidXRlKCdjaGVja2VkJywgJ2NoZWNrZWQnLCBjaGVja2JveCk7XG4gICAgICAgIH1cbiAgICAgICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHZpZXdJdGVtLCAwKSwgbGFiZWwpO1xuICAgICAgICB2aWV3V3JpdGVyLmluc2VydCh2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQobGFiZWwsIDApLCBjaGVja2JveCk7XG4gICAgICAgIHZpZXdXcml0ZXIuaW5zZXJ0KHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25BZnRlcihjaGVja2JveCksIHNwYW4pO1xuICAgICAgICBpbmplY3RWaWV3TGlzdChtb2RlbEl0ZW0sIHZpZXdJdGVtLCBjb252ZXJzaW9uQXBpLCBtb2RlbCk7XG4gICAgfTtcbn1cbi8qKlxuICogQSB2aWV3LXRvLW1vZGVsIGNvbnZlcnRlciBmb3IgdGhlIGNoZWNrYm94IGVsZW1lbnQgaW5zaWRlIGEgdmlldyBsaXN0IGl0ZW0uXG4gKlxuICogSXQgY2hhbmdlcyB0aGUgYGxpc3RUeXBlYCBvZiB0aGUgbW9kZWwgYGxpc3RJdGVtYCB0byBhIGB0b2RvYCB2YWx1ZS5cbiAqIFdoZW4gYSB2aWV3IGNoZWNrYm94IGVsZW1lbnQgaXMgbWFya2VkIGFzIGNoZWNrZWQsIGFuIGFkZGl0aW9uYWwgYHRvZG9MaXN0Q2hlY2tlZD1cInRydWVcImAgYXR0cmlidXRlIGlzIGFkZGVkIHRvIHRoZSBtb2RlbCBpdGVtLlxuICpcbiAqIEl0IGlzIHVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9kYXRhY29udHJvbGxlcn5EYXRhQ29udHJvbGxlcn0uXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vdXBjYXN0ZGlzcGF0Y2hlcn5VcGNhc3REaXNwYXRjaGVyI2V2ZW50OmVsZW1lbnRcbiAqLyBjb25zdCBkYXRhVmlld01vZGVsQ2hlY2ttYXJrSW5zZXJ0aW9uID0gKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICBjb25zdCBtb2RlbEN1cnNvciA9IGRhdGEubW9kZWxDdXJzb3I7XG4gICAgY29uc3QgbW9kZWxJdGVtID0gbW9kZWxDdXJzb3IucGFyZW50O1xuICAgIGNvbnN0IHZpZXdJdGVtID0gZGF0YS52aWV3SXRlbTtcbiAgICBpZiAodmlld0l0ZW0uZ2V0QXR0cmlidXRlKCd0eXBlJykgIT0gJ2NoZWNrYm94JyB8fCBtb2RlbEl0ZW0ubmFtZSAhPSAnbGlzdEl0ZW0nIHx8ICFtb2RlbEN1cnNvci5pc0F0U3RhcnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKHZpZXdJdGVtLCB7XG4gICAgICAgIG5hbWU6IHRydWVcbiAgICB9KSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHdyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJywgJ3RvZG8nLCBtb2RlbEl0ZW0pO1xuICAgIGlmIChkYXRhLnZpZXdJdGVtLmhhc0F0dHJpYnV0ZSgnY2hlY2tlZCcpKSB7XG4gICAgICAgIHdyaXRlci5zZXRBdHRyaWJ1dGUoJ3RvZG9MaXN0Q2hlY2tlZCcsIHRydWUsIG1vZGVsSXRlbSk7XG4gICAgfVxuICAgIGRhdGEubW9kZWxSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZShtb2RlbEN1cnNvcik7XG59O1xuLyoqXG4gKiBBIG1vZGVsLXRvLXZpZXcgY29udmVydGVyIGZvciB0aGUgYGxpc3RUeXBlYCBhdHRyaWJ1dGUgY2hhbmdlIG9uIHRoZSBgbGlzdEl0ZW1gIG1vZGVsIGVsZW1lbnQuXG4gKlxuICogVGhpcyBjaGFuZ2UgbWVhbnMgdGhhdCB0aGUgYDxsaT5gIGVsZW1lbnQgcGFyZW50IGNoYW5nZXMgdG8gYDx1bCBjbGFzcz1cInRvZG8tbGlzdFwiPmAgYW5kIGFcbiAqIHtAbGluayBtb2R1bGU6ZW5naW5lL3ZpZXcvdWllbGVtZW50flVJRWxlbWVudCBjaGVja2JveCBVSSBlbGVtZW50fSBpcyBhZGRlZCBhdCB0aGUgYmVnaW5uaW5nXG4gKiBvZiB0aGUgbGlzdCBpdGVtIGVsZW1lbnQgKG9yIHZpY2UgdmVyc2EpLlxuICpcbiAqIFRoaXMgY29udmVydGVyIGlzIHByZWNlZGVkIGJ5IHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3lsaXN0L2xlZ2FjeWNvbnZlcnRlcnN+bW9kZWxWaWV3Q2hhbmdlVHlwZX0gYW5kIGZvbGxvd2VkIGJ5XG4gKiB7QGxpbmsgbW9kdWxlOmxpc3QvbGVnYWN5bGlzdC9sZWdhY3ljb252ZXJ0ZXJzfm1vZGVsVmlld01lcmdlQWZ0ZXJDaGFuZ2VUeXBlfSB0byBoYW5kbGUgc3BsaXR0aW5nIGFuZCBtZXJnaW5nIHN1cnJvdW5kaW5nIGxpc3RzXG4gKiBvZiB0aGUgc2FtZSB0eXBlLlxuICpcbiAqIEl0IGlzIHVzZWQgYnkge0BsaW5rIG1vZHVsZTplbmdpbmUvY29udHJvbGxlci9lZGl0aW5nY29udHJvbGxlcn5FZGl0aW5nQ29udHJvbGxlcn0uXG4gKlxuICogQHNlZSBtb2R1bGU6ZW5naW5lL2NvbnZlcnNpb24vZG93bmNhc3RkaXNwYXRjaGVyfkRvd25jYXN0RGlzcGF0Y2hlciNldmVudDphdHRyaWJ1dGVcbiAqIEBwYXJhbSBvbkNoZWNrZWRDaGFuZ2UgQ2FsbGJhY2sgZmlyZWQgYWZ0ZXIgY2xpY2tpbmcgdGhlIGNoZWNrYm94IFVJIGVsZW1lbnQuXG4gKiBAcGFyYW0gdmlldyBFZGl0aW5nIHZpZXcgY29udHJvbGxlci5cbiAqIEByZXR1cm5zIFJldHVybnMgYSBjb252ZXJzaW9uIGNhbGxiYWNrLlxuICovIGZ1bmN0aW9uIG1vZGVsVmlld0NoYW5nZVR5cGUob25DaGVja2VkQ2hhbmdlLCB2aWV3KSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5jb25zdW1hYmxlLmNvbnN1bWUoZGF0YS5pdGVtLCBldnQubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2aWV3SXRlbSA9IGNvbnZlcnNpb25BcGkubWFwcGVyLnRvVmlld0VsZW1lbnQoZGF0YS5pdGVtKTtcbiAgICAgICAgY29uc3Qgdmlld1dyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICBjb25zdCBsYWJlbEVsZW1lbnQgPSBmaW5kTGFiZWwodmlld0l0ZW0sIHZpZXcpO1xuICAgICAgICBpZiAoZGF0YS5hdHRyaWJ1dGVOZXdWYWx1ZSA9PSAndG9kbycpIHtcbiAgICAgICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9ICEhZGF0YS5pdGVtLmdldEF0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJyk7XG4gICAgICAgICAgICBjb25zdCBjaGVja21hcmtFbGVtZW50ID0gY3JlYXRlQ2hlY2ttYXJrRWxlbWVudChkYXRhLml0ZW0sIHZpZXdXcml0ZXIsIGlzQ2hlY2tlZCwgb25DaGVja2VkQ2hhbmdlKTtcbiAgICAgICAgICAgIGNvbnN0IHNwYW4gPSB2aWV3V3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoJ3NwYW4nLCB7XG4gICAgICAgICAgICAgICAgY2xhc3M6ICd0b2RvLWxpc3RfX2xhYmVsX19kZXNjcmlwdGlvbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgaXRlbVJhbmdlID0gdmlld1dyaXRlci5jcmVhdGVSYW5nZUluKHZpZXdJdGVtKTtcbiAgICAgICAgICAgIGNvbnN0IG5lc3RlZExpc3QgPSBmaW5kTmVzdGVkTGlzdCh2aWV3SXRlbSk7XG4gICAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvblN0YXJ0ID0gcG9zaXRpb25BZnRlclVpRWxlbWVudHMoaXRlbVJhbmdlLnN0YXJ0KTtcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uRW5kID0gbmVzdGVkTGlzdCA/IHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUobmVzdGVkTGlzdCkgOiBpdGVtUmFuZ2UuZW5kO1xuICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRpb25SYW5nZSA9IHZpZXdXcml0ZXIuY3JlYXRlUmFuZ2UoZGVzY3JpcHRpb25TdGFydCwgZGVzY3JpcHRpb25FbmQpO1xuICAgICAgICAgICAgdmlld1dyaXRlci5hZGRDbGFzcygndG9kby1saXN0Jywgdmlld0l0ZW0ucGFyZW50KTtcbiAgICAgICAgICAgIHZpZXdXcml0ZXIubW92ZShkZXNjcmlwdGlvblJhbmdlLCB2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQXQoc3BhbiwgMCkpO1xuICAgICAgICAgICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkF0KHZpZXdJdGVtLCAwKSwgY2hlY2ttYXJrRWxlbWVudCk7XG4gICAgICAgICAgICB2aWV3V3JpdGVyLmluc2VydCh2aWV3V3JpdGVyLmNyZWF0ZVBvc2l0aW9uQWZ0ZXIoY2hlY2ttYXJrRWxlbWVudCksIHNwYW4pO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuYXR0cmlidXRlT2xkVmFsdWUgPT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICBjb25zdCBkZXNjcmlwdGlvblNwYW4gPSBmaW5kRGVzY3JpcHRpb24odmlld0l0ZW0sIHZpZXcpO1xuICAgICAgICAgICAgdmlld1dyaXRlci5yZW1vdmVDbGFzcygndG9kby1saXN0Jywgdmlld0l0ZW0ucGFyZW50KTtcbiAgICAgICAgICAgIHZpZXdXcml0ZXIucmVtb3ZlKGxhYmVsRWxlbWVudCk7XG4gICAgICAgICAgICB2aWV3V3JpdGVyLm1vdmUodmlld1dyaXRlci5jcmVhdGVSYW5nZUluKGRlc2NyaXB0aW9uU3BhbiksIHZpZXdXcml0ZXIuY3JlYXRlUG9zaXRpb25CZWZvcmUoZGVzY3JpcHRpb25TcGFuKSk7XG4gICAgICAgICAgICB2aWV3V3JpdGVyLnJlbW92ZShkZXNjcmlwdGlvblNwYW4pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogQSBtb2RlbC10by12aWV3IGNvbnZlcnRlciBmb3IgdGhlIGB0b2RvTGlzdENoZWNrZWRgIGF0dHJpYnV0ZSBjaGFuZ2Ugb24gdGhlIGBsaXN0SXRlbWAgbW9kZWwgZWxlbWVudC5cbiAqXG4gKiBJdCBtYXJrcyB0aGUge0BsaW5rIG1vZHVsZTplbmdpbmUvdmlldy91aWVsZW1lbnR+VUlFbGVtZW50IGNoZWNrYm94IFVJIGVsZW1lbnR9IGFzIGNoZWNrZWQuXG4gKlxuICogSXQgaXMgdXNlZCBieSB7QGxpbmsgbW9kdWxlOmVuZ2luZS9jb250cm9sbGVyL2VkaXRpbmdjb250cm9sbGVyfkVkaXRpbmdDb250cm9sbGVyfS5cbiAqXG4gKiBAc2VlIG1vZHVsZTplbmdpbmUvY29udmVyc2lvbi9kb3duY2FzdGRpc3BhdGNoZXJ+RG93bmNhc3REaXNwYXRjaGVyI2V2ZW50OmF0dHJpYnV0ZVxuICogQHBhcmFtIG9uQ2hlY2tlZENoYW5nZSBDYWxsYmFjayBmaXJlZCBhZnRlciBjbGlja2luZyB0aGUgY2hlY2tib3ggVUkgZWxlbWVudC5cbiAqIEByZXR1cm5zIFJldHVybnMgYSBjb252ZXJzaW9uIGNhbGxiYWNrLlxuICovIGZ1bmN0aW9uIG1vZGVsVmlld0NoYW5nZUNoZWNrZWQob25DaGVja2VkQ2hhbmdlKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIC8vIERvIG5vdCBjb252ZXJ0IGB0b2RvTGlzdENoZWNrZWRgIGF0dHJpYnV0ZSB3aGVuIHRvLWRvIGxpc3QgaXRlbSBoYXMgY2hhbmdlZCB0byBvdGhlciBsaXN0IGl0ZW0uXG4gICAgICAgIC8vIFRoaXMgYXR0cmlidXRlIHdpbGwgYmUgcmVtb3ZlZCBieSB0aGUgbW9kZWwgcG9zdCBmaXhlci5cbiAgICAgICAgaWYgKGRhdGEuaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgIT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb252ZXJzaW9uQXBpLmNvbnN1bWFibGUuY29uc3VtZShkYXRhLml0ZW0sICdhdHRyaWJ1dGU6dG9kb0xpc3RDaGVja2VkJykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IG1hcHBlciwgd3JpdGVyOiB2aWV3V3JpdGVyIH0gPSBjb252ZXJzaW9uQXBpO1xuICAgICAgICBjb25zdCBpc0NoZWNrZWQgPSAhIWRhdGEuaXRlbS5nZXRBdHRyaWJ1dGUoJ3RvZG9MaXN0Q2hlY2tlZCcpO1xuICAgICAgICBjb25zdCB2aWV3SXRlbSA9IG1hcHBlci50b1ZpZXdFbGVtZW50KGRhdGEuaXRlbSk7XG4gICAgICAgIC8vIEJlY2F1c2Ugb2YgbSAtPiB2IHBvc2l0aW9uIG1hcHBlciB3ZSBjYW4gYmUgc3VyZSBjaGVja2JveCBpcyBhbHdheXMgYXQgdGhlIGJlZ2lubmluZy5cbiAgICAgICAgY29uc3Qgb2xkQ2hlY2ttYXJrRWxlbWVudCA9IHZpZXdJdGVtLmdldENoaWxkKDApO1xuICAgICAgICBjb25zdCBuZXdDaGVja21hcmtFbGVtZW50ID0gY3JlYXRlQ2hlY2ttYXJrRWxlbWVudChkYXRhLml0ZW0sIHZpZXdXcml0ZXIsIGlzQ2hlY2tlZCwgb25DaGVja2VkQ2hhbmdlKTtcbiAgICAgICAgdmlld1dyaXRlci5pbnNlcnQodmlld1dyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKG9sZENoZWNrbWFya0VsZW1lbnQpLCBuZXdDaGVja21hcmtFbGVtZW50KTtcbiAgICAgICAgdmlld1dyaXRlci5yZW1vdmUob2xkQ2hlY2ttYXJrRWxlbWVudCk7XG4gICAgfTtcbn1cbi8qKlxuICogQSBtb2RlbC10by12aWV3IHBvc2l0aW9uIGF0IHplcm8gb2Zmc2V0IG1hcHBlci5cbiAqXG4gKiBUaGlzIGhlbHBlciBlbnN1cmVzIHRoYXQgcG9zaXRpb24gaW5zaWRlIHRvZG8tbGlzdCBpbiB0aGUgdmlldyBpcyBtYXBwZWQgYWZ0ZXIgdGhlIGNoZWNrYm94LlxuICpcbiAqIEl0IG9ubHkgaGFuZGxlcyB0aGUgcG9zaXRpb24gYXQgdGhlIGJlZ2lubmluZyBvZiBhIGxpc3QgaXRlbSBhcyBvdGhlciBwb3NpdGlvbnMgYXJlIHByb3Blcmx5IG1hcHBlZCBiZSB0aGUgZGVmYXVsdCBtYXBwZXIuXG4gKi8gZnVuY3Rpb24gbWFwTW9kZWxUb1ZpZXdQb3NpdGlvbih2aWV3KSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEpPT57XG4gICAgICAgIGNvbnN0IG1vZGVsUG9zaXRpb24gPSBkYXRhLm1vZGVsUG9zaXRpb247XG4gICAgICAgIGNvbnN0IHBhcmVudCA9IG1vZGVsUG9zaXRpb24ucGFyZW50O1xuICAgICAgICBpZiAoIXBhcmVudC5pcygnZWxlbWVudCcsICdsaXN0SXRlbScpIHx8IHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgIT0gJ3RvZG8nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgdmlld0xpID0gZGF0YS5tYXBwZXIudG9WaWV3RWxlbWVudChwYXJlbnQpO1xuICAgICAgICBjb25zdCBkZXNjU3BhbiA9IGZpbmREZXNjcmlwdGlvbih2aWV3TGksIHZpZXcpO1xuICAgICAgICBpZiAoZGVzY1NwYW4pIHtcbiAgICAgICAgICAgIGRhdGEudmlld1Bvc2l0aW9uID0gZGF0YS5tYXBwZXIuZmluZFBvc2l0aW9uSW4oZGVzY1NwYW4sIG1vZGVsUG9zaXRpb24ub2Zmc2V0KTtcbiAgICAgICAgfVxuICAgIH07XG59XG4vKipcbiAqIENyZWF0ZXMgYSBjaGVja2JveCBVSSBlbGVtZW50LlxuICovIGZ1bmN0aW9uIGNyZWF0ZUNoZWNrbWFya0VsZW1lbnQobW9kZWxJdGVtLCB2aWV3V3JpdGVyLCBpc0NoZWNrZWQsIG9uQ2hhbmdlKSB7XG4gICAgY29uc3QgdWlFbGVtZW50ID0gdmlld1dyaXRlci5jcmVhdGVVSUVsZW1lbnQoJ2xhYmVsJywge1xuICAgICAgICBjbGFzczogJ3RvZG8tbGlzdF9fbGFiZWwnLFxuICAgICAgICBjb250ZW50ZWRpdGFibGU6IGZhbHNlXG4gICAgfSwgZnVuY3Rpb24oZG9tRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3QgY2hlY2tib3ggPSBjcmVhdGVFbGVtZW50KGRvY3VtZW50LCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAnY2hlY2tib3gnLFxuICAgICAgICAgICAgdGFiaW5kZXg6ICctMSdcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc0NoZWNrZWQpIHtcbiAgICAgICAgICAgIGNoZWNrYm94LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gICAgICAgIH1cbiAgICAgICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCk9Pm9uQ2hhbmdlKG1vZGVsSXRlbSkpO1xuICAgICAgICBjb25zdCBkb21FbGVtZW50ID0gdGhpcy50b0RvbUVsZW1lbnQoZG9tRG9jdW1lbnQpO1xuICAgICAgICBkb21FbGVtZW50LmFwcGVuZENoaWxkKGNoZWNrYm94KTtcbiAgICAgICAgcmV0dXJuIGRvbUVsZW1lbnQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIHVpRWxlbWVudDtcbn1cbi8vIEhlbHBlciBtZXRob2QgdG8gZmluZCBsYWJlbCBlbGVtZW50IGluc2lkZSBsaS5cbmZ1bmN0aW9uIGZpbmRMYWJlbCh2aWV3SXRlbSwgdmlldykge1xuICAgIGNvbnN0IHJhbmdlID0gdmlldy5jcmVhdGVSYW5nZUluKHZpZXdJdGVtKTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlKXtcbiAgICAgICAgaWYgKHZhbHVlLml0ZW0uaXMoJ3VpRWxlbWVudCcsICdsYWJlbCcpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUuaXRlbTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGZpbmREZXNjcmlwdGlvbih2aWV3SXRlbSwgdmlldykge1xuICAgIGNvbnN0IHJhbmdlID0gdmlldy5jcmVhdGVSYW5nZUluKHZpZXdJdGVtKTtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJhbmdlKXtcbiAgICAgICAgaWYgKHZhbHVlLml0ZW0uaXMoJ2NvbnRhaW5lckVsZW1lbnQnLCAnc3BhbicpICYmIHZhbHVlLml0ZW0uaGFzQ2xhc3MoJ3RvZG8tbGlzdF9fbGFiZWxfX2Rlc2NyaXB0aW9uJykpIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5pdGVtO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jb25zdCBJVEVNX1RPR0dMRV9LRVlTVFJPS0UgPSAvKiAjX19QVVJFX18gKi8gcGFyc2VLZXlzdHJva2UoJ0N0cmwrRW50ZXInKTtcbi8qKlxuICogVGhlIGVuZ2luZSBvZiB0aGUgdG8tZG8gbGlzdCBmZWF0dXJlLiBJdCBoYW5kbGVzIGNyZWF0aW5nLCBlZGl0aW5nIGFuZCByZW1vdmluZyB0by1kbyBsaXN0cyBhbmQgdGhlaXIgaXRlbXMuXG4gKlxuICogSXQgcmVnaXN0ZXJzIHRoZSBlbnRpcmUgZnVuY3Rpb25hbGl0eSBvZiB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L2xlZ2FjeWxpc3QvbGVnYWN5bGlzdGVkaXRpbmd+TGVnYWN5TGlzdEVkaXRpbmcgbGVnYWN5IGxpc3QgZWRpdGluZ1xuICogcGx1Z2lufSBhbmQgZXh0ZW5kcyBpdCB3aXRoIHRoZSBjb21tYW5kczpcbiAqXG4gKiAtIGAndG9kb0xpc3QnYCxcbiAqIC0gYCdjaGVja1RvZG9MaXN0J2AsXG4gKiAtIGAndG9kb0xpc3RDaGVjaydgIGFzIGFuIGFsaWFzIGZvciBgY2hlY2tUb2RvTGlzdGAgY29tbWFuZC5cbiAqLyBjbGFzcyBMZWdhY3lUb2RvTGlzdEVkaXRpbmcgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xlZ2FjeVRvZG9MaXN0RWRpdGluZyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHJlcXVpcmVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgTGVnYWN5TGlzdEVkaXRpbmdcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBpbml0KCkge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgeyBlZGl0aW5nLCBkYXRhLCBtb2RlbCB9ID0gZWRpdG9yO1xuICAgICAgICAvLyBFeHRlbmQgc2NoZW1hLlxuICAgICAgICBtb2RlbC5zY2hlbWEuZXh0ZW5kKCdsaXN0SXRlbScsIHtcbiAgICAgICAgICAgIGFsbG93QXR0cmlidXRlczogW1xuICAgICAgICAgICAgICAgICd0b2RvTGlzdENoZWNrZWQnXG4gICAgICAgICAgICBdXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBEaXNhbGxvdyB0b2RvTGlzdENoZWNrZWQgYXR0cmlidXRlIG9uIG90aGVyIG5vZGVzIHRoYW4gbGlzdEl0ZW0gd2l0aCB0by1kbyBsaXN0VHlwZS5cbiAgICAgICAgbW9kZWwuc2NoZW1hLmFkZEF0dHJpYnV0ZUNoZWNrKChjb250ZXh0LCBhdHRyaWJ1dGVOYW1lKT0+e1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGNvbnRleHQubGFzdDtcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lID09ICd0b2RvTGlzdENoZWNrZWQnICYmIGl0ZW0ubmFtZSA9PSAnbGlzdEl0ZW0nICYmIGl0ZW0uZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpICE9ICd0b2RvJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlZ2lzdGVyIGB0b2RvTGlzdGAgY29tbWFuZC5cbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgndG9kb0xpc3QnLCBuZXcgTGVnYWN5TGlzdENvbW1hbmQoZWRpdG9yLCAndG9kbycpKTtcbiAgICAgICAgY29uc3QgY2hlY2tUb2RvTGlzdENvbW1hbmQgPSBuZXcgTGVnYWN5Q2hlY2tUb2RvTGlzdENvbW1hbmQoZWRpdG9yKTtcbiAgICAgICAgLy8gUmVnaXN0ZXIgYGNoZWNrVG9kb0xpc3RgIGNvbW1hbmQgYW5kIGFkZCBgdG9kb0xpc3RDaGVja2AgY29tbWFuZCBhcyBhbiBhbGlhcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS5cbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgnY2hlY2tUb2RvTGlzdCcsIGNoZWNrVG9kb0xpc3RDb21tYW5kKTtcbiAgICAgICAgZWRpdG9yLmNvbW1hbmRzLmFkZCgndG9kb0xpc3RDaGVjaycsIGNoZWNrVG9kb0xpc3RDb21tYW5kKTtcbiAgICAgICAgLy8gRGVmaW5lIGNvbnZlcnRlcnMuXG4gICAgICAgIGRhdGEuZG93bmNhc3REaXNwYXRjaGVyLm9uKCdpbnNlcnQ6bGlzdEl0ZW0nLCBkYXRhTW9kZWxWaWV3SW5zZXJ0aW9uKG1vZGVsKSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgZGF0YS51cGNhc3REaXNwYXRjaGVyLm9uKCdlbGVtZW50OmlucHV0JywgZGF0YVZpZXdNb2RlbENoZWNrbWFya0luc2VydGlvbiwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgZWRpdGluZy5kb3duY2FzdERpc3BhdGNoZXIub24oJ2luc2VydDpsaXN0SXRlbScsIG1vZGVsVmlld0luc2VydGlvbihtb2RlbCwgKGxpc3RJdGVtKT0+dGhpcy5faGFuZGxlQ2hlY2ttYXJrQ2hhbmdlKGxpc3RJdGVtKSksIHtcbiAgICAgICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRpbmcuZG93bmNhc3REaXNwYXRjaGVyLm9uKCdhdHRyaWJ1dGU6bGlzdFR5cGU6bGlzdEl0ZW0nLCBtb2RlbFZpZXdDaGFuZ2VUeXBlKChsaXN0SXRlbSk9PnRoaXMuX2hhbmRsZUNoZWNrbWFya0NoYW5nZShsaXN0SXRlbSksIGVkaXRpbmcudmlldykpO1xuICAgICAgICBlZGl0aW5nLmRvd25jYXN0RGlzcGF0Y2hlci5vbignYXR0cmlidXRlOnRvZG9MaXN0Q2hlY2tlZDpsaXN0SXRlbScsIG1vZGVsVmlld0NoYW5nZUNoZWNrZWQoKGxpc3RJdGVtKT0+dGhpcy5faGFuZGxlQ2hlY2ttYXJrQ2hhbmdlKGxpc3RJdGVtKSkpO1xuICAgICAgICBlZGl0aW5nLm1hcHBlci5vbignbW9kZWxUb1ZpZXdQb3NpdGlvbicsIG1hcE1vZGVsVG9WaWV3UG9zaXRpb24oZWRpdGluZy52aWV3KSk7XG4gICAgICAgIGRhdGEubWFwcGVyLm9uKCdtb2RlbFRvVmlld1Bvc2l0aW9uJywgbWFwTW9kZWxUb1ZpZXdQb3NpdGlvbihlZGl0aW5nLnZpZXcpKTtcbiAgICAgICAgLy8gSnVtcCBhdCB0aGUgZW5kIG9mIHRoZSBwcmV2aW91cyBub2RlIG9uIGxlZnQgYXJyb3cga2V5IHByZXNzLCB3aGVuIHNlbGVjdGlvbiBpcyBhZnRlciB0aGUgY2hlY2tib3guXG4gICAgICAgIC8vXG4gICAgICAgIC8vIDxibG9ja3F1b3RlPjxwPkZvbzwvcD48L2Jsb2NrcXVvdGU+XG4gICAgICAgIC8vIDx1bD48bGk+PGNoZWNrYm94Lz57fUJhcjwvbGk+PC91bD5cbiAgICAgICAgLy9cbiAgICAgICAgLy8gcHJlc3M6IGA8LWBcbiAgICAgICAgLy9cbiAgICAgICAgLy8gPGJsb2NrcXVvdGU+PHA+Rm9ve308L3A+PC9ibG9ja3F1b3RlPlxuICAgICAgICAvLyA8dWw+PGxpPjxjaGVja2JveC8+QmFyPC9saT48L3VsPlxuICAgICAgICAvL1xuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRpbmcudmlldy5kb2N1bWVudCwgJ2Fycm93S2V5JywganVtcE92ZXJDaGVja21hcmtPblNpZGVBcnJvd0tleVByZXNzKG1vZGVsLCBlZGl0b3IubG9jYWxlKSwge1xuICAgICAgICAgICAgY29udGV4dDogJ2xpJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVG9nZ2xlIGNoZWNrIHN0YXRlIG9mIHNlbGVjdGVkIHRvLWRvIGxpc3QgaXRlbXMgb24ga2V5c3Ryb2tlLlxuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRpbmcudmlldy5kb2N1bWVudCwgJ2tleWRvd24nLCAoZXZ0LCBkYXRhKT0+e1xuICAgICAgICAgICAgaWYgKGdldENvZGUoZGF0YSkgPT09IElURU1fVE9HR0xFX0tFWVNUUk9LRSkge1xuICAgICAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdjaGVja1RvZG9MaXN0Jyk7XG4gICAgICAgICAgICAgICAgZXZ0LnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVtb3ZlIGB0b2RvTGlzdENoZWNrZWRgIGF0dHJpYnV0ZSB3aGVuIGEgaG9zdCBlbGVtZW50IGlzIG5vIGxvbmdlciBhIHRvLWRvIGxpc3QgaXRlbS5cbiAgICAgICAgY29uc3QgbGlzdEl0ZW1zVG9GaXggPSBuZXcgU2V0KCk7XG4gICAgICAgIHRoaXMubGlzdGVuVG8obW9kZWwsICdhcHBseU9wZXJhdGlvbicsIChldnQsIGFyZ3MpPT57XG4gICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBhcmdzWzBdO1xuICAgICAgICAgICAgaWYgKG9wZXJhdGlvbi50eXBlID09ICdyZW5hbWUnICYmIG9wZXJhdGlvbi5vbGROYW1lID09ICdsaXN0SXRlbScpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gb3BlcmF0aW9uLnBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5oYXNBdHRyaWJ1dGUoJ3RvZG9MaXN0Q2hlY2tlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RJdGVtc1RvRml4LmFkZChpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdGlvbi50eXBlID09ICdjaGFuZ2VBdHRyaWJ1dGUnICYmIG9wZXJhdGlvbi5rZXkgPT0gJ2xpc3RUeXBlJyAmJiBvcGVyYXRpb24ub2xkVmFsdWUgPT09ICd0b2RvJykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBvcGVyYXRpb24ucmFuZ2UuZ2V0SXRlbXMoKSl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmhhc0F0dHJpYnV0ZSgndG9kb0xpc3RDaGVja2VkJykgJiYgaXRlbS5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgIT09ICd0b2RvJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdEl0ZW1zVG9GaXguYWRkKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbW9kZWwuZG9jdW1lbnQucmVnaXN0ZXJQb3N0Rml4ZXIoKHdyaXRlcik9PntcbiAgICAgICAgICAgIGxldCBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RJdGVtIG9mIGxpc3RJdGVtc1RvRml4KXtcbiAgICAgICAgICAgICAgICB3cml0ZXIucmVtb3ZlQXR0cmlidXRlKCd0b2RvTGlzdENoZWNrZWQnLCBsaXN0SXRlbSk7XG4gICAgICAgICAgICAgICAgaGFzQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0SXRlbXNUb0ZpeC5jbGVhcigpO1xuICAgICAgICAgICAgcmV0dXJuIGhhc0NoYW5nZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9pbml0QXJpYUFubm91bmNlbWVudHMoKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEhhbmRsZXMgdGhlIGNoZWNrYm94IGVsZW1lbnQgY2hhbmdlLCBtb3ZlcyB0aGUgc2VsZWN0aW9uIHRvIHRoZSBjb3JyZXNwb25kaW5nIG1vZGVsIGl0ZW0gdG8gbWFrZSBpdCBwb3NzaWJsZVxuXHQgKiB0byB0b2dnbGUgdGhlIGB0b2RvTGlzdENoZWNrZWRgIGF0dHJpYnV0ZSB1c2luZyB0aGUgY29tbWFuZCwgYW5kIHJlc3RvcmVzIHRoZSBzZWxlY3Rpb24gcG9zaXRpb24uXG5cdCAqXG5cdCAqIFNvbWUgc2F5IGl0J3MgYSBoYWNrIDopIE1vdmluZyB0aGUgc2VsZWN0aW9uIG9ubHkgZm9yIGV4ZWN1dGluZyB0aGUgY29tbWFuZCBvbiBhIGNlcnRhaW4gbm9kZSBhbmQgcmVzdG9yaW5nIGl0IGFmdGVyLFxuXHQgKiBpcyBub3QgYSBjbGVhciBzb2x1dGlvbi4gV2UgbmVlZCB0byBkZXNpZ24gYW4gQVBJIGZvciB1c2luZyBjb21tYW5kcyBiZXlvbmQgdGhlIHNlbGVjdGlvbiByYW5nZS5cblx0ICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzE5NTQuXG5cdCAqLyBfaGFuZGxlQ2hlY2ttYXJrQ2hhbmdlKGxpc3RJdGVtKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgcHJldmlvdXNTZWxlY3Rpb25SYW5nZXMgPSBBcnJheS5mcm9tKG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5nZXRSYW5nZXMoKSk7XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgd3JpdGVyLnNldFNlbGVjdGlvbihsaXN0SXRlbSwgJ2VuZCcpO1xuICAgICAgICAgICAgZWRpdG9yLmV4ZWN1dGUoJ2NoZWNrVG9kb0xpc3QnKTtcbiAgICAgICAgICAgIHdyaXRlci5zZXRTZWxlY3Rpb24ocHJldmlvdXNTZWxlY3Rpb25SYW5nZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE9ic2VydmUgd2hlbiB1c2VyIGVudGVycyBvciBsZWF2ZXMgdG9kbyBsaXN0IGFuZCBzZXQgcHJvcGVyIGFyaWEgdmFsdWUgaW4gZ2xvYmFsIGxpdmUgYW5ub3VuY2VyLlxuXHQgKiBUaGlzIGFsbG93cyBzY3JlZW4gcmVhZGVycyB0byBpbmRpY2F0ZSB3aGVuIHRoZSB1c2VyIGhhcyBlbnRlcmVkIGFuZCBsZWZ0IHRoZSBzcGVjaWZpZWQgdG9kbyBsaXN0LlxuXHQgKlxuXHQgKiBAaW50ZXJuYWxcblx0ICovIF9pbml0QXJpYUFubm91bmNlbWVudHMoKSB7XG4gICAgICAgIGNvbnN0IHsgbW9kZWwsIHVpLCB0IH0gPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgbGV0IGxhc3RGb2N1c2VkQ29kZUJsb2NrID0gbnVsbDtcbiAgICAgICAgaWYgKCF1aSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5vbignY2hhbmdlOnJhbmdlJywgKCk9PntcbiAgICAgICAgICAgIGNvbnN0IGZvY3VzUGFyZW50ID0gbW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uLmZvY3VzLnBhcmVudDtcbiAgICAgICAgICAgIGNvbnN0IGxhc3RFbGVtZW50SXNUb2RvTGlzdCA9IGlzTGVnYWN5VG9kb0xpc3RJdGVtRWxlbWVudChsYXN0Rm9jdXNlZENvZGVCbG9jayk7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50RWxlbWVudElzVG9kb0xpc3QgPSBpc0xlZ2FjeVRvZG9MaXN0SXRlbUVsZW1lbnQoZm9jdXNQYXJlbnQpO1xuICAgICAgICAgICAgaWYgKGxhc3RFbGVtZW50SXNUb2RvTGlzdCAmJiAhY3VycmVudEVsZW1lbnRJc1RvZG9MaXN0KSB7XG4gICAgICAgICAgICAgICAgdWkuYXJpYUxpdmVBbm5vdW5jZXIuYW5ub3VuY2UodCgnTGVhdmluZyBhIHRvLWRvIGxpc3QnKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFsYXN0RWxlbWVudElzVG9kb0xpc3QgJiYgY3VycmVudEVsZW1lbnRJc1RvZG9MaXN0KSB7XG4gICAgICAgICAgICAgICAgdWkuYXJpYUxpdmVBbm5vdW5jZXIuYW5ub3VuY2UodCgnRW50ZXJpbmcgYSB0by1kbyBsaXN0JykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdEZvY3VzZWRDb2RlQmxvY2sgPSBmb2N1c1BhcmVudDtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBIYW5kbGVzIHRoZSBsZWZ0L3JpZ2h0IChMVFIvUlRMIGNvbnRlbnQpIGFycm93IGtleSBhbmQgbW92ZXMgdGhlIHNlbGVjdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBwcmV2aW91cyBibG9jayBlbGVtZW50XG4gKiBpZiB0aGUgc2VsZWN0aW9uIGlzIGp1c3QgYWZ0ZXIgdGhlIGNoZWNrYm94IGVsZW1lbnQuIEluIG90aGVyIHdvcmRzLCBpdCBqdW1wcyBvdmVyIHRoZSBjaGVja2JveCBlbGVtZW50IHdoZW5cbiAqIG1vdmluZyB0aGUgc2VsZWN0aW9uIHRvIHRoZSBsZWZ0L3JpZ2h0IChMVFIvUlRMKS5cbiAqXG4gKiBAcmV0dXJucyBDYWxsYmFjayBmb3IgJ2tleWRvd24nIGV2ZW50cy5cbiAqLyBmdW5jdGlvbiBqdW1wT3ZlckNoZWNrbWFya09uU2lkZUFycm93S2V5UHJlc3MobW9kZWwsIGxvY2FsZSkge1xuICAgIHJldHVybiAoZXZlbnRJbmZvLCBkb21FdmVudERhdGEpPT57XG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGdldExvY2FsaXplZEFycm93S2V5Q29kZURpcmVjdGlvbihkb21FdmVudERhdGEua2V5Q29kZSwgbG9jYWxlLmNvbnRlbnRMYW5ndWFnZURpcmVjdGlvbik7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gIT0gJ2xlZnQnKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2NoZW1hID0gbW9kZWwuc2NoZW1hO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5kb2N1bWVudC5zZWxlY3Rpb247XG4gICAgICAgIGlmICghc2VsZWN0aW9uLmlzQ29sbGFwc2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBzZWxlY3Rpb24uZ2V0Rmlyc3RQb3NpdGlvbigpO1xuICAgICAgICBjb25zdCBwYXJlbnQgPSBwb3NpdGlvbi5wYXJlbnQ7XG4gICAgICAgIGlmIChwYXJlbnQubmFtZSA9PT0gJ2xpc3RJdGVtJyAmJiBwYXJlbnQuZ2V0QXR0cmlidXRlKCdsaXN0VHlwZScpID09ICd0b2RvJyAmJiBwb3NpdGlvbi5pc0F0U3RhcnQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1JhbmdlID0gc2NoZW1hLmdldE5lYXJlc3RTZWxlY3Rpb25SYW5nZShtb2RlbC5jcmVhdGVQb3NpdGlvbkJlZm9yZShwYXJlbnQpLCAnYmFja3dhcmQnKTtcbiAgICAgICAgICAgIGlmIChuZXdSYW5nZSkge1xuICAgICAgICAgICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+d3JpdGVyLnNldFNlbGVjdGlvbihuZXdSYW5nZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG9tRXZlbnREYXRhLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBkb21FdmVudERhdGEuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldmVudEluZm8uc3RvcCgpO1xuICAgICAgICB9XG4gICAgfTtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBlbGVtZW50IGlzIGEgbGlzdCBpdGVtIG1vZGVsIGVsZW1lbnQgb2YgYSB0by1kbyBsaXN0LlxuICovIGZ1bmN0aW9uIGlzTGVnYWN5VG9kb0xpc3RJdGVtRWxlbWVudChlbGVtZW50KSB7XG4gICAgcmV0dXJuICEhZWxlbWVudCAmJiBlbGVtZW50LmlzKCdlbGVtZW50JywgJ2xpc3RJdGVtJykgJiYgZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xpc3RUeXBlJykgPT09ICd0b2RvJztcbn1cblxuLyoqXG4gKiBUaGUgbGVnYWN5IHRvLWRvIGxpc3QgZmVhdHVyZS5cbiAqXG4gKiBUaGlzIGlzIGEgXCJnbHVlXCIgcGx1Z2luIHRoYXQgbG9hZHMgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9sZWdhY3l0b2RvbGlzdC9sZWdhY3l0b2RvbGlzdGVkaXRpbmd+TGVnYWN5VG9kb0xpc3RFZGl0aW5nIGxlZ2FjeSB0by1kbyBsaXN0XG4gKiBlZGl0aW5nIGZlYXR1cmV9IGFuZCB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L3RvZG9saXN0L3RvZG9saXN0dWl+VG9kb0xpc3RVSSB0by1kbyBsaXN0IFVJIGZlYXR1cmV9LlxuICovIGNsYXNzIExlZ2FjeVRvZG9MaXN0IGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBMZWdhY3lUb2RvTGlzdEVkaXRpbmcsXG4gICAgICAgICAgICBUb2RvTGlzdFVJXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0xlZ2FjeVRvZG9MaXN0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuY2xhc3MgQWRqYWNlbnRMaXN0c1N1cHBvcnQgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ0FkamFjZW50TGlzdHNTdXBwb3J0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGluaXQoKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBtb2RlbCA9IGVkaXRvci5tb2RlbDtcbiAgICAgICAgbW9kZWwuc2NoZW1hLnJlZ2lzdGVyKCdsaXN0U2VwYXJhdG9yJywge1xuICAgICAgICAgICAgYWxsb3dXaGVyZTogJyRibG9jaycsXG4gICAgICAgICAgICBpc0Jsb2NrOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ3VwY2FzdCcpLy8gQWRkIGEgbGlzdCBzZXBhcmF0b3IgZWxlbWVudCBiZXR3ZWVuIHNpbWlsYXIgbGlzdCBlbGVtZW50cyBvbiB1cGNhc3QuXG4gICAgICAgIC5hZGQoKGRpc3BhdGNoZXIpPT57XG4gICAgICAgICAgICBkaXNwYXRjaGVyLm9uKCdlbGVtZW50Om9sJywgbGlzdFNlcGFyYXRvclVwY2FzdENvbnZlcnRlcigpKTtcbiAgICAgICAgICAgIGRpc3BhdGNoZXIub24oJ2VsZW1lbnQ6dWwnLCBsaXN0U2VwYXJhdG9yVXBjYXN0Q29udmVydGVyKCkpO1xuICAgICAgICB9KS8vIFZpZXctdG8tbW9kZWwgdHJhbnNmb3JtYXRpb24uXG4gICAgICAgIC5lbGVtZW50VG9FbGVtZW50KHtcbiAgICAgICAgICAgIG1vZGVsOiAnbGlzdFNlcGFyYXRvcicsXG4gICAgICAgICAgICB2aWV3OiAnY2stbGlzdC1zZXBhcmF0b3InXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBUaGUgbGlzdCBzZXBhcmF0b3IgZWxlbWVudCBzaG91bGQgZXhpc3QgaW4gdGhlIHZpZXcsIGJ1dCBzaG91bGQgYmUgaW52aXNpYmxlIChoaWRkZW4pLlxuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2VkaXRpbmdEb3duY2FzdCcpLmVsZW1lbnRUb0VsZW1lbnQoe1xuICAgICAgICAgICAgbW9kZWw6ICdsaXN0U2VwYXJhdG9yJyxcbiAgICAgICAgICAgIHZpZXc6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnZGl2JyxcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiBbXG4gICAgICAgICAgICAgICAgICAgICdjay1saXN0LXNlcGFyYXRvcicsXG4gICAgICAgICAgICAgICAgICAgICdjay1oaWRkZW4nXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gVGhlIGxpc3Qgc2VwYXJhdG9yIGVsZW1lbnQgc2hvdWxkIG5vdCBleGlzdCBpbiB0aGUgb3V0cHV0IGRhdGEuXG4gICAgICAgIGVkaXRvci5jb252ZXJzaW9uLmZvcignZGF0YURvd25jYXN0JykuZWxlbWVudFRvRWxlbWVudCh7XG4gICAgICAgICAgICBtb2RlbDogJ2xpc3RTZXBhcmF0b3InLFxuICAgICAgICAgICAgdmlldzogKG1vZGVsRWxlbWVudCwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3RWxlbWVudCA9IGNvbnZlcnNpb25BcGkud3JpdGVyLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoJ2NrLWxpc3Qtc2VwYXJhdG9yJyk7XG4gICAgICAgICAgICAgICAgY29udmVyc2lvbkFwaS53cml0ZXIuc2V0Q3VzdG9tUHJvcGVydHkoJ2RhdGFQaXBlbGluZTp0cmFuc3BhcmVudFJlbmRlcmluZycsIHRydWUsIHZpZXdFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB2aWV3RWxlbWVudC5nZXRGaWxsZXJPZmZzZXQgPSAoKT0+bnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmlld0VsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogSW5zZXJ0cyBhIGxpc3Qgc2VwYXJhdG9yIGVsZW1lbnQgYmV0d2VlbiB0d28gbGlzdHMgb2YgdGhlIHNhbWUgdHlwZSAoYG9sYCArIGBvbGAgb3IgYHVsYCArIGB1bGApLlxuICovIGZ1bmN0aW9uIGxpc3RTZXBhcmF0b3JVcGNhc3RDb252ZXJ0ZXIoKSB7XG4gICAgcmV0dXJuIChldnQsIGRhdGEsIGNvbnZlcnNpb25BcGkpPT57XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkYXRhLnZpZXdJdGVtO1xuICAgICAgICBjb25zdCBuZXh0U2libGluZyA9IGVsZW1lbnQubmV4dFNpYmxpbmc7XG4gICAgICAgIGlmICghbmV4dFNpYmxpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudC5uYW1lICE9PSBuZXh0U2libGluZy5uYW1lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkYXRhLm1vZGVsUmFuZ2UpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZGF0YSwgY29udmVyc2lvbkFwaS5jb252ZXJ0Q2hpbGRyZW4oZGF0YS52aWV3SXRlbSwgZGF0YS5tb2RlbEN1cnNvcikpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdyaXRlciA9IGNvbnZlcnNpb25BcGkud3JpdGVyO1xuICAgICAgICBjb25zdCBtb2RlbEVsZW1lbnQgPSB3cml0ZXIuY3JlYXRlRWxlbWVudCgnbGlzdFNlcGFyYXRvcicpO1xuICAgICAgICAvLyBUcnkgdG8gaW5zZXJ0IGEgbGlzdCBzZXBhcmF0b3IgZWxlbWVudCBvbiB0aGUgY3VycmVudCBtb2RlbCBjdXJzb3IgcG9zaXRpb24uXG4gICAgICAgIGlmICghY29udmVyc2lvbkFwaS5zYWZlSW5zZXJ0KG1vZGVsRWxlbWVudCwgZGF0YS5tb2RlbEN1cnNvcikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXJ0cyA9IGNvbnZlcnNpb25BcGkuZ2V0U3BsaXRQYXJ0cyhtb2RlbEVsZW1lbnQpO1xuICAgICAgICAvLyBFeHRlbmQgdGhlIG1vZGVsIHJhbmdlIHdpdGggdGhlIHJhbmdlIG9mIHRoZSBjcmVhdGVkIGxpc3Qgc2VwYXJhdG9yIGVsZW1lbnQuXG4gICAgICAgIGRhdGEubW9kZWxSYW5nZSA9IHdyaXRlci5jcmVhdGVSYW5nZShkYXRhLm1vZGVsUmFuZ2Uuc3RhcnQsIHdyaXRlci5jcmVhdGVQb3NpdGlvbkFmdGVyKHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKSk7XG4gICAgICAgIGNvbnZlcnNpb25BcGkudXBkYXRlQ29udmVyc2lvblJlc3VsdChtb2RlbEVsZW1lbnQsIGRhdGEpO1xuICAgIH07XG59XG5cbi8qKlxuICogVGhlIGRvY3VtZW50IGxpc3QgZmVhdHVyZS5cbiAqXG4gKiBUaGlzIGlzIGFuIG9ic29sZXRlIHBsdWdpbiB0aGF0IGV4aXN0cyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBvbmx5LlxuICogVXNlIHRoZSB7QGxpbmsgbW9kdWxlOmxpc3QvbGlzdH5MaXN0IGBMaXN0YH0gaW5zdGVhZC5cbiAqXG4gKiBAZGVwcmVjYXRlZFxuICovIGNsYXNzIERvY3VtZW50TGlzdCBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHJlcXVpcmVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgTGlzdFxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdEb2N1bWVudExpc3QnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGVkaXRvcil7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIC8qKlxuXHRcdCAqIFRoZSBgRG9jdW1lbnRMaXN0YCBwbHVnaW4gaXMgb2Jzb2xldGUuIFVzZSBgTGlzdGAgaW5zdGVhZC5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBwbHVnaW4tb2Jzb2xldGUtZG9jdW1lbnRsaXN0XG5cdFx0ICovIGxvZ1dhcm5pbmcoJ3BsdWdpbi1vYnNvbGV0ZS1kb2N1bWVudGxpc3QnLCB7XG4gICAgICAgICAgICBwbHVnaW5OYW1lOiAnRG9jdW1lbnRMaXN0J1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGRvY3VtZW50IGxpc3QgcHJvcGVydGllcyBmZWF0dXJlLlxuICpcbiAqIFRoaXMgaXMgYW4gb2Jzb2xldGUgcGx1Z2luIHRoYXQgZXhpc3RzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IG9ubHkuXG4gKiBVc2UgdGhlIHtAbGluayBtb2R1bGU6bGlzdC9saXN0cHJvcGVydGllc35MaXN0UHJvcGVydGllcyBgTGlzdFByb3BlcnRpZXNgfSBpbnN0ZWFkLlxuICpcbiAqIEBkZXByZWNhdGVkXG4gKi8gY2xhc3MgRG9jdW1lbnRMaXN0UHJvcGVydGllcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHJlcXVpcmVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgTGlzdFByb3BlcnRpZXNcbiAgICAgICAgXTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnRG9jdW1lbnRMaXN0UHJvcGVydGllcyc7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBpc09mZmljaWFsUGx1Z2luKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoZWRpdG9yKXtcbiAgICAgICAgc3VwZXIoZWRpdG9yKTtcbiAgICAgICAgLyoqXG5cdFx0ICogVGhlIGBEb2N1bWVudExpc3RQcm9wZXJ0aWVzYCBwbHVnaW4gaXMgb2Jzb2xldGUuIFVzZSBgTGlzdFByb3BlcnRpZXNgIGluc3RlYWQuXG5cdFx0ICpcblx0XHQgKiBAZXJyb3IgcGx1Z2luLW9ic29sZXRlLWRvY3VtZW50bGlzdHByb3BlcnRpZXNcblx0XHQgKi8gbG9nV2FybmluZygncGx1Z2luLW9ic29sZXRlLWRvY3VtZW50bGlzdHByb3BlcnRpZXMnLCB7XG4gICAgICAgICAgICBwbHVnaW5OYW1lOiAnRG9jdW1lbnRMaXN0UHJvcGVydGllcydcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoZSB0by1kbyBsaXN0IGZlYXR1cmUuXG4gKlxuICogVGhpcyBpcyBhbiBvYnNvbGV0ZSBwbHVnaW4gdGhhdCBleGlzdHMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb25seS5cbiAqIFVzZSB0aGUge0BsaW5rIG1vZHVsZTpsaXN0L3RvZG9saXN0flRvZG9MaXN0IGBUb2RvTGlzdGB9IGluc3RlYWQuXG4gKlxuICogQGRlcHJlY2F0ZWRcbiAqLyBjbGFzcyBUb2RvRG9jdW1lbnRMaXN0IGV4dGVuZHMgUGx1Z2luIHtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBUb2RvTGlzdFxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcGx1Z2luTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuICdUb2RvRG9jdW1lbnRMaXN0JztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihlZGl0b3Ipe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICAvKipcblx0XHQgKiBUaGUgYFRvZG9Eb2N1bWVudExpc3RgIHBsdWdpbiBpcyBvYnNvbGV0ZS4gVXNlIGBUb2RvTGlzdGAgaW5zdGVhZC5cblx0XHQgKlxuXHRcdCAqIEBlcnJvciBwbHVnaW4tb2Jzb2xldGUtdG9kb2RvY3VtZW50bGlzdFxuXHRcdCAqLyBsb2dXYXJuaW5nKCdwbHVnaW4tb2Jzb2xldGUtdG9kb2RvY3VtZW50bGlzdCcsIHtcbiAgICAgICAgICAgIHBsdWdpbk5hbWU6ICdUb2RvRG9jdW1lbnRMaXN0J1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IEFkamFjZW50TGlzdHNTdXBwb3J0LCBEb2N1bWVudExpc3QsIERvY3VtZW50TGlzdFByb3BlcnRpZXMsIExlZ2FjeUluZGVudENvbW1hbmQsIExlZ2FjeUxpc3QsIExlZ2FjeUxpc3RFZGl0aW5nLCBMZWdhY3lMaXN0UHJvcGVydGllcywgTGVnYWN5TGlzdFByb3BlcnRpZXNFZGl0aW5nLCBMZWdhY3lMaXN0VXRpbHMsIExlZ2FjeVRvZG9MaXN0LCBMZWdhY3lUb2RvTGlzdEVkaXRpbmcsIExpc3QsIExpc3RDb21tYW5kLCBMaXN0RWRpdGluZywgTGlzdEluZGVudENvbW1hbmQsIExpc3RQcm9wZXJ0aWVzLCBMaXN0UHJvcGVydGllc0VkaXRpbmcsIExpc3RQcm9wZXJ0aWVzVUksIExpc3RQcm9wZXJ0aWVzVXRpbHMsIExpc3RVSSwgTGlzdFV0aWxzLCBUb2RvRG9jdW1lbnRMaXN0LCBUb2RvTGlzdCwgVG9kb0xpc3RFZGl0aW5nLCBUb2RvTGlzdFVJIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiIsIi8qKlxuICogQGxpY2Vuc2UgQ29weXJpZ2h0IChjKSAyMDAzLTIwMjUsIENLU291cmNlIEhvbGRpbmcgc3AuIHogby5vLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogRm9yIGxpY2Vuc2luZywgc2VlIExJQ0VOU0UubWQgb3IgaHR0cHM6Ly9ja2VkaXRvci5jb20vbGVnYWwvY2tlZGl0b3ItbGljZW5zaW5nLW9wdGlvbnNcbiAqL1xuaW1wb3J0IHsgQ29tbWFuZCwgUGx1Z2luIH0gZnJvbSAnQGNrZWRpdG9yL2NrZWRpdG9yNS1jb3JlL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgQ0tFZGl0b3JFcnJvciwgdG9NYXAsIHVpZCwgUmVjdCwga2V5Q29kZXMsIENvbGxlY3Rpb24sIGxvZ1dhcm5pbmcsIGVudiB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdXRpbHMvZGlzdC9pbmRleC5qcyc7XG5pbXBvcnQgeyBMaXN0VmlldywgVmlldywgTGlzdEl0ZW1WaWV3LCBDb250ZXh0dWFsQmFsbG9vbiwgY2xpY2tPdXRzaWRlSGFuZGxlciwgQnV0dG9uVmlldyB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdWkvZGlzdC9pbmRleC5qcyc7XG5pbXBvcnQgeyBUZXh0V2F0Y2hlciB9IGZyb20gJ0Bja2VkaXRvci9ja2VkaXRvcjUtdHlwaW5nL2Rpc3QvaW5kZXguanMnO1xuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gtZXMnO1xuXG5jb25zdCBCUkFDS0VUX1BBSVJTID0ge1xuICAgICcoJzogJyknLFxuICAgICdbJzogJ10nLFxuICAgICd7JzogJ30nXG59O1xuLyoqXG4gKiBUaGUgbWVudGlvbiBjb21tYW5kLlxuICpcbiAqIFRoZSBjb21tYW5kIGlzIHJlZ2lzdGVyZWQgYnkge0BsaW5rIG1vZHVsZTptZW50aW9uL21lbnRpb25lZGl0aW5nfk1lbnRpb25FZGl0aW5nfSBhcyBgJ21lbnRpb24nYC5cbiAqXG4gKiBUbyBpbnNlcnQgYSBtZW50aW9uIGludG8gYSByYW5nZSwgZXhlY3V0ZSB0aGUgY29tbWFuZCBhbmQgc3BlY2lmeSBhIG1lbnRpb24gb2JqZWN0IHdpdGggYSByYW5nZSB0byByZXBsYWNlOlxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBmb2N1cyA9IGVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZm9jdXM7XG4gKlxuICogLy8gSXQgd2lsbCByZXBsYWNlIG9uZSBjaGFyYWN0ZXIgYmVmb3JlIHRoZSBzZWxlY3Rpb24gZm9jdXMgd2l0aCB0aGUgJyMxMjM0JyB0ZXh0XG4gKiAvLyB3aXRoIHRoZSBtZW50aW9uIGF0dHJpYnV0ZSBmaWxsZWQgd2l0aCBwYXNzZWQgYXR0cmlidXRlcy5cbiAqIGVkaXRvci5leGVjdXRlKCAnbWVudGlvbicsIHtcbiAqIFx0bWFya2VyOiAnIycsXG4gKiBcdG1lbnRpb246IHtcbiAqIFx0XHRpZDogJyMxMjM0JyxcbiAqIFx0XHRuYW1lOiAnRm9vJyxcbiAqIFx0XHR0aXRsZTogJ0JpZyBGb28nXG4gKiBcdH0sXG4gKiBcdHJhbmdlOiBlZGl0b3IubW9kZWwuY3JlYXRlUmFuZ2UoIGZvY3VzLmdldFNoaWZ0ZWRCeSggLTEgKSwgZm9jdXMgKVxuICogfSApO1xuICpcbiAqIC8vIEl0IHdpbGwgcmVwbGFjZSBvbmUgY2hhcmFjdGVyIGJlZm9yZSB0aGUgc2VsZWN0aW9uIGZvY3VzIHdpdGggdGhlICdUaGUgXCJCaWcgRm9vXCInIHRleHRcbiAqIC8vIHdpdGggdGhlIG1lbnRpb24gYXR0cmlidXRlIGZpbGxlZCB3aXRoIHBhc3NlZCBhdHRyaWJ1dGVzLlxuICogZWRpdG9yLmV4ZWN1dGUoICdtZW50aW9uJywge1xuICogXHRtYXJrZXI6ICcjJyxcbiAqIFx0bWVudGlvbjoge1xuICogXHRcdGlkOiAnIzEyMzQnLFxuICogXHRcdG5hbWU6ICdGb28nLFxuICogXHRcdHRpdGxlOiAnQmlnIEZvbydcbiAqIFx0fSxcbiAqIFx0dGV4dDogJ1RoZSBcIkJpZyBGb29cIicsXG4gKiBcdHJhbmdlOiBlZGl0b3IubW9kZWwuY3JlYXRlUmFuZ2UoIGZvY3VzLmdldFNoaWZ0ZWRCeSggLTEgKSwgZm9jdXMgKVxuICogfSApO1xuICpcdGBgYFxuICovIGNsYXNzIE1lbnRpb25Db21tYW5kIGV4dGVuZHMgQ29tbWFuZCB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBjb25zdHJ1Y3RvcihlZGl0b3Ipe1xuICAgICAgICBzdXBlcihlZGl0b3IpO1xuICAgICAgICAvLyBTaW5jZSB0aGlzIGNvbW1hbmQgbWF5IHBhc3MgcmFuZ2UgaW4gZXhlY3V0aW9uIHBhcmFtZXRlcnMsIGl0IHNob3VsZCBiZSBjaGVja2VkIGRpcmVjdGx5IGluIGV4ZWN1dGUgYmxvY2suXG4gICAgICAgIHRoaXMuX2lzRW5hYmxlZEJhc2VkT25TZWxlY3Rpb24gPSBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyByZWZyZXNoKCkge1xuICAgICAgICBjb25zdCBtb2RlbCA9IHRoaXMuZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2MgPSBtb2RlbC5kb2N1bWVudDtcbiAgICAgICAgdGhpcy5pc0VuYWJsZWQgPSBtb2RlbC5zY2hlbWEuY2hlY2tBdHRyaWJ1dGVJblNlbGVjdGlvbihkb2Muc2VsZWN0aW9uLCAnbWVudGlvbicpO1xuICAgIH1cbiAgICAvKipcblx0ICogRXhlY3V0ZXMgdGhlIGNvbW1hbmQuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIHRoZSBleGVjdXRlZCBjb21tYW5kLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5tZW50aW9uIFRoZSBtZW50aW9uIG9iamVjdCB0byBpbnNlcnQuIFdoZW4gYSBzdHJpbmcgaXMgcGFzc2VkLCBpdCB3aWxsIGJlIHVzZWQgdG8gY3JlYXRlIGEgcGxhaW5cblx0ICogb2JqZWN0IHdpdGggdGhlIG5hbWUgYXR0cmlidXRlIHRoYXQgZXF1YWxzIHRoZSBwYXNzZWQgc3RyaW5nLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5tYXJrZXIgVGhlIG1hcmtlciBjaGFyYWN0ZXIgKGUuZy4gYCdAJ2ApLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy50ZXh0IFRoZSB0ZXh0IG9mIHRoZSBpbnNlcnRlZCBtZW50aW9uLiBEZWZhdWx0cyB0byB0aGUgZnVsbCBtZW50aW9uIHN0cmluZyBjb21wb3NlZCBmcm9tIGBtYXJrZXJgIGFuZFxuXHQgKiBgbWVudGlvbmAgc3RyaW5nIG9yIGBtZW50aW9uLmlkYCBpZiBhbiBvYmplY3QgaXMgcGFzc2VkLlxuXHQgKiBAcGFyYW0gb3B0aW9ucy5yYW5nZSBUaGUgcmFuZ2UgdG8gcmVwbGFjZS5cblx0ICogTm90ZSB0aGF0IHRoZSByZXBsYWNlZCByYW5nZSBtaWdodCBiZSBzaG9ydGVyIHRoYW4gdGhlIGluc2VydGVkIHRleHQgd2l0aCB0aGUgbWVudGlvbiBhdHRyaWJ1dGUuXG5cdCAqIEBmaXJlcyBleGVjdXRlXG5cdCAqLyBleGVjdXRlKG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLmVkaXRvci5tb2RlbDtcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBtb2RlbC5kb2N1bWVudDtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICBjb25zdCBtZW50aW9uRGF0YSA9IHR5cGVvZiBvcHRpb25zLm1lbnRpb24gPT0gJ3N0cmluZycgPyB7XG4gICAgICAgICAgICBpZDogb3B0aW9ucy5tZW50aW9uXG4gICAgICAgIH0gOiBvcHRpb25zLm1lbnRpb247XG4gICAgICAgIGNvbnN0IG1lbnRpb25JRCA9IG1lbnRpb25EYXRhLmlkO1xuICAgICAgICBjb25zdCByYW5nZSA9IG9wdGlvbnMucmFuZ2UgfHwgc2VsZWN0aW9uLmdldEZpcnN0UmFuZ2UoKTtcbiAgICAgICAgLy8gRG9uJ3QgZXhlY3V0ZSBjb21tYW5kIGlmIHJhbmdlIGlzIGluIG5vbi1lZGl0YWJsZSBwbGFjZS5cbiAgICAgICAgaWYgKCFtb2RlbC5jYW5FZGl0QXQocmFuZ2UpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbWVudGlvblRleHQgPSBvcHRpb25zLnRleHQgfHwgbWVudGlvbklEO1xuICAgICAgICBjb25zdCBtZW50aW9uID0gX2FkZE1lbnRpb25BdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgIF90ZXh0OiBtZW50aW9uVGV4dCxcbiAgICAgICAgICAgIGlkOiBtZW50aW9uSURcbiAgICAgICAgfSwgbWVudGlvbkRhdGEpO1xuICAgICAgICBpZiAoIW1lbnRpb25JRC5zdGFydHNXaXRoKG9wdGlvbnMubWFya2VyKSkge1xuICAgICAgICAgICAgLyoqXG5cdFx0XHQgKiBUaGUgZmVlZCBpdGVtIElEIG11c3Qgc3RhcnQgd2l0aCB0aGUgbWFya2VyIGNoYXJhY3RlcihzKS5cblx0XHRcdCAqXG5cdFx0XHQgKiBDb3JyZWN0IG1lbnRpb24gZmVlZCBzZXR0aW5nOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBtZW50aW9uczogW1xuXHRcdFx0ICogXHR7XG5cdFx0XHQgKiBcdFx0bWFya2VyOiAnQCcsXG5cdFx0XHQgKiBcdFx0ZmVlZDogWyAnQEFubicsICdAQmFybmV5JywgLi4uIF1cblx0XHRcdCAqIFx0fVxuXHRcdFx0ICogXVxuXHRcdFx0ICogYGBgXG5cdFx0XHQgKlxuXHRcdFx0ICogSW5jb3JyZWN0IG1lbnRpb24gZmVlZCBzZXR0aW5nOlxuXHRcdFx0ICpcblx0XHRcdCAqIGBgYHRzXG5cdFx0XHQgKiBtZW50aW9uczogW1xuXHRcdFx0ICogXHR7XG5cdFx0XHQgKiBcdFx0bWFya2VyOiAnQCcsXG5cdFx0XHQgKiBcdFx0ZmVlZDogWyAnQW5uJywgJ0Jhcm5leScsIC4uLiBdXG5cdFx0XHQgKiBcdH1cblx0XHRcdCAqIF1cblx0XHRcdCAqIGBgYFxuXHRcdFx0ICpcblx0XHRcdCAqIFNlZSB7QGxpbmsgbW9kdWxlOm1lbnRpb24vbWVudGlvbmNvbmZpZ35NZW50aW9uQ29uZmlnfS5cblx0XHRcdCAqXG5cdFx0XHQgKiBAZXJyb3IgbWVudGlvbmNvbW1hbmQtaW5jb3JyZWN0LWlkXG5cdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21lbnRpb25jb21tYW5kLWluY29ycmVjdC1pZCcsIHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIG1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgY29uc3QgY3VycmVudEF0dHJpYnV0ZXMgPSB0b01hcChzZWxlY3Rpb24uZ2V0QXR0cmlidXRlcygpKTtcbiAgICAgICAgICAgIGNvbnN0IGF0dHJpYnV0ZXNXaXRoTWVudGlvbiA9IG5ldyBNYXAoY3VycmVudEF0dHJpYnV0ZXMuZW50cmllcygpKTtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXNXaXRoTWVudGlvbi5zZXQoJ21lbnRpb24nLCBtZW50aW9uKTtcbiAgICAgICAgICAgIC8vIFJlcGxhY2UgYSByYW5nZSB3aXRoIHRoZSB0ZXh0IHdpdGggYSBtZW50aW9uLlxuICAgICAgICAgICAgY29uc3QgaW5zZXJ0aW9uUmFuZ2UgPSBtb2RlbC5pbnNlcnRDb250ZW50KHdyaXRlci5jcmVhdGVUZXh0KG1lbnRpb25UZXh0LCBhdHRyaWJ1dGVzV2l0aE1lbnRpb24pLCByYW5nZSk7XG4gICAgICAgICAgICBjb25zdCBub2RlQmVmb3JlID0gaW5zZXJ0aW9uUmFuZ2Uuc3RhcnQubm9kZUJlZm9yZTtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVBZnRlciA9IGluc2VydGlvblJhbmdlLmVuZC5ub2RlQWZ0ZXI7XG4gICAgICAgICAgICBjb25zdCBpc0ZvbGxvd2VkQnlXaGl0ZVNwYWNlID0gbm9kZUFmdGVyICYmIG5vZGVBZnRlci5pcygnJHRleHQnKSAmJiBub2RlQWZ0ZXIuZGF0YS5zdGFydHNXaXRoKCcgJyk7XG4gICAgICAgICAgICBsZXQgaXNJbnNlcnRlZEluQnJhY2tldHMgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChub2RlQmVmb3JlICYmIG5vZGVBZnRlciAmJiBub2RlQmVmb3JlLmlzKCckdGV4dCcpICYmIG5vZGVBZnRlci5pcygnJHRleHQnKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZWNlZGluZ0NoYXJhY3RlciA9IG5vZGVCZWZvcmUuZGF0YS5zbGljZSgtMSk7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNQcmVjZWRlZEJ5T3BlbmluZ0JyYWNrZXQgPSBwcmVjZWRpbmdDaGFyYWN0ZXIgaW4gQlJBQ0tFVF9QQUlSUztcbiAgICAgICAgICAgICAgICBjb25zdCBpc0ZvbGxvd2VkQnlCcmFja2V0Q2xvc3VyZSA9IGlzUHJlY2VkZWRCeU9wZW5pbmdCcmFja2V0ICYmIG5vZGVBZnRlci5kYXRhLnN0YXJ0c1dpdGgoQlJBQ0tFVF9QQUlSU1twcmVjZWRpbmdDaGFyYWN0ZXJdKTtcbiAgICAgICAgICAgICAgICBpc0luc2VydGVkSW5CcmFja2V0cyA9IGlzUHJlY2VkZWRCeU9wZW5pbmdCcmFja2V0ICYmIGlzRm9sbG93ZWRCeUJyYWNrZXRDbG9zdXJlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRG9uJ3QgYWRkIGEgd2hpdGUgc3BhY2UgaWYgZWl0aGVyIG9mIHRoZSBmb2xsb3dpbmcgaXMgdHJ1ZTpcbiAgICAgICAgICAgIC8vICogdGhlcmUncyBhbHJlYWR5IG9uZSBhZnRlciB0aGUgbWVudGlvbjtcbiAgICAgICAgICAgIC8vICogdGhlIG1lbnRpb24gd2FzIGluc2VydGVkIGluIHRoZSBlbXB0eSBtYXRjaGluZyBicmFja2V0cy5cbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ja2VkaXRvci9ja2VkaXRvcjUvaXNzdWVzLzQ2NTFcbiAgICAgICAgICAgIGlmICghaXNJbnNlcnRlZEluQnJhY2tldHMgJiYgIWlzRm9sbG93ZWRCeVdoaXRlU3BhY2UpIHtcbiAgICAgICAgICAgICAgICBtb2RlbC5pbnNlcnRDb250ZW50KHdyaXRlci5jcmVhdGVUZXh0KCcgJywgY3VycmVudEF0dHJpYnV0ZXMpLCByYW5nZS5zdGFydC5nZXRTaGlmdGVkQnkobWVudGlvblRleHQubGVuZ3RoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgbWVudGlvbiBlZGl0aW5nIGZlYXR1cmUuXG4gKlxuICogSXQgaW50cm9kdWNlcyB0aGUge0BsaW5rIG1vZHVsZTptZW50aW9uL21lbnRpb25jb21tYW5kfk1lbnRpb25Db21tYW5kIGNvbW1hbmR9IGFuZCB0aGUgYG1lbnRpb25gXG4gKiBhdHRyaWJ1dGUgaW4gdGhlIHtAbGluayBtb2R1bGU6ZW5naW5lL21vZGVsL21vZGVsfk1vZGVsIG1vZGVsfSB3aGljaCByZW5kZXJzIGluIHRoZSB7QGxpbmsgbW9kdWxlOmVuZ2luZS92aWV3L3ZpZXcgdmlld31cbiAqIGFzIGEgYDxzcGFuIGNsYXNzPVwibWVudGlvblwiIGRhdGEtbWVudGlvbj1cIkBtZW50aW9uXCI+YC5cbiAqLyBjbGFzcyBNZW50aW9uRWRpdGluZyBleHRlbmRzIFBsdWdpbiB7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTWVudGlvbkVkaXRpbmcnO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gaW5pdCgpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGNvbnN0IG1vZGVsID0gZWRpdG9yLm1vZGVsO1xuICAgICAgICBjb25zdCBkb2MgPSBtb2RlbC5kb2N1bWVudDtcbiAgICAgICAgLy8gQWxsb3cgdGhlIG1lbnRpb24gYXR0cmlidXRlIG9uIGFsbCB0ZXh0IG5vZGVzLlxuICAgICAgICBtb2RlbC5zY2hlbWEuZXh0ZW5kKCckdGV4dCcsIHtcbiAgICAgICAgICAgIGFsbG93QXR0cmlidXRlczogJ21lbnRpb24nXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBVcGNhc3QgY29udmVyc2lvbi5cbiAgICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCd1cGNhc3QnKS5lbGVtZW50VG9BdHRyaWJ1dGUoe1xuICAgICAgICAgICAgdmlldzoge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdzcGFuJyxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiAnZGF0YS1tZW50aW9uJyxcbiAgICAgICAgICAgICAgICBjbGFzc2VzOiAnbWVudGlvbidcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb2RlbDoge1xuICAgICAgICAgICAgICAgIGtleTogJ21lbnRpb24nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAodmlld0VsZW1lbnQpPT5fdG9NZW50aW9uQXR0cmlidXRlKHZpZXdFbGVtZW50KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gRG93bmNhc3QgY29udmVyc2lvbi5cbiAgICAgICAgZWRpdG9yLmNvbnZlcnNpb24uZm9yKCdkb3duY2FzdCcpLmF0dHJpYnV0ZVRvRWxlbWVudCh7XG4gICAgICAgICAgICBtb2RlbDogJ21lbnRpb24nLFxuICAgICAgICAgICAgdmlldzogY3JlYXRlVmlld01lbnRpb25FbGVtZW50XG4gICAgICAgIH0pO1xuICAgICAgICBlZGl0b3IuY29udmVyc2lvbi5mb3IoJ2Rvd25jYXN0JykuYWRkKHByZXZlbnRQYXJ0aWFsTWVudGlvbkRvd25jYXN0KTtcbiAgICAgICAgZG9jLnJlZ2lzdGVyUG9zdEZpeGVyKCh3cml0ZXIpPT5yZW1vdmVQYXJ0aWFsTWVudGlvblBvc3RGaXhlcih3cml0ZXIsIGRvYywgbW9kZWwuc2NoZW1hKSk7XG4gICAgICAgIGRvYy5yZWdpc3RlclBvc3RGaXhlcigod3JpdGVyKT0+ZXh0ZW5kQXR0cmlidXRlT25NZW50aW9uUG9zdEZpeGVyKHdyaXRlciwgZG9jKSk7XG4gICAgICAgIGRvYy5yZWdpc3RlclBvc3RGaXhlcigod3JpdGVyKT0+c2VsZWN0aW9uTWVudGlvbkF0dHJpYnV0ZVBvc3RGaXhlcih3cml0ZXIsIGRvYykpO1xuICAgICAgICBlZGl0b3IuY29tbWFuZHMuYWRkKCdtZW50aW9uJywgbmV3IE1lbnRpb25Db21tYW5kKGVkaXRvcikpO1xuICAgIH1cbn1cbi8qKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gX2FkZE1lbnRpb25BdHRyaWJ1dGVzKGJhc2VNZW50aW9uRGF0YSwgZGF0YSkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgdWlkOiB1aWQoKVxuICAgIH0sIGJhc2VNZW50aW9uRGF0YSwgZGF0YSB8fCB7fSk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBtZW50aW9uIGF0dHJpYnV0ZSB2YWx1ZSBmcm9tIHRoZSBwcm92aWRlZCB2aWV3IGVsZW1lbnQgYW5kIG9wdGlvbmFsIGRhdGEuXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBleHBvc2VkIGFzXG4gKiB7QGxpbmsgbW9kdWxlOm1lbnRpb24vbWVudGlvbn5NZW50aW9uI3RvTWVudGlvbkF0dHJpYnV0ZSBgZWRpdG9yLnBsdWdpbnMuZ2V0KCAnTWVudGlvbicgKS50b01lbnRpb25BdHRyaWJ1dGUoKWB9LlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIF90b01lbnRpb25BdHRyaWJ1dGUodmlld0VsZW1lbnRPck1lbnRpb24sIGRhdGEpIHtcbiAgICBjb25zdCBkYXRhTWVudGlvbiA9IHZpZXdFbGVtZW50T3JNZW50aW9uLmdldEF0dHJpYnV0ZSgnZGF0YS1tZW50aW9uJyk7XG4gICAgY29uc3QgdGV4dE5vZGUgPSB2aWV3RWxlbWVudE9yTWVudGlvbi5nZXRDaGlsZCgwKTtcbiAgICAvLyBEbyBub3QgY29udmVydCBlbXB0eSBtZW50aW9ucy5cbiAgICBpZiAoIXRleHROb2RlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYmFzZU1lbnRpb25EYXRhID0ge1xuICAgICAgICBpZDogZGF0YU1lbnRpb24sXG4gICAgICAgIF90ZXh0OiB0ZXh0Tm9kZS5kYXRhXG4gICAgfTtcbiAgICByZXR1cm4gX2FkZE1lbnRpb25BdHRyaWJ1dGVzKGJhc2VNZW50aW9uRGF0YSwgZGF0YSk7XG59XG4vKipcbiAqIEEgY29udmVydGVyIHRoYXQgYmxvY2tzIHBhcnRpYWwgbWVudGlvbiBmcm9tIGJlaW5nIGNvbnZlcnRlZC5cbiAqXG4gKiBUaGlzIGNvbnZlcnRlciBpcyByZWdpc3RlcmVkIHdpdGggJ2hpZ2hlc3QnIHByaW9yaXR5IGluIG9yZGVyIHRvIGNvbnN1bWUgbWVudGlvbiBhdHRyaWJ1dGUgYmVmb3JlIGl0IGlzIGNvbnZlcnRlZCBieVxuICogYW55IG90aGVyIGNvbnZlcnRlcnMuIFRoaXMgY29udmVydGVyIG9ubHkgY29uc3VtZXMgcGFydGlhbCBtZW50aW9uIC0gdGhvc2Ugd2hvc2UgYF90ZXh0YCBhdHRyaWJ1dGUgaXMgbm90IGVxdWFsIHRvIHRleHQgd2l0aCBtZW50aW9uXG4gKiBhdHRyaWJ1dGUuIFRoaXMgbWF5IGhhcHBlbiB3aGVuIGNvcHlpbmcgcGFydCBvZiBtZW50aW9uIHRleHQuXG4gKi8gZnVuY3Rpb24gcHJldmVudFBhcnRpYWxNZW50aW9uRG93bmNhc3QoZGlzcGF0Y2hlcikge1xuICAgIGRpc3BhdGNoZXIub24oJ2F0dHJpYnV0ZTptZW50aW9uJywgKGV2dCwgZGF0YSwgY29udmVyc2lvbkFwaSk9PntcbiAgICAgICAgY29uc3QgbWVudGlvbiA9IGRhdGEuYXR0cmlidXRlTmV3VmFsdWU7XG4gICAgICAgIGlmICghZGF0YS5pdGVtLmlzKCckdGV4dFByb3h5JykgfHwgIW1lbnRpb24pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydCA9IGRhdGEucmFuZ2Uuc3RhcnQ7XG4gICAgICAgIGNvbnN0IHRleHROb2RlID0gc3RhcnQudGV4dE5vZGUgfHwgc3RhcnQubm9kZUFmdGVyO1xuICAgICAgICBpZiAodGV4dE5vZGUuZGF0YSAhPSBtZW50aW9uLl90ZXh0KSB7XG4gICAgICAgICAgICAvLyBDb25zdW1lIGl0ZW0gdG8gcHJldmVudCBwYXJ0aWFsIG1lbnRpb24gY29udmVyc2lvbi5cbiAgICAgICAgICAgIGNvbnZlcnNpb25BcGkuY29uc3VtYWJsZS5jb25zdW1lKGRhdGEuaXRlbSwgZXZ0Lm5hbWUpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnXG4gICAgfSk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBtZW50aW9uIGVsZW1lbnQgZnJvbSB0aGUgbWVudGlvbiBkYXRhLlxuICovIGZ1bmN0aW9uIGNyZWF0ZVZpZXdNZW50aW9uRWxlbWVudChtZW50aW9uLCB7IHdyaXRlciB9KSB7XG4gICAgaWYgKCFtZW50aW9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYXR0cmlidXRlcyA9IHtcbiAgICAgICAgY2xhc3M6ICdtZW50aW9uJyxcbiAgICAgICAgJ2RhdGEtbWVudGlvbic6IG1lbnRpb24uaWRcbiAgICB9O1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGlkOiBtZW50aW9uLnVpZCxcbiAgICAgICAgcHJpb3JpdHk6IDIwXG4gICAgfTtcbiAgICByZXR1cm4gd3JpdGVyLmNyZWF0ZUF0dHJpYnV0ZUVsZW1lbnQoJ3NwYW4nLCBhdHRyaWJ1dGVzLCBvcHRpb25zKTtcbn1cbi8qKlxuICogTW9kZWwgcG9zdC1maXhlciB0aGF0IGRpc2FsbG93cyB0eXBpbmcgd2l0aCBzZWxlY3Rpb24gd2hlbiB0aGUgc2VsZWN0aW9uIGlzIHBsYWNlZCBhZnRlciB0aGUgdGV4dCBub2RlIHdpdGggdGhlIG1lbnRpb24gYXR0cmlidXRlIG9yXG4gKiBiZWZvcmUgYSB0ZXh0IG5vZGUgd2l0aCBtZW50aW9uIGF0dHJpYnV0ZS5cbiAqLyBmdW5jdGlvbiBzZWxlY3Rpb25NZW50aW9uQXR0cmlidXRlUG9zdEZpeGVyKHdyaXRlciwgZG9jKSB7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jLnNlbGVjdGlvbjtcbiAgICBjb25zdCBmb2N1cyA9IHNlbGVjdGlvbi5mb2N1cztcbiAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmIHNlbGVjdGlvbi5oYXNBdHRyaWJ1dGUoJ21lbnRpb24nKSAmJiBzaG91bGROb3RUeXBlV2l0aE1lbnRpb25BdChmb2N1cykpIHtcbiAgICAgICAgd3JpdGVyLnJlbW92ZVNlbGVjdGlvbkF0dHJpYnV0ZSgnbWVudGlvbicpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gZGV0ZWN0IGlmIG1lbnRpb24gYXR0cmlidXRlIHNob3VsZCBiZSByZW1vdmVkIGZyb20gc2VsZWN0aW9uLlxuICogVGhpcyBjaGVjayBtYWtlcyBvbmx5IHNlbnNlIGlmIHRoZSBzZWxlY3Rpb24gaGFzIG1lbnRpb24gYXR0cmlidXRlLlxuICpcbiAqIFRoZSBtZW50aW9uIGF0dHJpYnV0ZSBzaG91bGQgYmUgcmVtb3ZlZCBmcm9tIGEgc2VsZWN0aW9uIHdoZW4gc2VsZWN0aW9uIGZvY3VzIGlzIHBsYWNlZDpcbiAqIGEpIGFmdGVyIGEgdGV4dCBub2RlXG4gKiBiKSB0aGUgcG9zaXRpb24gaXMgYXQgcGFyZW50cyBzdGFydCAtIHRoZSBzZWxlY3Rpb24gd2lsbCBzZXQgYXR0cmlidXRlcyBmcm9tIG5vZGUgYWZ0ZXIuXG4gKi8gZnVuY3Rpb24gc2hvdWxkTm90VHlwZVdpdGhNZW50aW9uQXQocG9zaXRpb24pIHtcbiAgICBjb25zdCBpc0F0U3RhcnQgPSBwb3NpdGlvbi5pc0F0U3RhcnQ7XG4gICAgY29uc3QgaXNBZnRlckFNZW50aW9uID0gcG9zaXRpb24ubm9kZUJlZm9yZSAmJiBwb3NpdGlvbi5ub2RlQmVmb3JlLmlzKCckdGV4dCcpO1xuICAgIHJldHVybiBpc0FmdGVyQU1lbnRpb24gfHwgaXNBdFN0YXJ0O1xufVxuLyoqXG4gKiBNb2RlbCBwb3N0LWZpeGVyIHRoYXQgcmVtb3ZlcyB0aGUgbWVudGlvbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kaWZpZWQgdGV4dCBub2RlLlxuICovIGZ1bmN0aW9uIHJlbW92ZVBhcnRpYWxNZW50aW9uUG9zdEZpeGVyKHdyaXRlciwgZG9jLCBzY2hlbWEpIHtcbiAgICBjb25zdCBjaGFuZ2VzID0gZG9jLmRpZmZlci5nZXRDaGFuZ2VzKCk7XG4gICAgbGV0IHdhc0NoYW5nZWQgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IGNoYW5nZSBvZiBjaGFuZ2VzKXtcbiAgICAgICAgaWYgKGNoYW5nZS50eXBlID09ICdhdHRyaWJ1dGUnKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVja3MgdGhlIHRleHQgbm9kZSBvbiB0aGUgY3VycmVudCBwb3NpdGlvbi5cbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBjaGFuZ2UucG9zaXRpb247XG4gICAgICAgIGlmIChjaGFuZ2UubmFtZSA9PSAnJHRleHQnKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXJJbnNlcnRlZFRleHROb2RlID0gcG9zaXRpb24udGV4dE5vZGUgJiYgcG9zaXRpb24udGV4dE5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAgICAgICAvLyBDaGVja3MgdGhlIHRleHQgbm9kZSB3aGVyZSB0aGUgY2hhbmdlIG9jY3VycmVkLlxuICAgICAgICAgICAgd2FzQ2hhbmdlZCA9IGNoZWNrQW5kRml4KHBvc2l0aW9uLnRleHROb2RlLCB3cml0ZXIpIHx8IHdhc0NoYW5nZWQ7XG4gICAgICAgICAgICAvLyBPY2N1cnMgb24gcGFzdGUgaW5zaWRlIGEgdGV4dCBub2RlIHdpdGggbWVudGlvbi5cbiAgICAgICAgICAgIHdhc0NoYW5nZWQgPSBjaGVja0FuZEZpeChub2RlQWZ0ZXJJbnNlcnRlZFRleHROb2RlLCB3cml0ZXIpIHx8IHdhc0NoYW5nZWQ7XG4gICAgICAgICAgICB3YXNDaGFuZ2VkID0gY2hlY2tBbmRGaXgocG9zaXRpb24ubm9kZUJlZm9yZSwgd3JpdGVyKSB8fCB3YXNDaGFuZ2VkO1xuICAgICAgICAgICAgd2FzQ2hhbmdlZCA9IGNoZWNrQW5kRml4KHBvc2l0aW9uLm5vZGVBZnRlciwgd3JpdGVyKSB8fCB3YXNDaGFuZ2VkO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrcyB0ZXh0IG5vZGVzIGluIGluc2VydGVkIGVsZW1lbnRzIChtaWdodCBvY2N1ciB3aGVuIHNwbGl0dGluZyBhIHBhcmFncmFwaCBvciBwYXN0aW5nIGNvbnRlbnQgaW5zaWRlIHRleHQgd2l0aCBtZW50aW9uKS5cbiAgICAgICAgaWYgKGNoYW5nZS5uYW1lICE9ICckdGV4dCcgJiYgY2hhbmdlLnR5cGUgPT0gJ2luc2VydCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGluc2VydGVkTm9kZSA9IHBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB3cml0ZXIuY3JlYXRlUmFuZ2VJbihpbnNlcnRlZE5vZGUpLmdldEl0ZW1zKCkpe1xuICAgICAgICAgICAgICAgIHdhc0NoYW5nZWQgPSBjaGVja0FuZEZpeChpdGVtLCB3cml0ZXIpIHx8IHdhc0NoYW5nZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5zZXJ0ZWQgaW5saW5lIGVsZW1lbnRzIG1pZ2h0IGJyZWFrIG1lbnRpb24uXG4gICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PSAnaW5zZXJ0JyAmJiBzY2hlbWEuaXNJbmxpbmUoY2hhbmdlLm5hbWUpKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXJJbnNlcnRlZCA9IHBvc2l0aW9uLm5vZGVBZnRlciAmJiBwb3NpdGlvbi5ub2RlQWZ0ZXIubmV4dFNpYmxpbmc7XG4gICAgICAgICAgICB3YXNDaGFuZ2VkID0gY2hlY2tBbmRGaXgocG9zaXRpb24ubm9kZUJlZm9yZSwgd3JpdGVyKSB8fCB3YXNDaGFuZ2VkO1xuICAgICAgICAgICAgd2FzQ2hhbmdlZCA9IGNoZWNrQW5kRml4KG5vZGVBZnRlckluc2VydGVkLCB3cml0ZXIpIHx8IHdhc0NoYW5nZWQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHdhc0NoYW5nZWQ7XG59XG4vKipcbiAqIFRoaXMgcG9zdC1maXhlciB3aWxsIGV4dGVuZCB0aGUgYXR0cmlidXRlIGFwcGxpZWQgb24gdGhlIHBhcnQgb2YgdGhlIG1lbnRpb24gc28gdGhlIHdob2xlIHRleHQgbm9kZSBvZiB0aGUgbWVudGlvbiB3aWxsIGhhdmVcbiAqIHRoZSBhZGRlZCBhdHRyaWJ1dGUuXG4gKi8gZnVuY3Rpb24gZXh0ZW5kQXR0cmlidXRlT25NZW50aW9uUG9zdEZpeGVyKHdyaXRlciwgZG9jKSB7XG4gICAgY29uc3QgY2hhbmdlcyA9IGRvYy5kaWZmZXIuZ2V0Q2hhbmdlcygpO1xuICAgIGxldCB3YXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgY2hhbmdlcyl7XG4gICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gJ2F0dHJpYnV0ZScgJiYgY2hhbmdlLmF0dHJpYnV0ZUtleSAhPSAnbWVudGlvbicpIHtcbiAgICAgICAgICAgIC8vIENoZWNrcyB0aGUgbm9kZSBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSByYW5nZS4uLlxuICAgICAgICAgICAgY29uc3Qgbm9kZUJlZm9yZSA9IGNoYW5nZS5yYW5nZS5zdGFydC5ub2RlQmVmb3JlO1xuICAgICAgICAgICAgLy8gLi4uIGFuZCBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgcmFuZ2UuXG4gICAgICAgICAgICBjb25zdCBub2RlQWZ0ZXIgPSBjaGFuZ2UucmFuZ2UuZW5kLm5vZGVBZnRlcjtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBbXG4gICAgICAgICAgICAgICAgbm9kZUJlZm9yZSxcbiAgICAgICAgICAgICAgICBub2RlQWZ0ZXJcbiAgICAgICAgICAgIF0pe1xuICAgICAgICAgICAgICAgIGlmIChpc0Jyb2tlbk1lbnRpb25Ob2RlKG5vZGUpICYmIG5vZGUuZ2V0QXR0cmlidXRlKGNoYW5nZS5hdHRyaWJ1dGVLZXkpICE9IGNoYW5nZS5hdHRyaWJ1dGVOZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuc2V0QXR0cmlidXRlKGNoYW5nZS5hdHRyaWJ1dGVLZXksIGNoYW5nZS5hdHRyaWJ1dGVOZXdWYWx1ZSwgbm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIHdhc0NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gd2FzQ2hhbmdlZDtcbn1cbi8qKlxuICogQ2hlY2tzIGlmIGEgbm9kZSBoYXMgYSBjb3JyZWN0IG1lbnRpb24gYXR0cmlidXRlIGlmIHByZXNlbnQuXG4gKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgbm9kZSBpcyB0ZXh0IGFuZCBoYXMgYSBtZW50aW9uIGF0dHJpYnV0ZSB3aG9zZSB0ZXh0IGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBtZW50aW9uIHRleHQuXG4gKi8gZnVuY3Rpb24gaXNCcm9rZW5NZW50aW9uTm9kZShub2RlKSB7XG4gICAgaWYgKCFub2RlIHx8ICEobm9kZS5pcygnJHRleHQnKSB8fCBub2RlLmlzKCckdGV4dFByb3h5JykpIHx8ICFub2RlLmhhc0F0dHJpYnV0ZSgnbWVudGlvbicpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgdGV4dCA9IG5vZGUuZGF0YTtcbiAgICBjb25zdCBtZW50aW9uID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ21lbnRpb24nKTtcbiAgICBjb25zdCBleHBlY3RlZFRleHQgPSBtZW50aW9uLl90ZXh0O1xuICAgIHJldHVybiB0ZXh0ICE9IGV4cGVjdGVkVGV4dDtcbn1cbi8qKlxuICogRml4ZXMgYSBtZW50aW9uIG9uIGEgdGV4dCBub2RlIGlmIGl0IG5lZWRzIGEgZml4LlxuICovIGZ1bmN0aW9uIGNoZWNrQW5kRml4KHRleHROb2RlLCB3cml0ZXIpIHtcbiAgICBpZiAoaXNCcm9rZW5NZW50aW9uTm9kZSh0ZXh0Tm9kZSkpIHtcbiAgICAgICAgd3JpdGVyLnJlbW92ZUF0dHJpYnV0ZSgnbWVudGlvbicsIHRleHROb2RlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBUaGUgbWVudGlvbiB1aSB2aWV3LlxuICovIGNsYXNzIE1lbnRpb25zVmlldyBleHRlbmRzIExpc3RWaWV3IHtcbiAgICBzZWxlY3RlZDtcbiAgICBwb3NpdGlvbjtcbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNvbnN0cnVjdG9yKGxvY2FsZSl7XG4gICAgICAgIHN1cGVyKGxvY2FsZSk7XG4gICAgICAgIHRoaXMuZXh0ZW5kVGVtcGxhdGUoe1xuICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgIGNsYXNzOiBbXG4gICAgICAgICAgICAgICAgICAgICdjay1tZW50aW9ucydcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHRhYmluZGV4OiAnLTEnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICoge0BsaW5rICNzZWxlY3QgU2VsZWN0c30gdGhlIGZpcnN0IGl0ZW0uXG5cdCAqLyBzZWxlY3RGaXJzdCgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3QoMCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWxlY3RzIG5leHQgaXRlbSB0byB0aGUgY3VycmVudGx5IHtAbGluayAjc2VsZWN0IHNlbGVjdGVkfS5cblx0ICpcblx0ICogSWYgdGhlIGxhc3QgaXRlbSBpcyBhbHJlYWR5IHNlbGVjdGVkLCBpdCB3aWxsIHNlbGVjdCB0aGUgZmlyc3QgaXRlbS5cblx0ICovIHNlbGVjdE5leHQoKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuaXRlbXMuZ2V0SW5kZXgoaXRlbSk7XG4gICAgICAgIHRoaXMuc2VsZWN0KGluZGV4ICsgMSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBTZWxlY3RzIHByZXZpb3VzIGl0ZW0gdG8gdGhlIGN1cnJlbnRseSB7QGxpbmsgI3NlbGVjdCBzZWxlY3RlZH0uXG5cdCAqXG5cdCAqIElmIHRoZSBmaXJzdCBpdGVtIGlzIGFscmVhZHkgc2VsZWN0ZWQsIGl0IHdpbGwgc2VsZWN0IHRoZSBsYXN0IGl0ZW0uXG5cdCAqLyBzZWxlY3RQcmV2aW91cygpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pdGVtcy5nZXRJbmRleChpdGVtKTtcbiAgICAgICAgdGhpcy5zZWxlY3QoaW5kZXggLSAxKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIE1hcmtzIGl0ZW0gYXQgYSBnaXZlbiBpbmRleCBhcyBzZWxlY3RlZC5cblx0ICpcblx0ICogSGFuZGxlcyBzZWxlY3Rpb24gY3ljbGluZyB3aGVuIHBhc3NlZCBpbmRleCBpcyBvdXQgb2YgYm91bmRzOlxuXHQgKiAtIGlmIHRoZSBpbmRleCBpcyBsb3dlciB0aGFuIDAsIGl0IHdpbGwgc2VsZWN0IHRoZSBsYXN0IGl0ZW0sXG5cdCAqIC0gaWYgdGhlIGluZGV4IGlzIGhpZ2hlciB0aGFuIHRoZSBsYXN0IGl0ZW0gaW5kZXgsIGl0IHdpbGwgc2VsZWN0IHRoZSBmaXJzdCBpdGVtLlxuXHQgKlxuXHQgKiBAcGFyYW0gaW5kZXggSW5kZXggb2YgYW4gaXRlbSB0byBiZSBtYXJrZWQgYXMgc2VsZWN0ZWQuXG5cdCAqLyBzZWxlY3QoaW5kZXgpIHtcbiAgICAgICAgbGV0IGluZGV4VG9HZXQgPSAwO1xuICAgICAgICBpZiAoaW5kZXggPiAwICYmIGluZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGluZGV4VG9HZXQgPSBpbmRleDtcbiAgICAgICAgfSBlbHNlIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgICAgIGluZGV4VG9HZXQgPSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuaXRlbXMuZ2V0KGluZGV4VG9HZXQpO1xuICAgICAgICAvLyBSZXR1cm4gZWFybHkgaWYgaXRlbSBpcyBhbHJlYWR5IHNlbGVjdGVkLlxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZCA9PT0gaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlbW92ZSBoaWdobGlnaHQgb2YgcHJldmlvdXNseSBzZWxlY3RlZCBpdGVtLlxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZC5yZW1vdmVIaWdobGlnaHQoKTtcbiAgICAgICAgfVxuICAgICAgICBpdGVtLmhpZ2hsaWdodCgpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gaXRlbTtcbiAgICAgICAgLy8gU2Nyb2xsIHRoZSBtZW50aW9ucyB2aWV3IHRvIHRoZSBzZWxlY3RlZCBlbGVtZW50LlxuICAgICAgICBpZiAoIXRoaXMuX2lzSXRlbVZpc2libGVJblNjcm9sbGVkQXJlYShpdGVtKSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnNjcm9sbFRvcCA9IGl0ZW0uZWxlbWVudC5vZmZzZXRUb3A7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG5cdCAqIFRyaWdnZXJzIHRoZSBgZXhlY3V0ZWAgZXZlbnQgb24gdGhlIHtAbGluayAjc2VsZWN0IHNlbGVjdGVkfSBpdGVtLlxuXHQgKi8gZXhlY3V0ZVNlbGVjdGVkKCkge1xuICAgICAgICB0aGlzLnNlbGVjdGVkLmZpcmUoJ2V4ZWN1dGUnKTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIENoZWNrcyBpZiBhbiBpdGVtIGlzIHZpc2libGUgaW4gdGhlIHNjcm9sbGFibGUgYXJlYS5cblx0ICpcblx0ICogVGhlIGl0ZW0gaXMgY29uc2lkZXJlZCB2aXNpYmxlIHdoZW46XG5cdCAqIC0gaXRzIHRvcCBib3VuZGFyeSBpcyBpbnNpZGUgdGhlIHNjcm9sbGFibGUgcmVjdFxuXHQgKiAtIGl0cyBib3R0b20gYm91bmRhcnkgaXMgaW5zaWRlIHRoZSBzY3JvbGxhYmxlIHJlY3QgKHRoZSB3aG9sZSBpdGVtIG11c3QgYmUgdmlzaWJsZSlcblx0ICovIF9pc0l0ZW1WaXNpYmxlSW5TY3JvbGxlZEFyZWEoaXRlbSkge1xuICAgICAgICByZXR1cm4gbmV3IFJlY3QodGhpcy5lbGVtZW50KS5jb250YWlucyhuZXcgUmVjdChpdGVtLmVsZW1lbnQpKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyB3cmFwcyBET00gZWxlbWVudCBhcyBhIENLRWRpdG9yNSBVSSBWaWV3LlxuICpcbiAqIEl0IGFsbG93cyB0byByZW5kZXIgYW55IERPTSBlbGVtZW50IGFuZCB1c2UgaXQgaW4gbWVudGlvbnMgbGlzdC5cbiAqLyBjbGFzcyBEb21XcmFwcGVyVmlldyBleHRlbmRzIFZpZXcge1xuICAgIC8qKlxuXHQgKiBUaGUgRE9NIGVsZW1lbnQgZm9yIHdoaWNoIHdyYXBwZXIgd2FzIGNyZWF0ZWQuXG5cdCAqLyBkb21FbGVtZW50O1xuICAgIC8qKlxuXHQgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIHtAbGluayBtb2R1bGU6bWVudGlvbi91aS9kb213cmFwcGVydmlld35Eb21XcmFwcGVyVmlld30gY2xhc3MuXG5cdCAqXG5cdCAqIEFsc28gc2VlIHtAbGluayAjcmVuZGVyfS5cblx0ICovIGNvbnN0cnVjdG9yKGxvY2FsZSwgZG9tRWxlbWVudCl7XG4gICAgICAgIHN1cGVyKGxvY2FsZSk7XG4gICAgICAgIC8vIERpc2FibGUgdGVtcGxhdGUgcmVuZGVyaW5nIG9uIHRoaXMgdmlldy5cbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9tRWxlbWVudDtcbiAgICAgICAgLy8gUmVuZGVyIGRvbSB3cmFwcGVyIGFzIGEgYnV0dG9uLlxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY2stYnV0dG9uJyk7XG4gICAgICAgIHRoaXMuc2V0KCdpc09uJywgZmFsc2UpO1xuICAgICAgICAvLyBIYW5kbGUgaXNPbiBzdGF0ZSBhcyBpbiBidXR0b25zLlxuICAgICAgICB0aGlzLm9uKCdjaGFuZ2U6aXNPbicsIChldnQsIG5hbWUsIGlzT24pPT57XG4gICAgICAgICAgICBpZiAoaXNPbikge1xuICAgICAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdjay1vbicpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjay1vZmYnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2NrLW9mZicpO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjay1vbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gUGFzcyBjbGljayBldmVudCBhcyBleGVjdXRlIGV2ZW50LlxuICAgICAgICB0aGlzLmxpc3RlblRvKHRoaXMuZG9tRWxlbWVudCwgJ2NsaWNrJywgKCk9PntcbiAgICAgICAgICAgIHRoaXMuZmlyZSgnZXhlY3V0ZScpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyByZW5kZXIoKSB7XG4gICAgICAgIHN1cGVyLnJlbmRlcigpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLmRvbUVsZW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBGb2N1c2VzIHRoZSBET00gZWxlbWVudC5cblx0ICovIGZvY3VzKCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG59XG5cbmNsYXNzIE1lbnRpb25MaXN0SXRlbVZpZXcgZXh0ZW5kcyBMaXN0SXRlbVZpZXcge1xuICAgIGl0ZW07XG4gICAgbWFya2VyO1xuICAgIGhpZ2hsaWdodCgpIHtcbiAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmZpcnN0O1xuICAgICAgICBjaGlsZC5pc09uID0gdHJ1ZTtcbiAgICB9XG4gICAgcmVtb3ZlSGlnaGxpZ2h0KCkge1xuICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZmlyc3Q7XG4gICAgICAgIGNoaWxkLmlzT24gPSBmYWxzZTtcbiAgICB9XG59XG5cbmNvbnN0IFZFUlRJQ0FMX1NQQUNJTkcgPSAzO1xuLy8gVGhlIGtleSBjb2RlcyB0aGF0IG1lbnRpb24gVUkgaGFuZGxlcyB3aGVuIGl0IGlzIG9wZW4gKHdpdGhvdXQgY29tbWl0IGtleXMpLlxuY29uc3QgZGVmYXVsdEhhbmRsZWRLZXlDb2RlcyA9IFtcbiAgICBrZXlDb2Rlcy5hcnJvd3VwLFxuICAgIGtleUNvZGVzLmFycm93ZG93bixcbiAgICBrZXlDb2Rlcy5lc2Ncbl07XG4vLyBEcm9wZG93biBjb21taXQga2V5IGNvZGVzLlxuY29uc3QgZGVmYXVsdENvbW1pdEtleUNvZGVzID0gW1xuICAgIGtleUNvZGVzLmVudGVyLFxuICAgIGtleUNvZGVzLnRhYlxuXTtcbi8qKlxuICogVGhlIG1lbnRpb24gVUkgZmVhdHVyZS5cbiAqLyBjbGFzcyBNZW50aW9uVUkgZXh0ZW5kcyBQbHVnaW4ge1xuICAgIC8qKlxuXHQgKiBUaGUgbWVudGlvbiB2aWV3LlxuXHQgKi8gX21lbnRpb25zVmlldztcbiAgICAvKipcblx0ICogU3RvcmVzIG1lbnRpb24gZmVlZHMgY29uZmlndXJhdGlvbnMuXG5cdCAqLyBfbWVudGlvbnNDb25maWd1cmF0aW9ucztcbiAgICAvKipcblx0ICogVGhlIGNvbnRleHR1YWwgYmFsbG9vbiBwbHVnaW4gaW5zdGFuY2UuXG5cdCAqLyBfYmFsbG9vbjtcbiAgICBfaXRlbXMgPSBuZXcgQ29sbGVjdGlvbigpO1xuICAgIF9sYXN0UmVxdWVzdGVkO1xuICAgIC8qKlxuXHQgKiBEZWJvdW5jZWQgZmVlZCByZXF1ZXN0ZXIuIEl0IHVzZXMgYGxvZGFzaCNkZWJvdW5jZWAgbWV0aG9kIHRvIGRlbGF5IGZ1bmN0aW9uIGNhbGwuXG5cdCAqLyBfcmVxdWVzdEZlZWREZWJvdW5jZWQ7XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IHBsdWdpbk5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnTWVudGlvblVJJztcbiAgICB9XG4gICAgLyoqXG5cdCAqIEBpbmhlcml0RG9jXG5cdCAqLyBzdGF0aWMgZ2V0IGlzT2ZmaWNpYWxQbHVnaW4oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgcmVxdWlyZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBDb250ZXh0dWFsQmFsbG9vblxuICAgICAgICBdO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGNvbnN0cnVjdG9yKGVkaXRvcil7XG4gICAgICAgIHN1cGVyKGVkaXRvcik7XG4gICAgICAgIHRoaXMuX21lbnRpb25zVmlldyA9IHRoaXMuX2NyZWF0ZU1lbnRpb25WaWV3KCk7XG4gICAgICAgIHRoaXMuX21lbnRpb25zQ29uZmlndXJhdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMuX3JlcXVlc3RGZWVkRGVib3VuY2VkID0gZGVib3VuY2UodGhpcy5fcmVxdWVzdEZlZWQsIDEwMCk7XG4gICAgICAgIGVkaXRvci5jb25maWcuZGVmaW5lKCdtZW50aW9uJywge1xuICAgICAgICAgICAgZmVlZHM6IFtdXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGluaXQoKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBjb21taXRLZXlzID0gZWRpdG9yLmNvbmZpZy5nZXQoJ21lbnRpb24uY29tbWl0S2V5cycpIHx8IGRlZmF1bHRDb21taXRLZXlDb2RlcztcbiAgICAgICAgY29uc3QgaGFuZGxlZEtleUNvZGVzID0gZGVmYXVsdEhhbmRsZWRLZXlDb2Rlcy5jb25jYXQoY29tbWl0S2V5cyk7XG4gICAgICAgIHRoaXMuX2JhbGxvb24gPSBlZGl0b3IucGx1Z2lucy5nZXQoQ29udGV4dHVhbEJhbGxvb24pO1xuICAgICAgICAvLyBLZXkgbGlzdGVuZXIgdGhhdCBoYW5kbGVzIG5hdmlnYXRpb24gaW4gbWVudGlvbiB2aWV3LlxuICAgICAgICBlZGl0b3IuZWRpdGluZy52aWV3LmRvY3VtZW50Lm9uKCdrZXlkb3duJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgIGlmIChpc0hhbmRsZWRLZXkoZGF0YS5rZXlDb2RlKSAmJiB0aGlzLl9pc1VJVmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIGRhdGEucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldnQuc3RvcCgpOyAvLyBSZXF1aXJlZCBmb3IgRW50ZXIga2V5IG92ZXJyaWRpbmcuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd2Rvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWVudGlvbnNWaWV3LnNlbGVjdE5leHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5hcnJvd3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21lbnRpb25zVmlldy5zZWxlY3RQcmV2aW91cygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29tbWl0S2V5cy5pbmNsdWRlcyhkYXRhLmtleUNvZGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21lbnRpb25zVmlldy5leGVjdXRlU2VsZWN0ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEua2V5Q29kZSA9PSBrZXlDb2Rlcy5lc2MpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZVVJQW5kUmVtb3ZlTWFya2VyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2hlc3QnXG4gICAgICAgIH0pOyAvLyBSZXF1aXJlZCB0byBvdmVycmlkZSB0aGUgRW50ZXIga2V5LlxuICAgICAgICAvLyBDbG9zZSB0aGUgZHJvcGRvd24gdXBvbiBjbGlja2luZyBvdXRzaWRlIG9mIHRoZSBwbHVnaW4gVUkuXG4gICAgICAgIGNsaWNrT3V0c2lkZUhhbmRsZXIoe1xuICAgICAgICAgICAgZW1pdHRlcjogdGhpcy5fbWVudGlvbnNWaWV3LFxuICAgICAgICAgICAgYWN0aXZhdG9yOiAoKT0+dGhpcy5faXNVSVZpc2libGUsXG4gICAgICAgICAgICBjb250ZXh0RWxlbWVudHM6ICgpPT5bXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2JhbGxvb24udmlldy5lbGVtZW50XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoKT0+dGhpcy5faGlkZVVJQW5kUmVtb3ZlTWFya2VyKClcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGZlZWRzID0gZWRpdG9yLmNvbmZpZy5nZXQoJ21lbnRpb24uZmVlZHMnKTtcbiAgICAgICAgZm9yIChjb25zdCBtZW50aW9uRGVzY3JpcHRpb24gb2YgZmVlZHMpe1xuICAgICAgICAgICAgY29uc3QgeyBmZWVkLCBtYXJrZXIsIGRyb3Bkb3duTGltaXQgfSA9IG1lbnRpb25EZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIGlmICghaXNWYWxpZE1lbnRpb25NYXJrZXIobWFya2VyKSkge1xuICAgICAgICAgICAgICAgIC8qKlxuXHRcdFx0XHQgKiBUaGUgbWFya2VyIG11c3QgYmUgYSBzaW5nbGUgY2hhcmFjdGVyLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBDb3JyZWN0IG1hcmtlcnM6IGAnQCdgLCBgJyMnYC5cblx0XHRcdFx0ICpcblx0XHRcdFx0ICogSW5jb3JyZWN0IG1hcmtlcnM6IGAnJCQnYCwgYCdbQCdgLlxuXHRcdFx0XHQgKlxuXHRcdFx0XHQgKiBTZWUge0BsaW5rIG1vZHVsZTptZW50aW9uL21lbnRpb25jb25maWd+TWVudGlvbkNvbmZpZ30uXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIEBlcnJvciBtZW50aW9uY29uZmlnLWluY29ycmVjdC1tYXJrZXJcblx0XHRcdFx0ICogQHBhcmFtIG1hcmtlciBDb25maWd1cmVkIG1hcmtlclxuXHRcdFx0XHQgKi8gdGhyb3cgbmV3IENLRWRpdG9yRXJyb3IoJ21lbnRpb25jb25maWctaW5jb3JyZWN0LW1hcmtlcicsIG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBmZWVkQ2FsbGJhY2sgPSB0eXBlb2YgZmVlZCA9PSAnZnVuY3Rpb24nID8gZmVlZC5iaW5kKHRoaXMuZWRpdG9yKSA6IGNyZWF0ZUZlZWRDYWxsYmFjayhmZWVkKTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1SZW5kZXJlciA9IG1lbnRpb25EZXNjcmlwdGlvbi5pdGVtUmVuZGVyZXI7XG4gICAgICAgICAgICBjb25zdCBkZWZpbml0aW9uID0ge1xuICAgICAgICAgICAgICAgIG1hcmtlcixcbiAgICAgICAgICAgICAgICBmZWVkQ2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgaXRlbVJlbmRlcmVyLFxuICAgICAgICAgICAgICAgIGRyb3Bkb3duTGltaXRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLl9tZW50aW9uc0NvbmZpZ3VyYXRpb25zLnNldChtYXJrZXIsIGRlZmluaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NldHVwVGV4dFdhdGNoZXIoZmVlZHMpO1xuICAgICAgICB0aGlzLmxpc3RlblRvKGVkaXRvciwgJ2NoYW5nZTppc1JlYWRPbmx5JywgKCk9PntcbiAgICAgICAgICAgIHRoaXMuX2hpZGVVSUFuZFJlbW92ZU1hcmtlcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vbigncmVxdWVzdEZlZWQ6cmVzcG9uc2UnLCAoZXZ0LCBkYXRhKT0+dGhpcy5faGFuZGxlRmVlZFJlc3BvbnNlKGRhdGEpKTtcbiAgICAgICAgdGhpcy5vbigncmVxdWVzdEZlZWQ6ZXJyb3InLCAoKT0+dGhpcy5faGlkZVVJQW5kUmVtb3ZlTWFya2VyKCkpO1xuICAgICAgICAvKipcblx0XHQgKiBDaGVja3MgaWYgYSBnaXZlbiBrZXkgY29kZSBpcyBoYW5kbGVkIGJ5IHRoZSBtZW50aW9uIFVJLlxuXHRcdCAqLyBmdW5jdGlvbiBpc0hhbmRsZWRLZXkoa2V5Q29kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZWRLZXlDb2Rlcy5pbmNsdWRlcyhrZXlDb2RlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIGRlc3Ryb3koKSB7XG4gICAgICAgIHN1cGVyLmRlc3Ryb3koKTtcbiAgICAgICAgLy8gRGVzdHJveSBjcmVhdGVkIFVJIGNvbXBvbmVudHMgYXMgdGhleSBhcmUgbm90IGF1dG9tYXRpY2FsbHkgZGVzdHJveWVkIChzZWUgY2tlZGl0b3I1IzEzNDEpLlxuICAgICAgICB0aGlzLl9tZW50aW9uc1ZpZXcuZGVzdHJveSgpO1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyB0cnVlIHdoZW4ge0BsaW5rICNfbWVudGlvbnNWaWV3fSBpcyBpbiB0aGUge0BsaW5rIG1vZHVsZTp1aS9wYW5lbC9iYWxsb29uL2NvbnRleHR1YWxiYWxsb29ufkNvbnRleHR1YWxCYWxsb29ufSBhbmQgaXQgaXNcblx0ICogY3VycmVudGx5IHZpc2libGUuXG5cdCAqLyBnZXQgX2lzVUlWaXNpYmxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYmFsbG9vbi52aXNpYmxlVmlldyA9PT0gdGhpcy5fbWVudGlvbnNWaWV3O1xuICAgIH1cbiAgICAvKipcblx0ICogQ3JlYXRlcyB0aGUge0BsaW5rICNfbWVudGlvbnNWaWV3fS5cblx0ICovIF9jcmVhdGVNZW50aW9uVmlldygpIHtcbiAgICAgICAgY29uc3QgbG9jYWxlID0gdGhpcy5lZGl0b3IubG9jYWxlO1xuICAgICAgICBjb25zdCBtZW50aW9uc1ZpZXcgPSBuZXcgTWVudGlvbnNWaWV3KGxvY2FsZSk7XG4gICAgICAgIG1lbnRpb25zVmlldy5pdGVtcy5iaW5kVG8odGhpcy5faXRlbXMpLnVzaW5nKChkYXRhKT0+e1xuICAgICAgICAgICAgY29uc3QgeyBpdGVtLCBtYXJrZXIgfSA9IGRhdGE7XG4gICAgICAgICAgICBjb25zdCB7IGRyb3Bkb3duTGltaXQ6IG1hcmtlckRyb3Bkb3duTGltaXQgfSA9IHRoaXMuX21lbnRpb25zQ29uZmlndXJhdGlvbnMuZ2V0KG1hcmtlcik7XG4gICAgICAgICAgICAvLyBTZXQgdG8gMTAgYnkgZGVmYXVsdCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuIFNlZTogIzEwNDc5XG4gICAgICAgICAgICBjb25zdCBkcm9wZG93bkxpbWl0ID0gbWFya2VyRHJvcGRvd25MaW1pdCB8fCB0aGlzLmVkaXRvci5jb25maWcuZ2V0KCdtZW50aW9uLmRyb3Bkb3duTGltaXQnKSB8fCAxMDtcbiAgICAgICAgICAgIGlmIChtZW50aW9uc1ZpZXcuaXRlbXMubGVuZ3RoID49IGRyb3Bkb3duTGltaXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGxpc3RJdGVtVmlldyA9IG5ldyBNZW50aW9uTGlzdEl0ZW1WaWV3KGxvY2FsZSk7XG4gICAgICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5fcmVuZGVySXRlbShpdGVtLCBtYXJrZXIpO1xuICAgICAgICAgICAgdmlldy5kZWxlZ2F0ZSgnZXhlY3V0ZScpLnRvKGxpc3RJdGVtVmlldyk7XG4gICAgICAgICAgICBsaXN0SXRlbVZpZXcuY2hpbGRyZW4uYWRkKHZpZXcpO1xuICAgICAgICAgICAgbGlzdEl0ZW1WaWV3Lml0ZW0gPSBpdGVtO1xuICAgICAgICAgICAgbGlzdEl0ZW1WaWV3Lm1hcmtlciA9IG1hcmtlcjtcbiAgICAgICAgICAgIGxpc3RJdGVtVmlldy5vbignZXhlY3V0ZScsICgpPT57XG4gICAgICAgICAgICAgICAgbWVudGlvbnNWaWV3LmZpcmUoJ2V4ZWN1dGUnLCB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlclxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbGlzdEl0ZW1WaWV3O1xuICAgICAgICB9KTtcbiAgICAgICAgbWVudGlvbnNWaWV3Lm9uKCdleGVjdXRlJywgKGV2dCwgZGF0YSk9PntcbiAgICAgICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICAgICAgY29uc3QgbW9kZWwgPSBlZGl0b3IubW9kZWw7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gZGF0YS5pdGVtO1xuICAgICAgICAgICAgY29uc3QgbWFya2VyID0gZGF0YS5tYXJrZXI7XG4gICAgICAgICAgICBjb25zdCBtZW50aW9uTWFya2VyID0gZWRpdG9yLm1vZGVsLm1hcmtlcnMuZ2V0KCdtZW50aW9uJyk7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSByYW5nZSBvbiBtYXRjaGVkIHRleHQuXG4gICAgICAgICAgICBjb25zdCBlbmQgPSBtb2RlbC5jcmVhdGVQb3NpdGlvbkF0KG1vZGVsLmRvY3VtZW50LnNlbGVjdGlvbi5mb2N1cyk7XG4gICAgICAgICAgICBjb25zdCBzdGFydCA9IG1vZGVsLmNyZWF0ZVBvc2l0aW9uQXQobWVudGlvbk1hcmtlci5nZXRTdGFydCgpKTtcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlID0gbW9kZWwuY3JlYXRlUmFuZ2Uoc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICB0aGlzLl9oaWRlVUlBbmRSZW1vdmVNYXJrZXIoKTtcbiAgICAgICAgICAgIGVkaXRvci5leGVjdXRlKCdtZW50aW9uJywge1xuICAgICAgICAgICAgICAgIG1lbnRpb246IGl0ZW0sXG4gICAgICAgICAgICAgICAgdGV4dDogaXRlbS50ZXh0LFxuICAgICAgICAgICAgICAgIG1hcmtlcixcbiAgICAgICAgICAgICAgICByYW5nZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlZGl0b3IuZWRpdGluZy52aWV3LmZvY3VzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVudGlvbnNWaWV3O1xuICAgIH1cbiAgICAvKipcblx0ICogUmV0dXJucyBpdGVtIHJlbmRlcmVyIGZvciB0aGUgbWFya2VyLlxuXHQgKi8gX2dldEl0ZW1SZW5kZXJlcihtYXJrZXIpIHtcbiAgICAgICAgY29uc3QgeyBpdGVtUmVuZGVyZXIgfSA9IHRoaXMuX21lbnRpb25zQ29uZmlndXJhdGlvbnMuZ2V0KG1hcmtlcik7XG4gICAgICAgIHJldHVybiBpdGVtUmVuZGVyZXI7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBSZXF1ZXN0cyBhIGZlZWQgZnJvbSBhIGNvbmZpZ3VyZWQgY2FsbGJhY2tzLlxuXHQgKi8gX3JlcXVlc3RGZWVkKG1hcmtlciwgZmVlZFRleHQpIHtcbiAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICclY1tGZWVkXSVjIFJlcXVlc3RpbmcgZm9yJywgJ2NvbG9yOiBibHVlJywgJ2NvbG9yOiBibGFjaycsIGBcIiR7IGZlZWRUZXh0IH1cImAgKTtcbiAgICAgICAgLy8gU3RvcmUgdGhlIGxhc3QgcmVxdWVzdGVkIGZlZWQgLSBpdCBpcyB1c2VkIHRvIGRpc2NhcmQgYW55IG91dC1vZiBvcmRlciByZXF1ZXN0cy5cbiAgICAgICAgdGhpcy5fbGFzdFJlcXVlc3RlZCA9IGZlZWRUZXh0O1xuICAgICAgICBjb25zdCB7IGZlZWRDYWxsYmFjayB9ID0gdGhpcy5fbWVudGlvbnNDb25maWd1cmF0aW9ucy5nZXQobWFya2VyKTtcbiAgICAgICAgY29uc3QgZmVlZFJlc3BvbnNlID0gZmVlZENhbGxiYWNrKGZlZWRUZXh0KTtcbiAgICAgICAgY29uc3QgaXNBc3luY2hyb25vdXMgPSBmZWVkUmVzcG9uc2UgaW5zdGFuY2VvZiBQcm9taXNlO1xuICAgICAgICAvLyBGb3Igc3luY2hyb25vdXMgZmVlZHMgKGUuZy4gY2FsbGJhY2tzLCBhcnJheXMpIGZpcmUgdGhlIHJlc3BvbnNlIGV2ZW50IGltbWVkaWF0ZWx5LlxuICAgICAgICBpZiAoIWlzQXN5bmNocm9ub3VzKSB7XG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3JlcXVlc3RGZWVkOnJlc3BvbnNlJywge1xuICAgICAgICAgICAgICAgIGZlZWQ6IGZlZWRSZXNwb25zZSxcbiAgICAgICAgICAgICAgICBtYXJrZXIsXG4gICAgICAgICAgICAgICAgZmVlZFRleHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhhbmRsZSB0aGUgYXN5bmNocm9ub3VzIHJlc3BvbnNlcy5cbiAgICAgICAgZmVlZFJlc3BvbnNlLnRoZW4oKHJlc3BvbnNlKT0+e1xuICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIGZlZWQgdGV4dCBvZiB0aGlzIHJlc3BvbnNlIHdpdGggdGhlIGxhc3QgcmVxdWVzdGVkIG9uZSBzbyBlaXRoZXI6XG4gICAgICAgICAgICBpZiAodGhpcy5fbGFzdFJlcXVlc3RlZCA9PSBmZWVkVGV4dCkge1xuICAgICAgICAgICAgICAgIC8vIEl0IGlzIHRoZSBzYW1lIGFuZCBmaXJlIHRoZSByZXNwb25zZSBldmVudC5cbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3JlcXVlc3RGZWVkOnJlc3BvbnNlJywge1xuICAgICAgICAgICAgICAgICAgICBmZWVkOiByZXNwb25zZSxcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLFxuICAgICAgICAgICAgICAgICAgICBmZWVkVGV4dFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJdCBpcyBkaWZmZXJlbnQgLSBtb3N0IHByb2JhYmx5IG91dC1vZi1vcmRlciBvbmUsIHNvIGZpcmUgdGhlIGRpc2NhcmRlZCBldmVudC5cbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3JlcXVlc3RGZWVkOmRpc2NhcmRlZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgZmVlZDogcmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcixcbiAgICAgICAgICAgICAgICAgICAgZmVlZFRleHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKGVycm9yKT0+e1xuICAgICAgICAgICAgdGhpcy5maXJlKCdyZXF1ZXN0RmVlZDplcnJvcicsIHtcbiAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvKipcblx0XHRcdFx0ICogVGhlIGNhbGxiYWNrIHVzZWQgZm9yIG9idGFpbmluZyBtZW50aW9uIGF1dG9jb21wbGV0ZSBmZWVkIHRocm93biBhbmQgZXJyb3IgYW5kIHRoZSBtZW50aW9uIFVJIHdhcyBoaWRkZW4gb3Jcblx0XHRcdFx0ICogbm90IGRpc3BsYXllZCBhdCBhbGwuXG5cdFx0XHRcdCAqXG5cdFx0XHRcdCAqIEBlcnJvciBtZW50aW9uLWZlZWQtY2FsbGJhY2stZXJyb3Jcblx0XHRcdFx0ICovIGxvZ1dhcm5pbmcoJ21lbnRpb24tZmVlZC1jYWxsYmFjay1lcnJvcicsIHtcbiAgICAgICAgICAgICAgICBtYXJrZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlZ2lzdGVycyBhIHRleHQgd2F0Y2hlciBmb3IgdGhlIG1hcmtlci5cblx0ICovIF9zZXR1cFRleHRXYXRjaGVyKGZlZWRzKSB7XG4gICAgICAgIGNvbnN0IGVkaXRvciA9IHRoaXMuZWRpdG9yO1xuICAgICAgICBjb25zdCBmZWVkc1dpdGhQYXR0ZXJuID0gZmVlZHMubWFwKChmZWVkKT0+KHtcbiAgICAgICAgICAgICAgICAuLi5mZWVkLFxuICAgICAgICAgICAgICAgIHBhdHRlcm46IGNyZWF0ZVJlZ0V4cChmZWVkLm1hcmtlciwgZmVlZC5taW5pbXVtQ2hhcmFjdGVycyB8fCAwKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCB3YXRjaGVyID0gbmV3IFRleHRXYXRjaGVyKGVkaXRvci5tb2RlbCwgY3JlYXRlVGVzdENhbGxiYWNrKGZlZWRzV2l0aFBhdHRlcm4pKTtcbiAgICAgICAgd2F0Y2hlci5vbignbWF0Y2hlZCcsIChldnQsIGRhdGEpPT57XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJEZWZpbml0aW9uID0gZ2V0TGFzdFZhbGlkTWFya2VySW5UZXh0KGZlZWRzV2l0aFBhdHRlcm4sIGRhdGEudGV4dCk7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBlZGl0b3IubW9kZWwuZG9jdW1lbnQuc2VsZWN0aW9uO1xuICAgICAgICAgICAgY29uc3QgZm9jdXMgPSBzZWxlY3Rpb24uZm9jdXM7XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJQb3NpdGlvbiA9IGVkaXRvci5tb2RlbC5jcmVhdGVQb3NpdGlvbkF0KGZvY3VzLnBhcmVudCwgbWFya2VyRGVmaW5pdGlvbi5wb3NpdGlvbik7XG4gICAgICAgICAgICBpZiAoaXNQb3NpdGlvbkluRXhpc3RpbmdNZW50aW9uKGZvY3VzKSB8fCBpc01hcmtlckluRXhpc3RpbmdNZW50aW9uKG1hcmtlclBvc2l0aW9uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVVSUFuZFJlbW92ZU1hcmtlcigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZlZWRUZXh0ID0gcmVxdWVzdEZlZWRUZXh0KG1hcmtlckRlZmluaXRpb24sIGRhdGEudGV4dCk7XG4gICAgICAgICAgICBjb25zdCBtYXRjaGVkVGV4dExlbmd0aCA9IG1hcmtlckRlZmluaXRpb24ubWFya2VyLmxlbmd0aCArIGZlZWRUZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG1hcmtlciByYW5nZS5cbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gZm9jdXMuZ2V0U2hpZnRlZEJ5KC1tYXRjaGVkVGV4dExlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBmb2N1cy5nZXRTaGlmdGVkQnkoLWZlZWRUZXh0Lmxlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCBtYXJrZXJSYW5nZSA9IGVkaXRvci5tb2RlbC5jcmVhdGVSYW5nZShzdGFydCwgZW5kKTtcbiAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19NRU5USU9OIC8vIGNvbnNvbGUuZ3JvdXAoICclY1tUZXh0V2F0Y2hlcl0lYyBtYXRjaGVkJywgJ2NvbG9yOiByZWQnLCAnY29sb3I6IGJsYWNrJywgYFwiJHsgZmVlZFRleHQgfVwiYCApO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICdkYXRhI3RleHQnLCBgXCIkeyBkYXRhLnRleHQgfVwiYCApO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICdkYXRhI3JhbmdlJywgZGF0YS5yYW5nZS5zdGFydC5wYXRoLCBkYXRhLnJhbmdlLmVuZC5wYXRoICk7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmxvZyggJ21hcmtlciBkZWZpbml0aW9uJywgbWFya2VyRGVmaW5pdGlvbiApO1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICdtYXJrZXIgcmFuZ2UnLCBtYXJrZXJSYW5nZS5zdGFydC5wYXRoLCBtYXJrZXJSYW5nZS5lbmQucGF0aCApO1xuICAgICAgICAgICAgaWYgKGNoZWNrSWZTdGlsbEluQ29tcGxldGlvbk1vZGUoZWRpdG9yKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lbnRpb25NYXJrZXIgPSBlZGl0b3IubW9kZWwubWFya2Vycy5nZXQoJ21lbnRpb24nKTtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIG1hcmtlciAtIHVzZXIgbWlnaHQndmUgbW92ZWQgdGhlIHNlbGVjdGlvbiB0byBvdGhlciBtZW50aW9uIHRyaWdnZXIuXG4gICAgICAgICAgICAgICAgZWRpdG9yLm1vZGVsLmNoYW5nZSgod3JpdGVyKT0+e1xuICAgICAgICAgICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmxvZyggJyVjW0VkaXRpbmddJWMgVXBkYXRpbmcgdGhlIG1hcmtlci4nLCAnY29sb3I6IHB1cnBsZScsICdjb2xvcjogYmxhY2snICk7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci51cGRhdGVNYXJrZXIobWVudGlvbk1hcmtlciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IG1hcmtlclJhbmdlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlZGl0b3IubW9kZWwuY2hhbmdlKCh3cml0ZXIpPT57XG4gICAgICAgICAgICAgICAgICAgIC8vIEBpZiBDS19ERUJVR19NRU5USU9OIC8vIGNvbnNvbGUubG9nKCAnJWNbRWRpdGluZ10lYyBBZGRpbmcgdGhlIG1hcmtlci4nLCAnY29sb3I6IHB1cnBsZScsICdjb2xvcjogYmxhY2snICk7XG4gICAgICAgICAgICAgICAgICAgIHdyaXRlci5hZGRNYXJrZXIoJ21lbnRpb24nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByYW5nZTogbWFya2VyUmFuZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2luZ09wZXJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBhZmZlY3RzRGF0YTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0RmVlZERlYm91bmNlZChtYXJrZXJEZWZpbml0aW9uLm1hcmtlciwgZmVlZFRleHQpO1xuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB3YXRjaGVyLm9uKCd1bm1hdGNoZWQnLCAoKT0+e1xuICAgICAgICAgICAgdGhpcy5faGlkZVVJQW5kUmVtb3ZlTWFya2VyKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBtZW50aW9uQ29tbWFuZCA9IGVkaXRvci5jb21tYW5kcy5nZXQoJ21lbnRpb24nKTtcbiAgICAgICAgd2F0Y2hlci5iaW5kKCdpc0VuYWJsZWQnKS50byhtZW50aW9uQ29tbWFuZCk7XG4gICAgICAgIHJldHVybiB3YXRjaGVyO1xuICAgIH1cbiAgICAvKipcblx0ICogSGFuZGxlcyB0aGUgZmVlZCByZXNwb25zZSBldmVudCBkYXRhLlxuXHQgKi8gX2hhbmRsZUZlZWRSZXNwb25zZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IHsgZmVlZCwgbWFya2VyIH0gPSBkYXRhO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmxvZyggYCVjW0ZlZWRdJWMgUmVzcG9uc2UgZm9yIFwiJHsgZGF0YS5mZWVkVGV4dCB9XCIgKCR7IGZlZWQubGVuZ3RoIH0pYCwgJ2NvbG9yOiBibHVlJywgJ2NvbG9yOiBibGFjaycsIGZlZWQgKTtcbiAgICAgICAgLy8gSWYgdGhlIG1hcmtlciBpcyBub3QgaW4gdGhlIGRvY3VtZW50IGhhcHBlbnMgd2hlbiB0aGUgc2VsZWN0aW9uIGhhZCBjaGFuZ2VkIGFuZCB0aGUgJ21lbnRpb24nIG1hcmtlciB3YXMgcmVtb3ZlZC5cbiAgICAgICAgaWYgKCFjaGVja0lmU3RpbGxJbkNvbXBsZXRpb25Nb2RlKHRoaXMuZWRpdG9yKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIFJlc2V0IHRoZSB2aWV3LlxuICAgICAgICB0aGlzLl9pdGVtcy5jbGVhcigpO1xuICAgICAgICBmb3IgKGNvbnN0IGZlZWRJdGVtIG9mIGZlZWQpe1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHR5cGVvZiBmZWVkSXRlbSAhPSAnb2JqZWN0JyA/IHtcbiAgICAgICAgICAgICAgICBpZDogZmVlZEl0ZW0sXG4gICAgICAgICAgICAgICAgdGV4dDogZmVlZEl0ZW1cbiAgICAgICAgICAgIH0gOiBmZWVkSXRlbTtcbiAgICAgICAgICAgIHRoaXMuX2l0ZW1zLmFkZCh7XG4gICAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgICBtYXJrZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lbnRpb25NYXJrZXIgPSB0aGlzLmVkaXRvci5tb2RlbC5tYXJrZXJzLmdldCgnbWVudGlvbicpO1xuICAgICAgICBpZiAodGhpcy5faXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9zaG93T3JVcGRhdGVVSShtZW50aW9uTWFya2VyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIERvIG5vdCBzaG93IGVtcHR5IG1lbnRpb24gVUkuXG4gICAgICAgICAgICB0aGlzLl9oaWRlVUlBbmRSZW1vdmVNYXJrZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcblx0ICogU2hvd3MgdGhlIG1lbnRpb25zIGJhbGxvb24uIElmIHRoZSBwYW5lbCBpcyBhbHJlYWR5IHZpc2libGUsIGl0IHdpbGwgcmVwb3NpdGlvbiBpdC5cblx0ICovIF9zaG93T3JVcGRhdGVVSShtYXJrZXJNYXJrZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzVUlWaXNpYmxlKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmxvZyggJyVjW1VJXSVjIFVwZGF0aW5nIHBvc2l0aW9uLicsICdjb2xvcjogZ3JlZW4nLCAnY29sb3I6IGJsYWNrJyApO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGJhbGxvb24gcG9zaXRpb24gYXMgdGhlIG1lbnRpb24gbGlzdCB2aWV3IG1heSBjaGFuZ2UgaXRzIHNpemUuXG4gICAgICAgICAgICB0aGlzLl9iYWxsb29uLnVwZGF0ZVBvc2l0aW9uKHRoaXMuX2dldEJhbGxvb25QYW5lbFBvc2l0aW9uRGF0YShtYXJrZXJNYXJrZXIsIHRoaXMuX21lbnRpb25zVmlldy5wb3NpdGlvbikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICclY1tVSV0lYyBTaG93aW5nIHRoZSBVSS4nLCAnY29sb3I6IGdyZWVuJywgJ2NvbG9yOiBibGFjaycgKTtcbiAgICAgICAgICAgIHRoaXMuX2JhbGxvb24uYWRkKHtcbiAgICAgICAgICAgICAgICB2aWV3OiB0aGlzLl9tZW50aW9uc1ZpZXcsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHRoaXMuX2dldEJhbGxvb25QYW5lbFBvc2l0aW9uRGF0YShtYXJrZXJNYXJrZXIsIHRoaXMuX21lbnRpb25zVmlldy5wb3NpdGlvbiksXG4gICAgICAgICAgICAgICAgc2luZ2xlVmlld01vZGU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21lbnRpb25zVmlldy5wb3NpdGlvbiA9IHRoaXMuX2JhbGxvb24udmlldy5wb3NpdGlvbjtcbiAgICAgICAgdGhpcy5fbWVudGlvbnNWaWV3LnNlbGVjdEZpcnN0KCk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBIaWRlcyB0aGUgbWVudGlvbnMgYmFsbG9vbiBhbmQgcmVtb3ZlcyB0aGUgJ21lbnRpb24nIG1hcmtlciBmcm9tIHRoZSBtYXJrZXJzIGNvbGxlY3Rpb24uXG5cdCAqLyBfaGlkZVVJQW5kUmVtb3ZlTWFya2VyKCkge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIG1lbnRpb24gdmlldyBmcm9tIGJhbGxvb24gYmVmb3JlIHJlbW92aW5nIG1hcmtlciAtIGl0IGlzIHVzZWQgYnkgYmFsbG9vbiBwb3NpdGlvbiB0YXJnZXQoKS5cbiAgICAgICAgaWYgKHRoaXMuX2JhbGxvb24uaGFzVmlldyh0aGlzLl9tZW50aW9uc1ZpZXcpKSB7XG4gICAgICAgICAgICAvLyBAaWYgQ0tfREVCVUdfTUVOVElPTiAvLyBjb25zb2xlLmxvZyggJyVjW1VJXSVjIEhpZGluZyB0aGUgVUkuJywgJ2NvbG9yOiBncmVlbicsICdjb2xvcjogYmxhY2snICk7XG4gICAgICAgICAgICB0aGlzLl9iYWxsb29uLnJlbW92ZSh0aGlzLl9tZW50aW9uc1ZpZXcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGVja0lmU3RpbGxJbkNvbXBsZXRpb25Nb2RlKHRoaXMuZWRpdG9yKSkge1xuICAgICAgICAgICAgLy8gQGlmIENLX0RFQlVHX01FTlRJT04gLy8gY29uc29sZS5sb2coICclY1tFZGl0aW5nXSVjIFJlbW92aW5nIG1hcmtlci4nLCAnY29sb3I6IHB1cnBsZScsICdjb2xvcjogYmxhY2snICk7XG4gICAgICAgICAgICB0aGlzLmVkaXRvci5tb2RlbC5jaGFuZ2UoKHdyaXRlcik9PndyaXRlci5yZW1vdmVNYXJrZXIoJ21lbnRpb24nKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTWFrZSB0aGUgbGFzdCBtYXRjaGVkIHBvc2l0aW9uIG9uIHBhbmVsIHZpZXcgdW5kZWZpbmVkIHNvIHRoZSAjX2dldEJhbGxvb25QYW5lbFBvc2l0aW9uRGF0YSgpIG1ldGhvZCB3aWxsIHJldHVybiBhbGwgcG9zaXRpb25zXG4gICAgICAgIC8vIG9uIHRoZSBuZXh0IGNhbGwuXG4gICAgICAgIHRoaXMuX21lbnRpb25zVmlldy5wb3NpdGlvbiA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgLyoqXG5cdCAqIFJlbmRlcnMgYSBzaW5nbGUgaXRlbSBpbiB0aGUgYXV0b2NvbXBsZXRlIGxpc3QuXG5cdCAqLyBfcmVuZGVySXRlbShpdGVtLCBtYXJrZXIpIHtcbiAgICAgICAgY29uc3QgZWRpdG9yID0gdGhpcy5lZGl0b3I7XG4gICAgICAgIGxldCB2aWV3O1xuICAgICAgICBsZXQgbGFiZWwgPSBpdGVtLmlkO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuX2dldEl0ZW1SZW5kZXJlcihtYXJrZXIpO1xuICAgICAgICBpZiAocmVuZGVyZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlbmRlclJlc3VsdCA9IHJlbmRlcmVyKGl0ZW0pO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByZW5kZXJSZXN1bHQgIT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IERvbVdyYXBwZXJWaWV3KGVkaXRvci5sb2NhbGUsIHJlbmRlclJlc3VsdCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxhYmVsID0gcmVuZGVyUmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdmlldykge1xuICAgICAgICAgICAgY29uc3QgYnV0dG9uVmlldyA9IG5ldyBCdXR0b25WaWV3KGVkaXRvci5sb2NhbGUpO1xuICAgICAgICAgICAgYnV0dG9uVmlldy5sYWJlbCA9IGxhYmVsO1xuICAgICAgICAgICAgYnV0dG9uVmlldy53aXRoVGV4dCA9IHRydWU7XG4gICAgICAgICAgICB2aWV3ID0gYnV0dG9uVmlldztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmlldztcbiAgICB9XG4gICAgLyoqXG5cdCAqIENyZWF0ZXMgYSBwb3NpdGlvbiBvcHRpb25zIG9iamVjdCB1c2VkIHRvIHBvc2l0aW9uIHRoZSBiYWxsb29uIHBhbmVsLlxuXHQgKlxuXHQgKiBAcGFyYW0gbWVudGlvbk1hcmtlclxuXHQgKiBAcGFyYW0gcHJlZmVycmVkUG9zaXRpb24gVGhlIG5hbWUgb2YgdGhlIGxhc3QgbWF0Y2hlZCBwb3NpdGlvbiBuYW1lLlxuXHQgKi8gX2dldEJhbGxvb25QYW5lbFBvc2l0aW9uRGF0YShtZW50aW9uTWFya2VyLCBwcmVmZXJyZWRQb3NpdGlvbikge1xuICAgICAgICBjb25zdCBlZGl0b3IgPSB0aGlzLmVkaXRvcjtcbiAgICAgICAgY29uc3QgZWRpdGluZyA9IGVkaXRvci5lZGl0aW5nO1xuICAgICAgICBjb25zdCBkb21Db252ZXJ0ZXIgPSBlZGl0aW5nLnZpZXcuZG9tQ29udmVydGVyO1xuICAgICAgICBjb25zdCBtYXBwZXIgPSBlZGl0aW5nLm1hcHBlcjtcbiAgICAgICAgY29uc3QgdWlMYW5ndWFnZURpcmVjdGlvbiA9IGVkaXRvci5sb2NhbGUudWlMYW5ndWFnZURpcmVjdGlvbjtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldDogKCk9PntcbiAgICAgICAgICAgICAgICBsZXQgbW9kZWxSYW5nZSA9IG1lbnRpb25NYXJrZXIuZ2V0UmFuZ2UoKTtcbiAgICAgICAgICAgICAgICAvLyBUYXJnZXQgdGhlIFVJIHRvIHRoZSBtb2RlbCBzZWxlY3Rpb24gcmFuZ2UgLSB0aGUgbWFya2VyIGhhcyBiZWVuIHJlbW92ZWQgc28gcHJvYmFibHkgdGhlIFVJIHdpbGwgbm90IGJlIHNob3duIGFueXdheS5cbiAgICAgICAgICAgICAgICAvLyBUaGUgbG9naWMgaXMgdXNlZCBieSBDb250ZXh0dWFsQmFsbG9vbiB0byBkaXNwbGF5IGFub3RoZXIgcGFuZWwgaW4gdGhlIHNhbWUgcGxhY2UuXG4gICAgICAgICAgICAgICAgaWYgKG1vZGVsUmFuZ2Uuc3RhcnQucm9vdC5yb290TmFtZSA9PSAnJGdyYXZleWFyZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kZWxSYW5nZSA9IGVkaXRvci5tb2RlbC5kb2N1bWVudC5zZWxlY3Rpb24uZ2V0Rmlyc3RSYW5nZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3UmFuZ2UgPSBtYXBwZXIudG9WaWV3UmFuZ2UobW9kZWxSYW5nZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZ2VSZWN0cyA9IFJlY3QuZ2V0RG9tUmFuZ2VSZWN0cyhkb21Db252ZXJ0ZXIudmlld1JhbmdlVG9Eb20odmlld1JhbmdlKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJhbmdlUmVjdHMucG9wKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGltaXRlcjogKCk9PntcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5lZGl0b3IuZWRpdGluZy52aWV3O1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdEb2N1bWVudCA9IHZpZXcuZG9jdW1lbnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgZWRpdGFibGVFbGVtZW50ID0gdmlld0RvY3VtZW50LnNlbGVjdGlvbi5lZGl0YWJsZUVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgaWYgKGVkaXRhYmxlRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldy5kb21Db252ZXJ0ZXIubWFwVmlld1RvRG9tKGVkaXRhYmxlRWxlbWVudC5yb290KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG9zaXRpb25zOiBnZXRCYWxsb29uUGFuZWxQb3NpdGlvbnMocHJlZmVycmVkUG9zaXRpb24sIHVpTGFuZ3VhZ2VEaXJlY3Rpb24pXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIHRoZSBiYWxsb29uIHBvc2l0aW9ucyBkYXRhIGNhbGxiYWNrcy5cbiAqLyBmdW5jdGlvbiBnZXRCYWxsb29uUGFuZWxQb3NpdGlvbnMocHJlZmVycmVkUG9zaXRpb24sIHVpTGFuZ3VhZ2VEaXJlY3Rpb24pIHtcbiAgICBjb25zdCBwb3NpdGlvbnMgPSB7XG4gICAgICAgIC8vIFBvc2l0aW9ucyB0aGUgcGFuZWwgdG8gdGhlIHNvdXRoZWFzdCBvZiB0aGUgY2FyZXQgcmVjdGFuZ2xlLlxuICAgICAgICAnY2FyZXRfc2UnOiAodGFyZ2V0UmVjdCk9PntcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG9wOiB0YXJnZXRSZWN0LmJvdHRvbSArIFZFUlRJQ0FMX1NQQUNJTkcsXG4gICAgICAgICAgICAgICAgbGVmdDogdGFyZ2V0UmVjdC5yaWdodCxcbiAgICAgICAgICAgICAgICBuYW1lOiAnY2FyZXRfc2UnLFxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICB3aXRoQXJyb3c6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gUG9zaXRpb25zIHRoZSBwYW5lbCB0byB0aGUgbm9ydGhlYXN0IG9mIHRoZSBjYXJldCByZWN0YW5nbGUuXG4gICAgICAgICdjYXJldF9uZSc6ICh0YXJnZXRSZWN0LCBiYWxsb29uUmVjdCk9PntcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG9wOiB0YXJnZXRSZWN0LnRvcCAtIGJhbGxvb25SZWN0LmhlaWdodCAtIFZFUlRJQ0FMX1NQQUNJTkcsXG4gICAgICAgICAgICAgICAgbGVmdDogdGFyZ2V0UmVjdC5yaWdodCxcbiAgICAgICAgICAgICAgICBuYW1lOiAnY2FyZXRfbmUnLFxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICB3aXRoQXJyb3c6IGZhbHNlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gUG9zaXRpb25zIHRoZSBwYW5lbCB0byB0aGUgc291dGh3ZXN0IG9mIHRoZSBjYXJldCByZWN0YW5nbGUuXG4gICAgICAgICdjYXJldF9zdyc6ICh0YXJnZXRSZWN0LCBiYWxsb29uUmVjdCk9PntcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG9wOiB0YXJnZXRSZWN0LmJvdHRvbSArIFZFUlRJQ0FMX1NQQUNJTkcsXG4gICAgICAgICAgICAgICAgbGVmdDogdGFyZ2V0UmVjdC5yaWdodCAtIGJhbGxvb25SZWN0LndpZHRoLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdjYXJldF9zdycsXG4gICAgICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhBcnJvdzogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICAvLyBQb3NpdGlvbnMgdGhlIHBhbmVsIHRvIHRoZSBub3J0aHdlc3Qgb2YgdGhlIGNhcmV0IHJlY3QuXG4gICAgICAgICdjYXJldF9udyc6ICh0YXJnZXRSZWN0LCBiYWxsb29uUmVjdCk9PntcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG9wOiB0YXJnZXRSZWN0LnRvcCAtIGJhbGxvb25SZWN0LmhlaWdodCAtIFZFUlRJQ0FMX1NQQUNJTkcsXG4gICAgICAgICAgICAgICAgbGVmdDogdGFyZ2V0UmVjdC5yaWdodCAtIGJhbGxvb25SZWN0LndpZHRoLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdjYXJldF9udycsXG4gICAgICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhBcnJvdzogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfTtcbiAgICAvLyBSZXR1cm5zIG9ubHkgdGhlIGxhc3QgcG9zaXRpb24gaWYgaXQgd2FzIG1hdGNoZWQgdG8gcHJldmVudCB0aGUgcGFuZWwgZnJvbSBqdW1waW5nIGFmdGVyIHRoZSBmaXJzdCBtYXRjaC5cbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHBvc2l0aW9ucywgcHJlZmVycmVkUG9zaXRpb24pKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBwb3NpdGlvbnNbcHJlZmVycmVkUG9zaXRpb25dXG4gICAgICAgIF07XG4gICAgfVxuICAgIC8vIEJ5IGRlZmF1bHQsIHJldHVybiBhbGwgcG9zaXRpb24gY2FsbGJhY2tzIG9yZGVyZWQgZGVwZW5kaW5nIG9uIHRoZSBVSSBsYW5ndWFnZSBkaXJlY3Rpb24uXG4gICAgcmV0dXJuIHVpTGFuZ3VhZ2VEaXJlY3Rpb24gIT09ICdydGwnID8gW1xuICAgICAgICBwb3NpdGlvbnMuY2FyZXRfc2UsXG4gICAgICAgIHBvc2l0aW9ucy5jYXJldF9zdyxcbiAgICAgICAgcG9zaXRpb25zLmNhcmV0X25lLFxuICAgICAgICBwb3NpdGlvbnMuY2FyZXRfbndcbiAgICBdIDogW1xuICAgICAgICBwb3NpdGlvbnMuY2FyZXRfc3csXG4gICAgICAgIHBvc2l0aW9ucy5jYXJldF9zZSxcbiAgICAgICAgcG9zaXRpb25zLmNhcmV0X253LFxuICAgICAgICBwb3NpdGlvbnMuY2FyZXRfbmVcbiAgICBdO1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgbWFya2VyIGRlZmluaXRpb24gb2YgdGhlIGxhc3QgdmFsaWQgb2NjdXJyaW5nIG1hcmtlciBpbiBhIGdpdmVuIHN0cmluZy5cbiAqIElmIHRoZXJlIGlzIG5vIHZhbGlkIG1hcmtlciBpbiBhIHN0cmluZywgaXQgcmV0dXJucyB1bmRlZmluZWQuXG4gKlxuICogRXhhbXBsZSBvZiByZXR1cm5lZCBvYmplY3Q6XG4gKlxuICogYGBgdHNcbiAqIHtcbiAqIFx0bWFya2VyOiAnQCcsXG4gKiBcdHBvc2l0aW9uOiA0LFxuICogXHRtaW5pbXVtQ2hhcmFjdGVyczogMFxuICogfVxuICogYGBgYFxuICpcbiAqIEBwYXJhbSBmZWVkc1dpdGhQYXR0ZXJuIFJlZ2lzdGVyZWQgZmVlZHMgaW4gZWRpdG9yIGZvciBtZW50aW9uIHBsdWdpbiB3aXRoIGNyZWF0ZWQgUmVnRXhwIGZvciBtYXRjaGluZyBtYXJrZXIuXG4gKiBAcGFyYW0gdGV4dCBTdHJpbmcgdG8gZmluZCB0aGUgbWFya2VyIGluXG4gKiBAcmV0dXJucyBNYXRjaGVkIG1hcmtlcidzIGRlZmluaXRpb25cbiAqLyBmdW5jdGlvbiBnZXRMYXN0VmFsaWRNYXJrZXJJblRleHQoZmVlZHNXaXRoUGF0dGVybiwgdGV4dCkge1xuICAgIGxldCBsYXN0VmFsaWRNYXJrZXI7XG4gICAgZm9yIChjb25zdCBmZWVkIG9mIGZlZWRzV2l0aFBhdHRlcm4pe1xuICAgICAgICBjb25zdCBjdXJyZW50TWFya2VyTGFzdEluZGV4ID0gdGV4dC5sYXN0SW5kZXhPZihmZWVkLm1hcmtlcik7XG4gICAgICAgIGlmIChjdXJyZW50TWFya2VyTGFzdEluZGV4ID4gMCAmJiAhdGV4dC5zdWJzdHJpbmcoY3VycmVudE1hcmtlckxhc3RJbmRleCAtIDEpLm1hdGNoKGZlZWQucGF0dGVybikpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbGFzdFZhbGlkTWFya2VyIHx8IGN1cnJlbnRNYXJrZXJMYXN0SW5kZXggPj0gbGFzdFZhbGlkTWFya2VyLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICBsYXN0VmFsaWRNYXJrZXIgPSB7XG4gICAgICAgICAgICAgICAgbWFya2VyOiBmZWVkLm1hcmtlcixcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogY3VycmVudE1hcmtlckxhc3RJbmRleCxcbiAgICAgICAgICAgICAgICBtaW5pbXVtQ2hhcmFjdGVyczogZmVlZC5taW5pbXVtQ2hhcmFjdGVycyxcbiAgICAgICAgICAgICAgICBwYXR0ZXJuOiBmZWVkLnBhdHRlcm5cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxhc3RWYWxpZE1hcmtlcjtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIFJlZ0V4cCBwYXR0ZXJuIGZvciB0aGUgbWFya2VyLlxuICpcbiAqIEZ1bmN0aW9uIGhhcyB0byBiZSBleHBvcnRlZCB0byBhY2hpZXZlIDEwMCUgY29kZSBjb3ZlcmFnZS5cbiAqLyBmdW5jdGlvbiBjcmVhdGVSZWdFeHAobWFya2VyLCBtaW5pbXVtQ2hhcmFjdGVycykge1xuICAgIGNvbnN0IG51bWJlck9mQ2hhcmFjdGVycyA9IG1pbmltdW1DaGFyYWN0ZXJzID09IDAgPyAnKicgOiBgeyR7bWluaW11bUNoYXJhY3RlcnN9LH1gO1xuICAgIGNvbnN0IG9wZW5BZnRlckNoYXJhY3RlcnMgPSBlbnYuZmVhdHVyZXMuaXNSZWdFeHBVbmljb2RlUHJvcGVydHlTdXBwb3J0ZWQgPyAnXFxcXHB7UHN9XFxcXHB7UGl9XCJcXCcnIDogJ1xcXFwoXFxcXFt7XCJcXCcnO1xuICAgIGNvbnN0IG1lbnRpb25DaGFyYWN0ZXJzID0gJy4nO1xuICAgIC8vIEkgd2FudGVkIHRvIG1ha2UgYW4gdXRpbCBvdXQgb2YgaXQsIGJ1dCBzaW5jZSB0aGlzIHJlZ2V4cCB1c2VzIFwidVwiIGZsYWcsIGl0IGJlY2FtZSBkaWZmaWN1bHQuXG4gICAgLy8gV2hlbiBcInVcIiBmbGFnIGlzIHVzZWQsIHRoZSByZWdleHAgaGFzIFwic3RyaWN0XCIgZXNjYXBpbmcgcnVsZXMsIGkuZS4gaWYgeW91IHRyeSB0byBlc2NhcGUgYSBjaGFyYWN0ZXIgdGhhdCBkb2VzIG5vdCBuZWVkXG4gICAgLy8gdG8gYmUgZXNjYXBlZCwgUmVnRXhwKCkgd2lsbCB0aHJvdy4gSXQgbWFkZSBpdCBkaWZmaWN1bHQgdG8gd3JpdGUgYSBnZW5lcmljIHV0aWwsIGJlY2F1c2UgZGlmZmVyZW50IGNoYXJhY3RlcnMgYXJlXG4gICAgLy8gYWxsb3dlZCBpbiBkaWZmZXJlbnQgY29udGV4dC4gRm9yIGV4YW1wbGUsIGVzY2FwaW5nIFwiLVwiIHNvbWV0aW1lcyB3YXMgY29ycmVjdCwgYnV0IHNvbWV0aW1lcyBpdCB0aHJldyBhbiBlcnJvci5cbiAgICBtYXJrZXIgPSBtYXJrZXIucmVwbGFjZSgvWy4qKz9eJHt9KClcXC18W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcbiAgICAvLyBUaGUgcGF0dGVybiBjb25zaXN0cyBvZiAzIGdyb3VwczpcbiAgICAvL1xuICAgIC8vIC0gMCAobm9uLWNhcHR1cmluZyk6IE9wZW5pbmcgc2VxdWVuY2UgLSBzdGFydCBvZiB0aGUgbGluZSwgc3BhY2Ugb3IgYW4gb3BlbmluZyBwdW5jdHVhdGlvbiBjaGFyYWN0ZXIgbGlrZSBcIihcIiBvciBcIlxcXCJcIixcbiAgICAvLyAtIDE6IFRoZSBtYXJrZXIgY2hhcmFjdGVyKHMpLFxuICAgIC8vIC0gMjogTWVudGlvbiBpbnB1dCAodGFraW5nIHRoZSBtaW5pbWFsIGxlbmd0aCBpbnRvIGNvbnNpZGVyYXRpb24gdG8gdHJpZ2dlciB0aGUgVUkpLFxuICAgIC8vXG4gICAgLy8gVGhlIHBhdHRlcm4gbWF0Y2hlcyB1cCB0byB0aGUgY2FyZXQgKGVuZCBvZiBzdHJpbmcgc3dpdGNoIC0gJCkuXG4gICAgLy8gICAgICAgICAgICAgICAoMDogICAgICBvcGVuaW5nIHNlcXVlbmNlICAgICAgICkoMTogbWFya2VyICApKDI6ICAgICAgICAgICAgICAgIHR5cGVkIG1lbnRpb24gICAgICAgICAgICAgICkkXG4gICAgY29uc3QgcGF0dGVybiA9IGAoPzpefFsgJHtvcGVuQWZ0ZXJDaGFyYWN0ZXJzfV0pKCR7bWFya2VyfSkoJHttZW50aW9uQ2hhcmFjdGVyc30ke251bWJlck9mQ2hhcmFjdGVyc30pJGA7XG4gICAgcmV0dXJuIG5ldyBSZWdFeHAocGF0dGVybiwgJ3UnKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIHRlc3QgY2FsbGJhY2sgZm9yIHRoZSBtYXJrZXIgdG8gYmUgdXNlZCBpbiB0aGUgdGV4dCB3YXRjaGVyIGluc3RhbmNlLlxuICpcbiAqIEBwYXJhbSBmZWVkc1dpdGhQYXR0ZXJuIEZlZWRzIG9mIG1lbnRpb24gcGx1Z2luIGNvbmZpZ3VyZWQgaW4gZWRpdG9yIHdpdGggUmVnRXhwIHRvIG1hdGNoIG1hcmtlciBpbiB0ZXh0XG4gKi8gZnVuY3Rpb24gY3JlYXRlVGVzdENhbGxiYWNrKGZlZWRzV2l0aFBhdHRlcm4pIHtcbiAgICBjb25zdCB0ZXh0TWF0Y2hlciA9ICh0ZXh0KT0+e1xuICAgICAgICBjb25zdCBtYXJrZXJEZWZpbml0aW9uID0gZ2V0TGFzdFZhbGlkTWFya2VySW5UZXh0KGZlZWRzV2l0aFBhdHRlcm4sIHRleHQpO1xuICAgICAgICBpZiAoIW1hcmtlckRlZmluaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc3BsaXRTdHJpbmdGcm9tID0gMDtcbiAgICAgICAgaWYgKG1hcmtlckRlZmluaXRpb24ucG9zaXRpb24gIT09IDApIHtcbiAgICAgICAgICAgIHNwbGl0U3RyaW5nRnJvbSA9IG1hcmtlckRlZmluaXRpb24ucG9zaXRpb24gLSAxO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRleHRUb1Rlc3QgPSB0ZXh0LnN1YnN0cmluZyhzcGxpdFN0cmluZ0Zyb20pO1xuICAgICAgICByZXR1cm4gbWFya2VyRGVmaW5pdGlvbi5wYXR0ZXJuLnRlc3QodGV4dFRvVGVzdCk7XG4gICAgfTtcbiAgICByZXR1cm4gdGV4dE1hdGNoZXI7XG59XG4vKipcbiAqIENyZWF0ZXMgYSB0ZXh0IG1hdGNoZXIgZnJvbSB0aGUgbWFya2VyLlxuICovIGZ1bmN0aW9uIHJlcXVlc3RGZWVkVGV4dChtYXJrZXJEZWZpbml0aW9uLCB0ZXh0KSB7XG4gICAgbGV0IHNwbGl0U3RyaW5nRnJvbSA9IDA7XG4gICAgaWYgKG1hcmtlckRlZmluaXRpb24ucG9zaXRpb24gIT09IDApIHtcbiAgICAgICAgc3BsaXRTdHJpbmdGcm9tID0gbWFya2VyRGVmaW5pdGlvbi5wb3NpdGlvbiAtIDE7XG4gICAgfVxuICAgIGNvbnN0IHJlZ0V4cCA9IGNyZWF0ZVJlZ0V4cChtYXJrZXJEZWZpbml0aW9uLm1hcmtlciwgMCk7XG4gICAgY29uc3QgdGV4dFRvTWF0Y2ggPSB0ZXh0LnN1YnN0cmluZyhzcGxpdFN0cmluZ0Zyb20pO1xuICAgIGNvbnN0IG1hdGNoID0gdGV4dFRvTWF0Y2gubWF0Y2gocmVnRXhwKTtcbiAgICByZXR1cm4gbWF0Y2hbMl07XG59XG4vKipcbiAqIFRoZSBkZWZhdWx0IGZlZWQgY2FsbGJhY2suXG4gKi8gZnVuY3Rpb24gY3JlYXRlRmVlZENhbGxiYWNrKGZlZWRJdGVtcykge1xuICAgIHJldHVybiAoZmVlZFRleHQpPT57XG4gICAgICAgIGNvbnN0IGZpbHRlcmVkSXRlbXMgPSBmZWVkSXRlbXMvLyBNYWtlIHRoZSBkZWZhdWx0IG1lbnRpb24gZmVlZCBjYXNlLWluc2Vuc2l0aXZlLlxuICAgICAgICAuZmlsdGVyKChpdGVtKT0+e1xuICAgICAgICAgICAgLy8gSXRlbSBtaWdodCBiZSBkZWZpbmVkIGFzIG9iamVjdC5cbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IHR5cGVvZiBpdGVtID09ICdzdHJpbmcnID8gaXRlbSA6IFN0cmluZyhpdGVtLmlkKTtcbiAgICAgICAgICAgIC8vIFRoZSBkZWZhdWx0IGZlZWQgaXMgY2FzZSBpbnNlbnNpdGl2ZS5cbiAgICAgICAgICAgIHJldHVybiBpdGVtSWQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmZWVkVGV4dC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmaWx0ZXJlZEl0ZW1zO1xuICAgIH07XG59XG4vKipcbiAqIENoZWNrcyBpZiBwb3NpdGlvbiBpbiBpbnNpZGUgb3IgcmlnaHQgYWZ0ZXIgYSB0ZXh0IHdpdGggYSBtZW50aW9uLlxuICovIGZ1bmN0aW9uIGlzUG9zaXRpb25JbkV4aXN0aW5nTWVudGlvbihwb3NpdGlvbikge1xuICAgIC8vIFRoZSB0ZXh0IHdhdGNoZXIgbGlzdGVucyBvbmx5IHRvIGNoYW5nZWQgcmFuZ2UgaW4gc2VsZWN0aW9uIC0gc28gdGhlIHNlbGVjdGlvbiBhdHRyaWJ1dGVzIGFyZSBub3QgeWV0IGF2YWlsYWJsZVxuICAgIC8vIGFuZCB5b3UgY2Fubm90IHVzZSBzZWxlY3Rpb24uaGFzQXR0cmlidXRlKCAnbWVudGlvbicgKSBqdXN0IHlldC5cbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS1lbmdpbmUvaXNzdWVzLzE3MjMuXG4gICAgY29uc3QgaGFzTWVudGlvbiA9IHBvc2l0aW9uLnRleHROb2RlICYmIHBvc2l0aW9uLnRleHROb2RlLmhhc0F0dHJpYnV0ZSgnbWVudGlvbicpO1xuICAgIGNvbnN0IG5vZGVCZWZvcmUgPSBwb3NpdGlvbi5ub2RlQmVmb3JlO1xuICAgIHJldHVybiBoYXNNZW50aW9uIHx8IG5vZGVCZWZvcmUgJiYgbm9kZUJlZm9yZS5pcygnJHRleHQnKSAmJiBub2RlQmVmb3JlLmhhc0F0dHJpYnV0ZSgnbWVudGlvbicpO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGNsb3Nlc3QgbWFya2VyIG9mZnNldCBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbWVudGlvbi5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NrZWRpdG9yL2NrZWRpdG9yNS9pc3N1ZXMvMTE0MDAuXG4gKi8gZnVuY3Rpb24gaXNNYXJrZXJJbkV4aXN0aW5nTWVudGlvbihtYXJrZXJQb3NpdGlvbikge1xuICAgIGNvbnN0IG5vZGVBZnRlciA9IG1hcmtlclBvc2l0aW9uLm5vZGVBZnRlcjtcbiAgICByZXR1cm4gbm9kZUFmdGVyICYmIG5vZGVBZnRlci5pcygnJHRleHQnKSAmJiBub2RlQWZ0ZXIuaGFzQXR0cmlidXRlKCdtZW50aW9uJyk7XG59XG4vKipcbiAqIENoZWNrcyBpZiBzdHJpbmcgaXMgYSB2YWxpZCBtZW50aW9uIG1hcmtlci5cbiAqLyBmdW5jdGlvbiBpc1ZhbGlkTWVudGlvbk1hcmtlcihtYXJrZXIpIHtcbiAgICByZXR1cm4gISFtYXJrZXI7XG59XG4vKipcbiAqIENoZWNrcyB0aGUgbWVudGlvbiBwbHVnaW5zIGlzIGluIGNvbXBsZXRpb24gbW9kZSAoZS5nLiB3aGVuIHR5cGluZyBpcyBhZnRlciBhIHZhbGlkIG1lbnRpb24gc3RyaW5nIGxpa2UgQGZvbykuXG4gKi8gZnVuY3Rpb24gY2hlY2tJZlN0aWxsSW5Db21wbGV0aW9uTW9kZShlZGl0b3IpIHtcbiAgICByZXR1cm4gZWRpdG9yLm1vZGVsLm1hcmtlcnMuaGFzKCdtZW50aW9uJyk7XG59XG5cbi8qKlxuICogVGhlIG1lbnRpb24gcGx1Z2luLlxuICpcbiAqIEZvciBhIGRldGFpbGVkIG92ZXJ2aWV3LCBjaGVjayB0aGUge0BnbGluayBmZWF0dXJlcy9tZW50aW9ucyBNZW50aW9uIGZlYXR1cmV9IGd1aWRlLlxuICovIGNsYXNzIE1lbnRpb24gZXh0ZW5kcyBQbHVnaW4ge1xuICAgIHRvTWVudGlvbkF0dHJpYnV0ZSh2aWV3RWxlbWVudCwgZGF0YSkge1xuICAgICAgICByZXR1cm4gX3RvTWVudGlvbkF0dHJpYnV0ZSh2aWV3RWxlbWVudCwgZGF0YSk7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCBwbHVnaW5OYW1lKCkge1xuICAgICAgICByZXR1cm4gJ01lbnRpb24nO1xuICAgIH1cbiAgICAvKipcblx0ICogQGluaGVyaXREb2Ncblx0ICovIHN0YXRpYyBnZXQgaXNPZmZpY2lhbFBsdWdpbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIC8qKlxuXHQgKiBAaW5oZXJpdERvY1xuXHQgKi8gc3RhdGljIGdldCByZXF1aXJlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIE1lbnRpb25FZGl0aW5nLFxuICAgICAgICAgICAgTWVudGlvblVJXG4gICAgICAgIF07XG4gICAgfVxufVxuXG5leHBvcnQgeyBEb21XcmFwcGVyVmlldywgTWVudGlvbiwgTWVudGlvbkVkaXRpbmcsIE1lbnRpb25MaXN0SXRlbVZpZXcsIE1lbnRpb25VSSwgTWVudGlvbnNWaWV3IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiIsImltcG9ydCBcImNrZWRpdG9yNVwiO1xyXG5pbXBvcnQgXCJja2VkaXRvcjUvY2tlZGl0b3I1LmNzc1wiO1xyXG5cclxuKHdpbmRvdyBhcyBhbnkpLkNLRURJVE9SLmVkaXRvckNvbmZpZyA9IGZ1bmN0aW9uIChjb25maWc6IGFueSkge1xyXG4gICAgLy8gRGVmaW5lIGNoYW5nZXMgdG8gZGVmYXVsdCBjb25maWd1cmF0aW9uIGhlcmUuIEZvciBleGFtcGxlOlxyXG4gICAgLy8gY29uZmlnLnVpQ29sb3IgPSAnI0FBREM2RSc7XHJcbiAgICBjb25maWcuY29udGVudHNMYW5nRGlyZWN0aW9uID0gJ3J0bCc7XHJcbiAgICBjb25maWcubGFuZ3VhZ2UgPSAnZmEnO1xyXG4gICAgY29uZmlnLmZpbGVicm93c2VySW1hZ2VVcGxvYWRVcmwgPSAnL2ZpbGUtdXBsb2FkJztcclxuICAgIGNvbmZpZy50b29sYmFyID0gJ015VG9vbGJhcic7XHJcblxyXG4gICAgY29uZmlnLnRvb2xiYXJfTXlUb29sYmFyID1cclxuICAgICAgICBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdkb2N1bWVudCcsXHJcbiAgICAgICAgICAgICAgICBpdGVtczogWydTb3VyY2UnLCAnLScsICdTYXZlJywgJ05ld1BhZ2UnLCAnRG9jUHJvcHMnLCAnUHJldmlldycsICdQcmludCcsICctJywgJ1RlbXBsYXRlcyddXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnY2xpcGJvYXJkJywgaXRlbXM6IFsnQ3V0JywgJ0NvcHknLCAnUGFzdGUnLCAnUGFzdGVUZXh0JywgJ1Bhc3RlRnJvbVdvcmQnLCAnLScsICdVbmRvJywgJ1JlZG8nXX0sXHJcbiAgICAgICAgICAgIHtuYW1lOiAnZWRpdGluZycsIGl0ZW1zOiBbJ0ZpbmQnLCAnUmVwbGFjZScsICctJywgJ1NlbGVjdEFsbCcsICctJywgJ1NwZWxsQ2hlY2tlcicsICdTY2F5dCddfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogJ2Zvcm1zJyxcclxuICAgICAgICAgICAgICAgIGl0ZW1zOiBbJ0Zvcm0nLCAnQ2hlY2tib3gnLCAnUmFkaW8nLCAnVGV4dEZpZWxkJywgJ1RleHRhcmVhJywgJ1NlbGVjdCcsICdCdXR0b24nLCAnSW1hZ2VCdXR0b24nLCAnSGlkZGVuRmllbGQnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnYmFzaWNzdHlsZXMnLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6IFsnQm9sZCcsICdJdGFsaWMnLCAnVW5kZXJsaW5lJywgJ1N0cmlrZScsICdTdWJzY3JpcHQnLCAnU3VwZXJzY3JpcHQnLCAnLScsICdSZW1vdmVGb3JtYXQnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7bmFtZTogJ2xpbmtzJywgaXRlbXM6IFsnTGluaycsICdVbmxpbmsnLCAnQW5jaG9yJ119LFxyXG4gICAgICAgICAgICB7bmFtZTogJ2NvbG9ycycsIGl0ZW1zOiBbJ1RleHRDb2xvcicsICdCR0NvbG9yJ119LFxyXG4gICAgICAgICAgICAnLycsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdpbnNlcnQnLFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6IFsnSW1hZ2UnLCAnRmxhc2gnLCAnVGFibGUnLCAnSG9yaXpvbnRhbFJ1bGUnLCAnU21pbGV5JywgJ1NwZWNpYWxDaGFyJywgJ1BhZ2VCcmVhaycsICdJZnJhbWUnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiAncGFyYWdyYXBoJyxcclxuICAgICAgICAgICAgICAgIGl0ZW1zOiBbJ051bWJlcmVkTGlzdCcsICdCdWxsZXRlZExpc3QnLCAnLScsICdPdXRkZW50JywgJ0luZGVudCcsICctJywgJ0Jsb2NrcXVvdGUnLCAnQ3JlYXRlRGl2JywgJy0nLCAnSnVzdGlmeUxlZnQnLCAnSnVzdGlmeUNlbnRlcicsICdKdXN0aWZ5UmlnaHQnLCAnSnVzdGlmeUJsb2NrJywgJy0nLCAnQmlkaUx0cicsICdCaWRpUnRsJ11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge25hbWU6ICdzdHlsZXMnLCBpdGVtczogWydTdHlsZXMnLCAnRm9ybWF0JywgJ0ZvbnQnLCAnRm9udFNpemUnXX1cclxuXHJcbiAgICAgICAgXTtcclxuXHJcbn07XHJcbiJdLCJuYW1lcyI6WyJmcmVlR2xvYmFsIiwiZnJlZVNlbGYiLCJyb290IiwiU3ltYm9sIiwib2JqZWN0UHJvdG8iLCJoYXNPd25Qcm9wZXJ0eSIsIm5hdGl2ZU9iamVjdFRvU3RyaW5nIiwic3ltVG9TdHJpbmdUYWciLCJnZXRSYXdUYWciLCJ2YWx1ZSIsImlzT3duIiwidGFnIiwidW5tYXNrZWQiLCJyZXN1bHQiLCJvYmplY3RUb1N0cmluZyIsIm51bGxUYWciLCJ1bmRlZmluZWRUYWciLCJiYXNlR2V0VGFnIiwiaXNPYmplY3RMaWtlIiwic3ltYm9sVGFnIiwiaXNTeW1ib2wiLCJhcnJheU1hcCIsImFycmF5IiwiaXRlcmF0ZWUiLCJpbmRleCIsImxlbmd0aCIsImlzQXJyYXkiLCJzeW1ib2xQcm90byIsInN5bWJvbFRvU3RyaW5nIiwiYmFzZVRvU3RyaW5nIiwiaXNPYmplY3QiLCJ0eXBlIiwiYXN5bmNUYWciLCJmdW5jVGFnIiwiZ2VuVGFnIiwicHJveHlUYWciLCJpc0Z1bmN0aW9uIiwiY29yZUpzRGF0YSIsIm1hc2tTcmNLZXkiLCJ1aWQiLCJpc01hc2tlZCIsImZ1bmMiLCJmdW5jUHJvdG8iLCJmdW5jVG9TdHJpbmciLCJ0b1NvdXJjZSIsInJlUmVnRXhwQ2hhciIsInJlSXNIb3N0Q3RvciIsInJlSXNOYXRpdmUiLCJiYXNlSXNOYXRpdmUiLCJwYXR0ZXJuIiwiZ2V0VmFsdWUiLCJvYmplY3QiLCJrZXkiLCJnZXROYXRpdmUiLCJXZWFrTWFwIiwib2JqZWN0Q3JlYXRlIiwiYmFzZUNyZWF0ZSIsInByb3RvIiwiY29weUFycmF5Iiwic291cmNlIiwiZGVmaW5lUHJvcGVydHkiLCJhcnJheUVhY2giLCJNQVhfU0FGRV9JTlRFR0VSIiwicmVJc1VpbnQiLCJpc0luZGV4IiwiYmFzZUFzc2lnblZhbHVlIiwiZXEiLCJvdGhlciIsImFzc2lnblZhbHVlIiwib2JqVmFsdWUiLCJjb3B5T2JqZWN0IiwicHJvcHMiLCJjdXN0b21pemVyIiwiaXNOZXciLCJuZXdWYWx1ZSIsImlzTGVuZ3RoIiwiaXNBcnJheUxpa2UiLCJpc1Byb3RvdHlwZSIsIkN0b3IiLCJiYXNlVGltZXMiLCJuIiwiYXJnc1RhZyIsImJhc2VJc0FyZ3VtZW50cyIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwiaXNBcmd1bWVudHMiLCJzdHViRmFsc2UiLCJmcmVlRXhwb3J0cyIsImZyZWVNb2R1bGUiLCJtb2R1bGVFeHBvcnRzIiwiQnVmZmVyIiwibmF0aXZlSXNCdWZmZXIiLCJpc0J1ZmZlciIsImFycmF5VGFnIiwiYm9vbFRhZyIsImRhdGVUYWciLCJlcnJvclRhZyIsIm1hcFRhZyIsIm51bWJlclRhZyIsIm9iamVjdFRhZyIsInJlZ2V4cFRhZyIsInNldFRhZyIsInN0cmluZ1RhZyIsIndlYWtNYXBUYWciLCJhcnJheUJ1ZmZlclRhZyIsImRhdGFWaWV3VGFnIiwiZmxvYXQzMlRhZyIsImZsb2F0NjRUYWciLCJpbnQ4VGFnIiwiaW50MTZUYWciLCJpbnQzMlRhZyIsInVpbnQ4VGFnIiwidWludDhDbGFtcGVkVGFnIiwidWludDE2VGFnIiwidWludDMyVGFnIiwidHlwZWRBcnJheVRhZ3MiLCJiYXNlSXNUeXBlZEFycmF5IiwiYmFzZVVuYXJ5IiwiZnJlZVByb2Nlc3MiLCJub2RlVXRpbCIsInR5cGVzIiwibm9kZUlzVHlwZWRBcnJheSIsImlzVHlwZWRBcnJheSIsImFycmF5TGlrZUtleXMiLCJpbmhlcml0ZWQiLCJpc0FyciIsImlzQXJnIiwiaXNCdWZmIiwiaXNUeXBlIiwic2tpcEluZGV4ZXMiLCJvdmVyQXJnIiwidHJhbnNmb3JtIiwiYXJnIiwibmF0aXZlS2V5cyIsImJhc2VLZXlzIiwia2V5cyIsIm5hdGl2ZUtleXNJbiIsImJhc2VLZXlzSW4iLCJpc1Byb3RvIiwia2V5c0luIiwicmVJc0RlZXBQcm9wIiwicmVJc1BsYWluUHJvcCIsImlzS2V5IiwibmF0aXZlQ3JlYXRlIiwiaGFzaENsZWFyIiwiaGFzaERlbGV0ZSIsIkhBU0hfVU5ERUZJTkVEIiwiaGFzaEdldCIsImRhdGEiLCJoYXNoSGFzIiwiaGFzaFNldCIsIkhhc2giLCJlbnRyaWVzIiwiZW50cnkiLCJsaXN0Q2FjaGVDbGVhciIsImFzc29jSW5kZXhPZiIsImFycmF5UHJvdG8iLCJzcGxpY2UiLCJsaXN0Q2FjaGVEZWxldGUiLCJsYXN0SW5kZXgiLCJsaXN0Q2FjaGVHZXQiLCJsaXN0Q2FjaGVIYXMiLCJsaXN0Q2FjaGVTZXQiLCJMaXN0Q2FjaGUiLCJNYXAiLCJtYXBDYWNoZUNsZWFyIiwiaXNLZXlhYmxlIiwiZ2V0TWFwRGF0YSIsIm1hcCIsIm1hcENhY2hlRGVsZXRlIiwibWFwQ2FjaGVHZXQiLCJtYXBDYWNoZUhhcyIsIm1hcENhY2hlU2V0Iiwic2l6ZSIsIk1hcENhY2hlIiwiRlVOQ19FUlJPUl9URVhUIiwibWVtb2l6ZSIsInJlc29sdmVyIiwibWVtb2l6ZWQiLCJhcmdzIiwiY2FjaGUiLCJNQVhfTUVNT0laRV9TSVpFIiwibWVtb2l6ZUNhcHBlZCIsInJlUHJvcE5hbWUiLCJyZUVzY2FwZUNoYXIiLCJzdHJpbmdUb1BhdGgiLCJzdHJpbmciLCJtYXRjaCIsIm51bWJlciIsInF1b3RlIiwic3ViU3RyaW5nIiwidG9TdHJpbmciLCJjYXN0UGF0aCIsInRvS2V5IiwiYmFzZUdldCIsInBhdGgiLCJnZXQiLCJkZWZhdWx0VmFsdWUiLCJhcnJheVB1c2giLCJ2YWx1ZXMiLCJvZmZzZXQiLCJnZXRQcm90b3R5cGUiLCJiYXNlU2xpY2UiLCJzdGFydCIsImVuZCIsInN0YWNrQ2xlYXIiLCJzdGFja0RlbGV0ZSIsInN0YWNrR2V0Iiwic3RhY2tIYXMiLCJMQVJHRV9BUlJBWV9TSVpFIiwic3RhY2tTZXQiLCJwYWlycyIsIlN0YWNrIiwiYmFzZUFzc2lnbiIsImJhc2VBc3NpZ25JbiIsImFsbG9jVW5zYWZlIiwiY2xvbmVCdWZmZXIiLCJidWZmZXIiLCJpc0RlZXAiLCJhcnJheUZpbHRlciIsInByZWRpY2F0ZSIsInJlc0luZGV4Iiwic3R1YkFycmF5IiwibmF0aXZlR2V0U3ltYm9scyIsImdldFN5bWJvbHMiLCJzeW1ib2wiLCJjb3B5U3ltYm9scyIsImdldFN5bWJvbHNJbiIsImNvcHlTeW1ib2xzSW4iLCJiYXNlR2V0QWxsS2V5cyIsImtleXNGdW5jIiwic3ltYm9sc0Z1bmMiLCJnZXRBbGxLZXlzIiwiRGF0YVZpZXciLCJQcm9taXNlIiwiU2V0IiwicHJvbWlzZVRhZyIsImRhdGFWaWV3Q3RvclN0cmluZyIsIm1hcEN0b3JTdHJpbmciLCJwcm9taXNlQ3RvclN0cmluZyIsInNldEN0b3JTdHJpbmciLCJ3ZWFrTWFwQ3RvclN0cmluZyIsImdldFRhZyIsImN0b3JTdHJpbmciLCJpbml0Q2xvbmVBcnJheSIsIlVpbnQ4QXJyYXkiLCJjbG9uZUFycmF5QnVmZmVyIiwiYXJyYXlCdWZmZXIiLCJjbG9uZURhdGFWaWV3IiwiZGF0YVZpZXciLCJyZUZsYWdzIiwiY2xvbmVSZWdFeHAiLCJyZWdleHAiLCJzeW1ib2xWYWx1ZU9mIiwiY2xvbmVTeW1ib2wiLCJjbG9uZVR5cGVkQXJyYXkiLCJ0eXBlZEFycmF5IiwiaW5pdENsb25lQnlUYWciLCJpbml0Q2xvbmVPYmplY3QiLCJiYXNlSXNNYXAiLCJub2RlSXNNYXAiLCJpc01hcCIsImJhc2VJc1NldCIsIm5vZGVJc1NldCIsImlzU2V0IiwiQ0xPTkVfRkxBVF9GTEFHIiwiY2xvbmVhYmxlVGFncyIsImJhc2VDbG9uZSIsImJpdG1hc2siLCJzdGFjayIsImlzRmxhdCIsImlzRnVuYyIsInN0YWNrZWQiLCJzdWJWYWx1ZSIsIkNMT05FX1NZTUJPTFNfRkxBRyIsImNsb25lIiwic2V0Q2FjaGVBZGQiLCJzZXRDYWNoZUhhcyIsIlNldENhY2hlIiwiYXJyYXlTb21lIiwiY2FjaGVIYXMiLCJDT01QQVJFX1BBUlRJQUxfRkxBRyIsIkNPTVBBUkVfVU5PUkRFUkVEX0ZMQUciLCJlcXVhbEFycmF5cyIsImVxdWFsRnVuYyIsImlzUGFydGlhbCIsImFyckxlbmd0aCIsIm90aExlbmd0aCIsImFyclN0YWNrZWQiLCJvdGhTdGFja2VkIiwic2VlbiIsImFyclZhbHVlIiwib3RoVmFsdWUiLCJjb21wYXJlZCIsIm90aEluZGV4IiwibWFwVG9BcnJheSIsInNldFRvQXJyYXkiLCJzZXQiLCJlcXVhbEJ5VGFnIiwiY29udmVydCIsImVxdWFsT2JqZWN0cyIsIm9ialByb3BzIiwib2JqTGVuZ3RoIiwib3RoUHJvcHMiLCJvYmpTdGFja2VkIiwic2tpcEN0b3IiLCJvYmpDdG9yIiwib3RoQ3RvciIsImJhc2VJc0VxdWFsRGVlcCIsIm9iaklzQXJyIiwib3RoSXNBcnIiLCJvYmpUYWciLCJvdGhUYWciLCJvYmpJc09iaiIsIm90aElzT2JqIiwiaXNTYW1lVGFnIiwib2JqSXNXcmFwcGVkIiwib3RoSXNXcmFwcGVkIiwib2JqVW53cmFwcGVkIiwib3RoVW53cmFwcGVkIiwiYmFzZUlzRXF1YWwiLCJsYXN0IiwicGFyZW50IiwiaXNFcXVhbCIsImJhc2VVbnNldCIsInVuc2V0IiwiZ2xvYmFsVmFyIiwiZ2xvYmFsIiwic3B5IiwiRXZlbnRJbmZvIiwibmFtZSIsIl9fcHVibGljRmllbGQiLCJIRVhfTlVNQkVSUyIsIl8iLCJyMSIsInIyIiwicjMiLCJyNCIsInByaW9yaXRpZXMiLCJwcmlvcml0eSIsImluc2VydFRvUHJpb3JpdHlBcnJheSIsIm9iamVjdHMiLCJvYmplY3RUb0luc2VydCIsImxlZnQiLCJyaWdodCIsIm1pZCIsIkRPQ1VNRU5UQVRJT05fVVJMIiwiQ0tFZGl0b3JFcnJvciIsImVycm9yTmFtZSIsImNvbnRleHQiLCJnZXRFcnJvck1lc3NhZ2UiLCJlcnIiLCJlcnJvciIsImxvZ1dhcm5pbmciLCJmb3JtYXRDb25zb2xlQXJndW1lbnRzIiwiZ2V0TGlua1RvRG9jdW1lbnRhdGlvbk1lc3NhZ2UiLCJwcm9jZXNzZWRPYmplY3RzIiwic3RyaW5naWZpZWREYXRhIiwiZG9jdW1lbnRhdGlvbkxpbmsiLCJkb2N1bWVudGF0aW9uTWVzc2FnZSIsInZlcnNpb24iLCJfbGlzdGVuaW5nVG8iLCJfZW1pdHRlcklkIiwiX2RlbGVnYXRpb25zIiwiZGVmYXVsdEVtaXR0ZXJDbGFzcyQxIiwiRW1pdHRlck1peGluIiwiYmFzZSIsIk1peGluIiwiZXZlbnQiLCJjYWxsYmFjayIsIm9wdGlvbnMiLCJ3YXNGaXJlZCIsIm9uY2VDYWxsYmFjayIsImVtaXR0ZXIiLCJlbWl0dGVySW5mbyIsImV2ZW50Q2FsbGJhY2tzIiwiZW1pdHRlcnMiLCJfZ2V0RW1pdHRlcklkIiwiX3NldEVtaXR0ZXJJZCIsImVtaXR0ZXJJZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnRPckluZm8iLCJldmVudEluZm8iLCJjYWxsYmFja3MiLCJnZXRDYWxsYmFja3NGb3JFdmVudCIsImkiLCJmbiIsImRlbGVnYXRpb25zIiwiZGVzdGluYXRpb25zIiwicGFzc0FsbERlc3RpbmF0aW9ucyIsImZpcmVEZWxlZ2F0ZWRFdmVudHMiLCJldmVudHMiLCJuYW1lT3JGdW5jdGlvbiIsImV2ZW50TmFtZSIsImNyZWF0ZUV2ZW50TmFtZXNwYWNlIiwibGlzdHMiLCJnZXRDYWxsYmFja3NMaXN0c0Zvck5hbWVzcGFjZSIsImNhbGxiYWNrRGVmaW5pdGlvbiIsIl9nZXRFbWl0dGVyTGlzdGVuZWRUbyIsImxpc3RlbmluZ0VtaXR0ZXIiLCJsaXN0ZW5lZFRvRW1pdHRlcklkIiwibGlzdGVuaW5nVG8iLCJpZCIsImdldEV2ZW50cyIsIm1ha2VFdmVudE5vZGUiLCJjaGlsZEV2ZW50TmFtZSIsIm5ld0V2ZW50Tm9kZXMiLCJub2RlIiwiZXZlbnROb2RlIiwiY2FsbGJhY2tzTGlzdHMiLCJjaGlsZENhbGxiYWNrc0xpc3RzIiwiY3VycmVudEV2ZW50TmFtZSIsImNvbG9uSW5kZXgiLCJmaXJlQXJncyIsImRlbGVnYXRlZEluZm8iLCJsaXN0ZW5lciIsIm9ic2VydmFibGVQcm9wZXJ0aWVzU3ltYm9sIiwiYm91bmRPYnNlcnZhYmxlc1N5bWJvbCIsImJvdW5kUHJvcGVydGllc1N5bWJvbCIsImRlY29yYXRlZE1ldGhvZHMiLCJkZWNvcmF0ZWRPcmlnaW5hbCIsImRlZmF1bHRPYnNlcnZhYmxlQ2xhc3MiLCJPYnNlcnZhYmxlTWl4aW4iLCJfZSIsIl9kIiwiX2MiLCJfYiIsIl9hIiwicHJvcGVydHkiLCJpbml0T2JzZXJ2YWJsZSIsInByb3BlcnRpZXMiLCJvbGRWYWx1ZSIsImJpbmRQcm9wZXJ0aWVzIiwiaXNTdHJpbmdBcnJheSIsImJvdW5kUHJvcGVydGllcyIsInByb3BlcnR5TmFtZSIsImJpbmRpbmdzIiwiYSIsImJpbmRpbmciLCJiaW5kVG8iLCJiaW5kVG9NYW55IiwidW5iaW5kUHJvcGVydGllcyIsImJvdW5kT2JzZXJ2YWJsZXMiLCJ0b09ic2VydmFibGUiLCJ0b1Byb3BlcnR5IiwidG9Qcm9wZXJ0aWVzIiwidG9Qcm9wZXJ0eUJpbmRpbmdzIiwiYm91bmRPYnNlcnZhYmxlIiwibWV0aG9kTmFtZSIsIm9yaWdpbmFsTWV0aG9kIiwiZXZ0Iiwib2JzZXJ2YWJsZSIsInBhcnNlZEFyZ3MiLCJwYXJzZUJpbmRUb0FyZ3MiLCJiaW5kaW5nc0tleXMiLCJudW1iZXJPZkJpbmRpbmdzIiwidG8iLCJhdHRhY2hCaW5kVG9MaXN0ZW5lcnMiLCJ1cGRhdGVCaW5kVG9Cb3VuZCIsInVwZGF0ZUJvdW5kT2JzZXJ2YWJsZVByb3BlcnR5Iiwib2JzZXJ2YWJsZXMiLCJhdHRyaWJ1dGUiLCJnZXRCaW5kaW5nVGFyZ2V0cyIsIm9ic2VydmFibGVBbmRBdHRyaWJ1dGVQYWlycyIsImFyciIsInBhcnNlZCIsImxhc3RPYnNlcnZhYmxlIiwidXBkYXRlQm91bmRPYnNlcnZhYmxlcyIsInRvUHJvcGVydHlOYW1lIiwiYmluZGluZ3NUb09ic2VydmFibGUiLCJjaGFpbiIsInByb3BlcnR5VmFsdWUiLCJ0b0JpbmRpbmdzIiwiY291bnQiLCJpdGVyYWJsZSIsImNvbXBhcmVBcnJheXMiLCJiIiwibWluTGVuIiwiaXNJdGVyYWJsZSIsImlzTm9kZSIsIm9iaiIsImlzV2luZG93Iiwic3RyaW5naWZpZWRPYmplY3QiLCJkZWZhdWx0RW1pdHRlckNsYXNzIiwiRG9tRW1pdHRlck1peGluIiwicHJveHlPcHRpb25zIiwicHJveHlFbWl0dGVyIiwiUHJveHlFbWl0dGVyIiwicHJveHlFbWl0dGVycyIsInByb3h5IiwiZ2V0UHJveHlFbWl0dGVySWQiLCJkb21MaXN0ZW5lciIsImRvbUV2dCIsImdldE5vZGVVSUQiLCJvcHRpb24iLCJrZXlDb2RlcyIsImdlbmVyYXRlS25vd25LZXlDb2RlcyIsImNvZGUiLCJsZXR0ZXIiLCJ0b0FycmF5IiwiQ29sbGVjdGlvbiIsImluaXRpYWxJdGVtc09yT3B0aW9ucyIsImhhc0luaXRpYWxJdGVtcyIsIml0ZW0iLCJpdGVtcyIsIml0ZW1JZCIsImN1cnJlbnRJdGVtSW5kZXgiLCJpZE9ySW5kZXgiLCJpdGVtT3JJZCIsImlkUHJvcGVydHkiLCJzdWJqZWN0IiwiY3R4IiwicmVtb3ZlZEl0ZW1zIiwiZXh0ZXJuYWxDb2xsZWN0aW9uIiwiQ2xhc3MiLCJjYWxsYmFja09yUHJvcGVydHkiLCJmYWN0b3J5IiwiYWRkSXRlbSIsImV4dGVybmFsSXRlbSIsImlzRXh0ZXJuYWxCb3VuZFRvVGhpcyIsImV4dGVybmFsSXRlbUJvdW5kIiwiZmluYWxJbmRleCIsInNraXBwZWQiLCJpdGVtRG9lc05vdEV4aXN0Iiwib2JqZWN0VG9NYXAiLCJ0b01hcCIsInNwbGljZUFycmF5IiwidGFyZ2V0QXJyYXkiLCJpbnNlcnRBcnJheSIsIm9yaWdpbmFsTGVuZ3RoIiwiaW5zZXJ0TGVuZ3RoIiwiVHlwZUNoZWNrYWJsZSQxIiwiTm9kZSQyIiwiZG9jdW1lbnQiLCJwb3MiLCJhbmNlc3RvcnMiLCJhbmNlc3RvcnNBIiwiYW5jZXN0b3JzQiIsInRoaXNQYXRoIiwibm9kZVBhdGgiLCJqc29uIiwiVGV4dCQxIiwiVGV4dCIsIm90aGVyTm9kZSIsIlRleHRQcm94eSQxIiwidGV4dE5vZGUiLCJvZmZzZXRJblRleHQiLCJub3JtYWxpemVDb25zdW1hYmxlcyIsImNvbnN1bWFibGVzIiwiYXR0cmlidXRlcyIsIm5vcm1hbGl6ZUNvbnN1bWFibGVQYXJ0IiwicHJlZml4IiwiTWF0Y2hlciIsImVsZW1lbnQiLCJzaW5nbGVFbGVtZW50IiwicmVzdWx0cyIsIm1hdGNoTmFtZSIsImF0dHJpYnV0ZXNNYXRjaCIsIm1hdGNoQXR0cmlidXRlcyIsIm1hdGNoQ2xhc3NlcyIsIm1hdGNoU3R5bGVzIiwiaXNQYXR0ZXJuTWF0Y2hlZCIsIm5vcm1hbGl6ZVBhdHRlcm5zIiwicGF0dGVybnMiLCJub3JtYWxpemVkUGF0dGVybnMiLCJleGNsdWRlQXR0cmlidXRlcyIsIlN0eWxlc01hcCIsInN0eWxlUHJvY2Vzc29yIiwiaW5saW5lU3R5bGUiLCJwYXJzZWRTdHlsZXMiLCJwYXJzZUlubGluZVN0eWxlcyIsInByb3BlcnR5RGVzY3JpcHRvciIsIm5hbWVPck9iamVjdCIsInZhbHVlT3JPYmplY3QiLCJuYW1lcyIsInRvUGF0aCIsImV4cGFuZCIsInRva2VuUGF0dGVybiIsInZhbHVlUGF0dGVybiIsInN0eWxlTmFtZSIsInJlbGF0ZWROYW1lIiwicHJvcCIsInBhdGhQYXJ0cyIsInBhcmVudFBhdGgiLCJwYXJlbnRPYmplY3QiLCJzdHlsZXNTdHJpbmciLCJxdW90ZVR5cGUiLCJwcm9wZXJ0eU5hbWVTdGFydCIsInByb3BlcnR5VmFsdWVTdGFydCIsInN0eWxlc01hcCIsImNoYXIiLCJUb2tlbkxpc3QiLCJ0b2tlbiIsInRva2VucyIsIkVsZW1lbnQkMSIsIkVsZW1lbnQiLCJhdHRycyIsImNoaWxkcmVuIiwidXNlc1N0eWxlc01hcCIsInVzZXNUb2tlbkxpc3QiLCJvdGhlckVsZW1lbnQiLCJvdGhlclZhbHVlIiwiY2xhc3NOYW1lIiwiaXRlcmF0b3IiLCJtYXRjaGVyIiwiY2xhc3NlcyIsInN0eWxlcyIsImF0dHJpYnV0ZU5hbWUiLCJkZWVwIiwiY2hpbGRyZW5DbG9uZSIsImNoaWxkIiwiY2xvbmVkIiwibm9kZXMiLCJub3JtYWxpemUkMyIsImhvd01hbnkiLCJvdmVyd3JpdGUiLCJjdXJyZW50VmFsdWUiLCJleGNsdWRlIiwia2V5UGF0dGVybiIsImhhc0tleSIsImhhc1ZhbHVlIiwidG9rZW5NYXRjaCIsInRva2VuTWF0Y2hJdGVtIiwiYXR0cnNNYXAiLCJub3JtYWxpemVkTm9kZXMiLCJlbGVtZW50TmFtZSIsIkNvbnRhaW5lckVsZW1lbnQiLCJnZXRGaWxsZXJPZmZzZXQkNCIsImxhc3RDaGlsZCIsIkVkaXRhYmxlRWxlbWVudCIsImlzRm9jdXNlZCIsInJvb3ROYW1lU3ltYm9sIiwiUm9vdEVkaXRhYmxlRWxlbWVudCIsInJvb3ROYW1lIiwiVHJlZVdhbGtlciQxIiwiUG9zaXRpb24kMSIsInNraXAiLCJuZXh0UmVzdWx0IiwicHJldlBvc2l0aW9uIiwicG9zaXRpb24iLCJwcmV2aW91c1Bvc2l0aW9uIiwidGV4dExlbmd0aCIsInRleHRQcm94eSIsImNoYXJhY3RlcnNDb3VudCIsInN0YXJ0T2Zmc2V0IiwibmV4dFBvc2l0aW9uIiwiUG9zaXRpb24iLCJlbmRPZmZzZXQiLCJlZGl0YWJsZSIsInNoaWZ0Iiwic2hpZnRlZCIsInRyZWVXYWxrZXIiLCJvdGhlclBvc2l0aW9uIiwib3RoZXJQYXRoIiwiaXRlbU9yUG9zaXRpb24iLCJSYW5nZSQxIiwiUmFuZ2UiLCJlbmxhcmdlVHJpbVNraXAiLCJub2RlQWZ0ZXJTdGFydCIsIm5vZGVCZWZvcmVFbmQiLCJvdGhlclJhbmdlIiwibG9vc2UiLCJjb250YWluc1N0YXJ0IiwiY29udGFpbnNFbmQiLCJyYW5nZXMiLCJjb21tb25SYW5nZVN0YXJ0IiwiY29tbW9uUmFuZ2VFbmQiLCJzdGFydEVsZW1lbnQiLCJlbmRFbGVtZW50IiwiU2VsZWN0aW9uJDEiLCJTZWxlY3Rpb24iLCJyYW5nZSIsImZpcnN0IiwiZmlyc3RSYW5nZSIsImxhc3RSYW5nZSIsIm90aGVyU2VsZWN0aW9uIiwidGhpc1JhbmdlIiwiZm91bmQiLCJudW1PZlJhbmdlc0EiLCJudW1PZlJhbmdlc0IiLCJyYW5nZUEiLCJyYW5nZUIiLCJzZWxlY3RhYmxlIiwicGxhY2VPck9mZnNldCIsIkRvY3VtZW50U2VsZWN0aW9uJDEiLCJiYWNrd2FyZCIsIm5ld0ZvY3VzIiwiYW5jaG9yIiwibmV3UmFuZ2VzIiwiaXNMYXN0QmFja3dhcmQiLCJpc0JhY2t3YXJkIiwic3RvcmVkUmFuZ2UiLCJCdWJibGluZ0V2ZW50SW5mbyIsInN0YXJ0UmFuZ2UiLCJjb250ZXh0c1N5bWJvbCIsIkJ1YmJsaW5nRW1pdHRlck1peGluIiwiZXZlbnRBcmdzIiwiZXZlbnRDb250ZXh0cyIsImdldEJ1YmJsaW5nQ29udGV4dHMiLCJ1cGRhdGVFdmVudEluZm8iLCJmaXJlTGlzdGVuZXJGb3IiLCJzZWxlY3RlZEVsZW1lbnQiLCJpc0N1c3RvbUNvbnRleHQiLCJnZXRDdXN0b21Db250ZXh0IiwiZ2V0RGVlcGVyUmFuZ2VQYXJlbnQiLCJjb250ZXh0cyIsIm1peGluIiwiZXZlbnRQaGFzZSIsImN1cnJlbnRUYXJnZXQiLCJzdGFydFBhcmVudCIsImVuZFBhcmVudCIsInN0YXJ0UGF0aCIsImVuZFBhdGgiLCJERUZBVUxUX1BSSU9SSVRZIiwiQXR0cmlidXRlRWxlbWVudCIsImdldEZpbGxlck9mZnNldCQzIiwibm9uVWlDaGlsZHJlbkNvdW50IiwiRW1wdHlFbGVtZW50IiwiZ2V0RmlsbGVyT2Zmc2V0JDIiLCJVSUVsZW1lbnQiLCJnZXRGaWxsZXJPZmZzZXQkMSIsImRvbURvY3VtZW50IiwiZG9tQ29udmVydGVyIiwiZG9tRWxlbWVudCIsIlJhd0VsZW1lbnQiLCJnZXRGaWxsZXJPZmZzZXQiLCJEb2N1bWVudEZyYWdtZW50JDEiLCJub3JtYWxpemUkMiIsIk5CU1BfRklMTEVSIiwiTUFSS0VEX05CU1BfRklMTEVSIiwic3BhbiIsIkJSX0ZJTExFUiIsImZpbGxlckJyIiwiVHlwZUNoZWNrYWJsZSIsIlRleHRQcm94eSIsIlRyZWVXYWxrZXIiLCJkaXJlY3Rpb24iLCJkb25lIiwicHJldlZpc2l0ZWRQYXJlbnQiLCJ0ZXh0Tm9kZUF0UG9zaXRpb24iLCJnZXRUZXh0Tm9kZUF0UG9zaXRpb24iLCJnZXROb2RlQWZ0ZXJQb3NpdGlvbiIsImZvcm1hdFJldHVyblZhbHVlIiwib2Zmc2V0SW5UZXh0Tm9kZSIsInBvc2l0aW9uUGFyZW50IiwiZ2V0Tm9kZUJlZm9yZVBvc2l0aW9uIiwic3RpY2tpbmVzcyIsIm5ld09mZnNldCIsInBhcmVudE5hbWUiLCJjbXAiLCJkaWZmQXQiLCJjb21tb25MZXZlbCIsImxldmVsIiwiZGlmZiIsImNoZWNrVG91Y2hpbmdCcmFuY2giLCJjaGVja09ubHlaZXJvZXMiLCJ0aGlzUGFyZW50UGF0aCIsInBvc1BhcmVudFBhdGgiLCJvcGVyYXRpb24iLCJtb3ZlZFJhbmdlIiwiaXNDb250YWluZWQiLCJkZWxldGVQb3NpdGlvbiIsInRyYW5zZm9ybWVkIiwiaW5zZXJ0UG9zaXRpb24iLCJzb3VyY2VQb3NpdGlvbiIsInRhcmdldFBvc2l0aW9uIiwidGFyZ2V0IiwiY29tYmluZWQiLCJkb2MiLCJjaGVja09ubHlNYXhPZmZzZXQiLCJpZHgiLCJhZGQiLCJzdGFydFBhcmVudFBhdGgiLCJlbmRQYXJlbnRQYXRoIiwic2hvdWxkSm9pbiIsInN0YXJ0UG9zaXRpb24iLCJlbmRQb3NpdGlvbiIsInBvc1BhcmVudCIsIm9wZXJhdGlvbnMiLCJqIiwibmV4dCIsInNwcmVhZCIsIm5ld1BvcyIsIm1vdmVSYW5nZSIsImRpZmZlcmVuY2VTZXQiLCJkaWZmZXJlbmNlIiwiY29tbW9uIiwidHJhbnNmb3JtZWRDb21tb24iLCJuZXdTdGFydCIsIm5ld0VuZCIsInJlZiIsInJlZkluZGV4IiwiTm9kZSQxIiwiYXR0ciIsIl9kZWVwIiwiYW55TmV3UmFuZ2UiLCJuZXdSYW5nZSIsIm9sZFJhbmdlIiwidmlzaXRlZCIsInN0YXJ0QmxvY2siLCJnZXRQYXJlbnRCbG9jayQxIiwiaXNTdGFydEJsb2NrU2VsZWN0ZWQiLCJ0cmVld2Fsa2VyIiwiYmxvY2siLCJpc1VudmlzaXRlZFRvcEJsb2NrIiwiZW5kQmxvY2siLCJpc0VuZEJsb2NrU2VsZWN0ZWQiLCJsaW1pdFN0YXJ0UG9zaXRpb24iLCJsaW1pdEVuZFBvc2l0aW9uIiwiaXNVbnZpc2l0ZWRCbG9jayIsImlzVG9wQmxvY2tJblJhbmdlIiwic2NoZW1hIiwiaGFzUGFyZW50TGltaXQiLCJwYXJlbnRCbG9jayIsImZpbmRBbmNlc3RvckJsb2NrIiwiTGl2ZVJhbmdlIiwiYmluZFdpdGhEb2N1bWVudCQxIiwidHJhbnNmb3JtJDIiLCJib3VuZGFyaWVzQ2hhbmdlZCIsImNvbnRlbnRDaGFuZ2VkIiwiZG9lc09wZXJhdGlvbkNoYW5nZVJhbmdlQ29udGVudCIsImRlbGV0aW9uUG9zaXRpb24iLCJzdG9yZVByZWZpeCIsIkRvY3VtZW50U2VsZWN0aW9uIiwiTGl2ZVNlbGVjdGlvbiIsInByZWZpeE9yTmFtZSIsIm1hcmtlciIsImJhdGNoIiwiY2xlYXJBdHRyaWJ1dGVzU3RvcmVkSW5FbGVtZW50IiwiYXR0cmlidXRlS2V5cyIsIm92ZXJyaWRlVWlkIiwibGl2ZVJhbmdlIiwibWFya2VycyIsImNoYW5nZWQiLCJtYXJrZXJHcm91cCIsIm1hcmtlclJhbmdlIiwic2VsZWN0aW9uUmFuZ2UiLCJvbGRNYXJrZXJzIiwiaGFzTWFya2VyIiwiY29udGFpbmVkIiwiY2xlYXJBbGwiLCJuZXdBdHRyaWJ1dGVzIiwib2xkQXR0cmlidXRlcyIsIm5ld0tleSIsIm9sZEtleSIsImRpcmVjdENoYW5nZSIsInNlbGVjdGlvblBhcmVudCIsIm5vZGVCZWZvcmUiLCJub2RlQWZ0ZXIiLCJnZXRUZXh0QXR0cmlidXRlcyIsIm1vZGVsIiwiZGlmZmVyIiwiY2hhbmdlUGFyZW50Iiwid3JpdGVyIiwic3RvcmVkQXR0cmlidXRlcyIsIk5vZGVMaXN0Iiwibm9kZXNBcnJheSIsIm1ha2VPZmZzZXRzQXJyYXkiLCJpbmRleFN0YXJ0IiwibGFzdE5vZGUiLCJyZW1vdmVkT2Zmc2V0U3VtIiwib2Zmc2V0cyIsInJlbGF0aXZlUGF0aCIsImNsb25lTm9kZXMiLCJub3JtYWxpemUkMSIsImNsb25lZE5vZGVzIiwiT3BlcmF0aW9uIiwiYmFzZVZlcnNpb24iLCJfaW5zZXJ0IiwiX25vcm1hbGl6ZU5vZGVzIiwic3VtIiwiX3NwbGl0Tm9kZUF0UG9zaXRpb24iLCJfbWVyZ2VOb2Rlc0F0SW5kZXgiLCJfcmVtb3ZlIiwicmVtb3ZlZCIsIl9tb3ZlIiwic291cmNlUmFuZ2UiLCJfc2V0QXR0cmlidXRlIiwibm9ybWFsaXplZCIsInByZXYiLCJfaGF2ZVNhbWVBdHRyaWJ1dGVzIiwibWVyZ2VkTm9kZSIsIm9mZnNldERpZmYiLCJmaXJzdFBhcnQiLCJzZWNvbmRQYXJ0Iiwibm9kZUEiLCJub2RlQiIsIml0ZXJhdG9yQSIsIml0ZXJhdG9yQiIsIk1vdmVPcGVyYXRpb24iLCJuZXdUYXJnZXRQb3NpdGlvbiIsInNvdXJjZUVsZW1lbnQiLCJ0YXJnZXRFbGVtZW50Iiwic291cmNlT2Zmc2V0IiwidGFyZ2V0T2Zmc2V0IiwiSW5zZXJ0T3BlcmF0aW9uIiwiaW5zZXJ0IiwiZ3JhdmV5YXJkIiwiZ3lQb3NpdGlvbiIsIm9yaWdpbmFsTm9kZXMiLCJTcGxpdE9wZXJhdGlvbiIsInNwbGl0UG9zaXRpb24iLCJpbnNlcnRpb25Qb3NpdGlvbiIsImdyYXZleWFyZFBvc2l0aW9uIiwiTWVyZ2VPcGVyYXRpb24iLCJzcGxpdEVsZW1lbnQiLCJuZXdFbGVtZW50IiwibWVyZ2VkRWxlbWVudCIsIk1hcmtlck9wZXJhdGlvbiIsImFmZmVjdHNEYXRhIiwiQXR0cmlidXRlT3BlcmF0aW9uIiwiTm9PcGVyYXRpb24iLCJSZW5hbWVPcGVyYXRpb24iLCJvbGROYW1lIiwibmV3TmFtZSIsIlJvb3RBdHRyaWJ1dGVPcGVyYXRpb24iLCJSb290T3BlcmF0aW9uIiwiaXNBZGQiLCJ0cmFuc2Zvcm1hdGlvbnMiLCJzZXRUcmFuc2Zvcm1hdGlvbiIsIk9wZXJhdGlvbkEiLCJPcGVyYXRpb25CIiwidHJhbnNmb3JtYXRpb25GdW5jdGlvbiIsImFHcm91cCIsIm9wIiwiX2dldENvbXBsZW1lbnRhcnlBdHRyaWJ1dGVPcGVyYXRpb25zIiwiaW5zZXJ0T3BlcmF0aW9uIiwiaW5zZXJ0VmFsdWUiLCJfYnJlYWtSYW5nZUJ5TW92ZU9wZXJhdGlvbiIsIm1vdmVPcCIsImRpZmZzIiwiYU5ld1JhbmdlIiwiYVRvR3JhdmV5YXJkIiwiYlRvR3JhdmV5YXJkIiwicmVtb3ZlZFJhbmdlIiwiYUlzU3Ryb25nIiwiaW5zZXJ0QmVmb3JlIiwiX21vdmVUYXJnZXRJbnRvTW92ZWRSYW5nZSIsIl9tYWtlTW92ZU9wZXJhdGlvbnNGcm9tUmFuZ2VzIiwiYUNvbXBCIiwic2hvdWxkU3ByZWFkIiwicmlnaHRSYW5nZSIsIm1vdmVzR3JhdmV5YXJkRWxlbWVudCIsImd5TW92ZVNvdXJjZSIsInNwbGl0Tm9kZXNNb3ZlU291cmNlIiwiYVRhcmdldCIsImd5TW92ZVRhcmdldCIsImd5TW92ZSIsInNwbGl0Tm9kZXNNb3ZlVGFyZ2V0UGF0aCIsInNwbGl0Tm9kZXNNb3ZlVGFyZ2V0Iiwic3BsaXROb2Rlc01vdmUiLCJyZW5hbWVQYXRoIiwic3BsaXRQYXRoIiwiZXh0cmFSZW5hbWUiLCJhZGRpdGlvbmFsU3BsaXQiLCJyYW5nZVRvTW92ZSIsImd5RWxlbWVudE1vdmVkIiwibmV3UGFyZW50UG9zaXRpb24iLCJuZXdUYXJnZXRQYXRoIiwic3BsaXRBdFRhcmdldCIsImhvd01hbnlSZW1vdmVkIiwiYUluR3JhdmV5YXJkIiwiYkluR3JhdmV5YXJkIiwibmV3UG9zaXRpb25QYXRoIiwibmV3UG9zaXRpb24iLCJMaXZlUG9zaXRpb24iLCJiaW5kV2l0aERvY3VtZW50Iiwib2xkUG9zaXRpb24iLCJSb290RWxlbWVudCIsIk1hcmtlciIsIm1hbmFnZWRVc2luZ09wZXJhdGlvbnMiLCJEb2N1bWVudEZyYWdtZW50Iiwibm9ybWFsaXplIiwiY29sb3JOYW1lIiwiY3NzS2V5d29yZHMiLCJyZXF1aXJlJCQwIiwicmV2ZXJzZUtleXdvcmRzIiwiY29udmVyc2lvbnMiLCJjaGFubmVscyIsImxhYmVscyIsInJnYiIsInIiLCJnIiwibWluIiwibWF4IiwiZGVsdGEiLCJoIiwicyIsImwiLCJyZGlmIiwiZ2RpZiIsImJkaWYiLCJ2IiwiZGlmZmMiLCJjIiwidyIsImsiLCJtIiwieSIsImNvbXBhcmF0aXZlRGlzdGFuY2UiLCJ4IiwicmV2ZXJzZWQiLCJjdXJyZW50Q2xvc2VzdERpc3RhbmNlIiwiY3VycmVudENsb3Nlc3RLZXl3b3JkIiwia2V5d29yZCIsImRpc3RhbmNlIiwieiIsInh5eiIsImhzbCIsInQyIiwidDMiLCJ2YWwiLCJ0MSIsInNtaW4iLCJsbWluIiwic3YiLCJoc3YiLCJoaSIsImYiLCJwIiwicSIsInQiLCJ2bWluIiwic2wiLCJod2IiLCJ3aCIsImJsIiwicmF0aW8iLCJjbXlrIiwibGFiIiwieTIiLCJ4MiIsInoyIiwibGNoIiwiaHIiLCJzYXR1cmF0aW9uIiwiYW5zaSIsImNvbG9yIiwibXVsdCIsInJlbSIsImNvbG9yU3RyaW5nIiwiaW50ZWdlciIsImNocm9tYSIsImdyYXlzY2FsZSIsImh1ZSIsImhjZyIsInB1cmUiLCJtZyIsImFwcGxlIiwiZ3JheSIsImJ1aWxkR3JhcGgiLCJncmFwaCIsIm1vZGVscyIsImxlbiIsImRlcml2ZUJGUyIsImZyb21Nb2RlbCIsInF1ZXVlIiwiY3VycmVudCIsImFkamFjZW50cyIsImFkamFjZW50IiwibGluayIsImZyb20iLCJ3cmFwQ29udmVyc2lvbiIsInRvTW9kZWwiLCJjdXIiLCJyb3V0ZSIsImNvbnZlcnNpb24iLCJyZXF1aXJlJCQxIiwid3JhcFJhdyIsIndyYXBwZWRGbiIsImFyZzAiLCJ3cmFwUm91bmRlZCIsInJvdXRlcyIsImNvbG9yQ29udmVydCIsInJldHVybkljb24iLCJMSVNUX1NUWUxFX1RZUEVTIiwibGlzdFN0eWxlIiwidHlwZUF0dHJpYnV0ZSIsImxpc3RUeXBlIiwiY29uZmlnIl0sIm1hcHBpbmdzIjoicUxBQ0EsSUFBSUEsR0FBYSxPQUFPLFFBQVUsVUFBWSxRQUFVLE9BQU8sU0FBVyxRQUFVLE9DRWhGQyxHQUFXLE9BQU8sTUFBUSxVQUFZLE1BQVEsS0FBSyxTQUFXLFFBQVUsS0FHeEVDLEVBQU9GLElBQWNDLElBQVksU0FBUyxhQUFhLEVBQUcsRUNIMURFLEVBQVNELEVBQUssT0NBZEUsR0FBYyxPQUFPLFVBR3JCQyxHQUFpQkQsR0FBWSxlQU83QkUsR0FBdUJGLEdBQVksU0FHbkNHLEdBQWlCSixFQUFTQSxFQUFPLFlBQWMsT0FTbkQsU0FBU0ssR0FBVUMsRUFBTyxDQUN4QixJQUFJQyxFQUFRTCxHQUFlLEtBQUtJLEVBQU9GLEVBQWMsRUFDakRJLEVBQU1GLEVBQU1GLEVBQWMsRUFFOUIsR0FBSSxDQUNGRSxFQUFNRixFQUFjLEVBQUksT0FDeEIsSUFBSUssRUFB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QUFpQixJQUFLLE9BQVEsTUFBTSxDQUFDLEVBQ3RHLENBQUMsS0FBTSxVQUFXLE1BQU8sQ0FBQyxPQUFRLFVBQVcsSUFBSyxZQUFhLElBQUssZUFBZ0IsT0FBTyxDQUFDLEVBQzVGLENBQ0ksS0FBTSxRQUNOLE1BQU8sQ0FBQyxPQUFRLFdBQVksUUFBUyxZQUFhLFdBQVksU0FBVSxTQUFVLGNBQWUsYUFBYSxDQUNsSCxFQUNBLENBQ0ksS0FBTSxjQUNOLE1BQU8sQ0FBQyxPQUFRLFNBQVUsWUFBYSxTQUFVLFlBQWEsY0FBZSxJQUFLLGNBQWMsQ0FDcEcsRUFDQSxDQUFDLEtBQU0sUUFBUyxNQUFPLENBQUMsT0FBUSxTQUFVLFFBQVEsQ0FBQyxFQUNuRCxDQUFDLEtBQU0sU0FBVSxNQUFPLENBQUMsWUFBYSxTQUFTLENBQUMsRUFDaEQsSUFDQSxDQUNJLEtBQU0sU0FDTixNQUFPLENBQUMsUUFBUyxRQUFTLFFBQVMsaUJBQWtCLFNBQVUsY0FBZSxZQUFhLFFBQVEsQ0FDdkcsRUFDQSxDQUNJLEtBQU0sWUFDTixNQUFPLENBQUMsZUFBZ0IsZUFBZ0IsSUFBSyxVQUFXLFNBQVUsSUFBSyxhQUFjLFlBQWEsSUFBSyxjQUFlLGdCQUFpQixlQUFnQixlQUFnQixJQUFLLFVBQVcsU0FBUyxDQUNwTSxFQUNBLENBQUMsS0FBTSxTQUFVLE1BQU8sQ0FBQyxTQUFVLFNBQVUsT0FBUSxVQUFVLENBQUMsQ0FFcEUsQ0FFUiIsInhfZ29vZ2xlX2lnbm9yZUxpc3QiOlswLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5LDIwLDIxLDIyLDIzLDI0LDI1LDI2LDI3LDI4LDI5LDMwLDMxLDMyLDMzLDM0LDM1LDM2LDM3LDM4LDM5LDQwLDQxLDQyLDQzLDQ0LDQ1LDQ2LDQ3LDQ4LDQ5LDUwLDUxLDUyLDUzLDU0LDU1LDU2LDU3LDU4LDU5LDYwLDYxLDYyLDYzLDY0LDY1LDY2LDY3LDY4LDY5LDcwLDcxLDcyLDczLDc0LDc1LDc2LDc3LDc4LDc5LDgwLDgxLDgyLDgzLDg0LDg1LDg2LDg3LDg4LDg5LDkwLDkxLDkyLDkzLDk0LDk1LDk2LDk3LDk4LDk5LDEwMCwxMDEsMTAyLDEwMywxMDQsMTA1LDEwNiwxMDcsMTA4LDEwOSwxMTAsMTExLDExMiwxMTMsMTE0LDExNSwxMTYsMTE3LDExOCwxMTksMTIwLDEyMSwxMjIsMTIzLDEyNCwxMjUsMTI2LDEyNywxMjgsMTI5LDEzMCwxMzEsMTMyLDEzMywxMzQsMTM1LDEzNiwxMzcsMTM4LDEzOSwxNDAsMTQxLDE0MiwxNDMsMTQ0LDE0NV19
